# IDS / IPS - Документация компонента

## Обзор

IDS/IPS (Intrusion Detection System / Intrusion Prevention System) - это система обнаружения и предотвращения вторжений для мониторинга сетевой безопасности. Компонент IDS/IPS в системе симуляции полностью эмулирует поведение реальных IDS/IPS систем (Snort, Suricata), включая обнаружение по сигнатурам (Snort rules), обнаружение аномалий, поведенческий анализ, протокольный анализ (Deep Packet Inspection), управление заблокированными IP и полный набор метрик производительности и безопасности.

### Основные возможности

- ✅ **Signature Detection** - Обнаружение известных атак по сигнатурам (regex, Snort rules)
- ✅ **Anomaly Detection** - Статистическое обнаружение аномалий в сетевом трафике
- ✅ **Behavioral Analysis** - Поведенческий анализ для обнаружения подозрительных паттернов
- ✅ **Protocol Analysis** - Deep Packet Inspection с анализом TCP флагов, sequence numbers, фрагментации
- ✅ **Snort Rules Support** - Поддержка формата правил Snort (стандарт индустрии)
- ✅ **IDS/IPS Modes** - Режимы работы: IDS (обнаружение) и IPS (блокировка)
- ✅ **IP Blocking** - Управление заблокированными IP с автоматическим истечением
- ✅ **Alert Management** - Генерация и управление алертами с различными уровнями серьезности
- ✅ **Connection Rules** - Автоматическая настройка конфигов при подключении компонентов
- ✅ **Метрики IDS/IPS** - Полный набор метрик производительности и безопасности

---

## Основные функции

### 1. Operation Modes (Режимы работы)

**Описание:** IDS/IPS может работать в двух режимах для обработки обнаруженных угроз.

**Режимы:**

#### 1.1. IDS Mode (Режим обнаружения)

**Описание:** IDS обнаруживает угрозы, но не блокирует пакеты. Все угрозы логируются и генерируются алерты.

**Параметры:**
- **mode**: `ids`

**Поведение:**
- Угрозы обнаруживаются и логируются
- Пакеты не блокируются
- Генерируются алерты
- Метрики `alertsGenerated` увеличиваются
- Алерты отображаются в UI

**Использование:** Для мониторинга и анализа трафика без блокировки легитимных запросов.

#### 1.2. IPS Mode (Режим предотвращения)

**Описание:** IPS блокирует пакеты при обнаружении угроз.

**Параметры:**
- **mode**: `ips`

**Поведение:**
- Угрозы обнаруживаются и блокируются
- Пакеты с угрозами отклоняются
- Генерируются алерты
- Метрики `alertsBlocked` и `alertsGenerated` увеличиваются
- IP адреса могут быть автоматически заблокированы (если включен auto-block)

**Использование:** Для production окружений с активной защитой.

### 2. Signature Detection (Обнаружение по сигнатурам)

**Описание:** IDS/IPS использует сигнатуры для обнаружения известных атак и паттернов.

**Параметры:**
- **enableSignatureDetection** - Включить обнаружение по сигнатурам (по умолчанию: `true`)

**Типы сигнатур:**

#### 2.1. Regex Patterns

**Описание:** Простые регулярные выражения для поиска паттернов в payload.

**Пример:**
```json
{
  "id": "sql-injection-1",
  "name": "SQL Injection Detection",
  "pattern": "(?i)(union|select|insert|delete|drop|exec|script)",
  "severity": "high",
  "action": "alert"
}
```

#### 2.2. Snort Rules

**Описание:** Правила в формате Snort (стандарт индустрии).

**Формат Snort Rule:**
```
action protocol source port direction destination port (options)
```

**Примеры Snort Rules:**

**Обнаружение SSH подключений:**
```
alert tcp any any -> any 22 (msg:"SSH connection detected"; sid:1000001;)
```

**Обнаружение SQL Injection:**
```
alert tcp any any -> any 80 (msg:"SQL Injection attempt"; content:"union select"; sid:1000002;)
```

**Обнаружение XSS:**
```
alert tcp any any -> any 80 (msg:"XSS attempt"; content:"<script>"; sid:1000003;)
```

**Поддерживаемые действия:**
- **alert** - Генерировать алерт
- **log** - Только логировать
- **pass** - Пропустить пакет
- **drop** - Заблокировать пакет (только для IPS)
- **reject** - Отклонить пакет с отправкой ошибки

**Поддерживаемые протоколы:**
- **tcp** - TCP
- **udp** - UDP
- **icmp** - ICMP
- **ip** - Все IP протоколы

**Поддерживаемые опции:**
- **msg** - Сообщение алерта
- **sid** - Signature ID
- **rev** - Revision
- **content** - Содержимое для поиска
- **flags** - TCP flags
- **threshold** - Пороги
- И другие опции

**Структура сигнатуры:**
```json
{
  "id": "sig-1",
  "name": "SSH Brute Force",
  "description": "Detect SSH brute force attacks",
  "enabled": true,
  "severity": "high",
  "pattern": "alert tcp any any -> any 22 (msg:\"SSH brute force\"; sid:1000001;)",
  "action": "block",
  "protocol": "tcp",
  "port": 22
}
```

**Параметры сигнатуры:**
- **id** - Уникальный идентификатор (обязательно)
- **name** - Имя сигнатуры (обязательно)
- **description** - Описание сигнатуры
- **enabled** - Включена ли сигнатура (по умолчанию: `true`)
- **severity** - Серьезность: `critical`, `high`, `medium`, `low` (обязательно)
- **pattern** - Паттерн обнаружения (regex или Snort rule) (обязательно)
- **action** - Действие: `alert`, `block`, `log` (обязательно)
- **protocol** - Протокол: `tcp`, `udp`, `icmp`, `all` (опционально)
- **sourceIP** - Source IP или CIDR (опционально)
- **destinationIP** - Destination IP или CIDR (опционально)
- **port** - Destination порт (опционально)
- **sourcePort** - Source порт (опционально)

**Валидация сигнатур:**
- Regex паттерны валидируются на корректность синтаксиса
- Snort rules валидируются на корректность формата
- Ошибки валидации отображаются в UI

### 3. Anomaly Detection (Обнаружение аномалий)

**Описание:** IDS/IPS использует статистические методы для обнаружения аномалий в сетевом трафике.

**Параметры:**
- **enableAnomalyDetection** - Включить обнаружение аномалий (по умолчанию: `true`)

**Методы обнаружения:**

#### 3.1. Statistical Baselines (Статистические базовые линии)

**Описание:** IDS/IPS обучается на исторических данных для создания базовых линий нормального трафика.

**Базовые линии:**
- **Port Baselines** - Нормальная активность по портам
- **Protocol Baselines** - Нормальная активность по протоколам
- **Payload Size Baselines** - Нормальные размеры payload

**Как работает:**
1. IDS/IPS собирает статистику за период обучения (10 минут)
2. Вычисляет среднее (mean) и стандартное отклонение (stdDev) для каждого порта/протокола
3. Использует z-score (3-sigma rule) для обнаружения аномалий
4. Если значение отклоняется более чем на 3 стандартных отклонения, обнаруживается аномалия

**Пример:**
- Нормальный трафик на порт 80: mean=100 пакетов/минуту, stdDev=10
- Аномальный трафик: 150 пакетов/минуту (z-score > 3)
- Обнаруживается аномалия

#### 3.2. Suspicious Patterns (Подозрительные паттерны)

**Описание:** Обнаружение подозрительных паттернов в payload.

**Паттерны:**
- SQL Injection паттерны (`union select`, `drop table`, etc.)
- XSS паттерны (`<script>`, `javascript:`, etc.)
- Command Injection паттерны (`; ls`, `| cat`, etc.)
- Path Traversal паттерны (`../`, `..\\`, etc.)

**Пример конфигурации:**
```json
{
  "enableAnomalyDetection": true
}
```

### 4. Behavioral Analysis (Поведенческий анализ)

**Описание:** IDS/IPS анализирует поведение трафика для обнаружения подозрительных паттернов.

**Параметры:**
- **enableBehavioralAnalysis** - Включить поведенческий анализ (по умолчанию: `false`)

**Методы анализа:**

#### 4.1. Request Rate Analysis

**Описание:** Анализ частоты запросов от одного IP адреса.

**Паттерны:**
- Высокая частота запросов (DDoS атака)
- Необычная частота запросов (аномалия)

#### 4.2. Temporal Patterns (Временные паттерны)

**Описание:** Анализ временных паттернов трафика.

**Паттерны:**
- **Hourly Patterns** - Паттерны по часам суток
- **Daily Patterns** - Паттерны по дням недели
- Обнаружение аномальных временных паттернов

#### 4.3. Scanning Detection (Обнаружение сканирования)

**Описание:** Обнаружение попыток сканирования сети.

**Типы сканирования:**
- **Port Scanning** - Сканирование портов
- **Network Scanning** - Сканирование сети
- **DDoS Pattern** - Паттерны DDoS атак

**Методы обнаружения:**
- Отслеживание количества различных портов от одного IP
- Отслеживание количества различных IP адресов
- Обнаружение высокого RPS (requests per second)

**Пример конфигурации:**
```json
{
  "enableBehavioralAnalysis": true
}
```

### 5. Protocol Analysis (Протокольный анализ)

**Описание:** Deep Packet Inspection (DPI) для анализа протокольных нарушений.

**Методы анализа:**

#### 5.1. TCP Flags Analysis

**Описание:** Анализ TCP флагов для обнаружения подозрительных комбинаций.

**Подозрительные комбинации:**
- **FIN без ACK** - Подозрительное завершение соединения
- **RST** - Сброс соединения (может быть атакой)
- **Множественные флаги** - Необычные комбинации флагов

**TCP Flags:**
- **SYN** - Синхронизация (начало соединения)
- **ACK** - Подтверждение
- **FIN** - Завершение соединения
- **RST** - Сброс соединения
- **PSH** - Push (немедленная отправка данных)
- **URG** - Urgent (срочные данные)

#### 5.2. TCP Sequence Numbers Analysis

**Описание:** Анализ TCP sequence numbers для обнаружения аномалий.

**Проверки:**
- Валидность sequence numbers
- Обнаружение out-of-order пакетов
- Обнаружение аномальных sequence numbers

#### 5.3. Fragmentation Analysis

**Описание:** Анализ фрагментации пакетов.

**Проверки:**
- Обнаружение фрагментированных пакетов
- Обнаружение overlapping fragments
- Обнаружение подозрительной фрагментации

**Пример конфигурации:**
```json
{
  "enableAnomalyDetection": true
}
```

**Примечание:** Протокольный анализ выполняется автоматически при включенном anomaly detection.

### 6. IP Blocking (Блокировка IP)

**Описание:** IDS/IPS может блокировать IP адреса при обнаружении угроз.

**Параметры:**
- **enableAutoBlock** - Автоматическая блокировка IP (по умолчанию: `false`)
- **blockDuration** - Длительность блокировки в секундах (по умолчанию: `3600` = 1 час)

**Как работает:**
1. При обнаружении угрозы (если `enableAutoBlock: true` и severity `critical`)
2. IP адрес автоматически блокируется
3. Блокировка действует в течение `blockDuration` секунд
4. После истечения блокировка автоматически снимается

**Управление заблокированными IP:**
- Просмотр списка заблокированных IP
- Ручная блокировка IP
- Ручное снятие блокировки
- Просмотр причины блокировки

**Пример конфигурации:**
```json
{
  "enableAutoBlock": true,
  "blockDuration": 3600
}
```

### 7. Alert Management (Управление алертами)

**Описание:** IDS/IPS генерирует алерты при обнаружении угроз.

**Типы алертов:**
- **signature** - Обнаружение по сигнатуре
- **anomaly** - Обнаружение аномалии
- **behavioral** - Обнаружение поведенческой аномалии

**Уровни серьезности:**
- **critical** - Критическая угроза
- **high** - Высокая серьезность
- **medium** - Средняя серьезность
- **low** - Низкая серьезность

**Параметры:**
- **alertThreshold** - Порог для генерации алертов: `low`, `medium`, `high`, `critical` (по умолчанию: `medium`)

**Структура алерта:**
```json
{
  "id": "alert-1",
  "type": "signature",
  "sourceIP": "192.168.1.100",
  "destinationIP": "10.0.0.1",
  "protocol": "tcp",
  "port": 80,
  "severity": "high",
  "timestamp": 1609459200000,
  "description": "SQL Injection attempt detected",
  "blocked": false,
  "signature": "SQL Injection Detection",
  "signatureId": "sig-1"
}
```

**Управление алертами:**
- Просмотр списка алертов
- Фильтрация по типу, серьезности, времени
- Группировка алертов
- Экспорт алертов
- Визуализация алертов (графики)

### 8. Snort Rules Support (Поддержка Snort Rules)

**Описание:** IDS/IPS поддерживает формат правил Snort (стандарт индустрии).

**Парсер Snort Rules:**
- Полный парсер Snort rules
- Поддержка всех основных действий (alert, log, pass, drop, reject)
- Поддержка всех протоколов (tcp, udp, icmp, ip)
- Поддержка IP адресов, CIDR, портов и диапазонов портов
- Извлечение всех опций из скобок (msg, sid, rev, content, flags, threshold, etc.)
- Валидация IP адресов, CIDR и портов
- Кэширование распарсенных правил для производительности

**Примеры Snort Rules:**

**Обнаружение SSH подключений:**
```
alert tcp any any -> any 22 (msg:"SSH connection detected"; sid:1000001;)
```

**Обнаружение SQL Injection:**
```
alert tcp any any -> any 80 (msg:"SQL Injection attempt"; content:"union select"; sid:1000002;)
```

**Обнаружение XSS:**
```
alert tcp any any -> any 80 (msg:"XSS attempt"; content:"<script>"; sid:1000003;)
```

**Обнаружение Port Scan:**
```
alert tcp any any -> any any (msg:"Port scan detected"; threshold:type threshold, track by_src, count 10, seconds 60; sid:1000004;)
```

**Использование:**
1. Создайте сигнатуру с pattern в формате Snort rule
2. Парсер автоматически распознает формат Snort
3. Правило кэшируется для производительности
4. Правило применяется к каждому пакету

---

## Руководство пользователя

### Быстрый старт

1. **Добавление компонента IDS/IPS:**
   - Перетащите компонент "IDS / IPS" из библиотеки компонентов на canvas
   - Откройте панель конфигурации компонента

2. **Настройка режима работы:**
   - Перейдите на вкладку **"Settings"**
   - Выберите режим: `ids` (обнаружение) или `ips` (блокировка)
   - Для production используйте `ips`

3. **Включение методов обнаружения:**
   - В секции **"Detection Methods"** включите:
     - **Signature Detection** - Обнаружение по сигнатурам
     - **Anomaly Detection** - Обнаружение аномалий
     - **Behavioral Analysis** - Поведенческий анализ (опционально)

4. **Создание первой сигнатуры:**
   - Перейдите на вкладку **"Signatures"**
   - Нажмите кнопку **"Add Signature"**
   - Заполните параметры сигнатуры
   - Нажмите **"Save"**

5. **Подключение к другим компонентам:**
   - Создайте соединение от компонента к IDS/IPS
   - IDS/IPS автоматически настроится для мониторинга трафика (Connection Rules)

### Работа с сигнатурами

#### Создание сигнатуры с Regex Pattern

1. Перейдите на вкладку **"Signatures"**
2. Нажмите кнопку **"Add Signature"**
3. Заполните параметры:
   - **Name** - Имя сигнатуры
   - **Pattern** - Regex паттерн (например: `(?i)(union|select|insert)`)
   - **Severity** - Серьезность
   - **Action** - Действие: `alert`, `block`, `log`
4. Нажмите **"Save"**

**Валидация:** Regex паттерн валидируется на корректность синтаксиса.

#### Создание сигнатуры с Snort Rule

1. В поле **Pattern** введите Snort rule:
   ```
   alert tcp any any -> any 80 (msg:"SQL Injection"; content:"union select"; sid:1000001;)
   ```
2. Парсер автоматически распознает формат Snort
3. Нажмите **"Save"**

**Валидация:** Snort rule валидируется на корректность формата.

#### Импорт сигнатур

1. Перейдите на вкладку **"Signatures"**
2. Нажмите кнопку **"Import"**
3. Выберите источник:
   - **From File** - Импорт из файла (JSON или Snort rules)
   - **From URL** - Импорт из URL (автоматическое определение формата)
4. Выберите файл или введите URL
5. Нажмите **"Import"**

**Поддерживаемые форматы:**
- JSON (массив сигнатур)
- Snort rules (текстовый файл с правилами)

#### Экспорт сигнатур

1. Перейдите на вкладку **"Signatures"**
2. Выберите сигнатуры для экспорта (через checkbox)
3. Нажмите кнопку **"Export"**
4. Выберите формат: **JSON** или **Snort Rules**
5. Файл будет загружен

#### Тестирование сигнатур

1. Найдите сигнатуру в списке
2. Нажмите кнопку **"Test"**
3. В диалоге тестирования:
   - Выберите пример payload (SQL Injection, XSS, etc.)
   - Или введите свой payload
4. Нажмите **"Test"**
5. Просмотрите результат (matched/not matched)

#### Массовое управление сигнатурами

1. Выберите сигнатуры через checkbox
2. Используйте кнопки:
   - **Enable Selected** - Включить выбранные
   - **Disable Selected** - Отключить выбранные
   - **Delete Selected** - Удалить выбранные

### Работа с алертами

#### Просмотр алертов

1. Перейдите на вкладку **"Alerts"**
2. Просматривайте список обнаруженных алертов
3. Фильтруйте алерты по:
   - **Type** - Тип (signature, anomaly, behavioral)
   - **Severity** - Серьезность (critical, high, medium, low)
   - **Time** - Время (1h, 6h, 24h, 7d)
4. Используйте поиск для фильтрации по тексту

#### Группировка алертов

1. В секции **"Group By"** выберите режим группировки:
   - **None** - Без группировки
   - **Type** - По типу
   - **Severity** - По серьезности
   - **Source IP** - По IP адресу источника
   - **Time** - По времени
2. Алерты будут сгруппированы

#### Визуализация алертов

1. На вкладке **"Alerts"** просматривайте графики:
   - **Line Chart** - Временные тренды (последние 24 часа)
   - **Stacked Bar Chart** - Распределение по типам обнаружения
   - **Pie Chart** - Типы атак (SQL Injection, XSS, Brute Force, DDoS, etc.)
   - **Bar Chart** - Распределение по severity

#### Экспорт алертов

1. На вкладке **"Alerts"** нажмите кнопку **"Export"**
2. Выберите формат: **JSON** или **CSV**
3. Файл будет загружен

### Работа с заблокированными IP

#### Просмотр заблокированных IP

1. Перейдите на вкладку **"Blocked IPs"**
2. Просматривайте список заблокированных IP адресов
3. Просматривайте причину блокировки и время истечения

#### Ручная блокировка IP

1. На вкладке **"Blocked IPs"** нажмите кнопку **"Block IP"**
2. Введите IP адрес
3. Укажите причину блокировки
4. Укажите длительность блокировки (в секундах)
5. Нажмите **"Block"**

#### Снятие блокировки

1. Найдите заблокированный IP в списке
2. Нажмите кнопку **"Unblock"**
3. Подтвердите действие

**Примечание:** Блокировки автоматически истекают через указанное время.

### Настройка Auto-Block

1. Перейдите на вкладку **"Settings"**
2. В секции **"Auto-Block"** включите **Enable Auto-Block**
3. Укажите **Block Duration** (в секундах)
4. Нажмите **"Save"**

**Поведение:**
- IP адреса с критическими угрозами автоматически блокируются
- Блокировка действует в течение указанного времени
- После истечения блокировка автоматически снимается

---

## Руководство администратора

### Рекомендации по конфигурации

#### Production IDS/IPS

```json
{
  "mode": "ips",
  "enableSignatureDetection": true,
  "enableAnomalyDetection": true,
  "enableBehavioralAnalysis": true,
  "alertThreshold": "medium",
  "enableAutoBlock": true,
  "blockDuration": 3600,
  "enableLogging": true,
  "logRetention": 30,
  "signatures": [
    {
      "id": "sql-injection",
      "name": "SQL Injection Detection",
      "pattern": "alert tcp any any -> any 80 (msg:\"SQL Injection\"; content:\"union select\"; sid:1000001;)",
      "severity": "high",
      "action": "block",
      "enabled": true
    }
  ]
}
```

**Рекомендации:**
- Используйте режим `ips` для production с активной блокировкой
- Включите все методы обнаружения для максимальной защиты
- Используйте `alertThreshold: "medium"` для баланса между обнаружением и false positives
- Включите `enableAutoBlock: true` для автоматической блокировки критических угроз
- Настройте разумную `blockDuration` (1 час рекомендуется)
- Используйте Snort rules для стандартизированных сигнатур
- Регулярно обновляйте сигнатуры из репозиториев правил

### Оптимизация производительности

#### Количество сигнатур

**Рекомендации:**
- Минимизируйте количество сигнатур для лучшей производительности
- Используйте приоритетные сигнатуры для критических угроз
- Отключайте неиспользуемые сигнатуры
- Группируйте похожие сигнатуры

**Влияние на производительность:**
- Каждая сигнатура проверяется для каждого пакета
- При большом количестве сигнатур (>1000) латентность может увеличиться
- Используйте кэширование Snort rules для производительности

#### Методы обнаружения

**Рекомендации:**
- Используйте **Signature Detection** для известных угроз (быстро и точно)
- Используйте **Anomaly Detection** для обнаружения новых угроз (медленнее, но более гибко)
- Используйте **Behavioral Analysis** для сложных атак (медленнее всего, но наиболее гибко)

**Влияние на производительность:**
- Signature Detection: низкая латентность
- Anomaly Detection: средняя латентность (статистические вычисления)
- Behavioral Analysis: высокая латентность (сложные вычисления)

### Безопасность

#### Управление сигнатурами

- Регулярно обновляйте сигнатуры из репозиториев правил
- Используйте проверенные источники сигнатур
- Валидируйте сигнатуры перед добавлением
- Тестируйте сигнатуры на тестовых данных
- Мониторьте false positive rate

#### Управление алертами

- Настройте правильный `alertThreshold` для баланса между обнаружением и false positives
- Регулярно анализируйте алерты на ложные срабатывания
- Настройте группировку алертов для лучшего анализа
- Экспортируйте алерты для долгосрочного анализа

#### Управление блокировками

- Используйте `enableAutoBlock: true` для автоматической блокировки критических угроз
- Настройте разумную `blockDuration` (не слишком короткую, не слишком длинную)
- Регулярно проверяйте заблокированные IP на ложные срабатывания
- Разблокируйте легитимные IP при необходимости

### Мониторинг и алертинг

#### Ключевые метрики

1. **Total Packets**
   - Нормальное значение: зависит от нагрузки
   - Алерт: резкое увеличение может указывать на атаку

2. **Alerts Generated**
   - Нормальное значение: зависит от трафика
   - Алерт: резкое увеличение может указывать на атаку

3. **Alerts Blocked**
   - Нормальное значение: зависит от режима и правил
   - Алерт: резкое увеличение может указывать на атаку

4. **Signature Matches**
   - Нормальное значение: зависит от сигнатур
   - Алерт: резкое увеличение может указывать на атаку

5. **Anomaly Detections**
   - Нормальное значение: зависит от трафика
   - Алерт: резкое увеличение может указывать на новые угрозы

6. **Blocked IPs**
   - Нормальное значение: зависит от auto-block настроек
   - Алерт: `blockedIPs > 100` (много заблокированных IP)

7. **Average Latency**
   - Нормальное значение: < 10ms
   - Алерт: `averageLatency > 50ms` (медленная обработка)

#### Рекомендации по алертингу

- Настройте алерты на резкое увеличение `alertsGenerated`
- Настройте алерты на резкое увеличение `alertsBlocked`
- Настройте алерты на высокую `averageLatency`
- Настройте алерты на большое количество `blockedIPs`

---

## Метрики и мониторинг

### Метрики Packets

- **totalPackets** - Общее количество обработанных пакетов
- **packetsAnalyzed** - Количество проанализированных пакетов

### Метрики Alerts

- **alertsGenerated** - Общее количество сгенерированных алертов
- **alertsBlocked** - Количество заблокированных пакетов (IPS режим)

### Метрики Detection

- **signatureMatches** - Количество совпадений сигнатур
- **anomalyDetections** - Количество обнаруженных аномалий
- **behavioralDetections** - Количество обнаруженных поведенческих аномалий

### Метрики Configuration

- **activeSignatures** - Количество активных сигнатур
- **blockedIPs** - Количество заблокированных IP адресов

### Per-Second Метрики

- **packetsPerSecond** - Скорость обработки пакетов (PPS)
- **averageLatency** - Средняя latency обработки (ms)
- **errorRate** - Процент ошибок (0-1)
- **blockRate** - Процент заблокированных пакетов (0-1)
- **alertRate** - Скорость генерации алертов (алертов в секунду)

### Мониторинг в реальном времени

Все метрики обновляются в реальном времени во время симуляции:
- Метрики синхронизируются из `IDSIPSEmulationEngine` каждые 500ms
- Метрики отображаются в UI компонента
- Алерты обновляются в реальном времени
- Заблокированные IP обновляются в реальном времени

---

## Примеры использования

### Пример 1: Базовый IDS для мониторинга

**Сценарий:** Мониторинг сетевого трафика без блокировки

```json
{
  "mode": "ids",
  "enableSignatureDetection": true,
  "enableAnomalyDetection": true,
  "enableBehavioralAnalysis": false,
  "alertThreshold": "medium",
  "enableAutoBlock": false,
  "enableLogging": true,
  "signatures": [
    {
      "id": "ssh-brute-force",
      "name": "SSH Brute Force",
      "pattern": "alert tcp any any -> any 22 (msg:\"SSH brute force\"; sid:1000001;)",
      "severity": "high",
      "action": "alert",
      "enabled": true
    }
  ]
}
```

### Пример 2: IPS с автоматической блокировкой

**Сценарий:** Активная защита с автоматической блокировкой угроз

```json
{
  "mode": "ips",
  "enableSignatureDetection": true,
  "enableAnomalyDetection": true,
  "enableBehavioralAnalysis": true,
  "alertThreshold": "medium",
  "enableAutoBlock": true,
  "blockDuration": 3600,
  "signatures": [
    {
      "id": "sql-injection",
      "name": "SQL Injection",
      "pattern": "alert tcp any any -> any 80 (msg:\"SQL Injection\"; content:\"union select\"; sid:1000002;)",
      "severity": "critical",
      "action": "block",
      "enabled": true
    },
    {
      "id": "xss",
      "name": "XSS Attack",
      "pattern": "alert tcp any any -> any 80 (msg:\"XSS\"; content:\"<script>\"; sid:1000003;)",
      "severity": "high",
      "action": "block",
      "enabled": true
    }
  ]
}
```

### Пример 3: IDS с поведенческим анализом

**Сценарий:** Обнаружение сложных атак через поведенческий анализ

```json
{
  "mode": "ids",
  "enableSignatureDetection": true,
  "enableAnomalyDetection": true,
  "enableBehavioralAnalysis": true,
  "alertThreshold": "low",
  "enableAutoBlock": false,
  "signatures": []
}
```

**Поведение:**
- Поведенческий анализ обнаруживает DDoS, port scanning, network scanning
- Временные паттерны анализируются для обнаружения аномалий
- Генерируются алерты для дальнейшего анализа

### Пример 4: IDS с Snort Rules

**Сценарий:** Использование стандартных Snort rules

```json
{
  "mode": "ids",
  "enableSignatureDetection": true,
  "signatures": [
    {
      "id": "snort-rule-1",
      "name": "SSH Connection",
      "pattern": "alert tcp any any -> any 22 (msg:\"SSH connection detected\"; sid:1000001;)",
      "severity": "medium",
      "action": "alert",
      "enabled": true
    },
    {
      "id": "snort-rule-2",
      "name": "Port Scan",
      "pattern": "alert tcp any any -> any any (msg:\"Port scan detected\"; threshold:type threshold, track by_src, count 10, seconds 60; sid:1000004;)",
      "severity": "high",
      "action": "alert",
      "enabled": true
    }
  ]
}
```

### Пример 5: IPS с протокольным анализом

**Сценарий:** Защита от протокольных нарушений

```json
{
  "mode": "ips",
  "enableSignatureDetection": true,
  "enableAnomalyDetection": true,
  "enableAutoBlock": true,
  "blockDuration": 1800,
  "signatures": []
}
```

**Поведение:**
- Протокольный анализ обнаруживает подозрительные TCP flags
- Обнаруживаются аномальные sequence numbers
- Обнаруживается подозрительная фрагментация
- Критические протокольные нарушения автоматически блокируются

---

## Часто задаваемые вопросы (FAQ)

### Что такое IDS/IPS?

IDS (Intrusion Detection System) - это система обнаружения вторжений, которая мониторит сетевой трафик и обнаруживает подозрительную активность. IPS (Intrusion Prevention System) - это система предотвращения вторжений, которая не только обнаруживает, но и блокирует угрозы.

### В чем разница между IDS и IPS?

- **IDS** - только обнаружение, не блокирует пакеты
- **IPS** - обнаружение + блокировка пакетов

### Как работает IDS/IPS?

1. IDS/IPS получает сетевые пакеты от компонентов
2. Анализирует пакеты с помощью различных методов:
   - Signature Detection (поиск известных паттернов)
   - Anomaly Detection (статистический анализ)
   - Behavioral Analysis (поведенческий анализ)
   - Protocol Analysis (протокольный анализ)
3. При обнаружении угрозы генерируется алерт
4. В режиме IPS пакет блокируется
5. IP адрес может быть автоматически заблокирован

### Что такое Signature Detection?

Signature Detection - это метод обнаружения известных атак по сигнатурам (паттернам). Сигнатуры могут быть в формате regex или Snort rules.

### Что такое Anomaly Detection?

Anomaly Detection - это метод обнаружения аномалий в сетевом трафике с помощью статистических методов. IDS/IPS обучается на исторических данных для создания базовых линий нормального трафика и обнаруживает отклонения.

### Что такое Behavioral Analysis?

Behavioral Analysis - это метод обнаружения подозрительных паттернов поведения в трафике. Анализируются временные паттерны, частота запросов, сканирование портов и сети, DDoS паттерны.

### Что такое Protocol Analysis?

Protocol Analysis (Deep Packet Inspection) - это анализ протокольных нарушений. Проверяются TCP flags, sequence numbers, фрагментация пакетов для обнаружения подозрительных комбинаций.

### Что такое Snort Rules?

Snort Rules - это стандартный формат правил для обнаружения угроз, используемый в индустрии. Формат: `action protocol source port direction destination port (options)`.

### Как создать сигнатуру?

1. Перейдите на вкладку **"Signatures"**
2. Нажмите **"Add Signature"**
3. Заполните параметры (name, pattern, severity, action)
4. Валидация выполняется автоматически
5. Нажмите **"Save"**

### Как импортировать сигнатуры?

1. Перейдите на вкладку **"Signatures"**
2. Нажмите **"Import"**
3. Выберите источник: **From File** или **From URL**
4. Выберите файл или введите URL
5. Нажмите **"Import"**

**Поддерживаемые форматы:** JSON, Snort rules

### Как работает Auto-Block?

При включенном `enableAutoBlock: true` IP адреса с критическими угрозами автоматически блокируются на указанное время (`blockDuration`). После истечения блокировка автоматически снимается.

### Как мониторить IDS/IPS?

Используйте метрики IDS/IPS:
- **Total Packets** - Общее количество обработанных пакетов
- **Alerts Generated** - Количество сгенерированных алертов
- **Alerts Blocked** - Количество заблокированных пакетов
- **Signature Matches** - Количество совпадений сигнатур
- **Anomaly Detections** - Количество обнаруженных аномалий
- **Blocked IPs** - Количество заблокированных IP
- **Average Latency** - Средняя latency обработки

### Как работает Connection Rules?

Connection Rules автоматически настраивают IDS/IPS при подключении компонентов:
- IDS/IPS может мониторить трафик от любых компонентов
- Автоматически создаются сигнатуры для мониторинга целевых компонентов
- Автоматически настраиваются режимы (IDS/IPS) для баз данных

---

## Дополнительные ресурсы

- [Snort Documentation](https://www.snort.org/documents)
- [Suricata Documentation](https://suricata.readthedocs.io/)
- [NIST SP 800-94: Guide to Intrusion Detection and Prevention Systems](https://csrc.nist.gov/publications/detail/sp/800-94/final)
- [OWASP ModSecurity Core Rule Set](https://coreruleset.org/)
- [Zeek (Bro) Network Analysis Framework](https://zeek.org/)
- [OSSEC Host-based IDS](https://www.ossec.net/)
