# Changelog

## [0.1.7z] - 2024-12-XX

### Добавлено

#### Keycloak: Полная симуляция и исправление UI/UX
- **Синхронизация с симуляцией**: Конфигурация синхронизируется с `KeycloakEmulationEngine` в реальном времени
- **Активные сессии**: Метрики сессий читаются из эмуляции с обновлением каждые 2 секунды
- **Toast-уведомления**: Добавлены уведомления для всех операций (добавление, удаление, изменение)
- **Показ/скрытие паролей**: Добавлена функциональность для Client Secret и User Credentials

#### WAF / API Shield: Полная реализация симуляции и улучшение UI/UX
- **WAFRoutingEngine**: Создан движок для обработки запросов через WAF с поддержкой правил, OWASP, rate limiting, geo-blocking и DDoS protection
- **WAFEmulationEngine**: Реализован движок для расчета метрик WAF (блокировки, угрозы, latency, utilization)
- **Интеграция в EmulationEngine**: Добавлена полная симуляция WAF с расчетом метрик на основе конфигурации
- **Обработчик в DataFlowEngine**: Реализована фильтрация и блокировка сообщений через WAF
- **Синхронизация UI с симуляцией**: Метрики отображаются в реальном времени из эмуляции
- **Редактирование условий правил**: Полноценный CRUD для условий правил с поддержкой всех типов (ip, uri, header, body, method, country, user-agent) и операторов (equals, contains, startsWith, endsWith, regex, in, not-in)
- **Поиск и фильтрация**: Добавлен поиск правил и фильтрация угроз (все/заблокированные/не заблокированные)
- **Toast-уведомления**: Добавлены уведомления для всех операций с правилами и условиями

### Исправлено

#### Keycloak UI элементы
- **Protocol Mappers**: Исправлены обработчики создания и удаления mappers
- **User Attributes**: Реализованы добавление, редактирование и удаление атрибутов
- **User Credentials**: Добавлена функциональность установки паролей (включая временные)
- **Identity Providers**: Реализован диалог добавления провайдеров (Google, GitHub, Facebook, SAML, OIDC, LDAP)
- **Client Scopes**: Исправлены обработчики создания и удаления scopes
- **Realm Roles**: Реализованы создание и удаление ролей с автоматическим удалением из пользователей
- **Client Secret**: Добавлена кнопка показа/скрытия пароля и копирования
- **Badge "Active"**: Теперь показывает реальное состояние подключения компонента
  - "Active" - компонент включен И имеет соединения
  - "Connected" - есть соединения, но компонент выключен
  - "Standalone" - компонент не подключен ни к одному компоненту

#### WAF UI элементы
- **Кнопка Refresh**: Исправлена функциональность сброса метрик
- **Сохранение данных**: Исправлена синхронизация конфигурации с эмуляцией при изменениях
- **Индексация в циклах**: Исправлена индексация для корректной работы обработчиков условий
- **Отображение метрик**: Метрики теперь берутся из реальной эмуляции, а не из статических значений
- **Отображение угроз**: Угрозы отображаются из эмуляции с детальной информацией (ruleId, ruleName, details)

### Удалено

#### Keycloak UI очистка
- **Кнопка "Admin Console"**: Удалена неиспользуемая пустышка
- **Карточка "Realm"**: Удалена из статистики (не несёт функциональной нагрузки)
- **Блок "Themes"**: Удалены визуальные настройки (не влияют на симуляцию)

### Улучшено

#### Keycloak UX
- **Валидация данных**: Корректная обработка данных перед сохранением
- **Индексация элементов**: Исправлена индексация в Dialog для корректной работы обработчиков
- **Оптимизация grid**: Изменён grid статистики с 4 на 3 колонки

### Технические изменения
- Обновлён `src/components/config/security/KeycloakConfigAdvanced.tsx`:
  - Добавлены обработчики для всех интерактивных элементов
  - Реализована синхронизация конфига с `KeycloakEmulationEngine`
  - Добавлены toast-уведомления через `useToast`
  - Исправлено получение метрик сессий из эмуляции
  - Добавлены состояния для управления видимостью паролей
  - Удалены неиспользуемые элементы UI

- Создан `src/core/WAFRoutingEngine.ts`:
  - Обработка запросов через WAF с проверкой правил, OWASP, rate limiting, geo-blocking, DDoS protection
  - Обнаружение угроз (SQL injection, XSS, path traversal, RCE)
  - Отслеживание статистики и истории угроз

- Создан `src/core/WAFEmulationEngine.ts`:
  - Расчет метрик WAF (throughput, latency, error rate, utilization)
  - Симуляция запросов для расчета метрик
  - Управление историей угроз и статистикой

- Обновлён `src/core/EmulationEngine.ts`:
  - Добавлен case `'waf'` в switch для симуляции
  - Метод `simulateWAF()` для расчета метрик на основе конфигурации
  - Метод `initializeWAFEngine()` для инициализации движка
  - Метод `getWAFEmulationEngine()` для доступа к движку

- Обновлён `src/core/DataFlowEngine.ts`:
  - Добавлен обработчик `createWAFHandler()` для фильтрации сообщений через WAF
  - Реализована блокировка запросов на основе правил и обнаруженных угроз

- Обновлён `src/components/config/security/WAFConfigAdvanced.tsx`:
  - Добавлена синхронизация с `WAFEmulationEngine` через `useEmulationStore`
  - Реализовано редактирование условий правил с полным CRUD
  - Добавлен поиск правил и фильтрация угроз
  - Добавлены toast-уведомления для всех операций
  - Улучшено отображение метрик с дополнительной информацией (block rate, detection rate, throughput)
  - Исправлена структура JSX (удалено дублирование CardContent)

## [0.1.1] - 2024-12-XX

### Добавлено

#### Улучшенное управление группами
- **Поддержка множественных групп**: Компоненты теперь могут принадлежать к нескольким группам одновременно
- **Умное меню "Remove from Group"**:
  - Если компонент в 1 группе: сразу удаляется из группы
  - Если компонент в 2+ группах: открывается диалог выбора группы для удаления
- **Диалог "Remove from Group"**: Новый диалог для выбора группы при удалении из нескольких групп
- **Улучшенное меню "Add to Group"**: Показывает только группы, в которых компонент еще не находится

### Улучшено

#### Компактный дизайн PropertiesPanel
- **Адаптивная ширина**: Автоматически подстраивается под размер экрана (224px → 256px → 288px)
- **Компактные табы**: Уменьшены размеры и отступы (высота 24px, текст 9px)
- **Оптимизированные отступы**: Уменьшены padding и spacing во всех компонентах
- **Компактные элементы**: Все внутренние компоненты стали более компактными

#### Улучшенное контекстное меню
- Добавлена кнопка "Remove from Group" для всех компонентов в группах
- Умная логика обработки (прямое удаление или диалог выбора)
- Закрытие диалогов при клике вне меню или нажатии Escape

### Исправлено
- Исправлена логика показа кнопки "Remove from Group"
- Исправлена фильтрация групп в меню "Add to Group"

### Технические изменения
- Добавлен компонент `RemoveFromGroupDialog`
- Обновлен `.gitignore` (добавлена папка `.cursor/`, паттерны для случайных файлов)
- Удалены случайно созданные файлы из проекта
- Оптимизированы размеры и отступы во всех компонентах PropertiesPanel

## [0.0.2] - 2024-12-XX

### Добавлено

#### Система группировки компонентов
- **Визуальная группировка компонентов** на канвасе с цветными границами
- **Создание групп вручную** из выбранных компонентов (кнопка Layers в Toolbar)
- **Автоматическая группировка** связанных компонентов по соединениям (кнопка Sparkles)
- **Панель свойств группы** в PropertiesPanel с возможностью:
  - Переименования группы
  - Изменения цвета группы
  - Просмотра и удаления компонентов из группы
- **Контекстное меню для групп** (ПКМ) с опциями:
  - Переименовать
  - Копировать ID
  - Удалить группу
- **Список всех групп** во вкладке Properties в PropertiesPanel

#### Улучшенная навигация и поиск
- **Поиск компонентов** в Toolbar с подсветкой найденных элементов
- **Автоматическое центрирование** при выборе компонента из поиска
- **Множественное выделение компонентов** (Ctrl+Click / Cmd+Click)

#### Статистика системы
- **Панель статистики системы** (вкладка Stats в PropertiesPanel) с:
  - Общей производительностью (throughput, latency, error rate, bottlenecks)
  - Здоровьем компонентов (healthy/degraded/critical)
  - Активностью (активные компоненты и соединения)
  - Сводкой алертов

#### Улучшенная визуализация
- **Мини-карта канваса** (bottom-left) с синхронизацией с текущим видом
- **Легенда Heat Map** (bottom-right) для визуализации загрузки компонентов
- **Улучшенная индикация соединений**:
  - Показ метрик только при активной симуляции
  - Скрытие статических метрик когда симуляция не запущена
  - Корректное отображение стрелок на соединениях

### Исправлено
- Убрана фиктивная/статическая индикация для несвязанных компонентов
- Исправлено отображение метрик на соединениях (показываются только при активной симуляции)
- Исправлены размеры стрелок на соединениях
- Улучшена логика отображения метрик для компонентов без активности

### Улучшено
- **UI/UX**: Кастомные диалоги вместо нативных alert/prompt
- **Производительность**: Оптимизирована работа с большим количеством компонентов
- **Сохранение состояния**: Группы сохраняются и загружаются вместе с диаграммой

### Технические изменения
- Добавлен `useUIStore` для управления UI состояниями (minimap, heatmap legend, search)
- Добавлен `ComponentGroup` компонент для визуализации групп
- Добавлен `ComponentSearch` для поиска компонентов
- Добавлен `SystemStatsPanel` для отображения статистики
- Расширен `useCanvasStore` с функциями управления группами
- Добавлены типы `ComponentGroup` в систему типов

## [0.0.1] - Initial Release

### Основной функционал
- Создание и редактирование архитектурных диаграмм
- Библиотека компонентов (messaging, data, API, ML, business, и др.)
- Симуляция и эмуляция систем
- Визуализация метрик и производительности
- Система алертов и диагностики

---

## Планы на будущее (Roadmap)

### Высокий приоритет
1. **Перемещение групп целиком** - возможность перемещать все компоненты группы вместе
2. **Улучшенная визуализация метрик с графиками** - графики производительности в реальном времени, история метрик
3. **Экспорт/импорт сценариев с метриками** - сохранение архитектуры вместе с метриками для сравнения

### Средний приоритет
4. **Улучшенная визуализация соединений** - анимация потока данных, визуализация задержек
5. **Расширенная аналитика** - анализ критических путей, прогнозирование узких мест, рекомендации
6. **Горячие клавиши** - быстрая навигация и управление

### Низкий приоритет
7. **Темы и кастомизация** - темная/светлая тема, настройка цветов
8. **Экспорт в различные форматы** - PNG, SVG, PDF для документации

