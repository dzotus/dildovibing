import{E as M,u as xe,j as e,r as y,A as H,H as ue,J as je,B as A,S as pe,T as ve,a as ge,b as v,K as Ne,a2 as ye,F as fe,d as g,C as h,e as x,f as u,h as j,k as d,L as n,I as o,i as c,P as f,m as b,t as $,n as q,o as B,p as F,q as Q,s as p}from"./index-CLbOuOtM.js";import{T as m}from"./textarea-DrzYBz3Z.js";import{s as T}from"./toast-BveJ0Q8A.js";const be=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Ce=M("cloud-upload",be);const we=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Re=M("hard-drive",we);function Ee({componentId:E}){const{nodes:V,updateNode:K}=xe(),D=V.find(s=>s.id===E);if(!D)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const i=D.data.config||{},J=i.scrapeInterval||"15s",G=i.evaluationInterval||"15s",X=i.retentionTime||"15d",Y=i.storagePath||"/prometheus",O=i.enableRemoteWrite??!1,C=i.remoteWrite||[{url:"https://remote-metrics.example.com/api/v1/write"}],L=i.enableAlertmanager??!0,Z=i.alertmanagerUrl||"http://alertmanager:9093",w=i.targets||[{job:"kubernetes-nodes",endpoint:"https://kube-nodes:9100",interval:"30s",status:"up"},{job:"istio-mesh",endpoint:"http://istio-telemetry:15014",interval:"15s",status:"up"},{job:"custom-app",endpoint:"http://app:8080/metrics",interval:"10s",status:"down"}],R=i.alertingRules||[{name:"HighCPUUsage",expr:"rate(process_cpu_seconds_total[5m]) > 0.8",for:"5m",labels:{severity:"warning"},annotations:{summary:"High CPU usage detected",description:"CPU usage is above 80%"},severity:"warning"},{name:"InstanceDown",expr:"up == 0",for:"1m",labels:{severity:"critical"},annotations:{summary:"Instance is down",description:"Target instance is not responding"},severity:"critical"}],S=i.recordingRules||[{name:"cpu:usage:rate5m",expr:"rate(process_cpu_seconds_total[5m])",labels:{job:"node-exporter"}}],k=i.serviceDiscovery||[{type:"kubernetes",config:{role:"pod",namespaces:{names:["default","production"]}}},{type:"consul",config:{server:"consul:8500",services:["web","api"]}}],[Se,ke]=y.useState(null),[Ae,Te]=y.useState(null),[ee,_]=y.useState(!1),[se,I]=y.useState(!1),[De,ae]=y.useState(!1),t=s=>{K(E,{data:{...D.data,config:{...i,...s}}})},re=()=>{t({targets:[...w,{job:"new-job",endpoint:"http://service:port/metrics",interval:J,status:"up"}]})},le=s=>{t({targets:w.filter((r,a)=>a!==s)})},P=(s,r,a)=>{const l=[...w];l[s]={...l[s],[r]:a},t({targets:l})},ne=()=>{t({remoteWrite:[...C,{url:"https://remote-storage.example.com/write"}]})},te=s=>{t({remoteWrite:C.filter((r,a)=>a!==s)})},W=(s,r)=>{const a=[...C];a[s]=r,t({remoteWrite:a})},ce=()=>{const s={name:"New Alert Rule",expr:"up == 0",for:"5m",labels:{},annotations:{},severity:"warning"};t({alertingRules:[...R,s]}),_(!1)},ie=s=>{t({alertingRules:R.filter((r,a)=>a!==s)})},N=(s,r,a)=>{const l=[...R];l[s]={...l[s],[r]:a},t({alertingRules:l})},oe=()=>{const s={name:"new:metric:name",expr:"rate(metric_name[5m])",labels:{}};t({recordingRules:[...S,s]}),I(!1)},de=s=>{t({recordingRules:S.filter((r,a)=>a!==s)})},U=(s,r,a)=>{const l=[...S];l[s]={...l[s],[r]:a},t({recordingRules:l})},me=()=>{const s={type:"static",config:{}};t({serviceDiscovery:[...k,s]}),ae(!1)},he=s=>{t({serviceDiscovery:k.filter((r,a)=>a!==s)})},z=(s,r,a)=>{const l=[...k];l[s]={...l[s],[r]:a},t({serviceDiscovery:l})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(H,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(ue,{children:"Prometheus"}),e.jsx(je,{children:"Metrics collection & rule evaluation"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"outline",children:"v2.48.0"}),e.jsxs(A,{variant:"secondary",className:"gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),"Healthy"]})]})]}),e.jsx(pe,{}),e.jsxs(ve,{defaultValue:"scraping",className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-6",children:[e.jsxs(v,{value:"scraping",className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Scraping"]}),e.jsxs(v,{value:"service-discovery",className:"gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Service Discovery"]}),e.jsxs(v,{value:"alerting-rules",className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Alerting Rules"]}),e.jsxs(v,{value:"recording-rules",className:"gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Recording Rules"]}),e.jsxs(v,{value:"storage",className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Storage"]}),e.jsxs(v,{value:"remote",className:"gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Remote Write"]})]}),e.jsxs(g,{value:"scraping",className:"mt-4 space-y-4",children:[e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Global Settings"}),e.jsx(j,{children:"Intervals for scraping targets and evaluating rules"})]}),e.jsxs(d,{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Scrape Interval"}),e.jsx(o,{value:J,onChange:s=>t({scrapeInterval:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Evaluation Interval"}),e.jsx(o,{value:G,onChange:s=>t({evaluationInterval:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Retention Time"}),e.jsx(o,{value:X,onChange:s=>t({retentionTime:s.target.value})})]})]})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Scrape Targets"}),e.jsx(j,{children:"Endpoints Prometheus scrapes for metrics"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:re,children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Add Target"]})]}),e.jsx(d,{className:"space-y-3",children:w.map((s,r)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{value:s.job,className:"font-semibold",onChange:a=>P(r,"job",a.target.value)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Job Name"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:s.status==="up"?"secondary":"destructive",children:s.status==="up"?"UP":"DOWN"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>le(r),children:e.jsx(b,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Endpoint"}),e.jsx(o,{value:s.endpoint,onChange:a=>P(r,"endpoint",a.target.value),placeholder:"http://service:port/metrics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Scrape Interval"}),e.jsx(o,{value:s.interval,onChange:a=>P(r,"interval",a.target.value),placeholder:"15s"})]})]},`${s.job}-${r}`))})]})]}),e.jsx(g,{value:"storage",className:"mt-4 space-y-4",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Local Storage"}),e.jsx(j,{children:"TSDB configuration"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Storage Path"}),e.jsx(o,{value:Y,onChange:s=>t({storagePath:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Compaction Log"}),e.jsx(m,{className:"font-mono text-xs",rows:4,value:`level=info ts=${Date.now()} caller=compact.go:516 msg="compact blocks" count=3 mint=0 maxt=3600000`,readOnly:!0})]})]})]})}),e.jsx(g,{value:"remote",className:"mt-4 space-y-4",children:e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Remote Write"}),e.jsx(j,{children:"Ship metrics to long-term storage"})]}),e.jsx($,{checked:O,onCheckedChange:s=>t({enableRemoteWrite:s})})]}),O&&e.jsxs(d,{className:"space-y-4",children:[C.map((s,r)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg space-y-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Endpoint #",r+1]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>te(r),children:e.jsx(b,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Remote URL"}),e.jsx(o,{value:s.url,onChange:a=>W(r,{...s,url:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Authorization Header"}),e.jsx(o,{placeholder:"Bearer ...",value:s.auth||"",onChange:a=>W(r,{...s,auth:a.target.value})})]})]},r)),e.jsxs(c,{variant:"outline",size:"sm",onClick:ne,className:"gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Add Endpoint"]})]})]})}),e.jsx(g,{value:"service-discovery",className:"mt-4 space-y-4",children:e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Service Discovery"}),e.jsx(j,{children:"Configure automatic target discovery"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:me,children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Add Service Discovery"]})]}),e.jsx(d,{className:"space-y-3",children:k.map((s,r)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(q,{value:s.type,onValueChange:a=>z(r,"type",a),children:[e.jsx(B,{className:"w-48",children:e.jsx(F,{})}),e.jsxs(Q,{children:[e.jsx(p,{value:"kubernetes",children:"Kubernetes"}),e.jsx(p,{value:"consul",children:"Consul"}),e.jsx(p,{value:"static",children:"Static"}),e.jsx(p,{value:"file",children:"File"}),e.jsx(p,{value:"dns",children:"DNS"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Discovery Type"})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>he(r),children:e.jsx(b,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Configuration (JSON)"}),e.jsx(m,{className:"font-mono text-xs",rows:4,value:JSON.stringify(s.config,null,2),onChange:a=>{try{const l=JSON.parse(a.target.value);z(r,"config",l)}catch(l){T(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"role": "pod", "namespaces": {"names": ["default"]}}'})]})]},r))})]})}),e.jsxs(g,{value:"alerting-rules",className:"mt-4 space-y-4",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Alerting Rules"}),e.jsx(j,{children:"Define PromQL expressions that trigger alerts"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>_(!0),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Create Alert Rule"]})]}),ee&&e.jsx(d,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Rule Name"}),e.jsx(o,{placeholder:"HighCPUUsage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"PromQL Expression"}),e.jsx(m,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m]) > 0.8"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:ce,children:"Create Rule"}),e.jsx(c,{variant:"outline",onClick:()=>_(!1),children:"Cancel"})]})]})}),e.jsx(d,{className:"space-y-3",children:R.map((s,r)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx(A,{variant:s.severity==="critical"?"destructive":s.severity==="warning"?"default":"secondary",children:s.severity||"info"})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>ie(r),children:e.jsx(b,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"PromQL Expression"}),e.jsx(m,{className:"font-mono text-xs",rows:2,value:s.expr,onChange:a=>N(r,"expr",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"For Duration"}),e.jsx(o,{value:s.for||"",onChange:a=>N(r,"for",a.target.value),placeholder:"5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Severity"}),e.jsxs(q,{value:s.severity||"warning",onValueChange:a=>N(r,"severity",a),children:[e.jsx(B,{children:e.jsx(F,{})}),e.jsxs(Q,{children:[e.jsx(p,{value:"critical",children:"Critical"}),e.jsx(p,{value:"warning",children:"Warning"}),e.jsx(p,{value:"info",children:"Info"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Labels (JSON)"}),e.jsx(m,{className:"font-mono text-xs",rows:2,value:JSON.stringify(s.labels||{},null,2),onChange:a=>{try{const l=JSON.parse(a.target.value);N(r,"labels",l)}catch(l){T(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"severity": "warning"}'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Annotations (JSON)"}),e.jsx(m,{className:"font-mono text-xs",rows:2,value:JSON.stringify(s.annotations||{},null,2),onChange:a=>{try{const l=JSON.parse(a.target.value);N(r,"annotations",l)}catch(l){T(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"summary": "Alert summary", "description": "Alert description"}'})]})]},r))})]}),e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Alertmanager Integration"}),e.jsx(j,{children:"Configure alert notifications pipeline"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Enable Alertmanager"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Forward firing alerts to Alertmanager"})]}),e.jsx($,{checked:L,onCheckedChange:s=>t({enableAlertmanager:s})})]}),L&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Alertmanager URL"}),e.jsx(o,{value:Z,onChange:s=>t({alertmanagerUrl:s.target.value})})]})]})]})]}),e.jsx(g,{value:"recording-rules",className:"mt-4 space-y-4",children:e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Recording Rules"}),e.jsx(j,{children:"Pre-compute frequently used or expensive queries"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>I(!0),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Create Recording Rule"]})]}),se&&e.jsx(d,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Rule Name"}),e.jsx(o,{placeholder:"cpu:usage:rate5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"PromQL Expression"}),e.jsx(m,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m])"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:oe,children:"Create Rule"}),e.jsx(c,{variant:"outline",onClick:()=>I(!1),children:"Cancel"})]})]})}),e.jsx(d,{className:"space-y-3",children:S.map((s,r)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold font-mono",children:s.name}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>de(r),children:e.jsx(b,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"PromQL Expression"}),e.jsx(m,{className:"font-mono text-xs",rows:2,value:s.expr,onChange:a=>U(r,"expr",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Labels (JSON)"}),e.jsx(m,{className:"font-mono text-xs",rows:2,value:JSON.stringify(s.labels||{},null,2),onChange:a=>{try{const l=JSON.parse(a.target.value);U(r,"labels",l)}catch(l){T(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"job": "node-exporter"}'})]})]},r))})]})})]})]})})}export{Ee as PrometheusConfigAdvanced};
