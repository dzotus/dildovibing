const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KafkaConfigAdvanced-BvaNq7aB.js","assets/progress-BDryJQiy.js","assets/textarea-BP9ERDTp.js","assets/database-mnvKqujo.js","assets/users-BcBED_Fh.js","assets/shield-CJoMZweg.js","assets/RabbitMQConfigAdvanced-3sShrFCN.js","assets/usePortValidation-C4_cZT_I.js","assets/requiredFields-BLgUUVkB.js","assets/toast-CPabE91d.js","assets/message-square-1dqkcHbE.js","assets/arrow-right-left-CtRLZfEj.js","assets/key-DamQBX2o.js","assets/PostgreSQLConfigAdvanced-BDM62wii.js","assets/table-EVy803_b.js","assets/MongoDBConfigAdvanced-Cb2d_tzz.js","assets/RedisConfigAdvanced-CCERgMi5.js","assets/ElasticsearchConfigAdvanced-CunCpHWf.js","assets/refresh-ccw-DXr8PW7J.js","assets/code-CjyyMuGv.js","assets/CassandraConfigAdvanced-DaIbDvtM.js","assets/ClickHouseConfigAdvanced-CBMRn2Io.js","assets/chart-column-DKPOz5mt.js","assets/SnowflakeConfigAdvanced-CBljDbVL.js","assets/S3DataLakeConfigAdvanced-BtRjVX6m.js","assets/folder-DO-DcsmX.js","assets/NginxConfigAdvanced-CMfOPPPN.js","assets/use-toast-BKQD3ulU.js","assets/globe-yQIPkChn.js","assets/server-BPPjH2Py.js","assets/RestApiConfigAdvanced-z-YiBW2W.js","assets/GRPCConfigAdvanced-15R5YqI9.js","assets/circle-check-big-BfUBLtt7.js","assets/WebSocketConfigAdvanced-BScKJxFv.js","assets/send-D_nrnLrG.js","assets/GraphQLConfigAdvanced-By52hJQM.js","assets/SOAPConfigAdvanced-CZkWjRER.js","assets/WebhookConfigAdvanced-CtOzXmJI.js","assets/webhook-ni9a53Kj.js","assets/clock-DmijjKjH.js","assets/DockerK8sConfigAdvanced-BtwLm_D2.js","assets/alert-CvOl259B.js","assets/loader-circle-BYj5vu5Y.js","assets/hard-drive-Cv1BqDR1.js","assets/KubernetesConfigAdvanced-SMHhCX_Z.js","assets/HAProxyConfigAdvanced-C28vLKEd.js","assets/trending-up-PXwzmGHq.js","assets/TraefikConfigAdvanced-CySWtVHv.js","assets/route-DREi_lbe.js","assets/EnvoyConfigAdvanced-BiQZ_44n.js","assets/ActiveMQConfigAdvanced-ChXTW-Jl.js","assets/pen-CcEmHE3H.js","assets/AWSSQSConfigAdvanced-DIVVrhui.js","assets/cloud-BrQxu2ZZ.js","assets/AzureServiceBusConfigAdvanced-BKwC0Ook.js","assets/GCPPubSubConfigAdvanced-Cfqk90Xt.js","assets/KongConfigAdvanced-CLoh3jT2.js","assets/ApigeeConfigAdvanced-COKA6x6Q.js","assets/MuleSoftConfigAdvanced-Dt7tq7Y7.js","assets/GraphQLGatewayConfigAdvanced-CW9Y8v8E.js","assets/BFFServiceConfigAdvanced-DgknMRbw.js","assets/WebhookRelayConfigAdvanced-C32z_umw.js","assets/PrometheusConfigAdvanced-BStD_hYg.js","assets/GrafanaConfigAdvanced-DMr0HHkA.js","assets/BarChart-aeAOlIr6.js","assets/LokiConfigAdvanced-C1TnZ3wV.js","assets/JaegerConfigAdvanced-BjgG_s7r.js","assets/git-branch-Ct1FszuW.js","assets/OpenTelemetryCollectorConfigAdvanced-Br1rb2RN.js","assets/PagerDutyConfigAdvanced-Lv94dbYd.js","assets/bell-BcF9rNmk.js","assets/KeycloakConfigAdvanced-bjwwgcip.js","assets/lock-BXOL23qp.js","assets/mail-CIJOoErI.js","assets/eye-off-D3BNWqWG.js","assets/WAFConfigAdvanced-Cx1ooaP2.js","assets/SecretsVaultConfigAdvanced-CBxQksMW.js","assets/IDSIPSConfigAdvanced-CXefv-Mj.js","assets/FirewallConfigAdvanced-SaWbN52a.js","assets/JenkinsConfigAdvanced-DyWy_o9H.js","assets/package-kBp5cHh_.js","assets/GitLabCIConfigAdvanced-DXP6D2PV.js","assets/calendar-CD4o7ri4.js","assets/ArgoCDConfigAdvanced-DW6NfeXZ.js","assets/folder-git-2-Bsn1iQcQ.js","assets/HarborConfigAdvanced-ySR7dBKk.js","assets/TerraformConfigAdvanced-Cpv_e8_Z.js","assets/AnsibleConfigAdvanced-B0EC-w5B.js","assets/IstioConfigAdvanced-DA6-2UDW.js","assets/ServiceMeshConfigAdvanced--tFdzQ0J.js","assets/APIGatewayConfigAdvanced-q4q8lm0f.js","assets/VPNConfigAdvanced-wcsP9aWL.js","assets/CDNConfigAdvanced-BnPAi64B.js","assets/SparkConfigAdvanced-CNmBRk3S.js","assets/TensorFlowServingConfigAdvanced-BNMHBsOI.js","assets/PyTorchServeConfigAdvanced-BJSvV3Oq.js","assets/FeatureStoreConfigAdvanced-YrrbrnTQ.js","assets/MLflowConfigAdvanced-oKp25OvW.js","assets/CRMConfigAdvanced-zdtoquKO.js","assets/dollar-sign-Cdb8rbbo.js","assets/building-1eETco7Z.js","assets/ERPConfigAdvanced-BoGVZWqS.js","assets/RPABotConfigAdvanced-C_MSXaKQ.js","assets/BPMNEngineConfigAdvanced-Cn2OEmzI.js","assets/PaymentGatewayConfigAdvanced-D3H_vKaX.js"])))=>i.map(i=>d[i]);
function mE(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const a=Object.getOwnPropertyDescriptor(n,s);a&&Object.defineProperty(r,s,a.get?a:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var BO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hh(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Qf={exports:{}},wr={};var j0;function yE(){if(j0)return wr;j0=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,s,a){var c=null;if(a!==void 0&&(c=""+a),s.key!==void 0&&(c=""+s.key),"key"in s){a={};for(var l in s)l!=="key"&&(a[l]=s[l])}else a=s;return s=a.ref,{$$typeof:r,type:n,key:c,ref:s!==void 0?s:null,props:a}}return wr.Fragment=e,wr.jsx=t,wr.jsxs=t,wr}var P0;function vE(){return P0||(P0=1,Qf.exports=yE()),Qf.exports}var g=vE(),Vf={exports:{}},Le={};var z0;function bE(){if(z0)return Le;z0=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function b(P){return P===null||typeof P!="object"?null:(P=y&&P[y]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,E={};function C(P,F,Y){this.props=P,this.context=F,this.refs=E,this.updater=Y||S}C.prototype.isReactComponent={},C.prototype.setState=function(P,F){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,F,"setState")},C.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function T(){}T.prototype=C.prototype;function k(P,F,Y){this.props=P,this.context=F,this.refs=E,this.updater=Y||S}var A=k.prototype=new T;A.constructor=k,M(A,C.prototype),A.isPureReactComponent=!0;var _=Array.isArray;function N(){}var L={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function Z(P,F,Y){var ie=Y.ref;return{$$typeof:r,type:P,key:F,ref:ie!==void 0?ie:null,props:Y}}function se(P,F){return Z(P.type,F,P.props)}function ce(P){return typeof P=="object"&&P!==null&&P.$$typeof===r}function J(P){var F={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(Y){return F[Y]})}var te=/\/+/g;function le(P,F){return typeof P=="object"&&P!==null&&P.key!=null?J(""+P.key):F.toString(36)}function ue(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(N,N):(P.status="pending",P.then(function(F){P.status==="pending"&&(P.status="fulfilled",P.value=F)},function(F){P.status==="pending"&&(P.status="rejected",P.reason=F)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function z(P,F,Y,ie,B){var ae=typeof P;(ae==="undefined"||ae==="boolean")&&(P=null);var $=!1;if(P===null)$=!0;else switch(ae){case"bigint":case"string":case"number":$=!0;break;case"object":switch(P.$$typeof){case r:case e:$=!0;break;case p:return $=P._init,z($(P._payload),F,Y,ie,B)}}if($)return B=B(P),$=ie===""?"."+le(P,0):ie,_(B)?(Y="",$!=null&&(Y=$.replace(te,"$&/")+"/"),z(B,F,Y,"",function(me){return me})):B!=null&&(ce(B)&&(B=se(B,Y+(B.key==null||P&&P.key===B.key?"":(""+B.key).replace(te,"$&/")+"/")+$)),F.push(B)),1;$=0;var G=ie===""?".":ie+":";if(_(P))for(var pe=0;pe<P.length;pe++)ie=P[pe],ae=G+le(ie,pe),$+=z(ie,F,Y,ae,B);else if(pe=b(P),typeof pe=="function")for(P=pe.call(P),pe=0;!(ie=P.next()).done;)ie=ie.value,ae=G+le(ie,pe++),$+=z(ie,F,Y,ae,B);else if(ae==="object"){if(typeof P.then=="function")return z(ue(P),F,Y,ie,B);throw F=String(P),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return $}function j(P,F,Y){if(P==null)return P;var ie=[],B=0;return z(P,ie,"","",function(ae){return F.call(Y,ae,B++)}),ie}function O(P){if(P._status===-1){var F=P._result;F=F(),F.then(function(Y){(P._status===0||P._status===-1)&&(P._status=1,P._result=Y)},function(Y){(P._status===0||P._status===-1)&&(P._status=2,P._result=Y)}),P._status===-1&&(P._status=0,P._result=F)}if(P._status===1)return P._result.default;throw P._result}var W=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},he={map:j,forEach:function(P,F,Y){j(P,function(){F.apply(this,arguments)},Y)},count:function(P){var F=0;return j(P,function(){F++}),F},toArray:function(P){return j(P,function(F){return F})||[]},only:function(P){if(!ce(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return Le.Activity=m,Le.Children=he,Le.Component=C,Le.Fragment=t,Le.Profiler=s,Le.PureComponent=k,Le.StrictMode=n,Le.Suspense=d,Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,Le.__COMPILER_RUNTIME={__proto__:null,c:function(P){return L.H.useMemoCache(P)}},Le.cache=function(P){return function(){return P.apply(null,arguments)}},Le.cacheSignal=function(){return null},Le.cloneElement=function(P,F,Y){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var ie=M({},P.props),B=P.key;if(F!=null)for(ae in F.key!==void 0&&(B=""+F.key),F)!q.call(F,ae)||ae==="key"||ae==="__self"||ae==="__source"||ae==="ref"&&F.ref===void 0||(ie[ae]=F[ae]);var ae=arguments.length-2;if(ae===1)ie.children=Y;else if(1<ae){for(var $=Array(ae),G=0;G<ae;G++)$[G]=arguments[G+2];ie.children=$}return Z(P.type,B,ie)},Le.createContext=function(P){return P={$$typeof:c,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:a,_context:P},P},Le.createElement=function(P,F,Y){var ie,B={},ae=null;if(F!=null)for(ie in F.key!==void 0&&(ae=""+F.key),F)q.call(F,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(B[ie]=F[ie]);var $=arguments.length-2;if($===1)B.children=Y;else if(1<$){for(var G=Array($),pe=0;pe<$;pe++)G[pe]=arguments[pe+2];B.children=G}if(P&&P.defaultProps)for(ie in $=P.defaultProps,$)B[ie]===void 0&&(B[ie]=$[ie]);return Z(P,ae,B)},Le.createRef=function(){return{current:null}},Le.forwardRef=function(P){return{$$typeof:l,render:P}},Le.isValidElement=ce,Le.lazy=function(P){return{$$typeof:p,_payload:{_status:-1,_result:P},_init:O}},Le.memo=function(P,F){return{$$typeof:f,type:P,compare:F===void 0?null:F}},Le.startTransition=function(P){var F=L.T,Y={};L.T=Y;try{var ie=P(),B=L.S;B!==null&&B(Y,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(N,W)}catch(ae){W(ae)}finally{F!==null&&Y.types!==null&&(F.types=Y.types),L.T=F}},Le.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},Le.use=function(P){return L.H.use(P)},Le.useActionState=function(P,F,Y){return L.H.useActionState(P,F,Y)},Le.useCallback=function(P,F){return L.H.useCallback(P,F)},Le.useContext=function(P){return L.H.useContext(P)},Le.useDebugValue=function(){},Le.useDeferredValue=function(P,F){return L.H.useDeferredValue(P,F)},Le.useEffect=function(P,F){return L.H.useEffect(P,F)},Le.useEffectEvent=function(P){return L.H.useEffectEvent(P)},Le.useId=function(){return L.H.useId()},Le.useImperativeHandle=function(P,F,Y){return L.H.useImperativeHandle(P,F,Y)},Le.useInsertionEffect=function(P,F){return L.H.useInsertionEffect(P,F)},Le.useLayoutEffect=function(P,F){return L.H.useLayoutEffect(P,F)},Le.useMemo=function(P,F){return L.H.useMemo(P,F)},Le.useOptimistic=function(P,F){return L.H.useOptimistic(P,F)},Le.useReducer=function(P,F,Y){return L.H.useReducer(P,F,Y)},Le.useRef=function(P){return L.H.useRef(P)},Le.useState=function(P){return L.H.useState(P)},Le.useSyncExternalStore=function(P,F,Y){return L.H.useSyncExternalStore(P,F,Y)},Le.useTransition=function(){return L.H.useTransition()},Le.version="19.2.0",Le}var L0;function qh(){return L0||(L0=1,Vf.exports=bE()),Vf.exports}var w=qh();const kt=Hh(w),Uh=mE({__proto__:null,default:kt},[w]);var Gf={exports:{}},Sr={},Kf={exports:{}},Yf={};var I0;function xE(){return I0||(I0=1,(function(r){function e(z,j){var O=z.length;z.push(j);e:for(;0<O;){var W=O-1>>>1,he=z[W];if(0<s(he,j))z[W]=j,z[O]=he,O=W;else break e}}function t(z){return z.length===0?null:z[0]}function n(z){if(z.length===0)return null;var j=z[0],O=z.pop();if(O!==j){z[0]=O;e:for(var W=0,he=z.length,P=he>>>1;W<P;){var F=2*(W+1)-1,Y=z[F],ie=F+1,B=z[ie];if(0>s(Y,O))ie<he&&0>s(B,Y)?(z[W]=B,z[ie]=O,W=ie):(z[W]=Y,z[F]=O,W=F);else if(ie<he&&0>s(B,O))z[W]=B,z[ie]=O,W=ie;else break e}}return j}function s(z,j){var O=z.sortIndex-j.sortIndex;return O!==0?O:z.id-j.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;r.unstable_now=function(){return a.now()}}else{var c=Date,l=c.now();r.unstable_now=function(){return c.now()-l}}var d=[],f=[],p=1,m=null,y=3,b=!1,S=!1,M=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function A(z){for(var j=t(f);j!==null;){if(j.callback===null)n(f);else if(j.startTime<=z)n(f),j.sortIndex=j.expirationTime,e(d,j);else break;j=t(f)}}function _(z){if(M=!1,A(z),!S)if(t(d)!==null)S=!0,N||(N=!0,J());else{var j=t(f);j!==null&&ue(_,j.startTime-z)}}var N=!1,L=-1,q=5,Z=-1;function se(){return E?!0:!(r.unstable_now()-Z<q)}function ce(){if(E=!1,N){var z=r.unstable_now();Z=z;var j=!0;try{e:{S=!1,M&&(M=!1,T(L),L=-1),b=!0;var O=y;try{t:{for(A(z),m=t(d);m!==null&&!(m.expirationTime>z&&se());){var W=m.callback;if(typeof W=="function"){m.callback=null,y=m.priorityLevel;var he=W(m.expirationTime<=z);if(z=r.unstable_now(),typeof he=="function"){m.callback=he,A(z),j=!0;break t}m===t(d)&&n(d),A(z)}else n(d);m=t(d)}if(m!==null)j=!0;else{var P=t(f);P!==null&&ue(_,P.startTime-z),j=!1}}break e}finally{m=null,y=O,b=!1}j=void 0}}finally{j?J():N=!1}}}var J;if(typeof k=="function")J=function(){k(ce)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,le=te.port2;te.port1.onmessage=ce,J=function(){le.postMessage(null)}}else J=function(){C(ce,0)};function ue(z,j){L=C(function(){z(r.unstable_now())},j)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(z){z.callback=null},r.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<z?Math.floor(1e3/z):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(z){switch(y){case 1:case 2:case 3:var j=3;break;default:j=y}var O=y;y=j;try{return z()}finally{y=O}},r.unstable_requestPaint=function(){E=!0},r.unstable_runWithPriority=function(z,j){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var O=y;y=z;try{return j()}finally{y=O}},r.unstable_scheduleCallback=function(z,j,O){var W=r.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?W+O:W):O=W,z){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=O+he,z={id:p++,callback:j,priorityLevel:z,startTime:O,expirationTime:he,sortIndex:-1},O>W?(z.sortIndex=O,e(f,z),t(d)===null&&z===t(f)&&(M?(T(L),L=-1):M=!0,ue(_,O-W))):(z.sortIndex=he,e(d,z),S||b||(S=!0,N||(N=!0,J()))),z},r.unstable_shouldYield=se,r.unstable_wrapCallback=function(z){var j=y;return function(){var O=y;y=j;try{return z.apply(this,arguments)}finally{y=O}}}})(Yf)),Yf}var O0;function wE(){return O0||(O0=1,Kf.exports=xE()),Kf.exports}var Wf={exports:{}},cn={};var H0;function SE(){if(H0)return cn;H0=1;var r=qh();function e(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(d,f,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:d,containerInfo:f,implementation:p}}var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return cn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,cn.createPortal=function(d,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return a(d,f,null,p)},cn.flushSync=function(d){var f=c.T,p=n.p;try{if(c.T=null,n.p=2,d)return d()}finally{c.T=f,n.p=p,n.d.f()}},cn.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(d,f))},cn.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},cn.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var p=f.as,m=l(p,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,b=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?n.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:b}):p==="script"&&n.d.X(d,{crossOrigin:m,integrity:y,fetchPriority:b,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},cn.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=l(f.as,f.crossOrigin);n.d.M(d,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(d)},cn.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,m=l(p,f.crossOrigin);n.d.L(d,p,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},cn.preloadModule=function(d,f){if(typeof d=="string")if(f){var p=l(f.as,f.crossOrigin);n.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(d)},cn.requestFormReset=function(d){n.d.r(d)},cn.unstable_batchedUpdates=function(d,f){return d(f)},cn.useFormState=function(d,f,p){return c.H.useFormState(d,f,p)},cn.useFormStatus=function(){return c.H.useHostTransitionStatus()},cn.version="19.2.0",cn}var q0;function Gv(){if(q0)return Wf.exports;q0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Wf.exports=SE(),Wf.exports}var U0;function ME(){if(U0)return Sr;U0=1;var r=wE(),e=qh(),t=Gv();function n(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function a(i){var o=i,u=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(u=o.return),i=o.return;while(i)}return o.tag===3?u:null}function c(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function l(i){if(i.tag===31){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function d(i){if(a(i)!==i)throw Error(n(188))}function f(i){var o=i.alternate;if(!o){if(o=a(i),o===null)throw Error(n(188));return o!==i?null:i}for(var u=i,h=o;;){var v=u.return;if(v===null)break;var x=v.alternate;if(x===null){if(h=v.return,h!==null){u=h;continue}break}if(v.child===x.child){for(x=v.child;x;){if(x===u)return d(v),i;if(x===h)return d(v),o;x=x.sibling}throw Error(n(188))}if(u.return!==h.return)u=v,h=x;else{for(var R=!1,D=v.child;D;){if(D===u){R=!0,u=v,h=x;break}if(D===h){R=!0,h=v,u=x;break}D=D.sibling}if(!R){for(D=x.child;D;){if(D===u){R=!0,u=x,h=v;break}if(D===h){R=!0,h=x,u=v;break}D=D.sibling}if(!R)throw Error(n(189))}}if(u.alternate!==h)throw Error(n(190))}if(u.tag!==3)throw Error(n(188));return u.stateNode.current===u?i:o}function p(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=p(i),o!==null)return o;i=i.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),k=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),se=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function J(i){return i===null||typeof i!="object"?null:(i=ce&&i[ce]||i["@@iterator"],typeof i=="function"?i:null)}var te=Symbol.for("react.client.reference");function le(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===te?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case M:return"Fragment";case C:return"Profiler";case E:return"StrictMode";case _:return"Suspense";case N:return"SuspenseList";case Z:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case S:return"Portal";case k:return i.displayName||"Context";case T:return(i._context.displayName||"Context")+".Consumer";case A:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case L:return o=i.displayName||null,o!==null?o:le(i.type)||"Memo";case q:o=i._payload,i=i._init;try{return le(i(o))}catch{}}return null}var ue=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},W=[],he=-1;function P(i){return{current:i}}function F(i){0>he||(i.current=W[he],W[he]=null,he--)}function Y(i,o){he++,W[he]=i.current,i.current=o}var ie=P(null),B=P(null),ae=P(null),$=P(null);function G(i,o){switch(Y(ae,o),Y(B,i),Y(ie,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?n0(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=n0(o),i=s0(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}F(ie),Y(ie,i)}function pe(){F(ie),F(B),F(ae)}function me(i){i.memoizedState!==null&&Y($,i);var o=ie.current,u=s0(o,i.type);o!==u&&(Y(B,i),Y(ie,u))}function ye(i){B.current===i&&(F(ie),F(B)),$.current===i&&(F($),yr._currentValue=O)}var ve,Pe;function $e(i){if(ve===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);ve=o&&o[1]||"",Pe=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ve+i+Pe}var it=!1;function Je(i,o){if(!i||it)return"";it=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(o){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(X){var K=X}Reflect.construct(i,[],re)}else{try{re.call()}catch(X){K=X}i.call(re.prototype)}}else{try{throw Error()}catch(X){K=X}(re=i())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(X){if(X&&K&&typeof X.stack=="string")return[X.stack,K.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=h.DetermineComponentFrameRoot(),R=x[0],D=x[1];if(R&&D){var I=R.split(`
`),V=D.split(`
`);for(v=h=0;h<I.length&&!I[h].includes("DetermineComponentFrameRoot");)h++;for(;v<V.length&&!V[v].includes("DetermineComponentFrameRoot");)v++;if(h===I.length||v===V.length)for(h=I.length-1,v=V.length-1;1<=h&&0<=v&&I[h]!==V[v];)v--;for(;1<=h&&0<=v;h--,v--)if(I[h]!==V[v]){if(h!==1||v!==1)do if(h--,v--,0>v||I[h]!==V[v]){var ne=`
`+I[h].replace(" at new "," at ");return i.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",i.displayName)),ne}while(1<=h&&0<=v);break}}}finally{it=!1,Error.prepareStackTrace=u}return(u=i?i.displayName||i.name:"")?$e(u):""}function jt(i,o){switch(i.tag){case 26:case 27:case 5:return $e(i.type);case 16:return $e("Lazy");case 13:return i.child!==o&&o!==null?$e("Suspense Fallback"):$e("Suspense");case 19:return $e("SuspenseList");case 0:case 15:return Je(i.type,!1);case 11:return Je(i.type.render,!1);case 1:return Je(i.type,!0);case 31:return $e("Activity");default:return""}}function de(i){try{var o="",u=null;do o+=jt(i,u),u=i,i=i.return;while(i);return o}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var Ue=Object.prototype.hasOwnProperty,Be=r.unstable_scheduleCallback,bt=r.unstable_cancelCallback,mt=r.unstable_shouldYield,Ut=r.unstable_requestPaint,Ze=r.unstable_now,Pt=r.unstable_getCurrentPriorityLevel,xt=r.unstable_ImmediatePriority,yt=r.unstable_UserBlockingPriority,Xt=r.unstable_NormalPriority,Gt=r.unstable_LowPriority,_s=r.unstable_IdlePriority,Xn=r.log,Nn=r.unstable_setDisableYieldValue,fs=null,Jt=null;function Kt(i){if(typeof Xn=="function"&&Nn(i),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(fs,i)}catch{}}var zt=Math.clz32?Math.clz32:Jr,Fi=Math.log,jn=Math.LN2;function Jr(i){return i>>>=0,i===0?32:31-(Fi(i)/jn|0)|0}var Ns=256,Qi=262144,ci=4194304;function Jn(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function js(i,o,u){var h=i.pendingLanes;if(h===0)return 0;var v=0,x=i.suspendedLanes,R=i.pingedLanes;i=i.warmLanes;var D=h&134217727;return D!==0?(h=D&~x,h!==0?v=Jn(h):(R&=D,R!==0?v=Jn(R):u||(u=D&~i,u!==0&&(v=Jn(u))))):(D=h&~x,D!==0?v=Jn(D):R!==0?v=Jn(R):u||(u=h&~i,u!==0&&(v=Jn(u)))),v===0?0:o!==0&&o!==v&&(o&x)===0&&(x=v&-v,u=o&-o,x>=u||x===32&&(u&4194048)!==0)?o:v}function Ps(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function zu(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ee(){var i=ci;return ci<<=1,(ci&62914560)===0&&(ci=4194304),i}function fe(i){for(var o=[],u=0;31>u;u++)o.push(i);return o}function be(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function ze(i,o,u,h,v,x){var R=i.pendingLanes;i.pendingLanes=u,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=u,i.entangledLanes&=u,i.errorRecoveryDisabledLanes&=u,i.shellSuspendCounter=0;var D=i.entanglements,I=i.expirationTimes,V=i.hiddenUpdates;for(u=R&~u;0<u;){var ne=31-zt(u),re=1<<ne;D[ne]=0,I[ne]=-1;var K=V[ne];if(K!==null)for(V[ne]=null,ne=0;ne<K.length;ne++){var X=K[ne];X!==null&&(X.lane&=-536870913)}u&=~re}h!==0&&Ie(i,h,0),x!==0&&v===0&&i.tag!==0&&(i.suspendedLanes|=x&~(R&~o))}function Ie(i,o,u){i.pendingLanes|=o,i.suspendedLanes&=~o;var h=31-zt(o);i.entangledLanes|=o,i.entanglements[h]=i.entanglements[h]|1073741824|u&261930}function lt(i,o){var u=i.entangledLanes|=o;for(i=i.entanglements;u;){var h=31-zt(u),v=1<<h;v&o|i[h]&o&&(i[h]|=o),u&=~v}}function Lt(i,o){var u=o&-o;return u=(u&42)!==0?1:Zt(u),(u&(i.suspendedLanes|o))!==0?0:u}function Zt(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function At(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function un(){var i=j.p;return i!==0?i:(i=window.event,i===void 0?32:R0(i.type))}function Mt(i,o){var u=j.p;try{return j.p=i,o()}finally{j.p=u}}var at=Math.random().toString(36).slice(2),vt="__reactFiber$"+at,$t="__reactProps$"+at,hs="__reactContainer$"+at,Fe="__reactEvents$"+at,Pn="__reactListeners$"+at,Vi="__reactHandles$"+at,Ea="__reactResources$"+at,No="__reactMarker$"+at;function Lu(i){delete i[vt],delete i[$t],delete i[Fe],delete i[Pn],delete i[Vi]}function Ra(i){var o=i[vt];if(o)return o;for(var u=i.parentNode;u;){if(o=u[hs]||u[vt]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(i=u0(i);i!==null;){if(u=i[vt])return u;i=u0(i)}return o}i=u,u=i.parentNode}return null}function ka(i){if(i=i[vt]||i[hs]){var o=i.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return i}return null}function jo(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(n(33))}function Ta(i){var o=i[Ea];return o||(o=i[Ea]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Yt(i){i[No]=!0}var Fp=new Set,Qp={};function Gi(i,o){Aa(i,o),Aa(i+"Capture",o)}function Aa(i,o){for(Qp[i]=o,i=0;i<o.length;i++)Fp.add(o[i])}var rC=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vp={},Gp={};function cC(i){return Ue.call(Gp,i)?!0:Ue.call(Vp,i)?!1:rC.test(i)?Gp[i]=!0:(Vp[i]=!0,!1)}function Zr(i,o,u){if(cC(o))if(u===null)i.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var h=o.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+u)}}function ec(i,o,u){if(u===null)i.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+u)}}function zs(i,o,u,h){if(h===null)i.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttributeNS(o,u,""+h)}}function zn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Kp(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function lC(i,o,u){var h=Object.getOwnPropertyDescriptor(i.constructor.prototype,o);if(!i.hasOwnProperty(o)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var v=h.get,x=h.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return v.call(this)},set:function(R){u=""+R,x.call(this,R)}}),Object.defineProperty(i,o,{enumerable:h.enumerable}),{getValue:function(){return u},setValue:function(R){u=""+R},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function Iu(i){if(!i._valueTracker){var o=Kp(i)?"checked":"value";i._valueTracker=lC(i,o,""+i[o])}}function Yp(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var u=o.getValue(),h="";return i&&(h=Kp(i)?i.checked?"true":"false":i.value),i=h,i!==u?(o.setValue(i),!0):!1}function tc(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var uC=/[\n"\\]/g;function Ln(i){return i.replace(uC,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Ou(i,o,u,h,v,x,R,D){i.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?i.type=R:i.removeAttribute("type"),o!=null?R==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+zn(o)):i.value!==""+zn(o)&&(i.value=""+zn(o)):R!=="submit"&&R!=="reset"||i.removeAttribute("value"),o!=null?Hu(i,R,zn(o)):u!=null?Hu(i,R,zn(u)):h!=null&&i.removeAttribute("value"),v==null&&x!=null&&(i.defaultChecked=!!x),v!=null&&(i.checked=v&&typeof v!="function"&&typeof v!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.name=""+zn(D):i.removeAttribute("name")}function Wp(i,o,u,h,v,x,R,D){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(i.type=x),o!=null||u!=null){if(!(x!=="submit"&&x!=="reset"||o!=null)){Iu(i);return}u=u!=null?""+zn(u):"",o=o!=null?""+zn(o):u,D||o===i.value||(i.value=o),i.defaultValue=o}h=h??v,h=typeof h!="function"&&typeof h!="symbol"&&!!h,i.checked=D?i.checked:!!h,i.defaultChecked=!!h,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(i.name=R),Iu(i)}function Hu(i,o,u){o==="number"&&tc(i.ownerDocument)===i||i.defaultValue===""+u||(i.defaultValue=""+u)}function Da(i,o,u,h){if(i=i.options,o){o={};for(var v=0;v<u.length;v++)o["$"+u[v]]=!0;for(u=0;u<i.length;u++)v=o.hasOwnProperty("$"+i[u].value),i[u].selected!==v&&(i[u].selected=v),v&&h&&(i[u].defaultSelected=!0)}else{for(u=""+zn(u),o=null,v=0;v<i.length;v++){if(i[v].value===u){i[v].selected=!0,h&&(i[v].defaultSelected=!0);return}o!==null||i[v].disabled||(o=i[v])}o!==null&&(o.selected=!0)}}function Xp(i,o,u){if(o!=null&&(o=""+zn(o),o!==i.value&&(i.value=o),u==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=u!=null?""+zn(u):""}function Jp(i,o,u,h){if(o==null){if(h!=null){if(u!=null)throw Error(n(92));if(ue(h)){if(1<h.length)throw Error(n(93));h=h[0]}u=h}u==null&&(u=""),o=u}u=zn(o),i.defaultValue=u,h=i.textContent,h===u&&h!==""&&h!==null&&(i.value=h),Iu(i)}function _a(i,o){if(o){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=o;return}}i.textContent=o}var dC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zp(i,o,u){var h=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?h?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":h?i.setProperty(o,u):typeof u!="number"||u===0||dC.has(o)?o==="float"?i.cssFloat=u:i[o]=(""+u).trim():i[o]=u+"px"}function eg(i,o,u){if(o!=null&&typeof o!="object")throw Error(n(62));if(i=i.style,u!=null){for(var h in u)!u.hasOwnProperty(h)||o!=null&&o.hasOwnProperty(h)||(h.indexOf("--")===0?i.setProperty(h,""):h==="float"?i.cssFloat="":i[h]="");for(var v in o)h=o[v],o.hasOwnProperty(v)&&u[v]!==h&&Zp(i,v,h)}else for(var x in o)o.hasOwnProperty(x)&&Zp(i,x,o[x])}function qu(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),hC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function nc(i){return hC.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Ls(){}var Uu=null;function $u(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Na=null,ja=null;function tg(i){var o=ka(i);if(o&&(i=o.stateNode)){var u=i[$t]||null;e:switch(i=o.stateNode,o.type){case"input":if(Ou(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Ln(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var h=u[o];if(h!==i&&h.form===i.form){var v=h[$t]||null;if(!v)throw Error(n(90));Ou(h,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(o=0;o<u.length;o++)h=u[o],h.form===i.form&&Yp(h)}break e;case"textarea":Xp(i,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&Da(i,!!u.multiple,o,!1)}}}var Bu=!1;function ng(i,o,u){if(Bu)return i(o,u);Bu=!0;try{var h=i(o);return h}finally{if(Bu=!1,(Na!==null||ja!==null)&&(Bc(),Na&&(o=Na,i=ja,ja=Na=null,tg(o),i)))for(o=0;o<i.length;o++)tg(i[o])}}function Po(i,o){var u=i.stateNode;if(u===null)return null;var h=u[$t]||null;if(h===null)return null;u=h[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(n(231,o,typeof u));return u}var Is=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fu=!1;if(Is)try{var zo={};Object.defineProperty(zo,"passive",{get:function(){Fu=!0}}),window.addEventListener("test",zo,zo),window.removeEventListener("test",zo,zo)}catch{Fu=!1}var li=null,Qu=null,sc=null;function sg(){if(sc)return sc;var i,o=Qu,u=o.length,h,v="value"in li?li.value:li.textContent,x=v.length;for(i=0;i<u&&o[i]===v[i];i++);var R=u-i;for(h=1;h<=R&&o[u-h]===v[x-h];h++);return sc=v.slice(i,1<h?1-h:void 0)}function ic(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function ac(){return!0}function ig(){return!1}function pn(i){function o(u,h,v,x,R){this._reactName=u,this._targetInst=v,this.type=h,this.nativeEvent=x,this.target=R,this.currentTarget=null;for(var D in i)i.hasOwnProperty(D)&&(u=i[D],this[D]=u?u(x):x[D]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?ac:ig,this.isPropagationStopped=ig,this}return m(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ac)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ac)},persist:function(){},isPersistent:ac}),o}var Ki={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oc=pn(Ki),Lo=m({},Ki,{view:0,detail:0}),pC=pn(Lo),Vu,Gu,Io,rc=m({},Lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yu,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Io&&(Io&&i.type==="mousemove"?(Vu=i.screenX-Io.screenX,Gu=i.screenY-Io.screenY):Gu=Vu=0,Io=i),Vu)},movementY:function(i){return"movementY"in i?i.movementY:Gu}}),ag=pn(rc),gC=m({},rc,{dataTransfer:0}),mC=pn(gC),yC=m({},Lo,{relatedTarget:0}),Ku=pn(yC),vC=m({},Ki,{animationName:0,elapsedTime:0,pseudoElement:0}),bC=pn(vC),xC=m({},Ki,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),wC=pn(xC),SC=m({},Ki,{data:0}),og=pn(SC),MC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},EC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function RC(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=EC[i])?!!o[i]:!1}function Yu(){return RC}var kC=m({},Lo,{key:function(i){if(i.key){var o=MC[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=ic(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?CC[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yu,charCode:function(i){return i.type==="keypress"?ic(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?ic(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),TC=pn(kC),AC=m({},rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rg=pn(AC),DC=m({},Lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yu}),_C=pn(DC),NC=m({},Ki,{propertyName:0,elapsedTime:0,pseudoElement:0}),jC=pn(NC),PC=m({},rc,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),zC=pn(PC),LC=m({},Ki,{newState:0,oldState:0}),IC=pn(LC),OC=[9,13,27,32],Wu=Is&&"CompositionEvent"in window,Oo=null;Is&&"documentMode"in document&&(Oo=document.documentMode);var HC=Is&&"TextEvent"in window&&!Oo,cg=Is&&(!Wu||Oo&&8<Oo&&11>=Oo),lg=" ",ug=!1;function dg(i,o){switch(i){case"keyup":return OC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fg(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Pa=!1;function qC(i,o){switch(i){case"compositionend":return fg(o);case"keypress":return o.which!==32?null:(ug=!0,lg);case"textInput":return i=o.data,i===lg&&ug?null:i;default:return null}}function UC(i,o){if(Pa)return i==="compositionend"||!Wu&&dg(i,o)?(i=sg(),sc=Qu=li=null,Pa=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return cg&&o.locale!=="ko"?null:o.data;default:return null}}var $C={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hg(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!$C[i.type]:o==="textarea"}function pg(i,o,u,h){Na?ja?ja.push(h):ja=[h]:Na=h,o=Wc(o,"onChange"),0<o.length&&(u=new oc("onChange","change",null,u,h),i.push({event:u,listeners:o}))}var Ho=null,qo=null;function BC(i){Wy(i,0)}function cc(i){var o=jo(i);if(Yp(o))return i}function gg(i,o){if(i==="change")return o}var mg=!1;if(Is){var Xu;if(Is){var Ju="oninput"in document;if(!Ju){var yg=document.createElement("div");yg.setAttribute("oninput","return;"),Ju=typeof yg.oninput=="function"}Xu=Ju}else Xu=!1;mg=Xu&&(!document.documentMode||9<document.documentMode)}function vg(){Ho&&(Ho.detachEvent("onpropertychange",bg),qo=Ho=null)}function bg(i){if(i.propertyName==="value"&&cc(qo)){var o=[];pg(o,qo,i,$u(i)),ng(BC,o)}}function FC(i,o,u){i==="focusin"?(vg(),Ho=o,qo=u,Ho.attachEvent("onpropertychange",bg)):i==="focusout"&&vg()}function QC(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return cc(qo)}function VC(i,o){if(i==="click")return cc(o)}function GC(i,o){if(i==="input"||i==="change")return cc(o)}function KC(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var Mn=typeof Object.is=="function"?Object.is:KC;function Uo(i,o){if(Mn(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var u=Object.keys(i),h=Object.keys(o);if(u.length!==h.length)return!1;for(h=0;h<u.length;h++){var v=u[h];if(!Ue.call(o,v)||!Mn(i[v],o[v]))return!1}return!0}function xg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function wg(i,o){var u=xg(i);i=0;for(var h;u;){if(u.nodeType===3){if(h=i+u.textContent.length,i<=o&&h>=o)return{node:u,offset:o-i};i=h}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=xg(u)}}function Sg(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?Sg(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function Mg(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=tc(i.document);o instanceof i.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)i=o.contentWindow;else break;o=tc(i.document)}return o}function Zu(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var YC=Is&&"documentMode"in document&&11>=document.documentMode,za=null,ed=null,$o=null,td=!1;function Cg(i,o,u){var h=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;td||za==null||za!==tc(h)||(h=za,"selectionStart"in h&&Zu(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),$o&&Uo($o,h)||($o=h,h=Wc(ed,"onSelect"),0<h.length&&(o=new oc("onSelect","select",null,o,u),i.push({event:o,listeners:h}),o.target=za)))}function Yi(i,o){var u={};return u[i.toLowerCase()]=o.toLowerCase(),u["Webkit"+i]="webkit"+o,u["Moz"+i]="moz"+o,u}var La={animationend:Yi("Animation","AnimationEnd"),animationiteration:Yi("Animation","AnimationIteration"),animationstart:Yi("Animation","AnimationStart"),transitionrun:Yi("Transition","TransitionRun"),transitionstart:Yi("Transition","TransitionStart"),transitioncancel:Yi("Transition","TransitionCancel"),transitionend:Yi("Transition","TransitionEnd")},nd={},Eg={};Is&&(Eg=document.createElement("div").style,"AnimationEvent"in window||(delete La.animationend.animation,delete La.animationiteration.animation,delete La.animationstart.animation),"TransitionEvent"in window||delete La.transitionend.transition);function Wi(i){if(nd[i])return nd[i];if(!La[i])return i;var o=La[i],u;for(u in o)if(o.hasOwnProperty(u)&&u in Eg)return nd[i]=o[u];return i}var Rg=Wi("animationend"),kg=Wi("animationiteration"),Tg=Wi("animationstart"),WC=Wi("transitionrun"),XC=Wi("transitionstart"),JC=Wi("transitioncancel"),Ag=Wi("transitionend"),Dg=new Map,sd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");sd.push("scrollEnd");function Zn(i,o){Dg.set(i,o),Gi(o,[i])}var lc=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},In=[],Ia=0,id=0;function uc(){for(var i=Ia,o=id=Ia=0;o<i;){var u=In[o];In[o++]=null;var h=In[o];In[o++]=null;var v=In[o];In[o++]=null;var x=In[o];if(In[o++]=null,h!==null&&v!==null){var R=h.pending;R===null?v.next=v:(v.next=R.next,R.next=v),h.pending=v}x!==0&&_g(u,v,x)}}function dc(i,o,u,h){In[Ia++]=i,In[Ia++]=o,In[Ia++]=u,In[Ia++]=h,id|=h,i.lanes|=h,i=i.alternate,i!==null&&(i.lanes|=h)}function ad(i,o,u,h){return dc(i,o,u,h),fc(i)}function Xi(i,o){return dc(i,null,null,o),fc(i)}function _g(i,o,u){i.lanes|=u;var h=i.alternate;h!==null&&(h.lanes|=u);for(var v=!1,x=i.return;x!==null;)x.childLanes|=u,h=x.alternate,h!==null&&(h.childLanes|=u),x.tag===22&&(i=x.stateNode,i===null||i._visibility&1||(v=!0)),i=x,x=x.return;return i.tag===3?(x=i.stateNode,v&&o!==null&&(v=31-zt(u),i=x.hiddenUpdates,h=i[v],h===null?i[v]=[o]:h.push(o),o.lane=u|536870912),x):null}function fc(i){if(50<ur)throw ur=0,gf=null,Error(n(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var Oa={};function ZC(i,o,u,h){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cn(i,o,u,h){return new ZC(i,o,u,h)}function od(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Os(i,o){var u=i.alternate;return u===null?(u=Cn(i.tag,o,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=o,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&65011712,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,o=i.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.refCleanup=i.refCleanup,u}function Ng(i,o){i.flags&=65011714;var u=i.alternate;return u===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,o=u.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function hc(i,o,u,h,v,x){var R=0;if(h=i,typeof i=="function")od(i)&&(R=1);else if(typeof i=="string")R=iE(i,u,ie.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Z:return i=Cn(31,u,o,v),i.elementType=Z,i.lanes=x,i;case M:return Ji(u.children,v,x,o);case E:R=8,v|=24;break;case C:return i=Cn(12,u,o,v|2),i.elementType=C,i.lanes=x,i;case _:return i=Cn(13,u,o,v),i.elementType=_,i.lanes=x,i;case N:return i=Cn(19,u,o,v),i.elementType=N,i.lanes=x,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case k:R=10;break e;case T:R=9;break e;case A:R=11;break e;case L:R=14;break e;case q:R=16,h=null;break e}R=29,u=Error(n(130,i===null?"null":typeof i,"")),h=null}return o=Cn(R,u,o,v),o.elementType=i,o.type=h,o.lanes=x,o}function Ji(i,o,u,h){return i=Cn(7,i,h,o),i.lanes=u,i}function rd(i,o,u){return i=Cn(6,i,null,o),i.lanes=u,i}function jg(i){var o=Cn(18,null,null,0);return o.stateNode=i,o}function cd(i,o,u){return o=Cn(4,i.children!==null?i.children:[],i.key,o),o.lanes=u,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var Pg=new WeakMap;function On(i,o){if(typeof i=="object"&&i!==null){var u=Pg.get(i);return u!==void 0?u:(o={value:i,source:o,stack:de(o)},Pg.set(i,o),o)}return{value:i,source:o,stack:de(o)}}var Ha=[],qa=0,pc=null,Bo=0,Hn=[],qn=0,ui=null,ps=1,gs="";function Hs(i,o){Ha[qa++]=Bo,Ha[qa++]=pc,pc=i,Bo=o}function zg(i,o,u){Hn[qn++]=ps,Hn[qn++]=gs,Hn[qn++]=ui,ui=i;var h=ps;i=gs;var v=32-zt(h)-1;h&=~(1<<v),u+=1;var x=32-zt(o)+v;if(30<x){var R=v-v%5;x=(h&(1<<R)-1).toString(32),h>>=R,v-=R,ps=1<<32-zt(o)+v|u<<v|h,gs=x+i}else ps=1<<x|u<<v|h,gs=i}function ld(i){i.return!==null&&(Hs(i,1),zg(i,1,0))}function ud(i){for(;i===pc;)pc=Ha[--qa],Ha[qa]=null,Bo=Ha[--qa],Ha[qa]=null;for(;i===ui;)ui=Hn[--qn],Hn[qn]=null,gs=Hn[--qn],Hn[qn]=null,ps=Hn[--qn],Hn[qn]=null}function Lg(i,o){Hn[qn++]=ps,Hn[qn++]=gs,Hn[qn++]=ui,ps=o.id,gs=o.overflow,ui=i}var en=null,wt=null,Xe=!1,di=null,Un=!1,dd=Error(n(519));function fi(i){var o=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fo(On(o,i)),dd}function Ig(i){var o=i.stateNode,u=i.type,h=i.memoizedProps;switch(o[vt]=i,o[$t]=h,u){case"dialog":Ve("cancel",o),Ve("close",o);break;case"iframe":case"object":case"embed":Ve("load",o);break;case"video":case"audio":for(u=0;u<fr.length;u++)Ve(fr[u],o);break;case"source":Ve("error",o);break;case"img":case"image":case"link":Ve("error",o),Ve("load",o);break;case"details":Ve("toggle",o);break;case"input":Ve("invalid",o),Wp(o,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":Ve("invalid",o);break;case"textarea":Ve("invalid",o),Jp(o,h.value,h.defaultValue,h.children)}u=h.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||h.suppressHydrationWarning===!0||e0(o.textContent,u)?(h.popover!=null&&(Ve("beforetoggle",o),Ve("toggle",o)),h.onScroll!=null&&Ve("scroll",o),h.onScrollEnd!=null&&Ve("scrollend",o),h.onClick!=null&&(o.onclick=Ls),o=!0):o=!1,o||fi(i,!0)}function Og(i){for(en=i.return;en;)switch(en.tag){case 5:case 31:case 13:Un=!1;return;case 27:case 3:Un=!0;return;default:en=en.return}}function Ua(i){if(i!==en)return!1;if(!Xe)return Og(i),Xe=!0,!1;var o=i.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=i.type,u=!(u!=="form"&&u!=="button")||Df(i.type,i.memoizedProps)),u=!u),u&&wt&&fi(i),Og(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));wt=l0(i)}else if(o===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));wt=l0(i)}else o===27?(o=wt,Ri(i.type)?(i=zf,zf=null,wt=i):wt=o):wt=en?Bn(i.stateNode.nextSibling):null;return!0}function Zi(){wt=en=null,Xe=!1}function fd(){var i=di;return i!==null&&(vn===null?vn=i:vn.push.apply(vn,i),di=null),i}function Fo(i){di===null?di=[i]:di.push(i)}var hd=P(null),ea=null,qs=null;function hi(i,o,u){Y(hd,o._currentValue),o._currentValue=u}function Us(i){i._currentValue=hd.current,F(hd)}function pd(i,o,u){for(;i!==null;){var h=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),i===u)break;i=i.return}}function gd(i,o,u,h){var v=i.child;for(v!==null&&(v.return=i);v!==null;){var x=v.dependencies;if(x!==null){var R=v.child;x=x.firstContext;e:for(;x!==null;){var D=x;x=v;for(var I=0;I<o.length;I++)if(D.context===o[I]){x.lanes|=u,D=x.alternate,D!==null&&(D.lanes|=u),pd(x.return,u,i),h||(R=null);break e}x=D.next}}else if(v.tag===18){if(R=v.return,R===null)throw Error(n(341));R.lanes|=u,x=R.alternate,x!==null&&(x.lanes|=u),pd(R,u,i),R=null}else R=v.child;if(R!==null)R.return=v;else for(R=v;R!==null;){if(R===i){R=null;break}if(v=R.sibling,v!==null){v.return=R.return,R=v;break}R=R.return}v=R}}function $a(i,o,u,h){i=null;for(var v=o,x=!1;v!==null;){if(!x){if((v.flags&524288)!==0)x=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var R=v.alternate;if(R===null)throw Error(n(387));if(R=R.memoizedProps,R!==null){var D=v.type;Mn(v.pendingProps.value,R.value)||(i!==null?i.push(D):i=[D])}}else if(v===$.current){if(R=v.alternate,R===null)throw Error(n(387));R.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(i!==null?i.push(yr):i=[yr])}v=v.return}i!==null&&gd(o,i,u,h),o.flags|=262144}function gc(i){for(i=i.firstContext;i!==null;){if(!Mn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function ta(i){ea=i,qs=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function tn(i){return Hg(ea,i)}function mc(i,o){return ea===null&&ta(i),Hg(i,o)}function Hg(i,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},qs===null){if(i===null)throw Error(n(308));qs=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else qs=qs.next=o;return u}var e1=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(u,h){i.push(h)}};this.abort=function(){o.aborted=!0,i.forEach(function(u){return u()})}},t1=r.unstable_scheduleCallback,n1=r.unstable_NormalPriority,It={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function md(){return{controller:new e1,data:new Map,refCount:0}}function Qo(i){i.refCount--,i.refCount===0&&t1(n1,function(){i.controller.abort()})}var Vo=null,yd=0,Ba=0,Fa=null;function s1(i,o){if(Vo===null){var u=Vo=[];yd=0,Ba=wf(),Fa={status:"pending",value:void 0,then:function(h){u.push(h)}}}return yd++,o.then(qg,qg),o}function qg(){if(--yd===0&&Vo!==null){Fa!==null&&(Fa.status="fulfilled");var i=Vo;Vo=null,Ba=0,Fa=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function i1(i,o){var u=[],h={status:"pending",value:null,reason:null,then:function(v){u.push(v)}};return i.then(function(){h.status="fulfilled",h.value=o;for(var v=0;v<u.length;v++)(0,u[v])(o)},function(v){for(h.status="rejected",h.reason=v,v=0;v<u.length;v++)(0,u[v])(void 0)}),h}var Ug=z.S;z.S=function(i,o){Cy=Ze(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&s1(i,o),Ug!==null&&Ug(i,o)};var na=P(null);function vd(){var i=na.current;return i!==null?i:pt.pooledCache}function yc(i,o){o===null?Y(na,na.current):Y(na,o.pool)}function $g(){var i=vd();return i===null?null:{parent:It._currentValue,pool:i}}var Qa=Error(n(460)),bd=Error(n(474)),vc=Error(n(542)),bc={then:function(){}};function Bg(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Fg(i,o,u){switch(u=i[u],u===void 0?i.push(o):u!==o&&(o.then(Ls,Ls),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,Vg(i),i;default:if(typeof o.status=="string")o.then(Ls,Ls);else{if(i=pt,i!==null&&100<i.shellSuspendCounter)throw Error(n(482));i=o,i.status="pending",i.then(function(h){if(o.status==="pending"){var v=o;v.status="fulfilled",v.value=h}},function(h){if(o.status==="pending"){var v=o;v.status="rejected",v.reason=h}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,Vg(i),i}throw ia=o,Qa}}function sa(i){try{var o=i._init;return o(i._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(ia=u,Qa):u}}var ia=null;function Qg(){if(ia===null)throw Error(n(459));var i=ia;return ia=null,i}function Vg(i){if(i===Qa||i===vc)throw Error(n(483))}var Va=null,Go=0;function xc(i){var o=Go;return Go+=1,Va===null&&(Va=[]),Fg(Va,i,o)}function Ko(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function wc(i,o){throw o.$$typeof===y?Error(n(525)):(i=Object.prototype.toString.call(o),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function Gg(i){function o(U,H){if(i){var Q=U.deletions;Q===null?(U.deletions=[H],U.flags|=16):Q.push(H)}}function u(U,H){if(!i)return null;for(;H!==null;)o(U,H),H=H.sibling;return null}function h(U){for(var H=new Map;U!==null;)U.key!==null?H.set(U.key,U):H.set(U.index,U),U=U.sibling;return H}function v(U,H){return U=Os(U,H),U.index=0,U.sibling=null,U}function x(U,H,Q){return U.index=Q,i?(Q=U.alternate,Q!==null?(Q=Q.index,Q<H?(U.flags|=67108866,H):Q):(U.flags|=67108866,H)):(U.flags|=1048576,H)}function R(U){return i&&U.alternate===null&&(U.flags|=67108866),U}function D(U,H,Q,oe){return H===null||H.tag!==6?(H=rd(Q,U.mode,oe),H.return=U,H):(H=v(H,Q),H.return=U,H)}function I(U,H,Q,oe){var Te=Q.type;return Te===M?ne(U,H,Q.props.children,oe,Q.key):H!==null&&(H.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===q&&sa(Te)===H.type)?(H=v(H,Q.props),Ko(H,Q),H.return=U,H):(H=hc(Q.type,Q.key,Q.props,null,U.mode,oe),Ko(H,Q),H.return=U,H)}function V(U,H,Q,oe){return H===null||H.tag!==4||H.stateNode.containerInfo!==Q.containerInfo||H.stateNode.implementation!==Q.implementation?(H=cd(Q,U.mode,oe),H.return=U,H):(H=v(H,Q.children||[]),H.return=U,H)}function ne(U,H,Q,oe,Te){return H===null||H.tag!==7?(H=Ji(Q,U.mode,oe,Te),H.return=U,H):(H=v(H,Q),H.return=U,H)}function re(U,H,Q){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return H=rd(""+H,U.mode,Q),H.return=U,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case b:return Q=hc(H.type,H.key,H.props,null,U.mode,Q),Ko(Q,H),Q.return=U,Q;case S:return H=cd(H,U.mode,Q),H.return=U,H;case q:return H=sa(H),re(U,H,Q)}if(ue(H)||J(H))return H=Ji(H,U.mode,Q,null),H.return=U,H;if(typeof H.then=="function")return re(U,xc(H),Q);if(H.$$typeof===k)return re(U,mc(U,H),Q);wc(U,H)}return null}function K(U,H,Q,oe){var Te=H!==null?H.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Te!==null?null:D(U,H,""+Q,oe);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case b:return Q.key===Te?I(U,H,Q,oe):null;case S:return Q.key===Te?V(U,H,Q,oe):null;case q:return Q=sa(Q),K(U,H,Q,oe)}if(ue(Q)||J(Q))return Te!==null?null:ne(U,H,Q,oe,null);if(typeof Q.then=="function")return K(U,H,xc(Q),oe);if(Q.$$typeof===k)return K(U,H,mc(U,Q),oe);wc(U,Q)}return null}function X(U,H,Q,oe,Te){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return U=U.get(Q)||null,D(H,U,""+oe,Te);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case b:return U=U.get(oe.key===null?Q:oe.key)||null,I(H,U,oe,Te);case S:return U=U.get(oe.key===null?Q:oe.key)||null,V(H,U,oe,Te);case q:return oe=sa(oe),X(U,H,Q,oe,Te)}if(ue(oe)||J(oe))return U=U.get(Q)||null,ne(H,U,oe,Te,null);if(typeof oe.then=="function")return X(U,H,Q,xc(oe),Te);if(oe.$$typeof===k)return X(U,H,Q,mc(H,oe),Te);wc(H,oe)}return null}function xe(U,H,Q,oe){for(var Te=null,et=null,Ce=H,He=H=0,Ke=null;Ce!==null&&He<Q.length;He++){Ce.index>He?(Ke=Ce,Ce=null):Ke=Ce.sibling;var tt=K(U,Ce,Q[He],oe);if(tt===null){Ce===null&&(Ce=Ke);break}i&&Ce&&tt.alternate===null&&o(U,Ce),H=x(tt,H,He),et===null?Te=tt:et.sibling=tt,et=tt,Ce=Ke}if(He===Q.length)return u(U,Ce),Xe&&Hs(U,He),Te;if(Ce===null){for(;He<Q.length;He++)Ce=re(U,Q[He],oe),Ce!==null&&(H=x(Ce,H,He),et===null?Te=Ce:et.sibling=Ce,et=Ce);return Xe&&Hs(U,He),Te}for(Ce=h(Ce);He<Q.length;He++)Ke=X(Ce,U,He,Q[He],oe),Ke!==null&&(i&&Ke.alternate!==null&&Ce.delete(Ke.key===null?He:Ke.key),H=x(Ke,H,He),et===null?Te=Ke:et.sibling=Ke,et=Ke);return i&&Ce.forEach(function(_i){return o(U,_i)}),Xe&&Hs(U,He),Te}function Ne(U,H,Q,oe){if(Q==null)throw Error(n(151));for(var Te=null,et=null,Ce=H,He=H=0,Ke=null,tt=Q.next();Ce!==null&&!tt.done;He++,tt=Q.next()){Ce.index>He?(Ke=Ce,Ce=null):Ke=Ce.sibling;var _i=K(U,Ce,tt.value,oe);if(_i===null){Ce===null&&(Ce=Ke);break}i&&Ce&&_i.alternate===null&&o(U,Ce),H=x(_i,H,He),et===null?Te=_i:et.sibling=_i,et=_i,Ce=Ke}if(tt.done)return u(U,Ce),Xe&&Hs(U,He),Te;if(Ce===null){for(;!tt.done;He++,tt=Q.next())tt=re(U,tt.value,oe),tt!==null&&(H=x(tt,H,He),et===null?Te=tt:et.sibling=tt,et=tt);return Xe&&Hs(U,He),Te}for(Ce=h(Ce);!tt.done;He++,tt=Q.next())tt=X(Ce,U,He,tt.value,oe),tt!==null&&(i&&tt.alternate!==null&&Ce.delete(tt.key===null?He:tt.key),H=x(tt,H,He),et===null?Te=tt:et.sibling=tt,et=tt);return i&&Ce.forEach(function(gE){return o(U,gE)}),Xe&&Hs(U,He),Te}function ft(U,H,Q,oe){if(typeof Q=="object"&&Q!==null&&Q.type===M&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case b:e:{for(var Te=Q.key;H!==null;){if(H.key===Te){if(Te=Q.type,Te===M){if(H.tag===7){u(U,H.sibling),oe=v(H,Q.props.children),oe.return=U,U=oe;break e}}else if(H.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===q&&sa(Te)===H.type){u(U,H.sibling),oe=v(H,Q.props),Ko(oe,Q),oe.return=U,U=oe;break e}u(U,H);break}else o(U,H);H=H.sibling}Q.type===M?(oe=Ji(Q.props.children,U.mode,oe,Q.key),oe.return=U,U=oe):(oe=hc(Q.type,Q.key,Q.props,null,U.mode,oe),Ko(oe,Q),oe.return=U,U=oe)}return R(U);case S:e:{for(Te=Q.key;H!==null;){if(H.key===Te)if(H.tag===4&&H.stateNode.containerInfo===Q.containerInfo&&H.stateNode.implementation===Q.implementation){u(U,H.sibling),oe=v(H,Q.children||[]),oe.return=U,U=oe;break e}else{u(U,H);break}else o(U,H);H=H.sibling}oe=cd(Q,U.mode,oe),oe.return=U,U=oe}return R(U);case q:return Q=sa(Q),ft(U,H,Q,oe)}if(ue(Q))return xe(U,H,Q,oe);if(J(Q)){if(Te=J(Q),typeof Te!="function")throw Error(n(150));return Q=Te.call(Q),Ne(U,H,Q,oe)}if(typeof Q.then=="function")return ft(U,H,xc(Q),oe);if(Q.$$typeof===k)return ft(U,H,mc(U,Q),oe);wc(U,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint"?(Q=""+Q,H!==null&&H.tag===6?(u(U,H.sibling),oe=v(H,Q),oe.return=U,U=oe):(u(U,H),oe=rd(Q,U.mode,oe),oe.return=U,U=oe),R(U)):u(U,H)}return function(U,H,Q,oe){try{Go=0;var Te=ft(U,H,Q,oe);return Va=null,Te}catch(Ce){if(Ce===Qa||Ce===vc)throw Ce;var et=Cn(29,Ce,null,U.mode);return et.lanes=oe,et.return=U,et}finally{}}}var aa=Gg(!0),Kg=Gg(!1),pi=!1;function xd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wd(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function gi(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function mi(i,o,u){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,(nt&2)!==0){var v=h.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),h.pending=o,o=fc(i),_g(i,null,u),o}return dc(i,h,o,u),fc(i)}function Yo(i,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var h=o.lanes;h&=i.pendingLanes,u|=h,o.lanes=u,lt(i,u)}}function Sd(i,o){var u=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,u===h)){var v=null,x=null;if(u=u.firstBaseUpdate,u!==null){do{var R={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};x===null?v=x=R:x=x.next=R,u=u.next}while(u!==null);x===null?v=x=o:x=x.next=o}else v=x=o;u={baseState:h.baseState,firstBaseUpdate:v,lastBaseUpdate:x,shared:h.shared,callbacks:h.callbacks},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=o:i.next=o,u.lastBaseUpdate=o}var Md=!1;function Wo(){if(Md){var i=Fa;if(i!==null)throw i}}function Xo(i,o,u,h){Md=!1;var v=i.updateQueue;pi=!1;var x=v.firstBaseUpdate,R=v.lastBaseUpdate,D=v.shared.pending;if(D!==null){v.shared.pending=null;var I=D,V=I.next;I.next=null,R===null?x=V:R.next=V,R=I;var ne=i.alternate;ne!==null&&(ne=ne.updateQueue,D=ne.lastBaseUpdate,D!==R&&(D===null?ne.firstBaseUpdate=V:D.next=V,ne.lastBaseUpdate=I))}if(x!==null){var re=v.baseState;R=0,ne=V=I=null,D=x;do{var K=D.lane&-536870913,X=K!==D.lane;if(X?(Ge&K)===K:(h&K)===K){K!==0&&K===Ba&&(Md=!0),ne!==null&&(ne=ne.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var xe=i,Ne=D;K=o;var ft=u;switch(Ne.tag){case 1:if(xe=Ne.payload,typeof xe=="function"){re=xe.call(ft,re,K);break e}re=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=Ne.payload,K=typeof xe=="function"?xe.call(ft,re,K):xe,K==null)break e;re=m({},re,K);break e;case 2:pi=!0}}K=D.callback,K!==null&&(i.flags|=64,X&&(i.flags|=8192),X=v.callbacks,X===null?v.callbacks=[K]:X.push(K))}else X={lane:K,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ne===null?(V=ne=X,I=re):ne=ne.next=X,R|=K;if(D=D.next,D===null){if(D=v.shared.pending,D===null)break;X=D,D=X.next,X.next=null,v.lastBaseUpdate=X,v.shared.pending=null}}while(!0);ne===null&&(I=re),v.baseState=I,v.firstBaseUpdate=V,v.lastBaseUpdate=ne,x===null&&(v.shared.lanes=0),wi|=R,i.lanes=R,i.memoizedState=re}}function Yg(i,o){if(typeof i!="function")throw Error(n(191,i));i.call(o)}function Wg(i,o){var u=i.callbacks;if(u!==null)for(i.callbacks=null,i=0;i<u.length;i++)Yg(u[i],o)}var Ga=P(null),Sc=P(0);function Xg(i,o){i=Ws,Y(Sc,i),Y(Ga,o),Ws=i|o.baseLanes}function Cd(){Y(Sc,Ws),Y(Ga,Ga.current)}function Ed(){Ws=Sc.current,F(Ga),F(Sc)}var En=P(null),$n=null;function yi(i){var o=i.alternate;Y(Dt,Dt.current&1),Y(En,i),$n===null&&(o===null||Ga.current!==null||o.memoizedState!==null)&&($n=i)}function Rd(i){Y(Dt,Dt.current),Y(En,i),$n===null&&($n=i)}function Jg(i){i.tag===22?(Y(Dt,Dt.current),Y(En,i),$n===null&&($n=i)):vi()}function vi(){Y(Dt,Dt.current),Y(En,En.current)}function Rn(i){F(En),$n===i&&($n=null),F(Dt)}var Dt=P(0);function Mc(i){for(var o=i;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||jf(u)||Pf(u)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var $s=0,Oe=null,ut=null,Ot=null,Cc=!1,Ka=!1,oa=!1,Ec=0,Jo=0,Ya=null,a1=0;function Et(){throw Error(n(321))}function kd(i,o){if(o===null)return!1;for(var u=0;u<o.length&&u<i.length;u++)if(!Mn(i[u],o[u]))return!1;return!0}function Td(i,o,u,h,v,x){return $s=x,Oe=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,z.H=i===null||i.memoizedState===null?zm:Bd,oa=!1,x=u(h,v),oa=!1,Ka&&(x=em(o,u,h,v)),Zg(i),x}function Zg(i){z.H=tr;var o=ut!==null&&ut.next!==null;if($s=0,Ot=ut=Oe=null,Cc=!1,Jo=0,Ya=null,o)throw Error(n(300));i===null||Ht||(i=i.dependencies,i!==null&&gc(i)&&(Ht=!0))}function em(i,o,u,h){Oe=i;var v=0;do{if(Ka&&(Ya=null),Jo=0,Ka=!1,25<=v)throw Error(n(301));if(v+=1,Ot=ut=null,i.updateQueue!=null){var x=i.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}z.H=Lm,x=o(u,h)}while(Ka);return x}function o1(){var i=z.H,o=i.useState()[0];return o=typeof o.then=="function"?Zo(o):o,i=i.useState()[0],(ut!==null?ut.memoizedState:null)!==i&&(Oe.flags|=1024),o}function Ad(){var i=Ec!==0;return Ec=0,i}function Dd(i,o,u){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~u}function _d(i){if(Cc){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Cc=!1}$s=0,Ot=ut=Oe=null,Ka=!1,Jo=Ec=0,Ya=null}function dn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?Oe.memoizedState=Ot=i:Ot=Ot.next=i,Ot}function _t(){if(ut===null){var i=Oe.alternate;i=i!==null?i.memoizedState:null}else i=ut.next;var o=Ot===null?Oe.memoizedState:Ot.next;if(o!==null)Ot=o,ut=i;else{if(i===null)throw Oe.alternate===null?Error(n(467)):Error(n(310));ut=i,i={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},Ot===null?Oe.memoizedState=Ot=i:Ot=Ot.next=i}return Ot}function Rc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Zo(i){var o=Jo;return Jo+=1,Ya===null&&(Ya=[]),i=Fg(Ya,i,o),o=Oe,(Ot===null?o.memoizedState:Ot.next)===null&&(o=o.alternate,z.H=o===null||o.memoizedState===null?zm:Bd),i}function kc(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Zo(i);if(i.$$typeof===k)return tn(i)}throw Error(n(438,String(i)))}function Nd(i){var o=null,u=Oe.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var h=Oe.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(o={data:h.data.map(function(v){return v.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Rc(),Oe.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(i),h=0;h<i;h++)u[h]=se;return o.index++,u}function Bs(i,o){return typeof o=="function"?o(i):o}function Tc(i){var o=_t();return jd(o,ut,i)}function jd(i,o,u){var h=i.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=u;var v=i.baseQueue,x=h.pending;if(x!==null){if(v!==null){var R=v.next;v.next=x.next,x.next=R}o.baseQueue=v=x,h.pending=null}if(x=i.baseState,v===null)i.memoizedState=x;else{o=v.next;var D=R=null,I=null,V=o,ne=!1;do{var re=V.lane&-536870913;if(re!==V.lane?(Ge&re)===re:($s&re)===re){var K=V.revertLane;if(K===0)I!==null&&(I=I.next={lane:0,revertLane:0,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),re===Ba&&(ne=!0);else if(($s&K)===K){V=V.next,K===Ba&&(ne=!0);continue}else re={lane:0,revertLane:V.revertLane,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},I===null?(D=I=re,R=x):I=I.next=re,Oe.lanes|=K,wi|=K;re=V.action,oa&&u(x,re),x=V.hasEagerState?V.eagerState:u(x,re)}else K={lane:re,revertLane:V.revertLane,gesture:V.gesture,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},I===null?(D=I=K,R=x):I=I.next=K,Oe.lanes|=re,wi|=re;V=V.next}while(V!==null&&V!==o);if(I===null?R=x:I.next=D,!Mn(x,i.memoizedState)&&(Ht=!0,ne&&(u=Fa,u!==null)))throw u;i.memoizedState=x,i.baseState=R,i.baseQueue=I,h.lastRenderedState=x}return v===null&&(h.lanes=0),[i.memoizedState,h.dispatch]}function Pd(i){var o=_t(),u=o.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=i;var h=u.dispatch,v=u.pending,x=o.memoizedState;if(v!==null){u.pending=null;var R=v=v.next;do x=i(x,R.action),R=R.next;while(R!==v);Mn(x,o.memoizedState)||(Ht=!0),o.memoizedState=x,o.baseQueue===null&&(o.baseState=x),u.lastRenderedState=x}return[x,h]}function tm(i,o,u){var h=Oe,v=_t(),x=Xe;if(x){if(u===void 0)throw Error(n(407));u=u()}else u=o();var R=!Mn((ut||v).memoizedState,u);if(R&&(v.memoizedState=u,Ht=!0),v=v.queue,Id(im.bind(null,h,v,i),[i]),v.getSnapshot!==o||R||Ot!==null&&Ot.memoizedState.tag&1){if(h.flags|=2048,Wa(9,{destroy:void 0},sm.bind(null,h,v,u,o),null),pt===null)throw Error(n(349));x||($s&127)!==0||nm(h,o,u)}return u}function nm(i,o,u){i.flags|=16384,i={getSnapshot:o,value:u},o=Oe.updateQueue,o===null?(o=Rc(),Oe.updateQueue=o,o.stores=[i]):(u=o.stores,u===null?o.stores=[i]:u.push(i))}function sm(i,o,u,h){o.value=u,o.getSnapshot=h,am(o)&&om(i)}function im(i,o,u){return u(function(){am(o)&&om(i)})}function am(i){var o=i.getSnapshot;i=i.value;try{var u=o();return!Mn(i,u)}catch{return!0}}function om(i){var o=Xi(i,2);o!==null&&bn(o,i,2)}function zd(i){var o=dn();if(typeof i=="function"){var u=i;if(i=u(),oa){Kt(!0);try{u()}finally{Kt(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bs,lastRenderedState:i},o}function rm(i,o,u,h){return i.baseState=u,jd(i,ut,typeof h=="function"?h:Bs)}function r1(i,o,u,h,v){if(_c(i))throw Error(n(485));if(i=o.action,i!==null){var x={payload:v,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){x.listeners.push(R)}};z.T!==null?u(!0):x.isTransition=!1,h(x),u=o.pending,u===null?(x.next=o.pending=x,cm(o,x)):(x.next=u.next,o.pending=u.next=x)}}function cm(i,o){var u=o.action,h=o.payload,v=i.state;if(o.isTransition){var x=z.T,R={};z.T=R;try{var D=u(v,h),I=z.S;I!==null&&I(R,D),lm(i,o,D)}catch(V){Ld(i,o,V)}finally{x!==null&&R.types!==null&&(x.types=R.types),z.T=x}}else try{x=u(v,h),lm(i,o,x)}catch(V){Ld(i,o,V)}}function lm(i,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(h){um(i,o,h)},function(h){return Ld(i,o,h)}):um(i,o,u)}function um(i,o,u){o.status="fulfilled",o.value=u,dm(o),i.state=u,o=i.pending,o!==null&&(u=o.next,u===o?i.pending=null:(u=u.next,o.next=u,cm(i,u)))}function Ld(i,o,u){var h=i.pending;if(i.pending=null,h!==null){h=h.next;do o.status="rejected",o.reason=u,dm(o),o=o.next;while(o!==h)}i.action=null}function dm(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function fm(i,o){return o}function hm(i,o){if(Xe){var u=pt.formState;if(u!==null){e:{var h=Oe;if(Xe){if(wt){t:{for(var v=wt,x=Un;v.nodeType!==8;){if(!x){v=null;break t}if(v=Bn(v.nextSibling),v===null){v=null;break t}}x=v.data,v=x==="F!"||x==="F"?v:null}if(v){wt=Bn(v.nextSibling),h=v.data==="F!";break e}}fi(h)}h=!1}h&&(o=u[0])}}return u=dn(),u.memoizedState=u.baseState=o,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fm,lastRenderedState:o},u.queue=h,u=Nm.bind(null,Oe,h),h.dispatch=u,h=zd(!1),x=$d.bind(null,Oe,!1,h.queue),h=dn(),v={state:o,dispatch:null,action:i,pending:null},h.queue=v,u=r1.bind(null,Oe,v,x,u),v.dispatch=u,h.memoizedState=i,[o,u,!1]}function pm(i){var o=_t();return gm(o,ut,i)}function gm(i,o,u){if(o=jd(i,o,fm)[0],i=Tc(Bs)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var h=Zo(o)}catch(R){throw R===Qa?vc:R}else h=o;o=_t();var v=o.queue,x=v.dispatch;return u!==o.memoizedState&&(Oe.flags|=2048,Wa(9,{destroy:void 0},c1.bind(null,v,u),null)),[h,x,i]}function c1(i,o){i.action=o}function mm(i){var o=_t(),u=ut;if(u!==null)return gm(o,u,i);_t(),o=o.memoizedState,u=_t();var h=u.queue.dispatch;return u.memoizedState=i,[o,h,!1]}function Wa(i,o,u,h){return i={tag:i,create:u,deps:h,inst:o,next:null},o=Oe.updateQueue,o===null&&(o=Rc(),Oe.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=i.next=i:(h=u.next,u.next=i,i.next=h,o.lastEffect=i),i}function ym(){return _t().memoizedState}function Ac(i,o,u,h){var v=dn();Oe.flags|=i,v.memoizedState=Wa(1|o,{destroy:void 0},u,h===void 0?null:h)}function Dc(i,o,u,h){var v=_t();h=h===void 0?null:h;var x=v.memoizedState.inst;ut!==null&&h!==null&&kd(h,ut.memoizedState.deps)?v.memoizedState=Wa(o,x,u,h):(Oe.flags|=i,v.memoizedState=Wa(1|o,x,u,h))}function vm(i,o){Ac(8390656,8,i,o)}function Id(i,o){Dc(2048,8,i,o)}function l1(i){Oe.flags|=4;var o=Oe.updateQueue;if(o===null)o=Rc(),Oe.updateQueue=o,o.events=[i];else{var u=o.events;u===null?o.events=[i]:u.push(i)}}function bm(i){var o=_t().memoizedState;return l1({ref:o,nextImpl:i}),function(){if((nt&2)!==0)throw Error(n(440));return o.impl.apply(void 0,arguments)}}function xm(i,o){return Dc(4,2,i,o)}function wm(i,o){return Dc(4,4,i,o)}function Sm(i,o){if(typeof o=="function"){i=i();var u=o(i);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function Mm(i,o,u){u=u!=null?u.concat([i]):null,Dc(4,4,Sm.bind(null,o,i),u)}function Od(){}function Cm(i,o){var u=_t();o=o===void 0?null:o;var h=u.memoizedState;return o!==null&&kd(o,h[1])?h[0]:(u.memoizedState=[i,o],i)}function Em(i,o){var u=_t();o=o===void 0?null:o;var h=u.memoizedState;if(o!==null&&kd(o,h[1]))return h[0];if(h=i(),oa){Kt(!0);try{i()}finally{Kt(!1)}}return u.memoizedState=[h,o],h}function Hd(i,o,u){return u===void 0||($s&1073741824)!==0&&(Ge&261930)===0?i.memoizedState=o:(i.memoizedState=u,i=Ry(),Oe.lanes|=i,wi|=i,u)}function Rm(i,o,u,h){return Mn(u,o)?u:Ga.current!==null?(i=Hd(i,u,h),Mn(i,o)||(Ht=!0),i):($s&42)===0||($s&1073741824)!==0&&(Ge&261930)===0?(Ht=!0,i.memoizedState=u):(i=Ry(),Oe.lanes|=i,wi|=i,o)}function km(i,o,u,h,v){var x=j.p;j.p=x!==0&&8>x?x:8;var R=z.T,D={};z.T=D,$d(i,!1,o,u);try{var I=v(),V=z.S;if(V!==null&&V(D,I),I!==null&&typeof I=="object"&&typeof I.then=="function"){var ne=i1(I,h);er(i,o,ne,An(i))}else er(i,o,h,An(i))}catch(re){er(i,o,{then:function(){},status:"rejected",reason:re},An())}finally{j.p=x,R!==null&&D.types!==null&&(R.types=D.types),z.T=R}}function u1(){}function qd(i,o,u,h){if(i.tag!==5)throw Error(n(476));var v=Tm(i).queue;km(i,v,o,O,u===null?u1:function(){return Am(i),u(h)})}function Tm(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bs,lastRenderedState:O},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bs,lastRenderedState:u},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function Am(i){var o=Tm(i);o.next===null&&(o=i.alternate.memoizedState),er(i,o.next.queue,{},An())}function Ud(){return tn(yr)}function Dm(){return _t().memoizedState}function _m(){return _t().memoizedState}function d1(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var u=An();i=gi(u);var h=mi(o,i,u);h!==null&&(bn(h,o,u),Yo(h,o,u)),o={cache:md()},i.payload=o;return}o=o.return}}function f1(i,o,u){var h=An();u={lane:h,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},_c(i)?jm(o,u):(u=ad(i,o,u,h),u!==null&&(bn(u,i,h),Pm(u,o,h)))}function Nm(i,o,u){var h=An();er(i,o,u,h)}function er(i,o,u,h){var v={lane:h,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(_c(i))jm(o,v);else{var x=i.alternate;if(i.lanes===0&&(x===null||x.lanes===0)&&(x=o.lastRenderedReducer,x!==null))try{var R=o.lastRenderedState,D=x(R,u);if(v.hasEagerState=!0,v.eagerState=D,Mn(D,R))return dc(i,o,v,0),pt===null&&uc(),!1}catch{}finally{}if(u=ad(i,o,v,h),u!==null)return bn(u,i,h),Pm(u,o,h),!0}return!1}function $d(i,o,u,h){if(h={lane:2,revertLane:wf(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},_c(i)){if(o)throw Error(n(479))}else o=ad(i,u,h,2),o!==null&&bn(o,i,2)}function _c(i){var o=i.alternate;return i===Oe||o!==null&&o===Oe}function jm(i,o){Ka=Cc=!0;var u=i.pending;u===null?o.next=o:(o.next=u.next,u.next=o),i.pending=o}function Pm(i,o,u){if((u&4194048)!==0){var h=o.lanes;h&=i.pendingLanes,u|=h,o.lanes=u,lt(i,u)}}var tr={readContext:tn,use:kc,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useLayoutEffect:Et,useInsertionEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useSyncExternalStore:Et,useId:Et,useHostTransitionStatus:Et,useFormState:Et,useActionState:Et,useOptimistic:Et,useMemoCache:Et,useCacheRefresh:Et};tr.useEffectEvent=Et;var zm={readContext:tn,use:kc,useCallback:function(i,o){return dn().memoizedState=[i,o===void 0?null:o],i},useContext:tn,useEffect:vm,useImperativeHandle:function(i,o,u){u=u!=null?u.concat([i]):null,Ac(4194308,4,Sm.bind(null,o,i),u)},useLayoutEffect:function(i,o){return Ac(4194308,4,i,o)},useInsertionEffect:function(i,o){Ac(4,2,i,o)},useMemo:function(i,o){var u=dn();o=o===void 0?null:o;var h=i();if(oa){Kt(!0);try{i()}finally{Kt(!1)}}return u.memoizedState=[h,o],h},useReducer:function(i,o,u){var h=dn();if(u!==void 0){var v=u(o);if(oa){Kt(!0);try{u(o)}finally{Kt(!1)}}}else v=o;return h.memoizedState=h.baseState=v,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:v},h.queue=i,i=i.dispatch=f1.bind(null,Oe,i),[h.memoizedState,i]},useRef:function(i){var o=dn();return i={current:i},o.memoizedState=i},useState:function(i){i=zd(i);var o=i.queue,u=Nm.bind(null,Oe,o);return o.dispatch=u,[i.memoizedState,u]},useDebugValue:Od,useDeferredValue:function(i,o){var u=dn();return Hd(u,i,o)},useTransition:function(){var i=zd(!1);return i=km.bind(null,Oe,i.queue,!0,!1),dn().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,u){var h=Oe,v=dn();if(Xe){if(u===void 0)throw Error(n(407));u=u()}else{if(u=o(),pt===null)throw Error(n(349));(Ge&127)!==0||nm(h,o,u)}v.memoizedState=u;var x={value:u,getSnapshot:o};return v.queue=x,vm(im.bind(null,h,x,i),[i]),h.flags|=2048,Wa(9,{destroy:void 0},sm.bind(null,h,x,u,o),null),u},useId:function(){var i=dn(),o=pt.identifierPrefix;if(Xe){var u=gs,h=ps;u=(h&~(1<<32-zt(h)-1)).toString(32)+u,o="_"+o+"R_"+u,u=Ec++,0<u&&(o+="H"+u.toString(32)),o+="_"}else u=a1++,o="_"+o+"r_"+u.toString(32)+"_";return i.memoizedState=o},useHostTransitionStatus:Ud,useFormState:hm,useActionState:hm,useOptimistic:function(i){var o=dn();o.memoizedState=o.baseState=i;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=$d.bind(null,Oe,!0,u),u.dispatch=o,[i,o]},useMemoCache:Nd,useCacheRefresh:function(){return dn().memoizedState=d1.bind(null,Oe)},useEffectEvent:function(i){var o=dn(),u={impl:i};return o.memoizedState=u,function(){if((nt&2)!==0)throw Error(n(440));return u.impl.apply(void 0,arguments)}}},Bd={readContext:tn,use:kc,useCallback:Cm,useContext:tn,useEffect:Id,useImperativeHandle:Mm,useInsertionEffect:xm,useLayoutEffect:wm,useMemo:Em,useReducer:Tc,useRef:ym,useState:function(){return Tc(Bs)},useDebugValue:Od,useDeferredValue:function(i,o){var u=_t();return Rm(u,ut.memoizedState,i,o)},useTransition:function(){var i=Tc(Bs)[0],o=_t().memoizedState;return[typeof i=="boolean"?i:Zo(i),o]},useSyncExternalStore:tm,useId:Dm,useHostTransitionStatus:Ud,useFormState:pm,useActionState:pm,useOptimistic:function(i,o){var u=_t();return rm(u,ut,i,o)},useMemoCache:Nd,useCacheRefresh:_m};Bd.useEffectEvent=bm;var Lm={readContext:tn,use:kc,useCallback:Cm,useContext:tn,useEffect:Id,useImperativeHandle:Mm,useInsertionEffect:xm,useLayoutEffect:wm,useMemo:Em,useReducer:Pd,useRef:ym,useState:function(){return Pd(Bs)},useDebugValue:Od,useDeferredValue:function(i,o){var u=_t();return ut===null?Hd(u,i,o):Rm(u,ut.memoizedState,i,o)},useTransition:function(){var i=Pd(Bs)[0],o=_t().memoizedState;return[typeof i=="boolean"?i:Zo(i),o]},useSyncExternalStore:tm,useId:Dm,useHostTransitionStatus:Ud,useFormState:mm,useActionState:mm,useOptimistic:function(i,o){var u=_t();return ut!==null?rm(u,ut,i,o):(u.baseState=i,[i,u.queue.dispatch])},useMemoCache:Nd,useCacheRefresh:_m};Lm.useEffectEvent=bm;function Fd(i,o,u,h){o=i.memoizedState,u=u(h,o),u=u==null?o:m({},o,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Qd={enqueueSetState:function(i,o,u){i=i._reactInternals;var h=An(),v=gi(h);v.payload=o,u!=null&&(v.callback=u),o=mi(i,v,h),o!==null&&(bn(o,i,h),Yo(o,i,h))},enqueueReplaceState:function(i,o,u){i=i._reactInternals;var h=An(),v=gi(h);v.tag=1,v.payload=o,u!=null&&(v.callback=u),o=mi(i,v,h),o!==null&&(bn(o,i,h),Yo(o,i,h))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var u=An(),h=gi(u);h.tag=2,o!=null&&(h.callback=o),o=mi(i,h,u),o!==null&&(bn(o,i,u),Yo(o,i,u))}};function Im(i,o,u,h,v,x,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,x,R):o.prototype&&o.prototype.isPureReactComponent?!Uo(u,h)||!Uo(v,x):!0}function Om(i,o,u,h){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,h),o.state!==i&&Qd.enqueueReplaceState(o,o.state,null)}function ra(i,o){var u=o;if("ref"in o){u={};for(var h in o)h!=="ref"&&(u[h]=o[h])}if(i=i.defaultProps){u===o&&(u=m({},u));for(var v in i)u[v]===void 0&&(u[v]=i[v])}return u}function Hm(i){lc(i)}function qm(i){console.error(i)}function Um(i){lc(i)}function Nc(i,o){try{var u=i.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(h){setTimeout(function(){throw h})}}function $m(i,o,u){try{var h=i.onCaughtError;h(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Vd(i,o,u){return u=gi(u),u.tag=3,u.payload={element:null},u.callback=function(){Nc(i,o)},u}function Bm(i){return i=gi(i),i.tag=3,i}function Fm(i,o,u,h){var v=u.type.getDerivedStateFromError;if(typeof v=="function"){var x=h.value;i.payload=function(){return v(x)},i.callback=function(){$m(o,u,h)}}var R=u.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(i.callback=function(){$m(o,u,h),typeof v!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var D=h.stack;this.componentDidCatch(h.value,{componentStack:D!==null?D:""})})}function h1(i,o,u,h,v){if(u.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(o=u.alternate,o!==null&&$a(o,u,v,!0),u=En.current,u!==null){switch(u.tag){case 31:case 13:return $n===null?Fc():u.alternate===null&&Rt===0&&(Rt=3),u.flags&=-257,u.flags|=65536,u.lanes=v,h===bc?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([h]):o.add(h),vf(i,h,v)),!1;case 22:return u.flags|=65536,h===bc?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([h])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([h]):u.add(h)),vf(i,h,v)),!1}throw Error(n(435,u.tag))}return vf(i,h,v),Fc(),!1}if(Xe)return o=En.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=v,h!==dd&&(i=Error(n(422),{cause:h}),Fo(On(i,u)))):(h!==dd&&(o=Error(n(423),{cause:h}),Fo(On(o,u))),i=i.current.alternate,i.flags|=65536,v&=-v,i.lanes|=v,h=On(h,u),v=Vd(i.stateNode,h,v),Sd(i,v),Rt!==4&&(Rt=2)),!1;var x=Error(n(520),{cause:h});if(x=On(x,u),lr===null?lr=[x]:lr.push(x),Rt!==4&&(Rt=2),o===null)return!0;h=On(h,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,i=v&-v,u.lanes|=i,i=Vd(u.stateNode,h,i),Sd(u,i),!1;case 1:if(o=u.type,x=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Si===null||!Si.has(x))))return u.flags|=65536,v&=-v,u.lanes|=v,v=Bm(v),Fm(v,i,u,h),Sd(u,v),!1}u=u.return}while(u!==null);return!1}var Gd=Error(n(461)),Ht=!1;function nn(i,o,u,h){o.child=i===null?Kg(o,null,u,h):aa(o,i.child,u,h)}function Qm(i,o,u,h,v){u=u.render;var x=o.ref;if("ref"in h){var R={};for(var D in h)D!=="ref"&&(R[D]=h[D])}else R=h;return ta(o),h=Td(i,o,u,R,x,v),D=Ad(),i!==null&&!Ht?(Dd(i,o,v),Fs(i,o,v)):(Xe&&D&&ld(o),o.flags|=1,nn(i,o,h,v),o.child)}function Vm(i,o,u,h,v){if(i===null){var x=u.type;return typeof x=="function"&&!od(x)&&x.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=x,Gm(i,o,x,h,v)):(i=hc(u.type,null,h,o,o.mode,v),i.ref=o.ref,i.return=o,o.child=i)}if(x=i.child,!tf(i,v)){var R=x.memoizedProps;if(u=u.compare,u=u!==null?u:Uo,u(R,h)&&i.ref===o.ref)return Fs(i,o,v)}return o.flags|=1,i=Os(x,h),i.ref=o.ref,i.return=o,o.child=i}function Gm(i,o,u,h,v){if(i!==null){var x=i.memoizedProps;if(Uo(x,h)&&i.ref===o.ref)if(Ht=!1,o.pendingProps=h=x,tf(i,v))(i.flags&131072)!==0&&(Ht=!0);else return o.lanes=i.lanes,Fs(i,o,v)}return Kd(i,o,u,h,v)}function Km(i,o,u,h){var v=h.children,x=i!==null?i.memoizedState:null;if(i===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((o.flags&128)!==0){if(x=x!==null?x.baseLanes|u:u,i!==null){for(h=o.child=i.child,v=0;h!==null;)v=v|h.lanes|h.childLanes,h=h.sibling;h=v&~x}else h=0,o.child=null;return Ym(i,o,x,u,h)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&yc(o,x!==null?x.cachePool:null),x!==null?Xg(o,x):Cd(),Jg(o);else return h=o.lanes=536870912,Ym(i,o,x!==null?x.baseLanes|u:u,u,h)}else x!==null?(yc(o,x.cachePool),Xg(o,x),vi(),o.memoizedState=null):(i!==null&&yc(o,null),Cd(),vi());return nn(i,o,v,u),o.child}function nr(i,o){return i!==null&&i.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Ym(i,o,u,h,v){var x=vd();return x=x===null?null:{parent:It._currentValue,pool:x},o.memoizedState={baseLanes:u,cachePool:x},i!==null&&yc(o,null),Cd(),Jg(o),i!==null&&$a(i,o,h,!0),o.childLanes=v,null}function jc(i,o){return o=zc({mode:o.mode,children:o.children},i.mode),o.ref=i.ref,i.child=o,o.return=i,o}function Wm(i,o,u){return aa(o,i.child,null,u),i=jc(o,o.pendingProps),i.flags|=2,Rn(o),o.memoizedState=null,i}function p1(i,o,u){var h=o.pendingProps,v=(o.flags&128)!==0;if(o.flags&=-129,i===null){if(Xe){if(h.mode==="hidden")return i=jc(o,h),o.lanes=536870912,nr(null,i);if(Rd(o),(i=wt)?(i=c0(i,Un),i=i!==null&&i.data==="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:ui!==null?{id:ps,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},u=jg(i),u.return=o,o.child=u,en=o,wt=null)):i=null,i===null)throw fi(o);return o.lanes=536870912,null}return jc(o,h)}var x=i.memoizedState;if(x!==null){var R=x.dehydrated;if(Rd(o),v)if(o.flags&256)o.flags&=-257,o=Wm(i,o,u);else if(o.memoizedState!==null)o.child=i.child,o.flags|=128,o=null;else throw Error(n(558));else if(Ht||$a(i,o,u,!1),v=(u&i.childLanes)!==0,Ht||v){if(h=pt,h!==null&&(R=Lt(h,u),R!==0&&R!==x.retryLane))throw x.retryLane=R,Xi(i,R),bn(h,i,R),Gd;Fc(),o=Wm(i,o,u)}else i=x.treeContext,wt=Bn(R.nextSibling),en=o,Xe=!0,di=null,Un=!1,i!==null&&Lg(o,i),o=jc(o,h),o.flags|=4096;return o}return i=Os(i.child,{mode:h.mode,children:h.children}),i.ref=o.ref,o.child=i,i.return=o,i}function Pc(i,o){var u=o.ref;if(u===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(n(284));(i===null||i.ref!==u)&&(o.flags|=4194816)}}function Kd(i,o,u,h,v){return ta(o),u=Td(i,o,u,h,void 0,v),h=Ad(),i!==null&&!Ht?(Dd(i,o,v),Fs(i,o,v)):(Xe&&h&&ld(o),o.flags|=1,nn(i,o,u,v),o.child)}function Xm(i,o,u,h,v,x){return ta(o),o.updateQueue=null,u=em(o,h,u,v),Zg(i),h=Ad(),i!==null&&!Ht?(Dd(i,o,x),Fs(i,o,x)):(Xe&&h&&ld(o),o.flags|=1,nn(i,o,u,x),o.child)}function Jm(i,o,u,h,v){if(ta(o),o.stateNode===null){var x=Oa,R=u.contextType;typeof R=="object"&&R!==null&&(x=tn(R)),x=new u(h,x),o.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Qd,o.stateNode=x,x._reactInternals=o,x=o.stateNode,x.props=h,x.state=o.memoizedState,x.refs={},xd(o),R=u.contextType,x.context=typeof R=="object"&&R!==null?tn(R):Oa,x.state=o.memoizedState,R=u.getDerivedStateFromProps,typeof R=="function"&&(Fd(o,u,R,h),x.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(R=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),R!==x.state&&Qd.enqueueReplaceState(x,x.state,null),Xo(o,h,x,v),Wo(),x.state=o.memoizedState),typeof x.componentDidMount=="function"&&(o.flags|=4194308),h=!0}else if(i===null){x=o.stateNode;var D=o.memoizedProps,I=ra(u,D);x.props=I;var V=x.context,ne=u.contextType;R=Oa,typeof ne=="object"&&ne!==null&&(R=tn(ne));var re=u.getDerivedStateFromProps;ne=typeof re=="function"||typeof x.getSnapshotBeforeUpdate=="function",D=o.pendingProps!==D,ne||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(D||V!==R)&&Om(o,x,h,R),pi=!1;var K=o.memoizedState;x.state=K,Xo(o,h,x,v),Wo(),V=o.memoizedState,D||K!==V||pi?(typeof re=="function"&&(Fd(o,u,re,h),V=o.memoizedState),(I=pi||Im(o,u,I,h,K,V,R))?(ne||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(o.flags|=4194308)):(typeof x.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=V),x.props=h,x.state=V,x.context=R,h=I):(typeof x.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{x=o.stateNode,wd(i,o),R=o.memoizedProps,ne=ra(u,R),x.props=ne,re=o.pendingProps,K=x.context,V=u.contextType,I=Oa,typeof V=="object"&&V!==null&&(I=tn(V)),D=u.getDerivedStateFromProps,(V=typeof D=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(R!==re||K!==I)&&Om(o,x,h,I),pi=!1,K=o.memoizedState,x.state=K,Xo(o,h,x,v),Wo();var X=o.memoizedState;R!==re||K!==X||pi||i!==null&&i.dependencies!==null&&gc(i.dependencies)?(typeof D=="function"&&(Fd(o,u,D,h),X=o.memoizedState),(ne=pi||Im(o,u,ne,h,K,X,I)||i!==null&&i.dependencies!==null&&gc(i.dependencies))?(V||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(h,X,I),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(h,X,I)),typeof x.componentDidUpdate=="function"&&(o.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof x.componentDidUpdate!="function"||R===i.memoizedProps&&K===i.memoizedState||(o.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&K===i.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=X),x.props=h,x.state=X,x.context=I,h=ne):(typeof x.componentDidUpdate!="function"||R===i.memoizedProps&&K===i.memoizedState||(o.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&K===i.memoizedState||(o.flags|=1024),h=!1)}return x=h,Pc(i,o),h=(o.flags&128)!==0,x||h?(x=o.stateNode,u=h&&typeof u.getDerivedStateFromError!="function"?null:x.render(),o.flags|=1,i!==null&&h?(o.child=aa(o,i.child,null,v),o.child=aa(o,null,u,v)):nn(i,o,u,v),o.memoizedState=x.state,i=o.child):i=Fs(i,o,v),i}function Zm(i,o,u,h){return Zi(),o.flags|=256,nn(i,o,u,h),o.child}var Yd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wd(i){return{baseLanes:i,cachePool:$g()}}function Xd(i,o,u){return i=i!==null?i.childLanes&~u:0,o&&(i|=Tn),i}function ey(i,o,u){var h=o.pendingProps,v=!1,x=(o.flags&128)!==0,R;if((R=x)||(R=i!==null&&i.memoizedState===null?!1:(Dt.current&2)!==0),R&&(v=!0,o.flags&=-129),R=(o.flags&32)!==0,o.flags&=-33,i===null){if(Xe){if(v?yi(o):vi(),(i=wt)?(i=c0(i,Un),i=i!==null&&i.data!=="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:ui!==null?{id:ps,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},u=jg(i),u.return=o,o.child=u,en=o,wt=null)):i=null,i===null)throw fi(o);return Pf(i)?o.lanes=32:o.lanes=536870912,null}var D=h.children;return h=h.fallback,v?(vi(),v=o.mode,D=zc({mode:"hidden",children:D},v),h=Ji(h,v,u,null),D.return=o,h.return=o,D.sibling=h,o.child=D,h=o.child,h.memoizedState=Wd(u),h.childLanes=Xd(i,R,u),o.memoizedState=Yd,nr(null,h)):(yi(o),Jd(o,D))}var I=i.memoizedState;if(I!==null&&(D=I.dehydrated,D!==null)){if(x)o.flags&256?(yi(o),o.flags&=-257,o=Zd(i,o,u)):o.memoizedState!==null?(vi(),o.child=i.child,o.flags|=128,o=null):(vi(),D=h.fallback,v=o.mode,h=zc({mode:"visible",children:h.children},v),D=Ji(D,v,u,null),D.flags|=2,h.return=o,D.return=o,h.sibling=D,o.child=h,aa(o,i.child,null,u),h=o.child,h.memoizedState=Wd(u),h.childLanes=Xd(i,R,u),o.memoizedState=Yd,o=nr(null,h));else if(yi(o),Pf(D)){if(R=D.nextSibling&&D.nextSibling.dataset,R)var V=R.dgst;R=V,h=Error(n(419)),h.stack="",h.digest=R,Fo({value:h,source:null,stack:null}),o=Zd(i,o,u)}else if(Ht||$a(i,o,u,!1),R=(u&i.childLanes)!==0,Ht||R){if(R=pt,R!==null&&(h=Lt(R,u),h!==0&&h!==I.retryLane))throw I.retryLane=h,Xi(i,h),bn(R,i,h),Gd;jf(D)||Fc(),o=Zd(i,o,u)}else jf(D)?(o.flags|=192,o.child=i.child,o=null):(i=I.treeContext,wt=Bn(D.nextSibling),en=o,Xe=!0,di=null,Un=!1,i!==null&&Lg(o,i),o=Jd(o,h.children),o.flags|=4096);return o}return v?(vi(),D=h.fallback,v=o.mode,I=i.child,V=I.sibling,h=Os(I,{mode:"hidden",children:h.children}),h.subtreeFlags=I.subtreeFlags&65011712,V!==null?D=Os(V,D):(D=Ji(D,v,u,null),D.flags|=2),D.return=o,h.return=o,h.sibling=D,o.child=h,nr(null,h),h=o.child,D=i.child.memoizedState,D===null?D=Wd(u):(v=D.cachePool,v!==null?(I=It._currentValue,v=v.parent!==I?{parent:I,pool:I}:v):v=$g(),D={baseLanes:D.baseLanes|u,cachePool:v}),h.memoizedState=D,h.childLanes=Xd(i,R,u),o.memoizedState=Yd,nr(i.child,h)):(yi(o),u=i.child,i=u.sibling,u=Os(u,{mode:"visible",children:h.children}),u.return=o,u.sibling=null,i!==null&&(R=o.deletions,R===null?(o.deletions=[i],o.flags|=16):R.push(i)),o.child=u,o.memoizedState=null,u)}function Jd(i,o){return o=zc({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function zc(i,o){return i=Cn(22,i,null,o),i.lanes=0,i}function Zd(i,o,u){return aa(o,i.child,null,u),i=Jd(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function ty(i,o,u){i.lanes|=o;var h=i.alternate;h!==null&&(h.lanes|=o),pd(i.return,o,u)}function ef(i,o,u,h,v,x){var R=i.memoizedState;R===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:u,tailMode:v,treeForkCount:x}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=h,R.tail=u,R.tailMode=v,R.treeForkCount=x)}function ny(i,o,u){var h=o.pendingProps,v=h.revealOrder,x=h.tail;h=h.children;var R=Dt.current,D=(R&2)!==0;if(D?(R=R&1|2,o.flags|=128):R&=1,Y(Dt,R),nn(i,o,h,u),h=Xe?Bo:0,!D&&i!==null&&(i.flags&128)!==0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&ty(i,u,o);else if(i.tag===19)ty(i,u,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(v){case"forwards":for(u=o.child,v=null;u!==null;)i=u.alternate,i!==null&&Mc(i)===null&&(v=u),u=u.sibling;u=v,u===null?(v=o.child,o.child=null):(v=u.sibling,u.sibling=null),ef(o,!1,v,u,x,h);break;case"backwards":case"unstable_legacy-backwards":for(u=null,v=o.child,o.child=null;v!==null;){if(i=v.alternate,i!==null&&Mc(i)===null){o.child=v;break}i=v.sibling,v.sibling=u,u=v,v=i}ef(o,!0,u,null,x,h);break;case"together":ef(o,!1,null,null,void 0,h);break;default:o.memoizedState=null}return o.child}function Fs(i,o,u){if(i!==null&&(o.dependencies=i.dependencies),wi|=o.lanes,(u&o.childLanes)===0)if(i!==null){if($a(i,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(n(153));if(o.child!==null){for(i=o.child,u=Os(i,i.pendingProps),o.child=u,u.return=o;i.sibling!==null;)i=i.sibling,u=u.sibling=Os(i,i.pendingProps),u.return=o;u.sibling=null}return o.child}function tf(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&gc(i)))}function g1(i,o,u){switch(o.tag){case 3:G(o,o.stateNode.containerInfo),hi(o,It,i.memoizedState.cache),Zi();break;case 27:case 5:me(o);break;case 4:G(o,o.stateNode.containerInfo);break;case 10:hi(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Rd(o),null;break;case 13:var h=o.memoizedState;if(h!==null)return h.dehydrated!==null?(yi(o),o.flags|=128,null):(u&o.child.childLanes)!==0?ey(i,o,u):(yi(o),i=Fs(i,o,u),i!==null?i.sibling:null);yi(o);break;case 19:var v=(i.flags&128)!==0;if(h=(u&o.childLanes)!==0,h||($a(i,o,u,!1),h=(u&o.childLanes)!==0),v){if(h)return ny(i,o,u);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),Y(Dt,Dt.current),h)break;return null;case 22:return o.lanes=0,Km(i,o,u,o.pendingProps);case 24:hi(o,It,i.memoizedState.cache)}return Fs(i,o,u)}function sy(i,o,u){if(i!==null)if(i.memoizedProps!==o.pendingProps)Ht=!0;else{if(!tf(i,u)&&(o.flags&128)===0)return Ht=!1,g1(i,o,u);Ht=(i.flags&131072)!==0}else Ht=!1,Xe&&(o.flags&1048576)!==0&&zg(o,Bo,o.index);switch(o.lanes=0,o.tag){case 16:e:{var h=o.pendingProps;if(i=sa(o.elementType),o.type=i,typeof i=="function")od(i)?(h=ra(i,h),o.tag=1,o=Jm(null,o,i,h,u)):(o.tag=0,o=Kd(null,o,i,h,u));else{if(i!=null){var v=i.$$typeof;if(v===A){o.tag=11,o=Qm(null,o,i,h,u);break e}else if(v===L){o.tag=14,o=Vm(null,o,i,h,u);break e}}throw o=le(i)||i,Error(n(306,o,""))}}return o;case 0:return Kd(i,o,o.type,o.pendingProps,u);case 1:return h=o.type,v=ra(h,o.pendingProps),Jm(i,o,h,v,u);case 3:e:{if(G(o,o.stateNode.containerInfo),i===null)throw Error(n(387));h=o.pendingProps;var x=o.memoizedState;v=x.element,wd(i,o),Xo(o,h,null,u);var R=o.memoizedState;if(h=R.cache,hi(o,It,h),h!==x.cache&&gd(o,[It],u,!0),Wo(),h=R.element,x.isDehydrated)if(x={element:h,isDehydrated:!1,cache:R.cache},o.updateQueue.baseState=x,o.memoizedState=x,o.flags&256){o=Zm(i,o,h,u);break e}else if(h!==v){v=On(Error(n(424)),o),Fo(v),o=Zm(i,o,h,u);break e}else{switch(i=o.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(wt=Bn(i.firstChild),en=o,Xe=!0,di=null,Un=!0,u=Kg(o,null,h,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Zi(),h===v){o=Fs(i,o,u);break e}nn(i,o,h,u)}o=o.child}return o;case 26:return Pc(i,o),i===null?(u=p0(o.type,null,o.pendingProps,null))?o.memoizedState=u:Xe||(u=o.type,i=o.pendingProps,h=Xc(ae.current).createElement(u),h[vt]=o,h[$t]=i,sn(h,u,i),Yt(h),o.stateNode=h):o.memoizedState=p0(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return me(o),i===null&&Xe&&(h=o.stateNode=d0(o.type,o.pendingProps,ae.current),en=o,Un=!0,v=wt,Ri(o.type)?(zf=v,wt=Bn(h.firstChild)):wt=v),nn(i,o,o.pendingProps.children,u),Pc(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&Xe&&((v=h=wt)&&(h=Q1(h,o.type,o.pendingProps,Un),h!==null?(o.stateNode=h,en=o,wt=Bn(h.firstChild),Un=!1,v=!0):v=!1),v||fi(o)),me(o),v=o.type,x=o.pendingProps,R=i!==null?i.memoizedProps:null,h=x.children,Df(v,x)?h=null:R!==null&&Df(v,R)&&(o.flags|=32),o.memoizedState!==null&&(v=Td(i,o,o1,null,null,u),yr._currentValue=v),Pc(i,o),nn(i,o,h,u),o.child;case 6:return i===null&&Xe&&((i=u=wt)&&(u=V1(u,o.pendingProps,Un),u!==null?(o.stateNode=u,en=o,wt=null,i=!0):i=!1),i||fi(o)),null;case 13:return ey(i,o,u);case 4:return G(o,o.stateNode.containerInfo),h=o.pendingProps,i===null?o.child=aa(o,null,h,u):nn(i,o,h,u),o.child;case 11:return Qm(i,o,o.type,o.pendingProps,u);case 7:return nn(i,o,o.pendingProps,u),o.child;case 8:return nn(i,o,o.pendingProps.children,u),o.child;case 12:return nn(i,o,o.pendingProps.children,u),o.child;case 10:return h=o.pendingProps,hi(o,o.type,h.value),nn(i,o,h.children,u),o.child;case 9:return v=o.type._context,h=o.pendingProps.children,ta(o),v=tn(v),h=h(v),o.flags|=1,nn(i,o,h,u),o.child;case 14:return Vm(i,o,o.type,o.pendingProps,u);case 15:return Gm(i,o,o.type,o.pendingProps,u);case 19:return ny(i,o,u);case 31:return p1(i,o,u);case 22:return Km(i,o,u,o.pendingProps);case 24:return ta(o),h=tn(It),i===null?(v=vd(),v===null&&(v=pt,x=md(),v.pooledCache=x,x.refCount++,x!==null&&(v.pooledCacheLanes|=u),v=x),o.memoizedState={parent:h,cache:v},xd(o),hi(o,It,v)):((i.lanes&u)!==0&&(wd(i,o),Xo(o,null,null,u),Wo()),v=i.memoizedState,x=o.memoizedState,v.parent!==h?(v={parent:h,cache:h},o.memoizedState=v,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=v),hi(o,It,h)):(h=x.cache,hi(o,It,h),h!==v.cache&&gd(o,[It],u,!0))),nn(i,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(n(156,o.tag))}function Qs(i){i.flags|=4}function nf(i,o,u,h,v){if((o=(i.mode&32)!==0)&&(o=!1),o){if(i.flags|=16777216,(v&335544128)===v)if(i.stateNode.complete)i.flags|=8192;else if(Dy())i.flags|=8192;else throw ia=bc,bd}else i.flags&=-16777217}function iy(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!b0(o))if(Dy())i.flags|=8192;else throw ia=bc,bd}function Lc(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?ee():536870912,i.lanes|=o,eo|=o)}function sr(i,o){if(!Xe)switch(i.tailMode){case"hidden":o=i.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function St(i){var o=i.alternate!==null&&i.alternate.child===i.child,u=0,h=0;if(o)for(var v=i.child;v!==null;)u|=v.lanes|v.childLanes,h|=v.subtreeFlags&65011712,h|=v.flags&65011712,v.return=i,v=v.sibling;else for(v=i.child;v!==null;)u|=v.lanes|v.childLanes,h|=v.subtreeFlags,h|=v.flags,v.return=i,v=v.sibling;return i.subtreeFlags|=h,i.childLanes=u,o}function m1(i,o,u){var h=o.pendingProps;switch(ud(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return St(o),null;case 1:return St(o),null;case 3:return u=o.stateNode,h=null,i!==null&&(h=i.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),Us(It),pe(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(Ua(o)?Qs(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,fd())),St(o),null;case 26:var v=o.type,x=o.memoizedState;return i===null?(Qs(o),x!==null?(St(o),iy(o,x)):(St(o),nf(o,v,null,h,u))):x?x!==i.memoizedState?(Qs(o),St(o),iy(o,x)):(St(o),o.flags&=-16777217):(i=i.memoizedProps,i!==h&&Qs(o),St(o),nf(o,v,i,h,u)),null;case 27:if(ye(o),u=ae.current,v=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==h&&Qs(o);else{if(!h){if(o.stateNode===null)throw Error(n(166));return St(o),null}i=ie.current,Ua(o)?Ig(o):(i=d0(v,h,u),o.stateNode=i,Qs(o))}return St(o),null;case 5:if(ye(o),v=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==h&&Qs(o);else{if(!h){if(o.stateNode===null)throw Error(n(166));return St(o),null}if(x=ie.current,Ua(o))Ig(o);else{var R=Xc(ae.current);switch(x){case 1:x=R.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:x=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":x=R.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":x=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":x=R.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof h.is=="string"?R.createElement("select",{is:h.is}):R.createElement("select"),h.multiple?x.multiple=!0:h.size&&(x.size=h.size);break;default:x=typeof h.is=="string"?R.createElement(v,{is:h.is}):R.createElement(v)}}x[vt]=o,x[$t]=h;e:for(R=o.child;R!==null;){if(R.tag===5||R.tag===6)x.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===o)break e;for(;R.sibling===null;){if(R.return===null||R.return===o)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}o.stateNode=x;e:switch(sn(x,v,h),v){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&Qs(o)}}return St(o),nf(o,o.type,i===null?null:i.memoizedProps,o.pendingProps,u),null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==h&&Qs(o);else{if(typeof h!="string"&&o.stateNode===null)throw Error(n(166));if(i=ae.current,Ua(o)){if(i=o.stateNode,u=o.memoizedProps,h=null,v=en,v!==null)switch(v.tag){case 27:case 5:h=v.memoizedProps}i[vt]=o,i=!!(i.nodeValue===u||h!==null&&h.suppressHydrationWarning===!0||e0(i.nodeValue,u)),i||fi(o,!0)}else i=Xc(i).createTextNode(h),i[vt]=o,o.stateNode=i}return St(o),null;case 31:if(u=o.memoizedState,i===null||i.memoizedState!==null){if(h=Ua(o),u!==null){if(i===null){if(!h)throw Error(n(318));if(i=o.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(557));i[vt]=o}else Zi(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;St(o),i=!1}else u=fd(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=u),i=!0;if(!i)return o.flags&256?(Rn(o),o):(Rn(o),null);if((o.flags&128)!==0)throw Error(n(558))}return St(o),null;case 13:if(h=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(v=Ua(o),h!==null&&h.dehydrated!==null){if(i===null){if(!v)throw Error(n(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(n(317));v[vt]=o}else Zi(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;St(o),v=!1}else v=fd(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=v),v=!0;if(!v)return o.flags&256?(Rn(o),o):(Rn(o),null)}return Rn(o),(o.flags&128)!==0?(o.lanes=u,o):(u=h!==null,i=i!==null&&i.memoizedState!==null,u&&(h=o.child,v=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(v=h.alternate.memoizedState.cachePool.pool),x=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(x=h.memoizedState.cachePool.pool),x!==v&&(h.flags|=2048)),u!==i&&u&&(o.child.flags|=8192),Lc(o,o.updateQueue),St(o),null);case 4:return pe(),i===null&&Ef(o.stateNode.containerInfo),St(o),null;case 10:return Us(o.type),St(o),null;case 19:if(F(Dt),h=o.memoizedState,h===null)return St(o),null;if(v=(o.flags&128)!==0,x=h.rendering,x===null)if(v)sr(h,!1);else{if(Rt!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(x=Mc(i),x!==null){for(o.flags|=128,sr(h,!1),i=x.updateQueue,o.updateQueue=i,Lc(o,i),o.subtreeFlags=0,i=u,u=o.child;u!==null;)Ng(u,i),u=u.sibling;return Y(Dt,Dt.current&1|2),Xe&&Hs(o,h.treeForkCount),o.child}i=i.sibling}h.tail!==null&&Ze()>Uc&&(o.flags|=128,v=!0,sr(h,!1),o.lanes=4194304)}else{if(!v)if(i=Mc(x),i!==null){if(o.flags|=128,v=!0,i=i.updateQueue,o.updateQueue=i,Lc(o,i),sr(h,!0),h.tail===null&&h.tailMode==="hidden"&&!x.alternate&&!Xe)return St(o),null}else 2*Ze()-h.renderingStartTime>Uc&&u!==536870912&&(o.flags|=128,v=!0,sr(h,!1),o.lanes=4194304);h.isBackwards?(x.sibling=o.child,o.child=x):(i=h.last,i!==null?i.sibling=x:o.child=x,h.last=x)}return h.tail!==null?(i=h.tail,h.rendering=i,h.tail=i.sibling,h.renderingStartTime=Ze(),i.sibling=null,u=Dt.current,Y(Dt,v?u&1|2:u&1),Xe&&Hs(o,h.treeForkCount),i):(St(o),null);case 22:case 23:return Rn(o),Ed(),h=o.memoizedState!==null,i!==null?i.memoizedState!==null!==h&&(o.flags|=8192):h&&(o.flags|=8192),h?(u&536870912)!==0&&(o.flags&128)===0&&(St(o),o.subtreeFlags&6&&(o.flags|=8192)):St(o),u=o.updateQueue,u!==null&&Lc(o,u.retryQueue),u=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==u&&(o.flags|=2048),i!==null&&F(na),null;case 24:return u=null,i!==null&&(u=i.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Us(It),St(o),null;case 25:return null;case 30:return null}throw Error(n(156,o.tag))}function y1(i,o){switch(ud(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Us(It),pe(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return ye(o),null;case 31:if(o.memoizedState!==null){if(Rn(o),o.alternate===null)throw Error(n(340));Zi()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 13:if(Rn(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(n(340));Zi()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return F(Dt),null;case 4:return pe(),null;case 10:return Us(o.type),null;case 22:case 23:return Rn(o),Ed(),i!==null&&F(na),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return Us(It),null;case 25:return null;default:return null}}function ay(i,o){switch(ud(o),o.tag){case 3:Us(It),pe();break;case 26:case 27:case 5:ye(o);break;case 4:pe();break;case 31:o.memoizedState!==null&&Rn(o);break;case 13:Rn(o);break;case 19:F(Dt);break;case 10:Us(o.type);break;case 22:case 23:Rn(o),Ed(),i!==null&&F(na);break;case 24:Us(It)}}function ir(i,o){try{var u=o.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var v=h.next;u=v;do{if((u.tag&i)===i){h=void 0;var x=u.create,R=u.inst;h=x(),R.destroy=h}u=u.next}while(u!==v)}}catch(D){rt(o,o.return,D)}}function bi(i,o,u){try{var h=o.updateQueue,v=h!==null?h.lastEffect:null;if(v!==null){var x=v.next;h=x;do{if((h.tag&i)===i){var R=h.inst,D=R.destroy;if(D!==void 0){R.destroy=void 0,v=o;var I=u,V=D;try{V()}catch(ne){rt(v,I,ne)}}}h=h.next}while(h!==x)}}catch(ne){rt(o,o.return,ne)}}function oy(i){var o=i.updateQueue;if(o!==null){var u=i.stateNode;try{Wg(o,u)}catch(h){rt(i,i.return,h)}}}function ry(i,o,u){u.props=ra(i.type,i.memoizedProps),u.state=i.memoizedState;try{u.componentWillUnmount()}catch(h){rt(i,o,h)}}function ar(i,o){try{var u=i.ref;if(u!==null){switch(i.tag){case 26:case 27:case 5:var h=i.stateNode;break;case 30:h=i.stateNode;break;default:h=i.stateNode}typeof u=="function"?i.refCleanup=u(h):u.current=h}}catch(v){rt(i,o,v)}}function ms(i,o){var u=i.ref,h=i.refCleanup;if(u!==null)if(typeof h=="function")try{h()}catch(v){rt(i,o,v)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(v){rt(i,o,v)}else u.current=null}function cy(i){var o=i.type,u=i.memoizedProps,h=i.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&h.focus();break e;case"img":u.src?h.src=u.src:u.srcSet&&(h.srcset=u.srcSet)}}catch(v){rt(i,i.return,v)}}function sf(i,o,u){try{var h=i.stateNode;H1(h,i.type,u,o),h[$t]=o}catch(v){rt(i,i.return,v)}}function ly(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Ri(i.type)||i.tag===4}function af(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||ly(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Ri(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function of(i,o,u){var h=i.tag;if(h===5||h===6)i=i.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(i,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(i),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Ls));else if(h!==4&&(h===27&&Ri(i.type)&&(u=i.stateNode,o=null),i=i.child,i!==null))for(of(i,o,u),i=i.sibling;i!==null;)of(i,o,u),i=i.sibling}function Ic(i,o,u){var h=i.tag;if(h===5||h===6)i=i.stateNode,o?u.insertBefore(i,o):u.appendChild(i);else if(h!==4&&(h===27&&Ri(i.type)&&(u=i.stateNode),i=i.child,i!==null))for(Ic(i,o,u),i=i.sibling;i!==null;)Ic(i,o,u),i=i.sibling}function uy(i){var o=i.stateNode,u=i.memoizedProps;try{for(var h=i.type,v=o.attributes;v.length;)o.removeAttributeNode(v[0]);sn(o,h,u),o[vt]=i,o[$t]=u}catch(x){rt(i,i.return,x)}}var Vs=!1,qt=!1,rf=!1,dy=typeof WeakSet=="function"?WeakSet:Set,Wt=null;function v1(i,o){if(i=i.containerInfo,Tf=il,i=Mg(i),Zu(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var h=u.getSelection&&u.getSelection();if(h&&h.rangeCount!==0){u=h.anchorNode;var v=h.anchorOffset,x=h.focusNode;h=h.focusOffset;try{u.nodeType,x.nodeType}catch{u=null;break e}var R=0,D=-1,I=-1,V=0,ne=0,re=i,K=null;t:for(;;){for(var X;re!==u||v!==0&&re.nodeType!==3||(D=R+v),re!==x||h!==0&&re.nodeType!==3||(I=R+h),re.nodeType===3&&(R+=re.nodeValue.length),(X=re.firstChild)!==null;)K=re,re=X;for(;;){if(re===i)break t;if(K===u&&++V===v&&(D=R),K===x&&++ne===h&&(I=R),(X=re.nextSibling)!==null)break;re=K,K=re.parentNode}re=X}u=D===-1||I===-1?null:{start:D,end:I}}else u=null}u=u||{start:0,end:0}}else u=null;for(Af={focusedElem:i,selectionRange:u},il=!1,Wt=o;Wt!==null;)if(o=Wt,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,Wt=i;else for(;Wt!==null;){switch(o=Wt,x=o.alternate,i=o.flags,o.tag){case 0:if((i&4)!==0&&(i=o.updateQueue,i=i!==null?i.events:null,i!==null))for(u=0;u<i.length;u++)v=i[u],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&x!==null){i=void 0,u=o,v=x.memoizedProps,x=x.memoizedState,h=u.stateNode;try{var xe=ra(u.type,v);i=h.getSnapshotBeforeUpdate(xe,x),h.__reactInternalSnapshotBeforeUpdate=i}catch(Ne){rt(u,u.return,Ne)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,u=i.nodeType,u===9)Nf(i);else if(u===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Nf(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(n(163))}if(i=o.sibling,i!==null){i.return=o.return,Wt=i;break}Wt=o.return}}function fy(i,o,u){var h=u.flags;switch(u.tag){case 0:case 11:case 15:Ks(i,u),h&4&&ir(5,u);break;case 1:if(Ks(i,u),h&4)if(i=u.stateNode,o===null)try{i.componentDidMount()}catch(R){rt(u,u.return,R)}else{var v=ra(u.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(v,o,i.__reactInternalSnapshotBeforeUpdate)}catch(R){rt(u,u.return,R)}}h&64&&oy(u),h&512&&ar(u,u.return);break;case 3:if(Ks(i,u),h&64&&(i=u.updateQueue,i!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{Wg(i,o)}catch(R){rt(u,u.return,R)}}break;case 27:o===null&&h&4&&uy(u);case 26:case 5:Ks(i,u),o===null&&h&4&&cy(u),h&512&&ar(u,u.return);break;case 12:Ks(i,u);break;case 31:Ks(i,u),h&4&&gy(i,u);break;case 13:Ks(i,u),h&4&&my(i,u),h&64&&(i=u.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(u=k1.bind(null,u),G1(i,u))));break;case 22:if(h=u.memoizedState!==null||Vs,!h){o=o!==null&&o.memoizedState!==null||qt,v=Vs;var x=qt;Vs=h,(qt=o)&&!x?Ys(i,u,(u.subtreeFlags&8772)!==0):Ks(i,u),Vs=v,qt=x}break;case 30:break;default:Ks(i,u)}}function hy(i){var o=i.alternate;o!==null&&(i.alternate=null,hy(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&Lu(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Ct=null,gn=!1;function Gs(i,o,u){for(u=u.child;u!==null;)py(i,o,u),u=u.sibling}function py(i,o,u){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(fs,u)}catch{}switch(u.tag){case 26:qt||ms(u,o),Gs(i,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:qt||ms(u,o);var h=Ct,v=gn;Ri(u.type)&&(Ct=u.stateNode,gn=!1),Gs(i,o,u),pr(u.stateNode),Ct=h,gn=v;break;case 5:qt||ms(u,o);case 6:if(h=Ct,v=gn,Ct=null,Gs(i,o,u),Ct=h,gn=v,Ct!==null)if(gn)try{(Ct.nodeType===9?Ct.body:Ct.nodeName==="HTML"?Ct.ownerDocument.body:Ct).removeChild(u.stateNode)}catch(x){rt(u,o,x)}else try{Ct.removeChild(u.stateNode)}catch(x){rt(u,o,x)}break;case 18:Ct!==null&&(gn?(i=Ct,o0(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,u.stateNode),co(i)):o0(Ct,u.stateNode));break;case 4:h=Ct,v=gn,Ct=u.stateNode.containerInfo,gn=!0,Gs(i,o,u),Ct=h,gn=v;break;case 0:case 11:case 14:case 15:bi(2,u,o),qt||bi(4,u,o),Gs(i,o,u);break;case 1:qt||(ms(u,o),h=u.stateNode,typeof h.componentWillUnmount=="function"&&ry(u,o,h)),Gs(i,o,u);break;case 21:Gs(i,o,u);break;case 22:qt=(h=qt)||u.memoizedState!==null,Gs(i,o,u),qt=h;break;default:Gs(i,o,u)}}function gy(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{co(i)}catch(u){rt(o,o.return,u)}}}function my(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{co(i)}catch(u){rt(o,o.return,u)}}function b1(i){switch(i.tag){case 31:case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new dy),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new dy),o;default:throw Error(n(435,i.tag))}}function Oc(i,o){var u=b1(i);o.forEach(function(h){if(!u.has(h)){u.add(h);var v=T1.bind(null,i,h);h.then(v,v)}})}function mn(i,o){var u=o.deletions;if(u!==null)for(var h=0;h<u.length;h++){var v=u[h],x=i,R=o,D=R;e:for(;D!==null;){switch(D.tag){case 27:if(Ri(D.type)){Ct=D.stateNode,gn=!1;break e}break;case 5:Ct=D.stateNode,gn=!1;break e;case 3:case 4:Ct=D.stateNode.containerInfo,gn=!0;break e}D=D.return}if(Ct===null)throw Error(n(160));py(x,R,v),Ct=null,gn=!1,x=v.alternate,x!==null&&(x.return=null),v.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)yy(o,i),o=o.sibling}var es=null;function yy(i,o){var u=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:mn(o,i),yn(i),h&4&&(bi(3,i,i.return),ir(3,i),bi(5,i,i.return));break;case 1:mn(o,i),yn(i),h&512&&(qt||u===null||ms(u,u.return)),h&64&&Vs&&(i=i.updateQueue,i!==null&&(h=i.callbacks,h!==null&&(u=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=u===null?h:u.concat(h))));break;case 26:var v=es;if(mn(o,i),yn(i),h&512&&(qt||u===null||ms(u,u.return)),h&4){var x=u!==null?u.memoizedState:null;if(h=i.memoizedState,u===null)if(h===null)if(i.stateNode===null){e:{h=i.type,u=i.memoizedProps,v=v.ownerDocument||v;t:switch(h){case"title":x=v.getElementsByTagName("title")[0],(!x||x[No]||x[vt]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=v.createElement(h),v.head.insertBefore(x,v.querySelector("head > title"))),sn(x,h,u),x[vt]=i,Yt(x),h=x;break e;case"link":var R=y0("link","href",v).get(h+(u.href||""));if(R){for(var D=0;D<R.length;D++)if(x=R[D],x.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&x.getAttribute("rel")===(u.rel==null?null:u.rel)&&x.getAttribute("title")===(u.title==null?null:u.title)&&x.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){R.splice(D,1);break t}}x=v.createElement(h),sn(x,h,u),v.head.appendChild(x);break;case"meta":if(R=y0("meta","content",v).get(h+(u.content||""))){for(D=0;D<R.length;D++)if(x=R[D],x.getAttribute("content")===(u.content==null?null:""+u.content)&&x.getAttribute("name")===(u.name==null?null:u.name)&&x.getAttribute("property")===(u.property==null?null:u.property)&&x.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&x.getAttribute("charset")===(u.charSet==null?null:u.charSet)){R.splice(D,1);break t}}x=v.createElement(h),sn(x,h,u),v.head.appendChild(x);break;default:throw Error(n(468,h))}x[vt]=i,Yt(x),h=x}i.stateNode=h}else v0(v,i.type,i.stateNode);else i.stateNode=m0(v,h,i.memoizedProps);else x!==h?(x===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):x.count--,h===null?v0(v,i.type,i.stateNode):m0(v,h,i.memoizedProps)):h===null&&i.stateNode!==null&&sf(i,i.memoizedProps,u.memoizedProps)}break;case 27:mn(o,i),yn(i),h&512&&(qt||u===null||ms(u,u.return)),u!==null&&h&4&&sf(i,i.memoizedProps,u.memoizedProps);break;case 5:if(mn(o,i),yn(i),h&512&&(qt||u===null||ms(u,u.return)),i.flags&32){v=i.stateNode;try{_a(v,"")}catch(xe){rt(i,i.return,xe)}}h&4&&i.stateNode!=null&&(v=i.memoizedProps,sf(i,v,u!==null?u.memoizedProps:v)),h&1024&&(rf=!0);break;case 6:if(mn(o,i),yn(i),h&4){if(i.stateNode===null)throw Error(n(162));h=i.memoizedProps,u=i.stateNode;try{u.nodeValue=h}catch(xe){rt(i,i.return,xe)}}break;case 3:if(el=null,v=es,es=Jc(o.containerInfo),mn(o,i),es=v,yn(i),h&4&&u!==null&&u.memoizedState.isDehydrated)try{co(o.containerInfo)}catch(xe){rt(i,i.return,xe)}rf&&(rf=!1,vy(i));break;case 4:h=es,es=Jc(i.stateNode.containerInfo),mn(o,i),yn(i),es=h;break;case 12:mn(o,i),yn(i);break;case 31:mn(o,i),yn(i),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,Oc(i,h)));break;case 13:mn(o,i),yn(i),i.child.flags&8192&&i.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(qc=Ze()),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,Oc(i,h)));break;case 22:v=i.memoizedState!==null;var I=u!==null&&u.memoizedState!==null,V=Vs,ne=qt;if(Vs=V||v,qt=ne||I,mn(o,i),qt=ne,Vs=V,yn(i),h&8192)e:for(o=i.stateNode,o._visibility=v?o._visibility&-2:o._visibility|1,v&&(u===null||I||Vs||qt||ca(i)),u=null,o=i;;){if(o.tag===5||o.tag===26){if(u===null){I=u=o;try{if(x=I.stateNode,v)R=x.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{D=I.stateNode;var re=I.memoizedProps.style,K=re!=null&&re.hasOwnProperty("display")?re.display:null;D.style.display=K==null||typeof K=="boolean"?"":(""+K).trim()}}catch(xe){rt(I,I.return,xe)}}}else if(o.tag===6){if(u===null){I=o;try{I.stateNode.nodeValue=v?"":I.memoizedProps}catch(xe){rt(I,I.return,xe)}}}else if(o.tag===18){if(u===null){I=o;try{var X=I.stateNode;v?r0(X,!0):r0(I.stateNode,!1)}catch(xe){rt(I,I.return,xe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break e;for(;o.sibling===null;){if(o.return===null||o.return===i)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}h&4&&(h=i.updateQueue,h!==null&&(u=h.retryQueue,u!==null&&(h.retryQueue=null,Oc(i,u))));break;case 19:mn(o,i),yn(i),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,Oc(i,h)));break;case 30:break;case 21:break;default:mn(o,i),yn(i)}}function yn(i){var o=i.flags;if(o&2){try{for(var u,h=i.return;h!==null;){if(ly(h)){u=h;break}h=h.return}if(u==null)throw Error(n(160));switch(u.tag){case 27:var v=u.stateNode,x=af(i);Ic(i,x,v);break;case 5:var R=u.stateNode;u.flags&32&&(_a(R,""),u.flags&=-33);var D=af(i);Ic(i,D,R);break;case 3:case 4:var I=u.stateNode.containerInfo,V=af(i);of(i,V,I);break;default:throw Error(n(161))}}catch(ne){rt(i,i.return,ne)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function vy(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;vy(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function Ks(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)fy(i,o.alternate,o),o=o.sibling}function ca(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:bi(4,o,o.return),ca(o);break;case 1:ms(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&ry(o,o.return,u),ca(o);break;case 27:pr(o.stateNode);case 26:case 5:ms(o,o.return),ca(o);break;case 22:o.memoizedState===null&&ca(o);break;case 30:ca(o);break;default:ca(o)}i=i.sibling}}function Ys(i,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var h=o.alternate,v=i,x=o,R=x.flags;switch(x.tag){case 0:case 11:case 15:Ys(v,x,u),ir(4,x);break;case 1:if(Ys(v,x,u),h=x,v=h.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(V){rt(h,h.return,V)}if(h=x,v=h.updateQueue,v!==null){var D=h.stateNode;try{var I=v.shared.hiddenCallbacks;if(I!==null)for(v.shared.hiddenCallbacks=null,v=0;v<I.length;v++)Yg(I[v],D)}catch(V){rt(h,h.return,V)}}u&&R&64&&oy(x),ar(x,x.return);break;case 27:uy(x);case 26:case 5:Ys(v,x,u),u&&h===null&&R&4&&cy(x),ar(x,x.return);break;case 12:Ys(v,x,u);break;case 31:Ys(v,x,u),u&&R&4&&gy(v,x);break;case 13:Ys(v,x,u),u&&R&4&&my(v,x);break;case 22:x.memoizedState===null&&Ys(v,x,u),ar(x,x.return);break;case 30:break;default:Ys(v,x,u)}o=o.sibling}}function cf(i,o){var u=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==u&&(i!=null&&i.refCount++,u!=null&&Qo(u))}function lf(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Qo(i))}function ts(i,o,u,h){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)by(i,o,u,h),o=o.sibling}function by(i,o,u,h){var v=o.flags;switch(o.tag){case 0:case 11:case 15:ts(i,o,u,h),v&2048&&ir(9,o);break;case 1:ts(i,o,u,h);break;case 3:ts(i,o,u,h),v&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Qo(i)));break;case 12:if(v&2048){ts(i,o,u,h),i=o.stateNode;try{var x=o.memoizedProps,R=x.id,D=x.onPostCommit;typeof D=="function"&&D(R,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(I){rt(o,o.return,I)}}else ts(i,o,u,h);break;case 31:ts(i,o,u,h);break;case 13:ts(i,o,u,h);break;case 23:break;case 22:x=o.stateNode,R=o.alternate,o.memoizedState!==null?x._visibility&2?ts(i,o,u,h):or(i,o):x._visibility&2?ts(i,o,u,h):(x._visibility|=2,Xa(i,o,u,h,(o.subtreeFlags&10256)!==0||!1)),v&2048&&cf(R,o);break;case 24:ts(i,o,u,h),v&2048&&lf(o.alternate,o);break;default:ts(i,o,u,h)}}function Xa(i,o,u,h,v){for(v=v&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var x=i,R=o,D=u,I=h,V=R.flags;switch(R.tag){case 0:case 11:case 15:Xa(x,R,D,I,v),ir(8,R);break;case 23:break;case 22:var ne=R.stateNode;R.memoizedState!==null?ne._visibility&2?Xa(x,R,D,I,v):or(x,R):(ne._visibility|=2,Xa(x,R,D,I,v)),v&&V&2048&&cf(R.alternate,R);break;case 24:Xa(x,R,D,I,v),v&&V&2048&&lf(R.alternate,R);break;default:Xa(x,R,D,I,v)}o=o.sibling}}function or(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=i,h=o,v=h.flags;switch(h.tag){case 22:or(u,h),v&2048&&cf(h.alternate,h);break;case 24:or(u,h),v&2048&&lf(h.alternate,h);break;default:or(u,h)}o=o.sibling}}var rr=8192;function Ja(i,o,u){if(i.subtreeFlags&rr)for(i=i.child;i!==null;)xy(i,o,u),i=i.sibling}function xy(i,o,u){switch(i.tag){case 26:Ja(i,o,u),i.flags&rr&&i.memoizedState!==null&&aE(u,es,i.memoizedState,i.memoizedProps);break;case 5:Ja(i,o,u);break;case 3:case 4:var h=es;es=Jc(i.stateNode.containerInfo),Ja(i,o,u),es=h;break;case 22:i.memoizedState===null&&(h=i.alternate,h!==null&&h.memoizedState!==null?(h=rr,rr=16777216,Ja(i,o,u),rr=h):Ja(i,o,u));break;default:Ja(i,o,u)}}function wy(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function cr(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var h=o[u];Wt=h,My(h,i)}wy(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Sy(i),i=i.sibling}function Sy(i){switch(i.tag){case 0:case 11:case 15:cr(i),i.flags&2048&&bi(9,i,i.return);break;case 3:cr(i);break;case 12:cr(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,Hc(i)):cr(i);break;default:cr(i)}}function Hc(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var h=o[u];Wt=h,My(h,i)}wy(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:bi(8,o,o.return),Hc(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Hc(o));break;default:Hc(o)}i=i.sibling}}function My(i,o){for(;Wt!==null;){var u=Wt;switch(u.tag){case 0:case 11:case 15:bi(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var h=u.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Qo(u.memoizedState.cache)}if(h=u.child,h!==null)h.return=u,Wt=h;else e:for(u=i;Wt!==null;){h=Wt;var v=h.sibling,x=h.return;if(hy(h),h===u){Wt=null;break e}if(v!==null){v.return=x,Wt=v;break e}Wt=x}}}var x1={getCacheForType:function(i){var o=tn(It),u=o.data.get(i);return u===void 0&&(u=i(),o.data.set(i,u)),u},cacheSignal:function(){return tn(It).controller.signal}},w1=typeof WeakMap=="function"?WeakMap:Map,nt=0,pt=null,Qe=null,Ge=0,ot=0,kn=null,xi=!1,Za=!1,uf=!1,Ws=0,Rt=0,wi=0,la=0,df=0,Tn=0,eo=0,lr=null,vn=null,ff=!1,qc=0,Cy=0,Uc=1/0,$c=null,Si=null,Bt=0,Mi=null,to=null,Xs=0,hf=0,pf=null,Ey=null,ur=0,gf=null;function An(){return(nt&2)!==0&&Ge!==0?Ge&-Ge:z.T!==null?wf():un()}function Ry(){if(Tn===0)if((Ge&536870912)===0||Xe){var i=Qi;Qi<<=1,(Qi&3932160)===0&&(Qi=262144),Tn=i}else Tn=536870912;return i=En.current,i!==null&&(i.flags|=32),Tn}function bn(i,o,u){(i===pt&&(ot===2||ot===9)||i.cancelPendingCommit!==null)&&(no(i,0),Ci(i,Ge,Tn,!1)),be(i,u),((nt&2)===0||i!==pt)&&(i===pt&&((nt&2)===0&&(la|=u),Rt===4&&Ci(i,Ge,Tn,!1)),ys(i))}function ky(i,o,u){if((nt&6)!==0)throw Error(n(327));var h=!u&&(o&127)===0&&(o&i.expiredLanes)===0||Ps(i,o),v=h?C1(i,o):yf(i,o,!0),x=h;do{if(v===0){Za&&!h&&Ci(i,o,0,!1);break}else{if(u=i.current.alternate,x&&!S1(u)){v=yf(i,o,!1),x=!1;continue}if(v===2){if(x=o,i.errorRecoveryDisabledLanes&x)var R=0;else R=i.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){o=R;e:{var D=i;v=lr;var I=D.current.memoizedState.isDehydrated;if(I&&(no(D,R).flags|=256),R=yf(D,R,!1),R!==2){if(uf&&!I){D.errorRecoveryDisabledLanes|=x,la|=x,v=4;break e}x=vn,vn=v,x!==null&&(vn===null?vn=x:vn.push.apply(vn,x))}v=R}if(x=!1,v!==2)continue}}if(v===1){no(i,0),Ci(i,o,0,!0);break}e:{switch(h=i,x=v,x){case 0:case 1:throw Error(n(345));case 4:if((o&4194048)!==o)break;case 6:Ci(h,o,Tn,!xi);break e;case 2:vn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((o&62914560)===o&&(v=qc+300-Ze(),10<v)){if(Ci(h,o,Tn,!xi),js(h,0,!0)!==0)break e;Xs=o,h.timeoutHandle=i0(Ty.bind(null,h,u,vn,$c,ff,o,Tn,la,eo,xi,x,"Throttled",-0,0),v);break e}Ty(h,u,vn,$c,ff,o,Tn,la,eo,xi,x,null,-0,0)}}break}while(!0);ys(i)}function Ty(i,o,u,h,v,x,R,D,I,V,ne,re,K,X){if(i.timeoutHandle=-1,re=o.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ls},xy(o,x,re);var xe=(x&62914560)===x?qc-Ze():(x&4194048)===x?Cy-Ze():0;if(xe=oE(re,xe),xe!==null){Xs=x,i.cancelPendingCommit=xe(Ly.bind(null,i,o,x,u,h,v,R,D,I,ne,re,null,K,X)),Ci(i,x,R,!V);return}}Ly(i,o,x,u,h,v,R,D,I)}function S1(i){for(var o=i;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var h=0;h<u.length;h++){var v=u[h],x=v.getSnapshot;v=v.value;try{if(!Mn(x(),v))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ci(i,o,u,h){o&=~df,o&=~la,i.suspendedLanes|=o,i.pingedLanes&=~o,h&&(i.warmLanes|=o),h=i.expirationTimes;for(var v=o;0<v;){var x=31-zt(v),R=1<<x;h[x]=-1,v&=~R}u!==0&&Ie(i,u,o)}function Bc(){return(nt&6)===0?(dr(0),!1):!0}function mf(){if(Qe!==null){if(ot===0)var i=Qe.return;else i=Qe,qs=ea=null,_d(i),Va=null,Go=0,i=Qe;for(;i!==null;)ay(i.alternate,i),i=i.return;Qe=null}}function no(i,o){var u=i.timeoutHandle;u!==-1&&(i.timeoutHandle=-1,$1(u)),u=i.cancelPendingCommit,u!==null&&(i.cancelPendingCommit=null,u()),Xs=0,mf(),pt=i,Qe=u=Os(i.current,null),Ge=o,ot=0,kn=null,xi=!1,Za=Ps(i,o),uf=!1,eo=Tn=df=la=wi=Rt=0,vn=lr=null,ff=!1,(o&8)!==0&&(o|=o&32);var h=i.entangledLanes;if(h!==0)for(i=i.entanglements,h&=o;0<h;){var v=31-zt(h),x=1<<v;o|=i[v],h&=~x}return Ws=o,uc(),u}function Ay(i,o){Oe=null,z.H=tr,o===Qa||o===vc?(o=Qg(),ot=3):o===bd?(o=Qg(),ot=4):ot=o===Gd?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,kn=o,Qe===null&&(Rt=1,Nc(i,On(o,i.current)))}function Dy(){var i=En.current;return i===null?!0:(Ge&4194048)===Ge?$n===null:(Ge&62914560)===Ge||(Ge&536870912)!==0?i===$n:!1}function _y(){var i=z.H;return z.H=tr,i===null?tr:i}function Ny(){var i=z.A;return z.A=x1,i}function Fc(){Rt=4,xi||(Ge&4194048)!==Ge&&En.current!==null||(Za=!0),(wi&134217727)===0&&(la&134217727)===0||pt===null||Ci(pt,Ge,Tn,!1)}function yf(i,o,u){var h=nt;nt|=2;var v=_y(),x=Ny();(pt!==i||Ge!==o)&&($c=null,no(i,o)),o=!1;var R=Rt;e:do try{if(ot!==0&&Qe!==null){var D=Qe,I=kn;switch(ot){case 8:mf(),R=6;break e;case 3:case 2:case 9:case 6:En.current===null&&(o=!0);var V=ot;if(ot=0,kn=null,so(i,D,I,V),u&&Za){R=0;break e}break;default:V=ot,ot=0,kn=null,so(i,D,I,V)}}M1(),R=Rt;break}catch(ne){Ay(i,ne)}while(!0);return o&&i.shellSuspendCounter++,qs=ea=null,nt=h,z.H=v,z.A=x,Qe===null&&(pt=null,Ge=0,uc()),R}function M1(){for(;Qe!==null;)jy(Qe)}function C1(i,o){var u=nt;nt|=2;var h=_y(),v=Ny();pt!==i||Ge!==o?($c=null,Uc=Ze()+500,no(i,o)):Za=Ps(i,o);e:do try{if(ot!==0&&Qe!==null){o=Qe;var x=kn;t:switch(ot){case 1:ot=0,kn=null,so(i,o,x,1);break;case 2:case 9:if(Bg(x)){ot=0,kn=null,Py(o);break}o=function(){ot!==2&&ot!==9||pt!==i||(ot=7),ys(i)},x.then(o,o);break e;case 3:ot=7;break e;case 4:ot=5;break e;case 7:Bg(x)?(ot=0,kn=null,Py(o)):(ot=0,kn=null,so(i,o,x,7));break;case 5:var R=null;switch(Qe.tag){case 26:R=Qe.memoizedState;case 5:case 27:var D=Qe;if(R?b0(R):D.stateNode.complete){ot=0,kn=null;var I=D.sibling;if(I!==null)Qe=I;else{var V=D.return;V!==null?(Qe=V,Qc(V)):Qe=null}break t}}ot=0,kn=null,so(i,o,x,5);break;case 6:ot=0,kn=null,so(i,o,x,6);break;case 8:mf(),Rt=6;break e;default:throw Error(n(462))}}E1();break}catch(ne){Ay(i,ne)}while(!0);return qs=ea=null,z.H=h,z.A=v,nt=u,Qe!==null?0:(pt=null,Ge=0,uc(),Rt)}function E1(){for(;Qe!==null&&!mt();)jy(Qe)}function jy(i){var o=sy(i.alternate,i,Ws);i.memoizedProps=i.pendingProps,o===null?Qc(i):Qe=o}function Py(i){var o=i,u=o.alternate;switch(o.tag){case 15:case 0:o=Xm(u,o,o.pendingProps,o.type,void 0,Ge);break;case 11:o=Xm(u,o,o.pendingProps,o.type.render,o.ref,Ge);break;case 5:_d(o);default:ay(u,o),o=Qe=Ng(o,Ws),o=sy(u,o,Ws)}i.memoizedProps=i.pendingProps,o===null?Qc(i):Qe=o}function so(i,o,u,h){qs=ea=null,_d(o),Va=null,Go=0;var v=o.return;try{if(h1(i,v,o,u,Ge)){Rt=1,Nc(i,On(u,i.current)),Qe=null;return}}catch(x){if(v!==null)throw Qe=v,x;Rt=1,Nc(i,On(u,i.current)),Qe=null;return}o.flags&32768?(Xe||h===1?i=!0:Za||(Ge&536870912)!==0?i=!1:(xi=i=!0,(h===2||h===9||h===3||h===6)&&(h=En.current,h!==null&&h.tag===13&&(h.flags|=16384))),zy(o,i)):Qc(o)}function Qc(i){var o=i;do{if((o.flags&32768)!==0){zy(o,xi);return}i=o.return;var u=m1(o.alternate,o,Ws);if(u!==null){Qe=u;return}if(o=o.sibling,o!==null){Qe=o;return}Qe=o=i}while(o!==null);Rt===0&&(Rt=5)}function zy(i,o){do{var u=y1(i.alternate,i);if(u!==null){u.flags&=32767,Qe=u;return}if(u=i.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(i=i.sibling,i!==null)){Qe=i;return}Qe=i=u}while(i!==null);Rt=6,Qe=null}function Ly(i,o,u,h,v,x,R,D,I){i.cancelPendingCommit=null;do Vc();while(Bt!==0);if((nt&6)!==0)throw Error(n(327));if(o!==null){if(o===i.current)throw Error(n(177));if(x=o.lanes|o.childLanes,x|=id,ze(i,u,x,R,D,I),i===pt&&(Qe=pt=null,Ge=0),to=o,Mi=i,Xs=u,hf=x,pf=v,Ey=h,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,A1(Xt,function(){return Uy(),null})):(i.callbackNode=null,i.callbackPriority=0),h=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||h){h=z.T,z.T=null,v=j.p,j.p=2,R=nt,nt|=4;try{v1(i,o,u)}finally{nt=R,j.p=v,z.T=h}}Bt=1,Iy(),Oy(),Hy()}}function Iy(){if(Bt===1){Bt=0;var i=Mi,o=to,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=z.T,z.T=null;var h=j.p;j.p=2;var v=nt;nt|=4;try{yy(o,i);var x=Af,R=Mg(i.containerInfo),D=x.focusedElem,I=x.selectionRange;if(R!==D&&D&&D.ownerDocument&&Sg(D.ownerDocument.documentElement,D)){if(I!==null&&Zu(D)){var V=I.start,ne=I.end;if(ne===void 0&&(ne=V),"selectionStart"in D)D.selectionStart=V,D.selectionEnd=Math.min(ne,D.value.length);else{var re=D.ownerDocument||document,K=re&&re.defaultView||window;if(K.getSelection){var X=K.getSelection(),xe=D.textContent.length,Ne=Math.min(I.start,xe),ft=I.end===void 0?Ne:Math.min(I.end,xe);!X.extend&&Ne>ft&&(R=ft,ft=Ne,Ne=R);var U=wg(D,Ne),H=wg(D,ft);if(U&&H&&(X.rangeCount!==1||X.anchorNode!==U.node||X.anchorOffset!==U.offset||X.focusNode!==H.node||X.focusOffset!==H.offset)){var Q=re.createRange();Q.setStart(U.node,U.offset),X.removeAllRanges(),Ne>ft?(X.addRange(Q),X.extend(H.node,H.offset)):(Q.setEnd(H.node,H.offset),X.addRange(Q))}}}}for(re=[],X=D;X=X.parentNode;)X.nodeType===1&&re.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<re.length;D++){var oe=re[D];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}il=!!Tf,Af=Tf=null}finally{nt=v,j.p=h,z.T=u}}i.current=o,Bt=2}}function Oy(){if(Bt===2){Bt=0;var i=Mi,o=to,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=z.T,z.T=null;var h=j.p;j.p=2;var v=nt;nt|=4;try{fy(i,o.alternate,o)}finally{nt=v,j.p=h,z.T=u}}Bt=3}}function Hy(){if(Bt===4||Bt===3){Bt=0,Ut();var i=Mi,o=to,u=Xs,h=Ey;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Bt=5:(Bt=0,to=Mi=null,qy(i,i.pendingLanes));var v=i.pendingLanes;if(v===0&&(Si=null),At(u),o=o.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(fs,o,void 0,(o.current.flags&128)===128)}catch{}if(h!==null){o=z.T,v=j.p,j.p=2,z.T=null;try{for(var x=i.onRecoverableError,R=0;R<h.length;R++){var D=h[R];x(D.value,{componentStack:D.stack})}}finally{z.T=o,j.p=v}}(Xs&3)!==0&&Vc(),ys(i),v=i.pendingLanes,(u&261930)!==0&&(v&42)!==0?i===gf?ur++:(ur=0,gf=i):ur=0,dr(0)}}function qy(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,Qo(o)))}function Vc(){return Iy(),Oy(),Hy(),Uy()}function Uy(){if(Bt!==5)return!1;var i=Mi,o=hf;hf=0;var u=At(Xs),h=z.T,v=j.p;try{j.p=32>u?32:u,z.T=null,u=pf,pf=null;var x=Mi,R=Xs;if(Bt=0,to=Mi=null,Xs=0,(nt&6)!==0)throw Error(n(331));var D=nt;if(nt|=4,Sy(x.current),by(x,x.current,R,u),nt=D,dr(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(fs,x)}catch{}return!0}finally{j.p=v,z.T=h,qy(i,o)}}function $y(i,o,u){o=On(u,o),o=Vd(i.stateNode,o,2),i=mi(i,o,2),i!==null&&(be(i,2),ys(i))}function rt(i,o,u){if(i.tag===3)$y(i,i,u);else for(;o!==null;){if(o.tag===3){$y(o,i,u);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Si===null||!Si.has(h))){i=On(u,i),u=Bm(2),h=mi(o,u,2),h!==null&&(Fm(u,h,o,i),be(h,2),ys(h));break}}o=o.return}}function vf(i,o,u){var h=i.pingCache;if(h===null){h=i.pingCache=new w1;var v=new Set;h.set(o,v)}else v=h.get(o),v===void 0&&(v=new Set,h.set(o,v));v.has(u)||(uf=!0,v.add(u),i=R1.bind(null,i,o,u),o.then(i,i))}function R1(i,o,u){var h=i.pingCache;h!==null&&h.delete(o),i.pingedLanes|=i.suspendedLanes&u,i.warmLanes&=~u,pt===i&&(Ge&u)===u&&(Rt===4||Rt===3&&(Ge&62914560)===Ge&&300>Ze()-qc?(nt&2)===0&&no(i,0):df|=u,eo===Ge&&(eo=0)),ys(i)}function By(i,o){o===0&&(o=ee()),i=Xi(i,o),i!==null&&(be(i,o),ys(i))}function k1(i){var o=i.memoizedState,u=0;o!==null&&(u=o.retryLane),By(i,u)}function T1(i,o){var u=0;switch(i.tag){case 31:case 13:var h=i.stateNode,v=i.memoizedState;v!==null&&(u=v.retryLane);break;case 19:h=i.stateNode;break;case 22:h=i.stateNode._retryCache;break;default:throw Error(n(314))}h!==null&&h.delete(o),By(i,u)}function A1(i,o){return Be(i,o)}var Gc=null,io=null,bf=!1,Kc=!1,xf=!1,Ei=0;function ys(i){i!==io&&i.next===null&&(io===null?Gc=io=i:io=io.next=i),Kc=!0,bf||(bf=!0,_1())}function dr(i,o){if(!xf&&Kc){xf=!0;do for(var u=!1,h=Gc;h!==null;){if(i!==0){var v=h.pendingLanes;if(v===0)var x=0;else{var R=h.suspendedLanes,D=h.pingedLanes;x=(1<<31-zt(42|i)+1)-1,x&=v&~(R&~D),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(u=!0,Gy(h,x))}else x=Ge,x=js(h,h===pt?x:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(x&3)===0||Ps(h,x)||(u=!0,Gy(h,x));h=h.next}while(u);xf=!1}}function D1(){Fy()}function Fy(){Kc=bf=!1;var i=0;Ei!==0&&U1()&&(i=Ei);for(var o=Ze(),u=null,h=Gc;h!==null;){var v=h.next,x=Qy(h,o);x===0?(h.next=null,u===null?Gc=v:u.next=v,v===null&&(io=u)):(u=h,(i!==0||(x&3)!==0)&&(Kc=!0)),h=v}Bt!==0&&Bt!==5||dr(i),Ei!==0&&(Ei=0)}function Qy(i,o){for(var u=i.suspendedLanes,h=i.pingedLanes,v=i.expirationTimes,x=i.pendingLanes&-62914561;0<x;){var R=31-zt(x),D=1<<R,I=v[R];I===-1?((D&u)===0||(D&h)!==0)&&(v[R]=zu(D,o)):I<=o&&(i.expiredLanes|=D),x&=~D}if(o=pt,u=Ge,u=js(i,i===o?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h=i.callbackNode,u===0||i===o&&(ot===2||ot===9)||i.cancelPendingCommit!==null)return h!==null&&h!==null&&bt(h),i.callbackNode=null,i.callbackPriority=0;if((u&3)===0||Ps(i,u)){if(o=u&-u,o===i.callbackPriority)return o;switch(h!==null&&bt(h),At(u)){case 2:case 8:u=yt;break;case 32:u=Xt;break;case 268435456:u=_s;break;default:u=Xt}return h=Vy.bind(null,i),u=Be(u,h),i.callbackPriority=o,i.callbackNode=u,o}return h!==null&&h!==null&&bt(h),i.callbackPriority=2,i.callbackNode=null,2}function Vy(i,o){if(Bt!==0&&Bt!==5)return i.callbackNode=null,i.callbackPriority=0,null;var u=i.callbackNode;if(Vc()&&i.callbackNode!==u)return null;var h=Ge;return h=js(i,i===pt?h:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h===0?null:(ky(i,h,o),Qy(i,Ze()),i.callbackNode!=null&&i.callbackNode===u?Vy.bind(null,i):null)}function Gy(i,o){if(Vc())return null;ky(i,o,!0)}function _1(){B1(function(){(nt&6)!==0?Be(xt,D1):Fy()})}function wf(){if(Ei===0){var i=Ba;i===0&&(i=Ns,Ns<<=1,(Ns&261888)===0&&(Ns=256)),Ei=i}return Ei}function Ky(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:nc(""+i)}function Yy(i,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,i.id&&u.setAttribute("form",i.id),o.parentNode.insertBefore(u,o),i=new FormData(i),u.parentNode.removeChild(u),i}function N1(i,o,u,h,v){if(o==="submit"&&u&&u.stateNode===v){var x=Ky((v[$t]||null).action),R=h.submitter;R&&(o=(o=R[$t]||null)?Ky(o.formAction):R.getAttribute("formAction"),o!==null&&(x=o,R=null));var D=new oc("action","action",null,h,v);i.push({event:D,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Ei!==0){var I=R?Yy(v,R):new FormData(v);qd(u,{pending:!0,data:I,method:v.method,action:x},null,I)}}else typeof x=="function"&&(D.preventDefault(),I=R?Yy(v,R):new FormData(v),qd(u,{pending:!0,data:I,method:v.method,action:x},x,I))},currentTarget:v}]})}}for(var Sf=0;Sf<sd.length;Sf++){var Mf=sd[Sf],j1=Mf.toLowerCase(),P1=Mf[0].toUpperCase()+Mf.slice(1);Zn(j1,"on"+P1)}Zn(Rg,"onAnimationEnd"),Zn(kg,"onAnimationIteration"),Zn(Tg,"onAnimationStart"),Zn("dblclick","onDoubleClick"),Zn("focusin","onFocus"),Zn("focusout","onBlur"),Zn(WC,"onTransitionRun"),Zn(XC,"onTransitionStart"),Zn(JC,"onTransitionCancel"),Zn(Ag,"onTransitionEnd"),Aa("onMouseEnter",["mouseout","mouseover"]),Aa("onMouseLeave",["mouseout","mouseover"]),Aa("onPointerEnter",["pointerout","pointerover"]),Aa("onPointerLeave",["pointerout","pointerover"]),Gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fr));function Wy(i,o){o=(o&4)!==0;for(var u=0;u<i.length;u++){var h=i[u],v=h.event;h=h.listeners;e:{var x=void 0;if(o)for(var R=h.length-1;0<=R;R--){var D=h[R],I=D.instance,V=D.currentTarget;if(D=D.listener,I!==x&&v.isPropagationStopped())break e;x=D,v.currentTarget=V;try{x(v)}catch(ne){lc(ne)}v.currentTarget=null,x=I}else for(R=0;R<h.length;R++){if(D=h[R],I=D.instance,V=D.currentTarget,D=D.listener,I!==x&&v.isPropagationStopped())break e;x=D,v.currentTarget=V;try{x(v)}catch(ne){lc(ne)}v.currentTarget=null,x=I}}}}function Ve(i,o){var u=o[Fe];u===void 0&&(u=o[Fe]=new Set);var h=i+"__bubble";u.has(h)||(Xy(o,i,2,!1),u.add(h))}function Cf(i,o,u){var h=0;o&&(h|=4),Xy(u,i,h,o)}var Yc="_reactListening"+Math.random().toString(36).slice(2);function Ef(i){if(!i[Yc]){i[Yc]=!0,Fp.forEach(function(u){u!=="selectionchange"&&(z1.has(u)||Cf(u,!1,i),Cf(u,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[Yc]||(o[Yc]=!0,Cf("selectionchange",!1,o))}}function Xy(i,o,u,h){switch(R0(o)){case 2:var v=lE;break;case 8:v=uE;break;default:v=qf}u=v.bind(null,o,u,i),v=void 0,!Fu||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),h?v!==void 0?i.addEventListener(o,u,{capture:!0,passive:v}):i.addEventListener(o,u,!0):v!==void 0?i.addEventListener(o,u,{passive:v}):i.addEventListener(o,u,!1)}function Rf(i,o,u,h,v){var x=h;if((o&1)===0&&(o&2)===0&&h!==null)e:for(;;){if(h===null)return;var R=h.tag;if(R===3||R===4){var D=h.stateNode.containerInfo;if(D===v)break;if(R===4)for(R=h.return;R!==null;){var I=R.tag;if((I===3||I===4)&&R.stateNode.containerInfo===v)return;R=R.return}for(;D!==null;){if(R=Ra(D),R===null)return;if(I=R.tag,I===5||I===6||I===26||I===27){h=x=R;continue e}D=D.parentNode}}h=h.return}ng(function(){var V=x,ne=$u(u),re=[];e:{var K=Dg.get(i);if(K!==void 0){var X=oc,xe=i;switch(i){case"keypress":if(ic(u)===0)break e;case"keydown":case"keyup":X=TC;break;case"focusin":xe="focus",X=Ku;break;case"focusout":xe="blur",X=Ku;break;case"beforeblur":case"afterblur":X=Ku;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=ag;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=mC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=_C;break;case Rg:case kg:case Tg:X=bC;break;case Ag:X=jC;break;case"scroll":case"scrollend":X=pC;break;case"wheel":X=zC;break;case"copy":case"cut":case"paste":X=wC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=rg;break;case"toggle":case"beforetoggle":X=IC}var Ne=(o&4)!==0,ft=!Ne&&(i==="scroll"||i==="scrollend"),U=Ne?K!==null?K+"Capture":null:K;Ne=[];for(var H=V,Q;H!==null;){var oe=H;if(Q=oe.stateNode,oe=oe.tag,oe!==5&&oe!==26&&oe!==27||Q===null||U===null||(oe=Po(H,U),oe!=null&&Ne.push(hr(H,oe,Q))),ft)break;H=H.return}0<Ne.length&&(K=new X(K,xe,null,u,ne),re.push({event:K,listeners:Ne}))}}if((o&7)===0){e:{if(K=i==="mouseover"||i==="pointerover",X=i==="mouseout"||i==="pointerout",K&&u!==Uu&&(xe=u.relatedTarget||u.fromElement)&&(Ra(xe)||xe[hs]))break e;if((X||K)&&(K=ne.window===ne?ne:(K=ne.ownerDocument)?K.defaultView||K.parentWindow:window,X?(xe=u.relatedTarget||u.toElement,X=V,xe=xe?Ra(xe):null,xe!==null&&(ft=a(xe),Ne=xe.tag,xe!==ft||Ne!==5&&Ne!==27&&Ne!==6)&&(xe=null)):(X=null,xe=V),X!==xe)){if(Ne=ag,oe="onMouseLeave",U="onMouseEnter",H="mouse",(i==="pointerout"||i==="pointerover")&&(Ne=rg,oe="onPointerLeave",U="onPointerEnter",H="pointer"),ft=X==null?K:jo(X),Q=xe==null?K:jo(xe),K=new Ne(oe,H+"leave",X,u,ne),K.target=ft,K.relatedTarget=Q,oe=null,Ra(ne)===V&&(Ne=new Ne(U,H+"enter",xe,u,ne),Ne.target=Q,Ne.relatedTarget=ft,oe=Ne),ft=oe,X&&xe)t:{for(Ne=L1,U=X,H=xe,Q=0,oe=U;oe;oe=Ne(oe))Q++;oe=0;for(var Te=H;Te;Te=Ne(Te))oe++;for(;0<Q-oe;)U=Ne(U),Q--;for(;0<oe-Q;)H=Ne(H),oe--;for(;Q--;){if(U===H||H!==null&&U===H.alternate){Ne=U;break t}U=Ne(U),H=Ne(H)}Ne=null}else Ne=null;X!==null&&Jy(re,K,X,Ne,!1),xe!==null&&ft!==null&&Jy(re,ft,xe,Ne,!0)}}e:{if(K=V?jo(V):window,X=K.nodeName&&K.nodeName.toLowerCase(),X==="select"||X==="input"&&K.type==="file")var et=gg;else if(hg(K))if(mg)et=GC;else{et=QC;var Ce=FC}else X=K.nodeName,!X||X.toLowerCase()!=="input"||K.type!=="checkbox"&&K.type!=="radio"?V&&qu(V.elementType)&&(et=gg):et=VC;if(et&&(et=et(i,V))){pg(re,et,u,ne);break e}Ce&&Ce(i,K,V),i==="focusout"&&V&&K.type==="number"&&V.memoizedProps.value!=null&&Hu(K,"number",K.value)}switch(Ce=V?jo(V):window,i){case"focusin":(hg(Ce)||Ce.contentEditable==="true")&&(za=Ce,ed=V,$o=null);break;case"focusout":$o=ed=za=null;break;case"mousedown":td=!0;break;case"contextmenu":case"mouseup":case"dragend":td=!1,Cg(re,u,ne);break;case"selectionchange":if(YC)break;case"keydown":case"keyup":Cg(re,u,ne)}var He;if(Wu)e:{switch(i){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else Pa?dg(i,u)&&(Ke="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(Ke="onCompositionStart");Ke&&(cg&&u.locale!=="ko"&&(Pa||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&Pa&&(He=sg()):(li=ne,Qu="value"in li?li.value:li.textContent,Pa=!0)),Ce=Wc(V,Ke),0<Ce.length&&(Ke=new og(Ke,i,null,u,ne),re.push({event:Ke,listeners:Ce}),He?Ke.data=He:(He=fg(u),He!==null&&(Ke.data=He)))),(He=HC?qC(i,u):UC(i,u))&&(Ke=Wc(V,"onBeforeInput"),0<Ke.length&&(Ce=new og("onBeforeInput","beforeinput",null,u,ne),re.push({event:Ce,listeners:Ke}),Ce.data=He)),N1(re,i,V,u,ne)}Wy(re,o)})}function hr(i,o,u){return{instance:i,listener:o,currentTarget:u}}function Wc(i,o){for(var u=o+"Capture",h=[];i!==null;){var v=i,x=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||x===null||(v=Po(i,u),v!=null&&h.unshift(hr(i,v,x)),v=Po(i,o),v!=null&&h.push(hr(i,v,x))),i.tag===3)return h;i=i.return}return[]}function L1(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Jy(i,o,u,h,v){for(var x=o._reactName,R=[];u!==null&&u!==h;){var D=u,I=D.alternate,V=D.stateNode;if(D=D.tag,I!==null&&I===h)break;D!==5&&D!==26&&D!==27||V===null||(I=V,v?(V=Po(u,x),V!=null&&R.unshift(hr(u,V,I))):v||(V=Po(u,x),V!=null&&R.push(hr(u,V,I)))),u=u.return}R.length!==0&&i.push({event:o,listeners:R})}var I1=/\r\n?/g,O1=/\u0000|\uFFFD/g;function Zy(i){return(typeof i=="string"?i:""+i).replace(I1,`
`).replace(O1,"")}function e0(i,o){return o=Zy(o),Zy(i)===o}function dt(i,o,u,h,v,x){switch(u){case"children":typeof h=="string"?o==="body"||o==="textarea"&&h===""||_a(i,h):(typeof h=="number"||typeof h=="bigint")&&o!=="body"&&_a(i,""+h);break;case"className":ec(i,"class",h);break;case"tabIndex":ec(i,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":ec(i,u,h);break;case"style":eg(i,h,x);break;case"data":if(o!=="object"){ec(i,"data",h);break}case"src":case"href":if(h===""&&(o!=="a"||u!=="href")){i.removeAttribute(u);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(u);break}h=nc(""+h),i.setAttribute(u,h);break;case"action":case"formAction":if(typeof h=="function"){i.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(u==="formAction"?(o!=="input"&&dt(i,o,"name",v.name,v,null),dt(i,o,"formEncType",v.formEncType,v,null),dt(i,o,"formMethod",v.formMethod,v,null),dt(i,o,"formTarget",v.formTarget,v,null)):(dt(i,o,"encType",v.encType,v,null),dt(i,o,"method",v.method,v,null),dt(i,o,"target",v.target,v,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(u);break}h=nc(""+h),i.setAttribute(u,h);break;case"onClick":h!=null&&(i.onclick=Ls);break;case"onScroll":h!=null&&Ve("scroll",i);break;case"onScrollEnd":h!=null&&Ve("scrollend",i);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(n(61));if(u=h.__html,u!=null){if(v.children!=null)throw Error(n(60));i.innerHTML=u}}break;case"multiple":i.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":i.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){i.removeAttribute("xlink:href");break}u=nc(""+h),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(u,""+h):i.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(u,""):i.removeAttribute(u);break;case"capture":case"download":h===!0?i.setAttribute(u,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(u,h):i.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?i.setAttribute(u,h):i.removeAttribute(u);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?i.removeAttribute(u):i.setAttribute(u,h);break;case"popover":Ve("beforetoggle",i),Ve("toggle",i),Zr(i,"popover",h);break;case"xlinkActuate":zs(i,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":zs(i,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":zs(i,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":zs(i,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":zs(i,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":zs(i,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":zs(i,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":zs(i,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":zs(i,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Zr(i,"is",h);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=fC.get(u)||u,Zr(i,u,h))}}function kf(i,o,u,h,v,x){switch(u){case"style":eg(i,h,x);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(n(61));if(u=h.__html,u!=null){if(v.children!=null)throw Error(n(60));i.innerHTML=u}}break;case"children":typeof h=="string"?_a(i,h):(typeof h=="number"||typeof h=="bigint")&&_a(i,""+h);break;case"onScroll":h!=null&&Ve("scroll",i);break;case"onScrollEnd":h!=null&&Ve("scrollend",i);break;case"onClick":h!=null&&(i.onclick=Ls);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Qp.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(v=u.endsWith("Capture"),o=u.slice(2,v?u.length-7:void 0),x=i[$t]||null,x=x!=null?x[u]:null,typeof x=="function"&&i.removeEventListener(o,x,v),typeof h=="function")){typeof x!="function"&&x!==null&&(u in i?i[u]=null:i.hasAttribute(u)&&i.removeAttribute(u)),i.addEventListener(o,h,v);break e}u in i?i[u]=h:h===!0?i.setAttribute(u,""):Zr(i,u,h)}}}function sn(i,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ve("error",i),Ve("load",i);var h=!1,v=!1,x;for(x in u)if(u.hasOwnProperty(x)){var R=u[x];if(R!=null)switch(x){case"src":h=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:dt(i,o,x,R,u,null)}}v&&dt(i,o,"srcSet",u.srcSet,u,null),h&&dt(i,o,"src",u.src,u,null);return;case"input":Ve("invalid",i);var D=x=R=v=null,I=null,V=null;for(h in u)if(u.hasOwnProperty(h)){var ne=u[h];if(ne!=null)switch(h){case"name":v=ne;break;case"type":R=ne;break;case"checked":I=ne;break;case"defaultChecked":V=ne;break;case"value":x=ne;break;case"defaultValue":D=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(n(137,o));break;default:dt(i,o,h,ne,u,null)}}Wp(i,x,D,I,V,R,v,!1);return;case"select":Ve("invalid",i),h=R=x=null;for(v in u)if(u.hasOwnProperty(v)&&(D=u[v],D!=null))switch(v){case"value":x=D;break;case"defaultValue":R=D;break;case"multiple":h=D;default:dt(i,o,v,D,u,null)}o=x,u=R,i.multiple=!!h,o!=null?Da(i,!!h,o,!1):u!=null&&Da(i,!!h,u,!0);return;case"textarea":Ve("invalid",i),x=v=h=null;for(R in u)if(u.hasOwnProperty(R)&&(D=u[R],D!=null))switch(R){case"value":h=D;break;case"defaultValue":v=D;break;case"children":x=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(n(91));break;default:dt(i,o,R,D,u,null)}Jp(i,h,v,x);return;case"option":for(I in u)if(u.hasOwnProperty(I)&&(h=u[I],h!=null))switch(I){case"selected":i.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:dt(i,o,I,h,u,null)}return;case"dialog":Ve("beforetoggle",i),Ve("toggle",i),Ve("cancel",i),Ve("close",i);break;case"iframe":case"object":Ve("load",i);break;case"video":case"audio":for(h=0;h<fr.length;h++)Ve(fr[h],i);break;case"image":Ve("error",i),Ve("load",i);break;case"details":Ve("toggle",i);break;case"embed":case"source":case"link":Ve("error",i),Ve("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in u)if(u.hasOwnProperty(V)&&(h=u[V],h!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:dt(i,o,V,h,u,null)}return;default:if(qu(o)){for(ne in u)u.hasOwnProperty(ne)&&(h=u[ne],h!==void 0&&kf(i,o,ne,h,u,void 0));return}}for(D in u)u.hasOwnProperty(D)&&(h=u[D],h!=null&&dt(i,o,D,h,u,null))}function H1(i,o,u,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,x=null,R=null,D=null,I=null,V=null,ne=null;for(X in u){var re=u[X];if(u.hasOwnProperty(X)&&re!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":I=re;default:h.hasOwnProperty(X)||dt(i,o,X,null,h,re)}}for(var K in h){var X=h[K];if(re=u[K],h.hasOwnProperty(K)&&(X!=null||re!=null))switch(K){case"type":x=X;break;case"name":v=X;break;case"checked":V=X;break;case"defaultChecked":ne=X;break;case"value":R=X;break;case"defaultValue":D=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(n(137,o));break;default:X!==re&&dt(i,o,K,X,h,re)}}Ou(i,R,D,I,V,ne,x,v);return;case"select":X=R=D=K=null;for(x in u)if(I=u[x],u.hasOwnProperty(x)&&I!=null)switch(x){case"value":break;case"multiple":X=I;default:h.hasOwnProperty(x)||dt(i,o,x,null,h,I)}for(v in h)if(x=h[v],I=u[v],h.hasOwnProperty(v)&&(x!=null||I!=null))switch(v){case"value":K=x;break;case"defaultValue":D=x;break;case"multiple":R=x;default:x!==I&&dt(i,o,v,x,h,I)}o=D,u=R,h=X,K!=null?Da(i,!!u,K,!1):!!h!=!!u&&(o!=null?Da(i,!!u,o,!0):Da(i,!!u,u?[]:"",!1));return;case"textarea":X=K=null;for(D in u)if(v=u[D],u.hasOwnProperty(D)&&v!=null&&!h.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:dt(i,o,D,null,h,v)}for(R in h)if(v=h[R],x=u[R],h.hasOwnProperty(R)&&(v!=null||x!=null))switch(R){case"value":K=v;break;case"defaultValue":X=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(n(91));break;default:v!==x&&dt(i,o,R,v,h,x)}Xp(i,K,X);return;case"option":for(var xe in u)if(K=u[xe],u.hasOwnProperty(xe)&&K!=null&&!h.hasOwnProperty(xe))switch(xe){case"selected":i.selected=!1;break;default:dt(i,o,xe,null,h,K)}for(I in h)if(K=h[I],X=u[I],h.hasOwnProperty(I)&&K!==X&&(K!=null||X!=null))switch(I){case"selected":i.selected=K&&typeof K!="function"&&typeof K!="symbol";break;default:dt(i,o,I,K,h,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ne in u)K=u[Ne],u.hasOwnProperty(Ne)&&K!=null&&!h.hasOwnProperty(Ne)&&dt(i,o,Ne,null,h,K);for(V in h)if(K=h[V],X=u[V],h.hasOwnProperty(V)&&K!==X&&(K!=null||X!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(n(137,o));break;default:dt(i,o,V,K,h,X)}return;default:if(qu(o)){for(var ft in u)K=u[ft],u.hasOwnProperty(ft)&&K!==void 0&&!h.hasOwnProperty(ft)&&kf(i,o,ft,void 0,h,K);for(ne in h)K=h[ne],X=u[ne],!h.hasOwnProperty(ne)||K===X||K===void 0&&X===void 0||kf(i,o,ne,K,h,X);return}}for(var U in u)K=u[U],u.hasOwnProperty(U)&&K!=null&&!h.hasOwnProperty(U)&&dt(i,o,U,null,h,K);for(re in h)K=h[re],X=u[re],!h.hasOwnProperty(re)||K===X||K==null&&X==null||dt(i,o,re,K,h,X)}function t0(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function q1(){if(typeof performance.getEntriesByType=="function"){for(var i=0,o=0,u=performance.getEntriesByType("resource"),h=0;h<u.length;h++){var v=u[h],x=v.transferSize,R=v.initiatorType,D=v.duration;if(x&&D&&t0(R)){for(R=0,D=v.responseEnd,h+=1;h<u.length;h++){var I=u[h],V=I.startTime;if(V>D)break;var ne=I.transferSize,re=I.initiatorType;ne&&t0(re)&&(I=I.responseEnd,R+=ne*(I<D?1:(D-V)/(I-V)))}if(--h,o+=8*(x+R)/(v.duration/1e3),i++,10<i)break}}if(0<i)return o/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Tf=null,Af=null;function Xc(i){return i.nodeType===9?i:i.ownerDocument}function n0(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function s0(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function Df(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var _f=null;function U1(){var i=window.event;return i&&i.type==="popstate"?i===_f?!1:(_f=i,!0):(_f=null,!1)}var i0=typeof setTimeout=="function"?setTimeout:void 0,$1=typeof clearTimeout=="function"?clearTimeout:void 0,a0=typeof Promise=="function"?Promise:void 0,B1=typeof queueMicrotask=="function"?queueMicrotask:typeof a0<"u"?function(i){return a0.resolve(null).then(i).catch(F1)}:i0;function F1(i){setTimeout(function(){throw i})}function Ri(i){return i==="head"}function o0(i,o){var u=o,h=0;do{var v=u.nextSibling;if(i.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"||u==="/&"){if(h===0){i.removeChild(v),co(o);return}h--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")h++;else if(u==="html")pr(i.ownerDocument.documentElement);else if(u==="head"){u=i.ownerDocument.head,pr(u);for(var x=u.firstChild;x;){var R=x.nextSibling,D=x.nodeName;x[No]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=R}}else u==="body"&&pr(i.ownerDocument.body);u=v}while(u);co(o)}function r0(i,o){var u=i;i=0;do{var h=u.nextSibling;if(u.nodeType===1?o?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(o?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),h&&h.nodeType===8)if(u=h.data,u==="/$"){if(i===0)break;i--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||i++;u=h}while(u)}function Nf(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Nf(u),Lu(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}i.removeChild(u)}}function Q1(i,o,u,h){for(;i.nodeType===1;){var v=u;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!h&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(h){if(!i[No])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(x=i.getAttribute("rel"),x==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(x!==v.rel||i.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||i.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||i.getAttribute("title")!==(v.title==null?null:v.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(x=i.getAttribute("src"),(x!==(v.src==null?null:v.src)||i.getAttribute("type")!==(v.type==null?null:v.type)||i.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&x&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var x=v.name==null?null:""+v.name;if(v.type==="hidden"&&i.getAttribute("name")===x)return i}else return i;if(i=Bn(i.nextSibling),i===null)break}return null}function V1(i,o,u){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!u||(i=Bn(i.nextSibling),i===null))return null;return i}function c0(i,o){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=Bn(i.nextSibling),i===null))return null;return i}function jf(i){return i.data==="$?"||i.data==="$~"}function Pf(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function G1(i,o){var u=i.ownerDocument;if(i.data==="$~")i._reactRetry=o;else if(i.data!=="$?"||u.readyState!=="loading")o();else{var h=function(){o(),u.removeEventListener("DOMContentLoaded",h)};u.addEventListener("DOMContentLoaded",h),i._reactRetry=h}}function Bn(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return i}var zf=null;function l0(i){i=i.nextSibling;for(var o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"||u==="/&"){if(o===0)return Bn(i.nextSibling);o--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||o++}i=i.nextSibling}return null}function u0(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(o===0)return i;o--}else u!=="/$"&&u!=="/&"||o++}i=i.previousSibling}return null}function d0(i,o,u){switch(o=Xc(u),i){case"html":if(i=o.documentElement,!i)throw Error(n(452));return i;case"head":if(i=o.head,!i)throw Error(n(453));return i;case"body":if(i=o.body,!i)throw Error(n(454));return i;default:throw Error(n(451))}}function pr(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);Lu(i)}var Fn=new Map,f0=new Set;function Jc(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Js=j.d;j.d={f:K1,r:Y1,D:W1,C:X1,L:J1,m:Z1,X:tE,S:eE,M:nE};function K1(){var i=Js.f(),o=Bc();return i||o}function Y1(i){var o=ka(i);o!==null&&o.tag===5&&o.type==="form"?Am(o):Js.r(i)}var ao=typeof document>"u"?null:document;function h0(i,o,u){var h=ao;if(h&&typeof o=="string"&&o){var v=Ln(o);v='link[rel="'+i+'"][href="'+v+'"]',typeof u=="string"&&(v+='[crossorigin="'+u+'"]'),f0.has(v)||(f0.add(v),i={rel:i,crossOrigin:u,href:o},h.querySelector(v)===null&&(o=h.createElement("link"),sn(o,"link",i),Yt(o),h.head.appendChild(o)))}}function W1(i){Js.D(i),h0("dns-prefetch",i,null)}function X1(i,o){Js.C(i,o),h0("preconnect",i,o)}function J1(i,o,u){Js.L(i,o,u);var h=ao;if(h&&i&&o){var v='link[rel="preload"][as="'+Ln(o)+'"]';o==="image"&&u&&u.imageSrcSet?(v+='[imagesrcset="'+Ln(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(v+='[imagesizes="'+Ln(u.imageSizes)+'"]')):v+='[href="'+Ln(i)+'"]';var x=v;switch(o){case"style":x=oo(i);break;case"script":x=ro(i)}Fn.has(x)||(i=m({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:i,as:o},u),Fn.set(x,i),h.querySelector(v)!==null||o==="style"&&h.querySelector(gr(x))||o==="script"&&h.querySelector(mr(x))||(o=h.createElement("link"),sn(o,"link",i),Yt(o),h.head.appendChild(o)))}}function Z1(i,o){Js.m(i,o);var u=ao;if(u&&i){var h=o&&typeof o.as=="string"?o.as:"script",v='link[rel="modulepreload"][as="'+Ln(h)+'"][href="'+Ln(i)+'"]',x=v;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=ro(i)}if(!Fn.has(x)&&(i=m({rel:"modulepreload",href:i},o),Fn.set(x,i),u.querySelector(v)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(mr(x)))return}h=u.createElement("link"),sn(h,"link",i),Yt(h),u.head.appendChild(h)}}}function eE(i,o,u){Js.S(i,o,u);var h=ao;if(h&&i){var v=Ta(h).hoistableStyles,x=oo(i);o=o||"default";var R=v.get(x);if(!R){var D={loading:0,preload:null};if(R=h.querySelector(gr(x)))D.loading=5;else{i=m({rel:"stylesheet",href:i,"data-precedence":o},u),(u=Fn.get(x))&&Lf(i,u);var I=R=h.createElement("link");Yt(I),sn(I,"link",i),I._p=new Promise(function(V,ne){I.onload=V,I.onerror=ne}),I.addEventListener("load",function(){D.loading|=1}),I.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Zc(R,o,h)}R={type:"stylesheet",instance:R,count:1,state:D},v.set(x,R)}}}function tE(i,o){Js.X(i,o);var u=ao;if(u&&i){var h=Ta(u).hoistableScripts,v=ro(i),x=h.get(v);x||(x=u.querySelector(mr(v)),x||(i=m({src:i,async:!0},o),(o=Fn.get(v))&&If(i,o),x=u.createElement("script"),Yt(x),sn(x,"link",i),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},h.set(v,x))}}function nE(i,o){Js.M(i,o);var u=ao;if(u&&i){var h=Ta(u).hoistableScripts,v=ro(i),x=h.get(v);x||(x=u.querySelector(mr(v)),x||(i=m({src:i,async:!0,type:"module"},o),(o=Fn.get(v))&&If(i,o),x=u.createElement("script"),Yt(x),sn(x,"link",i),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},h.set(v,x))}}function p0(i,o,u,h){var v=(v=ae.current)?Jc(v):null;if(!v)throw Error(n(446));switch(i){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=oo(u.href),u=Ta(v).hoistableStyles,h=u.get(o),h||(h={type:"style",instance:null,count:0,state:null},u.set(o,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){i=oo(u.href);var x=Ta(v).hoistableStyles,R=x.get(i);if(R||(v=v.ownerDocument||v,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(i,R),(x=v.querySelector(gr(i)))&&!x._p&&(R.instance=x,R.state.loading=5),Fn.has(i)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Fn.set(i,u),x||sE(v,i,u,R.state))),o&&h===null)throw Error(n(528,""));return R}if(o&&h!==null)throw Error(n(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=ro(u),u=Ta(v).hoistableScripts,h=u.get(o),h||(h={type:"script",instance:null,count:0,state:null},u.set(o,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,i))}}function oo(i){return'href="'+Ln(i)+'"'}function gr(i){return'link[rel="stylesheet"]['+i+"]"}function g0(i){return m({},i,{"data-precedence":i.precedence,precedence:null})}function sE(i,o,u,h){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?h.loading=1:(o=i.createElement("link"),h.preload=o,o.addEventListener("load",function(){return h.loading|=1}),o.addEventListener("error",function(){return h.loading|=2}),sn(o,"link",u),Yt(o),i.head.appendChild(o))}function ro(i){return'[src="'+Ln(i)+'"]'}function mr(i){return"script[async]"+i}function m0(i,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var h=i.querySelector('style[data-href~="'+Ln(u.href)+'"]');if(h)return o.instance=h,Yt(h),h;var v=m({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return h=(i.ownerDocument||i).createElement("style"),Yt(h),sn(h,"style",v),Zc(h,u.precedence,i),o.instance=h;case"stylesheet":v=oo(u.href);var x=i.querySelector(gr(v));if(x)return o.state.loading|=4,o.instance=x,Yt(x),x;h=g0(u),(v=Fn.get(v))&&Lf(h,v),x=(i.ownerDocument||i).createElement("link"),Yt(x);var R=x;return R._p=new Promise(function(D,I){R.onload=D,R.onerror=I}),sn(x,"link",h),o.state.loading|=4,Zc(x,u.precedence,i),o.instance=x;case"script":return x=ro(u.src),(v=i.querySelector(mr(x)))?(o.instance=v,Yt(v),v):(h=u,(v=Fn.get(x))&&(h=m({},u),If(h,v)),i=i.ownerDocument||i,v=i.createElement("script"),Yt(v),sn(v,"link",h),i.head.appendChild(v),o.instance=v);case"void":return null;default:throw Error(n(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(h=o.instance,o.state.loading|=4,Zc(h,u.precedence,i));return o.instance}function Zc(i,o,u){for(var h=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=h.length?h[h.length-1]:null,x=v,R=0;R<h.length;R++){var D=h[R];if(D.dataset.precedence===o)x=D;else if(x!==v)break}x?x.parentNode.insertBefore(i,x.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(i,o.firstChild))}function Lf(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function If(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var el=null;function y0(i,o,u){if(el===null){var h=new Map,v=el=new Map;v.set(u,h)}else v=el,h=v.get(u),h||(h=new Map,v.set(u,h));if(h.has(i))return h;for(h.set(i,null),u=u.getElementsByTagName(i),v=0;v<u.length;v++){var x=u[v];if(!(x[No]||x[vt]||i==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var R=x.getAttribute(o)||"";R=i+R;var D=h.get(R);D?D.push(x):h.set(R,[x])}}return h}function v0(i,o,u){i=i.ownerDocument||i,i.head.insertBefore(u,o==="title"?i.querySelector("head > title"):null)}function iE(i,o,u){if(u===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return i=o.disabled,typeof o.precedence=="string"&&i==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function b0(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function aE(i,o,u,h){if(u.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var v=oo(h.href),x=o.querySelector(gr(v));if(x){o=x._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(i.count++,i=tl.bind(i),o.then(i,i)),u.state.loading|=4,u.instance=x,Yt(x);return}x=o.ownerDocument||o,h=g0(h),(v=Fn.get(v))&&Lf(h,v),x=x.createElement("link"),Yt(x);var R=x;R._p=new Promise(function(D,I){R.onload=D,R.onerror=I}),sn(x,"link",h),u.instance=x}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(i.count++,u=tl.bind(i),o.addEventListener("load",u),o.addEventListener("error",u))}}var Of=0;function oE(i,o){return i.stylesheets&&i.count===0&&sl(i,i.stylesheets),0<i.count||0<i.imgCount?function(u){var h=setTimeout(function(){if(i.stylesheets&&sl(i,i.stylesheets),i.unsuspend){var x=i.unsuspend;i.unsuspend=null,x()}},6e4+o);0<i.imgBytes&&Of===0&&(Of=62500*q1());var v=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&sl(i,i.stylesheets),i.unsuspend)){var x=i.unsuspend;i.unsuspend=null,x()}},(i.imgBytes>Of?50:800)+o);return i.unsuspend=u,function(){i.unsuspend=null,clearTimeout(h),clearTimeout(v)}}:null}function tl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)sl(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var nl=null;function sl(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,nl=new Map,o.forEach(rE,i),nl=null,tl.call(i))}function rE(i,o){if(!(o.state.loading&4)){var u=nl.get(i);if(u)var h=u.get(null);else{u=new Map,nl.set(i,u);for(var v=i.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<v.length;x++){var R=v[x];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(u.set(R.dataset.precedence,R),h=R)}h&&u.set(null,h)}v=o.instance,R=v.getAttribute("data-precedence"),x=u.get(R)||h,x===h&&u.set(null,v),u.set(R,v),this.count++,h=tl.bind(this),v.addEventListener("load",h),v.addEventListener("error",h),x?x.parentNode.insertBefore(v,x.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(v,i.firstChild)),o.state.loading|=4}}var yr={$$typeof:k,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function cE(i,o,u,h,v,x,R,D,I){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fe(0),this.hiddenUpdates=fe(null),this.identifierPrefix=h,this.onUncaughtError=v,this.onCaughtError=x,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=I,this.incompleteTransitions=new Map}function x0(i,o,u,h,v,x,R,D,I,V,ne,re){return i=new cE(i,o,u,R,I,V,ne,re,D),o=1,x===!0&&(o|=24),x=Cn(3,null,null,o),i.current=x,x.stateNode=i,o=md(),o.refCount++,i.pooledCache=o,o.refCount++,x.memoizedState={element:h,isDehydrated:u,cache:o},xd(x),i}function w0(i){return i?(i=Oa,i):Oa}function S0(i,o,u,h,v,x){v=w0(v),h.context===null?h.context=v:h.pendingContext=v,h=gi(o),h.payload={element:u},x=x===void 0?null:x,x!==null&&(h.callback=x),u=mi(i,h,o),u!==null&&(bn(u,i,o),Yo(u,i,o))}function M0(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<o?u:o}}function Hf(i,o){M0(i,o),(i=i.alternate)&&M0(i,o)}function C0(i){if(i.tag===13||i.tag===31){var o=Xi(i,67108864);o!==null&&bn(o,i,67108864),Hf(i,67108864)}}function E0(i){if(i.tag===13||i.tag===31){var o=An();o=Zt(o);var u=Xi(i,o);u!==null&&bn(u,i,o),Hf(i,o)}}var il=!0;function lE(i,o,u,h){var v=z.T;z.T=null;var x=j.p;try{j.p=2,qf(i,o,u,h)}finally{j.p=x,z.T=v}}function uE(i,o,u,h){var v=z.T;z.T=null;var x=j.p;try{j.p=8,qf(i,o,u,h)}finally{j.p=x,z.T=v}}function qf(i,o,u,h){if(il){var v=Uf(h);if(v===null)Rf(i,o,h,al,u),k0(i,h);else if(fE(v,i,o,u,h))h.stopPropagation();else if(k0(i,h),o&4&&-1<dE.indexOf(i)){for(;v!==null;){var x=ka(v);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var R=Jn(x.pendingLanes);if(R!==0){var D=x;for(D.pendingLanes|=2,D.entangledLanes|=2;R;){var I=1<<31-zt(R);D.entanglements[1]|=I,R&=~I}ys(x),(nt&6)===0&&(Uc=Ze()+500,dr(0))}}break;case 31:case 13:D=Xi(x,2),D!==null&&bn(D,x,2),Bc(),Hf(x,2)}if(x=Uf(h),x===null&&Rf(i,o,h,al,u),x===v)break;v=x}v!==null&&h.stopPropagation()}else Rf(i,o,h,null,u)}}function Uf(i){return i=$u(i),$f(i)}var al=null;function $f(i){if(al=null,i=Ra(i),i!==null){var o=a(i);if(o===null)i=null;else{var u=o.tag;if(u===13){if(i=c(o),i!==null)return i;i=null}else if(u===31){if(i=l(o),i!==null)return i;i=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return al=i,null}function R0(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Pt()){case xt:return 2;case yt:return 8;case Xt:case Gt:return 32;case _s:return 268435456;default:return 32}default:return 32}}var Bf=!1,ki=null,Ti=null,Ai=null,vr=new Map,br=new Map,Di=[],dE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function k0(i,o){switch(i){case"focusin":case"focusout":ki=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Ai=null;break;case"pointerover":case"pointerout":vr.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":br.delete(o.pointerId)}}function xr(i,o,u,h,v,x){return i===null||i.nativeEvent!==x?(i={blockedOn:o,domEventName:u,eventSystemFlags:h,nativeEvent:x,targetContainers:[v]},o!==null&&(o=ka(o),o!==null&&C0(o)),i):(i.eventSystemFlags|=h,o=i.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),i)}function fE(i,o,u,h,v){switch(o){case"focusin":return ki=xr(ki,i,o,u,h,v),!0;case"dragenter":return Ti=xr(Ti,i,o,u,h,v),!0;case"mouseover":return Ai=xr(Ai,i,o,u,h,v),!0;case"pointerover":var x=v.pointerId;return vr.set(x,xr(vr.get(x)||null,i,o,u,h,v)),!0;case"gotpointercapture":return x=v.pointerId,br.set(x,xr(br.get(x)||null,i,o,u,h,v)),!0}return!1}function T0(i){var o=Ra(i.target);if(o!==null){var u=a(o);if(u!==null){if(o=u.tag,o===13){if(o=c(u),o!==null){i.blockedOn=o,Mt(i.priority,function(){E0(u)});return}}else if(o===31){if(o=l(u),o!==null){i.blockedOn=o,Mt(i.priority,function(){E0(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ol(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var u=Uf(i.nativeEvent);if(u===null){u=i.nativeEvent;var h=new u.constructor(u.type,u);Uu=h,u.target.dispatchEvent(h),Uu=null}else return o=ka(u),o!==null&&C0(o),i.blockedOn=u,!1;o.shift()}return!0}function A0(i,o,u){ol(i)&&u.delete(o)}function hE(){Bf=!1,ki!==null&&ol(ki)&&(ki=null),Ti!==null&&ol(Ti)&&(Ti=null),Ai!==null&&ol(Ai)&&(Ai=null),vr.forEach(A0),br.forEach(A0)}function rl(i,o){i.blockedOn===o&&(i.blockedOn=null,Bf||(Bf=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,hE)))}var cl=null;function D0(i){cl!==i&&(cl=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){cl===i&&(cl=null);for(var o=0;o<i.length;o+=3){var u=i[o],h=i[o+1],v=i[o+2];if(typeof h!="function"){if($f(h||u)===null)continue;break}var x=ka(u);x!==null&&(i.splice(o,3),o-=3,qd(x,{pending:!0,data:v,method:u.method,action:h},h,v))}}))}function co(i){function o(I){return rl(I,i)}ki!==null&&rl(ki,i),Ti!==null&&rl(Ti,i),Ai!==null&&rl(Ai,i),vr.forEach(o),br.forEach(o);for(var u=0;u<Di.length;u++){var h=Di[u];h.blockedOn===i&&(h.blockedOn=null)}for(;0<Di.length&&(u=Di[0],u.blockedOn===null);)T0(u),u.blockedOn===null&&Di.shift();if(u=(i.ownerDocument||i).$$reactFormReplay,u!=null)for(h=0;h<u.length;h+=3){var v=u[h],x=u[h+1],R=v[$t]||null;if(typeof x=="function")R||D0(u);else if(R){var D=null;if(x&&x.hasAttribute("formAction")){if(v=x,R=x[$t]||null)D=R.formAction;else if($f(v)!==null)continue}else D=R.action;typeof D=="function"?u[h+1]=D:(u.splice(h,3),h-=3),D0(u)}}}function _0(){function i(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(R){return v=R})},focusReset:"manual",scroll:"manual"})}function o(){v!==null&&(v(),v=null),h||setTimeout(u,20)}function u(){if(!h&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,v=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(u,100),function(){h=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),v!==null&&(v(),v=null)}}}function Ff(i){this._internalRoot=i}ll.prototype.render=Ff.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(n(409));var u=o.current,h=An();S0(u,h,i,o,null,null)},ll.prototype.unmount=Ff.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;S0(i.current,2,null,i,null,null),Bc(),o[hs]=null}};function ll(i){this._internalRoot=i}ll.prototype.unstable_scheduleHydration=function(i){if(i){var o=un();i={blockedOn:null,target:i,priority:o};for(var u=0;u<Di.length&&o!==0&&o<Di[u].priority;u++);Di.splice(u,0,i),u===0&&T0(i)}};var N0=e.version;if(N0!=="19.2.0")throw Error(n(527,N0,"19.2.0"));j.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=f(o),i=i!==null?p(i):null,i=i===null?null:i.stateNode,i};var pE={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ul.isDisabled&&ul.supportsFiber)try{fs=ul.inject(pE),Jt=ul}catch{}}return Sr.createRoot=function(i,o){if(!s(i))throw Error(n(299));var u=!1,h="",v=Hm,x=qm,R=Um;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(v=o.onUncaughtError),o.onCaughtError!==void 0&&(x=o.onCaughtError),o.onRecoverableError!==void 0&&(R=o.onRecoverableError)),o=x0(i,1,!1,null,null,u,h,null,v,x,R,_0),i[hs]=o.current,Ef(i),new Ff(o)},Sr.hydrateRoot=function(i,o,u){if(!s(i))throw Error(n(299));var h=!1,v="",x=Hm,R=qm,D=Um,I=null;return u!=null&&(u.unstable_strictMode===!0&&(h=!0),u.identifierPrefix!==void 0&&(v=u.identifierPrefix),u.onUncaughtError!==void 0&&(x=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&(D=u.onRecoverableError),u.formState!==void 0&&(I=u.formState)),o=x0(i,1,!0,o,u??null,h,v,I,x,R,D,_0),o.context=w0(null),u=o.current,h=An(),h=Zt(h),v=gi(h),v.callback=null,mi(u,v,h),u=h,o.current.lanes=u,be(o,u),ys(o),i[hs]=o.current,Ef(i),new ll(o)},Sr.version="19.2.0",Sr}var $0;function CE(){if($0)return Gf.exports;$0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Gf.exports=ME(),Gf.exports}var EE=CE();const RE=Hh(EE);let kE={data:""},TE=r=>{if(typeof window=="object"){let e=(r?r.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(r||document.head).appendChild(e),e.firstChild}return r||kE},AE=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,DE=/\/\*[^]*?\*\/|  +/g,B0=/\n+/g,Pi=(r,e)=>{let t="",n="",s="";for(let a in r){let c=r[a];a[0]=="@"?a[1]=="i"?t=a+" "+c+";":n+=a[1]=="f"?Pi(c,a):a+"{"+Pi(c,a[1]=="k"?"":e)+"}":typeof c=="object"?n+=Pi(c,e?e.replace(/([^,])+/g,l=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,l):l?l+" "+d:d)):a):c!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=Pi.p?Pi.p(a,c):a+":"+c+";")}return t+(e&&s?e+"{"+s+"}":s)+n},Zs={},Kv=r=>{if(typeof r=="object"){let e="";for(let t in r)e+=t+Kv(r[t]);return e}return r},_E=(r,e,t,n,s)=>{let a=Kv(r),c=Zs[a]||(Zs[a]=(d=>{let f=0,p=11;for(;f<d.length;)p=101*p+d.charCodeAt(f++)>>>0;return"go"+p})(a));if(!Zs[c]){let d=a!==r?r:(f=>{let p,m,y=[{}];for(;p=AE.exec(f.replace(DE,""));)p[4]?y.shift():p[3]?(m=p[3].replace(B0," ").trim(),y.unshift(y[0][m]=y[0][m]||{})):y[0][p[1]]=p[2].replace(B0," ").trim();return y[0]})(r);Zs[c]=Pi(s?{["@keyframes "+c]:d}:d,t?"":"."+c)}let l=t&&Zs.g?Zs.g:null;return t&&(Zs.g=Zs[c]),((d,f,p,m)=>{m?f.data=f.data.replace(m,d):f.data.indexOf(d)===-1&&(f.data=p?d+f.data:f.data+d)})(Zs[c],e,n,l),c},NE=(r,e,t)=>r.reduce((n,s,a)=>{let c=e[a];if(c&&c.call){let l=c(t),d=l&&l.props&&l.props.className||/^go/.test(l)&&l;c=d?"."+d:l&&typeof l=="object"?l.props?"":Pi(l,""):l===!1?"":l}return n+s+(c??"")},"");function Wl(r){let e=this||{},t=r.call?r(e.p):r;return _E(t.unshift?t.raw?NE(t,[].slice.call(arguments,1),e.p):t.reduce((n,s)=>Object.assign(n,s&&s.call?s(e.p):s),{}):t,TE(e.target),e.g,e.o,e.k)}let Yv,yh,vh;Wl.bind({g:1});let si=Wl.bind({k:1});function jE(r,e,t,n){Pi.p=e,Yv=r,yh=t,vh=n}function qi(r,e){let t=this||{};return function(){let n=arguments;function s(a,c){let l=Object.assign({},a),d=l.className||s.className;t.p=Object.assign({theme:yh&&yh()},l),t.o=/ *go\d+/.test(d),l.className=Wl.apply(t,n)+(d?" "+d:"");let f=r;return r[0]&&(f=l.as||r,delete l.as),vh&&f[0]&&vh(l),Yv(f,l)}return s}}var PE=r=>typeof r=="function",zl=(r,e)=>PE(r)?r(e):r,zE=(()=>{let r=0;return()=>(++r).toString()})(),Wv=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");r=!e||e.matches}return r}})(),LE=20,$h="default",Xv=(r,e)=>{let{toastLimit:t}=r.settings;switch(e.type){case 0:return{...r,toasts:[e.toast,...r.toasts].slice(0,t)};case 1:return{...r,toasts:r.toasts.map(c=>c.id===e.toast.id?{...c,...e.toast}:c)};case 2:let{toast:n}=e;return Xv(r,{type:r.toasts.find(c=>c.id===n.id)?1:0,toast:n});case 3:let{toastId:s}=e;return{...r,toasts:r.toasts.map(c=>c.id===s||s===void 0?{...c,dismissed:!0,visible:!1}:c)};case 4:return e.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(c=>c.id!==e.toastId)};case 5:return{...r,pausedAt:e.time};case 6:let a=e.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(c=>({...c,pauseDuration:c.pauseDuration+a}))}}},El=[],Jv={toasts:[],pausedAt:void 0,settings:{toastLimit:LE}},bs={},Zv=(r,e=$h)=>{bs[e]=Xv(bs[e]||Jv,r),El.forEach(([t,n])=>{t===e&&n(bs[e])})},eb=r=>Object.keys(bs).forEach(e=>Zv(r,e)),IE=r=>Object.keys(bs).find(e=>bs[e].toasts.some(t=>t.id===r)),Xl=(r=$h)=>e=>{Zv(e,r)},OE={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},HE=(r={},e=$h)=>{let[t,n]=w.useState(bs[e]||Jv),s=w.useRef(bs[e]);w.useEffect(()=>(s.current!==bs[e]&&n(bs[e]),El.push([e,n]),()=>{let c=El.findIndex(([l])=>l===e);c>-1&&El.splice(c,1)}),[e]);let a=t.toasts.map(c=>{var l,d,f;return{...r,...r[c.type],...c,removeDelay:c.removeDelay||((l=r[c.type])==null?void 0:l.removeDelay)||r?.removeDelay,duration:c.duration||((d=r[c.type])==null?void 0:d.duration)||r?.duration||OE[c.type],style:{...r.style,...(f=r[c.type])==null?void 0:f.style,...c.style}}});return{...t,toasts:a}},qE=(r,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...t,id:t?.id||zE()}),Hr=r=>(e,t)=>{let n=qE(e,r,t);return Xl(n.toasterId||IE(n.id))({type:2,toast:n}),n.id},Vt=(r,e)=>Hr("blank")(r,e);Vt.error=Hr("error");Vt.success=Hr("success");Vt.loading=Hr("loading");Vt.custom=Hr("custom");Vt.dismiss=(r,e)=>{let t={type:3,toastId:r};e?Xl(e)(t):eb(t)};Vt.dismissAll=r=>Vt.dismiss(void 0,r);Vt.remove=(r,e)=>{let t={type:4,toastId:r};e?Xl(e)(t):eb(t)};Vt.removeAll=r=>Vt.remove(void 0,r);Vt.promise=(r,e,t)=>{let n=Vt.loading(e.loading,{...t,...t?.loading});return typeof r=="function"&&(r=r()),r.then(s=>{let a=e.success?zl(e.success,s):void 0;return a?Vt.success(a,{id:n,...t,...t?.success}):Vt.dismiss(n),s}).catch(s=>{let a=e.error?zl(e.error,s):void 0;a?Vt.error(a,{id:n,...t,...t?.error}):Vt.dismiss(n)}),r};var UE=1e3,$E=(r,e="default")=>{let{toasts:t,pausedAt:n}=HE(r,e),s=w.useRef(new Map).current,a=w.useCallback((m,y=UE)=>{if(s.has(m))return;let b=setTimeout(()=>{s.delete(m),c({type:4,toastId:m})},y);s.set(m,b)},[]);w.useEffect(()=>{if(n)return;let m=Date.now(),y=t.map(b=>{if(b.duration===1/0)return;let S=(b.duration||0)+b.pauseDuration-(m-b.createdAt);if(S<0){b.visible&&Vt.dismiss(b.id);return}return setTimeout(()=>Vt.dismiss(b.id,e),S)});return()=>{y.forEach(b=>b&&clearTimeout(b))}},[t,n,e]);let c=w.useCallback(Xl(e),[e]),l=w.useCallback(()=>{c({type:5,time:Date.now()})},[c]),d=w.useCallback((m,y)=>{c({type:1,toast:{id:m,height:y}})},[c]),f=w.useCallback(()=>{n&&c({type:6,time:Date.now()})},[n,c]),p=w.useCallback((m,y)=>{let{reverseOrder:b=!1,gutter:S=8,defaultPosition:M}=y||{},E=t.filter(k=>(k.position||M)===(m.position||M)&&k.height),C=E.findIndex(k=>k.id===m.id),T=E.filter((k,A)=>A<C&&k.visible).length;return E.filter(k=>k.visible).slice(...b?[T+1]:[0,T]).reduce((k,A)=>k+(A.height||0)+S,0)},[t]);return w.useEffect(()=>{t.forEach(m=>{if(m.dismissed)a(m.id,m.removeDelay);else{let y=s.get(m.id);y&&(clearTimeout(y),s.delete(m.id))}})},[t,a]),{toasts:t,handlers:{updateHeight:d,startPause:l,endPause:f,calculateOffset:p}}},BE=si`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,FE=si`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,QE=si`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,VE=qi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${BE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${FE} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${QE} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,GE=si`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,KE=qi("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${GE} 1s linear infinite;
`,YE=si`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,WE=si`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,XE=qi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${YE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${WE} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,JE=qi("div")`
  position: absolute;
`,ZE=qi("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,eR=si`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,tR=qi("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${eR} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,nR=({toast:r})=>{let{icon:e,type:t,iconTheme:n}=r;return e!==void 0?typeof e=="string"?w.createElement(tR,null,e):e:t==="blank"?null:w.createElement(ZE,null,w.createElement(KE,{...n}),t!=="loading"&&w.createElement(JE,null,t==="error"?w.createElement(VE,{...n}):w.createElement(XE,{...n})))},sR=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,iR=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,aR="0%{opacity:0;} 100%{opacity:1;}",oR="0%{opacity:1;} 100%{opacity:0;}",rR=qi("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,cR=qi("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,lR=(r,e)=>{let t=r.includes("top")?1:-1,[n,s]=Wv()?[aR,oR]:[sR(t),iR(t)];return{animation:e?`${si(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${si(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},uR=w.memo(({toast:r,position:e,style:t,children:n})=>{let s=r.height?lR(r.position||e||"top-center",r.visible):{opacity:0},a=w.createElement(nR,{toast:r}),c=w.createElement(cR,{...r.ariaProps},zl(r.message,r));return w.createElement(rR,{className:r.className,style:{...s,...t,...r.style}},typeof n=="function"?n({icon:a,message:c}):w.createElement(w.Fragment,null,a,c))});jE(w.createElement);var dR=({id:r,className:e,style:t,onHeightUpdate:n,children:s})=>{let a=w.useCallback(c=>{if(c){let l=()=>{let d=c.getBoundingClientRect().height;n(r,d)};l(),new MutationObserver(l).observe(c,{subtree:!0,childList:!0,characterData:!0})}},[r,n]);return w.createElement("div",{ref:a,className:e,style:t},s)},fR=(r,e)=>{let t=r.includes("top"),n=t?{top:0}:{bottom:0},s=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Wv()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...n,...s}},hR=Wl`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dl=16,pR=({reverseOrder:r,position:e="top-center",toastOptions:t,gutter:n,children:s,toasterId:a,containerStyle:c,containerClassName:l})=>{let{toasts:d,handlers:f}=$E(t,a);return w.createElement("div",{"data-rht-toaster":a||"",style:{position:"fixed",zIndex:9999,top:dl,left:dl,right:dl,bottom:dl,pointerEvents:"none",...c},className:l,onMouseEnter:f.startPause,onMouseLeave:f.endPause},d.map(p=>{let m=p.position||e,y=f.calculateOffset(p,{reverseOrder:r,gutter:n,defaultPosition:e}),b=fR(m,y);return w.createElement(dR,{id:p.id,key:p.id,onHeightUpdate:f.updateHeight,className:p.visible?hR:"",style:b},p.type==="custom"?zl(p.message,p):s?s(p):w.createElement(uR,{toast:p,position:m}))}))},FO=Vt;function F0(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function Ts(...r){return e=>{let t=!1;const n=r.map(s=>{const a=F0(s,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let s=0;s<n.length;s++){const a=n[s];typeof a=="function"?a():F0(r[s],null)}}}}function je(...r){return w.useCallback(Ts(...r),r)}var gR=Symbol.for("react.lazy"),Ll=Uh[" use ".trim().toString()];function mR(r){return typeof r=="object"&&r!==null&&"then"in r}function tb(r){return r!=null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===gR&&"_payload"in r&&mR(r._payload)}function Bh(r){const e=vR(r),t=w.forwardRef((n,s)=>{let{children:a,...c}=n;tb(a)&&typeof Ll=="function"&&(a=Ll(a._payload));const l=w.Children.toArray(a),d=l.find(xR);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}var yR=Bh("Slot");function vR(r){const e=w.forwardRef((t,n)=>{let{children:s,...a}=t;if(tb(s)&&typeof Ll=="function"&&(s=Ll(s._payload)),w.isValidElement(s)){const c=SR(s),l=wR(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var bR=Symbol("radix.slottable");function xR(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===bR}function wR(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function SR(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function nb(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=nb(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function sb(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=nb(r))&&(n&&(n+=" "),n+=e);return n}const Q0=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,V0=sb,Fh=(r,e)=>t=>{var n;if(e?.variants==null)return V0(r,t?.class,t?.className);const{variants:s,defaultVariants:a}=e,c=Object.keys(s).map(f=>{const p=t?.[f],m=a?.[f];if(p===null)return null;const y=Q0(p)||Q0(m);return s[f][y]}),l=t&&Object.entries(t).reduce((f,p)=>{let[m,y]=p;return y===void 0||(f[m]=y),f},{}),d=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((f,p)=>{let{class:m,className:y,...b}=p;return Object.entries(b).every(S=>{let[M,E]=S;return Array.isArray(E)?E.includes({...a,...l}[M]):{...a,...l}[M]===E})?[...f,m,y]:f},[]);return V0(r,c,d,t?.class,t?.className)},MR=(r,e)=>{const t=new Array(r.length+e.length);for(let n=0;n<r.length;n++)t[n]=r[n];for(let n=0;n<e.length;n++)t[r.length+n]=e[n];return t},CR=(r,e)=>({classGroupId:r,validator:e}),ib=(r=new Map,e=null,t)=>({nextPart:r,validators:e,classGroupId:t}),Il="-",G0=[],ER="arbitrary..",RR=r=>{const e=TR(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:c=>{if(c.startsWith("[")&&c.endsWith("]"))return kR(c);const l=c.split(Il),d=l[0]===""&&l.length>1?1:0;return ab(l,d,e)},getConflictingClassGroupIds:(c,l)=>{if(l){const d=n[c],f=t[c];return d?f?MR(f,d):d:f||G0}return t[c]||G0}}},ab=(r,e,t)=>{if(r.length-e===0)return t.classGroupId;const s=r[e],a=t.nextPart.get(s);if(a){const f=ab(r,e+1,a);if(f)return f}const c=t.validators;if(c===null)return;const l=e===0?r.join(Il):r.slice(e).join(Il),d=c.length;for(let f=0;f<d;f++){const p=c[f];if(p.validator(l))return p.classGroupId}},kR=r=>r.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=r.slice(1,-1),t=e.indexOf(":"),n=e.slice(0,t);return n?ER+n:void 0})(),TR=r=>{const{theme:e,classGroups:t}=r;return AR(t,e)},AR=(r,e)=>{const t=ib();for(const n in r){const s=r[n];Qh(s,t,n,e)}return t},Qh=(r,e,t,n)=>{const s=r.length;for(let a=0;a<s;a++){const c=r[a];DR(c,e,t,n)}},DR=(r,e,t,n)=>{if(typeof r=="string"){_R(r,e,t);return}if(typeof r=="function"){NR(r,e,t,n);return}jR(r,e,t,n)},_R=(r,e,t)=>{const n=r===""?e:ob(e,r);n.classGroupId=t},NR=(r,e,t,n)=>{if(PR(r)){Qh(r(n),e,t,n);return}e.validators===null&&(e.validators=[]),e.validators.push(CR(t,r))},jR=(r,e,t,n)=>{const s=Object.entries(r),a=s.length;for(let c=0;c<a;c++){const[l,d]=s[c];Qh(d,ob(e,l),t,n)}},ob=(r,e)=>{let t=r;const n=e.split(Il),s=n.length;for(let a=0;a<s;a++){const c=n[a];let l=t.nextPart.get(c);l||(l=ib(),t.nextPart.set(c,l)),t=l}return t},PR=r=>"isThemeGetter"in r&&r.isThemeGetter===!0,zR=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),n=Object.create(null);const s=(a,c)=>{t[a]=c,e++,e>r&&(e=0,n=t,t=Object.create(null))};return{get(a){let c=t[a];if(c!==void 0)return c;if((c=n[a])!==void 0)return s(a,c),c},set(a,c){a in t?t[a]=c:s(a,c)}}},bh="!",K0=":",LR=[],Y0=(r,e,t,n,s)=>({modifiers:r,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:n,isExternal:s}),IR=r=>{const{prefix:e,experimentalParseClassName:t}=r;let n=s=>{const a=[];let c=0,l=0,d=0,f;const p=s.length;for(let M=0;M<p;M++){const E=s[M];if(c===0&&l===0){if(E===K0){a.push(s.slice(d,M)),d=M+1;continue}if(E==="/"){f=M;continue}}E==="["?c++:E==="]"?c--:E==="("?l++:E===")"&&l--}const m=a.length===0?s:s.slice(d);let y=m,b=!1;m.endsWith(bh)?(y=m.slice(0,-1),b=!0):m.startsWith(bh)&&(y=m.slice(1),b=!0);const S=f&&f>d?f-d:void 0;return Y0(a,b,y,S)};if(e){const s=e+K0,a=n;n=c=>c.startsWith(s)?a(c.slice(s.length)):Y0(LR,!1,c,void 0,!0)}if(t){const s=n;n=a=>t({className:a,parseClassName:s})}return n},OR=r=>{const e=new Map;return r.orderSensitiveModifiers.forEach((t,n)=>{e.set(t,1e6+n)}),t=>{const n=[];let s=[];for(let a=0;a<t.length;a++){const c=t[a],l=c[0]==="[",d=e.has(c);l||d?(s.length>0&&(s.sort(),n.push(...s),s=[]),n.push(c)):s.push(c)}return s.length>0&&(s.sort(),n.push(...s)),n}},HR=r=>({cache:zR(r.cacheSize),parseClassName:IR(r),sortModifiers:OR(r),...RR(r)}),qR=/\s+/,UR=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:a}=e,c=[],l=r.trim().split(qR);let d="";for(let f=l.length-1;f>=0;f-=1){const p=l[f],{isExternal:m,modifiers:y,hasImportantModifier:b,baseClassName:S,maybePostfixModifierPosition:M}=t(p);if(m){d=p+(d.length>0?" "+d:d);continue}let E=!!M,C=n(E?S.substring(0,M):S);if(!C){if(!E){d=p+(d.length>0?" "+d:d);continue}if(C=n(S),!C){d=p+(d.length>0?" "+d:d);continue}E=!1}const T=y.length===0?"":y.length===1?y[0]:a(y).join(":"),k=b?T+bh:T,A=k+C;if(c.indexOf(A)>-1)continue;c.push(A);const _=s(C,E);for(let N=0;N<_.length;++N){const L=_[N];c.push(k+L)}d=p+(d.length>0?" "+d:d)}return d},$R=(...r)=>{let e=0,t,n,s="";for(;e<r.length;)(t=r[e++])&&(n=rb(t))&&(s&&(s+=" "),s+=n);return s},rb=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=rb(r[n]))&&(t&&(t+=" "),t+=e);return t},BR=(r,...e)=>{let t,n,s,a;const c=d=>{const f=e.reduce((p,m)=>m(p),r());return t=HR(f),n=t.cache.get,s=t.cache.set,a=l,l(d)},l=d=>{const f=n(d);if(f)return f;const p=UR(d,t);return s(d,p),p};return a=c,(...d)=>a($R(...d))},FR=[],Ft=r=>{const e=t=>t[r]||FR;return e.isThemeGetter=!0,e},cb=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,lb=/^\((?:(\w[\w-]*):)?(.+)\)$/i,QR=/^\d+\/\d+$/,VR=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,GR=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,KR=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,YR=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,WR=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,lo=r=>QR.test(r),qe=r=>!!r&&!Number.isNaN(Number(r)),Ni=r=>!!r&&Number.isInteger(Number(r)),Xf=r=>r.endsWith("%")&&qe(r.slice(0,-1)),ei=r=>VR.test(r),XR=()=>!0,JR=r=>GR.test(r)&&!KR.test(r),ub=()=>!1,ZR=r=>YR.test(r),ek=r=>WR.test(r),tk=r=>!we(r)&&!Se(r),nk=r=>Co(r,hb,ub),we=r=>cb.test(r),ua=r=>Co(r,pb,JR),Jf=r=>Co(r,rk,qe),W0=r=>Co(r,db,ub),sk=r=>Co(r,fb,ek),fl=r=>Co(r,gb,ZR),Se=r=>lb.test(r),Mr=r=>Eo(r,pb),ik=r=>Eo(r,ck),X0=r=>Eo(r,db),ak=r=>Eo(r,hb),ok=r=>Eo(r,fb),hl=r=>Eo(r,gb,!0),Co=(r,e,t)=>{const n=cb.exec(r);return n?n[1]?e(n[1]):t(n[2]):!1},Eo=(r,e,t=!1)=>{const n=lb.exec(r);return n?n[1]?e(n[1]):t:!1},db=r=>r==="position"||r==="percentage",fb=r=>r==="image"||r==="url",hb=r=>r==="length"||r==="size"||r==="bg-size",pb=r=>r==="length",rk=r=>r==="number",ck=r=>r==="family-name",gb=r=>r==="shadow",lk=()=>{const r=Ft("color"),e=Ft("font"),t=Ft("text"),n=Ft("font-weight"),s=Ft("tracking"),a=Ft("leading"),c=Ft("breakpoint"),l=Ft("container"),d=Ft("spacing"),f=Ft("radius"),p=Ft("shadow"),m=Ft("inset-shadow"),y=Ft("text-shadow"),b=Ft("drop-shadow"),S=Ft("blur"),M=Ft("perspective"),E=Ft("aspect"),C=Ft("ease"),T=Ft("animate"),k=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],_=()=>[...A(),Se,we],N=()=>["auto","hidden","clip","visible","scroll"],L=()=>["auto","contain","none"],q=()=>[Se,we,d],Z=()=>[lo,"full","auto",...q()],se=()=>[Ni,"none","subgrid",Se,we],ce=()=>["auto",{span:["full",Ni,Se,we]},Ni,Se,we],J=()=>[Ni,"auto",Se,we],te=()=>["auto","min","max","fr",Se,we],le=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],ue=()=>["start","end","center","stretch","center-safe","end-safe"],z=()=>["auto",...q()],j=()=>[lo,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...q()],O=()=>[r,Se,we],W=()=>[...A(),X0,W0,{position:[Se,we]}],he=()=>["no-repeat",{repeat:["","x","y","space","round"]}],P=()=>["auto","cover","contain",ak,nk,{size:[Se,we]}],F=()=>[Xf,Mr,ua],Y=()=>["","none","full",f,Se,we],ie=()=>["",qe,Mr,ua],B=()=>["solid","dashed","dotted","double"],ae=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$=()=>[qe,Xf,X0,W0],G=()=>["","none",S,Se,we],pe=()=>["none",qe,Se,we],me=()=>["none",qe,Se,we],ye=()=>[qe,Se,we],ve=()=>[lo,"full",...q()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ei],breakpoint:[ei],color:[XR],container:[ei],"drop-shadow":[ei],ease:["in","out","in-out"],font:[tk],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ei],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ei],shadow:[ei],spacing:["px",qe],text:[ei],"text-shadow":[ei],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",lo,we,Se,E]}],container:["container"],columns:[{columns:[qe,we,Se,l]}],"break-after":[{"break-after":k()}],"break-before":[{"break-before":k()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:_()}],overflow:[{overflow:N()}],"overflow-x":[{"overflow-x":N()}],"overflow-y":[{"overflow-y":N()}],overscroll:[{overscroll:L()}],"overscroll-x":[{"overscroll-x":L()}],"overscroll-y":[{"overscroll-y":L()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Z()}],"inset-x":[{"inset-x":Z()}],"inset-y":[{"inset-y":Z()}],start:[{start:Z()}],end:[{end:Z()}],top:[{top:Z()}],right:[{right:Z()}],bottom:[{bottom:Z()}],left:[{left:Z()}],visibility:["visible","invisible","collapse"],z:[{z:[Ni,"auto",Se,we]}],basis:[{basis:[lo,"full","auto",l,...q()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[qe,lo,"auto","initial","none",we]}],grow:[{grow:["",qe,Se,we]}],shrink:[{shrink:["",qe,Se,we]}],order:[{order:[Ni,"first","last","none",Se,we]}],"grid-cols":[{"grid-cols":se()}],"col-start-end":[{col:ce()}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":se()}],"row-start-end":[{row:ce()}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":te()}],"auto-rows":[{"auto-rows":te()}],gap:[{gap:q()}],"gap-x":[{"gap-x":q()}],"gap-y":[{"gap-y":q()}],"justify-content":[{justify:[...le(),"normal"]}],"justify-items":[{"justify-items":[...ue(),"normal"]}],"justify-self":[{"justify-self":["auto",...ue()]}],"align-content":[{content:["normal",...le()]}],"align-items":[{items:[...ue(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...ue(),{baseline:["","last"]}]}],"place-content":[{"place-content":le()}],"place-items":[{"place-items":[...ue(),"baseline"]}],"place-self":[{"place-self":["auto",...ue()]}],p:[{p:q()}],px:[{px:q()}],py:[{py:q()}],ps:[{ps:q()}],pe:[{pe:q()}],pt:[{pt:q()}],pr:[{pr:q()}],pb:[{pb:q()}],pl:[{pl:q()}],m:[{m:z()}],mx:[{mx:z()}],my:[{my:z()}],ms:[{ms:z()}],me:[{me:z()}],mt:[{mt:z()}],mr:[{mr:z()}],mb:[{mb:z()}],ml:[{ml:z()}],"space-x":[{"space-x":q()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":q()}],"space-y-reverse":["space-y-reverse"],size:[{size:j()}],w:[{w:[l,"screen",...j()]}],"min-w":[{"min-w":[l,"screen","none",...j()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[c]},...j()]}],h:[{h:["screen","lh",...j()]}],"min-h":[{"min-h":["screen","lh","none",...j()]}],"max-h":[{"max-h":["screen","lh",...j()]}],"font-size":[{text:["base",t,Mr,ua]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,Se,Jf]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Xf,we]}],"font-family":[{font:[ik,we,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,Se,we]}],"line-clamp":[{"line-clamp":[qe,"none",Se,Jf]}],leading:[{leading:[a,...q()]}],"list-image":[{"list-image":["none",Se,we]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Se,we]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...B(),"wavy"]}],"text-decoration-thickness":[{decoration:[qe,"from-font","auto",Se,ua]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[qe,"auto",Se,we]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:q()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Se,we]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Se,we]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:W()}],"bg-repeat":[{bg:he()}],"bg-size":[{bg:P()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Ni,Se,we],radial:["",Se,we],conic:[Ni,Se,we]},ok,sk]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:F()}],"gradient-via-pos":[{via:F()}],"gradient-to-pos":[{to:F()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:ie()}],"border-w-x":[{"border-x":ie()}],"border-w-y":[{"border-y":ie()}],"border-w-s":[{"border-s":ie()}],"border-w-e":[{"border-e":ie()}],"border-w-t":[{"border-t":ie()}],"border-w-r":[{"border-r":ie()}],"border-w-b":[{"border-b":ie()}],"border-w-l":[{"border-l":ie()}],"divide-x":[{"divide-x":ie()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ie()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...B(),"hidden","none"]}],"divide-style":[{divide:[...B(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...B(),"none","hidden"]}],"outline-offset":[{"outline-offset":[qe,Se,we]}],"outline-w":[{outline:["",qe,Mr,ua]}],"outline-color":[{outline:O()}],shadow:[{shadow:["","none",p,hl,fl]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",m,hl,fl]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[qe,ua]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":ie()}],"inset-ring-color":[{"inset-ring":O()}],"text-shadow":[{"text-shadow":["none",y,hl,fl]}],"text-shadow-color":[{"text-shadow":O()}],opacity:[{opacity:[qe,Se,we]}],"mix-blend":[{"mix-blend":[...ae(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ae()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[qe]}],"mask-image-linear-from-pos":[{"mask-linear-from":$()}],"mask-image-linear-to-pos":[{"mask-linear-to":$()}],"mask-image-linear-from-color":[{"mask-linear-from":O()}],"mask-image-linear-to-color":[{"mask-linear-to":O()}],"mask-image-t-from-pos":[{"mask-t-from":$()}],"mask-image-t-to-pos":[{"mask-t-to":$()}],"mask-image-t-from-color":[{"mask-t-from":O()}],"mask-image-t-to-color":[{"mask-t-to":O()}],"mask-image-r-from-pos":[{"mask-r-from":$()}],"mask-image-r-to-pos":[{"mask-r-to":$()}],"mask-image-r-from-color":[{"mask-r-from":O()}],"mask-image-r-to-color":[{"mask-r-to":O()}],"mask-image-b-from-pos":[{"mask-b-from":$()}],"mask-image-b-to-pos":[{"mask-b-to":$()}],"mask-image-b-from-color":[{"mask-b-from":O()}],"mask-image-b-to-color":[{"mask-b-to":O()}],"mask-image-l-from-pos":[{"mask-l-from":$()}],"mask-image-l-to-pos":[{"mask-l-to":$()}],"mask-image-l-from-color":[{"mask-l-from":O()}],"mask-image-l-to-color":[{"mask-l-to":O()}],"mask-image-x-from-pos":[{"mask-x-from":$()}],"mask-image-x-to-pos":[{"mask-x-to":$()}],"mask-image-x-from-color":[{"mask-x-from":O()}],"mask-image-x-to-color":[{"mask-x-to":O()}],"mask-image-y-from-pos":[{"mask-y-from":$()}],"mask-image-y-to-pos":[{"mask-y-to":$()}],"mask-image-y-from-color":[{"mask-y-from":O()}],"mask-image-y-to-color":[{"mask-y-to":O()}],"mask-image-radial":[{"mask-radial":[Se,we]}],"mask-image-radial-from-pos":[{"mask-radial-from":$()}],"mask-image-radial-to-pos":[{"mask-radial-to":$()}],"mask-image-radial-from-color":[{"mask-radial-from":O()}],"mask-image-radial-to-color":[{"mask-radial-to":O()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":A()}],"mask-image-conic-pos":[{"mask-conic":[qe]}],"mask-image-conic-from-pos":[{"mask-conic-from":$()}],"mask-image-conic-to-pos":[{"mask-conic-to":$()}],"mask-image-conic-from-color":[{"mask-conic-from":O()}],"mask-image-conic-to-color":[{"mask-conic-to":O()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:W()}],"mask-repeat":[{mask:he()}],"mask-size":[{mask:P()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Se,we]}],filter:[{filter:["","none",Se,we]}],blur:[{blur:G()}],brightness:[{brightness:[qe,Se,we]}],contrast:[{contrast:[qe,Se,we]}],"drop-shadow":[{"drop-shadow":["","none",b,hl,fl]}],"drop-shadow-color":[{"drop-shadow":O()}],grayscale:[{grayscale:["",qe,Se,we]}],"hue-rotate":[{"hue-rotate":[qe,Se,we]}],invert:[{invert:["",qe,Se,we]}],saturate:[{saturate:[qe,Se,we]}],sepia:[{sepia:["",qe,Se,we]}],"backdrop-filter":[{"backdrop-filter":["","none",Se,we]}],"backdrop-blur":[{"backdrop-blur":G()}],"backdrop-brightness":[{"backdrop-brightness":[qe,Se,we]}],"backdrop-contrast":[{"backdrop-contrast":[qe,Se,we]}],"backdrop-grayscale":[{"backdrop-grayscale":["",qe,Se,we]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[qe,Se,we]}],"backdrop-invert":[{"backdrop-invert":["",qe,Se,we]}],"backdrop-opacity":[{"backdrop-opacity":[qe,Se,we]}],"backdrop-saturate":[{"backdrop-saturate":[qe,Se,we]}],"backdrop-sepia":[{"backdrop-sepia":["",qe,Se,we]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":q()}],"border-spacing-x":[{"border-spacing-x":q()}],"border-spacing-y":[{"border-spacing-y":q()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Se,we]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[qe,"initial",Se,we]}],ease:[{ease:["linear","initial",C,Se,we]}],delay:[{delay:[qe,Se,we]}],animate:[{animate:["none",T,Se,we]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[M,Se,we]}],"perspective-origin":[{"perspective-origin":_()}],rotate:[{rotate:pe()}],"rotate-x":[{"rotate-x":pe()}],"rotate-y":[{"rotate-y":pe()}],"rotate-z":[{"rotate-z":pe()}],scale:[{scale:me()}],"scale-x":[{"scale-x":me()}],"scale-y":[{"scale-y":me()}],"scale-z":[{"scale-z":me()}],"scale-3d":["scale-3d"],skew:[{skew:ye()}],"skew-x":[{"skew-x":ye()}],"skew-y":[{"skew-y":ye()}],transform:[{transform:[Se,we,"","none","gpu","cpu"]}],"transform-origin":[{origin:_()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ve()}],"translate-x":[{"translate-x":ve()}],"translate-y":[{"translate-y":ve()}],"translate-z":[{"translate-z":ve()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Se,we]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":q()}],"scroll-mx":[{"scroll-mx":q()}],"scroll-my":[{"scroll-my":q()}],"scroll-ms":[{"scroll-ms":q()}],"scroll-me":[{"scroll-me":q()}],"scroll-mt":[{"scroll-mt":q()}],"scroll-mr":[{"scroll-mr":q()}],"scroll-mb":[{"scroll-mb":q()}],"scroll-ml":[{"scroll-ml":q()}],"scroll-p":[{"scroll-p":q()}],"scroll-px":[{"scroll-px":q()}],"scroll-py":[{"scroll-py":q()}],"scroll-ps":[{"scroll-ps":q()}],"scroll-pe":[{"scroll-pe":q()}],"scroll-pt":[{"scroll-pt":q()}],"scroll-pr":[{"scroll-pr":q()}],"scroll-pb":[{"scroll-pb":q()}],"scroll-pl":[{"scroll-pl":q()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Se,we]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[qe,Mr,ua,Jf]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},uk=BR(lk);function Re(...r){return uk(sb(r))}function QO(r,e){return r?{...e,...r}:e}const Vh=Fh("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ke=w.forwardRef(({className:r,variant:e,size:t,asChild:n=!1,...s},a)=>{const c=n?yR:"button";return g.jsx(c,{className:Re(Vh({variant:e,size:t,className:r})),ref:a,...s})});ke.displayName="Button";var qr=Gv();const dk=Hh(qr);var fk=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],hk=fk.reduce((r,e)=>{const t=Bh(`Primitive.${e}`),n=w.forwardRef((s,a)=>{const{asChild:c,...l}=s,d=c?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...r,[e]:n}},{}),pk="Separator",J0="horizontal",gk=["horizontal","vertical"],mb=w.forwardRef((r,e)=>{const{decorative:t,orientation:n=J0,...s}=r,a=mk(n)?n:J0,l=t?{role:"none"}:{"aria-orientation":a==="vertical"?a:void 0,role:"separator"};return g.jsx(hk.div,{"data-orientation":a,...l,...s,ref:e})});mb.displayName=pk;function mk(r){return gk.includes(r)}var yb=mb;const xn=w.forwardRef(({className:r,orientation:e="horizontal",decorative:t=!0,...n},s)=>g.jsx(yb,{ref:s,decorative:t,orientation:e,className:Re("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...n}));xn.displayName=yb.displayName;const Z0=r=>{let e;const t=new Set,n=(f,p)=>{const m=typeof f=="function"?f(e):f;if(!Object.is(m,e)){const y=e;e=p??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(b=>b(e,y))}},s=()=>e,l={setState:n,getState:s,getInitialState:()=>d,subscribe:f=>(t.add(f),()=>t.delete(f))},d=e=r(n,s,l);return l},yk=(r=>r?Z0(r):Z0),vk=r=>r;function bk(r,e=vk){const t=kt.useSyncExternalStore(r.subscribe,kt.useCallback(()=>e(r.getState()),[r,e]),kt.useCallback(()=>e(r.getInitialState()),[r,e]));return kt.useDebugValue(t),t}const ev=r=>{const e=yk(r),t=n=>bk(e,n);return Object.assign(t,e),t},us=(r=>r?ev(r):ev);class xk{nodes=[];connections=[];handlers=new Map;postgresQueryEngine=null;messageQueue=new Map;messageHistory=[];isRunning=!1;updateInterval=200;intervalId=null;messageIdCounter=0;MAX_HISTORY=1e3;traceContexts=new Map;traceIdCounter=0;constructor(){this.registerDefaultHandlers()}registerDefaultHandlers(){this.registerHandler("crm",this.createBusinessDataHandler("crm")),this.registerHandler("erp",this.createBusinessDataHandler("erp")),this.registerHandler("payment-gateway",this.createBusinessDataHandler("payment")),this.registerHandler("postgres",this.createDatabaseHandler("postgres")),this.registerHandler("mongodb",this.createDatabaseHandler("mongodb")),this.registerHandler("redis",this.createDatabaseHandler("redis")),this.registerHandler("cassandra",this.createDatabaseHandler("cassandra")),this.registerHandler("clickhouse",this.createDatabaseHandler("clickhouse")),this.registerHandler("snowflake",this.createDatabaseHandler("snowflake")),this.registerHandler("elasticsearch",this.createDatabaseHandler("elasticsearch")),this.registerHandler("s3-datalake",this.createStorageHandler("s3-datalake")),this.registerHandler("kafka",this.createMessageBrokerHandler("kafka")),this.registerHandler("rabbitmq",this.createMessageBrokerHandler("rabbitmq")),this.registerHandler("activemq",this.createMessageBrokerHandler("activemq")),this.registerHandler("aws-sqs",this.createMessageBrokerHandler("aws-sqs")),this.registerHandler("gcp-pubsub",this.createMessageBrokerHandler("gcp-pubsub")),this.registerHandler("rest",this.createAPIHandler("rest")),this.registerHandler("grpc",this.createAPIHandler("grpc")),this.registerHandler("graphql",this.createAPIHandler("graphql")),this.registerHandler("websocket",this.createAPIHandler("websocket")),this.registerHandler("kong",this.createIntegrationHandler("kong")),this.registerHandler("nginx",this.createIntegrationHandler("nginx")),this.registerHandler("apigee",this.createIntegrationHandler("apigee")),this.registerHandler("mulesoft",this.createIntegrationHandler("mulesoft")),this.registerHandler("graphql-gateway",this.createIntegrationHandler("graphql-gateway")),this.registerHandler("bff-service",this.createIntegrationHandler("bff-service")),this.registerHandler("webhook-relay",this.createIntegrationHandler("webhook-relay")),this.registerHandler("loki",this.createLokiHandler()),this.registerHandler("otel-collector",this.createOpenTelemetryCollectorHandler()),this.registerHandler("keycloak",this.createKeycloakHandler()),this.registerHandler("secrets-vault",this.createVaultHandler()),this.registerHandler("waf",this.createWAFHandler()),this.registerHandler("firewall",this.createFirewallHandler()),this.registerHandler("ids-ips",this.createIDSIPSHandler()),this.registerHandler("jenkins",this.createJenkinsHandler()),this.registerHandler("gitlab-ci",this.createGitLabCIHandler()),this.registerHandler("argo-cd",this.createArgoCDHandler()),this.registerHandler("terraform",this.createTerraformHandler()),this.registerHandler("harbor",this.createHarborHandler()),this.registerHandler("docker",this.createDockerHandler())}registerHandler(e,t){this.handlers.set(e,t)}initialize(e,t){this.nodes=e,this.connections=t,this.messageQueue.clear(),this.messageHistory=[];for(const n of t)this.messageQueue.set(n.id,[])}updateNodesAndConnections(e,t){this.nodes=e,this.connections=t;const n=new Set(t.map(s=>s.id));for(const[s]of this.messageQueue.entries())n.has(s)||this.messageQueue.delete(s);for(const s of t)this.messageQueue.has(s.id)||this.messageQueue.set(s.id,[])}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.processDataFlow()},this.updateInterval))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}processDataFlow(){this.generateSourceData(),this.processInTransitMessages(),this.deliverMessages()}generateSourceData(){for(const e of this.connections){const t=this.nodes.find(c=>c.id===e.source);if(!t)continue;const n=this.handlers.get(t.type);if(!n?.generateData)continue;const s=t.data.config||{},a=n.generateData(t,s);if(a&&a.length>0){const c=this.messageQueue.get(e.id)||[];for(const l of a)l.connectionId=e.id,l.target=e.target,l.status="pending",l.id=`msg-${++this.messageIdCounter}`,l.timestamp=Date.now(),c.push(l);this.messageQueue.set(e.id,c)}}}processInTransitMessages(){for(const[e,t]of this.messageQueue.entries()){const n=this.connections.find(c=>c.id===e);if(!n)continue;const s=this.nodes.find(c=>c.id===n.source),a=this.nodes.find(c=>c.id===n.target);if(!(!s||!a)){for(const c of t)if(c.status==="pending")this.transformMessageIfNeeded(c,s,a,n)&&(c.status="in-transit",c.latency=this.calculateTransitTime(n));else if(c.status==="in-transit"){const l=Date.now()-c.timestamp;c.latency&&l>=c.latency&&(c.status="delivered")}}}}deliverMessages(){for(const[e,t]of this.messageQueue.entries()){const n=this.connections.find(d=>d.id===e);if(!n)continue;const s=this.nodes.find(d=>d.id===n.target);if(!s)continue;const a=this.handlers.get(s.type);if(!a?.processData)continue;const c=s.data.config||{},l=t.filter(d=>d.status==="delivered");for(const d of l)try{const f=this.nodes.find(m=>m.id===n.source),p=a.processData(s,d,c);p&&(f&&this.generateTraceForMessage(d,f,s,n,p),this.addToHistory(d),t.splice(t.indexOf(d),1))}catch(f){d.status="failed",d.error=f instanceof Error?f.message:"Unknown error";const p=this.nodes.find(m=>m.id===n.source);p&&this.generateTraceForMessage(d,p,s,n,d),this.addToHistory(d),t.splice(t.indexOf(d),1)}this.messageQueue.set(e,t)}}transformMessageIfNeeded(e,t,n,s){const a=this.handlers.get(t.type),c=this.handlers.get(n.type),l=a?.getSupportedFormats?.(t)||[e.format],d=c?.getSupportedFormats?.(n)||[e.format];if(d.includes(e.format))return e;const f=d.find(m=>l.includes(m));if(f)return e.format=f,e.status="transformed",e;const p=this.findIntegrationHandler(s);if(p?.transformData){const m=p.transformData(t,e,n.type,t.data.config||{});if(m)return m}if(a?.transformData){const m=a.transformData(t,e,n.type,t.data.config||{});if(m)return m}return e.status="failed",e.error=`Format ${e.format} not supported by target ${n.type}`,null}findIntegrationHandler(e){const t=this.nodes.find(n=>n.id===e.source);return t&&["kong","apigee","mulesoft","bff-service"].includes(t.type)&&this.handlers.get(t.type)||null}calculateTransitTime(e){const t=e.data||{},n=t.latencyMs||10,s=(t.jitterMs||0)*(Math.random()-.5);return Math.max(1,n+s)}generateTraceForMessage(e,t,n,s,a){const c=De.getAllJaegerEngines();if(c.size===0)return;let l=e.metadata?.traceContext;if(!l){const b=this.generateTraceId(),S=this.generateSpanId();l={traceId:b,spanId:S,sampled:!0},this.traceContexts.set(b,l)}const d=e.timestamp*1e3,f=(e.timestamp+(e.latency||0))*1e3,p=f-d,m=this.getOperationName(e,t,n),y={traceId:l.traceId,spanId:l.spanId,parentSpanId:l.parentSpanId,operationName:m,serviceName:t.data.label||t.type,startTime:d,duration:p,tags:[{key:"component.type",value:t.type},{key:"target.component",value:n.data.label||n.type},{key:"target.type",value:n.type},{key:"message.format",value:e.format},{key:"message.size",value:e.size},{key:"connection.id",value:s.id},{key:"status",value:a.status}],logs:[]};if((a.status==="failed"||a.error)&&(y.tags.push({key:"error",value:!0}),y.logs.push({timestamp:f,fields:[{key:"event",value:"error"},{key:"error.message",value:a.error||"Unknown error"}]})),e.metadata)for(const[b,S]of Object.entries(e.metadata))b!=="traceContext"&&S!==void 0&&S!==null&&y.tags.push({key:`metadata.${b}`,value:String(S)});for(const[,b]of c)b.receiveSpan(y);if(a.status==="delivered"&&n){const b=this.generateSpanId(),S={traceId:l.traceId,spanId:b,parentSpanId:l.spanId,sampled:l.sampled};a.metadata||(a.metadata={}),a.metadata.traceContext=S}}generateTraceId(){return`trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getOperationName(e,t,n){return e.metadata?.operation?String(e.metadata.operation):t.type==="api-gateway"||t.type==="kong"||t.type==="apigee"?`HTTP ${e.metadata?.method||"REQUEST"}`:t.type.includes("database")||t.type==="postgres"||t.type==="mongodb"?`DB ${e.metadata?.queryType||"QUERY"}`:t.type.includes("queue")||t.type==="rabbitmq"||t.type==="kafka"?`MQ ${e.metadata?.queue||"SEND"}`:`${t.type} -> ${n.type}`}addToHistory(e){this.messageHistory.push(e),this.messageHistory.length>this.MAX_HISTORY&&this.messageHistory.shift()}getConnectionMessages(e){return this.messageQueue.get(e)||[]}getMessageHistory(e){const t=[...this.messageHistory].reverse();return e?t.slice(0,e):t}getComponentMessages(e){const t=[];for(const n of this.messageQueue.values())for(const s of n)(s.source===e||s.target===e)&&t.push(s);return t}createBusinessDataHandler(e){return{generateData:(t,n)=>{const s=[],a=n.generateInterval||2e3,c=t._lastGenerate||0,l=Date.now();if(l-c<a)return null;switch(t._lastGenerate=l,e){case"crm":s.push(this.createCRMDataMessage(t));break;case"erp":s.push(this.createERPDataMessage(t));break;case"payment":s.push(this.createPaymentDataMessage(t));break}return s},getSupportedFormats:()=>["json","xml"]}}validateMongoDBSchema(e,t){if(!t||!t.$jsonSchema)return{valid:!0};const n=t.$jsonSchema;if(n.required&&Array.isArray(n.required)){for(const s of n.required)if(!(s in e)||e[s]===void 0||e[s]===null)return{valid:!1,error:`Required field "${s}" is missing`}}if(n.properties){for(const[s,a]of Object.entries(n.properties))if(s in e){const c=e[s],l=a;if(l.type){const d=l.type,f=Array.isArray(c)?"array":typeof c;if(d==="string"&&f!=="string")return{valid:!1,error:`Field "${s}" must be of type string`};if(d==="number"&&f!=="number")return{valid:!1,error:`Field "${s}" must be of type number`};if(d==="boolean"&&f!=="boolean")return{valid:!1,error:`Field "${s}" must be of type boolean`};if(d==="array"&&f!=="array")return{valid:!1,error:`Field "${s}" must be of type array`};if(d==="object"&&(f!=="object"||Array.isArray(c)))return{valid:!1,error:`Field "${s}" must be of type object`}}}}return{valid:!0}}createDatabaseHandler(e){return{processData:(t,n,s)=>{if(e==="postgres"&&n.payload?.sql)return this.processPostgreSQLQuery(t,n,s);if(e==="redis")return this.processRedisCommand(t,n,s);if(e==="cassandra")return this.processCQLQuery(t,n,s);if(e==="clickhouse")return this.processClickHouseQuery(t,n,s);if(e==="snowflake")return this.processSnowflakeQuery(t,n,s);if(e==="elasticsearch")return this.processElasticsearchOperation(t,n,s);const a=n.payload?.operation||"insert";switch(a){case"insert":case"update":{const l=s.queryLatency||10;if(n.latency=l,e==="mongodb"){const f=t.data.config?.collections||[],p=n.payload;let m=p?.collection;if(!m&&f.length>0&&(p?.type?m=f.find(b=>b.name.toLowerCase().includes(p.type.toLowerCase()))?.name||f[0].name:m=f[0].name),m){const y=f.find(b=>b.name===m);if(y){if(y.validation){const b=y.validation;if(b.validationLevel!=="off"){const M={...p?.document||p?.data||p};delete M._id;const E=this.validateMongoDBSchema(M,b.validator);if(!E.valid){if(b.validationAction==="error")return n.status="failed",n.error=`Schema validation failed for collection "${m}": ${E.error}`,n;b.validationAction==="warn"&&(n.metadata={...n.metadata,validationWarning:E.error,collection:m})}}}a==="insert"?n.metadata={...n.metadata,collection:m,documentStored:!0}:a==="update"&&(n.metadata={...n.metadata,collection:m,documentUpdated:!0})}else return n.status="failed",n.error=`Collection "${m}" not found`,n}}return n.status="delivered",n}case"delete":const c=s.queryLatency||10;return n.latency=c,n.status="delivered",n;case"query":{let l=[];if(e==="mongodb"){const f=t.data.config?.collections||[],p=n.payload,m=p?.collection||f[0]?.name;if(m){const y=f.find(b=>b.name===m);if(y?.documents&&y.documents.length>0){if(l=y.documents.map(S=>({...S})),p?.filter)try{const S=typeof p.filter=="string"?JSON.parse(p.filter):p.filter;l=l.filter(M=>{for(const[E,C]of Object.entries(S))if(M[E]!==C)return!1;return!0})}catch{}const b=p?.limit||100;l=l.slice(0,b)}else l=this.generateQueryResults(e,p?.query)}else l=this.generateQueryResults(e,p?.query)}else l=this.generateQueryResults(e,n.payload?.query);return n.payload={...n.payload,results:l},n.status="delivered",n}default:return n.status="failed",n.error=`Unknown operation: ${a}`,n}},getSupportedFormats:()=>["json","binary"]}}processClickHouseQuery(e,t,n){const s=t.payload,a=De.getClickHouseRoutingEngine(e.id);if(!a)return t.status="failed",t.error="ClickHouse Routing Engine not initialized",t;let c;if(s?.sql)c=s.sql;else if(s?.query)c=s.query;else if(typeof s=="string")c=s;else{const d=s?.operation||"select",f=e.data.config,p=s?.database||f?.database||"default",m=s?.table||"default_table";switch(d.toLowerCase()){case"select":case"read":case"query":c=`SELECT * FROM ${p}.${m}`,s?.where&&(c+=` WHERE ${s.where}`),s?.limit&&(c+=` LIMIT ${s.limit}`);break;case"insert":case"write":const y=s?.columns?Object.keys(s.columns).join(", "):"id, data",b=s?.columns?Object.values(s.columns).map(S=>`'${S}'`).join(", "):`${Date.now()}, 'data'`;c=`INSERT INTO ${p}.${m} (${y}) VALUES (${b})`;break;default:return t.status="failed",t.error=`Unknown ClickHouse operation: ${d}`,t}}const l=a.executeQuery(c);return l.success?(t.status="delivered",t.latency=l.latency||45,t.payload={...t.payload,sql:c,rows:l.rows||[],rowCount:l.rowCount||0,columns:l.columns||[],dataRead:l.dataRead,dataWritten:l.dataWritten,clickHouseResult:l.rows},t.metadata={...t.metadata,clickHouseQuery:c,rowsRead:l.dataRead,rowsWritten:l.dataWritten}):(t.status="failed",t.error=l.error||"ClickHouse query execution failed",t.latency=l.latency||0),t}processSnowflakeQuery(e,t,n){const s=t.payload,a=De.getSnowflakeRoutingEngine(e.id);if(!a)return t.status="failed",t.error="Snowflake Routing Engine not initialized",t;let c,l,d,f;if(s?.sql)c=s.sql,l=s.warehouse,d=s.database,f=s.schema;else if(s?.query)c=s.query,l=s.warehouse,d=s.database,f=s.schema;else if(typeof s=="string")c=s;else{const m=s?.operation||"select",y=e.data.config;d=s?.database||y?.database||"PUBLIC",f=s?.schema||y?.schema||"PUBLIC",l=s?.warehouse||y?.warehouse;const b=s?.table||"default_table";switch(m.toLowerCase()){case"select":case"read":case"query":c=`SELECT * FROM ${d}.${f}.${b}`,s?.where&&(c+=` WHERE ${s.where}`),s?.limit&&(c+=` LIMIT ${s.limit}`);break;case"insert":case"write":const S=s?.columns?Object.keys(s.columns).join(", "):"id, data",M=s?.columns?Object.values(s.columns).map(E=>`'${E}'`).join(", "):`${Date.now()}, 'data'`;c=`INSERT INTO ${d}.${f}.${b} (${S}) VALUES (${M})`;break;default:return t.status="failed",t.error=`Unknown Snowflake operation: ${m}`,t}}const p=a.executeQuery(c,l,d,f);return p.success?(t.status="delivered",t.latency=p.latency||50,t.payload={...t.payload,sql:c,rows:p.rows||[],rowCount:p.rowCount||0,columns:p.columns||[],dataRead:p.dataRead,dataWritten:p.dataWritten,snowflakeResult:p.rows,queryId:p.queryId,warehouse:p.warehouse,resultCacheUsed:p.resultCacheUsed},t.metadata={...t.metadata,snowflakeQuery:c,rowsRead:p.dataRead,rowsWritten:p.dataWritten,warehouse:p.warehouse,queryId:p.queryId,cacheHit:p.resultCacheUsed||!1}):(t.status="failed",t.error=p.error||"Snowflake query execution failed",t.latency=p.latency||0),t}processElasticsearchOperation(e,t,n){const s=t.payload,a=De.getElasticsearchRoutingEngine(e.id);if(!a)return t.status="failed",t.error="Elasticsearch Routing Engine not initialized",t;const c=s?.operation||s?.method||"index",l=s?.index||s?._index||e.data.config?.index||"archiphoenix-index",d=s?.id||s?._id,f=s?.document||s?._source||s?.body||s,p=s?.query,m=s?.routing||s?._routing;let y;switch(c.toLowerCase()){case"index":case"create":case"update":if(!d||!f)return t.status="failed",t.error="Index operation requires id and document",t;y=a.indexDocument(l,d,f,m);break;case"get":case"read":if(!d)return t.status="failed",t.error="Get operation requires id",t;y=a.getDocument(l,d,m);break;case"search":case"query":p?y=a.search(l,p):s?.queryString?y=a.executeQuery(s.queryString):y=a.search(l,{query:{match_all:{}}});break;case"delete":if(!d)return t.status="failed",t.error="Delete operation requires id",t;y=a.deleteDocument(l,d,m);break;default:if(typeof s=="string"||s?.queryString){const b=typeof s=="string"?s:s.queryString;y=a.executeQuery(b)}else return t.status="failed",t.error=`Unsupported Elasticsearch operation: ${c}`,t}return y.success?(t.status="delivered",t.latency=y.latency||y.took||10,t.payload={...t.payload,operation:y.operation,index:y.index,id:y.id,document:y.document,hits:y.hits,took:y.took,elasticsearchResult:y},t.metadata={...t.metadata,elasticsearchOperation:y.operation,index:y.index,hits:y.hits,took:y.took}):(t.status="failed",t.error=y.error||"Elasticsearch operation failed",t.latency=y.latency||y.took||0),t}createStorageHandler(e){return e==="s3-datalake"?{processData:(t,n,s)=>this.processS3Operation(t,n,s),getSupportedFormats:()=>["json","binary","text","xml"]}:{processData:(t,n,s)=>(n.status="delivered",n.latency=50,n),getSupportedFormats:()=>["json","binary","text"]}}processS3Operation(e,t,n){const s=t.payload,a=De.getS3RoutingEngine(e.id);if(!a)return t.status="failed",t.error="S3 Routing Engine not initialized",t;const c=s?.operation||s?.method||"PUT",l=s?.bucket||s?.bucketName||e.data.config?.buckets?.[0]?.name||"default-bucket",d=s?.key||s?.objectKey||t.metadata?.key,f=s?.versionId||t.metadata?.versionId;let p;switch(c.toUpperCase()){case"PUT":case"UPLOAD":if(!d||!t.payload)return t.status="failed",t.error="PUT operation requires key and payload",t;const m=s?.data||s?.body||t.payload,y=s?.contentType||t.metadata?.contentType,b=s?.metadata||t.metadata;p=a.putObject(l,d,m,t.size,b,y);break;case"GET":case"DOWNLOAD":if(!d)return t.status="failed",t.error="GET operation requires key",t;p=a.getObject(l,d,f);break;case"DELETE":if(!d)return t.status="failed",t.error="DELETE operation requires key",t;p=a.deleteObject(l,d,f);break;case"LIST":const S=s?.prefix||t.metadata?.prefix,M=s?.maxKeys||s?.maxKeys||1e3;p=a.listObjects(l,S,M);break;case"HEAD":if(!d)return t.status="failed",t.error="HEAD operation requires key",t;p=a.headObject(l,d);break;default:return t.status="failed",t.error=`Unsupported S3 operation: ${c}`,t}return p.success?(t.status="delivered",t.latency=p.latency||50,p.object?t.payload={...t.payload,operation:c.toUpperCase(),bucket:l,key:d,object:p.object,etag:p.object.etag,versionId:p.versionId||p.object.versionId,size:p.object.size,storageClass:p.object.storageClass}:p.objects?t.payload={...t.payload,operation:"LIST",bucket:l,objects:p.objects,count:p.objects.length}:t.payload={...t.payload,operation:c.toUpperCase(),bucket:l,key:d,success:!0,versionId:p.versionId,deleteMarker:p.deleteMarker},t.metadata={...t.metadata,s3Operation:c.toUpperCase(),bucket:l,key:d,latency:p.latency}):(t.status="failed",t.error=p.error||`S3 ${c} operation failed`,t.latency=p.latency||0),t}processPostgreSQLQuery(e,t,n){if(!this.postgresQueryEngine)return t.status="failed",t.error="PostgreSQL Query Engine not initialized",t;const s=t.payload?.sql;if(!s||typeof s!="string")return t.status="failed",t.error="No SQL query provided",t;const a=e.data.config,c=a.tables||[],l=this.extractIndexesFromConfig(a,c),d=a.views||[],f=this.postgresQueryEngine.execute(s,c,l,d);return f.success?(t.status="delivered",t.latency=f.executionTime||n.queryLatency||10,t.payload={...t.payload,results:f.rows||[],rowCount:f.rowCount||0,queryPlan:f.queryPlan,indexesUsed:f.indexesUsed||[]}):(t.status="failed",t.error=f.error||"Query execution failed",t.latency=f.executionTime||0),t}processRedisCommand(e,t,n){const s=t.payload,a=De.getRedisRoutingEngine(e.id);if(!a)return t.status="failed",t.error="Redis Routing Engine not initialized",t;let c,l;if(s?.command)c=s.command,l=s.args||[];else if(s?.redisCommand){const f=String(s.redisCommand).trim().split(/\s+/);c=f[0],l=f.slice(1)}else if(typeof s=="string"){const f=s.trim().split(/\s+/);c=f[0],l=f.slice(1)}else{const f=s?.operation||"get";switch(f.toLowerCase()){case"get":c="GET",l=[s?.key||"default:key"];break;case"set":c="SET",l=[s?.key||"default:key",typeof s?.value=="string"?s.value:JSON.stringify(s?.value||"")],s?.ttl&&l.push("EX",String(s.ttl));break;case"delete":case"del":c="DEL",l=Array.isArray(s?.keys)?s.keys:[s?.key||"default:key"];break;case"exists":c="EXISTS",l=Array.isArray(s?.keys)?s.keys:[s?.key||"default:key"];break;default:return t.status="failed",t.error=`Unknown Redis operation: ${f}`,t}}const d=a.executeCommand(c,l);return d.success?(t.status="delivered",t.latency=d.latency||1,t.payload={...t.payload,command:c,args:l,result:d.value,redisResult:d.value}):(t.status="failed",t.error=d.error||"Redis command execution failed",t.latency=d.latency||0),t}processCQLQuery(e,t,n){const s=t.payload,a=De.getCassandraRoutingEngine(e.id);if(!a)return t.status="failed",t.error="Cassandra Routing Engine not initialized",t;let c,l;if(s?.cql)c=s.cql,l=s.consistency;else if(s?.query)c=s.query,l=s.consistency;else if(typeof s=="string")c=s;else{const f=s?.operation||"select",p=e.data.config,m=s?.keyspace||p?.keyspace||"system",y=s?.table||"default_table";switch(f.toLowerCase()){case"select":case"read":c=`SELECT * FROM ${m}.${y}`,s?.limit&&(c+=` LIMIT ${s.limit}`);break;case"insert":case"write":const b=s?.columns?Object.keys(s.columns).join(", "):"id, data",S=s?.columns?Object.values(s.columns).map(C=>`'${C}'`).join(", "):`${Date.now()}, 'data'`;c=`INSERT INTO ${m}.${y} (${b}) VALUES (${S})`;break;case"update":const M=s?.columns||{},E=Object.entries(M).map(([C,T])=>`${C} = '${T}'`).join(", ");c=`UPDATE ${m}.${y} SET ${E}`,s?.where&&(c+=` WHERE ${s.where}`);break;case"delete":c=`DELETE FROM ${m}.${y}`,s?.where&&(c+=` WHERE ${s.where}`);break;default:return t.status="failed",t.error=`Unknown CQL operation: ${f}`,t}}l||(l=e.data.config?.consistencyLevel||"QUORUM");const d=a.executeCQL(c,l);return d.success?(t.status="delivered",t.latency=d.latency||5,t.payload={...t.payload,cql:c,consistency:d.consistency,rows:d.rows||[],rowCount:d.rowCount||0,replicasQueried:d.replicasQueried,cqlResult:d.rows},t.metadata={...t.metadata,cassandraConsistency:d.consistency,cassandraReplicasQueried:d.replicasQueried}):(t.status="failed",t.error=d.error||"CQL query execution failed",t.latency=d.latency||0),t}extractIndexesFromConfig(e,t){const n=[];for(const s of t)for(const a of s.indexes||[]){const c=a.match(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+(\w+)\s+ON\s+\w+\s*\(([^)]+)\)/i);c?n.push({name:c[1],table:s.name,schema:s.schema,columns:c[2].split(",").map(l=>l.trim()),unique:a.toUpperCase().includes("UNIQUE")}):n.push({name:a,table:s.name,schema:s.schema,columns:[a.replace(/^idx_|^index_/i,"")]})}return n}createMessageBrokerHandler(e){return e==="rabbitmq"?{processData:(t,n,s)=>{const a=De.getRabbitMQRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=s?.messaging||n.metadata?.messaging||{},l=c.exchange||"amq.topic",d=c.routingKey||n.metadata?.routingKey||"default",f=n.metadata?.headers,p=n.metadata?.priority,m=a.routeMessage(l,d,n.payload,n.size,f,p);return m.length>0?(n.status="delivered",n.metadata={...n.metadata,routedQueues:m,exchange:l,routingKey:d}):(n.status="failed",n.error=`No queues bound to exchange '${l}' with routing key '${d}'`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="activemq"?{processData:(t,n,s)=>{const a=De.getActiveMQRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=s?.messaging||n.metadata?.messaging||{},l=c.queue,d=c.topic,f=n.metadata?.headers,p=n.metadata?.priority;let m=!1,y="";const b=t.data.config||{},S=b.acls||[],E=this.nodes.find(T=>T.id===n.source)?.data.config,C=n.metadata?.principal||E?.username||E?.clientId||b.username||`user-${n.source.slice(0,8)}`;if(l){if(!(De.checkActiveMQACLPermissionPublic?.(S,C,`queue://${l}`,"write")??!0))return n.status="failed",n.error=`Access denied: principal '${C}' does not have write permission for queue '${l}'`,n;a.routeToQueue(l,n.payload,n.size,f,p)&&(m=!0,y=l)}if(d){if(!(De.checkActiveMQACLPermissionPublic?.(S,C,`topic://${d}`,"write")??!0))return n.status="failed",n.error=`Access denied: principal '${C}' does not have write permission for topic '${d}'`,n;a.publishToTopic(d,n.payload,n.size,f,p).length>0&&(m=!0,y=d)}return m?(n.status="delivered",n.metadata={...n.metadata,destination:y,queue:l||void 0,topic:d||void 0}):(n.status="failed",n.error=`No queue or topic found. Queue: '${l||"none"}', Topic: '${d||"none"}'`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="aws-sqs"?{processData:(t,n,s)=>{const a=De.getSQSRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=s?.messaging||n.metadata?.messaging||{},l=c.queueUrl,d=c.queueName||(l?l.split("/").pop():null)||n.metadata?.queueName||"default-queue",f=t.data.config||{},p=f.iamPolicies||[],y=this.nodes.find(k=>k.id===n.source)?.data.config,b=n.metadata?.principal||y?.accessKeyId||y?.clientId||f.accessKeyId||`arn:aws:iam::123456789012:user/${n.source.slice(0,8)}`;if(!(De.checkSQSIAMPolicy?.(p,b,d,"sqs:SendMessage")??!0))return n.status="failed",n.error=`Access denied: principal '${b}' does not have sqs:SendMessage permission for queue '${d}'`,n;const M=n.metadata?.messageGroupId,E=n.metadata?.messageDeduplicationId,C=n.metadata?.attributes,T=a.sendMessage(d,n.payload,n.size,C,M,E);return T?(n.status="delivered",n.metadata={...n.metadata,queueName:d,messageId:T,queueUrl:l||`https://sqs.${f.defaultRegion||"us-east-1"}.amazonaws.com/.../${d}`}):(n.status="failed",n.error=`Queue '${d}' not found`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="azure-service-bus"?{processData:(t,n,s)=>{const a=De.getAzureServiceBusRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=s?.messaging||n.metadata?.messaging||{},l=c.queue,d=c.topic,f=n.metadata?.properties||n.metadata?.headers,p=n.metadata?.sessionId,m=n.metadata?.scheduledEnqueueTime;let y=!1,b="",S=[];if(l){const M=a.sendToQueue(l,n.payload,n.size,f,p,m);M&&(y=!0,b=l,S.push(M))}if(d){const M=a.publishToTopic(d,n.payload,n.size,f,m);M.length>0&&(y=!0,b=d,S=M)}return y?(n.status="delivered",n.metadata={...n.metadata,destination:b,queue:l||void 0,topic:d||void 0,messageIds:S,sessionId:p||void 0}):(n.status="failed",n.error=`No queue or topic found. Queue: '${l||"none"}', Topic: '${d||"none"}'`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="gcp-pubsub"?{processData:(t,n,s)=>{const a=De.getPubSubRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=s?.messaging||n.metadata?.messaging||{},l=c.topic||n.metadata?.topic,d=c.orderingKey||n.metadata?.orderingKey,f=n.metadata?.attributes||n.metadata?.headers,p=t.data.config||{},m=l||p.topics&&p.topics[0]?.name||null;if(!m)return n.status="failed",n.error="No topic specified for Pub/Sub message",n;const y=a.publishToTopic(m,n.payload,n.size,f,d);return y?(n.status="delivered",n.metadata={...n.metadata,topic:m,messageId:y,orderingKey:d||void 0}):(n.status="failed",n.error=`Topic '${m}' not found`),n},getSupportedFormats:()=>["json","binary","text"]}:{processData:(t,n,s)=>(n.status="delivered",n),getSupportedFormats:()=>["json","binary","text"]}}createAPIHandler(e){return{processData:(t,n,s)=>{const a={status:"success",data:n.payload,timestamp:Date.now()};return n.payload=a,n.status="delivered",n},transformData:(t,n,s,a)=>(e==="rest"&&n.format!=="json"?(n.format="json",n.status="transformed"):e==="grpc"&&n.format!=="protobuf"&&(n.format="protobuf",n.status="transformed"),n),getSupportedFormats:()=>{switch(e){case"rest":return["json","xml"];case"grpc":return["protobuf","binary"];case"graphql":return["json"];case"websocket":return["json","text","binary"];default:return["json"]}}}}createIntegrationHandler(e){return e==="kong"?{processData:(t,n,s)=>{const a=De.getKongRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",f=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=f.apikey||f["X-API-Key"]||p.apikey,y=n.metadata?.consumerId,b=a.routeRequest({path:l,method:d,headers:f,query:p,body:c?.body,consumerId:y,apiKey:m});return b.response.status>=200&&b.response.status<300?(n.status="delivered",n.latency=b.response.latency,n.metadata={...n.metadata,kongRoute:b.match?.route.id,kongService:b.match?.service.id,kongTarget:b.target,kongResponseStatus:b.response.status}):(n.status="failed",n.error=b.response.error||`HTTP ${b.response.status}`,n.latency=b.response.latency),n},transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:e==="nginx"?{processData:(t,n,s)=>{const a=De.getNginxRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",f=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=f["X-Real-IP"]||f["X-Forwarded-For"]||n.metadata?.clientIP,y=f["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",b=a.routeRequest({path:l,method:d,headers:f,query:p,body:c?.body,clientIP:m,protocol:y});return b.response.status>=200&&b.response.status<300?(n.status="delivered",n.latency=b.response.latency,n.metadata={...n.metadata,nginxLocation:b.match?.location.path,nginxUpstream:b.upstreamTarget,nginxResponseStatus:b.response.status,nginxCacheHit:b.response.cacheHit},b.response.body&&(n.payload=b.response.body)):(n.status="failed",n.error=b.response.error||`HTTP ${b.response.status}`,n.latency=b.response.latency),n},transformData:(t,n,s,a)=>{(t.data.config||{}).enableGzip&&n.metadata?.nginxCacheHit&&(n.metadata={...n.metadata,contentEncoding:"gzip"});const l=this.getTargetFormats(s);return l.length>0&&!l.includes(n.format)&&(n.format=l[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:e==="apigee"?{processData:(t,n,s)=>{const a=De.getApigeeRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",f=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=f.apikey||f["X-API-Key"]||p.apikey,y=f.Authorization||"",b=y.startsWith("OAuth ")?y.replace("OAuth ",""):void 0,S=y.startsWith("Bearer ")?y.replace("Bearer ",""):f["X-JWT-Token"],M=a.routeRequest({path:l,method:d,headers:f,query:p,body:c?.body,apiKey:m,oauthToken:b,jwtToken:S});return M.response.status>=200&&M.response.status<300?(n.status="delivered",n.latency=M.response.latency,n.metadata={...n.metadata,apigeeProxy:M.match?.proxy.name,apigeeTarget:M.target,apigeeResponseStatus:M.response.status,apigeeEnvironment:M.match?.proxy.environment}):(n.status="failed",n.error=M.response.error||`HTTP ${M.response.status}`,n.latency=M.response.latency),n},transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:e==="graphql-gateway"?{processData:(t,n,s)=>{const a=De.getGraphQLGatewayRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=c?.query||c?.body||n.metadata?.query,d=c?.variables||n.metadata?.variables,f=c?.operationName||n.metadata?.operationName,p=c?.headers||n.metadata?.headers||{},m=a.routeRequest({query:l||"",variables:d,headers:p,operationName:f});if(n.latency=m.latency,m.status>=200&&m.status<300){n.status="delivered";const S=a.getServiceRegistry().getConnectedServices().map(M=>M.endpoint);n.metadata={...n.metadata,graphqlGatewayStatus:m.status,graphqlGatewayEndpoints:S}}else n.status="failed",n.error=m.error||`HTTP ${m.status}`;return n},transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json"]}:e==="mulesoft"?{processData:(t,n,s)=>{const a=De.getMuleSoftRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=this.nodes.find(p=>p.id===n.source),d=this.nodes.find(p=>p.id===n.target),f=a.processData({path:c?.path||n.metadata?.path,method:c?.method||n.metadata?.method||"POST",headers:c?.headers||n.metadata?.headers||{},query:c?.query||n.metadata?.query||{},body:c?.body||c||n.payload,format:n.format,sourceComponentType:l?.type,sourceComponentId:l?.id,targetComponentType:d?.type,targetComponentId:d?.id});return f.response.status==="success"?(n.status="delivered",n.latency=f.response.latency,n.payload=f.response.data,f.response.format&&(n.format=f.response.format),n.metadata={...n.metadata,mulesoftApplication:f.response.application,mulesoftFlow:f.response.flow,mulesoftConnector:f.response.connector}):(n.status="failed",n.error=f.response.error||"MuleSoft processing failed",n.latency=f.response.latency||0),n},transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:e==="bff-service"?{processData:(t,n,s)=>{const a=De.getBFFRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",f=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=c?.body||c||n.payload,y=a.routeRequest({path:l,method:d,headers:f,query:p,body:m});return y.status>=200&&y.status<300?(n.status="delivered",n.latency=y.latency,n.payload=y.data,n.metadata={...n.metadata,bffCacheHit:y.cacheHit,bffBackendResponses:y.backendResponses.length,bffStatus:y.status}):(n.status="failed",n.error=y.error||`HTTP ${y.status}`,n.latency=y.latency),n},transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json"]}:e==="webhook-relay"?{processData:(t,n,s)=>{const a=De.getWebhookRelayRoutingEngine(t.id);if(!a)return n.status="delivered",n;const c=n.payload,l=c?.url||n.metadata?.url||c?.path||"/",d=c?.method||n.metadata?.method||"POST",f=c?.headers||n.metadata?.headers||{},p=c?.body||c||n.payload,m=c?.ip||n.metadata?.ip||f["x-forwarded-for"]?.split(",")[0]?.trim(),y=c?.event||n.metadata?.event||f["x-event"]||f["x-github-event"]||"",b=a.relayWebhook({url:l,method:d,headers:f,body:p,ip:m,event:y});return b.success?(n.status="delivered",n.latency=b.latency,n.metadata={...n.metadata,webhookRelayId:b.relayId,webhookDeliveryId:b.deliveryId,webhookAttempts:b.attempts,webhookStatus:b.status}):(n.status="failed",n.error=b.error||`Webhook relay failed (HTTP ${b.status})`,n.latency=b.latency,n.metadata={...n.metadata,webhookRelayId:b.relayId,webhookDeliveryId:b.deliveryId,webhookAttempts:b.attempts,webhookStatus:b.status}),n},transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","text","binary"]}:{transformData:(t,n,s,a)=>{const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}}getTargetFormats(e){return this.handlers.get(e)?.getSupportedFormats?.({type:e})||["json"]}createLokiHandler(){return{processData:(e,t,n)=>{const s=De.getLokiEmulationEngine(e.id);if(!s)return t.status="delivered",t;const a=t.payload;if(a?.query||a?.logql){const c=a.query||a.logql,l=a.startTime||a.start,d=a.endTime||a.end,f=a.limit||100,p=s.executeQuery(c,l,d,f);p.success?(t.status="delivered",t.latency=p.latency,t.payload={...t.payload,query:c,results:p.result||[],resultsCount:p.resultsCount}):(t.status="failed",t.error=p.error||"LogQL query execution failed",t.latency=p.latency||0)}else{const c=[],l=a?.stream||a?.labels||t.metadata?.labels||{app:e.data.label?.toLowerCase().replace(/\s+/g,"-")||"unknown",source:t.source.slice(0,8)};let d=[];if(a?.values&&Array.isArray(a.values))d=a.values;else if(a?.logs&&Array.isArray(a.logs)){const f=Date.now()*1e6;d=a.logs.map((p,m)=>[(f+m).toString(),String(p)])}else if(a?.log)d=[[(Date.now()*1e6).toString(),String(a.log)]];else if(typeof a=="string")d=[[(Date.now()*1e6).toString(),a]];else{const f=JSON.stringify(a);d=[[(Date.now()*1e6).toString(),f]]}if(d.length>0){c.push({stream:l,values:d});const f=s.processIngestion(c,t.source);f.success?(t.status="delivered",t.latency=10,t.payload={...t.payload,ingestedLines:f.ingestedLines,ingestedBytes:f.ingestedBytes}):(t.status="failed",t.error=f.error||"Log ingestion failed")}else t.status="failed",t.error="No log entries found in payload"}return t},getSupportedFormats:()=>["json","text"]}}createKeycloakHandler(){return{processData:(e,t,n)=>{const s=De.getKeycloakEmulationEngine(e.id);if(!s)return t.status="failed",t.error="Keycloak engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||a.grant_type;let l="login";if(typeof c=="string"){const y=c.toLowerCase();y.includes("refresh")||y==="refresh_token"?l="refresh":y.includes("introspect")?l="introspect":y.includes("userinfo")||y.includes("user_info")?l="userinfo":l="login"}const d=a.clientId||a.client_id||t.metadata?.clientId,f=a.username||a.user||t.metadata?.username,p=a.sub||a.subject||t.metadata?.subject||f,m=s.processAuthRequest(l,{clientId:d,username:f,subject:p,grantType:typeof c=="string"?c:void 0});return t.latency=m.latency,m.success?(t.status="delivered",t.payload={...a||{},keycloak:{realm:m.realm,clientId:m.clientId,subject:m.subject,tokenType:m.tokenType,expiresIn:m.expiresIn}},t.metadata={...t.metadata,authRealm:m.realm,authClientId:m.clientId,authSubject:m.subject,authResult:"success"}):(t.status="failed",t.error=m.error||"Keycloak auth failed"),t},getSupportedFormats:()=>["json","text"]}}createJenkinsHandler(){return{processData:(e,t,n)=>{const s=De.getJenkinsEmulationEngine(e.id);if(!s)return t.status="failed",t.error="Jenkins engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"webhook";if(c==="webhook"||a.ref||a.branch||a.commit){const l=a.pipelineId||a.pipeline||a.job,d=a.branch||a.ref?.replace("refs/heads/","")||"main",f=a.commit||a.sha||void 0;if(l){const p=s.triggerWebhook(l,d,f);p.success?(t.status="delivered",t.latency=50,t.payload={...a||{},jenkins:{webhookReceived:!0,pipelineId:l,branch:d,commit:f,triggered:!0}}):(t.status="failed",t.error=p.reason||"Failed to trigger build",t.latency=50)}else t.status="delivered",t.latency=50,t.payload={...a||{},jenkins:{webhookReceived:!0,branch:d,commit:f,triggered:!1,reason:"No pipeline ID specified"}}}else if(c==="getBuildStatus"||a.buildId||a.buildNumber){const l=a.buildId||a.buildNumber,d=a.pipelineId||a.pipeline,f=s.getBuildById(l||`${d}-${a.buildNumber}`),p=f?.status||"unknown";t.status="delivered",t.latency=20,t.payload={...a||{},jenkins:{buildId:l,pipelineId:d,status:p,progress:f?.progress,duration:f?.duration}}}else t.status="delivered",t.latency=30,t.payload={...a||{},jenkins:{processed:!0,operation:c}};return s.processRequest(t.status==="delivered"),t},getSupportedFormats:()=>["json","text"]}}createGitLabCIHandler(){return{processData:(e,t,n)=>{const s=De.getGitLabCIEmulationEngine(e.id);if(!s)return t.status="failed",t.error="GitLab CI engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"webhook";if(c==="webhook"||a.ref||a.branch||a.commit){const l=a.ref||a.branch?.replace("refs/heads/","")||"main",d=a.variables||{},f=s.triggerWebhook(l,d);f.success?(t.status="delivered",t.latency=50,t.payload={...a||{},gitlab:{webhookReceived:!0,pipelineId:f.pipelineId,ref:l,variables:d,triggered:!0}}):(t.status="failed",t.error=f.reason||"Failed to trigger pipeline",t.latency=50)}else if(c==="getPipelineStatus"||a.pipelineId||a.pipelineIid){const l=a.pipelineId||a.pipelineIid?.toString(),d=s.getPipeline(l||"");t.status="delivered",t.latency=20,t.payload={...a||{},gitlab:{pipelineId:l,status:d?.status||"unknown",duration:d?.duration,stages:d?.stages.map(f=>({name:f.name,status:f.status,duration:f.duration}))}}}else if(c==="getJobStatus"||a.jobId){const l=a.jobId,d=s.getJob(l||"");t.status="delivered",t.latency=20,t.payload={...a||{},gitlab:{jobId:l,status:d?.status||"unknown",progress:d?.progress,duration:d?.duration,logs:d?.logs?.slice(-10)}}}else if(c==="cancelPipeline"||a.cancel){const l=a.pipelineId,d=s.cancelPipeline(l||"");t.status=d.success?"delivered":"failed",t.error=d.reason,t.latency=30,t.payload={...a||{},gitlab:{pipelineId:l,canceled:d.success}}}else t.status="delivered",t.latency=30,t.payload={...a||{},gitlab:{processed:!0,operation:c}};return s.processRequest(t.status==="delivered"),t},getSupportedFormats:()=>["json","text"]}}createArgoCDHandler(){return{processData:(e,t,n)=>{const s=De.getArgoCDEmulationEngine(e.id);if(!s)return t.status="failed",t.error="Argo CD engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"webhook";if(c==="webhook"||a.ref||a.branch||a.commit||a.repository){const l=a.repository||a.repo||"",d=a.ref||a.branch||a.commit||"main",f=a.application||a.app||"";f?s.startSync(f)?(t.status="delivered",t.latency=50,t.payload={...a||{},argocd:{webhookReceived:!0,application:f,repository:l,ref:d,syncTriggered:!0}}):(t.status="failed",t.error="Failed to trigger sync or application already syncing",t.latency=50):(t.status="delivered",t.latency=30,t.payload={...a||{},argocd:{webhookReceived:!0,repository:l,ref:d,syncTriggered:!1,reason:"No application specified"}})}else if(c==="sync"||c==="startSync"){const l=a.application||a.app||t.metadata?.application;if(!l)return t.status="failed",t.error="Application name is required for sync operation",t;s.startSync(l)?(t.status="delivered",t.latency=50,t.payload={...a||{},argocd:{operation:"sync",application:l,syncStarted:!0}}):(t.status="failed",t.error="Failed to start sync or application already syncing",t.latency=50)}else if(c==="getApplicationStatus"||c==="getAppStatus"||a.application){const l=a.application||a.app||"",d=s.getApplication(l);t.status="delivered",t.latency=20,t.payload={...a||{},argocd:{application:l,status:d?.status||"unknown",health:d?.health||"unknown",lastSync:d?.lastSync,lastSyncDuration:d?.lastSyncDuration,revision:d?.revision,sourceRevision:d?.sourceRevision}}}else if(c==="getSyncStatus"||a.syncOperationId){const l=a.syncOperationId||a.operationId,f=s.getSyncOperations().find(p=>p.id===l);t.status="delivered",t.latency=20,t.payload={...a||{},argocd:{syncOperationId:l,status:f?.status||"unknown",phase:f?.phase,startedAt:f?.startedAt,finishedAt:f?.finishedAt,error:f?.error}}}else if(c==="getMetrics"||c==="getStats"){const l=s.getMetrics(),d=s.getStats();t.status="delivered",t.latency=15,t.payload={...a||{},argocd:{metrics:l,stats:d}}}else t.status="delivered",t.latency=30,t.payload={...a||{},argocd:{processed:!0,operation:c}};return s.processRequest(t.status==="delivered"),t},getSupportedFormats:()=>["json","text"]}}createTerraformHandler(){return{processData:(e,t,n)=>{const s=De.getTerraformEmulationEngine(e.id);if(!s)return t.status="failed",t.error="Terraform engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"webhook";if(c==="webhook"||a.ref||a.branch||a.commit||a.repository){const l=a.workspace||a.workspaceId||"",d=a.workspaceId||a.workspace,f=a.ref?.replace("refs/heads/","")||a.branch||"main",p=a.commit||a.sha||void 0;if(l||d){const m=s.getWorkspaces(),y=d?m.find(b=>b.id===d):m.find(b=>b.name===l);if(y){const b=s.triggerRun(y.id,{planOnly:a.planOnly??!1,source:"vcs",triggeredBy:"vcs-webhook"});b.success?(t.status="delivered",t.latency=50,t.payload={...a||{},terraform:{webhookReceived:!0,workspaceId:y.id,workspaceName:y.name,branch:f,commit:p,runTriggered:!0,runId:b.runId}}):(t.status="failed",t.error=b.reason||"Failed to trigger run",t.latency=50)}else t.status="failed",t.error="Workspace not found",t.latency=50}else t.status="delivered",t.latency=30,t.payload={...a||{},terraform:{webhookReceived:!0,branch:f,commit:p,runTriggered:!1,reason:"No workspace specified"}}}else if(c==="triggerRun"||c==="createRun"||c==="run"){const l=a.workspaceId||a.workspace||t.metadata?.workspaceId,d=a.planOnly??!1;if(!l)return t.status="failed",t.error="Workspace ID is required for run operation",t;const f=s.triggerRun(l,{planOnly:d,source:"api",triggeredBy:a.triggeredBy||"user"});f.success?(t.status="delivered",t.latency=50,t.payload={...a||{},terraform:{operation:"triggerRun",workspaceId:l,planOnly:d,runId:f.runId,runTriggered:!0}}):(t.status="failed",t.error=f.reason||"Failed to trigger run",t.latency=50)}else if(c==="cancelRun"||c==="cancel"){const l=a.runId||a.run||t.metadata?.runId;if(!l)return t.status="failed",t.error="Run ID is required for cancel operation",t;const d=s.cancelRun(l);d.success?(t.status="delivered",t.latency=30,t.payload={...a||{},terraform:{operation:"cancelRun",runId:l,canceled:!0}}):(t.status="failed",t.error=d.reason||"Failed to cancel run",t.latency=30)}else if(c==="getRunStatus"||c==="getRun"||a.runId){const l=a.runId||a.run||"",d=s.getRun(l);t.status="delivered",t.latency=20,t.payload={...a||{},terraform:{runId:l,status:d?.status||"unknown",workspaceId:d?.workspaceId,workspaceName:d?.workspaceName,createdAt:d?.createdAt,startedAt:d?.startedAt,finishedAt:d?.finishedAt,duration:d?.duration,planOnly:d?.planOnly,message:d?.message,error:d?.error,hasChanges:d?.hasChanges,resourceAdditions:d?.resourceAdditions,resourceChanges:d?.resourceChanges,resourceDestructions:d?.resourceDestructions}}}else if(c==="getWorkspaceStatus"||c==="getWorkspace"||a.workspaceId){const l=a.workspaceId||a.workspace||"",d=s.getWorkspace(l),f=d?s.getStateForWorkspace(l):void 0;t.status="delivered",t.latency=20,t.payload={...a||{},terraform:{workspaceId:l,workspace:d?{id:d.id,name:d.name,description:d.description,terraformVersion:d.terraformVersion,autoApply:d.autoApply,lastRun:d.lastRun}:null,state:f?{version:f.version,serial:f.serial,resources:f.resources,updatedAt:f.updatedAt}:null}}}else if(c==="getMetrics"||c==="getStats"){const l=s.getMetrics();t.status="delivered",t.latency=20,t.payload={...a||{},terraform:{metrics:{workspacesTotal:l.workspacesTotal,runsTotal:l.runsTotal,runsSuccess:l.runsSuccess,runsFailed:l.runsFailed,runsRunning:l.runsRunning,runsPending:l.runsPending,runsPerHour:l.runsPerHour,averageRunDuration:l.averageRunDuration,statesTotal:l.statesTotal,resourcesManaged:l.resourcesManaged}}}}else t.status="delivered",t.latency=30,t.payload={...a||{},terraform:{processed:!0,operation:c}};return s.processRequest(t.status==="delivered"),t},getSupportedFormats:()=>["json","text"]}}createHarborHandler(){return{processData:(e,t,n)=>{if(!De.getHarborEmulationEngine(e.id))return t.status="failed",t.error="Harbor engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"pull";return c==="push"?(t.status="delivered",t.latency=500+Math.random()*1500,t.payload={...a||{},harbor:{operation:"push",repository:a.repository||"unknown",tag:a.tag||"latest",size:a.size||0,status:"completed"}}):c==="pull"?(t.status="delivered",t.latency=200+Math.random()*800,t.payload={...a||{},harbor:{operation:"pull",repository:a.repository||"unknown",tag:a.tag||"latest",status:"completed"}}):c==="scan"?(t.status="delivered",t.latency=5e3+Math.random()*15e3,t.payload={...a||{},harbor:{operation:"scan",repository:a.repository||"unknown",tag:a.tag||"latest",status:"completed"}}):(t.status="delivered",t.latency=100+Math.random()*200,t.payload={...a||{},harbor:{operation:c,status:"completed"}}),t},getSupportedFormats:()=>["json","binary"]}}createDockerHandler(){return{processData:(e,t,n)=>{if(!De.getDockerEmulationEngine(e.id))return t.status="failed",t.error="Docker engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"container-operation";if(c.startsWith("container-")){const l=c.replace("container-","");switch(t.status="delivered",l){case"create":t.latency=500+Math.random()*1e3;break;case"start":t.latency=200+Math.random()*500;break;case"stop":t.latency=100+Math.random()*300;break;case"restart":t.latency=300+Math.random()*700;break;default:t.latency=100+Math.random()*200}t.payload={...a||{},docker:{operation:l,containerId:a.containerId||"unknown",status:"completed"}}}else if(c.startsWith("image-")){const l=c.replace("image-","");switch(t.status="delivered",l){case"pull":t.latency=2e3+Math.random()*8e3;break;case"push":t.latency=3e3+Math.random()*1e4;break;case"build":t.latency=5e3+Math.random()*15e3;break;default:t.latency=1e3+Math.random()*2e3}t.payload={...a||{},docker:{operation:l,imageId:a.imageId||"unknown",status:"completed"}}}else t.status="delivered",t.latency=100+Math.random()*200,t.payload={...a||{},docker:{operation:c,status:"completed"}};return t},getSupportedFormats:()=>["json","text"]}}createVaultHandler(){return{processData:(e,t,n)=>{const s=De.getVaultEmulationEngine(e.id);if(!s)return t.status="failed",t.error="Vault engine not initialized",t;const a=t.payload||{},c=t.metadata?.operation||a.operation||a.action||"read",l=a?.path||t.metadata?.path||"secret/default",d=a?.token||t.metadata?.token;let f;if(typeof c=="string"){const p=c.toLowerCase();if(p.includes("write")||p==="create"||p==="update"){const m=a?.data||a?.value||{};f=s.processWriteRequest(l,m,d)}else if(p.includes("delete")||p==="remove")f=s.processDeleteRequest(l,d);else if(p.includes("encrypt")){const m=a?.plaintext||a?.data||"",y=a?.key||a?.keyName||"default";f=s.processEncryptRequest(m,y,d)}else if(p.includes("decrypt")){const m=a?.ciphertext||a?.data||"",y=a?.key||a?.keyName||"default";f=s.processDecryptRequest(m,y,d)}else if(p.includes("auth")||p==="login"||p==="authenticate"){const m=a?.method||a?.authMethod||"token";f=s.processAuthRequest(m,a)}else{const m=a?.key;f=s.processReadRequest(l,m,d)}}else{const p=a?.key;f=s.processReadRequest(l,p,d)}return t.latency=(t.latency||0)+f.latency,f.success?(t.status="delivered",t.payload={...a||{},vault:{path:l,data:f.data,token:f.token,policies:f.policies}},f.token&&(t.metadata={...t.metadata,vaultToken:f.token,vaultPolicies:f.policies})):(t.status="failed",t.error=f.error||"Vault operation failed"),t},getSupportedFormats:()=>["json","text"]}}createWAFHandler(){return{processData:(e,t,n)=>{const s=De.getWAFEmulationEngine(e.id);if(!s)return t.status="delivered",t;const a=t.payload||{},c=a?.path||t.metadata?.path||"/",l=a?.method||t.metadata?.method||"GET",d=a?.headers||t.metadata?.headers||{},f=a?.query||t.metadata?.query||{},p=a?.body||a,m=a?.sourceIP||t.metadata?.sourceIP||d["x-forwarded-for"]||d["x-real-ip"],y=a?.country||t.metadata?.country||d["cf-ipcountry"],b=a?.userAgent||t.metadata?.userAgent||d["user-agent"],S=s.processRequest({path:c,method:l,headers:d,query:f,body:p,sourceIP:m,country:y,userAgent:b});return t.latency=(t.latency||0)+S.latency,S.blocked?(t.status="failed",t.error=S.error||`Request blocked by WAF: ${S.threatDetected?"Threat detected":"Rule matched"}`,S.threatDetected&&(t.metadata={...t.metadata,wafBlocked:!0,wafThreatDetected:!0,wafAction:"block"})):!S.success&&S.action==="challenge"?(t.status="pending",t.metadata={...t.metadata,wafChallenge:!0,wafAction:"challenge"}):(t.status="delivered",t.metadata={...t.metadata,wafChecked:!0,wafAllowed:!0,wafLatency:S.latency},S.threatDetected&&(t.metadata.wafThreatDetected=!0,t.metadata.wafAction="log")),t},getSupportedFormats:()=>["json","text","xml"]}}createFirewallHandler(){return{processData:(e,t,n)=>{const s=De.getFirewallEmulationEngine(e.id);if(!s)return t.status="delivered",t;const a=t.payload||{},c=a?.source||t.metadata?.sourceIP||a?.sourceIP||"0.0.0.0",l=a?.destination||t.metadata?.destinationIP||a?.destinationIP||"10.0.0.1",d=a?.protocol||t.metadata?.protocol||"tcp",f=a?.port||t.metadata?.port||a?.destinationPort,p=a?.sourcePort||t.metadata?.sourcePort,m=s.processPacket({source:c,destination:l,protocol:d,port:f,sourcePort:p});return t.latency=(t.latency||0)+m.latency,m.blocked?(t.status="failed",t.error=m.error||`Packet ${m.action} by Firewall: ${m.matchedRule?.name||"Default policy"}`,t.metadata={...t.metadata,firewallBlocked:!0,firewallAction:m.action,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}):(t.status="delivered",t.metadata={...t.metadata,firewallChecked:!0,firewallAllowed:!0,firewallLatency:m.latency,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}),t},getSupportedFormats:()=>["json","text","binary"]}}createIDSIPSHandler(){return{processData:(e,t,n)=>{const s=De.getIDSIPSEmulationEngine(e.id);if(!s)return t.status="delivered",t;const a=t.payload||{},c=a?.source||t.metadata?.sourceIP||a?.sourceIP||"0.0.0.0",l=a?.destination||t.metadata?.destinationIP||a?.destinationIP||"10.0.0.1",d=a?.protocol||t.metadata?.protocol||"tcp",f=a?.port||t.metadata?.port||a?.destinationPort,p=a?.sourcePort||t.metadata?.sourcePort,m=a?.payload||a?.body||(typeof a=="string"?a:JSON.stringify(a)),y=s.processPacket({source:c,destination:l,protocol:d,port:f,sourcePort:p,payload:m});return t.latency=(t.latency||0)+y.latency,y.blocked?(t.status="failed",t.error=y.error||"Packet blocked by IDS/IPS: Intrusion detected",t.metadata={...t.metadata,idsipsBlocked:!0,idsipsAlertGenerated:y.alertGenerated,idsipsAction:"block"},y.alertGenerated&&(t.metadata.idsipsAlertType="intrusion")):(t.status="delivered",t.metadata={...t.metadata,idsipsChecked:!0,idsipsAllowed:!0,idsipsLatency:y.latency,idsipsAlertGenerated:y.alertGenerated},y.alertGenerated&&(t.metadata.idsipsAction="alert",t.metadata.idsipsAlertType="intrusion")),t},getSupportedFormats:()=>["json","text","binary"]}}createOpenTelemetryCollectorHandler(){return{processData:(e,t,n)=>{const s=De.getOpenTelemetryCollectorRoutingEngine(e.id);if(!s)return t.status="delivered",t;const a=this.nodes.find(l=>l.id===t.source),c=s.processMessage(t,a||void 0);return c.success?(t.status="delivered",t.latency=c.latency):(t.status="failed",t.error=c.error||"OpenTelemetry Collector processing failed",t.latency=c.latency),t},getSupportedFormats:()=>["json","protobuf","binary","text"]}}createCRMDataMessage(e){const t=e.data.config||{},n=t.contacts||[],s=t.deals||[],a=Math.random()>.5?"contact":"deal";let c;if(a==="contact"&&n.length>0){const d=n[Math.floor(Math.random()*n.length)];c={operation:"create",type:"contact",data:{name:d.name,email:d.email,company:d.company,status:d.status}}}else if(s.length>0){const d=s[Math.floor(Math.random()*s.length)];c={operation:"update",type:"deal",data:{id:d.id,name:d.name,value:d.value,stage:d.stage}}}else c={operation:"create",type:"contact",data:{name:`Contact ${Date.now()}`,email:`contact${Date.now()}@example.com`}};const l=JSON.stringify(c);return{id:"",timestamp:Date.now(),source:e.id,target:"",connectionId:"",format:"json",payload:c,size:new Blob([l]).size,metadata:{contentType:"application/json",operation:c.operation},status:"pending"}}createERPDataMessage(e){const t=e.data.config||{},n=t.orders||[],s=t.inventory||[],a=Math.random()>.5?"order":"inventory";let c;if(a==="order"&&n.length>0){const d=n[Math.floor(Math.random()*n.length)];c={operation:"create",type:"order",data:{orderNumber:d.orderNumber,customer:d.customer,total:d.total,items:d.items}}}else if(s.length>0){const d=s[Math.floor(Math.random()*s.length)];c={operation:"update",type:"inventory",data:{sku:d.sku,quantity:d.quantity,status:d.status}}}else c={operation:"create",type:"order",data:{orderNumber:`ORD-${Date.now()}`,total:Math.random()*1e3}};const l=JSON.stringify(c);return{id:"",timestamp:Date.now(),source:e.id,target:"",connectionId:"",format:"json",payload:c,size:new Blob([l]).size,metadata:{contentType:"application/json",operation:c.operation},status:"pending"}}createPaymentDataMessage(e){const n=(e.data.config||{}).transactions||[];let s;if(n.length>0){const c=n[Math.floor(Math.random()*n.length)];s={operation:"process",type:"transaction",data:{id:c.id,amount:c.amount,currency:c.currency,status:c.status}}}else s={operation:"process",type:"transaction",data:{amount:Math.random()*1e3,currency:"USD"}};const a=JSON.stringify(s);return{id:"",timestamp:Date.now(),source:e.id,target:"",connectionId:"",format:"json",payload:s,size:new Blob([a]).size,metadata:{contentType:"application/json",operation:s.operation},status:"pending"}}generateQueryResults(e,t){const n=Math.floor(Math.random()*10)+1,s=[];for(let a=0;a<n;a++)s.push({id:a+1,name:`Record ${a+1}`,value:Math.random()*100,timestamp:new Date().toISOString()});return s}}const fn=new xk;class wk{componentStates=new Map;setComponentState(e,t,n){const s={nodeId:e,state:t,degradedLevel:n?.degradedLevel||.5,failureRate:n?.failureRate||.1,latencyMultiplier:n?.latencyMultiplier||2,throughputMultiplier:n?.throughputMultiplier||.5};this.componentStates.set(e,s)}getComponentState(e){return this.componentStates.get(e)}isEnabled(e){const t=this.componentStates.get(e);return!t||t.state==="enabled"}applyStateEffects(e,t){const n=this.componentStates.get(e);if(!n||n.state==="enabled")return{...t};if(n.state==="disabled"||n.state==="failed")return{throughput:0,latency:1/0,errorRate:1,utilization:0};if(n.state==="degraded"){const s=n.degradedLevel||.5;return{throughput:t.throughput*(n.throughputMultiplier||.5)*(1-s*.5),latency:t.latency*(n.latencyMultiplier||2)*(1+s),errorRate:Math.min(1,t.errorRate+(n.failureRate||.1)*s),utilization:Math.min(1,t.utilization*(1+s*.3))}}return{...t}}reset(){this.componentStates.clear()}resetComponent(e){this.componentStates.delete(e)}getAllStates(){return Array.from(this.componentStates.values())}}const mo=new wk;class Sk{queues=new Map;exchanges=new Map;bindings=new Map;queueMessages=new Map;unackedMessages=new Map;queueState=new Map;initialize(e){if(this.queues.clear(),this.exchanges.clear(),this.bindings.clear(),this.queueMessages.clear(),this.unackedMessages.clear(),this.queueState.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.unackedMessages.set(t.name,[]),this.queueState.set(t.name,{ready:t.ready||0,unacked:t.unacked||0,total:t.messages||0,lastUpdate:Date.now()});if(e.exchanges)for(const t of e.exchanges)this.exchanges.set(t.name,{...t}),this.bindings.set(t.name,[]);if(e.bindings)for(const t of e.bindings){const n=this.bindings.get(t.source)||[];n.push(t),this.bindings.set(t.source,n)}}routeMessage(e,t,n,s,a,c){const l=this.exchanges.get(e);if(!l)return[];const d=this.bindings.get(e)||[],f=[];for(const y of d)this.shouldRouteToQueue(l,y,t,a)&&f.push(y.destination);const p=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,m=Date.now();for(const y of f){const b=this.queues.get(y);if(!b)continue;if(b.maxLength&&(this.queueMessages.get(y)||[]).length>=b.maxLength){b.deadLetterExchange&&this.routeToDeadLetterExchange(b.deadLetterExchange,b.deadLetterRoutingKey||t,n,s,a,c);continue}const S={id:p,timestamp:m,routingKey:t,exchange:e,payload:n,size:s,priority:c||b.maxPriority?c||0:void 0,headers:a,ttl:b.messageTtl?m+b.messageTtl:void 0},M=this.queueMessages.get(y)||[];M.push(S),b.maxPriority&&S.priority!==void 0&&M.sort((E,C)=>(C.priority||0)-(E.priority||0)),this.queueMessages.set(y,M)}return f}shouldRouteToQueue(e,t,n,s){switch(e.type){case"direct":return t.routingKey===n;case"topic":return this.matchTopicPattern(t.routingKey,n);case"fanout":return!0;case"headers":if(!s||!t.arguments)return!1;for(const[a,c]of Object.entries(t.arguments))if(!a.startsWith("x-")&&s[a]!==c)return!1;return!0;default:return!1}}matchTopicPattern(e,t){const n=e.replace(/\./g,"\\.").replace(/\*/g,"[^.]+").replace(/#/g,".*");return new RegExp(`^${n}$`).test(t)}routeToDeadLetterExchange(e,t,n,s,a,c){this.routeMessage(e,t,n,s,a,c)}processConsumption(e){const t=Date.now();for(const[n,s]of this.queues.entries()){let a=this.queueMessages.get(n)||[],c=this.unackedMessages.get(n)||[];const l=this.queueState.get(n)||{ready:0,unacked:0,total:0,lastUpdate:t};a=a.filter(E=>E.ttl&&t>E.ttl?(s.deadLetterExchange&&this.routeToDeadLetterExchange(s.deadLetterExchange,s.deadLetterRoutingKey||E.routingKey,E.payload,E.size,E.headers,E.priority),!1):!0),this.queueMessages.set(n,a);const p=(s.consumers||0)*10*e/1e3,m=Math.min(p,a.length),y=a.splice(0,m);c.push(...y),this.unackedMessages.set(n,c);const S=e/100*c.length,M=Math.min(S,c.length);c.splice(0,Math.floor(M)),this.unackedMessages.set(n,c),l.ready=a.length,l.unacked=c.length,l.total=a.length+c.length,l.lastUpdate=t,this.queueState.set(n,l)}}getQueueMetrics(e){const t=this.queues.get(e);if(!t)return null;const n=this.queueMessages.get(e)||[],s=this.unackedMessages.get(e)||[];this.queueState.get(e);const a=n.length,c=s.length;return{messages:a+c,ready:a,unacked:c,consumers:t.consumers||0}}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getTotalQueueDepth(){let e=0;for(const t of this.queueMessages.values())e+=t.length;for(const t of this.unackedMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.queues.values())t.consumers&&(e+=t.consumers);return e+=this.exchanges.size,Math.max(1,e)}updateQueue(e,t){const n=this.queues.get(e);n&&(Object.assign(n,t),this.queues.set(e,n))}}class Mk{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;queueState=new Map;topicState=new Map;initialize(e){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.queueState.clear(),this.topicState.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.queueState.set(t.name,{queueSize:t.queueSize||0,consumerCount:t.consumerCount||0,enqueueCount:t.enqueueCount||0,dequeueCount:t.dequeueCount||0,lastUpdate:Date.now()});if(e.topics)for(const t of e.topics)this.topics.set(t.name,{...t}),this.topicMessages.set(t.name,[]),this.subscriptions.set(t.name,[]),this.topicState.set(t.name,{subscriberCount:t.subscriberCount||0,enqueueCount:t.enqueueCount||0,dequeueCount:t.dequeueCount||0,lastUpdate:Date.now()});if(e.subscriptions)for(const t of e.subscriptions){const n=this.subscriptions.get(t.destination)||[];n.push(t),this.subscriptions.set(t.destination,n),this.subscriptionMessages.set(t.id,[])}}routeToQueue(e,t,n,s,a){if(!this.queues.get(e))return!1;const l=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=Date.now(),f={id:l,timestamp:d,destination:e,payload:t,size:n,headers:s,priority:a},p=this.queueMessages.get(e)||[];p.push(f),a!==void 0&&p.sort((y,b)=>(b.priority||0)-(y.priority||0)),this.queueMessages.set(e,p);const m=this.queueState.get(e)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:d};return m.queueSize=p.length,m.enqueueCount=(m.enqueueCount||0)+1,m.lastUpdate=d,this.queueState.set(e,m),!0}publishToTopic(e,t,n,s,a){if(!this.topics.get(e))return[];const l=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=Date.now(),f=this.subscriptions.get(e)||[],p=[],m={id:l,timestamp:d,destination:e,payload:t,size:n,headers:s,priority:a};for(const b of f){if(b.selector&&!this.matchesSelector(b.selector,s))continue;const S=this.subscriptionMessages.get(b.id)||[];S.push(m),this.subscriptionMessages.set(b.id,S),p.push(b.id),b.pendingQueueSize=(b.pendingQueueSize||0)+1,b.enqueueCounter=(b.enqueueCounter||0)+1}if(f.length===0){const b=this.topicMessages.get(e)||[];b.push(m),this.topicMessages.set(e,b)}const y=this.topicState.get(e)||{subscriberCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:d};return y.enqueueCount=(y.enqueueCount||0)+1,y.lastUpdate=d,this.topicState.set(e,y),p}matchesSelector(e,t){if(!t||!e)return!0;try{const n=e.trim(),s=n.match(/^(\w+)\s*=\s*['"]([^'"]+)['"]$/);if(s){const c=s[1],l=s[2];return t[c]===l}const a=n.match(/^(\w+)\s*([><=]+)\s*(\d+)$/);if(a){const c=a[1],l=a[2],d=Number(a[3]),f=Number(t[c]);if(isNaN(f))return!1;switch(l){case">":return f>d;case"<":return f<d;case">=":return f>=d;case"<=":return f<=d;case"=":return f===d;default:return!1}}for(const c in t)if(n.includes(c))return!0;return!1}catch{return!0}}processConsumption(e){const t=Date.now();for(const[n,s]of this.queues.entries()){let a=this.queueMessages.get(n)||[];const c=this.queueState.get(n)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:t};a=a.filter(y=>!(y.ttl&&t>y.ttl)),this.queueMessages.set(n,a);const f=(s.consumerCount||c.consumerCount||0)*10*e/1e3,p=Math.min(f,a.length),m=a.splice(0,Math.floor(p));this.queueMessages.set(n,a),c.queueSize=a.length,c.dequeueCount=(c.dequeueCount||0)+m.length,c.lastUpdate=t,this.queueState.set(n,c)}for(const[n,s]of this.subscriptions.entries()){for(const c of s){let l=this.subscriptionMessages.get(c.id)||[];l=l.filter(y=>!(y.ttl&&t>y.ttl));const f=10*e/1e3,p=Math.min(f,l.length),m=l.splice(0,Math.floor(p));c.pendingQueueSize=l.length,c.dispatchedQueueSize=(c.dispatchedQueueSize||0)+m.length,c.dequeueCounter=(c.dequeueCounter||0)+m.length,this.subscriptionMessages.set(c.id,l)}const a=this.topicState.get(n);a&&(a.dequeueCount=s.reduce((c,l)=>c+(l.dequeueCounter||0),0),a.lastUpdate=t)}}getQueueMetrics(e){if(!this.queues.get(e))return null;const n=this.queueState.get(e);return n?{queueSize:n.queueSize,consumerCount:n.consumerCount,enqueueCount:n.enqueueCount,dequeueCount:n.dequeueCount}:null}getTopicMetrics(e){if(!this.topics.get(e))return null;const n=this.topicState.get(e);return n?{subscriberCount:n.subscriberCount,enqueueCount:n.enqueueCount,dequeueCount:n.dequeueCount}:null}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getAllTopicMetrics(){const e=new Map;for(const t of this.topics.keys()){const n=this.getTopicMetrics(t);n&&e.set(t,n)}return e}getTotalQueueDepth(){let e=0;for(const t of this.queueMessages.values())e+=t.length;return e}getTotalTopicMessages(){let e=0;for(const t of this.subscriptionMessages.values())e+=t.length;for(const t of this.topicMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.queues.values())t.consumerCount&&(e+=t.consumerCount);for(const t of this.subscriptions.values())e+=t.length;return Math.max(1,e+1)}updateQueue(e,t){const n=this.queues.get(e);if(n){Object.assign(n,t),this.queues.set(e,n);const s=this.queueState.get(e);s&&t.consumerCount!==void 0&&(s.consumerCount=t.consumerCount)}}updateTopic(e,t){const n=this.topics.get(e);if(n){Object.assign(n,t),this.topics.set(e,n);const s=this.topicState.get(e);s&&t.subscriberCount!==void 0&&(s.subscriberCount=t.subscriberCount)}}}class Ck{queues=new Map;queueMessages=new Map;inFlightMessages=new Map;dlqMessages=new Map;queueState=new Map;messageGroups=new Map;deduplicationIds=new Map;initialize(e){if(this.queues.clear(),this.queueMessages.clear(),this.inFlightMessages.clear(),this.dlqMessages.clear(),this.queueState.clear(),this.messageGroups.clear(),this.deduplicationIds.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.inFlightMessages.set(t.name,[]),this.queueState.set(t.name,{approximateMessages:0,approximateMessagesNotVisible:0,approximateMessagesDelayed:0,sentCount:0,receivedCount:0,deletedCount:0,dlqCount:0,lastUpdate:Date.now()}),t.type==="fifo"&&(this.messageGroups.set(t.name,new Map),this.deduplicationIds.set(t.name,new Set))}sendMessage(e,t,n,s,a,c){const l=this.queues.get(e);if(!l)return null;const d=Date.now(),f=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=`${e}-${f}`;if(l.type==="fifo"){if(l.contentBasedDedup&&!c){const T=JSON.stringify(t);c=this.hashString(T)}if(c){const T=this.deduplicationIds.get(e);if(T&&T.has(c))return p;T?.add(c)}a||(a="default-group")}const m=l.messageRetention*24*60*60*1e3,y=d+m,b=l.delaySeconds*1e3,S=b>0?d+b:void 0,M={id:f,messageId:p,timestamp:d,queueName:e,payload:t,size:n,attributes:s,messageGroupId:a,messageDeduplicationId:c,receiveCount:0,retentionExpiresAt:y,delayUntil:S},E=this.queueMessages.get(e)||[];if(l.type==="fifo"&&a){const T=this.messageGroups.get(e);if(T){const k=T.get(a)||[];k.push(M),T.set(a,k)}}E.push(M),this.queueMessages.set(e,E);const C=this.queueState.get(e);if(C){const T=this.queueMessages.get(e)||[],k=this.inFlightMessages.get(e)||[],A=T.filter(_=>_.delayUntil&&d<_.delayUntil);C.approximateMessages=T.length,C.approximateMessagesNotVisible=k.length,C.approximateMessagesDelayed=A.length,C.sentCount=(C.sentCount||0)+1,C.lastUpdate=d}return p}receiveMessage(e,t=1,n){const s=this.queues.get(e);if(!s)return[];const a=Date.now(),l=(n!==void 0?n:s.visibilityTimeout)*1e3;let d=(this.queueMessages.get(e)||[]).filter(y=>!(y.delayUntil&&a<y.delayUntil||a>=y.retentionExpiresAt));if(s.type==="fifo"){const y=this.messageGroups.get(e);if(y){d=[];let b=0;for(const[S,M]of y.entries()){if(b>=t)break;if(M.length>0){const E=M[0];(!E.delayUntil||a>=E.delayUntil)&&a<E.retentionExpiresAt&&(d.push(E),b++)}}}}const f=Math.min(t,d.length),p=[];for(let y=0;y<f;y++){const b=d[y],S=`receipt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;b.receiptHandle=S,b.receiveCount=(b.receiveCount||0)+1,b.firstReceivedAt||(b.firstReceivedAt=a);const M={message:b,receivedAt:a,visibilityTimeoutExpiresAt:a+l},E=this.inFlightMessages.get(e)||[];E.push(M),this.inFlightMessages.set(e,E);const C=this.queueMessages.get(e)||[],T=C.indexOf(b);if(T>-1&&C.splice(T,1),this.queueMessages.set(e,C),s.type==="fifo"&&b.messageGroupId){const k=this.messageGroups.get(e);if(k){const A=k.get(b.messageGroupId)||[],_=A.indexOf(b);_>-1&&A.splice(_,1),A.length===0?k.delete(b.messageGroupId):k.set(b.messageGroupId,A)}}p.push(b)}const m=this.queueState.get(e);return m&&(m.receivedCount=(m.receivedCount||0)+p.length,m.lastUpdate=a),p}deleteMessage(e,t){if(!this.queues.get(e))return!1;const s=this.inFlightMessages.get(e)||[],a=s.findIndex(l=>l.message.receiptHandle===t);if(a===-1)return!1;s[a],s.splice(a,1),this.inFlightMessages.set(e,s);const c=this.queueState.get(e);return c&&(c.deletedCount=(c.deletedCount||0)+1,c.lastUpdate=Date.now()),!0}processConsumption(e){const t=Date.now();for(const[n,s]of this.queues.entries()){const a=this.inFlightMessages.get(n)||[],c=[],l=[];for(const m of a)if(t>=m.visibilityTimeoutExpiresAt){const y=m.message;y.receiptHandle=void 0,s.maxReceiveCount&&y.receiveCount>=s.maxReceiveCount?this.sendToDLQ(s,y):c.push(y)}else l.push(m);if(this.inFlightMessages.set(n,l),c.length>0){const m=this.queueMessages.get(n)||[];if(s.type==="fifo"){const y=this.messageGroups.get(n);if(y)for(const b of c){const S=b.messageGroupId||"default-group",M=y.get(S)||[];M.push(b),y.set(S,M)}}m.push(...c),this.queueMessages.set(n,m)}const f=(this.queueMessages.get(n)||[]).filter(m=>t>=m.retentionExpiresAt?(s.deadLetterQueue&&this.sendToDLQ(s,m),!1):!0);if(this.queueMessages.set(n,f),s.type==="fifo"){const m=this.messageGroups.get(n);if(m)for(const[y,b]of m.entries()){const S=b.filter(M=>t>=M.retentionExpiresAt?(s.deadLetterQueue&&this.sendToDLQ(s,M),!1):!0);S.length===0?m.delete(y):m.set(y,S)}}const p=this.queueState.get(n);if(p){const m=this.queueMessages.get(n)||[],y=this.inFlightMessages.get(n)||[],b=m.filter(S=>S.delayUntil&&t<S.delayUntil);p.approximateMessages=m.length,p.approximateMessagesNotVisible=y.length,p.approximateMessagesDelayed=b.length,p.lastUpdate=t}}}sendToDLQ(e,t){if(!e.deadLetterQueue||!this.queues.get(e.deadLetterQueue))return;const s=this.dlqMessages.get(e.deadLetterQueue)||[];s.push(t),this.dlqMessages.set(e.deadLetterQueue,s);const a=this.queueState.get(e.deadLetterQueue);a&&(a.dlqCount=(a.dlqCount||0)+1,a.approximateMessages=s.length);const c=this.queueState.get(e.name);c&&(c.dlqCount=(c.dlqCount||0)+1)}hashString(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t=t&t}return Math.abs(t).toString(36)}getQueueMetrics(e){if(!this.queues.get(e))return null;const n=this.queueState.get(e);return n?{approximateMessages:n.approximateMessages,approximateMessagesNotVisible:n.approximateMessagesNotVisible,approximateMessagesDelayed:n.approximateMessagesDelayed,sentCount:n.sentCount,receivedCount:n.receivedCount,deletedCount:n.deletedCount,dlqCount:n.dlqCount}:null}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getTotalQueueDepth(){let e=0;for(const t of this.queueMessages.values())e+=t.length;for(const t of this.inFlightMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.queueState.values())(t.sentCount>0||t.receivedCount>0)&&(e+=1);return Math.max(1,e)}updateQueue(e,t){const n=this.queues.get(e);n&&(Object.assign(n,t),this.queues.set(e,n))}}class Ek{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;lockedMessages=new Map;deadLetterMessages=new Map;scheduledMessages=new Map;sessionMessages=new Map;queueState=new Map;subscriptionState=new Map;initialize(e){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.lockedMessages.clear(),this.deadLetterMessages.clear(),this.scheduledMessages.clear(),this.sessionMessages.clear(),this.queueState.clear(),this.subscriptionState.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.lockedMessages.set(t.name,[]),this.deadLetterMessages.set(t.name,[]),this.scheduledMessages.set(t.name,[]),this.queueState.set(t.name,{activeMessageCount:t.activeMessageCount||0,deadLetterMessageCount:t.deadLetterMessageCount||0,scheduledMessageCount:t.scheduledMessageCount||0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),t.enableSessions&&this.sessionMessages.set(t.name,new Map);if(e.topics){for(const t of e.topics)if(this.topics.set(t.name,{...t}),this.topicMessages.set(t.name,[]),this.scheduledMessages.set(t.name,[]),this.subscriptions.set(t.name,[]),t.subscriptions)for(const n of t.subscriptions){const s=this.subscriptions.get(t.name)||[];s.push(n),this.subscriptions.set(t.name,s);const a=`${t.name}/subscriptions/${n.name}`;this.subscriptionMessages.set(a,[]),this.lockedMessages.set(a,[]),this.deadLetterMessages.set(a,[]),this.subscriptionState.set(a,{activeMessageCount:n.activeMessageCount||0,deadLetterMessageCount:0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),this.sessionMessages.set(a,new Map)}}}sendToQueue(e,t,n,s,a,c){const l=this.queues.get(e);if(!l)return null;const d=Date.now(),f=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=`${e}-${f}`,m=l.defaultMessageTimeToLive*1e3,y=d+m,b={id:f,messageId:p,timestamp:d,destination:e,payload:t,size:n,properties:s,sessionId:a,scheduledEnqueueTime:c,expirationTime:y,deliveryCount:0,enqueuedTime:c||d};if(c&&c>d){const M=this.scheduledMessages.get(e)||[];M.push(b),this.scheduledMessages.set(e,M);const E=this.queueState.get(e);return E&&(E.scheduledMessageCount=M.length),p}if(l.enableSessions&&a){const M=this.sessionMessages.get(e);if(M){const E=M.get(a)||[];E.push(b),M.set(a,E)}}else{const M=this.queueMessages.get(e)||[];M.push(b),this.queueMessages.set(e,M)}const S=this.queueState.get(e);if(S){const M=this.getAvailableMessages(e);S.activeMessageCount=M.length,S.sentCount=(S.sentCount||0)+1,S.lastUpdate=d}return p}publishToTopic(e,t,n,s,a){const c=this.topics.get(e);if(!c)return[];const l=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f=`${e}-${d}`,p=c.defaultMessageTimeToLive*1e3,m=l+p,y={id:d,messageId:f,timestamp:l,destination:e,payload:t,size:n,properties:s,scheduledEnqueueTime:a,expirationTime:m,deliveryCount:0,enqueuedTime:a||l},b=[];if(a&&a>l){const M=this.scheduledMessages.get(e)||[];return M.push(y),this.scheduledMessages.set(e,M),[f]}const S=this.subscriptions.get(e)||[];if(S.length===0)return[];for(const M of S){const E=`${e}/subscriptions/${M.name}`,C=this.subscriptionMessages.get(E)||[],T={...y,id:`${d}-${M.name}`,messageId:`${f}-${M.name}`,subscriptionName:M.name};C.push(T),this.subscriptionMessages.set(E,C),b.push(T.messageId);const k=this.subscriptionState.get(E);if(k){const A=this.getAvailableSubscriptionMessages(E);k.activeMessageCount=A.length,k.sentCount=(k.sentCount||0)+1,k.lastUpdate=l}}return b}receiveFromQueue(e,t,n){const s=this.queues.get(e);if(!s)return null;const a=Date.now(),c=(t||s.lockDuration)*1e3,l=a+c;let d;if(s.enableSessions&&n){const y=this.sessionMessages.get(e);if(!y)return null;d=y.get(n)||[]}else d=this.getAvailableMessages(e);if(d.length===0)return null;const f=d.shift();f.deliveryCount=(f.deliveryCount||0)+1,f.lockedUntil=l,f.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const p=this.lockedMessages.get(e)||[];if(p.push({message:f,lockedAt:a,lockExpiresAt:l}),this.lockedMessages.set(e,p),s.enableSessions&&n){const y=this.sessionMessages.get(e);if(y){const b=y.get(n)||[],S=b.findIndex(M=>M.id===f.id);S>=0&&(b.splice(S,1),y.set(n,b))}}const m=this.queueState.get(e);if(m){const y=this.getAvailableMessages(e);m.activeMessageCount=y.length,m.receivedCount=(m.receivedCount||0)+1,m.lastUpdate=a}return f}receiveFromSubscription(e,t,n){const s=`${e}/subscriptions/${t}`,a=this.getAvailableSubscriptionMessages(s);if(a.length===0)return null;const c=this.subscriptions.get(e)?.find(b=>b.name===t);if(!c)return null;const l=Date.now(),d=(n||c.lockDuration)*1e3,f=l+d,p=a.shift();p.deliveryCount=(p.deliveryCount||0)+1,p.lockedUntil=f,p.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const m=this.lockedMessages.get(s)||[];m.push({message:p,lockedAt:l,lockExpiresAt:f}),this.lockedMessages.set(s,m);const y=this.subscriptionState.get(s);if(y){const b=this.getAvailableSubscriptionMessages(s);y.activeMessageCount=b.length,y.receivedCount=(y.receivedCount||0)+1,y.lastUpdate=l}return p}completeMessage(e,t){const n=this.lockedMessages.get(e)||[],s=n.findIndex(c=>c.message.lockToken===t);if(s<0)return!1;if(n.splice(s,1),this.lockedMessages.set(e,n),this.queues.has(e)){const c=this.queueState.get(e);c&&(c.completedCount=(c.completedCount||0)+1,c.lastUpdate=Date.now())}else{const c=this.subscriptionState.get(e);c&&(c.completedCount=(c.completedCount||0)+1,c.lastUpdate=Date.now())}return!0}abandonMessage(e,t){const n=this.lockedMessages.get(e)||[],s=n.findIndex(f=>f.message.lockToken===t);if(s<0)return!1;const a=n[s];n.splice(s,1),this.lockedMessages.set(e,n);const c=a.message;c.lockToken=void 0,c.lockedUntil=void 0;const l=this.queues.has(e),d=l?this.queues.get(e)?.maxDeliveryCount||10:this.subscriptions.get(c.destination)?.find(f=>f.name===c.subscriptionName)?.maxDeliveryCount||10;if(c.deliveryCount>=d){const f=this.deadLetterMessages.get(e)||[];if(f.push(c),this.deadLetterMessages.set(e,f),l){const p=this.queueState.get(e);p&&(p.deadLetterMessageCount=f.length,p.abandonedCount=(p.abandonedCount||0)+1,p.lastUpdate=Date.now())}else{const p=this.subscriptionState.get(e);p&&(p.deadLetterMessageCount=f.length,p.abandonedCount=(p.abandonedCount||0)+1,p.lastUpdate=Date.now())}}else{if(l){const f=this.queues.get(e);if(f)if(f.enableSessions&&c.sessionId){const p=this.sessionMessages.get(e);if(p){const m=p.get(c.sessionId)||[];m.push(c),p.set(c.sessionId,m)}}else{const p=this.queueMessages.get(e)||[];p.push(c),this.queueMessages.set(e,p)}}else{const f=this.subscriptionMessages.get(e)||[];f.push(c),this.subscriptionMessages.set(e,f)}if(l){const f=this.queueState.get(e);if(f){const p=this.getAvailableMessages(e);f.activeMessageCount=p.length,f.abandonedCount=(f.abandonedCount||0)+1,f.lastUpdate=Date.now()}}else{const f=this.subscriptionState.get(e);if(f){const p=this.getAvailableSubscriptionMessages(e);f.activeMessageCount=p.length,f.abandonedCount=(f.abandonedCount||0)+1,f.lastUpdate=Date.now()}}}return!0}processConsumption(e){const t=Date.now();for(const[n,s]of this.queues.entries()){const a=this.scheduledMessages.get(n)||[],c=this.queueMessages.get(n)||[],l=this.sessionMessages.get(n);for(let m=a.length-1;m>=0;m--){const y=a[m];if(y.scheduledEnqueueTime&&y.scheduledEnqueueTime<=t)if(a.splice(m,1),s.enableSessions&&y.sessionId&&l){const b=l.get(y.sessionId)||[];b.push(y),l.set(y.sessionId,b)}else c.push(y)}this.scheduledMessages.set(n,a),this.queueMessages.set(n,c);const d=this.lockedMessages.get(n)||[];for(let m=d.length-1;m>=0;m--){const y=d[m];y.lockExpiresAt<=t&&(d.splice(m,1),this.abandonMessage(n,y.message.lockToken))}this.lockedMessages.set(n,d);const f=this.getAvailableMessages(n);for(let m=f.length-1;m>=0;m--){const y=f[m];if(y.expirationTime<=t&&(f.splice(m,1),s.enableDeadLetteringOnMessageExpiration)){const b=this.deadLetterMessages.get(n)||[];b.push(y),this.deadLetterMessages.set(n,b)}}this.queueMessages.set(n,f);const p=this.queueState.get(n);p&&(p.activeMessageCount=this.getAvailableMessages(n).length,p.deadLetterMessageCount=(this.deadLetterMessages.get(n)||[]).length,p.scheduledMessageCount=a.length,p.lastUpdate=t)}for(const[n,s]of this.topics.entries()){const a=this.scheduledMessages.get(n)||[];for(let l=a.length-1;l>=0;l--){const d=a[l];d.scheduledEnqueueTime&&d.scheduledEnqueueTime<=t&&(a.splice(l,1),this.publishToTopic(n,d.payload,d.size,d.properties))}this.scheduledMessages.set(n,a);const c=this.subscriptions.get(n)||[];for(const l of c){const d=`${n}/subscriptions/${l.name}`,f=this.lockedMessages.get(d)||[];for(let y=f.length-1;y>=0;y--){const b=f[y];b.lockExpiresAt<=t&&(f.splice(y,1),this.abandonMessage(d,b.message.lockToken))}this.lockedMessages.set(d,f);const p=this.getAvailableSubscriptionMessages(d);for(let y=p.length-1;y>=0;y--){const b=p[y];if(b.expirationTime<=t&&(p.splice(y,1),l.enableDeadLetteringOnMessageExpiration)){const S=this.deadLetterMessages.get(d)||[];S.push(b),this.deadLetterMessages.set(d,S)}}this.subscriptionMessages.set(d,p);const m=this.subscriptionState.get(d);m&&(m.activeMessageCount=this.getAvailableSubscriptionMessages(d).length,m.deadLetterMessageCount=(this.deadLetterMessages.get(d)||[]).length,m.lastUpdate=t)}}}getAvailableMessages(e){if(!this.queues.get(e))return[];const n=Date.now();return(this.queueMessages.get(e)||[]).filter(a=>a.expirationTime>n)}getAvailableSubscriptionMessages(e){const t=Date.now();return(this.subscriptionMessages.get(e)||[]).filter(s=>s.expirationTime>t)}getTotalQueueDepth(){let e=0;for(const t of this.queues.keys())e+=this.getAvailableMessages(t).length;return e}getTotalSubscriptionMessages(){let e=0;for(const t of this.subscriptionMessages.keys())e+=this.getAvailableSubscriptionMessages(t).length;return e}getQueueMetrics(e){const t=this.queueState.get(e);return t?{activeMessageCount:t.activeMessageCount,deadLetterMessageCount:t.deadLetterMessageCount,scheduledMessageCount:t.scheduledMessageCount,sentCount:t.sentCount,receivedCount:t.receivedCount,completedCount:t.completedCount,abandonedCount:t.abandonedCount}:null}getSubscriptionMetrics(e,t){const n=`${e}/subscriptions/${t}`,s=this.subscriptionState.get(n);return s?{activeMessageCount:s.activeMessageCount,deadLetterMessageCount:s.deadLetterMessageCount,sentCount:s.sentCount,receivedCount:s.receivedCount,completedCount:s.completedCount,abandonedCount:s.abandonedCount}:null}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getAllSubscriptionMetrics(){const e=new Map;for(const[t,n]of this.subscriptionState.entries())e.set(t,{activeMessageCount:n.activeMessageCount,deadLetterMessageCount:n.deadLetterMessageCount,sentCount:n.sentCount,receivedCount:n.receivedCount,completedCount:n.completedCount,abandonedCount:n.abandonedCount});return e}getActiveConnections(){return this.queues.size+this.topics.size}}class Rk{topics=new Map;subscriptions=new Map;topicSubscriptions=new Map;topicMessages=new Map;subscriptionMessages=new Map;unackedMessages=new Map;orderingKeyQueues=new Map;topicState=new Map;subscriptionState=new Map;initialize(e){if(this.topics.clear(),this.subscriptions.clear(),this.topicSubscriptions.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.unackedMessages.clear(),this.orderingKeyQueues.clear(),this.topicState.clear(),this.subscriptionState.clear(),e.topics)for(const t of e.topics)this.topics.set(t.name,{...t}),this.topicMessages.set(t.name,[]),this.topicSubscriptions.set(t.name,[]),this.orderingKeyQueues.set(t.name,new Map),this.topicState.set(t.name,{messageCount:t.messageCount||0,byteCount:t.byteCount||0,publishedCount:0,lastUpdate:Date.now()});if(e.subscriptions)for(const t of e.subscriptions){this.subscriptions.set(t.name,{...t}),this.subscriptionMessages.set(t.name,[]),this.unackedMessages.set(t.name,[]);const n=this.topicSubscriptions.get(t.topic)||[];n.includes(t.name)||n.push(t.name),this.topicSubscriptions.set(t.topic,n),this.subscriptionState.set(t.name,{messageCount:t.messageCount||0,unackedMessageCount:t.unackedMessageCount||0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:Date.now()})}}publishToTopic(e,t,n,s,a){if(!this.topics.get(e))return null;const l=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f=l,p={id:`pubsub_${d}`,messageId:d,publishTime:f,data:t,attributes:s,orderingKey:a,size:n},m=this.topicMessages.get(e)||[];if(a){const S=this.orderingKeyQueues.get(e)||new Map,M=S.get(a)||[];M.push(p),S.set(a,M),this.orderingKeyQueues.set(e,S)}else m.push(p),this.topicMessages.set(e,m);const y=this.topicSubscriptions.get(e)||[];for(const S of y){const M=this.subscriptions.get(S);if(!M)continue;const E={...p,id:`${p.id}_${S}`},C=this.subscriptionMessages.get(S)||[];M.enableMessageOrdering,C.push(E),this.subscriptionMessages.set(S,C)}const b=this.topicState.get(e)||{messageCount:0,byteCount:0,publishedCount:0,lastUpdate:l};return b.messageCount=m.length+(a&&this.orderingKeyQueues.get(e)?.get(a)?.length||0),b.byteCount=(b.byteCount||0)+n,b.publishedCount=(b.publishedCount||0)+1,b.lastUpdate=l,this.topicState.set(e,b),d}pullFromSubscription(e,t=100){const n=this.subscriptions.get(e);if(!n)return[];const s=this.subscriptionMessages.get(e)||[];if(s.length===0)return[];const a=Date.now(),c=n.ackDeadlineSeconds*1e3,l=[],d=[];if(n.enableMessageOrdering){const m=new Map;for(const y of s){const b=y.orderingKey||"__no_key__";m.has(b)||m.set(b,[]),m.get(b).push(y)}for(const[y,b]of m.entries()){if(l.length>=t)break;const S=Math.min(b.length,t-l.length),M=b.splice(0,S);l.push(...M),d.push(...b)}for(const[y,b]of m.entries())b.length>0&&d.find(S=>(S.orderingKey||"__no_key__")===y)===void 0&&d.push(...b)}else{const m=Math.min(s.length,t);l.push(...s.splice(0,m)),d.push(...s)}this.subscriptionMessages.set(e,d);const f=this.unackedMessages.get(e)||[];for(const m of l){const y=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;m.ackId=y,f.push({message:m,subscriptionName:e,ackDeadlineExpiresAt:a+c,deliveryAttempt:1,orderingKey:m.orderingKey})}this.unackedMessages.set(e,f);const p=this.subscriptionState.get(e)||{messageCount:0,unackedMessageCount:0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:a};return p.messageCount=d.length,p.unackedMessageCount=f.length,p.deliveredCount=(p.deliveredCount||0)+l.length,p.lastUpdate=a,this.subscriptionState.set(e,p),l}ackMessage(e,t){if(!this.subscriptions.get(e))return!1;const s=this.unackedMessages.get(e)||[],a=s.length,c=s.filter(l=>l.message.ackId!==t);if(this.unackedMessages.set(e,c),c.length<a){const l=this.subscriptionState.get(e);return l&&(l.unackedMessageCount=c.length,l.acknowledgedCount=(l.acknowledgedCount||0)+1,l.lastUpdate=Date.now()),!0}return!1}nackMessage(e,t){if(!this.subscriptions.get(e))return!1;const s=this.unackedMessages.get(e)||[],a=s.findIndex(p=>p.message.ackId===t);if(a===-1)return!1;const l=s[a].message;s.splice(a,1),this.unackedMessages.set(e,s);const d=this.subscriptionMessages.get(e)||[];l.ackId=void 0,d.push(l),this.subscriptionMessages.set(e,d);const f=this.subscriptionState.get(e);return f&&(f.unackedMessageCount=s.length,f.messageCount=d.length,f.nackedCount=(f.nackedCount||0)+1,f.lastUpdate=Date.now()),!0}processConsumption(e){const t=Date.now();for(const[n,s]of this.unackedMessages.entries()){if(!this.subscriptions.get(n))continue;const c=[],l=[];for(const d of s)t>=d.ackDeadlineExpiresAt?c.push(d):l.push(d);if(c.length>0){const d=this.subscriptionMessages.get(n)||[];for(const p of c){const m=p.message;m.ackId=void 0,d.push(m)}this.subscriptionMessages.set(n,d);const f=this.subscriptionState.get(n);f&&(f.unackedMessageCount=l.length,f.messageCount=d.length)}this.unackedMessages.set(n,l)}for(const[n,s]of this.subscriptions.entries())if(s.pushEndpoint){const a=this.subscriptionMessages.get(n)||[];if(a.length>0){const l=Math.min(a.length,10),d=a.splice(0,l),f=this.unackedMessages.get(n)||[],p=Date.now(),m=s.ackDeadlineSeconds*1e3;for(const b of d){const S=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;b.ackId=S,f.push({message:b,subscriptionName:n,ackDeadlineExpiresAt:p+m,deliveryAttempt:1,orderingKey:b.orderingKey})}this.subscriptionMessages.set(n,a),this.unackedMessages.set(n,f);const y=this.subscriptionState.get(n);y&&(y.messageCount=a.length,y.unackedMessageCount=f.length,y.deliveredCount=(y.deliveredCount||0)+d.length)}}for(const[n,s]of this.topics.entries()){const c=(s.messageRetentionDuration||604800)*1e3,l=this.topicMessages.get(n)||[],d=Date.now(),f=l.filter(p=>d-p.publishTime<c);if(f.length<l.length){l.length-f.length,this.topicMessages.set(n,f);const p=this.topicState.get(n);p&&(p.messageCount=f.length)}}}getTopicMetrics(e){if(!this.topics.get(e))return null;const n=this.topicState.get(e);return n?{messageCount:n.messageCount,byteCount:n.byteCount,publishedCount:n.publishedCount}:null}getSubscriptionMetrics(e){if(!this.subscriptions.get(e))return null;const n=this.subscriptionState.get(e);return n?{messageCount:n.messageCount,unackedMessageCount:n.unackedMessageCount,deliveredCount:n.deliveredCount,acknowledgedCount:n.acknowledgedCount,nackedCount:n.nackedCount}:null}getAllTopicMetrics(){const e=new Map;for(const t of this.topics.keys()){const n=this.getTopicMetrics(t);n&&e.set(t,n)}return e}getAllSubscriptionMetrics(){const e=new Map;for(const t of this.subscriptions.keys()){const n=this.getSubscriptionMetrics(t);n&&e.set(t,n)}return e}getTotalTopicMessages(){let e=0;for(const t of this.topicMessages.values())e+=t.length;for(const t of this.orderingKeyQueues.values())for(const n of t.values())e+=n.length;return e}getTotalUnackedMessages(){let e=0;for(const t of this.unackedMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.subscriptions.values())t.pushEndpoint,e+=1;return Math.max(1,e+1)}updateTopic(e,t){const n=this.topics.get(e);n&&(Object.assign(n,t),this.topics.set(e,n))}updateSubscription(e,t){const n=this.subscriptions.get(e);n&&(Object.assign(n,t),this.subscriptions.set(e,n))}}class kk{services=new Map;routes=new Map;upstreams=new Map;consumers=new Map;plugins=[];roundRobinCounters=new Map;connectionCounts=new Map;consistentHashRing=new Map;rateLimitCounters=new Map;initialize(e){if(this.services.clear(),this.routes.clear(),this.upstreams.clear(),this.consumers.clear(),this.plugins=[],this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.consistentHashRing.clear(),this.rateLimitCounters.clear(),e.services)for(const t of e.services)this.services.set(t.id,{...t});if(e.routes)for(const t of e.routes)this.routes.set(t.id,{...t});if(e.upstreams){for(const t of e.upstreams)if(this.upstreams.set(t.name,{...t}),this.roundRobinCounters.set(t.name,0),t.algorithm==="consistent-hashing"&&t.targets){const n=[...t.targets].filter(s=>s.health==="healthy").sort((s,a)=>s.target.localeCompare(a.target));this.consistentHashRing.set(t.name,n.map(s=>s.target))}}if(e.consumers)for(const t of e.consumers)this.consumers.set(t.id,{...t});e.plugins&&(this.plugins=e.plugins.filter(t=>t.enabled))}routeRequest(e){const t=Date.now(),n=this.matchRoute(e);if(!n)return{match:null,response:{status:404,error:"No route matched",latency:Date.now()-t}};const s=this.executePlugins(e,n,"access");if(s.blocked)return{match:n,response:{status:s.status||403,error:s.error||"Request blocked by plugin",latency:Date.now()-t}};const a=this.selectUpstreamTarget(n.service);if(!a)return{match:n,response:{status:503,error:"No healthy upstream target available",latency:Date.now()-t}};this.transformPath(e.path,n);const c={status:200,latency:Date.now()-t};return c.latency=(c.latency||0)+this.simulateUpstreamLatency(a),{match:n,response:c,target:a}}matchRoute(e){const t=Array.from(this.routes.values()).sort((n,s)=>(s.priority||0)-(n.priority||0));for(const n of t){if(n.method&&n.method.toUpperCase()!==e.method.toUpperCase())continue;const s=this.matchPath(n.path,e.path);if(s){const a=this.services.get(n.service);if(!a||!a.enabled)continue;return{route:n,service:a,matchedPath:s.matched,remainingPath:s.remaining}}}return null}matchPath(e,t){if(t.startsWith(e))return{matched:e,remaining:t.substring(e.length)};try{if(new RegExp(`^${e}$`).test(t))return{matched:t,remaining:""}}catch{}return null}selectUpstreamTarget(e){const t=e.upstream||e.name,n=this.upstreams.get(t);if(!n||!n.targets||n.targets.length===0)return e.url;const s=n.targets.filter(c=>c.health==="healthy");if(s.length===0)return null;switch(n.algorithm||"round-robin"){case"round-robin":return this.selectRoundRobin(t,s);case"consistent-hashing":return this.selectConsistentHash(t,s,e.name);case"least-connections":return this.selectLeastConnections(s);default:return s[0].target}}selectRoundRobin(e,t){const n=this.roundRobinCounters.get(e)||0,s=t[n%t.length];return this.roundRobinCounters.set(e,(n+1)%t.length),s.target}selectConsistentHash(e,t,n){const a=this.simpleHash(n)%t.length;return t[a].target}selectLeastConnections(e){let t=1/0,n=e[0].target;for(const a of e){const c=this.connectionCounts.get(a.target)||0;c<t&&(t=c,n=a.target)}const s=this.connectionCounts.get(n)||0;return this.connectionCounts.set(n,s+1),n}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t=t&t}return Math.abs(t)}transformPath(e,t){return t.route.stripPath?t.remainingPath||"/":e}executePlugins(e,t,n){const s=this.plugins.filter(a=>!(a.route&&a.route!==t.route.id||a.service&&a.service!==t.service.id));for(const a of s){const c=this.executePlugin(a,e,t,n);if(c.blocked)return c}return{blocked:!1}}executePlugin(e,t,n,s){const a=e.config||{};switch(e.name){case"rate-limiting":return this.executeRateLimiting(e,t,n,a);case"key-auth":return this.executeKeyAuth(e,t,n,a);case"jwt":return this.executeJWT(e,t,n,a);case"cors":return{blocked:!1};case"ip-restriction":return this.executeIPRestriction(e,t,n,a);default:return{blocked:!1}}}executeRateLimiting(e,t,n,s){const a=t.consumerId||n.service.id||n.route.id,c=Date.now();let l=this.rateLimitCounters.get(e.id);l||(l=new Map,this.rateLimitCounters.set(e.id,l));let d=l.get(a);(!d||d.resetAt<c)&&(d={count:0,resetAt:c+6e4},l.set(a,d));const f=s.minute||1e3;return s.hour,d.count++,d.count>f?{blocked:!0,status:429,error:"Rate limit exceeded (per minute)"}:{blocked:!1}}executeKeyAuth(e,t,n,s){const a=s.key_names||["apikey"],c=t.apiKey||t.headers?.[a[0]]||t.query?.[a[0]];return c?Array.from(this.consumers.values()).find(d=>d.credentials?.some(f=>f.type==="key-auth"&&f.key===c))?{blocked:!1}:{blocked:!0,status:401,error:"Invalid API key"}:{blocked:!0,status:401,error:"API key required"}}executeJWT(e,t,n,s){const a=t.headers?.Authorization;return!a||!a.startsWith("Bearer ")?{blocked:!0,status:401,error:"JWT token required"}:{blocked:!1}}executeIPRestriction(e,t,n,s){const a=t.headers?.["X-Forwarded-For"]||t.headers?.["X-Real-IP"]||"unknown",c=s.whitelist||[];return(s.blacklist||[]).includes(a)?{blocked:!0,status:403,error:"IP address blocked"}:c.length>0&&!c.includes(a)?{blocked:!0,status:403,error:"IP address not whitelisted"}:{blocked:!1}}simulateUpstreamLatency(e){return 10+Math.random()*40}getStats(){return{services:this.services.size,routes:this.routes.size,upstreams:this.upstreams.size,consumers:this.consumers.size,plugins:this.plugins.length}}}class Tk{proxies=new Map;policies=[];organization;environment;quotaCounters=new Map;spikeArrestBuckets=new Map;apiKeyCache=new Map;oauthTokenCache=new Map;jwtTokenCache=new Map;proxyMetrics=new Map;initialize(e){if(this.proxies.clear(),this.policies=[],this.quotaCounters.clear(),this.spikeArrestBuckets.clear(),this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear(),this.proxyMetrics.clear(),this.organization=e.organization||"archiphoenix-org",this.environment=e.environment||"prod",e.proxies)for(const t of e.proxies)this.proxies.set(t.name,{...t}),this.proxyMetrics.set(t.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),t.spikeArrest&&t.spikeArrest>0&&this.spikeArrestBuckets.set(t.name,{tokens:t.spikeArrest,lastRefill:Date.now(),rate:t.spikeArrest});e.policies&&(this.policies=e.policies.filter(t=>t.enabled))}routeRequest(e){const t=Date.now(),n=this.matchProxy(e);if(!n)return{match:null,response:{status:404,error:"No API proxy matched for path",latency:Date.now()-t}};if(n.proxy.status==="undeployed")return this.updateProxyMetrics(n.proxy.name,!1,Date.now()-t),{match:n,response:{status:503,error:`Proxy '${n.proxy.name}' is not deployed`,latency:Date.now()-t}};const s=this.policies.filter(b=>b.enabled&&(b.executionFlow==="PreFlow"||!b.executionFlow&&this.isPreFlowPolicy(b.type))),a=this.executePolicies(s,e,n,"PreFlow");if(a.blocked)return this.updateProxyMetrics(n.proxy.name,!0,Date.now()-t),{match:n,response:{status:a.status||401,error:a.error||"Authentication failed",latency:Date.now()-t}};const c=this.policies.filter(b=>b.enabled&&(b.executionFlow==="RequestFlow"||!b.executionFlow&&this.isRequestFlowPolicy(b.type))),l=this.executePolicies(c,e,n,"RequestFlow");if(l.blocked)return this.updateProxyMetrics(n.proxy.name,!0,Date.now()-t),{match:n,response:{status:l.status||429,error:l.error||"Request policy violation",latency:Date.now()-t}};const d=this.buildTargetUrl(n.proxy,n.remainingPath),f=this.simulateUpstreamLatency(d),p=Date.now()-t+f,m=this.policies.filter(b=>b.enabled&&(b.executionFlow==="PostFlow"||!b.executionFlow&&this.isPostFlowPolicy(b.type))),y={status:200,latency:p};return this.executePolicies(m,e,n,"PostFlow",y),this.updateProxyMetrics(n.proxy.name,!1,p),{match:n,response:y,target:d}}matchProxy(e){const t=Array.from(this.proxies.values()).filter(n=>n.status==="deployed"||n.status===void 0).sort((n,s)=>s.basePath.length-n.basePath.length);for(const n of t)if(e.path.startsWith(n.basePath)){const s=e.path.slice(n.basePath.length)||"/";return{proxy:n,matchedPath:n.basePath,remainingPath:s}}return null}isPreFlowPolicy(e){return["verify-api-key","oauth","jwt"].includes(e)}isRequestFlowPolicy(e){return["quota","spike-arrest"].includes(e)}isPostFlowPolicy(e){return["cors","xml-to-json"].includes(e)}evaluateCondition(e,t,n){if(!e)return!0;try{if(e.includes("request.path")){const s=e.match(/request\.path\s*[=!]=\s*['"]([^'"]+)['"]/);if(s)return t.path===s[1]}return e.length>0}catch{return!0}}executePolicies(e,t,n,s,a){for(const c of e)if(this.evaluateCondition(c.condition,t,n))if(s==="PreFlow"){const l=this.executePreFlowPolicy(c,t,n);if(l.blocked)return l}else if(s==="RequestFlow"){const l=this.executeRequestFlowPolicy(c,t,n);if(l.blocked)return l}else s==="PostFlow"&&a&&this.executePostFlowPolicy(c,t,n,a);return{blocked:!1}}executePreFlowPolicy(e,t,n){if(n.proxy,e.type==="verify-api-key"){const s=t.apiKey||t.headers?.["X-API-Key"]||t.headers?.apikey||t.query?.apikey;if(!s)return{blocked:!0,status:401,error:"API key is required"};if(!this.validateApiKey(s))return{blocked:!0,status:401,error:"Invalid API key"}}if(e.type==="oauth"&&n.proxy.enableOAuth){const a=t.oauthToken||t.headers?.Authorization?.replace("Bearer ","")||t.headers?.Authorization?.replace("OAuth ","");if(!a)return{blocked:!0,status:401,error:"OAuth token is required"};if(!this.validateOAuthToken(a))return{blocked:!0,status:401,error:"Invalid or expired OAuth token"}}if(e.type==="jwt"){const s=n.proxy;if(s.jwtIssuer){const a=t.jwtToken||t.headers?.Authorization?.replace("Bearer ","")||t.headers?.["X-JWT-Token"];if(!a)return{blocked:!0,status:401,error:"JWT token is required"};if(!this.validateJWTToken(a,s.jwtIssuer))return{blocked:!0,status:401,error:"Invalid or expired JWT token"}}}return{blocked:!1}}executeRequestFlowPolicy(e,t,n){const s=n.proxy,a=t.headers?.["X-Consumer-ID"]||"default";if(e.type==="quota"){const c=e.config?.quota||s.quota,l=e.config?.interval||s.quotaInterval;if(c&&l&&!this.checkQuota(s.name,a,c,l))return{blocked:!0,status:429,error:`Quota exceeded: ${c} requests per ${l} seconds`}}if(e.type==="spike-arrest"){const c=e.config?.rate||s.spikeArrest;if(c&&c>0&&!this.checkSpikeArrest(s.name,c))return{blocked:!0,status:429,error:`Spike arrest limit exceeded: ${c} requests per second`}}return{blocked:!1}}executePostFlowPolicy(e,t,n,s){e.type==="cors"&&(s.headers||(s.headers={}),s.headers["Access-Control-Allow-Origin"]=e.config?.origins?.[0]||"*",s.headers["Access-Control-Allow-Methods"]=e.config?.methods?.join(", ")||"GET, POST, PUT, DELETE",s.headers["Access-Control-Allow-Headers"]=e.config?.headers?.join(", ")||"Content-Type, Authorization"),e.type==="xml-to-json"&&(s.headers||(s.headers={}),s.headers["Content-Type"]="application/json")}checkQuota(e,t,n,s){const a=Date.now(),c=s*1e3;let l=this.quotaCounters.get(e);l||(l=new Map,this.quotaCounters.set(e,l));let d=l.get(t);return(!d||d.resetAt<a)&&(d={count:0,resetAt:a+c,identifier:t},l.set(t,d)),d.count>=n?!1:(d.count++,!0)}checkSpikeArrest(e,t){const n=Date.now();let s=this.spikeArrestBuckets.get(e);s||(s={tokens:t,lastRefill:n,rate:t},this.spikeArrestBuckets.set(e,s));const c=(n-s.lastRefill)/1e3*s.rate;return s.tokens=Math.min(s.rate,s.tokens+c),s.lastRefill=n,s.tokens<1?!1:(s.tokens-=1,!0)}validateApiKey(e){const t=this.apiKeyCache.get(e);if(t&&t.expiresAt>Date.now())return t.valid;const n=e.length>=10;return this.apiKeyCache.set(e,{valid:n,expiresAt:Date.now()+300*1e3}),n}validateOAuthToken(e){const t=this.oauthTokenCache.get(e);if(t&&t.expiresAt>Date.now())return t.valid;const n=e.length>=20;return this.oauthTokenCache.set(e,{valid:n,expiresAt:Date.now()+3600*1e3}),n}validateJWTToken(e,t){const n=this.jwtTokenCache.get(e);if(n&&n.expiresAt>Date.now())return n.valid&&n.issuer===t;const s=e.length>=20;return this.jwtTokenCache.set(e,{valid:s,issuer:t,expiresAt:Date.now()+3600*1e3}),s}buildTargetUrl(e,t){const n=e.targetEndpoint.replace(/\/$/,""),s=t.startsWith("/")?t:`/${t}`;return`${n}${s}`}simulateUpstreamLatency(e){const t=10+Math.random()*40,n=(Math.random()-.5)*10;return Math.max(1,t+n)}updateProxyMetrics(e,t,n){const s=this.proxyMetrics.get(e);s&&(s.requestCount++,t&&s.errorCount++,s.totalLatency+=n,s.lastRequestTime=Date.now())}getStats(){let e=0,t=0,n=0;for(const a of this.proxyMetrics.values())e+=a.requestCount,t+=a.errorCount,n+=a.totalLatency;const s=e>0?n/e:0;return{proxies:this.proxies.size,policies:this.policies.length,totalRequests:e,totalErrors:t,avgLatency:s}}getProxyMetrics(e){const t=this.proxyMetrics.get(e);return t?{requestCount:t.requestCount,errorCount:t.errorCount,avgResponseTime:t.requestCount>0?t.totalLatency/t.requestCount:0}:null}clearCaches(){this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear()}}class Ak{applications=new Map;connectors=new Map;organization;environment;applicationMetrics=new Map;connectorMetrics=new Map;reconnectionState=new Map;initialize(e){if(this.applications.clear(),this.connectors.clear(),this.applicationMetrics.clear(),this.connectorMetrics.clear(),this.reconnectionState.clear(),this.organization=e.organization||"archiphoenix-org",this.environment=e.environment||"production",e.applications)for(const t of e.applications)this.applications.set(t.name,{...t}),this.applicationMetrics.set(t.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0});if(e.connectors)for(const t of e.connectors)this.connectors.set(t.name,{...t}),this.connectorMetrics.set(t.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),this.reconnectionState.set(t.name,{attempts:0,lastAttempt:0,nextAttempt:0})}processData(e){const t=Date.now(),n=this.matchApplication(e);if(!n)return{match:null,response:{status:"error",error:"No Mule application matched for request",latency:Date.now()-t}};if(n.application.status!=="running")return this.updateApplicationMetrics(n.application.name,!1,Date.now()-t),{match:n,response:{status:"error",error:`Application '${n.application.name}' is not running (status: ${n.application.status})`,latency:Date.now()-t}};let s=0,a;try{s=this.processFlow(n,e)}catch(l){a=l instanceof Error?l.message:"Unknown error"}if(a&&!this.handleError(n.application,a))return this.updateApplicationMetrics(n.application.name,!0,Date.now()-t),{match:n,response:{status:"error",error:a,latency:Date.now()-t,application:n.application.name,flow:n.flow?.name}};const c=this.transformData(e,n);return this.updateApplicationMetrics(n.application.name,!1,Date.now()-t),n.matchedConnector&&this.updateConnectorMetrics(n.matchedConnector.name,!1,Date.now()-t),{match:n,response:{status:"success",data:c.data,format:c.format||e.format,latency:Date.now()-t,application:n.application.name,flow:n.flow?.name,connector:n.matchedConnector?.name}}}matchApplication(e){if(e.sourceComponentType||e.targetComponentType)for(const[t,n]of this.applications.entries()){if(n.status!=="running")continue;const s=this.findMatchingConnector(n,e.sourceComponentType,e.targetComponentType);if(s){const a=n.flows?.find(c=>c.source===s.name||c.target===s.name)||n.flows?.[0];return{application:n,flow:a,matchedConnector:s}}}for(const[t,n]of this.applications.entries())if(n.status==="running")return{application:n,flow:n.flows?.[0]};return null}findMatchingConnector(e,t,n){const s=e.connectors||[];for(const a of s){const c=this.connectors.get(a);if(!(!c||!c.enabled)&&(t&&this.connectorMatchesComponentType(c,t)||n&&this.connectorMatchesComponentType(c,n)))return c}return null}connectorMatchesComponentType(e,t){const n={database:["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],api:["rest","grpc","graphql","soap","websocket","webhook"],messaging:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],file:["s3-datalake"],business:["crm","erp","payment-gateway"]};for(const[s,a]of Object.entries(n))if(e.type===s&&a.includes(t))return!0;return e.targetComponentType===t}processFlow(e,t){if(!e.flow)return this.calculateBaseProcessingTime(e.application);let n=this.calculateBaseProcessingTime(e.application);if(e.flow.processors)for(const s of e.flow.processors)n+=this.processProcessor(s,t);return e.matchedConnector&&(n+=this.calculateConnectorLatency(e.matchedConnector)),n}calculateBaseProcessingTime(e){const t=5+Math.random()*10,n=parseFloat(e.runtimeVersion)>=4.5?.9:1;return t*n}processProcessor(e,t){switch(e.type){case"transform":return 2+Math.random()*6;case"validate":return 1+Math.random()*2;case"filter":return .5+Math.random()*1.5;case"enrich":return 3+Math.random()*7;case"route":return .5+Math.random()*.5;default:return 1}}calculateConnectorLatency(e){const n={database:10,api:20,messaging:5,file:50,custom:15}[e.type]||15,s=n*.5*Math.random();return n+s}transformData(e,t){if(e.targetComponentType){const n=this.getTargetFormat(e.targetComponentType);if(n&&n!==e.format)return{data:e.body,format:n}}return{data:e.body,format:e.format}}getTargetFormat(e){return{postgres:"json",mongodb:"json",redis:"json",rest:"json",graphql:"json",soap:"xml",grpc:"binary",kafka:"json",rabbitmq:"json"}[e]}handleError(e,t){switch(e.errorStrategy||"continue"){case"continue":return!0;case"rollback":return!1;case"propagate":return!1;default:return!1}}updateApplicationMetrics(e,t,n){const s=this.applicationMetrics.get(e);s&&(s.requestCount++,t&&s.errorCount++,s.totalLatency+=n,s.lastRequestTime=Date.now())}updateConnectorMetrics(e,t,n){const s=this.connectorMetrics.get(e);s&&(s.requestCount++,t&&s.errorCount++,s.totalLatency+=n,s.lastRequestTime=Date.now())}getStats(){let e=0,t=0,n=0;for(const c of this.applicationMetrics.values())e+=c.requestCount,t+=c.errorCount,n+=c.totalLatency;const s=Array.from(this.applications.values()).filter(c=>c.status==="running").length,a=Array.from(this.connectors.values()).filter(c=>c.enabled).length;return{applications:this.applications.size,runningApplications:s,connectors:this.connectors.size,enabledConnectors:a,totalRequests:e,totalErrors:t,avgLatency:e>0?n/e:0}}getApplicationMetrics(e){const t=this.applicationMetrics.get(e);return t?{requestCount:t.requestCount,errorCount:t.errorCount,avgLatency:t.requestCount>0?t.totalLatency/t.requestCount:0}:null}getConnectorMetrics(e){const t=this.connectorMetrics.get(e);return t?{requestCount:t.requestCount,errorCount:t.errorCount,avgLatency:t.requestCount>0?t.totalLatency/t.requestCount:0}:null}}class Dk{locations=[];upstreams=new Map;rateLimitZones=new Map;sslCertificates=new Map;roundRobinCounters=new Map;connectionCounts=new Map;ipHashMap=new Map;hashRing=new Map;rateLimitCounters=new Map;cache=new Map;enableSSL=!1;sslPort=443;enableGzip=!0;enableCache=!0;maxWorkers=4;requestCount=0;cacheHits=0;cacheMisses=0;rateLimitBlocks=0;initialize(e){if(this.locations=[],this.upstreams.clear(),this.rateLimitZones.clear(),this.sslCertificates.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.ipHashMap.clear(),this.hashRing.clear(),this.rateLimitCounters.clear(),this.cache.clear(),e.locations&&(this.locations=[...e.locations].sort((t,n)=>n.path.length!==t.path.length?n.path.length-t.path.length:t.path.localeCompare(n.path))),e.upstreams){for(const t of e.upstreams)if(this.upstreams.set(t.name,{...t}),this.roundRobinCounters.set(t.name,0),t.method==="hash"&&t.servers){const n=[...t.servers].filter(s=>!s.down&&s.health!=="unhealthy").sort((s,a)=>s.address.localeCompare(a.address));this.hashRing.set(t.name,n.map(s=>s.address))}}if(e.rateLimitZones)for(const t of e.rateLimitZones)this.rateLimitZones.set(t.name,{...t});if(e.sslCertificates)for(const t of e.sslCertificates)this.sslCertificates.set(t.name,{...t});this.enableSSL=e.enableSSL??!1,this.sslPort=e.sslPort||443,this.enableGzip=e.enableGzip??!0,this.enableCache=e.enableCache??!0,this.maxWorkers=e.maxWorkers||4}routeRequest(e){const t=Date.now();if(this.requestCount++,!this.enableSSL&&e.protocol==="https")return{match:null,response:{status:400,error:"HTTPS not enabled",latency:Date.now()-t}};const n=this.matchLocation(e);if(!n)return{match:null,response:{status:404,error:"No location matched",latency:Date.now()-t}};if(n.location.rateLimit){const c=this.checkRateLimit(n.location.rateLimit,e);if(c.blocked)return this.rateLimitBlocks++,{match:n,response:{status:429,error:c.error||"Rate limit exceeded",latency:Date.now()-t}}}if(this.enableCache&&n.location.cache?.enabled&&e.method==="GET"){const c=this.getCacheKey(e,n),l=this.cache.get(c);if(l&&l.expiresAt>Date.now())return this.cacheHits++,{match:n,response:{status:200,body:l.data,latency:Date.now()-t,cacheHit:!0}};this.cacheMisses++}let s,a;switch(n.location.method){case"proxy":case"grpc":if(s=this.selectUpstreamTarget(n.location,e),!s)return{match:n,response:{status:503,error:"No healthy upstream server available",latency:Date.now()-t}};a=this.proxyRequest(e,n,s);break;case"static":a=this.serveStatic(e,n);break;case"fastcgi":case"uwsgi":case"scgi":if(s=this.selectUpstreamTarget(n.location,e),!s)return{match:n,response:{status:503,error:"No upstream server available",latency:Date.now()-t}};a=this.processFastCGI(e,n,s);break;default:a={status:501,error:"Method not implemented",latency:Date.now()-t}}if(this.enableGzip&&this.shouldCompress(a)&&(a.headers={...a.headers,"Content-Encoding":"gzip"}),this.enableCache&&n.location.cache?.enabled&&e.method==="GET"&&a.status===200){const c=this.getCacheKey(e,n),l=this.parseCacheValid(n.location.cache.valid||"1h");this.cache.set(c,{data:a.body,expiresAt:Date.now()+l})}return a.latency=Date.now()-t,a.upstreamTarget=s,{match:n,response:a,upstreamTarget:s}}matchLocation(e){for(const t of this.locations){const n=this.matchPath(t.path,e.path);if(n)return{location:t,matchedPath:n.matched,remainingPath:n.remaining,priority:this.getLocationPriority(t.path)}}return null}matchPath(e,t){const n=e.replace(/^[=~*^]/,""),s=e[0];switch(s){case"=":if(t===n)return{matched:t,remaining:""};break;case"~":case"~*":try{if(new RegExp(n,s==="~*"?"i":"").test(t))return{matched:t,remaining:""}}catch{}break;case"^~":case"*":default:if(t.startsWith(n))return{matched:n,remaining:t.substring(n.length)}}return null}getLocationPriority(e){return e.startsWith("=")?4:e.startsWith("^~")?3:e.startsWith("~")||e.startsWith("~*")?2:1}selectUpstreamTarget(e,t){const n=e.upstream||this.extractUpstreamFromProxyPass(e.proxyPass);if(!n)return e.proxyPass||null;const s=this.upstreams.get(n);if(!s||!s.servers||s.servers.length===0)return null;const a=s.servers.filter(l=>!l.down&&l.health!=="unhealthy");if(a.length===0)return null;switch(s.method||"round-robin"){case"round-robin":return this.selectRoundRobin(n,a);case"least_conn":return this.selectLeastConnections(a);case"ip_hash":return this.selectIPHash(n,a,t);case"hash":return this.selectHash(n,a,t);default:return a[0].address}}selectRoundRobin(e,t){const n=t.reduce((c,l)=>c+(l.weight||1),0);let s=this.roundRobinCounters.get(e)||0,a=0;for(const c of t)if(a+=c.weight||1,s<a)return this.roundRobinCounters.set(e,(s+1)%n),c.address;return this.roundRobinCounters.set(e,(s+1)%n),t[0].address}selectLeastConnections(e){let t=1/0,n=e[0].address;for(const a of e){const l=(this.connectionCounts.get(a.address)||0)/(a.weight||1);l<t&&(t=l,n=a.address)}const s=this.connectionCounts.get(n)||0;return this.connectionCounts.set(n,s+1),n}selectIPHash(e,t,n){const s=n.clientIP||n.headers?.["X-Real-IP"]||n.headers?.["X-Forwarded-For"]||"0.0.0.0",a=this.ipHashMap.get(s);if(a&&t.some(f=>f.address===a))return a;const l=this.simpleHash(s)%t.length,d=t[l].address;return this.ipHashMap.set(s,d),d}selectHash(e,t,n){const s=this.hashRing.get(e);if(!s||s.length===0)return t[0].address;const a=n.path,l=this.simpleHash(a)%s.length;return s[l]}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t=t&t}return Math.abs(t)}extractUpstreamFromProxyPass(e){if(!e)return null;const t=e.match(/^https?:\/\/([^\/:]+)/);return t&&this.upstreams.has(t[1])?t[1]:null}checkRateLimit(e,t){const n=this.rateLimitZones.get(e.zone);if(!n)return{blocked:!1};const s=n.rate.match(/^(\d+)r\/([smhd])$/);if(!s)return{blocked:!1};const a=parseInt(s[1],10),c=s[2],l=this.getPeriodMs(c),d=t.clientIP||t.headers?.["X-Real-IP"]||"default";let f=this.rateLimitCounters.get(e.zone);f||(f=new Map,this.rateLimitCounters.set(e.zone,f));let p=f.get(d);const m=Date.now();(!p||p.resetAt<m)&&(p={count:0,resetAt:m+l,burst:e.burst||0},f.set(d,p));const y=e.burst||0,b=a+y;return p.count>=b?{blocked:!0,error:`Rate limit exceeded: ${a} requests per ${c}`}:(p.count++,{blocked:!1})}getPeriodMs(e){switch(e){case"s":return 1e3;case"m":return 6e4;case"h":return 36e5;case"d":return 864e5;default:return 1e3}}proxyRequest(e,t,n){const s=10+Math.random()*90;return{status:200,body:{proxied:!0,upstream:n},latency:s}}serveStatic(e,t){const n=1+Math.random()*4;return{status:200,body:{static:!0,path:t.matchedPath},latency:n}}processFastCGI(e,t,n){const s=20+Math.random()*180;return{status:200,body:{processed:!0,upstream:n},latency:s}}getCacheKey(e,t){return t.location.cache?.key?t.location.cache.key.replace(/\$(\w+)/g,(n,s)=>{switch(s){case"uri":return e.path;case"args":return JSON.stringify(e.query);default:return""}}):`${e.method}:${e.path}:${JSON.stringify(e.query)}`}parseCacheValid(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 36e5;const n=parseInt(t[1],10),s=t[2];return n*this.getPeriodMs(s)}shouldCompress(e){if(!e.body)return!1;const t=e.headers?.["Content-Type"]||"";return["text/","application/json","application/javascript","application/xml"].some(s=>t.includes(s))}getStats(){const e=this.cacheHits+this.cacheMisses,t=e>0?this.cacheHits/e:0;return{locations:this.locations.length,upstreams:this.upstreams.size,rateLimitZones:this.rateLimitZones.size,sslCertificates:this.sslCertificates.size,requests:this.requestCount,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses,rateLimitBlocks:this.rateLimitBlocks,cacheHitRate:t}}updateServerHealth(e,t,n){const s=this.upstreams.get(e);if(!s)return;const a=s.servers.find(c=>c.address===t);a&&(a.health=n)}clearCache(){this.cache.clear(),this.cacheHits=0,this.cacheMisses=0}}class _k{parseQuery(e){const t=e.query.trim(),n=this.extractOperationType(t),s=e.operationName||this.extractOperationName(t),a=this.extractFields(t),c=this.calculateDepth(t),l=this.estimateComplexity(t,s);return{operationName:s,operationType:n,fields:a,depth:c,complexity:l,rawQuery:t}}extractOperationType(e){const t=e.trim();return t.startsWith("mutation")?"mutation":t.startsWith("subscription")?"subscription":"query"}extractOperationName(e){const t=e.match(/(?:query|mutation|subscription)\s+([a-zA-Z0-9_]+)/);return t?t[1]:void 0}extractFields(e){const t=[],n=/([a-zA-Z0-9_]+)\s*(?:\(|\{)/g;let s;for(;(s=n.exec(e))!==null;)t.push(s[1]);return t.length>0?t:["unknown"]}calculateDepth(e){let t=0,n=0;for(const s of e)s==="{"?(t+=1,n=Math.max(n,t)):s==="}"&&(t=Math.max(0,t-1));return n}estimateComplexity(e,t){const n=e.match(/[a-zA-Z0-9_]+(\s*[({])/g),s=n?n.length:5,a=this.calculateDepth(e),c=t?Math.max(1,t.length%5):1;return Math.round(s*(1+a*.5)*c*10)}}class Nk{federationConfig;constructor(e){this.federationConfig=e}planQuery(e,t){if(t.length===0)return{subqueries:[],requiresFederation:!1,estimatedLatency:0};const n=this.federationConfig?.enabled??!1,a=this.selectServices(e,t).map(d=>({serviceId:d.id,serviceName:d.name,endpoint:d.endpoint,query:e.rawQuery,fields:e.fields,estimatedLatency:this.estimateServiceLatency(d,e)})),c=a.reduce((d,f)=>d+f.estimatedLatency,0),l=n?3+Math.random()*5:0;return{subqueries:a,requiresFederation:n,estimatedLatency:c+l}}selectServices(e,t){if(this.federationConfig?.enabled&&this.federationConfig.services?.length){const a=t.filter(c=>this.federationConfig.services.includes(c.name));return a.length>0?a:t.slice(0,Math.min(2,t.length))}const n=this.hashString(e.operationName||e.rawQuery),s=Math.abs(n)%t.length;return[t[s]]}estimateServiceLatency(e,t){const n=e.avgLatencyMs,s=Math.sqrt(t.complexity)*.8,a=t.depth*1.5,c=Math.random()*5;return n+s+a+c}hashString(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t}updateFederationConfig(e){this.federationConfig=e}}class jk{serviceRegistry;constructor(e){this.serviceRegistry=e}executePlan(e){if(e.subqueries.length===0)return{success:!1,totalLatency:0,error:"No services available",executedEndpoints:[]};let t=0;const n=[];for(const s of e.subqueries){const a=this.serviceRegistry.getService(s.serviceId);if(!a)return{success:!1,totalLatency:t,error:`Service ${s.serviceId} not found`,failedService:s.serviceId,executedEndpoints:n};const c=s.endpoint||a.endpoint;n.push(c);const d=this.getEndpointLatency(c,a.avgLatencyMs)+(s.estimatedLatency-a.avgLatencyMs);if(t+=d,Math.random()<a.errorRate)return this.serviceRegistry.recordRequest(a.id,d,!1),{success:!1,totalLatency:t,error:`Upstream error at ${a.name} (${c})`,failedService:a.id,executedEndpoints:n};this.serviceRegistry.recordRequest(a.id,d,!0)}return{success:!0,totalLatency:t,executedEndpoints:n}}getEndpointLatency(e,t){return e.includes("localhost")||e.includes("127.0.0.1")?t*.8:e.includes("https://")?t*1.1:t}}class Pk{services=new Map;registerService(e){const t=this.services.get(e.id);this.services.set(e.id,{id:e.id,name:e.name,endpoint:e.endpoint,avgLatencyMs:e.avgLatencyMs??20,errorRate:e.errorRate??.01,status:e.status??"connected",rollingLatency:t?.rollingLatency||[],rollingErrors:t?.rollingErrors||[]})}unregisterService(e){this.services.delete(e)}getConnectedServices(){return Array.from(this.services.values()).filter(e=>e.status==="connected")}getService(e){return this.services.get(e)}getServiceByName(e){return Array.from(this.services.values()).find(t=>t.name===e)}recordRequest(e,t,n){const s=this.services.get(e);if(!s)return;s.rollingLatency.push(t),s.rollingLatency.length>50&&s.rollingLatency.shift(),n||(s.rollingErrors.push(t),s.rollingErrors.length>50&&s.rollingErrors.shift());const a=s.rollingLatency.reduce((l,d)=>l+d,0)/s.rollingLatency.length;s.avgLatencyMs=a;const c=s.rollingErrors.length/Math.max(s.rollingLatency.length,1);s.errorRate=c}initialize(e){this.services.clear();for(const t of e)this.registerService(t)}getAllServices(){return Array.from(this.services.values())}}class zk{cache=new Map;ttl;persistQueries;constructor(e=0,t=!1){this.ttl=e,this.persistQueries=t}generateCacheKey(e,t){const n=t?JSON.stringify(t):"";return this.hashString(e+n)}getCached(e,t){if(this.ttl<=0||!this.persistQueries)return{hit:!1,latencyReduction:0};const n=this.generateCacheKey(e,t),s=this.cache.get(n);return s?Date.now()-s.timestamp>s.ttl*1e3?(this.cache.delete(n),{hit:!1,latencyReduction:0}):{hit:!0,latencyReduction:.7}:{hit:!1,latencyReduction:0}}setCached(e,t,n){if(this.ttl<=0||!this.persistQueries)return;const s=this.generateCacheKey(e,n);if(this.cache.set(s,{query:e,response:t,timestamp:Date.now(),ttl:this.ttl}),this.cache.size>1e3){const a=this.cache.keys().next().value;this.cache.delete(a)}}getCacheHitProbability(e){if(this.ttl<=0||!this.persistQueries)return 0;const t=.2,n=Math.min(e.complexity/2e3,.4);return Math.min(t+n,.6)}updateConfig(e,t){e!==void 0&&(this.ttl=e),t!==void 0&&(this.persistQueries=t)}clearCache(){this.cache.clear()}hashString(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return Math.abs(t).toString(16)}}class Lk{enabled;limits=new Map;defaultLimit=100;windowMs=6e4;constructor(e=!1,t=100){this.enabled=e,this.defaultLimit=t}checkLimit(e,t){if(!this.enabled)return{allowed:!0,remaining:1/0,resetAt:Date.now()+this.windowMs};const n=t||this.defaultLimit,s=Date.now(),a=this.limits.get(e);if(!a||s>=a.resetAt){const c={count:1,resetAt:s+this.windowMs,windowStart:s};return this.limits.set(e,c),{allowed:!0,remaining:n-1,resetAt:c.resetAt}}return a.count>=n?{allowed:!1,remaining:0,resetAt:a.resetAt}:(a.count+=1,{allowed:!0,remaining:n-a.count,resetAt:a.resetAt})}getIdentifier(e){if(!e)return"default";const t=e["x-api-key"]||e.apikey;if(t)return`key:${t}`;const n=e["x-client-id"];return n?`client:${n}`:"default"}setEnabled(e){this.enabled=e}updateDefaultLimit(e){this.defaultLimit=e}clearLimits(){this.limits.clear()}}class Ik{maxQueryDepth;maxQueryComplexity;enabled;constructor(e=15,t=1e3,n=!0){this.maxQueryDepth=e,this.maxQueryComplexity=t,this.enabled=n}validateQuery(e){return this.enabled?e.depth>this.maxQueryDepth?{valid:!1,error:`Query depth ${e.depth} exceeds limit ${this.maxQueryDepth}`}:e.complexity>this.maxQueryComplexity?{valid:!1,error:`Query complexity ${e.complexity} exceeds limit ${this.maxQueryComplexity}`}:{valid:!0}:{valid:!0}}updateLimits(e,t){e!==void 0&&(this.maxQueryDepth=e),t!==void 0&&(this.maxQueryComplexity=t)}setEnabled(e){this.enabled=e}}class Ok{config;constructor(e){this.config=e}isEnabled(){return this.config?.enabled??!1}getVersion(){return this.config?.version}getFederatedServices(){return this.config?.services||[]}getPlanningOverhead(){return this.isEnabled()?(this.config?.version==="2"?2:4)+Math.random()*3:0}isFederatedService(e){return this.isEnabled()?this.config?.services?.includes(e.name)??!1:!1}getSupergraphSchema(){return this.config?.supergraph}updateConfig(e){this.config=e}}class Hk{queryParser;queryPlanner;queryExecutor;serviceRegistry;cacheManager;rateLimiter;complexityAnalyzer;federationComposer;constructor(){this.serviceRegistry=new Pk,this.queryParser=new _k,this.queryPlanner=new Nk,this.queryExecutor=new jk(this.serviceRegistry),this.cacheManager=new zk,this.rateLimiter=new Lk,this.complexityAnalyzer=new Ik,this.federationComposer=new Ok}initialize(e){e.services&&this.serviceRegistry.initialize(e.services),this.federationComposer.updateConfig(e.federation),this.queryPlanner.updateFederationConfig(e.federation),this.cacheManager.updateConfig(e.cacheTtl??0,e.persistQueries??!1),this.rateLimiter.setEnabled(e.enableRateLimiting??!1),this.complexityAnalyzer.updateLimits(e.maxQueryDepth??15,e.maxQueryComplexity??1e3),this.complexityAnalyzer.setEnabled(e.enableQueryComplexityAnalysis??!0)}routeRequest(e){const t=Date.now();if(!e.query||e.query.trim().length===0)return{status:400,latency:Date.now()-t,error:"Empty query"};const n=this.rateLimiter.getIdentifier(e.headers);if(!this.rateLimiter.checkLimit(n).allowed)return{status:429,latency:Date.now()-t,error:"Rate limit exceeded"};const a=this.queryParser.parseQuery(e),c=this.cacheManager.getCached(e.query,e.variables);if(c.hit)return{status:200,latency:(Date.now()-t)*(1-c.latencyReduction)};const l=this.complexityAnalyzer.validateQuery(a);if(!l.valid)return{status:413,latency:Date.now()-t,error:l.error};const d=this.serviceRegistry.getConnectedServices();if(d.length===0)return{status:503,latency:Date.now()-t,error:"No connected services"};const f=this.queryPlanner.planQuery(a,d),p=this.queryExecutor.executePlan(f);return p.success?(this.cacheManager.setCached(e.query,{success:!0},e.variables),{status:200,latency:p.totalLatency+(Date.now()-t)}):{status:502,latency:p.totalLatency+(Date.now()-t),error:p.error}}getServiceRegistry(){return this.serviceRegistry}getCacheManager(){return this.cacheManager}getRateLimiter(){return this.rateLimiter}}class qk{backends=new Map;endpoints=new Map;config={};circuitBreakers=new Map;cache=new Map;cacheMode="memory";defaultCacheTtl=5;redisEngine=null;redisNodeId="";backendMetrics=new Map;batchQueue=new Map;batchTimer=null;batchSize=10;batchTimeout=50;initialize(e){if(this.config=e,this.backends.clear(),this.endpoints.clear(),this.circuitBreakers.clear(),this.cache.clear(),this.backendMetrics.clear(),this.cacheMode=e.cacheMode||"memory",this.defaultCacheTtl=e.cacheTtl||5,this.redisEngine=e.redisEngine||null,this.redisNodeId=e.redisNodeId||"",e.backends)for(const t of e.backends)this.backends.set(t.id,{...t}),this.initializeCircuitBreaker(t.id,t.circuitBreaker),this.initializeBackendMetrics(t.id);if(e.endpoints)for(const t of e.endpoints)this.endpoints.set(t.id,{...t})}initializeCircuitBreaker(e,t){t?.enabled&&this.circuitBreakers.set(e,{failures:0,successes:0,state:"closed",lastFailureTime:0,nextAttemptTime:0})}initializeBackendMetrics(e){this.backendMetrics.set(e,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,cacheHits:0,cacheMisses:0})}routeRequest(e){const t=Date.now(),n=this.matchEndpoint(e);if(!n)return{status:404,error:"Endpoint not found",latency:Date.now()-t,backendResponses:[],cacheHit:!1};if(this.config.enableCaching&&this.cacheMode!=="off"){const c=this.getCacheKey(n,e),l=this.getCached(c);if(l){const d=this.backendMetrics.get(n.backends[0])||this.initializeBackendMetrics(n.backends[0]);return d&&d.cacheHits++,{status:200,data:l.data,latency:Date.now()-t,backendResponses:[],cacheHit:!0}}}const s=this.aggregateBackends(n,e),a=this.aggregateResponses(n,s);if(this.config.enableCaching&&this.cacheMode!=="off"&&a.status===200){const c=this.getCacheKey(n,e),l=n.cacheTtl||this.defaultCacheTtl;this.setCached(c,a.data,l)}for(const c of s){const l=this.backendMetrics.get(c.backendId);l&&(l.requestCount++,c.status>=400&&l.errorCount++,l.totalLatency+=c.latency,l.averageLatency=l.totalLatency/l.requestCount,l.lastRequestTime=Date.now(),c.cached||l.cacheMisses++)}return{...a,latency:Date.now()-t,backendResponses:s,cacheHit:!1}}matchEndpoint(e){for(const t of this.endpoints.values())if(t.path===e.path&&t.method===e.method)return t;return null}aggregateBackends(e,t){const n=e.backends;switch(e.aggregator){case"parallel":return this.executeBackendsParallel(n,t,e);case"sequential":return this.executeBackendsSequential(n,t,e);case"merge":default:return this.executeBackendsParallel(n,t,e)}}executeBackendsParallel(e,t,n){const s=[];for(const a of e){const c=this.executeBackend(a,t,n);s.push(c)}return s}executeBackendsSequential(e,t,n){const s=[];let a={};for(const c of e){const l={...t,body:{...typeof t.body=="object"?t.body:{},...a}},d=this.executeBackend(c,l,n);if(s.push(d),d.status>=200&&d.status<300&&d.data)typeof d.data=="object"&&(a={...a,...d.data});else break}return s}executeBackend(e,t,n){const s=this.backends.get(e);if(!s)return{backendId:e,status:503,error:"Backend not found",latency:0,cached:!1};const a=this.circuitBreakers.get(e);if(a){const p=Date.now();if(a.state==="open"){if(p<a.nextAttemptTime)return{backendId:e,status:503,error:"Circuit breaker is open",latency:0,cached:!1};a.state="half-open"}}if(this.config.enableCaching&&this.cacheMode!=="off"){const p=`${e}:${n.path}:${JSON.stringify(t.query||{})}`,m=this.getCached(p);if(m)return{backendId:e,status:200,data:m.data,latency:1,cached:!0}}n.timeout||s.timeout||this.config.defaultTimeout;const c=s.retries||0,l=s.retryBackoff||"exponential";let d,f=0;for(let p=0;p<=c;p++){if(p>0){const E=this.calculateBackoff(p,l);f+=E}const m=50+Math.random()*150,y=(Math.random()-.5)*20,b=m+y;f+=b;const S=s.status==="connected"?.95:.5;if(Math.random()<S){a&&(a.state==="half-open"?(a.successes++,a.successes>=(s.circuitBreaker?.successThreshold||2)&&(a.state="closed",a.failures=0,a.successes=0)):a.failures=Math.max(0,a.failures-1));const E=this.generateMockResponse(s,t);return{backendId:e,status:200,data:E,latency:f,cached:!1}}else d=`Backend error (attempt ${p+1}/${c+1})`,a&&(a.failures++,a.lastFailureTime=Date.now(),a.failures>=(s.circuitBreaker?.failureThreshold||5)&&(a.state="open",a.nextAttemptTime=Date.now()+(s.circuitBreaker?.timeout||6e4)))}return{backendId:e,status:503,error:d||"Backend request failed",latency:f,cached:!1}}calculateBackoff(e,t){switch(t){case"exponential":return Math.min(1e3*Math.pow(2,e-1),1e4);case"linear":return 100*e;case"constant":default:return 100}}generateMockResponse(e,t){const n=e.name.toLowerCase();return n.includes("user")||n.includes("profile")?{id:Math.floor(Math.random()*1e3),name:"John Doe",email:"john.doe@example.com",avatar:"https://example.com/avatar.jpg"}:n.includes("order")||n.includes("cart")?{id:Math.floor(Math.random()*1e3),items:[{id:1,name:"Product 1",price:29.99,quantity:2},{id:2,name:"Product 2",price:49.99,quantity:1}],total:109.97}:n.includes("product")||n.includes("catalog")?{products:[{id:1,name:"Product 1",price:29.99,inStock:!0},{id:2,name:"Product 2",price:49.99,inStock:!0}],total:2}:{data:"Mock response",timestamp:Date.now()}}aggregateResponses(e,t){if(t.length===0)return{status:503,error:"No backends configured for endpoint"};if(t.every(a=>a.status>=400))return{status:503,error:"All backends failed"};const s=t.some(a=>a.status>=400);if(e.aggregator==="merge"||e.aggregator==="parallel"){const a={};for(const c of t)if(c.status>=200&&c.status<300&&c.data){const d=this.backends.get(c.backendId)?.name||c.backendId;typeof c.data=="object"&&c.data,a[d]=c.data}return{status:s?207:200,data:a}}else{const a=t[t.length-1];return a.status>=200&&a.status<300?{status:200,data:a.data}:{status:a.status,error:a.error}}}getCacheKey(e,t){return e.cacheKey?e.cacheKey:`${e.path}:${e.method}:${JSON.stringify(t.query||{})}`}getCached(e){if(this.cacheMode==="off")return null;if(this.cacheMode==="redis"&&this.redisEngine){const n=this.getRedisCacheKey(e),s=this.redisEngine.executeCommand("GET",[n]);if(s.success&&s.value!==null)try{const a=typeof s.value=="string"?JSON.parse(s.value):s.value;return{key:e,data:a,expiresAt:Date.now()+this.defaultCacheTtl*1e3,hitCount:1}}catch{return null}return null}const t=this.cache.get(e);return t?Date.now()>t.expiresAt?(this.cache.delete(e),null):(t.hitCount++,t):null}setCached(e,t,n){if(this.cacheMode!=="off"){if(this.cacheMode==="redis"&&this.redisEngine){const s=this.getRedisCacheKey(e),a=typeof t=="string"?t:JSON.stringify(t),c=[s,a];n>0&&c.push("EX",String(n)),this.redisEngine.executeCommand("SET",c);return}this.cache.set(e,{key:e,data:t,expiresAt:Date.now()+n*1e3,hitCount:0}),this.cache.size>1e3&&this.cleanupCache()}}getRedisCacheKey(e){return`${this.redisNodeId?`bff:${this.redisNodeId}:`:"bff:"}${e}`}cleanupCache(){const e=Date.now();for(const[t,n]of this.cache.entries())e>n.expiresAt&&this.cache.delete(t)}getStats(){let e=0,t=0,n=0,s=0,a=0;const c={};for(const[l,d]of this.backendMetrics.entries())e+=d.requestCount,t+=d.errorCount,n+=d.totalLatency,s+=d.cacheHits,a+=d.cacheMisses,c[l]={...d};return{totalRequests:e,totalErrors:t,averageLatency:e>0?n/e:0,cacheHitRate:s+a>0?s/(s+a):0,backendStats:c}}getBackendMetrics(e){return this.backendMetrics.get(e)}getBackends(){return Array.from(this.backends.values())}getEndpoints(){return Array.from(this.endpoints.values())}updateBackendStatus(e,t){const n=this.backends.get(e);n&&(n.status=t)}}class Uk{relays=new Map;config={};deliveries=new Map;pendingDeliveries=new Map;relayMetrics=new Map;initialize(e){if(this.config=e,this.relays.clear(),this.deliveries.clear(),this.pendingDeliveries.clear(),this.relayMetrics.clear(),e.relays)for(const t of e.relays)t.enabled&&(this.relays.set(t.id,{...t}),this.initializeRelayMetrics(t.id))}initializeRelayMetrics(e){this.relayMetrics.set(e,{totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0})}relayWebhook(e){const t=Date.now(),n=this.findMatchingRelay(e);if(!n)return{success:!1,status:404,latency:Date.now()-t,attempts:0,error:"No matching relay found"};if(n.allowedIps&&n.allowedIps.length>0&&e.ip&&!this.isIpAllowed(e.ip,n.allowedIps))return this.updateRelayMetrics(n.id,!1,Date.now()-t),{success:!1,status:403,latency:Date.now()-t,attempts:0,error:"IP address not allowed",relayId:n.id};if(this.config.enableSignatureVerification&&n.signatureSecret&&!this.verifySignature(e,n.signatureSecret,n.signatureHeader||"X-Signature"))return this.updateRelayMetrics(n.id,!1,Date.now()-t),{success:!1,status:401,latency:Date.now()-t,attempts:0,error:"Invalid signature",relayId:n.id};let s=e.body;n.transformTemplate&&(s=this.transformPayload(e.body,n.transformTemplate));const a=this.deliverWebhook(n,{...e,body:s});return this.updateRelayMetrics(n.id,a.success,a.latency),{...a,relayId:n.id}}findMatchingRelay(e){for(const t of this.relays.values())if(e.url.startsWith(t.sourceUrl)||t.sourceUrl==="*"||e.url.includes(t.sourceUrl)){if(t.events&&t.events.length>0){const n=e.event||e.headers["x-event"]||e.headers["x-github-event"]||"";if(!t.events.includes(n)&&n!=="")continue}return t}return null}isIpAllowed(e,t){for(const n of t)if(this.matchesCidr(e,n))return!0;return!1}matchesCidr(e,t){if(t==="*"||t===e)return!0;if(t.includes("/")){const[n,s]=t.split("/"),a=parseInt(s,10),c=n.split("."),l=e.split(".");if(c.length!==4||l.length!==4)return!1;const d=Math.floor(a/8);for(let f=0;f<d;f++)if(c[f]!==l[f])return!1;return!0}return e===t}verifySignature(e,t,n){const s=e.headers[n.toLowerCase()]||e.headers[n]||e.headers["x-signature"]||e.headers["x-hub-signature-256"];return s?(typeof e.body=="string"?e.body:JSON.stringify(e.body),s.length>0&&t.length>0):!1}transformPayload(e,t){try{let n=t;if(n.includes("{{raw}}")){const s=typeof e=="string"?e:JSON.stringify(e);n=n.replace(/\{\{raw\}\}/g,s)}if(n.includes("{{json}}")){const s=typeof e=="string"?JSON.parse(e):e;n=n.replace(/\{\{json\}\}/g,JSON.stringify(s))}try{return JSON.parse(n)}catch{return n}}catch{return e}}deliverWebhook(e,t){const n=e.maxRetryAttempts||this.config.maxRetryAttempts||3,s=e.retryDelay||this.config.retryDelay||5,a=e.timeout||this.config.timeout||30,c=this.config.enableRetryOnFailure!==!1,l=e.retryBackoff||"exponential";let d=0,f,p;const m=Date.now();for(;d<n;){d++;const S=this.simulateHttpRequest(e.targetUrl,t,a);if(S.success){const M=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,E={id:M,relayId:e.id,event:t.event||"unknown",payload:typeof t.body=="string"?t.body:JSON.stringify(t.body),status:"success",timestamp:new Date().toISOString(),attempts:d,responseCode:S.statusCode};return this.deliveries.set(M,E),{success:!0,status:S.statusCode||200,latency:Date.now()-m,deliveryId:M,attempts:d}}if(f=S.error,p=S.statusCode,!c||d>=n)break;this.calculateRetryDelay(d,s,l)}const y=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,b={id:y,relayId:e.id,event:t.event||"unknown",payload:typeof t.body=="string"?t.body:JSON.stringify(t.body),status:"failed",timestamp:new Date().toISOString(),attempts:d,responseCode:p,error:f};return this.deliveries.set(y,b),{success:!1,status:p||500,latency:Date.now()-m,deliveryId:y,attempts:d,error:f||"Delivery failed after all retry attempts"}}simulateHttpRequest(e,t,n){const s=10+Math.random()*40,a=5+Math.random()*95,c=Math.random()<.05;if(Math.random()<.02)return{success:!1,statusCode:504,error:"Request timeout",latency:n*1e3};if(c){const d=[500,502,503,429],f=d[Math.floor(Math.random()*d.length)];return{success:!1,statusCode:f,error:`HTTP ${f} error`,latency:s+a}}return{success:!0,statusCode:200,latency:s+a}}calculateRetryDelay(e,t,n){switch(n){case"exponential":return t*Math.pow(2,e-1);case"linear":return t*e;case"constant":default:return t}}updateRelayMetrics(e,t,n){let s=this.relayMetrics.get(e);s||(s={totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0},this.relayMetrics.set(e,s)),s.totalRequests++,s.totalLatency+=n,s.averageLatency=s.totalLatency/s.totalRequests,s.lastRequestTime=Date.now(),t?s.successfulDeliveries++:s.failedDeliveries++}getDeliveries(e){const t=Array.from(this.deliveries.values());return e?t.filter(n=>n.relayId===e):t}getRelayMetrics(e){return this.relayMetrics.get(e)}getAllRelayMetrics(){return new Map(this.relayMetrics)}getRelay(e){return this.relays.get(e)}getAllRelays(){return Array.from(this.relays.values())}}class $k{keys=new Map;config={};maxMemoryBytes=256*1024*1024;currentMemoryUsage=0;metrics={totalKeys:0,keysByType:{string:0,hash:0,list:0,set:0,zset:0,stream:0},memoryUsage:0,memoryUsagePercent:0,operationsPerSecond:0,hitCount:0,missCount:0,hitRate:0,expiredKeys:0,evictedKeys:0,connectedClients:0};operationCount=0;lastMetricsUpdate=Date.now();operationHistory=[];clusterSlots=new Map;clusterNodes=[];initialize(e){if(this.config={...e},this.keys.clear(),this.currentMemoryUsage=0,this.operationCount=0,this.lastMetricsUpdate=Date.now(),this.operationHistory=[],e.maxMemory&&(this.maxMemoryBytes=this.parseMemorySize(e.maxMemory)),e.enableCluster&&e.clusterNodes&&(this.clusterNodes=[...e.clusterNodes],this.initializeClusterSlots()),e.keys)for(const t of e.keys)this.setKey(t.key,t.type,t.value,t.ttl);this.updateMetrics()}parseMemorySize(e){const t=e.match(/^(\d+)([kmg]?b?)$/i);if(!t)return 256*1024*1024;const n=parseInt(t[1]);switch(t[2].toLowerCase()){case"kb":return n*1024;case"mb":return n*1024*1024;case"gb":return n*1024*1024*1024;default:return n}}initializeClusterSlots(){if(this.clusterNodes.length===0)return;const e=Math.floor(16384/this.clusterNodes.length);let t=0;for(let n=0;n<this.clusterNodes.length;n++){const s=n===this.clusterNodes.length-1?16383:t+e-1;for(let a=t;a<=s;a++)this.clusterSlots.set(a,this.clusterNodes[n]);t=s+1}}getClusterSlot(e){const t=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935];let n=0;for(let s=0;s<e.length;s++){const a=e.charCodeAt(s);n=(n<<8^t[(n>>8^a)&255])&65535}return n%16384}isKeyForThisNode(e){if(!this.config.enableCluster||this.clusterNodes.length===0)return!0;const t=this.getClusterSlot(e);return this.clusterSlots.get(t),!0}executeCommand(e,t){const n=Date.now(),s=e.toUpperCase();try{let a;switch(s){case"GET":a=this.get(t[0]);break;case"SET":a=this.set(t[0],t[1],t[2]?parseInt(t[2]):void 0);break;case"DEL":a=this.del(t);break;case"EXISTS":a=this.exists(t);break;case"EXPIRE":a=this.expire(t[0],parseInt(t[1]));break;case"TTL":a=this.ttl(t[0]);break;case"KEYS":a=this.keys(t[0]||"*");break;case"HGET":a=this.hget(t[0],t[1]);break;case"HSET":a=this.hset(t[0],t.slice(1));break;case"HGETALL":a=this.hgetall(t[0]);break;case"HDEL":a=this.hdel(t[0],t.slice(1));break;case"HKEYS":a=this.hkeys(t[0]);break;case"HVALS":a=this.hvals(t[0]);break;case"LPUSH":a=this.lpush(t[0],t.slice(1));break;case"RPUSH":a=this.rpush(t[0],t.slice(1));break;case"LPOP":a=this.lpop(t[0]);break;case"RPOP":a=this.rpop(t[0]);break;case"LLEN":a=this.llen(t[0]);break;case"LRANGE":a=this.lrange(t[0],parseInt(t[1]),parseInt(t[2]));break;case"SADD":a=this.sadd(t[0],t.slice(1));break;case"SREM":a=this.srem(t[0],t.slice(1));break;case"SMEMBERS":a=this.smembers(t[0]);break;case"SISMEMBER":a=this.sismember(t[0],t[1]);break;case"SCARD":a=this.scard(t[0]);break;case"ZADD":a=this.zadd(t[0],t.slice(1));break;case"ZREM":a=this.zrem(t[0],t.slice(1));break;case"ZRANGE":a=this.zrange(t[0],parseInt(t[1]),parseInt(t[2]));break;case"ZSCORE":a=this.zscore(t[0],t[1]);break;case"ZCARD":a=this.zcard(t[0]);break;case"PING":a="PONG";break;case"INFO":a=this.info(t[0]);break;case"DBSIZE":a=this.dbsize();break;default:return{success:!1,error:`Unknown command: ${e}`,latency:Date.now()-n}}const c=Date.now()-n;return this.recordOperation(),{success:!0,value:a,latency:c}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error",latency:Date.now()-n}}}recordOperation(){this.operationCount++,this.operationHistory.push({timestamp:Date.now()}),this.operationHistory.length>1e3&&this.operationHistory.shift()}get(e){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");const t=this.keys.get(e);return t?this.isExpired(t)?(this.deleteKey(e),this.metrics.missCount++,null):(this.metrics.hitCount++,typeof t.value=="string"?t.value:JSON.stringify(t.value)):(this.metrics.missCount++,null)}set(e,t,n){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();const s=this.keys.get(e);s&&(this.currentMemoryUsage-=this.calculateKeySize(s));const a={key:e,type:"string",value:t,ttl:n!==void 0?n:s?.ttl,expiresAt:n!==void 0&&n>0?Date.now()+n*1e3:s?.expiresAt,size:this.estimateSize(t)};return this.keys.set(e,a),this.currentMemoryUsage+=this.calculateKeySize(a),"OK"}del(e){let t=0;for(const n of e)this.deleteKey(n)&&t++;return t}exists(e){let t=0;for(const n of e){const s=this.keys.get(n);s&&!this.isExpired(s)&&t++}return t}expire(e,t){const n=this.keys.get(e);return n?this.isExpired(n)?(this.deleteKey(e),0):(n.ttl=t,n.expiresAt=t>0?Date.now()+t*1e3:void 0,1):0}ttl(e){const t=this.keys.get(e);if(!t)return-2;if(this.isExpired(t))return this.deleteKey(e),-2;if(!t.expiresAt)return-1;const n=Math.floor((t.expiresAt-Date.now())/1e3);return n>0?n:-2}keys(e){const t=this.patternToRegex(e),n=[];for(const[s,a]of this.keys.entries()){if(this.isExpired(a)){this.deleteKey(s);continue}t.test(s)&&n.push(s)}return n}hget(e,t){const n=this.keys.get(e);return!n||n.type!=="hash"?null:this.isExpired(n)?(this.deleteKey(e),null):n.value[t]||null}hset(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="hash")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"hash",value:{},size:0});const s=n.value;let a=0;for(let c=0;c<t.length;c+=2){const l=t[c],d=t[c+1];s[l]||a++,s[l]=d}return n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),a}hgetall(e){const t=this.keys.get(e);return!t||t.type!=="hash"?{}:this.isExpired(t)?(this.deleteKey(e),{}):{...t.value}}hdel(e,t){const n=this.keys.get(e);if(!n||n.type!=="hash")return 0;if(this.isExpired(n))return this.deleteKey(e),0;const s=n.value;let a=0;for(const c of t)s[c]&&(delete s[c],a++);return a>0&&(n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(e,n)),a}hkeys(e){const t=this.keys.get(e);return!t||t.type!=="hash"?[]:this.isExpired(t)?(this.deleteKey(e),[]):Object.keys(t.value)}hvals(e){const t=this.keys.get(e);return!t||t.type!=="hash"?[]:this.isExpired(t)?(this.deleteKey(e),[]):Object.values(t.value)}lpush(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="list")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"list",value:[],size:0});const s=n.value;return s.unshift(...t),n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),s.length}rpush(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="list")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"list",value:[],size:0});const s=n.value;return s.push(...t),n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),s.length}lpop(e){const t=this.keys.get(e);if(!t||t.type!=="list")return null;if(this.isExpired(t))return this.deleteKey(e),null;const n=t.value;if(n.length===0)return null;const s=n.shift();return t.size=this.estimateSize(JSON.stringify(n)),this.keys.set(e,t),s}rpop(e){const t=this.keys.get(e);if(!t||t.type!=="list")return null;if(this.isExpired(t))return this.deleteKey(e),null;const n=t.value;if(n.length===0)return null;const s=n.pop();return t.size=this.estimateSize(JSON.stringify(n)),this.keys.set(e,t),s}llen(e){const t=this.keys.get(e);return!t||t.type!=="list"?0:this.isExpired(t)?(this.deleteKey(e),0):t.value.length}lrange(e,t,n){const s=this.keys.get(e);if(!s||s.type!=="list")return[];if(this.isExpired(s))return this.deleteKey(e),[];const a=s.value,c=a.length,l=t<0?Math.max(0,c+t):Math.min(t,c),d=n<0?Math.max(0,c+n):Math.min(n,c-1);return a.slice(l,d+1)}sadd(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="set")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"set",value:new Set,size:0});const s=n.value;let a=0;for(const c of t)s.has(c)||(s.add(c),a++);return n.size=this.estimateSize(JSON.stringify(Array.from(s))),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),a}srem(e,t){const n=this.keys.get(e);if(!n||n.type!=="set")return 0;if(this.isExpired(n))return this.deleteKey(e),0;const s=n.value;let a=0;for(const c of t)s.has(c)&&(s.delete(c),a++);return a>0&&(n.size=this.estimateSize(JSON.stringify(Array.from(s))),this.keys.set(e,n)),a}smembers(e){const t=this.keys.get(e);return!t||t.type!=="set"?[]:this.isExpired(t)?(this.deleteKey(e),[]):Array.from(t.value)}sismember(e,t){const n=this.keys.get(e);return!n||n.type!=="set"?0:this.isExpired(n)?(this.deleteKey(e),0):n.value.has(t)?1:0}scard(e){const t=this.keys.get(e);return!t||t.type!=="set"?0:this.isExpired(t)?(this.deleteKey(e),0):t.value.size}zadd(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="zset")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"zset",value:new Map,size:0});const s=n.value;let a=0;for(let c=0;c<t.length;c+=2){const l=parseFloat(t[c]),d=t[c+1];s.has(d)||a++,s.set(d,l)}return n.size=this.estimateSize(JSON.stringify(Array.from(s.entries()))),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),a}zrem(e,t){const n=this.keys.get(e);if(!n||n.type!=="zset")return 0;if(this.isExpired(n))return this.deleteKey(e),0;const s=n.value;let a=0;for(const c of t)s.has(c)&&(s.delete(c),a++);return a>0&&(n.size=this.estimateSize(JSON.stringify(Array.from(s.entries()))),this.keys.set(e,n)),a}zrange(e,t,n){const s=this.keys.get(e);if(!s||s.type!=="zset")return[];if(this.isExpired(s))return this.deleteKey(e),[];const a=s.value,c=Array.from(a.entries()).sort((p,m)=>p[1]-m[1]),l=c.length,d=t<0?Math.max(0,l+t):Math.min(t,l),f=n<0?Math.max(0,l+n):Math.min(n,l-1);return c.slice(d,f+1).map(p=>p[0])}zscore(e,t){const n=this.keys.get(e);return!n||n.type!=="zset"?null:this.isExpired(n)?(this.deleteKey(e),null):n.value.get(t)??null}zcard(e){const t=this.keys.get(e);return!t||t.type!=="zset"?0:this.isExpired(t)?(this.deleteKey(e),0):t.value.size}info(e){const t=this.getMetrics();return`# Server
redis_version:7.2.0
redis_mode:${this.config.enableCluster?"cluster":"standalone"}

# Memory
used_memory:${t.memoryUsage}
used_memory_human:${this.formatBytes(t.memoryUsage)}
maxmemory:${this.maxMemoryBytes}
maxmemory_human:${this.formatBytes(this.maxMemoryBytes)}
maxmemory_policy:${this.config.maxMemoryPolicy||"noeviction"}
mem_fragmentation_ratio:1.0

# Stats
total_keys:${t.totalKeys}
expired_keys:${t.expiredKeys}
evicted_keys:${t.evictedKeys}
keyspace_hits:${t.hitCount}
keyspace_misses:${t.missCount}

# Cluster
cluster_enabled:${this.config.enableCluster?1:0}
`}dbsize(){return this.cleanupExpiredKeys(),this.keys.size}setKey(e,t,n,s){const a={key:e,type:t,value:n,ttl:s!==void 0?s:-1,expiresAt:s!==void 0&&s>0?Date.now()+s*1e3:void 0,size:this.estimateSize(typeof n=="string"?n:JSON.stringify(n))};this.keys.set(e,a),this.currentMemoryUsage+=this.calculateKeySize(a)}deleteKey(e){const t=this.keys.get(e);return t?(this.currentMemoryUsage-=this.calculateKeySize(t),this.keys.delete(e),!0):!1}isExpired(e){return e.expiresAt?Date.now()>=e.expiresAt:!1}cleanupExpiredKeys(){let e=0;for(const[t,n]of this.keys.entries())this.isExpired(n)&&(this.deleteKey(t),e++);e>0&&(this.metrics.expiredKeys+=e)}checkMemoryAndEvict(){if(this.currentMemoryUsage<=this.maxMemoryBytes)return;const e=this.config.maxMemoryPolicy||"noeviction";if(e==="noeviction")return;const t=this.selectKeysToEvict(e);let n=0;for(const s of t)if(this.deleteKey(s),n++,this.currentMemoryUsage<=this.maxMemoryBytes*.9)break;n>0&&(this.metrics.evictedKeys+=n)}selectKeysToEvict(e){const t=Array.from(this.keys.keys());switch(e){case"allkeys-lru":case"allkeys-lfu":case"allkeys-random":return t;case"volatile-lru":case"volatile-lfu":case"volatile-ttl":case"volatile-random":return t.filter(n=>{const s=this.keys.get(n);return s&&s.expiresAt!==void 0});default:return[]}}calculateKeySize(e){if(e.size)return e.size;let t=0;return typeof e.value=="string"?t=Buffer.byteLength(e.value,"utf8"):t=Buffer.byteLength(JSON.stringify(e.value),"utf8"),Buffer.byteLength(e.key,"utf8")+t+100}estimateSize(e){return Buffer.byteLength(e,"utf8")}patternToRegex(e){const t=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${t}$`)}formatBytes(e){if(e===0)return"0B";const t=1024,n=["B","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,s)*100)/100+n[s]}getMetrics(){return this.cleanupExpiredKeys(),this.updateMetrics(),{...this.metrics}}updateMetrics(){const e=Date.now();(e-this.lastMetricsUpdate)/1e3;const t={string:0,hash:0,list:0,set:0,zset:0,stream:0};for(const c of this.keys.values())t[c.type]++;const n=this.operationHistory.filter(c=>c.timestamp>e-1e3).length,s=this.metrics.hitCount+this.metrics.missCount,a=s>0?this.metrics.hitCount/s:0;this.metrics={totalKeys:this.keys.size,keysByType:t,memoryUsage:this.currentMemoryUsage,memoryUsagePercent:this.maxMemoryBytes>0?this.currentMemoryUsage/this.maxMemoryBytes*100:0,operationsPerSecond:n,hitCount:this.metrics.hitCount,missCount:this.metrics.missCount,hitRate:a,expiredKeys:this.metrics.expiredKeys,evictedKeys:this.metrics.evictedKeys,connectedClients:1},this.lastMetricsUpdate=e}getAllKeys(){return this.cleanupExpiredKeys(),Array.from(this.keys.values())}getKey(e){const t=this.keys.get(e);if(t&&this.isExpired(t)){this.deleteKey(e);return}return t}syncKeysFromConfig(e){const t=new Map;for(const n of e)t.set(n.key,n);for(const[n,s]of this.keys.entries());for(const n of e){const s=this.keys.get(n.key);if(!s)this.setKey(n.key,n.type,n.value,n.ttl);else if(s.type!==n.type||JSON.stringify(s.value)!==JSON.stringify(n.value)||s.ttl!==n.ttl){this.currentMemoryUsage-=this.calculateKeySize(s);const a={...n,expiresAt:n.ttl!==void 0&&n.ttl>0?Date.now()+n.ttl*1e3:void 0,size:this.estimateSize(typeof n.value=="string"?n.value:JSON.stringify(n.value))};this.keys.set(n.key,a),this.currentMemoryUsage+=this.calculateKeySize(a)}}this.updateMetrics()}}class Bk{clusterName="archiphoenix-cluster";nodes=new Map;keyspaces=new Map;tables=new Map;tableData=new Map;defaultConsistencyLevel="QUORUM";defaultReplicationFactor=3;enableCompaction=!0;compactionStrategy="SizeTieredCompactionStrategy";datacenter="dc1";metrics={readLatency:5,writeLatency:10,totalNodes:0,healthyNodes:0,totalKeyspaces:0,totalTables:0,totalRows:0,totalSize:0,readOperationsPerSecond:0,writeOperationsPerSecond:0,readConsistencyViolations:0,writeConsistencyViolations:0,pendingCompactions:0,hintedHandoffs:0};readOperations=[];writeOperations=[];lastMetricsUpdate=Date.now();initialize(e){if(this.clusterName=e.clusterName||"archiphoenix-cluster",this.defaultConsistencyLevel=e.defaultConsistencyLevel||"QUORUM",this.defaultReplicationFactor=e.defaultReplicationFactor||3,this.enableCompaction=e.enableCompaction??!0,this.compactionStrategy=e.compactionStrategy||"SizeTieredCompactionStrategy",this.datacenter=e.datacenter||"dc1",this.nodes.clear(),e.nodes)for(const t of e.nodes)this.nodes.set(t.address,{...t});else this.nodes.set("localhost:9042",{address:"localhost:9042",status:"up",load:.5,tokens:256});if(this.keyspaces.clear(),e.keyspaces)for(const t of e.keyspaces)this.keyspaces.set(t.name,{...t});else this.keyspaces.set("system",{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0});if(this.tables.clear(),this.tableData.clear(),e.tables)for(const t of e.tables){const n=`${t.keyspace}.${t.name}`;this.tables.set(n,{...t}),this.tableData.set(n,[])}this.updateMetrics()}syncFromConfig(e){if(e.clusterName&&(this.clusterName=e.clusterName),e.defaultConsistencyLevel&&(this.defaultConsistencyLevel=e.defaultConsistencyLevel),e.defaultReplicationFactor!==void 0&&(this.defaultReplicationFactor=e.defaultReplicationFactor),e.nodes)for(const t of e.nodes)this.nodes.set(t.address,{...t});if(e.keyspaces){new Set(this.keyspaces.keys());for(const t of e.keyspaces)this.keyspaces.set(t.name,{...t,tables:this.countTablesInKeyspace(t.name)})}if(e.tables)for(const t of e.tables){const n=`${t.keyspace}.${t.name}`,s=this.tables.get(n);if(s){const a=this.tableData.get(n)||[];this.tables.set(n,{...t,rows:s.rows||a.length||0,size:s.size||a.length*1024||0})}else this.tables.set(n,{...t,rows:0,size:0}),this.tableData.has(n)||this.tableData.set(n,[])}this.updateMetrics()}executeCQL(e,t){const n=Date.now(),s=t||this.defaultConsistencyLevel;try{const a=e.trim().replace(/\s+/g," "),c=a.toUpperCase();return c.startsWith("SELECT")?this.executeSelect(a,s,n):c.startsWith("INSERT")?this.executeInsert(a,s,n):c.startsWith("UPDATE")?this.executeUpdate(a,s,n):c.startsWith("DELETE")?this.executeDelete(a,s,n):c.startsWith("CREATE KEYSPACE")?this.executeCreateKeyspace(a,n):c.startsWith("CREATE TABLE")?this.executeCreateTable(a,n):c.startsWith("DROP TABLE")?this.executeDropTable(a,n):c.startsWith("DROP KEYSPACE")?this.executeDropKeyspace(a,n):{success:!1,error:`Unsupported CQL statement: ${a}`,latency:Date.now()-n}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error",latency:Date.now()-n}}}executeSelect(e,t,n){const s=e.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-n};const a=s[1].trim(),c=this.normalizeTableKey(a),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-n};const d=this.tableData.get(c)||[],f=e.match(/LIMIT\s+(\d+)/i),p=f?parseInt(f[1],10):void 0;let m=[...d];const y=e.match(/WHERE\s+(.+?)(?:\s+LIMIT|$)/i);if(y){const C=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(C){const T=C[1],k=C[2];m=d.filter(A=>String(A[T])===k)}}p!==void 0&&p>0&&(m=m.slice(0,p));const b=this.calculateReadLatency(t),S=this.checkConsistencyViolation(t,l.keyspace);this.recordReadOperation(b,S);const M=this.getRequiredReplicas(t,l.keyspace);return{success:!0,latency:b,consistency:t,rows:m,rowCount:m.length,replicasQueried:M}}executeInsert(e,t,n){const s=e.match(/INTO\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-n};const a=s[1].trim(),c=this.normalizeTableKey(a);let l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-n};const d=e.match(/\(([^)]+)\)\s*VALUES/i),f=e.match(/VALUES\s*\(([^)]+)\)/i);if(!d||!f)return{success:!1,error:"Invalid INSERT query: missing columns or values",latency:Date.now()-n};const p=d[1].split(",").map(T=>T.trim()),m=f[1],y=this.parseValueList(m);if(p.length!==y.length)return{success:!1,error:"Column count does not match value count",latency:Date.now()-n};const b={};for(let T=0;T<p.length;T++)b[p[T]]=y[T];const S=this.tableData.get(c)||[];S.push(b),this.tableData.set(c,S),l.rows=S.length,l.size=S.length*1024,this.tables.set(c,l);const M=this.calculateWriteLatency(t,l.keyspace),E=this.checkConsistencyViolation(t,l.keyspace);this.recordWriteOperation(M,E);const C=this.getRequiredReplicas(t,l.keyspace);return this.updateMetrics(),{success:!0,latency:M,consistency:t,rowCount:1,replicasQueried:C}}executeUpdate(e,t,n){const s=e.match(/UPDATE\s+([\w.]+)\s+SET/i);if(!s)return{success:!1,error:"Invalid UPDATE query",latency:Date.now()-n};const a=s[1].trim(),c=this.normalizeTableKey(a),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-n};const d=e.match(/SET\s+(.+?)(?:\s+WHERE|$)/i);if(!d)return{success:!1,error:"Invalid UPDATE query: missing SET clause",latency:Date.now()-n};const f=d[1].trim(),p={},m=f.split(",").map(N=>N.trim());for(const N of m){const L=N.match(/(\w+)\s*=\s*(.+)/);if(L){const q=L[1].trim(),Z=this.parseValue(L[2].trim());p[q]=Z}}const y=e.match(/WHERE\s+(.+)/i);if(!y)return{success:!1,error:"UPDATE requires WHERE clause",latency:Date.now()-n};const S=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!S)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-n};const M=S[1],E=S[2],C=this.tableData.get(c)||[];let T=0;for(const N of C)String(N[M])===E&&(Object.assign(N,p),T++);l.rows=C.length,l.size=C.length*1024,this.tables.set(c,l);const k=this.calculateWriteLatency(t,l.keyspace),A=this.checkConsistencyViolation(t,l.keyspace);this.recordWriteOperation(k,A);const _=this.getRequiredReplicas(t,l.keyspace);return this.updateMetrics(),{success:!0,latency:k,consistency:t,rowCount:T,replicasQueried:_}}executeDelete(e,t,n){const s=e.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DELETE query: missing FROM clause",latency:Date.now()-n};const a=s[1].trim(),c=this.normalizeTableKey(a),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-n};const d=e.match(/WHERE\s+(.+)/i);if(!d)return{success:!1,error:"DELETE requires WHERE clause",latency:Date.now()-n};const p=d[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!p)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-n};const m=p[1],y=p[2],b=this.tableData.get(c)||[],S=b.length,M=b.filter(A=>String(A[m])!==y);this.tableData.set(c,M),l.rows=M.length,l.size=M.length*1024,this.tables.set(c,l);const E=S-M.length,C=this.calculateWriteLatency(t,l.keyspace),T=this.checkConsistencyViolation(t,l.keyspace);this.recordWriteOperation(C,T);const k=this.getRequiredReplicas(t,l.keyspace);return this.updateMetrics(),{success:!0,latency:C,consistency:t,rowCount:E,replicasQueried:k}}executeCreateKeyspace(e,t){const n=e.match(/KEYSPACE\s+(\w+)/i);if(!n)return{success:!1,error:"Invalid CREATE KEYSPACE query",latency:Date.now()-t};const s=n[1].trim();if(this.keyspaces.has(s))return{success:!1,error:`Keyspace ${s} already exists`,latency:Date.now()-t};let a=this.defaultReplicationFactor;const c=e.match(/replication.*?(\d+)/i);return c&&(a=parseInt(c[1],10)),this.keyspaces.set(s,{name:s,replication:a,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}executeCreateTable(e,t){const n=e.match(/TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s);if(this.tables.has(a))return{success:!1,error:`Table ${s} already exists`,latency:Date.now()-t};let c=e;const l=e.toUpperCase().indexOf(" WITH ");l>0&&(c=e.substring(0,l));const d=c.match(/\(([^)]+)\)/);if(!d)return{success:!1,error:"Invalid CREATE TABLE query: missing column definitions",latency:Date.now()-t};const f=d[1],p=[],m=f.split(",").map(C=>C.trim());for(const C of m){if(C.toUpperCase().includes("PRIMARY KEY"))continue;const T=C.match(/(\w+)\s+(\w+)/);T&&p.push({name:T[1],type:T[2]})}const y=s.split("."),b=y.length>1?y[0]:"system",S=y.length>1?y[1]:y[0];if(!this.keyspaces.has(b))return{success:!1,error:`Keyspace ${b} does not exist`,latency:Date.now()-t};const M={name:S,keyspace:b,columns:p,rows:0,size:0};this.tables.set(a,M),this.tableData.set(a,[]);const E=this.keyspaces.get(b);return E&&(E.tables=this.countTablesInKeyspace(b),this.keyspaces.set(b,E)),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}executeDropTable(e,t){const n=e.match(/TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s);if(!this.tables.has(a))return{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-t};const c=this.tables.get(a);this.tables.delete(a),this.tableData.delete(a);const l=this.keyspaces.get(c.keyspace);return l&&(l.tables=this.countTablesInKeyspace(c.keyspace),this.keyspaces.set(c.keyspace,l)),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}executeDropKeyspace(e,t){const n=e.match(/KEYSPACE\s+(\w+)/i);if(!n)return{success:!1,error:"Invalid DROP KEYSPACE query",latency:Date.now()-t};const s=n[1].trim();if(!this.keyspaces.has(s))return{success:!1,error:`Keyspace ${s} does not exist`,latency:Date.now()-t};const a=[];for(const[c,l]of this.tables.entries())l.keyspace===s&&a.push(c);for(const c of a)this.tables.delete(c),this.tableData.delete(c);return this.keyspaces.delete(s),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}getNodes(){return Array.from(this.nodes.values())}getKeyspaces(){return Array.from(this.keyspaces.values())}getTables(){return Array.from(this.tables.values())}getMetrics(){return this.updateMetrics(),{...this.metrics}}calculateReadLatency(e){const n=this.getRequiredReplicas(e,"system"),s=Math.log(n+1)*3,a=Math.random()*2;return Math.round(2+s+a)}calculateWriteLatency(e,t){const a=this.getRequiredReplicas(e,t)*2,c=Math.random()*3;return Math.round(5+a+c)}getRequiredReplicas(e,t){const s=this.keyspaces.get(t)?.replication||this.defaultReplicationFactor;switch(e){case"ONE":case"LOCAL_ONE":return 1;case"TWO":return 2;case"THREE":return 3;case"QUORUM":case"LOCAL_QUORUM":return Math.floor(s/2)+1;case"ALL":case"EACH_QUORUM":return s;case"SERIAL":case"LOCAL_SERIAL":return Math.floor(s/2)+1;default:return Math.floor(s/2)+1}}checkConsistencyViolation(e,t){const n=this.metrics.healthyNodes,s=this.getRequiredReplicas(e,t),a=n<s?.8:.05;return Math.random()<a}recordReadOperation(e,t){const n=Date.now();this.readOperations.push({timestamp:n,latency:e,violated:t}),this.readOperations.length>1e3&&this.readOperations.shift(),t&&this.metrics.readConsistencyViolations++}recordWriteOperation(e,t){const n=Date.now();this.writeOperations.push({timestamp:n,latency:e,violated:t}),this.writeOperations.length>1e3&&this.writeOperations.shift(),t&&this.metrics.writeConsistencyViolations++}updateMetrics(){const e=Date.now();(e-this.lastMetricsUpdate)/1e3,this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(f=>f.status==="up").length,this.metrics.totalKeyspaces=this.keyspaces.size,this.metrics.totalTables=this.tables.size;let t=0,n=0;for(const[f,p]of this.tableData.entries())t+=p.length,n+=p.length*1024;this.metrics.totalRows=t,this.metrics.totalSize=n;const s=e-1e3,a=this.readOperations.filter(f=>f.timestamp>s),c=this.writeOperations.filter(f=>f.timestamp>s);if(this.metrics.readOperationsPerSecond=a.length,this.metrics.writeOperationsPerSecond=c.length,a.length>0){const f=a.reduce((p,m)=>p+m.latency,0)/a.length;this.metrics.readLatency=Math.round(f*10)/10}if(c.length>0){const f=c.reduce((p,m)=>p+m.latency,0)/c.length;this.metrics.writeLatency=Math.round(f*10)/10}this.metrics.pendingCompactions=Math.floor(this.metrics.totalSize/(10*1024*1024));const l=this.metrics.totalNodes-this.metrics.healthyNodes;this.metrics.hintedHandoffs=l>0?l*5:0;const d=this.metrics.readOperationsPerSecond+this.metrics.writeOperationsPerSecond;for(const f of this.nodes.values())if(f.status==="up"){const p=Math.min(.95,.3+d/100*.3);f.load=f.load*.9+p*.1,f.load+=(Math.random()-.5)*.05,f.load=Math.max(.1,Math.min(.95,f.load))}this.lastMetricsUpdate=e}countTablesInKeyspace(e){let t=0;for(const n of this.tables.values())n.keyspace===e&&t++;return t}normalizeTableKey(e){return e.includes(".")?e:`system.${e}`}parseValueList(e){const t=[];let n="",s=!1,a="";for(let c=0;c<e.length;c++){const l=e[c];if((l==='"'||l==="'")&&!s){s=!0,a=l;continue}else if(l===a&&s){s=!1,a="";continue}l===","&&!s?(t.push(this.parseValue(n.trim())),n=""):n+=l}return n.trim()&&t.push(this.parseValue(n.trim())),t}parseValue(e){return e=e.trim(),e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):/^-?\d+$/.test(e)?parseInt(e,10):/^-?\d*\.\d+$/.test(e)?parseFloat(e):e.toUpperCase()==="TRUE"?!0:e.toUpperCase()==="FALSE"?!1:e.toUpperCase()==="NULL"?null:e}}class Fk{cluster="archiphoenix-cluster";replication=!1;tables=new Map;tableData=new Map;tableParts=new Map;maxMemoryUsage=10*1024*1024*1024;compression="LZ4";metrics={queryThroughput:0,avgQueryTime:45,queriesPerSecond:0,readRowsPerSecond:0,writtenRowsPerSecond:0,totalRows:0,totalSize:0,compressionRatio:5,activeQueries:0,memoryUsage:0,memoryUsagePercent:0,partsCount:0,pendingMerges:0,totalTables:0,clusterNodes:1,healthyNodes:1};queryOperations=[];lastMetricsUpdate=Date.now();activeQueriesSet=new Set;initialize(e){if(this.cluster=e.cluster||"archiphoenix-cluster",this.replication=e.replication||!1,this.maxMemoryUsage=e.maxMemoryUsage||10*1024*1024*1024,this.compression=e.compression||"LZ4",this.tables.clear(),this.tableData.clear(),this.tableParts.clear(),e.tables)for(const t of e.tables){const n=`${t.database||"default"}.${t.name}`;this.tables.set(n,{...t}),this.tableData.set(n,[]),this.tableParts.set(n,[])}this.updateMetrics()}syncFromConfig(e){if(e.cluster&&(this.cluster=e.cluster),e.replication!==void 0&&(this.replication=e.replication),e.maxMemoryUsage&&(this.maxMemoryUsage=e.maxMemoryUsage),e.compression&&(this.compression=e.compression),e.tables)for(const t of e.tables){const n=`${t.database||"default"}.${t.name}`,s=this.tables.get(n),a=this.tableData.get(n)||[];s?this.tables.set(n,{...t,rows:s.rows||a.length||0,size:s.size||a.length*512||0}):(this.tables.set(n,{...t,rows:0,size:0}),this.tableData.has(n)||(this.tableData.set(n,[]),this.tableParts.set(n,[])))}this.updateMetrics()}executeQuery(e){const t=Date.now(),n=`query-${Date.now()}-${Math.random()}`;try{const s=e.trim().replace(/\s+/g," "),a=s.toUpperCase();this.activeQueriesSet.add(n),this.metrics.activeQueries=this.activeQueriesSet.size;let c;a.startsWith("SELECT")?c=this.executeSelect(s,t):a.startsWith("INSERT")?c=this.executeInsert(s,t):a.startsWith("ALTER")?c=this.executeAlter(s,t):a.startsWith("CREATE TABLE")?c=this.executeCreateTable(s,t):a.startsWith("DROP TABLE")?c=this.executeDropTable(s,t):c={success:!1,error:`Unsupported SQL statement: ${s}`,latency:Date.now()-t};const l=c.latency||Date.now()-t;return this.queryOperations.push({timestamp:Date.now(),latency:l,rowsRead:c.dataRead||0,rowsWritten:c.dataWritten||0}),this.activeQueriesSet.delete(n),this.metrics.activeQueries=this.activeQueriesSet.size,c}catch(s){return this.activeQueriesSet.delete(n),this.metrics.activeQueries=this.activeQueriesSet.size,{success:!1,error:s instanceof Error?s.message:"Unknown error",latency:Date.now()-t}}}executeSelect(e,t){const n=e.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s),c=this.tables.get(a);if(!c)return{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-t};const l=this.tableData.get(a)||[],d=e.match(/SELECT\s+(.+?)\s+FROM/i),f=d?d[1].trim().split(",").map(T=>T.trim()):["*"];let p=[...l];const m=e.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(m){const k=m[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(k){const A=k[1],_=k[2];p=l.filter(N=>String(N[A])===_)}}const y=e.match(/GROUP\s+BY\s+(\w+)/i);if(y){const T=y[1],k=new Map;p.forEach(A=>{const _=String(A[T]||"null");k.set(_,(k.get(_)||0)+1)}),p=Array.from(k.entries()).map(([A,_])=>({[T]:A,count:_}))}const b=e.match(/ORDER\s+BY\s+(\w+)(?:\s+(ASC|DESC))?/i);if(b){const T=b[1],k=(b[2]||"ASC").toUpperCase();p.sort((A,_)=>{const N=A[T],L=_[T];return k==="DESC"?N>L?-1:N<L?1:0:N<L?-1:N>L?1:0})}const S=e.match(/LIMIT\s+(\d+)/i),M=S?parseInt(S[1],10):void 0;M!==void 0&&M>0&&(p=p.slice(0,M));const E=this.calculateQueryLatency(e,c,p.length);let C=p;return!f.includes("*")&&f.length>0&&(C=p.map(T=>{const k={};return f.forEach(A=>{T.hasOwnProperty(A)&&(k[A]=T[A])}),k})),{success:!0,latency:E,rows:C,rowCount:C.length,columns:f.includes("*")?Object.keys(l[0]||{}):f,dataRead:l.length}}executeInsert(e,t){const n=e.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s);let c=this.tables.get(a);if(!c)return{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-t};const l=e.match(/VALUES\s+(.+)/i);if(!l)return{success:!1,error:"Invalid INSERT query: missing VALUES clause",latency:Date.now()-t};const d=l[1].trim(),f=this.parseValues(d),p=this.tableData.get(a)||[],m={},y=e.match(/\(([^)]+)\)\s+VALUES/i),b=y?y[1].split(",").map(M=>M.trim()):[];b.length>0&&b.length===f.length?b.forEach((M,E)=>{m[M]=f[E]}):f.forEach((M,E)=>{m[`column_${E}`]=M}),p.push(m),this.tableData.set(a,p),c.rows=p.length,c.size=p.length*512,this.tables.set(a,c);const S=10+Math.random()*5;return this.simulatePartCreation(a),this.updateMetrics(),{success:!0,latency:S,rowCount:1,dataWritten:1}}executeCreateTable(e,t){const n=e.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s);if(this.tables.has(a))return{success:!1,error:`Table ${s} already exists`,latency:Date.now()-t};const c=e.match(/ENGINE\s*=\s*(\w+)/i),l=c?c[1]:"MergeTree",[d,f]=a.split("."),p={name:f,database:d||"default",engine:l,rows:0,size:0,partitions:0};return this.tables.set(a,p),this.tableData.set(a,[]),this.tableParts.set(a,[]),this.updateMetrics(),{success:!0,latency:Date.now()-t}}executeDropTable(e,t){const n=e.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s);return this.tables.has(a)?(this.tables.delete(a),this.tableData.delete(a),this.tableParts.delete(a),this.updateMetrics(),{success:!0,latency:Date.now()-t}):{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-t}}executeAlter(e,t){const n=e.match(/ALTER\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid ALTER TABLE query",latency:Date.now()-t};const s=n[1].trim(),a=this.normalizeTableKey(s);return this.tables.get(a)?{success:!0,latency:Date.now()-t}:{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-t}}calculateQueryLatency(e,t,n){const a=n/1e6*5;let c=1;const l=e.toUpperCase();l.includes("JOIN")&&(c*=2),l.includes("GROUP BY")&&(c*=1.5),l.includes("ORDER BY")&&(c*=1.3),l.includes("COUNT")&&(c*=.8),(l.includes("SUM")||l.includes("AVG"))&&(c*=.9);const d=this.tableParts.get(`${t.database}.${t.name}`)||[],f=Math.min(1.5,1+d.length/100);return 10+a*c*f}parseValues(e){let t=e.trim();t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,-1));const n=[];let s="",a=!1,c="";for(let l=0;l<t.length;l++){const d=t[l];(d==='"'||d==="'")&&!a?(a=!0,c=d):d===c&&a?(a=!1,c=""):d===","&&!a?(n.push(this.parseValue(s.trim())),s=""):s+=d}return s.trim()&&n.push(this.parseValue(s.trim())),n}parseValue(e){const t=e.trim();return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):t.toLowerCase()==="true"?!0:t.toLowerCase()==="false"?!1:t.toLowerCase()==="null"?null:t}normalizeTableKey(e){return e.includes(".")?e:`default.${e}`}simulatePartCreation(e){const t=this.tableParts.get(e)||[],n=new Date().toISOString().split("T")[0],s={name:`${n}_${t.length+1}`,minDate:n,maxDate:n,rows:1e3,size:512*1e3,level:0};if(t.push(s),this.tableParts.set(e,t),t.length>10){const a=t.splice(0,5),c={name:`merged_${Date.now()}`,minDate:a[0].minDate,maxDate:a[a.length-1].maxDate,rows:a.reduce((l,d)=>l+d.rows,0),size:a.reduce((l,d)=>l+d.size,0),level:Math.max(...a.map(l=>l.level))+1};t.unshift(c),this.tableParts.set(e,t)}}updateMetrics(){const e=Date.now(),t=(e-this.lastMetricsUpdate)/1e3;this.metrics.totalTables=this.tables.size;let n=0,s=0,a=0;for(const[f,p]of this.tables.entries()){n+=p.rows,s+=p.size;const m=this.tableParts.get(f)||[];a+=m.length}this.metrics.totalRows=n,this.metrics.totalSize=s,this.metrics.partsCount=a;const c=e-1e3,l=this.queryOperations.filter(f=>f.timestamp>c);if(this.metrics.queriesPerSecond=l.length,this.metrics.queryThroughput=l.length,l.length>0){const f=l.reduce((y,b)=>y+b.latency,0)/l.length;this.metrics.avgQueryTime=Math.round(f*10)/10;const p=l.reduce((y,b)=>y+b.rowsRead,0),m=l.reduce((y,b)=>y+b.rowsWritten,0);this.metrics.readRowsPerSecond=Math.round(p/t),this.metrics.writtenRowsPerSecond=Math.round(m/t)}const d=s/this.metrics.compressionRatio;this.metrics.memoryUsage=d,this.metrics.memoryUsagePercent=d/this.maxMemoryUsage*100,this.metrics.pendingMerges=Math.floor(a/10),this.metrics.clusterNodes=this.replication?3:1,this.metrics.healthyNodes=this.metrics.clusterNodes,this.lastMetricsUpdate=e}getMetrics(){return this.updateMetrics(),{...this.metrics}}insertData(e,t){const n=this.normalizeTableKey(e),s=this.tables.get(n);if(!s)return{success:!1,rowsInserted:0,error:`Table ${e} does not exist`};const a=this.tableData.get(n)||[];return a.push(...t),this.tableData.set(n,a),s.rows=a.length,s.size=a.length*512,this.tables.set(n,s),this.simulatePartCreation(n),this.updateMetrics(),{success:!0,rowsInserted:t.length}}}const uo={"X-Small":{servers:1,creditsPerHour:1},Small:{servers:2,creditsPerHour:2},Medium:{servers:4,creditsPerHour:4},Large:{servers:8,creditsPerHour:8},"X-Large":{servers:16,creditsPerHour:16},"2X-Large":{servers:32,creditsPerHour:32},"3X-Large":{servers:64,creditsPerHour:64},"4X-Large":{servers:128,creditsPerHour:128}};class Qk{account="archiphoenix";region="us-east-1";warehouses=new Map;databases=new Map;tables=new Map;tableData=new Map;queries=new Map;queryQueue=[];activeQueries=new Map;resultCache=new Map;cacheHits=0;cacheMisses=0;metrics={totalWarehouses:0,runningWarehouses:0,suspendedWarehouses:0,totalQueries:0,runningQueries:0,queuedQueries:0,queriesPerSecond:0,avgQueryTime:0,totalComputeTime:0,totalDataRead:0,totalDataWritten:0,cacheHitRate:0,warehouseUtilization:0,totalCost:0};queryOperations=[];lastMetricsUpdate=Date.now();warehouseLastUpdate=new Map;suspendTimers=new Map;initialize(e){if(this.account=e.account||"archiphoenix",this.region=e.region||"us-east-1",this.warehouses.clear(),e.warehouses&&e.warehouses.length>0)for(const t of e.warehouses)this.warehouses.set(t.name,{...t,status:t.status||"suspended",currentClusterCount:t.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});else this.warehouses.set("COMPUTE_WH",{name:"COMPUTE_WH",size:"Small",status:"suspended",autoSuspend:60,autoResume:!0,minClusterCount:1,maxClusterCount:1,currentClusterCount:1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});if(this.databases.clear(),this.tables.clear(),this.tableData.clear(),e.databases){for(const t of e.databases)if(this.databases.set(t.name,{...t}),t.schemas){for(const n of t.schemas)if(n.tables)for(const s of n.tables){const a=`${t.name}.${n.name}.${s.name}`;this.tables.set(a,{...s}),this.tableData.set(a,[])}}}this.databases.has("SNOWFLAKE")||this.databases.set("SNOWFLAKE",{name:"SNOWFLAKE",comment:"System database",retentionTime:1,size:0,schemas:[{name:"INFORMATION_SCHEMA",tables:[],views:0,functions:0}]}),this.updateMetrics()}syncFromConfig(e){if(e.account&&(this.account=e.account),e.region&&(this.region=e.region),e.warehouses){for(const n of e.warehouses){const s=this.warehouses.get(n.name);s?(this.warehouses.set(n.name,{...n,status:s.status,currentClusterCount:s.currentClusterCount,runningQueries:s.runningQueries,queuedQueries:s.queuedQueries,totalQueriesExecuted:s.totalQueriesExecuted,totalComputeTime:s.totalComputeTime,lastUsed:s.lastUsed}),this.updateWarehouseAutoSuspend(n.name,n)):this.warehouses.set(n.name,{...n,status:"suspended",currentClusterCount:n.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0})}const t=new Set(e.warehouses.map(n=>n.name));for(const[n]of this.warehouses.entries())if(!t.has(n)){this.warehouses.delete(n);const s=this.suspendTimers.get(n);s&&(clearTimeout(s),this.suspendTimers.delete(n))}}if(e.databases){for(const t of e.databases)if(this.databases.get(t.name),this.databases.set(t.name,{...t}),t.schemas){for(const n of t.schemas)if(n.tables)for(const s of n.tables){const a=`${t.name}.${n.name}.${s.name}`,c=this.tables.get(a),l=this.tableData.get(a)||[];c?this.tables.set(a,{...s,rows:c.rows||l.length||0,size:c.size||l.length*512||0}):(this.tables.set(a,{...s,rows:0,size:0}),this.tableData.set(a,[]))}}}this.updateMetrics()}executeQuery(e,t,n,s){const a=Date.now(),c=`query-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l=this.getCacheKey(e,n,s),d=this.resultCache.get(l);if(d&&Date.now()-d.timestamp<d.ttl)return this.cacheHits++,this.updateMetrics(),{success:!0,latency:10,rows:d.data,rowCount:d.data.length,queryId:c,resultCacheUsed:!0};this.cacheMisses++;let f;if(t?f=this.warehouses.get(t):f=Array.from(this.warehouses.values()).find(m=>m.status==="running")||Array.from(this.warehouses.values())[0],!f)return{success:!1,error:"No warehouse available",latency:Date.now()-a,queryId:c};const p={id:c,queryText:e,status:"queued",warehouse:f.name,database:n,schema:s,startedAt:a};return this.queries.set(c,p),f.status==="suspended"&&f.autoResume&&this.resumeWarehouse(f.name),f.status==="running"?this.executeQueryOnWarehouse(p,f,a):(f.queuedQueries++,this.queryQueue.push(p),p.status="queued",f.autoResume&&this.resumeWarehouse(f.name),f.status==="running"&&this.processQueryQueue(f),{success:!0,latency:50,queryId:c,warehouse:f.name})}executeQueryOnWarehouse(e,t,n){e.status="running",e.startedAt=Date.now(),t.runningQueries++,this.activeQueries.set(e.id,e),1/(uo[t.size]||uo.Small).servers,this.estimateQueryComplexity(e.queryText);const a=this.executeSQL(e.queryText,e.database,e.schema),c=Date.now();if(e.completedAt=c,e.duration=c-(e.startedAt||n),e.status=a.success?"success":"failed",e.rowsReturned=a.rowCount,e.error=a.error,t.runningQueries--,t.totalQueriesExecuted++,t.totalComputeTime+=e.duration/1e3,t.lastUsed=c,this.activeQueries.delete(e.id),a.success&&a.rows){const l=this.getCacheKey(e.queryText,e.database,e.schema);this.resultCache.set(l,{data:a.rows,timestamp:c,ttl:3e5})}return this.queryOperations.push({timestamp:c,latency:e.duration,rowsRead:a.dataRead||0,rowsWritten:a.dataWritten||0}),t.autoSuspend&&t.runningQueries===0&&t.queuedQueries===0&&this.scheduleWarehouseSuspend(t.name,t.autoSuspend),this.updateMetrics(),{...a,queryId:e.id,warehouse:t.name,latency:e.duration}}executeSQL(e,t,n){const s=e.trim().replace(/\s+/g," "),a=s.toUpperCase();try{return a.startsWith("SELECT")?this.executeSelect(s,t,n):a.startsWith("INSERT")?this.executeInsert(s,t,n):a.startsWith("UPDATE")?this.executeUpdate(s,t,n):a.startsWith("DELETE")?this.executeDelete(s,t,n):a.startsWith("CREATE TABLE")?this.executeCreateTable(s,t,n):a.startsWith("DROP TABLE")?this.executeDropTable(s,t,n):{success:!1,error:`Unsupported SQL statement: ${s}`}}catch(c){return{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}executeSelect(e,t,n){const s=e.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid SELECT query: missing FROM clause"};const a=s[1].trim(),c=this.normalizeTableKey(a,t,n),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${a} does not exist`};const d=this.tableData.get(c)||[],f=e.match(/SELECT\s+(.+?)\s+FROM/i),p=f?f[1].trim().split(",").map(S=>S.trim()):["*"];let m=[...d];const y=e.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(y){const M=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(M){const E=M[1],C=M[2];m=d.filter(T=>String(T[E])===C)}}const b=e.match(/LIMIT\s+(\d+)/i);if(b){const S=parseInt(b[1],10);m=m.slice(0,S)}return{success:!0,rows:m,rowCount:m.length,columns:p.includes("*")?l.columns?.map(S=>S.name)||[]:p,dataRead:d.length}}executeInsert(e,t,n){const s=e.match(/INTO\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid INSERT query: missing INTO clause"};const a=s[1].trim(),c=this.normalizeTableKey(a,t,n),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${a} does not exist`};const d=e.match(/VALUES\s*\((.+?)\)/i);if(!d)return{success:!1,error:"Invalid INSERT query: missing VALUES clause"};const f=d[1].split(",").map(b=>b.trim().replace(/^['"]|['"]$/g,"")),p=l.columns||[];if(f.length!==p.length)return{success:!1,error:`Column count mismatch: expected ${p.length}, got ${f.length}`};const m={};p.forEach((b,S)=>{m[b.name]=f[S]});const y=this.tableData.get(c)||[];return y.push(m),this.tableData.set(c,y),l.rows=y.length,l.size=y.length*512,{success:!0,rowCount:1,dataWritten:1}}executeUpdate(e,t,n){return{success:!0,rowCount:0,dataWritten:0}}executeDelete(e,t,n){return{success:!0,rowCount:0,dataWritten:0}}executeCreateTable(e,t,n){const s=e.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid CREATE TABLE query"};const a=s[1].trim(),c=this.normalizeTableKey(a,t,n);if(this.tables.has(c))return{success:!1,error:`Table ${a} already exists`};const l=e.match(/\((.+?)\)/),d=[];if(l){const b=l[1].split(",").map(S=>S.trim());for(const S of b){const M=S.split(/\s+/);M.length>=2&&d.push({name:M[0],type:M[1],nullable:!S.toUpperCase().includes("NOT NULL")})}}const[f,p,m]=this.parseTableName(a,t,n),y={name:m,schema:p,database:f,columns:d,rows:0,size:0,created:Date.now()};return this.tables.set(c,y),this.tableData.set(c,[]),{success:!0,rowCount:0}}executeDropTable(e,t,n){const s=e.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DROP TABLE query"};const a=s[1].trim(),c=this.normalizeTableKey(a,t,n);return this.tables.has(c)?(this.tables.delete(c),this.tableData.delete(c),{success:!0,rowCount:0}):{success:!1,error:`Table ${a} does not exist`}}resumeWarehouse(e){const t=this.warehouses.get(e);if(!t)return!1;if(t.status==="running")return!0;const n=this.suspendTimers.get(e);return n&&(clearTimeout(n),this.suspendTimers.delete(e)),t.status="running",t.currentClusterCount=t.minClusterCount,this.processQueryQueue(t),this.updateMetrics(),!0}suspendWarehouse(e){const t=this.warehouses.get(e);return t?t.status==="suspended"?!0:t.runningQueries>0?!1:(t.status="suspended",t.currentClusterCount=0,this.updateMetrics(),!0):!1}scheduleWarehouseSuspend(e,t){const n=this.suspendTimers.get(e);n&&clearTimeout(n);const s=setTimeout(()=>{const a=this.warehouses.get(e);a&&a.runningQueries===0&&a.queuedQueries===0&&this.suspendWarehouse(e),this.suspendTimers.delete(e)},t*1e3);this.suspendTimers.set(e,s)}updateWarehouseAutoSuspend(e,t){const n=this.warehouses.get(e);if(n){if(t.autoSuspend!==void 0||t.autoResume!==void 0){const s=this.suspendTimers.get(e);s&&(clearTimeout(s),this.suspendTimers.delete(e))}n.status==="running"&&n.autoSuspend&&n.runningQueries===0&&n.queuedQueries===0&&this.scheduleWarehouseSuspend(e,n.autoSuspend)}}processQueryQueue(e){if(e.status!=="running")return;const t=this.queryQueue.filter(n=>n.warehouse===e.name&&n.status==="queued");for(const n of t)e.runningQueries<this.getMaxConcurrentQueries(e)&&(e.queuedQueries--,this.queryQueue=this.queryQueue.filter(s=>s.id!==n.id),this.executeQueryOnWarehouse(n,e,n.startedAt||Date.now()))}getMaxConcurrentQueries(e){return(uo[e.size]||uo.Small).servers*e.currentClusterCount*8}estimateQueryComplexity(e){let t=1;const n=(e.match(/\bJOIN\b/gi)||[]).length;t+=n*.5,e.match(/\bGROUP\s+BY\b/i)&&(t+=.3),e.match(/\bORDER\s+BY\b/i)&&(t+=.2);const s=(e.match(/\b(COUNT|SUM|AVG|MAX|MIN)\s*\(/gi)||[]).length;return t+=s*.2,Math.max(1,t)}normalizeTableKey(e,t,n){const s=e.split(".");return s.length===3?s.join("."):s.length===2?`${t||"PUBLIC"}.${s.join(".")}`:`${t||"PUBLIC"}.${n||"PUBLIC"}.${s[0]}`}parseTableName(e,t,n){const s=e.split(".");return s.length===3?[s[0],s[1],s[2]]:s.length===2?[t||"PUBLIC",s[0],s[1]]:[t||"PUBLIC",n||"PUBLIC",s[0]]}getCacheKey(e,t,n){return`${e}|${t||""}|${n||""}`}updateMetrics(){const e=Date.now(),t=(e-this.lastMetricsUpdate)/1e3;if(this.metrics.totalWarehouses=this.warehouses.size,this.metrics.runningWarehouses=Array.from(this.warehouses.values()).filter(l=>l.status==="running").length,this.metrics.suspendedWarehouses=Array.from(this.warehouses.values()).filter(l=>l.status==="suspended").length,this.metrics.totalQueries=this.queries.size,this.metrics.runningQueries=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.runningQueries,0),this.metrics.queuedQueries=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.queuedQueries,0),t>0){const l=this.queryOperations.filter(d=>d.timestamp>e-1e3);this.metrics.queriesPerSecond=l.length}if(this.queryOperations.length>0){const l=this.queryOperations.slice(-100),d=l.reduce((f,p)=>f+p.latency,0)/l.length;this.metrics.avgQueryTime=d}this.metrics.totalComputeTime=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.totalComputeTime,0);const n=this.queryOperations.slice(-1e3);this.metrics.totalDataRead=n.reduce((l,d)=>l+d.rowsRead,0),this.metrics.totalDataWritten=n.reduce((l,d)=>l+d.rowsWritten,0);const s=this.cacheHits+this.cacheMisses;this.metrics.cacheHitRate=s>0?this.cacheHits/s:0;let a=0;for(const l of this.warehouses.values())if(l.status==="running"){const d=this.getMaxConcurrentQueries(l),f=d>0?l.runningQueries/d:0;a+=f}this.metrics.warehouseUtilization=this.metrics.runningWarehouses>0?a/this.metrics.runningWarehouses:0;let c=0;for(const l of this.warehouses.values())if(l.status==="running"&&l.totalComputeTime>0){const d=uo[l.size]||uo.Small,f=l.totalComputeTime/3600;c+=d.creditsPerHour*f*l.currentClusterCount}this.metrics.totalCost=c,this.lastMetricsUpdate=e}getMetrics(){return this.updateMetrics(),{...this.metrics}}getWarehouse(e){return this.warehouses.get(e)}getWarehouses(){return Array.from(this.warehouses.values())}getQuery(e){return this.queries.get(e)}getRecentQueries(e=100){return Array.from(this.queries.values()).sort((t,n)=>(n.startedAt||0)-(t.startedAt||0)).slice(0,e)}getTables(e,t){return!e&&!t?Array.from(this.tables.values()):Array.from(this.tables.values()).filter(n=>!(e&&n.database!==e||t&&n.schema!==t))}}class Vk{clusterName="archiphoenix-cluster";nodes=new Map;indices=new Map;shards=new Map;documents=new Map;defaultShards=5;defaultReplicas=1;refreshInterval="1s";metrics={clusterHealth:"green",totalNodes:0,healthyNodes:0,totalIndices:0,totalDocs:0,totalSize:0,activeShards:0,relocatingShards:0,initializingShards:0,unassignedShards:0,indexOperationsPerSecond:0,searchOperationsPerSecond:0,averageIndexLatency:5,averageSearchLatency:10,averageGetLatency:2};indexOperations=[];searchOperations=[];getOperations=[];lastMetricsUpdate=Date.now();recentQueries=[];initialize(e){if(this.clusterName=e.clusterName||"archiphoenix-cluster",this.defaultShards=e.defaultShards||5,this.defaultReplicas=e.defaultReplicas||1,this.refreshInterval=e.refreshInterval||"1s",this.nodes.clear(),e.nodes&&e.nodes.length>0)for(const t of e.nodes)this.nodes.set(t,{address:t,status:"up",load:.3+Math.random()*.4,shards:0});else this.nodes.set("localhost:9200",{address:"localhost:9200",status:"up",load:.5,shards:0});if(this.indices.clear(),this.shards.clear(),this.documents.clear(),e.indices&&e.indices.length>0)for(const t of e.indices)this.createIndex(t.name,t.shards||this.defaultShards,t.replicas||this.defaultReplicas,t);else this.createIndex("archiphoenix-index",this.defaultShards,this.defaultReplicas);this.updateMetrics()}syncFromConfig(e){if(e.clusterName&&(this.clusterName=e.clusterName),e.defaultShards!==void 0&&(this.defaultShards=e.defaultShards),e.defaultReplicas!==void 0&&(this.defaultReplicas=e.defaultReplicas),e.refreshInterval&&(this.refreshInterval=e.refreshInterval),e.nodes){new Set(this.nodes.keys());for(const t of e.nodes)this.nodes.has(t)||this.nodes.set(t,{address:t,status:"up",load:.3+Math.random()*.4,shards:0})}if(e.indices){new Set(this.indices.keys());for(const t of e.indices)if(!this.indices.has(t.name))this.createIndex(t.name,t.shards||this.defaultShards,t.replicas||this.defaultReplicas,t);else{const n=this.indices.get(t.name),s=this.getTotalDocsForIndex(t.name),a=this.getTotalSizeForIndex(t.name);this.indices.set(t.name,{...t,docs:n.docs||s,size:n.size||a,health:this.calculateIndexHealth(t.name)})}}this.updateMetrics()}createIndex(e,t=5,n=1,s){const a={name:e,docs:s?.docs||0,size:s?.size||0,shards:t,replicas:n,health:"yellow",mappings:s?.mappings,settings:s?.settings};this.indices.set(e,a);const c=[],l=Array.from(this.nodes.keys());for(let d=0;d<t;d++){const f=l[d%l.length];c.push({index:e,shard:d,primary:!0,node:f,state:"STARTED",docs:0,size:0});for(let p=0;p<n;p++){const m=l[(d+p+1)%l.length];c.push({index:e,shard:d,primary:!1,node:m,state:"STARTED",docs:0,size:0})}}if(this.shards.set(e,c),!this.documents.has(e)){const d=new Map;for(let f=0;f<t;f++)d.set(f,[]);this.documents.set(e,d)}a.health=this.calculateIndexHealth(e),this.updateMetrics()}routeToShard(e,t){const n=this.indices.get(e);if(!n)return 0;let s=0;for(let a=0;a<t.length;a++){const c=t.charCodeAt(a);s=(s<<5)-s+c,s=s&s}return Math.abs(s)%n.shards}indexDocument(e,t,n,s){const a=Date.now(),c=this.indices.get(e);if(!c)return{operation:"index",index:e,id:t,document:n,routing:s,latency:Date.now()-a,success:!1,error:`Index ${e} does not exist`};const l=s||t,d=this.routeToShard(e,l),f={_id:t,_index:e,_source:n,_routing:s},p=this.documents.get(e),m=p.get(d)||[],y=m.findIndex(M=>M._id===t);y>=0?m[y]=f:m.push(f),p.set(d,m),this.documents.set(e,p),c.docs=this.getTotalDocsForIndex(e),c.size=this.getTotalSizeForIndex(e),c.health=this.calculateIndexHealth(e);const b=this.shards.get(e);for(const M of b)M.index===e&&M.shard===d&&M.primary&&(M.docs=m.length,M.size=m.length*1024);const S=this.calculateIndexLatency();return this.recordIndexOperation(S),this.updateMetrics(),{operation:"index",index:e,id:t,document:n,routing:s,latency:S,success:!0,took:S}}getDocument(e,t,n){const s=Date.now();if(!this.indices.get(e))return{operation:"get",index:e,id:t,routing:n,latency:Date.now()-s,success:!1,error:`Index ${e} does not exist`};const c=n||t,l=this.routeToShard(e,c),p=(this.documents.get(e).get(l)||[]).find(y=>y._id===t),m=this.calculateGetLatency();return this.recordGetOperation(m),this.updateMetrics(),p?{operation:"get",index:e,id:t,document:p._source,routing:n,latency:m,success:!0,took:m}:{operation:"get",index:e,id:t,routing:n,latency:m,success:!1,error:`Document ${t} not found`,took:m}}search(e,t){const n=Date.now(),s=this.indices.get(e);if(!s)return{operation:"search",index:e,query:t,latency:Date.now()-n,success:!1,error:`Index ${e} does not exist`};const a=this.documents.get(e);let c=[];for(let m=0;m<s.shards;m++){const y=a.get(m)||[];c=c.concat(y)}let l=c;if(t&&t.query){if(t.query.match_all)l=c;else if(t.query.match){const m=Object.keys(t.query.match)[0],y=t.query.match[m];y&&typeof y=="string"&&(l=c.filter(b=>{const S=b._source[m];return S&&String(S).toLowerCase().includes(y.toLowerCase())}))}}const d=t?.size||10;l=l.slice(0,d);const f=this.calculateSearchLatency(s.shards,l.length);this.recordSearchOperation(f,l.length),this.updateMetrics();const p={operation:"search",index:e,query:t,latency:f,success:!0,hits:l.length,took:f};return this.recentQueries.unshift(p),this.recentQueries.length>100&&(this.recentQueries=this.recentQueries.slice(0,100)),p}deleteDocument(e,t,n){const s=Date.now(),a=this.indices.get(e);if(!a)return{operation:"delete",index:e,id:t,routing:n,latency:Date.now()-s,success:!1,error:`Index ${e} does not exist`};const c=n||t,l=this.routeToShard(e,c),d=this.documents.get(e),f=d.get(l)||[],p=f.length,m=f.filter(S=>S._id!==t);d.set(l,m),this.documents.set(e,d),a.docs=this.getTotalDocsForIndex(e),a.size=this.getTotalSizeForIndex(e),a.health=this.calculateIndexHealth(e);const y=this.shards.get(e);for(const S of y)S.index===e&&S.shard===l&&S.primary&&(S.docs=m.length,S.size=m.length*1024);const b=this.calculateIndexLatency();return this.updateMetrics(),m.length===p?{operation:"delete",index:e,id:t,routing:n,latency:b,success:!1,error:`Document ${t} not found`,took:b}:{operation:"delete",index:e,id:t,routing:n,latency:b,success:!0,took:b}}executeQuery(e){const t=Date.now();try{let n;try{n=JSON.parse(e)}catch{const s=e.split(`
`);if(s.length>=2){const a=s[0].match(/^(GET|POST|PUT|DELETE)\s+(.+)/);if(a){const c=a[1],l=a[2].trim();if(c==="GET"&&l.includes("/_search")){n=s.length>1?JSON.parse(s.slice(1).join(`
`)):{query:{match_all:{}}};const d=l.match(/^\/([^\/]+)\/_search/),f=d?d[1]:"_all";return this.search(f,n)}else if(c==="GET"&&l.match(/\/[^\/]+\/_doc\/[^\/]+/)){const d=l.match(/\/([^\/]+)\/_doc\/([^\/]+)/);if(d)return this.getDocument(d[1],d[2])}}}return{operation:"search",query:e,latency:Date.now()-t,success:!1,error:"Invalid query format"}}return n.query||n.match_all?this.search("_all",n):{operation:"search",query:e,latency:Date.now()-t,success:!1,error:"Unsupported query format"}}catch(n){return{operation:"search",query:e,latency:Date.now()-t,success:!1,error:n instanceof Error?n.message:"Unknown error"}}}getMetrics(){return this.updateMetrics(),{...this.metrics}}getIndices(){return Array.from(this.indices.values())}getShards(e){return this.shards.get(e)||[]}getRecentQueries(e=10){return this.recentQueries.slice(0,e)}calculateIndexHealth(e){const t=this.shards.get(e)||[],n=t.filter(c=>c.state==="UNASSIGNED").length,s=t.filter(c=>c.state==="INITIALIZING").length,a=t.filter(c=>c.state==="RELOCATING").length;return n>0?"red":s>0||a>0?"yellow":"green"}calculateClusterHealth(){let e=!1,t=!1;for(const a of this.indices.values())a.health==="red"?e=!0:a.health==="yellow"&&(t=!0);const n=Array.from(this.nodes.values()).filter(a=>a.status==="up").length,s=this.nodes.size;return n===0||e?"red":n<s||t?"yellow":"green"}getTotalDocsForIndex(e){const t=this.documents.get(e);if(!t)return 0;let n=0;for(const s of t.values())n+=s.length;return n}getTotalSizeForIndex(e){const t=this.documents.get(e);if(!t)return 0;let n=0;for(const s of t.values())n+=s.length*1024;return n}calculateIndexLatency(){const t=this.metrics.totalDocs;return 5+Math.min(20,t/1e4)+Math.random()*5}calculateSearchLatency(e,t){const s=e*2,a=Math.min(50,t/100);return 10+s+a+Math.random()*10}calculateGetLatency(){return 2+Math.random()*3}recordIndexOperation(e){this.indexOperations.push({timestamp:Date.now(),latency:e}),this.indexOperations.length>500&&(this.indexOperations=this.indexOperations.slice(-500))}recordSearchOperation(e,t){this.searchOperations.push({timestamp:Date.now(),latency:e,hits:t}),this.searchOperations.length>500&&(this.searchOperations=this.searchOperations.slice(-500))}recordGetOperation(e){this.getOperations.push({timestamp:Date.now(),latency:e}),this.getOperations.length>500&&(this.getOperations=this.getOperations.slice(-500))}updateMetrics(){const e=Date.now(),t=1e3,n=this.indexOperations.filter(p=>e-p.timestamp<t),s=this.searchOperations.filter(p=>e-p.timestamp<t),a=this.getOperations.filter(p=>e-p.timestamp<t);this.metrics.indexOperationsPerSecond=n.length,this.metrics.searchOperationsPerSecond=s.length,n.length>0&&(this.metrics.averageIndexLatency=n.reduce((p,m)=>p+m.latency,0)/n.length),s.length>0&&(this.metrics.averageSearchLatency=s.reduce((p,m)=>p+m.latency,0)/s.length),a.length>0&&(this.metrics.averageGetLatency=a.reduce((p,m)=>p+m.latency,0)/a.length),this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(p=>p.status==="up").length,this.metrics.totalIndices=this.indices.size,this.metrics.totalDocs=Array.from(this.indices.values()).reduce((p,m)=>p+m.docs,0),this.metrics.totalSize=Array.from(this.indices.values()).reduce((p,m)=>p+m.size,0);let c=0,l=0,d=0,f=0;for(const p of this.shards.values())for(const m of p)if(m.primary)switch(m.state){case"STARTED":c++;break;case"RELOCATING":l++;break;case"INITIALIZING":d++;break;case"UNASSIGNED":f++;break}this.metrics.activeShards=c,this.metrics.relocatingShards=l,this.metrics.initializingShards=d,this.metrics.unassignedShards=f,this.metrics.clusterHealth=this.calculateClusterHealth();for(const p of this.indices.values())p.health=this.calculateIndexHealth(p.name);this.lastMetricsUpdate=e}}class Gk{buckets=new Map;objects=new Map;versions=new Map;operations=[];metrics=new Map;lifecycleTransitions=new Map;initialize(e){if(this.buckets.clear(),this.objects.clear(),this.versions.clear(),this.operations=[],this.metrics.clear(),this.lifecycleTransitions.clear(),e.buckets)for(const t of e.buckets)this.buckets.set(t.name,{...t}),this.objects.set(t.name,new Map),t.versioning&&this.versions.set(t.name,new Map),this.metrics.set(t.name,{bucket:t.name,objectCount:0,totalSize:0,versionsCount:0,putCount:0,getCount:0,deleteCount:0,listCount:0,errorCount:0,averageLatency:0}),this.lifecycleTransitions.set(t.name,new Map)}putObject(e,t,n,s,a,c){const l=Date.now(),d=this.buckets.get(e);if(!d)return{success:!1,etag:"",latency:Date.now()-l,error:`Bucket '${e}' does not exist`};const f=this.generateETag(t,s),p=d.versioning?`${Date.now()}-${Math.random().toString(36).substr(2,9)}`:void 0,m={key:t,bucket:e,size:s,lastModified:Date.now(),storageClass:"STANDARD",etag:f,contentType:c||"application/octet-stream",metadata:a||{},versionId:p,encryption:d.encryption},y=this.objects.get(e);if(d.versioning&&p){const C=this.versions.get(e),T=C.get(t)||[];T.push({versionId:p,object:m,isDeleteMarker:!1}),C.set(t,T),this.versions.set(e,C);const k=this.metrics.get(e);k.versionsCount=this.getTotalVersionsCount(e)}y.set(t,m),this.objects.set(e,y);const b=this.findMatchingLifecycleRule(d,t);if(b&&b.transitions&&b.transitions.length>0){const C=this.lifecycleTransitions.get(e),T=b.transitions[0],k=Date.now()+T.days*24*60*60*1e3;C.set(t,{currentClass:"STANDARD",transitionScheduled:k,targetClass:T.storageClass,ruleId:b.id,transitionIndex:0,allTransitions:b.transitions}),this.lifecycleTransitions.set(e,C)}else if(d.lifecycleEnabled&&d.lifecycleDays){const C=this.lifecycleTransitions.get(e),T=Date.now()+d.lifecycleDays*24*60*60*1e3;C.set(t,{currentClass:"STANDARD",transitionScheduled:T,targetClass:d.glacierEnabled?"GLACIER":"STANDARD_IA"}),this.lifecycleTransitions.set(e,C)}const S=this.metrics.get(e),M=y.get(t);M?S.totalSize-=M.size:S.objectCount++,S.totalSize+=s,S.putCount++;const E=this.calculatePutLatency(s);return this.recordOperation("PUT",e,t,!0,E),this.updateMetrics(e,E,!0),{success:!0,versionId:p,etag:f,latency:E}}getObject(e,t,n){const s=Date.now(),a=this.buckets.get(e);if(!a)return{success:!1,latency:Date.now()-s,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e);if(a.versioning&&n){const m=(this.versions.get(e).get(t)||[]).find(b=>b.versionId===n);if(!m||m.isDeleteMarker){const b=this.calculateGetLatency(0);return this.recordOperation("GET",e,t,!1,b),this.updateMetrics(e,b,!1),{success:!1,latency:b,error:m?.isDeleteMarker?"Object version is a delete marker":`Object version '${n}' not found`}}if(m.object.storageClass==="GLACIER"||m.object.storageClass==="DEEP_ARCHIVE"){const b=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",e,t,!1,b),this.updateMetrics(e,b,!1),{success:!1,latency:b,error:`Object is archived in ${m.object.storageClass}. Restore operation required.`}}const y=this.calculateGetLatency(m.object.size);return this.recordOperation("GET",e,t,!0,y),this.updateMetrics(e,y,!0),{success:!0,object:m.object,latency:y}}const l=c.get(t);if(!l){const f=this.calculateGetLatency(0);return this.recordOperation("GET",e,t,!1,f),this.updateMetrics(e,f,!1),{success:!1,latency:f,error:`Object '${t}' not found`}}if(l.storageClass==="GLACIER"||l.storageClass==="DEEP_ARCHIVE"){const f=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",e,t,!1,f),this.updateMetrics(e,f,!1),{success:!1,latency:f,error:`Object is archived in ${l.storageClass}. Restore operation required.`}}const d=this.calculateGetLatency(l.size);return this.recordOperation("GET",e,t,!0,d),this.updateMetrics(e,d,!0),{success:!0,object:l,latency:d}}deleteObject(e,t,n){const s=Date.now(),a=this.buckets.get(e);if(!a)return{success:!1,latency:Date.now()-s,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e),l=c.get(t);if(!l){const m=this.calculateDeleteLatency();return this.recordOperation("DELETE",e,t,!1,m),this.updateMetrics(e,m,!1),{success:!1,latency:m,error:`Object '${t}' not found`}}if(a.versioning){const m=this.versions.get(e),y=m.get(t)||[],b=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;y.push({versionId:b,object:{...l},isDeleteMarker:!0}),m.set(t,y),this.versions.set(e,m),c.delete(t),this.objects.set(e,c);const S=this.metrics.get(e);S.versionsCount=this.getTotalVersionsCount(e),S.deleteCount++;const M=this.calculateDeleteLatency();return this.recordOperation("DELETE",e,t,!0,M),this.updateMetrics(e,M,!0),{success:!0,deleteMarker:!0,latency:M}}const d=l.size;c.delete(t),this.objects.set(e,c);const f=this.metrics.get(e);f.objectCount--,f.totalSize-=d,f.deleteCount++;const p=this.calculateDeleteLatency();return this.recordOperation("DELETE",e,t,!0,p),this.updateMetrics(e,p,!0),{success:!0,latency:p}}listObjects(e,t,n){const s=Date.now();if(!this.buckets.get(e))return{success:!1,objects:[],latency:Date.now()-s,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e);let l=Array.from(c.values());t&&(l=l.filter(p=>p.key.startsWith(t))),l.sort((p,m)=>p.key.localeCompare(m.key)),n&&(l=l.slice(0,n));const d=this.calculateListLatency(l.length);this.recordOperation("LIST",e,void 0,!0,d);const f=this.metrics.get(e);return f.listCount++,this.updateMetrics(e,d,!0),{success:!0,objects:l,latency:d}}headObject(e,t){const n=Date.now();if(!this.buckets.get(e))return{success:!1,latency:Date.now()-n,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e).get(t);if(!c){const d=this.calculateHeadLatency();return this.recordOperation("HEAD",e,t,!1,d),this.updateMetrics(e,d,!1),{success:!1,latency:d,error:`Object '${t}' not found`}}const l=this.calculateHeadLatency();return this.recordOperation("HEAD",e,t,!0,l),this.updateMetrics(e,l,!0),{success:!0,object:c,latency:l}}processLifecycleTransitions(e=Date.now()){for(const[t,n]of this.lifecycleTransitions.entries()){const s=this.buckets.get(t);if(!(s&&(s.lifecycleEnabled||s.lifecycleRules&&s.lifecycleRules.some(l=>l.status==="Enabled"))))continue;const c=this.objects.get(t);for(const[l,d]of n.entries())if(e>=d.transitionScheduled){const f=c.get(l);if(f&&f.storageClass===d.currentClass)if(f.storageClass=d.targetClass,c.set(l,f),this.objects.set(t,c),d.ruleId&&d.allTransitions&&d.transitionIndex!==void 0){const p=d.transitionIndex+1;if(p<d.allTransitions.length){const m=d.allTransitions[p],y=e+m.days*24*60*60*1e3;n.set(l,{currentClass:d.targetClass,transitionScheduled:y,targetClass:m.storageClass,ruleId:d.ruleId,transitionIndex:p,allTransitions:d.allTransitions})}else{const m=this.findLifecycleRuleById(s,d.ruleId);if(m?.expiration?.days){const y=e+m.expiration.days*24*60*60*1e3;n.set(l,{currentClass:d.targetClass,transitionScheduled:y,targetClass:d.targetClass,ruleId:d.ruleId,expiration:!0})}else n.delete(l)}}else if(s.glacierEnabled&&s.glacierDays&&d.targetClass==="STANDARD_IA"){const p=e+s.glacierDays*24*60*60*1e3;n.set(l,{currentClass:"STANDARD_IA",transitionScheduled:p,targetClass:"GLACIER"})}else n.delete(l);else f||n.delete(l)}this.lifecycleTransitions.set(t,n)}this.processExpirations(e)}processExpirations(e){for(const[t,n]of this.lifecycleTransitions.entries()){if(!this.buckets.get(t))continue;const a=this.objects.get(t),c=[];for(const[l,d]of n.entries())d.expiration&&e>=d.transitionScheduled&&a.has(l)&&c.push(l);for(const l of c){const d=a.get(l);if(d){const f=this.metrics.get(t);f&&(f.objectCount=Math.max(0,f.objectCount-1),f.totalSize=Math.max(0,f.totalSize-d.size))}a.delete(l),n.delete(l)}this.objects.set(t,a),this.lifecycleTransitions.set(t,n)}}findMatchingLifecycleRule(e,t){return!e.lifecycleRules||e.lifecycleRules.length===0?void 0:e.lifecycleRules.filter(s=>s.status==="Enabled").filter(s=>!s.prefix||t.startsWith(s.prefix)).sort((s,a)=>{const c=s.prefix||"";return(a.prefix||"").length-c.length})[0]}findLifecycleRuleById(e,t){if(e.lifecycleRules)return e.lifecycleRules.find(n=>n.id===t)}findLifecycleRuleById(e,t){if(e.lifecycleRules)return e.lifecycleRules.find(n=>n.id===t)}getBucketMetrics(e){return this.metrics.get(e)}getAllBucketMetrics(){return new Map(this.metrics)}getTotalStorageSize(){let e=0;for(const t of this.metrics.values())e+=t.totalSize;return e}getTotalObjectCount(){let e=0;for(const t of this.metrics.values())e+=t.objectCount;return e}generateETag(e,t){const n=`${e}_${t}_${Date.now()}`;let s=0;for(let a=0;a<n.length;a++){const c=n.charCodeAt(a);s=(s<<5)-s+c,s=s&s}return Math.abs(s).toString(16)}calculatePutLatency(e){const n=e/1024*.1,s=(Math.random()-.5)*10;return Math.max(10,50+n+s)}calculateGetLatency(e){const n=e/1024*.15,s=(Math.random()-.5)*10;return Math.max(10,30+n+s)}calculateDeleteLatency(){const t=(Math.random()-.5)*5;return Math.max(5,20+t)}calculateListLatency(e){const n=e*.01,s=(Math.random()-.5)*10;return Math.max(20,40+n+s)}calculateHeadLatency(){const t=(Math.random()-.5)*5;return Math.max(5,15+t)}calculateGlacierRestoreLatency(){return 5e3}recordOperation(e,t,n,s,a){this.operations.push({operation:e,bucket:t,key:n,success:s,latency:a,timestamp:Date.now()}),this.operations.length>1e3&&this.operations.shift()}updateMetrics(e,t,n){const s=this.metrics.get(e);if(!s)return;const a=s.putCount+s.getCount+s.deleteCount+s.listCount;a>0?s.averageLatency=(s.averageLatency*(a-1)+t)/a:s.averageLatency=t,n||s.errorCount++,s.lastOperation=Date.now()}getTotalVersionsCount(e){const t=this.versions.get(e);if(!t)return 0;let n=0;for(const s of t.values())n+=s.length;return n}}class Kk{connections=new Map;config;connectionCounter=0;queryHistory=[];MAX_HISTORY=1e3;constructor(e){this.config={maxConnections:e.maxConnections||100,minConnections:e.minConnections||0,idleTimeout:e.idleTimeout||3e5,maxLifetime:e.maxLifetime||36e5,connectionTimeout:e.connectionTimeout||5e3}}acquireConnection(e){const t=Date.now();this.cleanupIdleConnections(t);for(const[n,s]of this.connections.entries())if(s.status==="idle")return s.status="active",s.lastActivity=t,s.currentQuery=e,s.queryCount++,n;return this.connections.size<this.config.maxConnections?this.createConnection(e,t):null}releaseConnection(e,t){const n=this.connections.get(e);n&&(n.status="idle",n.lastActivity=Date.now(),n.currentQuery=void 0,t!==void 0&&this.recordQuery(t))}terminateConnection(e){const t=this.connections.get(e);t&&(t.status="terminated",this.connections.delete(e))}createConnection(e,t){const n=`conn_${++this.connectionCounter}_${t}`,s={id:n,status:"active",createdAt:t,lastActivity:t,queryCount:1,currentQuery:e};return this.connections.set(n,s),n}cleanupIdleConnections(e){const t=[];for(const[n,s]of this.connections.entries())s.status==="idle"&&(e-s.lastActivity>this.config.idleTimeout||e-s.createdAt>this.config.maxLifetime)&&t.push(n);for(const n of t)this.connections.delete(n)}recordQuery(e){const t=Date.now();this.queryHistory.push({timestamp:t,duration:e}),this.queryHistory.length>this.MAX_HISTORY&&this.queryHistory.shift()}getMetrics(){const e=Date.now();let t=0,n=0,s=0;for(const y of this.connections.values())switch(y.status){case"active":t++;break;case"idle":n++;break;case"waiting":s++;break}const a=this.connections.size,c=a>0?t/this.config.maxConnections:0,l=this.queryHistory.filter(y=>e-y.timestamp<6e4),d=l.length>0?l.reduce((y,b)=>y+b.duration,0)/l.length:0,p=this.queryHistory.filter(y=>e-y.timestamp<1e3).length,m=a>=this.config.maxConnections?this.config.connectionTimeout/2:0;return{totalConnections:a,activeConnections:t,idleConnections:n,waitingConnections:s,utilization:c,averageQueryTime:d,queriesPerSecond:p,connectionWaitTime:m}}getConnection(e){return this.connections.get(e)}getAllConnections(){return Array.from(this.connections.values())}updateConfig(e){if(this.config={...this.config,...e},e.maxConnections!==void 0&&e.maxConnections<this.connections.size){const t=this.connections.size-e.maxConnections,n=Array.from(this.connections.entries()).filter(([s,a])=>a.status==="idle").slice(0,t);for(const[s]of n)this.terminateConnection(s)}}reset(){this.connections.clear(),this.connectionCounter=0,this.queryHistory=[]}}class Yk{static exportMetrics(e,t){const n=[],s=this.buildLabels(e,t),a=t.timestamp||Date.now();if(n.push("# HELP component_throughput_total Component throughput in operations per second"),n.push("# TYPE component_throughput_total gauge"),n.push(`component_throughput_total{${s}} ${t.throughput||0} ${a}`),n.push("# HELP component_latency_ms Component latency in milliseconds"),n.push("# TYPE component_latency_ms gauge"),n.push(`component_latency_ms{${s}} ${t.latency||0} ${a}`),t.latencyP50!==void 0&&(n.push("# HELP component_latency_p50_ms Component 50th percentile latency in milliseconds"),n.push("# TYPE component_latency_p50_ms gauge"),n.push(`component_latency_p50_ms{${s}} ${t.latencyP50} ${a}`)),t.latencyP99!==void 0&&(n.push("# HELP component_latency_p99_ms Component 99th percentile latency in milliseconds"),n.push("# TYPE component_latency_p99_ms gauge"),n.push(`component_latency_p99_ms{${s}} ${t.latencyP99} ${a}`)),n.push("# HELP component_error_rate Component error rate (0-1)"),n.push("# TYPE component_error_rate gauge"),n.push(`component_error_rate{${s}} ${t.errorRate||0} ${a}`),n.push("# HELP component_utilization Component utilization (0-1)"),n.push("# TYPE component_utilization gauge"),n.push(`component_utilization{${s}} ${t.utilization||0} ${a}`),t.customMetrics)for(const[c,l]of Object.entries(t.customMetrics)){const d=this.sanitizeMetricName(c);n.push(`# HELP component_${d} Component custom metric: ${c}`),n.push(`# TYPE component_${d} gauge`),n.push(`component_${d}{${s}} ${l} ${a}`)}return n.join(`
`)+`
`}static buildLabels(e,t){const n=[];n.push(`component_id="${this.escapeLabelValue(e.id)}"`),n.push(`component_type="${this.escapeLabelValue(e.type)}"`),e.data.label&&n.push(`component_name="${this.escapeLabelValue(e.data.label)}"`);const s=e.data.config||{};return s.environment&&n.push(`environment="${this.escapeLabelValue(String(s.environment))}"`),s.namespace&&n.push(`namespace="${this.escapeLabelValue(String(s.namespace))}"`),n.join(",")}static escapeLabelValue(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}static sanitizeMetricName(e){return e.replace(/[^a-zA-Z0-9_:]/g,"_").replace(/^[^a-zA-Z]/,"_")}static exportAllMetrics(e,t){const n=[];for(const s of e){const a=t.get(s.id);a&&n.push(this.exportMetrics(s,a))}return n.join(`
`)}static exportEndpointMetrics(e,t){return t?this.exportMetrics(e,t):""}}class Wk{config=null;targetStatuses=new Map;scrapedMetrics=new Map;lastScrapeTimes=new Map;prometheusMetrics={scrapeRequestsTotal:0,scrapeErrorsTotal:0,scrapeDurationTotal:0,targetsUp:0,targetsDown:0,samplesScraped:0};initializeConfig(e){const t=e.data.config||{},n=typeof t.scrapeInterval=="number"?`${t.scrapeInterval/1e3}s`:t.scrapeInterval||"15s",s=typeof t.evaluationInterval=="number"?`${t.evaluationInterval/1e3}s`:t.evaluationInterval||"15s";this.config={global:{scrape_interval:n,evaluation_interval:s,external_labels:{prometheus:"archiphoenix"}},scrape_configs:this.buildScrapeConfigs(t),alerting:t.enableAlertmanager?{alertmanagers:[{static_configs:[{targets:[t.alertmanagerUrl||"http://alertmanager:9093"].map(a=>{const c=a.match(/^https?:\/\/([^\/]+)/);return c?c[1]:a})}]}]}:void 0,remote_write:t.enableRemoteWrite&&t.remoteWrite?t.remoteWrite.map(a=>({url:a.url})):void 0},this.initializeTargetStatuses()}buildScrapeConfigs(e){if(e.scrape_configs&&Array.isArray(e.scrape_configs))return e.scrape_configs.map(s=>({job_name:s.job_name,scrape_interval:s.scrape_interval,scrape_timeout:s.scrape_timeout,metrics_path:s.metrics_path,static_configs:s.static_configs||[]}));const t=[],n=e.scrapeInterval||"15s";if(e.targets&&Array.isArray(e.targets)){const s=new Map;for(const a of e.targets){const c=a.job||"default";s.has(c)||s.set(c,[]),s.get(c).push(a)}for(const[a,c]of s.entries()){const l=c[0],d=l.interval||n,f=l.metricsPath||"/metrics",p=c.map(m=>{try{const y=new URL(m.endpoint);return`${y.hostname}${y.port?":"+y.port:""}`}catch{const y=m.endpoint.match(/^https?:\/\/([^\/]+)/);return y?y[1]:m.endpoint}});t.push({job_name:a,scrape_interval:d,metrics_path:f,static_configs:[{targets:p,labels:l.labels||{}}]})}}return t}initializeTargetStatuses(){if(this.targetStatuses.clear(),!!this.config){for(const e of this.config.scrape_configs)if(e.static_configs)for(const t of e.static_configs)for(const n of t.targets){const s=e.metrics_path?`http://${n}${e.metrics_path}`:`http://${n}/metrics`,a=`${e.job_name}:${n}`;this.targetStatuses.set(a,{job:e.job_name,endpoint:s,lastScrape:0,lastSuccess:null,lastError:null,scrapeDuration:null,up:!1,labels:t.labels})}}}performScraping(e,t,n){if(this.config){this.parseDuration(this.config.global.scrape_interval||"15s"),this.prometheusMetrics.targetsUp=0,this.prometheusMetrics.targetsDown=0;for(const[s,a]of this.targetStatuses.entries()){const c=this.lastScrapeTimes.get(s)||0,l=this.getScrapeIntervalForTarget(a.job),d=this.parseDuration(l);e-c>=d&&(this.scrapeTarget(s,a,e,t,n),this.lastScrapeTimes.set(s,e)),a.up?this.prometheusMetrics.targetsUp++:this.prometheusMetrics.targetsDown++}}}scrapeTarget(e,t,n,s,a){const c=performance.now();this.prometheusMetrics.scrapeRequestsTotal++;try{const l=this.findNodeByEndpoint(t.endpoint,s);if(!l)throw new Error(`Target not found: ${t.endpoint}`);const d=a.get(l.id);if(!d)throw new Error(`Metrics not available for component: ${l.id}`);const f=Yk.exportMetrics(l,d);t.lastScrape=n,t.lastSuccess=n,t.lastError=null,t.up=!0;const p=performance.now()-c;t.scrapeDuration=p,this.prometheusMetrics.scrapeDurationTotal+=p,this.prometheusMetrics.samplesScraped+=this.countSamples(f),this.scrapedMetrics.set(e,d)}catch(l){const d=performance.now()-c;t.lastScrape=n,t.lastSuccess=null,t.lastError=l instanceof Error?l.message:String(l),t.up=!1,t.scrapeDuration=d,this.prometheusMetrics.scrapeErrorsTotal++}}findNodeByEndpoint(e,t){try{const n=new URL(e),s=n.hostname,a=n.port?parseInt(n.port):null;for(const c of t){const l=c.data.config||{},d=l.port||l.metricsPort||l.metrics?.port;if(c.data.label?.toLowerCase().replace(/\s+/g,"-")===s||a&&d===a)return c}}catch{}return null}getScrapeIntervalForTarget(e){return this.config&&(this.config.scrape_configs.find(n=>n.job_name===e)?.scrape_interval||this.config.global.scrape_interval)||"15s"}parseDuration(e){if(typeof e=="number")return e;if(typeof e!="string")return 15e3;const t=e.match(/^(\d+)([smhd])$/);if(!t)return 15e3;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 15e3}}countSamples(e){return e.split(`
`).filter(t=>t.trim()&&!t.startsWith("#")).length}getTargetStatuses(){return Array.from(this.targetStatuses.values())}getPrometheusMetrics(){return{...this.prometheusMetrics}}calculateLoad(){const e=this.prometheusMetrics.scrapeRequestsTotal,t=this.prometheusMetrics.scrapeErrorsTotal,n=this.prometheusMetrics.scrapeDurationTotal,s=this.prometheusMetrics.samplesScraped,a=this.targetStatuses.size,c=this.parseDuration(this.config?.global.scrape_interval||"15s"),l=a>0?1e3/c*a:0,d=e>0?n/e:0,f=e>0?t/e:0,p=l*(s/e||0);return{scrapeRequestsPerSecond:l,averageScrapeDuration:d,errorRate:f,samplesPerSecond:p}}}class Xk{config=null;lastRefreshTimes=new Map;lastAlertEvaluationTimes=new Map;grafanaMetrics={queriesPerSecond:0,dashboardRefreshesPerSecond:0,alertEvaluationsPerSecond:0,datasourceErrors:0,activeDashboards:0,activePanels:0,totalQueries:0,cachedQueries:0,queryLatency:0,renderingLatency:0};queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(e){const t=e.data.config||{};this.config=t,this.initializeRefreshTimes(),this.initializeAlertEvaluationTimes()}initializeRefreshTimes(){if(this.lastRefreshTimes.clear(),!this.config?.dashboards)return;const e=this.normalizeDashboards(this.config.dashboards);for(const t of e)this.lastRefreshTimes.set(t.id,0)}initializeAlertEvaluationTimes(){if(this.lastAlertEvaluationTimes.clear(),!(!this.config?.alerts||!this.config.enableAlerting))for(const e of this.config.alerts)this.lastAlertEvaluationTimes.set(e.id,0)}normalizeDashboards(e){return!e||!Array.isArray(e)?[]:e.map(t=>{if(t&&typeof t=="object"){if(typeof t.panels=="number")return{id:t.id||String(Date.now()),name:t.name||"Dashboard",panels:[],tags:Array.isArray(t.tags)?t.tags:[],refresh:t.refresh||"30s"};if(Array.isArray(t.panels))return{id:t.id||String(Date.now()),name:t.name||"Dashboard",panels:t.panels.map(n=>({id:n.id||`panel-${Date.now()}`,title:n.title||"Panel",type:n.type||"graph",datasource:n.datasource||"Prometheus",queries:Array.isArray(n.queries)?n.queries:[{refId:"A",expr:"up"}],gridPos:n.gridPos||{x:0,y:0,w:12,h:8}})),tags:Array.isArray(t.tags)?t.tags:[],variables:t.variables,refresh:t.refresh||"30s",timeRange:t.timeRange}}return t}).filter(t=>t&&typeof t=="object"&&t.id)}performUpdate(e,t=!0,n){this.config&&(this.updateDashboards(e,t,n),this.config.enableAlerting&&this.evaluateAlerts(e,t),this.updateMetrics())}updateDashboards(e,t,n){if(!this.config?.dashboards)return;const s=this.normalizeDashboards(this.config.dashboards);let a=0,c=0;for(const l of s){const d=this.parseDuration(l.refresh||"30s"),f=this.lastRefreshTimes.get(l.id)||0;if(e-f>=d){this.lastRefreshTimes.set(l.id,e);for(const p of l.panels){const m=p.datasource,y=m&&this.isLokiDatasource(m);for(const M of p.queries){a++;const E=this.simulateQueryExecution(M,t,y,n);c+=E,this.queryLatencyHistory.push(E),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift()}const b=this.simulatePanelRendering(p),S=this.grafanaMetrics.renderingLatency;this.grafanaMetrics.renderingLatency=S*.9+b*.1}}}this.grafanaMetrics.totalQueries+=a,a>0&&(this.grafanaMetrics.queryLatency=c/a)}isLokiDatasource(e){if(!this.config?.datasources)return!1;const n=(Array.isArray(this.config.datasources)?this.config.datasources:[]).find(s=>typeof s=="string"?s===e:s.name===e);return typeof n=="object"&&n.type?n.type==="loki":!1}evaluateAlerts(e,t){if(this.config?.alerts)for(const n of this.config.alerts){const s=this.parseDuration(n.for||"1m"),a=this.lastAlertEvaluationTimes.get(n.id)||0;e-a>=s&&(this.lastAlertEvaluationTimes.set(n.id,e),this.simulateQueryExecution({refId:"A",expr:n.condition.query},t),t||this.grafanaMetrics.datasourceErrors++)}}simulateQueryExecution(e,t,n=!1,s){if(n&&s)try{const d=Date.now()-36e5,f=Date.now(),p=s(e.expr,d,f,100);return p.success||this.grafanaMetrics.datasourceErrors++,p.latency}catch{return this.grafanaMetrics.datasourceErrors++,1e3}if(!t)return this.grafanaMetrics.datasourceErrors++,1e3;let a=50;const c=this.estimateQueryComplexity(e.expr);a+=c*10;const l=(Math.random()-.5)*20;return Math.max(10,a+l)}estimateQueryComplexity(e){if(!e)return 0;let t=1;e.includes("[")&&(t+=2);const n=["sum","avg","max","min","count","rate","irate","increase"];for(const a of n)e.toLowerCase().includes(a)&&(t+=1);const s=(e.match(/\|/g)||[]).length;return t+=s,t}simulatePanelRendering(e){const n={stat:5,gauge:10,piechart:15,bargraph:20,table:25,graph:30}[e.type]||20,s=Math.sqrt(e.queries.length);return n*s}updateMetrics(){if(!this.config)return;const e=this.normalizeDashboards(this.config.dashboards);this.grafanaMetrics.activeDashboards=e.length,this.grafanaMetrics.activePanels=e.reduce((s,a)=>s+a.panels.length,0);let t=0,n=0;for(const s of e){const c=1e3/this.parseDuration(s.refresh||"30s");n+=c;const l=s.panels.reduce((d,f)=>d+f.queries.length,0);t+=c*l}if(this.grafanaMetrics.queriesPerSecond=t,this.grafanaMetrics.dashboardRefreshesPerSecond=n,this.config.enableAlerting&&this.config.alerts){let s=0;for(const a of this.config.alerts){const l=1e3/this.parseDuration(a.for||"1m");s+=l}this.grafanaMetrics.alertEvaluationsPerSecond=s}else this.grafanaMetrics.alertEvaluationsPerSecond=0;if(this.queryLatencyHistory.length>0){const s=this.queryLatencyHistory.reduce((a,c)=>a+c,0)/this.queryLatencyHistory.length;this.grafanaMetrics.queryLatency=s}}parseDuration(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 3e4;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 3e4}}getGrafanaMetrics(){return{...this.grafanaMetrics}}calculateLoad(){const e=this.grafanaMetrics,t=.1,n=Math.min(.7,e.queriesPerSecond/100),s=Math.min(.1,e.alertEvaluationsPerSecond/10),a=Math.min(.1,e.activePanels/100),c=Math.min(.95,t+n+s+a),l=.2,d=Math.min(.4,e.activeDashboards/50),f=Math.min(.3,e.cachedQueries/1e3),p=Math.min(.95,l+d+f),m=e.totalQueries+e.alertEvaluationsPerSecond,y=m>0?e.datasourceErrors/m:0;return{queriesPerSecond:e.queriesPerSecond,dashboardRefreshesPerSecond:e.dashboardRefreshesPerSecond,alertEvaluationsPerSecond:e.alertEvaluationsPerSecond,averageQueryLatency:e.queryLatency,averageRenderingLatency:e.renderingLatency,errorRate:y,cpuUtilization:c,memoryUtilization:p}}getActiveDatasources(){return this.config?.datasources?this.config.datasources.length>0&&typeof this.config.datasources[0]=="string"?this.config.datasources.map(e=>({name:e,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:e===this.config.datasources[0]})):this.config.datasources.filter(e=>e&&typeof e=="object"&&e.name):[]}isPrometheusAvailable(e){return!(!e||!this.getActiveDatasources().find(s=>s.type==="prometheus"))}}class Jk{config=null;streams=new Map;queryStatuses=new Map;lastIngestionTimes=new Map;lokiMetrics={ingestionRequestsTotal:0,ingestionErrorsTotal:0,ingestionLinesTotal:0,ingestionBytesTotal:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,activeStreams:0,totalStorageSize:0,retentionDeletions:0};ingestionLatencyHistory=[];queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(e){const t=e.data.config||{};this.config={serverUrl:t.serverUrl||"http://loki:3100",retentionPeriod:t.retentionPeriod||"168h",maxStreams:t.maxStreams||1e4,maxLineSize:t.maxLineSize||256e3,enableCompression:t.enableCompression??!0,compressionType:t.compressionType||"gzip",enableAuth:t.enableAuth??!1,enableMultiTenancy:t.enableMultiTenancy??!1,tenants:t.tenants||[],ingestionRateLimit:t.ingestionRateLimit,queryRateLimit:t.queryRateLimit},this.initializeStreamsFromConfig(t),this.initializeQueriesFromConfig(t)}initializeStreamsFromConfig(e){if(e.streams&&Array.isArray(e.streams))for(const t of e.streams){const n=this.getStreamKey(t.labels||{}),s=[];if(t.entries&&Array.isArray(t.entries))for(const c of t.entries)s.push({timestamp:c.timestamp||Date.now().toString()+"000000",line:c.line||""});const a=t.size?t.size*1024*1024*1024:0;this.streams.set(n,{labels:t.labels||{},entries:s,size:a,lastEntryTime:Date.now()})}}initializeQueriesFromConfig(e){if(e.queries&&Array.isArray(e.queries))for(const t of e.queries){const n=t.id||`query-${Date.now()}-${Math.random()}`;this.queryStatuses.set(n,{id:n,query:t.query||"",lastExecution:0,lastSuccess:null,lastError:null,executionDuration:null,resultsCount:t.results||0,success:!0})}}processIngestion(e,t){if(!this.config)return{success:!1,error:"Loki not configured",ingestedLines:0,ingestedBytes:0};const n=performance.now();this.lokiMetrics.ingestionRequestsTotal++;try{if(this.config.ingestionRateLimit){const l=t||"default",d=this.lastIngestionTimes.get(l)||0,f=Date.now();f-d<1e3,this.lastIngestionTimes.set(l,f)}let s=0,a=0;for(const l of e){const d=this.getStreamKey(l.stream);if(!this.streams.has(d)&&this.streams.size>=(this.config.maxStreams||1e4)){this.lokiMetrics.ingestionErrorsTotal++;continue}let f=this.streams.get(d);f||(f={labels:l.stream,entries:[],size:0,lastEntryTime:Date.now()},this.streams.set(d,f));for(const[p,m]of l.values){const y=new Blob([m]).size;if(y>(this.config.maxLineSize||256e3)){this.lokiMetrics.ingestionErrorsTotal++;continue}f.entries.push({timestamp:p,line:m}),f.size+=y,f.lastEntryTime=Math.max(f.lastEntryTime,this.parseTimestamp(p)),s++,a+=y}if(this.config.enableCompression){const p=this.getCompressionRatio(this.config.compressionType||"gzip");f.size=Math.floor(f.size*p)}}this.lokiMetrics.ingestionLinesTotal+=s,this.lokiMetrics.ingestionBytesTotal+=a,this.lokiMetrics.totalStorageSize+=a,this.lokiMetrics.activeStreams=this.streams.size;const c=performance.now()-n;return this.ingestionLatencyHistory.push(c),this.ingestionLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.ingestionLatencyHistory.shift(),{success:!0,ingestedLines:s,ingestedBytes:a}}catch(s){return performance.now()-n,this.lokiMetrics.ingestionErrorsTotal++,{success:!1,error:s instanceof Error?s.message:String(s),ingestedLines:0,ingestedBytes:0}}}executeQuery(e,t,n,s){if(!this.config)return{success:!1,error:"Loki not configured",latency:0,resultsCount:0};const a=performance.now();this.lokiMetrics.queryRequestsTotal++;try{this.config.queryRateLimit;const c=this.parseLogQL(e),l=this.executeLogQLQuery(c,t,n,s),d=performance.now()-a;return this.lokiMetrics.queryDurationTotal+=d,this.queryLatencyHistory.push(d),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift(),{success:!0,result:l,latency:d,resultsCount:l.reduce((f,p)=>f+p.values.length,0)}}catch(c){const l=performance.now()-a;return this.lokiMetrics.queryErrorsTotal++,{success:!1,error:c instanceof Error?c.message:String(c),latency:l,resultsCount:0}}}parseLogQL(e){const t={},n=[],s=[],a=e.match(/^\{([^}]+)\}/);if(a){const b=a[1].matchAll(/(\w+)=["']([^"']+)["']/g);for(const S of b)t[S[1]]=S[2]}const c=e.match(/\|\s*=\s*["']([^"']+)["']/);c&&n.push({type:"contains",pattern:c[1]});const l=e.match(/!\s*=\s*["']([^"']+)["']/);l&&n.push({type:"not_contains",pattern:l[1]});const d=e.match(/\|\s*~\s*["']([^"']+)["']/);d&&n.push({type:"regex",pattern:d[1]});const f=e.matchAll(/\|\s*(\w+)\s*(=|=~|!=|!~)\s*["']([^"']+)["']/g);for(const y of f)s.push({label:y[1],operator:y[2],value:y[3]});let p;const m=e.match(/\|\s*(\w+)\(([^)]*)\)/);return m&&(p={function:m[1],params:m[2]?m[2].split(",").map(y=>y.trim()):[]}),{streamSelector:t,lineFilters:n,labelFilters:s,aggregation:p}}executeLogQLQuery(e,t,n,s){const a=[],c=Date.now(),l=t||c-36e5,d=n||c;for(const[f,p]of this.streams.entries()){let m=!0;for(const[S,M]of Object.entries(e.streamSelector))if(p.labels[S]!==M){m=!1;break}if(!m)continue;let b=p.entries.filter(S=>{const M=this.parseTimestamp(S.timestamp);return M>=l&&M<=d});for(const S of e.lineFilters)b=b.filter(M=>{switch(S.type){case"contains":return M.line.includes(S.pattern);case"not_contains":return!M.line.includes(S.pattern);case"regex":try{return new RegExp(S.pattern).test(M.line)}catch{return!1}}});for(const S of e.labelFilters){const M=p.labels[S.label];if(M===void 0){b=[];break}switch(S.operator){case"=":M!==S.value&&(b=[]);break;case"!=":M===S.value&&(b=[]);break;case"=~":try{new RegExp(S.value).test(M)||(b=[])}catch{b=[]}break;case"!~":try{new RegExp(S.value).test(M)&&(b=[])}catch{}break}}if(s&&b.length>s&&(b=b.slice(0,s)),e.aggregation){const S=this.applyAggregation(e.aggregation,b);a.push({stream:p.labels,values:[[Date.now().toString()+"000000",S.toString()]]})}else b.length>0&&a.push({stream:p.labels,values:b.map(S=>[S.timestamp,S.line])})}return a}applyAggregation(e,t){switch(e.function.toLowerCase()){case"rate":if(t.length<2)return 0;const n=this.parseTimestamp(t[0].timestamp),a=(this.parseTimestamp(t[t.length-1].timestamp)-n)/1e3;return a>0?t.length/a:0;case"count_over_time":return t.length;case"sum":return t.reduce((l,d)=>{const f=parseFloat(d.line);return l+(isNaN(f)?0:f)},0);case"avg":case"average":const c=t.map(l=>parseFloat(l.line)).filter(l=>!isNaN(l));return c.length>0?c.reduce((l,d)=>l+d,0)/c.length:0;default:return t.length}}performRetention(e){if(!this.config)return;const t=this.parseDuration(this.config.retentionPeriod||"168h"),n=e-t;let s=0,a=0;for(const[c,l]of this.streams.entries()){const d=l.entries.length;l.entries=l.entries.filter(f=>this.parseTimestamp(f.timestamp)>n),l.entries.length<d&&(s+=d-l.entries.length,l.size=l.entries.reduce((f,p)=>f+new Blob([p.line]).size,0),a+=l.size),l.entries.length===0&&this.streams.delete(c)}this.lokiMetrics.retentionDeletions+=s,this.lokiMetrics.totalStorageSize=Math.max(0,this.lokiMetrics.totalStorageSize-a),this.lokiMetrics.activeStreams=this.streams.size}getStreams(){return Array.from(this.streams.values())}getLokiMetrics(){return{...this.lokiMetrics}}calculateLoad(){const e=this.lokiMetrics.ingestionRequestsTotal,t=this.lokiMetrics.ingestionErrorsTotal,n=this.lokiMetrics.ingestionLinesTotal,s=this.lokiMetrics.ingestionBytesTotal,a=this.lokiMetrics.queryRequestsTotal,c=this.lokiMetrics.queryErrorsTotal,l=this.lokiMetrics.queryDurationTotal,d=this.ingestionLatencyHistory.length>0?this.ingestionLatencyHistory.reduce((C,T)=>C+T,0)/this.ingestionLatencyHistory.length:0,f=this.queryLatencyHistory.length>0?this.queryLatencyHistory.reduce((C,T)=>C+T,0)/this.queryLatencyHistory.length:a>0?l/a:0,p=e>0?t/e:0,m=a>0?c/a:0,y=n>0?n/100:0,b=s>0?s/100:0,S=a>0?a/100:0,M=(this.config?.maxStreams||1e4)*100*1024*1024,E=Math.min(1,this.lokiMetrics.totalStorageSize/M);return{ingestionLinesPerSecond:y,ingestionBytesPerSecond:b,averageIngestionLatency:d,ingestionErrorRate:p,queriesPerSecond:S,averageQueryLatency:f,queryErrorRate:m,storageUtilization:E,streamCount:this.streams.size}}getStreamKey(e){return Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join(",")}parseTimestamp(e){const t=BigInt(e);return Number(t/BigInt(1e6))}parseDuration(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 10080*60*1e3;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 10080*60*1e3}}getCompressionRatio(e){switch(e){case"gzip":return .3;case"snappy":return .5;case"lz4":return .4;default:return .3}}}class Zk{config=null;traces=new Map;serviceStats=new Map;jaegerMetrics={spansReceivedTotal:0,spansDroppedTotal:0,spansProcessedTotal:0,samplingDecisionsTotal:0,samplingErrorsTotal:0,tracesStoredTotal:0,tracesDroppedTotal:0,storageSizeBytes:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,spansSentTotal:0,spansFailedTotal:0};samplingState={};queryHistory=[];MAX_QUERY_HISTORY=100;lastCleanupTime=0;CLEANUP_INTERVAL=6e4;initializeConfig(e){const t=e.data.config||{};this.config={serverUrl:t.serverUrl||"http://jaeger:16686",agentEndpoint:t.agentEndpoint||"http://jaeger-agent:6831",collectorEndpoint:t.collectorEndpoint||"http://jaeger-collector:14268",queryEndpoint:t.queryEndpoint||"http://jaeger-query:16686",samplingType:t.samplingType||"probabilistic",samplingParam:t.samplingParam??.001,storageBackend:t.storageBackend||"elasticsearch",storageUrl:t.storageUrl||"http://elasticsearch:9200",enableUIGraphQL:t.enableUIGraphQL??!0,enableMetrics:t.enableMetrics??!0,metricsBackend:t.metricsBackend||"prometheus",metricsUrl:t.metricsUrl||"http://prometheus:9090",maxTraces:t.maxTraces||1e4,traceTTL:t.traceTTL||864e5},this.initializeSampling()}initializeSampling(){if(!this.config)return;const{samplingType:e,samplingParam:t}=this.config;switch(e){case"probabilistic":this.samplingState.probabilistic={probability:Math.max(0,Math.min(1,t||.001))};break;case"ratelimiting":this.samplingState.rateLimiting={maxTracesPerSecond:Math.max(1,t||10),bucket:{tokens:t||10,lastRefill:Date.now()}};break;case"peroperation":this.samplingState.perOperation=new Map;break}}receiveSpan(e){if(!this.config)return{sample:!1};this.jaegerMetrics.spansReceivedTotal++;const t=this.makeSamplingDecision(e);return this.jaegerMetrics.samplingDecisionsTotal++,t.sample?(this.processSpan(e),t):(this.jaegerMetrics.spansDroppedTotal++,t)}receiveSpansFromDataFlow(e){for(const t of e)this.receiveSpan(t)}makeSamplingDecision(e){if(!this.config)return{sample:!1};const{samplingType:t}=this.config;try{switch(t){case"probabilistic":return this.probabilisticSampling(e);case"ratelimiting":return this.rateLimitingSampling(e);case"peroperation":return this.perOperationSampling(e);default:return{sample:!0}}}catch{return this.jaegerMetrics.samplingErrorsTotal++,{sample:!1}}}probabilisticSampling(e){const t=this.samplingState.probabilistic;if(!t)return{sample:!0};const n=Math.random()<t.probability;return{sample:n,tags:n?[{key:"sampler.type",value:"probabilistic"},{key:"sampler.param",value:t.probability.toString()}]:void 0}}rateLimitingSampling(e){const t=this.samplingState.rateLimiting;if(!t)return{sample:!0};const n=Date.now(),s=n-t.bucket.lastRefill,a=1e3/t.maxTracesPerSecond,c=Math.floor(s/a);return c>0&&(t.bucket.tokens=Math.min(t.maxTracesPerSecond,t.bucket.tokens+c),t.bucket.lastRefill=n),t.bucket.tokens>0?(t.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"ratelimiting"},{key:"sampler.param",value:t.maxTracesPerSecond.toString()}]}):{sample:!1}}perOperationSampling(e){this.samplingState.perOperation||(this.samplingState.perOperation=new Map);const t=`${e.serviceName}:${e.operationName}`;let n=this.samplingState.perOperation.get(t);if(!n){const d=this.config?.samplingParam||10;n={maxTracesPerSecond:d,bucket:{tokens:d,lastRefill:Date.now()}},this.samplingState.perOperation.set(t,n)}const s=Date.now(),a=s-n.bucket.lastRefill,c=1e3/n.maxTracesPerSecond,l=Math.floor(a/c);return l>0&&(n.bucket.tokens=Math.min(n.maxTracesPerSecond,n.bucket.tokens+l),n.bucket.lastRefill=s),n.bucket.tokens>0?(n.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"peroperation"},{key:"sampler.param",value:n.maxTracesPerSecond.toString()}]}):{sample:!1}}processSpan(e){this.jaegerMetrics.spansProcessedTotal++;let t=this.traces.get(e.traceId);t||(t={traceId:e.traceId,spans:[],startTime:e.startTime,duration:e.duration,serviceCount:0,spanCount:0,hasErrors:!1},this.traces.set(e.traceId,t),this.jaegerMetrics.tracesStoredTotal++),t.spans.push(e),t.spanCount=t.spans.length,e.startTime<t.startTime&&(t.startTime=e.startTime);const n=Math.max(...t.spans.map(a=>a.startTime+a.duration));t.duration=n-t.startTime,!e.parentSpanId&&!t.rootService&&(t.rootService=e.serviceName,t.rootOperation=e.operationName),(e.tags.some(a=>a.key==="error"&&a.value===!0)||e.logs.some(a=>a.fields.some(c=>c.key==="error")))&&(t.hasErrors=!0),this.updateServiceStats(e,t),this.config&&this.traces.size>this.config.maxTraces&&this.evictOldestTraces()}updateServiceStats(e,t){let n=this.serviceStats.get(e.serviceName);n||(n={name:e.serviceName,tracesTotal:0,errorsTotal:0,avgDuration:0,spansTotal:0,lastTraceTime:0},this.serviceStats.set(e.serviceName,n)),n.spansTotal++,n.lastTraceTime=Math.max(n.lastTraceTime,e.startTime/1e3);const s=n.avgDuration*(n.spansTotal-1)+e.duration;n.avgDuration=s/n.spansTotal,(t.spans.length===1||t.spans[0].serviceName===e.serviceName)&&(n.tracesTotal++,t.hasErrors&&n.errorsTotal++)}evictOldestTraces(){if(!this.config)return;const e=Date.now()*1e3,t=this.config.traceTTL*1e3,n=this.config.maxTraces,s=[];for(const[a,c]of this.traces.entries())e-c.startTime>t&&s.push(a);if(this.traces.size-s.length>n){const c=Array.from(this.traces.entries()).filter(([l])=>!s.includes(l)).sort(([,l],[,d])=>l.startTime-d.startTime).slice(0,this.traces.size-s.length-n);s.push(...c.map(([l])=>l))}for(const a of s){const c=this.traces.get(a);if(c){for(const d of c.spans){const f=this.serviceStats.get(d.serviceName);f&&(f.tracesTotal=Math.max(0,f.tracesTotal-1),c.hasErrors&&(f.errorsTotal=Math.max(0,f.errorsTotal-1)))}const l=this.calculateTraceSize(c);this.jaegerMetrics.storageSizeBytes=Math.max(0,this.jaegerMetrics.storageSizeBytes-l),this.jaegerMetrics.tracesDroppedTotal++,this.traces.delete(a)}}}performCleanup(e){e-this.lastCleanupTime<this.CLEANUP_INTERVAL||(this.lastCleanupTime=e,this.evictOldestTraces())}queryTraces(e){const t=performance.now();this.jaegerMetrics.queryRequestsTotal++;try{let n=Array.from(this.traces.values());if(e.service&&(n=n.filter(l=>l.spans.some(d=>d.serviceName===e.service))),e.operation&&(n=n.filter(l=>l.spans.some(d=>d.operationName===e.operation))),e.tags&&(n=n.filter(l=>l.spans.some(d=>Object.entries(e.tags).every(([f,p])=>d.tags.some(m=>m.key===f&&String(m.value)===String(p)))))),e.startTime){const l=e.startTime*1e3;n=n.filter(d=>d.startTime>=l)}if(e.endTime){const l=e.endTime*1e3;n=n.filter(d=>d.startTime+d.duration<=l)}n.sort((l,d)=>d.startTime-l.startTime);const s=e.limit||20,a=n.length;n=n.slice(0,s);const c=performance.now()-t;return this.jaegerMetrics.queryDurationTotal+=c,this.queryHistory.push({params:e,timestamp:Date.now(),duration:c,resultsCount:n.length}),this.queryHistory.length>this.MAX_QUERY_HISTORY&&this.queryHistory.shift(),{traces:n,total:a,limit:s}}catch(n){return this.jaegerMetrics.queryErrorsTotal++,{traces:[],total:0,limit:e.limit||20,errors:[n instanceof Error?n.message:String(n)]}}}getServiceStats(){return Array.from(this.serviceStats.values())}getRecentTraces(e=20){const t=Array.from(this.traces.values());return t.sort((n,s)=>s.startTime-n.startTime),t.slice(0,e)}getTraceById(e){return this.traces.get(e)}getJaegerMetrics(){return{...this.jaegerMetrics}}calculateTraceSize(e){let t=0;for(const n of e.spans)t+=100,t+=n.operationName.length,t+=n.serviceName.length,t+=n.tags.length*50,t+=n.logs.length*100;return t}calculateLoad(){const e=this.jaegerMetrics.spansReceivedTotal,t=this.jaegerMetrics.tracesStoredTotal,n=this.jaegerMetrics.spansDroppedTotal,s=this.jaegerMetrics.queryRequestsTotal,a=this.jaegerMetrics.queryDurationTotal,c=this.jaegerMetrics.queryErrorsTotal,l=e>0?1-n/e:0,d=s>0?a/s:0,f=s>0?c/s:0,p=this.config?.maxTraces||1e4,m=this.traces.size/p,y=e/60,b=t/60;return{spansPerSecond:y,tracesPerSecond:b,samplingRate:l,storageUtilization:m,queryLatency:d,errorRate:f}}getConfig(){return this.config?{...this.config}:null}}class eT{config=null;receivers=new Map;processors=new Map;exporters=new Map;pipelines=new Map;metricsReceived=0;tracesReceived=0;logsReceived=0;metricsExported=0;tracesExported=0;logsExported=0;initializeConfig(e){const t=e.data.config||{};if(this.config={receivers:Array.isArray(t.receivers)?t.receivers:[],processors:Array.isArray(t.processors)?t.processors:[],exporters:Array.isArray(t.exporters)?t.exporters:[],pipelines:Array.isArray(t.pipelines)?t.pipelines:[]},this.receivers.clear(),this.config.receivers)for(const n of this.config.receivers)n.id&&this.receivers.set(n.id,n);if(this.processors.clear(),this.config.processors)for(const n of this.config.processors)n.id&&this.processors.set(n.id,n);if(this.exporters.clear(),this.config.exporters)for(const n of this.config.exporters)n.id&&this.exporters.set(n.id,n);if(this.pipelines.clear(),this.config.pipelines)for(const n of this.config.pipelines)n.id&&this.pipelines.set(n.id,n)}processMessage(e,t){const n=Date.now();try{const s=this.determineDataType(e,t),a=Array.from(this.pipelines.values()).filter(c=>c.type===s&&c.enabled!==!1);if(a.length===0)return{success:!0,latency:Date.now()-n};for(const c of a){if(c.receivers.map(m=>this.receivers.get(m)).filter(m=>m&&m.enabled).length===0)continue;let d=e.payload;const f=c.processors.map(m=>this.processors.get(m)).filter(m=>m&&m.enabled);for(const m of f)d=this.applyProcessor(m,d);const p=c.exporters.map(m=>this.exporters.get(m)).filter(m=>m&&m.enabled);for(const m of p)this.applyExporter(m,d,s);s==="metrics"?(this.metricsReceived++,this.metricsExported+=p.length):s==="traces"?(this.tracesReceived++,this.tracesExported+=p.length):s==="logs"&&(this.logsReceived++,this.logsExported+=p.length)}return{success:!0,latency:Date.now()-n}}catch(s){return{success:!1,latency:Date.now()-n,error:s instanceof Error?s.message:"Unknown error"}}}determineDataType(e,t){if(t){const n=t.type?.toLowerCase()||"";if(n.includes("prometheus")||n.includes("metric"))return"metrics";if(n.includes("jaeger")||n.includes("trace"))return"traces";if(n.includes("loki")||n.includes("log"))return"logs"}if(e.format){const n=e.format.toLowerCase();if(n.includes("prometheus")||n.includes("metric"))return"metrics";if(n.includes("jaeger")||n.includes("trace")||n.includes("zipkin"))return"traces";if(n.includes("log"))return"logs"}return"traces"}applyProcessor(e,t){switch(e.type){case"batch":return t;case"memory_limiter":return t;case"filter":return t;case"transform":return t;case"resource":return t;case"attributes":return t;default:return t}}applyExporter(e,t,n){e.type}getMetrics(){return{metricsReceived:this.metricsReceived,tracesReceived:this.tracesReceived,logsReceived:this.logsReceived,metricsExported:this.metricsExported,tracesExported:this.tracesExported,logsExported:this.logsExported,receiversCount:this.receivers.size,processorsCount:this.processors.size,exportersCount:this.exporters.size,pipelinesCount:this.pipelines.size}}resetMetrics(){this.metricsReceived=0,this.tracesReceived=0,this.logsReceived=0,this.metricsExported=0,this.tracesExported=0,this.logsExported=0}}class tT{config=null;incidents=new Map;incidentState=new Map;metrics={notificationsSent:0,escalationsTriggered:0,acknowledgements:0,totalAckLatency:0,totalAckCount:0,totalResolveLatency:0,totalResolveCount:0,apiRequests:0,webhookCalls:0,errors:0};initializeFromNode(e){const t=e.data.config||{},n=(t.services||[]).map(c=>({id:String(c.id??c.name??"service"),name:String(c.name??"service"),integrationKey:c.integrationKey,status:c.status??"active",escalationPolicy:c.escalationPolicy??t.escalationPolicy??"default-policy",autoResolve:c.autoResolve??t.enableAutoResolve??!0,resolveTimeout:c.resolveTimeout??t.resolveTimeout??300})),s=(t.escalationPolicies||[]).map(c=>({id:String(c.id??c.name??"policy"),name:String(c.name??"policy"),levels:Array.isArray(c.levels)?c.levels.map((l,d)=>({level:typeof l.level=="number"?l.level:d+1,timeout:typeof l.timeout=="number"?l.timeout:5,targets:Array.isArray(l.targets)?l.targets.map(f=>String(f)):[]})):[]})),a=(t.onCallUsers||[]).map(c=>({id:String(c.id??c.email??c.name??"user"),name:String(c.name??"On-Call User"),email:String(c.email??"user@example.com"),status:c.status==="off-call"?"off-call":"on-call"}));this.config={services:n,escalationPolicies:s,onCallUsers:a,severityMapping:t.severityMapping??"standard",enableAutoResolve:t.enableAutoResolve??!0,resolveTimeout:t.resolveTimeout??300}}processAlerts(e,t){if(!(!this.config||t.length===0))for(const n of t){const s=this.findServiceForAlert(n);if(!s||s.status==="disabled")continue;const a=this.mapSeverity(n),c=this.findExistingIncident(n,s);if(c)c.lastSignalAt=e,c.alertIds=Array.from(new Set([...c.alertIds||[],n.id])),this.incidents.set(c.id,c),this.metrics.apiRequests++;else{const l=`inc-${Date.now()}-${Math.floor(Math.random()*1e3)}`,d={id:l,title:n.title,serviceId:s.id,status:"triggered",severity:a,createdAt:e,lastSignalAt:e,alertIds:[n.id]};this.incidents.set(l,d),this.incidentState.set(l,{escalationLevelIndex:0,lastEscalationAt:e}),this.metrics.apiRequests++,this.triggerEscalation(e,d,s)}}}advanceTime(e){if(this.config)for(const[t,n]of this.incidents.entries()){if(n.status==="resolved")continue;const s=this.config.services.find(y=>y.id===n.serviceId);if(!s)continue;const a=s.autoResolve??this.config.enableAutoResolve,c=(s.resolveTimeout??this.config.resolveTimeout)*1e3;if(a&&n.status!=="resolved"&&n.lastSignalAt&&e-n.lastSignalAt>=c){this.resolveIncident(e,n),this.incidents.set(t,n);continue}const l=this.findEscalationPolicy(s);if(!l||l.levels.length===0)continue;const d=this.incidentState.get(t);if(!d)continue;const f=l.levels[d.escalationLevelIndex];if(!f)continue;const p=f.timeout*60*1e3;n.status==="triggered"&&e-d.lastEscalationAt>=p&&d.escalationLevelIndex<l.levels.length-1&&(d.escalationLevelIndex+=1,d.lastEscalationAt=e,this.incidentState.set(t,d),this.triggerEscalation(e,n,s,d.escalationLevelIndex))}}acknowledgeIncident(e,t){const n=this.incidents.get(t);!n||n.status!=="triggered"||(n.status="acknowledged",n.acknowledgedAt=e,this.incidents.set(t,n),this.metrics.acknowledgements++,this.metrics.totalAckCount++,this.metrics.totalAckLatency+=e-n.createdAt)}resolveIncidentManually(e,t){const n=this.incidents.get(t);!n||n.status==="resolved"||(this.resolveIncident(e,n),this.incidents.set(t,n))}getIncidents(){return Array.from(this.incidents.values())}getMetrics(){const e=Array.from(this.incidents.values()),t=e.length,n=e.filter(M=>M.status!=="resolved").length,s=e.filter(M=>M.status==="resolved").length,a=this.metrics.totalAckCount>0?this.metrics.totalAckLatency/this.metrics.totalAckCount:0,c=this.metrics.totalResolveCount>0?this.metrics.totalResolveLatency/this.metrics.totalResolveCount:0,l=300,d=this.metrics.apiRequests/l,f=this.metrics.webhookCalls/l,p=d+f+n*.1+this.metrics.notificationsSent/l,m=Math.min(.95,.1+p/200),y=Math.min(.95,.2+t/1e3),b=this.metrics.apiRequests+this.metrics.webhookCalls+1,S=this.metrics.errors/b;return{incidentsTotal:t,incidentsActive:n,incidentsResolved:s,notificationsSent:this.metrics.notificationsSent,escalationsTriggered:this.metrics.escalationsTriggered,acknowledgements:this.metrics.acknowledgements,averageAckLatency:a,averageResolveLatency:c,apiRequestsPerSecond:d,webhooksPerSecond:f,errorRate:S,cpuUtilization:m,memoryUtilization:y}}calculateLoad(){const e=this.getMetrics(),t=e.apiRequestsPerSecond+e.webhooksPerSecond+e.incidentsActive/60+e.notificationsSent/300,s=100+(e.averageAckLatency||0)*.01+(e.averageResolveLatency||0)*.005,a=(e.cpuUtilization+e.memoryUtilization)/2;return{throughput:t,latency:s,errorRate:e.errorRate,utilization:a}}findServiceForAlert(e){if(this.config){if(e.nodeLabel){const t=e.nodeLabel.toLowerCase(),n=this.config.services.find(s=>s.name.toLowerCase()===t||t.includes(s.name.toLowerCase()));if(n)return n}if(e.nodeId){const t=this.config.services.find(n=>n.id===e.nodeId);if(t)return t}return this.config.services[0]}}mapSeverity(e){if(!this.config)return"warning";const t=e.type==="critical"?"critical":e.type==="warning"?"warning":"info";switch(this.config.severityMapping){case"error-focused":return t==="warning"?"error":t;case"warning-demoted":return t==="warning"?"info":t;default:return t}}findExistingIncident(e,t){for(const n of this.incidents.values())if(n.serviceId===t.id&&n.status!=="resolved"&&n.title===e.title)return n}findEscalationPolicy(e){if(this.config)return e.escalationPolicy?this.config.escalationPolicies.find(t=>t.id===e.escalationPolicy||t.name===e.escalationPolicy)??this.config.escalationPolicies[0]:this.config.escalationPolicies[0]}resolveIncident(e,t){t.status!=="resolved"&&(t.status="resolved",t.resolvedAt=e,this.metrics.totalResolveCount++,this.metrics.totalResolveLatency+=e-t.createdAt)}triggerEscalation(e,t,n,s=0){if(!this.config)return;const a=this.findEscalationPolicy(n);if(!a)return;const c=a.levels[s];if(!c)return;const l=this.config.onCallUsers.filter(p=>p.status==="on-call"&&c.targets.includes(p.id)),d=l.length>0?l:this.config.onCallUsers,f=Math.max(1,d.length);this.metrics.notificationsSent+=f,this.metrics.escalationsTriggered++,this.metrics.webhookCalls+=1}}class nT{alerts=new Map;alertCallbacks=[];isAnalyzing=!1;onAlert(e){this.alertCallbacks.push(e)}analyze(e,t,n,s){if(this.isAnalyzing)return[];this.isAnalyzing=!0;const a=[];try{for(const c of e){const l=t.get(c.id),d=s.find(f=>f.nodeId===c.id);if(!(!l||!d)){if(d.health==="down"){const f=`down-${c.id}`;if(!this.alerts.has(f)){const p={id:f,type:"critical",title:"Component Down",message:`${c.data.label} is down and not responding`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:1};this.addAlert(p),a.push(p)}}if(l.errorRate>.1){const f=`error-${c.id}`,p=this.alerts.get(f);if(!p||p.acknowledged){const m={id:f,type:"critical",title:"High Error Rate",message:`${c.data.label} has ${(l.errorRate*100).toFixed(1)}% error rate`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:.9};this.addAlert(m),a.push(m)}}if(l.latency>2e3){const f=`latency-${c.id}`,p=this.alerts.get(f);if(!p||p.acknowledged){const m={id:f,type:"warning",title:"High Latency",message:`${c.data.label} has latency of ${l.latency.toFixed(0)}ms`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:.7};this.addAlert(m),a.push(m)}}if(l.utilization>.9){const f=`utilization-${c.id}`,p=this.alerts.get(f);if(!p||p.acknowledged){const m={id:f,type:"warning",title:"High Utilization",message:`${c.data.label} is at ${(l.utilization*100).toFixed(0)}% capacity`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:.6};this.addAlert(m),a.push(m)}}}}for(const[c,l]of n.entries())if(l.bottleneck){const d=`bottleneck-${c}`,f=this.alerts.get(d);if(!f||f.acknowledged){const p={id:d,type:"critical",title:"Connection Bottleneck",message:"Bottleneck detected in connection",timestamp:Date.now(),acknowledged:!1,severity:.85};this.addAlert(p),a.push(p)}}this.cleanupResolvedAlerts(e,t,n,s)}finally{this.isAnalyzing=!1}return a}addAlert(e){this.alerts.set(e.id,e),this.alertCallbacks.forEach(t=>t(e))}cleanupResolvedAlerts(e,t,n,s){new Set(e.map(a=>a.id)),new Set(n.keys());for(const[a,c]of this.alerts.entries()){if(c.acknowledged)continue;let l=!1;if(c.nodeId)if(!e.find(f=>f.id===c.nodeId))l=!0;else{const f=t.get(c.nodeId),p=s.find(m=>m.nodeId===c.nodeId);(a.startsWith("down-")&&p&&p.health!=="down"||a.startsWith("error-")&&f&&f.errorRate<=.1||a.startsWith("latency-")&&f&&f.latency<=2e3||a.startsWith("utilization-")&&f&&f.utilization<=.9)&&(l=!0)}else if(a.startsWith("bottleneck-")){const d=a.replace("bottleneck-",""),f=n.get(d);(!f||!f.bottleneck)&&(l=!0)}l&&this.alerts.delete(a)}}acknowledge(e){const t=this.alerts.get(e);t&&(t.acknowledged=!0,this.alerts.set(e,t))}getAlerts(){return Array.from(this.alerts.values()).filter(e=>!e.acknowledged).sort((e,t)=>t.severity-e.severity)}getAlertsByType(e){return this.getAlerts().filter(t=>t.type===e)}clear(){this.alerts.clear()}}const fa=new nT;class sT{config=null;metrics={loginRequestsTotal:0,loginErrorsTotal:0,tokenRefreshTotal:0,introspectionRequestsTotal:0,userInfoRequestsTotal:0,sessionsCreatedTotal:0,sessionsExpiredTotal:0,activeSessions:0};sessions=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(e){const t=e.data.config||{},n=Array.isArray(t.clients)?t.clients.map(a=>({id:String(a.id??a.clientId??"client"),name:String(a.name??a.id??"Client"),type:a.type??"public",enabled:a.enabled??!0,protocol:a.protocol??"openid-connect"})):[{id:"archiphoenix-app",name:"ArchiPhoenix App",type:"public",enabled:!0,protocol:"openid-connect"}],s=Array.isArray(t.users)?t.users.map(a=>({id:String(a.id??a.username??"user"),username:String(a.username??`user-${a.id??"1"}`),email:a.email?String(a.email):void 0,enabled:a.enabled??!0,roles:Array.isArray(a.roles)?a.roles.map(c=>String(c)):[]})):[{id:"1",username:"admin",email:"admin@archiphoenix.com",enabled:!0,roles:["admin","user"]}];this.config={realm:String(t.realm||"archiphoenix"),adminUrl:String(t.adminUrl||"http://keycloak:8080"),enableSSL:t.enableSSL??!1,sslRequired:t.sslRequired||"external",accessTokenLifespan:Number(t.accessTokenLifespan||300),ssoSessionIdle:Number(t.ssoSessionIdle||1800),ssoSessionMax:Number(t.ssoSessionMax||36e3),enableOAuth2:t.enableOAuth2??!0,enableSAML:t.enableSAML??!1,enableLDAP:t.enableLDAP??!1,passwordPolicy:String(t.passwordPolicy||"length(8)"),clients:n,users:s}}processAuthRequest(e,t){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredSessions(n);const s=this.config;if(!s)return this.recordLatency(50),this.metrics.loginErrorsTotal++,{success:!1,latency:50,error:"Keycloak not configured"};const a=t.clientId||this.inferDefaultClientId(),c=s.clients.find(m=>m.id===a&&m.enabled);let l=e==="login"?80:e==="refresh"?40:e==="introspect"?60:40;e==="login"&&(l+=this.estimatePasswordPolicyCost(s.passwordPolicy)),s.enableLDAP&&(l*=1.3);const d=(Math.random()-.5)*20,f=Math.max(10,l+d);if(this.recordLatency(f),!c)return this.metrics.loginErrorsTotal++,this.bumpCounter(e),{success:!1,latency:f,error:`Client ${a} not found or disabled`,clientId:a,realm:s.realm};let p;if(e==="login"||e==="userinfo"){const m=t.username||t.subject;if(m&&(p=s.users.find(y=>y.username===m)),!p||!p.enabled)return this.metrics.loginErrorsTotal++,this.bumpCounter(e),{success:!1,latency:f,error:`User ${m||"unknown"} not found or disabled`,clientId:a,realm:s.realm}}switch(e){case"login":return this.metrics.loginRequestsTotal++,this.createOrUpdateSession(n,s,a,p),{success:!0,latency:f,tokenType:"access",expiresIn:s.accessTokenLifespan,subject:p.username,clientId:a,realm:s.realm};case"refresh":return this.metrics.tokenRefreshTotal++,t.subject&&this.touchUserSessions(n,t.subject),{success:!0,latency:f,tokenType:"access",expiresIn:s.accessTokenLifespan,subject:t.subject,clientId:a,realm:s.realm};case"introspect":return this.metrics.introspectionRequestsTotal++,{success:!0,latency:f,tokenType:"access",expiresIn:s.accessTokenLifespan,subject:t.subject,clientId:a,realm:s.realm};case"userinfo":return this.metrics.userInfoRequestsTotal++,{success:!0,latency:f,tokenType:"id",expiresIn:s.accessTokenLifespan,subject:p?.username??t.subject,clientId:a,realm:s.realm}}}calculateLoad(){const e=this.metrics,t=e.loginRequestsTotal+e.tokenRefreshTotal+e.introspectionRequestsTotal+e.userInfoRequestsTotal,n=t>0?Math.min(1,e.loginErrorsTotal/t):0,s=this.latencyHistory.length>0?this.latencyHistory.reduce((l,d)=>l+d,0)/this.latencyHistory.length:0;let a=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const l=(this.lastRequestTime-this.firstRequestTime)/1e3;a=t/Math.max(l,1)}const c=e.loginRequestsTotal>0?1-e.loginErrorsTotal/e.loginRequestsTotal:1;return{requestsPerSecond:a,averageLatency:s,errorRate:n,activeSessions:this.metrics.activeSessions,authSuccessRate:c}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}inferDefaultClientId(){return this.config?.clients.length?(this.config.clients.filter(t=>t.enabled)[0]||this.config.clients[0]).id:"default-client"}estimatePasswordPolicyCost(e){if(!e)return 0;let t=0;const n=e.toLowerCase();n.includes("length(")&&(t+=10),n.includes("digits(")&&(t+=15),n.includes("special(")&&(t+=20),n.includes("uppercase(")&&(t+=10),n.includes("lowercase(")&&(t+=5);const s=(e.match(/\)/g)||[]).length;return t+=s*5,t}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}bumpCounter(e){switch(e){case"login":this.metrics.loginRequestsTotal++;break;case"refresh":this.metrics.tokenRefreshTotal++;break;case"introspect":this.metrics.introspectionRequestsTotal++;break;case"userinfo":this.metrics.userInfoRequestsTotal++;break}}createOrUpdateSession(e,t,n,s){for(const f of this.sessions.values())if(f.userId===s.id&&f.clientId===n)return f.lastAccess=e,f.sessionId;const a=`sess-${e}-${Math.random().toString(36).slice(2,8)}`,c=t.ssoSessionIdle*1e3,l=t.ssoSessionMax*1e3,d={sessionId:a,userId:s.id,clientId:n,realm:t.realm,createdAt:e,lastAccess:e,idleTimeoutMs:c,maxLifespanMs:l};return this.sessions.set(a,d),this.metrics.sessionsCreatedTotal++,this.metrics.activeSessions=this.sessions.size,a}touchUserSessions(e,t){if(!this.config)return;const n=this.config.users.find(s=>s.username===t);if(n)for(const s of this.sessions.values())s.userId===n.id&&(s.lastAccess=e)}cleanupExpiredSessions(e){let t=0;for(const[n,s]of this.sessions.entries()){const a=e-s.lastAccess>s.idleTimeoutMs,c=e-s.createdAt>s.maxLifespanMs;(a||c)&&(this.sessions.delete(n),t++)}t>0&&(this.metrics.sessionsExpiredTotal+=t,this.metrics.activeSessions=this.sessions.size)}}class iT{config=null;rules=new Map;threats=[];stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0};rateLimitTracker=new Map;RATE_LIMIT_WINDOW_MS=6e4;ddosTracker=new Map;DDOS_WINDOW_MS=1e3;MAX_THREATS=1e3;initializeConfig(e){const t=e.data.config||{};if(this.config={mode:t.mode||"detection",enableOWASP:t.enableOWASP??!0,owaspRuleset:t.owaspRuleset||"3.3",enableRateLimiting:t.enableRateLimiting??!0,rateLimitPerMinute:t.rateLimitPerMinute||100,enableGeoBlocking:t.enableGeoBlocking??!1,blockedCountries:Array.isArray(t.blockedCountries)?t.blockedCountries:[],enableIPWhitelist:t.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(t.whitelistedIPs)?t.whitelistedIPs:[],enableDDoSProtection:t.enableDDoSProtection??!0,ddosThreshold:t.ddosThreshold||1e3,rules:Array.isArray(t.rules)?t.rules:[]},this.rules.clear(),this.config.rules)for(const n of this.config.rules)n.id&&this.rules.set(n.id,n);this.stats.activeRules=Array.from(this.rules.values()).filter(n=>n.enabled).length}processRequest(e){const t=performance.now(),n=e.timestamp||Date.now(),s=e.sourceIP||"0.0.0.0";if(this.stats.totalRequests++,this.config?.enableIPWhitelist&&this.config.whitelistedIPs?.includes(s))return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-t};if(this.config?.enableGeoBlocking&&e.country&&this.config.blockedCountries?.includes(e.country)){const c={id:`threat-${Date.now()}-${Math.random()}`,type:"geo-block",sourceIP:s,target:e.path,timestamp:n,severity:"medium",blocked:!0,details:{country:e.country}};if(this.addThreat(c),this.stats.geoBlockHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:c}}if(this.config?.enableDDoSProtection){const c=this.checkDDoS(s,n);if(c.blocked){const l={id:`threat-${Date.now()}-${Math.random()}`,type:"ddos",sourceIP:s,target:e.path,timestamp:n,severity:"critical",blocked:!0,details:{requestCount:c.count}};if(this.addThreat(l),this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:l}}}if(this.config?.enableRateLimiting){const c=this.checkRateLimit(s,n);if(c.blocked){const l={id:`threat-${Date.now()}-${Math.random()}`,type:"rate-limit",sourceIP:s,target:e.path,timestamp:n,severity:"medium",blocked:!0,details:{requestCount:c.count}};if(this.addThreat(l),this.stats.rateLimitHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:l}}}if(this.config?.enableOWASP){const c=this.checkOWASPRules(e);if(c.detected){const l={id:`threat-${Date.now()}-${Math.random()}`,type:c.threatType||"custom",sourceIP:s,target:e.path,timestamp:n,severity:c.severity||"high",blocked:!0,details:c.details};if(this.addThreat(l),this.stats.owaspHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:l}}}const a=Array.from(this.rules.values()).filter(c=>c.enabled).sort((c,l)=>c.priority-l.priority);for(const c of a){const l=this.matchRule(c,e);if(l.matched){const d={id:`threat-${Date.now()}-${Math.random()}`,type:"custom",sourceIP:s,target:e.path,timestamp:n,severity:l.severity||"medium",blocked:c.action==="block",ruleId:c.id,ruleName:c.name,details:l.details};if(this.addThreat(d),this.stats.threatsDetected++,c.action==="block"&&this.config?.mode==="prevention")return this.stats.blockedRequests++,{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:d,matchedRule:c};if(c.action==="log")continue;if(c.action==="challenge")return{allowed:!1,blocked:!1,action:"challenge",latency:performance.now()-t,threatDetected:d,matchedRule:c}}}return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-t}}matchRule(e,t){if(!e.conditions||e.conditions.length===0)return{matched:!1};for(const n of e.conditions){let s,a=!1;switch(n.type){case"ip":s=t.sourceIP;break;case"uri":s=t.path;break;case"method":s=t.method;break;case"header":s=t.headers?.[n.value]||"";break;case"body":s=typeof t.body=="string"?t.body:JSON.stringify(t.body||"");break;case"country":s=t.country;break;case"user-agent":s=t.userAgent;break}if(s===void 0)return{matched:!1};switch(n.operator){case"equals":a=s===n.value;break;case"contains":a=s.toLowerCase().includes(n.value.toLowerCase());break;case"startsWith":a=s.toLowerCase().startsWith(n.value.toLowerCase());break;case"endsWith":a=s.toLowerCase().endsWith(n.value.toLowerCase());break;case"regex":try{a=new RegExp(n.value,"i").test(s)}catch{a=!1}break;case"in":a=n.value.split(",").map(d=>d.trim()).includes(s);break;case"not-in":a=!n.value.split(",").map(d=>d.trim()).includes(s);break}if(!a)return{matched:!1}}return{matched:!0,severity:"medium",details:{matchedConditions:e.conditions.length}}}checkOWASPRules(e){const t=typeof e.body=="string"?e.body:JSON.stringify(e.body||""),n=e.path||"",s=JSON.stringify(e.query||""),a=`${t} ${n} ${s}`.toLowerCase(),c=[/(\bunion\b.*\bselect\b)/i,/(\bselect\b.*\bfrom\b)/i,/(\bdrop\b.*\btable\b)/i,/(\binsert\b.*\binto\b)/i,/(\bdelete\b.*\bfrom\b)/i,/('.*--)/,/(\bor\b.*=.*)/i,/(\band\b.*=.*)/i];for(const p of c)if(p.test(a))return{detected:!0,threatType:"sql-injection",severity:"critical",details:{pattern:p.toString()}};const l=[/<script[^>]*>/i,/javascript:/i,/on\w+\s*=/i,/<iframe[^>]*>/i,/eval\s*\(/i,/expression\s*\(/i];for(const p of l)if(p.test(a))return{detected:!0,threatType:"xss",severity:"high",details:{pattern:p.toString()}};const d=[/\.\.\//,/\.\.\\/,/\.\.%2f/i,/\.\.%5c/i];for(const p of d)if(p.test(a))return{detected:!0,threatType:"path-traversal",severity:"high",details:{pattern:p.toString()}};const f=[/\$\{[^}]*\}/,/\$\([^)]*\)/,/`[^`]*`/,/\|\s*\w+.*\s*\|/];for(const p of f)if(p.test(a))return{detected:!0,threatType:"rce",severity:"critical",details:{pattern:p.toString()}};return{detected:!1}}checkRateLimit(e,t){if(!this.config?.enableRateLimiting||!this.config.rateLimitPerMinute)return{blocked:!1,count:0};const n=t-this.RATE_LIMIT_WINDOW_MS,s=this.rateLimitTracker.get(e)||[],a=s.filter(c=>c>n);return a.length>=this.config.rateLimitPerMinute?{blocked:!0,count:a.length}:(a.push(t),this.rateLimitTracker.set(e,a),s.length>this.config.rateLimitPerMinute*2&&this.rateLimitTracker.set(e,a),{blocked:!1,count:a.length})}checkDDoS(e,t){if(!this.config?.enableDDoSProtection||!this.config.ddosThreshold)return{blocked:!1,count:0};const n=this.ddosTracker.get(e),s=t-this.DDOS_WINDOW_MS;return!n||n.windowStart<s?(this.ddosTracker.set(e,{count:1,windowStart:t}),{blocked:!1,count:1}):(n.count++,this.ddosTracker.set(e,n),n.count>=this.config.ddosThreshold?{blocked:!0,count:n.count}:{blocked:!1,count:n.count})}addThreat(e){this.threats.push(e),this.threats.length>this.MAX_THREATS&&this.threats.shift()}getThreats(e=100){return this.threats.slice(-e).reverse()}getStats(){return{...this.stats}}resetStats(){this.stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:this.stats.activeRules,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0},this.threats=[],this.rateLimitTracker.clear(),this.ddosTracker.clear()}}class aT{config=null;routingEngine;metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:0,averageLatency:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new iT}initializeConfig(e){const t=e.data.config||{};this.config={mode:t.mode||"detection",enableOWASP:t.enableOWASP??!0,owaspRuleset:t.owaspRuleset||"3.3",enableRateLimiting:t.enableRateLimiting??!0,rateLimitPerMinute:t.rateLimitPerMinute||100,enableGeoBlocking:t.enableGeoBlocking??!1,blockedCountries:Array.isArray(t.blockedCountries)?t.blockedCountries:[],enableIPWhitelist:t.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(t.whitelistedIPs)?t.whitelistedIPs:[],enableDDoSProtection:t.enableDDoSProtection??!0,ddosThreshold:t.ddosThreshold||1e3,rules:Array.isArray(t.rules)?t.rules:[]},this.routingEngine.initializeConfig(e),this.updateMetricsFromStats()}processRequest(e){const t=performance.now(),n={path:e.path||"/",method:e.method||"GET",headers:e.headers,query:e.query,body:e.body,sourceIP:e.sourceIP||this.generateRandomIP(),country:e.country||this.generateRandomCountry(),userAgent:e.userAgent||"Mozilla/5.0",timestamp:Date.now()},s=this.routingEngine.processRequest(n),a=performance.now()-t+s.latency;if(this.recordLatency(a),this.metrics.requestsTotal++,s.allowed?this.metrics.requestsAllowed++:(this.metrics.requestsBlocked++,s.blocked&&this.metrics.threatsBlocked++),s.threatDetected){this.metrics.threatsDetected++;const l=this.routingEngine.getStats();this.metrics.rateLimitHits=l.rateLimitHits,this.metrics.geoBlockHits=l.geoBlockHits,this.metrics.ipBlockHits=l.ipBlockHits,this.metrics.owaspHits=l.owaspHits,this.metrics.customRuleHits=l.threatsDetected-l.owaspHits-l.rateLimitHits-l.geoBlockHits-l.ipBlockHits}const c=Date.now();return this.firstRequestTime||(this.firstRequestTime=c),this.lastRequestTime=c,{success:s.allowed,blocked:s.blocked,latency:a,threatDetected:!!s.threatDetected,error:s.error}}simulateRequests(e){const t=Date.now(),n=t-this.lastSimulationTime;if(this.lastSimulationTime=t,n<=0||e<=0)return;const s=Math.floor(e*n/1e3);if(s!==0){for(let a=0;a<s;a++){const c=this.generateRandomRequest();this.processRequest(c)}this.updateMetricsFromStats()}}generateRandomRequest(){const e=["GET","POST","PUT","DELETE","PATCH"],t=["/api/users","/api/products","/api/orders","/api/auth","/api/data"],n=["US","GB","DE","FR","CN","RU","JP"],s=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"],a=Math.random()<.05;let c=t[Math.floor(Math.random()*t.length)],l=null;return a?Math.random()<.5?(c+="?id=1' OR '1'='1",l={query:"SELECT * FROM users WHERE id = '1' OR '1'='1'"}):l={content:'<script>alert("XSS")<\/script>'}:Math.random()<.3&&(l={data:Math.random().toString(36).substring(7)}),{path:c,method:e[Math.floor(Math.random()*e.length)],headers:{"Content-Type":"application/json","User-Agent":s[Math.floor(Math.random()*s.length)]},body:l,sourceIP:this.generateRandomIP(),country:n[Math.floor(Math.random()*n.length)],userAgent:s[Math.floor(Math.random()*s.length)]}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomCountry(){const e=["US","GB","DE","FR","CN","RU","JP","BR","IN","AU"];return e[Math.floor(Math.random()*e.length)]}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const t=this.latencyHistory.reduce((n,s)=>n+s,0);this.metrics.averageLatency=t/this.latencyHistory.length}updateMetricsFromStats(){const e=this.routingEngine.getStats();this.metrics.requestsTotal=e.totalRequests,this.metrics.requestsAllowed=e.allowedRequests,this.metrics.requestsBlocked=e.blockedRequests,this.metrics.threatsDetected=e.threatsDetected,this.metrics.rateLimitHits=e.rateLimitHits,this.metrics.geoBlockHits=e.geoBlockHits,this.metrics.ipBlockHits=e.ipBlockHits,this.metrics.owaspHits=e.owaspHits,this.metrics.activeRules=e.activeRules,this.metrics.customRuleHits=e.threatsDetected-e.owaspHits-e.rateLimitHits-e.geoBlockHits-e.ipBlockHits}calculateLoad(){let e=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const c=(this.lastRequestTime-this.firstRequestTime)/1e3;c>0&&(e=this.metrics.requestsTotal/c)}e===0&&this.simulatedRequestRate>0&&(e=this.simulatedRequestRate);const t=this.metrics.averageLatency||5,n=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,s=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,a=this.metrics.requestsTotal>0?this.metrics.threatsDetected/this.metrics.requestsTotal:0;return{requestsPerSecond:e,averageLatency:t,errorRate:n,blockRate:s,threatDetectionRate:a}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getThreats(e=100){return this.routingEngine.getThreats(e)}getStats(){return this.routingEngine.getStats()}setSimulatedRequestRate(e){this.simulatedRequestRate=e}resetMetrics(){this.metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:this.metrics.activeRules,averageLatency:0},this.latencyHistory=[],this.firstRequestTime=null,this.lastRequestTime=null,this.routingEngine.resetStats()}}class oT{config=null;rules=new Map;logs=[];stats={totalPackets:0,allowedPackets:0,blockedPackets:0,rejectedPackets:0,activeRules:0,totalConnections:0,activeConnections:0};connections=new Map;MAX_CONNECTIONS=1e4;CONNECTION_TIMEOUT_MS=3e5;MAX_LOGS=1e4;initializeConfig(e){const t=e.data.config||{};if(this.config={enableFirewall:t.enableFirewall??!0,enableLogging:t.enableLogging??!0,enableIntrusionDetection:t.enableIntrusionDetection??!1,enableStatefulInspection:t.enableStatefulInspection??!0,defaultPolicy:t.defaultPolicy||"deny",logRetention:t.logRetention||30,rules:Array.isArray(t.rules)?t.rules:[]},this.rules.clear(),this.config.rules)for(const n of this.config.rules)n.id&&n.enabled&&this.rules.set(n.id,n);this.stats.activeRules=Array.from(this.rules.values()).filter(n=>n.enabled).length,this.cleanOldLogs()}processPacket(e){const t=performance.now(),n=e.timestamp||Date.now();if(!this.config?.enableFirewall)return{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-t};if(this.stats.totalPackets++,this.config?.enableStatefulInspection){const l=this.getConnectionKey(e),d=this.connections.get(l);if(d){if(d.lastSeen=n,d.packets++,d.state="established",d.state==="established")return this.stats.allowedPackets++,this.logPacket(e,"allowed",void 0,"Established connection"),{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-t}}else this.connections.size<this.MAX_CONNECTIONS&&(this.connections.set(l,{source:e.source,destination:e.destination,sourcePort:e.sourcePort||0,destinationPort:e.port||0,protocol:e.protocol,state:"new",firstSeen:n,lastSeen:n,packets:1}),this.stats.totalConnections++)}const s=Array.from(this.rules.values()).filter(l=>l.enabled).sort((l,d)=>d.priority-l.priority);for(const l of s){const d=this.matchRule(l,e);if(d.matched){if(l.hits=(l.hits||0)+1,this.config?.enableLogging&&this.logPacket(e,l.action==="allow"?"allowed":l.action==="deny"?"blocked":"rejected",l,d.reason),l.action==="allow"?this.stats.allowedPackets++:l.action==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,l.action==="allow"&&this.config?.enableStatefulInspection){const f=this.getConnectionKey(e),p=this.connections.get(f);p&&(p.state="established")}return{allowed:l.action==="allow",blocked:l.action==="deny"||l.action==="reject",action:l.action,latency:performance.now()-t,matchedRule:l}}}const a=this.config?.defaultPolicy||"deny",c=a==="allow"?"allowed":a==="deny"?"blocked":"rejected";return this.config?.enableLogging&&this.logPacket(e,c,void 0,`Default policy: ${a}`),a==="allow"?this.stats.allowedPackets++:a==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,{allowed:a==="allow",blocked:a==="deny"||a==="reject",action:a,latency:performance.now()-t}}matchRule(e,t){return e.protocol!=="all"&&e.protocol!==t.protocol?{matched:!1}:e.source&&!this.matchIP(t.source,e.source)?{matched:!1}:e.destination&&!this.matchIP(t.destination,e.destination)?{matched:!1}:(t.protocol==="tcp"||t.protocol==="udp")&&e.port!==void 0&&t.port!==e.port?{matched:!1}:(t.protocol==="tcp"||t.protocol==="udp")&&e.sourcePort!==void 0&&t.sourcePort!==e.sourcePort?{matched:!1}:{matched:!0,reason:`Matched rule: ${e.name}`}}matchIP(e,t){if(e===t)return!0;if(t.includes("/")){const[n,s]=t.split("/"),a=parseInt(s,10);if(isNaN(a)||a<0||a>32)return!1;const c=this.ipToNumber(e),l=this.ipToNumber(n),d=4294967295<<32-a>>>0;return(c&d)===(l&d)}return!1}ipToNumber(e){const t=e.split(".");return t.length!==4?0:(parseInt(t[0],10)<<24)+(parseInt(t[1],10)<<16)+(parseInt(t[2],10)<<8)+parseInt(t[3],10)}getConnectionKey(e){return`${e.source}:${e.sourcePort||0}-${e.destination}:${e.port||0}-${e.protocol}`}logPacket(e,t,n,s){if(!this.config?.enableLogging)return;const a={id:`log-${Date.now()}-${Math.random()}`,timestamp:e.timestamp||Date.now(),action:t,source:e.source,destination:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,ruleId:n?.id,ruleName:n?.name,reason:s||n?.name};this.logs.push(a),this.logs.length>this.MAX_LOGS&&this.logs.shift()}cleanOldLogs(){if(!this.config?.logRetention)return;const e=this.config.logRetention*24*60*60*1e3,t=Date.now()-e;this.logs=this.logs.filter(n=>n.timestamp>=t)}cleanupConnections(){const e=Date.now(),t=this.CONNECTION_TIMEOUT_MS;for(const[n,s]of this.connections.entries())e-s.lastSeen>t&&this.connections.delete(n);this.stats.activeConnections=this.connections.size}getStats(){return this.stats.activeConnections=this.connections.size,{...this.stats}}getLogs(e){const t=[...this.logs].reverse();return e?t.slice(0,e):t}getRules(){return Array.from(this.rules.values())}getConfig(){return this.config}}class rT{config=null;routingEngine;metrics={packetsTotal:0,packetsAllowed:0,packetsBlocked:0,packetsRejected:0,activeRules:0,totalConnections:0,activeConnections:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new oT}initializeConfig(e){const t=e.data.config||{};this.config={enableFirewall:t.enableFirewall??!0,enableLogging:t.enableLogging??!0,enableIntrusionDetection:t.enableIntrusionDetection??!1,enableStatefulInspection:t.enableStatefulInspection??!0,defaultPolicy:t.defaultPolicy||"deny",logRetention:t.logRetention||30,rules:Array.isArray(t.rules)?t.rules:[]},this.routingEngine.initializeConfig(e),this.updateMetricsFromStats()}processPacket(e){const t=performance.now(),n={source:e.source,destination:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,timestamp:Date.now()},s=this.routingEngine.processPacket(n),a=performance.now()-t;return this.recordLatency(a),this.updateMetricsFromStats(),{success:s.allowed,blocked:s.blocked,latency:a,error:s.blocked?s.matchedRule?.name||`Packet ${s.action}`:void 0}}simulatePackets(e){const t=Date.now(),n=t-this.lastSimulationTime;if(this.lastSimulationTime=t,n<=0||e<=0)return;const s=Math.floor(e*n/1e3);if(s!==0){for(let a=0;a<s;a++){const c=this.generateRandomPacket();this.processPacket(c)}this.updateMetricsFromStats()}}generateRandomPacket(){const e=["tcp","udp","icmp"],t=e[Math.floor(Math.random()*e.length)],n=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,s=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,a=t==="icmp"?void 0:Math.floor(Math.random()*65535),c=t==="icmp"?void 0:Math.floor(Math.random()*65535);return{source:n,destination:s,protocol:t,port:a,sourcePort:c}}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}updateMetricsFromStats(){const e=this.routingEngine.getStats();if(this.routingEngine.getRules(),this.metrics.packetsTotal=e.totalPackets,this.metrics.packetsAllowed=e.allowedPackets,this.metrics.packetsBlocked=e.blockedPackets,this.metrics.packetsRejected=e.rejectedPackets,this.metrics.activeRules=e.activeRules,this.metrics.totalConnections=e.totalConnections,this.metrics.activeConnections=e.activeConnections,this.latencyHistory.length>0){const t=this.latencyHistory.reduce((n,s)=>n+s,0);this.metrics.averageLatency=t/this.latencyHistory.length}}setSimulatedPacketRate(e){this.simulatedPacketRate=e}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLogs(e){return this.routingEngine.getLogs(e)}getRules(){return this.routingEngine.getRules()}getConfig(){return this.config}calculateLoad(){let e=0;if(this.firstPacketTime&&this.lastPacketTime){const s=(this.lastPacketTime-this.firstPacketTime)/1e3;s>0&&(e=this.metrics.packetsTotal/s)}e===0&&this.simulatedPacketRate>0&&(e=this.simulatedPacketRate);const t=this.metrics.packetsTotal>0?this.metrics.packetsBlocked/this.metrics.packetsTotal:0,n=this.metrics.packetsTotal>0?this.metrics.packetsRejected/this.metrics.packetsTotal:0;return{packetsPerSecond:e,averageLatency:this.metrics.averageLatency,blockRate:t,rejectionRate:n}}cleanup(){this.routingEngine.cleanupConnections(),this.updateMetricsFromStats()}}class cT{config=null;signatures=new Map;alerts=[];stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0};blockedIPs=new Map;behavioralPatterns=new Map;MAX_BEHAVIORAL_PATTERNS=1e4;BEHAVIORAL_WINDOW_MS=3e5;MAX_ALERTS=1e4;initializeConfig(e){const t=e.data.config||{};if(this.config={mode:t.mode||"ids",enableSignatureDetection:t.enableSignatureDetection??!0,enableAnomalyDetection:t.enableAnomalyDetection??!0,enableBehavioralAnalysis:t.enableBehavioralAnalysis??!1,alertThreshold:t.alertThreshold||"medium",enableAutoBlock:t.enableAutoBlock??!1,blockDuration:t.blockDuration||3600,enableLogging:t.enableLogging??!0,logRetention:t.logRetention||30,signatures:Array.isArray(t.signatures)?t.signatures:[]},this.signatures.clear(),this.config.signatures)for(const n of this.config.signatures)n.id&&n.enabled&&this.signatures.set(n.id,n);if(Array.isArray(t.blockedIPs)){this.blockedIPs.clear();for(const n of t.blockedIPs)if(n.ip){const s=n.expiresAt?new Date(n.expiresAt).getTime():Date.now()+(this.config.blockDuration||3600)*1e3;this.blockedIPs.set(n.ip,{ip:n.ip,reason:n.reason||"Intrusion detected",blockedAt:n.blockedAt?new Date(n.blockedAt).getTime():Date.now(),expiresAt:s})}}this.stats.activeSignatures=Array.from(this.signatures.values()).filter(n=>n.enabled).length,this.stats.blockedIPs=this.blockedIPs.size,this.cleanExpiredBlocks()}processPacket(e){const t=performance.now();if(this.stats.totalPackets++,this.isIPBlocked(e.source))return this.stats.alertsBlocked++,{allowed:!1,blocked:!0,alertGenerated:!1,latency:performance.now()-t,error:`IP ${e.source} is blocked`};this.stats.packetsAnalyzed++;let n,s=!1;if(this.config?.enableSignatureDetection){const c=this.detectSignature(e);if(c&&(n=c,this.stats.signatureMatches++,this.stats.alertsGenerated++,c.signatureId)){const l=this.signatures.get(c.signatureId);l&&l.action==="block"&&this.config.mode==="ips"&&(s=!0)}}if(!n&&this.config?.enableAnomalyDetection){const c=this.detectAnomaly(e);c&&(n=c,this.stats.anomalyDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&c.anomalyScore&&c.anomalyScore>.8&&(s=!0))}if(!n&&this.config?.enableBehavioralAnalysis){const c=this.detectBehavioral(e);c&&(n=c,this.stats.behavioralDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&c.behavioralPattern==="suspicious"&&(s=!0))}s&&this.config?.mode==="ips"&&(this.blockIP(e.source,n?.description||"Intrusion detected",n?.signatureId),this.stats.alertsBlocked++,n=n?{...n,blocked:!0}:void 0),n&&this.shouldGenerateAlert(n.severity)&&this.addAlert(n);const a=performance.now()-t;return{allowed:!s,blocked:s,alertGenerated:!!n,latency:a,alert:n}}detectSignature(e){const t=Array.from(this.signatures.values()).filter(n=>n.enabled).sort((n,s)=>{const a={critical:4,high:3,medium:2,low:1};return a[s.severity]-a[n.severity]});for(const n of t)if(!(n.protocol&&n.protocol!=="all"&&n.protocol!==e.protocol)&&!(n.sourceIP&&!this.matchIP(e.source,n.sourceIP))&&!(n.destinationIP&&!this.matchIP(e.destination,n.destinationIP))&&!(n.port!==void 0&&e.port!==void 0&&n.port!==e.port)&&!(n.sourcePort!==void 0&&e.sourcePort!==void 0&&n.sourcePort!==e.sourcePort)){if(n.pattern&&e.payload)try{if(new RegExp(n.pattern,"i").test(e.payload))return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:n.severity,timestamp:e.timestamp||Date.now(),description:n.description||`Signature match: ${n.name}`,blocked:!1,signature:n.name,signatureId:n.id}}catch{}else if(!n.pattern)return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:n.severity,timestamp:e.timestamp||Date.now(),description:n.description||`Signature match: ${n.name}`,blocked:!1,signature:n.name,signatureId:n.id}}return null}detectAnomaly(e){let t=0;const n=[22,23,80,443,3306,5432,27017,6379,8080];if(e.port&&n.includes(e.port)&&(t+=.2),e.protocol==="icmp"&&(t+=.1),e.payload){const a=e.payload.length;(a>1e4||a<10)&&(t+=.3)}if(e.payload){const a=["SELECT","UNION","DROP","DELETE","INSERT","UPDATE","<script","eval(","base64"];for(const c of a)if(e.payload.toLowerCase().includes(c.toLowerCase())){t+=.4;break}}const s=this.getAnomalyThreshold();if(t>=s){const a=t>=.8?"critical":t>=.6?"high":"medium";return{id:`alert-${Date.now()}-${Math.random()}`,type:"anomaly",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:a,timestamp:e.timestamp||Date.now(),description:`Anomaly detected: unusual network activity (score: ${t.toFixed(2)})`,blocked:!1,anomalyScore:t}}return null}detectBehavioral(e){const t=`${e.source}-${e.destination}-${e.protocol}-${e.port||"any"}`,n=Date.now();let s=this.behavioralPatterns.get(t);s||(s={sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,requestCount:0,firstSeen:n,lastSeen:n,suspiciousScore:0},this.behavioralPatterns.set(t,s)),s.requestCount++,s.lastSeen=n,this.behavioralPatterns.size>this.MAX_BEHAVIORAL_PATTERNS&&this.cleanOldBehavioralPatterns();const a=(n-s.firstSeen)/1e3,c=a>0?s.requestCount/a:s.requestCount;return c>10&&(s.suspiciousScore=Math.min(1,c/100)),s.suspiciousScore>.7?{id:`alert-${Date.now()}-${Math.random()}`,type:"behavioral",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:s.suspiciousScore>.9?"critical":"high",timestamp:n,description:`Behavioral pattern detected: high request rate (${c.toFixed(2)} req/s)`,blocked:!1,behavioralPattern:"suspicious"}:null}isIPBlocked(e){return this.cleanExpiredBlocks(),this.blockedIPs.has(e)}blockIP(e,t,n){const s=Date.now()+(this.config?.blockDuration||3600)*1e3;this.blockedIPs.set(e,{ip:e,reason:t,blockedAt:Date.now(),expiresAt:s}),this.stats.blockedIPs=this.blockedIPs.size}cleanExpiredBlocks(){const e=Date.now();for(const[t,n]of this.blockedIPs.entries())n.expiresAt<e&&this.blockedIPs.delete(t);this.stats.blockedIPs=this.blockedIPs.size}cleanOldBehavioralPatterns(){const e=Date.now();for(const[t,n]of this.behavioralPatterns.entries())e-n.lastSeen>this.BEHAVIORAL_WINDOW_MS&&this.behavioralPatterns.delete(t)}shouldGenerateAlert(e){const t=this.config?.alertThreshold||"medium",n={critical:4,high:3,medium:2,low:1},s={critical:4,high:3,medium:2,low:1};return n[e]>=s[t]}getAnomalyThreshold(){const e=this.config?.alertThreshold||"medium";return{low:.9,medium:.7,high:.5,critical:.3}[e]}matchIP(e,t){if(e===t)return!0;if(t.includes("/")){const[n,s]=t.split("/"),a=parseInt(s,10);return e.startsWith(n.split(".").slice(0,Math.floor(a/8)).join("."))}return!1}addAlert(e){this.alerts.push(e),this.alerts.length>this.MAX_ALERTS&&this.alerts.shift()}getAlerts(e=100){return this.alerts.slice(-e).reverse()}getBlockedIPs(){return this.cleanExpiredBlocks(),Array.from(this.blockedIPs.values())}unblockIP(e){this.blockedIPs.delete(e),this.stats.blockedIPs=this.blockedIPs.size}getStats(){return{...this.stats}}getSignatures(){return Array.from(this.signatures.values())}resetStats(){this.stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.stats.activeSignatures,blockedIPs:this.blockedIPs.size}}}class lT{config=null;routingEngine;metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new cT}initializeConfig(e){const t=e.data.config||{};this.config={mode:t.mode||"ids",enableSignatureDetection:t.enableSignatureDetection??!0,enableAnomalyDetection:t.enableAnomalyDetection??!0,enableBehavioralAnalysis:t.enableBehavioralAnalysis??!1,alertThreshold:t.alertThreshold||"medium",enableAutoBlock:t.enableAutoBlock??!1,blockDuration:t.blockDuration||3600,enableLogging:t.enableLogging??!0,logRetention:t.logRetention||30,signatures:Array.isArray(t.signatures)?t.signatures:[],blockedIPs:Array.isArray(t.blockedIPs)?t.blockedIPs:[]},this.routingEngine.initializeConfig(e),this.updateMetricsFromStats()}processPacket(e){const t=performance.now(),n={source:e.source,destination:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,payload:e.payload,timestamp:Date.now()},s=this.routingEngine.processPacket(n),a=performance.now()-t+s.latency;this.recordLatency(a),this.metrics.packetsTotal++,s.alertGenerated&&this.metrics.alertsGenerated++,s.blocked&&this.metrics.alertsBlocked++;const c=Date.now();return this.firstPacketTime||(this.firstPacketTime=c),this.lastPacketTime=c,this.updateMetricsFromStats(),{success:s.allowed,blocked:s.blocked,latency:a,alertGenerated:s.alertGenerated,error:s.error}}simulatePackets(e){const t=Date.now(),n=t-this.lastSimulationTime;if(this.lastSimulationTime=t,n<=0||e<=0)return;const s=Math.floor(e*n/1e3);if(s!==0){for(let a=0;a<s;a++){const c=this.generateRandomPacket();this.processPacket(c)}this.updateMetricsFromStats()}}generateRandomPacket(){const e=["tcp","udp","icmp"],t=e[Math.floor(Math.random()*e.length)],n=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,s=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,a=t==="icmp"?void 0:Math.floor(Math.random()*65535),c=t==="icmp"?void 0:Math.floor(Math.random()*65535),l=Math.random()<.05;let d;if(l){const f=["SELECT * FROM users WHERE id = 1 OR 1=1",'<script>alert("XSS")<\/script>',"DROP TABLE users","UNION SELECT password FROM users","../../../etc/passwd","eval(base64_decode("];d=f[Math.floor(Math.random()*f.length)]}else Math.random()<.3&&(d=`GET /api/data HTTP/1.1\r
Host: example.com\r
User-Agent: Mozilla/5.0`);return{source:n,destination:s,protocol:t,port:a,sourcePort:c,payload:d}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const t=this.latencyHistory.reduce((n,s)=>n+s,0);this.metrics.averageLatency=t/this.latencyHistory.length}updateMetricsFromStats(){const e=this.routingEngine.getStats();this.metrics.packetsTotal=e.totalPackets,this.metrics.packetsAnalyzed=e.packetsAnalyzed,this.metrics.alertsGenerated=e.alertsGenerated,this.metrics.alertsBlocked=e.alertsBlocked,this.metrics.signatureMatches=e.signatureMatches,this.metrics.anomalyDetections=e.anomalyDetections,this.metrics.behavioralDetections=e.behavioralDetections,this.metrics.activeSignatures=e.activeSignatures,this.metrics.blockedIPs=e.blockedIPs}calculateLoad(){let e=0;if(this.firstPacketTime&&this.lastPacketTime&&this.lastPacketTime>this.firstPacketTime){const c=(this.lastPacketTime-this.firstPacketTime)/1e3;c>0&&(e=this.metrics.packetsTotal/c)}e===0&&this.simulatedPacketRate>0&&(e=this.simulatedPacketRate);const t=this.metrics.averageLatency||5,n=this.config?.mode==="ips"&&this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,s=this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,a=this.metrics.packetsTotal>0?this.metrics.alertsGenerated/this.metrics.packetsTotal:0;return{packetsPerSecond:e,averageLatency:t,errorRate:n,blockRate:s,alertRate:a}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getAlerts(e=100){return this.routingEngine.getAlerts(e)}getStats(){return this.routingEngine.getStats()}getBlockedIPs(){return this.routingEngine.getBlockedIPs()}unblockIP(e){this.routingEngine.unblockIP(e),this.updateMetricsFromStats()}setSimulatedPacketRate(e){this.simulatedPacketRate=e}resetMetrics(){this.metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.metrics.activeSignatures,blockedIPs:this.metrics.blockedIPs,averageLatency:0},this.latencyHistory=[],this.firstPacketTime=null,this.lastPacketTime=null,this.routingEngine.resetStats()}}class uT{config=null;metrics={readRequestsTotal:0,writeRequestsTotal:0,deleteRequestsTotal:0,listRequestsTotal:0,authRequestsTotal:0,authErrorsTotal:0,tokenIssuedTotal:0,tokenRenewedTotal:0,tokenRevokedTotal:0,encryptionOperationsTotal:0,decryptionOperationsTotal:0,activeTokens:0,secretsTotal:0};tokens=new Map;secrets=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(e){const t=e.data.config||{},n=Array.isArray(t.secrets)?t.secrets.map(l=>({id:String(l.id??`secret-${Date.now()}`),path:String(l.path??"secret/default"),key:String(l.key??"key"),value:String(l.value??""),version:Number(l.version??1),created:l.created?String(l.created):new Date().toISOString(),updated:l.updated?String(l.updated):new Date().toISOString(),visible:l.visible??!1})):[],s=Array.isArray(t.engines)?t.engines.map(l=>({id:String(l.id??`engine-${Date.now()}`),name:String(l.name??"secret/"),type:l.type??"kv",enabled:l.enabled??!0,version:l.version?Number(l.version):void 0,description:l.description?String(l.description):void 0})):[{id:"1",name:"secret/",type:"kv",enabled:t.enableKV??!0,version:t.kvVersion==="1"?1:2,description:"Key-Value secrets"}],a=Array.isArray(t.policies)?t.policies.map(l=>({id:String(l.id??`policy-${Date.now()}`),name:String(l.name??"default"),rules:String(l.rules??'path "*" { capabilities = ["read"] }'),enabled:l.enabled??!0})):[{id:"1",name:"default",rules:'path "*" { capabilities = ["read", "list"] }',enabled:!0}],c=String(t.tokenTTL||"24h");this.parseTTL(c),this.config={vaultType:t.vaultType||"hashicorp",address:String(t.address||"http://vault:8200"),enableTLS:t.enableTLS??!1,enableTransit:t.enableTransit??!0,enableKV:t.enableKV??!0,kvVersion:String(t.kvVersion||"2"),enablePKI:t.enablePKI??!1,enableAuth:t.enableAuth??!0,authMethod:t.authMethod||"token",tokenTTL:c,secrets:n,engines:s,policies:a},this.secrets.clear(),n.forEach(l=>{this.secrets.set(l.id,l)}),this.metrics.secretsTotal=n.length,this.cleanupExpiredTokens(Date.now())}processReadRequest(e,t,n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const a=this.config;if(!a)return this.recordLatency(50),this.metrics.readRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(a.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.readRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const c=Array.from(this.secrets.values()).find(p=>p.path===e&&(!t||p.key===t)),l=15,d=(Math.random()-.5)*10,f=Math.max(5,l+d);return this.recordLatency(f),this.metrics.readRequestsTotal++,c?{success:!0,latency:f,data:{[c.key]:c.value,version:c.version}}:{success:!1,latency:f,error:`Secret not found at path: ${e}`}}processWriteRequest(e,t,n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const a=this.config;if(!a)return this.recordLatency(60),this.metrics.writeRequestsTotal++,{success:!1,latency:60,error:"Vault not configured"};if(a.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.writeRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};if(!a.enableKV)return this.recordLatency(20),this.metrics.writeRequestsTotal++,{success:!1,latency:20,error:"KV engine is not enabled"};const c=25,l=(Math.random()-.5)*15,d=Math.max(10,c+l);this.recordLatency(d),this.metrics.writeRequestsTotal++;const f=Array.from(this.secrets.values()).find(p=>p.path===e&&p.key===Object.keys(t)[0]);if(f)f.value=Object.values(t)[0],f.version=(f.version||1)+1,f.updated=new Date().toISOString(),this.secrets.set(f.id,f);else{const p={id:`secret-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,path:e,key:Object.keys(t)[0],value:Object.values(t)[0],version:1,created:new Date().toISOString(),updated:new Date().toISOString(),visible:!1};this.secrets.set(p.id,p),this.metrics.secretsTotal=this.secrets.size}return{success:!0,latency:d,data:{path:e,version:f?.version||1}}}processDeleteRequest(e,t){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const s=this.config;if(!s)return this.recordLatency(50),this.metrics.deleteRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(s.enableAuth&&t&&!this.validateToken(t,n))return this.recordLatency(30),this.metrics.deleteRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const a=20,c=(Math.random()-.5)*10,l=Math.max(8,a+c);this.recordLatency(l),this.metrics.deleteRequestsTotal++;const d=Array.from(this.secrets.values()).find(f=>f.path===e);return d?(this.secrets.delete(d.id),this.metrics.secretsTotal=this.secrets.size,{success:!0,latency:l}):{success:!1,latency:l,error:`Secret not found at path: ${e}`}}processAuthRequest(e,t){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const s=this.config;if(!s)return this.recordLatency(50),this.metrics.authRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!s.enableAuth)return this.recordLatency(20),this.metrics.authRequestsTotal++,{success:!1,latency:20,error:"Authentication is not enabled"};let a=40;e==="ldap"?a=80:e==="approle"?a=50:e==="aws"&&(a=60);const c=(Math.random()-.5)*20,l=Math.max(15,a+c);this.recordLatency(l),this.metrics.authRequestsTotal++;const d=this.parseTTL(s.tokenTTL),f=`vault-token-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,p={id:f,token:f,policies:s.policies.filter(m=>m.enabled).map(m=>m.name),ttl:d,renewable:!0,createdAt:n,expiresAt:n+d*1e3};return this.tokens.set(f,p),this.metrics.tokenIssuedTotal++,this.metrics.activeTokens=this.tokens.size,{success:!0,latency:l,token:f,policies:p.policies}}processEncryptRequest(e,t="default",n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const a=this.config;if(!a)return this.recordLatency(50),this.metrics.encryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!a.enableTransit)return this.recordLatency(20),this.metrics.encryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(a.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.encryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const c=e.length,l=30+Math.min(100,c/100),d=(Math.random()-.5)*15,f=Math.max(15,l+d);this.recordLatency(f),this.metrics.encryptionOperationsTotal++;const p=Buffer.from(e).toString("base64");return{success:!0,latency:f,data:{ciphertext:`vault:v1:${p}`,key:t}}}processDecryptRequest(e,t="default",n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const a=this.config;if(!a)return this.recordLatency(50),this.metrics.decryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!a.enableTransit)return this.recordLatency(20),this.metrics.decryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(a.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.decryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const c=25+Math.min(80,e.length/150),l=(Math.random()-.5)*12,d=Math.max(12,c+l);this.recordLatency(d),this.metrics.decryptionOperationsTotal++;const f=e.replace(/^vault:v1:/,"");let p;try{p=Buffer.from(f,"base64").toString("utf-8")}catch{return{success:!1,latency:d,error:"Invalid ciphertext format"}}return{success:!0,latency:d,data:{plaintext:p,key:t}}}calculateLoad(){const e=this.metrics,t=e.readRequestsTotal+e.writeRequestsTotal+e.deleteRequestsTotal+e.listRequestsTotal+e.authRequestsTotal+e.encryptionOperationsTotal+e.decryptionOperationsTotal,n=t>0?Math.min(1,e.authErrorsTotal/t):0,s=this.latencyHistory.length>0?this.latencyHistory.reduce((l,d)=>l+d,0)/this.latencyHistory.length:0;let a=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const l=(this.lastRequestTime-this.firstRequestTime)/1e3;a=t/Math.max(l,1)}const c=this.config?.engines.filter(l=>l.enabled).length||0;return{requestsPerSecond:a,averageLatency:s,errorRate:n,activeTokens:this.metrics.activeTokens,secretsCount:this.metrics.secretsTotal,enginesEnabled:c}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}getSecrets(){return Array.from(this.secrets.values())}getActiveTokens(){const e=Date.now();return this.cleanupExpiredTokens(e),Array.from(this.tokens.values())}parseTTL(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 86400;const n=parseInt(t[1],10);switch(t[2]){case"s":return n;case"m":return n*60;case"h":return n*3600;case"d":return n*86400;default:return 86400}}validateToken(e,t){const n=this.tokens.get(e);return n?t>n.expiresAt?(this.tokens.delete(e),this.metrics.activeTokens=this.tokens.size,!1):!0:!1}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}cleanupExpiredTokens(e){let t=0;for(const[n,s]of this.tokens.entries())e>s.expiresAt&&(this.tokens.delete(n),t++);t>0&&(this.metrics.tokenRevokedTotal+=t,this.metrics.activeTokens=this.tokens.size)}}class dT{config=null;pipelines=new Map;activeBuilds=new Map;nodes=new Map;plugins=new Map;jenkinsMetrics={buildsTotal:0,buildsSuccess:0,buildsFailed:0,buildsRunning:0,buildsPending:0,buildsPerMinute:0,averageBuildDuration:0,executorUtilization:0,executorIdle:0,executorBusy:0,pipelinesTotal:0,pipelinesEnabled:0,nodesTotal:0,nodesOnline:0,pluginsTotal:0,pluginsActive:0,artifactStorageBytes:0,requestsTotal:0,requestsErrors:0};processRequest(e=!0){this.jenkinsMetrics.requestsTotal++,e||this.jenkinsMetrics.requestsErrors++}buildHistory=[];MAX_BUILD_HISTORY=1e3;lastBuildTrigger=new Map;buildTriggerCounter=0;artifacts=new Map;initializeConfig(e){const t=e.data.config||{};this.config={jenkinsUrl:t.jenkinsUrl||"http://jenkins:8080",enableCSRF:t.enableCSRF??!0,executorCount:t.executorCount||2,enablePlugins:t.enablePlugins??!0,plugins:t.plugins||["git","docker","kubernetes"],enablePipeline:t.enablePipeline??!0,enableBlueOcean:t.enableBlueOcean??!1,enableArtifactArchiving:t.enableArtifactArchiving??!0,retentionDays:t.retentionDays||30,pipelines:t.pipelines||[],nodes:t.nodes||[],buildTriggerRate:t.buildTriggerRate||.5,averageBuildDuration:t.averageBuildDuration||12e4,failureRate:t.failureRate||.1},this.initializePipelines(),this.initializeNodes(),this.initializePlugins()}initializePipelines(){if(this.pipelines.clear(),!this.config||!this.config.enablePipeline)return;const e=this.config.pipelines||[];for(const t of e){const n=t.lastBuild||0,s={id:t.id,name:t.name,status:"pending",lastBuild:n,lastSuccessfulBuild:void 0,lastFailedBuild:void 0,duration:void 0,branch:t.branch||"main",enabled:t.enabled!==!1,builds:[],nextBuildNumber:n+1};s.config={triggers:t.triggers||[],parameters:t.parameters||[],environmentVariables:t.environmentVariables||{},postBuildActions:t.postBuildActions||[]},this.pipelines.set(s.id,s)}}calculatePipelineStatus(e){return e.builds.length===0?Array.from(this.activeBuilds.values()).find(s=>s.pipelineId===e.id&&s.status==="running")?"running":"pending":e.builds[e.builds.length-1].status}initializeNodes(){this.nodes.clear();const e={id:"master",name:"master",status:"online",numExecutors:this.config?.executorCount||2,busyExecutors:0,idleExecutors:this.config?.executorCount||2,labels:["master"]};this.nodes.set("master",e);const t=this.config?.nodes||[];for(const n of t){const s={id:n.id,name:n.name,status:"online",numExecutors:n.numExecutors||1,busyExecutors:0,idleExecutors:n.numExecutors||1,labels:n.labels||[]};this.nodes.set(s.id,s)}}initializePlugins(){if(this.plugins.clear(),!this.config||!this.config.enablePlugins)return;const e={git:{version:"4.11.0",description:"Git integration plugin"},docker:{version:"1.2.9",description:"Docker pipeline plugin",dependencies:["workflow-aggregator"]},kubernetes:{version:"1.31.1",description:"Kubernetes plugin for dynamic agent provisioning"},"workflow-aggregator":{version:"2.6",description:"Pipeline plugin aggregator"},"blue-ocean":{version:"1.25.3",description:"Blue Ocean UI for Jenkins",dependencies:["workflow-aggregator"]},credentials:{version:"2.6.1",description:"Credentials management plugin"},"ssh-slaves":{version:"1.32.0",description:"SSH agent plugin"},junit:{version:"1.53",description:"JUnit test result publisher"},"maven-plugin":{version:"3.20",description:"Maven integration plugin"},gradle:{version:"1.36.1",description:"Gradle plugin"}},t=this.config.plugins||[];for(const n of t){let s,a=!0;typeof n=="string"?s=n:(s=n.name||n,a=n.enabled!==!1);const c=e[s]||{version:"1.0.0",description:`${s} plugin`},l={name:s,version:c.version,description:c.description,enabled:a,active:a,dependencies:c.dependencies};this.plugins.set(s,l)}this.updatePluginActiveStatus()}updatePluginActiveStatus(){for(const e of this.plugins.values()){if(!e.enabled){e.active=!1;continue}if(e.dependencies&&e.dependencies.length>0){const t=e.dependencies.every(n=>{const s=this.plugins.get(n);return s&&s.enabled&&s.active});e.active=t}else e.active=e.enabled}}addPlugin(e,t,n){if(this.plugins.has(e))return!1;const s={name:e,version:t||"1.0.0",description:n||`${e} plugin`,enabled:!0,active:!0};return this.plugins.set(e,s),this.updatePluginActiveStatus(),!0}removePlugin(e){if(!this.plugins.get(e))return{success:!1,reason:"Plugin not found"};const n=Array.from(this.plugins.values()).filter(s=>s.dependencies?.includes(e));return n.length>0?{success:!1,reason:`Cannot remove plugin. It is required by: ${n.map(s=>s.name).join(", ")}`}:(this.plugins.delete(e),this.updatePluginActiveStatus(),{success:!0})}setPluginEnabled(e,t){const n=this.plugins.get(e);return n?(n.enabled=t,this.updatePluginActiveStatus(),!0):!1}performUpdate(e){this.config&&(this.updateActiveBuilds(e),this.config.enablePipeline&&this.triggerBuilds(e),this.config.enableArtifactArchiving&&this.cleanupArtifacts(e),this.updateMetrics())}updateActiveBuilds(e){const t=Array.from(this.activeBuilds.entries());for(const[n,s]of t)if(s.status==="running")try{s.startTime&&(e-s.startTime)%5e3<100&&this.updateBuildLogs(s,e);const a=e-s.startTime,c=s.estimatedDuration||this.config?.averageBuildDuration||12e4;if(a<0)continue;if(s.progress=Math.min(100,Math.max(0,Math.floor(a/c*100))),a>=c){const l=Math.random()<(this.config?.failureRate||.1);if(s.status=l?"failed":"success",s.duration=a,s.progress=100,s.logs&&(l?(s.logs.push("[Pipeline] FAILED"),s.logs.push(`Build failed after ${(a/1e3).toFixed(1)}s`)):(s.logs.push("[Pipeline] SUCCESS"),s.logs.push(`Build completed successfully in ${(a/1e3).toFixed(1)}s`)),s.logs.push(`Finished: ${s.status}`)),s.stages)for(const f of s.stages)(f.status==="running"||f.status==="pending")&&(f.status=s.status,f.startTime&&(f.duration=e-f.startTime));this.executePostBuildActions(s,s.status==="success");const d=this.pipelines.get(s.pipelineId);d&&(d.lastBuild=s.number,s.status==="success"?d.lastSuccessfulBuild=s.number:s.status==="failed"&&(d.lastFailedBuild=s.number),d.duration=s.duration,d.builds.push(s),d.builds.length>50&&d.builds.shift(),d.status=this.calculatePipelineStatus(d)),this.freeExecutor(n),this.addBuildToHistory(s),this.activeBuilds.delete(n)}}catch(a){console.error(`Error updating build ${n}:`,a),s.status="failed",this.activeBuilds.delete(n),this.freeExecutor(n)}}triggerBuilds(e){if(!(!this.config||!this.config.enablePipeline))for(const[t,n]of this.pipelines.entries()){if(!n.enabled)continue;const a=(n.config||{}).triggers||[];let c=!1;if(a.length===0){const l=this.config.buildTriggerRate||0;if(l>0){const d=6e4/l,f=this.lastBuildTrigger.get(t)||0;e-f>=d&&(c=!0)}}else for(const l of a)if(l.enabled){if(l.type==="cron"&&l.config?.schedule)c=this.shouldTriggerCron(l.config.schedule,t,e);else if(l.type==="scm"&&l.config?.pollInterval){const d=l.config.pollInterval*60*1e3,f=this.lastBuildTrigger.get(`${t}-scm`)||0;e-f>=d&&(c=!0,this.lastBuildTrigger.set(`${t}-scm`,e))}}c&&this.hasAvailableExecutor()&&(this.startBuild(t,e),this.lastBuildTrigger.set(t,e))}}shouldTriggerCron(e,t,n){const s=this.lastBuildTrigger.get(`${t}-cron`)||0,a=60*1e3;return n-s>=a?(this.lastBuildTrigger.set(`${t}-cron`,n),!0):!1}triggerWebhook(e,t,n){const s=this.pipelines.get(e);if(!s)return{success:!1,reason:"Pipeline not found"};if(!s.enabled)return{success:!1,reason:"Pipeline is disabled"};const c=(s.config||{}).triggers||[],l=c.find(f=>f.type==="webhook"&&f.enabled);if(!l&&c.length>0)return{success:!1,reason:"Webhook trigger not configured or disabled"};if(l?.config?.branches&&t&&!l.config.branches.includes(t))return{success:!1,reason:`Branch ${t} not in allowed branches`};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const d=Date.now();return this.startBuild(e,d,{branch:t,commit:n,triggeredBy:"webhook"}),{success:!0}}triggerBuildManually(e){const t=this.pipelines.get(e);if(!t)return{success:!1,reason:"Pipeline not found"};if(!t.enabled)return{success:!1,reason:"Pipeline is disabled"};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const n=Date.now();return this.startBuild(e,n),{success:!0,buildId:`${e}-${t.nextBuildNumber-1}`}}startBuild(e,t,n){const s=this.pipelines.get(e);if(!s)return;const a=s.nextBuildNumber++,c=`${e}-${a}`,l=this.config?.averageBuildDuration||12e4,d=l*.3,f=l+(Math.random()*2-1)*d,p=this.generateBuildLogs(a,s.name,s.branch||"main"),m=this.generateArtifacts(s.name,a),y=s.config||{},b=n?.parameters||{},S=y.parameters||[],M={};for(const T of S)T.defaultValue!==void 0&&(M[T.name]=T.defaultValue);Object.assign(M,b);const E={...y.environmentVariables||{},...M},C={id:c,number:a,pipelineId:e,status:"running",startTime:t,estimatedDuration:f,progress:0,branch:n?.branch||s.branch,commit:n?.commit,logs:p,artifacts:m.map(T=>T.name),triggeredBy:n?.triggeredBy||"system",stages:[{name:"Checkout",status:"running",startTime:t},{name:"Build",status:"pending"},{name:"Test",status:"pending"},{name:"Deploy",status:"pending"}]};C.parameters=M,C.environmentVariables=E,C.postBuildActions=y.postBuildActions||[];for(const T of m)this.artifacts.set(`${c}-${T.name}`,{size:T.size,created:t});this.activeBuilds.set(c,C),s.status=this.calculatePipelineStatus(s),this.allocateExecutor(c),this.jenkinsMetrics.buildsTotal++,this.jenkinsMetrics.buildsRunning++}generateBuildLogs(e,t,n){const s=[];return s.push("Started by system"),s.push(`Building on master in workspace /var/jenkins_home/workspace/${t}`),s.push(`[${t}] $ /usr/bin/git rev-parse --is-inside-work-tree`),s.push("true"),s.push(`[${t}] $ /usr/bin/git config remote.origin.url https://github.com/example/${t}.git`),s.push(`[${t}] $ /usr/bin/git --version`),s.push("git version 2.39.0"),s.push(`[${t}] $ /usr/bin/git fetch --tags --force --progress -- https://github.com/example/${t}.git +refs/heads/${n}:refs/remotes/origin/${n}`),s.push(`From https://github.com/example/${t}`),s.push(` * [new branch]      ${n}       -> origin/${n}`),s.push(`[${t}] $ /usr/bin/git rev-parse "refs/remotes/origin/${n}^{commit}"`),s.push("abc123def456789"),s.push(`[${t}] $ /usr/bin/git checkout -f abc123def456789`),s.push(`HEAD is now at abc123def456789 Commit message for build #${e}`),s.push(`[${t}] $ /usr/bin/git clean -fdx`),s.push("Removing .gradle/"),s.push("Removing build/"),s.push("[Pipeline] Start of Pipeline"),s.push("[Pipeline] node"),s.push(`Running on Jenkins in /var/jenkins_home/workspace/${t}`),s.push("[Pipeline] {"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Checkout)"),s.push("[Pipeline] checkout"),s.push(`Checking out abc123def456789 from ${n}`),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Build)"),s.push("[Pipeline] sh"),s.push('+ echo "Building application..."'),s.push("Building application..."),s.push("[Pipeline] sh"),s.push("+ ./gradlew build -x test"),s.push("> Task :compileJava"),s.push("> Task :processResources"),s.push("> Task :classes"),s.push("> Task :jar"),s.push("BUILD SUCCESSFUL in 45s"),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Test)"),s.push("[Pipeline] sh"),s.push('+ echo "Running tests..."'),s.push("Running tests..."),s.push("[Pipeline] sh"),s.push("+ ./gradlew test"),s.push("> Task :test"),s.push("Test results: 127 passed, 0 failed"),s.push("BUILD SUCCESSFUL in 30s"),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Deploy)"),s.push("[Pipeline] sh"),s.push('+ echo "Deploying to staging..."'),s.push("Deploying to staging..."),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] }"),s.push("[Pipeline] // node"),s.push("[Pipeline] End of Pipeline"),s}generateArtifacts(e,t){const n=[];return n.push({name:`app-${t}.jar`,size:15*1024*1024}),n.push({name:`app-${t}-sources.jar`,size:3*1024*1024}),n.push({name:`test-results-${t}.xml`,size:512*1024}),n.push({name:`coverage-report-${t}.html`,size:2*1024*1024}),n}cancelBuild(e){const t=this.activeBuilds.get(e);if(!t)return{success:!1,reason:"Build not found or already completed"};if(t.status!=="running"&&t.status!=="pending")return{success:!1,reason:"Build is not running"};if(t.status="aborted",t.duration=Date.now()-t.startTime,t.progress=0,t.logs&&(t.logs.push("[Pipeline] Aborted by user"),t.logs.push("[Pipeline] Terminated")),t.stages)for(const s of t.stages)(s.status==="running"||s.status==="pending")&&(s.status="aborted");this.freeExecutor(e);const n=this.pipelines.get(t.pipelineId);return n&&(n.builds.push(t),n.builds.length>50&&n.builds.shift(),n.status=this.calculatePipelineStatus(n),!n.builds.some(a=>a.status==="success")&&n.builds.every(a=>a.status==="aborted"||a.status==="failed")&&(n.status="pending")),this.activeBuilds.delete(e),this.jenkinsMetrics.buildsRunning--,{success:!0}}updateBuildLogs(e,t){if(!e.logs||e.status!=="running")return;const n=t-e.startTime,s=e.estimatedDuration||12e4,a=Math.min(100,Math.floor(n/s*100)),c=[10,30,50,70,90];for(const l of c)a>=l&&!e.logs.some(d=>d.includes(`Progress: ${l}%`))&&e.logs.push(`[Pipeline] Progress: ${l}% completed`);if(e.stages){const l=Math.floor(a/(100/e.stages.length));for(let d=0;d<e.stages.length;d++)(d<l&&e.stages[d].status==="pending"||d===l&&e.stages[d].status==="pending")&&(e.stages[d].status="running",e.stages[d].startTime=t)}}getBuildLogs(e){return this.getBuildById(e)?.logs}getBuildArtifacts(e){const t=this.getBuildById(e);if(!t||!t.artifacts)return[];const n=[];for(const s of t.artifacts){const a=`${e}-${s}`,c=this.artifacts.get(a);c&&n.push({name:s,size:c.size})}return n}executePostBuildActions(e,t){const n=e.postBuildActions||[];for(const s of n)if(s.enabled)switch(s.type){case"email":if(e.logs){const a=s.config?.recipients||["default@example.com"];e.logs.push(`[Post-Build] Sending email notification to: ${a.join(", ")}`),e.logs.push(`[Post-Build] Email subject: Build ${e.status==="success"?"SUCCESS":"FAILED"} - ${e.pipelineId} #${e.number}`)}break;case"archive":if(e.logs){const a=s.config?.archivePattern||"**/*";e.logs.push(`[Post-Build] Archiving artifacts matching pattern: ${a}`),e.artifacts&&e.artifacts.length>0&&e.logs.push(`[Post-Build] Archived ${e.artifacts.length} artifact(s)`)}break;case"publish":if(e.logs){const a=s.config?.publishTarget||"default";e.logs.push(`[Post-Build] Publishing test results to: ${a}`),e.logs.push("[Post-Build] Published build metrics and artifacts")}break;case"deploy":if(t&&s.config?.deployEnv){if(e.logs){const a=s.config.deployEnv;e.logs.push(`[Post-Build] Deploying to environment: ${a}`),e.logs.push(`[Post-Build] Deployment initiated for build #${e.number}`),e.logs.push(`[Post-Build] Deployment to ${a} completed successfully`)}}else t||e.logs&&e.logs.push("[Post-Build] Skipping deployment - build failed");break}}getPipelineConfig(e){const t=this.pipelines.get(e);return t?t.config||{}:null}updatePipelineConfig(e,t){const n=this.pipelines.get(e);return n?(n.config={...n.config||{},...t},!0):!1}hasAvailableExecutor(){for(const e of this.nodes.values())if(e.idleExecutors>0)return!0;return!1}allocateExecutor(e){for(const t of this.nodes.values())if(t.idleExecutors>0){t.idleExecutors--,t.busyExecutors++;return}}freeExecutor(e){for(const t of this.nodes.values())if(t.busyExecutors>0){t.busyExecutors--,t.idleExecutors++;return}}addBuildToHistory(e){e.duration&&(this.buildHistory.push({timestamp:e.startTime,duration:e.duration,status:e.status}),this.buildHistory.length>this.MAX_BUILD_HISTORY&&this.buildHistory.shift(),e.status==="success"?this.jenkinsMetrics.buildsSuccess++:e.status==="failed"&&this.jenkinsMetrics.buildsFailed++,this.jenkinsMetrics.buildsRunning--)}cleanupArtifacts(e){if(!this.config)return;const t=(this.config.retentionDays||30)*24*60*60*1e3;for(const[n,s]of this.artifacts.entries())e-s.created>t&&this.artifacts.delete(n)}updateMetrics(){this.jenkinsMetrics.buildsRunning=this.activeBuilds.size,this.jenkinsMetrics.buildsPending=Array.from(this.activeBuilds.values()).filter(d=>d.status==="pending").length;const e=this.buildHistory.length;this.jenkinsMetrics.buildsTotal=e+this.activeBuilds.size;const t=Date.now()-6e4,n=this.buildHistory.filter(d=>d.timestamp>t);if(this.jenkinsMetrics.buildsPerMinute=n.length,this.buildHistory.length>0){const d=this.buildHistory.slice(-100),f=d.reduce((p,m)=>p+m.duration,0)/d.length;this.jenkinsMetrics.averageBuildDuration=f}let s=0,a=0,c=0;for(const d of this.nodes.values())s+=d.numExecutors,a+=d.busyExecutors,c+=d.idleExecutors;this.jenkinsMetrics.executorBusy=a,this.jenkinsMetrics.executorIdle=c,this.jenkinsMetrics.executorUtilization=s>0?a/s*100:0,this.jenkinsMetrics.pipelinesTotal=this.pipelines.size,this.jenkinsMetrics.pipelinesEnabled=Array.from(this.pipelines.values()).filter(d=>d.enabled).length,this.jenkinsMetrics.nodesTotal=this.nodes.size,this.jenkinsMetrics.nodesOnline=Array.from(this.nodes.values()).filter(d=>d.status==="online").length,this.jenkinsMetrics.pluginsTotal=this.plugins.size,this.jenkinsMetrics.pluginsActive=Array.from(this.plugins.values()).filter(d=>d.active).length;let l=0;for(const d of this.artifacts.values())l+=d.size;this.jenkinsMetrics.artifactStorageBytes=l}getJenkinsMetrics(){return{...this.jenkinsMetrics}}getPipelines(){for(const e of this.pipelines.values())e.status=this.calculatePipelineStatus(e);return Array.from(this.pipelines.values())}getActiveBuilds(){return Array.from(this.activeBuilds.values())}getNodes(){return Array.from(this.nodes.values())}getPlugins(){return Array.from(this.plugins.values())}getPipelineBuilds(e){const t=this.pipelines.get(e);return t?t.builds:[]}getAllBuilds(){const e=[];e.push(...Array.from(this.activeBuilds.values()));for(const t of this.pipelines.values()){const n=t.builds.slice(-50);e.push(...n)}return e.sort((t,n)=>{const s=t.startTime||0;return(n.startTime||0)-s})}getBuildById(e){if(this.activeBuilds.has(e))return this.activeBuilds.get(e);for(const t of this.pipelines.values()){const n=t.builds.find(s=>s.id===e);if(n)return n}}updateConfig(e){const t=this.config,n=new Set(this.pipelines.keys());this.initializeConfig(e);const s=this.config?.executorCount||2;t&&t.executorCount!==s&&this.updateExecutorCount(s);const a=new Set(this.pipelines.keys());for(const f of n)if(!a.has(f)){for(const[p,m]of this.activeBuilds.entries())m.pipelineId===f&&(m.status="aborted",this.freeExecutor(p),this.activeBuilds.delete(p));this.pipelines.delete(f)}const c=this.config?.pipelines||[];for(const f of c){const p=this.pipelines.get(f.id);p&&(p.name=f.name,p.branch=f.branch||"main",p.enabled=f.enabled!==!1,p.config={triggers:f.triggers||[],parameters:f.parameters||[],environmentVariables:f.environmentVariables||{},postBuildActions:f.postBuildActions||[]})}const l=this.config?.nodes||[],d=new Set(this.nodes.keys());for(const f of d)f!=="master"&&!l.find(p=>p.id===f)&&this.nodes.delete(f);for(const f of l){const p=this.nodes.get(f.id);if(p)p.name=f.name,p.numExecutors=f.numExecutors||1,p.labels=f.labels||[],p.idleExecutors=p.numExecutors-p.busyExecutors;else{const m={id:f.id,name:f.name,status:"online",numExecutors:f.numExecutors||1,busyExecutors:0,idleExecutors:f.numExecutors||1,labels:f.labels||[]};this.nodes.set(f.id,m)}}}setPipelineEnabled(e,t){const n=this.pipelines.get(e);return n?(n.enabled=t,!0):!1}updateExecutorCount(e){const t=this.nodes.get("master");return!t||e<t.busyExecutors?!1:(t.numExecutors,t.numExecutors=e,t.idleExecutors=e-t.busyExecutors,!0)}canUpdateExecutorCount(e){const t=this.nodes.get("master");return t?e<1||e>100?{can:!1,reason:"Executor count must be between 1 and 100"}:e<t.busyExecutors?{can:!1,reason:`Cannot reduce executors to ${e}. Currently ${t.busyExecutors} executors are busy.`}:{can:!0}:{can:!1,reason:"Master node not found"}}setPipelineEnabled(e,t){const n=this.pipelines.get(e);return n?(n.enabled=t,!0):!1}calculateComponentMetrics(){const e=this.getJenkinsMetrics(),t=e.buildsPerMinute/60,n=e.averageBuildDuration,s=e.executorUtilization,a=e.buildsSuccess+e.buildsFailed,c=a>0?e.buildsFailed/a*100:0;return{throughput:t,latency:n,utilization:s,errorRate:c}}}class fT{config=null;pipelines=new Map;activeJobs=new Map;runners=new Map;variables=new Map;environments=new Map;schedules=new Map;artifacts=new Map;cacheEntries=new Map;gitlabMetrics={pipelinesTotal:0,pipelinesSuccess:0,pipelinesFailed:0,pipelinesRunning:0,pipelinesPending:0,pipelinesPerHour:0,averagePipelineDuration:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,averageJobDuration:0,runnersTotal:0,runnersOnline:0,runnersBusy:0,runnersIdle:0,runnerUtilization:0,cacheHits:0,cacheMisses:0,cacheHitRate:0,artifactsTotal:0,artifactsSizeBytes:0,requestsTotal:0,requestsErrors:0};pipelineHistory=[];MAX_PIPELINE_HISTORY=1e3;jobHistory=[];MAX_JOB_HISTORY=5e3;lastPipelineTrigger=new Map;pipelineIidCounter=0;scheduleLastRun=new Map;processRequest(e=!0){this.gitlabMetrics.requestsTotal++,e||this.gitlabMetrics.requestsErrors++}initializeConfig(e){const t=e.data.config||{};this.config={gitlabUrl:t.gitlabUrl||"https://gitlab.com",projectId:t.projectId||"1",projectUrl:t.projectUrl||"https://gitlab.com/archiphoenix/project",enableRunners:t.enableRunners??!0,runnerType:t.runnerType||"docker",concurrentJobs:t.concurrentJobs||4,enableCache:t.enableCache??!0,cacheType:t.cacheType||"s3",enableArtifacts:t.enableArtifacts??!0,artifactsExpiry:t.artifactsExpiry||"7d",enableKubernetes:t.enableKubernetes??!1,k8sNamespace:t.k8sNamespace||"gitlab-runner",pipelines:t.pipelines||[],runners:t.runners||[],variables:t.variables||[],environments:t.environments||[],schedules:t.schedules||[],pipelineTriggerRate:t.pipelineTriggerRate||2,averagePipelineDuration:t.averagePipelineDuration||3e5,averageJobDuration:t.averageJobDuration||6e4,failureRate:t.failureRate||.1,cacheHitRate:t.cacheHitRate||.7},this.initializePipelines(),this.initializeRunners(),this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}initializePipelines(){this.pipelines.clear();const e=this.config?.pipelines||[];for(const t of e){const n=t.id,a=(t.stages||[{name:"build",jobs:[{name:"build",stage:"build"}]},{name:"test",jobs:[{name:"test",stage:"test"}]},{name:"deploy",jobs:[{name:"deploy",stage:"deploy"}]}]).map(l=>({name:l.name,status:"pending",jobs:(l.jobs||[]).map(d=>({id:`${n}-${l.name}-${d.name}`,name:d.name,stage:l.name,status:"created",pipelineId:n,when:d.when||"on_success",allowFailure:d.allowFailure||!1,tags:d.tags||[],image:d.image,script:d.script||[`echo "Running ${d.name}"`]}))})),c={id:n,iid:++this.pipelineIidCounter,status:"created",ref:t.ref||"main",source:t.source||"push",stages:a,createdAt:Date.now(),updatedAt:Date.now(),variables:{}};this.pipelines.set(n,c)}}initializeRunners(){this.runners.clear();const e=this.config?.runners||[];if(e.length===0&&this.config?.enableRunners){const t={id:"default-runner-1",name:"docker-runner-1",status:"online",runnerType:"project_type",executor:this.config.runnerType||"docker",active:!0,isShared:!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",currentJobs:0,maxJobs:this.config.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(t.id,t);return}for(const t of e){const n={id:t.id,name:t.name,status:"online",runnerType:"project_type",executor:t.executor||this.config?.runnerType||"docker",active:!0,isShared:t.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:t.tags||[],currentJobs:0,maxJobs:t.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(n.id,n)}}initializeVariables(){this.variables.clear();const e=this.config?.variables||[];for(const t of e){const n={key:t.key,value:t.value,variableType:"env_var",protected:t.protected??!1,masked:t.masked??!1,raw:!1,environmentScope:t.environmentScope||"*"};this.variables.set(t.key,n)}}initializeEnvironments(){this.environments.clear();const e=this.config?.environments||[];for(const t of e){const n={id:t.id,name:t.name,slug:t.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),externalUrl:t.externalUrl,state:"available",deployments:[]};this.environments.set(t.id,n)}}initializeSchedules(){this.schedules.clear();const e=this.config?.schedules||[];for(const t of e){const n={id:t.id,description:t.description,ref:t.ref,cron:t.cron,active:t.active!==!1,variables:t.variables||{}};n.nextRunAt=this.calculateNextRunTime(n.cron),this.schedules.set(t.id,n)}}calculateNextRunTime(e){const t=Date.now(),n=3600*1e3;return t+n}performUpdate(e){this.config&&(this.updateActiveJobs(e),this.updateActivePipelines(e),this.triggerPipelines(e),this.checkSchedules(e),this.config.enableArtifacts&&this.cleanupArtifacts(e),this.updateMetrics())}updateActiveJobs(e){const t=Array.from(this.activeJobs.entries());for(const[n,s]of t)if(s.status==="running")try{if(!s.startTime){s.startTime=e;continue}const a=e-s.startTime,c=s.estimatedDuration||this.config?.averageJobDuration||6e4;if(a<0)continue;if(s.progress=Math.min(100,Math.max(0,Math.floor(a/c*100))),a%5e3<100&&s.logs&&this.updateJobLogs(s,a,c),a>=c){const l=Math.random()<(this.config?.failureRate||.1);s.status=l?"failed":"success",s.duration=a,s.progress=100,s.logs&&(l?s.logs.push(`Job ${s.name} failed after ${(a/1e3).toFixed(1)}s`):s.logs.push(`Job ${s.name} succeeded in ${(a/1e3).toFixed(1)}s`)),s.status==="success"&&this.config?.enableArtifacts&&this.generateJobArtifacts(s,e),this.freeRunner(s.runnerId),s.runnerId=void 0,this.updatePipelineStage(s),this.addJobToHistory(s),this.activeJobs.delete(n)}}catch(a){console.error(`Error updating job ${n}:`,a),s.status="failed",this.activeJobs.delete(n),this.freeRunner(s.runnerId)}}updateActivePipelines(e){for(const t of this.pipelines.values()){if(t.status!=="running"&&t.status!=="pending")continue;const n=t.stages.every(s=>s.status==="success"||s.status==="failed"||s.status==="canceled");if(n&&t.status==="running"){const s=t.stages.some(a=>a.status==="failed");t.status=s?"failed":"success",t.finishedAt=e,t.startedAt&&(t.duration=e-t.startedAt),t.status==="success"&&(t.coverage=75+Math.random()*20),this.addPipelineToHistory(t),t.status==="success"?this.gitlabMetrics.pipelinesSuccess++:this.gitlabMetrics.pipelinesFailed++,this.gitlabMetrics.pipelinesRunning--}else if(t.status==="pending"&&!n){const s=t.stages.find(a=>a.status==="pending");s&&this.hasAvailableRunner(s.jobs[0]?.tags)&&(t.status="running",t.startedAt=e,this.startStage(s,t.id,e))}else if(t.status==="running")for(let s=0;s<t.stages.length;s++){const a=t.stages[s],c=s>0?t.stages[s-1]:null;if(a.status==="pending"&&(!c||c.status==="success")){this.startStage(a,t.id,e);break}}t.updatedAt=e}}startStage(e,t,n){e.status="running",e.startTime=n;for(const s of e.jobs)if(s.status==="created"||s.status==="pending"){const a=this.findAvailableRunner(s.tags);a?(s.status="running",s.startTime=n,s.runnerId=a.id,s.estimatedDuration=this.config?.averageJobDuration||6e4,s.progress=0,s.logs=this.generateJobLogs(s),a.currentJobs++,a.busy=a.currentJobs>=a.maxJobs,this.activeJobs.set(s.id,s),this.gitlabMetrics.jobsRunning++):(s.status="pending",this.gitlabMetrics.jobsPending++)}}updateJobLogs(e,t,n){if(!e.logs)return;const s=Math.floor(t/n*100),a=[10,30,50,70,90];for(const c of a)s>=c&&!e.logs.some(l=>l.includes(`Progress: ${c}%`))&&e.logs.push(`[${e.name}] Progress: ${c}% completed`)}generateJobLogs(e){const t=[];if(t.push(`Running with ${e.image||"default"} image`),t.push(`$ ${e.script?.[0]||`echo "Running ${e.name}"`}`),e.script)for(const n of e.script)n.startsWith("echo")?t.push(n.replace("echo ","")):(t.push(`$ ${n}`),t.push(`[output from ${n}]`));return t}generateJobArtifacts(e,t){if(!this.config?.enableArtifacts)return;const n=[{name:`${e.name}-output.log`,size:1024*10,fileType:"text/plain"},{name:`${e.name}-results.json`,size:1024*5,fileType:"application/json"}];for(const s of n){const a=`${e.id}-${s.name}`,c={id:a,jobId:e.id,pipelineId:e.pipelineId,name:s.name,size:s.size,fileType:s.fileType,filename:s.name,createdAt:t},l=parseInt(this.config.artifactsExpiry?.replace("d","")||"7");c.expiresAt=t+l*24*60*60*1e3,this.artifacts.set(a,c),e.artifacts||(e.artifacts=[]),e.artifacts.push(s.name)}}updatePipelineStage(e){const t=this.pipelines.get(e.pipelineId);if(!t)return;const n=t.stages.find(c=>c.name===e.stage);if(!n)return;const s=n.jobs.find(c=>c.id===e.id);if(s&&(s.status=e.status,s.duration=e.duration),n.jobs.every(c=>c.status==="success"||c.status==="failed"||c.status==="canceled"||c.status==="skipped")){const c=n.jobs.some(l=>l.status==="failed"&&!l.allowFailure);n.status=c?"failed":"success",n.startTime&&(n.duration=Date.now()-n.startTime)}}triggerPipelines(e){if(!this.config)return;const t=this.config.pipelineTriggerRate||2,n=3600*1e3/t;for(const[s,a]of this.pipelines.entries()){if(a.status==="running"||a.status==="pending")continue;const c=this.lastPipelineTrigger.get(s)||0;e-c>=n&&(this.startPipeline(s,e),this.lastPipelineTrigger.set(s,e))}}checkSchedules(e){for(const[t,n]of this.schedules.entries())if(n.active&&n.nextRunAt&&e>=n.nextRunAt){const s=Array.from(this.pipelines.values()).find(a=>a.ref===n.ref&&(a.status==="created"||a.status==="success"||a.status==="failed"));s&&(this.startPipeline(s.id,e,"schedule",n.variables),n.lastRunPipelineId=s.id),n.nextRunAt=this.calculateNextRunTime(n.cron),this.scheduleLastRun.set(t,e)}}startPipeline(e,t,n="push",s){const a=this.pipelines.get(e);if(!a)return{success:!1,reason:"Pipeline not found"};if(a.status==="running"||a.status==="pending")return{success:!1,reason:"Pipeline already running"};a.status="pending",a.source=n,a.createdAt=t,a.updatedAt=t,a.startedAt=void 0,a.finishedAt=void 0,a.duration=void 0,a.coverage=void 0,s&&(a.variables={...a.variables,...s});for(const c of a.stages){c.status="pending",c.startTime=void 0,c.duration=void 0;for(const l of c.jobs)l.status="created",l.startTime=void 0,l.duration=void 0,l.progress=0,l.logs=void 0,l.artifacts=void 0,l.runnerId=void 0}return this.gitlabMetrics.pipelinesTotal++,this.gitlabMetrics.pipelinesPending++,{success:!0}}triggerWebhook(e,t){const n=Array.from(this.pipelines.values()).find(a=>a.ref===e&&(a.status==="created"||a.status==="success"||a.status==="failed"));if(!n)return{success:!1,reason:`No pipeline found for ref: ${e}`};const s=this.startPipeline(n.id,Date.now(),"trigger",t);return s.success?{success:!0,pipelineId:n.id}:s}cancelPipeline(e){const t=this.pipelines.get(e);if(!t)return{success:!1,reason:"Pipeline not found"};if(t.status!=="running"&&t.status!=="pending")return{success:!1,reason:"Pipeline is not running"};t.status="canceled",t.finishedAt=Date.now(),t.startedAt&&(t.duration=Date.now()-t.startedAt);for(const n of t.stages){n.status="canceled";for(const s of n.jobs)(s.status==="running"||s.status==="pending")&&(s.status="canceled",this.freeRunner(s.runnerId),this.activeJobs.delete(s.id),this.gitlabMetrics.jobsRunning--)}return this.gitlabMetrics.pipelinesRunning--,{success:!0}}hasAvailableRunner(e){for(const t of this.runners.values())if(!(t.status!=="online"||!t.active)&&!(t.currentJobs>=t.maxJobs)&&!(e&&e.length>0&&(!t.runUntagged&&(!t.tagList||t.tagList.length===0)||t.tagList&&t.tagList.length>0&&!e.some(s=>t.tagList?.includes(s))&&!t.runUntagged)))return!0;return!1}findAvailableRunner(e){for(const t of this.runners.values())if(!(t.status!=="online"||!t.active)&&!(t.currentJobs>=t.maxJobs)&&!(e&&e.length>0&&(!t.runUntagged&&(!t.tagList||t.tagList.length===0)||t.tagList&&t.tagList.length>0&&!e.some(s=>t.tagList?.includes(s))&&!t.runUntagged)))return t}freeRunner(e){if(!e)return;const t=this.runners.get(e);t&&t.currentJobs>0&&(t.currentJobs--,t.busy=t.currentJobs>=t.maxJobs)}addPipelineToHistory(e){e.duration&&(this.pipelineHistory.push({timestamp:e.startedAt||e.createdAt,duration:e.duration,status:e.status}),this.pipelineHistory.length>this.MAX_PIPELINE_HISTORY&&this.pipelineHistory.shift())}addJobToHistory(e){e.duration&&(this.jobHistory.push({timestamp:e.startTime||Date.now(),duration:e.duration,status:e.status}),this.jobHistory.length>this.MAX_JOB_HISTORY&&this.jobHistory.shift(),e.status==="success"?this.gitlabMetrics.jobsSuccess++:e.status==="failed"&&this.gitlabMetrics.jobsFailed++,this.gitlabMetrics.jobsRunning--)}cleanupArtifacts(e){if(!this.config)return;const n=parseInt(this.config.artifactsExpiry?.replace("d","")||"7")*24*60*60*1e3;for(const[s,a]of this.artifacts.entries())a.expiresAt&&e>a.expiresAt?this.artifacts.delete(s):e-a.createdAt>n&&this.artifacts.delete(s)}updateMetrics(){this.gitlabMetrics.pipelinesRunning=Array.from(this.pipelines.values()).filter(f=>f.status==="running").length,this.gitlabMetrics.pipelinesPending=Array.from(this.pipelines.values()).filter(f=>f.status==="pending").length;const e=Date.now()-3600*1e3,t=this.pipelineHistory.filter(f=>f.timestamp>e);if(this.gitlabMetrics.pipelinesPerHour=t.length,this.pipelineHistory.length>0){const f=this.pipelineHistory.slice(-100),p=f.reduce((m,y)=>m+y.duration,0)/f.length;this.gitlabMetrics.averagePipelineDuration=p}if(this.gitlabMetrics.jobsRunning=this.activeJobs.size,this.gitlabMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(f=>f.status==="pending").length,this.jobHistory.length>0){const f=this.jobHistory.slice(-500),p=f.reduce((m,y)=>m+y.duration,0)/f.length;this.gitlabMetrics.averageJobDuration=p}this.gitlabMetrics.runnersTotal=this.runners.size,this.gitlabMetrics.runnersOnline=Array.from(this.runners.values()).filter(f=>f.status==="online").length;let n=0,s=0,a=0;for(const f of this.runners.values())f.status==="online"&&(n+=f.currentJobs,s+=f.maxJobs-f.currentJobs,a+=f.maxJobs);this.gitlabMetrics.runnersBusy=n,this.gitlabMetrics.runnersIdle=s,this.gitlabMetrics.runnerUtilization=a>0?n/a*100:0;const c=this.gitlabMetrics.cacheHits+this.gitlabMetrics.cacheMisses;c>0?this.gitlabMetrics.cacheHitRate=this.gitlabMetrics.cacheHits/c:(this.gitlabMetrics.cacheHits=Math.floor(Math.random()*100),this.gitlabMetrics.cacheMisses=Math.floor(this.gitlabMetrics.cacheHits*.3),this.gitlabMetrics.cacheHitRate=this.config?.cacheHitRate||.7),this.gitlabMetrics.artifactsTotal=this.artifacts.size;let l=0;for(const f of this.artifacts.values())l+=f.size;this.gitlabMetrics.artifactsSizeBytes=l;const d=Array.from(this.pipelines.values()).filter(f=>f.status==="success"&&f.coverage!==void 0);if(d.length>0){const f=d.reduce((p,m)=>p+(m.coverage||0),0)/d.length;this.gitlabMetrics.coverage=f}}getGitLabCIMetrics(){return{...this.gitlabMetrics}}getMetrics(){return this.getGitLabCIMetrics()}getPipelines(){return Array.from(this.pipelines.values())}getPipeline(e){return this.pipelines.get(e)}getActiveJobs(){return Array.from(this.activeJobs.values())}getJob(e){if(this.activeJobs.has(e))return this.activeJobs.get(e);for(const t of this.pipelines.values())for(const n of t.stages){const s=n.jobs.find(a=>a.id===e);if(s)return s}}getRunners(){return Array.from(this.runners.values())}getVariables(){return Array.from(this.variables.values())}getEnvironments(){return Array.from(this.environments.values())}getSchedules(){return Array.from(this.schedules.values())}getArtifacts(){return Array.from(this.artifacts.values())}getJobLogs(e){return this.getJob(e)?.logs}updateConfig(e){this.config;const t=new Set(this.pipelines.keys());this.initializeConfig(e);const n=new Set(this.pipelines.keys());for(const l of t)if(!n.has(l)){for(const[d,f]of this.activeJobs.entries())f.pipelineId===l&&(f.status="canceled",this.freeRunner(f.runnerId),this.activeJobs.delete(d));this.pipelines.delete(l)}const s=this.config?.pipelines||[];for(const l of s){const d=this.pipelines.get(l.id);d&&(d.ref=l.ref||d.ref,d.source=l.source||d.source,d.status!=="running"&&d.status)}const a=this.config?.runners||[],c=new Set(this.runners.keys());for(const l of c)if(!a.find(d=>d.id===l)){for(const[d,f]of this.activeJobs.entries())f.runnerId===l&&(f.status="canceled",this.activeJobs.delete(d));this.runners.delete(l)}for(const l of a){const d=this.runners.get(l.id);if(d)d.name=l.name,d.executor=l.executor||d.executor,d.maxJobs=l.maxJobs||d.maxJobs,d.tagList=l.tags||d.tagList,d.isShared=l.isShared??d.isShared;else{const f={id:l.id,name:l.name,status:"online",runnerType:"project_type",executor:l.executor||this.config?.runnerType||"docker",active:!0,isShared:l.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:l.tags||[],currentJobs:0,maxJobs:l.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(l.id,f)}}this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}calculateComponentMetrics(){const e=this.getGitLabCIMetrics(),t=e.pipelinesPerHour/3600,n=e.averagePipelineDuration,s=e.runnerUtilization/100,a=e.pipelinesSuccess+e.pipelinesFailed,c=a>0?e.pipelinesFailed/a:0;return{throughput:t,latency:n,utilization:s,errorRate:c}}}class hT{config=null;applications=new Map;repositories=new Map;projects=new Map;syncOperations=new Map;argoMetrics={applicationsTotal:0,applicationsSynced:0,applicationsOutOfSync:0,applicationsProgressing:0,applicationsDegraded:0,applicationsHealthy:0,syncOperationsTotal:0,syncOperationsSuccess:0,syncOperationsFailed:0,syncOperationsRunning:0,syncRate:0,averageSyncDuration:0,repositoriesTotal:0,repositoriesConnected:0,repositoriesFailed:0,projectsTotal:0,requestsTotal:0,requestsErrors:0};syncHistory=[];MAX_SYNC_HISTORY=1e3;lastSyncTime=new Map;lastHealthCheck=new Map;processRequest(e=!0){this.argoMetrics.requestsTotal++,e||this.argoMetrics.requestsErrors++}initializeConfig(e){const t=e.data.config||{};this.config={serverUrl:t.serverUrl||t.argoUrl||"https://argocd.example.com",enableSSO:t.enableSSO??!1,ssoProvider:t.ssoProvider||"oidc",enableRBAC:t.enableRBAC??!0,enableSyncPolicy:t.enableSyncPolicy??!0,autoSync:t.autoSync??!1,syncPolicy:t.syncPolicy||"manual",enableHealthChecks:t.enableHealthChecks??!0,enableNotifications:t.enableNotifications??!0,notificationChannels:t.notificationChannels||["slack"],applications:t.applications||[],repositories:t.repositories||[],projects:t.projects||[],syncRate:t.syncRate||1,averageSyncDuration:t.averageSyncDuration||3e4,failureRate:t.failureRate||.05,healthCheckInterval:t.healthCheckInterval||3e5},this.initializeApplications(),this.initializeRepositories(),this.initializeProjects()}initializeApplications(){this.applications.clear();const e=this.config?.applications||[];if(e.length===0){const t={name:"web-app",namespace:"production",project:"default",repository:"https://github.com/example/web-app",path:"k8s",targetRevision:"main",destination:{server:"https://kubernetes.default.svc",namespace:"production"},syncPolicy:this.config?.syncPolicy||"manual",status:"synced",health:"healthy",lastSync:Date.now()-12e4,revision:"abc123",sourceRevision:"abc123"};this.applications.set(t.name,t);return}for(const t of e){const n={name:t.name,namespace:t.namespace,project:t.project||"default",repository:t.repository,path:t.path||".",targetRevision:t.targetRevision||"main",destination:t.destination||{server:"https://kubernetes.default.svc",namespace:t.namespace||"default"},syncPolicy:t.syncPolicy||this.config?.syncPolicy||"manual",status:t.status||"synced",health:t.health||"healthy",lastSync:Date.now()-Math.random()*36e5,revision:this.generateRevision(),sourceRevision:this.generateRevision()};this.applications.set(n.name,n)}}initializeRepositories(){this.repositories.clear();const e=this.config?.repositories||[],t=new Set;for(const n of this.applications.values())t.add(n.repository);for(const n of e){const s={name:n.name||n.url,url:n.url,type:n.type||"git",username:n.username,password:n.password,insecure:n.insecure??!1,project:n.project,connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(s.name,s)}for(const n of t)if(!this.repositories.has(n)){const s={name:n,url:n,type:"git",connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(n,s)}}initializeProjects(){this.projects.clear();const e=this.config?.projects||[];if(e.length===0){const t={name:"default",description:"Default project",sourceRepos:["*"],destinations:[{server:"*",namespace:"*"}]};this.projects.set("default",t);return}for(const t of e){const n={name:t.name,description:t.description,sourceRepos:t.sourceRepos||["*"],destinations:t.destinations||[{server:"*",namespace:"*"}]};this.projects.set(n.name,n)}}generateRevision(){return Math.random().toString(36).substring(2,8)}performUpdate(e){this.config&&(this.updateSyncOperations(e),(this.config.autoSync||this.config.syncPolicy==="automated")&&this.triggerAutoSyncs(e),this.config.enableHealthChecks&&this.performHealthChecks(e),this.checkRepositoryConnections(e),this.updateMetrics())}updateSyncOperations(e){const t=Array.from(this.syncOperations.entries());for(const[n,s]of t){if(s.status!=="running")continue;if(!s.startedAt){s.startedAt=e;continue}const a=e-s.startedAt,c=this.config?.averageSyncDuration||3e4;if(a>=c){const l=Math.random()<(this.config?.failureRate||.05);s.status=l?"failed":"success",s.finishedAt=e,l&&(s.error="Sync failed: resource conflict or validation error");const d=this.applications.get(s.application);d&&(s.status==="success"?(d.status="synced",d.health="healthy",d.lastSync=e,d.lastSyncDuration=a,d.revision=d.sourceRevision=this.generateRevision(),d.history||(d.history=[]),d.history.unshift({id:n,revision:d.revision,deployedAt:e}),d.history.length>10&&d.history.pop()):(d.status="degraded",d.health="degraded")),this.addSyncToHistory(s),s.status==="success"?this.argoMetrics.syncOperationsSuccess++:this.argoMetrics.syncOperationsFailed++,this.argoMetrics.syncOperationsRunning--,this.syncOperations.delete(n)}}}triggerAutoSyncs(e){const n=36e5/(this.config?.syncRate||1);for(const s of this.applications.values()){if(s.syncPolicy!=="automated"&&s.syncPolicy!=="auto")continue;const a=this.lastSyncTime.get(s.name)||s.lastSync||0;e-a>=n&&(s.status==="outofsync"||s.status==="synced")&&(this.startSync(s.name,e),this.lastSyncTime.set(s.name,e))}}performHealthChecks(e){const t=this.config?.healthCheckInterval||3e5;for(const n of this.applications.values()){const s=this.lastHealthCheck.get(n.name)||0;e-s>=t&&(Math.random()<.05&&n.health==="healthy"?(n.health="degraded",n.status="degraded"):n.health==="degraded"&&Math.random()<.3&&(n.health="healthy",n.status==="degraded"&&(n.status="synced")),this.lastHealthCheck.set(n.name,e))}}checkRepositoryConnections(e){for(const n of this.repositories.values()){const s=n.lastVerifiedAt||0;e-s>=6e5&&(Math.random()<.95?(n.connectionStatus="successful",n.lastVerifiedAt=e,n.lastConnectionError=void 0):(n.connectionStatus="failed",n.lastConnectionError="Connection timeout or authentication failed",n.lastVerifiedAt=e))}}startSync(e,t=Date.now()){const n=this.applications.get(e);if(!n||Array.from(this.syncOperations.values()).find(l=>l.application===e&&l.status==="running"))return!1;const a=`sync-${e}-${t}`,c={id:a,application:e,startedAt:t,status:"running",phase:"sync"};return this.syncOperations.set(a,c),this.argoMetrics.syncOperationsRunning++,this.argoMetrics.syncOperationsTotal++,n.status="progressing",n.syncStartedAt=t,!0}updateMetrics(){if(this.argoMetrics.applicationsTotal=this.applications.size,this.argoMetrics.applicationsSynced=Array.from(this.applications.values()).filter(e=>e.status==="synced").length,this.argoMetrics.applicationsOutOfSync=Array.from(this.applications.values()).filter(e=>e.status==="outofsync").length,this.argoMetrics.applicationsProgressing=Array.from(this.applications.values()).filter(e=>e.status==="progressing").length,this.argoMetrics.applicationsDegraded=Array.from(this.applications.values()).filter(e=>e.status==="degraded").length,this.argoMetrics.applicationsHealthy=Array.from(this.applications.values()).filter(e=>e.health==="healthy").length,this.argoMetrics.repositoriesTotal=this.repositories.size,this.argoMetrics.repositoriesConnected=Array.from(this.repositories.values()).filter(e=>e.connectionStatus==="successful").length,this.argoMetrics.repositoriesFailed=Array.from(this.repositories.values()).filter(e=>e.connectionStatus==="failed").length,this.argoMetrics.projectsTotal=this.projects.size,this.syncHistory.length>0){const e=Date.now()-36e5,t=this.syncHistory.filter(s=>s.timestamp>=e).length;this.argoMetrics.syncRate=t;const n=this.syncHistory.filter(s=>s.status==="success");if(n.length>0){const s=n.reduce((a,c)=>a+c.duration,0);this.argoMetrics.averageSyncDuration=s/n.length}}}addSyncToHistory(e){if(!e.finishedAt||!e.startedAt)return;const t=e.finishedAt-e.startedAt,n=e.status==="success"?"success":"failed";this.syncHistory.push({timestamp:e.finishedAt,duration:t,status:n}),this.syncHistory.length>this.MAX_SYNC_HISTORY&&this.syncHistory.shift()}getMetrics(){return{...this.argoMetrics}}getApplications(){return Array.from(this.applications.values())}getApplication(e){return this.applications.get(e)}addApplication(e){this.applications.set(e.name,e)}removeApplication(e){return this.applications.delete(e)}updateApplication(e,t){const n=this.applications.get(e);return n?(this.applications.set(e,{...n,...t}),!0):!1}getRepositories(){return Array.from(this.repositories.values())}getRepository(e){return this.repositories.get(e)}addRepository(e){this.repositories.set(e.name,e)}removeRepository(e){return this.repositories.delete(e)}updateRepository(e,t){const n=this.repositories.get(e);return n?(this.repositories.set(e,{...n,...t}),!0):!1}getProjects(){return Array.from(this.projects.values())}getProject(e){return this.projects.get(e)}addProject(e){this.projects.set(e.name,e)}updateProject(e,t){const n=this.projects.get(e);return n?(this.projects.set(e,{...n,...t}),!0):!1}removeProject(e){return this.projects.delete(e)}getSyncOperations(){return Array.from(this.syncOperations.values())}getStats(){return{metrics:this.getMetrics(),applications:this.getApplications(),repositories:this.getRepositories(),projects:this.getProjects(),activeSyncs:this.getSyncOperations()}}}class pT{config=null;workspaces=new Map;activeRuns=new Map;runHistory=new Map;MAX_RUN_HISTORY=1e3;states=new Map;terraformMetrics={workspacesTotal:0,runsTotal:0,runsSuccess:0,runsFailed:0,runsRunning:0,runsPending:0,runsPerHour:0,averageRunDuration:0,statesTotal:0,resourcesManaged:0,requestsTotal:0,requestsErrors:0};runHistoryList=[];MAX_RUN_HISTORY_LIST=1e3;lastRunTime=new Map;lastVCSWebhook=new Map;processRequest(e=!0){this.terraformMetrics.requestsTotal++,e||this.terraformMetrics.requestsErrors++}initializeConfig(e){const t=e.data.config||{};this.config={organizationName:t.organizationName||"archiphoenix",enableVCS:t.enableVCS??!0,enableStateLocking:t.enableStateLocking??!0,enableRemoteState:t.enableRemoteState??!0,defaultTerraformVersion:t.defaultTerraformVersion||"1.5.0",workspaces:t.workspaces||[],runs:t.runs||[],states:t.states||[],runTriggerRate:t.runTriggerRate||.5,averagePlanDuration:t.averagePlanDuration||3e4,averageApplyDuration:t.averageApplyDuration||12e4,failureRate:t.failureRate??.05,changeProbability:t.changeProbability??.7,maxResourceAdditions:t.maxResourceAdditions||10,maxResourceChanges:t.maxResourceChanges||5,maxResourceDestructions:t.maxResourceDestructions||3,vcsWebhookProbability:t.vcsWebhookProbability??.3,defaultStateResources:t.defaultStateResources||10,durationVariation:t.durationVariation??.3,resourceTimeMultiplier:t.resourceTimeMultiplier||500},this.initializeWorkspaces(),this.initializeRuns(),this.initializeStates()}updateConfig(e){this.initializeConfig(e)}initializeWorkspaces(){this.workspaces.clear();const e=this.config?.workspaces||[];if(e.length===0){const t={id:"default",name:"production",description:"Production infrastructure",terraformVersion:this.config?.defaultTerraformVersion||"1.5.0",autoApply:!1,queueAllRuns:!0,workingDirectory:"/terraform"};this.workspaces.set("default",t);return}for(const t of e){const n={id:t.id,name:t.name,description:t.description,terraformVersion:t.terraformVersion||this.config?.defaultTerraformVersion||"1.5.0",autoApply:t.autoApply??!1,queueAllRuns:t.queueAllRuns??!0,workingDirectory:t.workingDirectory,vcsRepo:t.vcsRepo,variables:t.variables||[]};this.workspaces.set(n.id,n)}}initializeRuns(){const e=new Set(Array.from(this.activeRuns.keys())),t=new Set((this.config?.runs||[]).map(s=>s.id));for(const[s,a]of this.runHistory.entries())!e.has(s)&&!t.has(s)&&this.runHistory.delete(s);const n=this.config?.runs||[];for(const s of n){const a=this.workspaces.values().next().value;if(!a)continue;const c={id:s.id,workspaceId:a.id,workspaceName:s.workspace||a.name,status:s.status||"applied",createdAt:s.createdAt?new Date(s.createdAt).getTime():Date.now()-36e5,finishedAt:s.createdAt?new Date(s.createdAt).getTime()+(s.duration||12e4):Date.now()-348e4,duration:s.duration||12e4,planOnly:s.planOnly??!1,message:s.message,hasChanges:s.status==="applied"};["pending","planning","applying"].includes(c.status)?this.activeRuns.set(c.id,c):this.runHistory.set(c.id,c)}}initializeStates(){this.states.clear();const e=this.config?.states||[];if(e.length===0){const t=this.config?.defaultStateResources||10;for(const n of this.workspaces.values()){const s={id:`state-${n.id}`,workspaceId:n.id,workspaceName:n.name,version:1,serial:1,resources:t,updatedAt:Date.now()-(36e5+Math.random()*36e5),createdAt:Date.now()-(864e5+Math.random()*864e5)};this.states.set(s.id,s)}return}for(const t of e){const n=Array.from(this.workspaces.values()).find(a=>a.name===t.workspace);if(!n)continue;const s={id:t.id,workspaceId:n.id,workspaceName:t.workspace,version:t.version||1,serial:t.serial||1,resources:t.resources,updatedAt:t.updatedAt?new Date(t.updatedAt).getTime():Date.now(),createdAt:t.updatedAt?new Date(t.updatedAt).getTime()-864e5:Date.now()-864e5};this.states.set(s.id,s)}}performUpdate(e){this.config&&(this.updateActiveRuns(e),this.config.enableVCS&&this.triggerVCSWebhooks(e),this.triggerAutoRuns(e),this.updateMetrics())}updateActiveRuns(e){const t=Array.from(this.activeRuns.entries());for(const[n,s]of t){if(!["pending","planning","applying"].includes(s.status)){if(this.runHistory.set(n,s),this.runHistory.size>this.MAX_RUN_HISTORY){const E=this.runHistory.keys().next().value;E&&this.runHistory.delete(E)}this.activeRuns.delete(n);continue}if(!s.startedAt){s.startedAt=e;continue}const a=e-s.startedAt;let c;const d=this.getStateForWorkspace(s.workspaceId)?.resources||this.config?.defaultStateResources||10,f=this.config?.resourceTimeMultiplier||500,p=this.config?.averagePlanDuration||3e4,m=this.config?.averageApplyDuration||12e4,y=this.config?.durationVariation||.3,b=Math.log10(Math.max(1,d))*f,S=p+b,M=m+b*2;if(s.status==="pending"){s.status="planning";const C=s.estimatedPlanDuration||S,T=C*y*(Math.random()*2-1);c=C+T}else if(s.status==="planning"){const E=S*y*(Math.random()*2-1);if(c=S+E,a>=c){const C=this.config?.changeProbability??.7,T=Math.random()<C;if(s.hasChanges=T,T){const k=this.config?.maxResourceAdditions||10,A=this.config?.maxResourceChanges||5,_=this.config?.maxResourceDestructions||3,N=Math.min(1.5,1+d/100);s.resourceAdditions=Math.floor(Math.random()*k*N)+1,s.resourceChanges=Math.floor(Math.random()*A*N),s.resourceDestructions=Math.floor(Math.random()*_*N)}else s.resourceAdditions=0,s.resourceChanges=0,s.resourceDestructions=0;if(s.planOnly)s.status="planned",s.finishedAt=e,s.duration=a,s.message=T?`Plan completed with ${s.resourceAdditions+s.resourceChanges+s.resourceDestructions} changes`:"No changes detected";else if(this.workspaces.get(s.workspaceId)?.autoApply&&T){s.status="applying";const A=M*y*(Math.random()*2-1);c=M+A}else T?(s.status="planned",s.message=`Plan completed. ${s.resourceAdditions+s.resourceChanges+s.resourceDestructions} changes detected.`):(s.status="applied",s.finishedAt=e,s.duration=a,s.message="No changes detected")}}else if(s.status==="applying"){const E=M*y*(Math.random()*2-1);if(c=M+E,a>=c){const C=this.config?.failureRate??.05,T=Math.random()<C;s.status=T?"errored":"applied",s.finishedAt=e,s.duration=a,T?(s.error="Apply failed: resource provisioning error or validation failure",s.message=s.error):(s.message="Apply completed successfully",this.updateStateAfterApply(s))}}}}updateStateAfterApply(e){const t=Array.from(this.states.values()).find(s=>s.workspaceId===e.workspaceId);if(!t)return;t.version++,t.serial++,t.updatedAt=Date.now(),e.resourceAdditions!==void 0&&(t.resources=(t.resources||0)+e.resourceAdditions,e.resourceDestructions!==void 0&&(t.resources=Math.max(0,t.resources-e.resourceDestructions)));const n=this.workspaces.get(e.workspaceId);n&&(n.lastRun={id:e.id,status:e.status,createdAt:e.finishedAt||Date.now()})}triggerVCSWebhooks(e){for(const n of this.workspaces.values()){if(!n.vcsRepo)continue;const s=this.lastVCSWebhook.get(n.id)||0;if(e-s<36e5)continue;const a=this.config?.vcsWebhookProbability??.3;Math.random()<a&&(this.lastVCSWebhook.set(n.id,e),this.triggerRun(n.id,{source:"vcs"}))}}triggerAutoRuns(e){const n=36e5/(this.config?.runTriggerRate||.5);for(const s of this.workspaces.values()){const a=this.lastRunTime.get(s.id)||0;e-a>=n&&!Array.from(this.activeRuns.values()).some(d=>d.workspaceId===s.id&&["pending","planning","applying"].includes(d.status))&&s.queueAllRuns&&(this.lastRunTime.set(s.id,e),this.triggerRun(s.id,{source:"scheduled"}))}}triggerRun(e,t){const n=this.workspaces.get(e);if(!n)return{success:!1,reason:"Workspace not found"};if(Array.from(this.activeRuns.values()).some(b=>b.workspaceId===e&&["pending","planning","applying"].includes(b.status))&&!n.queueAllRuns)return{success:!1,reason:"Workspace already has an active run"};const a=Date.now(),c=`run-${e}-${a}`,d=this.getStateForWorkspace(e)?.resources||this.config?.defaultStateResources||10,f=this.config?.resourceTimeMultiplier||500,p=this.config?.averagePlanDuration||3e4,m=Math.log10(Math.max(1,d))*f,y={id:c,workspaceId:n.id,workspaceName:n.name,status:"pending",createdAt:a,planOnly:t?.planOnly??!1,source:t?.source||"api",triggeredBy:t?.triggeredBy||"user"};return y.estimatedPlanDuration=p+m,this.activeRuns.set(c,y),this.terraformMetrics.runsTotal++,this.terraformMetrics.runsPending++,n.lastRun={id:c,status:"pending",createdAt:a},{success:!0,runId:c}}cancelRun(e){const t=this.activeRuns.get(e);if(!t)return{success:!1,reason:"Run not found or not active"};if(!["pending","planning","applying"].includes(t.status))return{success:!1,reason:"Run is not in a cancelable state"};if(t.status="canceled",t.finishedAt=Date.now(),t.duration=t.startedAt?Date.now()-t.startedAt:0,t.message="Run canceled by user",this.runHistory.set(e,t),this.runHistory.size>this.MAX_RUN_HISTORY){const n=this.runHistory.keys().next().value;n&&this.runHistory.delete(n)}return this.activeRuns.delete(e),{success:!0}}updateMetrics(){const e=Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values()));this.terraformMetrics.workspacesTotal=this.workspaces.size,this.terraformMetrics.statesTotal=this.states.size,this.terraformMetrics.runsRunning=Array.from(this.activeRuns.values()).filter(a=>["planning","applying"].includes(a.status)).length,this.terraformMetrics.runsPending=Array.from(this.activeRuns.values()).filter(a=>a.status==="pending").length,this.terraformMetrics.runsSuccess=e.filter(a=>a.status==="applied").length,this.terraformMetrics.runsFailed=e.filter(a=>a.status==="errored").length,this.terraformMetrics.resourcesManaged=Array.from(this.states.values()).reduce((a,c)=>a+(c.resources||0),0);const t=e.filter(a=>a.duration!==void 0);if(t.length>0){const a=t.reduce((c,l)=>c+(l.duration||0),0);this.terraformMetrics.averageRunDuration=a/t.length}const n=Date.now()-36e5,s=this.runHistoryList.filter(a=>a.timestamp>=n);this.terraformMetrics.runsPerHour=s.length}addRunToHistory(e){e.duration!==void 0&&(this.runHistoryList.push({timestamp:e.finishedAt||Date.now(),duration:e.duration,status:e.status}),this.runHistoryList.length>this.MAX_RUN_HISTORY_LIST&&this.runHistoryList.shift())}getMetrics(){return{...this.terraformMetrics}}getWorkspace(e){return this.workspaces.get(e)}getWorkspaces(){return Array.from(this.workspaces.values())}getRun(e){return this.activeRuns.get(e)||this.runHistory.get(e)}getActiveRuns(){return Array.from(this.activeRuns.values())}getRunsForWorkspace(e,t=100){return Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values())).filter(s=>s.workspaceId===e).sort((s,a)=>(a.createdAt||0)-(s.createdAt||0)).slice(0,t)}getStateForWorkspace(e){return Array.from(this.states.values()).find(t=>t.workspaceId===e)}getStates(){return Array.from(this.states.values())}getConfig(){return this.config}}class gT{config=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;pushLatencyHistory=[];pullLatencyHistory=[];scanLatencyHistory=[];MAX_LATENCY_HISTORY=500;harborMetrics={pushOperationsPerSecond:0,pullOperationsPerSecond:0,scanOperationsPerSecond:0,replicationOperationsPerSecond:0,averagePushLatency:0,averagePullLatency:0,averageScanLatency:0,storageUsed:0,storageTotal:100,totalProjects:0,totalRepositories:0,totalTags:0,totalVulnerabilities:0,scansCompleted:0,scansRunning:0,scansFailed:0,replicationPoliciesEnabled:0,activeReplications:0,gcOperationsTotal:0,gcStorageFreed:0};lastGCRun=0;initializeConfig(e){const t=e.data.config||{};this.config=t,this.updateMetricsFromConfig()}updateConfig(e){const t=e.data.config||{};this.config=t,this.updateMetricsFromConfig()}updateMetricsFromConfig(){if(!this.config)return;this.harborMetrics.totalProjects=this.config.projects?.length||0,this.harborMetrics.totalRepositories=this.config.repositories?.length||0,this.harborMetrics.totalTags=this.config.tags?.length||0;let e=0;this.config.projects&&(e=this.config.projects.reduce((n,s)=>n+(s.storageUsed||0),0)),this.harborMetrics.storageUsed=e;let t=0;this.config.tags&&this.config.tags.forEach(n=>{n.vulnerabilityScan?.totalVulnerabilities&&(t+=n.vulnerabilityScan.totalVulnerabilities)}),this.harborMetrics.totalVulnerabilities=t,this.harborMetrics.replicationPoliciesEnabled=(this.config.replicationPolicies||[]).filter(n=>n.enabled).length,this.harborMetrics.scansRunning=(this.config.tags||[]).filter(n=>n.vulnerabilityScan?.status==="running").length}performUpdate(e,t=!1){this.config&&(t&&this.simulatePushPullOperations(e),(this.config.enableVulnerabilityScanning||this.config.enableImageScanning)&&this.simulateVulnerabilityScans(e),this.config.replicationPolicies&&this.config.replicationPolicies.length>0&&this.simulateReplication(e),this.config.enableGarbageCollection&&this.simulateGarbageCollection(e),this.updateActiveOperations(e),this.updateMetrics(e))}simulatePushPullOperations(e){if(!this.config?.repositories||this.config.repositories.length===0)return;const t=Math.min(2,.1+this.config.repositories.length/10);if(Math.random()<t/10){const n=this.config.repositories[Math.floor(Math.random()*this.config.repositories.length)];Math.random()<.3?this.simulatePush(n,e):this.simulatePull(n,e)}}simulatePush(e,t){const n=`push-${t}-${Math.random()}`,s=50+Math.random()*500,a=500+Math.random()*1500,c=t+a,l={id:n,type:"push",repository:e.name,project:e.project,startTime:t,status:"running",size:s,completionTime:c};this.activeOperations.set(n,l)}simulatePull(e,t){const n=`pull-${t}-${Math.random()}`,s=200+Math.random()*800,a=t+s,c={id:n,type:"pull",repository:e.name,project:e.project,startTime:t,status:"running",completionTime:a};this.activeOperations.set(n,c)}simulateVulnerabilityScans(e){if(!this.config?.tags)return;const t=this.config.tags.filter(n=>{const s=n.vulnerabilityScan;return!s||s.status==="pending"||s.status==="completed"&&this.shouldRescan(n)});if(t.length!==0){if(this.harborMetrics.scansRunning<3&&Math.random()<.1){const n=t[Math.floor(Math.random()*t.length)];this.startVulnerabilityScan(n.id,e)}this.completeVulnerabilityScans(e)}}startVulnerabilityScan(e,t){if(!this.config?.tags)return;const n=this.config.tags.find(f=>f.id===e);if(!n)return;const s=`scan-${e}-${t}`,a=5e3+Math.random()*15e3,c=t+a,l={id:s,type:"scan",repository:n.repository,tag:n.name,startTime:t,status:"running",completionTime:c};this.activeOperations.set(s,l),this.harborMetrics.scansRunning++;const d=this.config.tags.map(f=>f.id===e?{...f,vulnerabilityScan:{status:"running",severity:"none",scannedAt:new Date(t).toISOString()}}:f);this.config.tags=d}completeVulnerabilityScans(e){}shouldRescan(e){if(!e.vulnerabilityScan?.scannedAt)return!0;const t=new Date(e.vulnerabilityScan.scannedAt).getTime(),n=Date.now()-t,s=10080*60*1e3;return n>s}simulateReplication(e){if(!this.config?.replicationPolicies)return;const t=this.config.replicationPolicies.filter(n=>n.enabled);t.length!==0&&t.forEach(n=>{if(n.trigger==="event-based"&&Math.random()<.05)this.simulateReplicationOperation(n,e);else if(n.trigger==="scheduled"){const s=this.getLastReplicationRun(n.id);e-s>36e5&&(this.simulateReplicationOperation(n,e),this.setLastReplicationRun(n.id,e))}})}lastReplicationRuns=new Map;getLastReplicationRun(e){return this.lastReplicationRuns.get(e)||0}setLastReplicationRun(e,t){this.lastReplicationRuns.set(e,t)}simulateReplicationOperation(e,t){const n=`replication-${e.id}-${t}`,s=2e3+Math.random()*5e3,a=t+s,c={id:n,type:"replication",startTime:t,status:"running",completionTime:a};this.activeOperations.set(n,c),this.harborMetrics.activeReplications++}simulateGarbageCollection(e){this.config?.gcSchedule&&e-this.lastGCRun>1440*60*1e3&&(this.runGarbageCollection(e),this.lastGCRun=e)}runGarbageCollection(e){const t=`gc-${e}`,n=3e4+Math.random()*6e4,s=e+n,a=Math.random()*5,c={id:t,type:"gc",startTime:e,status:"running",completionTime:s,size:a*1024};this.activeOperations.set(t,c)}updateActiveOperations(e){const t=[];for(const[s,a]of this.activeOperations.entries())a.completionTime&&e>=a.completionTime&&a.status==="running"&&t.push(a);for(const s of t)this.completeOperation(s,e);const n=e-6e4;for(const[s,a]of this.activeOperations.entries())a.startTime<n&&a.status==="completed"&&this.activeOperations.delete(s)}completeOperation(e,t){const n=e.completionTime?e.completionTime-e.startTime:0;switch(e.status="completed",e.duration=n,this.activeOperations.delete(e.id),this.addOperationToHistory(e),e.type){case"push":this.config&&e.size&&(this.harborMetrics.storageUsed+=e.size/1024),n>0&&(this.pushLatencyHistory.push(n),this.pushLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pushLatencyHistory.shift());break;case"pull":n>0&&(this.pullLatencyHistory.push(n),this.pullLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pullLatencyHistory.shift());break;case"scan":if(this.config?.tags&&e.id){const s=e.id.match(/^scan-(.+?)-/);if(s){const a=s[1];if(this.config.tags.find(l=>l.id===a)){const l=Math.floor(Math.random()*3),d=Math.floor(Math.random()*5),f=Math.floor(Math.random()*10),p=Math.floor(Math.random()*15),m=l+d+f+p,y=l>0?"critical":d>0?"high":f>0?"medium":p>0?"low":"none",b=this.config.tags.map(S=>S.id===a?{...S,vulnerabilityScan:{status:"completed",severity:y,totalVulnerabilities:m,critical:l,high:d,medium:f,low:p,scannedAt:new Date(t).toISOString(),scanDuration:n}}:S);this.config.tags=b,this.harborMetrics.scansRunning=Math.max(0,this.harborMetrics.scansRunning-1),this.harborMetrics.scansCompleted++,this.scanLatencyHistory.push(n),this.scanLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.scanLatencyHistory.shift()}}}break;case"replication":this.harborMetrics.activeReplications=Math.max(0,this.harborMetrics.activeReplications-1);break;case"gc":if(e.size){const s=e.size/1024;this.harborMetrics.gcOperationsTotal++,this.harborMetrics.gcStorageFreed+=s,this.harborMetrics.storageUsed=Math.max(0,this.harborMetrics.storageUsed-s)}break}}addOperationToHistory(e){this.operationHistory.push(e),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(e){const t=e-1e4,n=this.operationHistory.filter(s=>s.startTime>t);this.harborMetrics.pushOperationsPerSecond=n.filter(s=>s.type==="push").length/10,this.harborMetrics.pullOperationsPerSecond=n.filter(s=>s.type==="pull").length/10,this.harborMetrics.scanOperationsPerSecond=n.filter(s=>s.type==="scan").length/10,this.harborMetrics.replicationOperationsPerSecond=n.filter(s=>s.type==="replication").length/10,this.pushLatencyHistory.length>0&&(this.harborMetrics.averagePushLatency=this.pushLatencyHistory.reduce((s,a)=>s+a,0)/this.pushLatencyHistory.length),this.pullLatencyHistory.length>0&&(this.harborMetrics.averagePullLatency=this.pullLatencyHistory.reduce((s,a)=>s+a,0)/this.pullLatencyHistory.length),this.scanLatencyHistory.length>0&&(this.harborMetrics.averageScanLatency=this.scanLatencyHistory.reduce((s,a)=>s+a,0)/this.scanLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const e=this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond+this.harborMetrics.replicationOperationsPerSecond,t=(this.harborMetrics.averagePushLatency*this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.averagePullLatency*this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.averageScanLatency*this.harborMetrics.scanOperationsPerSecond)/Math.max(1,this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond),n=this.operationHistory.filter(f=>f.status==="failed").length,s=Math.min(1,n/Math.max(1,this.operationHistory.length)),a=Math.min(.95,.1+e/10*.4),c=Math.min(.95,.2+this.harborMetrics.storageUsed/this.harborMetrics.storageTotal*.5),l=this.harborMetrics.storageUsed/this.harborMetrics.storageTotal,d=Math.min(.95,e/20*.6);return{throughput:e,averageLatency:t||0,errorRate:s,cpuUtilization:a,memoryUtilization:c,storageUtilization:l,networkUtilization:d}}getMetrics(){return{...this.harborMetrics}}getConfig(){return this.config?{...this.config}:null}}class mT{config;connected=!1;eventSubscribers=new Set;eventStream=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;reconnectTimeout=3e3;constructor(e){this.config=e}getBaseUrl(){if(this.config.type==="local")return"/api/docker";{const e=this.config.useTLS?"https":"http",t=this.config.host||"localhost",n=this.config.port||2376;return`${e}://${t}:${n}`}}async request(e,t,n,s){const a=`${this.getBaseUrl()}${t}`,c=s?.timeout||this.config.timeout||3e4,l=new AbortController,d=setTimeout(()=>l.abort(),c);try{const f={"Content-Type":"application/json"};this.config.useTLS&&this.config.clientCert&&this.config.clientKey&&(f["X-Client-Cert"]=this.config.clientCert,f["X-Client-Key"]=this.config.clientKey);const p=await fetch(a,{method:e,headers:f,body:n?JSON.stringify(n):void 0,signal:l.signal});if(clearTimeout(d),!p.ok){const y=await p.text();throw new Error(`Docker API error: ${p.status} ${p.statusText} - ${y}`)}const m=p.headers.get("content-type");return m&&m.includes("application/json")?await p.json():{}}catch(f){throw clearTimeout(d),f.name==="AbortError"?new Error(`Request timeout after ${c}ms`):f}}async connect(){try{return await this.getSystemInfo()?(this.connected=!0,this.reconnectAttempts=0,this.startEventStream(),!0):!1}catch(e){return this.connected=!1,console.error("Failed to connect to Docker daemon:",e),!1}}async disconnect(){this.connected=!1,this.stopEventStream(),this.eventSubscribers.clear()}isConnected(){return this.connected}async testConnection(){try{return{success:!!await this.getSystemInfo()}}catch(e){return{success:!1,error:e.message}}}startEventStream(){if(this.eventSubscribers.size!==0)try{const e=`${this.getBaseUrl()}/events`;this.pollEvents()}catch(e){console.error("Failed to start event stream:",e)}}stopEventStream(){this.eventStream&&(this.eventStream.close(),this.eventStream=null)}async pollEvents(){}async listContainers(){return(await this.request("GET","/containers/json?all=true")).map(this.mapContainerFromAPI)}async getContainer(e){try{const t=await this.request("GET",`/containers/${e}/json`);return this.mapContainerFromAPI(t)}catch(t){if(t.message.includes("404"))return null;throw t}}async createContainer(e){const t=this.mapContainerConfigToAPI(e),n=await this.request("POST","/containers/create",t);return await this.getContainer(n.Id)||this.createContainerFromConfig(e,n.Id)}async startContainer(e){await this.request("POST",`/containers/${e}/start`)}async stopContainer(e){await this.request("POST",`/containers/${e}/stop`)}async pauseContainer(e){await this.request("POST",`/containers/${e}/pause`)}async unpauseContainer(e){await this.request("POST",`/containers/${e}/unpause`)}async restartContainer(e){await this.request("POST",`/containers/${e}/restart`)}async removeContainer(e,t=!1){await this.request("DELETE",`/containers/${e}?force=${t}`)}async listImages(){return(await this.request("GET","/images/json")).map(this.mapImageFromAPI)}async pullImage(e,t="latest"){await this.request("POST",`/images/create?fromImage=${e}&tag=${t}`);const s=(await this.listImages()).find(a=>a.repository===e&&a.tag===t);if(!s)throw new Error(`Failed to find pulled image ${e}:${t}`);return s}async buildImage(e){throw new Error("Build image not fully implemented - requires streaming support")}async removeImage(e,t=!1){await this.request("DELETE",`/images/${e}?force=${t}`)}async listNetworks(){return(await this.request("GET","/networks")).map(this.mapNetworkFromAPI)}async createNetwork(e){const t=this.mapNetworkConfigToAPI(e),n=await this.request("POST","/networks/create",t),a=(await this.listNetworks()).find(c=>c.id===n.Id);if(!a)throw new Error(`Failed to find created network ${n.Id}`);return a}async removeNetwork(e){await this.request("DELETE",`/networks/${e}`)}async listVolumes(){return(await this.request("GET","/volumes")).Volumes.map(this.mapVolumeFromAPI)}async createVolume(e){const t=this.mapVolumeConfigToAPI(e),n=await this.request("POST","/volumes/create",t),a=(await this.listVolumes()).find(c=>c.name===n.Name);if(!a)throw new Error(`Failed to find created volume ${n.Name}`);return a}async removeVolume(e){await this.request("DELETE",`/volumes/${e}`)}async getContainerStats(e){try{const t=await this.request("GET",`/containers/${e}/stats?stream=false`);return this.mapStatsFromAPI(t,e)}catch(t){if(t.message.includes("404"))return null;throw t}}async getSystemInfo(){try{const e=await this.request("GET","/info"),t=await this.request("GET","/version");return this.mapSystemInfoFromAPI(e,t)}catch(e){return console.error("Failed to get system info:",e),null}}subscribeToEvents(e){return this.eventSubscribers.add(e),this.connected&&!this.eventStream&&this.startEventStream(),()=>{this.eventSubscribers.delete(e),this.eventSubscribers.size===0&&this.stopEventStream()}}mapContainerFromAPI(e){const n=(e.Names||[])[0]?.replace(/^\//,"")||e.Id?.substring(0,12)||"unknown";return{id:e.Id||e.ID||"",name:n,image:e.Image||"",imageId:e.ImageID||"",status:this.mapContainerStatus(e.Status||e.State||"unknown"),createdAt:e.Created?new Date(e.Created).getTime():Date.now(),startedAt:e.StartedAt?new Date(e.StartedAt).getTime():void 0,finishedAt:e.FinishedAt?new Date(e.FinishedAt).getTime():void 0,restartCount:e.RestartCount||0,ports:this.mapPortsFromAPI(e.Ports),environment:e.Env?this.parseEnvVars(e.Env):void 0,volumes:e.Mounts?e.Mounts.map(s=>s.Name||s.Source):void 0,networks:e.NetworkSettings?Object.keys(e.NetworkSettings.Networks||{}):void 0,health:this.mapHealthStatus(e.Health)}}mapContainerStatus(e){const t=e.toLowerCase();return t.includes("running")?"running":t.includes("paused")?"paused":t.includes("restarting")?"restarting":t.includes("removing")?"removing":t.includes("exited")||t.includes("stopped")?"exited":t.includes("dead")?"dead":"created"}mapPortsFromAPI(e){if(e)return e.map(t=>({containerPort:t.PrivatePort||t.ContainerPort||0,hostPort:t.PublicPort||t.HostPort,protocol:(t.Type||"tcp").toLowerCase()}))}parseEnvVars(e){const t={};for(const n of e){const[s,...a]=n.split("=");s&&(t[s]=a.join("="))}return t}mapHealthStatus(e){if(!e)return"none";const t=e.Status||e.status||"";return t==="healthy"?"healthy":t==="unhealthy"?"unhealthy":t==="starting"?"starting":"none"}mapImageFromAPI(e){const t=e.RepoTags&&e.RepoTags[0]||"<none>:<none>",[n,s]=t.split(":");return{id:e.Id||e.ID||"",repository:n||"<none>",tag:s||"latest",digest:e.RepoDigests?.[0]?.split("@")[1],size:e.Size||0,createdAt:e.Created?new Date(e.Created*1e3).getTime():Date.now(),layers:e.Layers?.length}}mapNetworkFromAPI(e){return{id:e.Id||e.ID||"",name:e.Name||"",driver:e.Driver||"bridge",scope:e.Scope||"local",subnet:e.IPAM?.Config?.[0]?.Subnet,gateway:e.IPAM?.Config?.[0]?.Gateway,containers:e.Containers?Object.keys(e.Containers):void 0,created:e.Created?new Date(e.Created).getTime():Date.now(),internal:e.Internal||!1,enableIPv6:e.EnableIPv6||!1}}mapVolumeFromAPI(e){return{id:e.Name||e.Driver||"",name:e.Name||"",driver:e.Driver||"local",mountpoint:e.Mountpoint,size:e.UsageData?.Size,usedBy:e.UsageData?.RefCount?[e.UsageData.RefCount]:void 0,created:e.CreatedAt?new Date(e.CreatedAt).getTime():Date.now(),labels:e.Labels}}mapStatsFromAPI(e,t){const n=e.cpu_stats?.cpu_usage?.total_usage-(e.precpu_stats?.cpu_usage?.total_usage||0),s=e.cpu_stats?.system_cpu_usage-(e.precpu_stats?.system_cpu_usage||0),a=e.cpu_stats?.online_cpus||1,c=s>0?n/s*a*100:0,l=e.memory_stats?.usage||0,d=e.memory_stats?.limit||0,f=e.networks?Object.values(e.networks).reduce((m,y)=>m+(y.rx_bytes||0),0):0,p=e.networks?Object.values(e.networks).reduce((m,y)=>m+(y.tx_bytes||0),0):0;return{id:t,name:e.name||"",cpuUsage:Math.min(100,Math.max(0,c)),memoryUsage:l,memoryLimit:d,networkRx:f,networkTx:p,timestamp:Date.now()}}mapSystemInfoFromAPI(e,t){return{version:t.Version||"unknown",apiVersion:t.ApiVersion||"unknown",os:e.OperatingSystem||"unknown",arch:e.Architecture||"unknown",kernelVersion:e.KernelVersion||"unknown",totalMemory:e.MemTotal||0,totalCpus:e.NCPU||0,containers:e.Containers||0,containersRunning:e.ContainersRunning||0,containersPaused:e.ContainersPaused||0,containersStopped:e.ContainersStopped||0,images:e.Images||0,imagesSize:0}}mapContainerConfigToAPI(e){const t={Image:e.image,Cmd:e.command,Env:e.env?Object.entries(e.env).map(([n,s])=>`${n}=${s}`):void 0,HostConfig:{}};if(e.ports){t.ExposedPorts={},t.HostConfig.PortBindings={};for(const n of e.ports){const s=`${n.containerPort}/${n.protocol||"tcp"}`;t.ExposedPorts[s]={},n.hostPort&&(t.HostConfig.PortBindings[s]=[{HostPort:n.hostPort.toString()}])}}if(e.volumes&&(t.Volumes={},t.HostConfig.Binds=e.volumes),e.memoryLimit&&(t.HostConfig.Memory=e.memoryLimit),e.cpuLimit){const n=parseFloat(e.cpuLimit);isNaN(n)||(t.HostConfig.CpuQuota=Math.floor(n*1e5),t.HostConfig.CpuPeriod=1e5)}return e.restartPolicy&&(t.HostConfig.RestartPolicy={Name:e.restartPolicy}),e.healthCheck&&(t.Healthcheck={Test:e.healthCheck.test,Interval:e.healthCheck.interval||3e10,Timeout:e.healthCheck.timeout||5e9,Retries:e.healthCheck.retries||3,StartPeriod:e.healthCheck.startPeriod||0}),t}createContainerFromConfig(e,t){return{id:t,name:e.name||t.substring(0,12),image:e.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:e.ports,environment:e.env,volumes:e.volumes,networks:e.networks,health:"none"}}mapNetworkConfigToAPI(e){return{Name:e.name,Driver:e.driver||"bridge",IPAM:e.subnet||e.gateway?{Config:[{Subnet:e.subnet,Gateway:e.gateway}]}:void 0,Internal:e.internal||!1,EnableIPv6:e.enableIPv6||!1,Labels:e.labels}}mapVolumeConfigToAPI(e){return{Name:e.name,Driver:e.driver||"local",Labels:e.labels,DriverOpts:e.options}}}class yT{containers=new Map;images=new Map;networks=new Map;volumes=new Map;eventSubscribers=new Set;statsCache=new Map;systemInfo=null;constructor(e,t,n,s){if(e)for(const a of e)this.containers.set(a.id,{...a});if(t)for(const a of t)this.images.set(a.id,{...a});if(n)for(const a of n)this.networks.set(a.id,{...a});if(s)for(const a of s)this.volumes.set(a.id,{...a});this.systemInfo={version:"24.0.0",apiVersion:"1.43",os:"linux",arch:"amd64",kernelVersion:"5.15.0",totalMemory:16*1024*1024*1024,totalCpus:8,containers:this.containers.size,containersRunning:Array.from(this.containers.values()).filter(a=>a.status==="running").length,containersPaused:Array.from(this.containers.values()).filter(a=>a.status==="paused").length,containersStopped:Array.from(this.containers.values()).filter(a=>a.status==="exited"||a.status==="dead").length,images:this.images.size,imagesSize:Array.from(this.images.values()).reduce((a,c)=>a+c.size,0)}}async connect(){return!0}async disconnect(){this.eventSubscribers.clear()}isConnected(){return!0}async testConnection(){return{success:!0}}async listContainers(){return Array.from(this.containers.values())}async getContainer(e){return this.containers.get(e)||null}async createContainer(e){const t=`sim-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:t,name:e.name||t.substring(0,12),image:e.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:e.ports,environment:e.env,volumes:e.volumes,networks:e.networks,health:"none",memoryLimit:e.memoryLimit};return this.containers.set(t,n),this.emitEvent("container","create",t,{}),n}async startContainer(e){const t=this.containers.get(e);if(!t)throw new Error(`Container ${e} not found`);t.status="running",t.startedAt=Date.now(),this.emitEvent("container","start",e,{})}async stopContainer(e){const t=this.containers.get(e);if(!t)throw new Error(`Container ${e} not found`);t.status="exited",t.finishedAt=Date.now(),t.cpuUsage=0,t.memoryUsage=0,this.emitEvent("container","stop",e,{})}async pauseContainer(e){const t=this.containers.get(e);if(!t)throw new Error(`Container ${e} not found`);t.status="paused",this.emitEvent("container","pause",e,{})}async unpauseContainer(e){const t=this.containers.get(e);if(!t)throw new Error(`Container ${e} not found`);t.status="running",this.emitEvent("container","unpause",e,{})}async restartContainer(e){const t=this.containers.get(e);if(!t)throw new Error(`Container ${e} not found`);t.status="running",t.startedAt=Date.now(),t.restartCount=(t.restartCount||0)+1,this.emitEvent("container","restart",e,{})}async removeContainer(e,t=!1){const n=this.containers.get(e);if(!n)throw new Error(`Container ${e} not found`);if(n.status==="running"&&!t)throw new Error("Cannot remove running container without force");this.containers.delete(e),this.statsCache.delete(e),this.emitEvent("container","destroy",e,{})}async listImages(){return Array.from(this.images.values())}async pullImage(e,t="latest"){await new Promise(a=>setTimeout(a,1e3));const n=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:n,repository:e,tag:t,size:100*1024*1024+Math.random()*500*1024*1024,createdAt:Date.now(),pulledAt:Date.now()};return this.images.set(n,s),this.emitEvent("image","pull",n,{repository:e,tag:t}),s}async buildImage(e){await new Promise(c=>setTimeout(c,2e3));const t=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[n,s]=e.tag.split(":"),a={id:t,repository:n||e.tag,tag:s||"latest",size:200*1024*1024+Math.random()*800*1024*1024,createdAt:Date.now(),builtAt:Date.now()};return this.images.set(t,a),this.emitEvent("image","build",t,{tag:e.tag}),a}async removeImage(e,t=!1){if(!this.images.get(e))throw new Error(`Image ${e} not found`);this.images.delete(e),this.emitEvent("image","delete",e,{})}async listNetworks(){return Array.from(this.networks.values())}async createNetwork(e){const t=`net-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:t,name:e.name,driver:e.driver||"bridge",scope:"local",subnet:e.subnet,gateway:e.gateway,created:Date.now(),internal:e.internal||!1,enableIPv6:e.enableIPv6||!1};return this.networks.set(t,n),this.emitEvent("network","create",t,{name:e.name}),n}async removeNetwork(e){if(!this.networks.get(e))throw new Error(`Network ${e} not found`);this.networks.delete(e),this.emitEvent("network","destroy",e,{})}async listVolumes(){return Array.from(this.volumes.values())}async createVolume(e){const t=`vol-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:t,name:e.name,driver:e.driver||"local",created:Date.now(),labels:e.labels};return this.volumes.set(t,n),this.emitEvent("volume","create",t,{name:e.name}),n}async removeVolume(e){if(!this.volumes.get(e))throw new Error(`Volume ${e} not found`);this.volumes.delete(e),this.emitEvent("volume","destroy",e,{})}async getContainerStats(e){const t=this.containers.get(e);if(!t||t.status!=="running")return null;let n=this.statsCache.get(e);return n||(n={id:e,name:t.name,cpuUsage:t.cpuUsage||10+Math.random()*70,memoryUsage:t.memoryUsage||(t.memoryLimit||512*1024*1024)*.3,memoryLimit:t.memoryLimit||512*1024*1024,networkRx:t.networkRx||0,networkTx:t.networkTx||0,timestamp:Date.now()},this.statsCache.set(e,n)),n.cpuUsage=t.cpuUsage||n.cpuUsage,n.memoryUsage=t.memoryUsage||n.memoryUsage,n.networkRx=t.networkRx||n.networkRx,n.networkTx=t.networkTx||n.networkTx,n.timestamp=Date.now(),n}async getSystemInfo(){return this.systemInfo?(this.systemInfo.containers=this.containers.size,this.systemInfo.containersRunning=Array.from(this.containers.values()).filter(e=>e.status==="running").length,this.systemInfo.containersPaused=Array.from(this.containers.values()).filter(e=>e.status==="paused").length,this.systemInfo.containersStopped=Array.from(this.containers.values()).filter(e=>e.status==="exited"||e.status==="dead").length,this.systemInfo.images=this.images.size,this.systemInfo.imagesSize=Array.from(this.images.values()).reduce((e,t)=>e+t.size,0),{...this.systemInfo}):null}subscribeToEvents(e){return this.eventSubscribers.add(e),()=>{this.eventSubscribers.delete(e)}}emitEvent(e,t,n,s){const a={id:`evt-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:e,action:t,actor:{id:n,attributes:s},time:Math.floor(Date.now()/1e3),timeNano:Date.now()*1e6};for(const c of this.eventSubscribers)try{c(a)}catch(l){console.error("Error in event callback:",l)}}updateContainerStats(e,t){const n=this.containers.get(e);n&&(t.cpuUsage!==void 0&&(n.cpuUsage=t.cpuUsage),t.memoryUsage!==void 0&&(n.memoryUsage=t.memoryUsage),t.memoryLimit!==void 0&&(n.memoryLimit=t.memoryLimit),t.networkRx!==void 0&&(n.networkRx=t.networkRx),t.networkTx!==void 0&&(n.networkTx=t.networkTx))}}class vT{config=null;mode="simulation";simulationProvider=null;realProvider=null;currentProvider=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;operationLatencyHistory=[];MAX_LATENCY_HISTORY=500;containers=new Map;syncInterval=null;syncEnabled=!1;lastSyncTime=0;dockerMetrics={containersTotal:0,containersRunning:0,containersStopped:0,containersPaused:0,imagesTotal:0,imagesSize:0,networksTotal:0,volumesTotal:0,volumesSize:0,operationsPerSecond:0,averageOperationLatency:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryLimit:0,totalNetworkRx:0,totalNetworkTx:0,buildOperationsPerSecond:0,pullOperationsPerSecond:0,pushOperationsPerSecond:0};lastUpdateTime=Date.now();initializeConfig(e){const t=e.data.config||{};if(this.config=t,this.mode=t.mode||"simulation",this.initializeProviders(),t.containers)for(const n of t.containers)this.containers.set(n.id,{...n});this.updateMetricsFromConfig(),this.mode!=="simulation"&&t.syncSettings?.enabled&&this.startSync()}initializeProviders(){if(this.simulationProvider=new yT(this.config?.containers,this.config?.images,this.config?.networks,this.config?.volumes),(this.mode==="real"||this.mode==="hybrid")&&this.config?.dockerConnection){const e={type:this.config.dockerConnection.type,url:this.config.dockerConnection.url,host:this.config.dockerConnection.host,port:this.config.dockerConnection.port,useTLS:this.config.dockerConnection.useTLS,caCert:this.config.dockerConnection.caCert,clientCert:this.config.dockerConnection.clientCert,clientKey:this.config.dockerConnection.clientKey};this.realProvider=new mT(e)}this.currentProvider=this.mode==="simulation"?this.simulationProvider:this.realProvider||this.simulationProvider}setMode(e){this.mode!==e&&(this.mode=e,this.stopSync(),this.initializeProviders(),this.mode!=="simulation"&&this.config?.syncSettings?.enabled&&this.startSync())}getMode(){return this.mode}startSync(){if(this.syncInterval)return;const e=this.config?.syncSettings?.interval||2e3;this.syncEnabled=!0,this.syncFromProvider(),this.syncInterval=setInterval(()=>{this.syncFromProvider()},e),this.config?.syncSettings?.useEvents&&this.currentProvider&&this.currentProvider.subscribeToEvents(t=>{this.handleDockerEvent(t)})}stopSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.syncEnabled=!1}async syncFromProvider(){if(!(!this.currentProvider||!this.currentProvider.isConnected()))try{const e=await this.currentProvider.listContainers();this.syncContainers(e);const t=await this.currentProvider.listImages();this.config&&(this.config.images=t);const n=await this.currentProvider.listNetworks();this.config&&(this.config.networks=n);const s=await this.currentProvider.listVolumes();this.config&&(this.config.volumes=s),this.lastSyncTime=Date.now(),this.updateMetricsFromConfig()}catch(e){console.error("Failed to sync from Docker provider:",e)}}syncContainers(e){for(const n of e){const s=this.containers.get(n.id);s?Object.assign(s,n):this.containers.set(n.id,{...n})}const t=new Set(e.map(n=>n.id));for(const[n]of this.containers.entries())t.has(n)||this.containers.delete(n);this.config&&(this.config.containers=Array.from(this.containers.values()))}handleDockerEvent(e){switch(e.type){case"container":this.handleContainerEvent(e);break;case"image":this.handleImageEvent(e);break;case"network":this.handleNetworkEvent(e);break;case"volume":this.handleVolumeEvent(e);break}}handleContainerEvent(e){const t=e.actor.id;e.action==="destroy"||e.action==="die"?this.containers.delete(t):this.currentProvider&&this.currentProvider.getContainer(t).then(n=>{n&&this.containers.set(t,n)})}handleImageEvent(e){}handleNetworkEvent(e){}handleVolumeEvent(e){}updateConfig(e){const t=e.data.config||{};this.config;const n=this.mode;this.config=t;const s=t.mode||"simulation";if(s!==n&&this.setMode(s),t.containers){const a=new Set(t.containers.map(c=>c.id));for(const[c,l]of this.containers.entries())a.has(c)||this.containers.delete(c);for(const c of t.containers){const l=this.containers.get(c.id);if(l){const d={...l,name:c.name,image:c.image,imageId:c.imageId,ports:c.ports,environment:c.environment,volumes:c.volumes,networks:c.networks,health:c.health,cpuUsage:l.status==="running"?l.cpuUsage:c.cpuUsage,memoryUsage:l.status==="running"?l.memoryUsage:c.memoryUsage,memoryLimit:c.memoryLimit||l.memoryLimit,networkRx:l.status==="running"?l.networkRx:c.networkRx,networkTx:l.status==="running"?l.networkTx:c.networkTx,status:c.status||l.status,createdAt:c.createdAt||l.createdAt,startedAt:c.startedAt||l.startedAt,finishedAt:c.finishedAt||l.finishedAt,restartCount:c.restartCount!==void 0?c.restartCount:l.restartCount,exitCode:c.exitCode!==void 0?c.exitCode:l.exitCode};this.containers.set(c.id,d)}else{const d={id:c.id,name:c.name,image:c.image,imageId:c.imageId,status:c.status||"created",createdAt:c.createdAt||Date.now(),startedAt:c.startedAt,finishedAt:c.finishedAt,restartCount:c.restartCount||0,cpuUsage:c.cpuUsage,memoryUsage:c.memoryUsage,memoryLimit:c.memoryLimit,networkRx:c.networkRx,networkTx:c.networkTx,ports:c.ports,environment:c.environment,volumes:c.volumes,networks:c.networks,health:c.health,exitCode:c.exitCode};this.containers.set(c.id,d)}}}this.updateMetricsFromConfig()}updateMetricsFromConfig(){this.config&&(this.dockerMetrics.containersTotal=this.containers.size,this.dockerMetrics.containersRunning=Array.from(this.containers.values()).filter(e=>e.status==="running").length,this.dockerMetrics.containersStopped=Array.from(this.containers.values()).filter(e=>e.status==="exited"||e.status==="dead").length,this.dockerMetrics.containersPaused=Array.from(this.containers.values()).filter(e=>e.status==="paused").length,this.dockerMetrics.imagesTotal=this.config.images?.length||0,this.dockerMetrics.imagesSize=(this.config.images||[]).reduce((e,t)=>e+t.size,0),this.dockerMetrics.networksTotal=this.config.networks?.length||0,this.dockerMetrics.volumesTotal=this.config.volumes?.length||0,this.dockerMetrics.volumesSize=(this.config.volumes||[]).reduce((e,t)=>e+(t.size||0),0))}performUpdate(e,t=!1){if(!this.config)return;const n=e-this.lastUpdateTime;this.lastUpdateTime=e,this.mode!=="simulation"&&this.currentProvider?.isConnected()&&this.updateContainerStatsFromProvider(),this.mode==="simulation"&&t&&this.simulateContainerOperations(e),this.mode==="simulation"&&this.simulateImageOperations(e,t),this.mode==="simulation"&&this.updateContainerResources(n),this.updateActiveOperations(e),this.updateMetrics(e)}async updateContainerStatsFromProvider(){if(!this.currentProvider)return;const e=Array.from(this.containers.values()).filter(t=>t.status==="running");for(const t of e)try{const n=await this.currentProvider.getContainerStats(t.id);n&&(t.cpuUsage=n.cpuUsage,t.memoryUsage=n.memoryUsage,t.memoryLimit=n.memoryLimit,t.networkRx=n.networkRx,t.networkTx=n.networkTx,this.mode==="hybrid"&&this.simulationProvider&&this.simulationProvider.updateContainerStats(t.id,n))}catch(n){console.error(`Failed to get stats for container ${t.id}:`,n)}}simulateContainerOperations(e){if(this.containers.size===0)return;const t=Math.min(1,.1+this.containers.size/20);if(Math.random()<t/10){const n=Array.from(this.containers.values()),s=n[Math.floor(Math.random()*n.length)];let a;s.status==="running"?a=Math.random()<.1?"stop":Math.random()<.2?"pause":Math.random()<.3?"restart":"create":s.status==="exited"||s.status==="dead"?a=Math.random()<.5?"start":"create":s.status==="paused"?a=Math.random()<.5?"unpause":"stop":a="create",this.simulateContainerOperation(s.id,a,e)}}simulateContainerOperation(e,t,n){if(!this.containers.get(e))return;const a=`${t}-${e}-${n}-${Math.random()}`;let c=100;switch(t){case"create":c=500+Math.random()*1e3;break;case"start":c=200+Math.random()*500;break;case"stop":c=100+Math.random()*300;break;case"pause":c=50+Math.random()*100;break;case"unpause":c=50+Math.random()*100;break;case"restart":c=300+Math.random()*700;break;case"remove":c=200+Math.random()*400;break}const l=n+c,d={id:a,type:t,containerId:e,startTime:n,status:"running",completionTime:l};this.activeOperations.set(a,d)}simulateImageOperations(e,t){if(!this.config?.images||this.config.images.length===0)return;const n=Math.min(.5,.05+this.config.images.length/50);if(t&&Math.random()<n/10){const s=this.config.images[Math.floor(Math.random()*this.config.images.length)],a=Math.random()<.7?"pull":Math.random()<.9?"build":"push";this.simulateImageOperation(s.id,a,e)}}simulateImageOperation(e,t,n){const s=`${t}-${e}-${n}-${Math.random()}`;let a=1e3;switch(t){case"pull":a=2e3+Math.random()*8e3;break;case"push":a=3e3+Math.random()*1e4;break;case"build":a=5e3+Math.random()*15e3;break}const c=n+a,l={id:s,type:t,imageId:e,startTime:n,status:"running",completionTime:c};this.activeOperations.set(s,l)}updateContainerResources(e){const t=Array.from(this.containers.values()).filter(d=>d.status==="running");let n=0,s=0,a=0,c=0,l=0;for(const d of t){const f=10+Math.random()*70,p=(Math.random()-.5)*10;d.cpuUsage=Math.max(0,Math.min(100,f+p));const m=d.memoryLimit||512*1024*1024;if(d.memoryLimit=m,!d.memoryUsage)d.memoryUsage=m*.3;else{const S=1+(Math.random()-.4)*.1;d.memoryUsage=Math.min(m*.95,d.memoryUsage*S)}const b=(1e3+Math.random()*9e3)*e/1e3;d.networkRx=(d.networkRx||0)+b,d.networkTx=(d.networkTx||0)+b*.8,n+=d.cpuUsage,s+=d.memoryUsage,a+=m,c+=d.networkRx||0,l+=d.networkTx||0}this.dockerMetrics.totalCpuUsage=t.length>0?n/t.length:0,this.dockerMetrics.totalMemoryUsage=s,this.dockerMetrics.totalMemoryLimit=a,this.dockerMetrics.totalNetworkRx=c,this.dockerMetrics.totalNetworkTx=l}updateActiveOperations(e){const t=[];for(const[s,a]of this.activeOperations.entries())a.completionTime&&e>=a.completionTime&&a.status==="running"&&t.push(a);for(const s of t)this.completeOperation(s,e);const n=e-6e4;for(const[s,a]of this.activeOperations.entries())a.startTime<n&&a.status==="completed"&&this.activeOperations.delete(s)}completeOperation(e,t){const n=e.completionTime?e.completionTime-e.startTime:0;switch(e.status="completed",e.duration=n,this.activeOperations.delete(e.id),this.addOperationToHistory(e),e.type){case"create":case"start":if(e.containerId){const s=this.containers.get(e.containerId);s&&(s.status="running",s.startedAt=t,s.restartCount=s.restartCount||0)}break;case"stop":if(e.containerId){const s=this.containers.get(e.containerId);s&&(s.status="exited",s.finishedAt=t,s.cpuUsage=0,s.memoryUsage=0)}break;case"pause":if(e.containerId){const s=this.containers.get(e.containerId);s&&(s.status="paused")}break;case"unpause":if(e.containerId){const s=this.containers.get(e.containerId);s&&(s.status="running")}break;case"restart":if(e.containerId){const s=this.containers.get(e.containerId);s&&(s.status="running",s.startedAt=t,s.restartCount=(s.restartCount||0)+1)}break;case"remove":e.containerId&&this.containers.delete(e.containerId);break}n>0&&(this.operationLatencyHistory.push(n),this.operationLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.operationLatencyHistory.shift())}addOperationToHistory(e){this.operationHistory.push(e),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(e){const t=e-1e4,n=this.operationHistory.filter(s=>s.startTime>t);this.dockerMetrics.operationsPerSecond=n.length/10,this.dockerMetrics.buildOperationsPerSecond=n.filter(s=>s.type==="build").length/10,this.dockerMetrics.pullOperationsPerSecond=n.filter(s=>s.type==="pull").length/10,this.dockerMetrics.pushOperationsPerSecond=n.filter(s=>s.type==="push").length/10,this.operationLatencyHistory.length>0&&(this.dockerMetrics.averageOperationLatency=this.operationLatencyHistory.reduce((s,a)=>s+a,0)/this.operationLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const e=this.dockerMetrics.operationsPerSecond,t=this.dockerMetrics.averageOperationLatency,n=this.operationHistory.filter(y=>y.status==="failed").length,s=Math.min(1,n/Math.max(1,this.operationHistory.length)),a=Math.min(.95,this.dockerMetrics.totalCpuUsage/100),c=this.dockerMetrics.totalMemoryLimit>0?Math.min(.95,this.dockerMetrics.totalMemoryUsage/this.dockerMetrics.totalMemoryLimit):.1,l=1e3*1024*1024,d=Math.min(.95,(this.dockerMetrics.totalNetworkRx+this.dockerMetrics.totalNetworkTx)/l*8),f=100*1024*1024*1024,p=this.dockerMetrics.imagesSize+this.dockerMetrics.volumesSize,m=Math.min(.95,p/f);return{throughput:e,averageLatency:t||0,errorRate:s,cpuUtilization:a,memoryUtilization:c,networkUtilization:d,diskUtilization:m}}getMetrics(){return{...this.dockerMetrics}}getConfig(){return this.config?{...this.config}:null}getContainers(){return Array.from(this.containers.values())}getContainer(e){return this.containers.get(e)}getImages(){return this.config?.images||[]}getNetworks(){return this.config?.networks||[]}getVolumes(){return this.config?.volumes||[]}getProvider(){return this.currentProvider}async testConnection(){return this.currentProvider?await this.currentProvider.testConnection():{success:!1,error:"No provider available"}}async connect(){if(!this.currentProvider)return!1;const e=await this.currentProvider.connect();return e&&this.config?.syncSettings?.enabled&&this.startSync(),e}async disconnect(){this.stopSync(),this.currentProvider&&await this.currentProvider.disconnect()}isConnected(){return this.currentProvider?.isConnected()||!1}async createContainerViaProvider(e){if(!this.currentProvider)throw new Error("No provider available");const t={name:e.name,image:e.image,command:e.command,env:e.env,ports:e.ports,volumes:e.volumes,networks:e.networks,memoryLimit:e.memoryLimit,cpuLimit:e.cpuLimit},n=await this.currentProvider.createContainer(t);return this.containers.set(n.id,n),this.config&&(this.config.containers=Array.from(this.containers.values())),n}async startContainerViaProvider(e){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.startContainer(e);const t=this.containers.get(e);t&&(t.status="running",t.startedAt=Date.now())}async stopContainerViaProvider(e){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.stopContainer(e);const t=this.containers.get(e);t&&(t.status="exited",t.finishedAt=Date.now())}async removeContainerViaProvider(e,t=!1){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.removeContainer(e,t),this.containers.delete(e),this.config&&(this.config.containers=Array.from(this.containers.values()))}async pullImageViaProvider(e,t="latest"){if(!this.currentProvider)throw new Error("No provider available");const n=await this.currentProvider.pullImage(e,t);if(this.config){this.config.images||(this.config.images=[]);const s=this.config.images.findIndex(a=>a.id===n.id);s>=0?this.config.images[s]=n:this.config.images.push(n)}return n}async getSystemInfo(){return this.currentProvider?await this.currentProvider.getSystemInfo():null}}class bT{config=null;pods=new Map;deployments=new Map;services=new Map;configMaps=new Map;secrets=new Map;namespaces=new Map;nodes=new Map;events=[];persistentVolumeClaims=new Map;kubernetesMetrics={podsTotal:0,podsRunning:0,podsPending:0,podsFailed:0,podsSucceeded:0,deploymentsTotal:0,deploymentsReady:0,deploymentsNotReady:0,servicesTotal:0,servicesClusterIP:0,servicesNodePort:0,servicesLoadBalancer:0,nodesTotal:0,nodesReady:0,nodesNotReady:0,totalCpuRequests:0,totalCpuLimits:0,totalMemoryRequests:0,totalMemoryLimits:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryCapacity:0,namespacesTotal:0,configMapsTotal:0,secretsTotal:0};lastUpdateTime=Date.now();updateInterval=1e3;initializeConfig(e){const t=e.data.config||{};this.config=t,this.config.defaultNamespace||(this.config.defaultNamespace="default"),this.config.namespaces||(this.config.namespaces=[]),this.config.namespaces.some(s=>s.name===this.config.defaultNamespace)||this.config.namespaces.push({id:this.generateId(),name:this.config.defaultNamespace,phase:"Active",createdAt:Date.now()}),(!this.config.nodes||this.config.nodes.length===0)&&(this.config.nodes=[{id:this.generateId(),name:"node-1",roles:["worker"],conditions:[{type:"Ready",status:"True",lastTransitionTime:Date.now()}],allocatable:{cpu:"4",memory:"8Gi",pods:"110"},capacity:{cpu:"4",memory:"8Gi",pods:"110"},createdAt:Date.now(),unschedulable:!1,podCount:0}]),this.initializeResources(),this.updateMetricsFromResources()}initializeResources(){if(this.config){if(this.pods.clear(),this.config.pods)for(const e of this.config.pods)this.pods.set(e.id,{...e});if(this.deployments.clear(),this.config.deployments)for(const e of this.config.deployments)this.deployments.set(e.id,{...e});if(this.services.clear(),this.config.services)for(const e of this.config.services)this.services.set(e.id,{...e});if(this.configMaps.clear(),this.config.configMaps)for(const e of this.config.configMaps)this.configMaps.set(e.id,{...e});if(this.secrets.clear(),this.config.secrets)for(const e of this.config.secrets)this.secrets.set(e.id,{...e});if(this.namespaces.clear(),this.config.namespaces)for(const e of this.config.namespaces)this.namespaces.set(e.id,{...e});if(this.nodes.clear(),this.config.nodes)for(const e of this.config.nodes)this.nodes.set(e.id,{...e});if(this.persistentVolumeClaims.clear(),this.config.persistentVolumeClaims)for(const e of this.config.persistentVolumeClaims)this.persistentVolumeClaims.set(e.id,{...e});this.events=this.config.events||[]}}updateConfig(e){const t=e.data.config||{};this.config,this.config=t,this.syncResources(),this.updateMetricsFromResources()}syncResources(){if(this.config){if(this.config.pods){const e=new Set(this.config.pods.map(t=>t.id));for(const[t]of this.pods.entries())e.has(t)||this.pods.delete(t);for(const t of this.config.pods){const n=this.pods.get(t.id);n?this.pods.set(t.id,{...n,...t,totalCpuUsage:n.phase==="Running"?n.totalCpuUsage:t.totalCpuUsage,totalMemoryUsage:n.phase==="Running"?n.totalMemoryUsage:t.totalMemoryUsage,startedAt:t.startedAt||n.startedAt}):this.pods.set(t.id,{...t})}}this.initializeResources()}}updateMetricsFromResources(){this.kubernetesMetrics.podsTotal=this.pods.size,this.kubernetesMetrics.podsRunning=Array.from(this.pods.values()).filter(s=>s.phase==="Running").length,this.kubernetesMetrics.podsPending=Array.from(this.pods.values()).filter(s=>s.phase==="Pending").length,this.kubernetesMetrics.podsFailed=Array.from(this.pods.values()).filter(s=>s.phase==="Failed").length,this.kubernetesMetrics.podsSucceeded=Array.from(this.pods.values()).filter(s=>s.phase==="Succeeded").length,this.kubernetesMetrics.deploymentsTotal=this.deployments.size,this.kubernetesMetrics.deploymentsReady=Array.from(this.deployments.values()).filter(s=>s.readyReplicas===s.replicas&&s.replicas>0).length,this.kubernetesMetrics.deploymentsNotReady=Array.from(this.deployments.values()).filter(s=>s.readyReplicas!==s.replicas||s.replicas===0).length,this.kubernetesMetrics.servicesTotal=this.services.size,this.kubernetesMetrics.servicesClusterIP=Array.from(this.services.values()).filter(s=>s.type==="ClusterIP").length,this.kubernetesMetrics.servicesNodePort=Array.from(this.services.values()).filter(s=>s.type==="NodePort").length,this.kubernetesMetrics.servicesLoadBalancer=Array.from(this.services.values()).filter(s=>s.type==="LoadBalancer").length,this.kubernetesMetrics.nodesTotal=this.nodes.size,this.kubernetesMetrics.nodesReady=Array.from(this.nodes.values()).filter(s=>s.conditions?.some(a=>a.type==="Ready"&&a.status==="True")).length,this.kubernetesMetrics.nodesNotReady=this.kubernetesMetrics.nodesTotal-this.kubernetesMetrics.nodesReady;let e=0,t=0,n=0;for(const s of this.pods.values())s.totalCpuUsage&&(e+=s.totalCpuUsage),s.totalMemoryUsage&&(t+=s.totalMemoryUsage);for(const s of this.nodes.values())s.memoryCapacity&&(n+=s.memoryCapacity);this.kubernetesMetrics.totalCpuUsage=e,this.kubernetesMetrics.totalMemoryUsage=t,this.kubernetesMetrics.totalMemoryCapacity=n,this.kubernetesMetrics.namespacesTotal=this.namespaces.size,this.kubernetesMetrics.configMapsTotal=this.configMaps.size,this.kubernetesMetrics.secretsTotal=this.secrets.size}simulateStep(){const e=Date.now(),t=e-this.lastUpdateTime;this.lastUpdateTime=e,this.simulatePodLifecycle(t),this.simulateDeploymentReconciliation(t),this.simulateNodeMetrics(t),this.updateMetricsFromResources()}simulatePodLifecycle(e){for(const t of this.pods.values())t.phase==="Running"&&(t.totalCpuUsage?t.totalCpuUsage=Math.max(0,Math.min(100,t.totalCpuUsage+(Math.random()-.5)*5)):t.totalCpuUsage=20+Math.random()*60,t.totalMemoryUsage?t.totalMemoryUsage=Math.max(0,t.totalMemoryUsage+(Math.random()-.5)*100*1024*1024):t.totalMemoryUsage=512*1024*1024+Math.random()*(2*1024*1024*1024),t.totalMemoryLimit||(t.totalMemoryLimit=t.totalMemoryUsage*1.5))}simulateDeploymentReconciliation(e){for(const t of this.deployments.values()){const n=Array.from(this.pods.values()).filter(c=>c.namespace!==t.namespace?!1:t.selector?Object.entries(t.selector).every(([l,d])=>c.labels?.[l]===d):!1),s=n.filter(c=>c.phase==="Running"),a=s.filter(c=>c.conditions?.find(d=>d.type==="Ready")?.status==="True");t.readyReplicas=a.length,t.availableReplicas=s.length,t.updatedReplicas=s.length,t.unavailableReplicas=Math.max(0,t.replicas-t.availableReplicas),n.length<t.replicas&&!t.paused&&t.replicas-n.length>0&&Math.random()>.7&&this.createPodForDeployment(t)}}createPodForDeployment(e){const t=`${e.name}-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,n=this.generateId(),s={id:n,name:t,namespace:e.namespace||this.config?.defaultNamespace||"default",labels:e.template?.labels||e.selector,phase:"Pending",status:"Pending",createdAt:Date.now(),restartPolicy:"Always",restartCount:0};this.pods.set(n,s),this.config&&this.config.pods?this.config.pods.push(s):this.config&&(this.config.pods=[s]),setTimeout(()=>{const a=this.pods.get(n);a&&(a.phase="Running",a.status="Running",a.startedAt=Date.now(),a.podIP=`10.244.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,a.conditions=[{type:"Ready",status:"True",lastTransitionTime:Date.now()},{type:"PodScheduled",status:"True",lastTransitionTime:Date.now()}])},1e3+Math.random()*2e3)}simulateNodeMetrics(e){for(const t of this.nodes.values()){const n=Array.from(this.pods.values()).filter(c=>c.nodeName===t.name);t.podCount=n.length;let s=0,a=0;for(const c of n)c.totalCpuUsage&&(s+=c.totalCpuUsage),c.totalMemoryUsage&&(a+=c.totalMemoryUsage);t.cpuUsage=Math.min(100,s),t.capacity?.memory&&!t.memoryCapacity&&(t.memoryCapacity=this.parseMemoryString(t.capacity.memory)),t.memoryCapacity&&(t.memoryUsage=Math.min(t.memoryCapacity,a))}}parseMemoryString(e){const t=e.match(/^(\d+)([KMGT]?i?)$/);if(!t)return 0;const n=parseInt(t[1],10),s=t[2].toLowerCase(),a={"":1,k:1024,ki:1024,m:1024*1024,mi:1024*1024,g:1024*1024*1024,gi:1024*1024*1024,t:1024*1024*1024*1024,ti:1024*1024*1024*1024};return n*(a[s]||1)}getPods(){return Array.from(this.pods.values())}getPodsByNamespace(e){return Array.from(this.pods.values()).filter(t=>t.namespace===e)}getDeployments(){return Array.from(this.deployments.values())}getDeploymentsByNamespace(e){return Array.from(this.deployments.values()).filter(t=>t.namespace===e)}getServices(){return Array.from(this.services.values())}getServicesByNamespace(e){return Array.from(this.services.values()).filter(t=>t.namespace===e)}getConfigMaps(){return Array.from(this.configMaps.values())}getConfigMapsByNamespace(e){return Array.from(this.configMaps.values()).filter(t=>t.namespace===e)}getSecrets(){return Array.from(this.secrets.values())}getSecretsByNamespace(e){return Array.from(this.secrets.values()).filter(t=>t.namespace===e)}getNamespaces(){return Array.from(this.namespaces.values())}getNodes(){return Array.from(this.nodes.values())}getEvents(){return[...this.events]}getEventsByNamespace(e){return this.events.filter(t=>t.namespace===e)}getPersistentVolumeClaims(){return Array.from(this.persistentVolumeClaims.values())}getMetrics(){return{...this.kubernetesMetrics}}getLoad(){const e=Array.from(this.nodes.values()).reduce((d,f)=>{if(f.capacity?.cpu){const p=parseFloat(f.capacity.cpu);return d+p*1e3}return d},0),t=this.kubernetesMetrics.totalCpuUsage,n=e>0?t/e:0,s=this.kubernetesMetrics.totalMemoryCapacity>0?this.kubernetesMetrics.totalMemoryUsage/this.kubernetesMetrics.totalMemoryCapacity:0,a=Array.from(this.nodes.values()).reduce((d,f)=>f.capacity?.pods?d+parseInt(f.capacity.pods,10):d,0),c=a>0?this.kubernetesMetrics.podsTotal/a:0,l=this.kubernetesMetrics.podsTotal>0?this.kubernetesMetrics.podsFailed/this.kubernetesMetrics.podsTotal:0;return{throughput:this.kubernetesMetrics.podsRunning*10,averageLatency:100+Math.random()*200,errorRate:l,cpuUtilization:Math.min(1,n),memoryUtilization:Math.min(1,s),podUtilization:Math.min(1,c),networkUtilization:.1+Math.random()*.3,diskUtilization:.2+Math.random()*.2}}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getConfig(){return this.config?(this.config.pods=Array.from(this.pods.values()),this.config.deployments=Array.from(this.deployments.values()),this.config.services=Array.from(this.services.values()),this.config.configMaps=Array.from(this.configMaps.values()),this.config.secrets=Array.from(this.secrets.values()),this.config.namespaces=Array.from(this.namespaces.values()),this.config.nodes=Array.from(this.nodes.values()),this.config.events=this.events,this.config.persistentVolumeClaims=Array.from(this.persistentVolumeClaims.values()),{...this.config}):null}}class xT{errors=[];maxErrors=200;errorCounts=new Map;listeners=[];addError(e,t={}){const n=this.generateErrorId(e,t),s=this.errorCounts.get(n)||0;this.errorCounts.set(n,s+1);const a=this.errors.find(l=>l.id===n);if(a&&a.count!==void 0)return a.count=s+1,a.timestamp=Date.now(),this.notifyListeners(a),n;const c={id:n,timestamp:Date.now(),severity:t.severity||this.determineSeverity(e),source:t.source||"unknown",componentId:t.componentId,componentLabel:t.componentLabel,componentType:t.componentType,message:e instanceof Error?e.message:String(e),errorType:e instanceof Error?e.constructor.name:void 0,stack:e instanceof Error?e.stack:void 0,context:t.context,count:s+1};if(this.errors.unshift(c),this.errors.length>this.maxErrors){const l=this.errors.pop();l&&this.errorCounts.delete(l.id)}return this.notifyListeners(c),n}generateErrorId(e,t){const n=e instanceof Error?e.message:String(e),s=`${t.source||"unknown"}-${t.componentType||"unknown"}-${t.componentId||"global"}-${n}`;let a=0;for(let c=0;c<s.length;c++){const l=s.charCodeAt(c);a=(a<<5)-a+l,a=a&a}return`error-${Math.abs(a)}`}determineSeverity(e){if(e instanceof Error){const t=e.constructor.name,n=e.message.toLowerCase();if(t==="RangeError"||t==="ReferenceError"||n.includes("maximum call stack")||n.includes("cannot read property")||n.includes("is not a function"))return"critical";if(t==="TypeError"||n.includes("undefined")||n.includes("null"))return"warning"}return"info"}getErrors(){return[...this.errors]}getErrorsBySeverity(e){return this.errors.filter(t=>t.severity===e)}getErrorsBySource(e){return this.errors.filter(t=>t.source===e)}getErrorsByComponent(e){return this.errors.filter(t=>t.componentId===e)}getCriticalErrors(){return this.getErrorsBySeverity("critical")}getErrorCount(e){return e?this.getErrorsBySeverity(e).length:this.errors.length}clear(){this.errors=[],this.errorCounts.clear()}clearByFilter(e){this.errors=this.errors.filter(t=>{const n=!e(t);return n||this.errorCounts.delete(t.id),n})}removeError(e){this.errors=this.errors.filter(t=>t.id!==e),this.errorCounts.delete(e)}onError(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(n){console.error("Error in error listener:",n)}})}getStats(){const e={total:this.errors.length,critical:this.getErrorCount("critical"),warning:this.getErrorCount("warning"),info:this.getErrorCount("info"),bySource:{}};return["emulation-engine","component-engine","alert-system","data-flow","routing-engine","initialization","configuration","unknown"].forEach(n=>{e.bySource[n]=this.getErrorsBySource(n).length}),e}}const ct=new xT;class wT{nodes=[];connections=[];metrics=new Map;connectionMetrics=new Map;isRunning=!1;simulationTime=0;baseTime=Date.now();pausedTime=0;updateInterval=100;intervalId=null;latencyHistory=new Map;connectionLatencyHistory=new Map;HISTORY_SIZE=500;rabbitMQRoutingEngines=new Map;lastRabbitMQUpdate=new Map;activeMQRoutingEngines=new Map;lastActiveMQUpdate=new Map;sqsRoutingEngines=new Map;lastSQSUpdate=new Map;azureServiceBusRoutingEngines=new Map;lastAzureServiceBusUpdate=new Map;pubSubRoutingEngines=new Map;lastPubSubUpdate=new Map;kongRoutingEngines=new Map;nginxRoutingEngines=new Map;apigeeRoutingEngines=new Map;mulesoftRoutingEngines=new Map;graphQLGatewayRoutingEngines=new Map;lastGraphQLGatewayUpdate=new Map;bffRoutingEngines=new Map;webhookRelayRoutingEngines=new Map;redisRoutingEngines=new Map;cassandraRoutingEngines=new Map;clickHouseRoutingEngines=new Map;snowflakeRoutingEngines=new Map;elasticsearchRoutingEngines=new Map;s3RoutingEngines=new Map;postgresConnectionPools=new Map;prometheusEngines=new Map;grafanaEngines=new Map;lokiEngines=new Map;jaegerEngines=new Map;otelCollectorEngines=new Map;pagerDutyEngines=new Map;keycloakEngines=new Map;vaultEngines=new Map;wafEngines=new Map;firewallEngines=new Map;idsIpsEngines=new Map;jenkinsEngines=new Map;gitlabCIEngines=new Map;argoCDEngines=new Map;terraformEngines=new Map;harborEngines=new Map;dockerEngines=new Map;kubernetesEngines=new Map;constructor(){this.initializeMetrics()}calculatePercentile(e,t){if(e.length===0)return 0;const n=t/100*(e.length-1),s=Math.floor(n),a=Math.ceil(n),c=n-s;return s===a?e[s]:e[s]*(1-c)+e[a]*c}updateLatencyPercentiles(e,t,n){let s=this.latencyHistory.get(e);if(s||(s=[],this.latencyHistory.set(e,s)),s.push(t),s.length>this.HISTORY_SIZE&&s.shift(),s.length>0){const a=[...s].sort((c,l)=>c-l);n.latencyP50=this.calculatePercentile(a,50),n.latencyP99=this.calculatePercentile(a,99)}}updateConnectionLatencyPercentiles(e,t,n){let s=this.connectionLatencyHistory.get(e);if(s||(s=[],this.connectionLatencyHistory.set(e,s)),s.push(t),s.length>this.HISTORY_SIZE&&s.shift(),s.length>0){const a=[...s].sort((c,l)=>c-l);n.latencyP50=this.calculatePercentile(a,50),n.latencyP99=this.calculatePercentile(a,99)}}initialize(e,t){this.nodes=e,this.connections=t,this.initializeMetrics();for(const n of e){if(n.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(n),n.type==="activemq"&&this.initializeActiveMQRoutingEngine(n),n.type==="aws-sqs"&&this.initializeSQSRoutingEngine(n),n.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(n),n.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(n),n.type==="kong"&&this.initializeKongRoutingEngine(n),n.type==="nginx"&&this.initializeNginxRoutingEngine(n),n.type==="apigee"&&this.initializeApigeeRoutingEngine(n),n.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(n),n.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(n),n.type==="bff-service"&&this.initializeBFFRoutingEngine(n),n.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(n),n.type==="postgres"&&this.initializePostgreSQLConnectionPool(n),n.type==="redis"&&this.initializeRedisRoutingEngine(n),n.type==="cassandra"&&this.initializeCassandraRoutingEngine(n),n.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(n),n.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(n),n.type==="elasticsearch"&&this.initializeElasticsearchRoutingEngine(n),n.type==="s3-datalake"&&this.initializeS3RoutingEngine(n),n.type==="prometheus"&&this.initializePrometheusEngine(n),n.type==="grafana"&&this.initializeGrafanaEngine(n),n.type==="jaeger"&&this.initializeJaegerEngine(n),n.type==="otel-collector"&&this.initializeOpenTelemetryCollectorEngine(n),n.type==="pagerduty"&&this.initializePagerDutyEngine(n),n.type==="keycloak")try{this.initializeKeycloakEngine(n)}catch(s){ct.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeKeycloakEngine"}})}if(n.type==="secrets-vault")try{this.initializeVaultEngine(n)}catch(s){ct.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeVaultEngine"}})}if(n.type==="waf")try{this.initializeWAFEngine(n)}catch(s){ct.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeWAFEngine"}})}if(n.type==="firewall")try{this.initializeFirewallEngine(n)}catch(s){ct.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeFirewallEngine"}})}if(n.type==="ids-ips")try{this.initializeIDSIPSEngine(n)}catch(s){ct.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeIDSIPSEngine"}})}n.type==="jenkins"&&this.initializeJenkinsEngine(n),n.type==="gitlab-ci"&&this.initializeGitLabCIEngine(n),n.type==="argo-cd"&&this.initializeArgoCDEngine(n),n.type==="terraform"&&this.initializeTerraformEngine(n),n.type==="harbor"&&(this.harborEngines.has(n.id)?this.harborEngines.get(n.id).updateConfig(n):this.initializeHarborEngine(n)),n.type==="docker"&&(this.dockerEngines.has(n.id)?this.dockerEngines.get(n.id).updateConfig(n):this.initializeDockerEngine(n)),n.type==="kubernetes"&&(this.kubernetesEngines.has(n.id)?this.kubernetesEngines.get(n.id).updateConfig(n):this.initializeKubernetesEngine(n))}for(const n of e)if(n.type==="postgres"){const s=this.postgresConnectionPools.get(n.id);if(s){const a=n.data.config;s.updateConfig({maxConnections:a.maxConnections||100,minConnections:a.minConnections||0,idleTimeout:a.idleTimeout||3e5,maxLifetime:a.maxLifetime||36e5,connectionTimeout:a.connectionTimeout||5e3})}}fn.initialize(e,t)}updateNodesAndConnections(e,t){this.nodes=e,this.connections=t;for(const a of e){if(this.metrics.has(a.id)||this.metrics.set(a.id,this.createDefaultMetrics(a.id,a.type)),a.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(a),a.type==="activemq"&&this.initializeActiveMQRoutingEngine(a),a.type==="aws-sqs"&&this.initializeSQSRoutingEngine(a),a.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(a),a.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(a),a.type==="kong"&&this.initializeKongRoutingEngine(a),a.type==="nginx"&&this.initializeNginxRoutingEngine(a),a.type==="apigee"&&this.initializeApigeeRoutingEngine(a),a.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(a),a.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(a),a.type==="bff-service"&&this.initializeBFFRoutingEngine(a),a.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(a),a.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(a),a.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(a),a.type==="waf")try{this.wafEngines.has(a.id)?this.wafEngines.get(a.id).updateConfig(a):this.initializeWAFEngine(a)}catch(c){ct.addError(c,{severity:"critical",source:"initialization",componentId:a.id,componentLabel:a.data.label,componentType:a.type,context:{operation:"initializeWAFEngine"}})}if(a.type==="firewall")try{this.firewallEngines.has(a.id)?this.firewallEngines.get(a.id).initializeConfig(a):this.initializeFirewallEngine(a)}catch(c){ct.addError(c,{severity:"critical",source:"initialization",componentId:a.id,componentLabel:a.data.label,componentType:a.type,context:{operation:"initializeFirewallEngine"}})}if(a.type==="ids-ips")try{this.idsIpsEngines.has(a.id)?this.idsIpsEngines.get(a.id).updateConfig(a):this.initializeIDSIPSEngine(a)}catch(c){ct.addError(c,{severity:"critical",source:"initialization",componentId:a.id,componentLabel:a.data.label,componentType:a.type,context:{operation:"initializeIDSIPSEngine"}})}a.type==="jenkins"&&(this.jenkinsEngines.has(a.id)?this.jenkinsEngines.get(a.id).updateConfig(a):this.initializeJenkinsEngine(a)),a.type==="gitlab-ci"&&(this.gitlabCIEngines.has(a.id)?this.gitlabCIEngines.get(a.id).updateConfig(a):this.initializeGitLabCIEngine(a)),a.type==="argo-cd"&&(this.argoCDEngines.has(a.id)?this.argoCDEngines.get(a.id).initializeConfig(a):this.initializeArgoCDEngine(a)),a.type==="terraform"&&(this.terraformEngines.has(a.id)?this.terraformEngines.get(a.id).updateConfig(a):this.initializeTerraformEngine(a))}const n=new Set(e.map(a=>a.id));for(const[a]of this.metrics.entries())n.has(a)||(this.metrics.delete(a),this.rabbitMQRoutingEngines.delete(a),this.activeMQRoutingEngines.delete(a),this.sqsRoutingEngines.delete(a),this.azureServiceBusRoutingEngines.delete(a),this.pubSubRoutingEngines.delete(a),this.kongRoutingEngines.delete(a),this.nginxRoutingEngines.delete(a),this.apigeeRoutingEngines.delete(a),this.mulesoftRoutingEngines.delete(a),this.graphQLGatewayRoutingEngines.delete(a),this.bffRoutingEngines.delete(a),this.webhookRelayRoutingEngines.delete(a),this.redisRoutingEngines.delete(a),this.cassandraRoutingEngines.delete(a),this.clickHouseRoutingEngines.delete(a),this.snowflakeRoutingEngines.delete(a),this.elasticsearchRoutingEngines.delete(a),this.s3RoutingEngines.delete(a),this.graphQLGatewayRoutingEngines.delete(a),this.keycloakEngines.delete(a),this.vaultEngines.delete(a),this.wafEngines.delete(a),this.firewallEngines.delete(a),this.idsIpsEngines.delete(a),this.jenkinsEngines.delete(a),this.gitlabCIEngines.delete(a),this.argoCDEngines.delete(a),this.terraformEngines.delete(a),this.harborEngines.delete(a),this.lastRabbitMQUpdate.delete(a),this.lastActiveMQUpdate.delete(a),this.lastSQSUpdate.delete(a),this.lastAzureServiceBusUpdate.delete(a),this.lastPubSubUpdate.delete(a),this.lastGraphQLGatewayUpdate.delete(a));for(const a of t)this.connectionMetrics.has(a.id)||this.connectionMetrics.set(a.id,this.createDefaultConnectionMetrics(a));const s=new Set(t.map(a=>a.id));for(const[a]of this.connectionMetrics.entries())s.has(a)||this.connectionMetrics.delete(a);fn.updateNodesAndConnections(e,t)}start(){if(console.log("EmulationEngine.start() called",{isRunning:this.isRunning,hasInterval:!!this.intervalId}),this.isRunning&&!this.intervalId&&(console.log("Inconsistent state detected: isRunning=true but no interval, stopping first..."),this.stop()),this.isRunning){console.log("Already running, returning early");return}console.log("Setting isRunning to true and creating interval..."),this.isRunning=!0,this.baseTime=Date.now()-this.pausedTime,console.log("Starting data flow engine..."),fn.start(),console.log("Creating simulation interval..."),this.intervalId=setInterval(()=>{try{this.simulate()}catch(e){console.error("Error in simulation step:",e),ct.addError(e,{severity:"critical",source:"emulation-engine",context:{simulationTime:this.simulationTime}})}},this.updateInterval),console.log("EmulationEngine.start() complete",{intervalId:!!this.intervalId})}stop(){this.isRunning&&(this.isRunning=!1,this.pausedTime=this.simulationTime,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),fn.stop())}resetSimulation(){this.stop(),this.simulationTime=0,this.pausedTime=0,this.baseTime=Date.now(),this.initializeMetrics()}simulate(){this.simulationTime=Date.now()-this.baseTime;const e=Date.now();for(const[n,s]of this.rabbitMQRoutingEngines.entries()){const a=this.lastRabbitMQUpdate.get(n)||e,c=e-a;c>0&&(s.processConsumption(c),this.lastRabbitMQUpdate.set(n,e))}for(const[n,s]of this.activeMQRoutingEngines.entries()){const a=this.lastActiveMQUpdate.get(n)||e,c=e-a;c>0&&(s.processConsumption(c),this.lastActiveMQUpdate.set(n,e))}for(const[n,s]of this.sqsRoutingEngines.entries()){const a=this.lastSQSUpdate.get(n)||e,c=e-a;c>0&&(s.processConsumption(c),this.lastSQSUpdate.set(n,e))}for(const[n,s]of this.azureServiceBusRoutingEngines.entries()){const a=this.lastAzureServiceBusUpdate.get(n)||e,c=e-a;c>0&&(s.processConsumption(c),this.lastAzureServiceBusUpdate.set(n,e))}for(const[n,s]of this.pubSubRoutingEngines.entries()){const a=this.lastPubSubUpdate.get(n)||e,c=e-a;c>0&&(s.processConsumption(c),this.lastPubSubUpdate.set(n,e))}for(const n of this.nodes)this.updateComponentMetrics(n);try{fa.analyze(this.nodes,this.metrics,this.connectionMetrics,[])}catch(n){ct.addError(n,{severity:"critical",source:"alert-system",context:{operation:"analyze"}})}const t=fa.getAlerts();for(const[n,s]of this.pagerDutyEngines.entries())s.processAlerts(e,t),s.advanceTime(e);for(const[n,s]of this.prometheusEngines.entries())s.performScraping(e,this.nodes,this.metrics);for(const[n,s]of this.grafanaEngines.entries()){const a=this.nodes.find(c=>c.id===n);if(a){const c=this.isPrometheusAvailableForGrafana(a),l=this.createLokiQueryExecutor(a);s.performUpdate(e,c,l)}}for(const[n,s]of this.lokiEngines.entries())s.performRetention(e);for(const[n,s]of this.jaegerEngines.entries())s.performCleanup(e);for(const[n,s]of this.jenkinsEngines.entries())try{const a=this.nodes.find(d=>d.id===n);s.performUpdate(e);const c=s.calculateComponentMetrics(),l=this.metrics.get(n);l&&c&&(l.throughput=c.throughput||l.throughput,l.latency=c.latency||l.latency,l.utilization=(c.utilization||0)/100,l.errorRate=(c.errorRate||0)/100,l.timestamp=e)}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"jenkins",operation:"performUpdate"}})}for(const[n,s]of this.gitlabCIEngines.entries())try{const a=this.nodes.find(d=>d.id===n);s.performUpdate(e);const c=s.getMetrics(),l=this.metrics.get(n);if(l&&c){l.throughput=c.pipelinesPerHour/3600,l.latency=c.averagePipelineDuration||0;const d=c.pipelinesSuccess+c.pipelinesFailed;l.errorRate=d>0?c.pipelinesFailed/d:0,l.utilization=c.pipelinesTotal>0?c.pipelinesRunning/c.pipelinesTotal:0,l.customMetrics={pipelinesTotal:c.pipelinesTotal,pipelinesRunning:c.pipelinesRunning,jobsRunning:c.jobsRunning,runnersOnline:c.runnersOnline}}}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"gitlab-ci",operation:"performUpdate"}})}for(const[n,s]of this.argoCDEngines.entries())try{const a=this.nodes.find(d=>d.id===n);s.performUpdate(e);const c=s.getMetrics(),l=this.metrics.get(n);if(l&&c){l.throughput=c.syncRate/3600,l.latency=c.averageSyncDuration||0;const d=c.syncOperationsSuccess+c.syncOperationsFailed;l.errorRate=d>0?c.syncOperationsFailed/d:0,l.utilization=c.applicationsTotal>0?c.syncOperationsRunning/c.applicationsTotal:0,l.customMetrics={applicationsTotal:c.applicationsTotal,applicationsSynced:c.applicationsSynced,applicationsOutOfSync:c.applicationsOutOfSync,syncOperationsRunning:c.syncOperationsRunning,repositoriesConnected:c.repositoriesConnected}}}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"argo-cd",operation:"performUpdate"}})}for(const[n,s]of this.harborEngines.entries())try{if(!this.nodes.find(l=>l.id===n))continue;const c=this.connections.some(l=>l.target===n);s.performUpdate(e,c)}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"harbor",operation:"performUpdate"}})}for(const[n,s]of this.dockerEngines.entries())try{if(!this.nodes.find(l=>l.id===n))continue;const c=this.connections.some(l=>l.target===n);s.performUpdate(e,c)}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"docker",operation:"performUpdate"}})}for(const[n,s]of this.kubernetesEngines.entries())try{if(!this.nodes.find(c=>c.id===n))continue;s.simulateStep()}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"kubernetes",operation:"simulateStep"}})}for(const[n,s]of this.otelCollectorEngines.entries())try{const a=this.nodes.find(c=>c.id===n);s.processBatchFlush()}catch(a){const c=this.nodes.find(l=>l.id===n);ct.addError(a,{severity:"warning",source:"component-engine",componentId:n,componentLabel:c?.data.label,componentType:c?.type,context:{engine:"opentelemetry",operation:"processBatchFlush"}})}for(const n of this.connections)try{this.updateConnectionMetrics(n)}catch(s){ct.addError(s,{severity:"warning",source:"emulation-engine",context:{operation:"updateConnectionMetrics",connectionId:n.id}})}}updateComponentMetrics(e){const t=e.data.config||{},n=this.metrics.get(e.id)||this.createDefaultMetrics(e.id,e.type),s=this.connections.some(d=>d.target===e.id),a=this.connections.some(d=>d.source===e.id);if(!(s||a))n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,n.customMetrics={};else switch(e.type){case"kafka":this.simulateKafka(e,t,n,s);break;case"rabbitmq":this.simulateRabbitMQ(e,t,n,s);break;case"activemq":this.simulateActiveMQ(e,t,n,s);break;case"aws-sqs":this.simulateSQS(e,t,n,s);break;case"azure-service-bus":this.simulateAzureServiceBus(e,t,n,s);break;case"gcp-pubsub":this.simulatePubSub(e,t,n,s);break;case"postgres":case"mongodb":case"redis":case"cassandra":this.simulateDatabase(e,t,n,s);break;case"nginx":this.simulateNginx(e,t,n,s);break;case"docker":this.simulateDocker(e,t,n,s);break;case"kubernetes":this.simulateKubernetes(e,t,n,s);break;case"rest":case"grpc":case"websocket":this.simulateAPI(e,t,n,s);break;case"kong":this.simulateKong(e,t,n,s);break;case"apigee":this.simulateApigee(e,t,n,s);break;case"mulesoft":this.simulateMuleSoft(e,t,n,s);break;case"bff-service":this.simulateBFF(e,t,n,s);break;case"prometheus":this.simulatePrometheus(e,t,n,s);break;case"grafana":this.simulateGrafana(e,t,n,s);break;case"loki":this.simulateLoki(e,t,n,s);break;case"keycloak":this.simulateKeycloak(e,t,n,s);break;case"secrets-vault":this.simulateVault(e,t,n,s);break;case"pagerduty":this.simulatePagerDuty(e,t,n,s);break;case"waf":this.simulateWAF(e,t,n,s);break;case"firewall":this.simulateFirewall(e,t,n,s);break;case"ids-ips":this.simulateIDSIPS(e,t,n,s);break;case"argo-cd":this.simulateArgoCD(e,t,n,s);break;case"terraform":this.simulateTerraform(e,t,n,s);break;case"harbor":this.simulateHarbor(e,t,n,s);break;case"docker":this.simulateDocker(e,t,n,s);break}this.applyCascadeEffects(e,n);const l=mo.applyStateEffects(e.id,{throughput:n.throughput,latency:n.latency,errorRate:n.errorRate,utilization:n.utilization});n.throughput=l.throughput,n.latency=l.latency,n.errorRate=l.errorRate,n.utilization=l.utilization,this.updateLatencyPercentiles(e.id,n.latency,n),n.timestamp=Date.now(),this.metrics.set(e.id,n)}applyCascadeEffects(e,t){const n=this.connections.filter(p=>p.target===e.id);if(n.length===0)return;let s=0,a=0,c=0;const l=t.latency;for(const p of n){const m=this.metrics.get(p.source),y=this.connectionMetrics.get(p.id);if(!m||!y)continue;const b=y.throughputDependency||.5;c+=b;const S=m.errorRate*b*.3;s+=S*b;const E=Math.min(m.latency,500)*b*.2;a+=E*b,(m.errorRate>.5||m.utilization>.95)&&(s+=.1*b,a+=100*b)}c>0&&(s/=c,a/=c),a=Math.min(a,500),t.errorRate=Math.min(1,t.errorRate+s),t.latency=l+a;const f=1e4;t.latency=Math.min(t.latency,f),a>50&&(t.utilization=Math.min(1,t.utilization+.1)),s>.1&&(t.throughput=t.throughput*(1-s*.5))}updateConnectionMetrics(e){const t=this.metrics.get(e.source),n=this.metrics.get(e.target);if(!t||!n)return;const s=this.connectionMetrics.get(e.id)||{id:e.id,source:e.source,target:e.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0},a=this.nodes.find(d=>d.id===e.source),c=this.nodes.find(d=>d.id===e.target),l=a?.data.config?.avgPayloadSize||1024;s.traffic=t.throughput*l/1024,s.latency=this.calculateConnectionLatency(e,t,n),s.errorRate=t.errorRate*.1,this.calculateInteractionMetrics(e,s,t,n,a,c),this.updateConnectionLatencyPercentiles(e.id,s.latency,s),s.timestamp=Date.now(),this.connectionMetrics.set(e.id,s)}calculateInteractionMetrics(e,t,n,s,a,c){const l=e.data||{},f=(l.bandwidthMbps||1e3)*1024*1024/8;this.getComponentCapacity(a);const p=this.getComponentCapacity(c),m=n.throughput,y=a?.data.config?.avgPayloadSize||1024,b=m*y,S=Math.min(b,f),M=p*y,E=Math.min(S,M);t.effectiveThroughput=E/y;const T=this.connections.filter(J=>J.target===e.target).reduce((J,te)=>{const le=this.metrics.get(te.source);return J+(le?.throughput||0)},0);t.throughputDependency=T>0?m/T:0;const k=s.utilization,A=b/f,_=m/p,N=(l.packetLossPercent||0)/100;t.backpressure=Math.min(1,k*.4+A*.3+_*.2+N*.1);const L=b>f*.8,q=m>p*.8,Z=t.backpressure>.7;t.bottleneck=L||q||Z;const se=this.getBaseLatency(e.type),ce=Math.max(0,t.latency-se)/se;t.congestion=Math.min(1,A*.4+ce*.3+N*.3),t.utilization=Math.min(1,t.effectiveThroughput/p)}getComponentCapacity(e){if(!e)return 1e3;const t=e.data.config||{};switch(e.type){case"kafka":case"rabbitmq":case"activemq":return t.throughputMsgs||1e3;case"postgres":case"mongodb":case"redis":return t.maxConnections?t.maxConnections*10:1e3;case"nginx":case"rest":case"grpc":case"websocket":return t.requestsPerSecond||1e3;case"docker":case"kubernetes":return(t.workerThreads||1)*500;default:return 1e3}}getBaseLatency(e){return{sync:5,async:2,http:10,grpc:5,websocket:3}[e]||10}simulateKafka(e,t,n,s){const a=e.data.config,c=a?.brokers||["localhost:9092"],l=a?.topics||[],d=a?.consumerGroups||[],f=l.length||t.topicCount||5,p=l.reduce((j,O)=>j+(O.partitions||3),0)||t.partitions||3,m=l.length>0?l.reduce((j,O)=>j+(O.replication||1),0)/l.length:t.replicationFactor||1,y=this.connections.filter(j=>j.target===e.id);let b=0;for(const j of y){const O=this.metrics.get(j.source);O&&(b+=O.throughput||0)}const S=t.throughputMsgs||Math.max(1e3,b);if(!s&&S<=0){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,l.length>0)for(const j of l)j.messages=j.messages||0,j.size=j.size||0;for(const j of d)j.lag=0;n.customMetrics={topics:f,partitions:p,replication:Math.round(m*10)/10,brokers:c.length,consumer_groups:d.length,total_lag:0};return}const M=.2*Math.sin(this.simulationTime/1e3);n.throughput=S*(1+M);const E=3,C=Math.min(p/10,10),T=Math.max(1,(m-1)*2),k=Math.max(0,(m-1)*1),A=this.calculateCompressionOverhead(l);if(n.latency=E+C+T+k+A,c.length>1){const j=Math.min(5,c.length*.5);n.latency+=j}const _=this.calculateUnderReplicatedPartitions(l,c.length),N=m>1?(m-1)*5e-4:0,L=_>0?_*.001:0,q=a?.acls||[];let Z=0,se=0;for(const j of y){const O=this.nodes.find(Y=>Y.id===j.source);if(!O)continue;const W=O.data.config||{},he=W.messaging?.producerId||W.clientId||`User:${O.id.slice(0,8)}`,P=W.messaging?.topic||l[0]?.name||"default-topic";if(!this.checkACLPermission(q,he,"Topic",P,"Write")){const Y=this.metrics.get(j.source);Y&&(se+=Y.throughput*.9,Z+=.45)}}se>0&&(n.throughput=Math.max(0,n.throughput-se)),n.errorRate=Math.max(0,Math.min(.1,N+L+Z+1e-4));const J=Math.min(1,n.throughput/1e4),te=Math.min(1,p/200);n.utilization=Math.min(1,J*.7+te*.3);const le=t.avgPayloadSize||1024,ue=this.updateInterval/1e3;for(const j of l){const O=n.throughput/f,W=O*ue;j.messages=(j.messages||0)+W;const he=this.getCompressionRatio(j.config?.compressionType),P=W*le*he;if(j.size=(j.size||0)+P,j.config?.retentionMs&&j.config.retentionMs>0){const F=j.config.retentionMs/1e3,ie=O*F;if(j.messages>ie){const B=j.messages-ie;j.messages=ie,j.size=Math.max(0,j.size-B*le*he)}}if(j.config?.retentionBytes&&j.config.retentionBytes>0&&j.size>j.config.retentionBytes){const F=1-j.config.retentionBytes/j.size;j.size=j.config.retentionBytes,j.messages=Math.max(0,j.messages*(1-F))}if((j.config?.cleanupPolicy==="compact"||j.config?.cleanupPolicy==="delete,compact")&&this.simulationTime%3e5<this.updateInterval){const ie=Math.round(j.messages*.85),B=j.messages-ie;j.messages=ie,j.size=Math.max(0,j.size-B*le*he)}if(j.config?.minInsyncReplicas){const F=j.config.minInsyncReplicas,Y=this.getAverageISRCount(j,c.length);if(Y<F){const ie=F-Y;n.errorRate+=ie*.01}}if(j.config?.maxMessageBytes&&le>j.config.maxMessageBytes){const F=Math.min(.1,(le-j.config.maxMessageBytes)/j.config.maxMessageBytes);n.errorRate+=F*.5}}let z=0;for(const j of d){const O=l.find(it=>it.name===j.topic);if(!O)continue;const W=j.members||1,he=O.partitions||1,P=this.assignPartitionsToConsumers(W,he),F=300;let Y=0;for(const it of P){const Je=it.partitions.length;Y+=Je*F}const ie=Math.min(Y,W*F),B=n.throughput/f||0,ae=j.id||`Group:${j.id}`,$=this.checkACLPermission(q,ae,"Topic",j.topic,"Read"),G=this.checkACLPermission(q,ae,"Group",j.id,"Read");let pe=ie;(!$||!G)&&(pe=0);const me=B,ye=pe,ve=Math.max(0,(me-ye)*ue),Pe=j.lag||0,$e=Math.max(0,Pe+ve-ye*ue);j.lag=$e,z+=$e,this.isRebalancing(e.id,j.id)&&(j.lag=Math.min($e*1.2,$e+me*ue*.3),z+=$e*.2)}n.customMetrics={topics:f,partitions:p,replication:Math.round(m*10)/10,brokers:c.length,consumer_groups:d.length,total_lag:Math.round(z),avg_topic_messages:f>0?Math.round(l.reduce((j,O)=>j+(O.messages||0),0)/f):0,total_topic_size_mb:Math.round(l.reduce((j,O)=>j+(O.size||0),0)/1024/1024*100)/100,under_replicated_partitions:_}}calculateCompressionOverhead(e){if(e.length===0)return 0;const t={uncompressed:0,gzip:2,snappy:.5,lz4:.3,zstd:1};let n=0,s=0;for(const a of e){const c=a.config?.compressionType||"gzip",l=t[c]||0;l>0&&(n+=l,s++)}return s>0?n/s:0}getCompressionRatio(e){return{uncompressed:1,gzip:.3,snappy:.5,lz4:.4,zstd:.25}[e||"gzip"]||.3}calculateUnderReplicatedPartitions(e,t){let n=0;for(const s of e){const a=s.replication||1,c=s.partitions||1;if(s.partitionInfo&&Array.isArray(s.partitionInfo))for(const l of s.partitionInfo){const d=a;(l.isr?.length||l.replicas?.length||1)<d&&n++}else a>t&&(n+=c*Math.max(0,1-t/a)),Math.random()<.05&&a>1&&(n+=c*.1)}return Math.round(n)}assignPartitionsToConsumers(e,t){if(e===0||t===0)return[];const n=[],s=Math.floor(t/e),a=t%e;let c=0;for(let l=0;l<e;l++){const d=[],f=s+(l<a?1:0);for(let p=0;p<f;p++)c<t&&(d.push(c),c++);n.push({consumerId:l,partitions:d})}return n}consumerGroupMemberCounts=new Map;rebalancingGroups=new Map;isRebalancing(e,t){const n=`${e}:${t}`,s=this.rebalancingGroups.get(n);if(s&&Date.now()<s)return!0;const a=this.getCurrentGroupMembers(e,t),c=this.consumerGroupMemberCounts.get(n);return c!==void 0&&a!==c?(this.rebalancingGroups.set(n,Date.now()+2e3),this.consumerGroupMemberCounts.set(n,a),!0):((c===void 0||a!==c)&&this.consumerGroupMemberCounts.set(n,a),!1)}getCurrentGroupMembers(e,t){const n=this.nodes.find(l=>l.id===e);return n&&(n.data.config?.consumerGroups||[]).find(l=>l.id===t)?.members||0}getAverageISRCount(e,t){if(!e.partitionInfo||!Array.isArray(e.partitionInfo)||e.partitionInfo.length===0){const a=e.replication||1;return Math.min(a,t)*.95}let n=0,s=0;for(const a of e.partitionInfo){const c=a.isr?.length||a.replicas?.length||1;n+=c,s++}return s>0?n/s:1}checkACLPermission(e,t,n,s,a,c){if(!e||e.length===0)return!0;const l=t.includes(":")?t:`User:${t}`,d=e.filter(m=>{const y=m.principal||"";if(y!==l&&y!=="*"&&!l.includes(y)||m.resourceType!==n)return!1;const b=m.resourcePatternType||"Literal",S=m.resourceName||"";let M=!1;switch(b){case"Literal":M=S===s||S==="*";break;case"Prefixed":if(S==="*")M=!0;else if(S.endsWith("*")){const E=S.slice(0,-1);M=s.startsWith(E)}else M=s.startsWith(S);break;case"Match":if(S==="*")M=!0;else{const E=S.replace(/\./g,"\\.").replace(/\*/g,".*");M=new RegExp(`^${E}$`).test(s)}break;default:M=S===s||S==="*"}return!(!M||m.operation!==a&&m.operation!=="All"||m.host&&m.host!=="*"&&c&&m.host!==c)});return d.length===0||d.filter(m=>m.permission==="Deny").length>0?!1:d.filter(m=>m.permission==="Allow").length>0}simulateRabbitMQ(e,t,n,s){this.rabbitMQRoutingEngines.has(e.id)||this.initializeRabbitMQRoutingEngine(e);const a=this.rabbitMQRoutingEngines.get(e.id);if(e.data.config,!s){n.throughput=0,n.latency=2,n.errorRate=0;const k=a.getTotalQueueDepth();n.utilization=Math.min(1,k/1e5);const A=a.getAllQueueMetrics(),_=a.getActiveConnections();n.customMetrics={queue_depth:k,connections:_,replication:t.replicationFactor||1},this.updateQueueMetricsInConfig(e,A);return}const c=this.connections.filter(k=>k.target===e.id);let l=0;for(const k of c){const A=this.connectionMetrics.get(k.id);if(A){const N=A.traffic/1024;l+=N}}const d=t.throughputMsgs||l||1e3,f=t.replicationFactor||1,p=(Math.random()-.5)*.1;n.throughput=d*(1+p);const m=a.getTotalQueueDepth(),y=2,b=Math.min(50,m/1e3);n.latency=y+f*5+b+Math.random()*5;const S=5e-4,M=Math.min(.01,m/1e6);n.errorRate=S+M,n.utilization=Math.min(1,m/1e5);const E=a.getAllQueueMetrics(),C=a.getActiveConnections();let T=0;for(const k of E.values())T+=k.consumers;n.customMetrics={queue_depth:m,connections:C,replication:f,queues:E.size,consumers:T},this.updateQueueMetricsInConfig(e,E)}initializeRabbitMQRoutingEngine(e){const t=e.data.config||{},n=new Sk;n.initialize({queues:t.queues||[],exchanges:t.exchanges||[{name:"amq.direct",type:"direct",durable:!0,autoDelete:!1,internal:!1},{name:"amq.topic",type:"topic",durable:!0,autoDelete:!1,internal:!1},{name:"amq.fanout",type:"fanout",durable:!0,autoDelete:!1,internal:!1}],bindings:t.bindings||[]}),this.rabbitMQRoutingEngines.set(e.id,n),this.lastRabbitMQUpdate.set(e.id,Date.now())}updateQueueMetricsInConfig(e,t){const n=e.data.config||{},s=n.queues||[];for(let a=0;a<s.length;a++){const c=s[a],l=t.get(c.name);l&&(s[a]={...c,messages:l.messages,ready:l.ready,unacked:l.unacked,consumers:l.consumers})}n.queues=s}simulateActiveMQ(e,t,n,s){this.activeMQRoutingEngines.has(e.id)||this.initializeActiveMQRoutingEngine(e);const a=this.activeMQRoutingEngines.get(e.id),c=e.data.config||{},l=c.protocol||"openwire",d=c.persistenceEnabled??!0,f=c.maxConnections||1e3,p=c.memoryLimit||1024,m=c.storeUsage||0,y=c.tempUsage||0,b=c.connections||[];if(!s){n.throughput=0,n.latency=this.getProtocolBaseLatency(l),n.errorRate=0;const B=a.getTotalQueueDepth(),ae=a.getTotalTopicMessages(),$=B+ae;n.utilization=Math.min(1,$/1e5);const G=a.getAllQueueMetrics(),pe=a.getAllTopicMetrics(),me=a.getActiveConnections();let ye=0;for(const Pe of G.values())ye+=Pe.consumerCount;let ve=0;for(const Pe of pe.values())ve+=Pe.subscriberCount;n.customMetrics={queue_depth:B,topic_messages:ae,connections:me,queues:G.size,topics:pe.size,consumers:ye,subscribers:ve,memory_usage:m+y,memory_percent:p>0?(m+y)/p*100:0},this.updateActiveMQMetricsInConfig(e,G,pe);return}const S=this.connections.filter(B=>B.target===e.id);let M=0;for(const B of S){const ae=this.connectionMetrics.get(B.id);if(ae){const G=ae.traffic/1024;M+=G}}const E=t.throughputMsgs||M||1e3,C=(Math.random()-.5)*.1;n.throughput=E*(1+C);const T=a.getTotalQueueDepth(),k=a.getTotalTopicMessages(),A=T+k,_=this.getProtocolBaseLatency(l),N=d?5:0,L=Math.min(50,A/1e3),q=p>0&&m+y>p*.8?10:0;n.latency=_+N+L+q+Math.random()*5;const Z=c.acls||[];let se=0,ce=0;for(const B of S){const ae=this.nodes.find(me=>me.id===B.source);if(!ae)continue;const $=ae.data.config,G=$?.messaging||{},pe=$?.username||$?.clientId||c.username||`user-${B.source.slice(0,8)}`;if(G.queue&&!this.checkActiveMQACLPermission(Z,pe,`queue://${G.queue}`,"write")){const ye=this.metrics.get(B.source);ye&&(ce+=ye.throughput*.9,se+=.45)}if(G.topic&&!this.checkActiveMQACLPermission(Z,pe,`topic://${G.topic}`,"write")){const ye=this.metrics.get(B.source);ye&&(ce+=ye.throughput*.9,se+=.45)}}const J=c.queues||[];for(const B of J)B.consumerCount&&B.consumerCount>0&&(this.checkActiveMQACLPermission(Z,c.username||"admin",`queue://${B.name}`,"read")||(se+=.1));const te=5e-4,le=Math.min(.01,A/1e6),ue=p>0&&m+y>p?.01:0,z=b.length>=f?.005:0;ce>0&&(n.throughput=Math.max(0,n.throughput-ce)),n.errorRate=Math.min(1,te+le+ue+z+se);const j=Math.min(1,A/1e5),O=p>0?Math.min(1,(m+y)/p):0,W=Math.min(1,b.length/f);n.utilization=Math.max(j,O,W);const he=a.getAllQueueMetrics(),P=a.getAllTopicMetrics(),F=a.getActiveConnections();let Y=0;for(const B of he.values())Y+=B.consumerCount;let ie=0;for(const B of P.values())ie+=B.subscriberCount;n.customMetrics={queue_depth:T,topic_messages:k,connections:F,queues:he.size,topics:P.size,consumers:Y,subscribers:ie,memory_usage:m+y,memory_percent:p>0?(m+y)/p*100:0,protocol:l},this.updateActiveMQMetricsInConfig(e,he,P)}checkActiveMQACLPermission(e,t,n,s){if(!e||e.length===0)return!0;const a=e.filter(d=>{const f=d.principal||"";if(f!==t&&f!=="*"&&!t.includes(f))return!1;const p=d.resource||"";let m=!1;if(p==="*"||p===n)m=!0;else if(p.endsWith("*")){const S=p.slice(0,-1);m=n.startsWith(S)}else p.includes("://")?m=p===n:m=n.includes(p);if(!m)return!1;const y=(d.operation||"").toLowerCase(),b=s.toLowerCase();return!(y!==b&&y!=="all"&&y!=="*")});return a.length===0?!0:a.filter(d=>d.permission==="deny").length>0?!1:(a.filter(d=>d.permission==="allow").length>0,!0)}getProtocolBaseLatency(e){return{openwire:2,amqp:5,mqtt:8,stomp:10,ws:12}[e]||5}initializeActiveMQRoutingEngine(e){const t=e.data.config||{},n=new Mk;n.initialize({queues:t.queues||[],topics:t.topics||[],subscriptions:t.subscriptions||[]}),this.activeMQRoutingEngines.set(e.id,n),this.lastActiveMQUpdate.set(e.id,Date.now())}updateActiveMQMetricsInConfig(e,t,n){const s=e.data.config||{},a=s,c=s.queues||[];for(let m=0;m<c.length;m++){const y=c[m],b=t.get(y.name);b&&(c[m]={...y,queueSize:b.queueSize,consumerCount:b.consumerCount,enqueueCount:b.enqueueCount,dequeueCount:b.dequeueCount})}s.queues=c;const l=s.topics||[];for(let m=0;m<l.length;m++){const y=l[m],b=n.get(y.name);b&&(l[m]={...y,subscriberCount:b.subscriberCount,enqueueCount:b.enqueueCount,dequeueCount:b.dequeueCount})}s.topics=l;const d=this.connections.filter(m=>m.target===e.id),f=[];for(const m of d){const y=this.nodes.find(C=>C.id===m.source);if(!y)continue;y.data.config?.messaging;const S=a.protocol||"openwire",M=this.connectionMetrics.get(m.id),E=M?Math.floor(M.traffic/1024):0;f.push({id:m.id,remoteAddress:`${y.data.label||y.id}`,clientId:`client-${m.source.slice(0,8)}`,userName:a.username||"admin",connectedSince:new Date().toISOString(),messageCount:E,protocol:S==="openwire"?"OpenWire":S==="amqp"?"AMQP":S==="mqtt"?"MQTT":S==="stomp"?"STOMP":S==="ws"?"WebSocket":"OpenWire"})}s.connections=f;const p=[];for(const m of l)for(const y of d){const b=this.nodes.find(E=>E.id===y.source);if(!b)continue;const M=b.data.config?.messaging||{};if(M.topic===m.name||!M.queue){const E=n.get(m.name);p.push({id:`sub-${y.id}-${m.name}`,destination:m.name,clientId:`client-${y.source.slice(0,8)}`,pendingQueueSize:0,dispatchedQueueSize:0,dispatchedCounter:E?.enqueueCount||0,enqueueCounter:E?.enqueueCount||0,dequeueCounter:E?.dequeueCount||0})}}s.subscriptions=p}simulateAzureServiceBus(e,t,n,s){this.azureServiceBusRoutingEngines.has(e.id)||this.initializeAzureServiceBusRoutingEngine(e);const a=this.azureServiceBusRoutingEngines.get(e.id),c=e.data.config||{};if(!s){n.throughput=0,n.latency=5,n.errorRate=0;const se=a.getTotalQueueDepth(),ce=a.getTotalSubscriptionMessages(),J=se+ce;n.utilization=Math.min(1,J/1e5);const te=a.getAllQueueMetrics(),le=a.getAllSubscriptionMetrics(),ue=a.getActiveConnections();n.customMetrics={queue_depth:se,subscription_messages:ce,connections:ue,queues:c.queues?.length||0,topics:c.topics?.length||0},this.updateAzureServiceBusMetricsInConfig(e,te,le);return}const l=this.connections.filter(se=>se.target===e.id);let d=0;for(const se of l){const ce=this.connectionMetrics.get(se.id);if(ce){const te=ce.traffic/1024;d+=te}}const f=t.throughputMsgs||d||1e3,p=(Math.random()-.5)*.1;n.throughput=f*(1+p);const m=a.getTotalQueueDepth(),y=a.getTotalSubscriptionMessages(),b=m+y,S=5,M=Math.min(50,b/1e3),E=2;n.latency=S+M+E+Math.random()*5;const C=a.getAllQueueMetrics(),T=a.getAllSubscriptionMetrics(),k=a.getActiveConnections(),A=5e-4,_=Math.min(.01,b/1e6);let N=0;for(const se of C.values())N+=se.deadLetterMessageCount||0;for(const se of T.values())N+=se.deadLetterMessageCount||0;const L=N>0?Math.min(.05,N/1e4):0;n.errorRate=Math.min(1,A+_+L),n.utilization=Math.min(1,b/1e5);let q=0;const Z=c.topics||[];for(const se of Z)q+=(se.subscriptions||[]).length;n.customMetrics={queue_depth:m,subscription_messages:y,dead_letter_messages:N,connections:k,queues:c.queues?.length||0,topics:c.topics?.length||0,subscriptions:q},this.updateAzureServiceBusMetricsInConfig(e,C,T)}initializeAzureServiceBusRoutingEngine(e){const t=e.data.config||{},n=new Ek,s=(t.queues||[]).map(c=>({name:c.name,namespace:c.namespace||t.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:c.maxSizeInMegabytes||1024,defaultMessageTimeToLive:c.defaultMessageTimeToLive||2592e3,lockDuration:c.lockDuration||30,maxDeliveryCount:c.maxDeliveryCount||10,enablePartitioning:c.enablePartitioning||!1,enableDeadLetteringOnMessageExpiration:c.enableDeadLetteringOnMessageExpiration!==void 0?c.enableDeadLetteringOnMessageExpiration:!0,enableSessions:c.enableSessions||!1,activeMessageCount:c.activeMessageCount||0,deadLetterMessageCount:c.deadLetterMessageCount||0,scheduledMessageCount:c.scheduledMessageCount||0})),a=(t.topics||[]).map(c=>({name:c.name,namespace:c.namespace||t.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:c.maxSizeInMegabytes||1024,defaultMessageTimeToLive:c.defaultMessageTimeToLive||2592e3,enablePartitioning:c.enablePartitioning||!1,subscriptions:(c.subscriptions||[]).map(l=>({name:l.name,maxDeliveryCount:l.maxDeliveryCount||10,lockDuration:l.lockDuration||30,enableDeadLetteringOnMessageExpiration:l.enableDeadLetteringOnMessageExpiration!==void 0?l.enableDeadLetteringOnMessageExpiration:!0,activeMessageCount:l.activeMessageCount||0}))}));n.initialize({queues:s,topics:a}),this.azureServiceBusRoutingEngines.set(e.id,n),this.lastAzureServiceBusUpdate.set(e.id,Date.now())}updateAzureServiceBusMetricsInConfig(e,t,n){const s=e.data.config||{},a=s.queues||[];for(let l=0;l<a.length;l++){const d=a[l],f=t.get(d.name);f&&(a[l]={...d,activeMessageCount:f.activeMessageCount,deadLetterMessageCount:f.deadLetterMessageCount,scheduledMessageCount:f.scheduledMessageCount})}s.queues=a;const c=s.topics||[];for(let l=0;l<c.length;l++){const d=c[l],f=d.subscriptions||[];for(let p=0;p<f.length;p++){const m=f[p],y=`${d.name}/subscriptions/${m.name}`,b=n.get(y);b&&(f[p]={...m,activeMessageCount:b.activeMessageCount})}c[l]={...d,subscriptions:f}}s.topics=c}simulatePubSub(e,t,n,s){this.pubSubRoutingEngines.has(e.id)||this.initializePubSubRoutingEngine(e);const a=this.pubSubRoutingEngines.get(e.id),c=e.data.config||{},l=c.topics||[],d=c.subscriptions||[];if(!s){n.throughput=0,n.latency=3,n.errorRate=0;const z=a.getTotalTopicMessages(),j=a.getTotalUnackedMessages(),O=z+j;n.utilization=Math.min(1,O/1e5);const W=a.getAllTopicMetrics(),he=a.getAllSubscriptionMetrics(),P=a.getActiveConnections();n.customMetrics={topic_messages:z,unacked_messages:j,connections:P,topics:l.length,subscriptions:d.length},this.updatePubSubMetricsInConfig(e,W,he);return}const f=this.connections.filter(z=>z.target===e.id);let p=0;for(const z of f){const j=this.connectionMetrics.get(z.id);if(j){const W=j.traffic/1024;p+=W}}const m=t.throughputMsgs||p||1e3,y=(Math.random()-.5)*.1;n.throughput=m*(1+y);const b=a.getTotalTopicMessages(),S=a.getTotalUnackedMessages(),M=b+S,E=3,C=Math.min(15,M/1e4),T=d.filter(z=>z.pushEndpoint).length,k=T>0?2:0,A=S>0?.5:0;n.latency=E+C+k+A+Math.random()*2;const _=a.getAllTopicMetrics(),N=a.getAllSubscriptionMetrics(),L=a.getActiveConnections(),q=1e-4,Z=Math.min(.001,M/5e6),se=T>0&&S>0?Math.min(.002,S/1e5):0,ce=d.length>0?d.reduce((z,j)=>z+(j.ackDeadlineSeconds||10),0)/d.length:10,J=S>0&&ce<60?Math.min(.005,S/1e5):0;n.errorRate=Math.min(1,q+Z+se+J);const te=Math.min(1,n.throughput/1e5),le=Math.min(.3,M/5e5);n.utilization=Math.min(1,te*.7+le*.3);const ue=d.length-T;n.customMetrics={topic_messages:b,unacked_messages:S,connections:L,topics:l.length,subscriptions:d.length,push_subscriptions:T,pull_subscriptions:ue,total_bytes:Array.from(_.values()).reduce((z,j)=>z+j.byteCount,0)},this.updatePubSubMetricsInConfig(e,_,N)}initializePubSubRoutingEngine(e){const t=e.data.config||{},n=new Rk,s=(t.topics||[]).map(c=>({name:c.name,projectId:c.projectId||t.projectId||"archiphoenix-lab",messageRetentionDuration:c.messageRetentionDuration||604800,labels:c.labels||{},messageCount:c.messageCount||0,byteCount:c.byteCount||0})),a=(t.subscriptions||[]).map(c=>({name:c.name,topic:c.topic,projectId:c.projectId||t.projectId||"archiphoenix-lab",ackDeadlineSeconds:c.ackDeadlineSeconds||10,messageRetentionDuration:c.messageRetentionDuration,enableMessageOrdering:c.enableMessageOrdering||!1,pushEndpoint:c.pushEndpoint,pushAttributes:c.pushAttributes||{},messageCount:c.messageCount||0,unackedMessageCount:c.unackedMessageCount||0}));n.initialize({topics:s,subscriptions:a}),this.pubSubRoutingEngines.set(e.id,n),this.lastPubSubUpdate.set(e.id,Date.now())}updatePubSubMetricsInConfig(e,t,n){const s=e.data.config||{},a=s.topics||[];for(let l=0;l<a.length;l++){const d=a[l],f=t.get(d.name);f&&(a[l]={...d,messageCount:f.messageCount,byteCount:f.byteCount})}s.topics=a;const c=s.subscriptions||[];for(let l=0;l<c.length;l++){const d=c[l],f=n.get(d.name);f&&(c[l]={...d,messageCount:f.messageCount,unackedMessageCount:f.unackedMessageCount})}s.subscriptions=c}simulateSQS(e,t,n,s){this.sqsRoutingEngines.has(e.id)||this.initializeSQSRoutingEngine(e);const a=this.sqsRoutingEngines.get(e.id);if(e.data.config,!s){n.throughput=0,n.latency=5,n.errorRate=0;const C=a.getTotalQueueDepth();n.utilization=Math.min(1,C/1e5);const T=a.getAllQueueMetrics(),k=a.getActiveConnections();n.customMetrics={queue_depth:C,connections:k,queues:T.size},this.updateSQSQueueMetricsInConfig(e,T);return}const c=this.connections.filter(C=>C.target===e.id);let l=0;for(const C of c){const T=this.connectionMetrics.get(C.id);if(T){const A=T.traffic/1024;l+=A}}const d=t.throughputMsgs||l||1e3,f=(Math.random()-.5)*.1;n.throughput=d*(1+f);const p=a.getTotalQueueDepth(),m=5,y=Math.min(50,p/1e3);n.latency=m+y+Math.random()*5;const b=5e-4,S=Math.min(.01,p/1e6);n.errorRate=b+S,n.utilization=Math.min(1,p/1e5);const M=a.getAllQueueMetrics(),E=a.getActiveConnections();n.customMetrics={queue_depth:p,connections:E,queues:M.size},this.updateSQSQueueMetricsInConfig(e,M)}initializeSQSRoutingEngine(e){const t=e.data.config||{},n=new Ck,s=(t.queues||[]).map(a=>({name:a.name,type:a.type||"standard",region:a.region||t.defaultRegion||"us-east-1",visibilityTimeout:a.visibilityTimeout||30,messageRetention:a.messageRetention||4,delaySeconds:a.delaySeconds||0,maxReceiveCount:a.maxReceiveCount,deadLetterQueue:a.deadLetterQueue,contentBasedDedup:a.contentBasedDedup,fifoThroughputLimit:a.fifoThroughputLimit||"perQueue"}));n.initialize({queues:s}),this.sqsRoutingEngines.set(e.id,n),this.lastSQSUpdate.set(e.id,Date.now())}updateSQSQueueMetricsInConfig(e,t){const n=e.data.config||{},s=n.queues||[];for(let a=0;a<s.length;a++){const c=s[a],l=t.get(c.name);l&&(s[a]={...c,approximateMessages:l.approximateMessages,approximateMessagesNotVisible:l.approximateMessagesNotVisible,approximateMessagesDelayed:l.approximateMessagesDelayed})}n.queues=s}simulateDatabase(e,t,n,s){if(!s){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,n.customMetrics={},e.type==="postgres"){const y=this.postgresConnectionPools.get(e.id);y&&y.reset()}return}const a=t.maxConnections||100,c=t.queryLatency||10;if(e.type==="postgres"){const y=this.postgresConnectionPools.get(e.id);if(y){const S=this.connections.filter(N=>N.target===e.id).reduce((N,L)=>{const q=this.metrics.get(L.source);return N+(q?.throughput||0)},0),E=Math.min(S,a*10)*this.updateInterval/1e3;for(let N=0;N<Math.floor(E);N++){const L=y.acquireConnection("SELECT");if(L){const q=c+Math.random()*20;setTimeout(()=>{y.releaseConnection(L,q)},q)}}const C=y.getMetrics();n.throughput=C.queriesPerSecond,n.latency=C.averageQueryTime||c,n.utilization=C.utilization,n.errorRate=C.waitingConnections>0?.01:.001;const k=e.data.config.tables||[];let A=0;for(const N of k)A+=(N.indexes||[]).length;A===0&&(A=5);const _=this.calculateCacheHitRatio(e,C.queriesPerSecond);n.customMetrics={active_connections:C.activeConnections,idle_connections:C.idleConnections,waiting_connections:C.waitingConnections,total_connections:C.totalConnections,max_connections:a,indexes:A,cache_hit_ratio:_,connection_wait_time:C.connectionWaitTime};return}}if(e.type==="redis"){this.redisRoutingEngines.has(e.id)||this.initializeRedisRoutingEngine(e);const y=this.redisRoutingEngines.get(e.id),b=e.data.config;b?.keys&&y.syncKeysFromConfig(b.keys);const S=y.getMetrics(),E=this.connections.filter(A=>A.target===e.id).reduce((A,_)=>{const N=this.metrics.get(_.source);return A+(N?.throughput||0)},0);n.throughput=Math.max(S.operationsPerSecond,E);const C=.5,T=S.memoryUsagePercent/100,k=Math.min(1,S.totalKeys/1e5);n.latency=C+T*2+k*1,n.errorRate=T>.95?.01:.001,n.utilization=S.memoryUsagePercent/100,n.customMetrics={total_keys:S.totalKeys,keys_string:S.keysByType.string,keys_hash:S.keysByType.hash,keys_list:S.keysByType.list,keys_set:S.keysByType.set,keys_zset:S.keysByType.zset,keys_stream:S.keysByType.stream,memory_usage:S.memoryUsage,memory_usage_percent:S.memoryUsagePercent,operations_per_second:S.operationsPerSecond,hit_count:S.hitCount,miss_count:S.missCount,hit_rate:S.hitRate,expired_keys:S.expiredKeys,evicted_keys:S.evictedKeys,connected_clients:S.connectedClients};return}if(e.type==="cassandra"){this.cassandraRoutingEngines.has(e.id)||this.initializeCassandraRoutingEngine(e);const y=this.cassandraRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({clusterName:b.clusterName,nodes:b.nodes,keyspaces:b.keyspaces,tables:b.tables,defaultConsistencyLevel:b.consistencyLevel,defaultReplicationFactor:b.replicationFactor});const S=y.getMetrics(),E=this.connections.filter(_=>_.target===e.id).reduce((_,N)=>{const L=this.metrics.get(N.source);return _+(L?.throughput||0)},0);n.throughput=Math.max(S.readOperationsPerSecond+S.writeOperationsPerSecond,E);const C=S.readOperationsPerSecond+S.writeOperationsPerSecond;if(C>0){const _=S.readOperationsPerSecond/C,N=S.writeOperationsPerSecond/C;n.latency=S.readLatency*_+S.writeLatency*N}else n.latency=(S.readLatency+S.writeLatency)/2;const T=S.readConsistencyViolations+S.writeConsistencyViolations;n.errorRate=Math.min(.1,T/Math.max(1,C))||.001;const k=S.totalNodes>0?(S.totalNodes-S.healthyNodes)/S.totalNodes:0,A=Math.min(1,S.pendingCompactions/100);n.utilization=Math.min(1,k*.7+A*.3),n.customMetrics={total_nodes:S.totalNodes,healthy_nodes:S.healthyNodes,total_keyspaces:S.totalKeyspaces,total_tables:S.totalTables,total_rows:S.totalRows,total_size_gb:S.totalSize/(1024*1024*1024),read_latency_ms:S.readLatency,write_latency_ms:S.writeLatency,read_ops_per_sec:S.readOperationsPerSecond,write_ops_per_sec:S.writeOperationsPerSecond,pending_compactions:S.pendingCompactions,read_consistency_violations:S.readConsistencyViolations,write_consistency_violations:S.writeConsistencyViolations,hinted_handoffs:S.hintedHandoffs};return}if(e.type==="clickhouse"){this.clickHouseRoutingEngines.has(e.id)||this.initializeClickHouseRoutingEngine(e);const y=this.clickHouseRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({cluster:b.cluster,replication:b.replication,tables:b.tables?.map(A=>({name:A.name,database:b.database||"default",engine:A.engine||"MergeTree",rows:A.rows||0,size:A.size||0,partitions:A.partitions||0,columns:A.columns||[]})),maxMemoryUsage:b.maxMemoryUsage,compression:b.compression});const S=y.getMetrics(),E=this.connections.filter(A=>A.target===e.id).reduce((A,_)=>{const N=this.metrics.get(_.source);return A+(N?.throughput||0)},0);n.throughput=Math.max(S.queriesPerSecond,E),n.latency=S.avgQueryTime;const C=S.memoryUsagePercent/100;n.errorRate=C>.95?.01:.001;const T=Math.min(1,S.activeQueries/10),k=C;n.utilization=Math.max(T,k),n.customMetrics={total_tables:S.totalTables,total_rows:S.totalRows,total_size_gb:S.totalSize/(1024*1024*1024),queries_per_sec:S.queriesPerSecond,read_rows_per_sec:S.readRowsPerSecond,written_rows_per_sec:S.writtenRowsPerSecond,avg_query_time_ms:S.avgQueryTime,active_queries:S.activeQueries,memory_usage_bytes:S.memoryUsage,memory_usage_percent:S.memoryUsagePercent,parts_count:S.partsCount,pending_merges:S.pendingMerges,compression_ratio:S.compressionRatio,cluster_nodes:S.clusterNodes,healthy_nodes:S.healthyNodes};return}if(e.type==="snowflake"){this.snowflakeRoutingEngines.has(e.id)||this.initializeSnowflakeRoutingEngine(e);const y=this.snowflakeRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({account:b.account,region:b.region,warehouses:b.warehouses,databases:b.databases,role:b.role,enableAutoSuspend:b.enableAutoSuspend,autoSuspendSeconds:b.autoSuspendSeconds,enableAutoResume:b.enableAutoResume});const S=y.getMetrics(),E=this.connections.filter(C=>C.target===e.id).reduce((C,T)=>{const k=this.metrics.get(T.source);return C+(k?.throughput||0)},0);n.throughput=Math.max(S.queriesPerSecond,E),n.latency=S.avgQueryTime,n.errorRate=.001,n.utilization=S.warehouseUtilization,n.customMetrics={total_warehouses:S.totalWarehouses,running_warehouses:S.runningWarehouses,suspended_warehouses:S.suspendedWarehouses,total_queries:S.totalQueries,running_queries:S.runningQueries,queued_queries:S.queuedQueries,queries_per_sec:S.queriesPerSecond,avg_query_time_ms:S.avgQueryTime,total_compute_time_sec:S.totalComputeTime,total_data_read:S.totalDataRead,total_data_written:S.totalDataWritten,cache_hit_rate:S.cacheHitRate,warehouse_utilization:S.warehouseUtilization,total_cost_credits:S.totalCost};return}if(e.type==="elasticsearch"){this.elasticsearchRoutingEngines.has(e.id)||this.initializeElasticsearchRoutingEngine(e);const y=this.elasticsearchRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({clusterName:b.clusterName,nodes:b.nodes,indices:b.indices,defaultShards:b.shards,defaultReplicas:b.replicas,refreshInterval:b.refreshInterval});const S=y.getMetrics(),E=this.connections.filter(_=>_.target===e.id).reduce((_,N)=>{const L=this.metrics.get(N.source);return _+(L?.throughput||0)},0);n.throughput=Math.max(S.indexOperationsPerSecond+S.searchOperationsPerSecond,E);const C=S.indexOperationsPerSecond+S.searchOperationsPerSecond;if(C>0){const _=S.indexOperationsPerSecond/C,N=S.searchOperationsPerSecond/C;n.latency=S.averageIndexLatency*_+S.averageSearchLatency*N}else n.latency=S.averageSearchLatency||10;const T=S.clusterHealth==="red"?.01:S.clusterHealth==="yellow"?.002:.001;n.errorRate=T;const k=S.unassignedShards>0?1:S.relocatingShards>0?.7:S.initializingShards>0?.5:.3,A=S.healthyNodes/S.totalNodes;n.utilization=Math.max(k,1-A),this.updateElasticsearchMetricsInConfig(e,S),n.customMetrics={cluster_health:S.clusterHealth==="green"?1:S.clusterHealth==="yellow"?.5:0,total_nodes:S.totalNodes,healthy_nodes:S.healthyNodes,total_indices:S.totalIndices,total_docs:S.totalDocs,total_size_gb:S.totalSize/(1024*1024*1024),active_shards:S.activeShards,relocating_shards:S.relocatingShards,initializing_shards:S.initializingShards,unassigned_shards:S.unassignedShards,index_ops_per_sec:S.indexOperationsPerSecond,search_ops_per_sec:S.searchOperationsPerSecond,avg_index_latency_ms:S.averageIndexLatency,avg_search_latency_ms:S.averageSearchLatency,avg_get_latency_ms:S.averageGetLatency};return}if(e.type==="s3-datalake"){this.s3RoutingEngines.has(e.id)||this.initializeS3RoutingEngine(e);const y=this.s3RoutingEngines.get(e.id);if(y.processLifecycleTransitions(),!s){n.throughput=0,n.latency=50,n.errorRate=0;const J=y.getAllBucketMetrics(),te=y.getTotalStorageSize(),le=y.getTotalObjectCount(),ue=1024*1024*1024*1024,z=J.size,j=ue*z;n.utilization=j>0?Math.min(1,te/j):0,n.customMetrics={buckets:z,total_objects:le,total_size:te,total_size_mb:Math.round(te/(1024*1024)*100)/100},this.updateS3BucketMetricsInConfig(e,J);return}const b=this.connections.filter(J=>J.target===e.id);let S=0,M=0;for(const J of b){const te=this.connectionMetrics.get(J.id);te&&(S+=te.traffic/1024,M+=te.traffic)}const E=1024*1024,C=M>0?M/E:0;n.throughput=Math.max(0,C),n.latency=50+(C>100?(C-100)*.1:0),n.errorRate=.001;const T=y.getAllBucketMetrics(),k=y.getTotalStorageSize(),A=y.getTotalObjectCount(),_=T.size,L=1024*1024*1024*1024*_,q=L>0?Math.min(1,k/L):0,se=3500*_,ce=se>0?Math.min(1,C/se):0;n.utilization=Math.max(q,ce),n.customMetrics={buckets:_,total_objects:A,total_size:k,total_size_mb:Math.round(k/(1024*1024)*100)/100,total_size_gb:Math.round(k/(1024*1024*1024)*100)/100,estimated_ops_per_sec:Math.round(C*100)/100,storage_utilization:Math.round(q*1e3)/10,ops_utilization:Math.round(ce*1e3)/10},this.updateS3BucketMetricsInConfig(e,T);return}let l=t.indexCount||5;e.type==="mongodb"&&(l=(e.data.config?.collections||[]).reduce((S,M)=>S+(M.indexes?.length||0),0),l===0&&(l=1));const f=this.connections.filter(y=>y.target===e.id).reduce((y,b)=>{const S=this.metrics.get(b.source);return y+(S?.throughput||0)},0),p=Math.min(a,Math.floor(f/10)||Math.floor(a*.3));n.throughput=p*(1e3/(c+Math.random()*20));const m=Math.min(.3,l*.02);if(n.latency=c+p/a*50*(1-m),n.errorRate=.001,n.utilization=p/a,n.customMetrics={active_connections:p,max_connections:a,indexes:l,cache_hit_ratio:Math.random()*.8+.2},e.type==="mongodb"){const y=e.data.config,b=y?.collections||[],S=b.filter(k=>k.validation&&k.validation.validationLevel!=="off").length;if(S>0){const k=Math.min(.05,S*.01);n.errorRate=Math.max(n.errorRate,k)}const M=y?.enableReplicaSet||!1,E=y?.replicaSetMembers||[];if(M&&E.length>1){const k=E.length,A=Math.min(.3,(k-1)*.1);n.errorRate=Math.max(0,n.errorRate*(1-A)),n.latency=n.latency*(1+.05*(k-1))}const C=y?.enableSharding||!1,T=y?.shardConfig;if(C&&T?.shards){const k=T.shards.length,A=1+(k-1)*.3;n.throughput=n.throughput*A,n.latency=n.latency*(1+.02*(k-1))}n.customMetrics={...n.customMetrics,collections:b.length,collections_with_validation:S,total_documents:b.reduce((k,A)=>k+(A.documentCount||0),0),replica_set_enabled:M,replica_members:M?E.length:0,sharding_enabled:C,shard_count:C&&T?.shards?.length||0}}}simulateNginx(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=this.nginxRoutingEngines.get(e.id);if(!a){const C=t.workerThreads||t.maxWorkers||4,T=t.requestsPerSecond||1e4,k=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=T*k,n.latency=1+(1-k)*4,n.errorRate=1e-5,n.utilization=Math.min(1,n.throughput/T*(C/4)),n.customMetrics={worker_threads:C,active_connections:Math.floor(n.throughput*.1)};return}const c=t||{},l=c.maxWorkers||4,d=c.requestsPerSecond||1e4;c.enableCache;const f=c.enableGzip??!0,p=a.getStats(),m=.5*Math.sin(this.simulationTime/2e3)+.5;let y=d*m;if(p.rateLimitBlocks>0){const C=Math.min(.1,p.rateLimitBlocks/Math.max(1,p.requests));y=y*(1-C)}n.throughput=y;const b=1+(1-m)*4,S=10+Math.random()*90;n.latency=b+S*.3;const M=p.rateLimitBlocks>0?Math.min(.05,p.rateLimitBlocks/Math.max(1,p.requests)):0;n.errorRate=1e-5+M;const E=Math.min(1,n.throughput/d*(l/4));n.utilization=E,n.customMetrics={worker_threads:l,active_connections:Math.floor(n.throughput*.1),cache_hits:p.cacheHits,cache_misses:p.cacheMisses,cache_hit_rate:Math.round(p.cacheHitRate*100)/100,rate_limit_blocks:p.rateLimitBlocks,locations:p.locations,upstreams:p.upstreams,ssl_enabled:c.enableSSL?1:0,gzip_enabled:f?1:0}}simulateInfrastructure(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=t.workerThreads||1;n.throughput=100*a+Math.random()*50,n.latency=50+Math.random()*100,n.errorRate=1e-4,n.utilization=Math.random()*.8,n.customMetrics={replicas:a,cpu_percent:Math.random()*80,memory_percent:Math.random()*70}}simulateAPI(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=t.requestsPerSecond||100,c=t.responseLatency||50,l=Math.sin(this.simulationTime/1500)*.1+1;n.throughput=a*l,n.latency=c+Math.random()*30,n.errorRate=.005,n.utilization=n.throughput/a*Math.random(),n.customMetrics={rps:a,p50_latency:Math.round(c*.5),p99_latency:Math.round(c*2),errors:Math.round(n.throughput*n.errorRate)}}simulateKong(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=this.kongRoutingEngines.get(e.id);if(!a){this.simulateAPI(e,t,n,s);return}const c=t||{},l=c.requestsPerSecond||t.requestsPerSecond||450,d=a.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let p=l*f;const m=(c.plugins||[]).filter(C=>C.name==="rate-limiting"&&C.enabled);if(m.length>0){const C=Math.min(...m.map(T=>T.config?.minute||1e3));p=Math.min(p,C*f)}n.throughput=p;const y=2+Math.random()*3,b=d.plugins*.5,S=10+Math.random()*40;n.latency=y+b+S;const M=.001,E=d.consumers>0?.02:0;n.errorRate=Math.min(1,M+E),n.utilization=Math.min(1,n.throughput/l),n.customMetrics={services:d.services,routes:d.routes,upstreams:d.upstreams,consumers:d.consumers,plugins:d.plugins,requests_per_second:l,gateway_latency:y+b,upstream_latency:S}}simulateApigee(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=this.apigeeRoutingEngines.get(e.id);if(!a){this.simulateAPI(e,t,n,s);return}const c=t||{},l=c.proxies||[],d=c.requestsPerSecond||t.requestsPerSecond||500,f=a.getStats(),p=.5*Math.sin(this.simulationTime/2e3)+.5;let m=d*p;const y=l.filter(k=>k.status!=="undeployed");if(y.length>0){const k=y.filter(_=>_.quota&&_.quotaInterval).map(_=>_.quota/_.quotaInterval*p);if(k.length>0){const _=Math.min(...k);m=Math.min(m,_)}const A=y.filter(_=>_.spikeArrest&&_.spikeArrest>0).map(_=>_.spikeArrest);if(A.length>0){const _=Math.min(...A);m=Math.min(m,_*p)}}n.throughput=m;const b=3+Math.random()*2,S=f.policies*.8,M=15+Math.random()*35;n.latency=b+S+M;const E=.001,C=f.policies>0?.015:0,T=f.totalErrors>0?f.totalErrors/Math.max(f.totalRequests,1)*.1:0;n.errorRate=Math.min(1,E+C+T),n.utilization=Math.min(1,n.throughput/d),n.customMetrics={proxies:f.proxies,policies:f.policies,total_requests:f.totalRequests,total_errors:f.totalErrors,avg_latency:Math.round(f.avgLatency),requests_per_second:d,gateway_latency:b+S,upstream_latency:M}}simulateMuleSoft(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=this.mulesoftRoutingEngines.get(e.id);if(!a){this.simulateAPI(e,t,n,s);return}const l=(t||{}).applications||[],d=a.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let p=0,m=0;for(const _ of l)if(_.status==="running"){const N=_.workerCount||2;m+=N,p+=N*75}p===0&&(p=100);let y=p*f;n.throughput=y;const b=5+Math.random()*10,S=d.enabledConnectors*2,M=3+Math.random()*5,E=15+Math.random()*25;n.latency=b+S+M+E;const C=.002,T=d.totalErrors>0?d.totalErrors/Math.max(d.totalRequests,1)*.15:0,k=d.runningApplications>0?.005:.01;n.errorRate=Math.min(1,C+T+k);const A=m>0?Math.min(1,n.throughput/(m*75)):.5;n.utilization=Math.min(1,A),n.customMetrics={applications:d.applications,running_applications:d.runningApplications,connectors:d.connectors,enabled_connectors:d.enabledConnectors,total_requests:d.totalRequests,total_errors:d.totalErrors,avg_latency:Math.round(d.avgLatency),total_workers:m,runtime_latency:b,connector_latency:E,transformation_latency:M}}simulateGrafana(e,t,n,s){const a=this.grafanaEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.getGrafanaMetrics(),l=a.calculateLoad();n.throughput=l.queriesPerSecond+l.alertEvaluationsPerSecond,n.latency=l.averageQueryLatency+l.averageRenderingLatency,n.errorRate=l.errorRate,n.utilization=(l.cpuUtilization+l.memoryUtilization)/2,n.customMetrics={queries_per_second:l.queriesPerSecond,dashboard_refreshes_per_second:l.dashboardRefreshesPerSecond,alert_evaluations_per_second:l.alertEvaluationsPerSecond,average_query_latency:l.averageQueryLatency,average_rendering_latency:l.averageRenderingLatency,datasource_errors:c.datasourceErrors,active_dashboards:c.activeDashboards,active_panels:c.activePanels,total_queries:c.totalQueries,cpu_utilization:l.cpuUtilization,memory_utilization:l.memoryUtilization}}simulateKeycloak(e,t,n,s){const a=this.keycloakEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics(),d=a.getConfig();n.throughput=c.requestsPerSecond,n.latency=c.averageLatency,n.errorRate=c.errorRate;const f=Math.min(.6,(c.activeSessions||0)/500),p=Math.min(.3,c.requestsPerSecond/200),m=d?.passwordPolicy?this.estimateKeycloakPolicyComplexity(d.passwordPolicy):0,y=Math.min(.2,m/100);n.utilization=Math.min(.95,.1+f+p+y),n.customMetrics={...n.customMetrics||{},keycloak_login_requests_total:l.loginRequestsTotal,keycloak_login_errors_total:l.loginErrorsTotal,keycloak_token_refresh_total:l.tokenRefreshTotal,keycloak_introspection_requests_total:l.introspectionRequestsTotal,keycloak_userinfo_requests_total:l.userInfoRequestsTotal,keycloak_sessions_active:l.activeSessions,keycloak_sessions_created_total:l.sessionsCreatedTotal,keycloak_sessions_expired_total:l.sessionsExpiredTotal,keycloak_auth_success_rate:c.authSuccessRate,keycloak_clients_configured:d?.clients.length??0,keycloak_users_configured:d?.users.length??0}}simulateVault(e,t,n,s){const a=this.vaultEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();a.getConfig(),n.throughput=c.requestsPerSecond,n.latency=c.averageLatency,n.errorRate=c.errorRate;const d=Math.min(.4,(c.secretsCount||0)/1e3),f=Math.min(.3,(c.activeTokens||0)/500),p=Math.min(.2,c.requestsPerSecond/300),m=Math.min(.1,(c.enginesEnabled||0)/10);n.utilization=Math.min(.95,.1+d+f+p+m),n.customMetrics={...n.customMetrics||{},vault_read_requests_total:l.readRequestsTotal,vault_write_requests_total:l.writeRequestsTotal,vault_delete_requests_total:l.deleteRequestsTotal,vault_list_requests_total:l.listRequestsTotal,vault_auth_requests_total:l.authRequestsTotal,vault_auth_errors_total:l.authErrorsTotal,vault_token_issued_total:l.tokenIssuedTotal,vault_token_renewed_total:l.tokenRenewedTotal,vault_token_revoked_total:l.tokenRevokedTotal,vault_tokens_active:l.activeTokens,vault_secrets_total:l.secretsTotal,vault_encryption_operations_total:l.encryptionOperationsTotal,vault_decryption_operations_total:l.decryptionOperationsTotal,vault_engines_enabled:c.enginesEnabled}}estimateKeycloakPolicyComplexity(e){if(!e)return 0;let t=0;const n=e.toLowerCase();n.includes("length(")&&(t+=20),n.includes("digits(")&&(t+=25),n.includes("special(")&&(t+=30),n.includes("uppercase(")&&(t+=15),n.includes("lowercase(")&&(t+=10);const s=(e.match(/\)/g)||[]).length;return t+=s*5,t}simulatePrometheus(e,t,n,s){const a=this.prometheusEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.getPrometheusMetrics(),l=a.calculateLoad();n.throughput=l.scrapeRequestsPerSecond,n.latency=l.averageScrapeDuration,n.errorRate=l.errorRate;const d=a.getTargetStatuses().length,f=Math.min(.95,.1+d/100*.5+l.scrapeRequestsPerSecond/10*.2);n.utilization=f,n.customMetrics={scrape_requests_total:c.scrapeRequestsTotal,scrape_errors_total:c.scrapeErrorsTotal,targets_up:c.targetsUp,targets_down:c.targetsDown,samples_scraped:c.samplesScraped,scrape_requests_per_second:l.scrapeRequestsPerSecond,samples_per_second:l.samplesPerSecond}}simulateWAF(e,t,n,s){const a=this.wafEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();a.getStats(),n.throughput=c.requestsPerSecond,n.latency=c.averageLatency;const d=a.getConfig();d?.mode==="prevention"?n.errorRate=c.blockRate:n.errorRate=0;const f=Math.min(.4,(l.activeRules||0)/50),p=Math.min(.3,c.requestsPerSecond/1e3),m=d?.enableOWASP?.15:0,y=d?.enableRateLimiting?.1:0,b=d?.enableGeoBlocking?.05:0;if(n.utilization=Math.min(.95,.1+f+p+m+y+b),n.customMetrics={...n.customMetrics||{},waf_requests_total:l.requestsTotal,waf_requests_allowed:l.requestsAllowed,waf_requests_blocked:l.requestsBlocked,waf_threats_detected:l.threatsDetected,waf_threats_blocked:l.threatsBlocked,waf_rate_limit_hits:l.rateLimitHits,waf_geo_block_hits:l.geoBlockHits,waf_ip_block_hits:l.ipBlockHits,waf_owasp_hits:l.owaspHits,waf_custom_rule_hits:l.customRuleHits,waf_active_rules:l.activeRules,waf_block_rate:c.blockRate,waf_threat_detection_rate:c.threatDetectionRate,waf_average_latency:c.averageLatency},s){const S=this.connections.filter(E=>E.target===e.id);let M=0;for(const E of S){const C=this.metrics.get(E.source);C&&(M+=C.throughput||0)}M>0&&(a.setSimulatedRequestRate(M),a.simulateRequests(M))}}simulateFirewall(e,t,n,s){const a=this.firewallEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();a.getStats(),n.throughput=c.packetsPerSecond,n.latency=c.averageLatency,n.errorRate=c.blockRate+c.rejectionRate;const d=Math.min(.3,(l.activeRules||0)/100),f=Math.min(.3,c.packetsPerSecond/1e4),p=a.getConfig()?.enableStatefulInspection?.2:0,m=a.getConfig()?.enableIntrusionDetection?.2:0;if(n.utilization=Math.min(.95,.1+d+f+p+m),n.customMetrics={...n.customMetrics||{},firewall_packets_total:l.packetsTotal,firewall_packets_allowed:l.packetsAllowed,firewall_packets_blocked:l.packetsBlocked,firewall_packets_rejected:l.packetsRejected,firewall_active_rules:l.activeRules,firewall_total_connections:l.totalConnections,firewall_active_connections:l.activeConnections,firewall_block_rate:c.blockRate,firewall_rejection_rate:c.rejectionRate,firewall_average_latency:c.averageLatency},s){const y=this.connections.filter(S=>S.target===e.id);let b=0;for(const S of y){const M=this.metrics.get(S.source);M&&(b+=M.throughput||0)}b>0&&(a.setSimulatedPacketRate(b),a.simulatePackets(b))}a.cleanup()}simulateArgoCD(e,t,n,s){const a=this.argoCDEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const c=a.getMetrics();n.throughput=c.syncRate/3600,n.latency=c.averageSyncDuration||0;const l=c.syncOperationsSuccess+c.syncOperationsFailed;n.errorRate=l>0?c.syncOperationsFailed/l:0,n.utilization=c.applicationsTotal>0?c.syncOperationsRunning/c.applicationsTotal:0,n.customMetrics={applicationsTotal:c.applicationsTotal,applicationsSynced:c.applicationsSynced,applicationsOutOfSync:c.applicationsOutOfSync,syncOperationsRunning:c.syncOperationsRunning,repositoriesConnected:c.repositoriesConnected}}simulateTerraform(e,t,n,s){const a=this.terraformEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const c=a.getMetrics();n.throughput=c.runsPerHour/3600,n.latency=c.averageRunDuration||0;const l=c.runsSuccess+c.runsFailed;n.errorRate=l>0?c.runsFailed/l:0,n.utilization=c.workspacesTotal>0?Math.min(1,c.runsRunning/c.workspacesTotal):0,n.customMetrics={workspacesTotal:c.workspacesTotal,runsTotal:c.runsTotal,runsRunning:c.runsRunning,runsPending:c.runsPending,runsSuccess:c.runsSuccess,runsFailed:c.runsFailed,statesTotal:c.statesTotal,resourcesManaged:c.resourcesManaged,runsPerHour:c.runsPerHour,averageRunDuration:c.averageRunDuration}}simulateHarbor(e,t,n,s){const a=this.harborEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();n.throughput=c.throughput,n.latency=c.averageLatency,n.errorRate=c.errorRate,n.utilization=(c.cpuUtilization+c.memoryUtilization+c.storageUtilization+c.networkUtilization)/4,n.customMetrics={...n.customMetrics||{},harbor_push_ops_per_sec:l.pushOperationsPerSecond,harbor_pull_ops_per_sec:l.pullOperationsPerSecond,harbor_scan_ops_per_sec:l.scanOperationsPerSecond,harbor_replication_ops_per_sec:l.replicationOperationsPerSecond,harbor_avg_push_latency:l.averagePushLatency,harbor_avg_pull_latency:l.averagePullLatency,harbor_avg_scan_latency:l.averageScanLatency,harbor_storage_used:l.storageUsed,harbor_storage_total:l.storageTotal,harbor_projects_total:l.totalProjects,harbor_repositories_total:l.totalRepositories,harbor_tags_total:l.totalTags,harbor_vulnerabilities_total:l.totalVulnerabilities,harbor_scans_completed:l.scansCompleted,harbor_scans_running:l.scansRunning,harbor_scans_failed:l.scansFailed,harbor_replication_policies_enabled:l.replicationPoliciesEnabled,harbor_active_replications:l.activeReplications,harbor_gc_operations_total:l.gcOperationsTotal,harbor_gc_storage_freed:l.gcStorageFreed,harbor_cpu_utilization:c.cpuUtilization,harbor_memory_utilization:c.memoryUtilization,harbor_storage_utilization:c.storageUtilization,harbor_network_utilization:c.networkUtilization}}simulateDocker(e,t,n,s){const a=this.dockerEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();n.throughput=c.throughput,n.latency=c.averageLatency,n.errorRate=c.errorRate,n.utilization=(c.cpuUtilization+c.memoryUtilization+c.networkUtilization+c.diskUtilization)/4,n.customMetrics={...n.customMetrics||{},docker_containers_total:l.containersTotal,docker_containers_running:l.containersRunning,docker_containers_stopped:l.containersStopped,docker_containers_paused:l.containersPaused,docker_images_total:l.imagesTotal,docker_images_size:l.imagesSize,docker_networks_total:l.networksTotal,docker_volumes_total:l.volumesTotal,docker_volumes_size:l.volumesSize,docker_ops_per_sec:l.operationsPerSecond,docker_avg_operation_latency:l.averageOperationLatency,docker_total_cpu_usage:l.totalCpuUsage,docker_total_memory_usage:l.totalMemoryUsage,docker_total_memory_limit:l.totalMemoryLimit,docker_total_network_rx:l.totalNetworkRx,docker_total_network_tx:l.totalNetworkTx,docker_build_ops_per_sec:l.buildOperationsPerSecond,docker_pull_ops_per_sec:l.pullOperationsPerSecond,docker_push_ops_per_sec:l.pushOperationsPerSecond,docker_cpu_utilization:c.cpuUtilization,docker_memory_utilization:c.memoryUtilization,docker_network_utilization:c.networkUtilization,docker_disk_utilization:c.diskUtilization}}simulateKubernetes(e,t,n,s){const a=this.kubernetesEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.getLoad(),l=a.getMetrics();n.throughput=c.throughput,n.latency=c.averageLatency,n.errorRate=c.errorRate,n.utilization=(c.cpuUtilization+c.memoryUtilization+c.podUtilization+c.networkUtilization+c.diskUtilization)/5,n.customMetrics={...n.customMetrics||{},k8s_pods_total:l.podsTotal,k8s_pods_running:l.podsRunning,k8s_pods_pending:l.podsPending,k8s_pods_failed:l.podsFailed,k8s_pods_succeeded:l.podsSucceeded,k8s_deployments_total:l.deploymentsTotal,k8s_deployments_ready:l.deploymentsReady,k8s_deployments_not_ready:l.deploymentsNotReady,k8s_services_total:l.servicesTotal,k8s_services_clusterip:l.servicesClusterIP,k8s_services_nodeport:l.servicesNodePort,k8s_services_loadbalancer:l.servicesLoadBalancer,k8s_nodes_total:l.nodesTotal,k8s_nodes_ready:l.nodesReady,k8s_nodes_not_ready:l.nodesNotReady,k8s_namespaces_total:l.namespacesTotal,k8s_configmaps_total:l.configMapsTotal,k8s_secrets_total:l.secretsTotal,k8s_total_cpu_usage:l.totalCpuUsage,k8s_total_memory_usage:l.totalMemoryUsage,k8s_total_memory_capacity:l.totalMemoryCapacity,k8s_cpu_utilization:c.cpuUtilization,k8s_memory_utilization:c.memoryUtilization,k8s_pod_utilization:c.podUtilization,k8s_network_utilization:c.networkUtilization,k8s_disk_utilization:c.diskUtilization}}simulateIDSIPS(e,t,n,s){const a=this.idsIpsEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();a.getStats(),n.throughput=c.packetsPerSecond,n.latency=c.averageLatency;const d=a.getConfig();d?.mode==="ips"?n.errorRate=c.blockRate:n.errorRate=0;const f=Math.min(.3,(l.activeSignatures||0)/100),p=Math.min(.3,c.packetsPerSecond/1e4),m=d?.enableSignatureDetection?.15:0,y=d?.enableAnomalyDetection?.15:0,b=d?.enableBehavioralAnalysis?.1:0;if(n.utilization=Math.min(.95,.1+f+p+m+y+b),n.customMetrics={...n.customMetrics||{},idsips_packets_total:l.packetsTotal,idsips_packets_analyzed:l.packetsAnalyzed,idsips_alerts_generated:l.alertsGenerated,idsips_alerts_blocked:l.alertsBlocked,idsips_signature_matches:l.signatureMatches,idsips_anomaly_detections:l.anomalyDetections,idsips_behavioral_detections:l.behavioralDetections,idsips_active_signatures:l.activeSignatures,idsips_blocked_ips:l.blockedIPs,idsips_alert_rate:c.alertRate,idsips_block_rate:c.blockRate},this.updateLatencyPercentiles(e.id,n.latency,n),!s){const S=this.connections.filter(E=>E.target===e.id);let M=0;for(const E of S){const C=this.metrics.get(E.source);C&&(M+=C.throughput||0)}M>0&&(a.setSimulatedPacketRate(M),a.simulatePackets(M))}}simulatePagerDuty(e,t,n,s){const a=this.pagerDutyEngines.get(e.id);if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=a.calculateLoad(),l=a.getMetrics();n.throughput=c.throughput,n.latency=c.latency,n.errorRate=c.errorRate,n.utilization=c.utilization,n.customMetrics={incidents_total:l.incidentsTotal,incidents_active:l.incidentsActive,incidents_resolved:l.incidentsResolved,notifications_sent:l.notificationsSent,escalations_triggered:l.escalationsTriggered,acknowledgements:l.acknowledgements,average_ack_latency_ms:l.averageAckLatency,average_resolve_latency_ms:l.averageResolveLatency,api_requests_per_second:l.apiRequestsPerSecond,webhooks_per_second:l.webhooksPerSecond,cpu_utilization:l.cpuUtilization,memory_utilization:l.memoryUtilization}}simulateLoki(e,t,n,s){if(!this.lokiEngines.has(e.id)){const m=new Jk;m.initializeConfig(e),this.lokiEngines.set(e.id,m)}const a=this.lokiEngines.get(e.id);s&&this.processLokiIngestion(e,a);const c=a.getLokiMetrics(),l=a.calculateLoad();n.throughput=l.ingestionLinesPerSecond+l.queriesPerSecond;const d=l.ingestionLinesPerSecond/(l.ingestionLinesPerSecond+l.queriesPerSecond||1),f=1-d;n.latency=l.averageIngestionLatency*d+l.averageQueryLatency*f,n.errorRate=l.ingestionErrorRate*d+l.queryErrorRate*f;const p=Math.min(1,l.streamCount/(t.maxStreams||1e4));n.utilization=Math.max(l.storageUtilization,p),n.customMetrics={ingestion_lines_per_second:l.ingestionLinesPerSecond,ingestion_bytes_per_second:l.ingestionBytesPerSecond,ingestion_requests_total:c.ingestionRequestsTotal,ingestion_errors_total:c.ingestionErrorsTotal,ingestion_lines_total:c.ingestionLinesTotal,ingestion_bytes_total:c.ingestionBytesTotal,queries_per_second:l.queriesPerSecond,query_requests_total:c.queryRequestsTotal,query_errors_total:c.queryErrorsTotal,average_query_latency:l.averageQueryLatency,average_ingestion_latency:l.averageIngestionLatency,active_streams:l.streamCount,total_storage_size:c.totalStorageSize,storage_utilization:l.storageUtilization,retention_deletions:c.retentionDeletions}}processLokiIngestion(e,t){const n=this.connections.filter(s=>s.target===e.id);for(const s of n){const a=this.nodes.find(p=>p.id===s.source);if(!a)continue;const c=this.connectionMetrics.get(s.id);if(!c||c.traffic===0)continue;const d=c.traffic/200,f=this.generateLogsFromComponent(a,d);f.length>0&&t.processIngestion(f,a.id)}}generateLogsFromComponent(e,t){const n=[],s=e.type,a=e.data.label||e.id,c={app:a.toLowerCase().replace(/\s+/g,"-"),component:s,source:e.id.slice(0,8)},l=this.metrics.get(e.id),d=Math.ceil(t/100),f=Math.floor(t/d)||1;for(let p=0;p<d&&p<10;p++){const m=[];for(let y=0;y<f;y++){const b=Date.now()*1e6+y,S=this.getLogLevel(l),M=this.generateLogMessage(s,a,S,l);m.push([b.toString(),M])}m.length>0&&n.push({stream:{...c,level:this.getLogLevel(l)},values:m})}return n}getLogLevel(e){return e?e.errorRate>.1?"error":e.errorRate>.05||e.utilization>.9?"warn":"info":"info"}generateLogMessage(e,t,n,s){const a=new Date().toISOString();return n==="error"&&s?`[${a}] ERROR ${e}: Request failed, error rate: ${(s.errorRate*100).toFixed(2)}%`:n==="warn"&&s?`[${a}] WARN ${e}: High utilization: ${(s.utilization*100).toFixed(2)}%`:`[${a}] INFO ${e}: ${t} processing requests, throughput: ${s?.throughput.toFixed(2)||0}/s`}simulateBFF(e,t,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const a=this.bffRoutingEngines.get(e.id);if(!a){this.simulateAPI(e,t,n,s);return}const c=t||{},l=c.endpoints||[],d=c.backends||[],f=this.connections.filter(Z=>Z.target===e.id);let p=0;for(const Z of f){const se=this.connectionMetrics.get(Z.id);if(se){const J=se.traffic/2048;p+=J}}const m=t.requestsPerSecond||p||100,y=a.getStats(),b=.3*Math.sin(this.simulationTime/2e3)+.7;n.throughput=m*b;let S=y.averageLatency||100;const M=5+Math.random()*10,E=y.cacheHitRate||0,C=E*.8,T=S*(1-C)+M;n.latency=T+Math.random()*20;const k=y.totalRequests>0?y.totalErrors/y.totalRequests:.005,A=.001;n.errorRate=Math.min(1,k+A);const _=c.maxConcurrentRequests||100,N=n.throughput*(n.latency/1e3);n.utilization=Math.min(1,N/_);const L=l.reduce((Z,se)=>Z+(se.requests||0),0),q=d.filter(Z=>Z.status==="connected").length;n.customMetrics={endpoints:l.length,backends:d.length,connected_backends:q,total_requests:y.totalRequests,total_errors:y.totalErrors,avg_latency:Math.round(y.averageLatency),cache_hit_rate:Math.round(E*100)/100,endpoint_requests:L,aggregation_overhead:Math.round(M),concurrent_requests:Math.round(N)}}initializeKongRoutingEngine(e){const t=e.data.config||{},n=new kk;n.initialize({services:t.services||[],routes:t.routes||[],upstreams:t.upstreams||[],consumers:t.consumers||[],plugins:t.plugins||[]}),this.kongRoutingEngines.set(e.id,n)}initializeNginxRoutingEngine(e){const t=e.data.config||{},n=new Dk;n.initialize({locations:t.locations||[],upstreams:t.upstreams||[],rateLimitZones:t.rateLimitZones||[],sslCertificates:t.sslCertificates||[],enableSSL:t.enableSSL,sslPort:t.sslPort,enableGzip:t.enableGzip,enableCache:t.enableCache,maxWorkers:t.maxWorkers}),this.nginxRoutingEngines.set(e.id,n)}initializeApigeeRoutingEngine(e){const t=e.data.config||{},n=new Tk;n.initialize({organization:t.organization,environment:t.environment,proxies:t.proxies||[],policies:t.policies||[]}),this.apigeeRoutingEngines.set(e.id,n)}initializeMuleSoftRoutingEngine(e){const t=e.data.config||{},n=new Ak,s=(t.applications||[]).map(c=>({name:c.name,runtimeVersion:c.runtimeVersion||"4.6.0",workerCount:c.workerCount||2,status:c.status||"stopped",connectors:c.connectors||[],errorStrategy:c.errorStrategy||"continue",reconnectionStrategy:c.reconnectionStrategy||"exponential",auditLogging:c.auditLogging||!1,flows:c.flows||[]})),a=(t.connectors||[]).map(c=>({name:c.name,type:c.type||"api",enabled:c.enabled!==!1,config:c.config||{},targetComponentType:c.targetComponentType,targetComponentId:c.targetComponentId}));n.initialize({organization:t.organization,environment:t.environment,applications:s,connectors:a}),this.mulesoftRoutingEngines.set(e.id,n)}initializeGraphQLGatewayRoutingEngine(e){const t=e.data.config||{},n=new Hk;n.initialize({services:t.services||[],federation:t.federation,cacheTtl:t.cacheTtl,persistQueries:t.persistQueries,subscriptions:t.subscriptions,enableIntrospection:t.enableIntrospection,enableQueryComplexityAnalysis:t.enableQueryComplexityAnalysis,enableRateLimiting:t.enableRateLimiting,maxQueryDepth:t.maxQueryDepth,maxQueryComplexity:t.maxQueryComplexity,endpoint:t.endpoint}),this.graphQLGatewayRoutingEngines.set(e.id,n),this.lastGraphQLGatewayUpdate.set(e.id,Date.now())}initializeBFFRoutingEngine(e){const t=e.data.config||{},n=new qk;let s=null,a="";if(t.cacheMode==="redis"){const c=this.connections.find(l=>(l.source===e.id||l.target===e.id)&&this.nodes.find(d=>d.id===(l.source===e.id?l.target:l.source))?.type==="redis");if(c){const l=this.nodes.find(d=>d.id===(c.source===e.id?c.target:c.source));l&&l.type==="redis"&&(this.redisRoutingEngines.has(l.id)||this.initializeRedisRoutingEngine(l),s=this.redisRoutingEngines.get(l.id),a=l.id)}}n.initialize({backends:t.backends||[],endpoints:t.endpoints||[],enableCaching:t.enableCaching??!0,enableRequestBatching:t.enableRequestBatching??!1,enableResponseCompression:t.enableResponseCompression??!0,defaultTimeout:t.defaultTimeout||5e3,maxConcurrentRequests:t.maxConcurrentRequests||100,cacheMode:t.cacheMode||"memory",cacheTtl:t.cacheTtl||5,fallbackEnabled:t.fallbackEnabled??!0,fallbackComponent:t.fallbackComponent,redisEngine:s||void 0,redisNodeId:a||void 0}),this.bffRoutingEngines.set(e.id,n)}initializeWebhookRelayRoutingEngine(e){const t=e.data.config||{},n=new Uk;n.initialize({relays:t.relays||[],enableRetryOnFailure:t.enableRetryOnFailure??!0,enableSignatureVerification:t.enableSignatureVerification??!0,enableRequestLogging:t.enableRequestLogging??!0,maxRetryAttempts:t.maxRetryAttempts||3,retryDelay:t.retryDelay||5,timeout:t.timeout||30}),this.webhookRelayRoutingEngines.set(e.id,n)}initializeRedisRoutingEngine(e){const t=e.data.config||{},n=new $k;n.initialize({host:t.host||"localhost",port:t.port||6379,password:t.password||"",database:t.database||0,maxMemory:t.maxMemory||"256mb",maxMemoryPolicy:t.maxMemoryPolicy||"noeviction",enablePersistence:t.enablePersistence??!0,persistenceType:t.persistenceType||"rdb",enableCluster:t.enableCluster??!1,clusterNodes:t.clusterNodes||[],keys:t.keys||[]}),this.redisRoutingEngines.set(e.id,n)}initializeCassandraRoutingEngine(e){const t=e.data.config||{},n=new Bk;n.initialize({clusterName:t.clusterName||"archiphoenix-cluster",nodes:t.nodes||[],keyspaces:t.keyspaces||[],tables:t.tables||[],defaultConsistencyLevel:t.consistencyLevel||"QUORUM",defaultReplicationFactor:t.replicationFactor||3,datacenter:t.datacenter||"dc1"}),this.cassandraRoutingEngines.set(e.id,n)}initializeClickHouseRoutingEngine(e){const t=e.data.config||{},n=new Fk;n.initialize({cluster:t.cluster||"archiphoenix-cluster",replication:t.replication||!1,tables:t.tables?.map(s=>({name:s.name,database:t.database||"default",engine:s.engine||"MergeTree",rows:s.rows||0,size:s.size||0,partitions:s.partitions||0,columns:s.columns||[]}))||[],maxMemoryUsage:t.maxMemoryUsage||10*1024*1024*1024,compression:t.compression||"LZ4"}),this.clickHouseRoutingEngines.set(e.id,n)}initializeSnowflakeRoutingEngine(e){const t=e.data.config||{},n=new Qk;n.initialize({account:t.account||"archiphoenix",region:t.region||"us-east-1",warehouses:t.warehouses?.map(s=>({name:s.name,size:s.size||"Small",status:s.status||"suspended",autoSuspend:s.autoSuspend||(t.enableAutoSuspend?t.autoSuspendSeconds:void 0),autoResume:s.autoResume!==void 0?s.autoResume:t.enableAutoResume!==!1,minClusterCount:s.minClusterCount||1,maxClusterCount:s.maxClusterCount||1,currentClusterCount:s.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0}))||[],databases:t.databases?.map(s=>({name:s.name,comment:s.comment,retentionTime:s.retentionTime,size:s.size,schemas:s.schemas?.map(a=>({name:a.name,tables:a.tables||[],views:a.views||0,functions:a.functions||0}))||[]}))||[],role:t.role||"ACCOUNTADMIN",enableAutoSuspend:t.enableAutoSuspend,autoSuspendSeconds:t.autoSuspendSeconds,enableAutoResume:t.enableAutoResume}),this.snowflakeRoutingEngines.set(e.id,n)}initializeElasticsearchRoutingEngine(e){const t=e.data.config||{},n=new Vk;n.initialize({clusterName:t.clusterName||"archiphoenix-cluster",nodes:t.nodes||["localhost:9200"],indices:t.indices||[],defaultShards:t.shards||5,defaultReplicas:t.replicas||1,refreshInterval:t.refreshInterval||"1s",enableSSL:t.enableSSL??!1,enableAuth:t.enableAuth??!1,username:t.username||"elastic",password:t.password||""}),this.elasticsearchRoutingEngines.set(e.id,n)}initializeS3RoutingEngine(e){const t=e.data.config||{},n=new Gk,s=(t.buckets||[]).map(a=>({name:a.name,region:a.region||t.defaultRegion||"us-east-1",versioning:a.versioning||!1,encryption:a.encryption||"AES256",lifecycleEnabled:a.lifecycleEnabled||!1,lifecycleDays:a.lifecycleDays,glacierEnabled:a.glacierEnabled||!1,glacierDays:a.glacierDays,publicAccess:a.publicAccess||!1,lifecycleRules:t.lifecycleRules||[]}));n.initialize({buckets:s,defaultRegion:t.defaultRegion||"us-east-1"}),this.s3RoutingEngines.set(e.id,n)}initializePrometheusEngine(e){const t=new Wk;t.initializeConfig(e),this.prometheusEngines.set(e.id,t)}initializeGrafanaEngine(e){const t=new Xk;t.initializeConfig(e),this.grafanaEngines.set(e.id,t)}initializeJaegerEngine(e){const t=new Zk;t.initializeConfig(e),this.jaegerEngines.set(e.id,t)}initializeOpenTelemetryCollectorEngine(e){if(this.otelCollectorEngines.has(e.id))this.otelCollectorEngines.get(e.id).initializeConfig(e);else{const t=new eT;t.initializeConfig(e),this.otelCollectorEngines.set(e.id,t)}}initializePagerDutyEngine(e){const t=new tT;t.initializeFromNode(e),this.pagerDutyEngines.set(e.id,t)}initializeKeycloakEngine(e){const t=new sT;t.initializeConfig(e),this.keycloakEngines.set(e.id,t)}initializeVaultEngine(e){const t=new uT;t.initializeConfig(e),this.vaultEngines.set(e.id,t)}initializeWAFEngine(e){const t=new aT;t.initializeConfig(e),this.wafEngines.set(e.id,t)}initializeFirewallEngine(e){const t=new rT;t.initializeConfig(e),this.firewallEngines.set(e.id,t)}initializeIDSIPSEngine(e){const t=new lT;t.initializeConfig(e),this.idsIpsEngines.set(e.id,t)}initializeJenkinsEngine(e){const t=new dT;t.initializeConfig(e),this.jenkinsEngines.set(e.id,t)}initializeGitLabCIEngine(e){const t=new fT;t.initializeConfig(e),this.gitlabCIEngines.set(e.id,t)}initializeArgoCDEngine(e){const t=new hT;t.initializeConfig(e),this.argoCDEngines.set(e.id,t)}initializeTerraformEngine(e){const t=new pT;t.initializeConfig(e),this.terraformEngines.set(e.id,t)}initializeHarborEngine(e){const t=new gT;t.initializeConfig(e),this.harborEngines.set(e.id,t)}initializeDockerEngine(e){const t=new vT;t.initializeConfig(e),this.dockerEngines.set(e.id,t)}initializeKubernetesEngine(e){const t=new bT;t.initializeConfig(e),this.kubernetesEngines.set(e.id,t)}createLokiQueryExecutor(e){const s=((e.data.config||{}).datasources||[]).find(d=>typeof d=="string"?!1:d.type==="loki");if(!s||typeof s=="string")return;const a=s.url||"",c=this.nodes.find(d=>d.type!=="loki"?!1:((d.data.config||{}).serverUrl||"http://loki:3100")===a||a.includes(d.id)||a.includes(d.data.label||""));if(!c)return;const l=this.lokiEngines.get(c.id);if(l)return(d,f,p,m)=>{const y=l.executeQuery(d,f,p,m);return{success:y.success,latency:y.latency,resultsCount:y.resultsCount,error:y.error}}}isPrometheusAvailableForGrafana(e){const t=this.connections.find(c=>c.source===e.id&&this.nodes.find(l=>l.id===c.target)?.type==="prometheus");if(!t)return!1;const n=this.nodes.find(c=>c.id===t.target);if(!n||!this.prometheusEngines.get(n.id))return!1;const a=this.metrics.get(n.id);return!(a&&a.errorRate>.5)}initializePostgreSQLConnectionPool(e){const t=e.data.config||{},n={maxConnections:t.maxConnections||100,minConnections:t.minConnections||0,idleTimeout:t.idleTimeout||3e5,maxLifetime:t.maxLifetime||36e5,connectionTimeout:t.connectionTimeout||5e3},s=new Kk(n);this.postgresConnectionPools.set(e.id,s)}updateElasticsearchMetricsInConfig(e,t){const n=e.data.config||{};n.clusterHealth=t.clusterHealth,n.activeShards=t.activeShards,n.relocatingShards=t.relocatingShards,n.initializingShards=t.initializingShards;const s=n.indices||[],a=this.elasticsearchRoutingEngines.get(e.id)?.getIndices()||[];for(let c=0;c<s.length;c++){const l=s[c],d=a.find(f=>f.name===l.name);d&&(s[c]={...l,docs:d.docs,size:d.size,health:d.health})}n.indices=s,n.totalDocs=t.totalDocs,n.totalSize=t.totalSize}updateS3BucketMetricsInConfig(e,t){const n=e.data.config||{},s=n.buckets||[];for(let a=0;a<s.length;a++){const c=s[a],l=t.get(c.name);l&&(s[a]={...c,objectCount:l.objectCount,totalSize:l.totalSize})}n.buckets=s}calculateConnectionLatency(e,t,n){const a={sync:5,async:2,http:10,grpc:5,websocket:3}[e.type]||10,c=t.latency||0,l=n.latency||0,d=e.data||{},f=d.latencyMs||0,p=(d.jitterMs||0)*(Math.random()-.5),m=2+Math.random()*8+f+p;return a+(c+l)/2+m}calculateCacheHitRatio(e,t){let n=.95;t>0&&t<100?n=.9+Math.random()*.05:t>=100&&t<1e3?n=.95+Math.random()*.04:t>=1e3&&(n=.92+Math.random()*.05);const s=Math.sin(this.simulationTime/1e4)*.02;return Math.max(.85,Math.min(.99,n+s))}createDefaultMetrics(e,t){return{id:e,type:t,throughput:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now()}}createDefaultConnectionMetrics(e){return{id:e.id,source:e.source,target:e.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0}}initializeMetrics(){this.metrics.clear(),this.connectionMetrics.clear(),this.latencyHistory.clear(),this.connectionLatencyHistory.clear();for(const e of this.nodes)this.metrics.set(e.id,this.createDefaultMetrics(e.id,e.type))}getComponentMetrics(e){return this.metrics.get(e)}getRabbitMQRoutingEngine(e){return this.rabbitMQRoutingEngines.get(e)}getActiveMQRoutingEngine(e){return this.activeMQRoutingEngines.get(e)}getSQSRoutingEngine(e){return this.sqsRoutingEngines.get(e)}getAzureServiceBusRoutingEngine(e){return this.azureServiceBusRoutingEngines.get(e)}getPubSubRoutingEngine(e){return this.pubSubRoutingEngines.get(e)}getRedisRoutingEngine(e){return this.redisRoutingEngines.get(e)}getCassandraRoutingEngine(e){return this.cassandraRoutingEngines.get(e)}getClickHouseRoutingEngine(e){return this.clickHouseRoutingEngines.get(e)}getSnowflakeRoutingEngine(e){return this.snowflakeRoutingEngines.get(e)}getElasticsearchRoutingEngine(e){return this.elasticsearchRoutingEngines.get(e)}getKongRoutingEngine(e){return this.kongRoutingEngines.get(e)}getNginxRoutingEngine(e){return this.nginxRoutingEngines.get(e)}getApigeeRoutingEngine(e){return this.apigeeRoutingEngines.get(e)}getMuleSoftRoutingEngine(e){return this.mulesoftRoutingEngines.get(e)}getGraphQLGatewayRoutingEngine(e){return this.graphQLGatewayRoutingEngines.get(e)}getBFFRoutingEngine(e){return this.bffRoutingEngines.get(e)}getWebhookRelayRoutingEngine(e){return this.webhookRelayRoutingEngines.get(e)}getLokiEmulationEngine(e){return this.lokiEngines.get(e)}getKeycloakEmulationEngine(e){return this.keycloakEngines.get(e)}getJenkinsEmulationEngine(e){return this.jenkinsEngines.get(e)}getGitLabCIEmulationEngine(e){return this.gitlabCIEngines.get(e)}getArgoCDEmulationEngine(e){return this.argoCDEngines.get(e)}getTerraformEmulationEngine(e){return this.terraformEngines.get(e)}getHarborEmulationEngine(e){return this.harborEngines.get(e)}getDockerEmulationEngine(e){return this.dockerEngines.get(e)}getVaultEmulationEngine(e){return this.vaultEngines.get(e)}getWAFEmulationEngine(e){return this.wafEngines.get(e)}getFirewallEmulationEngine(e){return this.firewallEngines.get(e)}getIDSIPSEmulationEngine(e){return this.idsIpsEngines.get(e)}getJaegerEmulationEngine(e){return this.jaegerEngines.get(e)}getAllJaegerEngines(){return new Map(this.jaegerEngines)}getOpenTelemetryCollectorRoutingEngine(e){return this.otelCollectorEngines.get(e)}checkSQSIAMPolicy(e,t,n,s){if(!e||e.length===0)return!0;const a=e.filter(d=>{const f=d.principal||"";if(f!==t&&f!=="*"&&!t.includes(f))return!1;const p=d.resource||"";let m=!1;if(p==="*"||p===n)m=!0;else if(p.endsWith("*")){const b=p.slice(0,-1);m=n.startsWith(b.replace(/.*:/,""))}else if(p.includes("sqs:")||p.includes("arn:aws:sqs")){const b=p.split(":").pop()||p.split("/").pop()||"";m=b===n||b==="*"||n.includes(b)}else m=n.includes(p)||p==="*";if(!m)return!1;const y=d.action||"";return!(y!==s&&y!=="*"&&!y.includes(s))});return a.length===0?!0:a.filter(d=>d.effect==="Deny").length>0?!1:(a.filter(d=>d.effect==="Allow").length>0,!0)}checkActiveMQACLPermissionPublic(e,t,n,s){return this.checkActiveMQACLPermission(e,t,n,s)}getConnectionMetrics(e){return this.connectionMetrics.get(e)}getAllComponentMetrics(){return Array.from(this.metrics.values())}getAllConnectionMetrics(){return Array.from(this.connectionMetrics.values())}getPagerDutyIncidents(e){const t=this.pagerDutyEngines.get(e);return t?t.getIncidents():[]}getPagerDutyMetrics(e){const t=this.pagerDutyEngines.get(e);return t?t.getMetrics():null}acknowledgePagerDutyIncident(e,t){const n=this.pagerDutyEngines.get(e);n&&n.acknowledgeIncident(Date.now(),t)}resolvePagerDutyIncident(e,t){const n=this.pagerDutyEngines.get(e);n&&n.resolveIncidentManually(Date.now(),t)}getIsRunning(){return this.isRunning}getSimulationTime(){return this.simulationTime}}const De=new wT;function ST(r,e){let t=null;return function(...s){const a=()=>{t=null,r(...s)};t!==null&&clearTimeout(t),t=setTimeout(a,e)}}class MT{logLevel;logs=[];maxLogs=100;constructor(){this.logLevel=2}debug(e,t){this.log(0,e,void 0,t)}info(e,t){this.log(1,e,void 0,t)}warn(e,t,n){this.log(2,e,t,n)}error(e,t,n){this.log(3,e,t,n)}log(e,t,n,s){if(e<this.logLevel)return;const a={level:e,message:t,error:n,timestamp:Date.now(),context:s};this.logs.push(a),this.logs.length>this.maxLogs&&this.logs.shift();const c=`[${this.getLevelName(e)}] ${t}`,l=s?{...s,error:n}:n;switch(e){case 0:console.debug(c,l||"");break;case 1:console.info(c,l||"");break;case 2:console.warn(c,l||"");break;case 3:console.error(c,l||"");break}}getLevelName(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARN";case 3:return"ERROR";default:return"UNKNOWN"}}getRecentLogs(e,t=50){let n=this.logs;return e!==void 0&&(n=this.logs.filter(s=>s.level>=e)),n.slice(-t)}clearLogs(){this.logs=[]}setLogLevel(e){this.logLevel=e}}const vb=new MT,bb=(r,e,t)=>vb.warn(r,e,t),ii=(r,e,t)=>vb.error(r,e,t),Rl="archiphoenix_diagram",Gh=1,CT=500,ET=()=>{try{const r=localStorage.getItem(Rl);if(!r)return null;const e=JSON.parse(r);return e.version!==Gh?(bb("Diagram version mismatch, using defaults"),null):e}catch(r){return ii("Failed to load diagram from storage",r instanceof Error?r:new Error(String(r))),null}},RT=(r,e="My Diagram")=>{try{const t={...r,version:Gh,name:e,createdAt:localStorage.getItem(`${Rl}_createdAt`)||new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem(Rl,JSON.stringify(t)),localStorage.setItem(`${Rl}_createdAt`,t.createdAt)}catch(t){ii("Failed to save diagram to storage",t instanceof Error?t:new Error(String(t)))}},gt=ST(RT,CT),kT=(r,e="diagram.json")=>{try{const t={...r,version:Gh,name:e.replace(".json",""),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},n=JSON.stringify(t,null,2),s=new Blob([n],{type:"application/json"}),a=URL.createObjectURL(s),c=document.createElement("a");c.href=a,c.download=e,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(a)}catch(t){ii("Failed to export diagram",t instanceof Error?t:new Error(String(t)))}},TT=r=>new Promise(e=>{try{const t=new FileReader;t.onload=n=>{try{const s=n.target?.result,a=JSON.parse(s);if(!a.nodes||!a.connections||typeof a.zoom!="number"||!a.pan)throw new Error("Invalid diagram format");a.groups||(a.groups=[]),e(a)}catch(s){ii("Failed to parse diagram file",s instanceof Error?s:new Error(String(s))),e(null)}},t.readAsText(r)}catch(t){ii("Failed to import diagram",t instanceof Error?t:new Error(String(t))),e(null)}}),AT=50,Ar=us((r,e)=>({past:[],future:[],canUndo:!1,canRedo:!1,pushState:t=>{r(n=>{const s=[...n.past,t];return s.length>AT&&s.shift(),{past:s,future:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{past:t,future:n}=e();if(t.length===0)return null;const s=t[t.length-1],a=t.slice(0,-1);return r({past:a,future:[s,...n],canUndo:a.length>0,canRedo:!0}),s},redo:()=>{const{past:t,future:n}=e();if(n.length===0)return null;const s=n[0],a=n.slice(1);return r({past:[...t,s],future:a,canUndo:!0,canRedo:a.length>0}),s},clearHistory:()=>{r({past:[],future:[],canUndo:!1,canRedo:!1})}}));class DT{rules=new Map;allRules=[];register(e){const t=e.sourceType;this.rules.has(t)||this.rules.set(t,[]);const n=this.rules.get(t);n&&(n.push(e),this.allRules.push(e),n.sort((s,a)=>(a.priority||0)-(s.priority||0)))}registerMany(e){e.forEach(t=>this.register(t))}findRules(e,t){const n=[],s=this.rules.get(e)||[];for(const c of s)(c.targetTypes==="*"||Array.isArray(c.targetTypes)&&c.targetTypes.includes(t))&&n.push(c);const a=this.rules.get("*")||[];for(const c of a)(c.targetTypes==="*"||Array.isArray(c.targetTypes)&&c.targetTypes.includes(t))&&n.push(c);return n.sort((c,l)=>(l.priority||0)-(c.priority||0))}getAllRules(){return[...this.allRules]}getRulesForSource(e){return this.rules.get(e)||[]}clear(){this.rules.clear(),this.allRules=[]}}const _T={postgres:5432,mongodb:27017,redis:6379,cassandra:9042,clickhouse:8123,elasticsearch:9200,rest:8080,grpc:50051,graphql:4e3,websocket:8080,webhook:8080,soap:8080,nginx:80,envoy:80,haproxy:80,traefik:80,docker:2375,kubernetes:6443,kafka:9092,rabbitmq:5672,activemq:61616,"aws-sqs":9324,prometheus:9090,grafana:3e3,loki:3100,jaeger:16686,keycloak:8080,"secrets-vault":8200,crm:8080,erp:8080,"payment-gateway":443},NT={"api-gateway":9100,postgres:9187,redis:9121,"service-mesh":15014,istio:15014,envoy:9901,cdn:9101,"aws-sqs":9102};class xb{getHost(e){return e.data.label?e.data.label.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):e.id.slice(0,8)}getPort(e,t){const n=e.data.config||{};switch(t){case"main":return n.port||n.host?.split(":")[1]||_T[e.type];case"metrics":return n.metricsPort||n.metrics?.port||NT[e.type];case"admin":return n.adminPort||n.admin?.port}}getEndpoint(e,t="main"){const n=this.getHost(e),s=this.getPort(e,t);if(!s)throw new Error(`Port not found for ${e.type}:${t}`);return`${n}:${s}`}getURL(e,t="main",n="http"){const s=this.getEndpoint(e,t);return`${n}://${s}`}getConnectionMetadata(e,t,n){const s=this.getHost(e),a=this.getHost(t),c=this.getPort(e,"main"),l=this.getPort(t,"main");let d="http";return n.type==="grpc"?d="grpc":n.type==="websocket"?d="websocket":t.type==="kafka"?d="kafka":t.type==="rabbitmq"||t.type==="activemq"?d="rabbitmq":n.type==="async"?d="async":n.type==="sync"&&(d="sync"),{protocol:d,sourceHost:s,targetHost:a,sourcePort:c,targetPort:l,endpoint:l?`${a}:${l}`:void 0}}getCapabilities(e){return{defaultPort:this.getPort(e,"main"),metricsPort:this.getPort(e,"metrics"),adminPort:this.getPort(e,"admin"),getHost:t=>this.getHost(t),getPort:(t,n)=>this.getPort(t,n)}}}class jT{registry;discovery;constructor(){this.registry=new DT,this.discovery=new xb}initialize(e){this.registry.registerMany(e)}handleConnectionCreated(e,t,n,s){const a=this.registry.findRules(e.type,t.type);if(a.length===0)return{sourceUpdated:!1,targetUpdated:!1};let c=!1,l=!1;const d=this.discovery.getConnectionMetadata(e,t,n);for(const f of a)try{const p=f.updateSourceConfig(e,t,n,d);if(p&&Object.keys(p).length>0&&(s(e.id,{data:{...e.data,config:{...e.data.config,...p}}}),c=!0),f.updateTargetConfig){const m=f.updateTargetConfig(e,t,n,d);m&&Object.keys(m).length>0&&(s(t.id,{data:{...t.data,config:{...t.data.config,...m}}}),l=!0)}}catch(p){ii(`Error applying rule for ${e.type} -> ${t.type}`,p instanceof Error?p:new Error(String(p)),{sourceType:e.type,targetType:t.type})}return{sourceUpdated:c,targetUpdated:l}}handleConnectionDeleted(e,t,n,s){const a=this.registry.findRules(e.type,t.type);if(a.length===0)return{sourceUpdated:!1,targetUpdated:!1};let c=!1,l=!1;const d=this.discovery.getConnectionMetadata(e,t,n);for(const f of a)try{if(f.cleanupSourceConfig){const p=f.cleanupSourceConfig(e,t,n,d);p&&Object.keys(p).length>0&&(s(e.id,{data:{...e.data,config:{...e.data.config,...p}}}),c=!0)}if(f.cleanupTargetConfig){const p=f.cleanupTargetConfig(e,t,n,d);p&&Object.keys(p).length>0&&(s(t.id,{data:{...t.data,config:{...t.data.config,...p}}}),l=!0)}}catch(p){ii(`Error cleaning up rule for ${e.type} -> ${t.type}`,p instanceof Error?p:new Error(String(p)),{sourceType:e.type,targetType:t.type})}return{sourceUpdated:c,targetUpdated:l}}getDiscovery(){return this.discovery}getRegistry(){return this.registry}}function PT(r){return{sourceType:"envoy",targetTypes:["rest","grpc","graphql","websocket","soap","webhook","postgres","mongodb","redis","cassandra","clickhouse","crm","erp","payment-gateway","bpmn-engine"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).clusters||[],l=c.find(m=>!m.hosts||!Array.isArray(m.hosts)?!1:m.hosts.some(y=>y.address===s.targetHost&&y.port===s.targetPort));if(l)return l.hosts.some(y=>y.address===s.targetHost&&y.port===s.targetPort)?null:{clusters:c.map(y=>y===l?{...y,hosts:[...y.hosts||[],{address:s.targetHost,port:s.targetPort}]}:y)};t.data.label||t.type;const d=`${t.type}-${t.id.slice(0,8)}-cluster`;let f="STRICT_DNS";s.protocol==="grpc"?f="STRICT_DNS":(t.type==="postgres"||t.type==="mongodb"||t.type==="redis")&&(f="STATIC_DNS");const p={name:d,type:f,hosts:[{address:s.targetHost,port:s.targetPort}],healthChecks:!0,connectTimeout:5e3,requests:0,errors:0};return{clusters:[...c,p],totalClusters:c.length+1}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function zT(r){return{sourceType:"api-gateway",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).apis||[];if(c.find(M=>M.backendUrl===`http://${s.targetHost}:${s.targetPort}`||M.backendUrl===`https://${s.targetHost}:${s.targetPort}`))return null;const f=`${t.data.label||t.type}-api`,p=`/api/${t.type}`;let m="GET";t.type==="grpc"?m="POST":t.type==="websocket"&&(m="GET");const b=`${s.protocol==="grpc","http"}://${s.targetHost}:${s.targetPort}`,S={name:f,path:p,method:m,backendUrl:b,enabled:!0,requests:0,errors:0};return{apis:[...c,S]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function LT(r){return{sourceType:"kong",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const a=e.data.config||{},c=a.services||[],l=a.routes||[],f=`${s.protocol==="grpc","http"}://${s.targetHost}:${s.targetPort}`,m=`${t.data.label||t.type}-service`;let y=c.find(C=>C.name===m||C.url===f);y||(y={id:String(c.length+1),name:m,url:f,routes:0,enabled:!0},c.push(y));const b=`/api/${t.type}`;if(l.find(C=>C.service===y.name&&C.path===b))return null;let M="GET";t.type==="grpc"?M="POST":(t.type==="websocket"||t.type==="rest"||t.type==="graphql")&&(M="GET");const E={id:String(l.length+1),path:b,method:M,service:y.name,stripPath:!0,protocols:["http","https"]};return y.routes=(y.routes||0)+1,{services:c,routes:[...l,E]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function IT(r){return{sourceType:"service-mesh",targetTypes:"*",priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).services||[];if(c.find(y=>y.host===s.targetHost&&y.port===s.targetPort))return null;const f=(t.data.label||t.type).toLowerCase().replace(/\s+/g,"-");let p="http";s.protocol==="grpc"?p="grpc":(t.type==="postgres"||t.type==="mongodb"||t.type==="redis")&&(p="tcp");const m={name:f,namespace:"default",host:s.targetHost,port:s.targetPort,protocol:p,enabled:!0};return{services:[...c,m]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function OT(r){return{sourceType:"istio",targetTypes:"*",priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).services||[];if(c.find(y=>y.host===s.targetHost&&y.port===s.targetPort))return null;const f=(t.data.label||t.type).toLowerCase().replace(/\s+/g,"-");let p="http";s.protocol==="grpc"?p="grpc":(t.type==="postgres"||t.type==="mongodb"||t.type==="redis")&&(p="tcp");const m={name:f,namespace:"default",host:s.targetHost,port:s.targetPort,protocol:p,enabled:!0};return{services:[...c,m]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function HT(r){return{sourceType:"nginx",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).upstreams||[],l=`${t.type}-upstream`;let d=c.find(p=>p.name===l);if(d)return d.servers?.some(m=>(m.host===s.targetHost||m.address===`${s.targetHost}:${s.targetPort}`)&&(m.port===s.targetPort||m.address?.includes(`:${s.targetPort}`)))?null:{upstreams:c.map(m=>m.name===l?{...m,servers:[...m.servers||[],{host:s.targetHost,port:s.targetPort}]}:m)};const f={name:l,servers:[{host:s.targetHost,port:s.targetPort}],loadBalancing:"round-robin"};return{upstreams:[...c,f]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function qT(r){return{sourceType:"haproxy",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).backends||[],l=`${t.type}-backend`;let d=c.find(p=>p.name===l);if(d)return d.servers?.some(m=>(m.host===s.targetHost||m.address===`${s.targetHost}:${s.targetPort}`)&&(m.port===s.targetPort||m.address?.includes(`:${s.targetPort}`)))?null:{backends:c.map(m=>m.name===l?{...m,servers:[...m.servers||[],{host:s.targetHost,port:s.targetPort}]}:m)};const f={name:l,servers:[{host:s.targetHost,port:s.targetPort}],balance:"roundrobin"};return{backends:[...c,f]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function UT(r){return{sourceType:"traefik",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const a=e.data.config||{},c=a.services||{},l=a.routers||{},d=`${t.type}-service`,f=`${t.type}-router`;if(c[d])return c[d].servers?.some(b=>b.url===`http://${s.targetHost}:${s.targetPort}`)?null:{services:{...c,[d]:{...c[d],servers:[...c[d].servers||[],{url:`http://${s.targetHost}:${s.targetPort}`}]}}};const m=`Host(\`${(t.data.label||t.type).toLowerCase()}.local\`)`;return{services:{...c,[d]:{loadBalancer:{servers:[{url:`http://${s.targetHost}:${s.targetPort}`}]}}},routers:{...l,[f]:{rule:m,service:d}}}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function $T(r){return{sourceType:"*",targetTypes:["postgres","mongodb","redis","cassandra","clickhouse","elasticsearch"],priority:5,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const a=e.data.config||{},c=t.type;let l={};switch(c){case"postgres":l={database:{host:s.targetHost,port:s.targetPort,database:a.database?.database||"postgres",username:a.database?.username||"postgres",password:a.database?.password||""}};break;case"mongodb":l={database:{connectionString:`mongodb://${s.targetHost}:${s.targetPort}`,database:a.database?.database||"admin"}};break;case"redis":l={database:{host:s.targetHost,port:s.targetPort,password:a.database?.password||""}};break;case"cassandra":l={database:{hosts:[`${s.targetHost}:${s.targetPort}`],keyspace:a.database?.keyspace||"system"}};break;case"clickhouse":l={database:{host:s.targetHost,port:s.targetPort,database:a.database?.database||"default"}};break;case"elasticsearch":l={database:{hosts:[`http://${s.targetHost}:${s.targetPort}`]}};break;default:return null}return l},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function BT(r){return{sourceType:"*",targetTypes:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],priority:5,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const a=e.data.config||{},c=t.type;let l={};switch(c){case"kafka":l={messaging:{broker:`${s.targetHost}:${s.targetPort}`,topic:a.messaging?.topic||t.data.config?.defaultTopic||"default-topic",producerId:a.messaging?.producerId||e.id.slice(0,8)}};break;case"rabbitmq":l={messaging:{broker:`${s.targetHost}:${s.targetPort}`,exchange:a.messaging?.exchange||t.data.config?.defaultExchange||"amq.topic",routingKey:a.messaging?.routingKey||"default"}};break;case"activemq":const d=t.data.config?.queues||[],f=d.length>0&&typeof d[0]=="object"?d[0].name:d.length>0?d[0]:null;l={messaging:{broker:`${s.targetHost}:${s.targetPort}`,queue:a.messaging?.queue||f||"default-queue"}};break;case"aws-sqs":{const p=t.data.config?.queues||[],m=p.length>0&&typeof p[0]=="object"?p[0].name:p.length>0?p[0]:null,y=p.length>0&&typeof p[0]=="object"?p[0].region:t.data.config?.defaultRegion||"us-east-1";l={messaging:{queueUrl:`https://sqs.${y}.amazonaws.com/account/${m||"default-queue"}`,queueName:m||"default-queue",region:a.messaging?.region||y}};break}case"azure-service-bus":{const p=t.data.config||{},m=p.namespace||"archiphoenix.servicebus.windows.net";p.connectionString||`${m}`;const y=a.messaging?.entityType||p.entityType||"queue",b=a.messaging?.entityName||a.messaging?.queue||a.messaging?.topic||p.entityName||(y==="queue"?"events":"events-topic"),S=a.messaging?.subscriptionName||p.subscriptionName;l={messaging:{connectionString:p.connectionString||`Endpoint=sb://${m}/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=...`,namespace:m,entityType:y,queue:y==="queue"?b:void 0,topic:y==="topic"?b:void 0,subscriptionName:y==="topic"&&S?S:void 0}};break}case"gcp-pubsub":l={messaging:{projectId:a.messaging?.projectId||"default-project",topic:a.messaging?.topic||t.data.config?.defaultTopic||"default-topic"}};break;default:return null}return l},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function FT(r,e){const t=r.data.config||{};return t.metrics?.port?t.metrics.port:t.metricsPort?t.metricsPort:(r.type==="service-mesh"||r.type==="istio")&&t.metrics?.controlPlanePort?t.metrics.controlPlanePort:e.getPort(r,"metrics")}function QT(r){const e=r.data.config||{};return e.metrics?.path?e.metrics.path:e.metricsPath?e.metricsPath:r.type==="envoy"?e.metrics?.prometheusPath||"/stats/prometheus":"/metrics"}function tv(r){return r.data.label?r.data.label.toLowerCase().replace(/\s+/g,"-"):`${r.type}-${r.id.slice(0,8)}`}function nv(r,e){const t=e.getHost(r),n=FT(r,e);if(!n){const s=e.getPort(r,"main");return s?`${t}:${s}`:null}return`${t}:${n}`}function VT(r){return{sourceType:"*",targetTypes:["prometheus"],priority:5,updateTargetConfig:(e,t,n,s)=>{const a=t.data.config||{},c=a.scrape_configs||[],l=a.scrapeInterval||"15s",d=QT(e),f=nv(e,r);if(!f)return null;const p=tv(e),m={component:e.type,componentId:e.id},y=c.findIndex(S=>S.job_name===p);if(y>=0){const S=c[y];let M=!1;for(const E of S.static_configs||[]){if(E.targets&&E.targets.includes(f)){M=!0;break}if(E.labels?.componentId===e.id){E.targets.includes(f)||E.targets.push(f),M=!0;break}}if(!M){const E=[...c],C=[...S.static_configs||[]];return C.push({targets:[f],labels:m}),E[y]={...S,static_configs:C},{scrape_configs:E}}return null}const b={job_name:p,scrape_interval:l!=="15s"?l:void 0,metrics_path:d!=="/metrics"?d:void 0,static_configs:[{targets:[f],labels:m}]};return{scrape_configs:[...c,b]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n),cleanupTargetConfig:(e,t,n,s)=>{const c=(t.data.config||{}).scrape_configs||[];if(!c||c.length===0)return null;const l=nv(e,r),d=tv(e),f=e.id;let p=!1;const m=c.map(y=>{if(y.job_name!==d)return y;const b=(y.static_configs||[]).map(S=>{if(S.labels?.componentId===f)return p=!0,null;if(l&&S.targets&&S.targets.includes(l)){const M=S.targets.filter(E=>E!==l);return M.length===0?(p=!0,null):(p=!0,{...S,targets:M})}return S}).filter(S=>S!==null);return b.length===0?(p=!0,null):{...y,static_configs:b}}).filter(y=>y!==null);return p?{scrape_configs:m}:null}}}function GT(r){return{sourceType:"grafana",targetTypes:["prometheus"],priority:10,updateSourceConfig:(e,t,n,s)=>{let c=(e.data.config||{}).datasources||[];c.length>0&&typeof c[0]=="string"&&(c=c.map(y=>({name:y,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:y===c[0]})));const l=r.getURL(t,"main"),d=s.targetHost||r.getHost(t),f=s.targetPort||r.getPort(t,"main")||9090,p=f===9090?`http://${d}:${f}`:l,m=c.findIndex(y=>y&&typeof y=="object"&&(y.type==="prometheus"||y.name?.toLowerCase().includes("prometheus")));if(m>=0){const y=[...c];return y[m]={...y[m],url:p,type:"prometheus",isDefault:y[m].isDefault??!0},{datasources:y}}else{const y={name:"Prometheus",type:"prometheus",url:p,access:"proxy",isDefault:c.length===0};return{datasources:[...c,y]}}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n),cleanupSourceConfig:(e,t,n,s)=>{let c=(e.data.config||{}).datasources||[];if(c.length>0&&typeof c[0]=="string")return null;const l=r.getURL(t,"main"),d=s.targetHost||r.getHost(t),f=s.targetPort||r.getPort(t,"main")||9090,p=f===9090?`http://${d}:${f}`:l,m=c.filter(y=>!(y&&typeof y=="object"&&y.url===p&&y.type==="prometheus"));return m.length!==c.length?{datasources:m}:null}}}function wb(r){const e=["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],t=["rest","grpc","graphql","soap","websocket","webhook"],n=["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],s=["s3-datalake"],a=["crm","erp","payment-gateway"];return e.includes(r)?"database":t.includes(r)?"api":n.includes(r)?"messaging":s.includes(r)?"file":a.includes(r)?"api":"custom"}function Ol(r,e,t){const n=t?r.label||r.type:e.label||e.type,s=t?r.id.slice(0,8):e.id.slice(0,8);return`${n}-${s}`.toLowerCase().replace(/\s+/g,"-")}function KT(r){return{sourceType:"*",targetTypes:["mulesoft"],priority:5,updateTargetConfig:(e,t,n,s)=>{const c=(t.data.config||{}).connectors||[];if(c.find(m=>m.targetComponentId===e.id||m.name===Ol(e,t,!0)))return null;const d=wb(e.type),p={name:Ol(e,t,!0),type:d,enabled:!0,config:{},targetComponentType:e.type,targetComponentId:e.id};return d==="database"&&s.targetHost&&s.targetPort?p.config={host:s.targetHost,port:s.targetPort}:d==="api"&&s.targetHost&&s.targetPort?p.config={baseUrl:`http://${s.targetHost}:${s.targetPort}`}:d==="messaging"&&(p.config={broker:s.targetHost&&s.targetPort?`${s.targetHost}:${s.targetPort}`:void 0}),{connectors:[...c,p]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function YT(r){return{sourceType:"mulesoft",targetTypes:"*",priority:5,updateSourceConfig:(e,t,n,s)=>{const c=(e.data.config||{}).connectors||[];if(c.find(m=>m.targetComponentId===t.id||m.name===Ol(e,t,!1)))return null;const d=wb(t.type),p={name:Ol(e,t,!1),type:d,enabled:!0,config:{},targetComponentType:t.type,targetComponentId:t.id};return d==="database"&&s.targetHost&&s.targetPort?p.config={host:s.targetHost,port:s.targetPort}:d==="api"&&s.targetHost&&s.targetPort?p.config={baseUrl:`http://${s.targetHost}:${s.targetPort}`}:d==="messaging"&&s.targetHost&&s.targetPort&&(p.config={broker:`${s.targetHost}:${s.targetPort}`}),{connectors:[...c,p]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function WT(r){return{sourceType:"graphql-gateway",targetTypes:["graphql"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).services||[],l=`http://${s.targetHost}:${s.targetPort}/graphql`;if(c.find(m=>m.endpoint===l||m.name===t.data.label))return null;const f=t.data.label||t.type,p={id:`svc-${c.length+1}`,name:f,endpoint:l,status:"connected",requests:0,errors:0};return{services:[...c,p]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function XT(r){return{sourceType:"bff-service",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(e,t,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const c=(e.data.config||{}).backends||[],l=t.data.label||t.type;if(c.find(m=>m.name===l||m.endpoint===`http://${s.targetHost}:${s.targetPort}`||m.id===t.id))return null;let f="http";t.type==="grpc"?f="grpc":t.type==="graphql"&&(f="graphql");const p={id:t.id||`backend-${Date.now()}`,name:l,endpoint:`http://${s.targetHost}:${s.targetPort}`,protocol:f,status:"connected",timeout:5e3,retries:3,retryBackoff:"exponential",circuitBreaker:{enabled:!0,failureThreshold:5,successThreshold:2,timeout:6e4}};return{backends:[...c,p]}},extractMetadata:(e,t,n)=>r.getConnectionMetadata(e,t,n)}}function JT(r){return[PT(r),HT(r),qT(r),UT(r),zT(r),LT(r),WT(r),XT(r),IT(r),OT(r),$T(r),BT(r),VT(r),GT(r),KT(r),YT(r)]}let Zf=null;function sv(){if(!Zf){const r=new xb,e=new jT,t=JT(r);e.initialize(t),Zf=e}return Zf}const Kn=2e3,iv=140,av=200,pl=(r,e)=>({x:Math.floor(r/Kn),y:Math.floor(e/Kn)}),ZT=(r,e,t,n,s,a)=>{const c=s*Kn,l=(s+1)*Kn,d=a*Kn,f=(a+1)*Kn,p=r,m=r+t,y=e,b=e+n;return!(m<c||p>l||b<d||y>f)},eh=r=>{const e=new Set,t=iv+av,n=iv+av,s=r.position.x,a=s+t,c=r.position.y,l=c+n,d=pl(s,c).x,f=pl(a,l).x,p=pl(s,c).y,m=pl(a,l).y;for(let y=d;y<=f;y++)for(let b=p;b<=m;b++)ZT(s,c,t,n,y,b)&&e.add(`${y},${b}`);return e},Qn=(r,e=[])=>{if(r.length===0)return[];const t=new Set,n=new Map(r.map(s=>[s.id,s]));return r.forEach(s=>{eh(s).forEach(c=>t.add(c))}),e.forEach(s=>{const a=n.get(s.source),c=n.get(s.target);a&&eh(a).forEach(d=>t.add(d)),c&&eh(c).forEach(d=>t.add(d))}),Array.from(t).map(s=>{const[a,c]=s.split(",").map(Number);return{x:a,y:c}})},Vn=r=>{if(r.length===0)return{minX:0,minY:0,maxX:Kn,maxY:Kn};const e=r.map(l=>l.x),t=r.map(l=>l.y),n=Math.min(...e),s=Math.min(...t),a=Math.max(...e),c=Math.max(...t);return{minX:n*Kn,minY:s*Kn,maxX:(a+1)*Kn,maxY:(c+1)*Kn}},th={nodes:[],connections:[],groups:[],zoom:1,pan:{x:0,y:0}},Ee=us((r,e)=>{const t=ET(),n=t?{...th,...t,groups:t.groups||[]}:th;let s=!1,a=!1;const c=()=>{const p=e();return{nodes:p.nodes,connections:p.connections,groups:p.groups||[],zoom:p.zoom,pan:p.pan}},l=()=>{Ar.getState().pushState(c())},d=Qn(n.nodes,n.connections||[]),f=Vn(d);return{...n,selectedNodeId:null,selectedConnectionId:null,diagramName:t?.name||"Untitled Diagram",viewportWidth:0,viewportHeight:0,canvasBounds:f,canvasChunks:d,getDiagramState:c,updateCanvasBounds:()=>r(p=>{const m=Qn(p.nodes,p.connections);return{canvasChunks:m,canvasBounds:Vn(m)}}),addNode:p=>r(m=>{l();const y=[...m.nodes,p],b=Qn(y,m.connections),S={nodes:y,canvasChunks:b,canvasBounds:Vn(b)};return gt({...m,...S},m.diagramName),S}),updateNode:(p,m,y=!1)=>r(b=>{!y&&!s&&l();const S=b.nodes.map(C=>C.id===p?{...C,...m}:C),M=Qn(S,b.connections),E={nodes:S,canvasChunks:M,canvasBounds:Vn(M)};return(!s||!y)&&gt({...b,...E},b.diagramName),E}),updateNodes:(p,m=!1)=>r(y=>{!m&&!s&&!a&&l();const b=new Map(p.map(C=>[C.id,C.updates])),S=y.nodes.map(C=>{const T=b.get(C.id);return T?{...C,...T}:C}),M=Qn(S,y.connections),E={nodes:S,canvasChunks:M,canvasBounds:Vn(M)};return(!a||!m)&&gt({...y,...E},y.diagramName),E}),deleteNode:p=>r(m=>{l();const y=m.nodes.filter(E=>E.id!==p),b=m.connections.filter(E=>E.source!==p&&E.target!==p),S=Qn(y,b),M={nodes:y,connections:b,selectedNodeId:m.selectedNodeId===p?null:m.selectedNodeId,canvasChunks:S,canvasBounds:Vn(S)};return gt({...m,...M},m.diagramName),M}),selectNode:(p,m=!1)=>r(y=>m&&p&&y.nodes.find(S=>S.id===p)?{selectedNodeId:p,nodes:y.nodes.map(S=>({...S,selected:S.id===p?!S.selected:S.selected||!1}))}:{selectedNodeId:p,nodes:y.nodes.map(b=>({...b,selected:b.id===p}))}),selectNodesByIds:p=>r(m=>({selectedNodeId:p.length>0?p[0]:null,nodes:m.nodes.map(y=>({...y,selected:p.includes(y.id)}))})),addConnection:p=>r(m=>{l();const y={...p,type:p.type||"async"},b=m.nodes.find(k=>k.id===y.source),S=m.nodes.find(k=>k.id===y.target);let M=[...m.nodes];if(b&&S){const k=sv(),A=(_,N)=>{const L=M.findIndex(q=>q.id===_);L!==-1&&(M[L]={...M[L],...N})};k.handleConnectionCreated(b,S,y,A)}const E=[...m.connections,y],C=Qn(M,E),T={nodes:M,connections:E,canvasChunks:C,canvasBounds:Vn(C)};return gt({...m,...T},m.diagramName),T}),updateConnection:(p,m)=>r(y=>{l();const b={connections:y.connections.map(S=>S.id===p?{...S,...m}:S)};return gt({...y,...b},y.diagramName),b}),deleteConnection:p=>r(m=>{l();const y=m.connections.find(C=>C.id===p);let b=[...m.nodes];if(y){const C=m.nodes.find(k=>k.id===y.source),T=m.nodes.find(k=>k.id===y.target);if(C&&T){const k=sv(),A=(_,N)=>{const L=b.findIndex(q=>q.id===_);L!==-1&&(b[L]={...b[L],...N})};k.handleConnectionDeleted(C,T,y,A)}}const S=m.connections.filter(C=>C.id!==p),M=Qn(b,S),E={nodes:b,connections:S,selectedConnectionId:m.selectedConnectionId===p?null:m.selectedConnectionId,canvasChunks:M,canvasBounds:Vn(M)};return gt({...m,...E},m.diagramName),E}),selectConnection:p=>r(m=>({selectedConnectionId:p,selectedNodeId:null,selectedGroupId:null,connections:m.connections.map(y=>({...y,selected:y.id===p}))})),addGroup:p=>r(m=>{l();const y={groups:[...m.groups,p]};return gt({...m,...y},m.diagramName),y}),updateGroup:(p,m)=>r(y=>{l();const b={groups:y.groups.map(S=>S.id===p?{...S,...m}:S)};return gt({...y,...b},y.diagramName),b}),deleteGroup:p=>r(m=>{l();const y={groups:m.groups.filter(b=>b.id!==p)};return gt({...m,...y},m.diagramName),y}),addNodeToGroup:(p,m)=>r(y=>{l();const b={groups:y.groups.map(S=>S.id===p&&!S.nodeIds.includes(m)?{...S,nodeIds:[...S.nodeIds,m]}:S)};return gt({...y,...b},y.diagramName),b}),removeNodeFromGroup:(p,m)=>r(y=>{l();const b={groups:y.groups.map(S=>S.id===p?{...S,nodeIds:S.nodeIds.filter(M=>M!==m)}:S)};return gt({...y,...b},y.diagramName),b}),selectGroup:p=>r(m=>({selectedGroupId:p,selectedNodeId:null,selectedConnectionId:null})),createGroupFromSelection:p=>r(m=>{l();const y=m.nodes.filter(M=>M.selected||M.id===m.selectedNodeId).map(M=>M.id);if(y.length===0)return m;const b={id:`group-${Date.now()}`,name:p,nodeIds:y,color:`hsl(${Math.random()*360}, 70%, 50%)`},S={groups:[...m.groups,b],nodes:m.nodes.map(M=>({...M,selected:!1})),selectedNodeId:null};return gt({...m,...S},m.diagramName),S}),autoGroupByConnections:()=>r(p=>{l();const m=new Set;p.groups.forEach(k=>{k.nodeIds.forEach(A=>m.add(A))});const y=new Map,b=k=>{y.has(k)||y.set(k,k);const A=y.get(k);if(A!==void 0&&A!==k){const _=b(A);return y.set(k,_),_}return A??k},S=(k,A)=>{const _=b(k),N=b(A);_!==N&&y.set(_,N)};p.connections.forEach(k=>{!m.has(k.source)&&!m.has(k.target)&&S(k.source,k.target)});const M=new Map;p.nodes.forEach(k=>{if(!m.has(k.id)){const A=b(k.id);M.has(A)||M.set(A,[]);const _=M.get(A);_&&_.push(k.id)}});const E=[];let C=p.groups.length+1;M.forEach((k,A)=>{k.length>=2&&E.push({id:`group-${Date.now()}-${E.length}`,name:`Group ${C++}`,nodeIds:k,color:`hsl(${Math.random()*360}, 70%, 50%)`})});const T={groups:[...p.groups,...E]};return gt({...p,...T},p.diagramName),T}),setZoom:p=>r(m=>(gt({...m,zoom:p},m.diagramName),{zoom:p})),setPan:p=>r(m=>(gt({...m,pan:p},m.diagramName),{pan:p})),setViewportSize:p=>r(()=>({viewportWidth:p.width,viewportHeight:p.height})),setDiagramName:p=>r(m=>(gt(m,p),{diagramName:p})),loadDiagramState:(p,m=!1)=>r(()=>{m||l();const y=Qn(p.nodes||[],p.connections||[]),b={...p,canvasChunks:y,canvasBounds:Vn(y)};return gt(b,e().diagramName),b}),saveDiagram:()=>{const p=e();gt(p,p.diagramName)},resetCanvas:()=>{l();const p=Qn([],[]);r({...th,canvasChunks:p,canvasBounds:Vn(p)})},undo:()=>{const p=Ar.getState().undo();p&&r(()=>{const m=Qn(p.nodes||[],p.connections||[]),y={...p,canvasChunks:m,canvasBounds:Vn(m)};return gt(y,e().diagramName),y})},redo:()=>{const p=Ar.getState().redo();p&&r(()=>{const m=Qn(p.nodes||[],p.connections||[]),y={...p,canvasChunks:m,canvasBounds:Vn(m)};return gt(y,e().diagramName),y})},startDragOperation:p=>{const m=e();s=!0,m.nodes.find(y=>y.id===p),l()},endDragOperation:()=>{s=!1;const p=e();gt(p,p.diagramName)},setGroupDragging:p=>{a=p},getIsGroupDragging:()=>a,bringToFront:p=>r(m=>{l();const y=m.nodes.findIndex(E=>E.id===p);if(y===-1)return m;const b=[...m.nodes],[S]=b.splice(y,1);b.push(S);const M={nodes:b};return gt({...m,...M},m.diagramName),M}),sendToBack:p=>r(m=>{l();const y=m.nodes.findIndex(E=>E.id===p);if(y===-1)return m;const b=[...m.nodes],[S]=b.splice(y,1);b.unshift(S);const M={nodes:b};return gt({...m,...M},m.diagramName),M}),bringForward:p=>r(m=>{l();const y=m.nodes.findIndex(M=>M.id===p);if(y===-1||y===m.nodes.length-1)return m;const b=[...m.nodes];[b[y],b[y+1]]=[b[y+1],b[y]];const S={nodes:b};return gt({...m,...S},m.diagramName),S}),sendBackward:p=>r(m=>{l();const y=m.nodes.findIndex(M=>M.id===p);if(y===-1||y===0)return m;const b=[...m.nodes];[b[y],b[y-1]]=[b[y-1],b[y]];const S={nodes:b};return gt({...m,...S},m.diagramName),S})}}),zi=us((r,e)=>({isRunning:!1,messages:new Map,messageHistory:[],initialize:(t,n)=>{fn.initialize(t,n),e().updateMessages(t,n)},start:()=>{fn.start(),r({isRunning:!0});const t=setInterval(()=>{const{nodes:n,connections:s}=Ee.getState();e().updateMessages(n,s)},200);fn._pollInterval=t},stop:()=>{fn.stop();const t=fn._pollInterval;t&&clearInterval(t),r({isRunning:!1})},updateMessages:(t,n)=>{fn.updateNodesAndConnections(t,n);const s=new Map;for(const c of n)s.set(c.id,fn.getConnectionMessages(c.id));const a=fn.getMessageHistory(100);r({messages:s,messageHistory:a})},getConnectionMessages:t=>fn.getConnectionMessages(t),getComponentMessages:t=>fn.getComponentMessages(t),getMessageHistory:t=>fn.getMessageHistory(t)}));class eA{nodes=[];connections=[];componentMetrics=new Map;connectionMetrics=new Map;dependencyGraph=new Map;componentStatuses=new Map;update(e,t,n,s){this.nodes=e,this.connections=t,this.componentMetrics=n,this.connectionMetrics=s,this.buildDependencyGraph(),this.analyzeComponentHealth(),this.identifyCriticalPaths(),this.calculateImpactScores()}buildDependencyGraph(){this.dependencyGraph.clear();for(const e of this.nodes){const t=[],n=this.connections.filter(s=>s.target===e.id);for(const s of n){const a=this.connectionMetrics.get(s.id),c=this.componentMetrics.get(s.source);if(!a||!c)continue;const l=Math.max(a.throughputDependency,a.utilization,a.backpressure);let d="direct";a.bottleneck?d="critical":l>.7&&(d="indirect"),t.push({sourceId:s.source,targetId:e.id,connectionId:s.id,type:d,strength:l,impact:this.calculateDependencyImpact(s,c)})}this.dependencyGraph.set(e.id,t)}}calculateDependencyImpact(e,t){const n=this.connectionMetrics.get(e.id);if(!n)return 0;const s=t.errorRate,a=Math.min(1,n.latency/1e3),c=n.backpressure,l=t.utilization>.8?.5:0;return Math.min(1,s*.4+a*.2+c*.3+l*.1)}analyzeComponentHealth(){this.componentStatuses.clear();for(const e of this.nodes){const t=this.componentMetrics.get(e.id),n=this.dependencyGraph.get(e.id)||[];if(!t){this.componentStatuses.set(e.id,{nodeId:e.id,health:"down",dependencies:n,dependents:[],criticalPath:!1,impactScore:0,failureRisk:1});continue}let s="healthy",a=0;t.errorRate>.1?(s="critical",a+=.4):t.errorRate>.05&&(s="degraded",a+=.2),t.utilization>.9?(s==="healthy"&&(s="degraded"),a+=.3):t.utilization>.8&&(a+=.15),t.latency>1e3?(s==="healthy"&&(s="degraded"),a+=.2):t.latency>500&&(a+=.1);for(const l of n){const d=this.componentStatuses.get(l.sourceId);d&&(d.health==="critical"||d.health==="down"?(s==="healthy"&&(s="degraded"),a+=l.impact*.3):d.health==="degraded"&&(a+=l.impact*.15))}a=Math.min(1,a);const c=[];for(const l of this.connections)if(l.source===e.id){const d=this.connectionMetrics.get(l.id);d&&c.push({sourceId:e.id,targetId:l.target,connectionId:l.id,type:d.bottleneck?"critical":"direct",strength:d.throughputDependency,impact:this.calculateDependencyImpact(l,t)})}this.componentStatuses.set(e.id,{nodeId:e.id,health:s,dependencies:n,dependents:c,criticalPath:!1,impactScore:0,failureRisk:a})}}identifyCriticalPaths(){const e=this.nodes.filter(n=>!this.connections.some(s=>s.target===n.id)),t=this.nodes.filter(n=>!this.connections.some(s=>s.source===n.id));for(const n of e)for(const s of t){const a=this.findPath(n.id,s.id);a&&a.length>1&&a.some(l=>{const d=this.componentStatuses.get(l),f=this.connections.find(p=>a.includes(p.source)&&a.includes(p.target)&&a.indexOf(p.source)<a.indexOf(p.target));if(f){const p=this.connectionMetrics.get(f.id);return p?.bottleneck||(p?.backpressure||0)>.7}return d?.health==="critical"||d?.health==="down"})&&a.forEach(l=>{const d=this.componentStatuses.get(l);d&&(d.criticalPath=!0)})}}findPath(e,t){if(e===t)return[e];const n=[{nodeId:e,path:[e]}],s=new Set([e]);for(;n.length>0;){const{nodeId:a,path:c}=n.shift(),l=this.connections.filter(d=>d.source===a);for(const d of l){if(d.target===t)return[...c,t];s.has(d.target)||(s.add(d.target),n.push({nodeId:d.target,path:[...c,d.target]}))}}return null}calculateImpactScores(){for(const[e,t]of this.componentStatuses.entries()){let n=0;n+=Math.min(1,t.dependents.length/5)*.3,t.health==="critical"||t.health==="down"?n+=.4:t.health==="degraded"&&(n+=.2),t.criticalPath&&(n+=.2),n+=t.failureRisk*.1,t.impactScore=Math.min(1,n),this.componentStatuses.set(e,t)}}analyzeSystem(){const e=[],t=[],n=[],s=[];for(const[d,f]of this.componentStatuses.entries())if(f.criticalPath){const p=this.findPathToSink(d);p&&!e.some(m=>JSON.stringify(m)===JSON.stringify(p))&&e.push(p)}for(const[d,f]of this.connectionMetrics.entries())if(f.bottleneck){const p=this.connections.find(m=>m.id===d);p&&(t.includes(p.source)||t.push(p.source),t.includes(p.target)||t.push(p.target))}for(const[d,f]of this.componentStatuses.entries())(f.failureRisk>.6||f.health==="critical"||f.health==="down")&&n.push(d);this.generateRecommendations(s);const a=Array.from(this.componentStatuses.values()).map(d=>{switch(d.health){case"down":return 0;case"critical":return .25;case"degraded":return .5;case"healthy":return 1}}),c=a.length>0?a.reduce((d,f)=>d+f,0)/a.length:1;let l="healthy";return c<.25?l="down":c<.5?l="critical":c<.75&&(l="degraded"),{criticalPaths:e,bottlenecks:t,riskComponents:n,recommendations:s,overallHealth:l}}findPathToSink(e){const t=this.nodes.filter(n=>!this.connections.some(s=>s.source===n.id));for(const n of t){const s=this.findPath(e,n.id);if(s)return s}return null}generateRecommendations(e){for(const[n,s]of this.componentStatuses.entries()){const a=this.nodes.find(l=>l.id===n),c=this.componentMetrics.get(n);!a||!c||(c.utilization>.85&&e.push({type:"scaling",priority:c.utilization>.95?"critical":"high",componentId:n,message:`${a.data.label} is highly utilized (${(c.utilization*100).toFixed(0)}%)`,impact:"May cause performance degradation and increased latency",suggestion:`Consider scaling ${a.data.label} horizontally or vertically`}),c.errorRate>.05&&e.push({type:"monitoring",priority:c.errorRate>.1?"critical":"high",componentId:n,message:`${a.data.label} has high error rate (${(c.errorRate*100).toFixed(1)}%)`,impact:"Affects system reliability and user experience",suggestion:`Investigate error logs and implement error handling for ${a.data.label}`}),c.latency>500&&e.push({type:"optimization",priority:c.latency>1e3?"high":"medium",componentId:n,message:`${a.data.label} has high latency (${c.latency.toFixed(0)}ms)`,impact:"Affects end-to-end response time",suggestion:`Optimize ${a.data.label} performance or add caching`}),s.criticalPath&&s.failureRisk>.5&&e.push({type:"redundancy",priority:"high",componentId:n,message:`${a.data.label} is on a critical path and at risk`,impact:"Failure would significantly impact system",suggestion:`Add redundancy or failover for ${a.data.label}`}))}for(const[n,s]of this.connectionMetrics.entries()){const a=this.connections.find(d=>d.id===n);if(!a)continue;const c=this.nodes.find(d=>d.id===a.source),l=this.nodes.find(d=>d.id===a.target);s.bottleneck&&e.push({type:"optimization",priority:"critical",connectionId:n,message:`Connection between ${c?.data.label||"source"} and ${l?.data.label||"target"} is a bottleneck`,impact:"Limiting overall system throughput",suggestion:"Increase bandwidth or optimize data transfer between these components"}),s.backpressure>.7&&e.push({type:"optimization",priority:"high",connectionId:n,message:`High backpressure (${(s.backpressure*100).toFixed(0)}%) on connection`,impact:"Target component cannot process data fast enough",suggestion:"Scale target component or implement buffering/queuing"})}const t={critical:0,high:1,medium:2,low:3};e.sort((n,s)=>t[n.priority]-t[s.priority])}getComponentStatus(e){return this.componentStatuses.get(e)}getAllComponentStatuses(){return Array.from(this.componentStatuses.values())}getDependencies(e){return this.dependencyGraph.get(e)||[]}}const nh=new eA,ma=us((r,e)=>({componentStatuses:new Map,systemAnalysis:null,updateAnalysis:()=>{const{nodes:t,connections:n}=Ee.getState(),{componentMetrics:s,connectionMetrics:a}=Nt.getState();nh.update(t,n,s,a);const c=nh.analyzeSystem(),l=new Map(nh.getAllComponentStatuses().map(d=>[d.nodeId,d]));r({componentStatuses:l,systemAnalysis:c})},getComponentStatus:t=>e().componentStatuses.get(t),getAllComponentStatuses:()=>Array.from(e().componentStatuses.values()),getSystemAnalysis:()=>e().systemAnalysis})),Kh=us((r,e)=>({alerts:[],updateAlerts:()=>{try{const{nodes:t,connections:n}=Ee.getState(),{componentMetrics:s,connectionMetrics:a}=Nt.getState(),c=ma.getState().getAllComponentStatuses();fa.analyze(t,s,a,c);const l=fa.getAlerts();r({alerts:l})}catch(t){console.error("Error in updateAlerts:",t)}},acknowledgeAlert:t=>{fa.acknowledge(t);const n=fa.getAlerts();r({alerts:n})},clearAlerts:()=>{fa.clear(),r({alerts:[]})},getCriticalAlerts:()=>e().alerts.filter(t=>t.type==="critical"),getWarningAlerts:()=>e().alerts.filter(t=>t.type==="warning")})),Sb=us((r,e)=>(ct.onError(()=>{e().updateErrors()}),{errors:[],updateErrors:()=>{const t=ct.getErrors();r({errors:t})},clearErrors:()=>{ct.clear(),r({errors:[]})},clearErrorsByFilter:t=>{ct.clearByFilter(t),e().updateErrors()},removeError:t=>{ct.removeError(t),e().updateErrors()},getErrorsBySeverity:t=>ct.getErrorsBySeverity(t),getErrorsBySource:t=>ct.getErrorsBySource(t),getErrorsByComponent:t=>ct.getErrorsByComponent(t),getCriticalErrors:()=>ct.getCriticalErrors(),getErrorCount:t=>ct.getErrorCount(t),getStats:()=>ct.getStats()})),Nt=us((r,e)=>({isRunning:!1,simulationTime:0,updateInterval:100,componentMetrics:new Map,connectionMetrics:new Map,initialize:(t,n)=>{De.initialize(t,n),r({componentMetrics:new Map(De.getAllComponentMetrics().map(s=>[s.id,s])),connectionMetrics:new Map(De.getAllConnectionMetrics().map(s=>[s.id,s]))}),zi.getState().initialize(t,n)},start:()=>{console.log("useEmulationStore.start() called");try{const t=De.getIsRunning();console.log("Engine running state:",t),t&&(console.log("Stopping engine first..."),De.stop()),console.log("Calling emulationEngine.start()..."),De.start(),console.log("Engine started, setting store isRunning to true"),r({isRunning:!0}),console.log("Starting data flow..."),zi.getState().start(),console.log("Setting up polling interval...");const n=setInterval(()=>{e().updateMetrics()},e().updateInterval);De._pollInterval=n,console.log("Start complete, polling interval set")}catch(t){throw console.error("Error in useEmulationStore.start():",t),t}},stop:()=>{De.stop();const t=De._pollInterval;t&&clearInterval(t),zi.getState().stop(),r({isRunning:!1})},reset:()=>{De.resetSimulation();const t=De._pollInterval;t&&clearInterval(t),zi.getState().stop(),r({isRunning:!1,simulationTime:0,componentMetrics:new Map,connectionMetrics:new Map})},setUpdateInterval:t=>{r({updateInterval:t})},updateMetrics:()=>{const{nodes:t,connections:n}=Ee.getState();De.updateNodesAndConnections(t,n),r(s=>({simulationTime:De.getSimulationTime(),componentMetrics:new Map(De.getAllComponentMetrics().map(a=>[a.id,a])),connectionMetrics:new Map(De.getAllConnectionMetrics().map(a=>[a.id,a]))})),zi.getState().updateMessages(t,n),ma.getState().updateAnalysis(),Kh.getState().updateAlerts(),Sb.getState().updateErrors()},getComponentMetrics:t=>e().componentMetrics.get(t),getConnectionMetrics:t=>e().connectionMetrics.get(t)}));const tA=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),nA=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),ov=r=>{const e=nA(r);return e.charAt(0).toUpperCase()+e.slice(1)},Mb=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),sA=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var iA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const aA=w.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:a,iconNode:c,...l},d)=>w.createElement("svg",{ref:d,...iA,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:Mb("lucide",s),...!a&&!sA(l)&&{"aria-hidden":"true"},...l},[...c.map(([f,p])=>w.createElement(f,p)),...Array.isArray(a)?a:[a]]));const _e=(r,e)=>{const t=w.forwardRef(({className:n,...s},a)=>w.createElement(aA,{ref:a,iconNode:e,className:Mb(`lucide-${tA(ov(r))}`,`lucide-${r}`,n),...s}));return t.displayName=ov(r),t};const oA=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ya=_e("activity",oA);const rA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],cA=_e("arrow-down",rA);const lA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],uA=_e("arrow-right",lA);const dA=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],fA=_e("arrow-up",dA);const hA=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pA=_e("ban",hA);const gA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Yh=_e("check",gA);const mA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Jl=_e("chevron-down",mA);const yA=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Wh=_e("chevron-right",yA);const vA=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Cb=_e("chevron-up",vA);const bA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],va=_e("circle-alert",bA);const xA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Xh=_e("circle-check",xA);const wA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],SA=_e("circle-question-mark",wA);const MA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pa=_e("circle-x",MA);const CA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],EA=_e("circle",CA);const RA=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Eb=_e("copy",RA);const kA=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],TA=_e("download",kA);const AA=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],DA=_e("eye",AA);const _A=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],rv=_e("file-text",_A);const NA=[["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],jA=_e("folder-minus",NA);const PA=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],xh=_e("folder-plus",PA);const zA=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Rb=_e("funnel",zA);const LA=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],IA=_e("grip-vertical",LA);const OA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],kb=_e("info",OA);const HA=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Tb=_e("layers",HA);const qA=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],UA=_e("map",qA);const $A=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],BA=_e("maximize-2",$A);const FA=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],QA=_e("network",FA);const VA=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],GA=_e("pause",VA);const KA=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],YA=_e("play",KA);const WA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Hl=_e("plus",WA);const XA=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],kl=_e("power-off",XA);const JA=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],sh=_e("power",JA);const ZA=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],eD=_e("redo-2",ZA);const tD=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],nD=_e("refresh-cw",tD);const sD=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ab=_e("rotate-ccw",sD);const iD=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],aD=_e("ruler",iD);const oD=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],rD=_e("save",oD);const cD=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ur=_e("search",cD);const lD=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],ih=_e("settings-2",lD);const uD=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],dD=_e("settings",uD);const fD=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],hD=_e("sparkles",fD);const pD=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],gD=_e("square-pen",pD);const mD=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],yD=_e("star",mD);const vD=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Zl=_e("trash-2",vD);const bD=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Db=_e("trending-down",bD);const xD=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],as=_e("triangle-alert",xD);const wD=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],SD=_e("undo-2",wD);const MD=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],CD=_e("upload",MD);const ED=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],os=_e("x",ED);const RD=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],_b=_e("zap",RD);const kD=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],TD=_e("zoom-in",kD);const AD=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],DD=_e("zoom-out",AD);function _D(){const{isRunning:r,simulationTime:e,initialize:t,start:n,stop:s,reset:a}=Nt(),{nodes:c,connections:l}=Ee();w.useEffect(()=>{const y=De.getIsRunning();console.log("EmulationPanel mounted/updated",{storeIsRunning:r,engineIsRunning:y,simulationTime:e,nodesCount:c.length,connectionsCount:l.length}),r!==y&&(console.warn("State mismatch detected!",{storeIsRunning:r,engineIsRunning:y}),r&&!y?(console.log("Fixing: stopping store"),s()):!r&&y&&(console.log("Fixing: stopping engine"),De.stop()))},[r,e,c.length,l.length,s]);const d=()=>{console.log("handleStart called",{isRunning:r,simulationTime:e,nodesCount:c.length,connectionsCount:l.length});try{e===0&&(console.log("Initializing emulation..."),t(c,l),console.log("Initialization complete")),console.log("Starting emulation..."),n(),console.log("Start called, isRunning should be true now")}catch(y){console.error("Error starting emulation:",y)}},f=()=>{s()},p=()=>{a()},m=y=>{const b=Math.floor(y/1e3),S=Math.floor(b/60),M=b%60;return`${S}:${M.toString().padStart(2,"0")}`};return g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-sm text-muted-foreground w-12",children:m(e)}),g.jsx(ke,{size:"sm",variant:r?"default":"outline",onClick:y=>{console.log("Button clicked!",{isRunning:r,simulationTime:e,disabled:r}),y.preventDefault(),y.stopPropagation(),r?console.warn("Button clicked but isRunning is true, button should be disabled"):d()},disabled:r,title:"Start emulation",style:{pointerEvents:r?"none":"auto"},children:g.jsx(YA,{className:"w-4 h-4"})}),g.jsx(ke,{size:"sm",variant:r?"default":"outline",onClick:f,disabled:!r,title:"Stop emulation",children:g.jsx(GA,{className:"w-4 h-4"})}),g.jsx(ke,{size:"sm",variant:"outline",onClick:p,title:"Reset simulation",children:g.jsx(Ab,{className:"w-4 h-4"})})]})}const Tt=w.forwardRef(({className:r,type:e,...t},n)=>g.jsx("input",{type:e,className:Re("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n,...t}));Tt.displayName="Input";function ND(r){const e=jD(r),t=w.forwardRef((n,s)=>{const{children:a,...c}=n,l=w.Children.toArray(a),d=l.find(zD);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}function jD(r){const e=w.forwardRef((t,n)=>{const{children:s,...a}=t;if(w.isValidElement(s)){const c=ID(s),l=LD(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var PD=Symbol("radix.slottable");function zD(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===PD}function LD(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function ID(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var OD=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ae=OD.reduce((r,e)=>{const t=ND(`Primitive.${e}`),n=w.forwardRef((s,a)=>{const{asChild:c,...l}=s,d=c?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...r,[e]:n}},{});function Nb(r,e){r&&qr.flushSync(()=>r.dispatchEvent(e))}var rn=globalThis?.document?w.useLayoutEffect:()=>{};function HD(r,e){return w.useReducer((t,n)=>e[t][n]??t,r)}var ln=r=>{const{present:e,children:t}=r,n=qD(e),s=typeof t=="function"?t({present:n.isPresent}):w.Children.only(t),a=je(n.ref,UD(s));return typeof t=="function"||n.isPresent?w.cloneElement(s,{ref:a}):null};ln.displayName="Presence";function qD(r){const[e,t]=w.useState(),n=w.useRef(null),s=w.useRef(r),a=w.useRef("none"),c=r?"mounted":"unmounted",[l,d]=HD(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return w.useEffect(()=>{const f=gl(n.current);a.current=l==="mounted"?f:"none"},[l]),rn(()=>{const f=n.current,p=s.current;if(p!==r){const y=a.current,b=gl(f);r?d("MOUNT"):b==="none"||f?.display==="none"?d("UNMOUNT"):d(p&&y!==b?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,d]),rn(()=>{if(e){let f;const p=e.ownerDocument.defaultView??window,m=b=>{const M=gl(n.current).includes(CSS.escape(b.animationName));if(b.target===e&&M&&(d("ANIMATION_END"),!s.current)){const E=e.style.animationFillMode;e.style.animationFillMode="forwards",f=p.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=E)})}},y=b=>{b.target===e&&(a.current=gl(n.current))};return e.addEventListener("animationstart",y),e.addEventListener("animationcancel",m),e.addEventListener("animationend",m),()=>{p.clearTimeout(f),e.removeEventListener("animationstart",y),e.removeEventListener("animationcancel",m),e.removeEventListener("animationend",m)}}else d("ANIMATION_END")},[e,d]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:w.useCallback(f=>{n.current=f?getComputedStyle(f):null,t(f)},[])}}function gl(r){return r?.animationName||"none"}function UD(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function $D(r,e){const t=w.createContext(e),n=a=>{const{children:c,...l}=a,d=w.useMemo(()=>l,Object.values(l));return g.jsx(t.Provider,{value:d,children:c})};n.displayName=r+"Provider";function s(a){const c=w.useContext(t);if(c)return c;if(e!==void 0)return e;throw new Error(`\`${a}\` must be used within \`${r}\``)}return[n,s]}function Sn(r,e=[]){let t=[];function n(a,c){const l=w.createContext(c),d=t.length;t=[...t,c];const f=m=>{const{scope:y,children:b,...S}=m,M=y?.[r]?.[d]||l,E=w.useMemo(()=>S,Object.values(S));return g.jsx(M.Provider,{value:E,children:b})};f.displayName=a+"Provider";function p(m,y){const b=y?.[r]?.[d]||l,S=w.useContext(b);if(S)return S;if(c!==void 0)return c;throw new Error(`\`${m}\` must be used within \`${a}\``)}return[f,p]}const s=()=>{const a=t.map(c=>w.createContext(c));return function(l){const d=l?.[r]||a;return w.useMemo(()=>({[`__scope${r}`]:{...l,[r]:d}}),[l,d])}};return s.scopeName=r,[n,BD(s,...e)]}function BD(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(a){const c=n.reduce((l,{useScope:d,scopeName:f})=>{const m=d(a)[`__scope${f}`];return{...l,...m}},{});return w.useMemo(()=>({[`__scope${e.scopeName}`]:c}),[c])}};return t.scopeName=e.scopeName,t}function on(r){const e=w.useRef(r);return w.useEffect(()=>{e.current=r}),w.useMemo(()=>(...t)=>e.current?.(...t),[])}var FD=w.createContext(void 0);function Ro(r){const e=w.useContext(FD);return r||e||"ltr"}function jr(r,[e,t]){return Math.min(t,Math.max(e,r))}function ge(r,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(r?.(s),t===!1||!s.defaultPrevented)return e?.(s)}}function QD(r,e){return w.useReducer((t,n)=>e[t][n]??t,r)}var Jh="ScrollArea",[jb]=Sn(Jh),[VD,Wn]=jb(Jh),Pb=w.forwardRef((r,e)=>{const{__scopeScrollArea:t,type:n="hover",dir:s,scrollHideDelay:a=600,...c}=r,[l,d]=w.useState(null),[f,p]=w.useState(null),[m,y]=w.useState(null),[b,S]=w.useState(null),[M,E]=w.useState(null),[C,T]=w.useState(0),[k,A]=w.useState(0),[_,N]=w.useState(!1),[L,q]=w.useState(!1),Z=je(e,ce=>d(ce)),se=Ro(s);return g.jsx(VD,{scope:t,type:n,dir:se,scrollHideDelay:a,scrollArea:l,viewport:f,onViewportChange:p,content:m,onContentChange:y,scrollbarX:b,onScrollbarXChange:S,scrollbarXEnabled:_,onScrollbarXEnabledChange:N,scrollbarY:M,onScrollbarYChange:E,scrollbarYEnabled:L,onScrollbarYEnabledChange:q,onCornerWidthChange:T,onCornerHeightChange:A,children:g.jsx(Ae.div,{dir:se,...c,ref:Z,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":k+"px",...r.style}})})});Pb.displayName=Jh;var zb="ScrollAreaViewport",Lb=w.forwardRef((r,e)=>{const{__scopeScrollArea:t,children:n,nonce:s,...a}=r,c=Wn(zb,t),l=w.useRef(null),d=je(e,l,c.onViewportChange);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),g.jsx(Ae.div,{"data-radix-scroll-area-viewport":"",...a,ref:d,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...r.style},children:g.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Lb.displayName=zb;var As="ScrollAreaScrollbar",Zh=w.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Wn(As,r.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:c}=s,l=r.orientation==="horizontal";return w.useEffect(()=>(l?a(!0):c(!0),()=>{l?a(!1):c(!1)}),[l,a,c]),s.type==="hover"?g.jsx(GD,{...n,ref:e,forceMount:t}):s.type==="scroll"?g.jsx(KD,{...n,ref:e,forceMount:t}):s.type==="auto"?g.jsx(Ib,{...n,ref:e,forceMount:t}):s.type==="always"?g.jsx(ep,{...n,ref:e}):null});Zh.displayName=As;var GD=w.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Wn(As,r.__scopeScrollArea),[a,c]=w.useState(!1);return w.useEffect(()=>{const l=s.scrollArea;let d=0;if(l){const f=()=>{window.clearTimeout(d),c(!0)},p=()=>{d=window.setTimeout(()=>c(!1),s.scrollHideDelay)};return l.addEventListener("pointerenter",f),l.addEventListener("pointerleave",p),()=>{window.clearTimeout(d),l.removeEventListener("pointerenter",f),l.removeEventListener("pointerleave",p)}}},[s.scrollArea,s.scrollHideDelay]),g.jsx(ln,{present:t||a,children:g.jsx(Ib,{"data-state":a?"visible":"hidden",...n,ref:e})})}),KD=w.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Wn(As,r.__scopeScrollArea),a=r.orientation==="horizontal",c=tu(()=>d("SCROLL_END"),100),[l,d]=QD("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return w.useEffect(()=>{if(l==="idle"){const f=window.setTimeout(()=>d("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(f)}},[l,s.scrollHideDelay,d]),w.useEffect(()=>{const f=s.viewport,p=a?"scrollLeft":"scrollTop";if(f){let m=f[p];const y=()=>{const b=f[p];m!==b&&(d("SCROLL"),c()),m=b};return f.addEventListener("scroll",y),()=>f.removeEventListener("scroll",y)}},[s.viewport,a,d,c]),g.jsx(ln,{present:t||l!=="hidden",children:g.jsx(ep,{"data-state":l==="hidden"?"hidden":"visible",...n,ref:e,onPointerEnter:ge(r.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:ge(r.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),Ib=w.forwardRef((r,e)=>{const t=Wn(As,r.__scopeScrollArea),{forceMount:n,...s}=r,[a,c]=w.useState(!1),l=r.orientation==="horizontal",d=tu(()=>{if(t.viewport){const f=t.viewport.offsetWidth<t.viewport.scrollWidth,p=t.viewport.offsetHeight<t.viewport.scrollHeight;c(l?f:p)}},10);return xo(t.viewport,d),xo(t.content,d),g.jsx(ln,{present:n||a,children:g.jsx(ep,{"data-state":a?"visible":"hidden",...s,ref:e})})}),ep=w.forwardRef((r,e)=>{const{orientation:t="vertical",...n}=r,s=Wn(As,r.__scopeScrollArea),a=w.useRef(null),c=w.useRef(0),[l,d]=w.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=$b(l.viewport,l.content),p={...n,sizes:l,onSizesChange:d,hasThumb:f>0&&f<1,onThumbChange:y=>a.current=y,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:y=>c.current=y};function m(y,b){return e2(y,c.current,l,b)}return t==="horizontal"?g.jsx(YD,{...p,ref:e,onThumbPositionChange:()=>{if(s.viewport&&a.current){const y=s.viewport.scrollLeft,b=cv(y,l,s.dir);a.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:y=>{s.viewport&&(s.viewport.scrollLeft=y)},onDragScroll:y=>{s.viewport&&(s.viewport.scrollLeft=m(y,s.dir))}}):t==="vertical"?g.jsx(WD,{...p,ref:e,onThumbPositionChange:()=>{if(s.viewport&&a.current){const y=s.viewport.scrollTop,b=cv(y,l);a.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:y=>{s.viewport&&(s.viewport.scrollTop=y)},onDragScroll:y=>{s.viewport&&(s.viewport.scrollTop=m(y))}}):null}),YD=w.forwardRef((r,e)=>{const{sizes:t,onSizesChange:n,...s}=r,a=Wn(As,r.__scopeScrollArea),[c,l]=w.useState(),d=w.useRef(null),f=je(e,d,a.onScrollbarXChange);return w.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),g.jsx(Hb,{"data-orientation":"horizontal",...s,ref:f,sizes:t,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":eu(t)+"px",...r.style},onThumbPointerDown:p=>r.onThumbPointerDown(p.x),onDragScroll:p=>r.onDragScroll(p.x),onWheelScroll:(p,m)=>{if(a.viewport){const y=a.viewport.scrollLeft+p.deltaX;r.onWheelScroll(y),Fb(y,m)&&p.preventDefault()}},onResize:()=>{d.current&&a.viewport&&c&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:Ul(c.paddingLeft),paddingEnd:Ul(c.paddingRight)}})}})}),WD=w.forwardRef((r,e)=>{const{sizes:t,onSizesChange:n,...s}=r,a=Wn(As,r.__scopeScrollArea),[c,l]=w.useState(),d=w.useRef(null),f=je(e,d,a.onScrollbarYChange);return w.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),g.jsx(Hb,{"data-orientation":"vertical",...s,ref:f,sizes:t,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":eu(t)+"px",...r.style},onThumbPointerDown:p=>r.onThumbPointerDown(p.y),onDragScroll:p=>r.onDragScroll(p.y),onWheelScroll:(p,m)=>{if(a.viewport){const y=a.viewport.scrollTop+p.deltaY;r.onWheelScroll(y),Fb(y,m)&&p.preventDefault()}},onResize:()=>{d.current&&a.viewport&&c&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:Ul(c.paddingTop),paddingEnd:Ul(c.paddingBottom)}})}})}),[XD,Ob]=jb(As),Hb=w.forwardRef((r,e)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:s,onThumbChange:a,onThumbPointerUp:c,onThumbPointerDown:l,onThumbPositionChange:d,onDragScroll:f,onWheelScroll:p,onResize:m,...y}=r,b=Wn(As,t),[S,M]=w.useState(null),E=je(e,Z=>M(Z)),C=w.useRef(null),T=w.useRef(""),k=b.viewport,A=n.content-n.viewport,_=on(p),N=on(d),L=tu(m,10);function q(Z){if(C.current){const se=Z.clientX-C.current.left,ce=Z.clientY-C.current.top;f({x:se,y:ce})}}return w.useEffect(()=>{const Z=se=>{const ce=se.target;S?.contains(ce)&&_(se,A)};return document.addEventListener("wheel",Z,{passive:!1}),()=>document.removeEventListener("wheel",Z,{passive:!1})},[k,S,A,_]),w.useEffect(N,[n,N]),xo(S,L),xo(b.content,L),g.jsx(XD,{scope:t,scrollbar:S,hasThumb:s,onThumbChange:on(a),onThumbPointerUp:on(c),onThumbPositionChange:N,onThumbPointerDown:on(l),children:g.jsx(Ae.div,{...y,ref:E,style:{position:"absolute",...y.style},onPointerDown:ge(r.onPointerDown,Z=>{Z.button===0&&(Z.target.setPointerCapture(Z.pointerId),C.current=S.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),q(Z))}),onPointerMove:ge(r.onPointerMove,q),onPointerUp:ge(r.onPointerUp,Z=>{const se=Z.target;se.hasPointerCapture(Z.pointerId)&&se.releasePointerCapture(Z.pointerId),document.body.style.webkitUserSelect=T.current,b.viewport&&(b.viewport.style.scrollBehavior=""),C.current=null})})})}),ql="ScrollAreaThumb",qb=w.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Ob(ql,r.__scopeScrollArea);return g.jsx(ln,{present:t||s.hasThumb,children:g.jsx(JD,{ref:e,...n})})}),JD=w.forwardRef((r,e)=>{const{__scopeScrollArea:t,style:n,...s}=r,a=Wn(ql,t),c=Ob(ql,t),{onThumbPositionChange:l}=c,d=je(e,m=>c.onThumbChange(m)),f=w.useRef(void 0),p=tu(()=>{f.current&&(f.current(),f.current=void 0)},100);return w.useEffect(()=>{const m=a.viewport;if(m){const y=()=>{if(p(),!f.current){const b=t2(m,l);f.current=b,l()}};return l(),m.addEventListener("scroll",y),()=>m.removeEventListener("scroll",y)}},[a.viewport,p,l]),g.jsx(Ae.div,{"data-state":c.hasThumb?"visible":"hidden",...s,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:ge(r.onPointerDownCapture,m=>{const b=m.target.getBoundingClientRect(),S=m.clientX-b.left,M=m.clientY-b.top;c.onThumbPointerDown({x:S,y:M})}),onPointerUp:ge(r.onPointerUp,c.onThumbPointerUp)})});qb.displayName=ql;var tp="ScrollAreaCorner",Ub=w.forwardRef((r,e)=>{const t=Wn(tp,r.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?g.jsx(ZD,{...r,ref:e}):null});Ub.displayName=tp;var ZD=w.forwardRef((r,e)=>{const{__scopeScrollArea:t,...n}=r,s=Wn(tp,t),[a,c]=w.useState(0),[l,d]=w.useState(0),f=!!(a&&l);return xo(s.scrollbarX,()=>{const p=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(p),d(p)}),xo(s.scrollbarY,()=>{const p=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(p),c(p)}),f?g.jsx(Ae.div,{...n,ref:e,style:{width:a,height:l,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function Ul(r){return r?parseInt(r,10):0}function $b(r,e){const t=r/e;return isNaN(t)?0:t}function eu(r){const e=$b(r.viewport,r.content),t=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-t)*e;return Math.max(n,18)}function e2(r,e,t,n="ltr"){const s=eu(t),a=s/2,c=e||a,l=s-c,d=t.scrollbar.paddingStart+c,f=t.scrollbar.size-t.scrollbar.paddingEnd-l,p=t.content-t.viewport,m=n==="ltr"?[0,p]:[p*-1,0];return Bb([d,f],m)(r)}function cv(r,e,t="ltr"){const n=eu(e),s=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=e.scrollbar.size-s,c=e.content-e.viewport,l=a-n,d=t==="ltr"?[0,c]:[c*-1,0],f=jr(r,d);return Bb([0,c],[0,l])(f)}function Bb(r,e){return t=>{if(r[0]===r[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(r[1]-r[0]);return e[0]+n*(t-r[0])}}function Fb(r,e){return r>0&&r<e}var t2=(r,e=()=>{})=>{let t={left:r.scrollLeft,top:r.scrollTop},n=0;return(function s(){const a={left:r.scrollLeft,top:r.scrollTop},c=t.left!==a.left,l=t.top!==a.top;(c||l)&&e(),t=a,n=window.requestAnimationFrame(s)})(),()=>window.cancelAnimationFrame(n)};function tu(r,e){const t=on(r),n=w.useRef(0);return w.useEffect(()=>()=>window.clearTimeout(n.current),[]),w.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,e)},[t,e])}function xo(r,e){const t=on(e);rn(()=>{let n=0;if(r){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return s.observe(r),()=>{window.cancelAnimationFrame(n),s.unobserve(r)}}},[r,t])}var Qb=Pb,n2=Lb,s2=Ub;const an=w.forwardRef(({className:r,children:e,...t},n)=>g.jsxs(Qb,{ref:n,className:Re("relative overflow-hidden",r),scrollHideDelay:0,...t,children:[g.jsx(n2,{className:"h-full w-full rounded-[inherit]",children:e}),g.jsx(nu,{}),g.jsx(s2,{})]}));an.displayName=Qb.displayName;const nu=w.forwardRef(({className:r,orientation:e="vertical",...t},n)=>g.jsx(Zh,{ref:n,orientation:e,className:Re("flex touch-none select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]","data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30","[&[data-state=hidden]]:opacity-0 [&[data-state=visible]]:opacity-100",r),style:{transition:"none !important",transitionDelay:"0ms !important",transitionDuration:"0ms !important"},...t,children:g.jsx(qb,{className:"relative flex-1 rounded-full bg-accent/80 hover:bg-accent",style:{transition:"none !important"}})}));nu.displayName=Zh.displayName;const $r=us(r=>({showMinimap:!0,setShowMinimap:e=>r({showMinimap:e}),toggleMinimap:()=>r(e=>({showMinimap:!e.showMinimap})),showHeatMapLegend:!0,setShowHeatMapLegend:e=>r({showHeatMapLegend:e}),toggleHeatMapLegend:()=>r(e=>({showHeatMapLegend:!e.showHeatMapLegend})),showRuler:!1,setShowRuler:e=>r({showRuler:e}),toggleRuler:()=>r(e=>({showRuler:!e.showRuler})),autoCenterOnSelect:!0,setAutoCenterOnSelect:e=>r({autoCenterOnSelect:e}),searchQuery:"",setSearchQuery:e=>r({searchQuery:e}),highlightedNodeId:null,setHighlightedNodeId:e=>r({highlightedNodeId:e})})),Pr=[{id:"kafka",type:"kafka",label:"Apache Kafka",icon:"",color:"#000000",category:"messaging"},{id:"rabbitmq",type:"rabbitmq",label:"RabbitMQ",icon:"",color:"#FF6600",category:"messaging"},{id:"activemq",type:"activemq",label:"ActiveMQ",icon:"",color:"#A1005A",category:"messaging"},{id:"aws-sqs",type:"aws-sqs",label:"AWS SQS",icon:"",color:"#FF9900",category:"messaging"},{id:"azure-service-bus",type:"azure-service-bus",label:"Azure Service Bus",icon:"",color:"#0078D7",category:"messaging"},{id:"gcp-pubsub",type:"gcp-pubsub",label:"Google Pub/Sub",icon:"",color:"#4285F4",category:"messaging"},{id:"kong",type:"kong",label:"Kong Gateway",icon:"",color:"#003459",category:"integration"},{id:"apigee",type:"apigee",label:"Apigee",icon:"",color:"#F26522",category:"integration"},{id:"mulesoft",type:"mulesoft",label:"MuleSoft",icon:"",color:"#00A0DF",category:"integration"},{id:"graphql-gateway",type:"graphql-gateway",label:"GraphQL Gateway",icon:"",color:"#E10098",category:"integration"},{id:"bff-service",type:"bff-service",label:"BFF Service",icon:"",color:"#6C5CE7",category:"integration"},{id:"webhook-relay",type:"webhook-relay",label:"Webhook Relay",icon:"",color:"#1ABC9C",category:"integration"},{id:"postgres",type:"postgres",label:"PostgreSQL",icon:"",color:"#336791",category:"data"},{id:"mongodb",type:"mongodb",label:"MongoDB",icon:"",color:"#47A248",category:"data"},{id:"redis",type:"redis",label:"Redis",icon:"",color:"#DC382D",category:"data"},{id:"cassandra",type:"cassandra",label:"Apache Cassandra",icon:"",color:"#1287B1",category:"data"},{id:"clickhouse",type:"clickhouse",label:"ClickHouse",icon:"",color:"#FFCC00",category:"data"},{id:"snowflake",type:"snowflake",label:"Snowflake",icon:"",color:"#29B5E8",category:"data"},{id:"elasticsearch",type:"elasticsearch",label:"Elasticsearch",icon:"",color:"#00A79D",category:"data"},{id:"s3-datalake",type:"s3-datalake",label:"S3 Data Lake",icon:"",color:"#FF9900",category:"data"},{id:"prometheus",type:"prometheus",label:"Prometheus",icon:"",color:"#E6522C",category:"observability"},{id:"grafana",type:"grafana",label:"Grafana",icon:"",color:"#F56815",category:"observability"},{id:"loki",type:"loki",label:"Loki",icon:"",color:"#7CBA3C",category:"observability"},{id:"jaeger",type:"jaeger",label:"Jaeger",icon:"",color:"#65D6AD",category:"observability"},{id:"otel-collector",type:"otel-collector",label:"OpenTelemetry Collector",icon:"",color:"#6E56CF",category:"observability"},{id:"pagerduty",type:"pagerduty",label:"PagerDuty",icon:"",color:"#06AC38",category:"observability"},{id:"keycloak",type:"keycloak",label:"Keycloak",icon:"",color:"#5C6BC0",category:"security"},{id:"waf",type:"waf",label:"WAF / API Shield",icon:"",color:"#F44336",category:"security"},{id:"firewall",type:"firewall",label:"Firewall",icon:"",color:"#FF7043",category:"security"},{id:"secrets-vault",type:"secrets-vault",label:"Secrets Vault",icon:"",color:"#009688",category:"security"},{id:"ids-ips",type:"ids-ips",label:"IDS / IPS",icon:"",color:"#512DA8",category:"security"},{id:"jenkins",type:"jenkins",label:"Jenkins",icon:"",color:"#D24939",category:"devops"},{id:"gitlab-ci",type:"gitlab-ci",label:"GitLab CI",icon:"",color:"#FC6D26",category:"devops"},{id:"argo-cd",type:"argo-cd",label:"Argo CD",icon:"",color:"#EF7B45",category:"devops"},{id:"terraform",type:"terraform",label:"Terraform",icon:"",color:"#7B42BC",category:"devops"},{id:"ansible",type:"ansible",label:"Ansible",icon:"",color:"#000000",category:"devops"},{id:"harbor",type:"harbor",label:"Harbor Registry",icon:"",color:"#3BC1C4",category:"devops"},{id:"nginx",type:"nginx",label:"NGINX",icon:"",color:"#009639",category:"infrastructure"},{id:"docker",type:"docker",label:"Docker",icon:"",color:"#2496ED",category:"infrastructure"},{id:"kubernetes",type:"kubernetes",label:"Kubernetes",icon:"",color:"#326CE5",category:"infrastructure"},{id:"haproxy",type:"haproxy",label:"HAProxy",icon:"",color:"#009FDF",category:"infrastructure"},{id:"envoy",type:"envoy",label:"Envoy Proxy",icon:"",color:"#D63384",category:"infrastructure"},{id:"traefik",type:"traefik",label:"Traefik",icon:"",color:"#24A1DE",category:"infrastructure"},{id:"istio",type:"istio",label:"Istio Mesh",icon:"",color:"#466BB0",category:"edge"},{id:"service-mesh",type:"service-mesh",label:"Service Mesh",icon:"",color:"#5E81AC",category:"edge"},{id:"api-gateway",type:"api-gateway",label:"Cloud API Gateway",icon:"",color:"#FFB300",category:"edge"},{id:"vpn",type:"vpn",label:"VPN Concentrator",icon:"",color:"#2D9CDB",category:"edge"},{id:"cdn",type:"cdn",label:"CDN Edge",icon:"",color:"#FF5A5F",category:"edge"},{id:"rest",type:"rest",label:"REST API",icon:"",color:"#61DAFB",category:"api"},{id:"grpc",type:"grpc",label:"gRPC",icon:"",color:"#244C5A",category:"api"},{id:"graphql",type:"graphql",label:"GraphQL",icon:"",color:"#DE33A6",category:"api"},{id:"soap",type:"soap",label:"SOAP",icon:"",color:"#2196F3",category:"api"},{id:"websocket",type:"websocket",label:"WebSocket",icon:"",color:"#010101",category:"api"},{id:"webhook",type:"webhook",label:"Webhook Endpoint",icon:"",color:"#0FA3B1",category:"api"},{id:"spark",type:"spark",label:"Apache Spark",icon:"",color:"#E25A1C",category:"ml"},{id:"tensorflow-serving",type:"tensorflow-serving",label:"TensorFlow Serving",icon:"",color:"#FF6F00",category:"ml"},{id:"pytorch-serve",type:"pytorch-serve",label:"PyTorch Serve",icon:"",color:"#EE4C2C",category:"ml"},{id:"mlflow",type:"mlflow",label:"MLflow",icon:"",color:"#4285F4",category:"ml"},{id:"feature-store",type:"feature-store",label:"Feature Store",icon:"",color:"#8E44AD",category:"ml"},{id:"crm",type:"crm",label:"CRM System",icon:"",color:"#F39C12",category:"business"},{id:"erp",type:"erp",label:"ERP / SAP",icon:"",color:"#1B75BC",category:"business"},{id:"payment-gateway",type:"payment-gateway",label:"Payment Gateway",icon:"",color:"#4CAF50",category:"business"},{id:"bpmn-engine",type:"bpmn-engine",label:"BPMN Engine",icon:"",color:"#34495E",category:"business"},{id:"rpa-bot",type:"rpa-bot",label:"RPA Bot",icon:"",color:"#9B59B6",category:"business"}],Cr=[{id:"messaging",label:"Messaging & Event Bus",icon:""},{id:"integration",label:"Integration & API",icon:""},{id:"data",label:"Data & Storage",icon:""},{id:"observability",label:"Observability",icon:""},{id:"security",label:"Security & IAM",icon:""},{id:"devops",label:"DevOps & Platform",icon:""},{id:"infrastructure",label:"Runtime & Infra",icon:""},{id:"edge",label:"Edge & Networking",icon:""},{id:"api",label:"Protocols & APIs",icon:""},{id:"ml",label:"ML & Analytics",icon:""},{id:"business",label:"Business Systems",icon:""}];function i2(){const{nodes:r,selectNode:e,zoom:t,pan:n,setPan:s,setZoom:a}=Ee(),{searchQuery:c,setSearchQuery:l,highlightedNodeId:d,setHighlightedNodeId:f}=$r(),[p,m]=w.useState(!1),y=w.useRef(null);w.useEffect(()=>{const M=E=>{y.current&&!y.current.contains(E.target)&&m(!1)};return document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[]);const b=w.useMemo(()=>{if(!c.trim())return[];const M=c.toLowerCase();return r.filter(E=>{const C=Pr.find(_=>_.type===E.type),T=E.data?.label||"",k=E.type||"",A=C?.category||"";return T.toLowerCase().includes(M)||k.toLowerCase().includes(M)||A.toLowerCase().includes(M)})},[r,c]),S=M=>{e(M),f(M);const E=r.find(C=>C.id===M);if(E&&p){const C=window.innerWidth/2,T=window.innerHeight/2,k=E.position.x+70,A=E.position.y+70,_=C-k*t,N=T-A*t;s({x:_,y:N}),t<.8&&a(1)}setTimeout(()=>f(null),2e3)};return g.jsxs("div",{className:"relative",ref:y,children:[g.jsxs("div",{className:"relative",children:[g.jsx(Ur,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),g.jsx(Tt,{type:"text",placeholder:"Search components...",value:c,onChange:M=>{l(M.target.value),m(!0)},onFocus:()=>m(!0),className:"pl-8 pr-8 w-64"}),c&&g.jsx(ke,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>{l(""),m(!1),f(null)},children:g.jsx(os,{className:"h-3 w-3"})})]}),p&&c&&g.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-card border border-border rounded-md shadow-lg z-50 max-h-80 overflow-hidden",children:b.length>0?g.jsx(an,{className:"max-h-80",children:g.jsx("div",{className:"p-1",children:b.map(M=>{const E=Pr.find(T=>T.type===M.type),C=d===M.id;return g.jsxs("button",{onClick:()=>S(M.id),className:Re("w-full text-left px-3 py-2 rounded-sm hover:bg-accent transition-colors flex items-center justify-between",C&&"bg-accent"),children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:M.data?.label||M.type}),g.jsxs("div",{className:"text-xs text-muted-foreground truncate",children:[E?.category||"Unknown","  ",M.type]})]}),g.jsx(Wh,{className:"h-4 w-4 text-muted-foreground flex-shrink-0 ml-2"})]},M.id)})})}):g.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No components found"})})]})}function a2(r){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.appendChild(t),t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r))}Array(12).fill(0);let wh=1;class o2{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;const{message:n,...s}=e,a=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:wh++,c=this.toasts.find(d=>d.id===a),l=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),c?this.toasts=this.toasts.map(d=>d.id===a?(this.publish({...d,...e,id:a,title:n}),{...d,...e,id:a,dismissible:l,title:n}):d):this.addToast({title:n,...s,dismissible:l,id:a}),a},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(t=>t({id:e,dismiss:!0})))):this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));const s=Promise.resolve(e instanceof Function?e():e);let a=n!==void 0,c;const l=s.then(async f=>{if(c=["resolve",f],kt.isValidElement(f))a=!1,this.create({id:n,type:"default",message:f});else if(c2(f)&&!f.ok){a=!1;const m=typeof t.error=="function"?await t.error(`HTTP error! status: ${f.status}`):t.error,y=typeof t.description=="function"?await t.description(`HTTP error! status: ${f.status}`):t.description,S=typeof m=="object"&&!kt.isValidElement(m)?m:{message:m};this.create({id:n,type:"error",description:y,...S})}else if(f instanceof Error){a=!1;const m=typeof t.error=="function"?await t.error(f):t.error,y=typeof t.description=="function"?await t.description(f):t.description,S=typeof m=="object"&&!kt.isValidElement(m)?m:{message:m};this.create({id:n,type:"error",description:y,...S})}else if(t.success!==void 0){a=!1;const m=typeof t.success=="function"?await t.success(f):t.success,y=typeof t.description=="function"?await t.description(f):t.description,S=typeof m=="object"&&!kt.isValidElement(m)?m:{message:m};this.create({id:n,type:"success",description:y,...S})}}).catch(async f=>{if(c=["reject",f],t.error!==void 0){a=!1;const p=typeof t.error=="function"?await t.error(f):t.error,m=typeof t.description=="function"?await t.description(f):t.description,b=typeof p=="object"&&!kt.isValidElement(p)?p:{message:p};this.create({id:n,type:"error",description:m,...b})}}).finally(()=>{a&&(this.dismiss(n),n=void 0),t.finally==null||t.finally.call(t)}),d=()=>new Promise((f,p)=>l.then(()=>c[0]==="reject"?p(c[1]):f(c[1])).catch(p));return typeof n!="string"&&typeof n!="number"?{unwrap:d}:Object.assign(n,{unwrap:d})},this.custom=(e,t)=>{const n=t?.id||wh++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Gn=new o2,r2=(r,e)=>{const t=e?.id||wh++;return Gn.addToast({title:r,...e,id:t}),t},c2=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",l2=r2,u2=()=>Gn.toasts,d2=()=>Gn.getActiveToasts(),Ye=Object.assign(l2,{success:Gn.success,info:Gn.info,warning:Gn.warning,error:Gn.error,custom:Gn.custom,message:Gn.message,promise:Gn.promise,dismiss:Gn.dismiss,loading:Gn.loading},{getHistory:u2,getToasts:d2});a2("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");var f2=Uh[" useId ".trim().toString()]||(()=>{}),h2=0;function rs(r){const[e,t]=w.useState(f2());return rn(()=>{t(n=>n??String(h2++))},[r]),e?`radix-${e}`:""}var p2=Uh[" useInsertionEffect ".trim().toString()]||rn;function Rs({prop:r,defaultProp:e,onChange:t=()=>{},caller:n}){const[s,a,c]=g2({defaultProp:e,onChange:t}),l=r!==void 0,d=l?r:s;{const p=w.useRef(r!==void 0);w.useEffect(()=>{const m=p.current;m!==l&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=l},[l,n])}const f=w.useCallback(p=>{if(l){const m=m2(p)?p(r):p;m!==r&&c.current?.(m)}else a(p)},[l,r,a,c]);return[d,f]}function g2({defaultProp:r,onChange:e}){const[t,n]=w.useState(r),s=w.useRef(t),a=w.useRef(e);return p2(()=>{a.current=e},[e]),w.useEffect(()=>{s.current!==t&&(a.current?.(t),s.current=t)},[t,s]),[t,n,a]}function m2(r){return typeof r=="function"}function y2(r,e=globalThis?.document){const t=on(r);w.useEffect(()=>{const n=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var v2="DismissableLayer",Sh="dismissableLayer.update",b2="dismissableLayer.pointerDownOutside",x2="dismissableLayer.focusOutside",lv,Vb=w.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Br=w.forwardRef((r,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:a,onInteractOutside:c,onDismiss:l,...d}=r,f=w.useContext(Vb),[p,m]=w.useState(null),y=p?.ownerDocument??globalThis?.document,[,b]=w.useState({}),S=je(e,L=>m(L)),M=Array.from(f.layers),[E]=[...f.layersWithOutsidePointerEventsDisabled].slice(-1),C=M.indexOf(E),T=p?M.indexOf(p):-1,k=f.layersWithOutsidePointerEventsDisabled.size>0,A=T>=C,_=M2(L=>{const q=L.target,Z=[...f.branches].some(se=>se.contains(q));!A||Z||(s?.(L),c?.(L),L.defaultPrevented||l?.())},y),N=C2(L=>{const q=L.target;[...f.branches].some(se=>se.contains(q))||(a?.(L),c?.(L),L.defaultPrevented||l?.())},y);return y2(L=>{T===f.layers.size-1&&(n?.(L),!L.defaultPrevented&&l&&(L.preventDefault(),l()))},y),w.useEffect(()=>{if(p)return t&&(f.layersWithOutsidePointerEventsDisabled.size===0&&(lv=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),f.layersWithOutsidePointerEventsDisabled.add(p)),f.layers.add(p),uv(),()=>{t&&f.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=lv)}},[p,y,t,f]),w.useEffect(()=>()=>{p&&(f.layers.delete(p),f.layersWithOutsidePointerEventsDisabled.delete(p),uv())},[p,f]),w.useEffect(()=>{const L=()=>b({});return document.addEventListener(Sh,L),()=>document.removeEventListener(Sh,L)},[]),g.jsx(Ae.div,{...d,ref:S,style:{pointerEvents:k?A?"auto":"none":void 0,...r.style},onFocusCapture:ge(r.onFocusCapture,N.onFocusCapture),onBlurCapture:ge(r.onBlurCapture,N.onBlurCapture),onPointerDownCapture:ge(r.onPointerDownCapture,_.onPointerDownCapture)})});Br.displayName=v2;var w2="DismissableLayerBranch",S2=w.forwardRef((r,e)=>{const t=w.useContext(Vb),n=w.useRef(null),s=je(e,n);return w.useEffect(()=>{const a=n.current;if(a)return t.branches.add(a),()=>{t.branches.delete(a)}},[t.branches]),g.jsx(Ae.div,{...r,ref:s})});S2.displayName=w2;function M2(r,e=globalThis?.document){const t=on(r),n=w.useRef(!1),s=w.useRef(()=>{});return w.useEffect(()=>{const a=l=>{if(l.target&&!n.current){let d=function(){Gb(b2,t,f,{discrete:!0})};const f={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=d,e.addEventListener("click",s.current,{once:!0})):d()}else e.removeEventListener("click",s.current);n.current=!1},c=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(c),e.removeEventListener("pointerdown",a),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function C2(r,e=globalThis?.document){const t=on(r),n=w.useRef(!1);return w.useEffect(()=>{const s=a=>{a.target&&!n.current&&Gb(x2,t,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function uv(){const r=new CustomEvent(Sh);document.dispatchEvent(r)}function Gb(r,e,t,{discrete:n}){const s=t.originalEvent.target,a=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?Nb(s,a):s.dispatchEvent(a)}var ah="focusScope.autoFocusOnMount",oh="focusScope.autoFocusOnUnmount",dv={bubbles:!1,cancelable:!0},E2="FocusScope",Fr=w.forwardRef((r,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:a,...c}=r,[l,d]=w.useState(null),f=on(s),p=on(a),m=w.useRef(null),y=je(e,M=>d(M)),b=w.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;w.useEffect(()=>{if(n){let M=function(k){if(b.paused||!l)return;const A=k.target;l.contains(A)?m.current=A:ji(m.current,{select:!0})},E=function(k){if(b.paused||!l)return;const A=k.relatedTarget;A!==null&&(l.contains(A)||ji(m.current,{select:!0}))},C=function(k){if(document.activeElement===document.body)for(const _ of k)_.removedNodes.length>0&&ji(l)};document.addEventListener("focusin",M),document.addEventListener("focusout",E);const T=new MutationObserver(C);return l&&T.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",M),document.removeEventListener("focusout",E),T.disconnect()}}},[n,l,b.paused]),w.useEffect(()=>{if(l){hv.add(b);const M=document.activeElement;if(!l.contains(M)){const C=new CustomEvent(ah,dv);l.addEventListener(ah,f),l.dispatchEvent(C),C.defaultPrevented||(R2(_2(Kb(l)),{select:!0}),document.activeElement===M&&ji(l))}return()=>{l.removeEventListener(ah,f),setTimeout(()=>{const C=new CustomEvent(oh,dv);l.addEventListener(oh,p),l.dispatchEvent(C),C.defaultPrevented||ji(M??document.body,{select:!0}),l.removeEventListener(oh,p),hv.remove(b)},0)}}},[l,f,p,b]);const S=w.useCallback(M=>{if(!t&&!n||b.paused)return;const E=M.key==="Tab"&&!M.altKey&&!M.ctrlKey&&!M.metaKey,C=document.activeElement;if(E&&C){const T=M.currentTarget,[k,A]=k2(T);k&&A?!M.shiftKey&&C===A?(M.preventDefault(),t&&ji(k,{select:!0})):M.shiftKey&&C===k&&(M.preventDefault(),t&&ji(A,{select:!0})):C===T&&M.preventDefault()}},[t,n,b.paused]);return g.jsx(Ae.div,{tabIndex:-1,...c,ref:y,onKeyDown:S})});Fr.displayName=E2;function R2(r,{select:e=!1}={}){const t=document.activeElement;for(const n of r)if(ji(n,{select:e}),document.activeElement!==t)return}function k2(r){const e=Kb(r),t=fv(e,r),n=fv(e.reverse(),r);return[t,n]}function Kb(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function fv(r,e){for(const t of r)if(!T2(t,{upTo:e}))return t}function T2(r,{upTo:e}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function A2(r){return r instanceof HTMLInputElement&&"select"in r}function ji(r,{select:e=!1}={}){if(r&&r.focus){const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&A2(r)&&e&&r.select()}}var hv=D2();function D2(){let r=[];return{add(e){const t=r[0];e!==t&&t?.pause(),r=pv(r,e),r.unshift(e)},remove(e){r=pv(r,e),r[0]?.resume()}}}function pv(r,e){const t=[...r],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function _2(r){return r.filter(e=>e.tagName!=="A")}var N2="Portal",Qr=w.forwardRef((r,e)=>{const{container:t,...n}=r,[s,a]=w.useState(!1);rn(()=>a(!0),[]);const c=t||s&&globalThis?.document?.body;return c?dk.createPortal(g.jsx(Ae.div,{...n,ref:e}),c):null});Qr.displayName=N2;var rh=0;function su(){w.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??gv()),document.body.insertAdjacentElement("beforeend",r[1]??gv()),rh++,()=>{rh===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),rh--}},[])}function gv(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var vs=function(){return vs=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},vs.apply(this,arguments)};function Yb(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function j2(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,a;n<s;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return r.concat(a||Array.prototype.slice.call(e))}var Tl="right-scroll-bar-position",Al="width-before-scroll-bar",P2="with-scroll-bars-hidden",z2="--removed-body-scroll-bar-size";function ch(r,e){return typeof r=="function"?r(e):r&&(r.current=e),r}function L2(r,e){var t=w.useState(function(){return{value:r,callback:e,facade:{get current(){return t.value},set current(n){var s=t.value;s!==n&&(t.value=n,t.callback(n,s))}}}})[0];return t.callback=e,t.facade}var I2=typeof window<"u"?w.useLayoutEffect:w.useEffect,mv=new WeakMap;function O2(r,e){var t=L2(null,function(n){return r.forEach(function(s){return ch(s,n)})});return I2(function(){var n=mv.get(t);if(n){var s=new Set(n),a=new Set(r),c=t.current;s.forEach(function(l){a.has(l)||ch(l,null)}),a.forEach(function(l){s.has(l)||ch(l,c)})}mv.set(t,r)},[r]),t}function H2(r){return r}function q2(r,e){e===void 0&&(e=H2);var t=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:r},useMedium:function(a){var c=e(a,n);return t.push(c),function(){t=t.filter(function(l){return l!==c})}},assignSyncMedium:function(a){for(n=!0;t.length;){var c=t;t=[],c.forEach(a)}t={push:function(l){return a(l)},filter:function(){return t}}},assignMedium:function(a){n=!0;var c=[];if(t.length){var l=t;t=[],l.forEach(a),c=t}var d=function(){var p=c;c=[],p.forEach(a)},f=function(){return Promise.resolve().then(d)};f(),t={push:function(p){c.push(p),f()},filter:function(p){return c=c.filter(p),t}}}};return s}function U2(r){r===void 0&&(r={});var e=q2(null);return e.options=vs({async:!0,ssr:!1},r),e}var Wb=function(r){var e=r.sideCar,t=Yb(r,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return w.createElement(n,vs({},t))};Wb.isSideCarExport=!0;function $2(r,e){return r.useMedium(e),Wb}var Xb=U2(),lh=function(){},iu=w.forwardRef(function(r,e){var t=w.useRef(null),n=w.useState({onScrollCapture:lh,onWheelCapture:lh,onTouchMoveCapture:lh}),s=n[0],a=n[1],c=r.forwardProps,l=r.children,d=r.className,f=r.removeScrollBar,p=r.enabled,m=r.shards,y=r.sideCar,b=r.noRelative,S=r.noIsolation,M=r.inert,E=r.allowPinchZoom,C=r.as,T=C===void 0?"div":C,k=r.gapMode,A=Yb(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=y,N=O2([t,e]),L=vs(vs({},A),s);return w.createElement(w.Fragment,null,p&&w.createElement(_,{sideCar:Xb,removeScrollBar:f,shards:m,noRelative:b,noIsolation:S,inert:M,setCallbacks:a,allowPinchZoom:!!E,lockRef:t,gapMode:k}),c?w.cloneElement(w.Children.only(l),vs(vs({},L),{ref:N})):w.createElement(T,vs({},L,{className:d,ref:N}),l))});iu.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};iu.classNames={fullWidth:Al,zeroRight:Tl};var B2=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function F2(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var e=B2();return e&&r.setAttribute("nonce",e),r}function Q2(r,e){r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}function V2(r){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(r)}var G2=function(){var r=0,e=null;return{add:function(t){r==0&&(e=F2())&&(Q2(e,t),V2(e)),r++},remove:function(){r--,!r&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},K2=function(){var r=G2();return function(e,t){w.useEffect(function(){return r.add(e),function(){r.remove()}},[e&&t])}},Jb=function(){var r=K2(),e=function(t){var n=t.styles,s=t.dynamic;return r(n,s),null};return e},Y2={left:0,top:0,right:0,gap:0},uh=function(r){return parseInt(r||"",10)||0},W2=function(r){var e=window.getComputedStyle(document.body),t=e[r==="padding"?"paddingLeft":"marginLeft"],n=e[r==="padding"?"paddingTop":"marginTop"],s=e[r==="padding"?"paddingRight":"marginRight"];return[uh(t),uh(n),uh(s)]},X2=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return Y2;var e=W2(r),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},J2=Jb(),yo="data-scroll-locked",Z2=function(r,e,t,n){var s=r.left,a=r.top,c=r.right,l=r.gap;return t===void 0&&(t="margin"),`
  .`.concat(P2,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(l,"px ").concat(n,`;
  }
  body[`).concat(yo,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(a,`px;
    padding-right: `).concat(c,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(l,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Tl,` {
    right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(Al,` {
    margin-right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(Tl," .").concat(Tl,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Al," .").concat(Al,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(yo,`] {
    `).concat(z2,": ").concat(l,`px;
  }
`)},yv=function(){var r=parseInt(document.body.getAttribute(yo)||"0",10);return isFinite(r)?r:0},e_=function(){w.useEffect(function(){return document.body.setAttribute(yo,(yv()+1).toString()),function(){var r=yv()-1;r<=0?document.body.removeAttribute(yo):document.body.setAttribute(yo,r.toString())}},[])},t_=function(r){var e=r.noRelative,t=r.noImportant,n=r.gapMode,s=n===void 0?"margin":n;e_();var a=w.useMemo(function(){return X2(s)},[s]);return w.createElement(J2,{styles:Z2(a,!e,s,t?"":"!important")})},Mh=!1;if(typeof window<"u")try{var ml=Object.defineProperty({},"passive",{get:function(){return Mh=!0,!0}});window.addEventListener("test",ml,ml),window.removeEventListener("test",ml,ml)}catch{Mh=!1}var fo=Mh?{passive:!1}:!1,n_=function(r){return r.tagName==="TEXTAREA"},Zb=function(r,e){if(!(r instanceof Element))return!1;var t=window.getComputedStyle(r);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!n_(r)&&t[e]==="visible")},s_=function(r){return Zb(r,"overflowY")},i_=function(r){return Zb(r,"overflowX")},vv=function(r,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=ex(r,n);if(s){var a=tx(r,n),c=a[1],l=a[2];if(c>l)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},a_=function(r){var e=r.scrollTop,t=r.scrollHeight,n=r.clientHeight;return[e,t,n]},o_=function(r){var e=r.scrollLeft,t=r.scrollWidth,n=r.clientWidth;return[e,t,n]},ex=function(r,e){return r==="v"?s_(e):i_(e)},tx=function(r,e){return r==="v"?a_(e):o_(e)},r_=function(r,e){return r==="h"&&e==="rtl"?-1:1},c_=function(r,e,t,n,s){var a=r_(r,window.getComputedStyle(e).direction),c=a*n,l=t.target,d=e.contains(l),f=!1,p=c>0,m=0,y=0;do{if(!l)break;var b=tx(r,l),S=b[0],M=b[1],E=b[2],C=M-E-a*S;(S||C)&&ex(r,l)&&(m+=C,y+=S);var T=l.parentNode;l=T&&T.nodeType===Node.DOCUMENT_FRAGMENT_NODE?T.host:T}while(!d&&l!==document.body||d&&(e.contains(l)||e===l));return(p&&Math.abs(m)<1||!p&&Math.abs(y)<1)&&(f=!0),f},yl=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},bv=function(r){return[r.deltaX,r.deltaY]},xv=function(r){return r&&"current"in r?r.current:r},l_=function(r,e){return r[0]===e[0]&&r[1]===e[1]},u_=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},d_=0,ho=[];function f_(r){var e=w.useRef([]),t=w.useRef([0,0]),n=w.useRef(),s=w.useState(d_++)[0],a=w.useState(Jb)[0],c=w.useRef(r);w.useEffect(function(){c.current=r},[r]),w.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(s));var M=j2([r.lockRef.current],(r.shards||[]).map(xv),!0).filter(Boolean);return M.forEach(function(E){return E.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),M.forEach(function(E){return E.classList.remove("allow-interactivity-".concat(s))})}}},[r.inert,r.lockRef.current,r.shards]);var l=w.useCallback(function(M,E){if("touches"in M&&M.touches.length===2||M.type==="wheel"&&M.ctrlKey)return!c.current.allowPinchZoom;var C=yl(M),T=t.current,k="deltaX"in M?M.deltaX:T[0]-C[0],A="deltaY"in M?M.deltaY:T[1]-C[1],_,N=M.target,L=Math.abs(k)>Math.abs(A)?"h":"v";if("touches"in M&&L==="h"&&N.type==="range")return!1;var q=vv(L,N);if(!q)return!0;if(q?_=L:(_=L==="v"?"h":"v",q=vv(L,N)),!q)return!1;if(!n.current&&"changedTouches"in M&&(k||A)&&(n.current=_),!_)return!0;var Z=n.current||_;return c_(Z,E,M,Z==="h"?k:A)},[]),d=w.useCallback(function(M){var E=M;if(!(!ho.length||ho[ho.length-1]!==a)){var C="deltaY"in E?bv(E):yl(E),T=e.current.filter(function(_){return _.name===E.type&&(_.target===E.target||E.target===_.shadowParent)&&l_(_.delta,C)})[0];if(T&&T.should){E.cancelable&&E.preventDefault();return}if(!T){var k=(c.current.shards||[]).map(xv).filter(Boolean).filter(function(_){return _.contains(E.target)}),A=k.length>0?l(E,k[0]):!c.current.noIsolation;A&&E.cancelable&&E.preventDefault()}}},[]),f=w.useCallback(function(M,E,C,T){var k={name:M,delta:E,target:C,should:T,shadowParent:h_(C)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(A){return A!==k})},1)},[]),p=w.useCallback(function(M){t.current=yl(M),n.current=void 0},[]),m=w.useCallback(function(M){f(M.type,bv(M),M.target,l(M,r.lockRef.current))},[]),y=w.useCallback(function(M){f(M.type,yl(M),M.target,l(M,r.lockRef.current))},[]);w.useEffect(function(){return ho.push(a),r.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:y}),document.addEventListener("wheel",d,fo),document.addEventListener("touchmove",d,fo),document.addEventListener("touchstart",p,fo),function(){ho=ho.filter(function(M){return M!==a}),document.removeEventListener("wheel",d,fo),document.removeEventListener("touchmove",d,fo),document.removeEventListener("touchstart",p,fo)}},[]);var b=r.removeScrollBar,S=r.inert;return w.createElement(w.Fragment,null,S?w.createElement(a,{styles:u_(s)}):null,b?w.createElement(t_,{noRelative:r.noRelative,gapMode:r.gapMode}):null)}function h_(r){for(var e=null;r!==null;)r instanceof ShadowRoot&&(e=r.host,r=r.host),r=r.parentNode;return e}const p_=$2(Xb,f_);var Vr=w.forwardRef(function(r,e){return w.createElement(iu,vs({},r,{ref:e,sideCar:p_}))});Vr.classNames=iu.classNames;var g_=function(r){if(typeof document>"u")return null;var e=Array.isArray(r)?r[0]:r;return e.ownerDocument.body},po=new WeakMap,vl=new WeakMap,bl={},dh=0,nx=function(r){return r&&(r.host||nx(r.parentNode))},m_=function(r,e){return e.map(function(t){if(r.contains(t))return t;var n=nx(t);return n&&r.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",r,". Doing nothing"),null)}).filter(function(t){return!!t})},y_=function(r,e,t,n){var s=m_(e,Array.isArray(r)?r:[r]);bl[t]||(bl[t]=new WeakMap);var a=bl[t],c=[],l=new Set,d=new Set(s),f=function(m){!m||l.has(m)||(l.add(m),f(m.parentNode))};s.forEach(f);var p=function(m){!m||d.has(m)||Array.prototype.forEach.call(m.children,function(y){if(l.has(y))p(y);else try{var b=y.getAttribute(n),S=b!==null&&b!=="false",M=(po.get(y)||0)+1,E=(a.get(y)||0)+1;po.set(y,M),a.set(y,E),c.push(y),M===1&&S&&vl.set(y,!0),E===1&&y.setAttribute(t,"true"),S||y.setAttribute(n,"true")}catch(C){console.error("aria-hidden: cannot operate on ",y,C)}})};return p(e),l.clear(),dh++,function(){c.forEach(function(m){var y=po.get(m)-1,b=a.get(m)-1;po.set(m,y),a.set(m,b),y||(vl.has(m)||m.removeAttribute(n),vl.delete(m)),b||m.removeAttribute(t)}),dh--,dh||(po=new WeakMap,po=new WeakMap,vl=new WeakMap,bl={})}},au=function(r,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(r)?r:[r]),s=g_(r);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live], script"))),y_(n,s,t,"aria-hidden")):function(){return null}};function v_(r){const e=b_(r),t=w.forwardRef((n,s)=>{const{children:a,...c}=n,l=w.Children.toArray(a),d=l.find(w_);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}function b_(r){const e=w.forwardRef((t,n)=>{const{children:s,...a}=t;if(w.isValidElement(s)){const c=M_(s),l=S_(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var x_=Symbol("radix.slottable");function w_(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===x_}function S_(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function M_(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var ou="Dialog",[sx,ix]=Sn(ou),[C_,ds]=sx(ou),ax=r=>{const{__scopeDialog:e,children:t,open:n,defaultOpen:s,onOpenChange:a,modal:c=!0}=r,l=w.useRef(null),d=w.useRef(null),[f,p]=Rs({prop:n,defaultProp:s??!1,onChange:a,caller:ou});return g.jsx(C_,{scope:e,triggerRef:l,contentRef:d,contentId:rs(),titleId:rs(),descriptionId:rs(),open:f,onOpenChange:p,onOpenToggle:w.useCallback(()=>p(m=>!m),[p]),modal:c,children:t})};ax.displayName=ou;var ox="DialogTrigger",rx=w.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=ds(ox,t),a=je(e,s.triggerRef);return g.jsx(Ae.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":ip(s.open),...n,ref:a,onClick:ge(r.onClick,s.onOpenToggle)})});rx.displayName=ox;var np="DialogPortal",[E_,cx]=sx(np,{forceMount:void 0}),lx=r=>{const{__scopeDialog:e,forceMount:t,children:n,container:s}=r,a=ds(np,e);return g.jsx(E_,{scope:e,forceMount:t,children:w.Children.map(n,c=>g.jsx(ln,{present:t||a.open,children:g.jsx(Qr,{asChild:!0,container:s,children:c})}))})};lx.displayName=np;var $l="DialogOverlay",ux=w.forwardRef((r,e)=>{const t=cx($l,r.__scopeDialog),{forceMount:n=t.forceMount,...s}=r,a=ds($l,r.__scopeDialog);return a.modal?g.jsx(ln,{present:n||a.open,children:g.jsx(k_,{...s,ref:e})}):null});ux.displayName=$l;var R_=v_("DialogOverlay.RemoveScroll"),k_=w.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=ds($l,t);return g.jsx(Vr,{as:R_,allowPinchZoom:!0,shards:[s.contentRef],children:g.jsx(Ae.div,{"data-state":ip(s.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),ba="DialogContent",dx=w.forwardRef((r,e)=>{const t=cx(ba,r.__scopeDialog),{forceMount:n=t.forceMount,...s}=r,a=ds(ba,r.__scopeDialog);return g.jsx(ln,{present:n||a.open,children:a.modal?g.jsx(T_,{...s,ref:e}):g.jsx(A_,{...s,ref:e})})});dx.displayName=ba;var T_=w.forwardRef((r,e)=>{const t=ds(ba,r.__scopeDialog),n=w.useRef(null),s=je(e,t.contentRef,n);return w.useEffect(()=>{const a=n.current;if(a)return au(a)},[]),g.jsx(fx,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(r.onCloseAutoFocus,a=>{a.preventDefault(),t.triggerRef.current?.focus()}),onPointerDownOutside:ge(r.onPointerDownOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0;(c.button===2||l)&&a.preventDefault()}),onFocusOutside:ge(r.onFocusOutside,a=>a.preventDefault())})}),A_=w.forwardRef((r,e)=>{const t=ds(ba,r.__scopeDialog),n=w.useRef(!1),s=w.useRef(!1);return g.jsx(fx,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{r.onCloseAutoFocus?.(a),a.defaultPrevented||(n.current||t.triggerRef.current?.focus(),a.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:a=>{r.onInteractOutside?.(a),a.defaultPrevented||(n.current=!0,a.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const c=a.target;t.triggerRef.current?.contains(c)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&s.current&&a.preventDefault()}})}),fx=w.forwardRef((r,e)=>{const{__scopeDialog:t,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:a,...c}=r,l=ds(ba,t),d=w.useRef(null),f=je(e,d);return su(),g.jsxs(g.Fragment,{children:[g.jsx(Fr,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:a,children:g.jsx(Br,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":ip(l.open),...c,ref:f,onDismiss:()=>l.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(__,{titleId:l.titleId}),g.jsx(j_,{contentRef:d,descriptionId:l.descriptionId})]})]})}),sp="DialogTitle",hx=w.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=ds(sp,t);return g.jsx(Ae.h2,{id:s.titleId,...n,ref:e})});hx.displayName=sp;var px="DialogDescription",gx=w.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=ds(px,t);return g.jsx(Ae.p,{id:s.descriptionId,...n,ref:e})});gx.displayName=px;var mx="DialogClose",yx=w.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=ds(mx,t);return g.jsx(Ae.button,{type:"button",...n,ref:e,onClick:ge(r.onClick,()=>s.onOpenChange(!1))})});yx.displayName=mx;function ip(r){return r?"open":"closed"}var vx="DialogTitleWarning",[D_,bx]=$D(vx,{contentName:ba,titleName:sp,docsSlug:"dialog"}),__=({titleId:r})=>{const e=bx(vx),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return w.useEffect(()=>{r&&(document.getElementById(r)||console.error(t))},[t,r]),null},N_="DialogDescriptionWarning",j_=({contentRef:r,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bx(N_).contentName}}.`;return w.useEffect(()=>{const s=r.current?.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(n))},[n,r,e]),null},xx=ax,wx=rx,Sx=lx,ap=ux,op=dx,rp=hx,cp=gx,lp=yx,P_=Symbol("radix.slottable");function z_(r){const e=({children:t})=>g.jsx(g.Fragment,{children:t});return e.displayName=`${r}.Slottable`,e.__radixId=P_,e}var Mx="AlertDialog",[L_]=Sn(Mx,[ix]),ri=ix(),Cx=r=>{const{__scopeAlertDialog:e,...t}=r,n=ri(e);return g.jsx(xx,{...n,...t,modal:!0})};Cx.displayName=Mx;var I_="AlertDialogTrigger",O_=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,...n}=r,s=ri(t);return g.jsx(wx,{...s,...n,ref:e})});O_.displayName=I_;var H_="AlertDialogPortal",Ex=r=>{const{__scopeAlertDialog:e,...t}=r,n=ri(e);return g.jsx(Sx,{...n,...t})};Ex.displayName=H_;var q_="AlertDialogOverlay",Rx=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,...n}=r,s=ri(t);return g.jsx(ap,{...s,...n,ref:e})});Rx.displayName=q_;var vo="AlertDialogContent",[U_,$_]=L_(vo),B_=z_("AlertDialogContent"),kx=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,children:n,...s}=r,a=ri(t),c=w.useRef(null),l=je(e,c),d=w.useRef(null);return g.jsx(D_,{contentName:vo,titleName:Tx,docsSlug:"alert-dialog",children:g.jsx(U_,{scope:t,cancelRef:d,children:g.jsxs(op,{role:"alertdialog",...a,...s,ref:l,onOpenAutoFocus:ge(s.onOpenAutoFocus,f=>{f.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:f=>f.preventDefault(),onInteractOutside:f=>f.preventDefault(),children:[g.jsx(B_,{children:n}),g.jsx(Q_,{contentRef:c})]})})})});kx.displayName=vo;var Tx="AlertDialogTitle",Ax=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,...n}=r,s=ri(t);return g.jsx(rp,{...s,...n,ref:e})});Ax.displayName=Tx;var Dx="AlertDialogDescription",_x=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,...n}=r,s=ri(t);return g.jsx(cp,{...s,...n,ref:e})});_x.displayName=Dx;var F_="AlertDialogAction",Nx=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,...n}=r,s=ri(t);return g.jsx(lp,{...s,...n,ref:e})});Nx.displayName=F_;var jx="AlertDialogCancel",Px=w.forwardRef((r,e)=>{const{__scopeAlertDialog:t,...n}=r,{cancelRef:s}=$_(jx,t),a=ri(t),c=je(e,s);return g.jsx(lp,{...a,...n,ref:c})});Px.displayName=jx;var Q_=({contentRef:r})=>{const e=`\`${vo}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${vo}\` by passing a \`${Dx}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${vo}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return w.useEffect(()=>{document.getElementById(r.current?.getAttribute("aria-describedby"))||console.warn(e)},[e,r]),null},V_=Cx,G_=Ex,zx=Rx,Lx=kx,Ix=Nx,Ox=Px,Hx=Ax,qx=_x;const Ux=V_,K_=G_,$x=w.forwardRef(({className:r,...e},t)=>g.jsx(zx,{className:Re("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e,ref:t}));$x.displayName=zx.displayName;const up=w.forwardRef(({className:r,...e},t)=>g.jsxs(K_,{children:[g.jsx($x,{}),g.jsx(Lx,{ref:t,className:Re("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...e})]}));up.displayName=Lx.displayName;const Bx=({className:r,...e})=>g.jsx("div",{className:Re("flex flex-col space-y-2 text-center sm:text-left",r),...e});Bx.displayName="AlertDialogHeader";const Fx=({className:r,...e})=>g.jsx("div",{className:Re("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...e});Fx.displayName="AlertDialogFooter";const dp=w.forwardRef(({className:r,...e},t)=>g.jsx(Hx,{ref:t,className:Re("text-lg font-semibold",r),...e}));dp.displayName=Hx.displayName;const fp=w.forwardRef(({className:r,...e},t)=>g.jsx(qx,{ref:t,className:Re("text-sm text-muted-foreground",r),...e}));fp.displayName=qx.displayName;const hp=w.forwardRef(({className:r,...e},t)=>g.jsx(Ix,{ref:t,className:Re(Vh(),r),...e}));hp.displayName=Ix.displayName;const pp=w.forwardRef(({className:r,...e},t)=>g.jsx(Ox,{ref:t,className:Re(Vh({variant:"outline"}),"mt-2 sm:mt-0",r),...e}));pp.displayName=Ox.displayName;const gp=xx,VO=wx,Y_=Sx,Qx=w.forwardRef(({className:r,...e},t)=>g.jsx(ap,{ref:t,className:Re("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e}));Qx.displayName=ap.displayName;const ru=w.forwardRef(({className:r,children:e,...t},n)=>g.jsxs(Y_,{children:[g.jsx(Qx,{}),g.jsxs(op,{ref:n,className:Re("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:[e,g.jsxs(lp,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[g.jsx(os,{className:"h-4 w-4"}),g.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ru.displayName=op.displayName;const cu=({className:r,...e})=>g.jsx("div",{className:Re("flex flex-col space-y-1.5 text-center sm:text-left",r),...e});cu.displayName="DialogHeader";const lu=({className:r,...e})=>g.jsx("div",{className:Re("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...e});lu.displayName="DialogFooter";const uu=w.forwardRef(({className:r,...e},t)=>g.jsx(rp,{ref:t,className:Re("text-lg font-semibold leading-none tracking-tight",r),...e}));uu.displayName=rp.displayName;const du=w.forwardRef(({className:r,...e},t)=>g.jsx(cp,{ref:t,className:Re("text-sm text-muted-foreground",r),...e}));du.displayName=cp.displayName;var W_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],X_=W_.reduce((r,e)=>{const t=Bh(`Primitive.${e}`),n=w.forwardRef((s,a)=>{const{asChild:c,...l}=s,d=c?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...r,[e]:n}},{}),J_="Label",Vx=w.forwardRef((r,e)=>g.jsx(X_.label,{...r,ref:e,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(r.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Vx.displayName=J_;var Gx=Vx;const Z_=Fh("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),st=w.forwardRef(({className:r,...e},t)=>g.jsx(Gx,{ref:t,className:Re(Z_(),r),...e}));st.displayName=Gx.displayName;function mp({open:r,initialName:e="",onConfirm:t,onCancel:n}){const[s,a]=w.useState(e);w.useEffect(()=>{r&&a(e)},[r,e]);const c=()=>{s.trim()&&t(s.trim())};return g.jsx(gp,{open:r,onOpenChange:l=>!l&&n(),children:g.jsxs(ru,{children:[g.jsxs(cu,{children:[g.jsx(uu,{children:e?"Rename Group":"Create Group"}),g.jsx(du,{children:e?"Enter a new name for the group":"Enter a name for the new group"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(st,{htmlFor:"group-name",children:"Group Name"}),g.jsx(Tt,{id:"group-name",value:s,onChange:l=>a(l.target.value),onKeyDown:l=>{l.key==="Enter"&&c()},className:"mt-2",autoFocus:!0})]}),g.jsxs(lu,{children:[g.jsx(ke,{variant:"outline",onClick:n,children:"Cancel"}),g.jsx(ke,{onClick:c,disabled:!s.trim(),children:e?"Save":"Create"})]})]})})}function eN(){const{zoom:r,setZoom:e,diagramName:t,setDiagramName:n,saveDiagram:s,loadDiagramState:a,undo:c,redo:l,selectedNodeId:d,createGroupFromSelection:f,autoGroupByConnections:p,nodes:m,pan:y,setPan:b,viewportWidth:S,viewportHeight:M}=Ee(),{canUndo:E,canRedo:C}=Ar(),T=w.useRef(null),[k,A]=w.useState(!1),[_,N]=w.useState(t),[L,q]=w.useState(!1),{showMinimap:Z,toggleMinimap:se,showHeatMapLegend:ce,toggleHeatMapLegend:J,showRuler:te,toggleRuler:le}=$r(),ue=()=>e(Math.min(r+.1,2)),z=()=>e(r-.1),j=()=>{const ae=m;if(!ae.length){e(1),b({x:0,y:0});return}const $=100,G=ae.map(Gt=>Gt.position.x),pe=ae.map(Gt=>Gt.position.y),me=ae.map(Gt=>Gt.position.x+140),ye=ae.map(Gt=>Gt.position.y+140),ve=Math.min(...G)-$,Pe=Math.min(...pe)-$,$e=Math.max(...me)+$,it=Math.max(...ye)+$,Je=$e-ve,jt=it-Pe,de=S||window.innerWidth,Ue=M||window.innerHeight-56,Be=de/Je,bt=Ue/jt;let mt=Math.min(Be,bt);mt=Math.min(Math.max(mt,.2),2.5);const Ut=ve+Je/2,Ze=Pe+jt/2,Pt=de/2,xt=Ue/2,yt=Pt-Ut*mt,Xt=xt-Ze*mt;e(mt),b({x:yt,y:Xt})},O=()=>{s(),Ye.success("Diagram saved to browser storage")},W=()=>{const ae=`${t.replace(/\s+/g,"_")}_${Date.now()}.json`;kT(Ee.getState(),ae),Ye.success("Diagram exported as JSON")},he=()=>{T.current?.click()},P=async ae=>{const $=ae.target.files?.[0];if($){try{const G=await TT($);if(!G){Ye.error("Failed to import diagram: Invalid file format");return}a({nodes:G.nodes||[],connections:G.connections||[],groups:G.groups||[],zoom:G.zoom||1,pan:G.pan||{x:0,y:0}}),n(G.name),Ye.success(`Diagram "${G.name}" imported successfully`)}catch(G){Ye.error("Failed to import diagram"),ii("Failed to import diagram",G instanceof Error?G:new Error(String(G)))}T.current&&(T.current.value="")}},F=()=>{_.trim()&&(n(_.trim()),Ye.success("Diagram renamed")),A(!1)},Y=()=>{const{nodes:ae}=Ee.getState();if(ae.filter(G=>G.selected||G.id===d).length===0){Ye.error("Select at least one component to create a group");return}q(!0)},ie=ae=>{f(ae),Ye.success(`Group "${ae}" created`),q(!1)},B=()=>{p(),Ye.success("Groups created automatically from connections")};return g.jsxs(g.Fragment,{children:[g.jsx(mp,{open:L,onConfirm:ie,onCancel:()=>q(!1)}),g.jsxs("div",{className:"h-14 bg-toolbar-bg border-b border-border flex items-center justify-between px-4",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("button",{onClick:()=>A(!0),className:"text-lg font-semibold text-foreground hover:text-primary transition-colors cursor-pointer",title:"Click to rename diagram",children:[g.jsx("span",{className:"text-primary",children:"Archi"}),"Phoenix",g.jsxs("span",{className:"text-xs text-secondary-foreground ml-2",children:[" ",t]})]}),g.jsx(xn,{orientation:"vertical",className:"h-6 mx-2"}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:c,disabled:!E,title:"Undo (Ctrl/Cmd+Z)",children:g.jsx(SD,{className:"h-4 w-4"})}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:l,disabled:!C,title:"Redo (Ctrl/Cmd+Shift+Z or Ctrl/Cmd+Y)",children:g.jsx(eD,{className:"h-4 w-4"})})]}),g.jsx(xn,{orientation:"vertical",className:"h-6 mx-2"}),g.jsx(i2,{})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 rounded-md p-1",children:[g.jsx(ke,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ue,title:"Zoom In",children:g.jsx(TD,{className:"h-4 w-4"})}),g.jsxs("span",{className:"text-sm font-mono px-2 min-w-[60px] text-center",children:[Math.round(r*100),"%"]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:z,title:"Zoom Out",children:g.jsx(DD,{className:"h-4 w-4"})}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:j,title:"Fit to View",children:g.jsx(BA,{className:"h-4 w-4"})})]}),g.jsx(xn,{orientation:"vertical",className:"h-6"}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:O,title:"Save diagram to browser storage (auto-saves on changes)",children:g.jsx(rD,{className:"h-4 w-4"})}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:W,title:"Export diagram as JSON file",children:g.jsx(TA,{className:"h-4 w-4"})}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:he,title:"Import diagram from JSON file",children:g.jsx(CD,{className:"h-4 w-4"})}),g.jsx(xn,{orientation:"vertical",className:"h-6"}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Create group from selection",onClick:Y,disabled:!d,children:g.jsx(Tb,{className:"h-4 w-4"})}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Auto-group by connections",onClick:B,children:g.jsx(hD,{className:"h-4 w-4"})}),g.jsx(xn,{orientation:"vertical",className:"h-6"}),g.jsx(_D,{}),g.jsx(ke,{variant:Z?"default":"ghost",size:"icon",className:"h-9 w-9",title:Z?"Hide minimap":"Show minimap",onClick:se,children:g.jsx(UA,{className:"h-4 w-4"})}),g.jsx(ke,{variant:ce?"default":"ghost",size:"icon",className:"h-9 w-9",title:ce?"Hide heat map legend":"Show heat map legend",onClick:J,children:g.jsx(ya,{className:"h-4 w-4"})}),g.jsx(ke,{variant:te?"default":"ghost",size:"icon",className:"h-9 w-9",title:te?"Hide ruler":"Show ruler",onClick:le,children:g.jsx(aD,{className:"h-4 w-4"})}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Settings",children:g.jsx(dD,{className:"h-4 w-4"})})]})]}),g.jsx("input",{ref:T,type:"file",accept:".json",onChange:P,className:"hidden","aria-label":"Import diagram from file"}),g.jsx(Ux,{open:k,onOpenChange:A,children:g.jsxs(up,{children:[g.jsx(dp,{children:"Rename Diagram"}),g.jsx(fp,{children:"Enter a new name for your diagram"}),g.jsx("div",{className:"py-4",children:g.jsx(Tt,{value:_,onChange:ae=>N(ae.target.value),placeholder:"Diagram name",onKeyDown:ae=>{ae.key==="Enter"&&F()},autoFocus:!0})}),g.jsxs("div",{className:"flex gap-2 justify-end",children:[g.jsx(pp,{children:"Cancel"}),g.jsx(hp,{onClick:F,children:"Save"})]})]})})]})}function wv(r){const e=tN(r),t=w.forwardRef((n,s)=>{const{children:a,...c}=n,l=w.Children.toArray(a),d=l.find(sN);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}function tN(r){const e=w.forwardRef((t,n)=>{const{children:s,...a}=t;if(w.isValidElement(s)){const c=aN(s),l=iN(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var nN=Symbol("radix.slottable");function sN(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===nN}function iN(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function aN(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function fu(r){const e=r+"CollectionProvider",[t,n]=Sn(e),[s,a]=t(e,{collectionRef:{current:null},itemMap:new Map}),c=M=>{const{scope:E,children:C}=M,T=kt.useRef(null),k=kt.useRef(new Map).current;return g.jsx(s,{scope:E,itemMap:k,collectionRef:T,children:C})};c.displayName=e;const l=r+"CollectionSlot",d=wv(l),f=kt.forwardRef((M,E)=>{const{scope:C,children:T}=M,k=a(l,C),A=je(E,k.collectionRef);return g.jsx(d,{ref:A,children:T})});f.displayName=l;const p=r+"CollectionItemSlot",m="data-radix-collection-item",y=wv(p),b=kt.forwardRef((M,E)=>{const{scope:C,children:T,...k}=M,A=kt.useRef(null),_=je(E,A),N=a(p,C);return kt.useEffect(()=>(N.itemMap.set(A,{ref:A,...k}),()=>void N.itemMap.delete(A))),g.jsx(y,{[m]:"",ref:_,children:T})});b.displayName=p;function S(M){const E=a(r+"CollectionConsumer",M);return kt.useCallback(()=>{const T=E.collectionRef.current;if(!T)return[];const k=Array.from(T.querySelectorAll(`[${m}]`));return Array.from(E.itemMap.values()).sort((N,L)=>k.indexOf(N.ref.current)-k.indexOf(L.ref.current))},[E.collectionRef,E.itemMap])}return[{Provider:c,Slot:f,ItemSlot:b},S,n]}var fh="rovingFocusGroup.onEntryFocus",oN={bubbles:!1,cancelable:!0},Gr="RovingFocusGroup",[Ch,Kx,rN]=fu(Gr),[cN,hu]=Sn(Gr,[rN]),[lN,uN]=cN(Gr),Yx=w.forwardRef((r,e)=>g.jsx(Ch.Provider,{scope:r.__scopeRovingFocusGroup,children:g.jsx(Ch.Slot,{scope:r.__scopeRovingFocusGroup,children:g.jsx(dN,{...r,ref:e})})}));Yx.displayName=Gr;var dN=w.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:s=!1,dir:a,currentTabStopId:c,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:d,onEntryFocus:f,preventScrollOnEntryFocus:p=!1,...m}=r,y=w.useRef(null),b=je(e,y),S=Ro(a),[M,E]=Rs({prop:c,defaultProp:l??null,onChange:d,caller:Gr}),[C,T]=w.useState(!1),k=on(f),A=Kx(t),_=w.useRef(!1),[N,L]=w.useState(0);return w.useEffect(()=>{const q=y.current;if(q)return q.addEventListener(fh,k),()=>q.removeEventListener(fh,k)},[k]),g.jsx(lN,{scope:t,orientation:n,dir:S,loop:s,currentTabStopId:M,onItemFocus:w.useCallback(q=>E(q),[E]),onItemShiftTab:w.useCallback(()=>T(!0),[]),onFocusableItemAdd:w.useCallback(()=>L(q=>q+1),[]),onFocusableItemRemove:w.useCallback(()=>L(q=>q-1),[]),children:g.jsx(Ae.div,{tabIndex:C||N===0?-1:0,"data-orientation":n,...m,ref:b,style:{outline:"none",...r.style},onMouseDown:ge(r.onMouseDown,()=>{_.current=!0}),onFocus:ge(r.onFocus,q=>{const Z=!_.current;if(q.target===q.currentTarget&&Z&&!C){const se=new CustomEvent(fh,oN);if(q.currentTarget.dispatchEvent(se),!se.defaultPrevented){const ce=A().filter(z=>z.focusable),J=ce.find(z=>z.active),te=ce.find(z=>z.id===M),ue=[J,te,...ce].filter(Boolean).map(z=>z.ref.current);Jx(ue,p)}}_.current=!1}),onBlur:ge(r.onBlur,()=>T(!1))})})}),Wx="RovingFocusGroupItem",Xx=w.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:s=!1,tabStopId:a,children:c,...l}=r,d=rs(),f=a||d,p=uN(Wx,t),m=p.currentTabStopId===f,y=Kx(t),{onFocusableItemAdd:b,onFocusableItemRemove:S,currentTabStopId:M}=p;return w.useEffect(()=>{if(n)return b(),()=>S()},[n,b,S]),g.jsx(Ch.ItemSlot,{scope:t,id:f,focusable:n,active:s,children:g.jsx(Ae.span,{tabIndex:m?0:-1,"data-orientation":p.orientation,...l,ref:e,onMouseDown:ge(r.onMouseDown,E=>{n?p.onItemFocus(f):E.preventDefault()}),onFocus:ge(r.onFocus,()=>p.onItemFocus(f)),onKeyDown:ge(r.onKeyDown,E=>{if(E.key==="Tab"&&E.shiftKey){p.onItemShiftTab();return}if(E.target!==E.currentTarget)return;const C=pN(E,p.orientation,p.dir);if(C!==void 0){if(E.metaKey||E.ctrlKey||E.altKey||E.shiftKey)return;E.preventDefault();let k=y().filter(A=>A.focusable).map(A=>A.ref.current);if(C==="last")k.reverse();else if(C==="prev"||C==="next"){C==="prev"&&k.reverse();const A=k.indexOf(E.currentTarget);k=p.loop?gN(k,A+1):k.slice(A+1)}setTimeout(()=>Jx(k))}}),children:typeof c=="function"?c({isCurrentTabStop:m,hasTabStop:M!=null}):c})})});Xx.displayName=Wx;var fN={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function hN(r,e){return e!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function pN(r,e,t){const n=hN(r.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return fN[n]}function Jx(r,e=!1){const t=document.activeElement;for(const n of r)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function gN(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var Zx=Yx,ew=Xx,pu="Tabs",[mN]=Sn(pu,[hu]),tw=hu(),[yN,yp]=mN(pu),nw=w.forwardRef((r,e)=>{const{__scopeTabs:t,value:n,onValueChange:s,defaultValue:a,orientation:c="horizontal",dir:l,activationMode:d="automatic",...f}=r,p=Ro(l),[m,y]=Rs({prop:n,onChange:s,defaultProp:a??"",caller:pu});return g.jsx(yN,{scope:t,baseId:rs(),value:m,onValueChange:y,orientation:c,dir:p,activationMode:d,children:g.jsx(Ae.div,{dir:p,"data-orientation":c,...f,ref:e})})});nw.displayName=pu;var sw="TabsList",iw=w.forwardRef((r,e)=>{const{__scopeTabs:t,loop:n=!0,...s}=r,a=yp(sw,t),c=tw(t);return g.jsx(Zx,{asChild:!0,...c,orientation:a.orientation,dir:a.dir,loop:n,children:g.jsx(Ae.div,{role:"tablist","aria-orientation":a.orientation,...s,ref:e})})});iw.displayName=sw;var aw="TabsTrigger",ow=w.forwardRef((r,e)=>{const{__scopeTabs:t,value:n,disabled:s=!1,...a}=r,c=yp(aw,t),l=tw(t),d=lw(c.baseId,n),f=uw(c.baseId,n),p=n===c.value;return g.jsx(ew,{asChild:!0,...l,focusable:!s,active:p,children:g.jsx(Ae.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":f,"data-state":p?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:d,...a,ref:e,onMouseDown:ge(r.onMouseDown,m=>{!s&&m.button===0&&m.ctrlKey===!1?c.onValueChange(n):m.preventDefault()}),onKeyDown:ge(r.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&c.onValueChange(n)}),onFocus:ge(r.onFocus,()=>{const m=c.activationMode!=="manual";!p&&!s&&m&&c.onValueChange(n)})})})});ow.displayName=aw;var rw="TabsContent",cw=w.forwardRef((r,e)=>{const{__scopeTabs:t,value:n,forceMount:s,children:a,...c}=r,l=yp(rw,t),d=lw(l.baseId,n),f=uw(l.baseId,n),p=n===l.value,m=w.useRef(p);return w.useEffect(()=>{const y=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(y)},[]),g.jsx(ln,{present:s||p,children:({present:y})=>g.jsx(Ae.div,{"data-state":p?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":d,hidden:!y,id:f,tabIndex:0,...c,ref:e,style:{...r.style,animationDuration:m.current?"0s":void 0},children:y&&a})})});cw.displayName=rw;function lw(r,e){return`${r}-trigger-${e}`}function uw(r,e){return`${r}-content-${e}`}var vN=nw,dw=iw,fw=ow,hw=cw;const vp=vN,gu=w.forwardRef(({className:r,...e},t)=>g.jsx(dw,{ref:t,className:Re("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",r),...e}));gu.displayName=dw.displayName;const ss=w.forwardRef(({className:r,...e},t)=>g.jsx(fw,{ref:t,className:Re("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...e}));ss.displayName=fw.displayName;const ni=w.forwardRef(({className:r,...e},t)=>g.jsx(hw,{ref:t,className:Re("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...e}));ni.displayName=hw.displayName;const bN=["top","right","bottom","left"],Ii=Math.min,Dn=Math.max,Bl=Math.round,xl=Math.floor,Ss=r=>({x:r,y:r}),xN={left:"right",right:"left",bottom:"top",top:"bottom"},wN={start:"end",end:"start"};function Eh(r,e,t){return Dn(r,Ii(e,t))}function ai(r,e){return typeof r=="function"?r(e):r}function oi(r){return r.split("-")[0]}function ko(r){return r.split("-")[1]}function bp(r){return r==="x"?"y":"x"}function xp(r){return r==="y"?"height":"width"}const SN=new Set(["top","bottom"]);function xs(r){return SN.has(oi(r))?"y":"x"}function wp(r){return bp(xs(r))}function MN(r,e,t){t===void 0&&(t=!1);const n=ko(r),s=wp(r),a=xp(s);let c=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(c=Fl(c)),[c,Fl(c)]}function CN(r){const e=Fl(r);return[Rh(r),e,Rh(e)]}function Rh(r){return r.replace(/start|end/g,e=>wN[e])}const Sv=["left","right"],Mv=["right","left"],EN=["top","bottom"],RN=["bottom","top"];function kN(r,e,t){switch(r){case"top":case"bottom":return t?e?Mv:Sv:e?Sv:Mv;case"left":case"right":return e?EN:RN;default:return[]}}function TN(r,e,t,n){const s=ko(r);let a=kN(oi(r),t==="start",n);return s&&(a=a.map(c=>c+"-"+s),e&&(a=a.concat(a.map(Rh)))),a}function Fl(r){return r.replace(/left|right|bottom|top/g,e=>xN[e])}function AN(r){return{top:0,right:0,bottom:0,left:0,...r}}function pw(r){return typeof r!="number"?AN(r):{top:r,right:r,bottom:r,left:r}}function Ql(r){const{x:e,y:t,width:n,height:s}=r;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function Cv(r,e,t){let{reference:n,floating:s}=r;const a=xs(e),c=wp(e),l=xp(c),d=oi(e),f=a==="y",p=n.x+n.width/2-s.width/2,m=n.y+n.height/2-s.height/2,y=n[l]/2-s[l]/2;let b;switch(d){case"top":b={x:p,y:n.y-s.height};break;case"bottom":b={x:p,y:n.y+n.height};break;case"right":b={x:n.x+n.width,y:m};break;case"left":b={x:n.x-s.width,y:m};break;default:b={x:n.x,y:n.y}}switch(ko(e)){case"start":b[c]-=y*(t&&f?-1:1);break;case"end":b[c]+=y*(t&&f?-1:1);break}return b}const DN=async(r,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:a=[],platform:c}=t,l=a.filter(Boolean),d=await(c.isRTL==null?void 0:c.isRTL(e));let f=await c.getElementRects({reference:r,floating:e,strategy:s}),{x:p,y:m}=Cv(f,n,d),y=n,b={},S=0;for(let M=0;M<l.length;M++){const{name:E,fn:C}=l[M],{x:T,y:k,data:A,reset:_}=await C({x:p,y:m,initialPlacement:n,placement:y,strategy:s,middlewareData:b,rects:f,platform:c,elements:{reference:r,floating:e}});p=T??p,m=k??m,b={...b,[E]:{...b[E],...A}},_&&S<=50&&(S++,typeof _=="object"&&(_.placement&&(y=_.placement),_.rects&&(f=_.rects===!0?await c.getElementRects({reference:r,floating:e,strategy:s}):_.rects),{x:p,y:m}=Cv(f,y,d)),M=-1)}return{x:p,y:m,placement:y,strategy:s,middlewareData:b}};async function zr(r,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:a,rects:c,elements:l,strategy:d}=r,{boundary:f="clippingAncestors",rootBoundary:p="viewport",elementContext:m="floating",altBoundary:y=!1,padding:b=0}=ai(e,r),S=pw(b),E=l[y?m==="floating"?"reference":"floating":m],C=Ql(await a.getClippingRect({element:(t=await(a.isElement==null?void 0:a.isElement(E)))==null||t?E:E.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(l.floating)),boundary:f,rootBoundary:p,strategy:d})),T=m==="floating"?{x:n,y:s,width:c.floating.width,height:c.floating.height}:c.reference,k=await(a.getOffsetParent==null?void 0:a.getOffsetParent(l.floating)),A=await(a.isElement==null?void 0:a.isElement(k))?await(a.getScale==null?void 0:a.getScale(k))||{x:1,y:1}:{x:1,y:1},_=Ql(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:T,offsetParent:k,strategy:d}):T);return{top:(C.top-_.top+S.top)/A.y,bottom:(_.bottom-C.bottom+S.bottom)/A.y,left:(C.left-_.left+S.left)/A.x,right:(_.right-C.right+S.right)/A.x}}const _N=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:s,rects:a,platform:c,elements:l,middlewareData:d}=e,{element:f,padding:p=0}=ai(r,e)||{};if(f==null)return{};const m=pw(p),y={x:t,y:n},b=wp(s),S=xp(b),M=await c.getDimensions(f),E=b==="y",C=E?"top":"left",T=E?"bottom":"right",k=E?"clientHeight":"clientWidth",A=a.reference[S]+a.reference[b]-y[b]-a.floating[S],_=y[b]-a.reference[b],N=await(c.getOffsetParent==null?void 0:c.getOffsetParent(f));let L=N?N[k]:0;(!L||!await(c.isElement==null?void 0:c.isElement(N)))&&(L=l.floating[k]||a.floating[S]);const q=A/2-_/2,Z=L/2-M[S]/2-1,se=Ii(m[C],Z),ce=Ii(m[T],Z),J=se,te=L-M[S]-ce,le=L/2-M[S]/2+q,ue=Eh(J,le,te),z=!d.arrow&&ko(s)!=null&&le!==ue&&a.reference[S]/2-(le<J?se:ce)-M[S]/2<0,j=z?le<J?le-J:le-te:0;return{[b]:y[b]+j,data:{[b]:ue,centerOffset:le-ue-j,...z&&{alignmentOffset:j}},reset:z}}}),NN=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:s,middlewareData:a,rects:c,initialPlacement:l,platform:d,elements:f}=e,{mainAxis:p=!0,crossAxis:m=!0,fallbackPlacements:y,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:S="none",flipAlignment:M=!0,...E}=ai(r,e);if((t=a.arrow)!=null&&t.alignmentOffset)return{};const C=oi(s),T=xs(l),k=oi(l)===l,A=await(d.isRTL==null?void 0:d.isRTL(f.floating)),_=y||(k||!M?[Fl(l)]:CN(l)),N=S!=="none";!y&&N&&_.push(...TN(l,M,S,A));const L=[l,..._],q=await zr(e,E),Z=[];let se=((n=a.flip)==null?void 0:n.overflows)||[];if(p&&Z.push(q[C]),m){const le=MN(s,c,A);Z.push(q[le[0]],q[le[1]])}if(se=[...se,{placement:s,overflows:Z}],!Z.every(le=>le<=0)){var ce,J;const le=(((ce=a.flip)==null?void 0:ce.index)||0)+1,ue=L[le];if(ue&&(!(m==="alignment"?T!==xs(ue):!1)||se.every(O=>xs(O.placement)===T?O.overflows[0]>0:!0)))return{data:{index:le,overflows:se},reset:{placement:ue}};let z=(J=se.filter(j=>j.overflows[0]<=0).sort((j,O)=>j.overflows[1]-O.overflows[1])[0])==null?void 0:J.placement;if(!z)switch(b){case"bestFit":{var te;const j=(te=se.filter(O=>{if(N){const W=xs(O.placement);return W===T||W==="y"}return!0}).map(O=>[O.placement,O.overflows.filter(W=>W>0).reduce((W,he)=>W+he,0)]).sort((O,W)=>O[1]-W[1])[0])==null?void 0:te[0];j&&(z=j);break}case"initialPlacement":z=l;break}if(s!==z)return{reset:{placement:z}}}return{}}}};function Ev(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function Rv(r){return bN.some(e=>r[e]>=0)}const jN=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...s}=ai(r,e);switch(n){case"referenceHidden":{const a=await zr(e,{...s,elementContext:"reference"}),c=Ev(a,t.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:Rv(c)}}}case"escaped":{const a=await zr(e,{...s,altBoundary:!0}),c=Ev(a,t.floating);return{data:{escapedOffsets:c,escaped:Rv(c)}}}default:return{}}}}},gw=new Set(["left","top"]);async function PN(r,e){const{placement:t,platform:n,elements:s}=r,a=await(n.isRTL==null?void 0:n.isRTL(s.floating)),c=oi(t),l=ko(t),d=xs(t)==="y",f=gw.has(c)?-1:1,p=a&&d?-1:1,m=ai(e,r);let{mainAxis:y,crossAxis:b,alignmentAxis:S}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return l&&typeof S=="number"&&(b=l==="end"?S*-1:S),d?{x:b*p,y:y*f}:{x:y*f,y:b*p}}const zN=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:s,y:a,placement:c,middlewareData:l}=e,d=await PN(e,r);return c===((t=l.offset)==null?void 0:t.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:s+d.x,y:a+d.y,data:{...d,placement:c}}}}},LN=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:a=!0,crossAxis:c=!1,limiter:l={fn:E=>{let{x:C,y:T}=E;return{x:C,y:T}}},...d}=ai(r,e),f={x:t,y:n},p=await zr(e,d),m=xs(oi(s)),y=bp(m);let b=f[y],S=f[m];if(a){const E=y==="y"?"top":"left",C=y==="y"?"bottom":"right",T=b+p[E],k=b-p[C];b=Eh(T,b,k)}if(c){const E=m==="y"?"top":"left",C=m==="y"?"bottom":"right",T=S+p[E],k=S-p[C];S=Eh(T,S,k)}const M=l.fn({...e,[y]:b,[m]:S});return{...M,data:{x:M.x-t,y:M.y-n,enabled:{[y]:a,[m]:c}}}}}},IN=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:n,placement:s,rects:a,middlewareData:c}=e,{offset:l=0,mainAxis:d=!0,crossAxis:f=!0}=ai(r,e),p={x:t,y:n},m=xs(s),y=bp(m);let b=p[y],S=p[m];const M=ai(l,e),E=typeof M=="number"?{mainAxis:M,crossAxis:0}:{mainAxis:0,crossAxis:0,...M};if(d){const k=y==="y"?"height":"width",A=a.reference[y]-a.floating[k]+E.mainAxis,_=a.reference[y]+a.reference[k]-E.mainAxis;b<A?b=A:b>_&&(b=_)}if(f){var C,T;const k=y==="y"?"width":"height",A=gw.has(oi(s)),_=a.reference[m]-a.floating[k]+(A&&((C=c.offset)==null?void 0:C[m])||0)+(A?0:E.crossAxis),N=a.reference[m]+a.reference[k]+(A?0:((T=c.offset)==null?void 0:T[m])||0)-(A?E.crossAxis:0);S<_?S=_:S>N&&(S=N)}return{[y]:b,[m]:S}}}},ON=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:s,rects:a,platform:c,elements:l}=e,{apply:d=()=>{},...f}=ai(r,e),p=await zr(e,f),m=oi(s),y=ko(s),b=xs(s)==="y",{width:S,height:M}=a.floating;let E,C;m==="top"||m==="bottom"?(E=m,C=y===(await(c.isRTL==null?void 0:c.isRTL(l.floating))?"start":"end")?"left":"right"):(C=m,E=y==="end"?"top":"bottom");const T=M-p.top-p.bottom,k=S-p.left-p.right,A=Ii(M-p[E],T),_=Ii(S-p[C],k),N=!e.middlewareData.shift;let L=A,q=_;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(q=k),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(L=T),N&&!y){const se=Dn(p.left,0),ce=Dn(p.right,0),J=Dn(p.top,0),te=Dn(p.bottom,0);b?q=S-2*(se!==0||ce!==0?se+ce:Dn(p.left,p.right)):L=M-2*(J!==0||te!==0?J+te:Dn(p.top,p.bottom))}await d({...e,availableWidth:q,availableHeight:L});const Z=await c.getDimensions(l.floating);return S!==Z.width||M!==Z.height?{reset:{rects:!0}}:{}}}};function mu(){return typeof window<"u"}function To(r){return mw(r)?(r.nodeName||"").toLowerCase():"#document"}function _n(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function Ds(r){var e;return(e=(mw(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function mw(r){return mu()?r instanceof Node||r instanceof _n(r).Node:!1}function cs(r){return mu()?r instanceof Element||r instanceof _n(r).Element:!1}function ks(r){return mu()?r instanceof HTMLElement||r instanceof _n(r).HTMLElement:!1}function kv(r){return!mu()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof _n(r).ShadowRoot}const HN=new Set(["inline","contents"]);function Kr(r){const{overflow:e,overflowX:t,overflowY:n,display:s}=ls(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!HN.has(s)}const qN=new Set(["table","td","th"]);function UN(r){return qN.has(To(r))}const $N=[":popover-open",":modal"];function yu(r){return $N.some(e=>{try{return r.matches(e)}catch{return!1}})}const BN=["transform","translate","scale","rotate","perspective"],FN=["transform","translate","scale","rotate","perspective","filter"],QN=["paint","layout","strict","content"];function Sp(r){const e=Mp(),t=cs(r)?ls(r):r;return BN.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||FN.some(n=>(t.willChange||"").includes(n))||QN.some(n=>(t.contain||"").includes(n))}function VN(r){let e=Oi(r);for(;ks(e)&&!wo(e);){if(Sp(e))return e;if(yu(e))return null;e=Oi(e)}return null}function Mp(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const GN=new Set(["html","body","#document"]);function wo(r){return GN.has(To(r))}function ls(r){return _n(r).getComputedStyle(r)}function vu(r){return cs(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Oi(r){if(To(r)==="html")return r;const e=r.assignedSlot||r.parentNode||kv(r)&&r.host||Ds(r);return kv(e)?e.host:e}function yw(r){const e=Oi(r);return wo(e)?r.ownerDocument?r.ownerDocument.body:r.body:ks(e)&&Kr(e)?e:yw(e)}function Lr(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=yw(r),a=s===((n=r.ownerDocument)==null?void 0:n.body),c=_n(s);if(a){const l=kh(c);return e.concat(c,c.visualViewport||[],Kr(s)?s:[],l&&t?Lr(l):[])}return e.concat(s,Lr(s,[],t))}function kh(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function vw(r){const e=ls(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=ks(r),a=s?r.offsetWidth:t,c=s?r.offsetHeight:n,l=Bl(t)!==a||Bl(n)!==c;return l&&(t=a,n=c),{width:t,height:n,$:l}}function Cp(r){return cs(r)?r:r.contextElement}function bo(r){const e=Cp(r);if(!ks(e))return Ss(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:a}=vw(e);let c=(a?Bl(t.width):t.width)/n,l=(a?Bl(t.height):t.height)/s;return(!c||!Number.isFinite(c))&&(c=1),(!l||!Number.isFinite(l))&&(l=1),{x:c,y:l}}const KN=Ss(0);function bw(r){const e=_n(r);return!Mp()||!e.visualViewport?KN:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function YN(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==_n(r)?!1:e}function xa(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=r.getBoundingClientRect(),a=Cp(r);let c=Ss(1);e&&(n?cs(n)&&(c=bo(n)):c=bo(r));const l=YN(a,t,n)?bw(a):Ss(0);let d=(s.left+l.x)/c.x,f=(s.top+l.y)/c.y,p=s.width/c.x,m=s.height/c.y;if(a){const y=_n(a),b=n&&cs(n)?_n(n):n;let S=y,M=kh(S);for(;M&&n&&b!==S;){const E=bo(M),C=M.getBoundingClientRect(),T=ls(M),k=C.left+(M.clientLeft+parseFloat(T.paddingLeft))*E.x,A=C.top+(M.clientTop+parseFloat(T.paddingTop))*E.y;d*=E.x,f*=E.y,p*=E.x,m*=E.y,d+=k,f+=A,S=_n(M),M=kh(S)}}return Ql({width:p,height:m,x:d,y:f})}function bu(r,e){const t=vu(r).scrollLeft;return e?e.left+t:xa(Ds(r)).left+t}function xw(r,e){const t=r.getBoundingClientRect(),n=t.left+e.scrollLeft-bu(r,t),s=t.top+e.scrollTop;return{x:n,y:s}}function WN(r){let{elements:e,rect:t,offsetParent:n,strategy:s}=r;const a=s==="fixed",c=Ds(n),l=e?yu(e.floating):!1;if(n===c||l&&a)return t;let d={scrollLeft:0,scrollTop:0},f=Ss(1);const p=Ss(0),m=ks(n);if((m||!m&&!a)&&((To(n)!=="body"||Kr(c))&&(d=vu(n)),ks(n))){const b=xa(n);f=bo(n),p.x=b.x+n.clientLeft,p.y=b.y+n.clientTop}const y=c&&!m&&!a?xw(c,d):Ss(0);return{width:t.width*f.x,height:t.height*f.y,x:t.x*f.x-d.scrollLeft*f.x+p.x+y.x,y:t.y*f.y-d.scrollTop*f.y+p.y+y.y}}function XN(r){return Array.from(r.getClientRects())}function JN(r){const e=Ds(r),t=vu(r),n=r.ownerDocument.body,s=Dn(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),a=Dn(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let c=-t.scrollLeft+bu(r);const l=-t.scrollTop;return ls(n).direction==="rtl"&&(c+=Dn(e.clientWidth,n.clientWidth)-s),{width:s,height:a,x:c,y:l}}const Tv=25;function ZN(r,e){const t=_n(r),n=Ds(r),s=t.visualViewport;let a=n.clientWidth,c=n.clientHeight,l=0,d=0;if(s){a=s.width,c=s.height;const p=Mp();(!p||p&&e==="fixed")&&(l=s.offsetLeft,d=s.offsetTop)}const f=bu(n);if(f<=0){const p=n.ownerDocument,m=p.body,y=getComputedStyle(m),b=p.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,S=Math.abs(n.clientWidth-m.clientWidth-b);S<=Tv&&(a-=S)}else f<=Tv&&(a+=f);return{width:a,height:c,x:l,y:d}}const ej=new Set(["absolute","fixed"]);function tj(r,e){const t=xa(r,!0,e==="fixed"),n=t.top+r.clientTop,s=t.left+r.clientLeft,a=ks(r)?bo(r):Ss(1),c=r.clientWidth*a.x,l=r.clientHeight*a.y,d=s*a.x,f=n*a.y;return{width:c,height:l,x:d,y:f}}function Av(r,e,t){let n;if(e==="viewport")n=ZN(r,t);else if(e==="document")n=JN(Ds(r));else if(cs(e))n=tj(e,t);else{const s=bw(r);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return Ql(n)}function ww(r,e){const t=Oi(r);return t===e||!cs(t)||wo(t)?!1:ls(t).position==="fixed"||ww(t,e)}function nj(r,e){const t=e.get(r);if(t)return t;let n=Lr(r,[],!1).filter(l=>cs(l)&&To(l)!=="body"),s=null;const a=ls(r).position==="fixed";let c=a?Oi(r):r;for(;cs(c)&&!wo(c);){const l=ls(c),d=Sp(c);!d&&l.position==="fixed"&&(s=null),(a?!d&&!s:!d&&l.position==="static"&&!!s&&ej.has(s.position)||Kr(c)&&!d&&ww(r,c))?n=n.filter(p=>p!==c):s=l,c=Oi(c)}return e.set(r,n),n}function sj(r){let{element:e,boundary:t,rootBoundary:n,strategy:s}=r;const c=[...t==="clippingAncestors"?yu(e)?[]:nj(e,this._c):[].concat(t),n],l=c[0],d=c.reduce((f,p)=>{const m=Av(e,p,s);return f.top=Dn(m.top,f.top),f.right=Ii(m.right,f.right),f.bottom=Ii(m.bottom,f.bottom),f.left=Dn(m.left,f.left),f},Av(e,l,s));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function ij(r){const{width:e,height:t}=vw(r);return{width:e,height:t}}function aj(r,e,t){const n=ks(e),s=Ds(e),a=t==="fixed",c=xa(r,!0,a,e);let l={scrollLeft:0,scrollTop:0};const d=Ss(0);function f(){d.x=bu(s)}if(n||!n&&!a)if((To(e)!=="body"||Kr(s))&&(l=vu(e)),n){const b=xa(e,!0,a,e);d.x=b.x+e.clientLeft,d.y=b.y+e.clientTop}else s&&f();a&&!n&&s&&f();const p=s&&!n&&!a?xw(s,l):Ss(0),m=c.left+l.scrollLeft-d.x-p.x,y=c.top+l.scrollTop-d.y-p.y;return{x:m,y,width:c.width,height:c.height}}function hh(r){return ls(r).position==="static"}function Dv(r,e){if(!ks(r)||ls(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return Ds(r)===t&&(t=t.ownerDocument.body),t}function Sw(r,e){const t=_n(r);if(yu(r))return t;if(!ks(r)){let s=Oi(r);for(;s&&!wo(s);){if(cs(s)&&!hh(s))return s;s=Oi(s)}return t}let n=Dv(r,e);for(;n&&UN(n)&&hh(n);)n=Dv(n,e);return n&&wo(n)&&hh(n)&&!Sp(n)?t:n||VN(r)||t}const oj=async function(r){const e=this.getOffsetParent||Sw,t=this.getDimensions,n=await t(r.floating);return{reference:aj(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function rj(r){return ls(r).direction==="rtl"}const cj={convertOffsetParentRelativeRectToViewportRelativeRect:WN,getDocumentElement:Ds,getClippingRect:sj,getOffsetParent:Sw,getElementRects:oj,getClientRects:XN,getDimensions:ij,getScale:bo,isElement:cs,isRTL:rj};function Mw(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function lj(r,e){let t=null,n;const s=Ds(r);function a(){var l;clearTimeout(n),(l=t)==null||l.disconnect(),t=null}function c(l,d){l===void 0&&(l=!1),d===void 0&&(d=1),a();const f=r.getBoundingClientRect(),{left:p,top:m,width:y,height:b}=f;if(l||e(),!y||!b)return;const S=xl(m),M=xl(s.clientWidth-(p+y)),E=xl(s.clientHeight-(m+b)),C=xl(p),k={rootMargin:-S+"px "+-M+"px "+-E+"px "+-C+"px",threshold:Dn(0,Ii(1,d))||1};let A=!0;function _(N){const L=N[0].intersectionRatio;if(L!==d){if(!A)return c();L?c(!1,L):n=setTimeout(()=>{c(!1,1e-7)},1e3)}L===1&&!Mw(f,r.getBoundingClientRect())&&c(),A=!1}try{t=new IntersectionObserver(_,{...k,root:s.ownerDocument})}catch{t=new IntersectionObserver(_,k)}t.observe(r)}return c(!0),a}function uj(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:a=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:d=!1}=n,f=Cp(r),p=s||a?[...f?Lr(f):[],...Lr(e)]:[];p.forEach(C=>{s&&C.addEventListener("scroll",t,{passive:!0}),a&&C.addEventListener("resize",t)});const m=f&&l?lj(f,t):null;let y=-1,b=null;c&&(b=new ResizeObserver(C=>{let[T]=C;T&&T.target===f&&b&&(b.unobserve(e),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var k;(k=b)==null||k.observe(e)})),t()}),f&&!d&&b.observe(f),b.observe(e));let S,M=d?xa(r):null;d&&E();function E(){const C=xa(r);M&&!Mw(M,C)&&t(),M=C,S=requestAnimationFrame(E)}return t(),()=>{var C;p.forEach(T=>{s&&T.removeEventListener("scroll",t),a&&T.removeEventListener("resize",t)}),m?.(),(C=b)==null||C.disconnect(),b=null,d&&cancelAnimationFrame(S)}}const dj=zN,fj=LN,hj=NN,pj=ON,gj=jN,_v=_N,mj=IN,yj=(r,e,t)=>{const n=new Map,s={platform:cj,...t},a={...s.platform,_c:n};return DN(r,e,{...s,platform:a})};var vj=typeof document<"u",bj=function(){},Dl=vj?w.useLayoutEffect:bj;function Vl(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="function"&&r.toString()===e.toString())return!0;let t,n,s;if(r&&e&&typeof r=="object"){if(Array.isArray(r)){if(t=r.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!Vl(r[n],e[n]))return!1;return!0}if(s=Object.keys(r),t=s.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=t;n--!==0;){const a=s[n];if(!(a==="_owner"&&r.$$typeof)&&!Vl(r[a],e[a]))return!1}return!0}return r!==r&&e!==e}function Cw(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function Nv(r,e){const t=Cw(r);return Math.round(e*t)/t}function ph(r){const e=w.useRef(r);return Dl(()=>{e.current=r}),e}function xj(r){r===void 0&&(r={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:s,elements:{reference:a,floating:c}={},transform:l=!0,whileElementsMounted:d,open:f}=r,[p,m]=w.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[y,b]=w.useState(n);Vl(y,n)||b(n);const[S,M]=w.useState(null),[E,C]=w.useState(null),T=w.useCallback(O=>{O!==N.current&&(N.current=O,M(O))},[]),k=w.useCallback(O=>{O!==L.current&&(L.current=O,C(O))},[]),A=a||S,_=c||E,N=w.useRef(null),L=w.useRef(null),q=w.useRef(p),Z=d!=null,se=ph(d),ce=ph(s),J=ph(f),te=w.useCallback(()=>{if(!N.current||!L.current)return;const O={placement:e,strategy:t,middleware:y};ce.current&&(O.platform=ce.current),yj(N.current,L.current,O).then(W=>{const he={...W,isPositioned:J.current!==!1};le.current&&!Vl(q.current,he)&&(q.current=he,qr.flushSync(()=>{m(he)}))})},[y,e,t,ce,J]);Dl(()=>{f===!1&&q.current.isPositioned&&(q.current.isPositioned=!1,m(O=>({...O,isPositioned:!1})))},[f]);const le=w.useRef(!1);Dl(()=>(le.current=!0,()=>{le.current=!1}),[]),Dl(()=>{if(A&&(N.current=A),_&&(L.current=_),A&&_){if(se.current)return se.current(A,_,te);te()}},[A,_,te,se,Z]);const ue=w.useMemo(()=>({reference:N,floating:L,setReference:T,setFloating:k}),[T,k]),z=w.useMemo(()=>({reference:A,floating:_}),[A,_]),j=w.useMemo(()=>{const O={position:t,left:0,top:0};if(!z.floating)return O;const W=Nv(z.floating,p.x),he=Nv(z.floating,p.y);return l?{...O,transform:"translate("+W+"px, "+he+"px)",...Cw(z.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:W,top:he}},[t,l,z.floating,p.x,p.y]);return w.useMemo(()=>({...p,update:te,refs:ue,elements:z,floatingStyles:j}),[p,te,ue,z,j])}const wj=r=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:r,fn(t){const{element:n,padding:s}=typeof r=="function"?r(t):r;return n&&e(n)?n.current!=null?_v({element:n.current,padding:s}).fn(t):{}:n?_v({element:n,padding:s}).fn(t):{}}}},Sj=(r,e)=>({...dj(r),options:[r,e]}),Mj=(r,e)=>({...fj(r),options:[r,e]}),Cj=(r,e)=>({...mj(r),options:[r,e]}),Ej=(r,e)=>({...hj(r),options:[r,e]}),Rj=(r,e)=>({...pj(r),options:[r,e]}),kj=(r,e)=>({...gj(r),options:[r,e]}),Tj=(r,e)=>({...wj(r),options:[r,e]});var Aj="Arrow",Ew=w.forwardRef((r,e)=>{const{children:t,width:n=10,height:s=5,...a}=r;return g.jsx(Ae.svg,{...a,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?t:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});Ew.displayName=Aj;var Dj=Ew;function xu(r){const[e,t]=w.useState(void 0);return rn(()=>{if(r){t({width:r.offsetWidth,height:r.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const a=s[0];let c,l;if("borderBoxSize"in a){const d=a.borderBoxSize,f=Array.isArray(d)?d[0]:d;c=f.inlineSize,l=f.blockSize}else c=r.offsetWidth,l=r.offsetHeight;t({width:c,height:l})});return n.observe(r,{box:"border-box"}),()=>n.unobserve(r)}else t(void 0)},[r]),e}var Ep="Popper",[Rw,Ao]=Sn(Ep),[_j,kw]=Rw(Ep),Tw=r=>{const{__scopePopper:e,children:t}=r,[n,s]=w.useState(null);return g.jsx(_j,{scope:e,anchor:n,onAnchorChange:s,children:t})};Tw.displayName=Ep;var Aw="PopperAnchor",Dw=w.forwardRef((r,e)=>{const{__scopePopper:t,virtualRef:n,...s}=r,a=kw(Aw,t),c=w.useRef(null),l=je(e,c),d=w.useRef(null);return w.useEffect(()=>{const f=d.current;d.current=n?.current||c.current,f!==d.current&&a.onAnchorChange(d.current)}),n?null:g.jsx(Ae.div,{...s,ref:l})});Dw.displayName=Aw;var Rp="PopperContent",[Nj,jj]=Rw(Rp),_w=w.forwardRef((r,e)=>{const{__scopePopper:t,side:n="bottom",sideOffset:s=0,align:a="center",alignOffset:c=0,arrowPadding:l=0,avoidCollisions:d=!0,collisionBoundary:f=[],collisionPadding:p=0,sticky:m="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:S,...M}=r,E=kw(Rp,t),[C,T]=w.useState(null),k=je(e,$=>T($)),[A,_]=w.useState(null),N=xu(A),L=N?.width??0,q=N?.height??0,Z=n+(a!=="center"?"-"+a:""),se=typeof p=="number"?p:{top:0,right:0,bottom:0,left:0,...p},ce=Array.isArray(f)?f:[f],J=ce.length>0,te={padding:se,boundary:ce.filter(zj),altBoundary:J},{refs:le,floatingStyles:ue,placement:z,isPositioned:j,middlewareData:O}=xj({strategy:"fixed",placement:Z,whileElementsMounted:(...$)=>uj(...$,{animationFrame:b==="always"}),elements:{reference:E.anchor},middleware:[Sj({mainAxis:s+q,alignmentAxis:c}),d&&Mj({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?Cj():void 0,...te}),d&&Ej({...te}),Rj({...te,apply:({elements:$,rects:G,availableWidth:pe,availableHeight:me})=>{const{width:ye,height:ve}=G.reference,Pe=$.floating.style;Pe.setProperty("--radix-popper-available-width",`${pe}px`),Pe.setProperty("--radix-popper-available-height",`${me}px`),Pe.setProperty("--radix-popper-anchor-width",`${ye}px`),Pe.setProperty("--radix-popper-anchor-height",`${ve}px`)}}),A&&Tj({element:A,padding:l}),Lj({arrowWidth:L,arrowHeight:q}),y&&kj({strategy:"referenceHidden",...te})]}),[W,he]=Pw(z),P=on(S);rn(()=>{j&&P?.()},[j,P]);const F=O.arrow?.x,Y=O.arrow?.y,ie=O.arrow?.centerOffset!==0,[B,ae]=w.useState();return rn(()=>{C&&ae(window.getComputedStyle(C).zIndex)},[C]),g.jsx("div",{ref:le.setFloating,"data-radix-popper-content-wrapper":"",style:{...ue,transform:j?ue.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:B,"--radix-popper-transform-origin":[O.transformOrigin?.x,O.transformOrigin?.y].join(" "),...O.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:g.jsx(Nj,{scope:t,placedSide:W,onArrowChange:_,arrowX:F,arrowY:Y,shouldHideArrow:ie,children:g.jsx(Ae.div,{"data-side":W,"data-align":he,...M,ref:k,style:{...M.style,animation:j?void 0:"none"}})})})});_w.displayName=Rp;var Nw="PopperArrow",Pj={top:"bottom",right:"left",bottom:"top",left:"right"},jw=w.forwardRef(function(e,t){const{__scopePopper:n,...s}=e,a=jj(Nw,n),c=Pj[a.placedSide];return g.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[c]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:g.jsx(Dj,{...s,ref:t,style:{...s.style,display:"block"}})})});jw.displayName=Nw;function zj(r){return r!==null}var Lj=r=>({name:"transformOrigin",options:r,fn(e){const{placement:t,rects:n,middlewareData:s}=e,c=s.arrow?.centerOffset!==0,l=c?0:r.arrowWidth,d=c?0:r.arrowHeight,[f,p]=Pw(t),m={start:"0%",center:"50%",end:"100%"}[p],y=(s.arrow?.x??0)+l/2,b=(s.arrow?.y??0)+d/2;let S="",M="";return f==="bottom"?(S=c?m:`${y}px`,M=`${-d}px`):f==="top"?(S=c?m:`${y}px`,M=`${n.floating.height+d}px`):f==="right"?(S=`${-d}px`,M=c?m:`${b}px`):f==="left"&&(S=`${n.floating.width+d}px`,M=c?m:`${b}px`),{data:{x:S,y:M}}}});function Pw(r){const[e,t="center"]=r.split("-");return[e,t]}var kp=Tw,wu=Dw,Tp=_w,Ap=jw;function Ij(r){const e=Oj(r),t=w.forwardRef((n,s)=>{const{children:a,...c}=n,l=w.Children.toArray(a),d=l.find(qj);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}function Oj(r){const e=w.forwardRef((t,n)=>{const{children:s,...a}=t;if(w.isValidElement(s)){const c=$j(s),l=Uj(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var Hj=Symbol("radix.slottable");function qj(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Hj}function Uj(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function $j(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var Th=["Enter"," "],Bj=["ArrowDown","PageUp","Home"],zw=["ArrowUp","PageDown","End"],Fj=[...Bj,...zw],Qj={ltr:[...Th,"ArrowRight"],rtl:[...Th,"ArrowLeft"]},Vj={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Yr="Menu",[Ir,Gj,Kj]=fu(Yr),[Ma,Lw]=Sn(Yr,[Kj,Ao,hu]),Su=Ao(),Iw=hu(),[Yj,Ca]=Ma(Yr),[Wj,Wr]=Ma(Yr),Ow=r=>{const{__scopeMenu:e,open:t=!1,children:n,dir:s,onOpenChange:a,modal:c=!0}=r,l=Su(e),[d,f]=w.useState(null),p=w.useRef(!1),m=on(a),y=Ro(s);return w.useEffect(()=>{const b=()=>{p.current=!0,document.addEventListener("pointerdown",S,{capture:!0,once:!0}),document.addEventListener("pointermove",S,{capture:!0,once:!0})},S=()=>p.current=!1;return document.addEventListener("keydown",b,{capture:!0}),()=>{document.removeEventListener("keydown",b,{capture:!0}),document.removeEventListener("pointerdown",S,{capture:!0}),document.removeEventListener("pointermove",S,{capture:!0})}},[]),g.jsx(kp,{...l,children:g.jsx(Yj,{scope:e,open:t,onOpenChange:m,content:d,onContentChange:f,children:g.jsx(Wj,{scope:e,onClose:w.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:p,dir:y,modal:c,children:n})})})};Ow.displayName=Yr;var Xj="MenuAnchor",Dp=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,s=Su(t);return g.jsx(wu,{...s,...n,ref:e})});Dp.displayName=Xj;var _p="MenuPortal",[Jj,Hw]=Ma(_p,{forceMount:void 0}),qw=r=>{const{__scopeMenu:e,forceMount:t,children:n,container:s}=r,a=Ca(_p,e);return g.jsx(Jj,{scope:e,forceMount:t,children:g.jsx(ln,{present:t||a.open,children:g.jsx(Qr,{asChild:!0,container:s,children:n})})})};qw.displayName=_p;var Yn="MenuContent",[Zj,Np]=Ma(Yn),Uw=w.forwardRef((r,e)=>{const t=Hw(Yn,r.__scopeMenu),{forceMount:n=t.forceMount,...s}=r,a=Ca(Yn,r.__scopeMenu),c=Wr(Yn,r.__scopeMenu);return g.jsx(Ir.Provider,{scope:r.__scopeMenu,children:g.jsx(ln,{present:n||a.open,children:g.jsx(Ir.Slot,{scope:r.__scopeMenu,children:c.modal?g.jsx(eP,{...s,ref:e}):g.jsx(tP,{...s,ref:e})})})})}),eP=w.forwardRef((r,e)=>{const t=Ca(Yn,r.__scopeMenu),n=w.useRef(null),s=je(e,n);return w.useEffect(()=>{const a=n.current;if(a)return au(a)},[]),g.jsx(jp,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ge(r.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),tP=w.forwardRef((r,e)=>{const t=Ca(Yn,r.__scopeMenu);return g.jsx(jp,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),nP=Ij("MenuContent.ScrollLock"),jp=w.forwardRef((r,e)=>{const{__scopeMenu:t,loop:n=!1,trapFocus:s,onOpenAutoFocus:a,onCloseAutoFocus:c,disableOutsidePointerEvents:l,onEntryFocus:d,onEscapeKeyDown:f,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:y,onDismiss:b,disableOutsideScroll:S,...M}=r,E=Ca(Yn,t),C=Wr(Yn,t),T=Su(t),k=Iw(t),A=Gj(t),[_,N]=w.useState(null),L=w.useRef(null),q=je(e,L,E.onContentChange),Z=w.useRef(0),se=w.useRef(""),ce=w.useRef(0),J=w.useRef(null),te=w.useRef("right"),le=w.useRef(0),ue=S?Vr:w.Fragment,z=S?{as:nP,allowPinchZoom:!0}:void 0,j=W=>{const he=se.current+W,P=A().filter($=>!$.disabled),F=document.activeElement,Y=P.find($=>$.ref.current===F)?.textValue,ie=P.map($=>$.textValue),B=pP(ie,he,Y),ae=P.find($=>$.textValue===B)?.ref.current;(function $(G){se.current=G,window.clearTimeout(Z.current),G!==""&&(Z.current=window.setTimeout(()=>$(""),1e3))})(he),ae&&setTimeout(()=>ae.focus())};w.useEffect(()=>()=>window.clearTimeout(Z.current),[]),su();const O=w.useCallback(W=>te.current===J.current?.side&&mP(W,J.current?.area),[]);return g.jsx(Zj,{scope:t,searchRef:se,onItemEnter:w.useCallback(W=>{O(W)&&W.preventDefault()},[O]),onItemLeave:w.useCallback(W=>{O(W)||(L.current?.focus(),N(null))},[O]),onTriggerLeave:w.useCallback(W=>{O(W)&&W.preventDefault()},[O]),pointerGraceTimerRef:ce,onPointerGraceIntentChange:w.useCallback(W=>{J.current=W},[]),children:g.jsx(ue,{...z,children:g.jsx(Fr,{asChild:!0,trapped:s,onMountAutoFocus:ge(a,W=>{W.preventDefault(),L.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:c,children:g.jsx(Br,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:f,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:y,onDismiss:b,children:g.jsx(Zx,{asChild:!0,...k,dir:C.dir,orientation:"vertical",loop:n,currentTabStopId:_,onCurrentTabStopIdChange:N,onEntryFocus:ge(d,W=>{C.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(Tp,{role:"menu","aria-orientation":"vertical","data-state":sS(E.open),"data-radix-menu-content":"",dir:C.dir,...T,...M,ref:q,style:{outline:"none",...M.style},onKeyDown:ge(M.onKeyDown,W=>{const P=W.target.closest("[data-radix-menu-content]")===W.currentTarget,F=W.ctrlKey||W.altKey||W.metaKey,Y=W.key.length===1;P&&(W.key==="Tab"&&W.preventDefault(),!F&&Y&&j(W.key));const ie=L.current;if(W.target!==ie||!Fj.includes(W.key))return;W.preventDefault();const ae=A().filter($=>!$.disabled).map($=>$.ref.current);zw.includes(W.key)&&ae.reverse(),fP(ae)}),onBlur:ge(r.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(Z.current),se.current="")}),onPointerMove:ge(r.onPointerMove,Or(W=>{const he=W.target,P=le.current!==W.clientX;if(W.currentTarget.contains(he)&&P){const F=W.clientX>le.current?"right":"left";te.current=F,le.current=W.clientX}}))})})})})})})});Uw.displayName=Yn;var sP="MenuGroup",Pp=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return g.jsx(Ae.div,{role:"group",...n,ref:e})});Pp.displayName=sP;var iP="MenuLabel",$w=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return g.jsx(Ae.div,{...n,ref:e})});$w.displayName=iP;var Gl="MenuItem",jv="menu.itemSelect",Mu=w.forwardRef((r,e)=>{const{disabled:t=!1,onSelect:n,...s}=r,a=w.useRef(null),c=Wr(Gl,r.__scopeMenu),l=Np(Gl,r.__scopeMenu),d=je(e,a),f=w.useRef(!1),p=()=>{const m=a.current;if(!t&&m){const y=new CustomEvent(jv,{bubbles:!0,cancelable:!0});m.addEventListener(jv,b=>n?.(b),{once:!0}),Nb(m,y),y.defaultPrevented?f.current=!1:c.onClose()}};return g.jsx(Bw,{...s,ref:d,disabled:t,onClick:ge(r.onClick,p),onPointerDown:m=>{r.onPointerDown?.(m),f.current=!0},onPointerUp:ge(r.onPointerUp,m=>{f.current||m.currentTarget?.click()}),onKeyDown:ge(r.onKeyDown,m=>{const y=l.searchRef.current!=="";t||y&&m.key===" "||Th.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Mu.displayName=Gl;var Bw=w.forwardRef((r,e)=>{const{__scopeMenu:t,disabled:n=!1,textValue:s,...a}=r,c=Np(Gl,t),l=Iw(t),d=w.useRef(null),f=je(e,d),[p,m]=w.useState(!1),[y,b]=w.useState("");return w.useEffect(()=>{const S=d.current;S&&b((S.textContent??"").trim())},[a.children]),g.jsx(Ir.ItemSlot,{scope:t,disabled:n,textValue:s??y,children:g.jsx(ew,{asChild:!0,...l,focusable:!n,children:g.jsx(Ae.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...a,ref:f,onPointerMove:ge(r.onPointerMove,Or(S=>{n?c.onItemLeave(S):(c.onItemEnter(S),S.defaultPrevented||S.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ge(r.onPointerLeave,Or(S=>c.onItemLeave(S))),onFocus:ge(r.onFocus,()=>m(!0)),onBlur:ge(r.onBlur,()=>m(!1))})})})}),aP="MenuCheckboxItem",Fw=w.forwardRef((r,e)=>{const{checked:t=!1,onCheckedChange:n,...s}=r;return g.jsx(Yw,{scope:r.__scopeMenu,checked:t,children:g.jsx(Mu,{role:"menuitemcheckbox","aria-checked":Kl(t)?"mixed":t,...s,ref:e,"data-state":Lp(t),onSelect:ge(s.onSelect,()=>n?.(Kl(t)?!0:!t),{checkForDefaultPrevented:!1})})})});Fw.displayName=aP;var Qw="MenuRadioGroup",[oP,rP]=Ma(Qw,{value:void 0,onValueChange:()=>{}}),Vw=w.forwardRef((r,e)=>{const{value:t,onValueChange:n,...s}=r,a=on(n);return g.jsx(oP,{scope:r.__scopeMenu,value:t,onValueChange:a,children:g.jsx(Pp,{...s,ref:e})})});Vw.displayName=Qw;var Gw="MenuRadioItem",Kw=w.forwardRef((r,e)=>{const{value:t,...n}=r,s=rP(Gw,r.__scopeMenu),a=t===s.value;return g.jsx(Yw,{scope:r.__scopeMenu,checked:a,children:g.jsx(Mu,{role:"menuitemradio","aria-checked":a,...n,ref:e,"data-state":Lp(a),onSelect:ge(n.onSelect,()=>s.onValueChange?.(t),{checkForDefaultPrevented:!1})})})});Kw.displayName=Gw;var zp="MenuItemIndicator",[Yw,cP]=Ma(zp,{checked:!1}),Ww=w.forwardRef((r,e)=>{const{__scopeMenu:t,forceMount:n,...s}=r,a=cP(zp,t);return g.jsx(ln,{present:n||Kl(a.checked)||a.checked===!0,children:g.jsx(Ae.span,{...s,ref:e,"data-state":Lp(a.checked)})})});Ww.displayName=zp;var lP="MenuSeparator",Xw=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return g.jsx(Ae.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});Xw.displayName=lP;var uP="MenuArrow",Jw=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,s=Su(t);return g.jsx(Ap,{...s,...n,ref:e})});Jw.displayName=uP;var dP="MenuSub",[GO,Zw]=Ma(dP),kr="MenuSubTrigger",eS=w.forwardRef((r,e)=>{const t=Ca(kr,r.__scopeMenu),n=Wr(kr,r.__scopeMenu),s=Zw(kr,r.__scopeMenu),a=Np(kr,r.__scopeMenu),c=w.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:d}=a,f={__scopeMenu:r.__scopeMenu},p=w.useCallback(()=>{c.current&&window.clearTimeout(c.current),c.current=null},[]);return w.useEffect(()=>p,[p]),w.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),d(null)}},[l,d]),g.jsx(Dp,{asChild:!0,...f,children:g.jsx(Bw,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":s.contentId,"data-state":sS(t.open),...r,ref:Ts(e,s.onTriggerChange),onClick:m=>{r.onClick?.(m),!(r.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ge(r.onPointerMove,Or(m=>{a.onItemEnter(m),!m.defaultPrevented&&!r.disabled&&!t.open&&!c.current&&(a.onPointerGraceIntentChange(null),c.current=window.setTimeout(()=>{t.onOpenChange(!0),p()},100))})),onPointerLeave:ge(r.onPointerLeave,Or(m=>{p();const y=t.content?.getBoundingClientRect();if(y){const b=t.content?.dataset.side,S=b==="right",M=S?-5:5,E=y[S?"left":"right"],C=y[S?"right":"left"];a.onPointerGraceIntentChange({area:[{x:m.clientX+M,y:m.clientY},{x:E,y:y.top},{x:C,y:y.top},{x:C,y:y.bottom},{x:E,y:y.bottom}],side:b}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(m),m.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:ge(r.onKeyDown,m=>{const y=a.searchRef.current!=="";r.disabled||y&&m.key===" "||Qj[n.dir].includes(m.key)&&(t.onOpenChange(!0),t.content?.focus(),m.preventDefault())})})})});eS.displayName=kr;var tS="MenuSubContent",nS=w.forwardRef((r,e)=>{const t=Hw(Yn,r.__scopeMenu),{forceMount:n=t.forceMount,...s}=r,a=Ca(Yn,r.__scopeMenu),c=Wr(Yn,r.__scopeMenu),l=Zw(tS,r.__scopeMenu),d=w.useRef(null),f=je(e,d);return g.jsx(Ir.Provider,{scope:r.__scopeMenu,children:g.jsx(ln,{present:n||a.open,children:g.jsx(Ir.Slot,{scope:r.__scopeMenu,children:g.jsx(jp,{id:l.contentId,"aria-labelledby":l.triggerId,...s,ref:f,align:"start",side:c.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:p=>{c.isUsingKeyboardRef.current&&d.current?.focus(),p.preventDefault()},onCloseAutoFocus:p=>p.preventDefault(),onFocusOutside:ge(r.onFocusOutside,p=>{p.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:ge(r.onEscapeKeyDown,p=>{c.onClose(),p.preventDefault()}),onKeyDown:ge(r.onKeyDown,p=>{const m=p.currentTarget.contains(p.target),y=Vj[c.dir].includes(p.key);m&&y&&(a.onOpenChange(!1),l.trigger?.focus(),p.preventDefault())})})})})})});nS.displayName=tS;function sS(r){return r?"open":"closed"}function Kl(r){return r==="indeterminate"}function Lp(r){return Kl(r)?"indeterminate":r?"checked":"unchecked"}function fP(r){const e=document.activeElement;for(const t of r)if(t===e||(t.focus(),document.activeElement!==e))return}function hP(r,e){return r.map((t,n)=>r[(e+n)%r.length])}function pP(r,e,t){const s=e.length>1&&Array.from(e).every(f=>f===e[0])?e[0]:e,a=t?r.indexOf(t):-1;let c=hP(r,Math.max(a,0));s.length===1&&(c=c.filter(f=>f!==t));const d=c.find(f=>f.toLowerCase().startsWith(s.toLowerCase()));return d!==t?d:void 0}function gP(r,e){const{x:t,y:n}=r;let s=!1;for(let a=0,c=e.length-1;a<e.length;c=a++){const l=e[a],d=e[c],f=l.x,p=l.y,m=d.x,y=d.y;p>n!=y>n&&t<(m-f)*(n-p)/(y-p)+f&&(s=!s)}return s}function mP(r,e){if(!e)return!1;const t={x:r.clientX,y:r.clientY};return gP(t,e)}function Or(r){return e=>e.pointerType==="mouse"?r(e):void 0}var yP=Ow,vP=Dp,bP=qw,xP=Uw,wP=Pp,SP=$w,MP=Mu,CP=Fw,EP=Vw,RP=Kw,kP=Ww,TP=Xw,AP=Jw,DP=eS,_P=nS,Cu="DropdownMenu",[NP]=Sn(Cu,[Lw]),hn=Lw(),[jP,iS]=NP(Cu),aS=r=>{const{__scopeDropdownMenu:e,children:t,dir:n,open:s,defaultOpen:a,onOpenChange:c,modal:l=!0}=r,d=hn(e),f=w.useRef(null),[p,m]=Rs({prop:s,defaultProp:a??!1,onChange:c,caller:Cu});return g.jsx(jP,{scope:e,triggerId:rs(),triggerRef:f,contentId:rs(),open:p,onOpenChange:m,onOpenToggle:w.useCallback(()=>m(y=>!y),[m]),modal:l,children:g.jsx(yP,{...d,open:p,onOpenChange:m,dir:n,modal:l,children:t})})};aS.displayName=Cu;var oS="DropdownMenuTrigger",rS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,disabled:n=!1,...s}=r,a=iS(oS,t),c=hn(t);return g.jsx(vP,{asChild:!0,...c,children:g.jsx(Ae.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:Ts(e,a.triggerRef),onPointerDown:ge(r.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:ge(r.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});rS.displayName=oS;var PP="DropdownMenuPortal",cS=r=>{const{__scopeDropdownMenu:e,...t}=r,n=hn(e);return g.jsx(bP,{...n,...t})};cS.displayName=PP;var lS="DropdownMenuContent",uS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=iS(lS,t),a=hn(t),c=w.useRef(!1);return g.jsx(xP,{id:s.contentId,"aria-labelledby":s.triggerId,...a,...n,ref:e,onCloseAutoFocus:ge(r.onCloseAutoFocus,l=>{c.current||s.triggerRef.current?.focus(),c.current=!1,l.preventDefault()}),onInteractOutside:ge(r.onInteractOutside,l=>{const d=l.detail.originalEvent,f=d.button===0&&d.ctrlKey===!0,p=d.button===2||f;(!s.modal||p)&&(c.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});uS.displayName=lS;var zP="DropdownMenuGroup",LP=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(wP,{...s,...n,ref:e})});LP.displayName=zP;var IP="DropdownMenuLabel",dS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(SP,{...s,...n,ref:e})});dS.displayName=IP;var OP="DropdownMenuItem",fS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(MP,{...s,...n,ref:e})});fS.displayName=OP;var HP="DropdownMenuCheckboxItem",hS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(CP,{...s,...n,ref:e})});hS.displayName=HP;var qP="DropdownMenuRadioGroup",UP=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(EP,{...s,...n,ref:e})});UP.displayName=qP;var $P="DropdownMenuRadioItem",pS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(RP,{...s,...n,ref:e})});pS.displayName=$P;var BP="DropdownMenuItemIndicator",gS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(kP,{...s,...n,ref:e})});gS.displayName=BP;var FP="DropdownMenuSeparator",mS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(TP,{...s,...n,ref:e})});mS.displayName=FP;var QP="DropdownMenuArrow",VP=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(AP,{...s,...n,ref:e})});VP.displayName=QP;var GP="DropdownMenuSubTrigger",yS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(DP,{...s,...n,ref:e})});yS.displayName=GP;var KP="DropdownMenuSubContent",vS=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=hn(t);return g.jsx(_P,{...s,...n,ref:e,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});vS.displayName=KP;var YP=aS,WP=rS,XP=cS,bS=uS,xS=dS,wS=fS,SS=hS,MS=pS,CS=gS,ES=mS,RS=yS,kS=vS;const JP=YP,ZP=WP,ez=w.forwardRef(({className:r,inset:e,children:t,...n},s)=>g.jsxs(RS,{ref:s,className:Re("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",r),...n,children:[t,g.jsx(Wh,{className:"ml-auto"})]}));ez.displayName=RS.displayName;const tz=w.forwardRef(({className:r,...e},t)=>g.jsx(kS,{ref:t,className:Re("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",r),...e}));tz.displayName=kS.displayName;const TS=w.forwardRef(({className:r,sideOffset:e=4,...t},n)=>g.jsx(XP,{children:g.jsx(bS,{ref:n,sideOffset:e,className:Re("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",r),...t})}));TS.displayName=bS.displayName;const _l=w.forwardRef(({className:r,inset:e,...t},n)=>g.jsx(wS,{ref:n,className:Re("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",e&&"pl-8",r),...t}));_l.displayName=wS.displayName;const nz=w.forwardRef(({className:r,children:e,checked:t,...n},s)=>g.jsxs(SS,{ref:s,className:Re("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:t,...n,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(CS,{children:g.jsx(Yh,{className:"h-4 w-4"})})}),e]}));nz.displayName=SS.displayName;const sz=w.forwardRef(({className:r,children:e,...t},n)=>g.jsxs(MS,{ref:n,className:Re("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(CS,{children:g.jsx(EA,{className:"h-2 w-2 fill-current"})})}),e]}));sz.displayName=MS.displayName;const Ah=w.forwardRef(({className:r,inset:e,...t},n)=>g.jsx(xS,{ref:n,className:Re("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",r),...t}));Ah.displayName=xS.displayName;const AS=w.forwardRef(({className:r,...e},t)=>g.jsx(ES,{ref:t,className:Re("-mx-1 my-1 h-px bg-muted",r),...e}));AS.displayName=ES.displayName;const DS="archiphoenix_component_library",Pv=()=>{if(typeof window>"u")return{favorites:[],collections:[]};try{const r=window.localStorage.getItem(DS);if(!r)return{favorites:[],collections:[]};const e=JSON.parse(r);return{favorites:Array.isArray(e.favorites)?e.favorites:[],collections:Array.isArray(e.collections)?e.collections:[]}}catch(r){return bb("Failed to load component library state",r instanceof Error?r:new Error(String(r))),{favorites:[],collections:[]}}},go=r=>{typeof window>"u"||window.localStorage.setItem(DS,JSON.stringify(r))},iz=us((r,e)=>({favorites:Pv().favorites,collections:Pv().collections,toggleFavorite:t=>{r(n=>{const a=n.favorites.includes(t)?n.favorites.filter(c=>c!==t):[...n.favorites,t];return go({favorites:a,collections:n.collections}),{favorites:a}})},createCollection:t=>{const n=t.trim();if(!n)return null;const s={id:`collection-${Date.now()}`,name:n,componentIds:[]};return r(a=>{const c=[...a.collections,s];return go({favorites:a.favorites,collections:c}),{collections:c}}),s.id},renameCollection:(t,n)=>{r(s=>{const a=s.collections.map(c=>c.id===t?{...c,name:n}:c);return go({favorites:s.favorites,collections:a}),{collections:a}})},deleteCollection:t=>{r(n=>{const s=n.collections.filter(a=>a.id!==t);return go({favorites:n.favorites,collections:s}),{collections:s}})},addComponentToCollection:(t,n)=>{r(s=>{const a=s.collections.map(c=>c.id!==t||c.componentIds.includes(n)?c:{...c,componentIds:[...c.componentIds,n]});return go({favorites:s.favorites,collections:a}),{collections:a}})},removeComponentFromCollection:(t,n)=>{r(s=>{const a=s.collections.map(c=>c.id!==t?c:{...c,componentIds:c.componentIds.filter(l=>l!==n)});return go({favorites:s.favorites,collections:a}),{collections:a}})}}));function zv({open:r,initialName:e="",onConfirm:t,onCancel:n}){const[s,a]=w.useState(e);w.useEffect(()=>{r&&a(e)},[r,e]);const c=()=>{s.trim()&&t(s.trim())};return g.jsx(gp,{open:r,onOpenChange:l=>!l&&n(),children:g.jsxs(ru,{children:[g.jsxs(cu,{children:[g.jsx(uu,{children:e?"Rename Collection":"Create Collection"}),g.jsx(du,{children:e?"Enter a new name for the collection":"Enter a name for the new collection"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(st,{htmlFor:"collection-name",children:"Collection Name"}),g.jsx(Tt,{id:"collection-name",value:s,onChange:l=>a(l.target.value),onKeyDown:l=>{l.key==="Enter"&&c()},className:"mt-2",autoFocus:!0})]}),g.jsxs(lu,{children:[g.jsx(ke,{variant:"outline",onClick:n,children:"Cancel"}),g.jsx(ke,{onClick:c,disabled:!s.trim(),children:e?"Save":"Create"})]})]})})}function az(){const[r,e]=w.useState(""),[t,n]=w.useState("all"),[s,a]=w.useState(!1),[c,l]=w.useState(!1),[d,f]=w.useState(null),[p,m]=w.useState(null),[y,b]=w.useState(180),[S,M]=w.useState(!1),E=w.useRef(null),[C,T]=w.useState(()=>{const B=localStorage.getItem("sidebar-expanded-categories");if(B)try{const ae=JSON.parse(B);return Cr.reduce(($,G)=>($[G.id]=ae[G.id]!==void 0?ae[G.id]:!0,$),{})}catch{}return Cr.reduce((ae,$)=>(ae[$.id]=!0,ae),{})}),{favorites:k,collections:A,toggleFavorite:_,createCollection:N,renameCollection:L,deleteCollection:q,addComponentToCollection:Z,removeComponentFromCollection:se}=iz(),ce=B=>{T(ae=>({...ae,[B]:!ae[B]}))},J=r.toLowerCase(),te=w.useMemo(()=>Pr.filter(B=>B.label.toLowerCase().includes(J)),[J]),le=w.useMemo(()=>te.filter(B=>k.includes(B.id)),[k,te]),ue=(B,ae)=>{B.dataTransfer.setData("application/json",JSON.stringify(ae)),B.dataTransfer.effectAllowed="copy"},z=()=>{f(null),a(!0)},j=B=>{if(d)L(d.id,B),f(null);else{if(A.some(G=>G.name.toLowerCase()===B.toLowerCase())){alert("A collection with this name already exists");return}N(B)||alert("Failed to create collection")}a(!1)},O=()=>{a(!1),f(null)},W=B=>{m(B),f(null),l(!0)},he=B=>{if(!p)return;if(A.some(G=>G.name.toLowerCase()===B.toLowerCase())){alert("A collection with this name already exists");return}const $=N(B);$?Z($,p):alert("Failed to create collection"),l(!1),m(null)},P=()=>{l(!1),m(null)},F=B=>{f(B),a(!0)};w.useEffect(()=>{localStorage.setItem("sidebar-expanded-categories",JSON.stringify(C))},[C]),w.useEffect(()=>{if(!S)return;const B=$=>{if(!E.current)return;const G=E.current.closest(".h-full");if(!G)return;const pe=G.getBoundingClientRect();E.current.getBoundingClientRect();const me=pe.bottom-$.clientY,ye=70,ve=pe.height*.8;b(Math.max(ye,Math.min(ve,me)))},ae=()=>{M(!1)};return document.addEventListener("mousemove",B),document.addEventListener("mouseup",ae),()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",ae)}},[S]);const Y=(B,ae)=>{const $=k.includes(B.id);return g.jsxs("div",{draggable:!0,onDragStart:G=>ue(G,B),className:`flex items-center gap-1 px-1 ${ae?.compact?"py-0.5 text-[10px]":"py-1 text-xs"} rounded-md bg-secondary/50 hover:bg-secondary cursor-move transition-colors border border-border/50`,children:[g.jsxs("div",{className:"flex items-center gap-0.5 flex-1 min-w-0",children:[g.jsx("span",{className:"text-sm flex-shrink-0",children:B.icon}),g.jsx("span",{className:"text-foreground truncate min-w-0",children:B.label})]}),g.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[g.jsx("button",{type:"button",onClick:G=>{G.preventDefault(),G.stopPropagation(),_(B.id)},onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:$?"Remove from favorites":"Add to favorites",children:g.jsx(yD,{className:`h-4 w-4 ${$?"text-yellow-400":"text-muted-foreground"}`,fill:$?"currentColor":"none"})}),g.jsxs(JP,{children:[g.jsx(ZP,{asChild:!0,children:g.jsx("button",{type:"button",onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Add to collection",children:g.jsx(Hl,{className:"h-4 w-4 text-muted-foreground"})})}),g.jsxs(TS,{align:"end",className:"w-48",children:[A.length===0&&g.jsxs(g.Fragment,{children:[g.jsx(Ah,{children:"No collections"}),g.jsxs(_l,{onSelect:G=>{G.preventDefault(),W(B.id)},children:[g.jsx(xh,{className:"h-4 w-4 mr-2"}),"Create and add"]})]}),A.length>0&&g.jsxs(g.Fragment,{children:[g.jsx(Ah,{children:"Add to collection"}),A.map(G=>g.jsx(_l,{onSelect:pe=>{pe.preventDefault(),Z(G.id,B.id)},children:G.name},G.id)),g.jsx(AS,{}),g.jsxs(_l,{onSelect:G=>{G.preventDefault(),W(B.id)},children:[g.jsx(xh,{className:"h-4 w-4 mr-2"}),"New collection"]})]})]})]}),ae?.onRemove&&g.jsx("button",{type:"button",onClick:G=>{G.preventDefault(),G.stopPropagation(),ae.onRemove?.()},onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Remove from collection",children:g.jsx(os,{className:"h-4 w-4 text-muted-foreground"})})]})]},`${B.id}-${ae?.compact?"compact":"default"}`)},ie=t==="all"?Cr:Cr.filter(B=>B.id===t);return g.jsxs("div",{className:"w-60 h-full bg-sidebar-bg border-r border-border flex flex-col",children:[g.jsxs("div",{className:"p-3 border-b border-border",children:[g.jsx("h2",{className:"text-xs font-semibold text-foreground mb-2",children:"Components"}),g.jsxs("div",{className:"relative",children:[g.jsx(Ur,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),g.jsx(Tt,{type:"text",placeholder:"Search...",value:r,onChange:B=>e(B.target.value),className:"pl-7 h-8 text-xs"})]})]}),g.jsx("div",{className:"px-3 py-1.5 border-b border-border pb-2",children:g.jsx(vp,{value:t,onValueChange:n,children:g.jsxs(an,{orientation:"horizontal",className:"w-full",children:[g.jsxs(gu,{className:"flex w-max gap-0.5",children:[g.jsx(ss,{value:"all",className:"text-xs px-2 py-1",children:"All"}),Cr.map(B=>g.jsx(ss,{value:B.id,className:"text-xs px-2 py-1",children:B.icon},B.id))]}),g.jsx(nu,{orientation:"horizontal",className:"data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30 [&>[data-radix-scroll-area-thumb]]:bg-accent/80 hover:[&>[data-radix-scroll-area-thumb]]:bg-accent rounded-full",style:{transition:"none"}})]})})}),le.length>0&&g.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsx("span",{className:"text-[10px] font-semibold uppercase text-muted-foreground",children:"Favorites"}),g.jsx("span",{className:"text-[10px] text-muted-foreground",children:le.length})]}),g.jsx("div",{className:"space-y-1",children:le.map(B=>Y(B,{compact:!0}))})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"pl-3 pr-6 py-2",children:ie.map(B=>{const ae=te.filter($=>$.category===B.id);return ae.length===0&&r?null:g.jsxs("div",{className:"mb-1.5",children:[g.jsxs(ke,{variant:"ghost",className:"w-full justify-start px-1 h-7 text-xs",onClick:()=>ce(B.id),children:[C[B.id]?g.jsx(Jl,{className:"h-3.5 w-3.5 mr-0.5"}):g.jsx(Wh,{className:"h-3.5 w-3.5 mr-0.5"}),g.jsx("span",{className:"mr-1",children:B.icon}),g.jsx("span",{className:"flex-1 text-left truncate min-w-0 mr-1",children:B.label}),g.jsx("span",{className:"text-[10px] text-muted-foreground flex-shrink-0",children:ae.length})]}),C[B.id]&&g.jsx("div",{className:"ml-1.5 mt-1 space-y-1",children:ae.map($=>Y($,{compact:!0}))})]},B.id)})})}),g.jsx("div",{ref:E,className:"h-2 border-t border-border cursor-row-resize hover:bg-accent/50 transition-colors relative group flex items-center justify-center",onMouseDown:B=>{B.preventDefault(),M(!0)},style:{userSelect:"none"},children:g.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:g.jsx(IA,{className:"h-3 w-3 text-muted-foreground"})})}),g.jsxs("div",{className:"border-t border-border overflow-hidden flex flex-col",style:{height:`${y}px`},children:[g.jsx("div",{className:"p-2 pb-1.5 flex-shrink-0",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-[10px] uppercase font-semibold text-muted-foreground",children:"Collections"}),g.jsxs(ke,{size:"xs",variant:"outline",className:"h-6 text-[10px] px-2",onClick:B=>{B.preventDefault(),B.stopPropagation(),z()},type:"button",children:[g.jsx(Hl,{className:"h-3 w-3 mr-0.5"}),"New"]})]})}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"pl-1.5 pr-4 pb-2 space-y-1.5",children:A.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground px-0.5",children:"Create collections to quickly build typical architectures."}):A.map(B=>{const ae=B.componentIds.map($=>Pr.find(G=>G.id===$)).filter($=>!!$).filter($=>$.label.toLowerCase().includes(J));return g.jsxs("div",{className:"rounded-md border border-border/60 p-1.5",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:B.name}),g.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[ae.length," items"]})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(ke,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Rename",onClick:()=>F(B),children:""}),g.jsx(ke,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Delete collection",onClick:()=>q(B.id),children:g.jsx(os,{className:"h-4 w-4"})})]})]}),ae.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground",children:'Add components via "+" menu.'}):g.jsx("div",{className:"space-y-1",children:ae.map($=>Y($,{compact:!0,onRemove:()=>se(B.id,$.id)}))})]},B.id)})})})]}),g.jsx(zv,{open:s,initialName:d?.name||"",onConfirm:j,onCancel:O}),g.jsx(zv,{open:c,initialName:"",onConfirm:he,onCancel:P})]})}const Eu=us(r=>({tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}],addTab:e=>r(t=>{if(e.componentId){const s=t.tabs.find(a=>a.componentId===e.componentId);if(s)return{tabs:t.tabs.map(a=>({...a,active:a.id===s.id}))}}const n={...e,id:`${e.type}-${Date.now()}`,active:!0};return{tabs:[...t.tabs.map(s=>({...s,active:!1})),n]}}),closeTab:e=>r(t=>{const n=t.tabs.filter(c=>c.id!==e);if(n.length===0)return{tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}]};const s=t.tabs.findIndex(c=>c.id===e);if(t.tabs[s]?.active&&n.length>0){const c=Math.min(s,n.length-1);n[c].active=!0}return{tabs:n}}),setActiveTab:e=>r(t=>({tabs:t.tabs.map(n=>({...n,active:n.id===e}))})),updateTab:(e,t)=>r(n=>({tabs:n.tabs.map(s=>s.id===e?{...s,...t}:s)}))}));function oz(r){const e=rz(r),t=w.forwardRef((n,s)=>{const{children:a,...c}=n,l=w.Children.toArray(a),d=l.find(lz);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}function rz(r){const e=w.forwardRef((t,n)=>{const{children:s,...a}=t;if(w.isValidElement(s)){const c=dz(s),l=uz(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var cz=Symbol("radix.slottable");function lz(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===cz}function uz(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function dz(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function Ru(r){const e=w.useRef({value:r,previous:r});return w.useMemo(()=>(e.current.value!==r&&(e.current.previous=e.current.value,e.current.value=r),e.current.previous),[r])}var _S=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),fz="VisuallyHidden",hz=w.forwardRef((r,e)=>g.jsx(Ae.span,{...r,ref:e,style:{..._S,...r.style}}));hz.displayName=fz;var pz=[" ","Enter","ArrowUp","ArrowDown"],gz=[" ","Enter"],wa="Select",[ku,Tu,mz]=fu(wa),[Do]=Sn(wa,[mz,Ao]),Au=Ao(),[yz,Ui]=Do(wa),[vz,bz]=Do(wa),NS=r=>{const{__scopeSelect:e,children:t,open:n,defaultOpen:s,onOpenChange:a,value:c,defaultValue:l,onValueChange:d,dir:f,name:p,autoComplete:m,disabled:y,required:b,form:S}=r,M=Au(e),[E,C]=w.useState(null),[T,k]=w.useState(null),[A,_]=w.useState(!1),N=Ro(f),[L,q]=Rs({prop:n,defaultProp:s??!1,onChange:a,caller:wa}),[Z,se]=Rs({prop:c,defaultProp:l,onChange:d,caller:wa}),ce=w.useRef(null),J=E?S||!!E.closest("form"):!0,[te,le]=w.useState(new Set),ue=Array.from(te).map(z=>z.props.value).join(";");return g.jsx(kp,{...M,children:g.jsxs(yz,{required:b,scope:e,trigger:E,onTriggerChange:C,valueNode:T,onValueNodeChange:k,valueNodeHasChildren:A,onValueNodeHasChildrenChange:_,contentId:rs(),value:Z,onValueChange:se,open:L,onOpenChange:q,dir:N,triggerPointerDownPosRef:ce,disabled:y,children:[g.jsx(ku.Provider,{scope:e,children:g.jsx(vz,{scope:r.__scopeSelect,onNativeOptionAdd:w.useCallback(z=>{le(j=>new Set(j).add(z))},[]),onNativeOptionRemove:w.useCallback(z=>{le(j=>{const O=new Set(j);return O.delete(z),O})},[]),children:t})}),J?g.jsxs(nM,{"aria-hidden":!0,required:b,tabIndex:-1,name:p,autoComplete:m,value:Z,onChange:z=>se(z.target.value),disabled:y,form:S,children:[Z===void 0?g.jsx("option",{value:""}):null,Array.from(te)]},ue):null]})})};NS.displayName=wa;var jS="SelectTrigger",PS=w.forwardRef((r,e)=>{const{__scopeSelect:t,disabled:n=!1,...s}=r,a=Au(t),c=Ui(jS,t),l=c.disabled||n,d=je(e,c.onTriggerChange),f=Tu(t),p=w.useRef("touch"),[m,y,b]=iM(M=>{const E=f().filter(k=>!k.disabled),C=E.find(k=>k.value===c.value),T=aM(E,M,C);T!==void 0&&c.onValueChange(T.value)}),S=M=>{l||(c.onOpenChange(!0),b()),M&&(c.triggerPointerDownPosRef.current={x:Math.round(M.pageX),y:Math.round(M.pageY)})};return g.jsx(wu,{asChild:!0,...a,children:g.jsx(Ae.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":sM(c.value)?"":void 0,...s,ref:d,onClick:ge(s.onClick,M=>{M.currentTarget.focus(),p.current!=="mouse"&&S(M)}),onPointerDown:ge(s.onPointerDown,M=>{p.current=M.pointerType;const E=M.target;E.hasPointerCapture(M.pointerId)&&E.releasePointerCapture(M.pointerId),M.button===0&&M.ctrlKey===!1&&M.pointerType==="mouse"&&(S(M),M.preventDefault())}),onKeyDown:ge(s.onKeyDown,M=>{const E=m.current!=="";!(M.ctrlKey||M.altKey||M.metaKey)&&M.key.length===1&&y(M.key),!(E&&M.key===" ")&&pz.includes(M.key)&&(S(),M.preventDefault())})})})});PS.displayName=jS;var zS="SelectValue",LS=w.forwardRef((r,e)=>{const{__scopeSelect:t,className:n,style:s,children:a,placeholder:c="",...l}=r,d=Ui(zS,t),{onValueNodeHasChildrenChange:f}=d,p=a!==void 0,m=je(e,d.onValueNodeChange);return rn(()=>{f(p)},[f,p]),g.jsx(Ae.span,{...l,ref:m,style:{pointerEvents:"none"},children:sM(d.value)?g.jsx(g.Fragment,{children:c}):a})});LS.displayName=zS;var xz="SelectIcon",IS=w.forwardRef((r,e)=>{const{__scopeSelect:t,children:n,...s}=r;return g.jsx(Ae.span,{"aria-hidden":!0,...s,ref:e,children:n||""})});IS.displayName=xz;var wz="SelectPortal",OS=r=>g.jsx(Qr,{asChild:!0,...r});OS.displayName=wz;var Sa="SelectContent",HS=w.forwardRef((r,e)=>{const t=Ui(Sa,r.__scopeSelect),[n,s]=w.useState();if(rn(()=>{s(new DocumentFragment)},[]),!t.open){const a=n;return a?qr.createPortal(g.jsx(qS,{scope:r.__scopeSelect,children:g.jsx(ku.Slot,{scope:r.__scopeSelect,children:g.jsx("div",{children:r.children})})}),a):null}return g.jsx(US,{...r,ref:e})});HS.displayName=Sa;var ns=10,[qS,$i]=Do(Sa),Sz="SelectContentImpl",Mz=oz("SelectContent.RemoveScroll"),US=w.forwardRef((r,e)=>{const{__scopeSelect:t,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:a,onPointerDownOutside:c,side:l,sideOffset:d,align:f,alignOffset:p,arrowPadding:m,collisionBoundary:y,collisionPadding:b,sticky:S,hideWhenDetached:M,avoidCollisions:E,...C}=r,T=Ui(Sa,t),[k,A]=w.useState(null),[_,N]=w.useState(null),L=je(e,$=>A($)),[q,Z]=w.useState(null),[se,ce]=w.useState(null),J=Tu(t),[te,le]=w.useState(!1),ue=w.useRef(!1);w.useEffect(()=>{if(k)return au(k)},[k]),su();const z=w.useCallback($=>{const[G,...pe]=J().map(ve=>ve.ref.current),[me]=pe.slice(-1),ye=document.activeElement;for(const ve of $)if(ve===ye||(ve?.scrollIntoView({block:"nearest"}),ve===G&&_&&(_.scrollTop=0),ve===me&&_&&(_.scrollTop=_.scrollHeight),ve?.focus(),document.activeElement!==ye))return},[J,_]),j=w.useCallback(()=>z([q,k]),[z,q,k]);w.useEffect(()=>{te&&j()},[te,j]);const{onOpenChange:O,triggerPointerDownPosRef:W}=T;w.useEffect(()=>{if(k){let $={x:0,y:0};const G=me=>{$={x:Math.abs(Math.round(me.pageX)-(W.current?.x??0)),y:Math.abs(Math.round(me.pageY)-(W.current?.y??0))}},pe=me=>{$.x<=10&&$.y<=10?me.preventDefault():k.contains(me.target)||O(!1),document.removeEventListener("pointermove",G),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",G),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",G),document.removeEventListener("pointerup",pe,{capture:!0})}}},[k,O,W]),w.useEffect(()=>{const $=()=>O(!1);return window.addEventListener("blur",$),window.addEventListener("resize",$),()=>{window.removeEventListener("blur",$),window.removeEventListener("resize",$)}},[O]);const[he,P]=iM($=>{const G=J().filter(ye=>!ye.disabled),pe=G.find(ye=>ye.ref.current===document.activeElement),me=aM(G,$,pe);me&&setTimeout(()=>me.ref.current.focus())}),F=w.useCallback(($,G,pe)=>{const me=!ue.current&&!pe;(T.value!==void 0&&T.value===G||me)&&(Z($),me&&(ue.current=!0))},[T.value]),Y=w.useCallback(()=>k?.focus(),[k]),ie=w.useCallback(($,G,pe)=>{const me=!ue.current&&!pe;(T.value!==void 0&&T.value===G||me)&&ce($)},[T.value]),B=n==="popper"?Dh:$S,ae=B===Dh?{side:l,sideOffset:d,align:f,alignOffset:p,arrowPadding:m,collisionBoundary:y,collisionPadding:b,sticky:S,hideWhenDetached:M,avoidCollisions:E}:{};return g.jsx(qS,{scope:t,content:k,viewport:_,onViewportChange:N,itemRefCallback:F,selectedItem:q,onItemLeave:Y,itemTextRefCallback:ie,focusSelectedItem:j,selectedItemText:se,position:n,isPositioned:te,searchRef:he,children:g.jsx(Vr,{as:Mz,allowPinchZoom:!0,children:g.jsx(Fr,{asChild:!0,trapped:T.open,onMountAutoFocus:$=>{$.preventDefault()},onUnmountAutoFocus:ge(s,$=>{T.trigger?.focus({preventScroll:!0}),$.preventDefault()}),children:g.jsx(Br,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:$=>$.preventDefault(),onDismiss:()=>T.onOpenChange(!1),children:g.jsx(B,{role:"listbox",id:T.contentId,"data-state":T.open?"open":"closed",dir:T.dir,onContextMenu:$=>$.preventDefault(),...C,...ae,onPlaced:()=>le(!0),ref:L,style:{display:"flex",flexDirection:"column",outline:"none",...C.style},onKeyDown:ge(C.onKeyDown,$=>{const G=$.ctrlKey||$.altKey||$.metaKey;if($.key==="Tab"&&$.preventDefault(),!G&&$.key.length===1&&P($.key),["ArrowUp","ArrowDown","Home","End"].includes($.key)){let me=J().filter(ye=>!ye.disabled).map(ye=>ye.ref.current);if(["ArrowUp","End"].includes($.key)&&(me=me.slice().reverse()),["ArrowUp","ArrowDown"].includes($.key)){const ye=$.target,ve=me.indexOf(ye);me=me.slice(ve+1)}setTimeout(()=>z(me)),$.preventDefault()}})})})})})})});US.displayName=Sz;var Cz="SelectItemAlignedPosition",$S=w.forwardRef((r,e)=>{const{__scopeSelect:t,onPlaced:n,...s}=r,a=Ui(Sa,t),c=$i(Sa,t),[l,d]=w.useState(null),[f,p]=w.useState(null),m=je(e,L=>p(L)),y=Tu(t),b=w.useRef(!1),S=w.useRef(!0),{viewport:M,selectedItem:E,selectedItemText:C,focusSelectedItem:T}=c,k=w.useCallback(()=>{if(a.trigger&&a.valueNode&&l&&f&&M&&E&&C){const L=a.trigger.getBoundingClientRect(),q=f.getBoundingClientRect(),Z=a.valueNode.getBoundingClientRect(),se=C.getBoundingClientRect();if(a.dir!=="rtl"){const ye=se.left-q.left,ve=Z.left-ye,Pe=L.left-ve,$e=L.width+Pe,it=Math.max($e,q.width),Je=window.innerWidth-ns,jt=jr(ve,[ns,Math.max(ns,Je-it)]);l.style.minWidth=$e+"px",l.style.left=jt+"px"}else{const ye=q.right-se.right,ve=window.innerWidth-Z.right-ye,Pe=window.innerWidth-L.right-ve,$e=L.width+Pe,it=Math.max($e,q.width),Je=window.innerWidth-ns,jt=jr(ve,[ns,Math.max(ns,Je-it)]);l.style.minWidth=$e+"px",l.style.right=jt+"px"}const ce=y(),J=window.innerHeight-ns*2,te=M.scrollHeight,le=window.getComputedStyle(f),ue=parseInt(le.borderTopWidth,10),z=parseInt(le.paddingTop,10),j=parseInt(le.borderBottomWidth,10),O=parseInt(le.paddingBottom,10),W=ue+z+te+O+j,he=Math.min(E.offsetHeight*5,W),P=window.getComputedStyle(M),F=parseInt(P.paddingTop,10),Y=parseInt(P.paddingBottom,10),ie=L.top+L.height/2-ns,B=J-ie,ae=E.offsetHeight/2,$=E.offsetTop+ae,G=ue+z+$,pe=W-G;if(G<=ie){const ye=ce.length>0&&E===ce[ce.length-1].ref.current;l.style.bottom="0px";const ve=f.clientHeight-M.offsetTop-M.offsetHeight,Pe=Math.max(B,ae+(ye?Y:0)+ve+j),$e=G+Pe;l.style.height=$e+"px"}else{const ye=ce.length>0&&E===ce[0].ref.current;l.style.top="0px";const Pe=Math.max(ie,ue+M.offsetTop+(ye?F:0)+ae)+pe;l.style.height=Pe+"px",M.scrollTop=G-ie+M.offsetTop}l.style.margin=`${ns}px 0`,l.style.minHeight=he+"px",l.style.maxHeight=J+"px",n?.(),requestAnimationFrame(()=>b.current=!0)}},[y,a.trigger,a.valueNode,l,f,M,E,C,a.dir,n]);rn(()=>k(),[k]);const[A,_]=w.useState();rn(()=>{f&&_(window.getComputedStyle(f).zIndex)},[f]);const N=w.useCallback(L=>{L&&S.current===!0&&(k(),T?.(),S.current=!1)},[k,T]);return g.jsx(Rz,{scope:t,contentWrapper:l,shouldExpandOnScrollRef:b,onScrollButtonChange:N,children:g.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:g.jsx(Ae.div,{...s,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});$S.displayName=Cz;var Ez="SelectPopperPosition",Dh=w.forwardRef((r,e)=>{const{__scopeSelect:t,align:n="start",collisionPadding:s=ns,...a}=r,c=Au(t);return g.jsx(Tp,{...c,...a,ref:e,align:n,collisionPadding:s,style:{boxSizing:"border-box",...a.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Dh.displayName=Ez;var[Rz,Ip]=Do(Sa,{}),_h="SelectViewport",BS=w.forwardRef((r,e)=>{const{__scopeSelect:t,nonce:n,...s}=r,a=$i(_h,t),c=Ip(_h,t),l=je(e,a.onViewportChange),d=w.useRef(0);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),g.jsx(ku.Slot,{scope:t,children:g.jsx(Ae.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:ge(s.onScroll,f=>{const p=f.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:y}=c;if(y?.current&&m){const b=Math.abs(d.current-p.scrollTop);if(b>0){const S=window.innerHeight-ns*2,M=parseFloat(m.style.minHeight),E=parseFloat(m.style.height),C=Math.max(M,E);if(C<S){const T=C+b,k=Math.min(S,T),A=T-k;m.style.height=k+"px",m.style.bottom==="0px"&&(p.scrollTop=A>0?A:0,m.style.justifyContent="flex-end")}}}d.current=p.scrollTop})})})]})});BS.displayName=_h;var FS="SelectGroup",[kz,Tz]=Do(FS),Az=w.forwardRef((r,e)=>{const{__scopeSelect:t,...n}=r,s=rs();return g.jsx(kz,{scope:t,id:s,children:g.jsx(Ae.div,{role:"group","aria-labelledby":s,...n,ref:e})})});Az.displayName=FS;var QS="SelectLabel",VS=w.forwardRef((r,e)=>{const{__scopeSelect:t,...n}=r,s=Tz(QS,t);return g.jsx(Ae.div,{id:s.id,...n,ref:e})});VS.displayName=QS;var Yl="SelectItem",[Dz,GS]=Do(Yl),KS=w.forwardRef((r,e)=>{const{__scopeSelect:t,value:n,disabled:s=!1,textValue:a,...c}=r,l=Ui(Yl,t),d=$i(Yl,t),f=l.value===n,[p,m]=w.useState(a??""),[y,b]=w.useState(!1),S=je(e,T=>d.itemRefCallback?.(T,n,s)),M=rs(),E=w.useRef("touch"),C=()=>{s||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return g.jsx(Dz,{scope:t,value:n,disabled:s,textId:M,isSelected:f,onItemTextChange:w.useCallback(T=>{m(k=>k||(T?.textContent??"").trim())},[]),children:g.jsx(ku.ItemSlot,{scope:t,value:n,disabled:s,textValue:p,children:g.jsx(Ae.div,{role:"option","aria-labelledby":M,"data-highlighted":y?"":void 0,"aria-selected":f&&y,"data-state":f?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...c,ref:S,onFocus:ge(c.onFocus,()=>b(!0)),onBlur:ge(c.onBlur,()=>b(!1)),onClick:ge(c.onClick,()=>{E.current!=="mouse"&&C()}),onPointerUp:ge(c.onPointerUp,()=>{E.current==="mouse"&&C()}),onPointerDown:ge(c.onPointerDown,T=>{E.current=T.pointerType}),onPointerMove:ge(c.onPointerMove,T=>{E.current=T.pointerType,s?d.onItemLeave?.():E.current==="mouse"&&T.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ge(c.onPointerLeave,T=>{T.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:ge(c.onKeyDown,T=>{d.searchRef?.current!==""&&T.key===" "||(gz.includes(T.key)&&C(),T.key===" "&&T.preventDefault())})})})})});KS.displayName=Yl;var Tr="SelectItemText",YS=w.forwardRef((r,e)=>{const{__scopeSelect:t,className:n,style:s,...a}=r,c=Ui(Tr,t),l=$i(Tr,t),d=GS(Tr,t),f=bz(Tr,t),[p,m]=w.useState(null),y=je(e,C=>m(C),d.onItemTextChange,C=>l.itemTextRefCallback?.(C,d.value,d.disabled)),b=p?.textContent,S=w.useMemo(()=>g.jsx("option",{value:d.value,disabled:d.disabled,children:b},d.value),[d.disabled,d.value,b]),{onNativeOptionAdd:M,onNativeOptionRemove:E}=f;return rn(()=>(M(S),()=>E(S)),[M,E,S]),g.jsxs(g.Fragment,{children:[g.jsx(Ae.span,{id:d.textId,...a,ref:y}),d.isSelected&&c.valueNode&&!c.valueNodeHasChildren?qr.createPortal(a.children,c.valueNode):null]})});YS.displayName=Tr;var WS="SelectItemIndicator",XS=w.forwardRef((r,e)=>{const{__scopeSelect:t,...n}=r;return GS(WS,t).isSelected?g.jsx(Ae.span,{"aria-hidden":!0,...n,ref:e}):null});XS.displayName=WS;var Nh="SelectScrollUpButton",JS=w.forwardRef((r,e)=>{const t=$i(Nh,r.__scopeSelect),n=Ip(Nh,r.__scopeSelect),[s,a]=w.useState(!1),c=je(e,n.onScrollButtonChange);return rn(()=>{if(t.viewport&&t.isPositioned){let l=function(){const f=d.scrollTop>0;a(f)};const d=t.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[t.viewport,t.isPositioned]),s?g.jsx(eM,{...r,ref:c,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=t;l&&d&&(l.scrollTop=l.scrollTop-d.offsetHeight)}}):null});JS.displayName=Nh;var jh="SelectScrollDownButton",ZS=w.forwardRef((r,e)=>{const t=$i(jh,r.__scopeSelect),n=Ip(jh,r.__scopeSelect),[s,a]=w.useState(!1),c=je(e,n.onScrollButtonChange);return rn(()=>{if(t.viewport&&t.isPositioned){let l=function(){const f=d.scrollHeight-d.clientHeight,p=Math.ceil(d.scrollTop)<f;a(p)};const d=t.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[t.viewport,t.isPositioned]),s?g.jsx(eM,{...r,ref:c,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=t;l&&d&&(l.scrollTop=l.scrollTop+d.offsetHeight)}}):null});ZS.displayName=jh;var eM=w.forwardRef((r,e)=>{const{__scopeSelect:t,onAutoScroll:n,...s}=r,a=$i("SelectScrollButton",t),c=w.useRef(null),l=Tu(t),d=w.useCallback(()=>{c.current!==null&&(window.clearInterval(c.current),c.current=null)},[]);return w.useEffect(()=>()=>d(),[d]),rn(()=>{l().find(p=>p.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),g.jsx(Ae.div,{"aria-hidden":!0,...s,ref:e,style:{flexShrink:0,...s.style},onPointerDown:ge(s.onPointerDown,()=>{c.current===null&&(c.current=window.setInterval(n,50))}),onPointerMove:ge(s.onPointerMove,()=>{a.onItemLeave?.(),c.current===null&&(c.current=window.setInterval(n,50))}),onPointerLeave:ge(s.onPointerLeave,()=>{d()})})}),_z="SelectSeparator",tM=w.forwardRef((r,e)=>{const{__scopeSelect:t,...n}=r;return g.jsx(Ae.div,{"aria-hidden":!0,...n,ref:e})});tM.displayName=_z;var Ph="SelectArrow",Nz=w.forwardRef((r,e)=>{const{__scopeSelect:t,...n}=r,s=Au(t),a=Ui(Ph,t),c=$i(Ph,t);return a.open&&c.position==="popper"?g.jsx(Ap,{...s,...n,ref:e}):null});Nz.displayName=Ph;var jz="SelectBubbleInput",nM=w.forwardRef(({__scopeSelect:r,value:e,...t},n)=>{const s=w.useRef(null),a=je(n,s),c=Ru(e);return w.useEffect(()=>{const l=s.current;if(!l)return;const d=window.HTMLSelectElement.prototype,p=Object.getOwnPropertyDescriptor(d,"value").set;if(c!==e&&p){const m=new Event("change",{bubbles:!0});p.call(l,e),l.dispatchEvent(m)}},[c,e]),g.jsx(Ae.select,{...t,style:{..._S,...t.style},ref:a,defaultValue:e})});nM.displayName=jz;function sM(r){return r===""||r===void 0}function iM(r){const e=on(r),t=w.useRef(""),n=w.useRef(0),s=w.useCallback(c=>{const l=t.current+c;e(l),(function d(f){t.current=f,window.clearTimeout(n.current),f!==""&&(n.current=window.setTimeout(()=>d(""),1e3))})(l)},[e]),a=w.useCallback(()=>{t.current="",window.clearTimeout(n.current)},[]);return w.useEffect(()=>()=>window.clearTimeout(n.current),[]),[t,s,a]}function aM(r,e,t){const s=e.length>1&&Array.from(e).every(f=>f===e[0])?e[0]:e,a=t?r.indexOf(t):-1;let c=Pz(r,Math.max(a,0));s.length===1&&(c=c.filter(f=>f!==t));const d=c.find(f=>f.textValue.toLowerCase().startsWith(s.toLowerCase()));return d!==t?d:void 0}function Pz(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var zz=NS,oM=PS,Lz=LS,Iz=IS,Oz=OS,rM=HS,Hz=BS,cM=VS,lM=KS,qz=YS,Uz=XS,uM=JS,dM=ZS,fM=tM;const Nl=zz,jl=Lz,Dr=w.forwardRef(({className:r,children:e,...t},n)=>g.jsxs(oM,{ref:n,className:Re("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[e,g.jsx(Iz,{asChild:!0,children:g.jsx(Jl,{className:"h-4 w-4 opacity-50"})})]}));Dr.displayName=oM.displayName;const hM=w.forwardRef(({className:r,...e},t)=>g.jsx(uM,{ref:t,className:Re("flex cursor-default items-center justify-center py-1",r),...e,children:g.jsx(Cb,{className:"h-4 w-4"})}));hM.displayName=uM.displayName;const pM=w.forwardRef(({className:r,...e},t)=>g.jsx(dM,{ref:t,className:Re("flex cursor-default items-center justify-center py-1",r),...e,children:g.jsx(Jl,{className:"h-4 w-4"})}));pM.displayName=dM.displayName;const _r=w.forwardRef(({className:r,children:e,position:t="popper",...n},s)=>g.jsx(Oz,{children:g.jsxs(rM,{ref:s,className:Re("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...n,children:[g.jsx(hM,{}),g.jsx(Hz,{className:Re("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),g.jsx(pM,{})]})}));_r.displayName=rM.displayName;const $z=w.forwardRef(({className:r,...e},t)=>g.jsx(cM,{ref:t,className:Re("px-2 py-1.5 text-sm font-semibold",r),...e}));$z.displayName=cM.displayName;const Qt=w.forwardRef(({className:r,children:e,...t},n)=>g.jsxs(lM,{ref:n,className:Re("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[g.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(Uz,{children:g.jsx(Yh,{className:"h-4 w-4"})})}),g.jsx(qz,{children:e})]}));Qt.displayName=lM.displayName;const Bz=w.forwardRef(({className:r,...e},t)=>g.jsx(fM,{ref:t,className:Re("-mx-1 my-1 h-px bg-muted",r),...e}));Bz.displayName=fM.displayName;var gM=["PageUp","PageDown"],mM=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],yM={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},_o="Slider",[zh,Fz,Qz]=fu(_o),[vM]=Sn(_o,[Qz]),[Vz,Du]=vM(_o),bM=w.forwardRef((r,e)=>{const{name:t,min:n=0,max:s=100,step:a=1,orientation:c="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:f=[n],value:p,onValueChange:m=()=>{},onValueCommit:y=()=>{},inverted:b=!1,form:S,...M}=r,E=w.useRef(new Set),C=w.useRef(0),k=c==="horizontal"?Gz:Kz,[A=[],_]=Rs({prop:p,defaultProp:f,onChange:ce=>{[...E.current][C.current]?.focus(),m(ce)}}),N=w.useRef(A);function L(ce){const J=Zz(A,ce);se(ce,J)}function q(ce){se(ce,C.current)}function Z(){const ce=N.current[C.current];A[C.current]!==ce&&y(A)}function se(ce,J,{commit:te}={commit:!1}){const le=sL(a),ue=iL(Math.round((ce-n)/a)*a+n,le),z=jr(ue,[n,s]);_((j=[])=>{const O=Xz(j,z,J);if(nL(O,d*a)){C.current=O.indexOf(z);const W=String(O)!==String(j);return W&&te&&y(O),W?O:j}else return j})}return g.jsx(Vz,{scope:r.__scopeSlider,name:t,disabled:l,min:n,max:s,valueIndexToChangeRef:C,thumbs:E.current,values:A,orientation:c,form:S,children:g.jsx(zh.Provider,{scope:r.__scopeSlider,children:g.jsx(zh.Slot,{scope:r.__scopeSlider,children:g.jsx(k,{"aria-disabled":l,"data-disabled":l?"":void 0,...M,ref:e,onPointerDown:ge(M.onPointerDown,()=>{l||(N.current=A)}),min:n,max:s,inverted:b,onSlideStart:l?void 0:L,onSlideMove:l?void 0:q,onSlideEnd:l?void 0:Z,onHomeKeyDown:()=>!l&&se(n,0,{commit:!0}),onEndKeyDown:()=>!l&&se(s,A.length-1,{commit:!0}),onStepKeyDown:({event:ce,direction:J})=>{if(!l){const ue=gM.includes(ce.key)||ce.shiftKey&&mM.includes(ce.key)?10:1,z=C.current,j=A[z],O=a*ue*J;se(j+O,z,{commit:!0})}}})})})})});bM.displayName=_o;var[xM,wM]=vM(_o,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Gz=w.forwardRef((r,e)=>{const{min:t,max:n,dir:s,inverted:a,onSlideStart:c,onSlideMove:l,onSlideEnd:d,onStepKeyDown:f,...p}=r,[m,y]=w.useState(null),b=je(e,k=>y(k)),S=w.useRef(void 0),M=Ro(s),E=M==="ltr",C=E&&!a||!E&&a;function T(k){const A=S.current||m.getBoundingClientRect(),_=[0,A.width],L=Op(_,C?[t,n]:[n,t]);return S.current=A,L(k-A.left)}return g.jsx(xM,{scope:r.__scopeSlider,startEdge:C?"left":"right",endEdge:C?"right":"left",direction:C?1:-1,size:"width",children:g.jsx(SM,{dir:M,"data-orientation":"horizontal",...p,ref:b,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:k=>{const A=T(k.clientX);c?.(A)},onSlideMove:k=>{const A=T(k.clientX);l?.(A)},onSlideEnd:()=>{S.current=void 0,d?.()},onStepKeyDown:k=>{const _=yM[C?"from-left":"from-right"].includes(k.key);f?.({event:k,direction:_?-1:1})}})})}),Kz=w.forwardRef((r,e)=>{const{min:t,max:n,inverted:s,onSlideStart:a,onSlideMove:c,onSlideEnd:l,onStepKeyDown:d,...f}=r,p=w.useRef(null),m=je(e,p),y=w.useRef(void 0),b=!s;function S(M){const E=y.current||p.current.getBoundingClientRect(),C=[0,E.height],k=Op(C,b?[n,t]:[t,n]);return y.current=E,k(M-E.top)}return g.jsx(xM,{scope:r.__scopeSlider,startEdge:b?"bottom":"top",endEdge:b?"top":"bottom",size:"height",direction:b?1:-1,children:g.jsx(SM,{"data-orientation":"vertical",...f,ref:m,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:M=>{const E=S(M.clientY);a?.(E)},onSlideMove:M=>{const E=S(M.clientY);c?.(E)},onSlideEnd:()=>{y.current=void 0,l?.()},onStepKeyDown:M=>{const C=yM[b?"from-bottom":"from-top"].includes(M.key);d?.({event:M,direction:C?-1:1})}})})}),SM=w.forwardRef((r,e)=>{const{__scopeSlider:t,onSlideStart:n,onSlideMove:s,onSlideEnd:a,onHomeKeyDown:c,onEndKeyDown:l,onStepKeyDown:d,...f}=r,p=Du(_o,t);return g.jsx(Ae.span,{...f,ref:e,onKeyDown:ge(r.onKeyDown,m=>{m.key==="Home"?(c(m),m.preventDefault()):m.key==="End"?(l(m),m.preventDefault()):gM.concat(mM).includes(m.key)&&(d(m),m.preventDefault())}),onPointerDown:ge(r.onPointerDown,m=>{const y=m.target;y.setPointerCapture(m.pointerId),m.preventDefault(),p.thumbs.has(y)?y.focus():n(m)}),onPointerMove:ge(r.onPointerMove,m=>{m.target.hasPointerCapture(m.pointerId)&&s(m)}),onPointerUp:ge(r.onPointerUp,m=>{const y=m.target;y.hasPointerCapture(m.pointerId)&&(y.releasePointerCapture(m.pointerId),a(m))})})}),MM="SliderTrack",CM=w.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,s=Du(MM,t);return g.jsx(Ae.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:e})});CM.displayName=MM;var Lh="SliderRange",EM=w.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,s=Du(Lh,t),a=wM(Lh,t),c=w.useRef(null),l=je(e,c),d=s.values.length,f=s.values.map(y=>TM(y,s.min,s.max)),p=d>1?Math.min(...f):0,m=100-Math.max(...f);return g.jsx(Ae.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:l,style:{...r.style,[a.startEdge]:p+"%",[a.endEdge]:m+"%"}})});EM.displayName=Lh;var Ih="SliderThumb",RM=w.forwardRef((r,e)=>{const t=Fz(r.__scopeSlider),[n,s]=w.useState(null),a=je(e,l=>s(l)),c=w.useMemo(()=>n?t().findIndex(l=>l.ref.current===n):-1,[t,n]);return g.jsx(Yz,{...r,ref:a,index:c})}),Yz=w.forwardRef((r,e)=>{const{__scopeSlider:t,index:n,name:s,...a}=r,c=Du(Ih,t),l=wM(Ih,t),[d,f]=w.useState(null),p=je(e,T=>f(T)),m=d?c.form||!!d.closest("form"):!0,y=xu(d),b=c.values[n],S=b===void 0?0:TM(b,c.min,c.max),M=Jz(n,c.values.length),E=y?.[l.size],C=E?eL(E,S,l.direction):0;return w.useEffect(()=>{if(d)return c.thumbs.add(d),()=>{c.thumbs.delete(d)}},[d,c.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${S}% + ${C}px)`},children:[g.jsx(zh.ItemSlot,{scope:r.__scopeSlider,children:g.jsx(Ae.span,{role:"slider","aria-label":r["aria-label"]||M,"aria-valuemin":c.min,"aria-valuenow":b,"aria-valuemax":c.max,"aria-orientation":c.orientation,"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,tabIndex:c.disabled?void 0:0,...a,ref:p,style:b===void 0?{display:"none"}:r.style,onFocus:ge(r.onFocus,()=>{c.valueIndexToChangeRef.current=n})})}),m&&g.jsx(kM,{name:s??(c.name?c.name+(c.values.length>1?"[]":""):void 0),form:c.form,value:b},n)]})});RM.displayName=Ih;var Wz="RadioBubbleInput",kM=w.forwardRef(({__scopeSlider:r,value:e,...t},n)=>{const s=w.useRef(null),a=je(s,n),c=Ru(e);return w.useEffect(()=>{const l=s.current;if(!l)return;const d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"value").set;if(c!==e&&p){const m=new Event("input",{bubbles:!0});p.call(l,e),l.dispatchEvent(m)}},[c,e]),g.jsx(Ae.input,{style:{display:"none"},...t,ref:a,defaultValue:e})});kM.displayName=Wz;function Xz(r=[],e,t){const n=[...r];return n[t]=e,n.sort((s,a)=>s-a)}function TM(r,e,t){const a=100/(t-e)*(r-e);return jr(a,[0,100])}function Jz(r,e){return e>2?`Value ${r+1} of ${e}`:e===2?["Minimum","Maximum"][r]:void 0}function Zz(r,e){if(r.length===1)return 0;const t=r.map(s=>Math.abs(s-e)),n=Math.min(...t);return t.indexOf(n)}function eL(r,e,t){const n=r/2,a=Op([0,50],[0,n]);return(n-a(e)*t)*t}function tL(r){return r.slice(0,-1).map((e,t)=>r[t+1]-e)}function nL(r,e){if(e>0){const t=tL(r);return Math.min(...t)>=e}return!0}function Op(r,e){return t=>{if(r[0]===r[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(r[1]-r[0]);return e[0]+n*(t-r[0])}}function sL(r){return(String(r).split(".")[1]||"").length}function iL(r,e){const t=Math.pow(10,e);return Math.round(r*t)/t}var AM=bM,aL=CM,oL=EM,rL=RM;const is=w.forwardRef(({className:r,...e},t)=>g.jsxs(AM,{ref:t,className:Re("relative flex w-full touch-none select-none items-center",r),...e,children:[g.jsx(aL,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:g.jsx(oL,{className:"absolute h-full bg-primary"})}),g.jsx(rL,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));is.displayName=AM.displayName;var _u="Switch",[cL]=Sn(_u),[lL,uL]=cL(_u),DM=w.forwardRef((r,e)=>{const{__scopeSwitch:t,name:n,checked:s,defaultChecked:a,required:c,disabled:l,value:d="on",onCheckedChange:f,form:p,...m}=r,[y,b]=w.useState(null),S=je(e,k=>b(k)),M=w.useRef(!1),E=y?p||!!y.closest("form"):!0,[C,T]=Rs({prop:s,defaultProp:a??!1,onChange:f,caller:_u});return g.jsxs(lL,{scope:t,checked:C,disabled:l,children:[g.jsx(Ae.button,{type:"button",role:"switch","aria-checked":C,"aria-required":c,"data-state":PM(C),"data-disabled":l?"":void 0,disabled:l,value:d,...m,ref:S,onClick:ge(r.onClick,k=>{T(A=>!A),E&&(M.current=k.isPropagationStopped(),M.current||k.stopPropagation())})}),E&&g.jsx(jM,{control:y,bubbles:!M.current,name:n,value:d,checked:C,required:c,disabled:l,form:p,style:{transform:"translateX(-100%)"}})]})});DM.displayName=_u;var _M="SwitchThumb",NM=w.forwardRef((r,e)=>{const{__scopeSwitch:t,...n}=r,s=uL(_M,t);return g.jsx(Ae.span,{"data-state":PM(s.checked),"data-disabled":s.disabled?"":void 0,...n,ref:e})});NM.displayName=_M;var dL="SwitchBubbleInput",jM=w.forwardRef(({__scopeSwitch:r,control:e,checked:t,bubbles:n=!0,...s},a)=>{const c=w.useRef(null),l=je(c,a),d=Ru(t),f=xu(e);return w.useEffect(()=>{const p=c.current;if(!p)return;const m=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(m,"checked").set;if(d!==t&&b){const S=new Event("click",{bubbles:n});b.call(p,t),p.dispatchEvent(S)}},[d,t,n]),g.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...s,tabIndex:-1,ref:l,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});jM.displayName=dL;function PM(r){return r?"checked":"unchecked"}var zM=DM,fL=NM;const ha=w.forwardRef(({className:r,...e},t)=>g.jsx(zM,{className:Re("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...e,ref:t,children:g.jsx(fL,{className:Re("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));ha.displayName=zM.displayName;const wn=w.forwardRef(({className:r,...e},t)=>g.jsx("div",{ref:t,className:Re("rounded-xl border bg-card text-card-foreground shadow",r),...e}));wn.displayName="Card";const Ms=w.forwardRef(({className:r,...e},t)=>g.jsx("div",{ref:t,className:Re("flex flex-col space-y-1.5 p-6",r),...e}));Ms.displayName="CardHeader";const Cs=w.forwardRef(({className:r,...e},t)=>g.jsx("div",{ref:t,className:Re("font-semibold leading-none tracking-tight",r),...e}));Cs.displayName="CardTitle";const ga=w.forwardRef(({className:r,...e},t)=>g.jsx("div",{ref:t,className:Re("text-sm text-muted-foreground",r),...e}));ga.displayName="CardDescription";const Es=w.forwardRef(({className:r,...e},t)=>g.jsx("div",{ref:t,className:Re("p-6 pt-0",r),...e}));Es.displayName="CardContent";const hL=w.forwardRef(({className:r,...e},t)=>g.jsx("div",{ref:t,className:Re("flex items-center p-6 pt-0",r),...e}));hL.displayName="CardFooter";const pL=Fh("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ht({className:r,variant:e,...t}){return g.jsx("div",{className:Re(pL({variant:e}),r),...t})}const Nr={heading:{h1:"text-2xl font-bold text-foreground",h2:"text-lg font-semibold text-foreground",h3:"text-sm font-semibold text-foreground",h4:"text-xs font-semibold text-foreground",h5:"text-[10px] font-semibold text-muted-foreground uppercase"},body:{base:"text-sm text-foreground",small:"text-xs text-foreground",micro:"text-[10px] text-foreground"},muted:{base:"text-sm text-muted-foreground",small:"text-xs text-muted-foreground",micro:"text-[10px] text-muted-foreground"},mono:{base:"font-mono text-sm text-foreground",small:"font-mono text-xs text-foreground",micro:"font-mono text-[10px] text-foreground"},status:{success:"text-success",warning:"text-warning",error:"text-destructive",info:"text-primary"}},ws=w.forwardRef(({level:r,as:e,className:t,children:n,...s},a)=>{const c=e||`h${r}`,l=`h${r}`;return g.jsx(c,{ref:a,className:Re(Nr.heading[l],t),...s,children:n})});ws.displayName="Heading";const We=w.forwardRef(({size:r="base",muted:e=!1,mono:t=!1,as:n="p",className:s,children:a,...c},l)=>{const d=n;let f;return t?f=Nr.mono[r]:e?f=Nr.muted[r]:f=Nr.body[r],g.jsx(d,{ref:l,className:Re(f,s),...c,children:a})});We.displayName="Text";const da=w.forwardRef(({status:r,size:e="base",weight:t="normal",as:n="span",className:s,children:a,...c},l)=>{const d=n,f={base:"text-sm",small:"text-xs",micro:"text-[10px]"},p={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};return g.jsx(d,{ref:l,className:Re(f[e],p[t],Nr.status[r],s),...c,children:a})});da.displayName="StatusText";const gL=w.forwardRef(({as:r="h2",className:e,children:t,...n},s)=>g.jsx(ws,{ref:s,level:1,as:r,className:e,...n,children:t}));gL.displayName="PageTitle";const mL=w.forwardRef(({as:r="h3",className:e,children:t,...n},s)=>g.jsx(ws,{ref:s,level:2,as:r,className:e,...n,children:t}));mL.displayName="SectionTitle";const ti=w.forwardRef(({as:r="h3",className:e,children:t,...n},s)=>g.jsx(ws,{ref:s,level:3,as:r,className:e,...n,children:t}));ti.displayName="PanelTitle";const yL=w.forwardRef(({as:r="p",className:e,children:t,...n},s)=>g.jsx(We,{ref:s,size:"base",muted:!0,as:r,className:Re("mt-1",e),...n,children:t}));yL.displayName="Description";function vL({connection:r,onUpdate:e}){const t=r.data||{},{isRunning:n}=Nt(),{getConnectionMessages:s,getMessageHistory:a}=zi(),[c,l]=w.useState([]),[d,f]=w.useState([]);w.useEffect(()=>{if(!n){l([]),f([]);return}const C=setInterval(()=>{const T=s(r.id),k=a(50).filter(A=>A.connectionId===r.id);l(T),f(k)},200);return()=>clearInterval(C)},[n,r.id,s,a]);const p=C=>{const T={...t,...C};e(r.id,{data:T})},m=C=>{p({latencyMs:Math.max(0,C)})},y=C=>{p({bandwidthMbps:Math.max(1,C)})},b=C=>{p({packetLossPercent:Math.max(0,Math.min(100,C))})},S=C=>{p({jitterMs:Math.max(0,C)})},M=C=>{p({retryCount:Math.max(0,C)})},E=C=>{p({timeoutMs:Math.max(1e3,C)})};return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx(ti,{children:"Connection"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs(We,{size:"micro",muted:!0,children:["From: ",r.source]}),g.jsxs(We,{size:"micro",muted:!0,children:["To: ",r.target]}),g.jsxs(We,{size:"micro",muted:!0,children:["Type: ",r.type]})]})]}),g.jsxs("div",{className:"border-t border-border pt-2 space-y-2",children:[g.jsxs("div",{children:[g.jsx(ws,{level:5,className:"mb-1.5 opacity-70",children:"Network Parameters"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Latency (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.latencyMs??0})]}),g.jsx(is,{value:[t.latencyMs??0],onValueChange:C=>m(C[0]),min:0,max:5e3,step:10,className:"w-full"}),g.jsx(Tt,{type:"number",value:t.latencyMs??0,onChange:C=>m(parseInt(C.target.value)||0),placeholder:"0-5000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Bandwidth (Mbps)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.bandwidthMbps??1e3})]}),g.jsx(is,{value:[t.bandwidthMbps??1e3],onValueChange:C=>y(C[0]),min:1,max:1e5,step:10,className:"w-full"}),g.jsx(Tt,{type:"number",value:t.bandwidthMbps??1e3,onChange:C=>y(parseInt(C.target.value)||1e3),placeholder:"1-100000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Packet Loss (%)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.packetLossPercent??0})]}),g.jsx(is,{value:[t.packetLossPercent??0],onValueChange:C=>b(C[0]),min:0,max:100,step:.1,className:"w-full"}),g.jsx(Tt,{type:"number",step:"0.1",value:t.packetLossPercent??0,onChange:C=>b(parseFloat(C.target.value)||0),placeholder:"0-100",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Jitter (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.jitterMs??0})]}),g.jsx(is,{value:[t.jitterMs??0],onValueChange:C=>S(C[0]),min:0,max:1e3,step:5,className:"w-full"}),g.jsx(Tt,{type:"number",value:t.jitterMs??0,onChange:C=>S(parseInt(C.target.value)||0),placeholder:"0-1000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx("h4",{className:"text-[9px] font-semibold text-foreground mb-1.5 uppercase opacity-70",children:"Traffic Characteristics"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsx(st,{className:"text-xs",children:"Priority Level"}),g.jsxs(Nl,{value:t.priorityLevel||"medium",onValueChange:C=>p({priorityLevel:C}),children:[g.jsx(Dr,{className:"h-7 text-[11px]",children:g.jsx(jl,{})}),g.jsxs(_r,{children:[g.jsx(Qt,{value:"low",children:"Low"}),g.jsx(Qt,{value:"medium",children:"Medium"}),g.jsx(Qt,{value:"high",children:"High"}),g.jsx(Qt,{value:"critical",children:"Critical"})]})]})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Retry Count"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.retryCount??3})]}),g.jsx(is,{value:[t.retryCount??3],onValueChange:C=>M(C[0]),min:0,max:10,step:1,className:"w-full"}),g.jsx(Tt,{type:"number",value:t.retryCount??3,onChange:C=>M(parseInt(C.target.value)||0),placeholder:"0-10",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Timeout (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.timeoutMs??3e4})]}),g.jsx(is,{value:[t.timeoutMs??3e4],onValueChange:C=>E(C[0]),min:1e3,max:12e4,step:1e3,className:"w-full"}),g.jsx(Tt,{type:"number",value:t.timeoutMs??3e4,onChange:C=>E(parseInt(C.target.value)||3e4),placeholder:"1000-120000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx(ws,{level:5,className:"mb-1.5 opacity-70",children:"Monitoring"}),g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-accent/20 rounded-md",children:[g.jsx(st,{className:"text-xs cursor-pointer",children:"Enable Monitoring"}),g.jsx(ha,{checked:t.enableMonitoring??!1,onCheckedChange:C=>p({enableMonitoring:C})})]})]}),g.jsx(wn,{className:"bg-card/50 border-border/50 p-1.5 mt-2",children:g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Bandwidth:"}),g.jsxs(We,{mono:!0,size:"micro",children:[Math.max(1,(t.bandwidthMbps??1e3)*(1-(t.packetLossPercent??0)/100)).toFixed(2)," Mbps"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Latency:"}),g.jsxs(We,{mono:!0,size:"micro",children:[((t.latencyMs??0)+(t.jitterMs??0)/2).toFixed(0)," ms"]})]})]})}),n&&g.jsx("div",{className:"border-t border-border pt-2 mt-2",children:g.jsxs(vp,{defaultValue:"active",className:"w-full",children:[g.jsxs(gu,{className:"grid w-full grid-cols-2 h-7",children:[g.jsxs(ss,{value:"active",className:"text-xs px-2",children:[g.jsx(ya,{className:"h-3 w-3 mr-1"}),"Active (",c.length,")"]}),g.jsxs(ss,{value:"history",className:"text-xs px-2",children:[g.jsx(rv,{className:"h-3 w-3 mr-1"}),"History (",d.length,")"]})]}),g.jsx(ni,{value:"active",className:"mt-1.5 space-y-1",children:c.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(ya,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"No active messages"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:c.map((C,T)=>g.jsxs(wn,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(ht,{variant:"outline",className:"text-xs px-0.5 py-0",children:C.format}),g.jsx(ht,{variant:C.status==="delivered"?"default":C.status==="failed"?"destructive":C.status==="transformed"?"secondary":"outline",className:"text-xs px-0.5 py-0",children:C.status})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(C.size/1024).toFixed(2)," KB"]}),C.latency&&g.jsxs("div",{children:["Latency: ",C.latency.toFixed(0)," ms"]})]}),C.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(va,{className:"h-2.5 w-2.5"}),C.error]})]})}),C.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(C.payload,null,2)})]})]},C.id||T))})}),g.jsx(ni,{value:"history",className:"mt-1.5 space-y-1",children:d.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(rv,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"History is empty"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:d.map((C,T)=>g.jsxs(wn,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(ht,{variant:"outline",className:"text-xs px-0.5 py-0",children:C.format}),g.jsx(ht,{variant:C.status==="delivered"?"default":C.status==="failed"?"destructive":"outline",className:"text-xs px-0.5 py-0",children:C.status}),g.jsx("span",{className:"text-[9px] text-muted-foreground",children:new Date(C.timestamp).toLocaleTimeString()})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(C.size/1024).toFixed(2)," KB"]}),C.latency&&g.jsxs("div",{children:["Latency: ",C.latency.toFixed(0)," ms"]})]}),C.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(va,{className:"h-2.5 w-2.5"}),C.error]})]})}),C.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(C.payload,null,2)})]})]},C.id||T))})})]})})]})]})}function bL(r){const e=xL(r),t=w.forwardRef((n,s)=>{const{children:a,...c}=n,l=w.Children.toArray(a),d=l.find(SL);if(d){const f=d.props.children,p=l.map(m=>m===d?w.Children.count(f)>1?w.Children.only(null):w.isValidElement(f)?f.props.children:null:m);return g.jsx(e,{...c,ref:s,children:w.isValidElement(f)?w.cloneElement(f,void 0,p):null})}return g.jsx(e,{...c,ref:s,children:a})});return t.displayName=`${r}.Slot`,t}function xL(r){const e=w.forwardRef((t,n)=>{const{children:s,...a}=t;if(w.isValidElement(s)){const c=CL(s),l=ML(a,s.props);return s.type!==w.Fragment&&(l.ref=n?Ts(n,c):c),w.cloneElement(s,l)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var wL=Symbol("radix.slottable");function SL(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===wL}function ML(r,e){const t={...e};for(const n in e){const s=r[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?t[n]=(...l)=>{const d=a(...l);return s(...l),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...a}:n==="className"&&(t[n]=[s,a].filter(Boolean).join(" "))}return{...r,...t}}function CL(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var Nu="Popover",[LM]=Sn(Nu,[Ao]),Xr=Ao(),[EL,Bi]=LM(Nu),IM=r=>{const{__scopePopover:e,children:t,open:n,defaultOpen:s,onOpenChange:a,modal:c=!1}=r,l=Xr(e),d=w.useRef(null),[f,p]=w.useState(!1),[m,y]=Rs({prop:n,defaultProp:s??!1,onChange:a,caller:Nu});return g.jsx(kp,{...l,children:g.jsx(EL,{scope:e,contentId:rs(),triggerRef:d,open:m,onOpenChange:y,onOpenToggle:w.useCallback(()=>y(b=>!b),[y]),hasCustomAnchor:f,onCustomAnchorAdd:w.useCallback(()=>p(!0),[]),onCustomAnchorRemove:w.useCallback(()=>p(!1),[]),modal:c,children:t})})};IM.displayName=Nu;var OM="PopoverAnchor",RL=w.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=Bi(OM,t),a=Xr(t),{onCustomAnchorAdd:c,onCustomAnchorRemove:l}=s;return w.useEffect(()=>(c(),()=>l()),[c,l]),g.jsx(wu,{...a,...n,ref:e})});RL.displayName=OM;var HM="PopoverTrigger",qM=w.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=Bi(HM,t),a=Xr(t),c=je(e,s.triggerRef),l=g.jsx(Ae.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":QM(s.open),...n,ref:c,onClick:ge(r.onClick,s.onOpenToggle)});return s.hasCustomAnchor?l:g.jsx(wu,{asChild:!0,...a,children:l})});qM.displayName=HM;var Hp="PopoverPortal",[kL,TL]=LM(Hp,{forceMount:void 0}),UM=r=>{const{__scopePopover:e,forceMount:t,children:n,container:s}=r,a=Bi(Hp,e);return g.jsx(kL,{scope:e,forceMount:t,children:g.jsx(ln,{present:t||a.open,children:g.jsx(Qr,{asChild:!0,container:s,children:n})})})};UM.displayName=Hp;var So="PopoverContent",$M=w.forwardRef((r,e)=>{const t=TL(So,r.__scopePopover),{forceMount:n=t.forceMount,...s}=r,a=Bi(So,r.__scopePopover);return g.jsx(ln,{present:n||a.open,children:a.modal?g.jsx(DL,{...s,ref:e}):g.jsx(_L,{...s,ref:e})})});$M.displayName=So;var AL=bL("PopoverContent.RemoveScroll"),DL=w.forwardRef((r,e)=>{const t=Bi(So,r.__scopePopover),n=w.useRef(null),s=je(e,n),a=w.useRef(!1);return w.useEffect(()=>{const c=n.current;if(c)return au(c)},[]),g.jsx(Vr,{as:AL,allowPinchZoom:!0,children:g.jsx(BM,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(r.onCloseAutoFocus,c=>{c.preventDefault(),a.current||t.triggerRef.current?.focus()}),onPointerDownOutside:ge(r.onPointerDownOutside,c=>{const l=c.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0,f=l.button===2||d;a.current=f},{checkForDefaultPrevented:!1}),onFocusOutside:ge(r.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),_L=w.forwardRef((r,e)=>{const t=Bi(So,r.__scopePopover),n=w.useRef(!1),s=w.useRef(!1);return g.jsx(BM,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{r.onCloseAutoFocus?.(a),a.defaultPrevented||(n.current||t.triggerRef.current?.focus(),a.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:a=>{r.onInteractOutside?.(a),a.defaultPrevented||(n.current=!0,a.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const c=a.target;t.triggerRef.current?.contains(c)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&s.current&&a.preventDefault()}})}),BM=w.forwardRef((r,e)=>{const{__scopePopover:t,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:a,disableOutsidePointerEvents:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:f,onInteractOutside:p,...m}=r,y=Bi(So,t),b=Xr(t);return su(),g.jsx(Fr,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:a,children:g.jsx(Br,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:p,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:f,onDismiss:()=>y.onOpenChange(!1),children:g.jsx(Tp,{"data-state":QM(y.open),role:"dialog",id:y.contentId,...b,...m,ref:e,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),FM="PopoverClose",NL=w.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=Bi(FM,t);return g.jsx(Ae.button,{type:"button",...n,ref:e,onClick:ge(r.onClick,()=>s.onOpenChange(!1))})});NL.displayName=FM;var jL="PopoverArrow",PL=w.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=Xr(t);return g.jsx(Ap,{...s,...n,ref:e})});PL.displayName=jL;function QM(r){return r?"open":"closed"}var zL=IM,LL=qM,IL=UM,VM=$M;const OL=zL,HL=LL,GM=w.forwardRef(({className:r,align:e="center",sideOffset:t=4,...n},s)=>g.jsx(IL,{children:g.jsx(VM,{ref:s,align:e,sideOffset:t,className:Re("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",r),...n})}));GM.displayName=VM.displayName;const KM=us((r,e)=>({componentStates:new Map,setComponentState:(t,n,s)=>{mo.setComponentState(t,n,s);const a=mo.getComponentState(t);a&&r(c=>({componentStates:new Map(c.componentStates).set(t,a)}))},resetComponent:t=>{mo.resetComponent(t),r(n=>{const s=new Map(n.componentStates);return s.delete(t),{componentStates:s}})},resetAll:()=>{mo.reset(),r({componentStates:new Map})},getComponentState:t=>e().componentStates.get(t),isEnabled:t=>mo.isEnabled(t),getAllStates:()=>Array.from(e().componentStates.values())}));function qL({componentId:r,componentLabel:e}){const{isRunning:t}=Nt(),{getComponentState:n,setComponentState:s,resetComponent:a}=KM(),c=n(r),l=c?.state||"enabled",[d,f]=w.useState(c?.degradedLevel||.5),[p,m]=w.useState(c?.failureRate||.1),[y,b]=w.useState(c?.latencyMultiplier||2),[S,M]=w.useState(c?.throughputMultiplier||.5),E=A=>{A==="degraded"?s(r,A,{degradedLevel:d,failureRate:p,latencyMultiplier:y,throughputMultiplier:S}):s(r,A)},C=()=>{a(r),f(.5),m(.1),b(2),M(.5)},T=A=>{switch(A){case"enabled":return"bg-green-500/20 text-green-500 border-green-500/50";case"disabled":return"bg-gray-500/20 text-gray-500 border-gray-500/50";case"degraded":return"bg-yellow-500/20 text-yellow-500 border-yellow-500/50";case"failed":return"bg-red-500/20 text-red-500 border-red-500/50"}},k=A=>{switch(A){case"enabled":return g.jsx(sh,{className:"w-4 h-4"});case"disabled":return g.jsx(kl,{className:"w-4 h-4"});case"degraded":return g.jsx(as,{className:"w-4 h-4"});case"failed":return g.jsx(pa,{className:"w-4 h-4"})}};return g.jsxs(wn,{className:"border",children:[g.jsx(Ms,{className:"p-2 pb-1.5",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsxs(Cs,{className:"text-[11px] flex items-center gap-1",children:[g.jsx(ya,{className:"w-3 h-3"}),"Component State",g.jsxs(OL,{children:[g.jsx(HL,{asChild:!0,children:g.jsx(ke,{variant:"ghost",size:"icon",className:"h-3.5 w-3.5 rounded-full",children:g.jsx(SA,{className:"w-2.5 h-2.5 text-muted-foreground"})})}),g.jsx(GM,{className:"w-72 text-xs",align:"start",children:g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"font-semibold text-sm",children:"Component States"}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(sh,{className:"w-3.5 h-3.5 text-green-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-green-500",children:"Enabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  normal operation"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(kl,{className:"w-3.5 h-3.5 text-gray-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-gray-500",children:"Disabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  turned off. Throughput=0, Errors=100%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(as,{className:"w-3.5 h-3.5 text-yellow-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-yellow-500",children:"Degraded"}),g.jsx("span",{className:"text-muted-foreground",children:"  partial failure. Throughput 50%, Latency 2x, Errors 10%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(pa,{className:"w-3.5 h-3.5 text-red-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-red-500",children:"Failed"}),g.jsx("span",{className:"text-muted-foreground",children:"  crashed. Same as Disabled but indicates failure"})]})]})]}),g.jsx("p",{className:"text-muted-foreground pt-1 border-t border-border",children:"Use to simulate failures and test architecture resilience."})]})})]})]}),g.jsx(ga,{className:"text-[9px] mt-0.5",children:"Control operational state"})]}),c&&g.jsxs(ht,{variant:"outline",className:`${T(l)} text-xs px-1 py-0.5`,children:[k(l),g.jsx("span",{className:"ml-0.5",children:l.toUpperCase()})]})]})}),g.jsxs(Es,{className:"p-2 pt-1.5 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[g.jsxs(ke,{variant:l==="enabled"?"default":"outline",size:"sm",onClick:()=>E("enabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(sh,{className:"w-3.5 h-3.5"}),"Enabled"]}),g.jsxs(ke,{variant:l==="disabled"?"destructive":"outline",size:"sm",onClick:()=>E("disabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(kl,{className:"w-3.5 h-3.5"}),"Disabled"]}),g.jsxs(ke,{variant:l==="degraded"?"default":"outline",size:"sm",onClick:()=>E("degraded"),className:"flex items-center gap-1 h-7 text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-600 dark:text-yellow-400",disabled:!t,children:[g.jsx(as,{className:"w-3.5 h-3.5"}),"Degraded"]}),g.jsxs(ke,{variant:l==="failed"?"destructive":"outline",size:"sm",onClick:()=>E("failed"),className:"flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(pa,{className:"w-3.5 h-3.5"}),"Failed"]})]}),l==="degraded"&&g.jsxs("div",{className:"space-y-2 p-2 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[g.jsx(Db,{className:"w-3 h-3 text-yellow-600 dark:text-yellow-400"}),g.jsx(st,{className:"text-[11px] font-semibold text-yellow-600 dark:text-yellow-400",children:"Degradation Settings"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Degradation Level"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(d*100).toFixed(0),"%"]})]}),g.jsx(is,{value:[d],onValueChange:A=>{f(A[0]),E("degraded")},min:0,max:1,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Failure Rate"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(p*100).toFixed(0),"%"]})]}),g.jsx(is,{value:[p],onValueChange:A=>{m(A[0]),E("degraded")},min:0,max:1,step:.05,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Latency Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[y.toFixed(1),"x"]})]}),g.jsx(is,{value:[y],onValueChange:A=>{b(A[0]),E("degraded")},min:1,max:5,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Throughput Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(S*100).toFixed(0),"%"]})]}),g.jsx(is,{value:[S],onValueChange:A=>{M(A[0]),E("degraded")},min:0,max:1,step:.05,className:"w-full"})]})]})]}),c&&g.jsxs(ke,{variant:"outline",size:"sm",onClick:C,className:"w-full flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(Ab,{className:"w-3.5 h-3.5"}),"Reset to Normal"]}),!t&&g.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded text-[9px] text-muted-foreground",children:[g.jsx(va,{className:"w-3 h-3"}),"Start emulation to control component state"]})]})]})}function UL({onFilterChange:r}){const{nodes:e,connections:t,selectNode:n}=Ee(),{isRunning:s,getComponentMetrics:a}=Nt(),{getAllComponentStatuses:c}=ma(),[l,d]=w.useState(""),[f,p]=w.useState(!1),[m,y]=w.useState(!0),[b,S]=w.useState(!0),[M,E]=w.useState(!0),[C,T]=w.useState(!0),[k,A]=w.useState(100),[_,N]=w.useState(5),[L,q]=w.useState(new Set),Z=kt.useMemo(()=>s?e.filter(te=>{if(l&&!te.data.label.toLowerCase().includes(l.toLowerCase()))return!1;if(!f)return!0;const le=a(te.id),z=c().find(j=>j.nodeId===te.id);return!!(m&&t.some(O=>O.source===te.id||O.target===te.id?Nt.getState().getConnectionMetrics(O.id)?.bottleneck:!1)||b&&le&&le.errorRate*100>=_||C&&le&&le.latency>=k||M&&z?.criticalPath||z&&(z.health==="critical"||z.health==="down"))}):e,[l,f,m,b,C,M,k,_,s,e,t]);kt.useEffect(()=>{if(f){const te=new Set(Z.map(le=>le.id));q(te),r?.(Array.from(te))}else q(new Set),r?.(e.map(te=>te.id))},[f,Z,e,r]);const se=te=>{n(te)},ce=Z.length,J=e.filter(te=>{if(!s)return!1;const le=a(te.id),z=c().find(j=>j.nodeId===te.id);return le&&(le.errorRate*100>=_||le.latency>=k)||z?.criticalPath||z&&(z.health==="critical"||z.health==="down")||t.some(j=>j.source===te.id||j.target===te.id?Nt.getState().getConnectionMetrics(j.id)?.bottleneck:!1)}).length;return g.jsxs(wn,{className:"h-full border-2",children:[g.jsx(Ms,{className:"pb-3",children:g.jsxs(Cs,{className:"text-sm flex items-center gap-2",children:[g.jsx(Rb,{className:"w-4 h-4"}),"Problem Filters",ce>0&&g.jsx(ht,{variant:"destructive",className:"ml-auto",children:ce})]})}),g.jsxs(Es,{className:"space-y-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(st,{className:"text-xs",children:"Search Components"}),g.jsxs("div",{className:"relative",children:[g.jsx(Ur,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search by name...",value:l,onChange:te=>d(te.target.value),className:"pl-8 h-8 text-xs"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(DA,{className:"w-4 h-4"}),"Show Only Problems"]}),g.jsx(ha,{checked:f,onCheckedChange:p})]}),f&&g.jsxs("div",{className:"pl-6 space-y-2 border-l-2 border-border",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(Db,{className:"w-4 h-4 text-red-500"}),"Bottlenecks"]}),g.jsx(ha,{checked:m,onCheckedChange:y})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(pa,{className:"w-4 h-4 text-orange-500"}),"High Error Rate (>",_,"%)"]}),g.jsx(ha,{checked:b,onCheckedChange:S})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(_b,{className:"w-4 h-4 text-yellow-500"}),"High Latency (>",k,"ms)"]}),g.jsx(ha,{checked:C,onCheckedChange:T})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(ya,{className:"w-4 h-4 text-purple-500"}),"Critical Paths"]}),g.jsx(ha,{checked:M,onCheckedChange:E})]})]})]}),f&&g.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[g.jsxs("div",{children:[g.jsx(st,{className:"text-xs",children:"Min Latency (ms)"}),g.jsx(Tt,{type:"number",value:k,onChange:te=>A(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0})]}),g.jsxs("div",{children:[g.jsx(st,{className:"text-xs",children:"Min Error Rate (%)"}),g.jsx(Tt,{type:"number",value:_,onChange:te=>N(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0,max:100})]})]}),s&&g.jsx("div",{className:"pt-2 border-t border-border",children:g.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total problems detected: ",g.jsx("span",{className:"font-semibold text-foreground",children:J})]})}),f&&Z.length>0&&g.jsx(an,{className:"h-48 border border-border rounded p-2",children:g.jsx("div",{className:"space-y-1",children:Z.map(te=>{const le=a(te.id),z=c().find(j=>j.nodeId===te.id);return g.jsx(ke,{variant:"ghost",size:"sm",className:"w-full justify-start text-xs h-auto py-1.5",onClick:()=>se(te.id),children:g.jsxs("div",{className:"flex items-center gap-2 w-full",children:[z?.criticalPath&&g.jsx(ht,{variant:"outline",className:"bg-purple-500/20 text-purple-500 border-purple-500/50 text-xs px-1",children:"Critical"}),g.jsx("span",{className:"flex-1 text-left truncate",children:te.data.label}),le&&le.errorRate*100>=_&&g.jsxs(ht,{variant:"destructive",className:"text-xs px-1",children:[(le.errorRate*100).toFixed(0),"%"]})]})},te.id)})})}),!s&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-4",children:"Start emulation to see problems"})]})]})}function $L(){const{nodes:r,connections:e}=Ee(),{isRunning:t,getComponentMetrics:n,getConnectionMetrics:s}=Nt(),{getAllComponentStatuses:a,getSystemAnalysis:c}=ma(),[l,d]=w.useState(""),[f,p]=w.useState("all");if(!t)return g.jsx(wn,{className:"h-full",children:g.jsxs(Ms,{children:[g.jsx(Cs,{children:"Diagnostics"}),g.jsx(ga,{children:"Start emulation to see diagnostics"})]})});const m=[],y=a();c(),r.forEach(E=>{const C=n(E.id),T=y.find(_=>_.nodeId===E.id);if(!C||!T)return;const k={nodeId:E.id,nodeLabel:E.data.label,problem:"",severity:"info",metrics:{throughput:C.throughput,latency:C.latency,errorRate:C.errorRate,utilization:C.utilization},affectedConnections:[],recommendations:[]},A=e.filter(_=>_.source===E.id||_.target===E.id?s(_.id)?.bottleneck:!1);if(A.length>0){k.problem=`Bottleneck detected in ${A.length} connection(s)`,k.severity="critical",k.affectedConnections=A.map(_=>_.id),k.rootCause="High throughput dependency or backpressure",k.recommendations=["Consider scaling this component horizontally","Optimize data processing logic","Check for connection bandwidth limits"],m.push(k);return}if(C.errorRate>.05){k.problem=`High error rate: ${(C.errorRate*100).toFixed(1)}%`,k.severity=C.errorRate>.1?"critical":"warning",k.rootCause="Component is experiencing failures",k.recommendations=["Check component logs for error details","Verify input data format and validation","Review retry and error handling logic"],m.push(k);return}if(C.latency>1e3){k.problem=`High latency: ${C.latency.toFixed(0)}ms`,k.severity=C.latency>2e3?"critical":"warning",k.rootCause="Component processing is slow",k.recommendations=["Optimize database queries or data processing","Consider caching frequently accessed data","Review component configuration for performance"],m.push(k);return}if(C.utilization>.9){k.problem=`High utilization: ${(C.utilization*100).toFixed(0)}%`,k.severity="warning",k.rootCause="Component is near capacity",k.recommendations=["Consider scaling this component","Optimize resource usage","Monitor for potential failures"],m.push(k);return}(T.health==="critical"||T.health==="down")&&(k.problem=`Component health: ${T.health}`,k.severity="critical",k.rootCause="Component is in critical state or down",k.recommendations=["Immediately check component status","Review error logs and metrics","Consider failover or restart"],m.push(k))});const b=m.filter(E=>!(f!=="all"&&E.severity!==f||l&&!E.nodeLabel.toLowerCase().includes(l.toLowerCase()))),S=E=>{switch(E){case"critical":return g.jsx(pa,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(as,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(va,{className:"w-4 h-4 text-blue-500"})}},M=E=>{switch(E){case"critical":return g.jsx(ht,{variant:"destructive",className:"text-xs",children:"Critical"});case"warning":return g.jsx(ht,{variant:"outline",className:"border-yellow-500 text-yellow-600 text-xs",children:"Warning"});default:return g.jsx(ht,{variant:"outline",className:"text-xs",children:"Info"})}};return g.jsxs(wn,{className:"h-full flex flex-col",children:[g.jsxs(Ms,{className:"pb-3",children:[g.jsx(Cs,{className:"text-sm font-semibold",children:"Diagnostics"}),g.jsxs(ga,{className:"text-xs text-muted-foreground",children:[b.length," problem",b.length!==1?"s":""," detected"]})]}),g.jsxs(Es,{className:"flex-1 flex flex-col overflow-hidden p-0",children:[g.jsxs("div",{className:"p-4 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx(Ur,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search components...",value:l,onChange:E=>d(E.target.value),className:"pl-8 h-8 text-xs"})]}),g.jsxs("div",{className:"flex gap-1",children:[g.jsx(ke,{variant:f==="all"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>p("all"),children:"All"}),g.jsx(ke,{variant:f==="critical"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>p("critical"),children:"Critical"}),g.jsx(ke,{variant:f==="warning"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>p("warning"),children:"Warning"})]})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-4 space-y-2",children:b.length===0?g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-6",children:[g.jsx(ya,{className:"w-6 h-6 mx-auto mb-1.5 opacity-50"}),g.jsx("p",{children:"No problems detected"})]}):b.map((E,C)=>g.jsxs(wn,{className:`border-l-4 ${E.severity==="critical"?"border-l-red-500":E.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsxs(Ms,{className:"pb-2 p-3",children:[g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[S(E.severity),g.jsx(Cs,{className:"text-xs font-semibold",children:E.nodeLabel}),M(E.severity)]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{r.find(k=>k.id===E.nodeId)&&Ee.getState().selectNode(E.nodeId)},children:g.jsx(uA,{className:"w-3.5 h-3.5"})})]}),g.jsx(ga,{className:"text-xs mt-0.5",children:E.problem})]}),g.jsxs(Es,{className:"pt-0 p-3 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[E.metrics.throughput!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Throughput: "}),g.jsxs("span",{className:"font-mono",children:[E.metrics.throughput.toFixed(0)," ops/s"]})]}),E.metrics.latency!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Latency: "}),g.jsxs("span",{className:"font-mono",children:[E.metrics.latency.toFixed(0),"ms"]})]}),E.metrics.errorRate!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Error Rate: "}),g.jsxs("span",{className:"font-mono",children:[(E.metrics.errorRate*100).toFixed(1),"%"]})]}),E.metrics.utilization!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Utilization: "}),g.jsxs("span",{className:"font-mono",children:[(E.metrics.utilization*100).toFixed(0),"%"]})]})]}),E.rootCause&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Root Cause:"}),g.jsx("div",{className:"text-xs",children:E.rootCause})]}),E.recommendations.length>0&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Recommendations:"}),g.jsx("ul",{className:"text-xs space-y-0.5 list-disc list-inside",children:E.recommendations.map((T,k)=>g.jsx("li",{className:"text-muted-foreground",children:T},k))})]})]})]},C))})})]})]})}function BL(){const{alerts:r,acknowledgeAlert:e,clearAlerts:t,getCriticalAlerts:n,getWarningAlerts:s}=Kh(),{selectNode:a}=Ee(),c=n(),l=s();r.filter(p=>p.type==="info");const d=p=>{switch(p){case"critical":return g.jsx(pa,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(as,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(kb,{className:"w-4 h-4 text-blue-500"})}},f=p=>{a(p)};return r.length===0?g.jsxs(wn,{className:"h-full",children:[g.jsx(Ms,{children:g.jsx(Cs,{className:"text-sm",children:"Alerts"})}),g.jsx(Es,{children:g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(Xh,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),g.jsx("p",{children:"No active alerts"})]})})]}):g.jsxs(wn,{className:"h-full flex flex-col",children:[g.jsx(Ms,{className:"pb-3",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx(Cs,{className:"text-sm",children:"Alerts"}),g.jsxs("div",{className:"flex gap-2 mt-1",children:[c.length>0&&g.jsxs(ht,{variant:"destructive",className:"text-xs",children:[c.length," Critical"]}),l.length>0&&g.jsxs(ht,{variant:"outline",className:"text-xs border-yellow-500 text-yellow-600",children:[l.length," Warning"]})]})]}),g.jsx(ke,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:t,children:"Clear All"})]})}),g.jsx(Es,{className:"flex-1 overflow-hidden p-0",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-4 space-y-2",children:r.map(p=>g.jsx(wn,{className:`border-l-4 ${p.type==="critical"?"border-l-red-500 bg-red-500/5":p.type==="warning"?"border-l-yellow-500 bg-yellow-500/5":"border-l-blue-500 bg-blue-500/5"}`,children:g.jsx(Es,{className:"p-3",children:g.jsxs("div",{className:"flex items-start justify-between gap-2",children:[g.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[d(p.type),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("h4",{className:"text-xs font-semibold",children:p.title}),g.jsx(ht,{variant:p.type==="critical"?"destructive":p.type==="warning"?"outline":"secondary",className:"text-xs",children:p.type})]}),g.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:p.message}),p.nodeLabel&&g.jsxs(ke,{variant:"ghost",size:"sm",className:"h-6 text-xs p-1",onClick:()=>p.nodeId&&f(p.nodeId),children:["View: ",p.nodeLabel]}),g.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(p.timestamp).toLocaleTimeString()})]})]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>e(p.id),children:g.jsx(os,{className:"w-3 h-3"})})]})})},p.id))})})})]})}function FL(){const{nodes:r,connections:e}=Ee(),{isRunning:t,componentMetrics:n,connectionMetrics:s}=Nt(),{getSystemAnalysis:a}=ma(),{getCriticalAlerts:c,getWarningAlerts:l}=Kh(),d=w.useMemo(()=>{if(!t)return{totalThroughput:0,averageLatency:0,totalErrorRate:0,activeComponents:0,activeConnections:0,bottlenecks:0,healthyComponents:0,degradedComponents:0,criticalComponents:0};let m=0,y=0,b=0,S=0,M=0,E=0,C=0,T=0,k=0;n.forEach(L=>{(L.throughput>.1||L.errorRate>.001)&&(S++,m+=L.throughput||0,y+=L.latency||0,b+=L.errorRate||0)}),s.forEach(L=>{(L.effectiveThroughput>0||L.traffic>0)&&(M++,L.bottleneck&&E++)});const A=ma.getState();r.forEach(L=>{const q=A.getComponentStatus(L.id);if(q)switch(q.health){case"healthy":C++;break;case"degraded":T++;break;case"critical":case"down":k++;break}});const _=S>0?y/S:0,N=S>0?b/S:0;return{totalThroughput:m,averageLatency:_,totalErrorRate:N,activeComponents:S,activeConnections:M,bottlenecks:E,healthyComponents:C,degradedComponents:T,criticalComponents:k}},[t,n,s,r]),f=c(),p=l();return t?g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Performance"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Total Throughput"}),g.jsxs(da,{status:"success",size:"base",weight:"bold",children:[d.totalThroughput.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ops/s"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Avg Latency"}),g.jsxs(da,{status:"warning",size:"base",weight:"bold",children:[d.averageLatency.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ms"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Error Rate"}),g.jsxs(da,{status:"error",size:"base",weight:"bold",children:[(d.totalErrorRate*100).toFixed(2),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"%"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Bottlenecks"}),g.jsxs(da,{status:"warning",size:"base",weight:"bold",children:[d.bottlenecks,g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"conn"})]})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Component Health"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(Xh,{className:"w-4 h-4 text-success"}),g.jsx(We,{size:"micro",children:"Healthy"})]}),g.jsx(ht,{variant:"outline",className:"bg-success/20 border-success/50 text-success text-xs px-1 py-0",children:d.healthyComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(as,{className:"w-4 h-4 text-warning"}),g.jsx(We,{size:"micro",children:"Degraded"})]}),g.jsx(ht,{variant:"outline",className:"bg-warning/20 border-warning/50 text-warning text-xs px-1 py-0",children:d.degradedComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(as,{className:"w-4 h-4 text-destructive"}),g.jsx(We,{size:"micro",children:"Critical/Down"})]}),g.jsx(ht,{variant:"outline",className:"bg-destructive/20 border-destructive/50 text-destructive text-xs px-1 py-0",children:d.criticalComponents})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Activity"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(QA,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Components"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[d.activeComponents," / ",r.length]})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(_b,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Connections"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[d.activeConnections," / ",e.length]})]})]})]}),(f.length>0||p.length>0)&&g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Alerts"}),g.jsxs("div",{className:"space-y-0.5",children:[f.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(da,{status:"error",size:"micro",children:"Critical"}),g.jsx(ht,{variant:"destructive",className:"text-xs px-1 py-0",children:f.length})]}),p.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(da,{status:"warning",size:"micro",children:"Warnings"}),g.jsx(ht,{variant:"outline",className:"border-warning text-warning text-xs px-1 py-0",children:p.length})]})]})]})]}):g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(ya,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),g.jsx("p",{children:"Start emulation to see system statistics"})]})}const wl=43200,Lv=1440,Iv=Symbol.for("constructDateFrom");function qp(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&Iv in r?r[Iv](e):r instanceof Date?new r.constructor(e):new Date(e)}function Hi(r,e){return qp(r,r)}let QL={};function VL(){return QL}function Ov(r){const e=Hi(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function Up(r,...e){const t=qp.bind(null,r||e.find(n=>typeof n=="object"));return e.map(t)}function Pl(r,e){const t=+Hi(r)-+Hi(e);return t<0?-1:t>0?1:t}function GL(r){return qp(r,Date.now())}function KL(r,e,t){const[n,s]=Up(t?.in,r,e),a=n.getFullYear()-s.getFullYear(),c=n.getMonth()-s.getMonth();return a*12+c}function YL(r){return e=>{const n=(r?Math[r]:Math.trunc)(e);return n===0?0:n}}function WL(r,e){return+Hi(r)-+Hi(e)}function XL(r,e){const t=Hi(r);return t.setHours(23,59,59,999),t}function JL(r,e){const t=Hi(r),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function ZL(r,e){const t=Hi(r);return+XL(t)==+JL(t)}function e5(r,e,t){const[n,s,a]=Up(t?.in,r,r,e),c=Pl(s,a),l=Math.abs(KL(s,a));if(l<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-c*l);let d=Pl(s,a)===-c;ZL(n)&&l===1&&Pl(n,a)===1&&(d=!1);const f=c*(l-+d);return f===0?0:f}function t5(r,e,t){const n=WL(r,e)/1e3;return YL(t?.roundingMethod)(n)}const n5={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},s5=(r,e,t)=>{let n;const s=n5[r];return typeof s=="string"?n=s:e===1?n=s.one:n=s.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function gh(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const i5={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},a5={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},o5={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},r5={date:gh({formats:i5,defaultWidth:"full"}),time:gh({formats:a5,defaultWidth:"full"}),dateTime:gh({formats:o5,defaultWidth:"full"})},c5={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},l5=(r,e,t,n)=>c5[r];function Er(r){return(e,t)=>{const n=t?.context?String(t.context):"standalone";let s;if(n==="formatting"&&r.formattingValues){const c=r.defaultFormattingWidth||r.defaultWidth,l=t?.width?String(t.width):c;s=r.formattingValues[l]||r.formattingValues[c]}else{const c=r.defaultWidth,l=t?.width?String(t.width):r.defaultWidth;s=r.values[l]||r.values[c]}const a=r.argumentCallback?r.argumentCallback(e):e;return s[a]}}const u5={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},d5={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},f5={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},h5={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},p5={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},g5={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},m5=(r,e)=>{const t=Number(r),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},y5={ordinalNumber:m5,era:Er({values:u5,defaultWidth:"wide"}),quarter:Er({values:d5,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Er({values:f5,defaultWidth:"wide"}),day:Er({values:h5,defaultWidth:"wide"}),dayPeriod:Er({values:p5,defaultWidth:"wide",formattingValues:g5,defaultFormattingWidth:"wide"})};function Rr(r){return(e,t={})=>{const n=t.width,s=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],a=e.match(s);if(!a)return null;const c=a[0],l=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],d=Array.isArray(l)?b5(l,m=>m.test(c)):v5(l,m=>m.test(c));let f;f=r.valueCallback?r.valueCallback(d):d,f=t.valueCallback?t.valueCallback(f):f;const p=e.slice(c.length);return{value:f,rest:p}}}function v5(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function b5(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function x5(r){return(e,t={})=>{const n=e.match(r.matchPattern);if(!n)return null;const s=n[0],a=e.match(r.parsePattern);if(!a)return null;let c=r.valueCallback?r.valueCallback(a[0]):a[0];c=t.valueCallback?t.valueCallback(c):c;const l=e.slice(s.length);return{value:c,rest:l}}}const w5=/^(\d+)(th|st|nd|rd)?/i,S5=/\d+/i,M5={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},C5={any:[/^b/i,/^(a|c)/i]},E5={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},R5={any:[/1/i,/2/i,/3/i,/4/i]},k5={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},T5={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},A5={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},D5={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},_5={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},N5={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},j5={ordinalNumber:x5({matchPattern:w5,parsePattern:S5,valueCallback:r=>parseInt(r,10)}),era:Rr({matchPatterns:M5,defaultMatchWidth:"wide",parsePatterns:C5,defaultParseWidth:"any"}),quarter:Rr({matchPatterns:E5,defaultMatchWidth:"wide",parsePatterns:R5,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Rr({matchPatterns:k5,defaultMatchWidth:"wide",parsePatterns:T5,defaultParseWidth:"any"}),day:Rr({matchPatterns:A5,defaultMatchWidth:"wide",parsePatterns:D5,defaultParseWidth:"any"}),dayPeriod:Rr({matchPatterns:_5,defaultMatchWidth:"any",parsePatterns:N5,defaultParseWidth:"any"})},P5={code:"en-US",formatDistance:s5,formatLong:r5,formatRelative:l5,localize:y5,match:j5,options:{weekStartsOn:0,firstWeekContainsDate:1}};function z5(r,e,t){const n=VL(),s=t?.locale??n.locale??P5,a=2520,c=Pl(r,e);if(isNaN(c))throw new RangeError("Invalid time value");const l=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:c}),[d,f]=Up(t?.in,...c>0?[e,r]:[r,e]),p=t5(f,d),m=(Ov(f)-Ov(d))/1e3,y=Math.round((p-m)/60);let b;if(y<2)return t?.includeSeconds?p<5?s.formatDistance("lessThanXSeconds",5,l):p<10?s.formatDistance("lessThanXSeconds",10,l):p<20?s.formatDistance("lessThanXSeconds",20,l):p<40?s.formatDistance("halfAMinute",0,l):p<60?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",1,l):y===0?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",y,l);if(y<45)return s.formatDistance("xMinutes",y,l);if(y<90)return s.formatDistance("aboutXHours",1,l);if(y<Lv){const S=Math.round(y/60);return s.formatDistance("aboutXHours",S,l)}else{if(y<a)return s.formatDistance("xDays",1,l);if(y<wl){const S=Math.round(y/Lv);return s.formatDistance("xDays",S,l)}else if(y<wl*2)return b=Math.round(y/wl),s.formatDistance("aboutXMonths",b,l)}if(b=e5(f,d),b<12){const S=Math.round(y/wl);return s.formatDistance("xMonths",S,l)}else{const S=b%12,M=Math.trunc(b/12);return S<3?s.formatDistance("aboutXYears",M,l):S<9?s.formatDistance("overXYears",M,l):s.formatDistance("almostXYears",M+1,l)}}function L5(r,e){return z5(r,GL(r),e)}function I5(){const{errors:r,updateErrors:e,clearErrors:t,removeError:n,getErrorCount:s,getStats:a}=Sb(),{nodes:c}=Ee(),[l,d]=w.useState("all"),[f,p]=w.useState("all"),[m,y]=w.useState("all"),[b,S]=w.useState("");w.useEffect(()=>{e();const N=setInterval(()=>{e()},1e3);return()=>clearInterval(N)},[e]);const M=a(),E=w.useMemo(()=>{let N=r;if(l!=="all"&&(N=N.filter(L=>L.severity===l)),f!=="all"&&(N=N.filter(L=>L.source===f)),m!=="all"&&(N=N.filter(L=>L.componentId===m)),b){const L=b.toLowerCase();N=N.filter(q=>q.message.toLowerCase().includes(L)||q.componentLabel?.toLowerCase().includes(L)||q.componentType?.toLowerCase().includes(L)||q.errorType?.toLowerCase().includes(L))}return N},[r,l,f,m,b]),C=w.useMemo(()=>{const N=new Map;return r.forEach(L=>{L.componentId&&L.componentLabel&&N.set(L.componentId,{id:L.componentId,label:L.componentLabel,type:L.componentType||"unknown"})}),Array.from(N.values())},[r]),T=N=>{switch(N){case"critical":return g.jsx(pA,{className:"h-3 w-3 text-red-500"});case"warning":return g.jsx(as,{className:"h-3 w-3 text-yellow-500"});case"info":return g.jsx(kb,{className:"h-3 w-3 text-blue-500"})}},k=N=>{switch(N){case"critical":return g.jsx(ht,{variant:"destructive",className:"text-[9px] px-1 py-0 h-4",children:"Critical"});case"warning":return g.jsx(ht,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"Warning"});case"info":return g.jsx(ht,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-blue-500/10 text-blue-600 border-blue-500",children:"Info"})}},A=N=>{const L={"emulation-engine":"bg-purple-500/10 text-purple-600 border-purple-500","component-engine":"bg-green-500/10 text-green-600 border-green-500","alert-system":"bg-orange-500/10 text-orange-600 border-orange-500","data-flow":"bg-cyan-500/10 text-cyan-600 border-cyan-500","routing-engine":"bg-pink-500/10 text-pink-600 border-pink-500",initialization:"bg-indigo-500/10 text-indigo-600 border-indigo-500",configuration:"bg-gray-500/10 text-gray-600 border-gray-500",unknown:"bg-gray-500/10 text-gray-600 border-gray-500"},q={"emulation-engine":"Engine","component-engine":"Component","alert-system":"Alert","data-flow":"DataFlow","routing-engine":"Routing",initialization:"Init",configuration:"Config",unknown:"Unknown"};return g.jsx(ht,{variant:"outline",className:`text-[9px] px-1 py-0 h-4 ${L[N]||L.unknown}`,children:q[N]||q.unknown})},_=N=>{try{return L5(new Date(N),{addSuffix:!0})}catch{return"unknown time"}};return g.jsxs("div",{className:"h-full flex flex-col",children:[g.jsxs("div",{className:"p-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(va,{className:"h-4 w-4 text-muted-foreground"}),g.jsx("h3",{className:"text-sm font-semibold",children:"Simulation Errors"})]}),r.length>0&&g.jsxs(ke,{variant:"ghost",size:"sm",onClick:t,className:"h-6 text-xs",children:[g.jsx(Zl,{className:"h-3 w-3 mr-1"}),"Clear All"]})]}),g.jsxs("div",{className:"flex gap-2 text-xs",children:[g.jsxs(ht,{variant:"outline",className:"text-xs",children:["Total: ",M.total]}),M.critical>0&&g.jsxs(ht,{variant:"destructive",className:"text-xs",children:["Critical: ",M.critical]}),M.warning>0&&g.jsxs(ht,{variant:"outline",className:"text-xs bg-yellow-500/10 text-yellow-600 border-yellow-500",children:["Warning: ",M.warning]}),M.info>0&&g.jsxs(ht,{variant:"outline",className:"text-xs bg-blue-500/10 text-blue-600 border-blue-500",children:["Info: ",M.info]})]})]}),g.jsxs("div",{className:"p-2 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx(Ur,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search errors...",value:b,onChange:N=>S(N.target.value),className:"h-7 pl-7 text-xs"})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[g.jsxs(Nl,{value:l,onValueChange:N=>d(N),children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(jl,{placeholder:"Severity"})}),g.jsxs(_r,{children:[g.jsx(Qt,{value:"all",children:"All Severities"}),g.jsx(Qt,{value:"critical",children:"Critical"}),g.jsx(Qt,{value:"warning",children:"Warning"}),g.jsx(Qt,{value:"info",children:"Info"})]})]}),g.jsxs(Nl,{value:f,onValueChange:N=>p(N),children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(jl,{placeholder:"Source"})}),g.jsxs(_r,{children:[g.jsx(Qt,{value:"all",children:"All Sources"}),g.jsx(Qt,{value:"emulation-engine",children:"Emulation Engine"}),g.jsx(Qt,{value:"component-engine",children:"Component Engine"}),g.jsx(Qt,{value:"alert-system",children:"Alert System"}),g.jsx(Qt,{value:"data-flow",children:"Data Flow"}),g.jsx(Qt,{value:"routing-engine",children:"Routing Engine"}),g.jsx(Qt,{value:"initialization",children:"Initialization"}),g.jsx(Qt,{value:"configuration",children:"Configuration"})]})]})]}),C.length>0&&g.jsxs(Nl,{value:m,onValueChange:y,children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(jl,{placeholder:"Component"})}),g.jsxs(_r,{children:[g.jsx(Qt,{value:"all",children:"All Components"}),C.map(N=>g.jsxs(Qt,{value:N.id,children:[N.label," (",N.type,")"]},N.id))]})]})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:E.length===0?g.jsx("div",{className:"text-center text-sm text-muted-foreground py-8",children:r.length===0?g.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g.jsx(va,{className:"h-8 w-8 opacity-50"}),g.jsx("p",{children:"No errors detected"})]}):g.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g.jsx(Rb,{className:"h-8 w-8 opacity-50"}),g.jsx("p",{children:"No errors match the filters"})]})}):E.map(N=>g.jsxs(wn,{className:`border-l-2 ${N.severity==="critical"?"border-l-red-500":N.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsx(Ms,{className:"pb-1 p-1.5",children:g.jsxs("div",{className:"flex items-start justify-between gap-1",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5 flex-wrap",children:[g.jsx("span",{className:"flex-shrink-0",children:T(N.severity)}),g.jsx(Cs,{className:"text-[11px] font-semibold truncate",children:N.componentLabel||"System"}),g.jsx("span",{className:"flex-shrink-0",children:k(N.severity)}),g.jsx("span",{className:"flex-shrink-0",children:A(N.source)}),N.count&&N.count>1&&g.jsxs(ht,{variant:"outline",className:"text-[9px] px-1 py-0 h-4",children:[N.count,"x"]})]}),g.jsx(ga,{className:"text-[10px] mt-0.5 break-words line-clamp-2",children:N.message}),g.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[9px] text-muted-foreground",children:[g.jsx("span",{children:_(N.timestamp)}),N.componentType&&g.jsxs("span",{className:"truncate",children:[" ",N.componentType]}),N.errorType&&g.jsxs("span",{className:"truncate",children:[" ",N.errorType]})]})]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5 flex-shrink-0",onClick:()=>n(N.id),children:g.jsx(os,{className:"h-3 w-3"})})]})}),N.context&&Object.keys(N.context).length>0||N.stack?g.jsxs(Es,{className:"pt-0 p-1.5 space-y-1",children:[N.context&&Object.keys(N.context).length>0&&g.jsxs("details",{className:"text-[9px]",children:[g.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Context"}),g.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:JSON.stringify(N.context,null,2)})]}),N.stack&&g.jsxs("details",{className:"text-[9px]",children:[g.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Stack"}),g.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:N.stack})]})]}):null]},N.id))})})]})}var ju="Checkbox",[O5]=Sn(ju),[H5,$p]=O5(ju);function q5(r){const{__scopeCheckbox:e,checked:t,children:n,defaultChecked:s,disabled:a,form:c,name:l,onCheckedChange:d,required:f,value:p="on",internal_do_not_use_render:m}=r,[y,b]=Rs({prop:t,defaultProp:s??!1,onChange:d,caller:ju}),[S,M]=w.useState(null),[E,C]=w.useState(null),T=w.useRef(!1),k=S?!!c||!!S.closest("form"):!0,A={checked:y,disabled:a,setChecked:b,control:S,setControl:M,name:l,form:c,value:p,hasConsumerStoppedPropagationRef:T,required:f,defaultChecked:Li(s)?!1:s,isFormControl:k,bubbleInput:E,setBubbleInput:C};return g.jsx(H5,{scope:e,...A,children:U5(m)?m(A):n})}var YM="CheckboxTrigger",WM=w.forwardRef(({__scopeCheckbox:r,onKeyDown:e,onClick:t,...n},s)=>{const{control:a,value:c,disabled:l,checked:d,required:f,setControl:p,setChecked:m,hasConsumerStoppedPropagationRef:y,isFormControl:b,bubbleInput:S}=$p(YM,r),M=je(s,p),E=w.useRef(d);return w.useEffect(()=>{const C=a?.form;if(C){const T=()=>m(E.current);return C.addEventListener("reset",T),()=>C.removeEventListener("reset",T)}},[a,m]),g.jsx(Ae.button,{type:"button",role:"checkbox","aria-checked":Li(d)?"mixed":d,"aria-required":f,"data-state":tC(d),"data-disabled":l?"":void 0,disabled:l,value:c,...n,ref:M,onKeyDown:ge(e,C=>{C.key==="Enter"&&C.preventDefault()}),onClick:ge(t,C=>{m(T=>Li(T)?!0:!T),S&&b&&(y.current=C.isPropagationStopped(),y.current||C.stopPropagation())})})});WM.displayName=YM;var Bp=w.forwardRef((r,e)=>{const{__scopeCheckbox:t,name:n,checked:s,defaultChecked:a,required:c,disabled:l,value:d,onCheckedChange:f,form:p,...m}=r;return g.jsx(q5,{__scopeCheckbox:t,checked:s,defaultChecked:a,disabled:l,required:c,onCheckedChange:f,name:n,form:p,value:d,internal_do_not_use_render:({isFormControl:y})=>g.jsxs(g.Fragment,{children:[g.jsx(WM,{...m,ref:e,__scopeCheckbox:t}),y&&g.jsx(eC,{__scopeCheckbox:t})]})})});Bp.displayName=ju;var XM="CheckboxIndicator",JM=w.forwardRef((r,e)=>{const{__scopeCheckbox:t,forceMount:n,...s}=r,a=$p(XM,t);return g.jsx(ln,{present:n||Li(a.checked)||a.checked===!0,children:g.jsx(Ae.span,{"data-state":tC(a.checked),"data-disabled":a.disabled?"":void 0,...s,ref:e,style:{pointerEvents:"none",...r.style}})})});JM.displayName=XM;var ZM="CheckboxBubbleInput",eC=w.forwardRef(({__scopeCheckbox:r,...e},t)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:a,defaultChecked:c,required:l,disabled:d,name:f,value:p,form:m,bubbleInput:y,setBubbleInput:b}=$p(ZM,r),S=je(t,b),M=Ru(a),E=xu(n);w.useEffect(()=>{const T=y;if(!T)return;const k=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(k,"checked").set,N=!s.current;if(M!==a&&_){const L=new Event("click",{bubbles:N});T.indeterminate=Li(a),_.call(T,Li(a)?!1:a),T.dispatchEvent(L)}},[y,M,a,s]);const C=w.useRef(Li(a)?!1:a);return g.jsx(Ae.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??C.current,required:l,disabled:d,name:f,value:p,form:m,...e,tabIndex:-1,ref:S,style:{...e.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});eC.displayName=ZM;function U5(r){return typeof r=="function"}function Li(r){return r==="indeterminate"}function tC(r){return Li(r)?"indeterminate":r?"checked":"unchecked"}const Oh=w.forwardRef(({className:r,...e},t)=>g.jsx(Bp,{ref:t,className:Re("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...e,children:g.jsx(JM,{className:Re("grid place-content-center text-current"),children:g.jsx(Yh,{className:"h-4 w-4"})})}));Oh.displayName=Bp.displayName;function nC({open:r,groupName:e,onConfirm:t,onCancel:n}){return g.jsx(Ux,{open:r,onOpenChange:s=>!s&&n(),children:g.jsxs(up,{children:[g.jsxs(Bx,{children:[g.jsx(dp,{children:"Delete Group?"}),g.jsxs(fp,{children:['Are you sure you want to delete the group "',e,'"? This action cannot be undone.']})]}),g.jsxs(Fx,{children:[g.jsx(pp,{onClick:n,children:"Cancel"}),g.jsx(hp,{onClick:t,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}function $5({group:r}){const{nodes:e,updateGroup:t,deleteGroup:n,removeNodeFromGroup:s,addNodeToGroup:a,selectGroup:c}=Ee(),[l,d]=w.useState(!1),[f,p]=w.useState(!1),[m,y]=w.useState(!1),[b,S]=w.useState(new Set),M=A=>{t(r.id,{name:A}),Ye.success("Group renamed"),p(!1)},E=()=>{d(!0)},C=()=>{n(r.id),c(null),Ye.success("Group deleted"),d(!1)},T=A=>{s(r.id,A),Ye.success("Component removed from group")},k=e.filter(A=>r.nodeIds.includes(A.id));return g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{children:[g.jsx(st,{htmlFor:"group-name",className:"text-xs font-medium",children:"Group Name"}),g.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[g.jsx(Tt,{id:"group-name",value:r.name,onChange:A=>t(r.id,{name:A.target.value}),className:"flex-1 h-8 text-xs"}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:E,children:g.jsx(Zl,{className:"h-3.5 w-3.5 text-destructive"})})]})]}),g.jsx(nC,{open:l,groupName:r.name,onConfirm:C,onCancel:()=>d(!1)}),g.jsx(mp,{open:f,initialName:r.name,onConfirm:M,onCancel:()=>p(!1)}),g.jsx(xn,{}),g.jsxs("div",{className:"flex items-center space-x-2",children:[g.jsx(Oh,{id:"show-name",checked:r.showName!==!1,onCheckedChange:A=>t(r.id,{showName:A!==!1})}),g.jsx(st,{htmlFor:"show-name",className:"text-xs font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show name on canvas"})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(st,{className:"text-xs font-medium mb-1.5 block",children:"Color"}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("input",{type:"color",value:r.color||"#3b82f6",onChange:A=>t(r.id,{color:A.target.value}),className:"w-10 h-8 rounded border border-border cursor-pointer"}),g.jsx(Tt,{value:r.color||"#3b82f6",onChange:A=>t(r.id,{color:A.target.value}),className:"flex-1 font-mono text-xs h-8",placeholder:"#3b82f6"})]})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs(st,{className:"text-xs font-medium",children:["Components (",r.nodeIds.length,")"]}),g.jsxs(ke,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{if(Ee.getState().nodes.filter(N=>!r.nodeIds.includes(N.id)).length===0){Ye.info("All components are already in this group");return}S(new Set),y(!0)},children:[g.jsx(Hl,{className:"h-3 w-3 mr-1"}),"Add"]})]}),g.jsxs("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[k.map(A=>g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-secondary/50 rounded border border-border",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-xs font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:A.type})]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>T(A.id),title:"Remove from group",children:g.jsx(os,{className:"h-3 w-3"})})]},A.id)),k.length===0&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-3",children:"No components in group"})]})]}),g.jsx(xn,{}),g.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[g.jsx("span",{children:"Group ID:"}),g.jsx("code",{className:"font-mono bg-secondary/50 px-1.5 py-0.5 rounded text-[10px]",children:r.id})]}),g.jsx(gp,{open:m,onOpenChange:y,children:g.jsxs(ru,{className:"max-w-md",children:[g.jsxs(cu,{children:[g.jsx(uu,{children:"Add Components to Group"}),g.jsxs(du,{children:['Select components to add to "',r.name,'"']})]}),g.jsx(an,{className:"max-h-96",children:g.jsxs("div",{className:"space-y-2 py-2",children:[e.filter(A=>!r.nodeIds.includes(A.id)).map(A=>g.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border border-border hover:bg-secondary/50 cursor-pointer",onClick:()=>{const _=new Set(b);_.has(A.id)?_.delete(A.id):_.add(A.id),S(_)},children:[g.jsx(Oh,{checked:b.has(A.id),onCheckedChange:_=>{const N=new Set(b);_?N.add(A.id):N.delete(A.id),S(N)}}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-xs text-muted-foreground truncate",children:A.type})]})]},A.id)),e.filter(A=>!r.nodeIds.includes(A.id)).length===0&&g.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"All components are already in this group"})]})}),g.jsxs(lu,{children:[g.jsx(ke,{variant:"outline",onClick:()=>{y(!1),S(new Set)},children:"Cancel"}),g.jsxs(ke,{onClick:()=>{if(b.size===0){Ye.error("Select at least one component");return}b.forEach(A=>{a(r.id,A)}),Ye.success(`${b.size} component(s) added to group`),y(!1),S(new Set)},children:["Add Selected (",b.size,")"]})]})]})})]})}function B5(){const{selectedNodeId:r,nodes:e,updateNode:t,selectNode:n,connections:s,updateConnection:a,selectedConnectionId:c,selectConnection:l,selectedGroupId:d,groups:f,selectGroup:p}=Ee(),{addTab:m}=Eu(),y=e.find(M=>M.id===r),b=s.find(M=>M.id===c),S=f.find(M=>M.id===d);return S?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(ih,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Group Properties"})]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>p(null),children:g.jsx(os,{className:"h-3 w-3"})})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx($5,{group:S})})})]}):!y&&!b?g.jsx("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:g.jsxs(vp,{defaultValue:"stats",className:"h-full flex flex-col",children:[g.jsx("div",{className:"p-1 border-b border-border",children:g.jsxs(gu,{className:"grid w-full grid-cols-6 h-6 gap-0.5 p-0.5",children:[g.jsx(ss,{value:"stats",className:"text-xs px-1 py-0.5",children:"Stats"}),g.jsx(ss,{value:"diagnostics",className:"text-xs px-1 py-0.5",children:"Diag"}),g.jsx(ss,{value:"alerts",className:"text-xs px-1 py-0.5",children:"Alerts"}),g.jsx(ss,{value:"errors",className:"text-xs px-1 py-0.5",children:"Errors"}),g.jsx(ss,{value:"filters",className:"text-xs px-1 py-0.5",children:"Filter"}),g.jsx(ss,{value:"properties",className:"text-xs px-1 py-0.5",children:"Groups"})]})}),g.jsx(ni,{value:"stats",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(FL,{})})})}),g.jsx(ni,{value:"diagnostics",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx($L,{})}),g.jsx(ni,{value:"alerts",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(BL,{})}),g.jsx(ni,{value:"errors",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(I5,{})}),g.jsx(ni,{value:"filters",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(UL,{})})})}),g.jsx(ni,{value:"properties",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:g.jsxs("div",{children:[g.jsxs(ti,{as:"h4",className:"mb-1",children:["Groups (",f.length,")"]}),f.length>0?g.jsx("div",{className:"space-y-1",children:f.map(M=>g.jsx("div",{className:"p-1.5 bg-secondary/50 rounded border border-border cursor-pointer hover:bg-secondary transition-colors",onClick:()=>p(M.id),children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx(We,{size:"small",className:"font-medium truncate",children:M.name}),g.jsxs(We,{size:"micro",muted:!0,children:[M.nodeIds.length," component",M.nodeIds.length!==1?"s":""]})]}),g.jsx("div",{className:"w-2.5 h-2.5 rounded border-2 border-border flex-shrink-0 ml-1",style:{backgroundColor:M.color||"hsl(var(--primary))"}})]})},M.id))}):g.jsx(We,{size:"micro",muted:!0,className:"text-center py-2",children:"No groups created yet"})]})})})})]})}):b?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(ih,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Connection"})]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>l(null),children:g.jsx(os,{className:"h-3 w-3"})})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(vL,{connection:b,onUpdate:(M,E)=>a(M,E)})})})]}):g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(ih,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Properties"})]}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>n(null),children:g.jsx(os,{className:"h-3 w-3"})})]}),g.jsx(an,{className:"flex-1",children:g.jsxs("div",{className:"p-1.5 space-y-1.5",children:[g.jsx(qL,{componentId:y.id,componentLabel:y.data.label}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(st,{htmlFor:"label",className:"text-xs font-medium",children:"Label"}),g.jsx(Tt,{id:"label",value:y.data.label,onChange:M=>t(y.id,{data:{...y.data,label:M.target.value}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Position"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{children:[g.jsx(st,{htmlFor:"pos-x",className:"text-xs text-muted-foreground",children:"X"}),g.jsx(Tt,{id:"pos-x",type:"number",value:Math.round(y.position.x),onChange:M=>t(y.id,{position:{...y.position,x:parseInt(M.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsxs("div",{children:[g.jsx(st,{htmlFor:"pos-y",className:"text-xs text-muted-foreground",children:"Y"}),g.jsx(Tt,{id:"pos-y",type:"number",value:Math.round(y.position.y),onChange:M=>t(y.id,{position:{...y.position,y:parseInt(M.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]})]})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Component Type"}),g.jsx("div",{className:"bg-secondary/50 rounded-md p-1.5 border border-border",children:g.jsx(We,{mono:!0,size:"small",children:y.type})})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Configuration"}),g.jsx(ke,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:()=>{m({title:`${y.data.label} Config`,type:"component",componentId:y.id,componentType:y.type})},children:"Open Configuration Panel"})]})]})})]})}function F5(){const{tabs:r,setActiveTab:e,closeTab:t,addTab:n}=Eu(),s=()=>{n({title:"Untitled Diagram",type:"diagram"})};return g.jsx("div",{className:"h-10 bg-secondary/30 border-b border-border flex items-center",children:g.jsxs(an,{className:"flex-1",children:[g.jsxs("div",{className:"flex items-center",children:[r.map(a=>g.jsxs("div",{className:`
                flex items-center gap-2 px-4 h-10 border-r border-border cursor-pointer group
                transition-colors
                ${a.active?"bg-canvas-bg text-foreground":"text-muted-foreground hover:bg-secondary/50"}
              `,onClick:()=>e(a.id),children:[g.jsx("span",{className:"text-sm",children:a.title}),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:bg-destructive/10",onClick:c=>{c.stopPropagation(),t(a.id)},children:g.jsx(os,{className:"h-3 w-3"})})]},a.id)),g.jsx(ke,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:s,children:g.jsx(Hl,{className:"h-4 w-4"})})]}),g.jsx(nu,{orientation:"horizontal"})]})})}const Hv=r=>Symbol.iterator in r,qv=r=>"entries"in r,Uv=(r,e)=>{const t=r instanceof Map?r:new Map(r.entries()),n=e instanceof Map?e:new Map(e.entries());if(t.size!==n.size)return!1;for(const[s,a]of t)if(!n.has(s)||!Object.is(a,n.get(s)))return!1;return!0},Q5=(r,e)=>{const t=r[Symbol.iterator](),n=e[Symbol.iterator]();let s=t.next(),a=n.next();for(;!s.done&&!a.done;){if(!Object.is(s.value,a.value))return!1;s=t.next(),a=n.next()}return!!s.done&&!!a.done};function V5(r,e){return Object.is(r,e)?!0:typeof r!="object"||r===null||typeof e!="object"||e===null||Object.getPrototypeOf(r)!==Object.getPrototypeOf(e)?!1:Hv(r)&&Hv(e)?qv(r)&&qv(e)?Uv(r,e):Q5(r,e):Uv({entries:()=>Object.entries(r)},{entries:()=>Object.entries(e)})}function sC(r){const e=kt.useRef(void 0);return t=>{const n=r(t);return V5(e.current,n)?e.current:e.current=n}}const $v=globalThis;function Sl(r){try{if(typeof $v.structuredClone=="function")return $v.structuredClone(r)}catch{}return JSON.parse(JSON.stringify(r))}function Mo(r,e,t=140,n=100,s=16){const a=[],c=t/2,l=n/2,d=r+c,f=e+l;for(let p=0;p<s;p++){const m=p/s*2*Math.PI-Math.PI/2;let y,b;const S=(m%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(S>=0&&S<Math.PI/2){const M=S/(Math.PI/2);y=d+c,b=f-l+M*n}else if(S>=Math.PI/2&&S<Math.PI){const M=(S-Math.PI/2)/(Math.PI/2);y=d+c-M*t,b=f+l}else if(S>=Math.PI&&S<3*Math.PI/2){const M=(S-Math.PI)/(Math.PI/2);y=d-c,b=f+l-M*n}else{const M=(S-3*Math.PI/2)/(Math.PI/2);y=d-c+M*t,b=f-l}a.push({x:y,y:b,index:p})}return a}function G5(r,e,t){let n=1/0,s=0;for(let a=0;a<r.length;a++){const c=r[a],l=Math.sqrt(Math.pow(e-c.x,2)+Math.pow(t-c.y,2));l<n&&(n=l,s=a)}return s}function Bv(r,e,t,n,s,a,c,l=140,d=100){const f=Mo(a,c,l,d),p=G5(f,t,n);if(s.filter(y=>y.source===r&&y.target===e&&y.sourcePort===p||y.target===r&&y.source===e&&y.targetPort===p).length===0)return p;for(let y=1;y<f.length;y++){const b=(p+y)%f.length,S=(p-y+f.length)%f.length;if(s.filter(C=>C.source===r&&C.target===e&&C.sourcePort===b||C.target===r&&C.source===e&&C.targetPort===b).length===0)return b;if(s.filter(C=>C.source===r&&C.target===e&&C.sourcePort===S||C.target===r&&C.source===e&&C.targetPort===S).length===0)return S}return p}const iC=w.createContext(null);function K5({children:r}){const e=w.useRef(new Map),t=w.useCallback((c,l)=>{l?e.current.set(c,l):e.current.delete(c)},[]),n=w.useCallback(c=>e.current.get(c)||null,[]),s=w.useCallback(c=>{e.current.delete(c)},[]),a={registerNodeRef:t,getNodeRef:n,unregisterNodeRef:s};return g.jsx(iC.Provider,{value:a,children:r})}function Pu(){const r=w.useContext(iC);if(!r)throw new Error("useNodeRefs must be used within NodeRefsProvider");return r}function Y5({node:r,onConnectionStart:e,onConnectionEnd:t,isConnecting:n=!1,onContextMenu:s}){const{registerNodeRef:a,unregisterNodeRef:c}=Pu(),l=w.useRef(null);w.useEffect(()=>(l.current&&a(r.id,l.current),()=>{c(r.id)}),[r.id,a,c]);const d=Ee(de=>de.selectNode),f=Ee(de=>de.updateNode),p=Ee(de=>de.updateNodes),m=Ee(de=>de.deleteNode);Ee(de=>de.addNode);const y=Ee(de=>de.startDragOperation),b=Ee(de=>de.endDragOperation);Ee(de=>de.bringToFront),Ee(de=>de.sendToBack),Ee(de=>de.bringForward),Ee(de=>de.sendBackward);const{connections:S,zoom:M,pan:E,nodes:C}=Ee(sC(de=>({connections:de.connections,zoom:de.zoom,pan:de.pan,nodes:de.nodes}))),{addTab:T}=Eu(),[k,A]=w.useState(!1),[_,N]=w.useState(!1),L=w.useRef({x:0,y:0}),q=w.useRef({x:0,y:0}),Z=w.useRef({x:0,y:0}),se=w.useRef({x:0,y:0}),ce=w.useRef(null),J=w.useRef(null),te=w.useRef(!1),le=w.useRef(!1),ue=w.useRef({}),z=w.useMemo(()=>Pr.find(de=>de.type===r.type),[r.type]),{isRunning:j,getComponentMetrics:O}=Nt(),W=ma(de=>de.getComponentStatus(r.id)),he=KM(de=>de.getComponentState(r.id)),P=j?O(r.id):void 0,Y=$r(de=>de.highlightedNodeId)===r.id,ie=w.useMemo(()=>S.some(de=>de.source===r.id||de.target===r.id),[S,r.id]),B=P&&(P.throughput&&P.throughput>.1||P.errorRate&&P.errorRate>.001||P.utilization&&P.utilization>.01),ae=()=>{if(!j||!P||!ie||!B)return"";const de=P.utilization||0,Ue=P.errorRate||0,Be=Math.min(1,de*.7+Ue*.3);return Be>.8?"border-red-500":Be>.6?"border-orange-500":Be>.4?"border-yellow-500":Be>.2?"border-green-500":""},$=()=>{if(!j)return null;if(he)switch(he.state){case"disabled":case"failed":return g.jsx(kl,{className:"text-red-500",size:16});case"degraded":return g.jsx(as,{className:"text-yellow-500",size:16})}if(!ie||!B||!W)return null;const de=W.health,Ue=16;switch(de){case"healthy":return g.jsx(Xh,{className:"text-green-500",size:Ue});case"degraded":return g.jsx(as,{className:"text-yellow-500",size:Ue});case"critical":return g.jsx(va,{className:"text-orange-500",size:Ue});case"down":return g.jsx(pa,{className:"text-red-500",size:Ue});default:return null}},G=()=>{if(!j)return r.selected?"border-primary":"border-border";if(he)switch(he.state){case"disabled":case"failed":return"border-red-500 border-2";case"degraded":return"border-yellow-500 border-2"}if(!W)return r.selected?"border-primary":"border-border";if(W.criticalPath)return"border-purple-500 border-2";switch(W.health){case"down":return"border-red-500 border-2";case"critical":return"border-orange-500";case"degraded":return"border-yellow-500";default:return r.selected?"border-primary":"border-border"}},pe=w.useRef(M),me=w.useRef(E);w.useEffect(()=>{pe.current=M,me.current=E},[M,E]),w.useEffect(()=>{const de=Be=>{if(!te.current)return;if(Ee.getState().getIsGroupDragging()){te.current=!1,le.current=!1,A(!1);return}const mt=Be.clientX-q.current.x,Ut=Be.clientY-q.current.y,Ze=Math.sqrt(mt*mt+Ut*Ut);if(!le.current&&Ze>3){le.current=!0,A(!0),y(r.id);const xt=Ee.getState().nodes.filter(yt=>yt.selected);ue.current={},xt.forEach(yt=>{ue.current[yt.id]={x:yt.position.x,y:yt.position.y}})}if(le.current&&ce.current){const Pt=pe.current,xt=me.current,yt=ce.current.getBoundingClientRect(),Xt=(Be.clientX-yt.left-xt.x)/Pt,Gt=(Be.clientY-yt.top-xt.y)/Pt,_s=Xt-Z.current.x,Xn=Gt-Z.current.y,fs=Ee.getState().nodes.filter(Kt=>Kt.selected),Jt=Object.keys(ue.current).length>0;if(fs.length>1&&Jt){const Kt=[];fs.forEach(zt=>{const Fi=ue.current[zt.id];Fi&&Kt.push({id:zt.id,updates:{position:{x:Fi.x+_s,y:Fi.y+Xn}}})}),Kt.length>0&&p(Kt,!0)}else{const Kt=se.current.x+_s,zt=se.current.y+Xn;f(r.id,{position:{x:Kt,y:zt}},!0)}}},Ue=()=>{te.current&&(te.current=!1,le.current&&(le.current=!1,A(!1),b()))};return document.addEventListener("mousemove",de),document.addEventListener("mouseup",Ue),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",Ue)}},[r.id,f,p,y,b]);const ye=de=>{if(de.button!==0)return;const Be=Ee.getState().nodes.filter(Nn=>Nn.selected),bt=r.selected,mt=Be.some(Nn=>Nn.id!==r.id);if(!(bt&&mt&&!de.ctrlKey&&!de.metaKey)){const Nn=de.ctrlKey||de.metaKey;d(r.id,Nn)}const Ut=document.querySelector(".flex-1.overflow-hidden.relative");if(!Ut){L.current={x:0,y:0},Z.current={x:0,y:0},se.current={x:0,y:0},ce.current=null,J.current=null;return}ce.current=Ut;const Ze=pe.current,Pt=me.current,xt=Ut.getBoundingClientRect();J.current=xt;const yt=(de.clientX-xt.left-Pt.x)/Ze,Xt=(de.clientY-xt.top-Pt.y)/Ze;Z.current={x:yt,y:Xt};const Xn=Ee.getState().nodes.find(Nn=>Nn.id===r.id)?.position||r.position;se.current={x:Xn.x,y:Xn.y},L.current={x:yt-Xn.x,y:Xt-Xn.y},q.current={x:de.clientX,y:de.clientY},te.current=!0,le.current=!1,de.stopPropagation()},ve=de=>{de.stopPropagation(),de.preventDefault(),k&&(A(!1),b()),T({title:`${r.data.label} Config`,type:"component",componentId:r.id,componentType:r.type})},Pe=de=>{de.key==="Delete"&&r.selected&&m(r.id)},$e=de=>{if(de.preventDefault(),de.stopPropagation(),!r.selected){const Ue=C.some(Be=>Be.id!==r.id&&Be.selected);d(r.id,Ue)}s?.(de.clientX,de.clientY)},it=(de,Ue)=>{de.stopPropagation(),e?.(Ue)},Je=w.useCallback(()=>{if(!l.current)return{width:140,height:100};const Be=(l.current.querySelector(".bg-card")||l.current).getBoundingClientRect();return{width:Be.width/M,height:Be.height/M}},[M]),jt=de=>{if(n){de.stopPropagation();const Ue=Je(),Be=Mo(r.position.x,r.position.y,Ue.width,Ue.height,16),bt=document.querySelector(".flex-1.overflow-hidden.relative");if(bt){const mt=bt.getBoundingClientRect(),Ut=(de.clientX-mt.left-E.x)/M,Ze=(de.clientY-mt.top-E.y)/M;let Pt=1/0,xt=0;for(let yt=0;yt<Be.length;yt++){const Xt=Be[yt],Gt=Math.sqrt(Math.pow(Ut-Xt.x,2)+Math.pow(Ze-Xt.y,2));Gt<Pt&&(Pt=Gt,xt=yt)}t?.(xt)}else t?.()}};return g.jsx(g.Fragment,{children:g.jsx("div",{ref:l,"data-node-id":r.id,className:`
          absolute cursor-move select-none
          transition-shadow
          ${r.selected?"glow-primary":""}
          ${k?"pointer-events-none":""}
        `,style:{left:`${r.position.x}px`,top:`${r.position.y}px`},onMouseDown:ye,onMouseUp:jt,onDoubleClick:ve,onContextMenu:$e,onKeyDown:Pe,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),tabIndex:0,children:g.jsxs("div",{className:Re("bg-card border-2 rounded-lg p-4 min-w-[140px] relative",G(),ae(),"hover:border-primary/50 transition-colors",W?.criticalPath&&"shadow-lg shadow-purple-500/20",Y&&"ring-4 ring-yellow-400 ring-offset-2 animate-pulse"),children:[j&&W&&g.jsx("div",{className:"absolute -top-2 -right-2 bg-card rounded-full p-0.5 border border-border",children:$()}),j&&W?.criticalPath&&g.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 bg-purple-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-semibold",children:"CRITICAL"}),g.jsxs("div",{className:"flex flex-col items-center gap-2 select-none",children:[g.jsx("div",{className:"text-3xl select-none pointer-events-none",children:z?.icon}),g.jsx("div",{className:"text-sm font-medium text-center text-foreground select-none pointer-events-none",children:r.data.label})]}),(_||n)&&(()=>{const de=l.current?(()=>{const mt=(l.current.querySelector(".bg-card")||l.current).getBoundingClientRect();return{width:mt.width/M,height:mt.height/M}})():{width:140,height:100},Ue=Mo(r.position.x,r.position.y,de.width,de.height,16);return g.jsx(g.Fragment,{children:Ue.map((Be,bt)=>{const mt=Be.x-r.position.x,Ut=Be.y-r.position.y;return g.jsx("div",{className:"absolute w-3 h-3 rounded-full bg-primary/80 border-2 border-card cursor-crosshair hover:scale-150 hover:bg-primary transition-all z-10",style:{left:`${mt-6}px`,top:`${Ut-6}px`},onMouseDown:Ze=>{Ze.stopPropagation(),it(Ze,bt)},onMouseUp:Ze=>{Ze.stopPropagation(),n&&t?.(bt)},title:"Connection point"},bt)})})})()]})})})}const W5=w.memo(Y5,(r,e)=>!(r.node.id!==e.node.id||r.node.position.x!==e.node.position.x||r.node.position.y!==e.node.position.y||r.node.selected!==e.node.selected||r.node.type!==e.node.type||r.node.data.label!==e.node.data.label||r.isConnecting!==e.isConnecting||r.onConnectionStart!==e.onConnectionStart||r.onConnectionEnd!==e.onConnectionEnd||r.onContextMenu!==e.onContextMenu));function X5({selectedNodeId:r,highlightPath:e=!0}){const{nodes:t,connections:n}=Ee(),{isRunning:s}=Nt(),{getConnectionMessages:a}=zi(),[c,l]=w.useState(new Set),[d,f]=w.useState(new Map);return w.useEffect(()=>{if(!r||!e||!s){l(new Set),f(new Map);return}const p=new Set,m=new Map,y=[{nodeId:r,path:[r]}];for(;y.length>0;){const{nodeId:b,path:S}=y.shift();if(p.has(b))continue;p.add(b);const M=n.filter(E=>E.source===b);for(const E of M){const C=E.target,T=[...S,C];m.set(E.id,T),p.has(C)||y.push({nodeId:C,path:T})}}f(m),l(new Set(m.keys()))},[r,n,e,s]),w.useEffect(()=>{if(!r||!e||!s)return;const p=new Set,m=[{nodeId:r,path:[r]}];for(;m.length>0;){const{nodeId:y,path:b}=m.shift();if(p.has(y))continue;p.add(y);const S=n.filter(M=>M.target===y);for(const M of S){const E=M.source,C=[E,...b],T=d.get(M.id)||[];(T.length===0||C.length<T.length)&&(d.set(M.id,C),f(new Map(d))),p.has(E)||m.push({nodeId:E,path:C})}}l(new Set(d.keys()))},[r,n,e,s]),null}function J5(r){const{selectedNodeId:e}=Ee(),{isRunning:t}=Nt(),[n,s]=w.useState(!1);return w.useEffect(()=>{if(!e||!t){s(!1);return}const{nodes:a,connections:c}=Ee.getState();if(!a.find(f=>f.id===e)){s(!1);return}const d=c.find(f=>f.id===r);d&&(d.source===e||d.target===e)?s(!0):s(!1)},[e,r,t]),n}const aC=w.createContext(null);function Z5({children:r}){const e=w.useRef(null),t=w.useRef(new WeakMap);w.useEffect(()=>(e.current=new ResizeObserver(a=>{a.forEach(c=>{const l=t.current.get(c.target);l&&l()})}),()=>{e.current&&(e.current.disconnect(),e.current=null)}),[]);const s={observe:w.useCallback((a,c)=>e.current?(t.current.set(a,c),e.current.observe(a),()=>{e.current&&(e.current.unobserve(a),t.current.delete(a))}):()=>{},[])};return g.jsx(aC.Provider,{value:s,children:r})}function oC(){const r=w.useContext(aC);if(!r)throw new Error("useResizeObserver must be used within ResizeObserverProvider");return r}function eI({connection:r,sourceNode:e,targetNode:t,zoom:n,pan:s,isSelected:a=!1,onClick:c,onContextMenu:l}){const[d,f]=w.useState(!1),{isRunning:p,connectionMetrics:m}=Nt(sC(G=>({isRunning:G.isRunning,connectionMetrics:G.connectionMetrics}))),y=p?m.get(r.id):void 0,{getConnectionMessages:b}=zi(),S=Ee(G=>G.selectedNodeId),M=Ee(G=>G.connections),E=p?b(r.id):[],C=w.useMemo(()=>E.filter(G=>G.status==="in-transit"||G.status==="pending"),[E]),T=J5(r.id);w.useMemo(()=>M.some(G=>G.source===r.target&&G.target===r.source),[M,r.target,r.source]);const{getNodeRef:k}=Pu(),{observe:A}=oC(),[_,N]=w.useState(()=>{const G=pe=>{const me=k(pe);if(!me)return{width:140,height:100};const Pe=(me.querySelector(".bg-card")||me).getBoundingClientRect();return{width:Pe.width/n,height:Pe.height/n}};return{source:G(e.id),target:G(t.id)}});w.useEffect(()=>{const G=()=>{const Je=jt=>{const de=k(jt);if(!de)return{width:140,height:100};const bt=(de.querySelector(".bg-card")||de).getBoundingClientRect();return{width:bt.width/n,height:bt.height/n}};N({source:Je(e.id),target:Je(t.id)})};G();const pe=k(e.id),me=k(t.id),ye=pe?.querySelector(".bg-card"),ve=me?.querySelector(".bg-card"),Pe=ye||pe,$e=ve||me,it=[];if(Pe){const Je=A(Pe,G);it.push(Je)}if($e){const Je=A($e,G);it.push(Je)}return()=>{it.forEach(Je=>Je())}},[e.id,t.id,n,k,A]);const L=_.source.width,q=_.source.height,Z=_.target.width,se=_.target.height,ce=L/2,J=q/2,te=Z/2,le=se/2;let ue,z,j,O;if(r.sourcePort!==void 0&&r.targetPort!==void 0){const G=Mo(e.position.x,e.position.y,L,q,16),pe=Mo(t.position.x,t.position.y,Z,se,16),me=G[r.sourcePort],ye=pe[r.targetPort];ue=me.x,z=me.y,j=ye.x,O=ye.y}else{const G=e.position.x+ce,pe=e.position.y+J,me=t.position.x+te,ye=t.position.y+le,ve=Math.atan2(ye-pe,me-G),Pe=(Je,jt,de,Ue)=>{const Be=Math.abs(de),bt=Ue?ce:te,mt=Ue?J:le,Ut=Math.atan2(mt,bt);let Ze,Pt;if(Be<Ut||Be>Math.PI-Ut){const xt=Ue?1:-1;Ze=Je+xt*bt*Math.sign(Math.cos(de)),Pt=jt+xt*bt*Math.tan(de)*Math.sign(Math.cos(de))}else{const xt=Ue?1:-1;Ze=Je+xt*mt/Math.tan(de)*Math.sign(Math.sin(de)),Pt=jt+xt*mt*Math.sign(Math.sin(de))}return{x:Ze,y:Pt}},$e=Pe(G,pe,ve,!0),it=Pe(me,ye,ve,!1);ue=$e.x,z=$e.y,j=it.x,O=it.y}const W=j-ue,he=O-z,P=Math.min(Math.abs(W),Math.abs(he))*.3+30,F=`
    M ${ue},${z}
    C ${ue+P*Math.sign(W)},${z}
      ${j-P*Math.sign(W)},${O}
      ${j},${O}
  `;let Y="hsl(var(--border))",ie=2;T&&S?(Y="hsl(280 100% 70%)",ie=3):a?(Y="hsl(var(--primary))",ie=2.5):d?(Y="hsl(var(--accent))",ie=2.5):y&&p&&(y.effectiveThroughput>0||y.traffic>0)&&(y.bottleneck?(Y="hsl(0 84% 60%)",ie=3):y.backpressure>.7?(Y="hsl(25 95% 53%)",ie=2.5):y.congestion>.6?(Y="hsl(45 93% 47%)",ie=2.5):y.throughputDependency>.5?(Y="hsl(142 76% 36%)",ie=2):y.effectiveThroughput>0&&(Y="hsl(var(--primary))",ie=2));const B=G=>{G.stopPropagation(),c?.()},ae=G=>{G.preventDefault(),G.stopPropagation(),l?.(G)},$=p&&y&&y.effectiveThroughput>0?y.effectiveThroughput%40/2:0;return g.jsxs("g",{children:[g.jsx("path",{d:F,fill:"none",stroke:"transparent",strokeWidth:20/n,style:{cursor:"pointer"},onClick:B,onContextMenu:ae,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1)}),p&&y&&y.effectiveThroughput>0&&y.traffic>0&&g.jsx("path",{d:F,fill:"none",stroke:Y,strokeWidth:Math.max(1,ie/n),strokeLinecap:"round",strokeDasharray:`${Math.max(4,8/n)} ${Math.max(2,4/n)}`,strokeDashoffset:-$,style:{opacity:.4,pointerEvents:"none",animation:"flow 2s linear infinite"}}),p&&C.map((G,pe)=>{const me=Date.now()-G.timestamp,ve=G.latency?Math.min(1,me/G.latency):0,Pe=ue+(j-ue)*ve,$e=z+(O-z)*ve,Je={json:"hsl(142 76% 36%)",xml:"hsl(25 95% 53%)",binary:"hsl(221 83% 53%)",protobuf:"hsl(280 100% 70%)",text:"hsl(210 40% 50%)"}[G.format]||"hsl(var(--primary))";return g.jsxs("g",{children:[g.jsx("circle",{cx:Pe,cy:$e,r:4/n,fill:Je,stroke:"hsl(var(--background))",strokeWidth:1/n,style:{pointerEvents:"none",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.3))"},children:g.jsx("animate",{attributeName:"opacity",values:"0.5;1;0.5",dur:"1s",repeatCount:"indefinite"})}),G.size>1e3&&g.jsx("text",{x:Pe,y:$e-8/n,fill:Je,fontSize:8/n,textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:G.format})]},G.id||pe)}),g.jsx("path",{d:F,fill:"none",stroke:Y,strokeWidth:Math.max(1,ie/n),strokeLinecap:"round",markerEnd:p&&y&&(y.effectiveThroughput>0||y.traffic>0)?`url(#arrowhead-${a?"selected":y?.bottleneck?"bottleneck":"default"})`:a?"url(#arrowhead-selected)":"url(#arrowhead-default)",style:{transition:"stroke 0.3s, stroke-width 0.3s",pointerEvents:"none"}}),p&&y&&(y.effectiveThroughput>0||y.traffic>0)?g.jsxs("g",{children:[g.jsx("text",{x:(ue+j)/2,y:(z+O)/2-10/n,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/n),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:r.label||`${y.latency.toFixed(1)}ms`}),g.jsx("text",{x:(ue+j)/2,y:(z+O)/2+8/n,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(7,9/n),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:y.traffic>0?`${y.traffic.toFixed(1)} KB/s`:`${y.effectiveThroughput.toFixed(0)} msg/s`}),r.data?.bandwidthMbps&&y.traffic>0&&g.jsxs("text",{x:(ue+j)/2,y:(z+O)/2+20/n,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(6,8/n),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none",opacity:.7},children:["Limit: ",r.data.bandwidthMbps,"Mbps"]})]}):r.label?g.jsx("g",{children:g.jsx("text",{x:(ue+j)/2,y:(z+O)/2-10/n,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/n),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:r.label})}):null]})}const tI=w.memo(eI,(r,e)=>!(r.connection.id!==e.connection.id||r.connection.sourcePort!==e.connection.sourcePort||r.connection.targetPort!==e.connection.targetPort||r.connection.label!==e.connection.label||r.sourceNode.id!==e.sourceNode.id||r.sourceNode.position.x!==e.sourceNode.position.x||r.sourceNode.position.y!==e.sourceNode.position.y||r.targetNode.id!==e.targetNode.id||r.targetNode.position.x!==e.targetNode.position.x||r.targetNode.position.y!==e.targetNode.position.y||r.zoom!==e.zoom||r.pan.x!==e.pan.x||r.pan.y!==e.pan.y||r.isSelected!==e.isSelected||r.onClick!==e.onClick||r.onContextMenu!==e.onContextMenu)),nI=140,sI=140,iI=16;function aI({nodeId:r,position:e}){const t=Nt(p=>p.componentMetrics.get(r)),{connections:n}=Ee(),{isRunning:s}=Nt(),a=n.some(p=>p.source===r||p.target===r),c=t&&(t.throughput&&t.throughput>.1||t.errorRate&&t.errorRate>.001||t.utilization&&t.utilization>.01),l=w.useMemo(()=>{if(!t)return[];const p=[{label:"Throughput",value:`${Math.round(t.throughput)}`,unit:"ops/s",color:"text-blue-400"},{label:"Latency (avg)",value:`${Math.round(t.latency)}`,unit:"ms",color:"text-yellow-400"}];return t.latencyP50!==void 0&&p.push({label:"Latency (p50)",value:`${Math.round(t.latencyP50)}`,unit:"ms",color:"text-green-400"}),t.latencyP99!==void 0&&p.push({label:"Latency (p99)",value:`${Math.round(t.latencyP99)}`,unit:"ms",color:"text-red-400"}),p.push({label:"Error Rate",value:`${(t.errorRate*100).toFixed(2)}`,unit:"%",color:"text-orange-400"},{label:"Utilization",value:`${Math.round(t.utilization*100)}`,unit:"%",color:"text-purple-400"}),p},[t]);if(!s||!t||!a||!c||l.length===0)return null;const d=e.x+nI/2,f=e.y+sI+iI;return g.jsx("div",{className:"absolute pointer-events-none",style:{left:`${d}px`,top:`${f}px`,transform:"translateX(-50%)",zIndex:10},children:g.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-2 shadow-lg min-w-max",children:g.jsx("div",{className:"text-xs space-y-1",children:l.map(p=>g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("span",{className:"text-slate-400",children:[p.label,":"]}),g.jsxs("span",{className:`font-mono font-semibold ${p.color}`,children:[p.value," ",p.unit]})]},p.label))})})})}function oI({isVisible:r=!0}){return r?g.jsx("div",{className:"absolute bottom-4 right-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-muted-foreground",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-green-500/20 border border-green-500/30"}),g.jsx("span",{children:"<20%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500/20 border border-yellow-500/30"}),g.jsx("span",{children:"20-40%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-orange-500/20 border border-orange-500/30"}),g.jsx("span",{children:"40-60%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-red-500/20 border border-red-500/30"}),g.jsx("span",{children:">60%"})]})]})}):null}function rI({isVisible:r=!0}){const{nodes:e,connections:t,zoom:n,pan:s}=Ee(),{isRunning:a}=Nt(),c=kt.useMemo(()=>{if(e.length===0)return{minX:0,minY:0,maxX:2e3,maxY:2e3};const T=e.map(q=>q.position.x),k=e.map(q=>q.position.y),A=Math.min(...T)-200,_=Math.min(...k)-200,N=Math.max(...T)+200,L=Math.max(...k)+200;return{minX:A,minY:_,maxX:N,maxY:L}},[e]),l=c.maxX-c.minX,d=c.maxY-c.minY,f=120,p=80,m=f/Math.max(l,1e3),y=p/Math.max(d,1e3),b=Math.min(m,y),S=window.innerWidth/n*b,M=window.innerHeight/n*b,E=(-s.x/n-c.minX)*b,C=(-s.y/n-c.minY)*b;return r?g.jsx("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("svg",{width:f,height:p,className:"border border-border/50 rounded",style:{background:"hsl(var(--background))"},children:[t.map(T=>{const k=e.find(Z=>Z.id===T.source),A=e.find(Z=>Z.id===T.target);if(!k||!A)return null;const _=(k.position.x-c.minX)*b,N=(k.position.y-c.minY)*b,L=(A.position.x-c.minX)*b,q=(A.position.y-c.minY)*b;return g.jsx("line",{x1:_,y1:N,x2:L,y2:q,stroke:"hsl(var(--border))",strokeWidth:.3,opacity:.2},T.id)}),e.map(T=>g.jsx("circle",{cx:(T.position.x-c.minX)*b,cy:(T.position.y-c.minY)*b,r:1.5,fill:"hsl(var(--muted-foreground))",opacity:.5},T.id)),g.jsx("rect",{x:E,y:C,width:S,height:M,fill:"hsl(var(--primary))",fillOpacity:.2,stroke:"hsl(var(--primary))",strokeWidth:1.5,strokeDasharray:"2 2"})]})}):null}function cI({x:r,y:e,onDelete:t,onRename:n,onCopyId:s,onClose:a}){const c=w.useRef(null),[l,d]=w.useState({x:r,y:e});return w.useEffect(()=>{if(c.current){const f=c.current.getBoundingClientRect(),p=window.innerWidth,m=window.innerHeight;let y=r,b=e;r+f.width>p&&(y=p-f.width-10),e+f.height>m&&(b=m-f.height-10),y=Math.max(10,y),b=Math.max(10,b),d({x:y,y:b})}},[r,e]),w.useEffect(()=>{const f=m=>{c.current&&!c.current.contains(m.target)&&a()},p=m=>{m.key==="Escape"&&a()};return document.addEventListener("mousedown",f),document.addEventListener("keydown",p),()=>{document.removeEventListener("mousedown",f),document.removeEventListener("keydown",p)}},[a]),g.jsxs("div",{ref:c,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[120px]",style:{left:`${l.x}px`,top:`${l.y}px`},children:[g.jsxs("button",{onClick:()=>{n(),a()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(gD,{className:"w-3.5 h-3.5"}),"Rename"]}),g.jsxs("button",{onClick:()=>{s(),a()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Eb,{className:"w-3.5 h-3.5"}),"Copy ID"]}),g.jsx("div",{className:"border-t border-border my-0.5"}),g.jsxs("button",{onClick:()=>{t(),a()},className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}const lI=140,uI=100;function dI(r,e,t){const n=t(r);if(!n)return{width:lI,height:uI};const c=(n.querySelector(".bg-card")||n).getBoundingClientRect();return{width:c.width/e,height:c.height/e}}function fI(r,e){const{getNodeRef:t}=Pu(),{observe:n}=oC(),[s,a]=w.useState({}),c=w.useCallback(()=>{const l={};r.forEach(d=>{const f=dI(d,e,t);f&&(l[d]=f)}),a(d=>({...d,...l}))},[r,e,t]);return w.useEffect(()=>{if(r.length===0)return;c();const l=[];return r.forEach(d=>{const f=t(d);if(f){const m=f.querySelector(".bg-card")||f;if(m){const y=n(m,c);l.push(y)}}}),()=>{l.forEach(d=>d())}},[r,e,c,t,n]),s}const mh=20,hI=140,pI=100,gI=18,mI=6,yI=gI+mI*2;function vI(r,e,t,n){return w.useMemo(()=>{const s=e.filter(y=>r.nodeIds.includes(y.id));if(s.length===0)return null;const a=mh,c=mh,l=r.showName!==!1?yI:mh;let d=1/0,f=1/0,p=-1/0,m=-1/0;return s.forEach(y=>{const b=t[y.id]||{width:hI,height:pI},S=y.position.x,M=y.position.y,E=S+b.width,C=M+b.height;d=Math.min(d,S),f=Math.min(f,M),p=Math.max(p,E),m=Math.max(m,C)}),{x:d-a,y:f-l,width:p-d+a*2,height:m-f+l+c}},[e,r.nodeIds,t,n,r.showName])}function bI(r,e){const{nodes:t,updateNodes:n}=Ee(),[s,a]=w.useState(!1),c=w.useRef({x:0,y:0}),l=w.useRef({}),d=w.useCallback(f=>{if(f.button!==0||f.target.closest("[data-node-id]"))return;f.stopPropagation();const y=Ee.getState();y.selectGroup(r.id),a(!0),c.current.x=f.clientX,c.current.y=f.clientY,y.setGroupDragging(!0);const b=t.filter(S=>r.nodeIds.includes(S.id));l.current={},b.forEach(S=>{l.current[S.id]={...S.position}})},[r.id,r.nodeIds,t]);return w.useEffect(()=>{if(!s)return;let f=null,p=null,m=!0;const y=S=>{if(!m)return;const M=(S.clientX-c.current.x)/e,E=(S.clientY-c.current.y)/e;p={dx:M,dy:E},f===null&&(f=requestAnimationFrame(()=>{if(!m||!p){f=null,p=null;return}const{dx:C,dy:T}=p,k=Ee.getState(),A=r.nodeIds.map(_=>{const N=l.current[_];return N?{id:_,updates:{position:{x:N.x+C,y:N.y+T}}}:null}).filter(_=>_!==null);A.length>0&&k.updateNodes(A,!0),f=null,p=null}))},b=S=>{if(S&&S.button!==0)return;m=!1,f!==null&&(cancelAnimationFrame(f),f=null);const M=Ee.getState();if(p){const{dx:E,dy:C}=p,T=r.nodeIds.map(k=>{const A=l.current[k];return A?{id:k,updates:{position:{x:A.x+E,y:A.y+C}}}:null}).filter(k=>k!==null);if(M.setGroupDragging(!1),T.length>0){M.updateNodes(T,!0);const k=Ee.getState();gt(k,k.diagramName)}}else M.setGroupDragging(!1);p=null,a(!1)};return document.addEventListener("mousemove",y,{passive:!0}),document.addEventListener("mouseup",b,{capture:!0}),()=>{m=!1,f!==null&&cancelAnimationFrame(f),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b,{capture:!0}),Ee.getState().setGroupDragging(!1)}},[s,r.nodeIds,e]),{isDragging:s,handleMouseDown:d}}const Fv=18,Ml=6;function xI({group:r,zoom:e}){const{nodes:t,selectedGroupId:n,selectGroup:s,deleteGroup:a,updateGroup:c}=Ee(),[l,d]=w.useState(null),[f,p]=w.useState(!1),[m,y]=w.useState(!1),b=fI(r.nodeIds,e),S=vI(r,t,b,e),{handleMouseDown:M}=bI(r,e);if(!S)return null;const E=n===r.id,C=r.color||"hsl(var(--primary))",T=q=>{q.preventDefault(),q.stopPropagation(),s(r.id),d({x:q.clientX,y:q.clientY})},k=()=>{p(!0)},A=()=>{a(r.id),Ye.success("Group deleted"),p(!1)},_=()=>{y(!0)},N=q=>{c(r.id,{name:q}),Ye.success("Group renamed"),y(!1)},L=()=>{navigator.clipboard.writeText(r.id),Ye.success("Group ID copied to clipboard")};return g.jsxs(g.Fragment,{children:[g.jsxs("g",{children:[g.jsx("rect",{x:S.x,y:S.y,width:S.width,height:S.height,fill:C,fillOpacity:E?.1:.05,stroke:C,strokeWidth:E?3/e:2/e,strokeDasharray:E?"0":"5,5",rx:8/e,ry:8/e,style:{cursor:"pointer",transition:"all 0.2s"},onMouseDown:M,onContextMenu:T}),r.showName!==!1&&g.jsxs("g",{onClick:q=>{q.stopPropagation(),s(r.id)},onContextMenu:T,style:{cursor:"pointer"},children:[g.jsx("rect",{x:S.x+Ml,y:S.y+Ml,width:Math.max(80,r.name.length*6.5+16),height:Fv,fill:C,fillOpacity:.85,rx:3,ry:3,stroke:C,strokeWidth:.5}),g.jsx("text",{x:S.x+Ml+8,y:S.y+Ml+Fv/2,fill:"white",fontSize:11,fontWeight:"600",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:r.name})]})]}),l&&g.jsx(cI,{x:l.x,y:l.y,onDelete:k,onRename:_,onCopyId:L,onClose:()=>d(null)}),g.jsx(nC,{open:f,groupName:r.name,onConfirm:A,onCancel:()=>p(!1)}),g.jsx(mp,{open:m,initialName:r.name,onConfirm:N,onCancel:()=>y(!1)})]})}const wI=w.memo(xI,(r,e)=>!(r.group.id!==e.group.id||r.group.name!==e.group.name||r.group.color!==e.group.color||r.group.nodeIds.length!==e.group.nodeIds.length||r.group.nodeIds.some((t,n)=>t!==e.group.nodeIds[n])||r.zoom!==e.zoom));function SI({isVisible:r,canvasRef:e}){const{zoom:t,pan:n}=Ee(),[s,a]=w.useState(null),c=w.useRef(null);if(w.useEffect(()=>{if(!r){a(null);return}const _=()=>{if(e?.current)a(e.current.getBoundingClientRect());else if(c.current?.parentElement){const se=c.current.parentElement.getBoundingClientRect(),ce=24;a({...se,width:se.width-ce,height:se.height-ce,left:se.left+ce,top:se.top+ce})}},N=setTimeout(_,10),L=requestAnimationFrame(_),q=requestAnimationFrame(()=>{requestAnimationFrame(_)});return window.addEventListener("resize",_),()=>{clearTimeout(N),cancelAnimationFrame(L),cancelAnimationFrame(q),window.removeEventListener("resize",_)}},[r,e]),w.useEffect(()=>{if(!r)return;const N=requestAnimationFrame(()=>{e?.current&&a(e.current.getBoundingClientRect())});return()=>cancelAnimationFrame(N)},[t,n,r,e]),!r)return null;if(!s)return g.jsx("div",{ref:c,className:"absolute inset-0 pointer-events-none z-20"});const l=20,d=l*t;let f=1;d<10?f=10:d<20?f=5:d<40&&(f=2);const p=l*f,m=24,y=24,b=s.width,S=s.height,M=Math.floor(-n.x/t/p)*p,E=Math.floor(-n.y/t/p)*p,C=M+b/t+p*2,T=E+S/t+p*2,k=[];for(let _=M;_<=C;_+=p)k.push(_);const A=[];for(let _=E;_<=T;_+=p)A.push(_);return g.jsxs("div",{ref:c,className:"absolute inset-0 pointer-events-none z-20",children:[g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-border pointer-events-none",style:{top:0,left:`${m}px`,right:0,height:`${y}px`,transform:`translate(${n.x}px, 0) scale(${t})`,transformOrigin:"0 0"},children:k.map(_=>g.jsx("div",{className:"absolute top-0 bottom-0 border-l border-border/60",style:{left:`${_}px`,width:"1px"},children:g.jsx("span",{className:"absolute top-0.5 left-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/t})`,transformOrigin:"0 0"},children:_})},`h-${_}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-r border-border pointer-events-none",style:{top:`${y}px`,left:0,bottom:0,width:`${m}px`,transform:`translate(0, ${n.y}px) scale(${t})`,transformOrigin:"0 0"},children:A.map(_=>g.jsx("div",{className:"absolute left-0 right-0 border-t border-border/60",style:{top:`${_}px`,height:"1px"},children:g.jsx("span",{className:"absolute left-0.5 top-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/t})`,transformOrigin:"0 0"},children:_})},`v-${_}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-r border-border pointer-events-none",style:{top:0,left:0,width:`${m}px`,height:`${y}px`}})]})}function MI({x:r,y:e,onDelete:t,onDuplicate:n,onCopyId:s,onBringToFront:a,onSendToBack:c,onBringForward:l,onSendBackward:d,onAddToGroup:f,onRemoveFromGroup:p,onClose:m}){const y=w.useRef(null);w.useEffect(()=>{const N=q=>{y.current&&!y.current.contains(q.target)&&m()},L=q=>{q.key==="Escape"&&m()};return document.addEventListener("mousedown",N),document.addEventListener("keydown",L),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("keydown",L)}},[m]);const b=()=>{t(),m()},S=()=>{n(),m()},M=()=>{s(),m()},E=()=>{a?.(),m()},C=()=>{c?.(),m()},T=()=>{l?.(),m()},k=()=>{d?.(),m()},A=()=>{f?.(),m()},_=()=>{p?.(),m()};return g.jsxs("div",{ref:y,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[140px]",style:{left:`${r}px`,top:`${e}px`},children:[g.jsxs("button",{onClick:S,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Tb,{className:"w-3.5 h-3.5"}),"Duplicate"]}),g.jsxs("button",{onClick:M,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Eb,{className:"w-3.5 h-3.5"}),"Copy ID"]}),(f||p)&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"border-t border-border my-0.5"}),p&&g.jsxs("button",{onClick:_,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(jA,{className:"w-3.5 h-3.5"}),"Remove from Group"]}),f&&g.jsxs("button",{onClick:A,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(xh,{className:"w-3.5 h-3.5"}),"Add to Group"]})]}),g.jsx("div",{className:"border-t border-border my-0.5"}),(a||c||l||d)&&g.jsxs(g.Fragment,{children:[g.jsxs("button",{onClick:E,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(fA,{className:"w-3.5 h-3.5"}),"Bring to Front"]}),g.jsxs("button",{onClick:C,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(cA,{className:"w-3.5 h-3.5"}),"Send to Back"]}),g.jsxs("button",{onClick:T,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Cb,{className:"w-3.5 h-3.5"}),"Bring Forward"]}),g.jsxs("button",{onClick:k,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Jl,{className:"w-3.5 h-3.5"}),"Send Backward"]}),g.jsx("div",{className:"border-t border-border my-0.5"})]}),g.jsxs("button",{onClick:b,className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}function CI({nodeId:r,x:e,y:t,onClose:n}){const s=w.useRef(null),{groups:a,addNodeToGroup:c}=Ee();return w.useEffect(()=>{const l=f=>{s.current&&!s.current.contains(f.target)&&n()},d=f=>{f.key==="Escape"&&n()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",d)}},[n]),g.jsxs("div",{ref:s,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${e}px`,top:`${t}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Add to Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:(()=>{const l=a.filter(d=>!d.nodeIds.includes(r));return l.length>0?l.map(d=>g.jsxs("button",{onClick:()=>{c(d.id,r),Ye.success(`Added to "${d.name}"`),n()},className:"w-full px-2 py-1.5 text-xs text-left text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:d.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:d.name})]},d.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:a.length===0?"No groups available":"Already in all groups"})})()}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:n,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function EI({nodeId:r,x:e,y:t,onClose:n}){const s=w.useRef(null),{groups:a,removeNodeFromGroup:c}=Ee(),l=a.filter(d=>d.nodeIds.includes(r));return w.useEffect(()=>{const d=p=>{s.current&&!s.current.contains(p.target)&&n()},f=p=>{p.key==="Escape"&&n()};return document.addEventListener("mousedown",d),document.addEventListener("keydown",f),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",f)}},[n]),g.jsxs("div",{ref:s,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${e}px`,top:`${t}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Remove from Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:l.length>0?l.map(d=>g.jsxs("button",{onClick:()=>{c(d.id,r),Ye.success(`Removed from "${d.name}"`),n()},className:"w-full px-2 py-1.5 text-xs text-left text-destructive hover:bg-destructive/10 hover:text-destructive flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:d.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:d.name})]},d.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:"Not in any groups"})}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:n,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function RI({x:r,y:e,onDelete:t,onClose:n}){const s=w.useRef(null),[a,c]=w.useState({x:r,y:e});return w.useEffect(()=>{if(s.current){const l=s.current.getBoundingClientRect(),d=window.innerWidth,f=window.innerHeight;let p=r,m=e;r+l.width>d&&(p=d-l.width-8),e+l.height>f&&(m=f-l.height-8),p=Math.max(8,p),m=Math.max(8,m),c({x:p,y:m})}},[r,e]),w.useEffect(()=>{const l=f=>{s.current&&!s.current.contains(f.target)&&n()},d=f=>{f.key==="Escape"&&n()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",d)}},[n]),g.jsx("div",{ref:s,className:"fixed bg-card border border-border rounded-md shadow-lg z-50",style:{left:`${a.x}px`,top:`${a.y}px`},children:g.jsx("button",{className:"w-full px-3 py-2 text-sm text-left hover:bg-accent transition-colors first:rounded-t-md last:rounded-b-md",onClick:t,children:"Delete"})})}function Qv(){const r=w.useRef(null),{nodes:e,connections:t,groups:n=[],addNode:s,addConnection:a,deleteConnection:c,zoom:l,pan:d,setPan:f,setZoom:p,selectNode:m,selectConnection:y,selectGroup:b,selectNodesByIds:S,selectedConnectionId:M,selectedNodeId:E,setViewportSize:C,deleteNode:T,updateNode:k,bringToFront:A,sendToBack:_,bringForward:N,sendBackward:L,canvasBounds:q,canvasChunks:Z,addNodeToGroup:se,removeNodeFromGroup:ce}=Ee(),{isRunning:J}=Nt(),{showMinimap:te,showHeatMapLegend:le,showRuler:ue}=$r(),{getNodeRef:z}=Pu(),[j,O]=w.useState(!1),[W,he]=w.useState({x:0,y:0}),[P,F]=w.useState(!1),[Y,ie]=w.useState(null),[B,ae]=w.useState(void 0),[$,G]=w.useState(null),[pe,me]=w.useState(null),[ye,ve]=w.useState(null),[Pe,$e]=w.useState(null),[it,Je]=w.useState(null),[jt,de]=w.useState(null),[Ue,Be]=w.useState(null);w.useEffect(()=>{if(!r.current)return;const ee=()=>{if(!r.current)return;const be=r.current.getBoundingClientRect();C({width:be.width,height:be.height})};ee();const fe=new ResizeObserver(()=>{ee()});return fe.observe(r.current),window.addEventListener("resize",ee),()=>{fe.disconnect(),window.removeEventListener("resize",ee)}},[C]),w.useEffect(()=>{const ee=fe=>{if((fe.ctrlKey||fe.metaKey)&&r.current){const be=r.current.getBoundingClientRect();fe.clientX>=be.left&&fe.clientX<=be.right&&fe.clientY>=be.top&&fe.clientY<=be.bottom&&fe.preventDefault()}};return document.addEventListener("wheel",ee,{passive:!1,capture:!0}),()=>{document.removeEventListener("wheel",ee,{capture:!0})}},[]);const bt=ee=>{if(ee.preventDefault(),!r.current)return;const fe=ee.dataTransfer.getData("application/json");if(!fe)return;const be=JSON.parse(fe),ze=r.current.getBoundingClientRect(),Ie=(ee.clientX-ze.left-d.x)/l,lt=(ee.clientY-ze.top-d.y)/l,Lt={id:`node-${Date.now()}`,type:be.type,position:{x:Ie,y:lt},data:{label:be.label}};s(Lt)},mt=ee=>{ee.preventDefault(),ee.dataTransfer.dropEffect="copy"},Ut=ee=>{const fe=ee.button===0;if(ee.button===1||fe&&ee.ctrlKey){O(!0),he({x:ee.clientX-d.x,y:ee.clientY-d.y}),ee.preventDefault();return}if(fe&&!P&&!ee.ctrlKey&&!ee.metaKey){if(r.current){const ze=r.current.getBoundingClientRect(),Ie=(ee.clientX-ze.left-d.x)/l,lt=(ee.clientY-ze.top-d.y)/l;$e({x:Ie,y:lt}),Je({x:Ie,y:lt,width:0,height:0})}m(null),y(null),b(null)}},Ze=ee=>{if(j)f({x:ee.clientX-W.x,y:ee.clientY-W.y});else if(P&&r.current){const fe=r.current.getBoundingClientRect();G({x:(ee.clientX-fe.left-d.x)/l,y:(ee.clientY-fe.top-d.y)/l})}else if(Pe&&r.current){const fe=r.current.getBoundingClientRect(),be=(ee.clientX-fe.left-d.x)/l,ze=(ee.clientY-fe.top-d.y)/l,Ie=Math.min(Pe.x,be),lt=Math.min(Pe.y,ze),Lt=Math.abs(be-Pe.x),Zt=Math.abs(ze-Pe.y),At={x:Ie,y:lt,width:Lt,height:Zt};Je(At);const un=e.filter(Mt=>{const at=Mt.position.x,vt=Mt.position.y,$t=Mt.position.x+140,hs=Mt.position.y+140;return $t>=At.x&&at<=At.x+At.width&&hs>=At.y&&vt<=At.y+At.height}).map(Mt=>Mt.id);S(un)}},Pt=()=>{O(!1),P&&(F(!1),ie(null),G(null)),Pe&&($e(null),Je(null))},xt=w.useCallback((ee,fe)=>{F(!0),ie(ee),ae(fe)},[]),yt=w.useCallback(ee=>{const fe=z(ee);if(!fe)return{width:140,height:100};const Ie=(fe.querySelector(".bg-card")||fe).getBoundingClientRect();return{width:Ie.width/l,height:Ie.height/l}},[z,l]),Xt=w.useCallback((ee,fe)=>{if(P&&Y&&Y!==ee){const be=e.find(Ie=>Ie.id===Y),ze=e.find(Ie=>Ie.id===ee);if(be&&ze){const Ie=yt(Y),lt=yt(ee),Lt=$?.x??ze.position.x+lt.width/2,Zt=$?.y??ze.position.y+lt.height/2,At=be.position.x+Ie.width/2,un=be.position.y+Ie.height/2,Mt=B!==void 0?B:Bv(Y,ee,Lt,Zt,t,be.position.x,be.position.y,Ie.width,Ie.height),at=fe!==void 0?fe:Bv(ee,Y,At,un,t,ze.position.x,ze.position.y,lt.width,lt.height),vt={id:`conn-${Date.now()}`,source:Y,target:ee,type:"async",sourcePort:Mt,targetPort:at};a(vt)}}F(!1),ie(null),ae(void 0),G(null)},[P,Y,B,e,t,a,$,yt]),Gt=w.useCallback(ee=>{y(ee)},[y]),_s=w.useCallback((ee,fe,be)=>{me({connectionId:ee,x:fe,y:be})},[]),Xn=w.useCallback(ee=>{const fe=ee.target,be=fe.closest?.("[data-node-id]"),ze=fe.closest?.("[data-connection-id]"),Ie=fe instanceof SVGElement,lt=fe.closest?.("svg")!==null;if(be||ze||Ie||lt)return;const Lt=e.filter(Zt=>Zt.selected);Lt.length>0&&(ee.preventDefault(),ee.stopPropagation(),ve({nodeId:Lt[0].id,x:ee.clientX,y:ee.clientY}))},[e]),Nn=w.useCallback(()=>{pe&&(c(pe.connectionId),me(null))},[pe,c]),fs=w.useMemo(()=>e.map(ee=>ee.id).join(","),[e]),Jt=w.useMemo(()=>{const ee=new Map;return e.forEach(fe=>{const be=fe.id;ee.set(be,{onConnectionStart:ze=>xt(be,ze),onConnectionEnd:ze=>Xt(be,ze),onContextMenu:(ze,Ie)=>ve({nodeId:be,x:ze,y:Ie})})}),ee},[fs,xt,Xt,e]),Kt=w.useMemo(()=>t.map(ee=>ee.id).join(","),[t]),zt=w.useMemo(()=>{const ee=new Map;return t.forEach(fe=>{const be=fe.id;ee.set(be,{onClick:()=>Gt(be),onContextMenu:ze=>_s(be,ze.clientX,ze.clientY)})}),ee},[Kt,Gt,_s,t]),Fi=ee=>{if(ee.ctrlKey&&r.current){ee.preventDefault();const{left:fe,top:be,width:ze,height:Ie}=r.current.getBoundingClientRect(),lt=ee.clientX-fe,Lt=ee.clientY-be,Zt=(lt-d.x)/l,At=(Lt-d.y)/l,un=1+Math.min(Math.max(-ee.deltaY/500,-.5),.5);let Mt=l*un;Mt=Math.min(Math.max(Mt,.3),2.5);const at=lt-Zt*Mt,vt=Lt-At*Mt;p(Mt),f({x:at,y:vt})}},jn=20,Jr=ue?24:0,Ns=2e3,Qi=l<.5,ci=Ee(ee=>ee.viewportWidth),Jn=Ee(ee=>ee.viewportHeight),js=w.useMemo(()=>{if(ci===0||Jn===0)return e;const ee=-d.x/l,fe=-d.y/l,be=(ci-d.x)/l,ze=(Jn-d.y)/l,Ie=200,lt=ee-Ie,Lt=fe-Ie,Zt=be+Ie,At=ze+Ie;return e.filter(un=>{const Mt=un.position.x,at=un.position.y;return Mt+140>=lt&&Mt<=Zt&&at+100>=Lt&&at<=At})},[e,l,d,ci,Jn]),Ps=w.useMemo(()=>new Set(js.map(ee=>ee.id)),[js]),zu=w.useMemo(()=>t.filter(ee=>Ps.has(ee.source)&&Ps.has(ee.target)),[t,Ps]);return g.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[g.jsx(SI,{isVisible:ue,canvasRef:r}),g.jsx("div",{ref:r,className:"absolute overflow-hidden",style:{top:`${Jr}px`,left:`${Jr}px`,right:0,bottom:0,cursor:j?"grabbing":P?"crosshair":"default",backgroundColor:"hsl(var(--muted) / 0.1)"},onDrop:bt,onDragOver:mt,onMouseDown:Ut,onMouseMove:Ze,onMouseUp:Pt,onMouseLeave:Pt,onWheel:Fi,onContextMenu:Xn,children:g.jsxs("div",{style:{transform:`translate(${d.x}px, ${d.y}px) scale(${l})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[Z.map(ee=>{const fe=ee.x*Ns,be=ee.y*Ns,ze=Z.some(at=>at.x===ee.x+1&&at.y===ee.y),Ie=Z.some(at=>at.x===ee.x&&at.y===ee.y+1),lt=d.x/l,Lt=d.y/l,Zt=(-lt%jn+jn)%jn,At=(-Lt%jn+jn)%jn,un=fe%jn,Mt=be%jn;return g.jsxs("div",{className:"absolute pointer-events-none",style:{left:`${fe}px`,top:`${be}px`,width:`${Ns}px`,height:`${Ns}px`,backgroundColor:"hsl(var(--canvas-bg))",backgroundImage:`
                  linear-gradient(hsl(var(--canvas-grid)) 1px, transparent 1px),
                  linear-gradient(90deg, hsl(var(--canvas-grid)) 1px, transparent 1px)
                `,backgroundSize:`${jn}px ${jn}px`,backgroundPosition:`${Zt+un}px ${At+Mt}px`,border:Qi?"2px dashed hsl(var(--border) / 0.6)":"none",boxShadow:Qi?"inset 0 0 0 1px hsl(var(--border) / 0.3)":"none"},children:[ze&&g.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none z-10",style:{right:0,width:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}}),Ie&&g.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{bottom:0,height:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}})]},`chunk-${ee.x}-${ee.y}`)}),it&&g.jsx("div",{className:"absolute border-2 border-primary/60 bg-primary/10 pointer-events-none",style:{left:it.x,top:it.y,width:it.width,height:it.height}}),g.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"visible"},children:[g.jsxs("defs",{children:[g.jsx("marker",{id:"arrowhead-default",markerWidth:"8",markerHeight:"8",refX:"7",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,8 L8,4 z",fill:"hsl(var(--border))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-selected",markerWidth:"10",markerHeight:"10",refX:"8",refY:"5",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,10 L10,5 z",fill:"hsl(var(--primary))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-bottleneck",markerWidth:"12",markerHeight:"12",refX:"10",refY:"6",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,12 L12,6 z",fill:"hsl(0 84% 60%)",stroke:"none"})})]}),n&&n.length>0&&g.jsx("g",{style:{pointerEvents:"auto"},children:n.map(ee=>g.jsx(wI,{group:ee,zoom:l},ee.id))}),g.jsxs("g",{style:{pointerEvents:"auto"},children:[zu.map(ee=>{const fe=e.find(Ie=>Ie.id===ee.source),be=e.find(Ie=>Ie.id===ee.target);if(!fe||!be)return null;const ze=zt.get(ee.id);return ze?g.jsx(tI,{connection:ee,sourceNode:fe,targetNode:be,zoom:l,pan:d,isSelected:M===ee.id,onClick:ze.onClick,onContextMenu:ze.onContextMenu},ee.id):null}),P&&Y&&$&&(()=>{const ee=e.find(Ie=>Ie.id===Y);if(!ee)return null;const fe=yt(Y);let be,ze;if(B!==void 0){const lt=Mo(ee.position.x,ee.position.y,fe.width,fe.height,16)[B];be=lt.x,ze=lt.y}else be=ee.position.x+fe.width/2,ze=ee.position.y+fe.height/2;return g.jsx("line",{x1:be,y1:ze,x2:$.x,y2:$.y,stroke:"hsl(var(--primary))",strokeWidth:2/l,strokeDasharray:"5,5",style:{pointerEvents:"none"}})})()]})]}),js.map(ee=>{const fe=Jt.get(ee.id);return fe?g.jsx(W5,{node:ee,onConnectionStart:fe.onConnectionStart,onConnectionEnd:fe.onConnectionEnd,isConnecting:P,onContextMenu:fe.onContextMenu},ee.id):null}),J&&js.map(ee=>g.jsx(aI,{nodeId:ee.id,position:ee.position},`metrics-${ee.id}`))]})}),g.jsx(oI,{isVisible:le}),g.jsx(rI,{isVisible:te}),g.jsx(X5,{selectedNodeId:E,highlightPath:!0}),pe&&g.jsx(RI,{x:pe.x,y:pe.y,onDelete:Nn,onClose:()=>me(null)}),ye&&(()=>{const ee=e.find(Fe=>Fe.id===ye.nodeId);if(!ee)return null;const fe=e.filter(Fe=>Fe.selected),be=fe.length>1,ze=()=>{be?(fe.forEach(Fe=>{T(Fe.id)}),Ye.success(`${fe.length} elements deleted`)):(T(ee.id),Ye.success("Element deleted")),ve(null)},Ie=()=>{if(be)fe.forEach((Fe,Pn)=>{const Vi={...Sl(Fe),id:`${Fe.type}_${Date.now()}_${Pn}`,position:{x:Fe.position.x+20+Pn*10,y:Fe.position.y+20+Pn*10},selected:!1};Vi.data?.config&&(Vi.data.config=Sl(Vi.data.config)),s(Vi)}),Ye.success(`${fe.length} elements duplicated`);else{const Fe={...Sl(ee),id:`${ee.type}_${Date.now()}`,position:{x:ee.position.x+20,y:ee.position.y+20},selected:!1};Fe.data?.config&&(Fe.data.config=Sl(Fe.data.config)),s(Fe),Ye.success("Element duplicated")}ve(null)},lt=()=>{if(be){const Fe=fe.map(Pn=>Pn.id).join(", ");navigator.clipboard.writeText(Fe),Ye.success(`${fe.length} IDs copied to clipboard`)}else navigator.clipboard.writeText(ee.id),Ye.success("ID copied to clipboard");ve(null)},Lt=()=>{be?(fe.forEach(Fe=>{A(Fe.id)}),Ye.success(`${fe.length} elements brought to front`)):(A(ee.id),Ye.success("Brought to front")),ve(null)},Zt=()=>{be?(fe.forEach(Fe=>{_(Fe.id)}),Ye.success(`${fe.length} elements sent to back`)):(_(ee.id),Ye.success("Sent to back")),ve(null)},At=()=>{be?(fe.forEach(Fe=>{N(Fe.id)}),Ye.success(`${fe.length} elements brought forward`)):(N(ee.id),Ye.success("Brought forward")),ve(null)},un=()=>{be?(fe.forEach(Fe=>{L(Fe.id)}),Ye.success(`${fe.length} elements sent backward`)):(L(ee.id),Ye.success("Sent backward")),ve(null)},Mt=()=>{de(be?{nodeId:fe[0].id,x:ye.x,y:ye.y}:{nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)},at=be?n.filter(Fe=>fe.some(Pn=>Fe.nodeIds.includes(Pn.id))):n.filter(Fe=>Fe.nodeIds.includes(ee.id)),vt=at.length>=1,$t=at.length>=2,hs=()=>{if(be){let Fe=0;fe.forEach(Pn=>{n.filter(Ea=>Ea.nodeIds.includes(Pn.id)).forEach(Ea=>{ce(Ea.id,Pn.id),Fe++})}),Fe>0&&Ye.success(`Removed ${fe.length} elements from groups`),ve(null)}else $t?(Be({nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)):at.length===1&&(ce(at[0].id,ee.id),Ye.success(`Removed from "${at[0].name}"`),ve(null))};return g.jsx(MI,{x:ye.x,y:ye.y,onDelete:ze,onDuplicate:Ie,onCopyId:lt,onBringToFront:Lt,onSendToBack:Zt,onBringForward:At,onSendBackward:un,onAddToGroup:Mt,onRemoveFromGroup:vt?hs:void 0,onClose:()=>ve(null)})})(),jt&&g.jsx(CI,{nodeId:jt.nodeId,x:jt.x,y:jt.y,onClose:()=>de(null)}),Ue&&g.jsx(EI,{nodeId:Ue.nodeId,x:Ue.x,y:Ue.y,onClose:()=>Be(null)})]})}const kI="modulepreload",TI=function(r){return"/"+r},Vv={},Me=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let d=function(f){return Promise.all(f.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");s=d(t.map(f=>{if(f=TI(f),f in Vv)return;Vv[f]=!0;const p=f.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${m}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":kI,p||(y.as="script"),y.crossOrigin="",y.href=f,l&&y.setAttribute("nonce",l),document.head.appendChild(y),p)return new Promise((b,S)=>{y.addEventListener("load",b),y.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return s.then(c=>{for(const l of c||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})},AI=w.lazy(()=>Me(()=>import("./KafkaConfigAdvanced-BvaNq7aB.js"),__vite__mapDeps([0,1,2,3,4,5])).then(r=>({default:r.KafkaConfigAdvanced}))),DI=w.lazy(()=>Me(()=>import("./RabbitMQConfigAdvanced-3sShrFCN.js"),__vite__mapDeps([6,1,7,8,9,10,11,12,5,3])).then(r=>({default:r.RabbitMQConfigAdvanced}))),_I=w.lazy(()=>Me(()=>import("./PostgreSQLConfigAdvanced-BDM62wii.js"),__vite__mapDeps([13,2,7,9,8,3,14,4,12])).then(r=>({default:r.PostgreSQLConfigAdvanced}))),NI=w.lazy(()=>Me(()=>import("./MongoDBConfigAdvanced-Cb2d_tzz.js"),__vite__mapDeps([15,2,7,9,8,3])).then(r=>({default:r.MongoDBConfigAdvanced}))),jI=w.lazy(()=>Me(()=>import("./RedisConfigAdvanced-CCERgMi5.js"),__vite__mapDeps([16,2,9,8,3,12])).then(r=>({default:r.RedisConfigAdvanced}))),PI=w.lazy(()=>Me(()=>import("./ElasticsearchConfigAdvanced-CunCpHWf.js"),__vite__mapDeps([17,2,9,18,19,3,5])).then(r=>({default:r.ElasticsearchConfigAdvanced}))),zI=w.lazy(()=>Me(()=>import("./CassandraConfigAdvanced-DaIbDvtM.js"),__vite__mapDeps([20,1,2,3,14,19])).then(r=>({default:r.CassandraConfigAdvanced}))),LI=w.lazy(()=>Me(()=>import("./ClickHouseConfigAdvanced-CBMRn2Io.js"),__vite__mapDeps([21,2,1,7,8,9,22,3,19])).then(r=>({default:r.ClickHouseConfigAdvanced}))),II=w.lazy(()=>Me(()=>import("./SnowflakeConfigAdvanced-CBljDbVL.js"),__vite__mapDeps([23,2,18,3,12])).then(r=>({default:r.SnowflakeConfigAdvanced}))),OI=w.lazy(()=>Me(()=>import("./S3DataLakeConfigAdvanced-BtRjVX6m.js"),__vite__mapDeps([24,18,12,25])).then(r=>({default:r.S3DataLakeConfigAdvanced}))),HI=w.lazy(()=>Me(()=>import("./NginxConfigAdvanced-CMfOPPPN.js"),__vite__mapDeps([26,2,1,27,28,29,11,5])).then(r=>({default:r.NginxConfigAdvanced}))),qI=w.lazy(()=>Me(()=>import("./RestApiConfigAdvanced-z-YiBW2W.js"),__vite__mapDeps([30,2,28,19])).then(r=>({default:r.RestApiConfigAdvanced}))),UI=w.lazy(()=>Me(()=>import("./GRPCConfigAdvanced-15R5YqI9.js"),__vite__mapDeps([31,2,18,29,32])).then(r=>({default:r.GRPCConfigAdvanced}))),$I=w.lazy(()=>Me(()=>import("./WebSocketConfigAdvanced-BScKJxFv.js"),__vite__mapDeps([33,2,18,10,34,32])).then(r=>({default:r.WebSocketConfigAdvanced}))),BI=w.lazy(()=>Me(()=>import("./GraphQLConfigAdvanced-By52hJQM.js"),__vite__mapDeps([35,2,18,3,19,32])).then(r=>({default:r.GraphQLConfigAdvanced}))),FI=w.lazy(()=>Me(()=>import("./SOAPConfigAdvanced-CZkWjRER.js"),__vite__mapDeps([36,2,18,29,32])).then(r=>({default:r.SOAPConfigAdvanced}))),QI=w.lazy(()=>Me(()=>import("./WebhookConfigAdvanced-CtOzXmJI.js"),__vite__mapDeps([37,18,38,34,32,39])).then(r=>({default:r.WebhookConfigAdvanced}))),VI=w.lazy(()=>Me(()=>import("./DockerK8sConfigAdvanced-BtwLm_D2.js"),__vite__mapDeps([40,2,1,41,9,42,43])).then(r=>({default:r.DockerK8sConfigAdvanced}))),GI=w.lazy(()=>Me(()=>import("./KubernetesConfigAdvanced-SMHhCX_Z.js"),__vite__mapDeps([44,2,1,9,12,25,29])).then(r=>({default:r.KubernetesConfigAdvanced}))),KI=w.lazy(()=>Me(()=>import("./HAProxyConfigAdvanced-C28vLKEd.js"),__vite__mapDeps([45,18,46,32,29,5])).then(r=>({default:r.HAProxyConfigAdvanced}))),YI=w.lazy(()=>Me(()=>import("./TraefikConfigAdvanced-CySWtVHv.js"),__vite__mapDeps([47,18,48,32,5])).then(r=>({default:r.TraefikConfigAdvanced}))),WI=w.lazy(()=>Me(()=>import("./EnvoyConfigAdvanced-BiQZ_44n.js"),__vite__mapDeps([49,18,28,29,32])).then(r=>({default:r.EnvoyConfigAdvanced}))),XI=w.lazy(()=>Me(()=>import("./ActiveMQConfigAdvanced-ChXTW-Jl.js"),__vite__mapDeps([50,1,41,18,10,3,4,5,51])).then(r=>({default:r.ActiveMQConfigAdvanced}))),JI=w.lazy(()=>Me(()=>import("./AWSSQSConfigAdvanced-DIVVrhui.js"),__vite__mapDeps([52,1,18,53,10,12,5,34])).then(r=>({default:r.AWSSQSConfigAdvanced}))),ZI=w.lazy(()=>Me(()=>import("./AzureServiceBusConfigAdvanced-BKwC0Ook.js"),__vite__mapDeps([54,2,10,12])).then(r=>({default:r.AzureServiceBusConfigAdvanced}))),eO=w.lazy(()=>Me(()=>import("./GCPPubSubConfigAdvanced-Cfqk90Xt.js"),__vite__mapDeps([55,2,10,4,12])).then(r=>({default:r.GCPPubSubConfigAdvanced}))),tO=w.lazy(()=>Me(()=>import("./KongConfigAdvanced-CLoh3jT2.js"),__vite__mapDeps([56,2,9,29,48,4])).then(r=>({default:r.KongConfigAdvanced}))),nO=w.lazy(()=>Me(()=>import("./ApigeeConfigAdvanced-COKA6x6Q.js"),__vite__mapDeps([57,1,5])).then(r=>({default:r.ApigeeConfigAdvanced}))),sO=w.lazy(()=>Me(()=>import("./MuleSoftConfigAdvanced-Dt7tq7Y7.js"),__vite__mapDeps([58,1,3,32])).then(r=>({default:r.MuleSoftConfigAdvanced}))),iO=w.lazy(()=>Me(()=>import("./GraphQLGatewayConfigAdvanced-CW9Y8v8E.js"),__vite__mapDeps([59,32,28])).then(r=>({default:r.GraphQLGatewayConfigAdvanced}))),aO=w.lazy(()=>Me(()=>import("./BFFServiceConfigAdvanced-DgknMRbw.js"),__vite__mapDeps([60,18])).then(r=>({default:r.BFFServiceConfigAdvanced}))),oO=w.lazy(()=>Me(()=>import("./WebhookRelayConfigAdvanced-C32z_umw.js"),__vite__mapDeps([61,2,41,18,38,34,32,39])).then(r=>({default:r.WebhookRelayConfigAdvanced}))),rO=w.lazy(()=>Me(()=>import("./PrometheusConfigAdvanced-BStD_hYg.js"),__vite__mapDeps([62,2,9,43])).then(r=>({default:r.PrometheusConfigAdvanced}))),cO=w.lazy(()=>Me(()=>import("./GrafanaConfigAdvanced-DMr0HHkA.js"),__vite__mapDeps([63,22,64,2,3])).then(r=>({default:r.GrafanaConfigAdvanced}))),lO=w.lazy(()=>Me(()=>import("./LokiConfigAdvanced-C1TnZ3wV.js"),__vite__mapDeps([65,2,51])).then(r=>({default:r.LokiConfigAdvanced}))),uO=w.lazy(()=>Me(()=>import("./JaegerConfigAdvanced-BjgG_s7r.js"),__vite__mapDeps([66,1,67])).then(r=>({default:r.JaegerConfigAdvanced}))),dO=w.lazy(()=>Me(()=>import("./OpenTelemetryCollectorConfigAdvanced-Br1rb2RN.js"),__vite__mapDeps([68,1,18,11])).then(r=>({default:r.OpenTelemetryCollectorConfigAdvanced}))),fO=w.lazy(()=>Me(()=>import("./PagerDutyConfigAdvanced-Lv94dbYd.js"),__vite__mapDeps([69,18,4,70,39])).then(r=>({default:r.PagerDutyConfigAdvanced}))),hO=w.lazy(()=>Me(()=>import("./KeycloakConfigAdvanced-bjwwgcip.js"),__vite__mapDeps([71,2,27,5,28,12,4,39,72,73,74])).then(r=>({default:r.KeycloakConfigAdvanced}))),pO=w.lazy(()=>Me(()=>import("./WAFConfigAdvanced-Cx1ooaP2.js"),__vite__mapDeps([75,27,18,5,28,32])).then(r=>({default:r.WAFConfigAdvanced}))),gO=w.lazy(()=>Me(()=>import("./SecretsVaultConfigAdvanced-CBxQksMW.js"),__vite__mapDeps([76,27,2,18,12,3,5,72,74,32])).then(r=>({default:r.SecretsVaultConfigAdvanced}))),mO=w.lazy(()=>Me(()=>import("./IDSIPSConfigAdvanced-CXefv-Mj.js"),__vite__mapDeps([77,27,18,5,32])).then(r=>({default:r.IDSIPSConfigAdvanced}))),yO=w.lazy(()=>Me(()=>import("./FirewallConfigAdvanced-SaWbN52a.js"),__vite__mapDeps([78,41,27,18,5,32,46])).then(r=>({default:r.FirewallConfigAdvanced}))),vO=w.lazy(()=>Me(()=>import("./JenkinsConfigAdvanced-DyWy_o9H.js"),__vite__mapDeps([79,1,2,27,67,80,29,4,22,46,64,39,42])).then(r=>({default:r.JenkinsConfigAdvanced}))),bO=w.lazy(()=>Me(()=>import("./GitLabCIConfigAdvanced-DXP6D2PV.js"),__vite__mapDeps([81,1,27,67,19,29,3,28,82,39])).then(r=>({default:r.GitLabCIConfigAdvanced}))),xO=w.lazy(()=>Me(()=>import("./ArgoCDConfigAdvanced-DW6NfeXZ.js"),__vite__mapDeps([83,1,2,27,3,84,5,70,67,39])).then(r=>({default:r.ArgoCDConfigAdvanced}))),wO=w.lazy(()=>Me(()=>import("./HarborConfigAdvanced-ySR7dBKk.js"),__vite__mapDeps([85,9,80,25,4,5])).then(r=>({default:r.HarborConfigAdvanced}))),SO=w.lazy(()=>Me(()=>import("./TerraformConfigAdvanced-Cpv_e8_Z.js"),__vite__mapDeps([86,27,2,18,32,53,39])).then(r=>({default:r.TerraformConfigAdvanced}))),MO=w.lazy(()=>Me(()=>import("./AnsibleConfigAdvanced-B0EC-w5B.js"),__vite__mapDeps([87,27,2,18,29,32,84,12,82,39])).then(r=>({default:r.AnsibleConfigAdvanced}))),CO=w.lazy(()=>Me(()=>import("./IstioConfigAdvanced-DA6-2UDW.js"),__vite__mapDeps([88,18,28,48])).then(r=>({default:r.IstioConfigAdvanced}))),EO=w.lazy(()=>Me(()=>import("./ServiceMeshConfigAdvanced--tFdzQ0J.js"),__vite__mapDeps([89,18,29,5])).then(r=>({default:r.ServiceMeshConfigAdvanced}))),RO=w.lazy(()=>Me(()=>import("./APIGatewayConfigAdvanced-q4q8lm0f.js"),__vite__mapDeps([90,9,18,28,5,46,48])).then(r=>({default:r.APIGatewayConfigAdvanced}))),kO=w.lazy(()=>Me(()=>import("./VPNConfigAdvanced-wcsP9aWL.js"),__vite__mapDeps([91,18,4,72,39])).then(r=>({default:r.VPNConfigAdvanced}))),TO=w.lazy(()=>Me(()=>import("./CDNConfigAdvanced-BnPAi64B.js"),__vite__mapDeps([92,18,28,46])).then(r=>({default:r.CDNConfigAdvanced}))),AO=w.lazy(()=>Me(()=>import("./SparkConfigAdvanced-CNmBRk3S.js"),__vite__mapDeps([93,18,3,32,39])).then(r=>({default:r.SparkConfigAdvanced}))),DO=w.lazy(()=>Me(()=>import("./TensorFlowServingConfigAdvanced-BNMHBsOI.js"),__vite__mapDeps([94,2,18,3,32])).then(r=>({default:r.TensorFlowServingConfigAdvanced}))),_O=w.lazy(()=>Me(()=>import("./PyTorchServeConfigAdvanced-BJSvV3Oq.js"),__vite__mapDeps([95,2,18,3,32])).then(r=>({default:r.PyTorchServeConfigAdvanced}))),NO=w.lazy(()=>Me(()=>import("./FeatureStoreConfigAdvanced-YrrbrnTQ.js"),__vite__mapDeps([96,18,80,3,46])).then(r=>({default:r.FeatureStoreConfigAdvanced}))),jO=w.lazy(()=>Me(()=>import("./MLflowConfigAdvanced-oKp25OvW.js"),__vite__mapDeps([97,80,46])).then(r=>({default:r.MLflowConfigAdvanced}))),PO=w.lazy(()=>Me(()=>import("./CRMConfigAdvanced-zdtoquKO.js"),__vite__mapDeps([98,18,4,99,46,100,73])).then(r=>({default:r.CRMConfigAdvanced}))),zO=w.lazy(()=>Me(()=>import("./ERPConfigAdvanced-BoGVZWqS.js"),__vite__mapDeps([101,18,80,99,46,100])).then(r=>({default:r.ERPConfigAdvanced}))),LO=w.lazy(()=>Me(()=>import("./RPABotConfigAdvanced-C_MSXaKQ.js"),__vite__mapDeps([102,18,46,32,39])).then(r=>({default:r.RPABotConfigAdvanced}))),IO=w.lazy(()=>Me(()=>import("./BPMNEngineConfigAdvanced-Cn2OEmzI.js"),__vite__mapDeps([103,18,32,39,4])).then(r=>({default:r.BPMNEngineConfigAdvanced}))),OO=w.lazy(()=>Me(()=>import("./PaymentGatewayConfigAdvanced-D3H_vKaX.js"),__vite__mapDeps([104,18,99,46,5,32,39])).then(r=>({default:r.PaymentGatewayConfigAdvanced}))),HO=()=>g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsx("div",{className:"text-muted-foreground",children:"Loading configuration..."})});function qO({componentId:r,componentType:e}){const t=()=>{switch(e){case"kafka":return g.jsx(AI,{componentId:r});case"rabbitmq":return g.jsx(DI,{componentId:r});case"postgres":return g.jsx(_I,{componentId:r});case"mongodb":return g.jsx(NI,{componentId:r});case"redis":return g.jsx(jI,{componentId:r});case"elasticsearch":return g.jsx(PI,{componentId:r});case"cassandra":return g.jsx(zI,{componentId:r});case"clickhouse":return g.jsx(LI,{componentId:r});case"snowflake":return g.jsx(II,{componentId:r});case"s3-datalake":return g.jsx(OI,{componentId:r});case"nginx":return g.jsx(HI,{componentId:r});case"rest":return g.jsx(qI,{componentId:r});case"grpc":return g.jsx(UI,{componentId:r});case"websocket":return g.jsx($I,{componentId:r});case"graphql":return g.jsx(BI,{componentId:r});case"soap":return g.jsx(FI,{componentId:r});case"webhook":return g.jsx(QI,{componentId:r});case"docker":return g.jsx(VI,{componentId:r});case"kubernetes":return g.jsx(GI,{componentId:r});case"haproxy":return g.jsx(KI,{componentId:r});case"traefik":return g.jsx(YI,{componentId:r});case"envoy":return g.jsx(WI,{componentId:r});case"activemq":return g.jsx(XI,{componentId:r});case"aws-sqs":return g.jsx(JI,{componentId:r});case"azure-service-bus":return g.jsx(ZI,{componentId:r});case"gcp-pubsub":return g.jsx(eO,{componentId:r});case"kong":return g.jsx(tO,{componentId:r});case"apigee":return g.jsx(nO,{componentId:r});case"mulesoft":return g.jsx(sO,{componentId:r});case"graphql-gateway":return g.jsx(iO,{componentId:r});case"bff-service":return g.jsx(aO,{componentId:r});case"webhook-relay":return g.jsx(oO,{componentId:r});case"prometheus":return g.jsx(rO,{componentId:r});case"grafana":return g.jsx(cO,{componentId:r});case"loki":return g.jsx(lO,{componentId:r});case"jaeger":return g.jsx(uO,{componentId:r});case"otel-collector":return g.jsx(dO,{componentId:r});case"pagerduty":return g.jsx(fO,{componentId:r});case"keycloak":return g.jsx(hO,{componentId:r});case"waf":return g.jsx(pO,{componentId:r});case"firewall":return g.jsx(yO,{componentId:r});case"secrets-vault":return g.jsx(gO,{componentId:r});case"ids-ips":return g.jsx(mO,{componentId:r});case"jenkins":return g.jsx(vO,{componentId:r});case"gitlab-ci":return g.jsx(bO,{componentId:r});case"argo-cd":return g.jsx(xO,{componentId:r});case"terraform":return g.jsx(SO,{componentId:r});case"ansible":return g.jsx(MO,{componentId:r});case"harbor":return g.jsx(wO,{componentId:r});case"istio":return g.jsx(CO,{componentId:r});case"service-mesh":return g.jsx(EO,{componentId:r});case"api-gateway":return g.jsx(RO,{componentId:r});case"vpn":return g.jsx(kO,{componentId:r});case"cdn":return g.jsx(TO,{componentId:r});case"spark":return g.jsx(AO,{componentId:r});case"tensorflow-serving":return g.jsx(DO,{componentId:r});case"pytorch-serve":return g.jsx(_O,{componentId:r});case"feature-store":return g.jsx(NO,{componentId:r});case"mlflow":return g.jsx(jO,{componentId:r});case"crm":return g.jsx(PO,{componentId:r});case"erp":return g.jsx(zO,{componentId:r});case"rpa-bot":return g.jsx(LO,{componentId:r});case"bpmn-engine":return g.jsx(IO,{componentId:r});case"payment-gateway":return g.jsx(OO,{componentId:r});default:return g.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"Configuration panel not available for this component type"})}};return g.jsx(w.Suspense,{fallback:g.jsx(HO,{}),children:t()})}function UO(){const{undo:r,redo:e,zoom:t,setZoom:n,pan:s,setPan:a,resetCanvas:c,saveDiagram:l,selectedConnectionId:d,selectedNodeId:f,selectedGroupId:p,nodes:m,deleteConnection:y,deleteNode:b,deleteGroup:S,selectConnection:M,selectNode:E,selectGroup:C}=Ee(),{canUndo:T,canRedo:k}=Ar(),{isRunning:A,start:_,stop:N}=Nt(),{showMinimap:L,toggleMinimap:q,showHeatMapLegend:Z,toggleHeatMapLegend:se}=$r();w.useEffect(()=>{const ce=J=>{const te=J.ctrlKey||J.metaKey;if(te&&J.key==="z"&&!J.shiftKey&&T){J.preventDefault(),r();return}if(te&&(J.key==="z"&&J.shiftKey||J.key==="y")&&k){J.preventDefault(),e();return}if(te&&(J.key==="="||J.key==="+")){J.preventDefault(),n(Math.min(t+.1,2));return}if(te&&J.key==="-"){J.preventDefault(),n(Math.max(t-.1,.5));return}if(te&&J.key==="0"){J.preventDefault(),n(1),a({x:0,y:0});return}const le=50;if(!te){if(J.key==="ArrowLeft"){J.preventDefault(),a({x:s.x+le,y:s.y});return}if(J.key==="ArrowRight"){J.preventDefault(),a({x:s.x-le,y:s.y});return}if(J.key==="ArrowUp"){J.preventDefault(),a({x:s.x,y:s.y+le});return}if(J.key==="ArrowDown"){J.preventDefault(),a({x:s.x,y:s.y-le});return}}if(!te&&J.key===" "){const ue=J.target;if(!ue){if(J.preventDefault(),A)N();else{const{nodes:W,connections:he}=Ee.getState();Nt.getState().initialize(W,he),_()}return}const z=ue.tagName;if(z==="INPUT"||z==="TEXTAREA"||z==="SELECT"||ue.isContentEditable||ue.closest('input, textarea, select, [contenteditable="true"]'))return;const O=ue.getAttribute("role");if(O==="textbox"||O==="combobox"||O==="searchbox"||O==="spinbutton"||ue.closest("[data-radix-select-trigger], [data-radix-select-content], [data-radix-select-viewport]"))return;if(J.preventDefault(),A)N();else{const{nodes:W,connections:he}=Ee.getState();Nt.getState().initialize(W,he),_()}return}if(te&&(J.key==="s"||J.key==="")){J.preventDefault(),l();return}if(te&&(J.key==="m"||J.key==="")){J.preventDefault(),q();return}if(te&&(J.key==="h"||J.key==="")){J.preventDefault(),se();return}if((J.key==="Delete"||J.key==="Backspace")&&!te){const ue=document.activeElement;if(ue){const j=ue.tagName;if(j==="INPUT"||j==="TEXTAREA"||j==="SELECT"||ue.isContentEditable)return;const O=ue.getAttribute("role");if(O==="textbox"||O==="combobox"||O==="searchbox"||O==="spinbutton")return;const W=ue.closest("form")!==null,he=ue.closest('[role="textbox"], [role="combobox"], [contenteditable="true"]')!==null,P=ue.closest("[data-radix-select-trigger], [data-radix-select-content]")!==null,F=ue.closest('[role="dialog"]')!==null;if(W||he||P||F)return}if(J.preventDefault(),d){y(d),M(null);return}if(p){S(p),C(null);return}const z=m.filter(j=>j.selected);if(z.length>0){z.forEach(j=>b(j.id)),E(null);return}if(f){b(f),E(null);return}}};return window.addEventListener("keydown",ce),()=>{window.removeEventListener("keydown",ce)}},[r,e,T,k,t,n,s,a,c,l,A,_,N,L,q,Z,se,d,f,p,m,y,b,S,M,E,C])}class Cl extends w.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){ii("ErrorBoundary caught an error",e,{componentStack:t.componentStack}),this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:g.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:g.jsxs(wn,{className:"w-full max-w-2xl",children:[g.jsxs(Ms,{children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(as,{className:"h-5 w-5 text-destructive"}),g.jsx(Cs,{children:"-   "})]}),g.jsx(ga,{children:"    "})]}),g.jsxs(Es,{className:"space-y-4",children:[this.state.error&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("p",{className:"text-sm font-semibold text-foreground",children:":"}),g.jsx("pre",{className:"text-xs bg-muted p-3 rounded-md overflow-auto max-h-48",children:this.state.error.toString()})]}),!1,g.jsxs("div",{className:"flex gap-2",children:[g.jsxs(ke,{onClick:this.handleReset,variant:"default",children:[g.jsx(nD,{className:"h-4 w-4 mr-2"})," "]}),g.jsx(ke,{onClick:()=>window.location.reload(),variant:"outline",children:" "})]})]})]})}):this.props.children}}function $O(){UO();const{tabs:r}=Eu(),e=r.find(t=>t.active);return g.jsx(Cl,{children:g.jsx(Z5,{children:g.jsx(K5,{children:g.jsxs("div",{className:"h-screen flex flex-col bg-background",children:[g.jsx(eN,{}),g.jsx(F5,{}),g.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[g.jsx(Cl,{children:g.jsx(az,{})}),g.jsx(Cl,{children:e?.type==="diagram"?g.jsx(Qv,{}):e?.type==="component"&&e.componentId&&e.componentType?g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsx(qO,{componentId:e.componentId,componentType:e.componentType})}):g.jsx(Qv,{})}),g.jsx(Cl,{children:g.jsx(B5,{})})]})]})})})})}RE.createRoot(document.getElementById("root")).render(g.jsxs(kt.StrictMode,{children:[g.jsx(pR,{position:"top-right"}),g.jsx($O,{})]}));export{as as $,ya as A,ht as B,wn as C,gp as D,_e as E,rv as F,BO as G,gL as H,Tt as I,yL as J,Ur as K,st as L,DA as M,YA as N,Rb as O,Hl as P,Eb as Q,QA as R,xn as S,vp as T,gD as U,De as V,Tb as W,Nt as X,pa as Y,_b as Z,Xh as _,gu as a,GA as a0,nD as a1,Ux as a2,up as a3,Bx as a4,dp as a5,fp as a6,Fx as a7,pp as a8,hp as a9,kb as aa,os as ab,KM as ac,ma as ad,Bh as ae,Re as af,FO as ag,Fh as ah,TA as ai,sb as aj,kt as ak,Hh as al,an as am,ii as an,VO as ao,pA as ap,Ab as aq,ss as b,dD as c,ni as d,Ms as e,Cs as f,QO as g,ga as h,ke as i,g as j,Es as k,va as l,Zl as m,Nl as n,Dr as o,jl as p,_r as q,w as r,Qt as s,ha as t,Ee as u,ru as v,cu as w,uu as x,du as y,lu as z};
