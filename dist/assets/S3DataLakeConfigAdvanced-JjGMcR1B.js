import{u as me,j as e,r as S,a as je,e as ue,l as v,S as X,C as l,h as g,i as f,m as r,T as ge,b as fe,c as B,aD as Y,A as pe,f as T,k as L,P as M,B as d,o as K,L as i,I as n,x as E,q as _,s as G,t as P,v as F,w as N,d as ve}from"./index-DCOdhwlJ.js";import{R as Ne}from"./refresh-ccw-DhaFJxzK.js";import{K as ye}from"./key-BKfGeR4T.js";import{F as be}from"./folder-C8aIZo8k.js";function Ie({componentId:C}){const{nodes:q,updateNode:O}=me(),A=q.find(s=>s.id===C);if(!A)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const y=A.data.config||{},o=y.buckets||[],J=y.accessKeyId||"",$=y.secretAccessKey||"",V=y.defaultRegion||"us-east-1",x=y.lifecycleRules||[],[Ce,we]=S.useState(null),[Se,Ee]=S.useState(null),[Ae,Re]=S.useState(!1),[R,D]=S.useState(null),{isRunning:U,getComponentMetrics:Q}=je(),k=S.useMemo(()=>{if(U)return ue.getS3EmulationEngine(C)},[C,U]),b=Q(C)?.customMetrics||{},h=k?.getMetrics(),H=h?.totalBuckets??o.length,Z=h?.totalObjects??o.reduce((s,a)=>s+(a.objectCount||0),0),ee=h?.totalSize??o.reduce((s,a)=>s+(a.totalSize||0),0),se=h?.throughput??b.estimated_ops_per_sec??0,te=h?.storageUtilization??(b.storage_utilization?b.storage_utilization/100:0),ae=h?.operationsUtilization??(b.ops_utilization?b.ops_utilization/100:0),ce=h?.glacierObjects??b.glacier_objects??0;h?.lifecycleTransitions??b.lifecycle_transitions;const ie=()=>{O(C,{data:{...A.data,config:{...y,_lastRefresh:Date.now()}}})},m=s=>{O(C,{data:{...A.data,config:{...y,...s}}})},ne=()=>{const s={name:"new-bucket",region:V,versioning:!1,encryption:"AES256",lifecycleEnabled:!1,publicAccess:!1,objectCount:0,totalSize:0,folders:[]};m({buckets:[...o,s]})},le=s=>{m({buckets:o.filter((a,t)=>t!==s)})},j=(s,a,t)=>{const c=[...o];c[s]={...c[s],[a]:t},m({buckets:c})},re=()=>{const s={id:`rule-${Date.now()}`,name:"New Lifecycle Rule",status:"Enabled",transitions:[]};m({lifecycleRules:[...x,s]}),D(s.id)},de=s=>{m({lifecycleRules:x.filter(a=>a.id!==s)}),R===s&&D(null)},u=(s,a)=>{const t=x.map(c=>c.id===s?{...c,...a}:c);m({lifecycleRules:t})},oe=s=>{const a=x.find(c=>c.id===s);if(!a)return;const t={days:30,storageClass:"STANDARD_IA"};u(s,{transitions:[...a.transitions||[],t]})},xe=(s,a)=>{const t=x.find(w=>w.id===s);if(!t||!t.transitions)return;const c=t.transitions.filter((w,p)=>p!==a);u(s,{transitions:c})},W=(s,a,t)=>{const c=x.find(p=>p.id===s);if(!c||!c.transitions)return;const w=c.transitions.map((p,I)=>I===a?{...p,...t}:p);u(s,{transitions:w})},z=s=>{if(s===0)return"0 Bytes";const a=1024,t=["Bytes","KB","MB","GB","TB"],c=Math.floor(Math.log(s)/Math.log(a));return Math.round(s/Math.pow(a,c)*100)/100+" "+t[c]};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Amazon S3 Data Lake"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Object Storage"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Configure S3 buckets, lifecycle policies and data lake storage"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:ie,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(X,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(l,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(f,{className:"text-sm font-medium",children:"Total Objects"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Z.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Across ",H," ",H===1?"bucket":"buckets"]})]})]}),e.jsxs(l,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(f,{className:"text-sm font-medium",children:"Total Storage"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:z(ee)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(te*100),"% utilized"]})]})]}),e.jsxs(l,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(f,{className:"text-sm font-medium",children:"Throughput"})}),e.jsxs(r,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(se)," ops/s"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(ae*100),"% capacity"]})]})]}),e.jsxs(l,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(f,{className:"text-sm font-medium",children:"Archived Objects"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:ce.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"In Glacier/Deep Archive"})]})]})]}),e.jsxs(ge,{defaultValue:"buckets",className:"space-y-4",children:[e.jsxs(fe,{children:[e.jsxs(B,{value:"buckets",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Buckets (",o.length,")"]}),e.jsxs(B,{value:"lifecycle",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Lifecycle Rules (",x.length,")"]}),e.jsxs(B,{value:"credentials",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Credentials"]})]}),e.jsx(T,{value:"buckets",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(f,{children:"S3 Buckets"}),e.jsx(L,{children:"Configure and manage S3 buckets for data lake storage"})]}),e.jsxs(v,{onClick:ne,size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Create Bucket"]})]})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-4",children:o.map((s,a)=>e.jsxs(l,{className:"border-l-4 border-l-orange-500",children:[e.jsx(g,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx(f,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(d,{variant:"outline",children:s.region}),s.versioning&&e.jsx(d,{variant:"default",children:"Versioning"}),s.publicAccess&&e.jsx(d,{variant:"destructive",children:"Public"}),e.jsxs(d,{variant:"outline",children:[s.objectCount||0," objects"]})]})]})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>le(a),disabled:o.length===1,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(r,{className:"space-y-4",children:[(()=>{const t=h?.bucketMetrics.get(s.name),c=t?.objectCount??s.objectCount??0,w=t?.totalSize??s.totalSize??0,p=t?.putCount??0,I=t?.getCount??0,he=t?.averageLatency??0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Objects"}),e.jsx("p",{className:"text-lg font-semibold",children:c.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Size"}),e.jsx("p",{className:"text-lg font-semibold",children:z(w)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bucket URL"}),e.jsxs("p",{className:"text-xs font-mono text-muted-foreground truncate",children:["s3://",s.name]})]})]}),t&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"PUT ops"}),e.jsx("p",{className:"text-sm font-semibold",children:p.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"GET ops"}),e.jsx("p",{className:"text-sm font-semibold",children:I.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Latency"}),e.jsxs("p",{className:"text-sm font-semibold",children:[Math.round(he),"ms"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Errors"}),e.jsx("p",{className:"text-sm font-semibold",children:t.errorCount.toLocaleString()})]})]})]})})(),e.jsx(X,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Bucket Name"}),e.jsx(n,{value:s.name,onChange:t=>j(a,"name",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Region"}),e.jsx(n,{value:s.region,onChange:t=>j(a,"region",t.target.value),placeholder:"us-east-1"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Versioning"}),e.jsx(E,{checked:s.versioning||!1,onCheckedChange:t=>j(a,"versioning",t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Encryption"}),e.jsxs(_,{value:s.encryption||"AES256",onValueChange:t=>j(a,"encryption",t),children:[e.jsx(G,{children:e.jsx(P,{})}),e.jsxs(F,{children:[e.jsx(N,{value:"AES256",children:"AES256"}),e.jsx(N,{value:"aws:kms",children:"AWS KMS"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Public Access"}),e.jsx(E,{checked:s.publicAccess||!1,onCheckedChange:t=>j(a,"publicAccess",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Lifecycle Enabled"}),e.jsx(E,{checked:s.lifecycleEnabled||!1,onCheckedChange:t=>j(a,"lifecycleEnabled",t)})]}),s.lifecycleEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Lifecycle Transition Days"}),e.jsx(n,{type:"number",value:s.lifecycleDays||30,onChange:t=>j(a,"lifecycleDays",Number(t.target.value)),min:1})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Enable Glacier Archive"}),e.jsx(E,{checked:s.glacierEnabled||!1,onCheckedChange:t=>j(a,"glacierEnabled",t)})]}),s.glacierEnabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Glacier Transition Days"}),e.jsx(n,{type:"number",value:s.glacierDays||90,onChange:t=>j(a,"glacierDays",Number(t.target.value)),min:90})]})]})]}),s.folders&&s.folders.length>0&&e.jsxs("div",{children:[e.jsx(i,{className:"mb-2 block",children:"Folders"}),e.jsx("div",{className:"space-y-2",children:s.folders.map((t,c)=>e.jsx(l,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.path})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",children:[t.objectCount||0," objects"]}),e.jsx(d,{variant:"outline",children:z(t.size||0)})]})]})},c))})]})]})]},a))})})]})}),e.jsx(T,{value:"lifecycle",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Lifecycle Rules"}),e.jsx(L,{children:"Configure automatic transitions and expiration"})]}),e.jsxs(v,{onClick:re,size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Create Rule"]})]})}),e.jsx(r,{children:x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No lifecycle rules configured"}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsx(l,{className:"border-l-4 border-l-green-500",children:e.jsxs(r,{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(d,{variant:s.status==="Enabled"?"default":"outline",children:s.status}),R===s.id?e.jsx(n,{value:s.name,onChange:a=>u(s.id,{name:a.target.value}),className:"w-48"}):e.jsx("span",{className:"font-medium",children:s.name}),s.prefix&&e.jsxs(d,{variant:"outline",children:["Prefix: ",s.prefix]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>D(R===s.id?null:s.id),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>de(s.id),children:e.jsx(K,{className:"h-4 w-4"})})]})]}),R===s.id&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Rule Name"}),e.jsx(n,{value:s.name,onChange:a=>u(s.id,{name:a.target.value})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Status"}),e.jsxs(_,{value:s.status,onValueChange:a=>u(s.id,{status:a}),children:[e.jsx(G,{className:"w-32",children:e.jsx(P,{})}),e.jsxs(F,{children:[e.jsx(N,{value:"Enabled",children:"Enabled"}),e.jsx(N,{value:"Disabled",children:"Disabled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Prefix (optional)"}),e.jsx(n,{value:s.prefix||"",onChange:a=>u(s.id,{prefix:a.target.value||void 0}),placeholder:"logs/"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Apply rule to objects with keys starting with this prefix"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Transitions"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>oe(s.id),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Add Transition"]})]}),s.transitions&&s.transitions.length>0?e.jsx("div",{className:"space-y-2",children:s.transitions.map((a,t)=>e.jsxs("div",{className:"flex gap-2 items-center p-2 border rounded",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs",children:"Days"}),e.jsx(n,{type:"number",value:a.days,onChange:c=>W(s.id,t,{days:Number(c.target.value)}),min:1})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs",children:"Storage Class"}),e.jsxs(_,{value:a.storageClass,onValueChange:c=>W(s.id,t,{storageClass:c}),children:[e.jsx(G,{children:e.jsx(P,{})}),e.jsxs(F,{children:[e.jsx(N,{value:"STANDARD_IA",children:"STANDARD_IA"}),e.jsx(N,{value:"GLACIER",children:"GLACIER"}),e.jsx(N,{value:"DEEP_ARCHIVE",children:"DEEP_ARCHIVE"}),e.jsx(N,{value:"INTELLIGENT_TIERING",children:"INTELLIGENT_TIERING"})]})]})]})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>xe(s.id,t),children:e.jsx(K,{className:"h-4 w-4"})})]},t))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No transitions configured"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Expiration"}),e.jsx(E,{checked:!!s.expiration,onCheckedChange:a=>u(s.id,{expiration:a?{days:365}:void 0})})]}),s.expiration&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"text-xs",children:"Delete after"}),e.jsx(n,{type:"number",value:s.expiration.days,onChange:a=>u(s.id,{expiration:{days:Number(a.target.value)}}),min:1,className:"w-24"}),e.jsx(i,{className:"text-xs",children:"days"})]})]})]})]})},s.id))})})]})}),e.jsx(T,{value:"credentials",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"AWS Credentials"}),e.jsx(L,{children:"Configure AWS access credentials for S3"})]}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"accessKeyId",children:"Access Key ID"}),e.jsx(n,{id:"accessKeyId",value:J,onChange:s=>m({accessKeyId:s.target.value}),placeholder:"AKIAIOSFODNN7EXAMPLE"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"secretAccessKey",children:"Secret Access Key"}),e.jsx(n,{id:"secretAccessKey",type:"password",value:$,onChange:s=>m({secretAccessKey:s.target.value}),placeholder:"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"defaultRegion",children:"Default Region"}),e.jsx(n,{id:"defaultRegion",value:V,onChange:s=>m({defaultRegion:s.target.value}),placeholder:"us-east-1"})]}),e.jsx("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:[e.jsx("strong",{children:"Security Note:"})," In production, use IAM roles or environment variables instead of hardcoding credentials."]})})]})]})}),k&&e.jsx(T,{value:"lifecycle",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(g,{children:[e.jsx(f,{className:"text-sm font-medium",children:"Lifecycle Transitions"}),e.jsx(L,{children:"Recent storage class transitions"})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-2",children:[k.getLifecycleTransitionHistory().slice(-10).reverse().map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-xs p-2 rounded bg-secondary/50",children:[e.jsx("div",{children:e.jsxs("span",{className:"font-medium",children:[s.bucket,"/",s.key]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",children:s.fromClass}),e.jsx("span",{children:"â†’"}),e.jsx(d,{variant:"outline",children:s.toClass}),e.jsx("span",{className:"text-muted-foreground",children:new Date(s.timestamp).toLocaleTimeString()})]})]},a)),k.getLifecycleTransitionHistory().length===0&&e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4",children:"No lifecycle transitions yet"})]})})]})})]})]})})}export{Ie as S3DataLakeConfigAdvanced};
