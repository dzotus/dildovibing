import{u as Ms,a as ls,aO as Js,aP as Ws,j as e,r as v,a4 as we,B as H,S as Xs,T as Ys,b as Qs,c as te,aj as Zs,d as ea,f as le,C as E,h as V,i as F,k as G,l as m,P,I as d,m as R,ai as je,o as W,L as n,q as N,s as y,t as C,v as b,w as o,x as L,O as ne,Q as re,V as ce,W as ie,X as de,Y as oe,_ as he,$ as me}from"./index-Cd-JdYDo.js";import{T as Xe}from"./textarea-C1mJ7m6P.js";import{s as $,a as K}from"./toast-46NEDLjC.js";import{S as ns}from"./server-CcDBNlmT.js";import{R as Ye}from"./route-N9Y0URrn.js";import{U as sa}from"./users-tsDCdKQO.js";function aa(w){const{isSimulationRunning:ke,componentState:ee,metrics:A,dependencyStatus:B,hasConnections:xe=!1,customCheck:ve}=w;if(ve){const pe=ve(w);if(pe!==null)return pe}if(!ke)return"stopped";if(ee==="disabled"||ee==="failed")return ee==="failed"?"error":"stopped";if(ee==="degraded")return"degraded";if(B){if(B.health==="down"||B.health==="critical")return"error";if(B.health==="degraded")return"degraded"}if(!xe&&(!A||A.throughput===0&&A.errorRate===0))return"idle";if(A){if(A.errorRate>.5)return"error";if(A.errorRate>.1||A.latency&&A.latency>1e3)return"degraded";if(A.throughput>0||A.utilization>0||A.errorRate>0)return"running"}return xe?"running":"idle"}function ta(w){switch(w){case"running":return"default";case"stopped":return"outline";case"degraded":return"secondary";case"error":return"destructive";case"idle":return"outline";default:return"outline"}}function la(w){switch(w){case"running":return"bg-green-500";case"stopped":return"bg-gray-500";case"degraded":return"bg-yellow-500";case"error":return"bg-red-500";case"idle":return"bg-blue-500";default:return"bg-gray-500"}}function ha({componentId:w}){const{nodes:ke,updateNode:ee,connections:A}=Ms(),B=ke.find(s=>s.id===w),{isRunning:xe,getComponentMetrics:ve}=ls(),pe=Js(s=>s.getComponentState(w)),rs=Ws(s=>s.getComponentStatus(w)),cs=xe?ve(w):void 0,is=A.some(s=>s.source===w||s.target===w);if(!B)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const X=aa({isSimulationRunning:xe,componentState:pe?.state,metrics:cs,dependencyStatus:rs,hasConnections:is}),k=B.data.config||{},ds=k.adminUrl||"http://kong:8001",os=k.serviceName||"core-service",hs=k.upstreamUrl||"http://core:8080";k.routePaths,k.stripPath,k.authPlugin,k.rateLimitPerMinute,k.enableLogging,k.loggingTarget;const u=k.services||[],S=k.routes||[],_=k.upstreams||[],g=k.consumers||[],D=k.plugins||[];k.requestsPerSecond;const{updateKongRoutingEngine:Qe}=ls();v.useEffect(()=>{Qe(w)},[w,u,S,_,g,D,Qe]);const[ms,Se]=v.useState(!1),[xs,_e]=v.useState(!1),[us,Te]=v.useState(!1),[Pe,js]=v.useState(null),[Re,vs]=v.useState(null),[Ae,ps]=v.useState(null),[ge,fe]=v.useState(null),[Ue,gs]=v.useState(null),[I,Ne]=v.useState(null),[Y,He]=v.useState(null),[O,Ee]=v.useState(null),[se,Le]=v.useState(null),[q,De]=v.useState(null),[ue,Ie]=v.useState(null),[Ze,Oe]=v.useState(""),[es,$e]=v.useState(""),[ss,ze]=v.useState(""),[Ve,Fe]=v.useState(""),[ye,Ge]=v.useState("rate-limiting"),[Q,fs]=v.useState(""),[M,Ns]=v.useState(""),[ae,ys]=v.useState(""),[J,Cs]=v.useState(""),[z,bs]=v.useState(""),j=s=>{ee(w,{data:{...B.data,config:{...k,...s}}})},ws=()=>{j({services:[...u,{id:String(u.length+1),name:"new-service",protocol:"http",host:"service",port:8080,path:"/",connect_timeout:6e4,write_timeout:6e4,read_timeout:6e4,retries:5,enabled:!0,routes:[]}]})},ks=s=>{const a=u[s];if(a&&Ce(a.id||a.name).length>0){$("Cannot delete service with routes. Please remove routes first.");return}j({services:u.filter((l,r)=>r!==s)}),K(`Service "${a?.name||"Unknown"}" deleted successfully`)},Ss=s=>{ks(s),Ee(null)},U=(s,a,l)=>{const r=[...u];r[s]={...r[s],[a]:l},j({services:r})},_s=s=>S.filter(a=>a.service===s||a.service===u.find(l=>l.id===s)?.name).length,Ce=s=>{const a=u.find(l=>l.id===s);return a?S.filter(l=>l.service===s||l.service===a.name):[]},Ts=()=>{j({routes:[...S,{id:String(S.length+1),paths:["/new-path"],methods:["GET"],service:u[0]?.name||u[0]?.id||"",strip_path:!0,preserve_host:!1,request_buffering:!0,response_buffering:!0,protocols:["http","https"]}]})},Ps=s=>{const a=S[s];j({routes:S.filter((l,r)=>r!==s)}),K(`Route "${a?.name||a?.paths?.[0]||"Unknown"}" deleted successfully`)},Rs=s=>{Ps(s),Le(null)},f=(s,a,l)=>{const r=[...S];r[s]={...r[s],[a]:l},j({routes:r})},As=s=>{const l=[...S[s].hosts||[],""];f(s,"hosts",l)},Us=(s,a,l)=>{const c=[...S[s].hosts||[]];c[a]=l,f(s,"hosts",c.filter(t=>t.trim()))},Hs=(s,a)=>{const r=[...S[s].hosts||[]];r.splice(a,1),f(s,"hosts",r)},Es=()=>{const s=Ze.trim()||"new-upstream",a={id:String(_.length+1),name:s,algorithm:"round-robin",slots:1e4,hash_on:"none",hash_fallback:"none",healthchecks:{active:{type:"http",http_path:"/",timeout:1,concurrency:10,healthy:{interval:0,successes:1,http_statuses:[200,201,202,203,204,205,206,207,208,226,300,301,302,303,304,305,306,307,308],timeouts:0},unhealthy:{interval:0,timeouts:0,http_statuses:[429,500,501,502,503,504,505],tcp_failures:0,http_failures:0}},passive:{type:"http",healthy:{successes:1,http_statuses:[200,201,202,203,204,205,206,207,208,226,300,301,302,303,304,305,306,307,308],timeouts:0},unhealthy:{timeouts:0,http_statuses:[429,500,501,502,503,504,505],tcp_failures:0,http_failures:0}}},targets:[{target:"server:8080",weight:100,health:"healthy"}]};j({upstreams:[..._,a]}),Oe(""),Se(!1)},Ls=s=>{const a=_[s];if(u.filter(r=>r.upstream===a.name).length>0){$("Cannot delete upstream with associated services. Please remove services first.");return}j({upstreams:_.filter((r,c)=>c!==s)}),K(`Upstream "${a?.name||"Unknown"}" deleted successfully`)},Ds=s=>{Ls(s),De(null)},p=(s,a,l)=>{const r=[..._],c={...r[s]};if(a.includes(".")){const t=a.split(".");let i=c;for(let h=0;h<t.length-1;h++)i[t[h]]||(i[t[h]]={}),i=i[t[h]];i[t[t.length-1]]=l}else c[a]=l;r[s]=c,j({upstreams:r})},as=(s,a,l,r)=>{const c=[..._],t={...c[s]};t.targets||(t.targets=[]);const i=[...t.targets];i[a]={...i[a],[l]:r},t.targets=i,c[s]=t,j({upstreams:c})},Is=s=>{const a=[..._];a[s].targets||(a[s].targets=[]),a[s].targets=[...a[s].targets,{target:"server:8080",weight:100,health:"healthy"}],j({upstreams:a})},Os=(s,a)=>{const l=[..._];l[s].targets=l[s].targets?.filter((r,c)=>c!==a),j({upstreams:l})},$s=()=>{const s=es.trim();if(!s){$("Username is required");return}if(g.some(c=>c.username===s)){$("Consumer with this username already exists");return}const a=ss.trim()||void 0;if(a&&g.some(c=>(c.customId||c.custom_id)===a)){$("Consumer with this custom ID already exists");return}const l=Ve.trim()?Ve.split(",").map(c=>c.trim()).filter(c=>c.length>0):void 0,r={id:`consumer-${Date.now()}`,username:s,customId:a,custom_id:a,tags:l,credentials:[]};j({consumers:[...g,r]}),$e(""),ze(""),Fe(""),_e(!1),K(`Consumer "${s}" created successfully`)},zs=s=>{const a=g[s];if(a.credentials&&a.credentials.length>0){$("Cannot delete consumer with credentials. Please remove credentials first."),Ne(null);return}j({consumers:g.filter((l,r)=>r!==s)}),K(`Consumer "${a.username||a.id}" deleted successfully`),Ne(null)},Ke=(s,a,l)=>{const r=[...g];if(a==="username"&&l){const c=l.trim();if(!c){$("Username cannot be empty");return}if(g.some((t,i)=>i!==s&&t.username===c)){$("Consumer with this username already exists");return}r[s]={...r[s],[a]:c}}else if(a==="customId"||a==="custom_id"){const c=l.trim()||void 0;if(c&&g.some((t,i)=>i!==s&&(t.customId||t.custom_id)===c)){$("Consumer with this custom ID already exists");return}r[s]={...r[s],customId:c,custom_id:c}}else if(a==="tags")if(typeof l=="string"){const c=l.trim()?l.split(",").map(t=>t.trim()).filter(t=>t.length>0):void 0;r[s]={...r[s],tags:c}}else r[s]={...r[s],[a]:l};else r[s]={...r[s],[a]:l};j({consumers:r})},Z=(s,a)=>{const l=[...g];l[s].credentials||(l[s].credentials=[]);const r={id:`cred-${Date.now()}`,type:a,created_at:Date.now()};switch(a){case"key-auth":r.key=`key-${Date.now()}`;break;case"jwt":r.secret=`secret-${Date.now()}`,r.algorithm="HS256";break;case"basic-auth":r.username="",r.password="";break;case"hmac-auth":r.username="",r.secret="";break;case"oauth2":r.name="",r.client_id="",r.client_secret="";break;case"ldap-auth":r.ldap_host="",r.ldap_port=389,r.start_tls=!1;break;case"mtls-auth":r.certificate="";break}l[s].credentials=[...l[s].credentials,r],j({consumers:l}),K(`${a} credential added successfully`)},T=(s,a,l,r)=>{const c=[...g];if(!c[s].credentials)return;const t=c[s].credentials[a];t&&(c[s].credentials[a]={...t,[l]:r},j({consumers:c}))},Vs=(s,a)=>{const l=[...g],r=l[s].credentials?.[a];r&&(l[s].credentials=l[s].credentials?.filter((c,t)=>t!==a),j({consumers:l}),K(`${r.type} credential removed successfully`)),He(null)},Fs=(s,a)=>{Vs(s,a)},Gs=()=>{const s={"rate-limiting":{minute:1e3,hour:1e4},"key-auth":{key_names:["apikey"],hide_credentials:!1},jwt:{secret_is_base64:!1,run_on:"first"},cors:{origins:["*"],methods:["GET","POST","PUT","DELETE"],credentials:!1},"request-transformer":{http_method:null},"response-transformer":{},"ip-restriction":{whitelist:[],blacklist:[]},"file-log":{path:"/tmp/kong-access.log",reopen:!1},"http-log":{http_endpoint:"http://localhost:8080/logs",method:"POST",timeout:1e4}},a={id:String(D.length+1),name:ye,enabled:!0,config:s[ye]||{}};j({plugins:[...D,a]}),Te(!1),Ge("rate-limiting"),K(`Plugin "${ye}" created successfully`)},Ks=s=>{const a=D[s];j({plugins:D.filter((l,r)=>r!==s)}),K(`Plugin "${a?.name||"Unknown"}" deleted successfully`)},Bs=s=>{Ks(s),Ie(null)},ts=(s,a,l)=>{const r=[...D];r[s]={...r[s],[a]:l},j({plugins:r})},x=(s,a,l)=>{const r=[...D],c=r[s];c.config||(c.config={});const t=a.split(".");let i=c.config;for(let h=0;h<t.length-1;h++)i[t[h]]||(i[t[h]]={}),i=i[t[h]];i[t[t.length-1]]=l,j({plugins:r})},Be=u.filter(s=>!Q||s.name?.toLowerCase().includes(Q.toLowerCase())||s.host?.toLowerCase().includes(Q.toLowerCase())),qe=S.filter(s=>!M||s.name?.toLowerCase().includes(M.toLowerCase())||s.paths?.some(a=>a.toLowerCase().includes(M.toLowerCase()))||s.service?.toLowerCase().includes(M.toLowerCase())),Me=_.filter(s=>!ae||s.name?.toLowerCase().includes(ae.toLowerCase())),Je=g.filter(s=>!J||s.username?.toLowerCase().includes(J.toLowerCase())||s.customId?.toLowerCase().includes(J.toLowerCase())||s.custom_id?.toLowerCase().includes(J.toLowerCase())),We=D.filter(s=>!z||s.name?.toLowerCase().includes(z.toLowerCase())||s.service?.toLowerCase().includes(z.toLowerCase())||s.route?.toLowerCase().includes(z.toLowerCase())||s.consumer?.toLowerCase().includes(z.toLowerCase()));return e.jsxs("div",{className:"h-full overflow-y-auto bg-background",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(we,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Kong API Gateway"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Service Mesh & API Gateway"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(H,{variant:ta(X),className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${la(X)} ${X==="running"?"animate-pulse":""}`}),X==="running"?"Running":X==="stopped"?"Stopped":X==="degraded"?"Degraded":X==="error"?"Error":"Idle"]})})]}),e.jsx(Xs,{}),e.jsxs(Ys,{defaultValue:"services",className:"w-full",children:[e.jsxs(Qs,{className:"flex flex-wrap w-full gap-1",children:[e.jsxs(te,{value:"services",className:"gap-2 flex-shrink-0",children:[e.jsx(we,{className:"h-4 w-4"}),"Services"]}),e.jsxs(te,{value:"upstreams",className:"gap-2 flex-shrink-0",children:[e.jsx(ns,{className:"h-4 w-4"}),"Upstreams"]}),e.jsxs(te,{value:"routes",className:"gap-2 flex-shrink-0",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Routes"]}),e.jsxs(te,{value:"consumers",className:"gap-2 flex-shrink-0",children:[e.jsx(sa,{className:"h-4 w-4"}),"Consumers"]}),e.jsxs(te,{value:"plugins",className:"gap-2 flex-shrink-0",children:[e.jsx(Zs,{className:"h-4 w-4"}),"Plugins"]}),e.jsxs(te,{value:"settings",className:"gap-2 flex-shrink-0",children:[e.jsx(ea,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(le,{value:"services",className:"space-y-4 mt-4",children:e.jsxs(E,{children:[e.jsxs(V,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Services"}),e.jsx(G,{children:"Upstream services managed by Kong"})]}),e.jsxs(m,{size:"sm",onClick:ws,variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Service"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(d,{placeholder:"Search services...",value:Q,onChange:s=>fs(s.target.value),className:"max-w-sm"})})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[Be.length===0&&Q&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:['No services found matching "',Q,'"']}),Be.length===0&&!Q&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No services configured"}),Be.map(s=>{const a=u.findIndex(t=>t.id===s.id&&t.name===s.name),l=s.url||(s.protocol&&s.host&&s.port?`${s.protocol}://${s.host}:${s.port}${s.path||""}`:"Not configured"),r=_s(s.id),c=Ce(s.id);return e.jsxs(E,{className:"border-border",children:[e.jsx(V,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(we,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"flex-1 min-w-0",children:ge===a?e.jsx(d,{value:s.name,onChange:t=>U(a,"name",t.target.value),onBlur:()=>fe(null),onKeyDown:t=>{t.key==="Enter"&&fe(null)},className:"font-semibold text-lg",autoFocus:!0}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"text-lg cursor-pointer hover:text-primary transition-colors truncate",onClick:()=>fe(a),title:s.name,children:s.name}),e.jsxs(G,{className:"text-xs mt-1 truncate",title:l,children:[l," • ",r," route",r!==1?"s":"",s.upstream&&` • Upstream: ${s.upstream}`]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.enabled!==!1?e.jsx(H,{variant:"default",className:"bg-green-500",children:"Enabled"}):e.jsx(H,{variant:"secondary",children:"Disabled"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>fe(ge===a?null:a),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),ge===a?"Hide":"Edit"]}),u.length>1&&e.jsx(m,{size:"icon",variant:"ghost",onClick:()=>Ee(a),children:e.jsx(W,{className:"h-4 w-4"})})]})]})}),ge===a&&e.jsxs(R,{className:"space-y-4 pt-3 border-t",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Service Name"}),e.jsx(d,{value:s.name,onChange:t=>U(a,"name",t.target.value),placeholder:"my-service"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Protocol"}),e.jsxs(N,{value:s.protocol||"http",onValueChange:t=>U(a,"protocol",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"http",children:"HTTP"}),e.jsx(o,{value:"https",children:"HTTPS"}),e.jsx(o,{value:"grpc",children:"gRPC"}),e.jsx(o,{value:"grpcs",children:"gRPCS"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Host"}),e.jsx(d,{value:s.host||"",onChange:t=>U(a,"host",t.target.value),placeholder:"example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Port"}),e.jsx(d,{type:"number",value:s.port||"",onChange:t=>U(a,"port",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"8080",min:"1",max:"65535"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Path"}),e.jsx(d,{value:s.path||"",onChange:t=>U(a,"path",t.target.value),placeholder:"/api"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Upstream"}),e.jsxs(N,{value:s.upstream||"__none__",onValueChange:t=>U(a,"upstream",t==="__none__"?void 0:t),children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Select upstream"})}),e.jsxs(b,{children:[e.jsx(o,{value:"__none__",children:"None"}),_.map(t=>{const i=t.name||`upstream-${_.indexOf(t)}`;return e.jsx(o,{value:i,children:t.name||"Unnamed Upstream"},i)})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Connect Timeout (ms)"}),e.jsx(d,{type:"number",value:s.connect_timeout||"",onChange:t=>U(a,"connect_timeout",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"60000",min:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Write Timeout (ms)"}),e.jsx(d,{type:"number",value:s.write_timeout||"",onChange:t=>U(a,"write_timeout",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"60000",min:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Read Timeout (ms)"}),e.jsx(d,{type:"number",value:s.read_timeout||"",onChange:t=>U(a,"read_timeout",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"60000",min:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Retries"}),e.jsx(d,{type:"number",value:s.retries||"",onChange:t=>U(a,"retries",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"5",min:"0"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(n,{children:"Enabled"}),e.jsx(L,{checked:s.enabled!==!1,onCheckedChange:t=>U(a,"enabled",t)})]}),c.length>0&&e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs(n,{children:["Associated Routes (",c.length,")"]}),e.jsx("div",{className:"space-y-1",children:c.map((t,i)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/50 rounded text-sm",children:[e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{className:"font-mono",children:t.path||t.paths?.[0]||"/"}),e.jsx(H,{variant:"outline",className:"text-xs",children:t.method||t.methods?.[0]||"GET"})]},i))})]})]})]},a)})]})})]})}),e.jsx(le,{value:"routes",className:"space-y-4 mt-4",children:e.jsxs(E,{children:[e.jsxs(V,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Routes"}),e.jsx(G,{children:"API route configuration"})]}),e.jsxs(m,{size:"sm",onClick:Ts,variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Route"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(d,{placeholder:"Search routes...",value:M,onChange:s=>Ns(s.target.value),className:"max-w-sm"})})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[qe.length===0&&M&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:['No routes found matching "',M,'"']}),qe.length===0&&!M&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No routes configured"}),qe.map(s=>{const a=S.findIndex(t=>t.id===s.id||t.name===s.name&&t.service===s.service),l=s.path||s.paths?.[0]||"/",r=s.method||s.methods?.[0]||"GET",c=u.find(t=>t.id===s.service||t.name===s.service)?.name||s.service;return e.jsxs(E,{className:"border-border",children:[e.jsx(V,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10 flex-shrink-0",children:e.jsx(Ye,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(F,{className:"text-lg truncate",title:s.name||l,children:s.name||l}),e.jsxs(G,{className:"text-xs mt-1 truncate",children:[r," → ",c,s.hosts&&s.hosts.length>0&&` • Hosts: ${s.hosts.join(", ")}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>gs(Ue===a?null:a),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),Ue===a?"Hide":"Edit"]}),S.length>1&&e.jsx(m,{size:"icon",variant:"ghost",onClick:()=>Le(a),children:e.jsx(W,{className:"h-4 w-4"})})]})]})}),Ue===a&&e.jsxs(R,{className:"space-y-4 pt-3 border-t",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Route Name"}),e.jsx(d,{value:s.name||"",onChange:t=>f(a,"name",t.target.value||void 0),placeholder:"my-route"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Service"}),e.jsxs(N,{value:s.service||void 0,onValueChange:t=>f(a,"service",t),children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Select service"})}),e.jsx(b,{children:u.map(t=>{const i=t.id||t.name||`service-${u.indexOf(t)}`;return e.jsx(o,{value:i,children:t.name||"Unnamed Service"},i)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Paths (comma-separated)"}),e.jsx(d,{value:s.paths?.join(", ")||s.path||"",onChange:t=>{const i=t.target.value.split(",").map(h=>h.trim()).filter(h=>h);f(a,"paths",i.length>0?i:void 0),i.length===0&&f(a,"path",t.target.value)},placeholder:"/api, /v1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Methods"}),e.jsxs(N,{value:s.methods?.join(",")||s.method||"GET",onValueChange:t=>{const i=t.split(",").map(h=>h.trim()).filter(h=>h);f(a,"methods",i.length>0?i:void 0),i.length===1&&f(a,"method",i[0])},children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"GET",children:"GET"}),e.jsx(o,{value:"POST",children:"POST"}),e.jsx(o,{value:"PUT",children:"PUT"}),e.jsx(o,{value:"PATCH",children:"PATCH"}),e.jsx(o,{value:"DELETE",children:"DELETE"}),e.jsx(o,{value:"HEAD",children:"HEAD"}),e.jsx(o,{value:"OPTIONS",children:"OPTIONS"}),e.jsx(o,{value:"GET,POST,PUT,PATCH,DELETE",children:"All Methods"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Protocols"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["http","https","grpc","grpcs"].map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`route-${a}-proto-${t}`,checked:s.protocols?.includes(t)||!1,onChange:i=>{const h=s.protocols||[],be=i.target.checked?[...h,t]:h.filter(qs=>qs!==t);f(a,"protocols",be.length>0?be:void 0)},className:"rounded"}),e.jsx(n,{htmlFor:`route-${a}-proto-${t}`,className:"text-sm font-normal cursor-pointer",children:t.toUpperCase()})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Regex Priority"}),e.jsx(d,{type:"number",value:s.regex_priority||s.priority||"",onChange:t=>{const i=t.target.value?parseInt(t.target.value,10):void 0;f(a,"regex_priority",i),f(a,"priority",i)},placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Path Handling"}),e.jsxs(N,{value:s.path_handling||"v0",onValueChange:t=>f(a,"path_handling",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"v0",children:"v0 (Legacy)"}),e.jsx(o,{value:"v1",children:"v1 (Modern)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HTTPS Redirect Status Code"}),e.jsxs(N,{value:String(s.https_redirect_status_code||426),onValueChange:t=>f(a,"https_redirect_status_code",parseInt(t,10)),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"426",children:"426 (Upgrade Required)"}),e.jsx(o,{value:"301",children:"301 (Moved Permanently)"}),e.jsx(o,{value:"302",children:"302 (Found)"}),e.jsx(o,{value:"307",children:"307 (Temporary Redirect)"}),e.jsx(o,{value:"308",children:"308 (Permanent Redirect)"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Hosts"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>As(a),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Host"]})]}),e.jsxs("div",{className:"space-y-2",children:[s.hosts?.map((t,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{value:t,onChange:h=>Us(a,i,h.target.value),placeholder:"example.com"}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>Hs(a,i),children:e.jsx(W,{className:"h-3 w-3"})})]},i)),(!s.hosts||s.hosts.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hosts configured"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Preserve Host"}),e.jsx(L,{checked:s.preserve_host??!1,onCheckedChange:t=>f(a,"preserve_host",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Strip Path"}),e.jsx(L,{checked:s.strip_path??s.stripPath??!0,onCheckedChange:t=>{f(a,"strip_path",t),f(a,"stripPath",t)}})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Request Buffering"}),e.jsx(L,{checked:s.request_buffering??!0,onCheckedChange:t=>f(a,"request_buffering",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Response Buffering"}),e.jsx(L,{checked:s.response_buffering??!0,onCheckedChange:t=>f(a,"response_buffering",t)})]})]})]})]},a)})]})})]})}),e.jsx(le,{value:"upstreams",className:"space-y-4 mt-4",children:e.jsxs(E,{children:[e.jsxs(V,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Upstreams"}),e.jsx(G,{children:"Load balancing upstream targets"})]}),e.jsxs(m,{size:"sm",onClick:()=>Se(!0),variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Upstream"]})]}),e.jsx(R,{className:"border-b pb-4",children:e.jsx(d,{placeholder:"Search upstreams...",value:ae,onChange:s=>ys(s.target.value),className:"max-w-sm"})}),ms&&e.jsx(R,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Upstream Name"}),e.jsx(d,{placeholder:"backend-upstream",value:Ze,onChange:s=>Oe(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{onClick:Es,children:"Create Upstream"}),e.jsx(m,{variant:"outline",onClick:()=>{Se(!1),Oe("")},children:"Cancel"})]})]})}),e.jsxs(R,{className:"space-y-4",children:[Me.length===0&&ae&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:['No upstreams found matching "',ae,'"']}),Me.length===0&&!ae&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No upstreams configured"}),Me.map(s=>{const a=_.findIndex(t=>t.name===s.name),l=u.filter(t=>t.upstream===s.name),r=s.targets?.filter(t=>t.health==="healthy"||!t.health).length||0,c=s.targets?.length||0;return e.jsxs(E,{className:"border-border",children:[e.jsx(V,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10 flex-shrink-0",children:e.jsx(ns,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(F,{className:"text-lg truncate",title:s.name,children:s.name}),e.jsxs(G,{className:"text-xs mt-1",children:[c," target(s) • ",r," healthy • Algorithm: ",s.algorithm||"round-robin",l.length>0&&` • ${l.length} service(s)`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>js(Pe===a?null:a),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),Pe===a?"Hide":"Edit"]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>De(a),children:e.jsx(W,{className:"h-4 w-4"})})]})]})}),Pe===a&&e.jsxs("div",{className:"space-y-4 pt-3 border-t",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Upstream Name"}),e.jsx(d,{value:s.name,onChange:t=>p(a,"name",t.target.value),placeholder:"backend-upstream"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Algorithm"}),e.jsxs(N,{value:s.algorithm||"round-robin",onValueChange:t=>p(a,"algorithm",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"round-robin",children:"Round Robin"}),e.jsx(o,{value:"consistent-hashing",children:"Consistent Hashing"}),e.jsx(o,{value:"least-connections",children:"Least Connections"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Slots"}),e.jsx(d,{type:"number",value:s.slots||"",onChange:t=>p(a,"slots",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"10000",min:"1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of slots for consistent hashing"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hash On"}),e.jsxs(N,{value:s.hash_on||"none",onValueChange:t=>p(a,"hash_on",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"none",children:"None"}),e.jsx(o,{value:"header",children:"Header"}),e.jsx(o,{value:"cookie",children:"Cookie"}),e.jsx(o,{value:"consumer",children:"Consumer"}),e.jsx(o,{value:"ip",children:"IP"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hash Fallback"}),e.jsxs(N,{value:s.hash_fallback||"none",onValueChange:t=>p(a,"hash_fallback",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"none",children:"None"}),e.jsx(o,{value:"header",children:"Header"}),e.jsx(o,{value:"cookie",children:"Cookie"}),e.jsx(o,{value:"consumer",children:"Consumer"}),e.jsx(o,{value:"ip",children:"IP"})]})]})]}),s.hash_on==="header"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hash On Header"}),e.jsx(d,{value:s.hash_on_header||"",onChange:t=>p(a,"hash_on_header",t.target.value||void 0),placeholder:"X-Forwarded-For"})]}),s.hash_fallback==="header"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hash Fallback Header"}),e.jsx(d,{value:s.hash_fallback_header||"",onChange:t=>p(a,"hash_fallback_header",t.target.value||void 0),placeholder:"X-Forwarded-For"})]}),s.hash_on==="cookie"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hash On Cookie"}),e.jsx(d,{value:s.hash_on_cookie||"",onChange:t=>p(a,"hash_on_cookie",t.target.value||void 0),placeholder:"sessionid"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hash On Cookie Path"}),e.jsx(d,{value:s.hash_on_cookie_path||"",onChange:t=>p(a,"hash_on_cookie_path",t.target.value||void 0),placeholder:"/"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(n,{className:"text-base font-semibold",children:"Health Checks"})}),e.jsxs("div",{className:"space-y-3 p-4 border rounded bg-muted/30",children:[e.jsx(n,{className:"text-sm font-semibold",children:"Active Health Checks"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Type"}),e.jsxs(N,{value:s.healthchecks?.active?.type||"http",onValueChange:t=>p(a,"healthchecks.active.type",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"http",children:"HTTP"}),e.jsx(o,{value:"https",children:"HTTPS"}),e.jsx(o,{value:"tcp",children:"TCP"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HTTP Path"}),e.jsx(d,{value:s.healthchecks?.active?.http_path||"",onChange:t=>p(a,"healthchecks.active.http_path",t.target.value||void 0),placeholder:"/"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Timeout (seconds)"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.timeout||"",onChange:t=>p(a,"healthchecks.active.timeout",t.target.value?parseFloat(t.target.value):void 0),placeholder:"1",min:"0",step:"0.1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Concurrency"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.concurrency||"",onChange:t=>p(a,"healthchecks.active.concurrency",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"10",min:"1"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsx(n,{className:"text-sm",children:"Healthy Thresholds"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Interval (seconds)"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.healthy?.interval||"",onChange:t=>p(a,"healthchecks.active.healthy.interval",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Successes"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.healthy?.successes||"",onChange:t=>p(a,"healthchecks.active.healthy.successes",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"1",min:"0"})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsx(n,{className:"text-sm",children:"Unhealthy Thresholds"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Interval (seconds)"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.unhealthy?.interval||"",onChange:t=>p(a,"healthchecks.active.unhealthy.interval",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Timeouts"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.unhealthy?.timeouts||"",onChange:t=>p(a,"healthchecks.active.unhealthy.timeouts",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"TCP Failures"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.unhealthy?.tcp_failures||"",onChange:t=>p(a,"healthchecks.active.unhealthy.tcp_failures",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HTTP Failures"}),e.jsx(d,{type:"number",value:s.healthchecks?.active?.unhealthy?.http_failures||"",onChange:t=>p(a,"healthchecks.active.unhealthy.http_failures",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded bg-muted/30",children:[e.jsx(n,{className:"text-sm font-semibold",children:"Passive Health Checks"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Type"}),e.jsxs(N,{value:s.healthchecks?.passive?.type||"http",onValueChange:t=>p(a,"healthchecks.passive.type",t),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"http",children:"HTTP"}),e.jsx(o,{value:"https",children:"HTTPS"}),e.jsx(o,{value:"tcp",children:"TCP"})]})]})]})}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsx(n,{className:"text-sm",children:"Healthy Thresholds"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Successes"}),e.jsx(d,{type:"number",value:s.healthchecks?.passive?.healthy?.successes||"",onChange:t=>p(a,"healthchecks.passive.healthy.successes",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"1",min:"0"})]})})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsx(n,{className:"text-sm",children:"Unhealthy Thresholds"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Timeouts"}),e.jsx(d,{type:"number",value:s.healthchecks?.passive?.unhealthy?.timeouts||"",onChange:t=>p(a,"healthchecks.passive.unhealthy.timeouts",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"TCP Failures"}),e.jsx(d,{type:"number",value:s.healthchecks?.passive?.unhealthy?.tcp_failures||"",onChange:t=>p(a,"healthchecks.passive.unhealthy.tcp_failures",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HTTP Failures"}),e.jsx(d,{type:"number",value:s.healthchecks?.passive?.unhealthy?.http_failures||"",onChange:t=>p(a,"healthchecks.passive.unhealthy.http_failures",t.target.value?parseInt(t.target.value,10):void 0),placeholder:"0",min:"0"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Targets"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Is(a),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Target"]})]}),e.jsxs("div",{className:"space-y-2",children:[s.targets?.map((t,i)=>e.jsx(E,{className:"border",children:e.jsxs(R,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1",children:e.jsx(H,{variant:t.health==="healthy"?"default":t.health==="draining"?"secondary":"destructive",children:t.health||"healthy"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>Os(a,i),children:e.jsx(W,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Target (host:port)"}),e.jsx(d,{value:t.target,onChange:h=>as(a,i,"target",h.target.value),placeholder:"server:8080"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Weight"}),e.jsx(d,{type:"number",value:t.weight||"",onChange:h=>as(a,i,"weight",h.target.value?parseInt(h.target.value,10):void 0),placeholder:"100",min:"0"})]})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((h,be)=>e.jsx(H,{variant:"outline",children:h},be))})]})]})},i)),(!s.targets||s.targets.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No targets configured"})]})]}),l.length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsxs(n,{children:["Associated Services (",l.length,")"]}),e.jsx("div",{className:"space-y-1",children:l.map((t,i)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/50 rounded text-sm",children:[e.jsx(we,{className:"h-3 w-3"}),e.jsx("span",{className:"font-mono",children:t.name}),e.jsxs(H,{variant:"outline",className:"text-xs",children:[t.protocol||"http","://",t.host||"localhost",":",t.port||80]})]},i))})]})]})]},a)})]})]})}),e.jsx(le,{value:"consumers",className:"space-y-4 mt-4",children:e.jsxs(E,{children:[e.jsxs(V,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Consumers"}),e.jsx(G,{children:"API consumers and authentication credentials"})]}),e.jsxs(m,{size:"sm",onClick:()=>_e(!0),variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Consumer"]})]}),xs&&e.jsx(R,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username *"}),e.jsx(d,{placeholder:"new-consumer",value:es,onChange:s=>$e(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Custom ID"}),e.jsx(d,{placeholder:"custom-id",value:ss,onChange:s=>ze(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Tags (comma-separated)"}),e.jsx(d,{placeholder:"tag1, tag2, tag3",value:Ve,onChange:s=>Fe(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{onClick:$s,children:"Create Consumer"}),e.jsx(m,{variant:"outline",onClick:()=>{_e(!1),$e(""),ze(""),Fe("")},children:"Cancel"})]})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx(d,{placeholder:"Search consumers...",value:J,onChange:s=>Cs(s.target.value),className:"max-w-sm"})}),Je.length===0&&J&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:['No consumers found matching "',J,'"']}),Je.length===0&&!J&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No consumers configured"}),Je.map(s=>{const a=g.findIndex(c=>c.id===s.id||c.username===s.username&&c.customId===s.customId),l=s.credentials?.map(c=>c.type)||[],r=[...new Set(l)];return e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:s.username||s.id}),(s.customId||s.custom_id)&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Custom ID: ",s.customId||s.custom_id]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.tags.map((c,t)=>e.jsx(H,{variant:"outline",className:"text-xs",children:c},t))}),s.credentials&&s.credentials.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.credentials.length," credential(s):"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.map((c,t)=>{const i=l.filter(h=>h===c).length;return e.jsxs(H,{variant:"secondary",className:"text-xs",children:[c," ",i>1?`(${i})`:""]},t)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>vs(Re===a?null:a),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),Re===a?"Hide":"Edit"]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>Ne(a),children:e.jsx(W,{className:"h-4 w-4"})})]})]}),Re===a&&e.jsxs("div",{className:"space-y-4 pt-3 border-t",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username *"}),e.jsx(d,{value:s.username||"",onChange:c=>Ke(a,"username",c.target.value),placeholder:"consumer-username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Custom ID"}),e.jsx(d,{value:s.customId||s.custom_id||"",onChange:c=>Ke(a,"customId",c.target.value),placeholder:"custom-id"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Tags (comma-separated)"}),e.jsx(d,{value:s.tags?.join(", ")||"",onChange:c=>Ke(a,"tags",c.target.value),placeholder:"tag1, tag2, tag3"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Credentials"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"key-auth"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Key Auth"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"jwt"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"JWT"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"oauth2"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"OAuth2"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"basic-auth"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Basic Auth"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"hmac-auth"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"HMAC Auth"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"ldap-auth"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"LDAP Auth"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Z(a,"mtls-auth"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"mTLS Auth"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[s.credentials?.map((c,t)=>e.jsx(E,{className:"border",children:e.jsxs(R,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{children:c.type}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>He({consumerIndex:a,credIndex:t}),children:e.jsx(W,{className:"h-3 w-3"})})]}),c.type==="key-auth"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Key"}),e.jsx(d,{className:"font-mono text-xs",value:c.key||"",onChange:i=>T(a,t,"key",i.target.value),placeholder:"api-key"})]})}),c.type==="jwt"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Secret"}),e.jsx(d,{className:"font-mono text-xs",type:"password",value:c.secret||"",onChange:i=>T(a,t,"secret",i.target.value),placeholder:"jwt-secret"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Algorithm"}),e.jsxs(N,{value:c.algorithm||"HS256",onValueChange:i=>T(a,t,"algorithm",i),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"HS256",children:"HS256"}),e.jsx(o,{value:"HS384",children:"HS384"}),e.jsx(o,{value:"HS512",children:"HS512"}),e.jsx(o,{value:"RS256",children:"RS256"}),e.jsx(o,{value:"RS384",children:"RS384"}),e.jsx(o,{value:"RS512",children:"RS512"}),e.jsx(o,{value:"ES256",children:"ES256"}),e.jsx(o,{value:"ES384",children:"ES384"}),e.jsx(o,{value:"ES512",children:"ES512"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"RSA Public Key"}),e.jsx(Xe,{className:"font-mono text-xs",value:c.rsa_public_key||c.rsaPublicKey||"",onChange:i=>T(a,t,"rsa_public_key",i.target.value),placeholder:"-----BEGIN PUBLIC KEY-----...",rows:3})]})]}),c.type==="oauth2"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Name"}),e.jsx(d,{className:"text-xs",value:c.name||"",onChange:i=>T(a,t,"name",i.target.value),placeholder:"oauth2-app-name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Client ID"}),e.jsx(d,{className:"font-mono text-xs",value:c.client_id||"",onChange:i=>T(a,t,"client_id",i.target.value),placeholder:"client-id"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Client Secret"}),e.jsx(d,{className:"font-mono text-xs",type:"password",value:c.client_secret||"",onChange:i=>T(a,t,"client_secret",i.target.value),placeholder:"client-secret"})]})]}),c.type==="basic-auth"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Username"}),e.jsx(d,{className:"text-xs",value:c.username||"",onChange:i=>T(a,t,"username",i.target.value),placeholder:"username"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Password"}),e.jsx(d,{className:"font-mono text-xs",type:"password",value:c.password||"",onChange:i=>T(a,t,"password",i.target.value),placeholder:"password"})]})]}),c.type==="hmac-auth"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Username"}),e.jsx(d,{className:"text-xs",value:c.username||"",onChange:i=>T(a,t,"username",i.target.value),placeholder:"username"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Secret"}),e.jsx(d,{className:"font-mono text-xs",type:"password",value:c.secret||"",onChange:i=>T(a,t,"secret",i.target.value),placeholder:"hmac-secret"})]})]}),c.type==="ldap-auth"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"LDAP Host"}),e.jsx(d,{className:"text-xs",value:c.ldap_host||"",onChange:i=>T(a,t,"ldap_host",i.target.value),placeholder:"ldap.example.com"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"LDAP Port"}),e.jsx(d,{className:"text-xs",type:"number",value:c.ldap_port||"",onChange:i=>T(a,t,"ldap_port",i.target.value?parseInt(i.target.value,10):389),placeholder:"389"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:c.start_tls||!1,onCheckedChange:i=>T(a,t,"start_tls",i)}),e.jsx(n,{className:"text-xs",children:"Start TLS"})]})]}),c.type==="mtls-auth"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Certificate"}),e.jsx(Xe,{className:"font-mono text-xs",value:c.certificate||"",onChange:i=>T(a,t,"certificate",i.target.value),placeholder:"-----BEGIN CERTIFICATE-----...",rows:4})]})})]})},t)),(!s.credentials||s.credentials.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No credentials configured"})]})]})]})]},a)})]})]})}),e.jsx(le,{value:"plugins",className:"space-y-4 mt-4",children:e.jsxs(E,{children:[e.jsxs(V,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Plugins"}),e.jsx(G,{children:"Configure plugins for services, routes, and consumers"})]}),e.jsxs(m,{size:"sm",onClick:()=>Te(!0),variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Plugin"]})]}),us&&e.jsx(R,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Plugin Name"}),e.jsxs(N,{value:ye,onValueChange:Ge,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"rate-limiting",children:"Rate Limiting"}),e.jsx(o,{value:"key-auth",children:"Key Auth"}),e.jsx(o,{value:"jwt",children:"JWT"}),e.jsx(o,{value:"cors",children:"CORS"}),e.jsx(o,{value:"request-transformer",children:"Request Transformer"}),e.jsx(o,{value:"response-transformer",children:"Response Transformer"}),e.jsx(o,{value:"ip-restriction",children:"IP Restriction"}),e.jsx(o,{value:"file-log",children:"File Log"}),e.jsx(o,{value:"http-log",children:"HTTP Log"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{onClick:Gs,children:"Add Plugin"}),e.jsx(m,{variant:"outline",onClick:()=>{Te(!1),Ge("rate-limiting")},children:"Cancel"})]})]})}),e.jsxs(R,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(d,{placeholder:"Search plugins...",value:z,onChange:s=>bs(s.target.value),className:"max-w-sm"})}),e.jsxs("div",{className:"space-y-3",children:[We.length===0&&z&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:['No plugins found matching "',z,'"']}),We.length===0&&!z&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No plugins configured"}),We.map(s=>{const a=D.findIndex(l=>l.id===s.id||l.name===s.name&&l.service===s.service&&l.route===s.route);return e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.service&&`Service: ${s.service}`,s.route&&`Route: ${s.route}`,s.consumer&&`Consumer: ${s.consumer}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:s.service?"default":s.route?"secondary":s.consumer?"outline":"secondary",children:s.service?"Service":s.route?"Route":s.consumer?"Consumer":"Global"}),e.jsx(L,{checked:s.enabled,onCheckedChange:l=>ts(a,"enabled",l)}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>Ie(a),children:e.jsx(W,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>ps(Ae===a?null:a),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),Ae===a?"Hide Config":"Edit Config"]})}),Ae===a&&e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[s.name==="rate-limiting"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"Rate Limiting Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Minute Limit"}),e.jsx(d,{type:"number",value:s.config?.minute||"",onChange:l=>x(a,"minute",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"1000",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Hour Limit"}),e.jsx(d,{type:"number",value:s.config?.hour||"",onChange:l=>x(a,"hour",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"10000",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Day Limit"}),e.jsx(d,{type:"number",value:s.config?.day||"",onChange:l=>x(a,"day",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"100000",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Limit By"}),e.jsxs(N,{value:s.config?.limit_by||"consumer",onValueChange:l=>x(a,"limit_by",l),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"consumer",children:"Consumer"}),e.jsx(o,{value:"ip",children:"IP"}),e.jsx(o,{value:"credential",children:"Credential"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Policy"}),e.jsxs(N,{value:s.config?.policy||"local",onValueChange:l=>x(a,"policy",l),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"local",children:"Local"}),e.jsx(o,{value:"redis",children:"Redis"}),e.jsx(o,{value:"cluster",children:"Cluster"})]})]})]})]}),s.config?.policy==="redis"&&e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx(n,{className:"text-sm font-semibold",children:"Redis Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Redis Host"}),e.jsx(d,{value:s.config?.redis?.host||"",onChange:l=>x(a,"redis.host",l.target.value),placeholder:"localhost"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Redis Port"}),e.jsx(d,{type:"number",value:s.config?.redis?.port||"",onChange:l=>x(a,"redis.port",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"6379"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Redis Password"}),e.jsx(d,{type:"password",value:s.config?.redis?.password||"",onChange:l=>x(a,"redis.password",l.target.value),placeholder:"password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Redis Database"}),e.jsx(d,{type:"number",value:s.config?.redis?.database||"",onChange:l=>x(a,"redis.database",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"0"})]})]})]})]}),s.name==="key-auth"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"Key Auth Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Key Names (comma-separated)"}),e.jsx(d,{value:Array.isArray(s.config?.key_names)?s.config.key_names.join(", "):s.config?.key_names||"apikey",onChange:l=>x(a,"key_names",l.target.value.split(",").map(r=>r.trim())),placeholder:"apikey, X-API-Key"})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:s.config?.hide_credentials||!1,onCheckedChange:l=>x(a,"hide_credentials",l)}),e.jsx(n,{children:"Hide Credentials"})]})})]})]}),s.name==="jwt"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"JWT Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Secret is Base64"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:s.config?.secret_is_base64||!1,onCheckedChange:l=>x(a,"secret_is_base64",l)}),e.jsx(n,{children:"Enabled"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Run On"}),e.jsxs(N,{value:s.config?.run_on||"first",onValueChange:l=>x(a,"run_on",l),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"first",children:"First"}),e.jsx(o,{value:"all",children:"All"})]})]})]})]})]}),s.name==="cors"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"CORS Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Origins (comma-separated, * for all)"}),e.jsx(d,{value:Array.isArray(s.config?.origins)?s.config.origins.join(", "):s.config?.origins||"*",onChange:l=>x(a,"origins",l.target.value.split(",").map(r=>r.trim())),placeholder:"*, https://example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Methods (comma-separated)"}),e.jsx(d,{value:Array.isArray(s.config?.methods)?s.config.methods.join(", "):s.config?.methods||"GET, POST",onChange:l=>x(a,"methods",l.target.value.split(",").map(r=>r.trim())),placeholder:"GET, POST, PUT, DELETE"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Headers"}),e.jsx(d,{value:Array.isArray(s.config?.headers)?s.config.headers.join(", "):s.config?.headers||"",onChange:l=>x(a,"headers",l.target.value?l.target.value.split(",").map(r=>r.trim()):void 0),placeholder:"Content-Type, Authorization"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Exposed Headers"}),e.jsx(d,{value:Array.isArray(s.config?.exposed_headers)?s.config.exposed_headers.join(", "):s.config?.exposed_headers||"",onChange:l=>x(a,"exposed_headers",l.target.value?l.target.value.split(",").map(r=>r.trim()):void 0),placeholder:"X-Custom-Header"})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:s.config?.credentials||!1,onCheckedChange:l=>x(a,"credentials",l)}),e.jsx(n,{children:"Credentials"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Max Age (seconds)"}),e.jsx(d,{type:"number",value:s.config?.max_age||"",onChange:l=>x(a,"max_age",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"3600",min:"0"})]})]})]}),s.name==="ip-restriction"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"IP Restriction Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Whitelist (comma-separated IPs)"}),e.jsx(d,{value:Array.isArray(s.config?.whitelist)?s.config.whitelist.join(", "):s.config?.whitelist||"",onChange:l=>x(a,"whitelist",l.target.value?l.target.value.split(",").map(r=>r.trim()):[]),placeholder:"192.168.1.1, 10.0.0.0/8"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Blacklist (comma-separated IPs)"}),e.jsx(d,{value:Array.isArray(s.config?.blacklist)?s.config.blacklist.join(", "):s.config?.blacklist||"",onChange:l=>x(a,"blacklist",l.target.value?l.target.value.split(",").map(r=>r.trim()):[]),placeholder:"192.168.1.100"})]})]})]}),s.name==="file-log"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"File Log Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Path"}),e.jsx(d,{value:s.config?.path||"",onChange:l=>x(a,"path",l.target.value),placeholder:"/tmp/kong-access.log"})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:s.config?.reopen||!1,onCheckedChange:l=>x(a,"reopen",l)}),e.jsx(n,{children:"Reopen"})]})})]})]}),s.name==="http-log"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-sm font-semibold",children:"HTTP Log Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HTTP Endpoint"}),e.jsx(d,{value:s.config?.http_endpoint||"",onChange:l=>x(a,"http_endpoint",l.target.value),placeholder:"http://localhost:8080/logs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Method"}),e.jsxs(N,{value:s.config?.method||"POST",onValueChange:l=>x(a,"method",l),children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(o,{value:"POST",children:"POST"}),e.jsx(o,{value:"PUT",children:"PUT"}),e.jsx(o,{value:"PATCH",children:"PATCH"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Timeout (ms)"}),e.jsx(d,{type:"number",value:s.config?.timeout||"",onChange:l=>x(a,"timeout",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"10000",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Keepalive (ms)"}),e.jsx(d,{type:"number",value:s.config?.keepalive||"",onChange:l=>x(a,"keepalive",l.target.value?parseInt(l.target.value,10):void 0),placeholder:"60000",min:"0"})]})]})]}),!["rate-limiting","key-auth","jwt","cors","ip-restriction","file-log","http-log"].includes(s.name)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Configuration (JSON)"}),e.jsx(Xe,{className:"font-mono text-xs",rows:6,value:JSON.stringify(s.config||{},null,2),onChange:l=>{try{const r=JSON.parse(l.target.value);ts(a,"config",r)}catch(r){$(`Неверный формат JSON: ${r instanceof Error?r.message:"Неизвестная ошибка"}`)}},placeholder:'{"key": "value"}'})]})]})]},s.id||a)})]})]})]})}),e.jsx(le,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(E,{children:[e.jsxs(V,{children:[e.jsx(F,{children:"Service & Upstream"}),e.jsx(G,{children:"Default service configuration"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"service-name",children:"Service Name"}),e.jsx(d,{id:"service-name",value:os,onChange:s=>j({serviceName:s.target.value}),placeholder:"core-service"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"upstream-url",children:"Upstream URL"}),e.jsx(d,{id:"upstream-url",value:hs,onChange:s=>j({upstreamUrl:s.target.value}),placeholder:"http://service:port"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"admin-url",children:"Admin API URL"}),e.jsx(d,{id:"admin-url",value:ds,onChange:s=>j({adminUrl:s.target.value}),placeholder:"http://kong:8001"})]})]})]})})]})]}),e.jsx(ne,{open:I!==null,onOpenChange:s=>!s&&Ne(null),children:e.jsxs(re,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsxs(de,{children:["Are you sure you want to delete consumer ",e.jsx("strong",{children:I!==null?g[I]?.username||g[I]?.id:""}),"?",I!==null&&g[I]?.credentials&&g[I].credentials.length>0&&e.jsxs("span",{className:"block mt-2 text-destructive",children:["This consumer has ",g[I].credentials.length," credential(s). Please remove them first."]}),"This action cannot be undone."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:()=>I!==null&&zs(I),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ne,{open:Y!==null,onOpenChange:s=>!s&&He(null),children:e.jsxs(re,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsxs(de,{children:["Are you sure you want to delete this ",Y?g[Y.consumerIndex]?.credentials?.[Y.credIndex]?.type:""," credential? This action cannot be undone."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:()=>{Y&&Fs(Y.consumerIndex,Y.credIndex)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ne,{open:O!==null,onOpenChange:s=>!s&&Ee(null),children:e.jsxs(re,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsxs(de,{children:["Are you sure you want to delete service ",e.jsx("strong",{children:O!==null?u[O]?.name||"Unknown":""}),"?",O!==null&&Ce(u[O]?.id||u[O]?.name||"").length>0&&e.jsxs("span",{className:"block mt-2 text-destructive",children:["This service has ",Ce(u[O]?.id||u[O]?.name||"").length," route(s). Please remove them first."]}),"This action cannot be undone."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:()=>O!==null&&Ss(O),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ne,{open:se!==null,onOpenChange:s=>!s&&Le(null),children:e.jsxs(re,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsxs(de,{children:["Are you sure you want to delete route ",e.jsx("strong",{children:se!==null?S[se]?.name||S[se]?.paths?.[0]||"Unknown":""}),"? This action cannot be undone."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:()=>se!==null&&Rs(se),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ne,{open:q!==null,onOpenChange:s=>!s&&De(null),children:e.jsxs(re,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsxs(de,{children:["Are you sure you want to delete upstream ",e.jsx("strong",{children:q!==null?_[q]?.name||"Unknown":""}),"?",q!==null&&u.filter(s=>s.upstream===_[q]?.name).length>0&&e.jsxs("span",{className:"block mt-2 text-destructive",children:["This upstream is used by ",u.filter(s=>s.upstream===_[q]?.name).length," service(s). Please remove them first."]}),"This action cannot be undone."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:()=>q!==null&&Ds(q),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ne,{open:ue!==null,onOpenChange:s=>!s&&Ie(null),children:e.jsxs(re,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsxs(de,{children:["Are you sure you want to delete plugin ",e.jsx("strong",{children:ue!==null?D[ue]?.name||"Unknown":""}),"? This action cannot be undone."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:()=>ue!==null&&Bs(ue),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}export{ha as KongConfigAdvanced};
