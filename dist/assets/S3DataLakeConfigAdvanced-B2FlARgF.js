import{E as ce,u as ne,j as e,r as R,i as u,S as G,C as t,e as f,f as g,k as j,B as m,T as ie,a as le,b as T,A as te,d as I,h as D,P as B,m as L,L as i,I as l,t as y,n as K,o as z,p as M,q as _,s as p,c as re}from"./index-DLY56EcE.js";import{R as de}from"./refresh-ccw-CIIwm2k8.js";import{K as oe}from"./key-BPyaeisU.js";import{F as xe}from"./folder-BSsFRthP.js";const he=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],V=ce("archive",he);function Ce({componentId:S}){const{nodes:O,updateNode:P}=ne(),b=O.find(s=>s.id===S);if(!b)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const v=b.data.config||{},r=v.buckets||[],H=v.accessKeyId||"",W=v.secretAccessKey||"",A=v.defaultRegion||"us-east-1",d=v.lifecycleRules||[],[je,me]=R.useState(null),[ue,fe]=R.useState(null),[ge,pe]=R.useState(!1),[C,E]=R.useState(null),X=()=>{P(S,{data:{...b.data,config:{...v,_lastRefresh:Date.now()}}})},o=s=>{P(S,{data:{...b.data,config:{...v,...s}}})},U=()=>{const s={name:"new-bucket",region:A,versioning:!1,encryption:"AES256",lifecycleEnabled:!1,publicAccess:!1,objectCount:0,totalSize:0,folders:[]};o({buckets:[...r,s]})},Y=s=>{o({buckets:r.filter((a,c)=>c!==s)})},x=(s,a,c)=>{const n=[...r];n[s]={...n[s],[a]:c},o({buckets:n})},q=()=>{const s={id:`rule-${Date.now()}`,name:"New Lifecycle Rule",status:"Enabled",transitions:[]};o({lifecycleRules:[...d,s]}),E(s.id)},J=s=>{o({lifecycleRules:d.filter(a=>a.id!==s)}),C===s&&E(null)},h=(s,a)=>{const c=d.map(n=>n.id===s?{...n,...a}:n);o({lifecycleRules:c})},$=s=>{const a=d.find(n=>n.id===s);if(!a)return;const c={days:30,storageClass:"STANDARD_IA"};h(s,{transitions:[...a.transitions||[],c]})},Q=(s,a)=>{const c=d.find(w=>w.id===s);if(!c||!c.transitions)return;const n=c.transitions.filter((w,N)=>N!==a);h(s,{transitions:n})},F=(s,a,c)=>{const n=d.find(N=>N.id===s);if(!n||!n.transitions)return;const w=n.transitions.map((N,ae)=>ae===a?{...N,...c}:N);h(s,{transitions:w})},Z=r.length,ee=r.reduce((s,a)=>s+(a.objectCount||0),0),se=r.reduce((s,a)=>s+(a.totalSize||0),0),k=s=>{if(s===0)return"0 Bytes";const a=1024,c=["Bytes","KB","MB","GB","TB"],n=Math.floor(Math.log(s)/Math.log(a));return Math.round(s/Math.pow(a,n)*100)/100+" "+c[n]};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Amazon S3 Data Lake"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Object Storage"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Configure S3 buckets, lifecycle policies and data lake storage"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:X,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsx(f,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium",children:"Buckets"})}),e.jsx(j,{children:e.jsx("span",{className:"text-2xl font-bold",children:Z})})]}),e.jsxs(t,{children:[e.jsx(f,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium",children:"Total Objects"})}),e.jsx(j,{children:e.jsx("span",{className:"text-2xl font-bold",children:ee.toLocaleString()})})]}),e.jsxs(t,{children:[e.jsx(f,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium",children:"Total Size"})}),e.jsx(j,{children:e.jsx("span",{className:"text-2xl font-bold",children:k(se)})})]}),e.jsxs(t,{children:[e.jsx(f,{className:"pb-3",children:e.jsx(g,{className:"text-sm font-medium",children:"Default Region"})}),e.jsx(j,{children:e.jsx(m,{variant:"outline",children:A})})]})]}),e.jsxs(ie,{defaultValue:"buckets",className:"space-y-4",children:[e.jsxs(le,{children:[e.jsxs(T,{value:"buckets",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buckets (",r.length,")"]}),e.jsxs(T,{value:"lifecycle",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Lifecycle Rules (",d.length,")"]}),e.jsxs(T,{value:"credentials",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Credentials"]})]}),e.jsx(I,{value:"buckets",className:"space-y-4",children:e.jsxs(t,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"S3 Buckets"}),e.jsx(D,{children:"Configure and manage S3 buckets for data lake storage"})]}),e.jsxs(u,{onClick:U,size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Bucket"]})]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:r.map((s,a)=>e.jsxs(t,{className:"border-l-4 border-l-orange-500",children:[e.jsx(f,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx(g,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(m,{variant:"outline",children:s.region}),s.versioning&&e.jsx(m,{variant:"default",children:"Versioning"}),s.publicAccess&&e.jsx(m,{variant:"destructive",children:"Public"}),e.jsxs(m,{variant:"outline",children:[s.objectCount||0," objects"]})]})]})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>Y(a),disabled:r.length===1,children:e.jsx(L,{className:"h-4 w-4"})})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Objects"}),e.jsx("p",{className:"text-lg font-semibold",children:(s.objectCount||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Size"}),e.jsx("p",{className:"text-lg font-semibold",children:k(s.totalSize||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bucket URL"}),e.jsxs("p",{className:"text-xs font-mono text-muted-foreground truncate",children:["s3://",s.name]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Bucket Name"}),e.jsx(l,{value:s.name,onChange:c=>x(a,"name",c.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Region"}),e.jsx(l,{value:s.region,onChange:c=>x(a,"region",c.target.value),placeholder:"us-east-1"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Versioning"}),e.jsx(y,{checked:s.versioning||!1,onCheckedChange:c=>x(a,"versioning",c)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Encryption"}),e.jsxs(K,{value:s.encryption||"AES256",onValueChange:c=>x(a,"encryption",c),children:[e.jsx(z,{children:e.jsx(M,{})}),e.jsxs(_,{children:[e.jsx(p,{value:"AES256",children:"AES256"}),e.jsx(p,{value:"aws:kms",children:"AWS KMS"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Public Access"}),e.jsx(y,{checked:s.publicAccess||!1,onCheckedChange:c=>x(a,"publicAccess",c)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Lifecycle Enabled"}),e.jsx(y,{checked:s.lifecycleEnabled||!1,onCheckedChange:c=>x(a,"lifecycleEnabled",c)})]}),s.lifecycleEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Lifecycle Transition Days"}),e.jsx(l,{type:"number",value:s.lifecycleDays||30,onChange:c=>x(a,"lifecycleDays",Number(c.target.value)),min:1})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Enable Glacier Archive"}),e.jsx(y,{checked:s.glacierEnabled||!1,onCheckedChange:c=>x(a,"glacierEnabled",c)})]}),s.glacierEnabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Glacier Transition Days"}),e.jsx(l,{type:"number",value:s.glacierDays||90,onChange:c=>x(a,"glacierDays",Number(c.target.value)),min:90})]})]})]}),s.folders&&s.folders.length>0&&e.jsxs("div",{children:[e.jsx(i,{className:"mb-2 block",children:"Folders"}),e.jsx("div",{className:"space-y-2",children:s.folders.map((c,n)=>e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c.path})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",children:[c.objectCount||0," objects"]}),e.jsx(m,{variant:"outline",children:k(c.size||0)})]})]})},n))})]})]})]},a))})})]})}),e.jsx(I,{value:"lifecycle",className:"space-y-4",children:e.jsxs(t,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Lifecycle Rules"}),e.jsx(D,{children:"Configure automatic transitions and expiration"})]}),e.jsxs(u,{onClick:q,size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Rule"]})]})}),e.jsx(j,{children:d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No lifecycle rules configured"}):e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsx(t,{className:"border-l-4 border-l-green-500",children:e.jsxs(j,{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(m,{variant:s.status==="Enabled"?"default":"outline",children:s.status}),C===s.id?e.jsx(l,{value:s.name,onChange:a=>h(s.id,{name:a.target.value}),className:"w-48"}):e.jsx("span",{className:"font-medium",children:s.name}),s.prefix&&e.jsxs(m,{variant:"outline",children:["Prefix: ",s.prefix]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>E(C===s.id?null:s.id),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>J(s.id),children:e.jsx(L,{className:"h-4 w-4"})})]})]}),C===s.id&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Rule Name"}),e.jsx(l,{value:s.name,onChange:a=>h(s.id,{name:a.target.value})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Status"}),e.jsxs(K,{value:s.status,onValueChange:a=>h(s.id,{status:a}),children:[e.jsx(z,{className:"w-32",children:e.jsx(M,{})}),e.jsxs(_,{children:[e.jsx(p,{value:"Enabled",children:"Enabled"}),e.jsx(p,{value:"Disabled",children:"Disabled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Prefix (optional)"}),e.jsx(l,{value:s.prefix||"",onChange:a=>h(s.id,{prefix:a.target.value||void 0}),placeholder:"logs/"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Apply rule to objects with keys starting with this prefix"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Transitions"}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>$(s.id),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Transition"]})]}),s.transitions&&s.transitions.length>0?e.jsx("div",{className:"space-y-2",children:s.transitions.map((a,c)=>e.jsxs("div",{className:"flex gap-2 items-center p-2 border rounded",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs",children:"Days"}),e.jsx(l,{type:"number",value:a.days,onChange:n=>F(s.id,c,{days:Number(n.target.value)}),min:1})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs",children:"Storage Class"}),e.jsxs(K,{value:a.storageClass,onValueChange:n=>F(s.id,c,{storageClass:n}),children:[e.jsx(z,{children:e.jsx(M,{})}),e.jsxs(_,{children:[e.jsx(p,{value:"STANDARD_IA",children:"STANDARD_IA"}),e.jsx(p,{value:"GLACIER",children:"GLACIER"}),e.jsx(p,{value:"DEEP_ARCHIVE",children:"DEEP_ARCHIVE"}),e.jsx(p,{value:"INTELLIGENT_TIERING",children:"INTELLIGENT_TIERING"})]})]})]})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>Q(s.id,c),children:e.jsx(L,{className:"h-4 w-4"})})]},c))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No transitions configured"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Expiration"}),e.jsx(y,{checked:!!s.expiration,onCheckedChange:a=>h(s.id,{expiration:a?{days:365}:void 0})})]}),s.expiration&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"text-xs",children:"Delete after"}),e.jsx(l,{type:"number",value:s.expiration.days,onChange:a=>h(s.id,{expiration:{days:Number(a.target.value)}}),min:1,className:"w-24"}),e.jsx(i,{className:"text-xs",children:"days"})]})]})]})]})},s.id))})})]})}),e.jsx(I,{value:"credentials",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"AWS Credentials"}),e.jsx(D,{children:"Configure AWS access credentials for S3"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"accessKeyId",children:"Access Key ID"}),e.jsx(l,{id:"accessKeyId",value:H,onChange:s=>o({accessKeyId:s.target.value}),placeholder:"AKIAIOSFODNN7EXAMPLE"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"secretAccessKey",children:"Secret Access Key"}),e.jsx(l,{id:"secretAccessKey",type:"password",value:W,onChange:s=>o({secretAccessKey:s.target.value}),placeholder:"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"defaultRegion",children:"Default Region"}),e.jsx(l,{id:"defaultRegion",value:A,onChange:s=>o({defaultRegion:s.target.value}),placeholder:"us-east-1"})]}),e.jsx("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:[e.jsx("strong",{children:"Security Note:"})," In production, use IAM roles or environment variables instead of hardcoding credentials."]})})]})]})})]})]})})}export{Ce as S3DataLakeConfigAdvanced};
