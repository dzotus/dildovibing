import{u as Fe,a as Ke,r as V,j as e,e as P,l as p,S as He,C as j,h as S,i as M,m as f,A as Ve,k as L,L as m,x as J,I as N,q as U,s as E,t as _,v as O,w as c,T as Be,b as We,c as B,aA as Ge,d as Ze,f as W,B as Y,P as z,o as I}from"./index-HDGrDyRq.js";import{R as xe}from"./refresh-ccw-BUKvY8S7.js";import{U as qe}from"./users-O29_gLR1.js";import{B as Je}from"./bell-THvPHNcM.js";import{C as Q}from"./clock-3yiD5iuE.js";const Qe=u=>u?/^[a-zA-Z0-9_-]+$/.test(u)&&u.length>=8:!0,Xe=u=>u?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u):!1,es=u=>{if(!u)return!0;try{return new URL(u),!0}catch{return!1}};function rs({componentId:u}){const{nodes:X,updateNode:me}=Fe(),{getComponentMetrics:he,isRunning:ue}=Ke(),$=X.find(s=>s.id===u),[A,je]=V.useState({}),[ve,ee]=V.useState(!1),se=he(u),ae=se?.customMetrics||{};if(V.useEffect(()=>{},[se,ue]),!$)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const v=$?.data?.config||{},ge=v.enableAutoResolve??!0,pe=v.resolveTimeout??300,G=v.enableWebhooks??!1,fe=v.webhookUrl??"",Ne=v.severityMapping??"standard",D=Array.isArray(v.services)?v.services:[],F=P.getPagerDutyIncidents(u).map(s=>{const a=D.find(n=>n.id===s.serviceId);return{id:s.id,title:s.title,service:a?.name||s.serviceId,status:s.status,severity:s.severity,createdAt:new Date(s.createdAt).toISOString(),acknowledgedAt:s.acknowledgedAt?new Date(s.acknowledgedAt).toISOString():void 0,resolvedAt:s.resolvedAt?new Date(s.resolvedAt).toISOString():void 0}}),w=Array.isArray(v.escalationPolicies)?v.escalationPolicies:[],y=Array.isArray(v.onCallUsers)?v.onCallUsers:[],b=Array.isArray(v.schedules)?v.schedules:[],Z=P.getPagerDutyMetrics(u),[T,ye]=V.useState(v.timeFormat||"24h"),[g,we]=V.useState(v.dateFormat||"YYYY-MM-DD"),be=Z?.incidentsTotal??F.length,te=Z?.incidentsActive??F.filter(s=>s.status!=="resolved").length,Ce=Z?.incidentsResolved??F.filter(s=>s.status==="resolved").length,o=s=>{const a={...v,...s},n={};if(a.enableWebhooks&&a.webhookUrl&&(es(a.webhookUrl)||(n.webhookUrl="Invalid URL format")),Array.isArray(a.services)&&a.services.forEach((l,i)=>{l.integrationKey&&!Qe(l.integrationKey)&&(n[`service-${i}-integrationKey`]="Invalid integration key format")}),Array.isArray(a.onCallUsers)&&a.onCallUsers.forEach((l,i)=>{Xe(l.email)||(n[`user-${i}-email`]="Invalid email format")}),je(n),Object.keys(n).length>0)return;me(u,{data:{...$.data,config:a}}),ee(!0);const t={...$,data:{...$.data,config:a}};P.updateNodesAndConnections([t],[]),setTimeout(()=>ee(!1),500)},Se=()=>{const s={id:`service-${Date.now()}`,name:"new-service",integrationKey:"",status:"active",autoResolve:!0,resolveTimeout:300,incidentCount:0};o({services:[...D,s]}),setShowCreateService(!1)},De=s=>{o({services:D.filter(a=>a.id!==s)})},R=(s,a,n)=>{const t=D.map(l=>l.id===s?{...l,[a]:n}:l);o({services:t})},Me=s=>{P.acknowledgePagerDutyIncident(u,s)},Ye=s=>{P.resolvePagerDutyIncident(u,s)},Ae=()=>{const s={id:`policy-${Date.now()}`,name:"new-policy",levels:[{level:1,timeout:5,targets:[]}]};o({escalationPolicies:[...w,s]}),setShowCreatePolicy(!1)},ke=s=>{o({escalationPolicies:w.filter(a=>a.id!==s)})},Te=(s,a)=>{const n=w.map(t=>t.id===s?{...t,name:a}:t);o({escalationPolicies:n})},Pe=s=>{const a=w.map(n=>{if(n.id!==s)return n;const t=(n.levels[n.levels.length-1]?.level||0)+1;return{...n,levels:[...n.levels,{level:t,timeout:5,targets:[]}]}});o({escalationPolicies:a})},Ue=(s,a)=>{const n=w.map(t=>{if(t.id!==s)return t;const l=t.levels.filter((i,r)=>r!==a);return{...t,levels:l}});o({escalationPolicies:n})},Ee=(s,a,n)=>{const t=w.map(l=>{if(l.id!==s)return l;const i=l.levels.map((r,x)=>x===a?{...r,timeout:n}:r);return{...l,levels:i}});o({escalationPolicies:t})},_e=()=>{const s={id:`user-${Date.now()}`,name:"On-Call User",email:"user@example.com",status:"on-call"};o({onCallUsers:[...y,s]}),setShowCreateOnCall(!1)},Oe=s=>{const a=y.filter(t=>t.id!==s),n=w.map(t=>({...t,levels:t.levels.map(l=>({...l,targets:l.targets.filter(i=>i!==s)}))}));o({onCallUsers:a,escalationPolicies:n})},q=(s,a,n)=>{const t=y.map(l=>l.id===s?{...l,[a]:n}:l);o({onCallUsers:t})},$e=()=>{const s={id:`schedule-${Date.now()}`,name:"new-schedule",timezone:"UTC",layers:[{start:new Date().toISOString(),rotation_virtual_start:new Date().toISOString(),rotation_turn_length_seconds:604800,users:[]}]};o({schedules:[...b,s]})},Re=s=>{const a=b.filter(t=>t.id!==s),n=w.map(t=>({...t,levels:t.levels.map(l=>({...l,targets:l.targets.filter(i=>i!==s)}))}));o({schedules:a,escalationPolicies:n})},ne=(s,a,n)=>{const t=b.map(l=>l.id===s?{...l,[a]:n}:l);o({schedules:t})},Le=s=>{const a=b.map(n=>n.id!==s?n:{...n,layers:[...n.layers,{start:new Date().toISOString(),rotation_virtual_start:new Date().toISOString(),rotation_turn_length_seconds:604800,users:[]}]});o({schedules:a})},ze=(s,a)=>{const n=b.map(t=>t.id!==s?t:{...t,layers:t.layers.filter((l,i)=>i!==a)});o({schedules:n})},K=(s,a,n,t)=>{const l=b.map(i=>i.id!==s?i:{...i,layers:i.layers.map((r,x)=>x===a?{...r,[n]:t}:r)});o({schedules:l})},Ie=(s,a,n)=>{const t=b.map(l=>l.id!==s?l:{...l,layers:l.layers.map((i,r)=>{if(r!==a)return i;const x=i.users.some(d=>d.user.id===n);return{...i,users:x?i.users.filter(d=>d.user.id!==n):[...i.users,{user:{id:n}}]}})});o({schedules:t})},le=(s,a,n)=>{const t=w.map(l=>{if(l.id!==s)return l;const i=l.levels.map((r,x)=>{if(x!==a)return r;const h=r.targets.includes(n)?r.targets.filter(k=>k!==n):[...r.targets,n];return{...r,targets:h}});return{...l,levels:i}});o({escalationPolicies:t})},ie=s=>P.getPagerDutyScheduleOnCallUsers(u,s),re=s=>{const a=new Date(s),n=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return g==="MM/DD/YYYY"?`${t}/${l}/${n}`:g==="DD/MM/YYYY"?`${l}/${t}/${n}`:`${n}-${t}-${l}`},ce=s=>{if(!s)return null;let a,n,t;if(g==="MM/DD/YYYY"){const[l,i,r]=s.split("/").map(Number);a=r,n=l-1,t=i}else if(g==="DD/MM/YYYY"){const[l,i,r]=s.split("/").map(Number);a=r,n=i-1,t=l}else{const[l,i,r]=s.split("-").map(Number);a=l,n=i-1,t=r}return new Date(a,n,t)},de=s=>{const a=new Date(s),n=a.getHours(),t=a.getMinutes();if(T==="12h"){const l=n%12||12,i=n>=12?"PM":"AM";return`${String(l).padStart(2,"0")}:${String(t).padStart(2,"0")} ${i}`}return`${String(n).padStart(2,"0")}:${String(t).padStart(2,"0")}`},oe=(s,a)=>{s!==void 0&&(ye(s),o({timeFormat:s})),a!==void 0&&(we(a),o({dateFormat:a}))};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"PagerDuty"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Incident Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage incidents, services, escalation policies and on-call schedules"})]}),e.jsxs("div",{className:"flex gap-2",children:[ve&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(xe,{className:"h-4 w-4 animate-spin"}),"Updating..."]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{const s={...$};P.updateNodesAndConnections([s],[])},children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsx(He,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(j,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Total Incidents"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold",children:be})})]}),e.jsxs(j,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Active"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold text-red-500",children:te})})]}),e.jsxs(j,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Resolved"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold text-green-500",children:Ce})})]}),e.jsxs(j,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Services"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold",children:D.length})})]})]}),e.jsxs(j,{children:[e.jsxs(S,{children:[e.jsxs(M,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Global Settings"]}),e.jsx(L,{children:"Control how incidents are auto-resolved, mapped by severity and propagated via webhooks"})]}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Auto Resolve"}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Enable automatic incident resolution"}),e.jsx(J,{checked:ge,onCheckedChange:s=>o({enableAutoResolve:s})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Resolve Timeout (seconds)"}),e.jsx(N,{type:"number",value:pe,onChange:s=>o({resolveTimeout:Number(s.target.value)||0}),min:60})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Severity Mapping"}),e.jsxs(U,{value:Ne,onValueChange:s=>o({severityMapping:s}),children:[e.jsx(E,{children:e.jsx(_,{})}),e.jsxs(O,{children:[e.jsx(c,{value:"standard",children:"Standard (critical / warning / info)"}),e.jsx(c,{value:"error-focused",children:"Error-focused (warnings treated as errors)"}),e.jsx(c,{value:"warning-demoted",children:"Warning demoted (warnings as info)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Enable Webhooks"}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Send outbound incident webhooks"}),e.jsx(J,{checked:G,onCheckedChange:s=>o({enableWebhooks:s})})]})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(m,{children:"Webhook URL"}),e.jsx(N,{value:fe,onChange:s=>o({webhookUrl:s.target.value}),placeholder:"https://webhook.example.com/pagerduty",disabled:!G,className:A.webhookUrl?"border-red-500":""}),A.webhookUrl&&e.jsx("p",{className:"text-xs text-red-500",children:A.webhookUrl}),G&&ae.webhook_success_rate!==void 0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Success rate: ",(ae.webhook_success_rate*100).toFixed(1),"%"]})]})]})})]}),e.jsxs(Be,{defaultValue:"incidents",className:"space-y-4",children:[e.jsxs(We,{children:[e.jsxs(B,{value:"incidents",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Incidents (",te,")"]}),e.jsxs(B,{value:"services",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Services (",D.length,")"]}),e.jsxs(B,{value:"policies",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Escalation Policies (",w.length,")"]}),e.jsxs(B,{value:"oncall",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"On-Call"]}),e.jsxs(B,{value:"schedules",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Schedules (",b.length,")"]})]}),e.jsx(W,{value:"incidents",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(S,{children:[e.jsx(M,{children:"Incidents"}),e.jsx(L,{children:"Manage and respond to incidents"})]}),e.jsx(f,{children:F.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No incidents"}):e.jsx("div",{className:"space-y-2",children:F.map(s=>e.jsx(j,{className:`border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="error"?"border-l-orange-500":s.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{variant:s.status==="resolved"?"default":s.status==="acknowledged"?"secondary":"destructive",children:s.status}),e.jsx(Y,{variant:s.severity==="critical"?"destructive":s.severity==="error"?"default":"outline",children:s.severity}),e.jsx("span",{className:"font-medium",children:s.title})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Service: ",s.service]}),e.jsxs("p",{children:["Created: ",new Date(s.createdAt).toLocaleString()]}),s.assignedTo&&e.jsxs("p",{children:["Assigned to: ",s.assignedTo]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="triggered"&&e.jsx(p,{size:"sm",variant:"outline",onClick:()=>Me(s.id),children:"Acknowledge"}),s.status!=="resolved"&&e.jsx(p,{size:"sm",variant:"default",onClick:()=>Ye(s.id),children:"Resolve"})]})]})})},s.id))})})]})}),e.jsx(W,{value:"services",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Services"}),e.jsx(L,{children:"Configure monitored services"})]}),e.jsxs(p,{onClick:Se,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Service"]})]})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsxs(j,{className:"border-l-4 border-l-blue-500",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Y,{variant:s.status==="active"?"default":s.status==="maintenance"?"secondary":"outline",children:s.status}),e.jsxs(Y,{variant:"outline",children:[s.incidentCount||0," incidents"]})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>De(s.id),disabled:D.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Service Name"}),e.jsx(N,{value:s.name,onChange:a=>R(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Integration Key"}),e.jsx(N,{value:s.integrationKey,onChange:a=>R(s.id,"integrationKey",a.target.value),placeholder:"integration-key",className:A[`service-${D.indexOf(s)}-integrationKey`]?"border-red-500":""}),A[`service-${D.indexOf(s)}-integrationKey`]&&e.jsx("p",{className:"text-xs text-red-500",children:A[`service-${D.indexOf(s)}-integrationKey`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Status"}),e.jsxs(U,{value:s.status,onValueChange:a=>R(s.id,"status",a),children:[e.jsx(E,{children:e.jsx(_,{})}),e.jsxs(O,{children:[e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"maintenance",children:"Maintenance"}),e.jsx(c,{value:"disabled",children:"Disabled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Escalation Policy"}),e.jsxs(U,{value:s.escalationPolicy||"",onValueChange:a=>R(s.id,"escalationPolicy",a),children:[e.jsx(E,{children:e.jsx(_,{})}),e.jsx(O,{children:w.map(a=>e.jsx(c,{value:a.name,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{children:"Auto Resolve"}),e.jsx(J,{checked:s.autoResolve??!0,onCheckedChange:a=>R(s.id,"autoResolve",a)})]}),s.autoResolve&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Resolve Timeout (seconds)"}),e.jsx(N,{type:"number",value:s.resolveTimeout||300,onChange:a=>R(s.id,"resolveTimeout",Number(a.target.value)),min:60})]})]})})]},s.id))})})]})}),e.jsx(W,{value:"policies",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Escalation Policies"}),e.jsx(L,{children:"Configure incident escalation rules"})]}),e.jsxs(p,{onClick:Ae,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Policy"]})]})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsxs(j,{className:"border-l-4 border-l-green-500",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(m,{children:"Policy Name"}),e.jsx(N,{value:s.name,onChange:a=>Te(s.id,a.target.value)})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>ke(s.id),disabled:w.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsxs(f,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.levels.length," levels"]})]}),e.jsxs(p,{variant:"outline",size:"xs",onClick:()=>Pe(s.id),children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Add Level"]})]}),e.jsx("div",{className:"space-y-2",children:s.levels.map((a,n)=>e.jsx(j,{className:"p-3",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-medium",children:["Level ",a.level]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>Ue(s.id,n),disabled:s.levels.length===1,children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Timeout (minutes)"}),e.jsx(N,{type:"number",value:a.timeout,min:1,onChange:t=>Ee(s.id,n,Number(t.target.value)||0)})]}),e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Targets (users or schedules)"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.map(t=>{const l=a.targets.includes(t.id);return e.jsxs(Y,{variant:l?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>le(s.id,n,t.id),children:["ðŸ‘¤ ",t.name]},t.id)}),b.map(t=>{const l=a.targets.includes(t.id),i=ie(t.id);return e.jsxs(Y,{variant:l?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>le(s.id,n,t.id),title:`Schedule: ${t.name} (${i.length} on-call)`,children:["ðŸ“… ",t.name]},t.id)}),y.length===0&&b.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"No targets configured"})]})})]})]})]})})},n))})]})]},s.id))})})]})}),e.jsx(W,{value:"oncall",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"On-Call Roster"}),e.jsx(L,{children:"Manage who participates in on-call and their status"})]}),e.jsxs(p,{size:"sm",onClick:_e,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsx(f,{children:y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No on-call users configured. Add at least one user to use escalation policies effectively."}):e.jsx("div",{className:"space-y-2",children:y.map(s=>e.jsx(j,{className:"border-l-4 border-l-purple-500",children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Name"}),e.jsx(N,{value:s.name,onChange:a=>q(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Email"}),e.jsx(N,{value:s.email,onChange:a=>q(s.id,"email",a.target.value),className:A[`user-${y.indexOf(s)}-email`]?"border-red-500":""}),A[`user-${y.indexOf(s)}-email`]&&e.jsx("p",{className:"text-xs text-red-500",children:A[`user-${y.indexOf(s)}-email`]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Status"}),e.jsxs(U,{value:s.status,onValueChange:a=>q(s.id,"status",a),children:[e.jsx(E,{className:"h-8 w-[140px]",children:e.jsx(_,{})}),e.jsxs(O,{children:[e.jsx(c,{value:"on-call",children:"On-Call"}),e.jsx(c,{value:"off-call",children:"Off-Call"})]})]})]}),e.jsx(Y,{variant:s.status==="on-call"?"default":"outline",children:s.status==="on-call"?"On-Call":"Off-Call"})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>Oe(s.id),disabled:y.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})})},s.id))})})]})}),e.jsx(W,{value:"schedules",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Schedules"}),e.jsx(L,{children:"Configure on-call rotation schedules"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"text-xs",children:"Time Format:"}),e.jsxs(U,{value:T,onValueChange:s=>oe(s),children:[e.jsx(E,{className:"h-8 w-20",children:e.jsx(_,{})}),e.jsxs(O,{children:[e.jsx(c,{value:"12h",children:"12h"}),e.jsx(c,{value:"24h",children:"24h"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"text-xs",children:"Date Format:"}),e.jsxs(U,{value:g,onValueChange:s=>oe(void 0,s),children:[e.jsx(E,{className:"h-8 w-32",children:e.jsx(_,{})}),e.jsxs(O,{children:[e.jsx(c,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"}),e.jsx(c,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(c,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"})]})]})]}),e.jsxs(p,{onClick:$e,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Schedule"]})]})]})}),e.jsx(f,{children:b.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No schedules configured. Create a schedule to manage on-call rotations."}):e.jsx("div",{className:"space-y-4",children:b.map(s=>{const a=ie(s.id),n=y.filter(t=>a.includes(t.id));return e.jsxs(j,{className:"border-l-4 border-l-indigo-500",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{children:"Schedule Name"}),e.jsx(N,{value:s.name,onChange:t=>ne(s.id,"name",t.target.value),className:"max-w-xs"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{children:"Timezone"}),e.jsxs(U,{value:s.timezone,onValueChange:t=>ne(s.id,"timezone",t),children:[e.jsx(E,{className:"max-w-xs",children:e.jsx(_,{placeholder:"Select timezone"})}),e.jsxs(O,{children:[e.jsx(c,{value:"UTC",children:"UTC (Coordinated Universal Time)"}),e.jsx(c,{value:"America/New_York",children:"America/New_York (EST/EDT)"}),e.jsx(c,{value:"America/Chicago",children:"America/Chicago (CST/CDT)"}),e.jsx(c,{value:"America/Denver",children:"America/Denver (MST/MDT)"}),e.jsx(c,{value:"America/Los_Angeles",children:"America/Los_Angeles (PST/PDT)"}),e.jsx(c,{value:"Europe/London",children:"Europe/London (GMT/BST)"}),e.jsx(c,{value:"Europe/Paris",children:"Europe/Paris (CET/CEST)"}),e.jsx(c,{value:"Europe/Berlin",children:"Europe/Berlin (CET/CEST)"}),e.jsx(c,{value:"Europe/Moscow",children:"Europe/Moscow (MSK)"}),e.jsx(c,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"}),e.jsx(c,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(c,{value:"Asia/Shanghai",children:"Asia/Shanghai (CST)"}),e.jsx(c,{value:"Asia/Tokyo",children:"Asia/Tokyo (JST)"}),e.jsx(c,{value:"Australia/Sydney",children:"Australia/Sydney (AEST/AEDT)"}),e.jsx(c,{value:"Pacific/Auckland",children:"Pacific/Auckland (NZST/NZDT)"})]})]})]}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:"default",children:"Current On-Call:"}),n.map(t=>e.jsx(Y,{variant:"outline",children:t.name},t.id))]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>Re(s.id),disabled:b.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsxs(f,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.layers.length," layer(s)"]})]}),e.jsxs(p,{variant:"outline",size:"xs",onClick:()=>Le(s.id),children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Add Layer"]})]}),e.jsx("div",{className:"space-y-2",children:s.layers.map((t,l)=>e.jsx(j,{className:"p-3 bg-muted/50",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Layer ",l+1]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>ze(s.id,l),disabled:s.layers.length===1,children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Start Date & Time"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{type:g==="YYYY-MM-DD"?"date":"text",value:g==="YYYY-MM-DD"?new Date(t.start).toISOString().split("T")[0]:re(t.start),onChange:i=>{const r=i.target.value;if(!r)return;const x=new Date(t.start);let d;if(g==="YYYY-MM-DD"){const[h,k,C]=r.split("-").map(Number);d=new Date(h,k-1,C,x.getHours(),x.getMinutes())}else{const h=ce(r);if(!h)return;d=new Date(h.getFullYear(),h.getMonth(),h.getDate(),x.getHours(),x.getMinutes())}K(s.id,l,"start",d.toISOString())},placeholder:g==="YYYY-MM-DD"?"":g,className:"text-xs flex-1"}),e.jsx(N,{type:T==="24h"?"time":"text",value:de(t.start),onChange:i=>{const r=i.target.value;if(!r)return;const x=new Date(t.start);let d,h;if(T==="24h")[d,h]=r.split(":").map(Number);else{const C=r.match(/(\d+):(\d+)\s*(AM|PM)?/i);if(!C)return;d=Number(C[1]),h=Number(C[2]);const H=(C[3]||"").toUpperCase()==="PM";H&&d!==12&&(d+=12),!H&&d===12&&(d=0)}const k=new Date(x.getFullYear(),x.getMonth(),x.getDate(),d,h);K(s.id,l,"start",k.toISOString())},placeholder:T==="24h"?"HH:mm":"hh:mm AM/PM",className:"text-xs w-28"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Rotation Start Date & Time"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{type:g==="YYYY-MM-DD"?"date":"text",value:g==="YYYY-MM-DD"?new Date(t.rotation_virtual_start).toISOString().split("T")[0]:re(t.rotation_virtual_start),onChange:i=>{const r=i.target.value;if(!r)return;const x=new Date(t.rotation_virtual_start);let d;if(g==="YYYY-MM-DD"){const[h,k,C]=r.split("-").map(Number);d=new Date(h,k-1,C,x.getHours(),x.getMinutes())}else{const h=ce(r);if(!h)return;d=new Date(h.getFullYear(),h.getMonth(),h.getDate(),x.getHours(),x.getMinutes())}K(s.id,l,"rotation_virtual_start",d.toISOString())},placeholder:g==="YYYY-MM-DD"?"":g,className:"text-xs flex-1"}),e.jsx(N,{type:T==="24h"?"time":"text",value:de(t.rotation_virtual_start),onChange:i=>{const r=i.target.value;if(!r)return;const x=new Date(t.rotation_virtual_start);let d,h;if(T==="24h")[d,h]=r.split(":").map(Number);else{const C=r.match(/(\d+):(\d+)\s*(AM|PM)?/i);if(!C)return;d=Number(C[1]),h=Number(C[2]);const H=(C[3]||"").toUpperCase()==="PM";H&&d!==12&&(d+=12),!H&&d===12&&(d=0)}const k=new Date(x.getFullYear(),x.getMonth(),x.getDate(),d,h);K(s.id,l,"rotation_virtual_start",k.toISOString())},placeholder:T==="24h"?"HH:mm":"hh:mm AM/PM",className:"text-xs w-28"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Rotation Length (days)"}),e.jsx(N,{type:"number",value:Math.floor(t.rotation_turn_length_seconds/86400),onChange:i=>{const r=Number(i.target.value)||7;K(s.id,l,"rotation_turn_length_seconds",r*86400)},min:1,className:"text-xs"})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-xs",children:"Users in Rotation"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.map(i=>{const r=t.users.some(x=>x.user.id===i.id);return e.jsx(Y,{variant:r?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>Ie(s.id,l,i.id),children:i.name},i.id)}),y.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"No on-call users configured"})]})]})]})})},l))})]})]},s.id)})})})]})})]})]})})}export{rs as PagerDutyConfigAdvanced};
