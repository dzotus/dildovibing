import{K as qe,a as Ne,r as L,e as Ke,j as e,C as D,m as O,A as oe,af as ge,ax as je,h as z,i as F,k as B,L as h,a5 as be,I as w,q as te,s as ae,t as re,v as ne,w as J,B as Z,aA as ye,u as Ve,a2 as Qe,a3 as Ye,l as f,a7 as Ie,S as Ge,T as Xe,b as Ze,c as V,d as es,F as ss,f as Q,P as Y,o as I,x as fe}from"./index-DCOdhwlJ.js";import{T as U}from"./textarea-DZHYvQNj.js";import{s as X,a as ts}from"./toast-B-uYm5sG.js";import{T as as,a as rs,b as ie,c as W,d as ns,e as M}from"./table-C8gniQa5.js";import{C as ls}from"./clock-Cuo099JE.js";import{H as cs}from"./hard-drive-XLgW6qnJ.js";const is=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],os=qe("cloud-upload",is);function ve(n){try{const s=new URL(n);return s.port?`${s.hostname}:${s.port}`:s.hostname}catch{const s=n.match(/^https?:\/\/([^\/]+)/);return s?s[1]:n}}function ds(n){const s=new Map;for(const i of n){const o=i.job||"default";s.has(o)||s.set(o,[]),s.get(o).push(i)}return s}function hs(n){const s=[];s.push("global:"),n.scrapeInterval&&s.push(`  scrape_interval: ${n.scrapeInterval}`),n.evaluationInterval&&s.push(`  evaluation_interval: ${n.evaluationInterval}`),n.storagePath&&s.push(`  # storage.tsdb.path: ${n.storagePath}`),n.retentionTime&&s.push(`  # storage.tsdb.retention.time: ${n.retentionTime}`),s.push("");const i=n.scrapeInterval||"15s";if(n.scrape_configs&&n.scrape_configs.length>0){s.push("scrape_configs:");for(const o of n.scrape_configs){s.push(`  - job_name: '${E(o.job_name)}'`),o.scrape_interval&&o.scrape_interval!==i&&s.push(`    scrape_interval: ${o.scrape_interval}`),o.scrape_timeout&&s.push(`    scrape_timeout: ${o.scrape_timeout}`),o.metrics_path&&o.metrics_path!=="/metrics"&&s.push(`    metrics_path: '${E(o.metrics_path)}'`),s.push("    static_configs:");for(const p of o.static_configs||[]){s.push("      - targets:");for(const y of p.targets||[])s.push(`          - '${E(y)}'`);if(p.labels&&Object.keys(p.labels).length>0){s.push("        labels:");for(const[y,g]of Object.entries(p.labels))s.push(`          ${y}: '${E(String(g))}'`)}}s.push("")}}else if(n.targets&&n.targets.length>0){s.push("scrape_configs:");const o=ds(n.targets);for(const[p,y]of o.entries()){const g=y[0],d=g.interval||i,_=g.metricsPath||"/metrics",S=g.scrapeTimeout;s.push(`  - job_name: '${E(p)}'`),d!==i&&s.push(`    scrape_interval: ${d}`),S&&s.push(`    scrape_timeout: ${S}`),_!=="/metrics"&&s.push(`    metrics_path: '${E(_)}'`),s.push("    static_configs:");const A=new Map;for(const v of y){const C=JSON.stringify(v.labels||{});A.has(C)||A.set(C,[]),A.get(C).push(v)}for(const[v,C]of A.entries()){const P=JSON.parse(v);s.push("      - targets:");for(const N of C){const b=ve(N.endpoint);s.push(`          - '${E(b)}'`)}if(Object.keys(P).length>0){s.push("        labels:");for(const[N,b]of Object.entries(P))s.push(`          ${N}: '${E(String(b))}'`)}}s.push("")}}else s.push("scrape_configs: []"),s.push("");if(n.enableAlertmanager&&n.alertmanagerUrl){s.push("alerting:"),s.push("  alertmanagers:"),s.push("    - static_configs:"),s.push("        - targets:");const o=ve(n.alertmanagerUrl);s.push(`            - '${E(o)}'`),s.push("")}if(n.enableRemoteWrite&&n.remoteWrite&&n.remoteWrite.length>0){s.push("remote_write:");for(const o of n.remoteWrite)s.push("  - url:"),s.push(`      '${E(o.url)}'`),o.auth&&s.push("    # Authorization header should be configured via file or environment");s.push("")}return s.join(`
`)}function us(n){if(n.length===0)return"";const s=["groups:"];s.push("  - name: alerts"),s.push("    rules:");for(const i of n){if(s.push(`      - alert: ${i.name}`),s.push(`        expr: ${i.expr}`),i.for&&s.push(`        for: ${i.for}`),i.labels&&Object.keys(i.labels).length>0){s.push("        labels:");for(const[o,p]of Object.entries(i.labels))s.push(`          ${o}: '${E(String(p))}'`)}if(i.annotations&&Object.keys(i.annotations).length>0){s.push("        annotations:");for(const[o,p]of Object.entries(i.annotations))s.push(`          ${o}: '${E(String(p))}'`)}s.push("")}return s.join(`
`)}function ms(n){if(n.length===0)return"";const s=["groups:"];s.push("  - name: recording_rules"),s.push("    rules:");for(const i of n){if(s.push(`      - record: ${i.name}`),s.push(`        expr: ${i.expr}`),i.labels&&Object.keys(i.labels).length>0){s.push("        labels:");for(const[o,p]of Object.entries(i.labels))s.push(`          ${o}: '${E(String(p))}'`)}s.push("")}return s.join(`
`)}function E(n){return n.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\n/g,"\\n")}function xs(n){try{const s=new URL(n);return s.port?`${s.hostname}:${s.port}`:s.protocol==="https:"?`${s.hostname}:443`:`${s.hostname}:80`}catch{const s=n.match(/^https?:\/\/([^\/]+)/);return s?s[1]:null}}function ps(n){try{return new URL(n).pathname||"/metrics"}catch{const s=n.match(/^https?:\/\/[^\/]+(\/.*)/);return s?s[1]:"/metrics"}}function gs(n,s="15s"){if(!n||n.length===0)return[];const i=new Map;for(const p of n){const y=p.job||"default";i.has(y)||i.set(y,[]),i.get(y).push(p)}const o=[];for(const[p,y]of i.entries()){const g=new Map;for(const v of y){const C=JSON.stringify(v.labels||{});g.has(C)||g.set(C,[]),g.get(C).push(v)}const d=[];let _,S,A;for(const[v,C]of g.entries()){const P=JSON.parse(v),N=[];for(const b of C){const G=xs(b.endpoint);G&&N.push(G),!_&&b.interval&&(_=b.interval),!S&&b.metricsPath?S=b.metricsPath:S||(S=ps(b.endpoint)),!A&&b.scrapeTimeout&&(A=b.scrapeTimeout)}N.length>0&&d.push({targets:N,labels:Object.keys(P).length>0?P:void 0})}if(d.length>0){const v={job_name:p,static_configs:d};_&&_!==s&&(v.scrape_interval=_),S&&S!=="/metrics"&&(v.metrics_path=S),A&&(v.scrape_timeout=A),o.push(v)}}return o}function Ce(n){return n.targets&&Array.isArray(n.targets)&&n.targets.length>0&&!n.scrape_configs}function js(n){if(!Ce(n))return n;const s=gs(n.targets,n.scrapeInterval||"15s");return{...n,scrape_configs:s}}function fs({componentId:n}){const{isRunning:s}=Ne(),[i,o]=L.useState([]),[p,y]=L.useState(""),[g,d]=L.useState("all"),[_,S]=L.useState("all"),[A,v]=L.useState(0),C=L.useMemo(()=>s?Ke.getPrometheusEmulationEngine(n):null,[n,s]);L.useEffect(()=>{const c=()=>{if(C){const j=C.getTargetStatuses();o(j)}else o([])};if(c(),s){const j=setInterval(()=>{c(),v(H=>H+1)},1e3);return()=>clearInterval(j)}},[C,s,A]);const P=L.useMemo(()=>{const c=new Set;return i.forEach(j=>c.add(j.job)),Array.from(c).sort()},[i]),N=L.useMemo(()=>i.filter(c=>{if(g!=="all"&&c.up!==(g==="up")||_!=="all"&&c.job!==_)return!1;if(p){const j=p.toLowerCase(),H=c.endpoint.toLowerCase().includes(j),R=c.job.toLowerCase().includes(j),de=c.labels?Object.entries(c.labels).some(([he,ue])=>he.toLowerCase().includes(j)||ue.toLowerCase().includes(j)):!1;if(!H&&!R&&!de)return!1}return!0}),[i,g,_,p]),b=c=>{if(!c)return"Never";const j=new Date(c),R=Date.now()-c;return R<1e3?"Just now":R<6e4?`${Math.floor(R/1e3)}s ago`:R<36e5?`${Math.floor(R/6e4)}m ago`:R<864e5?`${Math.floor(R/36e5)}h ago`:j.toLocaleString()},G=c=>c===null?"-":c<1?`${(c*1e3).toFixed(0)}μs`:c<1e3?`${c.toFixed(2)}ms`:`${(c/1e3).toFixed(2)}s`,k=N.filter(c=>c.up).length,K=N.filter(c=>!c.up).length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(D,{children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Targets"}),e.jsx("p",{className:"text-2xl font-bold",children:N.length})]}),e.jsx(oe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(D,{children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Up"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:k})]}),e.jsx(ge,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(D,{children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Down"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:K})]}),e.jsx(je,{className:"h-8 w-8 text-red-600"})]})})})]}),e.jsxs(D,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Targets Status"}),e.jsxs(B,{children:["Real-time status of all Prometheus scrape targets",!s&&e.jsx("span",{className:"ml-2 text-yellow-600",children:"(Start emulation to see live data)"})]})]}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search by endpoint, job, labels...",value:p,onChange:c=>y(c.target.value),className:"pl-8"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Status"}),e.jsxs(te,{value:g,onValueChange:c=>d(c),children:[e.jsx(ae,{children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(J,{value:"all",children:"All"}),e.jsx(J,{value:"up",children:"Up"}),e.jsx(J,{value:"down",children:"Down"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Job"}),e.jsxs(te,{value:_,onValueChange:S,children:[e.jsx(ae,{children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(J,{value:"all",children:"All Jobs"}),P.map(c=>e.jsx(J,{value:c,children:c},c))]})]})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(as,{children:[e.jsx(rs,{children:e.jsxs(ie,{children:[e.jsx(W,{children:"Status"}),e.jsx(W,{children:"Job"}),e.jsx(W,{children:"Endpoint"}),e.jsx(W,{children:"Last Scrape"}),e.jsx(W,{children:"Duration"}),e.jsx(W,{children:"Samples"}),e.jsx(W,{children:"Retries"}),e.jsx(W,{children:"Error"}),e.jsx(W,{children:"Labels"})]})}),e.jsx(ns,{children:N.length===0?e.jsx(ie,{children:e.jsx(M,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:i.length===0?s?"No targets configured. Add scrape configs to see targets here.":"Start emulation to see targets status":"No targets match the current filters"})}):N.map((c,j)=>e.jsxs(ie,{children:[e.jsx(M,{children:e.jsx(Z,{variant:c.up?"default":"destructive",className:"gap-1",children:c.up?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-3 w-3"}),"Up"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-3 w-3"}),"Down"]})})}),e.jsx(M,{className:"font-mono text-sm",children:c.job}),e.jsx(M,{className:"font-mono text-sm",children:c.endpoint}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ls,{className:"h-3 w-3 text-muted-foreground"}),b(c.lastScrape)]}),c.lastSuccess&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Last success: ",b(c.lastSuccess)]})]}),e.jsx(M,{className:"font-mono text-sm",children:c.scrapeDuration!==null?G(c.scrapeDuration):"-"}),e.jsx(M,{className:"font-mono text-sm",children:c.samplesScraped}),e.jsx(M,{children:c.retryCount>0?e.jsx(Z,{variant:"outline",className:"text-orange-600",children:c.retryCount}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(M,{children:c.lastError?e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm max-w-xs",children:[e.jsx(ye,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:c.lastError,children:c.lastError})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(M,{children:c.labels&&Object.keys(c.labels).length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[Object.entries(c.labels).slice(0,3).map(([H,R])=>e.jsxs(Z,{variant:"outline",className:"text-xs",children:[H,"=",R]},H)),Object.keys(c.labels).length>3&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:["+",Object.keys(c.labels).length-3]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},`${c.job}-${c.endpoint}-${j}`))})]})})]})]})]})}function Rs({componentId:n}){const{nodes:s,updateNode:i,connections:o}=Ve(),{getComponentMetrics:p,isRunning:y}=Ne(),g=s.find(t=>t.id===n);if(!g)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});let d=g.data.config||{};Ce(d)&&(d=js(d),i(n,{data:{...g.data,config:d}}));const _=d.version||"2.48.0",S=d.scrapeInterval||"15s",A=d.evaluationInterval||"15s",v=d.retentionTime||"15d",C=d.storagePath||"/prometheus",P=d.enableRemoteWrite??!1,N=d.remoteWrite||[],b=d.enableAlertmanager??!0,G=d.alertmanagerUrl||"http://alertmanager:9093",k=d.scrape_configs||[],K=d.alertingRules||[],c=d.recordingRules||[],j=d.serviceDiscovery||[],R=(()=>{if(k.reduce((a,r)=>a+(r.static_configs?.reduce((l,x)=>l+(x.targets?.length||0),0)||0),0)===0)return{status:"idle",label:"Idle",color:"bg-gray-500"};if(y){const a=p(n);if(a?.customMetrics){const r=a.customMetrics.targets_up||0,l=a.customMetrics.targets_down||0,x=a.customMetrics.scrape_errors_total||0;if(l>0||x>0)return{status:"degraded",label:"Degraded",color:"bg-yellow-500"};if(r>0)return{status:"healthy",label:"Healthy",color:"bg-green-500"}}}return{status:"configured",label:"Configured",color:"bg-blue-500"}})(),[de,he]=L.useState(null),[ue,vs]=L.useState(null),[we,le]=L.useState(!1),[Se,ce]=L.useState(!1),[Ns,_e]=L.useState(!1),m=t=>{i(n,{data:{...g.data,config:{...d,...t}}})},Re=()=>{m({scrape_configs:[...k,{job_name:"new-job",static_configs:[{targets:[]}]}]})},Te=t=>{m({scrape_configs:k.filter((a,r)=>r!==t)})},se=(t,a,r)=>{const l=[...k];l[t]={...l[t],[a]:r},m({scrape_configs:l})},$e=t=>{const a=[...k],r=a[t];a[t]={...r,static_configs:[...r.static_configs||[],{targets:[]}]},m({scrape_configs:a})},ke=(t,a)=>{const r=[...k],l=r[t];r[t]={...l,static_configs:l.static_configs.filter((x,u)=>u!==a)},m({scrape_configs:r})},Oe=(t,a,r)=>{const l=[...k],x=l[t];x.static_configs[a],l[t]={...x,static_configs:x.static_configs.map((u,T)=>T===a?{...u,targets:[...u.targets||[],r]}:u)},m({scrape_configs:l})},Le=(t,a,r)=>{const l=[...k],x=l[t];l[t]={...x,static_configs:x.static_configs.map((u,T)=>T===a?{...u,targets:u.targets.filter((q,$)=>$!==r)}:u)},m({scrape_configs:l})},Ae=(t,a,r,l)=>{const x=[...k],u=x[t];x[t]={...u,static_configs:u.static_configs.map((T,q)=>q===a?{...T,targets:T.targets.map(($,He)=>He===r?l:$)}:T)},m({scrape_configs:x})},Ee=(t,a,r)=>{const l=[...k],x=l[t];l[t]={...x,static_configs:x.static_configs.map((u,T)=>T===a?{...u,labels:Object.keys(r).length>0?r:void 0}:u)},m({scrape_configs:l})},Je=()=>{m({remoteWrite:[...N,{url:""}]})},De=t=>{m({remoteWrite:N.filter((a,r)=>r!==t)})},me=(t,a)=>{const r=[...N];r[t]=a,m({remoteWrite:r})},Pe=()=>{const t={name:"New Alert Rule",expr:"up == 0",for:"5m",labels:{},annotations:{},severity:"warning"};m({alertingRules:[...K,t]}),le(!1)},Ue=t=>{m({alertingRules:K.filter((a,r)=>r!==t)})},ee=(t,a,r)=>{const l=[...K];l[t]={...l[t],[a]:r},m({alertingRules:l})},Me=()=>{const t={name:"new:metric:name",expr:"rate(metric_name[5m])",labels:{}};m({recordingRules:[...c,t]}),ce(!1)},We=t=>{m({recordingRules:c.filter((a,r)=>r!==t)})},xe=(t,a,r)=>{const l=[...c];l[t]={...l[t],[a]:r},m({recordingRules:l})},ze=()=>{const t={type:"static",config:{}};m({serviceDiscovery:[...j,t]}),_e(!1)},Fe=t=>{m({serviceDiscovery:j.filter((a,r)=>r!==t)})},pe=(t,a,r)=>{const l=[...j];l[t]={...l[t],[a]:r},m({serviceDiscovery:l})},Be=()=>{try{const t=hs(d),a=d.alertingRules&&d.alertingRules.length>0?us(d.alertingRules):"",r=d.recordingRules&&d.recordingRules.length>0?ms(d.recordingRules):"",l=new Blob([t],{type:"text/yaml"}),x=URL.createObjectURL(l),u=document.createElement("a");if(u.href=x,u.download="prometheus.yml",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(x),a){const T=new Blob([a],{type:"text/yaml"}),q=URL.createObjectURL(T),$=document.createElement("a");$.href=q,$.download="alerts.yml",document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(q)}if(r){const T=new Blob([r],{type:"text/yaml"}),q=URL.createObjectURL(T),$=document.createElement("a");$.href=q,$.download="recording_rules.yml",document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(q)}ts("Configuration exported successfully")}catch(t){X(`Failed to export configuration: ${t instanceof Error?t.message:"Unknown error"}`)}};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(oe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(Qe,{children:"Prometheus"}),e.jsx(Ye,{children:"Metrics collection & rule evaluation"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Z,{variant:"secondary",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${R.color} ${y&&R.status==="healthy"?"animate-pulse":""}`}),R.label]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:Be,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Export YAML"]})]})]}),e.jsx(Ge,{}),e.jsxs(Xe,{defaultValue:"targets",className:"w-full",children:[e.jsxs(Ze,{className:"grid w-full grid-cols-7",children:[e.jsxs(V,{value:"targets",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Targets"]}),e.jsxs(V,{value:"scraping",className:"gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"Scraping"]}),e.jsxs(V,{value:"service-discovery",className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Service Discovery"]}),e.jsxs(V,{value:"alerting-rules",className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Alerting Rules"]}),e.jsxs(V,{value:"recording-rules",className:"gap-2",children:[e.jsx(ss,{className:"h-4 w-4"}),"Recording Rules"]}),e.jsxs(V,{value:"storage",className:"gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"Storage"]}),e.jsxs(V,{value:"remote",className:"gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"Remote Write"]})]}),e.jsx(Q,{value:"targets",className:"mt-4",children:e.jsx(fs,{componentId:n})}),e.jsxs(Q,{value:"scraping",className:"mt-4 space-y-4",children:[e.jsxs(D,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Global Settings"}),e.jsx(B,{children:"Intervals for scraping targets and evaluating rules"})]}),e.jsxs(O,{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Version"}),e.jsx(w,{value:_,onChange:t=>m({version:t.target.value}),placeholder:"2.48.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Scrape Interval"}),e.jsx(w,{value:S,onChange:t=>m({scrapeInterval:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Evaluation Interval"}),e.jsx(w,{value:A,onChange:t=>m({evaluationInterval:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Retention Time"}),e.jsx(w,{value:v,onChange:t=>m({retentionTime:t.target.value})})]})]})]}),e.jsxs(D,{children:[e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Scrape Configs"}),e.jsx(B,{children:"Scrape configurations for Prometheus (matches real Prometheus format)"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:Re,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Scrape Config"]})]}),e.jsxs(O,{className:"space-y-4",children:[k.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No scrape configurations"}),e.jsx("p",{className:"text-xs mt-2",children:"Add scrape configs manually or connect components to automatically add them"})]}),k.map((t,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 space-y-2",children:e.jsxs("div",{children:[e.jsx(h,{children:"Job Name"}),e.jsx(w,{value:t.job_name,className:"font-semibold",onChange:r=>se(a,"job_name",r.target.value),placeholder:"my-job"})]})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Te(a),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Scrape Interval"}),e.jsx(w,{value:t.scrape_interval||S,onChange:r=>se(a,"scrape_interval",r.target.value||void 0),placeholder:S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Metrics Path"}),e.jsx(w,{value:t.metrics_path||"/metrics",onChange:r=>se(a,"metrics_path",r.target.value||void 0),placeholder:"/metrics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Scrape Timeout"}),e.jsx(w,{value:t.scrape_timeout||"",onChange:r=>se(a,"scrape_timeout",r.target.value||void 0),placeholder:"10s"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Static Configs"}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>$e(a),children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Add Static Config"]})]}),t.static_configs.map((r,l)=>e.jsxs("div",{className:"p-3 border border-border rounded bg-muted/50 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{className:"text-sm",children:["Static Config #",l+1]}),t.static_configs.length>1&&e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>ke(a,l),children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs",children:"Targets (host:port)"}),e.jsxs("div",{className:"space-y-2",children:[r.targets.map((x,u)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:x,onChange:T=>Ae(a,l,u,T.target.value),placeholder:"host:port"}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Le(a,l,u),children:e.jsx(I,{className:"h-3 w-3"})})]},u)),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>Oe(a,l,""),className:"w-full",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Add Target"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs",children:"Labels (JSON)"}),e.jsx(U,{className:"font-mono text-xs",rows:2,value:JSON.stringify(r.labels||{},null,2),onChange:x=>{try{const u=JSON.parse(x.target.value);Ee(a,l,u)}catch(u){X(`Неверный формат JSON: ${u instanceof Error?u.message:"Неизвестная ошибка"}`)}},placeholder:'{"env": "prod", "region": "us-east-1"}'})]})]},l))]})]},`${t.job_name}-${a}`))]})]})]}),e.jsx(Q,{value:"storage",className:"mt-4 space-y-4",children:e.jsxs(D,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Local Storage"}),e.jsx(B,{children:"TSDB configuration"})]}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Storage Path"}),e.jsx(w,{value:C,onChange:t=>m({storagePath:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Compaction Log"}),e.jsx(U,{className:"font-mono text-xs",rows:4,value:`level=info ts=${Date.now()} caller=compact.go:516 msg="compact blocks" count=3 mint=0 maxt=3600000`,readOnly:!0})]})]})]})}),e.jsx(Q,{value:"remote",className:"mt-4 space-y-4",children:e.jsxs(D,{children:[e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Remote Write"}),e.jsx(B,{children:"Ship metrics to long-term storage"})]}),e.jsx(fe,{checked:P,onCheckedChange:t=>m({enableRemoteWrite:t})})]}),P&&e.jsxs(O,{className:"space-y-4",children:[N.map((t,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg space-y-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Endpoint #",a+1]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>De(a),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Remote URL"}),e.jsx(w,{value:t.url,onChange:r=>me(a,{...t,url:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Authorization Header"}),e.jsx(w,{placeholder:"Bearer ...",value:t.auth||"",onChange:r=>me(a,{...t,auth:r.target.value})})]})]},a)),e.jsxs(f,{variant:"outline",size:"sm",onClick:Je,className:"gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Add Endpoint"]})]})]})}),e.jsx(Q,{value:"service-discovery",className:"mt-4 space-y-4",children:e.jsxs(D,{children:[e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Service Discovery"}),e.jsx(B,{children:"Configure automatic target discovery"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:ze,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Service Discovery"]})]}),e.jsxs(O,{className:"space-y-3",children:[j.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No service discovery configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Configure automatic target discovery for Kubernetes, Consul, etc."})]}),j.map((t,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(te,{value:t.type,onValueChange:r=>pe(a,"type",r),children:[e.jsx(ae,{className:"w-48",children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(J,{value:"kubernetes",children:"Kubernetes"}),e.jsx(J,{value:"consul",children:"Consul"}),e.jsx(J,{value:"static",children:"Static"}),e.jsx(J,{value:"file",children:"File"}),e.jsx(J,{value:"dns",children:"DNS"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Discovery Type"})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Fe(a),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Configuration (JSON)"}),e.jsx(U,{className:"font-mono text-xs",rows:4,value:JSON.stringify(t.config,null,2),onChange:r=>{try{const l=JSON.parse(r.target.value);pe(a,"config",l)}catch(l){X(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"role": "pod", "namespaces": {"names": ["default"]}}'})]})]},a))]})]})}),e.jsxs(Q,{value:"alerting-rules",className:"mt-4 space-y-4",children:[e.jsxs(D,{children:[e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Alerting Rules"}),e.jsx(B,{children:"Define PromQL expressions that trigger alerts"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>le(!0),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Create Alert Rule"]})]}),we&&e.jsx(O,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Rule Name"}),e.jsx(w,{placeholder:"HighCPUUsage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(U,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m]) > 0.8"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:Pe,children:"Create Rule"}),e.jsx(f,{variant:"outline",onClick:()=>le(!1),children:"Cancel"})]})]})}),e.jsxs(O,{className:"space-y-3",children:[K.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No alerting rules configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Create rules to monitor your system and trigger alerts"})]}),K.map((t,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx(Z,{variant:t.severity==="critical"?"destructive":t.severity==="warning"?"default":"secondary",children:t.severity||"info"})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Ue(a),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(U,{className:"font-mono text-xs",rows:2,value:t.expr,onChange:r=>ee(a,"expr",r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"For Duration"}),e.jsx(w,{value:t.for||"",onChange:r=>ee(a,"for",r.target.value),placeholder:"5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Severity"}),e.jsxs(te,{value:t.severity||"warning",onValueChange:r=>ee(a,"severity",r),children:[e.jsx(ae,{children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(J,{value:"critical",children:"Critical"}),e.jsx(J,{value:"warning",children:"Warning"}),e.jsx(J,{value:"info",children:"Info"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Labels (JSON)"}),e.jsx(U,{className:"font-mono text-xs",rows:2,value:JSON.stringify(t.labels||{},null,2),onChange:r=>{try{const l=JSON.parse(r.target.value);ee(a,"labels",l)}catch(l){X(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"severity": "warning"}'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Annotations (JSON)"}),e.jsx(U,{className:"font-mono text-xs",rows:2,value:JSON.stringify(t.annotations||{},null,2),onChange:r=>{try{const l=JSON.parse(r.target.value);ee(a,"annotations",l)}catch(l){X(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"summary": "Alert summary", "description": "Alert description"}'})]})]},a))]})]}),e.jsxs(D,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Alertmanager Integration"}),e.jsx(B,{children:"Configure alert notifications pipeline"})]}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{children:"Enable Alertmanager"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Forward firing alerts to Alertmanager"})]}),e.jsx(fe,{checked:b,onCheckedChange:t=>m({enableAlertmanager:t})})]}),b&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Alertmanager URL"}),e.jsx(w,{value:G,onChange:t=>m({alertmanagerUrl:t.target.value})})]})]})]})]}),e.jsx(Q,{value:"recording-rules",className:"mt-4 space-y-4",children:e.jsxs(D,{children:[e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Recording Rules"}),e.jsx(B,{children:"Pre-compute frequently used or expensive queries"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>ce(!0),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Create Recording Rule"]})]}),Se&&e.jsx(O,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Rule Name"}),e.jsx(w,{placeholder:"cpu:usage:rate5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(U,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m])"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:Me,children:"Create Rule"}),e.jsx(f,{variant:"outline",onClick:()=>ce(!1),children:"Cancel"})]})]})}),e.jsxs(O,{className:"space-y-3",children:[c.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No recording rules configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Create rules to pre-compute frequently used queries"})]}),c.map((t,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold font-mono",children:t.name}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>We(a),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(U,{className:"font-mono text-xs",rows:2,value:t.expr,onChange:r=>xe(a,"expr",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Labels (JSON)"}),e.jsx(U,{className:"font-mono text-xs",rows:2,value:JSON.stringify(t.labels||{},null,2),onChange:r=>{try{const l=JSON.parse(r.target.value);xe(a,"labels",l)}catch(l){X(`Неверный формат JSON: ${l instanceof Error?l.message:"Неизвестная ошибка"}`)}},placeholder:'{"job": "node-exporter"}'})]})]},a))]})]})})]})]})})}export{Rs as PrometheusConfigAdvanced};
