import{u as te,_ as ne,j as e,r as E,S as D,C as r,e as x,f as h,k as c,B as u,T as le,a as ie,b as f,R as J,A as re,c as ce,d as b,h as y,i as g,P as O,I as o,m as K,L as i,n as P,o as C,p as w,q as A,s as n,t as Q}from"./index-B7PftTIS.js";import{P as z}from"./progress-ZAUNZkOu.js";import{S as oe}from"./shield-B1Nr_zGk.js";function me({componentId:S}){const{nodes:B,updateNode:_}=te(),{isRunning:W,getComponentMetrics:X}=ne(),k=B.find(s=>s.id===S);if(!k)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const q=W?X(S):void 0,j=k.data.config||{},L=j.organization||"archiphoenix-org",$=j.environment||"prod",l=j.proxies||[],v=j.policies||[{id:"1",name:"Quota Policy",type:"quota",enabled:!0,config:{quota:5e3,interval:60}},{id:"2",name:"Spike Arrest",type:"spike-arrest",enabled:!0,config:{rate:100}}],H=j.apiKey||"",[G,T]=E.useState(null),[M,F]=E.useState(!1),[N,V]=E.useState("quota"),m=s=>{_(S,{data:{...k.data,config:{...j,...s}}})},U=()=>{const s={name:"new-proxy",environment:"prod",basePath:"/api",targetEndpoint:"https://api.internal",revision:1,status:"undeployed",quota:1e3,quotaInterval:60,spikeArrest:50,enableOAuth:!1,requestCount:0,errorCount:0,avgResponseTime:0};m({proxies:[...l,s]})},Y=s=>{m({proxies:l.filter((a,t)=>t!==s)})},d=(s,a,t)=>{const p=[...l];p[s]={...p[s],[a]:t},m({proxies:p})},Z=()=>{const s={quota:"Quota Policy","spike-arrest":"Spike Arrest Policy",oauth:"OAuth Policy",jwt:"JWT Policy","verify-api-key":"Verify API Key Policy",cors:"CORS Policy","xml-to-json":"XML to JSON Policy"},a={quota:"RequestFlow","spike-arrest":"RequestFlow",oauth:"PreFlow",jwt:"PreFlow","verify-api-key":"PreFlow",cors:"PostFlow","xml-to-json":"PostFlow"},t={id:`policy-${Date.now()}`,name:s[N]||"New Policy",type:N,enabled:!0,executionFlow:a[N],config:{}};m({policies:[...v,t]}),F(!1),V("quota")},ee=s=>{m({policies:v.filter(a=>a.id!==s)})},R=(s,a,t)=>{const p=v.map(I=>I.id===s?{...I,[a]:t}:I);m({policies:p})},se=q?.customMetrics?.total_requests||l.reduce((s,a)=>s+(a.requestCount||0),0);q?.customMetrics?.total_errors||l.reduce((s,a)=>s+(a.errorCount||0),0);const ae=q?.customMetrics?.avg_latency||(l.length>0?l.reduce((s,a)=>s+(a.avgResponseTime||0),0)/l.length:0);return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Apigee API Platform"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"API Proxy Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Configure API proxies, policies, quotas and security"})]})}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium",children:"Organization"})}),e.jsx(c,{children:e.jsx(u,{variant:"outline",children:L})})]}),e.jsxs(r,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium",children:"API Proxies"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold",children:l.length})})]}),e.jsxs(r,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium",children:"Total Requests"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold",children:se.toLocaleString()})})]}),e.jsxs(r,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-sm font-medium",children:"Avg Response Time"})}),e.jsxs(c,{children:[e.jsx("span",{className:"text-2xl font-bold",children:ae.toFixed(0)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"ms"})]})]})]}),e.jsxs(le,{defaultValue:"proxies",className:"space-y-4",children:[e.jsxs(ie,{children:[e.jsxs(f,{value:"proxies",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Proxies (",l.length,")"]}),e.jsxs(f,{value:"policies",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Policies (",v.length,")"]}),e.jsxs(f,{value:"monitoring",disabled:l.filter(s=>s.status==="deployed"||!s.status).length===0,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Monitoring (",l.filter(s=>s.status==="deployed"||!s.status).length,")"]}),e.jsxs(f,{value:"settings",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(b,{value:"proxies",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(h,{children:"API Proxies"}),e.jsx(y,{children:"Configure and manage API proxies"})]}),e.jsxs(g,{onClick:U,size:"sm",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Create Proxy"]})]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:l.map((s,a)=>e.jsxs(r,{className:"border-l-4 border-l-blue-500",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[G===a?e.jsx(o,{value:s.name,onChange:t=>d(a,"name",t.target.value),onBlur:()=>T(null),onKeyDown:t=>{t.key==="Enter"&&T(null)},className:"font-semibold text-base",autoFocus:!0}):e.jsx(h,{className:"text-base cursor-pointer hover:text-primary transition-colors",onClick:()=>T(a),children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(u,{variant:s.status==="deployed"?"default":"outline",children:s.status||"undeployed"}),e.jsx(u,{variant:"outline",children:s.environment}),e.jsxs(u,{variant:"outline",children:["Rev ",s.revision||1]})]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>Y(a),disabled:l.length===1,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requests"}),e.jsx("p",{className:"text-lg font-semibold",children:(s.requestCount||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Errors"}),e.jsx("p",{className:"text-lg font-semibold text-red-500",children:(s.errorCount||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Response Time"}),e.jsxs("p",{className:"text-lg font-semibold",children:[(s.avgResponseTime||0).toFixed(0)," ms"]})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Proxy Name"}),e.jsx(o,{value:s.name,onChange:t=>d(a,"name",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Environment"}),e.jsxs(P,{value:s.environment,onValueChange:t=>d(a,"environment",t),children:[e.jsx(C,{children:e.jsx(w,{})}),e.jsxs(A,{children:[e.jsx(n,{value:"dev",children:"Development"}),e.jsx(n,{value:"stage",children:"Staging"}),e.jsx(n,{value:"prod",children:"Production"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Base Path"}),e.jsx(o,{value:s.basePath,onChange:t=>d(a,"basePath",t.target.value),placeholder:"/api"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Target Endpoint"}),e.jsx(o,{value:s.targetEndpoint,onChange:t=>d(a,"targetEndpoint",t.target.value),placeholder:"https://api.internal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Quota (requests)"}),e.jsx(o,{type:"number",value:s.quota||0,onChange:t=>d(a,"quota",Number(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Quota Interval (seconds)"}),e.jsx(o,{type:"number",value:s.quotaInterval||60,onChange:t=>d(a,"quotaInterval",Number(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Spike Arrest (req/sec)"}),e.jsx(o,{type:"number",value:s.spikeArrest||0,onChange:t=>d(a,"spikeArrest",Number(t.target.value))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Enable OAuth"}),e.jsx(Q,{checked:s.enableOAuth||!1,onCheckedChange:t=>d(a,"enableOAuth",t)})]})]}),s.enableOAuth&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"JWT Issuer"}),e.jsx(o,{value:s.jwtIssuer||"",onChange:t=>d(a,"jwtIssuer",t.target.value),placeholder:"auth.archi"})]})]})]},a))})})]})}),e.jsx(b,{value:"policies",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Policies"}),e.jsx(y,{children:"Configure API proxy policies"})]}),e.jsxs(g,{onClick:()=>F(!0),size:"sm",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Add Policy"]})]})}),e.jsxs(c,{children:[M&&e.jsx(r,{className:"mb-4 border-l-4 border-l-blue-500",children:e.jsx(c,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-semibold",children:"Policy Type"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Select the type of policy to add. The type determines the policy's functionality and cannot be changed after creation."}),e.jsxs(P,{value:N,onValueChange:s=>V(s),children:[e.jsx(C,{children:e.jsx(w,{})}),e.jsxs(A,{children:[e.jsx(n,{value:"quota",children:"Quota Policy - Limit total requests per time period"}),e.jsx(n,{value:"spike-arrest",children:"Spike Arrest Policy - Smooth traffic spikes"}),e.jsx(n,{value:"verify-api-key",children:"Verify API Key - Validate API keys"}),e.jsx(n,{value:"oauth",children:"OAuth Policy - OAuth 2.0 authentication"}),e.jsx(n,{value:"jwt",children:"JWT Policy - JWT token validation"}),e.jsx(n,{value:"cors",children:"CORS Policy - Cross-origin resource sharing"}),e.jsx(n,{value:"xml-to-json",children:"XML to JSON - Transform XML to JSON"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:Z,size:"sm",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Create Policy"]}),e.jsx(g,{variant:"outline",onClick:()=>F(!1),size:"sm",children:"Cancel"})]})]})})}),v.length===0&&!M?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No policies configured"}):e.jsx("div",{className:"space-y-2",children:v.map(s=>e.jsx(r,{className:"border-l-4 border-l-green-500",children:e.jsxs(c,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(u,{variant:"outline",title:"Policy type - determines functionality and cannot be changed",children:s.type}),e.jsx("span",{className:"font-medium",children:s.name}),s.enabled?e.jsx(u,{variant:"default",children:"Enabled"}):e.jsx(u,{variant:"outline",children:"Disabled"}),s.executionFlow&&e.jsx(u,{variant:"secondary",className:"text-xs",children:s.executionFlow})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",s.type,s.executionFlow&&` • Execution: ${s.executionFlow}`,s.condition&&` • Condition: ${s.condition}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{checked:s.enabled,onCheckedChange:a=>R(s.id,"enabled",a)}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>ee(s.id),children:e.jsx(K,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs",children:"Execution Flow"}),e.jsxs(P,{value:s.executionFlow||"RequestFlow",onValueChange:a=>R(s.id,"executionFlow",a),children:[e.jsx(C,{className:"h-8 text-xs",children:e.jsx(w,{})}),e.jsxs(A,{children:[e.jsx(n,{value:"PreFlow",children:"PreFlow (Auth)"}),e.jsx(n,{value:"RequestFlow",children:"RequestFlow (Quota/Rate Limit)"}),e.jsx(n,{value:"PostFlow",children:"PostFlow (Transform/CORS)"}),e.jsx(n,{value:"ErrorFlow",children:"ErrorFlow (Error Handling)"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs",children:"Condition (optional)"}),e.jsx(o,{value:s.condition||"",onChange:a=>R(s.id,"condition",a.target.value),placeholder:"e.g., request.path = '/api'",className:"h-8 text-xs"})]})]})})]})},s.id))})]})]})}),e.jsx(b,{value:"monitoring",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"API Analytics"}),e.jsx(y,{children:"Monitor API proxy performance and usage"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:l.map((s,a)=>e.jsxs(r,{className:"border-l-4 border-l-purple-500",children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-base",children:s.name})}),e.jsx(c,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold",children:(s.requestCount||0).toLocaleString()}),e.jsx(z,{value:Math.min((s.requestCount||0)/1e4*100,100),className:"h-2 mt-2"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Errors"}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:(s.errorCount||0).toLocaleString()}),e.jsx(z,{value:Math.min((s.errorCount||0)/100*100,100),className:"h-2 mt-2"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Avg Response Time"}),e.jsxs("p",{className:"text-2xl font-bold",children:[(s.avgResponseTime||0).toFixed(0)," ms"]}),e.jsx(z,{value:Math.min((s.avgResponseTime||0)/1e3*100,100),className:"h-2 mt-2"})]})]})})]},a))})})]})}),e.jsx(b,{value:"settings",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Apigee Settings"}),e.jsx(y,{children:"Configure organization and API access"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Organization"}),e.jsx(o,{value:L,onChange:s=>m({organization:s.target.value}),placeholder:"my-organization"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Default Environment"}),e.jsxs(P,{value:$,onValueChange:s=>m({environment:s}),children:[e.jsx(C,{children:e.jsx(w,{})}),e.jsxs(A,{children:[e.jsx(n,{value:"dev",children:"Development"}),e.jsx(n,{value:"stage",children:"Staging"}),e.jsx(n,{value:"prod",children:"Production"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"API Key"}),e.jsx(o,{type:"password",value:H,onChange:s=>m({apiKey:s.target.value}),placeholder:"Enter Apigee API key"})]})]})]})})]})]})})}export{me as ApigeeConfigAdvanced};
