import{K as ks,r as D,j as e,l as E,Z as Zs,M as Js,R as en,N as sn,U as Fs,O as nn,Q as tn,V as an,W as rn,X as ln,Y as cn,_ as on,$ as dn,a0 as mn,u as hn,a1 as un,e as ls,D as xn,a2 as fn,a3 as pn,B as Ae,S as cs,T as jn,b as gn,c as Ne,a4 as Nn,a5 as bn,a6 as ws,A as yn,d as vn,f as be,C as ee,h as te,i as ae,k as re,P as _e,m as ie,L as z,I as V,o as Ee,q as De,s as Me,t as ke,v as Fe,w as Q,n as ue,a7 as Ve,a8 as $n,a9 as Tn,aa as En,ab as Ke,F as os,ac as Cs,y as ds,z as ms,E as hs,G as us,H as xs,ad as wn,ae as Cn,af as Ss,ag as Sn,x as fs}from"./index-C50GjM4J.js";import{T as We}from"./textarea-DH0yP9d7.js";import{u as In}from"./usePortValidation-BgqOeqN_.js";import{a as K,s as q}from"./toast-CdfuIZXR.js";import{v as Ln}from"./requiredFields-BLgUUVkB.js";import{A as ps,a as js,b as gs}from"./alert-CSFenUrK.js";import{F as Ns}from"./file-code-zpSfeDby.js";import{T as Ze}from"./table-CCCxI6cB.js";import{U as Is}from"./users-DueoQ0eF.js";import{P as bs}from"./pen-UnUGj2jw.js";import{K as ys}from"./key-CZB3aZ-2.js";const Rn=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Ls=ks("folder-tree",Rn);const An=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],_n=ks("layout-grid",An);function Dn(n){if(!n)return null;const h=n.match(/FOREIGN\s+KEY\s*\(([^)]+)\)\s*REFERENCES\s+(?:(\w+)\.)?(\w+)\s*\(([^)]+)\)/i);if(!h)return null;const f=h[1].split(",").map(c=>c.trim().replace(/["`]/g,"")),N=h[2]?.trim(),l=h[3].trim(),x=h[4].split(",").map(c=>c.trim().replace(/["`]/g,"")),t=n.match(/ON\s+DELETE\s+(CASCADE|SET\s+NULL|SET\s+DEFAULT|RESTRICT|NO\s+ACTION)/i),d=n.match(/ON\s+UPDATE\s+(CASCADE|SET\s+NULL|SET\s+DEFAULT|RESTRICT|NO\s+ACTION)/i),a=n.match(/CONSTRAINT\s+(\w+)/i);return{name:a?a[1]:void 0,table:"",columns:f,referencedTable:N?`${N}.${l}`:l,referencedColumns:x,onDelete:t?t[1].toUpperCase():void 0,onUpdate:d?d[1].toUpperCase():void 0}}function Mn(n,h,f=220,N=50,l){let x,t;if(l)x=l.x,t=l.y;else{const c=Math.floor(Math.sqrt(n.name.length)||1);x=h%c*300+100,t=Math.floor(h/c)*300+100}const d=n.columns.map((a,c)=>({name:a.name,type:a.type,default:a.default||"",check:"",primary:a.primaryKey||!1,unique:!1,notNull:!a.nullable,increment:a.type.toUpperCase().includes("SERIAL")||a.type.toUpperCase().includes("IDENTITY"),comment:"",id:`field_${n.name}_${a.name}_${c}`}));return{id:`table_${n.schema}_${n.name}`,name:n.schema!=="public"?`${n.schema}.${n.name}`:n.name,x,y:t,locked:!1,fields:d,comment:"",indices:[],color:"#175e7a",hidden:!1}}function kn(n,h){const f=[],N=new Map;return n.forEach((l,x)=>{N.set(`${l.schema}.${l.name}`,{table:l,drawDB:h[x]})}),n.forEach(l=>{const x=`${l.schema}.${l.name}`,t=N.get(x);t&&l.constraints.forEach(d=>{const a=Dn(d);if(!a)return;const c=a.referencedTable,r=Array.from(N.values()).find(R=>R.table.name===c||`${R.table.schema}.${R.table.name}`===c);if(!r)return;const p=t.drawDB.fields.find(R=>a.columns.includes(R.name)),j=r.drawDB.fields.find(R=>a.referencedColumns.includes(R.name));if(!p||!j)return;const y="one_to_many",g=a.onDelete||"No action";let b="No action";g.includes("CASCADE")?b="Cascade":g.includes("SET NULL")?b="Set null":g.includes("SET DEFAULT")?b="Set default":g.includes("RESTRICT")&&(b="Restrict"),f.push({id:`rel_${t.drawDB.id}_${r.drawDB.id}_${p.id}`,startTableId:t.drawDB.id,startFieldId:p.id,endTableId:r.drawDB.id,endFieldId:j.id,cardinality:y,constraint:b})})}),f}const Rs=220,Ps=300,As=250;function _s(n){return 57+n.fields.length*36}function Ds(n,h){const f=n.x+Rs/2,N=n.y+_s(n)/2,l=h.x+Rs/2,x=h.y+_s(h)/2;return Math.sqrt(Math.pow(l-f,2)+Math.pow(x-N,2))}function Fn(n,h=100,f=100){if(n.length===0)return n;const N=Math.ceil(Math.sqrt(n.length)),l=Ps;return n.map((x,t)=>{const d=t%N,a=Math.floor(t/N);return{...x,x:h+d*l,y:f+a*l}})}function Pn(n,h,f=50){if(n.length===0)return n;const N=500,l=400,x=Math.max(200,n.length*30);let t=n.map((a,c)=>{if(a.x===0&&a.y===0){const r=2*Math.PI*c/n.length;return{...a,x:N+x*Math.cos(r),y:l+x*Math.sin(r)}}return a});const d=new Map;h.forEach(a=>{d.has(a.startTableId)||d.set(a.startTableId,[]),d.has(a.endTableId)||d.set(a.endTableId,[]),d.get(a.startTableId).push(a.endTableId),d.get(a.endTableId).push(a.startTableId)});for(let a=0;a<f;a++){const c=t.map(()=>({x:0,y:0}));for(let p=0;p<t.length;p++)for(let j=p+1;j<t.length;j++){const y=t[p],g=t[j],b=Ds(y,g);if(b<As){const R=Math.atan2(g.y-y.y,g.x-y.x),H=(As-b)*.1;c[p].x-=Math.cos(R)*H,c[p].y-=Math.sin(R)*H,c[j].x+=Math.cos(R)*H,c[j].y+=Math.sin(R)*H}}h.forEach(p=>{const j=t.findIndex(I=>I.id===p.startTableId),y=t.findIndex(I=>I.id===p.endTableId);if(j===-1||y===-1)return;const g=t[j],b=t[y],R=Ds(g,b),H=Ps;if(R>H){const I=Math.atan2(b.y-g.y,b.x-g.x),W=(R-H)*.05;c[j].x+=Math.cos(I)*W,c[j].y+=Math.sin(I)*W,c[y].x-=Math.cos(I)*W,c[y].y-=Math.sin(I)*W}});const r=.8;t=t.map((p,j)=>{const y=p.x+c[j].x*r,g=p.y+c[j].y*r;return{...p,x:Math.max(50,Math.min(y,2e3)),y:Math.max(50,Math.min(g,2e3))}})}return t}function Un(n,h){if(n.length===0)return n;const f=new Map;n.forEach(p=>{f.set(p.id,new Set)}),h.forEach(p=>{f.get(p.endTableId)?.add(p.startTableId)});const N=[],l=new Set,x=new Set;function t(p,j){if(x.has(p)||l.has(p))return j;x.add(p);let y=j;for(f.get(p)?.forEach(g=>{const b=t(g,j);y=Math.max(y,b+1)}),x.delete(p),l.add(p);N.length<=y;)N.push([]);return N[y].push(p),y}n.forEach(p=>{l.has(p.id)||t(p.id,0)});const d=new Map(n.map(p=>[p.id,p])),a=[],c=400,r=300;return N.forEach((p,j)=>{p.forEach((y,g)=>{const b=d.get(y);b&&a.push({...b,x:100+g*r,y:100+j*c})})}),n.forEach(p=>{a.find(j=>j.id===p.id)||a.push({...p,x:100+a.length*r,y:100})}),a}function On(n,h,f="hierarchical"){if(n.length===0)return n;switch(f){case"grid":return Fn(n);case"force":return Pn(n,h);case"hierarchical":default:return Un(n,h)}}const Be=220,qe=50,we=36,Qe=7;function Ms(n){return qe+Qe+n.fields.length*we}function Kn(n,h,f,N){const l=Be,x=1;let t=n.x,d=n.y+f*we+qe+Qe+we/2,a=h.x,c=h.y+N*we+qe+Qe+we/2,r=10*x;const p=(a+t+l)/2,j=a+l<t?a+l:a;if(Math.abs(d-c)<=36*x&&(r=Math.abs(c-d)/3,r<=2)){if(t+l<=a)return`M ${t+l} ${d} L ${a} ${c+.1}`;if(a+l<t)return`M ${t} ${d} L ${a+l} ${c+.1}`}return d<=c?t+l<=a?`M ${t+l} ${d} L ${p-r} ${d} A ${r} ${r} 0 0 1 ${p} ${d+r} L ${p} ${c-r} A ${r} ${r} 0 0 0 ${p+r} ${c} L ${j} ${c}`:a<=t+l&&t<=a?`M ${t+l} ${d} L ${a+l} ${d} A ${r} ${r} 0 0 1 ${a+l+r} ${d+r} L ${a+l+r} ${c-r} A ${r} ${r} 0 0 1 ${a+l} ${c} L ${a+l} ${c}`:a+l>=t&&a+l<=t+l?`M ${t} ${d} L ${a-r} ${d} A ${r} ${r} 0 0 0 ${a-r-r} ${d+r} L ${a-r-r} ${c-r} A ${r} ${r} 0 0 0 ${a-r} ${c} L ${a} ${c}`:`M ${t} ${d} L ${p+r} ${d} A ${r} ${r} 0 0 0 ${p} ${d+r} L ${p} ${c-r} A ${r} ${r} 0 0 1 ${p-r} ${c} L ${j} ${c}`:t+l<=a?`M ${t+l} ${d} L ${p-r} ${d} A ${r} ${r} 0 0 0 ${p} ${d-r} L ${p} ${c+r} A ${r} ${r} 0 0 1 ${p+r} ${c} L ${j} ${c}`:t+l>=a&&t+l<=a+l?`M ${t} ${d} L ${t-r-r} ${d} A ${r} ${r} 0 0 1 ${t-r-r-r} ${d-r} L ${t-r-r-r} ${c+r} A ${r} ${r} 0 0 1 ${t-r-r} ${c} L ${j} ${c}`:t>=a&&t<=a+l?`M ${t+l} ${d} L ${t+l+r} ${d} A ${r} ${r} 0 0 0 ${t+l+r+r} ${d-r} L ${t+l+r+r} ${c+r} A ${r} ${r} 0 0 0 ${t+l+r} ${c} L ${j} ${c}`:`M ${t} ${d} L ${p+r} ${d} A ${r} ${r} 0 0 1 ${p} ${d-r} L ${p} ${c+r} A ${r} ${r} 0 0 0 ${p-r} ${c} L ${j} ${c}`}function Bn({tables:n,tablePositions:h={},onTableUpdate:f,onRelationshipAdd:N,onRelationshipDelete:l,onRelationshipsChange:x,onAutoArrange:t}){const d=D.useRef(null),a=D.useRef(null),[c,r]=D.useState({x:0,y:0,scale:1}),[p,j]=D.useState(null),[y,g]=D.useState(null),[b,R]=D.useState(null),[H,I]=D.useState(null),[W,v]=D.useState(null),M=D.useMemo(()=>n.map(($,A)=>{const _=`${$.schema}.${$.name}`,C=h[_];return Mn($,A,220,50,C)}),[n,h]),P=D.useMemo(()=>kn(n,M),[n,M]);D.useEffect(()=>{x?.(P)},[P,x]);const O=D.useMemo(()=>{if(M.length===0)return{x:0,y:0,width:1e3,height:1e3};const $=Math.min(...M.map(S=>S.x))-200,A=Math.min(...M.map(S=>S.y))-200,_=Math.max(...M.map(S=>S.x+Be))+200,C=Math.max(...M.map(S=>S.y+Ms(S)))+200;return{x:$,y:A,width:_-$,height:C-A}},[M]),ye=$=>{if($.button!==0||$.target.closest(".table-box")||b)return;const A=$.clientX,_=$.clientY,C=c.x,S=c.y,k=me=>{const le=(me.clientX-A)/c.scale,ve=(me.clientY-_)/c.scale;r({...c,x:C+le,y:S+ve})},B=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",B)};document.addEventListener("mousemove",k),document.addEventListener("mouseup",B)},Pe=($,A,_=!1)=>{if(!_&&b)return;$.stopPropagation();const C=M.find(Y=>Y.id===A);if(!C)return;const S=d.current;if(!S)return;const k=S.getBoundingClientRect(),B=S.viewBox.baseVal,me=($.clientX-k.left)/k.width*B.width+B.x,le=($.clientY-k.top)/k.height*B.height+B.y,ve=(me-c.x/c.scale)/c.scale,$e=(le-c.y/c.scale)/c.scale,xe=ve-C.x,ce=$e-C.y;j({id:A,offset:{x:xe,y:ce}}),g(A);const fe=Y=>{const Se=d.current;if(!Se)return;const Te=Se.getBoundingClientRect(),ge=Se.viewBox.baseVal,Z=(Y.clientX-Te.left)/Te.width*ge.width+ge.x,Ue=(Y.clientY-Te.top)/Te.height*ge.height+ge.y,Ie=(Z-c.x/c.scale)/c.scale,X=(Ue-c.y/c.scale)/c.scale,Ye=Ie-xe,es=X-ce;f?.(A,{x:Ye,y:es})},ne=()=>{j(null),document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",ne)};document.addEventListener("mousemove",fe),document.addEventListener("mouseup",ne)},oe=($,A,_,C)=>{if($.stopPropagation(),b){if(b.tableId!==A&&b.fieldId!==_){const S=M.find(B=>B.id===b.tableId),k=M.find(B=>B.id===A);if(S&&k){const B={id:`rel_${b.tableId}_${A}_${b.fieldId}`,startTableId:b.tableId,startFieldId:b.fieldId,endTableId:A,endFieldId:_,cardinality:"one_to_many",constraint:"No action"};N?.(B)}}R(null),I(null)}else{const S=M.find(me=>me.id===A);if(!S)return;const k=S.y+qe+Qe+(C+.5)*we,B=S.x+Be/2;R({tableId:A,fieldId:_,x:B,y:k})}},J=$=>{if(b&&d.current){const A=d.current,_=A.getBoundingClientRect(),C=A.viewBox.baseVal,S=($.clientX-_.left)/_.width*C.width+C.x,k=($.clientY-_.top)/_.height*C.height+C.y;I({x:S,y:k})}},se=()=>{r({...c,scale:Math.min(c.scale*1.2,3)})},Ce=()=>{r({...c,scale:Math.max(c.scale/1.2,.3)})},de=()=>{r({x:0,y:0,scale:1})},U=()=>{r({x:0,y:0,scale:1})},Je=()=>{if(!d.current)return;const $=d.current.cloneNode(!0);$.setAttribute("width",O.width.toString()),$.setAttribute("height",O.height.toString()),$.setAttribute("viewBox",`${O.x} ${O.y} ${O.width} ${O.height}`);const A=new XMLSerializer().serializeToString($),_=new Blob([A],{type:"image/svg+xml;charset=utf-8"}),C=URL.createObjectURL(_),S=document.createElement("a");S.href=C,S.download="schema-diagram.svg",document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(C)},je=()=>{if(M.length===0)return;const $=On(M,P,"hierarchical"),A={};$.forEach(_=>{const C=_.id.replace(/^table_/,"").replace(/_/g,".");A[C]={x:_.x,y:_.y}}),t?.(A)};return n.length===0?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px] border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No tables to display"}),e.jsx("p",{className:"text-sm",children:"Add tables in the Tables tab to see the schema diagram"})]})}):e.jsxs("div",{ref:a,className:"relative w-full h-full border rounded-lg bg-background overflow-hidden",children:[e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-2 bg-background/80 backdrop-blur-sm border rounded-lg p-1",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:se,title:"Zoom In",children:e.jsx(Zs,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:Ce,title:"Zoom Out",children:e.jsx(Js,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:de,title:"Reset View",children:e.jsx(en,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:U,title:"Fit to Screen",children:e.jsx(sn,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:Je,title:"Export SVG",children:e.jsx(Fs,{className:"h-4 w-4"})}),t&&e.jsx(E,{variant:"ghost",size:"sm",onClick:je,title:"Auto Arrange Tables",children:e.jsx(_n,{className:"h-4 w-4"})})]}),e.jsx("svg",{ref:d,className:`w-full h-full ${p?"cursor-grabbing":b?"cursor-crosshair":"cursor-grab"}`,viewBox:`${O.x} ${O.y} ${O.width} ${O.height}`,preserveAspectRatio:"xMidYMid meet",onMouseDown:ye,onMouseMove:J,onMouseLeave:()=>{b&&(R(null),I(null))},children:e.jsxs("g",{transform:`translate(${c.x/c.scale}, ${c.y/c.scale}) scale(${c.scale})`,children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"24",height:"24",patternUnits:"userSpaceOnUse",children:e.jsx("circle",{cx:"12",cy:"12",r:"0.85",fill:"currentColor",className:"text-muted-foreground/20"})})}),e.jsx("rect",{x:O.x,y:O.y,width:O.width,height:O.height,fill:"url(#grid)"}),b&&H&&e.jsx("path",{d:`M ${b.x} ${b.y} L ${H.x} ${H.y}`,fill:"none",stroke:"hsl(var(--primary))",strokeWidth:"2",strokeDasharray:"5,5",opacity:"0.7",pointerEvents:"none"}),P.map($=>{const A=M.find(Z=>Z.id===$.startTableId),_=M.find(Z=>Z.id===$.endTableId);if(!A||!_)return null;const C=A.fields.findIndex(Z=>Z.id===$.startFieldId),S=_.fields.findIndex(Z=>Z.id===$.endFieldId);if(C===-1||S===-1)return null;const k=Kn(A,_,C,S);A.fields[C],_.fields[S];const B=A.x+Be/2,me=A.y+qe+Qe+(C+.5)*we,le=_.x+Be/2,ve=_.y+qe+Qe+(S+.5)*we,$e=(B+le)/2,xe=(me+ve)/2;let ce="1",fe="1";switch($.cardinality){case"one_to_many":ce="1",fe="n";break;case"many_to_one":ce="n",fe="1";break;case"one_to_one":ce="1",fe="1";break}const ne=20,Y=B<le?B+ne:B-ne,Se=me,Te=le>B?le-ne:le+ne,ge=ve;return e.jsxs("g",{className:"relationship-group",children:[e.jsx("path",{d:k,fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-muted-foreground/60 hover:text-primary/60 transition-colors cursor-pointer",markerEnd:"url(#arrowhead)",onClick:Z=>{Z.stopPropagation(),v($.id)}}),e.jsx("text",{x:Y,y:Se,fill:"currentColor",fontSize:"14",fontWeight:"bold",textAnchor:"middle",className:"text-foreground pointer-events-none",style:{userSelect:"none"},children:ce}),e.jsx("text",{x:Te,y:ge,fill:"currentColor",fontSize:"14",fontWeight:"bold",textAnchor:"middle",className:"text-foreground pointer-events-none",style:{userSelect:"none"},children:fe}),$.constraint!=="No action"&&e.jsxs("g",{children:[e.jsx("circle",{cx:$e+45,cy:xe-10,r:"8",fill:"hsl(var(--primary))",style:{pointerEvents:"none"}}),e.jsx("text",{x:$e+45,y:xe-6,fill:"white",fontSize:"8",fontWeight:"bold",textAnchor:"middle",style:{userSelect:"none",pointerEvents:"none"},children:$.constraint==="Cascade"?"C":$.constraint==="Restrict"?"R":$.constraint==="Set null"?"N":"D"})]})]},$.id)}),e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3, 0 6",fill:"currentColor",className:"text-muted-foreground/60"})})}),M.map($=>{const A=Ms($),_=y===$.id;return e.jsx("g",{className:"table-box",children:e.jsx("foreignObject",{x:$.x,y:$.y,width:Be,height:A,children:e.jsxs("div",{className:`border-2 rounded-lg transition-all ${_?"border-primary shadow-lg":"border-border hover:border-primary/50"} bg-card text-card-foreground`,children:[e.jsx("div",{className:"h-[7px] rounded-t-lg",style:{backgroundColor:$.color}}),e.jsx("div",{className:"px-3 py-2 font-semibold text-sm border-b bg-muted/50 cursor-move select-none",onMouseDown:C=>Pe(C,$.id,!0),title:"ÐŸÐµÑ€ÐµÑ‚Ð°Ñ‰Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹",children:$.name}),e.jsx("div",{className:"divide-y",children:$.fields.map((C,S)=>e.jsxs("div",{className:`px-3 py-1.5 text-xs flex items-center gap-2 min-h-[36px] cursor-pointer transition-colors ${b?.fieldId===C.id?"bg-primary/20 border-l-2 border-primary":"hover:bg-muted/50"}`,onClick:k=>{k.stopPropagation(),oe(k,$.id,C.id,S)},onMouseDown:k=>{k.stopPropagation()},title:b?"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ð¾Ð»Ðµ Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ²ÑÐ·Ð¸":"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ²ÑÐ·Ð¸",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:C.name}),e.jsx("span",{className:"text-muted-foreground ml-2",children:C.type})]}),e.jsxs("div",{className:"flex gap-1",children:[C.primary&&e.jsx("span",{className:"text-primary",title:"Primary Key",children:"ðŸ”‘"}),C.notNull&&e.jsx("span",{className:"text-muted-foreground",title:"NOT NULL",children:"*"}),C.unique&&e.jsx("span",{className:"text-muted-foreground",title:"UNIQUE",children:"U"})]})]},C.id))})]})})},$.id)})]})}),e.jsx(nn,{open:!!W,onOpenChange:$=>!$&&v(null),children:e.jsxs(tn,{children:[e.jsxs(an,{children:[e.jsx(rn,{children:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ²ÑÐ·ÑŒ?"}),e.jsx(ln,{children:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ ÑÐ²ÑÐ·ÑŒ? Ð­Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½ÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ."})]}),e.jsxs(cn,{children:[e.jsx(on,{children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"}),e.jsx(dn,{onClick:()=>{W&&(l?.(W),v(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})]})]})})]})}function qn(n){return n?n.replace(/'/g,"''"):""}function Qn(n,h){if(!h)return"";if(h.includes("(")&&h.includes(")"))return h;const f=h.toUpperCase();return["NULL","CURRENT_TIMESTAMP","CURRENT_DATE","NOW()"].includes(f)?h:["VARCHAR","TEXT","CHAR","CHARACTER"].some(x=>n.type.toUpperCase().includes(x))?`'${qn(h)}'`:h}function zn(n,h=[]){const f=[];n.forEach(l=>{const x=l.columns.map(r=>{let p=`	"${r.name}" ${r.type}`;return r.nullable||(p+=" NOT NULL"),r.default&&(p+=` DEFAULT ${Qn(r,r.default)}`),p}).join(`,
`),t=l.columns.filter(r=>r.primaryKey),d=t.length>0?`,
	PRIMARY KEY(${t.map(r=>`"${r.name}"`).join(", ")})`:"",a=l.indexes.map(r=>`-- Index: ${r}`).join(`
`),c=`CREATE TABLE IF NOT EXISTS "${l.schema}"."${l.name}" (
${x}${d}
);`;f.push(c),a&&f.push(a)});const N=h.map(l=>{const x=l.startTableId.replace(/^table_/,"").replace(/_/g,"."),t=l.endTableId.replace(/^table_/,"").replace(/_/g,"."),d=n.find(y=>{const g=`${y.schema}.${y.name}`;return l.startTableId===`table_${y.schema}_${y.name}`||x===g}),a=n.find(y=>{const g=`${y.schema}.${y.name}`;return l.endTableId===`table_${y.schema}_${y.name}`||t===g});if(!d||!a)return"";const c=d.columns.find((y,g)=>{const b=`field_${d.name}_${y.name}_${g}`;return l.startFieldId===b||l.startFieldId.includes(y.name)}),r=a.columns.find((y,g)=>{const b=`field_${a.name}_${y.name}_${g}`;return l.endFieldId===b||l.endFieldId.includes(y.name)});if(!c||!r)return"";const p=l.constraint==="Cascade"?"CASCADE":l.constraint==="Restrict"?"RESTRICT":l.constraint==="Set null"?"SET NULL":l.constraint==="Set default"?"SET DEFAULT":"NO ACTION",j=p;return`ALTER TABLE "${d.schema}"."${d.name}"
ADD FOREIGN KEY("${c.name}") REFERENCES "${a.schema}"."${a.name}"("${r.name}")
ON UPDATE ${j} ON DELETE ${p};`}).filter(Boolean);return f.push(...N),f.join(`

`)}function Us(n,h=[]){const f=n.map(l=>{const x=l.columns.map(t=>`		${t.type} ${t.name}${t.primaryKey?" PK":""}${t.nullable?"":' "not null"'}`).join(`
`);return`	${l.schema!=="public"?`${l.schema}_`:""}${l.name} {
${x}
	}`}).join(`

`),N=h.map(l=>{const x=n.find(r=>l.startTableId===`table_${r.schema}_${r.name}`),t=n.find(r=>l.endTableId===`table_${r.schema}_${r.name}`);if(!x||!t)return"";const d=x.schema!=="public"?`${x.schema}_${x.name}`:x.name,a=t.schema!=="public"?`${t.schema}_${t.name}`:t.name;let c="||--o{";return l.cardinality==="one_to_one"?c="||--||":l.cardinality==="many_to_one"&&(c="}o--||"),`	${d} ${c} ${a} : references`}).filter(Boolean).join(`
`);return`erDiagram
${N?`${N}

`:""}${f}`}function Hn(n,h=[]){const f=n.map(l=>{const x=l.columns.map(t=>{let d=`	${t.name} ${t.type.toLowerCase()}`;const a=[];return t.primaryKey&&a.push("pk"),t.nullable||a.push("not null"),t.default&&a.push(`default: ${t.default}`),a.length>0&&(d+=` [${a.join(", ")}]`),d}).join(`
`);return`Table "${l.schema}"."${l.name}" {
${x}
}`}).join(`

`),N=h.map(l=>{const x=n.find(j=>l.startTableId===`table_${j.schema}_${j.name}`),t=n.find(j=>l.endTableId===`table_${j.schema}_${j.name}`);if(!x||!t)return"";const d=x.columns.find((j,y)=>{const g=`field_${x.name}_${j.name}_${y}`;return l.startFieldId===g||l.startFieldId.includes(j.name)}),a=t.columns.find((j,y)=>{const g=`field_${t.name}_${j.name}_${y}`;return l.endFieldId===g||l.endFieldId.includes(j.name)});if(!d||!a)return"";let c="<";l.cardinality==="one_to_one"?c="-":l.cardinality==="many_to_one"&&(c=">");const r=l.constraint.toLowerCase(),p=r;return`Ref "${l.id}" {
	"${x.schema}"."${x.name}".${d.name} ${c} "${t.schema}"."${t.name}".${a.name} [delete: ${r}, update: ${p}]
}`}).filter(Boolean).join(`

`);return`${f}${N?`

${N}`:""}`}function Vn(n,h=[],f="Database Schema"){const N=n.map(d=>`	- [${d.name}](#${d.name.toLowerCase().replace(/\s+/g,"-")})`).join(`
`),l=n.map(d=>{const a=d.columns.map(c=>{const r=[c.primaryKey?"ðŸ”‘ PK":"",c.nullable?"null":"not null",c.default?`default: ${c.default}`:""].filter(Boolean).join(", ");return`| **${c.name}** | ${c.type} | ${r} |`}).join(`
`);return`### ${d.name}

| Name | Type | Settings |
|------|------|----------|
${a}`}).join(`

`),x=h.map(d=>{const a=n.find(r=>d.startTableId===`table_${r.schema}_${r.name}`),c=n.find(r=>d.endTableId===`table_${r.schema}_${r.name}`);return!a||!c?"":`- **${a.name}** to **${c.name}**: ${d.cardinality} (${d.constraint})`}).filter(Boolean).join(`
`),t=Us(n,h);return`# ${f} Documentation

## Summary

${N}

## Table Structure

${l}

## Relationships

${x}

## Database Diagram

\`\`\`mermaid
${t}
\`\`\`
`}function Yn(n){if(!n)return"TEXT";if(typeof n=="string")return n.toUpperCase();if(n.dataType){const h=n.dataType.toUpperCase(),f=n.length?.value?.[0]?.value;return f?`${h}(${f})`:h}return"TEXT"}function Xn(n){if(n){if(typeof n=="string")return n;if(n.value!==void 0)return String(n.value);if(n.keyword)return n.keyword;if(n.type==="function")return n.name?.name||n.name}}function Gn(n,h,f){if(!n||!n.column)return null;const N=n.column,l=Yn(n.definition?.dataType||n.dataType);let x=!0,t=!1,d;(n.definition?.nullable===!1||n.nullable===!1)&&(x=!1),(n.definition?.constraint?.some(c=>c.type==="PRIMARY KEY")||n.constraint?.some(c=>c.type==="PRIMARY KEY"))&&(t=!0,x=!1);const a=n.definition?.default||n.default;return a&&(d=Xn(a)),(l.includes("SERIAL")||l.includes("AUTO_INCREMENT"))&&(d||(d="nextval")),{name:N,type:l,nullable:x,default:d,primaryKey:t}}function Wn(n){if(!n||n.type!=="create"||n.table===null)return null;const h=n.table?.[0];if(!h)return null;const f=h.table||h.name,N=h.db||"public";if(!f)return null;const l=[],x=n.create_definitions||n.definition||[],t=[];x.forEach(a=>{a.type==="PRIMARY KEY"&&a.columns&&a.columns.forEach(c=>{c.column&&t.push(c.column)})}),x.forEach(a=>{if(a.column){const c=Gn(a);c&&(t.includes(c.name)&&(c.primaryKey=!0,c.nullable=!1),l.push(c))}});const d=[];return x.forEach(a=>{(a.type==="INDEX"||a.type==="UNIQUE INDEX")&&a.name&&d.push(a.name)}),{name:f,schema:N,columns:l,indexes:d,constraints:[],data:[]}}function Zn(n,h){if(!n||n.type!=="alter"||!n.table)return null;const f=n.table[0];if(!f)return null;const N=f.table||f.name,l=f.db||"public",t=(n.action||[]).find(P=>P.resource==="foreign key"||P.type==="ADD FOREIGN KEY");if(!t)return null;const d=t.column||t.columns?.[0]?.column;if(!d)return null;const a=t.references;if(!a)return null;const c=a.table?.[0]?.table||a.table,r=a.table?.[0]?.db||a.db||"public",p=a.column?.[0]?.column||a.column;if(!c||!p)return null;const j=h.find(P=>P.name===N&&P.schema===l),y=h.find(P=>P.name===c&&P.schema===r);if(!j||!y)return null;const g=j.columns.findIndex(P=>P.name===d),b=y.columns.findIndex(P=>P.name===p);if(g===-1||b===-1)return null;let R="No action";if(t.onDelete){const P=t.onDelete.toUpperCase();P==="CASCADE"?R="Cascade":P==="RESTRICT"?R="Restrict":P==="SET NULL"?R="Set null":P==="SET DEFAULT"&&(R="Set default")}const H=y.columns[b]?.primaryKey?"many_to_one":"one_to_many",I=`table_${l}_${N}`,W=`table_${r}_${c}`,v=`field_${N}_${d}_${g}`,M=`field_${c}_${p}_${b}`;return{id:`rel_${I}_${v}_${W}_${M}`,startTableId:I,endTableId:W,startFieldId:v,endFieldId:M,cardinality:H,constraint:R}}function Jn(n){const h={tables:[],relationships:[],errors:[]};if(!n||!n.trim())return h.errors.push("SQL string is empty"),h;try{const f=new mn.Parser,N=n.split(";").map(l=>l.trim()).filter(l=>l.length>0);for(const l of N)try{const x=f.astify(l),t=Array.isArray(x)?x:[x];for(const d of t)if(d.type==="create"&&d.keyword==="table"){const a=Wn(d);a&&(h.tables.some(r=>r.name===a.name&&r.schema===a.schema)?h.errors.push(`Table "${a.schema}.${a.name}" already exists`):h.tables.push(a))}}catch{l.toUpperCase().trim().startsWith("CREATE TABLE")&&h.errors.push(`Failed to parse statement: ${l.substring(0,50)}...`)}for(const l of N)try{const x=f.astify(l),t=Array.isArray(x)?x:[x];for(const d of t)if(d.type==="alter"){const a=Zn(d,h.tables);a&&(h.relationships.some(r=>r.id===a.id)||h.relationships.push(a))}}catch{l.toUpperCase().trim().startsWith("ALTER TABLE")&&h.errors.push(`Failed to parse ALTER TABLE statement: ${l.substring(0,50)}...`)}for(const l of N)try{const x=f.astify(l),t=Array.isArray(x)?x:[x];for(const d of t)d.type==="create"&&d.keyword==="table"&&(d.create_definitions||d.definition||[]).forEach(c=>{if(c.type==="FOREIGN KEY"||c.references){const r=d.table?.[0];if(r){const p=r.table||r.name,j=r.db||"public",y=h.tables.find(g=>g.name===p&&g.schema===j);if(y&&c.column){const g=c.column,b=c.references;if(b&&b.table){const R=b.table[0]?.table||b.table,H=b.table[0]?.db||b.db||"public",I=b.column?.[0]?.column||b.column;if(R&&I){const W=h.tables.find(v=>v.name===R&&v.schema===H);if(W){const v=y.columns.findIndex(P=>P.name===g),M=W.columns.findIndex(P=>P.name===I);if(v!==-1&&M!==-1){const P=`table_${j}_${p}`,O=`table_${H}_${R}`,ye=`field_${p}_${g}_${v}`,Pe=`field_${R}_${I}_${M}`;let oe="No action";if(b.onDelete){const de=b.onDelete.toUpperCase();de==="CASCADE"?oe="Cascade":de==="RESTRICT"?oe="Restrict":de==="SET NULL"?oe="Set null":de==="SET DEFAULT"&&(oe="Set default")}const J=W.columns[M]?.primaryKey?"many_to_one":"one_to_many",se={id:`rel_${P}_${ye}_${O}_${Pe}`,startTableId:P,endTableId:O,startFieldId:ye,endFieldId:Pe,cardinality:J,constraint:oe};h.relationships.some(de=>de.id===se.id)||h.relationships.push(se)}}}}}}}})}catch{}}catch(f){h.errors.push(`Failed to parse SQL: ${f instanceof Error?f.message:String(f)}`)}return h}function et(n){const h=[];return(!n||n.trim().length===0)&&h.push({type:"error",message:"Table name cannot be empty"}),n.length>63&&h.push({type:"warning",message:`Table name "${n}" exceeds 63 characters (PostgreSQL limit)`,table:n}),["SELECT","FROM","WHERE","INSERT","UPDATE","DELETE","CREATE","DROP","ALTER","TABLE","INDEX","VIEW","SCHEMA","DATABASE","USER","ROLE"].includes(n.toUpperCase())&&h.push({type:"warning",message:`Table name "${n}" is a reserved keyword`,table:n}),h}function st(n,h){const f=[];return(!n.name||n.name.trim().length===0)&&f.push({type:"error",message:"Column name cannot be empty",table:h}),n.name.length>63&&f.push({type:"warning",message:`Column name "${n.name}" exceeds 63 characters`,table:h,column:n.name}),(!n.type||n.type.trim().length===0)&&f.push({type:"error",message:`Column "${n.name}" must have a type`,table:h,column:n.name}),n.primaryKey&&n.nullable&&f.push({type:"error",message:`Primary key column "${n.name}" cannot be nullable`,table:h,column:n.name}),n.default&&n.nullable===!1&&!n.default.trim()&&f.push({type:"warning",message:`NOT NULL column "${n.name}" has empty default value`,table:h,column:n.name}),f}function nt(n){const h=[];h.push(...et(n.name)),(!n.schema||n.schema.trim().length===0)&&h.push({type:"error",message:`Table "${n.name}" must have a schema`,table:n.name}),n.columns.length===0&&h.push({type:"error",message:`Table "${n.name}" must have at least one column`,table:n.name});const f=new Set;n.columns.forEach(l=>{f.has(l.name)&&h.push({type:"error",message:`Duplicate column name "${l.name}" in table "${n.name}"`,table:n.name,column:l.name}),f.add(l.name),h.push(...st(l,n.name))});const N=n.columns.filter(l=>l.primaryKey);return N.length===0&&h.push({type:"warning",message:`Table "${n.name}" has no primary key`,table:n.name}),N.length>1,h}function tt(n,h){const f=[],N=h.find(d=>`table_${d.schema}_${d.name}`===n.startTableId),l=h.find(d=>`table_${d.schema}_${d.name}`===n.endTableId);if(N||f.push({type:"error",message:`Relationship references non-existent table: ${n.startTableId}`,relationship:n.id}),l||f.push({type:"error",message:`Relationship references non-existent table: ${n.endTableId}`,relationship:n.id}),!N||!l)return f;const x=N.columns.find((d,a)=>`field_${N.name}_${d.name}_${a}`===n.startFieldId||n.startFieldId.includes(d.name)),t=l.columns.find((d,a)=>`field_${l.name}_${d.name}_${a}`===n.endFieldId||n.endFieldId.includes(d.name));return x||f.push({type:"error",message:`Relationship references non-existent column in table "${N.name}"`,relationship:n.id,table:N.name}),t||f.push({type:"error",message:`Relationship references non-existent column in table "${l.name}"`,relationship:n.id,table:l.name}),!x||!t||(t.primaryKey||f.push({type:"warning",message:`Foreign key references non-primary key column "${t.name}" in table "${l.name}"`,relationship:n.id,table:l.name,column:t.name}),x.type!==t.type&&f.push({type:"warning",message:`Type mismatch: "${x.name}" (${x.type}) references "${t.name}" (${t.type})`,relationship:n.id,table:N.name,column:x.name}),N.name===l.name&&(N.schema,l.schema)),f}function at(n,h=[]){const f=[],N=[],l=new Map;n.forEach(a=>{const c=`${a.schema}.${a.name}`;l.has(c)&&f.push({type:"error",message:`Duplicate table name: "${a.name}" in schema "${a.schema}"`,table:a.name}),l.set(c,a)}),n.forEach(a=>{nt(a).forEach(r=>{r.type==="error"?f.push(r):N.push(r)})}),h.forEach(a=>{tt(a,n).forEach(r=>{r.type==="error"?f.push(r):N.push(r)})});const x=new Set,t=new Set;function d(a){if(t.has(a))return!0;if(x.has(a))return!1;x.add(a),t.add(a);const c=h.filter(r=>r.startTableId===a);for(const r of c)if(d(r.endTableId))return!0;return t.delete(a),!1}return h.forEach(a=>{d(a.startTableId)&&N.push({type:"warning",message:`Circular dependency detected in relationships involving table ${a.startTableId}`,relationship:a.id})}),{valid:f.length===0,errors:f,warnings:N}}function pt({componentId:n}){const{nodes:h,updateNode:f,connections:N}=hn(),l=h.find(s=>s.id===n),x=N.some(s=>s.source===n||s.target===n);if(!l)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const t=l.data.config||{},d=t.host||"localhost",a=t.port||5432,c=t.database||"postgres",r=t.username||"postgres",p=t.password||"",j=t.currentSchema||"public",y=t.schemas||[{name:"public",owner:"postgres"},{name:"information_schema",owner:"postgres"}],g=t.tables||[],b=t.views||[],R=t.roles||[{name:"postgres",login:!0,superuser:!0},{name:"app_user",login:!0,superuser:!1},{name:"readonly",login:!0,superuser:!1}],H=t.sqlQuery||"",I=t.queryResults||[],[W]=D.useState(()=>new un),v=s=>{if(f(n,{data:{...l.data,config:{...t,...s}}}),Object.keys(s).some(m=>["host","port","database","username"].includes(m))){const m={...X};Object.keys(s).forEach(i=>{m[i]&&delete m[i]}),Ye(m)}},[M,P]=D.useState(null),[O,ye]=D.useState(""),[Pe,oe]=D.useState(!1),[J,se]=D.useState([{name:"id",type:"SERIAL",nullable:!1,primaryKey:!0}]),[Ce,de]=D.useState(""),[U,Je]=D.useState(null),[je,$]=D.useState([]),[A,_]=D.useState(!1),[C,S]=D.useState(""),[k,B]=D.useState("sql"),[me,le]=D.useState(!1),[ve,$e]=D.useState(!1),[xe,ce]=D.useState(""),[fe,ne]=D.useState([]),[Y,Se]=D.useState(null),[Te,ge]=D.useState(!1);D.useEffect(()=>{const s=ls.getPostgreSQLEmulationEngine(n);s&&s.updateConfig(t)},[n,t.host,t.port,t.database,t.username,t.tables,t.views,t.schemas]),D.useEffect(()=>{const s=setInterval(()=>{const m=ls.getPostgreSQLEmulationEngine(n);if(m){const i=m.getMetrics();Je(i)}},1e3);return()=>clearInterval(s)},[n]);const{portError:Z,hostError:Ue,portConflict:Ie}=In(h,n,d,a),[X,Ye]=D.useState({}),es=[{field:"host",label:"Host"},{field:"port",label:"Port",validator:s=>typeof s=="number"&&s>0&&s<=65535},{field:"database",label:"Database"},{field:"username",label:"Username"}],pe=()=>{const s=Ln({host:d,port:a,database:c,username:r},es);return Ye(s.errors),s.isValid},Os=()=>{if(!xe||!xe.trim()){q("SQL string is empty");return}try{const s=Jn(xe);if(s.errors.length>0){if(ne(s.errors),s.tables.length===0){q(`Import failed: ${s.errors.join(", ")}`);return}}else ne([]);if(s.tables.length===0){q("No tables found in SQL");return}const i=[...t.tables||g];let o=0;s.tables.forEach(u=>{i.some(w=>w.name===u.name&&w.schema===u.schema)||(i.push(u),o++)}),v({tables:i}),s.relationships.length>0&&$([...je,...s.relationships]),$e(!1),ce(""),ne([]),o>0?K(`Successfully imported ${o} table(s)`):q("All tables already exist")}catch(s){q(`Import failed: ${s instanceof Error?s.message:String(s)}`),ne([s instanceof Error?s.message:String(s)])}},Ks=()=>{if(O&&O.trim()){const s=t.tables||g;if(s.some(o=>o.name===O.trim()&&o.schema===j)){q(`Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° "${O.trim()}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð² ÑÑ…ÐµÐ¼Ðµ "${j}"`);return}const i={name:O.trim(),schema:j,columns:J.map(o=>({...o})),indexes:[],constraints:[],data:[]};v({tables:[...s,i]}),ye(""),se([{name:"id",type:"SERIAL",nullable:!1,primaryKey:!0}]),oe(!1),K(`Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° "${O.trim()}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°`)}},Bs=s=>{const m=[...g],i=m.findIndex(o=>o.name===s&&o.schema===j);i>=0&&(m[i].columns.push({name:"new_column",type:"VARCHAR(255)",nullable:!0,primaryKey:!1}),v({tables:m}),K(`ÐšÐ¾Ð»Ð¾Ð½ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ "${s}"`))},qs=(s,m)=>{const i=[...g],o=i.findIndex(u=>u.name===s&&u.schema===j);if(o>=0&&i[o].columns.length>1){const u=i[o].columns[m]?.name||"ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°";i[o].columns=i[o].columns.filter((T,w)=>w!==m),v({tables:i}),K(`ÐšÐ¾Ð»Ð¾Ð½ÐºÐ° "${u}" ÑƒÐ´Ð°Ð»ÐµÐ½Ð° Ð¸Ð· Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ "${s}"`)}else i[o]?.columns.length===1&&q("ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ")},ze=(s,m,i,o)=>{const u=[...g],T=u.findIndex(w=>w.name===s&&w.schema===j);T>=0&&(u[T].columns[m]={...u[T].columns[m],[i]:o},v({tables:u}))},Qs=(s,m)=>{const i=[...g],o=i.findIndex(u=>u.name===s&&u.schema===j);o>=0&&i[o].constraints&&(i[o].constraints=i[o].constraints.filter((u,T)=>T!==m),v({tables:i}),K(`Constraint ÑƒÐ´Ð°Ð»ÐµÐ½ Ð¸Ð· Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ "${s}"`))},[vs,He]=D.useState(null),[Le,Xe]=D.useState(""),[zs,Ge]=D.useState(!1),$s=()=>{if(Le&&Le.trim()){if(y.some(m=>m.name===Le.trim())){q(`Ð¡Ñ…ÐµÐ¼Ð° "${Le.trim()}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚`);return}v({schemas:[...y,{name:Le.trim(),owner:r}]}),Xe(""),Ge(!1),K(`Ð¡Ñ…ÐµÐ¼Ð° "${Le.trim()}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°`)}},Ts=(s,m,i)=>{const o=y.map(u=>u.name===s?{...u,[m]:i}:u);if(m==="name"&&i!==s){if(y.some(L=>L.name===i&&L.name!==s)){q(`Ð¡Ñ…ÐµÐ¼Ð° "${i}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚`);return}const u=g.map(L=>L.schema===s?{...L,schema:i}:L),T=b.map(L=>L.schema===s?{...L,schema:i}:L);v({schemas:o,tables:u,views:T,currentSchema:s===j?i:j}),K(`Ð¡Ñ…ÐµÐ¼Ð° "${s}" Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð° Ð² "${i}"`)}else v({schemas:o}),m==="owner"&&K(`Ð’Ð»Ð°Ð´ÐµÐ»ÐµÑ† ÑÑ…ÐµÐ¼Ñ‹ "${s}" Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½ Ð½Ð° "${i}"`)},Hs=s=>{if(s===j){q("ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ ÑÑ…ÐµÐ¼Ñƒ. Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ñ€ÑƒÐ³ÑƒÑŽ ÑÑ…ÐµÐ¼Ñƒ.");return}const m=g.some(u=>u.schema===s),i=b.some(u=>u.schema===s);if(m||i){q(`ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ…ÐµÐ¼Ñƒ "${s}" - Ð² Ð½ÐµÐ¹ ÐµÑÑ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ. Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° ÑƒÐ´Ð°Ð»Ð¸Ñ‚Ðµ Ð¸Ñ….`);return}const o=y.filter(u=>u.name!==s);v({schemas:o}),K(`Ð¡Ñ…ÐµÐ¼Ð° "${s}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°`)},[ss,ns]=D.useState(null),[Es,ts]=D.useState(null),Vs=()=>{const s="new_view";if(b.some(i=>i.name===s&&i.schema===j)){q(`ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ "${s}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð² ÑÑ…ÐµÐ¼Ðµ "${j}"`);return}v({views:[...b,{name:s,schema:j,definition:"SELECT * FROM table_name"}]}),K("ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¾")},as=(s,m,i,o)=>{const u=b.map(T=>T.name===s&&T.schema===m?{...T,[i]:o}:T);if(i==="name"||i==="schema"){const T=i==="name"?o:s,w=i==="schema"?o:m;if(u.some(F=>F.name===T&&F.schema===w&&!(F.name===s&&F.schema===m))){q(`ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ "${T}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð² ÑÑ…ÐµÐ¼Ðµ "${w}"`);return}}v({views:u}),i==="name"?K(`ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ "${s}" Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¾ Ð² "${o}"`):i==="definition"&&K(`ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ "${s}" Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾`)},Ys=(s,m)=>{const i=b.filter(o=>!(o.name===s&&o.schema===m));v({views:i}),K(`ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ "${s}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾`)},Xs=()=>{const s="new_role";if(R.some(i=>i.name===s)){q(`Ð Ð¾Ð»ÑŒ "${s}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚`);return}v({roles:[...R,{name:s,login:!1,superuser:!1}]}),K("Ð Ð¾Ð»ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°")},rs=(s,m,i)=>{const o=R.map(u=>u.name===s?{...u,[m]:i}:u);if(m==="name"&&typeof i=="string"&&R.some(u=>u.name===i&&u.name!==s)){q(`Ð Ð¾Ð»ÑŒ "${i}" ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚`);return}v({roles:o}),m==="name"?K(`Ð Ð¾Ð»ÑŒ "${s}" Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð° Ð² "${i}"`):K(`Ð Ð¾Ð»ÑŒ "${s}" Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°`)},Gs=s=>{if(s==="postgres"){q('ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½ÑƒÑŽ Ñ€Ð¾Ð»ÑŒ "postgres"');return}const m=R.filter(i=>i.name!==s);v({roles:m}),K(`Ð Ð¾Ð»ÑŒ "${s}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°`)},he=g.filter(s=>s.schema===j),Ws=b.filter(s=>s.schema===j);return!Ce&&he.length>0&&de(he[0].name),Ce&&!he.find(s=>s.name===Ce)&&de(he[0]?.name||""),e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(xn,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx(fn,{children:"PostgreSQL"}),e.jsxs(pn,{children:["Database: ",c," @ ",d,":",a]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ae,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${x?"bg-green-500 animate-pulse":"bg-gray-400"}`}),x?"Connected":"Not Connected"]}),e.jsxs(E,{size:"sm",variant:"outline",children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Query Tool"]})]})]}),e.jsx(cs,{}),e.jsxs(jn,{defaultValue:"schemas",className:"w-full",children:[e.jsxs(gn,{className:"flex flex-wrap w-full gap-1",children:[e.jsxs(Ne,{value:"schemas",className:"gap-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),"Schemas"]}),e.jsxs(Ne,{value:"tables",className:"gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Tables"]}),e.jsxs(Ne,{value:"diagram",className:"gap-2",children:[e.jsx(Nn,{className:"h-4 w-4"}),"Schema Diagram"]}),e.jsxs(Ne,{value:"data",className:"gap-2",children:[e.jsx(bn,{className:"h-4 w-4"}),"Data Editor"]}),e.jsxs(Ne,{value:"query",className:"gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"Query Tool"]}),e.jsxs(Ne,{value:"views",className:"gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"Views"]}),e.jsxs(Ne,{value:"roles",className:"gap-2",children:[e.jsx(Is,{className:"h-4 w-4"}),"Roles"]}),e.jsxs(Ne,{value:"metrics",className:"gap-2",children:[e.jsx(yn,{className:"h-4 w-4"}),"Metrics"]}),e.jsxs(Ne,{value:"connection",className:"gap-2",children:[e.jsx(vn,{className:"h-4 w-4"}),"Connection"]})]}),e.jsx(be,{value:"schemas",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Database Schemas"}),e.jsx(re,{children:"Schema organization and management"})]}),e.jsxs(E,{size:"sm",onClick:()=>Ge(!0),variant:"outline",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Create Schema"]})]})}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-3",children:[zs&&e.jsx(ee,{className:"border-dashed border-2",children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Schema Name"}),e.jsx(V,{value:Le,onChange:s=>Xe(s.target.value),placeholder:"Enter schema name",onKeyDown:s=>{s.key==="Enter"?$s():s.key==="Escape"&&(Ge(!1),Xe(""))},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{size:"sm",onClick:$s,children:"Create"}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>{Ge(!1),Xe("")},children:"Cancel"})]})]})})}),y.map((s,m)=>e.jsx(ee,{className:"border-border",children:e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(Ls,{className:"h-4 w-4 text-primary"})}),vs===s.name?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(V,{value:s.name,onChange:i=>Ts(s.name,"name",i.target.value),className:"font-semibold",onKeyDown:i=>{(i.key==="Enter"||i.key==="Escape")&&He(null)},autoFocus:!0}),e.jsx(V,{value:s.owner,onChange:i=>Ts(s.name,"owner",i.target.value),className:"text-sm",placeholder:"Owner"})]}):e.jsxs("div",{className:"flex-1",children:[e.jsx(ae,{className:"text-lg",children:s.name}),e.jsxs(re,{className:"text-xs mt-1",children:["Owner: ",s.owner]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.name===j&&e.jsx(Ae,{variant:"default",children:"Current"}),vs===s.name?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>He(null),children:"Save"}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>He(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>v({currentSchema:s.name}),children:"Use"}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>He(s.name),children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>Hs(s.name),className:"text-destructive hover:text-destructive",children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})]})})},m))]})})]})}),e.jsx(be,{value:"tables",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ae,{children:["Tables in Schema: ",j]}),e.jsx(re,{children:"Table structure and columns"})]}),e.jsxs(E,{size:"sm",onClick:()=>oe(!0),variant:"outline",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Create Table"]})]})}),e.jsxs(ie,{children:[Pe&&e.jsxs(ee,{className:"mb-4 border-primary",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Create New Table"}),e.jsx(re,{children:"Define table structure"})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Table Name"}),e.jsx(V,{value:O,onChange:s=>ye(s.target.value),placeholder:"table_name"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(z,{children:"Columns"}),e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>se([...J,{name:"new_column",type:"VARCHAR(255)",nullable:!0}]),children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Column"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Nullable"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Default"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Primary Key"}),e.jsx("th",{className:"text-left p-2 font-medium"})]})}),e.jsx("tbody",{children:J.map((s,m)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:e.jsx(V,{value:s.name,onChange:i=>{const o=[...J];o[m].name=i.target.value,se(o)},className:"h-8",placeholder:"column_name"})}),e.jsx("td",{className:"p-2",children:e.jsxs(De,{value:s.type,onValueChange:i=>{const o=[...J];o[m].type=i,se(o)},children:[e.jsx(Me,{className:"h-8",children:e.jsx(ke,{})}),e.jsxs(Fe,{children:[e.jsx(Q,{value:"SERIAL",children:"SERIAL"}),e.jsx(Q,{value:"INTEGER",children:"INTEGER"}),e.jsx(Q,{value:"BIGINT",children:"BIGINT"}),e.jsx(Q,{value:"VARCHAR(255)",children:"VARCHAR(255)"}),e.jsx(Q,{value:"TEXT",children:"TEXT"}),e.jsx(Q,{value:"DECIMAL(10,2)",children:"DECIMAL(10,2)"}),e.jsx(Q,{value:"BOOLEAN",children:"BOOLEAN"}),e.jsx(Q,{value:"TIMESTAMP",children:"TIMESTAMP"}),e.jsx(Q,{value:"DATE",children:"DATE"})]})]})}),e.jsx("td",{className:"p-2",children:e.jsxs(De,{value:s.nullable?"true":"false",onValueChange:i=>{const o=[...J];o[m].nullable=i==="true",se(o)},children:[e.jsx(Me,{className:"h-8",children:e.jsx(ke,{})}),e.jsxs(Fe,{children:[e.jsx(Q,{value:"true",children:"NULL"}),e.jsx(Q,{value:"false",children:"NOT NULL"})]})]})}),e.jsx("td",{className:"p-2",children:e.jsx(V,{value:s.default||"",onChange:i=>{const o=[...J];o[m].default=i.target.value,se(o)},className:"h-8",placeholder:"default value"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"checkbox",checked:s.primaryKey||!1,onChange:i=>{const o=[...J];o[m].primaryKey=i.target.checked,se(o)},className:"h-4 w-4"})}),e.jsx("td",{className:"p-2",children:e.jsx(E,{size:"icon",variant:"ghost",onClick:()=>se(J.filter((i,o)=>o!==m)),disabled:J.length<=1,title:J.length<=1?"ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ":"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ",children:e.jsx(Ee,{className:"h-4 w-4"})})})]},m))})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{onClick:Ks,disabled:!O||!O.trim(),children:"Create Table"}),e.jsx(E,{variant:"outline",onClick:()=>{oe(!1),ye(""),se([{name:"id",type:"SERIAL",nullable:!1,primaryKey:!0}])},children:"Cancel"})]}),!O&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please enter a table name"})]})]}),e.jsx("div",{className:"space-y-4",children:he.map((s,m)=>e.jsxs(ee,{className:"border-border",children:[e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(Ze,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-lg",children:s.name}),e.jsxs(re,{className:"text-xs mt-1",children:["Schema: ",s.schema," â€¢ ",s.columns.length," columns â€¢ ",s.indexes.length," indexes"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:"sm",variant:"outline",onClick:()=>P(M===s.name?null:s.name),children:M===s.name?"Done":"Edit Structure"}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>{const i=s.name;v({tables:g.filter((o,u)=>{const T=g[u];return!(T.name===s.name&&T.schema===j)})}),K(`Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° "${i}" ÑƒÐ´Ð°Ð»ÐµÐ½Ð°`)},children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(z,{className:"text-sm font-semibold",children:"Columns"}),M===s.name&&e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>Bs(s.name),children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Column"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Nullable"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Default"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Key"}),M===s.name&&e.jsx("th",{className:"text-left p-2 font-medium"})]})}),e.jsx("tbody",{children:s.columns.map((i,o)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:M===s.name?e.jsx(V,{value:i.name,onChange:u=>ze(s.name,o,"name",u.target.value),className:"h-8 font-mono"}):e.jsx("span",{className:"font-mono",children:i.name})}),e.jsx("td",{className:"p-2",children:M===s.name?e.jsxs(De,{value:i.type,onValueChange:u=>ze(s.name,o,"type",u),children:[e.jsx(Me,{className:"h-8",children:e.jsx(ke,{})}),e.jsxs(Fe,{children:[e.jsx(Q,{value:"SERIAL",children:"SERIAL"}),e.jsx(Q,{value:"INTEGER",children:"INTEGER"}),e.jsx(Q,{value:"BIGINT",children:"BIGINT"}),e.jsx(Q,{value:"VARCHAR(255)",children:"VARCHAR(255)"}),e.jsx(Q,{value:"TEXT",children:"TEXT"}),e.jsx(Q,{value:"DECIMAL(10,2)",children:"DECIMAL(10,2)"}),e.jsx(Q,{value:"BOOLEAN",children:"BOOLEAN"}),e.jsx(Q,{value:"TIMESTAMP",children:"TIMESTAMP"}),e.jsx(Q,{value:"DATE",children:"DATE"})]})]}):e.jsx("span",{className:"text-muted-foreground",children:i.type})}),e.jsx("td",{className:"p-2",children:M===s.name?e.jsxs(De,{value:i.nullable?"true":"false",onValueChange:u=>ze(s.name,o,"nullable",u==="true"),children:[e.jsx(Me,{className:"h-8",children:e.jsx(ke,{})}),e.jsxs(Fe,{children:[e.jsx(Q,{value:"true",children:"NULL"}),e.jsx(Q,{value:"false",children:"NOT NULL"})]})]}):i.nullable?e.jsx(Ae,{variant:"outline",children:"NULL"}):e.jsx(Ae,{variant:"secondary",children:"NOT NULL"})}),e.jsx("td",{className:"p-2",children:M===s.name?e.jsx(V,{value:i.default||"",onChange:u=>ze(s.name,o,"default",u.target.value),className:"h-8",placeholder:"default"}):e.jsx("span",{className:"text-muted-foreground",children:i.default||"-"})}),e.jsx("td",{className:"p-2",children:M===s.name?e.jsx("input",{type:"checkbox",checked:i.primaryKey||!1,onChange:u=>ze(s.name,o,"primaryKey",u.target.checked),className:"h-4 w-4"}):i.primaryKey&&e.jsxs(Ae,{variant:"default",className:"gap-1",children:[e.jsx(ys,{className:"h-3 w-3"}),"PK"]})}),M===s.name&&e.jsx("td",{className:"p-2",children:e.jsx(E,{size:"icon",variant:"ghost",onClick:()=>qs(s.name,o),disabled:s.columns.length<=1,title:s.columns.length<=1?"ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ":"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ",children:e.jsx(Ee,{className:"h-4 w-4"})})})]},o))})]})})]}),s.indexes.length>0&&e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-semibold mb-2 block",children:"Indexes"}),e.jsx("div",{className:"space-y-1",children:s.indexes.map((i,o)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded text-sm",children:[e.jsx(ys,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"font-mono",children:i})]},o))})]}),s.constraints.length>0&&e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-semibold mb-2 block",children:"Constraints"}),e.jsx("div",{className:"space-y-1",children:s.constraints.map((i,o)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded text-sm",children:[e.jsx("span",{className:"font-mono text-muted-foreground",children:i}),M===s.name&&e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>Qs(s.name,o),children:e.jsx(Ee,{className:"h-3 w-3"})})]},o))})]})]})]},m))})]})]})}),e.jsx(be,{value:"diagram",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Schema Diagram"}),e.jsxs(re,{children:["Visual representation of database schema with tables and relationships.",e.jsx("br",{}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-2 block",children:["ðŸ’¡ ",e.jsx("strong",{children:"ÐšÐ°Ðº ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ²ÑÐ·ÑŒ:"})," ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ð¾Ð»Ðµ Ð² Ð¾Ð´Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ, Ð·Ð°Ñ‚ÐµÐ¼ ÐºÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ð¾Ð»Ðµ Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ. Ð¡Ð²ÑÐ·ÑŒ ÑÐ¾Ð·Ð´Ð°ÑÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸. Ð”Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑÐ²ÑÐ·Ð¸ ÐºÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð½ÐµÑ‘."]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{const s=at(g,je);Se(s),ge(!0)},children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Validate Schema"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{ce(""),ne([]),$e(!0)},children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Import SQL"]}),e.jsxs($n,{children:[e.jsx(Tn,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(En,{align:"end",children:[e.jsxs(Ke,{onClick:()=>{const s=zn(g,je);S(s),B("sql"),_(!0)},children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Export SQL"]}),e.jsxs(Ke,{onClick:()=>{const s=Us(g,je);S(s),B("mermaid"),_(!0)},children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Export Mermaid"]}),e.jsxs(Ke,{onClick:()=>{const s=Hn(g,je);S(s),B("dbml"),_(!0)},children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Export DBML"]}),e.jsxs(Ke,{onClick:()=>{const s=Vn(g,je,c);S(s),B("docs"),_(!0)},children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Export Documentation"]}),e.jsxs(Ke,{onClick:async()=>{try{const s=document.querySelector(".schema-diagram-container > div");if(!s){q("Schema diagram not found");return}const{toPng:m}=await Cs(async()=>{const{toPng:u}=await import("./index-BJ-mfDgp.js");return{toPng:u}},[]),i=await m(s,{quality:1,pixelRatio:2,backgroundColor:"white"}),o=document.createElement("a");o.download="schema-diagram.png",o.href=i,o.click(),K("PNG exported successfully")}catch(s){q("Failed to export PNG"),console.error(s)}},children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Export PNG"]}),e.jsxs(Ke,{onClick:async()=>{try{const s=document.querySelector(".schema-diagram-container > div");if(!s){q("Schema diagram not found");return}const{toJpeg:m}=await Cs(async()=>{const{toJpeg:u}=await import("./index-BJ-mfDgp.js");return{toJpeg:u}},[]),i=await m(s,{quality:.95,pixelRatio:2,backgroundColor:"white"}),o=document.createElement("a");o.download="schema-diagram.jpg",o.href=i,o.click(),K("JPEG exported successfully")}catch(s){q("Failed to export JPEG"),console.error(s)}},children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Export JPEG"]})]})]})]})]})}),e.jsxs(ie,{children:[e.jsx("div",{className:"h-[600px] min-h-[400px] schema-diagram-container",children:e.jsx(Bn,{tables:g,tablePositions:t.diagramPositions||{},onTableUpdate:(s,m)=>{if(m.x!==void 0||m.y!==void 0){const i=s.replace(/^table_/,""),o={...t.diagramPositions||{},[i]:{x:m.x??t.diagramPositions?.[i]?.x??100,y:m.y??t.diagramPositions?.[i]?.y??100}};v({diagramPositions:o})}},onRelationshipAdd:s=>{const m=s.startTableId.replace(/^table_/,"").replace(/_/g,"."),i=s.endTableId.replace(/^table_/,"").replace(/_/g,"."),o=g.find(G=>{const Re=`${G.schema}.${G.name}`;return s.startTableId===`table_${G.schema}_${G.name}`||m===Re}),u=g.find(G=>{const Re=`${G.schema}.${G.name}`;return s.endTableId===`table_${G.schema}_${G.name}`||i===Re});if(!o||!u)return;const T=o.columns.find((G,Re)=>{const is=`field_${o.name}_${G.name}_${Re}`;return s.startFieldId===is||s.startFieldId.includes(G.name)}),w=u.columns.find((G,Re)=>{const is=`field_${u.name}_${G.name}_${Re}`;return s.endFieldId===is||s.endFieldId.includes(G.name)});if(!T||!w)return;const L=`FOREIGN KEY (${T.name}) REFERENCES ${u.name}(${w.name}) ON DELETE ${s.constraint==="Cascade"?"CASCADE":s.constraint==="Restrict"?"RESTRICT":s.constraint==="Set null"?"SET NULL":"NO ACTION"}`,F=[...g],Oe=F.findIndex(G=>G.name===o.name&&G.schema===o.schema);Oe>=0&&(F[Oe].constraints||(F[Oe].constraints=[]),F[Oe].constraints.push(L),v({tables:F}),K(`Foreign key constraint Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½: ${o.name}.${T.name} â†’ ${u.name}.${w.name}`))},onRelationshipDelete:s=>{const m=je.find(F=>F.id===s);if(!m)return;const i=m.startTableId.replace(/^table_/,"").replace(/_/g,"."),o=g.find(F=>{const Oe=`${F.schema}.${F.name}`;return m.startTableId===`table_${F.schema}_${F.name}`||i===Oe});if(!o)return;const u=m.startFieldId.match(/field_\w+_(\w+)_\d+/),T=u?u[1]:"",w=[...g],L=w.findIndex(F=>F.name===o.name&&F.schema===o.schema);L>=0&&w[L].constraints&&(w[L].constraints=w[L].constraints.filter(F=>!(F.includes("FOREIGN KEY")&&T&&F.includes(`(${T})`))),v({tables:w}),K("Foreign key constraint ÑƒÐ´Ð°Ð»ÐµÐ½"))},onRelationshipsChange:s=>{$(s)},onAutoArrange:s=>{v({diagramPositions:s})}})}),e.jsx(ds,{open:A,onOpenChange:_,children:e.jsxs(ms,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(hs,{children:[e.jsxs(us,{children:["Export ",k==="sql"?"SQL":k==="mermaid"?"Mermaid":k==="dbml"?"DBML":"Documentation"]}),e.jsxs(xs,{children:[k==="sql"&&"PostgreSQL SQL schema definition",k==="mermaid"&&"Mermaid ER diagram format",k==="dbml"&&"DBML format for dbdiagram.io",k==="docs"&&"Markdown documentation"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(E,{variant:"outline",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(C),le(!0),setTimeout(()=>le(!1),2e3),K("Copied to clipboard")}catch{q("Failed to copy to clipboard")}},children:me?e.jsxs(e.Fragment,{children:[e.jsx(wn,{className:"h-4 w-4 mr-2"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(Cn,{className:"h-4 w-4 mr-2"}),"Copy"]})}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{const s=new Blob([C],{type:k==="sql"?"text/sql":k==="mermaid"||k==="dbml"?"text/plain":"text/markdown"}),m=URL.createObjectURL(s),i=document.createElement("a");i.href=m,i.download=`schema.${k==="sql"?"sql":k==="mermaid"?"mmd":k==="dbml"?"dbml":"md"}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(m),K("File downloaded")},children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Download"]})]}),e.jsx(We,{value:C,readOnly:!0,className:"font-mono text-sm h-[400px] resize-none"})]})]})}),e.jsx(ds,{open:ve,onOpenChange:$e,children:e.jsxs(ms,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(hs,{children:[e.jsx(us,{children:"Import SQL Schema"}),e.jsx(xs,{children:"Paste PostgreSQL CREATE TABLE and ALTER TABLE statements to import tables and relationships"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(E,{variant:"outline",size:"sm",onClick:()=>{ce(""),ne([])},children:"Clear"}),e.jsxs(E,{variant:"default",size:"sm",onClick:Os,children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Import"]})]}),fe.length>0&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsx("div",{className:"text-sm font-medium text-destructive mb-2",children:"Import Errors:"}),e.jsx("ul",{className:"text-sm text-destructive/80 list-disc list-inside space-y-1",children:fe.map((s,m)=>e.jsx("li",{children:s},m))})]}),e.jsx(We,{value:xe,onChange:s=>ce(s.target.value),placeholder:`Paste SQL here, e.g.

CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(255) NOT NULL
);

CREATE TABLE orders (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL
);

ALTER TABLE orders
ADD FOREIGN KEY (user_id) REFERENCES users(id)
ON DELETE CASCADE;`,className:"font-mono text-sm h-[400px] resize-none"})]})]})}),e.jsx(ds,{open:Te,onOpenChange:ge,children:e.jsxs(ms,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(hs,{children:[e.jsx(us,{className:"flex items-center gap-2",children:Y?.valid?e.jsxs(e.Fragment,{children:[e.jsx(Ss,{className:"h-5 w-5 text-green-500"}),"Schema Validation - Valid"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-5 w-5 text-destructive"}),"Schema Validation - Errors Found"]})}),e.jsx(xs,{children:Y?.valid?"Schema is valid with no errors":`${Y?.errors.length||0} error(s) and ${Y?.warnings.length||0} warning(s) found`})]}),e.jsx("div",{className:"space-y-4",children:Y&&e.jsxs(e.Fragment,{children:[Y.errors.length>0&&e.jsxs(ps,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs(js,{children:["Errors (",Y.errors.length,")"]}),e.jsx(gs,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1 mt-2",children:Y.errors.map((s,m)=>e.jsxs("li",{children:[s.table&&e.jsx("strong",{children:s.table}),s.column&&` â†’ ${s.column}`,s.relationship&&` (${s.relationship})`,": ",s.message]},m))})})]}),Y.warnings.length>0&&e.jsxs(ps,{children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs(js,{children:["Warnings (",Y.warnings.length,")"]}),e.jsx(gs,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1 mt-2",children:Y.warnings.map((s,m)=>e.jsxs("li",{children:[s.table&&e.jsx("strong",{children:s.table}),s.column&&` â†’ ${s.column}`,s.relationship&&` (${s.relationship})`,": ",s.message]},m))})})]}),Y.errors.length===0&&Y.warnings.length===0&&e.jsxs(ps,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(js,{children:"Schema is Valid"}),e.jsx(gs,{children:"No errors or warnings found in the schema."})]})]})})]})})]})]})}),e.jsx(be,{value:"data",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Data Editor"}),e.jsx(re,{children:"View and edit table data"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(De,{value:j,onValueChange:s=>v({currentSchema:s}),children:[e.jsx(Me,{className:"w-40",children:e.jsx(ke,{})}),e.jsx(Fe,{children:y.map(s=>e.jsx(Q,{value:s.name,children:s.name},s.name))})]}),e.jsxs(De,{value:he[0]?.name||"",onValueChange:()=>{},children:[e.jsx(Me,{className:"w-40",children:e.jsx(ke,{placeholder:"Select table"})}),e.jsx(Fe,{children:he.map(s=>e.jsx(Q,{value:s.name,children:s.name},s.name))})]}),e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>{if(he.length>0){const s=[...g],m=s.findIndex(i=>i.name===he[0].name&&i.schema===j);if(m>=0){const i={};s[m].columns.forEach(o=>{o.default?i[o.name]=o.default:o.type.includes("SERIAL")?i[o.name]="AUTO":i[o.name]=""}),s[m].data||(s[m].data=[]),s[m].data.push(i),v({tables:s})}}},children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Insert Row"]})]})]})}),e.jsx(ie,{children:(()=>{const s=Ce||he[0]?.name,m=he.find(i=>i.name===s);return m?!m.data||m.data.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ze,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:'No data in table. Click "Insert Row" to add data.'})]}):e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[m.columns.map(i=>e.jsxs("th",{className:"text-left p-2 font-medium border-r",children:[i.name,i.primaryKey&&e.jsx(ys,{className:"h-3 w-3 inline ml-1 text-primary"})]},i.name)),e.jsx("th",{className:"text-left p-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:m.data.map((i,o)=>e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[m.columns.map(u=>e.jsx("td",{className:"p-1 border-r",children:e.jsx(V,{value:i[u.name]!==void 0?String(i[u.name]):"",onChange:T=>{const w=[...g],L=w.findIndex(F=>F.name===s&&F.schema===j);L>=0&&w[L].data&&(w[L].data[o]={...w[L].data[o],[u.name]:T.target.value},v({tables:w}))},className:"border-0 p-1 h-8 bg-transparent hover:bg-muted/50 focus:bg-background focus:border focus:border-primary",placeholder:u.default||(u.nullable?"NULL":"required"),disabled:u.type.includes("SERIAL")&&String(i[u.name])==="AUTO"})},u.name)),e.jsx("td",{className:"p-2",children:e.jsx(E,{size:"sm",variant:"ghost",className:"h-7 text-destructive",onClick:()=>{const u=[...g],T=u.findIndex(w=>w.name===s&&w.schema===j);T>=0&&u[T].data&&(u[T].data=u[T].data.filter((w,L)=>L!==o),v({tables:u}))},children:e.jsx(Ee,{className:"h-3 w-3"})})})]},o))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ze,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Select a table to view and edit data"})]})})()})]})}),e.jsx(be,{value:"query",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Query Tool"}),e.jsx(re,{children:"Execute SQL queries and commands"})]}),e.jsxs(E,{size:"sm",onClick:()=>{if(!H||!H.trim()){q("Please enter a SQL query");return}try{const s=[];for(const u of g)for(const T of u.indexes||[]){const w=T.match(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+(\w+)\s+ON\s+\w+\s*\(([^)]+)\)/i);w&&s.push({name:w[1],table:u.name,schema:u.schema,columns:w[2].split(",").map(L=>L.trim()),unique:T.toUpperCase().includes("UNIQUE")})}const m=g.map(u=>({name:u.name,schema:u.schema,columns:u.columns.map(T=>({name:T.name,type:T.type,nullable:T.nullable,default:T.default,primaryKey:T.primaryKey})),indexes:u.indexes,constraints:u.constraints,data:u.data})),i=ls.getPostgreSQLEmulationEngine(n);let o;if(i){o=i.executeQuery(H);const u=i.getTables();if(Array.isArray(u)&&u.length>0){const T=g.map(w=>{const L=u.find(F=>F.name===w.name&&F.schema===w.schema);return L&&Array.isArray(L.data)?{...w,data:L.data}:w});v({tables:T})}}else o=W.execute(H,m,s,b);if(o.success){const u=o.queryPlan?.operation||"";if(o.queryPlan&&(u.includes("INSERT")||u.includes("UPDATE")||u.includes("DELETE"))){const T=[...g],w=T.find(L=>L.name===o.queryPlan?.table||H.toLowerCase().includes(L.name.toLowerCase()));if(w){const L=m.find(F=>F.name===w.name&&F.schema===w.schema);L&&L.data&&(w.data=L.data)}v({tables:T,queryResults:[{message:`${o.queryPlan.operation} executed: ${o.rowCount||0} row(s) affected`,queryPlan:o.queryPlan,rowCount:o.rowCount,indexesUsed:o.indexesUsed}]})}else{const T=o.rows||[];v({queryResults:T.length>0?[{queryPlan:o.queryPlan,rowCount:o.rowCount,indexesUsed:o.indexesUsed},...T]:[{queryPlan:o.queryPlan,rowCount:0,indexesUsed:o.indexesUsed}]})}o.queryPlan?K(`Query executed successfully. ${o.rowCount||0} row(s) returned. `+(o.indexesUsed&&o.indexesUsed.length>0?`Index used: ${o.indexesUsed.join(", ")}`:"")):K(`Query executed successfully. ${o.rowCount||0} row(s) returned.`)}else q(o.error||"Query execution failed"),v({queryResults:[{error:o.error||"Query execution failed"}]})}catch(s){const m=s instanceof Error?s.message:"Unknown error";q(`Query execution error: ${m}`),v({queryResults:[{error:m}]})}},children:[e.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Execute"]})]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"SQL Query"}),e.jsx(We,{value:H,onChange:s=>v({sqlQuery:s.target.value}),className:"font-mono text-sm h-32",placeholder:"SELECT * FROM users;"})]}),I.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Results"}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:I[0]?.error?e.jsxs("div",{className:"p-4 text-sm text-destructive bg-destructive/10 rounded",children:[e.jsx("strong",{children:"Error:"})," ",I[0].error]}):I[0]?.message?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:I[0].message}):I[0]?.queryPlan?e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Query Plan:"}),e.jsxs("div",{className:"bg-muted/50 p-2 rounded font-mono text-xs",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Operation:"})," ",I[0].queryPlan.operation]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Table:"})," ",I[0].queryPlan.table]}),I[0].queryPlan.indexUsed&&e.jsxs("div",{children:[e.jsx("strong",{children:"Index Used:"})," ",I[0].queryPlan.indexUsed]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Estimated Rows:"})," ",I[0].queryPlan.estimatedRows]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Estimated Cost:"})," ",I[0].queryPlan.estimatedCost]})]})]}),I[0].rowCount!==void 0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Rows returned: ",I[0].rowCount]}),I.length>1&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs font-semibold mb-1",children:"Data:"}),e.jsxs("table",{className:"w-full text-sm border rounded",children:[e.jsx("thead",{className:"bg-muted",children:e.jsx("tr",{children:Object.keys(I[1]||{}).map(s=>e.jsx("th",{className:"text-left p-2 font-medium border-r",children:s},s))})}),e.jsx("tbody",{children:I.slice(1).map((s,m)=>e.jsx("tr",{className:"border-t hover:bg-muted/50",children:Object.values(s).map((i,o)=>e.jsx("td",{className:"p-2 border-r",children:String(i)},o))},m))})]})]})]}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsx("tr",{children:Object.keys(I[0]||{}).filter(s=>s!=="queryPlan"&&s!=="indexesUsed"&&s!=="rowCount").map(s=>e.jsx("th",{className:"text-left p-2 font-medium border-r",children:s},s))})}),e.jsx("tbody",{children:I.map((s,m)=>e.jsx("tr",{className:"border-t hover:bg-muted/50",children:Object.keys(s).filter(i=>i!=="queryPlan"&&i!=="indexesUsed"&&i!=="rowCount").map(i=>e.jsx("td",{className:"p-2 border-r",children:String(s[i])},i))},m))})]})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-2",children:"ðŸ’¡ Example queries:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs mb-1",children:"Basic queries:"}),e.jsx("p",{className:"font-mono text-xs",children:"SELECT * FROM users;"}),e.jsx("p",{className:"font-mono text-xs",children:"INSERT INTO users (username, email) VALUES ('new_user', 'user@example.com');"}),e.jsx("p",{className:"font-mono text-xs",children:"UPDATE users SET email = 'updated@example.com' WHERE id = 1;"}),e.jsx("p",{className:"font-mono text-xs",children:"DELETE FROM users WHERE id = 2;"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs mb-1 mt-2",children:"Transactions:"}),e.jsx("p",{className:"font-mono text-xs",children:"BEGIN;"}),e.jsx("p",{className:"font-mono text-xs",children:"INSERT INTO users (username, email) VALUES ('user1', 'user1@example.com');"}),e.jsx("p",{className:"font-mono text-xs",children:"INSERT INTO users (username, email) VALUES ('user2', 'user2@example.com');"}),e.jsx("p",{className:"font-mono text-xs",children:"COMMIT;"}),e.jsx("p",{className:"font-mono text-xs",children:"-- or ROLLBACK; to cancel"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs mb-1 mt-2",children:"With WHERE clause:"}),e.jsx("p",{className:"font-mono text-xs",children:"SELECT * FROM users WHERE id > 10;"}),e.jsx("p",{className:"font-mono text-xs",children:"SELECT * FROM users WHERE email LIKE '%@example.com';"})]})]})]})]})]})}),e.jsx(be,{value:"views",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ae,{children:["Views in Schema: ",j]}),e.jsx(re,{children:"Database views and their definitions"})]}),e.jsxs(E,{size:"sm",onClick:Vs,variant:"outline",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Create View"]})]})}),e.jsx(ie,{children:e.jsx("div",{className:"space-y-3",children:Ws.map((s,m)=>e.jsxs(ee,{className:"border-border",children:[e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(ws,{className:"h-4 w-4 text-primary"})}),ss===`${s.schema}.${s.name}`?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(V,{value:s.name,onChange:i=>as(s.name,s.schema,"name",i.target.value),className:"font-semibold",placeholder:"View name"}),e.jsxs(De,{value:s.schema,onValueChange:i=>as(s.name,s.schema,"schema",i),children:[e.jsx(Me,{children:e.jsx(ke,{})}),e.jsx(Fe,{children:y.map(i=>e.jsx(Q,{value:i.name,children:i.name},i.name))})]})]}):e.jsxs("div",{className:"flex-1",children:[e.jsx(ae,{className:"text-lg",children:s.name}),e.jsxs(re,{className:"text-xs mt-1",children:["Schema: ",s.schema]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:ss===`${s.schema}.${s.name}`?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>ns(null),children:"Save"}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>ns(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>ns(`${s.schema}.${s.name}`),children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>Ys(s.name,s.schema),className:"text-destructive hover:text-destructive",children:e.jsx(Ee,{className:"h-4 w-4"})})]})})]})}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Definition"}),e.jsx(We,{value:s.definition,onChange:i=>as(s.name,s.schema,"definition",i.target.value),readOnly:ss!==`${s.schema}.${s.name}`,className:"font-mono text-sm",rows:3})]})})]},m))})})]})}),e.jsx(be,{value:"roles",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Database Roles"}),e.jsx(re,{children:"User roles and permissions"})]}),e.jsxs(E,{size:"sm",onClick:Xs,variant:"outline",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Create Role"]})]})}),e.jsx(ie,{children:e.jsx("div",{className:"space-y-3",children:R.map((s,m)=>e.jsx(ee,{className:"border-border",children:e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(Is,{className:"h-4 w-4 text-primary"})}),Es===s.name?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(V,{value:s.name,onChange:i=>rs(s.name,"name",i.target.value),className:"font-semibold",placeholder:"Role name"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{checked:s.login,onCheckedChange:i=>rs(s.name,"login",i)}),e.jsx(z,{className:"text-sm",children:"LOGIN"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{checked:s.superuser,onCheckedChange:i=>rs(s.name,"superuser",i)}),e.jsx(z,{className:"text-sm",children:"SUPERUSER"})]})]})]}):e.jsxs("div",{className:"flex-1",children:[e.jsx(ae,{className:"text-lg",children:s.name}),e.jsxs(re,{className:"text-xs mt-1 flex gap-1",children:[s.login&&e.jsx(Ae,{variant:"outline",children:"LOGIN"}),s.superuser&&e.jsx(Ae,{variant:"destructive",children:"SUPERUSER"}),!s.login&&!s.superuser&&e.jsx("span",{className:"text-muted-foreground",children:"No special privileges"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:Es===s.name?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>ts(null),children:"Save"}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>ts(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>ts(s.name),children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>Gs(s.name),className:"text-destructive hover:text-destructive",disabled:s.name==="postgres",children:e.jsx(Ee,{className:"h-4 w-4"})})]})})]})})},m))})})]})}),e.jsx(be,{value:"metrics",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"PostgreSQL Metrics"}),e.jsx(re,{children:"Real-time metrics from PostgreSQL emulation engine"})]}),e.jsx(ie,{className:"space-y-6",children:U?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Connection Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Connections"}),e.jsx("div",{className:"text-2xl font-bold",children:U.activeConnections}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["/ ",U.maxConnections]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Idle Connections"}),e.jsx("div",{className:"text-2xl font-bold",children:U.idleConnections})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Waiting Connections"}),e.jsx("div",{className:"text-2xl font-bold",children:U.waitingConnections})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Utilization"}),e.jsxs("div",{className:"text-2xl font-bold",children:[(U.connectionUtilization*100).toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Query Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Queries/sec"}),e.jsx("div",{className:"text-2xl font-bold",children:U.queriesPerSecond.toFixed(1)})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Query Time"}),e.jsxs("div",{className:"text-2xl font-bold",children:[U.averageQueryTime.toFixed(1),"ms"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"P95 Query Time"}),e.jsxs("div",{className:"text-2xl font-bold",children:[U.p95QueryTime.toFixed(1),"ms"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Slow Queries"}),e.jsx("div",{className:"text-2xl font-bold",children:U.slowQueries})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Database Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Transactions/sec"}),e.jsx("div",{className:"text-2xl font-bold",children:U.transactionsPerSecond.toFixed(1)})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Commits/sec"}),e.jsx("div",{className:"text-2xl font-bold",children:U.commitsPerSecond.toFixed(1)})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Database Size"}),e.jsxs("div",{className:"text-2xl font-bold",children:[(U.databaseSize/1024/1024).toFixed(2),"MB"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Bloat Ratio"}),e.jsxs("div",{className:"text-2xl font-bold",children:[(U.bloatRatio*100).toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Table Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Tables"}),e.jsx("div",{className:"text-2xl font-bold",children:U.totalTables})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Rows"}),e.jsx("div",{className:"text-2xl font-bold",children:U.totalRows.toLocaleString()})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Dead Tuples"}),e.jsx("div",{className:"text-2xl font-bold",children:U.deadTuples.toLocaleString()})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Live Tuples"}),e.jsx("div",{className:"text-2xl font-bold",children:U.liveTuples.toLocaleString()})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cache Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Hit Ratio"}),e.jsxs("div",{className:"text-2xl font-bold",children:[(U.cacheHitRatio*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Index Cache Hit Ratio"}),e.jsxs("div",{className:"text-2xl font-bold",children:[(U.indexCacheHitRatio*100).toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"WAL & Vacuum Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"WAL Written/sec"}),e.jsxs("div",{className:"text-2xl font-bold",children:[(U.walWritten/1024).toFixed(1),"KB"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Checkpoints/hour"}),e.jsx("div",{className:"text-2xl font-bold",children:U.checkpointFrequency.toFixed(1)})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Autovacuum Running"}),e.jsx("div",{className:"text-2xl font-bold",children:U.autovacuumRunning})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vacuum Ops/hour"}),e.jsx("div",{className:"text-2xl font-bold",children:U.vacuumOperationsPerHour})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Lock Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Locks"}),e.jsx("div",{className:"text-2xl font-bold",children:U.activeLocks})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Blocked Queries"}),e.jsx("div",{className:"text-2xl font-bold",children:U.blockedQueries})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Lock Wait Time"}),e.jsxs("div",{className:"text-2xl font-bold",children:[U.lockWaitTime.toFixed(1),"ms"]})]})]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Metrics will appear here when simulation is running"})})]})}),e.jsx(be,{value:"connection",className:"space-y-4 mt-4",children:e.jsxs(ee,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Connection Settings"}),e.jsx(re,{children:"PostgreSQL server connection details"})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"host",children:["Host ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"host",value:d,onChange:s=>{v({host:s.target.value}),X.host&&pe()},onBlur:pe,placeholder:"localhost",className:Ue||X.host?"border-destructive":""}),Ue&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:Ue})]}),!Ue&&X.host&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:X.host})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"port",children:["Port ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"port",type:"number",value:a,onChange:s=>{v({port:parseInt(s.target.value)||5432}),X.port&&pe()},onBlur:pe,placeholder:"5432",className:Z||Ie.hasConflict||X.port?"border-destructive":""}),Z&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:Z})]}),!Z&&X.port&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:X.port})]}),!Z&&!X.port&&Ie.hasConflict&&Ie.conflictingNode&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-amber-600 dark:text-amber-400",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsxs("span",{children:['ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ð¿Ð¾Ñ€Ñ‚Ð°: ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ "',Ie.conflictingNode.data.label||Ie.conflictingNode.type,'" ÑƒÐ¶Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ',d,":",a]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"database",children:["Database ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"database",value:c,onChange:s=>{v({database:s.target.value}),X.database&&pe()},onBlur:pe,placeholder:"postgres",className:X.database?"border-destructive":""}),X.database&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:X.database})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"username",children:["Username ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"username",value:r,onChange:s=>{v({username:s.target.value}),X.username&&pe()},onBlur:pe,placeholder:"postgres",className:X.username?"border-destructive":""}),X.username&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:X.username})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"password",children:"Password"}),e.jsx(V,{id:"password",type:"password",value:p,onChange:s=>v({password:s.target.value}),placeholder:"password"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsx(E,{onClick:()=>{pe()?K("ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹"):q("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð²ÑÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ")},children:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"}),e.jsx(E,{variant:"outline",onClick:()=>{pe()?K("ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð²Ð°Ð»Ð¸Ð´Ð½Ñ‹"):q("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð²ÑÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ")},children:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ"})]}),e.jsx(cs,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Connection Pool Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Configure connection pooling behavior"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"maxConnections",children:"Max Connections"}),e.jsx(V,{id:"maxConnections",type:"number",min:"1",max:"10000",value:t.maxConnections||100,onChange:s=>v({maxConnections:parseInt(s.target.value)||100}),placeholder:"100"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum number of concurrent connections"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"minConnections",children:"Min Connections"}),e.jsx(V,{id:"minConnections",type:"number",min:"0",value:t.minConnections||0,onChange:s=>v({minConnections:parseInt(s.target.value)||0}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Minimum number of idle connections"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"idleTimeout",children:"Idle Timeout (ms)"}),e.jsx(V,{id:"idleTimeout",type:"number",min:"1000",value:t.idleTimeout||3e5,onChange:s=>v({idleTimeout:parseInt(s.target.value)||3e5}),placeholder:"300000"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time before idle connection is closed (default: 5 min)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"maxLifetime",children:"Max Connection Lifetime (ms)"}),e.jsx(V,{id:"maxLifetime",type:"number",min:"60000",value:t.maxLifetime||36e5,onChange:s=>v({maxLifetime:parseInt(s.target.value)||36e5}),placeholder:"3600000"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum time a connection can live (default: 1 hour)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"queryLatency",children:"Query Latency (ms)"}),e.jsx(V,{id:"queryLatency",type:"number",min:"1",value:t.queryLatency||10,onChange:s=>v({queryLatency:parseInt(s.target.value)||10}),placeholder:"10"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Base query execution time for simulation"})]})]})]}),e.jsx(cs,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Enable Metrics Export (postgres_exporter)"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Export PostgreSQL metrics for Prometheus scraping"})]}),e.jsx(fs,{checked:t.metrics?.enabled??!0,onCheckedChange:s=>v({metrics:{...t.metrics,enabled:s,port:t.metrics?.port||9187,path:t.metrics?.path||"/metrics"}})})]}),t.metrics?.enabled!==!1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Metrics Port (postgres_exporter)"}),e.jsx(V,{type:"number",value:t.metrics?.port??9187,onChange:s=>v({metrics:{...t.metrics,port:parseInt(s.target.value)||9187,path:t.metrics?.path||"/metrics"}}),min:1024,max:65535}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default port for postgres_exporter: 9187"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Metrics Path"}),e.jsx(V,{type:"text",value:t.metrics?.path??"/metrics",onChange:s=>v({metrics:{...t.metrics,path:s.target.value||"/metrics",port:t.metrics?.port||9187}}),placeholder:"/metrics"})]})]})]})]})]})})]})]})})}export{pt as PostgreSQLConfigAdvanced};
