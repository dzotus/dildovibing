import{E as he,u as Pe,_ as Je,j as e,r as V,A as ae,H as Ue,J as De,B as re,i as g,a8 as Ee,S as ze,T as We,a as Me,b as M,K as Be,a3 as He,F as Fe,d as B,C as P,e as J,f as U,h as D,k as T,L as h,I as j,P as z,m as W,t as ne,n as ce,o as le,p as ie,q as oe,s as E}from"./index-B2nbXufR.js";import{T as O}from"./textarea-BMW-3UUp.js";import{s as H,a as qe}from"./toast-CCzjHQ-d.js";const Ke=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Qe=he("cloud-upload",Ke);const Ve=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Ye=he("hard-drive",Ve);function de(c){try{const t=new URL(c);return t.port?`${t.hostname}:${t.port}`:t.hostname}catch{const t=c.match(/^https?:\/\/([^\/]+)/);return t?t[1]:c}}function Ie(c){const t=new Map;for(const l of c){const o=l.job||"default";t.has(o)||t.set(o,[]),t.get(o).push(l)}return t}function Ge(c){const t=[];t.push("global:"),c.scrapeInterval&&t.push(`  scrape_interval: ${c.scrapeInterval}`),c.evaluationInterval&&t.push(`  evaluation_interval: ${c.evaluationInterval}`),c.storagePath&&t.push(`  # storage.tsdb.path: ${c.storagePath}`),c.retentionTime&&t.push(`  # storage.tsdb.retention.time: ${c.retentionTime}`),t.push("");const l=c.scrapeInterval||"15s";if(c.scrape_configs&&c.scrape_configs.length>0){t.push("scrape_configs:");for(const o of c.scrape_configs){t.push(`  - job_name: '${w(o.job_name)}'`),o.scrape_interval&&o.scrape_interval!==l&&t.push(`    scrape_interval: ${o.scrape_interval}`),o.scrape_timeout&&t.push(`    scrape_timeout: ${o.scrape_timeout}`),o.metrics_path&&o.metrics_path!=="/metrics"&&t.push(`    metrics_path: '${w(o.metrics_path)}'`),t.push("    static_configs:");for(const p of o.static_configs||[]){t.push("      - targets:");for(const v of p.targets||[])t.push(`          - '${w(v)}'`);if(p.labels&&Object.keys(p.labels).length>0){t.push("        labels:");for(const[v,f]of Object.entries(p.labels))t.push(`          ${v}: '${w(String(f))}'`)}}t.push("")}}else if(c.targets&&c.targets.length>0){t.push("scrape_configs:");const o=Ie(c.targets);for(const[p,v]of o.entries()){const f=v[0],i=f.interval||l,$=f.metricsPath||"/metrics",C=f.scrapeTimeout;t.push(`  - job_name: '${w(p)}'`),i!==l&&t.push(`    scrape_interval: ${i}`),C&&t.push(`    scrape_timeout: ${C}`),$!=="/metrics"&&t.push(`    metrics_path: '${w($)}'`),t.push("    static_configs:");const k=new Map;for(const x of v){const _=JSON.stringify(x.labels||{});k.has(_)||k.set(_,[]),k.get(_).push(x)}for(const[x,_]of k.entries()){const A=JSON.parse(x);t.push("      - targets:");for(const S of _){const y=de(S.endpoint);t.push(`          - '${w(y)}'`)}if(Object.keys(A).length>0){t.push("        labels:");for(const[S,y]of Object.entries(A))t.push(`          ${S}: '${w(String(y))}'`)}}t.push("")}}else t.push("scrape_configs: []"),t.push("");if(c.enableAlertmanager&&c.alertmanagerUrl){t.push("alerting:"),t.push("  alertmanagers:"),t.push("    - static_configs:"),t.push("        - targets:");const o=de(c.alertmanagerUrl);t.push(`            - '${w(o)}'`),t.push("")}if(c.enableRemoteWrite&&c.remoteWrite&&c.remoteWrite.length>0){t.push("remote_write:");for(const o of c.remoteWrite)t.push("  - url:"),t.push(`      '${w(o.url)}'`),o.auth&&t.push("    # Authorization header should be configured via file or environment");t.push("")}return t.join(`
`)}function Xe(c){if(c.length===0)return"";const t=["groups:"];t.push("  - name: alerts"),t.push("    rules:");for(const l of c){if(t.push(`      - alert: ${l.name}`),t.push(`        expr: ${l.expr}`),l.for&&t.push(`        for: ${l.for}`),l.labels&&Object.keys(l.labels).length>0){t.push("        labels:");for(const[o,p]of Object.entries(l.labels))t.push(`          ${o}: '${w(String(p))}'`)}if(l.annotations&&Object.keys(l.annotations).length>0){t.push("        annotations:");for(const[o,p]of Object.entries(l.annotations))t.push(`          ${o}: '${w(String(p))}'`)}t.push("")}return t.join(`
`)}function Ze(c){if(c.length===0)return"";const t=["groups:"];t.push("  - name: recording_rules"),t.push("    rules:");for(const l of c){if(t.push(`      - record: ${l.name}`),t.push(`        expr: ${l.expr}`),l.labels&&Object.keys(l.labels).length>0){t.push("        labels:");for(const[o,p]of Object.entries(l.labels))t.push(`          ${o}: '${w(String(p))}'`)}t.push("")}return t.join(`
`)}function w(c){return c.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\n/g,"\\n")}function es(c){try{const t=new URL(c);return t.port?`${t.hostname}:${t.port}`:t.protocol==="https:"?`${t.hostname}:443`:`${t.hostname}:80`}catch{const t=c.match(/^https?:\/\/([^\/]+)/);return t?t[1]:null}}function ss(c){try{return new URL(c).pathname||"/metrics"}catch{const t=c.match(/^https?:\/\/[^\/]+(\/.*)/);return t?t[1]:"/metrics"}}function ts(c,t="15s"){if(!c||c.length===0)return[];const l=new Map;for(const p of c){const v=p.job||"default";l.has(v)||l.set(v,[]),l.get(v).push(p)}const o=[];for(const[p,v]of l.entries()){const f=new Map;for(const x of v){const _=JSON.stringify(x.labels||{});f.has(_)||f.set(_,[]),f.get(_).push(x)}const i=[];let $,C,k;for(const[x,_]of f.entries()){const A=JSON.parse(x),S=[];for(const y of _){const Y=es(y.endpoint);Y&&S.push(Y),!$&&y.interval&&($=y.interval),!C&&y.metricsPath?C=y.metricsPath:C||(C=ss(y.endpoint)),!k&&y.scrapeTimeout&&(k=y.scrapeTimeout)}S.length>0&&i.push({targets:S,labels:Object.keys(A).length>0?A:void 0})}if(i.length>0){const x={job_name:p,static_configs:i};$&&$!==t&&(x.scrape_interval=$),C&&C!=="/metrics"&&(x.metrics_path=C),k&&(x.scrape_timeout=k),o.push(x)}}return o}function ue(c){return c.targets&&Array.isArray(c.targets)&&c.targets.length>0&&!c.scrape_configs}function as(c){if(!ue(c))return c;const t=ts(c.targets,c.scrapeInterval||"15s");return{...c,scrape_configs:t}}function ms({componentId:c}){const{nodes:t,updateNode:l,connections:o}=Pe(),{getComponentMetrics:p,isRunning:v}=Je(),f=t.find(s=>s.id===c);if(!f)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});let i=f.data.config||{};ue(i)&&(i=as(i),l(c,{data:{...f.data,config:i}}));const $=i.version||"2.48.0",C=i.scrapeInterval||"15s",k=i.evaluationInterval||"15s",x=i.retentionTime||"15d",_=i.storagePath||"/prometheus",A=i.enableRemoteWrite??!1,S=i.remoteWrite||[],y=i.enableAlertmanager??!0,Y=i.alertmanagerUrl||"http://alertmanager:9093",R=i.scrape_configs||[],F=i.alertingRules||[],q=i.recordingRules||[],K=i.serviceDiscovery||[],G=(()=>{if(R.reduce((a,r)=>a+(r.static_configs?.reduce((n,m)=>n+(m.targets?.length||0),0)||0),0)===0)return{status:"idle",label:"Idle",color:"bg-gray-500"};if(v){const a=p(c);if(a?.customMetrics){const r=a.customMetrics.targets_up||0,n=a.customMetrics.targets_down||0,m=a.customMetrics.scrape_errors_total||0;if(n>0||m>0)return{status:"degraded",label:"Degraded",color:"bg-yellow-500"};if(r>0)return{status:"healthy",label:"Healthy",color:"bg-green-500"}}}return{status:"configured",label:"Configured",color:"bg-blue-500"}})(),[ns,cs]=V.useState(null),[ls,is]=V.useState(null),[me,X]=V.useState(!1),[pe,Z]=V.useState(!1),[os,ge]=V.useState(!1),u=s=>{l(c,{data:{...f.data,config:{...i,...s}}})},xe=()=>{u({scrape_configs:[...R,{job_name:"new-job",static_configs:[{targets:[]}]}]})},je=s=>{u({scrape_configs:R.filter((a,r)=>r!==s)})},I=(s,a,r)=>{const n=[...R];n[s]={...n[s],[a]:r},u({scrape_configs:n})},ve=s=>{const a=[...R],r=a[s];a[s]={...r,static_configs:[...r.static_configs||[],{targets:[]}]},u({scrape_configs:a})},fe=(s,a)=>{const r=[...R],n=r[s];r[s]={...n,static_configs:n.static_configs.filter((m,d)=>d!==a)},u({scrape_configs:r})},ye=(s,a,r)=>{const n=[...R],m=n[s];m.static_configs[a],n[s]={...m,static_configs:m.static_configs.map((d,N)=>N===a?{...d,targets:[...d.targets||[],r]}:d)},u({scrape_configs:n})},Ne=(s,a,r)=>{const n=[...R],m=n[s];n[s]={...m,static_configs:m.static_configs.map((d,N)=>N===a?{...d,targets:d.targets.filter((L,b)=>b!==r)}:d)},u({scrape_configs:n})},be=(s,a,r,n)=>{const m=[...R],d=m[s];m[s]={...d,static_configs:d.static_configs.map((N,L)=>L===a?{...N,targets:N.targets.map((b,Le)=>Le===r?n:b)}:N)},u({scrape_configs:m})},Ce=(s,a,r)=>{const n=[...R],m=n[s];n[s]={...m,static_configs:m.static_configs.map((d,N)=>N===a?{...d,labels:Object.keys(r).length>0?r:void 0}:d)},u({scrape_configs:n})},_e=()=>{u({remoteWrite:[...S,{url:""}]})},we=s=>{u({remoteWrite:S.filter((a,r)=>r!==s)})},ee=(s,a)=>{const r=[...S];r[s]=a,u({remoteWrite:r})},Se=()=>{const s={name:"New Alert Rule",expr:"up == 0",for:"5m",labels:{},annotations:{},severity:"warning"};u({alertingRules:[...F,s]}),X(!1)},Re=s=>{u({alertingRules:F.filter((a,r)=>r!==s)})},Q=(s,a,r)=>{const n=[...F];n[s]={...n[s],[a]:r},u({alertingRules:n})},ke=()=>{const s={name:"new:metric:name",expr:"rate(metric_name[5m])",labels:{}};u({recordingRules:[...q,s]}),Z(!1)},$e=s=>{u({recordingRules:q.filter((a,r)=>r!==s)})},se=(s,a,r)=>{const n=[...q];n[s]={...n[s],[a]:r},u({recordingRules:n})},Te=()=>{const s={type:"static",config:{}};u({serviceDiscovery:[...K,s]}),ge(!1)},Oe=s=>{u({serviceDiscovery:K.filter((a,r)=>r!==s)})},te=(s,a,r)=>{const n=[...K];n[s]={...n[s],[a]:r},u({serviceDiscovery:n})},Ae=()=>{try{const s=Ge(i),a=i.alertingRules&&i.alertingRules.length>0?Xe(i.alertingRules):"",r=i.recordingRules&&i.recordingRules.length>0?Ze(i.recordingRules):"",n=new Blob([s],{type:"text/yaml"}),m=URL.createObjectURL(n),d=document.createElement("a");if(d.href=m,d.download="prometheus.yml",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m),a){const N=new Blob([a],{type:"text/yaml"}),L=URL.createObjectURL(N),b=document.createElement("a");b.href=L,b.download="alerts.yml",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(L)}if(r){const N=new Blob([r],{type:"text/yaml"}),L=URL.createObjectURL(N),b=document.createElement("a");b.href=L,b.download="recording_rules.yml",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(L)}qe("Configuration exported successfully")}catch(s){H(`Failed to export configuration: ${s instanceof Error?s.message:"Unknown error"}`)}};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(ae,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(Ue,{children:"Prometheus"}),e.jsx(De,{children:"Metrics collection & rule evaluation"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(re,{variant:"secondary",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${G.color} ${v&&G.status==="healthy"?"animate-pulse":""}`}),G.label]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:Ae,children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Export YAML"]})]})]}),e.jsx(ze,{}),e.jsxs(We,{defaultValue:"scraping",className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-6",children:[e.jsxs(M,{value:"scraping",className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Scraping"]}),e.jsxs(M,{value:"service-discovery",className:"gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Service Discovery"]}),e.jsxs(M,{value:"alerting-rules",className:"gap-2",children:[e.jsx(He,{className:"h-4 w-4"}),"Alerting Rules"]}),e.jsxs(M,{value:"recording-rules",className:"gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Recording Rules"]}),e.jsxs(M,{value:"storage",className:"gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Storage"]}),e.jsxs(M,{value:"remote",className:"gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Remote Write"]})]}),e.jsxs(B,{value:"scraping",className:"mt-4 space-y-4",children:[e.jsxs(P,{children:[e.jsxs(J,{children:[e.jsx(U,{children:"Global Settings"}),e.jsx(D,{children:"Intervals for scraping targets and evaluating rules"})]}),e.jsxs(T,{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Version"}),e.jsx(j,{value:$,onChange:s=>u({version:s.target.value}),placeholder:"2.48.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Scrape Interval"}),e.jsx(j,{value:C,onChange:s=>u({scrapeInterval:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Evaluation Interval"}),e.jsx(j,{value:k,onChange:s=>u({evaluationInterval:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Retention Time"}),e.jsx(j,{value:x,onChange:s=>u({retentionTime:s.target.value})})]})]})]}),e.jsxs(P,{children:[e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Scrape Configs"}),e.jsx(D,{children:"Scrape configurations for Prometheus (matches real Prometheus format)"})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:xe,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add Scrape Config"]})]}),e.jsxs(T,{className:"space-y-4",children:[R.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No scrape configurations"}),e.jsx("p",{className:"text-xs mt-2",children:"Add scrape configs manually or connect components to automatically add them"})]}),R.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 space-y-2",children:e.jsxs("div",{children:[e.jsx(h,{children:"Job Name"}),e.jsx(j,{value:s.job_name,className:"font-semibold",onChange:r=>I(a,"job_name",r.target.value),placeholder:"my-job"})]})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>je(a),children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Scrape Interval"}),e.jsx(j,{value:s.scrape_interval||C,onChange:r=>I(a,"scrape_interval",r.target.value||void 0),placeholder:C})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Metrics Path"}),e.jsx(j,{value:s.metrics_path||"/metrics",onChange:r=>I(a,"metrics_path",r.target.value||void 0),placeholder:"/metrics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Scrape Timeout"}),e.jsx(j,{value:s.scrape_timeout||"",onChange:r=>I(a,"scrape_timeout",r.target.value||void 0),placeholder:"10s"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Static Configs"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>ve(a),children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Add Static Config"]})]}),s.static_configs.map((r,n)=>e.jsxs("div",{className:"p-3 border border-border rounded bg-muted/50 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{className:"text-sm",children:["Static Config #",n+1]}),s.static_configs.length>1&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>fe(a,n),children:e.jsx(W,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs",children:"Targets (host:port)"}),e.jsxs("div",{className:"space-y-2",children:[r.targets.map((m,d)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{value:m,onChange:N=>be(a,n,d,N.target.value),placeholder:"host:port"}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>Ne(a,n,d),children:e.jsx(W,{className:"h-3 w-3"})})]},d)),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>ye(a,n,""),className:"w-full",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Add Target"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs",children:"Labels (JSON)"}),e.jsx(O,{className:"font-mono text-xs",rows:2,value:JSON.stringify(r.labels||{},null,2),onChange:m=>{try{const d=JSON.parse(m.target.value);Ce(a,n,d)}catch(d){H(`Неверный формат JSON: ${d instanceof Error?d.message:"Неизвестная ошибка"}`)}},placeholder:'{"env": "prod", "region": "us-east-1"}'})]})]},n))]})]},`${s.job_name}-${a}`))]})]})]}),e.jsx(B,{value:"storage",className:"mt-4 space-y-4",children:e.jsxs(P,{children:[e.jsxs(J,{children:[e.jsx(U,{children:"Local Storage"}),e.jsx(D,{children:"TSDB configuration"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Storage Path"}),e.jsx(j,{value:_,onChange:s=>u({storagePath:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Compaction Log"}),e.jsx(O,{className:"font-mono text-xs",rows:4,value:`level=info ts=${Date.now()} caller=compact.go:516 msg="compact blocks" count=3 mint=0 maxt=3600000`,readOnly:!0})]})]})]})}),e.jsx(B,{value:"remote",className:"mt-4 space-y-4",children:e.jsxs(P,{children:[e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Remote Write"}),e.jsx(D,{children:"Ship metrics to long-term storage"})]}),e.jsx(ne,{checked:A,onCheckedChange:s=>u({enableRemoteWrite:s})})]}),A&&e.jsxs(T,{className:"space-y-4",children:[S.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg space-y-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Endpoint #",a+1]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>we(a),children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Remote URL"}),e.jsx(j,{value:s.url,onChange:r=>ee(a,{...s,url:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Authorization Header"}),e.jsx(j,{placeholder:"Bearer ...",value:s.auth||"",onChange:r=>ee(a,{...s,auth:r.target.value})})]})]},a)),e.jsxs(g,{variant:"outline",size:"sm",onClick:_e,className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Add Endpoint"]})]})]})}),e.jsx(B,{value:"service-discovery",className:"mt-4 space-y-4",children:e.jsxs(P,{children:[e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Service Discovery"}),e.jsx(D,{children:"Configure automatic target discovery"})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:Te,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add Service Discovery"]})]}),e.jsxs(T,{className:"space-y-3",children:[K.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No service discovery configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Configure automatic target discovery for Kubernetes, Consul, etc."})]}),K.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ce,{value:s.type,onValueChange:r=>te(a,"type",r),children:[e.jsx(le,{className:"w-48",children:e.jsx(ie,{})}),e.jsxs(oe,{children:[e.jsx(E,{value:"kubernetes",children:"Kubernetes"}),e.jsx(E,{value:"consul",children:"Consul"}),e.jsx(E,{value:"static",children:"Static"}),e.jsx(E,{value:"file",children:"File"}),e.jsx(E,{value:"dns",children:"DNS"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Discovery Type"})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>Oe(a),children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Configuration (JSON)"}),e.jsx(O,{className:"font-mono text-xs",rows:4,value:JSON.stringify(s.config,null,2),onChange:r=>{try{const n=JSON.parse(r.target.value);te(a,"config",n)}catch(n){H(`Неверный формат JSON: ${n instanceof Error?n.message:"Неизвестная ошибка"}`)}},placeholder:'{"role": "pod", "namespaces": {"names": ["default"]}}'})]})]},a))]})]})}),e.jsxs(B,{value:"alerting-rules",className:"mt-4 space-y-4",children:[e.jsxs(P,{children:[e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Alerting Rules"}),e.jsx(D,{children:"Define PromQL expressions that trigger alerts"})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>X(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Alert Rule"]})]}),me&&e.jsx(T,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Rule Name"}),e.jsx(j,{placeholder:"HighCPUUsage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(O,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m]) > 0.8"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:Se,children:"Create Rule"}),e.jsx(g,{variant:"outline",onClick:()=>X(!1),children:"Cancel"})]})]})}),e.jsxs(T,{className:"space-y-3",children:[F.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No alerting rules configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Create rules to monitor your system and trigger alerts"})]}),F.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx(re,{variant:s.severity==="critical"?"destructive":s.severity==="warning"?"default":"secondary",children:s.severity||"info"})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>Re(a),children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(O,{className:"font-mono text-xs",rows:2,value:s.expr,onChange:r=>Q(a,"expr",r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"For Duration"}),e.jsx(j,{value:s.for||"",onChange:r=>Q(a,"for",r.target.value),placeholder:"5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Severity"}),e.jsxs(ce,{value:s.severity||"warning",onValueChange:r=>Q(a,"severity",r),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsxs(oe,{children:[e.jsx(E,{value:"critical",children:"Critical"}),e.jsx(E,{value:"warning",children:"Warning"}),e.jsx(E,{value:"info",children:"Info"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Labels (JSON)"}),e.jsx(O,{className:"font-mono text-xs",rows:2,value:JSON.stringify(s.labels||{},null,2),onChange:r=>{try{const n=JSON.parse(r.target.value);Q(a,"labels",n)}catch(n){H(`Неверный формат JSON: ${n instanceof Error?n.message:"Неизвестная ошибка"}`)}},placeholder:'{"severity": "warning"}'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Annotations (JSON)"}),e.jsx(O,{className:"font-mono text-xs",rows:2,value:JSON.stringify(s.annotations||{},null,2),onChange:r=>{try{const n=JSON.parse(r.target.value);Q(a,"annotations",n)}catch(n){H(`Неверный формат JSON: ${n instanceof Error?n.message:"Неизвестная ошибка"}`)}},placeholder:'{"summary": "Alert summary", "description": "Alert description"}'})]})]},a))]})]}),e.jsxs(P,{children:[e.jsxs(J,{children:[e.jsx(U,{children:"Alertmanager Integration"}),e.jsx(D,{children:"Configure alert notifications pipeline"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{children:"Enable Alertmanager"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Forward firing alerts to Alertmanager"})]}),e.jsx(ne,{checked:y,onCheckedChange:s=>u({enableAlertmanager:s})})]}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Alertmanager URL"}),e.jsx(j,{value:Y,onChange:s=>u({alertmanagerUrl:s.target.value})})]})]})]})]}),e.jsx(B,{value:"recording-rules",className:"mt-4 space-y-4",children:e.jsxs(P,{children:[e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Recording Rules"}),e.jsx(D,{children:"Pre-compute frequently used or expensive queries"})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>Z(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Recording Rule"]})]}),pe&&e.jsx(T,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Rule Name"}),e.jsx(j,{placeholder:"cpu:usage:rate5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(O,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m])"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:ke,children:"Create Rule"}),e.jsx(g,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"})]})]})}),e.jsxs(T,{className:"space-y-3",children:[q.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No recording rules configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Create rules to pre-compute frequently used queries"})]}),q.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold font-mono",children:s.name}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>$e(a),children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"PromQL Expression"}),e.jsx(O,{className:"font-mono text-xs",rows:2,value:s.expr,onChange:r=>se(a,"expr",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Labels (JSON)"}),e.jsx(O,{className:"font-mono text-xs",rows:2,value:JSON.stringify(s.labels||{},null,2),onChange:r=>{try{const n=JSON.parse(r.target.value);se(a,"labels",n)}catch(n){H(`Неверный формат JSON: ${n instanceof Error?n.message:"Неизвестная ошибка"}`)}},placeholder:'{"job": "node-exporter"}'})]})]},a))]})]})})]})]})})}export{ms as PrometheusConfigAdvanced};
