import{u as le,j as e,r as O,i as k,S as w,C as t,e as r,f as d,k as c,T as ie,a as ae,b as m,a2 as ne,F as te,A as ce,c as re,d as u,h as g,P as de,B as x,t as p,m as oe,L as n,I as j,n as S,o as R,p as P,q as D,s as o,X as T}from"./index-Dd33G1rA.js";import{R as xe}from"./refresh-ccw-BqMDkn9s.js";import{S as he}from"./shield-pnIeGi0d.js";import{G as je}from"./globe-OJLibZCs.js";import{C as me}from"./circle-check-big-DUY3LvWD.js";function Ce({componentId:A}){const{nodes:q,updateNode:G}=le(),y=q.find(s=>s.id===A);if(!y)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const i=y.data.config||{},F=i.mode||"detection",B=i.enableOWASP??!0,V=i.owaspRuleset||"3.3",I=i.enableRateLimiting??!0,M=i.rateLimitPerMinute||100,L=i.enableGeoBlocking??!1,b=i.blockedCountries||[],W=i.enableIPWhitelist??!1,N=i.whitelistedIPs||[],E=i.enableDDoSProtection??!0,z=i.ddosThreshold||1e3,h=i.rules||[{id:"1",name:"Block SQL Injection",description:"Detect and block SQL injection attempts",enabled:!0,action:"block",priority:1,conditions:[{type:"body",operator:"contains",value:"'; DROP TABLE"}]},{id:"2",name:"Block XSS",description:"Detect and block cross-site scripting",enabled:!0,action:"block",priority:2,conditions:[{type:"body",operator:"contains",value:"<script>"}]}],f=i.threats||[{id:"1",type:"sql-injection",sourceIP:"192.168.1.100",target:"/api/users",timestamp:new Date().toISOString(),severity:"critical",blocked:!0}],X=i.requestsBlocked||0,K=i.requestsAllowed||0,Q=i.threatsDetected||f.length,[ue,ge]=O.useState(null),[pe,U]=O.useState(!1),a=s=>{G(A,{data:{...y.data,config:{...i,...s}}})},$=()=>{const s={id:`rule-${Date.now()}`,name:"New Rule",description:"",enabled:!0,action:"block",priority:h.length+1,conditions:[]};a({rules:[...h,s]}),U(!1)},H=s=>{a({rules:h.filter(l=>l.id!==s)})},v=(s,l,ee)=>{const se=h.map(C=>C.id===s?{...C,[l]:ee}:C);a({rules:se})},J=s=>{b.includes(s)||a({blockedCountries:[...b,s]})},Y=s=>{a({blockedCountries:b.filter(l=>l!==s)})},Z=s=>{N.includes(s)||a({whitelistedIPs:[...N,s]})},_=s=>{a({whitelistedIPs:N.filter(l=>l!==s)})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Web Application Firewall"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"WAF Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Protect applications from web exploits and attacks"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{variant:"outline",size:"sm",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(w,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Requests Blocked"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold text-red-500",children:X.toLocaleString()})})]}),e.jsxs(t,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Requests Allowed"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold text-green-500",children:K.toLocaleString()})})]}),e.jsxs(t,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Threats Detected"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold text-orange-500",children:Q.toLocaleString()})})]}),e.jsxs(t,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Active Rules"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold",children:h.filter(s=>s.enabled).length})})]})]}),e.jsxs(ie,{defaultValue:"rules",className:"space-y-4",children:[e.jsxs(ae,{children:[e.jsxs(m,{value:"rules",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Rules (",h.length,")"]}),e.jsxs(m,{value:"threats",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Threats (",f.length,")"]}),e.jsxs(m,{value:"owasp",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"OWASP Rules"]}),e.jsxs(m,{value:"rate-limiting",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Rate Limiting"]}),e.jsxs(m,{value:"geo-blocking",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Geo-Blocking"]}),e.jsxs(m,{value:"settings",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(u,{value:"rules",className:"space-y-4",children:e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Custom Rules"}),e.jsx(g,{children:"Configure custom WAF rules"})]}),e.jsxs(k,{onClick:$,size:"sm",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Create Rule"]})]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsxs(t,{className:"border-l-4 border-l-blue-500",children:[e.jsx(r,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(x,{variant:s.enabled?"default":"outline",children:s.enabled?"Enabled":"Disabled"}),e.jsx(x,{variant:"outline",children:s.action}),e.jsxs(x,{variant:"outline",children:["Priority: ",s.priority]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{checked:s.enabled,onCheckedChange:l=>v(s.id,"enabled",l)}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>H(s.id),children:e.jsx(oe,{className:"h-4 w-4"})})]})]})}),e.jsx(c,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Rule Name"}),e.jsx(j,{value:s.name,onChange:l=>v(s.id,"name",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Action"}),e.jsxs(S,{value:s.action,onValueChange:l=>v(s.id,"action",l),children:[e.jsx(R,{children:e.jsx(P,{})}),e.jsxs(D,{children:[e.jsx(o,{value:"block",children:"Block"}),e.jsx(o,{value:"allow",children:"Allow"}),e.jsx(o,{value:"log",children:"Log"}),e.jsx(o,{value:"challenge",children:"Challenge"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Priority"}),e.jsx(j,{type:"number",value:s.priority,onChange:l=>v(s.id,"priority",Number(l.target.value)),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Description"}),e.jsx(j,{value:s.description,onChange:l=>v(s.id,"description",l.target.value),placeholder:"Rule description"})]})]})})]},s.id))})})]})}),e.jsx(u,{value:"threats",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsx(d,{children:"Detected Threats"}),e.jsx(g,{children:"Recent security threats and attacks"})]}),e.jsx(c,{children:f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No threats detected"}):e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsx(t,{className:`border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="high"?"border-l-orange-500":s.severity==="medium"?"border-l-yellow-500":"border-l-blue-500"}`,children:e.jsx(c,{className:"pt-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{variant:s.severity==="critical"?"destructive":s.severity==="high"?"default":"outline",children:s.severity}),e.jsx(x,{variant:"outline",children:s.type}),s.blocked?e.jsxs(x,{variant:"default",className:"bg-green-500",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Blocked"]}):e.jsxs(x,{variant:"outline",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Not Blocked"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Source IP: ",s.sourceIP]}),e.jsxs("p",{children:["Target: ",s.target]}),e.jsxs("p",{children:["Time: ",new Date(s.timestamp).toLocaleString()]})]})]})})})},s.id))})})]})}),e.jsx(u,{value:"owasp",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsx(d,{children:"OWASP ModSecurity Rules"}),e.jsx(g,{children:"Core Rule Set configuration"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable OWASP Rules"}),e.jsx(p,{checked:B,onCheckedChange:s=>a({enableOWASP:s})})]}),B&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"OWASP Rule Set Version"}),e.jsxs(S,{value:V,onValueChange:s=>a({owaspRuleset:s}),children:[e.jsx(R,{children:e.jsx(P,{})}),e.jsxs(D,{children:[e.jsx(o,{value:"3.3",children:"3.3 (Latest)"}),e.jsx(o,{value:"3.2",children:"3.2"}),e.jsx(o,{value:"3.1",children:"3.1"})]})]})]})]})]})}),e.jsx(u,{value:"rate-limiting",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsx(d,{children:"Rate Limiting"}),e.jsx(g,{children:"Configure request rate limits"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable Rate Limiting"}),e.jsx(p,{checked:I,onCheckedChange:s=>a({enableRateLimiting:s})})]}),I&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Rate Limit (requests per minute)"}),e.jsx(j,{type:"number",value:M,onChange:s=>a({rateLimitPerMinute:Number(s.target.value)}),min:1,max:1e4})]})]})]})}),e.jsx(u,{value:"geo-blocking",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsx(d,{children:"Geo-Blocking"}),e.jsx(g,{children:"Block requests from specific countries"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable Geo-Blocking"}),e.jsx(p,{checked:L,onCheckedChange:s=>a({enableGeoBlocking:s})})]}),L&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Blocked Countries (ISO codes)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(s=>e.jsxs(x,{variant:"outline",className:"gap-1",children:[s,e.jsx("button",{onClick:()=>Y(s),className:"ml-1 hover:text-destructive",children:e.jsx(T,{className:"h-3 w-3"})})]},s))}),e.jsx(j,{placeholder:"Enter ISO country code (e.g., CN, RU)",onKeyDown:s=>{if(s.key==="Enter"){const l=s.currentTarget.value.trim().toUpperCase();l&&(J(l),s.currentTarget.value="")}}})]})]})]})}),e.jsx(u,{value:"settings",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsx(d,{children:"WAF Settings"}),e.jsx(g,{children:"General WAF configuration"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Operation Mode"}),e.jsxs(S,{value:F,onValueChange:s=>a({mode:s}),children:[e.jsx(R,{children:e.jsx(P,{})}),e.jsxs(D,{children:[e.jsx(o,{value:"prevention",children:"Prevention (Block threats)"}),e.jsx(o,{value:"detection",children:"Detection (Log only)"}),e.jsx(o,{value:"logging",children:"Logging Only"})]})]})]}),e.jsx(w,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable DDoS Protection"}),e.jsx(p,{checked:E,onCheckedChange:s=>a({enableDDoSProtection:s})})]}),E&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"DDoS Threshold (requests per second)"}),e.jsx(j,{type:"number",value:z,onChange:s=>a({ddosThreshold:Number(s.target.value)}),min:100,max:1e5})]}),e.jsx(w,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable IP Whitelist"}),e.jsx(p,{checked:W,onCheckedChange:s=>a({enableIPWhitelist:s})})]}),W&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Whitelisted IPs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(s=>e.jsxs(x,{variant:"outline",className:"gap-1",children:[s,e.jsx("button",{onClick:()=>_(s),className:"ml-1 hover:text-destructive",children:e.jsx(T,{className:"h-3 w-3"})})]},s))}),e.jsx(j,{placeholder:"Enter IP or CIDR (e.g., 192.168.1.0/24)",onKeyDown:s=>{if(s.key==="Enter"){const l=s.currentTarget.value.trim();l&&(Z(l),s.currentTarget.value="")}}})]})]})]})})]})]})})}export{Ce as WAFConfigAdvanced};
