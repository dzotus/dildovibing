import{J as xe,u as he,j as e,r as y,e as je,l as g,S as F,C as c,h as o,i as m,m as d,T as ge,b as pe,c as w,A as ve,f as S,k,P as W,B as x,o as K,L as t,I as u,q as z,s as A,t as I,v as X,w as j,x as Ne}from"./index-Cr1wcIS8.js";import{T as Ce}from"./textarea-Dvy4XTRf.js";import{R as fe}from"./refresh-ccw-sjVO-8we.js";import{D as $}from"./database-xMKuW3ZI.js";import{K as be}from"./key-DKkNLHjr.js";const ye=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],J=xe("snowflake",ye);function We({componentId:Q}){const{nodes:G,updateNode:Y}=he(),L=G.find(s=>s.id===Q);if(!L)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const i=L.data.config||{},R=i.account||"archiphoenix",Z=i.region||"us-east-1",_=R.includes(".")?R:`${R}.${Z}.aws`,ee=i.username||"admin",se=i.password||"",B=i.warehouse||"COMPUTE_WH",O=i.database||"SNOWFLAKE",q=i.schema||"PUBLIC",ae=i.role||"ACCOUNTADMIN",h=i.warehouses||[],p=i.databases||[{name:"SNOWFLAKE",comment:"System database",retentionTime:1,size:0,schemas:[{name:"INFORMATION_SCHEMA",tables:0,views:0,functions:0}]}],P=i.queries||[],[Se,ke]=y.useState(null),[Qe,Le]=y.useState(null),[ne,T]=y.useState(!1),[C,D]=y.useState(""),v=je.getSnowflakeRoutingEngine(Q),l=s=>{Y(Q,{data:{...L.data,config:{...i,...s}}})},te=()=>{const s={name:"NEW_WH",size:"Small",autoSuspend:60,autoResume:!0,minClusterCount:1,maxClusterCount:1,status:"suspended",runningQueries:0,queuedQueries:0};l({warehouses:[...h,s]})},re=s=>{l({warehouses:h.filter((n,a)=>a!==s)})},N=(s,n,a)=>{const r=[...h];r[s]={...r[s],[n]:a},l({warehouses:r})},le=()=>{const s={name:"NEW_DB",retentionTime:1,size:0,schemas:[{name:"PUBLIC",tables:0,views:0,functions:0}]};l({databases:[...p,s]})},ce=s=>{l({databases:p.filter((n,a)=>a!==s)})},E=(s,n,a)=>{const r=[...p];r[s]={...r[s],[n]:a},l({databases:r})},ie=()=>{if(!C.trim())return;const s={id:`query-${Date.now()}`,queryText:C,status:"running",warehouse:B,database:O,schema:q,duration:0,rowsReturned:0};l({queries:[s,...P.slice(0,9)]}),D(""),T(!1)},U=v?.getMetrics(),H=v?.getWarehouses()||[],V=v?.getRecentQueries(10)||[],de=U?.runningQueries??h.reduce((s,n)=>s+(n.runningQueries||0),0),ue=U?.queuedQueries??h.reduce((s,n)=>s+(n.queuedQueries||0),0),f=H.length>0?H.map(s=>{const n=h.find(a=>a.name===s.name);return{...s,autoSuspend:s.autoSuspend??n?.autoSuspend,autoResume:s.autoResume??n?.autoResume,minClusterCount:s.minClusterCount??n?.minClusterCount??1,maxClusterCount:s.maxClusterCount??n?.maxClusterCount??1}}):h,M=V.length>0?V:P,oe=()=>{if(!v)return;v.getMetrics();const s=v.getWarehouses(),n=v.getRecentQueries(100),a=s.map(r=>{const b=h.find(me=>me.name===r.name);return{...r,autoSuspend:b?.autoSuspend??r.autoSuspend,autoResume:b?.autoResume??r.autoResume,minClusterCount:b?.minClusterCount??r.minClusterCount,maxClusterCount:b?.maxClusterCount??r.maxClusterCount}});l({warehouses:a.length>0?a:h,queries:n.slice(0,100)})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Snowflake Data Cloud"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Data Warehouse"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Configure warehouses, databases, schemas and execute queries"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:oe,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(F,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm font-medium",children:"Account"})}),e.jsx(d,{children:e.jsx("p",{className:"text-sm break-words leading-tight",children:_})})]}),e.jsxs(c,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm font-medium",children:"Warehouses"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold",children:f.length})})]}),e.jsxs(c,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm font-medium",children:"Running Queries"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold",children:de})})]}),e.jsxs(c,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-sm font-medium",children:"Queued Queries"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold",children:ue})})]})]}),e.jsxs(ge,{defaultValue:"warehouses",className:"space-y-4",children:[e.jsxs(pe,{children:[e.jsxs(w,{value:"warehouses",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Warehouses (",f.length,")"]}),e.jsxs(w,{value:"databases",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Databases (",p.length,")"]}),e.jsxs(w,{value:"queries",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Queries (",M.length,")"]}),e.jsxs(w,{value:"connection",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Connection"]})]}),e.jsx(S,{value:"warehouses",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Compute Warehouses"}),e.jsx(k,{children:"Configure virtual warehouses for query processing"})]}),e.jsxs(g,{onClick:te,size:"sm",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Create Warehouse"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:f.map((s,n)=>e.jsxs(c,{className:"border-l-4 border-l-blue-500",children:[e.jsx(o,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(x,{variant:s.status==="running"?"default":"outline",children:s.status||"suspended"}),e.jsx(x,{variant:"outline",children:s.size}),e.jsxs(x,{variant:"outline",children:[s.runningQueries||0," running"]})]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>re(n),disabled:h.length===1,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Running Queries"}),e.jsx("p",{className:"text-lg font-semibold",children:s.runningQueries||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Queued Queries"}),e.jsx("p",{className:"text-lg font-semibold",children:s.queuedQueries||0})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Warehouse Name"}),e.jsx(u,{value:s.name,onChange:a=>N(n,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Size"}),e.jsxs(z,{value:s.size,onValueChange:a=>N(n,"size",a),children:[e.jsx(A,{children:e.jsx(I,{})}),e.jsxs(X,{children:[e.jsx(j,{value:"X-Small",children:"X-Small"}),e.jsx(j,{value:"Small",children:"Small"}),e.jsx(j,{value:"Medium",children:"Medium"}),e.jsx(j,{value:"Large",children:"Large"}),e.jsx(j,{value:"X-Large",children:"X-Large"}),e.jsx(j,{value:"2X-Large",children:"2X-Large"}),e.jsx(j,{value:"3X-Large",children:"3X-Large"}),e.jsx(j,{value:"4X-Large",children:"4X-Large"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Auto Suspend (seconds)"}),e.jsx(u,{type:"number",value:s.autoSuspend||60,onChange:a=>N(n,"autoSuspend",Number(a.target.value))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Auto Resume"}),e.jsx(Ne,{checked:s.autoResume??!0,onCheckedChange:a=>N(n,"autoResume",a)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Min Clusters"}),e.jsx(u,{type:"number",value:s.minClusterCount||1,onChange:a=>N(n,"minClusterCount",Number(a.target.value)),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Max Clusters"}),e.jsx(u,{type:"number",value:s.maxClusterCount||1,onChange:a=>N(n,"maxClusterCount",Number(a.target.value)),min:1})]})]})]})]},n))})})]})}),e.jsx(S,{value:"databases",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Databases"}),e.jsx(k,{children:"Manage databases and schemas"})]}),e.jsxs(g,{onClick:le,size:"sm",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Create Database"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:p.map((s,n)=>e.jsxs(c,{className:"border-l-4 border-l-green-500",children:[e.jsx(o,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(x,{variant:"outline",children:[s.schemas?.length||0," schemas"]}),s.size!==void 0&&e.jsxs(x,{variant:"outline",children:[s.size.toLocaleString()," bytes"]})]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>ce(n),disabled:p.length===1,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Database Name"}),e.jsx(u,{value:s.name,onChange:a=>E(n,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Retention Time (days)"}),e.jsx(u,{type:"number",value:s.retentionTime||1,onChange:a=>E(n,"retentionTime",Number(a.target.value))})]})]}),s.comment&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Comment"}),e.jsx(u,{value:s.comment,onChange:a=>E(n,"comment",a.target.value)})]}),s.schemas&&s.schemas.length>0&&e.jsxs("div",{children:[e.jsx(t,{className:"mb-2 block",children:"Schemas"}),e.jsx("div",{className:"space-y-2",children:s.schemas.map((a,r)=>e.jsx(c,{className:"p-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(x,{variant:"outline",children:[a.tables||0," tables"]}),e.jsxs(x,{variant:"outline",children:[a.views||0," views"]}),e.jsxs(x,{variant:"outline",children:[a.functions||0," functions"]})]})]})})},r))})]})]})]},n))})})]})}),e.jsx(S,{value:"queries",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Query History"}),e.jsx(k,{children:"Execute and monitor SQL queries"})]}),e.jsxs(g,{onClick:()=>T(!0),size:"sm",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"New Query"]})]})}),e.jsxs(d,{children:[ne&&e.jsxs(c,{className:"mb-4 border-primary",children:[e.jsx(o,{children:e.jsx(m,{children:"Execute Query"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"SQL Query"}),e.jsx(Ce,{value:C,onChange:s=>D(s.target.value),placeholder:"SELECT * FROM table_name LIMIT 10;",rows:6})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:ie,disabled:!C.trim(),children:"Execute"}),e.jsx(g,{variant:"outline",onClick:()=>{T(!1),D("")},children:"Cancel"})]})]})]}),M.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No queries executed"}):e.jsx("div",{className:"space-y-2",children:M.map(s=>e.jsx(c,{className:"border-l-4 border-l-purple-500",children:e.jsx(d,{className:"pt-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{variant:s.status==="success"?"default":s.status==="failed"?"destructive":s.status==="running"?"secondary":"outline",children:s.status}),s.warehouse&&e.jsx(x,{variant:"outline",children:s.warehouse}),s.duration!==void 0&&e.jsxs(x,{variant:"outline",children:[s.duration,"ms"]})]}),e.jsx("p",{className:"text-sm font-mono bg-muted p-2 rounded text-xs",children:s.queryText}),s.rowsReturned!==void 0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Rows returned: ",s.rowsReturned]})]})})})},s.id))})]})]})}),e.jsx(S,{value:"connection",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Connection Settings"}),e.jsx(k,{children:"Configure Snowflake connection parameters"})]}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Account"}),e.jsx(u,{value:_,onChange:s=>l({account:s.target.value}),placeholder:"account.region.cloud"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Username"}),e.jsx(u,{value:ee,onChange:s=>l({username:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Password"}),e.jsx(u,{type:"password",value:se,onChange:s=>l({password:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Role"}),e.jsx(u,{value:ae,onChange:s=>l({role:s.target.value}),placeholder:"ACCOUNTADMIN"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Warehouse"}),e.jsxs(z,{value:B,onValueChange:s=>l({warehouse:s}),children:[e.jsx(A,{children:e.jsx(I,{})}),e.jsx(X,{children:f.map(s=>e.jsx(j,{value:s.name,children:s.name},s.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Database"}),e.jsxs(z,{value:O,onValueChange:s=>l({database:s}),children:[e.jsx(A,{children:e.jsx(I,{})}),e.jsx(X,{children:p.map(s=>e.jsx(j,{value:s.name,children:s.name},s.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Schema"}),e.jsx(u,{value:q,onChange:s=>l({schema:s.target.value}),placeholder:"PUBLIC"})]})]})})]})})]})]})})}export{We as SnowflakeConfigAdvanced};
