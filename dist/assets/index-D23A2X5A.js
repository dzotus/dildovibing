const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KafkaConfigAdvanced-BOpLuO4v.js","assets/progress-BWG7Hc0v.js","assets/textarea-jYm4DBr1.js","assets/database-NUChT3Xv.js","assets/users-Dz6R0HsC.js","assets/shield-zjpi15QO.js","assets/RabbitMQConfigAdvanced-BKyqI78e.js","assets/usePortValidation-C100Hz9U.js","assets/requiredFields-BLgUUVkB.js","assets/toast-y51Cxgtb.js","assets/message-square-BgY2EI2R.js","assets/arrow-right-left-Bm2_LMsN.js","assets/key-0OQPKhEY.js","assets/PostgreSQLConfigAdvanced-CspIMofc.js","assets/file-code-CiB-VKAE.js","assets/table-C5j6f1PI.js","assets/MongoDBConfigAdvanced-C-Hqgfzs.js","assets/RedisConfigAdvanced-BFqlXSUc.js","assets/ElasticsearchConfigAdvanced-CnMLUKTg.js","assets/refresh-ccw-C1sN3B1t.js","assets/code-B6ADZZsZ.js","assets/CassandraConfigAdvanced-CM08hDrT.js","assets/ClickHouseConfigAdvanced-DanDkouU.js","assets/chart-column-Cky0Ux6R.js","assets/SnowflakeConfigAdvanced-CGE2ZzCE.js","assets/S3DataLakeConfigAdvanced-L23Mecc5.js","assets/folder-Br1Slqxn.js","assets/NginxConfigAdvanced-C6zYnjBC.js","assets/use-toast-LEvjeSn9.js","assets/globe-BUVqWm7r.js","assets/server-Cc1tE2dk.js","assets/RestApiConfigAdvanced-CIKrNFRq.js","assets/trending-up-BQoQa7Kb.js","assets/clock-CumNGRXg.js","assets/GRPCConfigAdvanced-_YUzikrp.js","assets/circle-check-big-D5vTmfeK.js","assets/WebSocketConfigAdvanced-BaWMN2Uo.js","assets/send-BJRlhGYb.js","assets/GraphQLConfigAdvanced-zmOr5Mey.js","assets/SOAPConfigAdvanced-ujYovjf0.js","assets/WebhookConfigAdvanced-DWyUnFu8.js","assets/webhook-B1QD5xlF.js","assets/DockerK8sConfigAdvanced-D_Ag5pRt.js","assets/alert-BY2Q9R-e.js","assets/loader-circle-DBhHTxvE.js","assets/hard-drive-D8ww-_DW.js","assets/InfrastructureConfig-D5F0Ftn6.js","assets/KubernetesConfigAdvanced-NzIZO296.js","assets/HAProxyConfigAdvanced-Ccoq-zAH.js","assets/TraefikConfigAdvanced-BvvhanC1.js","assets/route-CrnufPXC.js","assets/EnvoyConfigAdvanced-DzC8MQIF.js","assets/ActiveMQConfigAdvanced-BAYprIRP.js","assets/pen-D906WDt7.js","assets/AWSSQSConfigAdvanced-Bvtq4x1o.js","assets/cloud-C6-thDgd.js","assets/AzureServiceBusConfigAdvanced-D4TaTUmC.js","assets/GCPPubSubConfigAdvanced-Ku9OF4Wc.js","assets/KongConfigAdvanced-B28bi_BW.js","assets/ApigeeConfigAdvanced-De4QCBK5.js","assets/MuleSoftConfigAdvanced-DdBs05Ay.js","assets/GraphQLGatewayConfigAdvanced-BPeF2DCb.js","assets/BFFServiceConfigAdvanced-BFcLcXqV.js","assets/WebhookRelayConfigAdvanced-d1yGnTp_.js","assets/PrometheusConfigAdvanced-zAUu-tUo.js","assets/GrafanaConfigAdvanced-DN3Z04FU.js","assets/BarChart-CmGFhKya.js","assets/LokiConfigAdvanced-CoLMpNn0.js","assets/JaegerConfigAdvanced-D_N2u7LK.js","assets/git-branch-CEfDrGbX.js","assets/OpenTelemetryCollectorConfigAdvanced-DiHapVBi.js","assets/PagerDutyConfigAdvanced-BmUWcBWi.js","assets/bell-C_ADig1N.js","assets/KeycloakConfigAdvanced-CaHBxvOM.js","assets/lock-XZfdzNCT.js","assets/mail-DeJFqj3V.js","assets/eye-off-BPcPAVv3.js","assets/WAFConfigAdvanced-CBEjZe3A.js","assets/SecretsVaultConfigAdvanced-SylSt_f_.js","assets/IDSIPSConfigAdvanced-BNBx0WFX.js","assets/FirewallConfigAdvanced-3R0tnc3I.js","assets/JenkinsConfigAdvanced-DLkAGaFA.js","assets/package-DtzxkauA.js","assets/GitLabCIConfigAdvanced-Bh8W3K-9.js","assets/calendar-CKUmHsIq.js","assets/ArgoCDConfigAdvanced-C5nejwfS.js","assets/folder-git-2-69JoGzQw.js","assets/HarborConfigAdvanced-iTnuo3Jo.js","assets/TerraformConfigAdvanced-B7V61Mm5.js","assets/AnsibleConfigAdvanced-BakoglzQ.js","assets/IstioConfigAdvanced-gy8urxWV.js","assets/ServiceMeshConfigAdvanced-C_WaQE0n.js","assets/APIGatewayConfigAdvanced-Cptc_PSF.js","assets/VPNConfigAdvanced-CNTIBq4f.js","assets/CDNConfigAdvanced-Dp4pGf1S.js","assets/SparkConfigAdvanced-DlW8Twnm.js","assets/TensorFlowServingConfigAdvanced-CWmbUarE.js","assets/PyTorchServeConfigAdvanced-BWSKFirq.js","assets/FeatureStoreConfigAdvanced-B14DLIpZ.js","assets/MLflowConfigAdvanced-BPQzbDy3.js","assets/CRMConfigAdvanced-B-XRbt_R.js","assets/dollar-sign-BkkviSKT.js","assets/building-B-Ym_57L.js","assets/ERPConfigAdvanced-C7q7y6Ri.js","assets/RPABotConfigAdvanced-EU2eUQ7a.js","assets/BPMNEngineConfigAdvanced-blwOYJ24.js","assets/PaymentGatewayConfigAdvanced-wYkVqHol.js"])))=>i.map(i=>d[i]);
function SR(r,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();var c3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Fh={exports:{}},wr={};var j0;function MR(){if(j0)return wr;j0=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,i){var o=null;if(i!==void 0&&(o=""+i),s.key!==void 0&&(o=""+s.key),"key"in s){i={};for(var c in s)c!=="key"&&(i[c]=s[c])}else i=s;return s=i.ref,{$$typeof:r,type:n,key:o,ref:s!==void 0?s:null,props:i}}return wr.Fragment=t,wr.jsx=e,wr.jsxs=e,wr}var L0;function RR(){return L0||(L0=1,Fh.exports=MR()),Fh.exports}var g=RR(),Vh={exports:{}},ze={};var z0;function ER(){if(z0)return ze;z0=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function v(j){return j===null||typeof j!="object"?null:(j=y&&j[y]||j["@@iterator"],typeof j=="function"?j:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,R={};function M(j,F,Y){this.props=j,this.context=F,this.refs=R,this.updater=Y||x}M.prototype.isReactComponent={},M.prototype.setState=function(j,F){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,F,"setState")},M.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function T(){}T.prototype=M.prototype;function k(j,F,Y){this.props=j,this.context=F,this.refs=R,this.updater=Y||x}var A=k.prototype=new T;A.constructor=k,S(A,M.prototype),A.isPureReactComponent=!0;var _=Array.isArray;function P(){}var z={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function Z(j,F,Y){var ie=Y.ref;return{$$typeof:r,type:j,key:F,ref:ie!==void 0?ie:null,props:Y}}function se(j,F){return Z(j.type,F,j.props)}function ce(j){return typeof j=="object"&&j!==null&&j.$$typeof===r}function J(j){var F={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(Y){return F[Y]})}var te=/\/+/g;function le(j,F){return typeof j=="object"&&j!==null&&j.key!=null?J(""+j.key):F.toString(36)}function ue(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(P,P):(j.status="pending",j.then(function(F){j.status==="pending"&&(j.status="fulfilled",j.value=F)},function(F){j.status==="pending"&&(j.status="rejected",j.reason=F)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function L(j,F,Y,ie,U){var ae=typeof j;(ae==="undefined"||ae==="boolean")&&(j=null);var B=!1;if(j===null)B=!0;else switch(ae){case"bigint":case"string":case"number":B=!0;break;case"object":switch(j.$$typeof){case r:case t:B=!0;break;case f:return B=j._init,L(B(j._payload),F,Y,ie,U)}}if(B)return U=U(j),B=ie===""?"."+le(j,0):ie,_(U)?(Y="",B!=null&&(Y=B.replace(te,"$&/")+"/"),L(U,F,Y,"",function(me){return me})):U!=null&&(ce(U)&&(U=se(U,Y+(U.key==null||j&&j.key===U.key?"":(""+U.key).replace(te,"$&/")+"/")+B)),F.push(U)),1;B=0;var Q=ie===""?".":ie+":";if(_(j))for(var pe=0;pe<j.length;pe++)ie=j[pe],ae=Q+le(ie,pe),B+=L(ie,F,Y,ae,U);else if(pe=v(j),typeof pe=="function")for(j=pe.call(j),pe=0;!(ie=j.next()).done;)ie=ie.value,ae=Q+le(ie,pe++),B+=L(ie,F,Y,ae,U);else if(ae==="object"){if(typeof j.then=="function")return L(ue(j),F,Y,ie,U);throw F=String(j),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return B}function N(j,F,Y){if(j==null)return j;var ie=[],U=0;return L(j,ie,"","",function(ae){return F.call(Y,ae,U++)}),ie}function O(j){if(j._status===-1){var F=j._result;F=F(),F.then(function(Y){(j._status===0||j._status===-1)&&(j._status=1,j._result=Y)},function(Y){(j._status===0||j._status===-1)&&(j._status=2,j._result=Y)}),j._status===-1&&(j._status=0,j._result=F)}if(j._status===1)return j._result.default;throw j._result}var W=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)},fe={map:N,forEach:function(j,F,Y){N(j,function(){F.apply(this,arguments)},Y)},count:function(j){var F=0;return N(j,function(){F++}),F},toArray:function(j){return N(j,function(F){return F})||[]},only:function(j){if(!ce(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};return ze.Activity=m,ze.Children=fe,ze.Component=M,ze.Fragment=e,ze.Profiler=s,ze.PureComponent=k,ze.StrictMode=n,ze.Suspense=u,ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,ze.__COMPILER_RUNTIME={__proto__:null,c:function(j){return z.H.useMemoCache(j)}},ze.cache=function(j){return function(){return j.apply(null,arguments)}},ze.cacheSignal=function(){return null},ze.cloneElement=function(j,F,Y){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var ie=S({},j.props),U=j.key;if(F!=null)for(ae in F.key!==void 0&&(U=""+F.key),F)!q.call(F,ae)||ae==="key"||ae==="__self"||ae==="__source"||ae==="ref"&&F.ref===void 0||(ie[ae]=F[ae]);var ae=arguments.length-2;if(ae===1)ie.children=Y;else if(1<ae){for(var B=Array(ae),Q=0;Q<ae;Q++)B[Q]=arguments[Q+2];ie.children=B}return Z(j.type,U,ie)},ze.createContext=function(j){return j={$$typeof:o,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:i,_context:j},j},ze.createElement=function(j,F,Y){var ie,U={},ae=null;if(F!=null)for(ie in F.key!==void 0&&(ae=""+F.key),F)q.call(F,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(U[ie]=F[ie]);var B=arguments.length-2;if(B===1)U.children=Y;else if(1<B){for(var Q=Array(B),pe=0;pe<B;pe++)Q[pe]=arguments[pe+2];U.children=Q}if(j&&j.defaultProps)for(ie in B=j.defaultProps,B)U[ie]===void 0&&(U[ie]=B[ie]);return Z(j,ae,U)},ze.createRef=function(){return{current:null}},ze.forwardRef=function(j){return{$$typeof:c,render:j}},ze.isValidElement=ce,ze.lazy=function(j){return{$$typeof:f,_payload:{_status:-1,_result:j},_init:O}},ze.memo=function(j,F){return{$$typeof:h,type:j,compare:F===void 0?null:F}},ze.startTransition=function(j){var F=z.T,Y={};z.T=Y;try{var ie=j(),U=z.S;U!==null&&U(Y,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(P,W)}catch(ae){W(ae)}finally{F!==null&&Y.types!==null&&(F.types=Y.types),z.T=F}},ze.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},ze.use=function(j){return z.H.use(j)},ze.useActionState=function(j,F,Y){return z.H.useActionState(j,F,Y)},ze.useCallback=function(j,F){return z.H.useCallback(j,F)},ze.useContext=function(j){return z.H.useContext(j)},ze.useDebugValue=function(){},ze.useDeferredValue=function(j,F){return z.H.useDeferredValue(j,F)},ze.useEffect=function(j,F){return z.H.useEffect(j,F)},ze.useEffectEvent=function(j){return z.H.useEffectEvent(j)},ze.useId=function(){return z.H.useId()},ze.useImperativeHandle=function(j,F,Y){return z.H.useImperativeHandle(j,F,Y)},ze.useInsertionEffect=function(j,F){return z.H.useInsertionEffect(j,F)},ze.useLayoutEffect=function(j,F){return z.H.useLayoutEffect(j,F)},ze.useMemo=function(j,F){return z.H.useMemo(j,F)},ze.useOptimistic=function(j,F){return z.H.useOptimistic(j,F)},ze.useReducer=function(j,F,Y){return z.H.useReducer(j,F,Y)},ze.useRef=function(j){return z.H.useRef(j)},ze.useState=function(j){return z.H.useState(j)},ze.useSyncExternalStore=function(j,F,Y){return z.H.useSyncExternalStore(j,F,Y)},ze.useTransition=function(){return z.H.useTransition()},ze.version="19.2.0",ze}var I0;function qf(){return I0||(I0=1,Vh.exports=ER()),Vh.exports}var C=qf();const kt=Hf(C),$f=SR({__proto__:null,default:kt},[C]);var Gh={exports:{}},Cr={},Qh={exports:{}},Kh={};var O0;function kR(){return O0||(O0=1,(function(r){function t(L,N){var O=L.length;L.push(N);e:for(;0<O;){var W=O-1>>>1,fe=L[W];if(0<s(fe,N))L[W]=N,L[O]=fe,O=W;else break e}}function e(L){return L.length===0?null:L[0]}function n(L){if(L.length===0)return null;var N=L[0],O=L.pop();if(O!==N){L[0]=O;e:for(var W=0,fe=L.length,j=fe>>>1;W<j;){var F=2*(W+1)-1,Y=L[F],ie=F+1,U=L[ie];if(0>s(Y,O))ie<fe&&0>s(U,Y)?(L[W]=U,L[ie]=O,W=ie):(L[W]=Y,L[F]=O,W=F);else if(ie<fe&&0>s(U,O))L[W]=U,L[ie]=O,W=ie;else break e}}return N}function s(L,N){var O=L.sortIndex-N.sortIndex;return O!==0?O:L.id-N.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,c=o.now();r.unstable_now=function(){return o.now()-c}}var u=[],h=[],f=1,m=null,y=3,v=!1,x=!1,S=!1,R=!1,M=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function A(L){for(var N=e(h);N!==null;){if(N.callback===null)n(h);else if(N.startTime<=L)n(h),N.sortIndex=N.expirationTime,t(u,N);else break;N=e(h)}}function _(L){if(S=!1,A(L),!x)if(e(u)!==null)x=!0,P||(P=!0,J());else{var N=e(h);N!==null&&ue(_,N.startTime-L)}}var P=!1,z=-1,q=5,Z=-1;function se(){return R?!0:!(r.unstable_now()-Z<q)}function ce(){if(R=!1,P){var L=r.unstable_now();Z=L;var N=!0;try{e:{x=!1,S&&(S=!1,T(z),z=-1),v=!0;var O=y;try{t:{for(A(L),m=e(u);m!==null&&!(m.expirationTime>L&&se());){var W=m.callback;if(typeof W=="function"){m.callback=null,y=m.priorityLevel;var fe=W(m.expirationTime<=L);if(L=r.unstable_now(),typeof fe=="function"){m.callback=fe,A(L),N=!0;break t}m===e(u)&&n(u),A(L)}else n(u);m=e(u)}if(m!==null)N=!0;else{var j=e(h);j!==null&&ue(_,j.startTime-L),N=!1}}break e}finally{m=null,y=O,v=!1}N=void 0}}finally{N?J():P=!1}}}var J;if(typeof k=="function")J=function(){k(ce)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,le=te.port2;te.port1.onmessage=ce,J=function(){le.postMessage(null)}}else J=function(){M(ce,0)};function ue(L,N){z=M(function(){L(r.unstable_now())},N)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(L){L.callback=null},r.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<L?Math.floor(1e3/L):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(L){switch(y){case 1:case 2:case 3:var N=3;break;default:N=y}var O=y;y=N;try{return L()}finally{y=O}},r.unstable_requestPaint=function(){R=!0},r.unstable_runWithPriority=function(L,N){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var O=y;y=L;try{return N()}finally{y=O}},r.unstable_scheduleCallback=function(L,N,O){var W=r.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?W+O:W):O=W,L){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=O+fe,L={id:f++,callback:N,priorityLevel:L,startTime:O,expirationTime:fe,sortIndex:-1},O>W?(L.sortIndex=O,t(h,L),e(u)===null&&L===e(h)&&(S?(T(z),z=-1):S=!0,ue(_,O-W))):(L.sortIndex=fe,t(u,L),x||v||(x=!0,P||(P=!0,J()))),L},r.unstable_shouldYield=se,r.unstable_wrapCallback=function(L){var N=y;return function(){var O=y;y=N;try{return L.apply(this,arguments)}finally{y=O}}}})(Kh)),Kh}var H0;function TR(){return H0||(H0=1,Qh.exports=kR()),Qh.exports}var Yh={exports:{}},cn={};var q0;function AR(){if(q0)return cn;q0=1;var r=qf();function t(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function i(u,h,f){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:u,containerInfo:h,implementation:f}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return cn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,cn.createPortal=function(u,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return i(u,h,null,f)},cn.flushSync=function(u){var h=o.T,f=n.p;try{if(o.T=null,n.p=2,u)return u()}finally{o.T=h,n.p=f,n.d.f()}},cn.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(u,h))},cn.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},cn.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var f=h.as,m=c(f,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;f==="style"?n.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:v}):f==="script"&&n.d.X(u,{crossOrigin:m,integrity:y,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},cn.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var f=c(h.as,h.crossOrigin);n.d.M(u,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(u)},cn.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var f=h.as,m=c(f,h.crossOrigin);n.d.L(u,f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},cn.preloadModule=function(u,h){if(typeof u=="string")if(h){var f=c(h.as,h.crossOrigin);n.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(u)},cn.requestFormReset=function(u){n.d.r(u)},cn.unstable_batchedUpdates=function(u,h){return u(h)},cn.useFormState=function(u,h,f){return o.H.useFormState(u,h,f)},cn.useFormStatus=function(){return o.H.useHostTransitionStatus()},cn.version="19.2.0",cn}var $0;function Xv(){if($0)return Yh.exports;$0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Yh.exports=AR(),Yh.exports}var B0;function DR(){if(B0)return Cr;B0=1;var r=TR(),t=qf(),e=Xv();function n(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function i(a){var l=a,d=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(d=l.return),a=l.return;while(a)}return l.tag===3?d:null}function o(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function c(a){if(a.tag===31){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function u(a){if(i(a)!==a)throw Error(n(188))}function h(a){var l=a.alternate;if(!l){if(l=i(a),l===null)throw Error(n(188));return l!==a?null:a}for(var d=a,p=l;;){var b=d.return;if(b===null)break;var w=b.alternate;if(w===null){if(p=b.return,p!==null){d=p;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===d)return u(b),a;if(w===p)return u(b),l;w=w.sibling}throw Error(n(188))}if(d.return!==p.return)d=b,p=w;else{for(var E=!1,D=b.child;D;){if(D===d){E=!0,d=b,p=w;break}if(D===p){E=!0,p=b,d=w;break}D=D.sibling}if(!E){for(D=w.child;D;){if(D===d){E=!0,d=w,p=b;break}if(D===p){E=!0,p=w,d=b;break}D=D.sibling}if(!E)throw Error(n(189))}}if(d.alternate!==p)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?a:l}function f(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=f(a),l!==null)return l;a=a.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),k=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),se=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function J(a){return a===null||typeof a!="object"?null:(a=ce&&a[ce]||a["@@iterator"],typeof a=="function"?a:null)}var te=Symbol.for("react.client.reference");function le(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===te?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case S:return"Fragment";case M:return"Profiler";case R:return"StrictMode";case _:return"Suspense";case P:return"SuspenseList";case Z:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case x:return"Portal";case k:return a.displayName||"Context";case T:return(a._context.displayName||"Context")+".Consumer";case A:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case z:return l=a.displayName||null,l!==null?l:le(a.type)||"Memo";case q:l=a._payload,a=a._init;try{return le(a(l))}catch{}}return null}var ue=Array.isArray,L=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},W=[],fe=-1;function j(a){return{current:a}}function F(a){0>fe||(a.current=W[fe],W[fe]=null,fe--)}function Y(a,l){fe++,W[fe]=a.current,a.current=l}var ie=j(null),U=j(null),ae=j(null),B=j(null);function Q(a,l){switch(Y(ae,l),Y(U,a),Y(ie,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?s0(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=s0(l),a=i0(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}F(ie),Y(ie,a)}function pe(){F(ie),F(U),F(ae)}function me(a){a.memoizedState!==null&&Y(B,a);var l=ie.current,d=i0(l,a.type);l!==d&&(Y(U,a),Y(ie,d))}function ye(a){U.current===a&&(F(ie),F(U)),B.current===a&&(F(B),yr._currentValue=O)}var ve,je;function Be(a){if(ve===void 0)try{throw Error()}catch(d){var l=d.stack.trim().match(/\n( *(at )?)/);ve=l&&l[1]||"",je=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ve+a+je}var at=!1;function Je(a,l){if(!a||at)return"";at=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(l){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(X){var K=X}Reflect.construct(a,[],re)}else{try{re.call()}catch(X){K=X}a.call(re.prototype)}}else{try{throw Error()}catch(X){K=X}(re=a())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(X){if(X&&K&&typeof X.stack=="string")return[X.stack,K.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=p.DetermineComponentFrameRoot(),E=w[0],D=w[1];if(E&&D){var I=E.split(`
`),G=D.split(`
`);for(b=p=0;p<I.length&&!I[p].includes("DetermineComponentFrameRoot");)p++;for(;b<G.length&&!G[b].includes("DetermineComponentFrameRoot");)b++;if(p===I.length||b===G.length)for(p=I.length-1,b=G.length-1;1<=p&&0<=b&&I[p]!==G[b];)b--;for(;1<=p&&0<=b;p--,b--)if(I[p]!==G[b]){if(p!==1||b!==1)do if(p--,b--,0>b||I[p]!==G[b]){var ne=`
`+I[p].replace(" at new "," at ");return a.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",a.displayName)),ne}while(1<=p&&0<=b);break}}}finally{at=!1,Error.prepareStackTrace=d}return(d=a?a.displayName||a.name:"")?Be(d):""}function Nt(a,l){switch(a.tag){case 26:case 27:case 5:return Be(a.type);case 16:return Be("Lazy");case 13:return a.child!==l&&l!==null?Be("Suspense Fallback"):Be("Suspense");case 19:return Be("SuspenseList");case 0:case 15:return Je(a.type,!1);case 11:return Je(a.type.render,!1);case 1:return Je(a.type,!0);case 31:return Be("Activity");default:return""}}function de(a){try{var l="",d=null;do l+=Nt(a,d),d=a,a=a.return;while(a);return l}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var $e=Object.prototype.hasOwnProperty,Ue=r.unstable_scheduleCallback,bt=r.unstable_cancelCallback,mt=r.unstable_shouldYield,$t=r.unstable_requestPaint,Ze=r.unstable_now,jt=r.unstable_getCurrentPriorityLevel,xt=r.unstable_ImmediatePriority,yt=r.unstable_UserBlockingPriority,Xt=r.unstable_NormalPriority,Qt=r.unstable_LowPriority,_s=r.unstable_IdlePriority,Xn=r.log,Pn=r.unstable_setDisableYieldValue,hs=null,Jt=null;function Kt(a){if(typeof Xn=="function"&&Pn(a),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(hs,a)}catch{}}var Lt=Math.clz32?Math.clz32:Jr,Fi=Math.log,Nn=Math.LN2;function Jr(a){return a>>>=0,a===0?32:31-(Fi(a)/Nn|0)|0}var Ps=256,Vi=262144,ci=4194304;function Jn(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ns(a,l,d){var p=a.pendingLanes;if(p===0)return 0;var b=0,w=a.suspendedLanes,E=a.pingedLanes;a=a.warmLanes;var D=p&134217727;return D!==0?(p=D&~w,p!==0?b=Jn(p):(E&=D,E!==0?b=Jn(E):d||(d=D&~a,d!==0&&(b=Jn(d))))):(D=p&~w,D!==0?b=Jn(D):E!==0?b=Jn(E):d||(d=p&~a,d!==0&&(b=Jn(d)))),b===0?0:l!==0&&l!==b&&(l&w)===0&&(w=b&-b,d=l&-l,w>=d||w===32&&(d&4194048)!==0)?l:b}function js(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function Lu(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ee(){var a=ci;return ci<<=1,(ci&62914560)===0&&(ci=4194304),a}function he(a){for(var l=[],d=0;31>d;d++)l.push(a);return l}function be(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Le(a,l,d,p,b,w){var E=a.pendingLanes;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=d,a.entangledLanes&=d,a.errorRecoveryDisabledLanes&=d,a.shellSuspendCounter=0;var D=a.entanglements,I=a.expirationTimes,G=a.hiddenUpdates;for(d=E&~d;0<d;){var ne=31-Lt(d),re=1<<ne;D[ne]=0,I[ne]=-1;var K=G[ne];if(K!==null)for(G[ne]=null,ne=0;ne<K.length;ne++){var X=K[ne];X!==null&&(X.lane&=-536870913)}d&=~re}p!==0&&Ie(a,p,0),w!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=w&~(E&~l))}function Ie(a,l,d){a.pendingLanes|=l,a.suspendedLanes&=~l;var p=31-Lt(l);a.entangledLanes|=l,a.entanglements[p]=a.entanglements[p]|1073741824|d&261930}function lt(a,l){var d=a.entangledLanes|=l;for(a=a.entanglements;d;){var p=31-Lt(d),b=1<<p;b&l|a[p]&l&&(a[p]|=l),d&=~b}}function zt(a,l){var d=l&-l;return d=(d&42)!==0?1:Zt(d),(d&(a.suspendedLanes|l))!==0?0:d}function Zt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function At(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function un(){var a=N.p;return a!==0?a:(a=window.event,a===void 0?32:k0(a.type))}function St(a,l){var d=N.p;try{return N.p=a,l()}finally{N.p=d}}var ot=Math.random().toString(36).slice(2),vt="__reactFiber$"+ot,Bt="__reactProps$"+ot,fs="__reactContainer$"+ot,Fe="__reactEvents$"+ot,jn="__reactListeners$"+ot,Gi="__reactHandles$"+ot,Ra="__reactResources$"+ot,Po="__reactMarker$"+ot;function zu(a){delete a[vt],delete a[Bt],delete a[Fe],delete a[jn],delete a[Gi]}function Ea(a){var l=a[vt];if(l)return l;for(var d=a.parentNode;d;){if(l=d[fs]||d[vt]){if(d=l.alternate,l.child!==null||d!==null&&d.child!==null)for(a=d0(a);a!==null;){if(d=a[vt])return d;a=d0(a)}return l}a=d,d=a.parentNode}return null}function ka(a){if(a=a[vt]||a[fs]){var l=a.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return a}return null}function No(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(n(33))}function Ta(a){var l=a[Ra];return l||(l=a[Ra]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Yt(a){a[Po]=!0}var Vp=new Set,Gp={};function Qi(a,l){Aa(a,l),Aa(a+"Capture",l)}function Aa(a,l){for(Gp[a]=l,a=0;a<l.length;a++)Vp.add(l[a])}var pM=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qp={},Kp={};function gM(a){return $e.call(Kp,a)?!0:$e.call(Qp,a)?!1:pM.test(a)?Kp[a]=!0:(Qp[a]=!0,!1)}function Zr(a,l,d){if(gM(l))if(d===null)a.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var p=l.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+d)}}function ec(a,l,d){if(d===null)a.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+d)}}function Ls(a,l,d,p){if(p===null)a.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(d);return}a.setAttributeNS(l,d,""+p)}}function Ln(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Yp(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function mM(a,l,d){var p=Object.getOwnPropertyDescriptor(a.constructor.prototype,l);if(!a.hasOwnProperty(l)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var b=p.get,w=p.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return b.call(this)},set:function(E){d=""+E,w.call(this,E)}}),Object.defineProperty(a,l,{enumerable:p.enumerable}),{getValue:function(){return d},setValue:function(E){d=""+E},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Iu(a){if(!a._valueTracker){var l=Yp(a)?"checked":"value";a._valueTracker=mM(a,l,""+a[l])}}function Wp(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var d=l.getValue(),p="";return a&&(p=Yp(a)?a.checked?"true":"false":a.value),a=p,a!==d?(l.setValue(a),!0):!1}function tc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var yM=/[\n"\\]/g;function zn(a){return a.replace(yM,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Ou(a,l,d,p,b,w,E,D){a.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?a.type=E:a.removeAttribute("type"),l!=null?E==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+Ln(l)):a.value!==""+Ln(l)&&(a.value=""+Ln(l)):E!=="submit"&&E!=="reset"||a.removeAttribute("value"),l!=null?Hu(a,E,Ln(l)):d!=null?Hu(a,E,Ln(d)):p!=null&&a.removeAttribute("value"),b==null&&w!=null&&(a.defaultChecked=!!w),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?a.name=""+Ln(D):a.removeAttribute("name")}function Xp(a,l,d,p,b,w,E,D){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(a.type=w),l!=null||d!=null){if(!(w!=="submit"&&w!=="reset"||l!=null)){Iu(a);return}d=d!=null?""+Ln(d):"",l=l!=null?""+Ln(l):d,D||l===a.value||(a.value=l),a.defaultValue=l}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=D?a.checked:!!p,a.defaultChecked=!!p,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(a.name=E),Iu(a)}function Hu(a,l,d){l==="number"&&tc(a.ownerDocument)===a||a.defaultValue===""+d||(a.defaultValue=""+d)}function Da(a,l,d,p){if(a=a.options,l){l={};for(var b=0;b<d.length;b++)l["$"+d[b]]=!0;for(d=0;d<a.length;d++)b=l.hasOwnProperty("$"+a[d].value),a[d].selected!==b&&(a[d].selected=b),b&&p&&(a[d].defaultSelected=!0)}else{for(d=""+Ln(d),l=null,b=0;b<a.length;b++){if(a[b].value===d){a[b].selected=!0,p&&(a[b].defaultSelected=!0);return}l!==null||a[b].disabled||(l=a[b])}l!==null&&(l.selected=!0)}}function Jp(a,l,d){if(l!=null&&(l=""+Ln(l),l!==a.value&&(a.value=l),d==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=d!=null?""+Ln(d):""}function Zp(a,l,d,p){if(l==null){if(p!=null){if(d!=null)throw Error(n(92));if(ue(p)){if(1<p.length)throw Error(n(93));p=p[0]}d=p}d==null&&(d=""),l=d}d=Ln(l),a.defaultValue=d,p=a.textContent,p===d&&p!==""&&p!==null&&(a.value=p),Iu(a)}function _a(a,l){if(l){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=l;return}}a.textContent=l}var vM=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function eg(a,l,d){var p=l.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?p?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":p?a.setProperty(l,d):typeof d!="number"||d===0||vM.has(l)?l==="float"?a.cssFloat=d:a[l]=(""+d).trim():a[l]=d+"px"}function tg(a,l,d){if(l!=null&&typeof l!="object")throw Error(n(62));if(a=a.style,d!=null){for(var p in d)!d.hasOwnProperty(p)||l!=null&&l.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var b in l)p=l[b],l.hasOwnProperty(b)&&d[b]!==p&&eg(a,b,p)}else for(var w in l)l.hasOwnProperty(w)&&eg(a,w,l[w])}function qu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bM=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xM=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function nc(a){return xM.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function zs(){}var $u=null;function Bu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Pa=null,Na=null;function ng(a){var l=ka(a);if(l&&(a=l.stateNode)){var d=a[Bt]||null;e:switch(a=l.stateNode,l.type){case"input":if(Ou(a,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),l=d.name,d.type==="radio"&&l!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+zn(""+l)+'"][type="radio"]'),l=0;l<d.length;l++){var p=d[l];if(p!==a&&p.form===a.form){var b=p[Bt]||null;if(!b)throw Error(n(90));Ou(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(l=0;l<d.length;l++)p=d[l],p.form===a.form&&Wp(p)}break e;case"textarea":Jp(a,d.value,d.defaultValue);break e;case"select":l=d.value,l!=null&&Da(a,!!d.multiple,l,!1)}}}var Uu=!1;function sg(a,l,d){if(Uu)return a(l,d);Uu=!0;try{var p=a(l);return p}finally{if(Uu=!1,(Pa!==null||Na!==null)&&(Uc(),Pa&&(l=Pa,a=Na,Na=Pa=null,ng(l),a)))for(l=0;l<a.length;l++)ng(a[l])}}function jo(a,l){var d=a.stateNode;if(d===null)return null;var p=d[Bt]||null;if(p===null)return null;d=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(n(231,l,typeof d));return d}var Is=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fu=!1;if(Is)try{var Lo={};Object.defineProperty(Lo,"passive",{get:function(){Fu=!0}}),window.addEventListener("test",Lo,Lo),window.removeEventListener("test",Lo,Lo)}catch{Fu=!1}var li=null,Vu=null,sc=null;function ig(){if(sc)return sc;var a,l=Vu,d=l.length,p,b="value"in li?li.value:li.textContent,w=b.length;for(a=0;a<d&&l[a]===b[a];a++);var E=d-a;for(p=1;p<=E&&l[d-p]===b[w-p];p++);return sc=b.slice(a,1<p?1-p:void 0)}function ic(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function ac(){return!0}function ag(){return!1}function pn(a){function l(d,p,b,w,E){this._reactName=d,this._targetInst=b,this.type=p,this.nativeEvent=w,this.target=E,this.currentTarget=null;for(var D in a)a.hasOwnProperty(D)&&(d=a[D],this[D]=d?d(w):w[D]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?ac:ag,this.isPropagationStopped=ag,this}return m(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=ac)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=ac)},persist:function(){},isPersistent:ac}),l}var Ki={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oc=pn(Ki),zo=m({},Ki,{view:0,detail:0}),wM=pn(zo),Gu,Qu,Io,rc=m({},zo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Io&&(Io&&a.type==="mousemove"?(Gu=a.screenX-Io.screenX,Qu=a.screenY-Io.screenY):Qu=Gu=0,Io=a),Gu)},movementY:function(a){return"movementY"in a?a.movementY:Qu}}),og=pn(rc),CM=m({},rc,{dataTransfer:0}),SM=pn(CM),MM=m({},zo,{relatedTarget:0}),Ku=pn(MM),RM=m({},Ki,{animationName:0,elapsedTime:0,pseudoElement:0}),EM=pn(RM),kM=m({},Ki,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),TM=pn(kM),AM=m({},Ki,{data:0}),rg=pn(AM),DM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_M={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},PM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function NM(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=PM[a])?!!l[a]:!1}function Yu(){return NM}var jM=m({},zo,{key:function(a){if(a.key){var l=DM[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=ic(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?_M[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yu,charCode:function(a){return a.type==="keypress"?ic(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ic(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),LM=pn(jM),zM=m({},rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cg=pn(zM),IM=m({},zo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yu}),OM=pn(IM),HM=m({},Ki,{propertyName:0,elapsedTime:0,pseudoElement:0}),qM=pn(HM),$M=m({},rc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),BM=pn($M),UM=m({},Ki,{newState:0,oldState:0}),FM=pn(UM),VM=[9,13,27,32],Wu=Is&&"CompositionEvent"in window,Oo=null;Is&&"documentMode"in document&&(Oo=document.documentMode);var GM=Is&&"TextEvent"in window&&!Oo,lg=Is&&(!Wu||Oo&&8<Oo&&11>=Oo),ug=" ",dg=!1;function hg(a,l){switch(a){case"keyup":return VM.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fg(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ja=!1;function QM(a,l){switch(a){case"compositionend":return fg(l);case"keypress":return l.which!==32?null:(dg=!0,ug);case"textInput":return a=l.data,a===ug&&dg?null:a;default:return null}}function KM(a,l){if(ja)return a==="compositionend"||!Wu&&hg(a,l)?(a=ig(),sc=Vu=li=null,ja=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return lg&&l.locale!=="ko"?null:l.data;default:return null}}var YM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pg(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!YM[a.type]:l==="textarea"}function gg(a,l,d,p){Pa?Na?Na.push(p):Na=[p]:Pa=p,l=Wc(l,"onChange"),0<l.length&&(d=new oc("onChange","change",null,d,p),a.push({event:d,listeners:l}))}var Ho=null,qo=null;function WM(a){Xy(a,0)}function cc(a){var l=No(a);if(Wp(l))return a}function mg(a,l){if(a==="change")return l}var yg=!1;if(Is){var Xu;if(Is){var Ju="oninput"in document;if(!Ju){var vg=document.createElement("div");vg.setAttribute("oninput","return;"),Ju=typeof vg.oninput=="function"}Xu=Ju}else Xu=!1;yg=Xu&&(!document.documentMode||9<document.documentMode)}function bg(){Ho&&(Ho.detachEvent("onpropertychange",xg),qo=Ho=null)}function xg(a){if(a.propertyName==="value"&&cc(qo)){var l=[];gg(l,qo,a,Bu(a)),sg(WM,l)}}function XM(a,l,d){a==="focusin"?(bg(),Ho=l,qo=d,Ho.attachEvent("onpropertychange",xg)):a==="focusout"&&bg()}function JM(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return cc(qo)}function ZM(a,l){if(a==="click")return cc(l)}function e1(a,l){if(a==="input"||a==="change")return cc(l)}function t1(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var Sn=typeof Object.is=="function"?Object.is:t1;function $o(a,l){if(Sn(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var d=Object.keys(a),p=Object.keys(l);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var b=d[p];if(!$e.call(l,b)||!Sn(a[b],l[b]))return!1}return!0}function wg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Cg(a,l){var d=wg(a);a=0;for(var p;d;){if(d.nodeType===3){if(p=a+d.textContent.length,a<=l&&p>=l)return{node:d,offset:l-a};a=p}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=wg(d)}}function Sg(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?Sg(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function Mg(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=tc(a.document);l instanceof a.HTMLIFrameElement;){try{var d=typeof l.contentWindow.location.href=="string"}catch{d=!1}if(d)a=l.contentWindow;else break;l=tc(a.document)}return l}function Zu(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var n1=Is&&"documentMode"in document&&11>=document.documentMode,La=null,ed=null,Bo=null,td=!1;function Rg(a,l,d){var p=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;td||La==null||La!==tc(p)||(p=La,"selectionStart"in p&&Zu(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Bo&&$o(Bo,p)||(Bo=p,p=Wc(ed,"onSelect"),0<p.length&&(l=new oc("onSelect","select",null,l,d),a.push({event:l,listeners:p}),l.target=La)))}function Yi(a,l){var d={};return d[a.toLowerCase()]=l.toLowerCase(),d["Webkit"+a]="webkit"+l,d["Moz"+a]="moz"+l,d}var za={animationend:Yi("Animation","AnimationEnd"),animationiteration:Yi("Animation","AnimationIteration"),animationstart:Yi("Animation","AnimationStart"),transitionrun:Yi("Transition","TransitionRun"),transitionstart:Yi("Transition","TransitionStart"),transitioncancel:Yi("Transition","TransitionCancel"),transitionend:Yi("Transition","TransitionEnd")},nd={},Eg={};Is&&(Eg=document.createElement("div").style,"AnimationEvent"in window||(delete za.animationend.animation,delete za.animationiteration.animation,delete za.animationstart.animation),"TransitionEvent"in window||delete za.transitionend.transition);function Wi(a){if(nd[a])return nd[a];if(!za[a])return a;var l=za[a],d;for(d in l)if(l.hasOwnProperty(d)&&d in Eg)return nd[a]=l[d];return a}var kg=Wi("animationend"),Tg=Wi("animationiteration"),Ag=Wi("animationstart"),s1=Wi("transitionrun"),i1=Wi("transitionstart"),a1=Wi("transitioncancel"),Dg=Wi("transitionend"),_g=new Map,sd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");sd.push("scrollEnd");function Zn(a,l){_g.set(a,l),Qi(l,[a])}var lc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},In=[],Ia=0,id=0;function uc(){for(var a=Ia,l=id=Ia=0;l<a;){var d=In[l];In[l++]=null;var p=In[l];In[l++]=null;var b=In[l];In[l++]=null;var w=In[l];if(In[l++]=null,p!==null&&b!==null){var E=p.pending;E===null?b.next=b:(b.next=E.next,E.next=b),p.pending=b}w!==0&&Pg(d,b,w)}}function dc(a,l,d,p){In[Ia++]=a,In[Ia++]=l,In[Ia++]=d,In[Ia++]=p,id|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function ad(a,l,d,p){return dc(a,l,d,p),hc(a)}function Xi(a,l){return dc(a,null,null,l),hc(a)}function Pg(a,l,d){a.lanes|=d;var p=a.alternate;p!==null&&(p.lanes|=d);for(var b=!1,w=a.return;w!==null;)w.childLanes|=d,p=w.alternate,p!==null&&(p.childLanes|=d),w.tag===22&&(a=w.stateNode,a===null||a._visibility&1||(b=!0)),a=w,w=w.return;return a.tag===3?(w=a.stateNode,b&&l!==null&&(b=31-Lt(d),a=w.hiddenUpdates,p=a[b],p===null?a[b]=[l]:p.push(l),l.lane=d|536870912),w):null}function hc(a){if(50<ur)throw ur=0,ph=null,Error(n(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var Oa={};function o1(a,l,d,p){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(a,l,d,p){return new o1(a,l,d,p)}function od(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Os(a,l){var d=a.alternate;return d===null?(d=Mn(a.tag,l,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=l,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&65011712,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,l=a.dependencies,d.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d.refCleanup=a.refCleanup,d}function Ng(a,l){a.flags&=65011714;var d=a.alternate;return d===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=d.childLanes,a.lanes=d.lanes,a.child=d.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=d.memoizedProps,a.memoizedState=d.memoizedState,a.updateQueue=d.updateQueue,a.type=d.type,l=d.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function fc(a,l,d,p,b,w){var E=0;if(p=a,typeof a=="function")od(a)&&(E=1);else if(typeof a=="string")E=dR(a,d,ie.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Z:return a=Mn(31,d,l,b),a.elementType=Z,a.lanes=w,a;case S:return Ji(d.children,b,w,l);case R:E=8,b|=24;break;case M:return a=Mn(12,d,l,b|2),a.elementType=M,a.lanes=w,a;case _:return a=Mn(13,d,l,b),a.elementType=_,a.lanes=w,a;case P:return a=Mn(19,d,l,b),a.elementType=P,a.lanes=w,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case k:E=10;break e;case T:E=9;break e;case A:E=11;break e;case z:E=14;break e;case q:E=16,p=null;break e}E=29,d=Error(n(130,a===null?"null":typeof a,"")),p=null}return l=Mn(E,d,l,b),l.elementType=a,l.type=p,l.lanes=w,l}function Ji(a,l,d,p){return a=Mn(7,a,p,l),a.lanes=d,a}function rd(a,l,d){return a=Mn(6,a,null,l),a.lanes=d,a}function jg(a){var l=Mn(18,null,null,0);return l.stateNode=a,l}function cd(a,l,d){return l=Mn(4,a.children!==null?a.children:[],a.key,l),l.lanes=d,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var Lg=new WeakMap;function On(a,l){if(typeof a=="object"&&a!==null){var d=Lg.get(a);return d!==void 0?d:(l={value:a,source:l,stack:de(l)},Lg.set(a,l),l)}return{value:a,source:l,stack:de(l)}}var Ha=[],qa=0,pc=null,Uo=0,Hn=[],qn=0,ui=null,ps=1,gs="";function Hs(a,l){Ha[qa++]=Uo,Ha[qa++]=pc,pc=a,Uo=l}function zg(a,l,d){Hn[qn++]=ps,Hn[qn++]=gs,Hn[qn++]=ui,ui=a;var p=ps;a=gs;var b=32-Lt(p)-1;p&=~(1<<b),d+=1;var w=32-Lt(l)+b;if(30<w){var E=b-b%5;w=(p&(1<<E)-1).toString(32),p>>=E,b-=E,ps=1<<32-Lt(l)+b|d<<b|p,gs=w+a}else ps=1<<w|d<<b|p,gs=a}function ld(a){a.return!==null&&(Hs(a,1),zg(a,1,0))}function ud(a){for(;a===pc;)pc=Ha[--qa],Ha[qa]=null,Uo=Ha[--qa],Ha[qa]=null;for(;a===ui;)ui=Hn[--qn],Hn[qn]=null,gs=Hn[--qn],Hn[qn]=null,ps=Hn[--qn],Hn[qn]=null}function Ig(a,l){Hn[qn++]=ps,Hn[qn++]=gs,Hn[qn++]=ui,ps=l.id,gs=l.overflow,ui=a}var en=null,wt=null,Xe=!1,di=null,$n=!1,dd=Error(n(519));function hi(a){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fo(On(l,a)),dd}function Og(a){var l=a.stateNode,d=a.type,p=a.memoizedProps;switch(l[vt]=a,l[Bt]=p,d){case"dialog":Ge("cancel",l),Ge("close",l);break;case"iframe":case"object":case"embed":Ge("load",l);break;case"video":case"audio":for(d=0;d<hr.length;d++)Ge(hr[d],l);break;case"source":Ge("error",l);break;case"img":case"image":case"link":Ge("error",l),Ge("load",l);break;case"details":Ge("toggle",l);break;case"input":Ge("invalid",l),Xp(l,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":Ge("invalid",l);break;case"textarea":Ge("invalid",l),Zp(l,p.value,p.defaultValue,p.children)}d=p.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||l.textContent===""+d||p.suppressHydrationWarning===!0||t0(l.textContent,d)?(p.popover!=null&&(Ge("beforetoggle",l),Ge("toggle",l)),p.onScroll!=null&&Ge("scroll",l),p.onScrollEnd!=null&&Ge("scrollend",l),p.onClick!=null&&(l.onclick=zs),l=!0):l=!1,l||hi(a,!0)}function Hg(a){for(en=a.return;en;)switch(en.tag){case 5:case 31:case 13:$n=!1;return;case 27:case 3:$n=!0;return;default:en=en.return}}function $a(a){if(a!==en)return!1;if(!Xe)return Hg(a),Xe=!0,!1;var l=a.tag,d;if((d=l!==3&&l!==27)&&((d=l===5)&&(d=a.type,d=!(d!=="form"&&d!=="button")||Ah(a.type,a.memoizedProps)),d=!d),d&&wt&&hi(a),Hg(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));wt=u0(a)}else if(l===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));wt=u0(a)}else l===27?(l=wt,Ei(a.type)?(a=jh,jh=null,wt=a):wt=l):wt=en?Un(a.stateNode.nextSibling):null;return!0}function Zi(){wt=en=null,Xe=!1}function hd(){var a=di;return a!==null&&(vn===null?vn=a:vn.push.apply(vn,a),di=null),a}function Fo(a){di===null?di=[a]:di.push(a)}var fd=j(null),ea=null,qs=null;function fi(a,l,d){Y(fd,l._currentValue),l._currentValue=d}function $s(a){a._currentValue=fd.current,F(fd)}function pd(a,l,d){for(;a!==null;){var p=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),a===d)break;a=a.return}}function gd(a,l,d,p){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var w=b.dependencies;if(w!==null){var E=b.child;w=w.firstContext;e:for(;w!==null;){var D=w;w=b;for(var I=0;I<l.length;I++)if(D.context===l[I]){w.lanes|=d,D=w.alternate,D!==null&&(D.lanes|=d),pd(w.return,d,a),p||(E=null);break e}w=D.next}}else if(b.tag===18){if(E=b.return,E===null)throw Error(n(341));E.lanes|=d,w=E.alternate,w!==null&&(w.lanes|=d),pd(E,d,a),E=null}else E=b.child;if(E!==null)E.return=b;else for(E=b;E!==null;){if(E===a){E=null;break}if(b=E.sibling,b!==null){b.return=E.return,E=b;break}E=E.return}b=E}}function Ba(a,l,d,p){a=null;for(var b=l,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var E=b.alternate;if(E===null)throw Error(n(387));if(E=E.memoizedProps,E!==null){var D=b.type;Sn(b.pendingProps.value,E.value)||(a!==null?a.push(D):a=[D])}}else if(b===B.current){if(E=b.alternate,E===null)throw Error(n(387));E.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(yr):a=[yr])}b=b.return}a!==null&&gd(l,a,d,p),l.flags|=262144}function gc(a){for(a=a.firstContext;a!==null;){if(!Sn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ta(a){ea=a,qs=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function tn(a){return qg(ea,a)}function mc(a,l){return ea===null&&ta(a),qg(a,l)}function qg(a,l){var d=l._currentValue;if(l={context:l,memoizedValue:d,next:null},qs===null){if(a===null)throw Error(n(308));qs=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else qs=qs.next=l;return d}var r1=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(d,p){a.push(p)}};this.abort=function(){l.aborted=!0,a.forEach(function(d){return d()})}},c1=r.unstable_scheduleCallback,l1=r.unstable_NormalPriority,It={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function md(){return{controller:new r1,data:new Map,refCount:0}}function Vo(a){a.refCount--,a.refCount===0&&c1(l1,function(){a.controller.abort()})}var Go=null,yd=0,Ua=0,Fa=null;function u1(a,l){if(Go===null){var d=Go=[];yd=0,Ua=xh(),Fa={status:"pending",value:void 0,then:function(p){d.push(p)}}}return yd++,l.then($g,$g),l}function $g(){if(--yd===0&&Go!==null){Fa!==null&&(Fa.status="fulfilled");var a=Go;Go=null,Ua=0,Fa=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function d1(a,l){var d=[],p={status:"pending",value:null,reason:null,then:function(b){d.push(b)}};return a.then(function(){p.status="fulfilled",p.value=l;for(var b=0;b<d.length;b++)(0,d[b])(l)},function(b){for(p.status="rejected",p.reason=b,b=0;b<d.length;b++)(0,d[b])(void 0)}),p}var Bg=L.S;L.S=function(a,l){Ry=Ze(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&u1(a,l),Bg!==null&&Bg(a,l)};var na=j(null);function vd(){var a=na.current;return a!==null?a:pt.pooledCache}function yc(a,l){l===null?Y(na,na.current):Y(na,l.pool)}function Ug(){var a=vd();return a===null?null:{parent:It._currentValue,pool:a}}var Va=Error(n(460)),bd=Error(n(474)),vc=Error(n(542)),bc={then:function(){}};function Fg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Vg(a,l,d){switch(d=a[d],d===void 0?a.push(l):d!==l&&(l.then(zs,zs),l=d),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Qg(a),a;default:if(typeof l.status=="string")l.then(zs,zs);else{if(a=pt,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=l,a.status="pending",a.then(function(p){if(l.status==="pending"){var b=l;b.status="fulfilled",b.value=p}},function(p){if(l.status==="pending"){var b=l;b.status="rejected",b.reason=p}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Qg(a),a}throw ia=l,Va}}function sa(a){try{var l=a._init;return l(a._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(ia=d,Va):d}}var ia=null;function Gg(){if(ia===null)throw Error(n(459));var a=ia;return ia=null,a}function Qg(a){if(a===Va||a===vc)throw Error(n(483))}var Ga=null,Qo=0;function xc(a){var l=Qo;return Qo+=1,Ga===null&&(Ga=[]),Vg(Ga,a,l)}function Ko(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function wc(a,l){throw l.$$typeof===y?Error(n(525)):(a=Object.prototype.toString.call(l),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function Kg(a){function l($,H){if(a){var V=$.deletions;V===null?($.deletions=[H],$.flags|=16):V.push(H)}}function d($,H){if(!a)return null;for(;H!==null;)l($,H),H=H.sibling;return null}function p($){for(var H=new Map;$!==null;)$.key!==null?H.set($.key,$):H.set($.index,$),$=$.sibling;return H}function b($,H){return $=Os($,H),$.index=0,$.sibling=null,$}function w($,H,V){return $.index=V,a?(V=$.alternate,V!==null?(V=V.index,V<H?($.flags|=67108866,H):V):($.flags|=67108866,H)):($.flags|=1048576,H)}function E($){return a&&$.alternate===null&&($.flags|=67108866),$}function D($,H,V,oe){return H===null||H.tag!==6?(H=rd(V,$.mode,oe),H.return=$,H):(H=b(H,V),H.return=$,H)}function I($,H,V,oe){var Ae=V.type;return Ae===S?ne($,H,V.props.children,oe,V.key):H!==null&&(H.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===q&&sa(Ae)===H.type)?(H=b(H,V.props),Ko(H,V),H.return=$,H):(H=fc(V.type,V.key,V.props,null,$.mode,oe),Ko(H,V),H.return=$,H)}function G($,H,V,oe){return H===null||H.tag!==4||H.stateNode.containerInfo!==V.containerInfo||H.stateNode.implementation!==V.implementation?(H=cd(V,$.mode,oe),H.return=$,H):(H=b(H,V.children||[]),H.return=$,H)}function ne($,H,V,oe,Ae){return H===null||H.tag!==7?(H=Ji(V,$.mode,oe,Ae),H.return=$,H):(H=b(H,V),H.return=$,H)}function re($,H,V){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return H=rd(""+H,$.mode,V),H.return=$,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case v:return V=fc(H.type,H.key,H.props,null,$.mode,V),Ko(V,H),V.return=$,V;case x:return H=cd(H,$.mode,V),H.return=$,H;case q:return H=sa(H),re($,H,V)}if(ue(H)||J(H))return H=Ji(H,$.mode,V,null),H.return=$,H;if(typeof H.then=="function")return re($,xc(H),V);if(H.$$typeof===k)return re($,mc($,H),V);wc($,H)}return null}function K($,H,V,oe){var Ae=H!==null?H.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return Ae!==null?null:D($,H,""+V,oe);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case v:return V.key===Ae?I($,H,V,oe):null;case x:return V.key===Ae?G($,H,V,oe):null;case q:return V=sa(V),K($,H,V,oe)}if(ue(V)||J(V))return Ae!==null?null:ne($,H,V,oe,null);if(typeof V.then=="function")return K($,H,xc(V),oe);if(V.$$typeof===k)return K($,H,mc($,V),oe);wc($,V)}return null}function X($,H,V,oe,Ae){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return $=$.get(V)||null,D(H,$,""+oe,Ae);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case v:return $=$.get(oe.key===null?V:oe.key)||null,I(H,$,oe,Ae);case x:return $=$.get(oe.key===null?V:oe.key)||null,G(H,$,oe,Ae);case q:return oe=sa(oe),X($,H,V,oe,Ae)}if(ue(oe)||J(oe))return $=$.get(V)||null,ne(H,$,oe,Ae,null);if(typeof oe.then=="function")return X($,H,V,xc(oe),Ae);if(oe.$$typeof===k)return X($,H,V,mc(H,oe),Ae);wc(H,oe)}return null}function xe($,H,V,oe){for(var Ae=null,et=null,Me=H,He=H=0,Ke=null;Me!==null&&He<V.length;He++){Me.index>He?(Ke=Me,Me=null):Ke=Me.sibling;var tt=K($,Me,V[He],oe);if(tt===null){Me===null&&(Me=Ke);break}a&&Me&&tt.alternate===null&&l($,Me),H=w(tt,H,He),et===null?Ae=tt:et.sibling=tt,et=tt,Me=Ke}if(He===V.length)return d($,Me),Xe&&Hs($,He),Ae;if(Me===null){for(;He<V.length;He++)Me=re($,V[He],oe),Me!==null&&(H=w(Me,H,He),et===null?Ae=Me:et.sibling=Me,et=Me);return Xe&&Hs($,He),Ae}for(Me=p(Me);He<V.length;He++)Ke=X(Me,$,He,V[He],oe),Ke!==null&&(a&&Ke.alternate!==null&&Me.delete(Ke.key===null?He:Ke.key),H=w(Ke,H,He),et===null?Ae=Ke:et.sibling=Ke,et=Ke);return a&&Me.forEach(function(_i){return l($,_i)}),Xe&&Hs($,He),Ae}function Pe($,H,V,oe){if(V==null)throw Error(n(151));for(var Ae=null,et=null,Me=H,He=H=0,Ke=null,tt=V.next();Me!==null&&!tt.done;He++,tt=V.next()){Me.index>He?(Ke=Me,Me=null):Ke=Me.sibling;var _i=K($,Me,tt.value,oe);if(_i===null){Me===null&&(Me=Ke);break}a&&Me&&_i.alternate===null&&l($,Me),H=w(_i,H,He),et===null?Ae=_i:et.sibling=_i,et=_i,Me=Ke}if(tt.done)return d($,Me),Xe&&Hs($,He),Ae;if(Me===null){for(;!tt.done;He++,tt=V.next())tt=re($,tt.value,oe),tt!==null&&(H=w(tt,H,He),et===null?Ae=tt:et.sibling=tt,et=tt);return Xe&&Hs($,He),Ae}for(Me=p(Me);!tt.done;He++,tt=V.next())tt=X(Me,$,He,tt.value,oe),tt!==null&&(a&&tt.alternate!==null&&Me.delete(tt.key===null?He:tt.key),H=w(tt,H,He),et===null?Ae=tt:et.sibling=tt,et=tt);return a&&Me.forEach(function(CR){return l($,CR)}),Xe&&Hs($,He),Ae}function ht($,H,V,oe){if(typeof V=="object"&&V!==null&&V.type===S&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case v:e:{for(var Ae=V.key;H!==null;){if(H.key===Ae){if(Ae=V.type,Ae===S){if(H.tag===7){d($,H.sibling),oe=b(H,V.props.children),oe.return=$,$=oe;break e}}else if(H.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===q&&sa(Ae)===H.type){d($,H.sibling),oe=b(H,V.props),Ko(oe,V),oe.return=$,$=oe;break e}d($,H);break}else l($,H);H=H.sibling}V.type===S?(oe=Ji(V.props.children,$.mode,oe,V.key),oe.return=$,$=oe):(oe=fc(V.type,V.key,V.props,null,$.mode,oe),Ko(oe,V),oe.return=$,$=oe)}return E($);case x:e:{for(Ae=V.key;H!==null;){if(H.key===Ae)if(H.tag===4&&H.stateNode.containerInfo===V.containerInfo&&H.stateNode.implementation===V.implementation){d($,H.sibling),oe=b(H,V.children||[]),oe.return=$,$=oe;break e}else{d($,H);break}else l($,H);H=H.sibling}oe=cd(V,$.mode,oe),oe.return=$,$=oe}return E($);case q:return V=sa(V),ht($,H,V,oe)}if(ue(V))return xe($,H,V,oe);if(J(V)){if(Ae=J(V),typeof Ae!="function")throw Error(n(150));return V=Ae.call(V),Pe($,H,V,oe)}if(typeof V.then=="function")return ht($,H,xc(V),oe);if(V.$$typeof===k)return ht($,H,mc($,V),oe);wc($,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,H!==null&&H.tag===6?(d($,H.sibling),oe=b(H,V),oe.return=$,$=oe):(d($,H),oe=rd(V,$.mode,oe),oe.return=$,$=oe),E($)):d($,H)}return function($,H,V,oe){try{Qo=0;var Ae=ht($,H,V,oe);return Ga=null,Ae}catch(Me){if(Me===Va||Me===vc)throw Me;var et=Mn(29,Me,null,$.mode);return et.lanes=oe,et.return=$,et}finally{}}}var aa=Kg(!0),Yg=Kg(!1),pi=!1;function xd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wd(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function gi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function mi(a,l,d){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(st&2)!==0){var b=p.pending;return b===null?l.next=l:(l.next=b.next,b.next=l),p.pending=l,l=hc(a),Pg(a,null,d),l}return dc(a,p,l,d),hc(a)}function Yo(a,l,d){if(l=l.updateQueue,l!==null&&(l=l.shared,(d&4194048)!==0)){var p=l.lanes;p&=a.pendingLanes,d|=p,l.lanes=d,lt(a,d)}}function Cd(a,l){var d=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var b=null,w=null;if(d=d.firstBaseUpdate,d!==null){do{var E={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};w===null?b=w=E:w=w.next=E,d=d.next}while(d!==null);w===null?b=w=l:w=w.next=l}else b=w=l;d={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:p.shared,callbacks:p.callbacks},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=l:a.next=l,d.lastBaseUpdate=l}var Sd=!1;function Wo(){if(Sd){var a=Fa;if(a!==null)throw a}}function Xo(a,l,d,p){Sd=!1;var b=a.updateQueue;pi=!1;var w=b.firstBaseUpdate,E=b.lastBaseUpdate,D=b.shared.pending;if(D!==null){b.shared.pending=null;var I=D,G=I.next;I.next=null,E===null?w=G:E.next=G,E=I;var ne=a.alternate;ne!==null&&(ne=ne.updateQueue,D=ne.lastBaseUpdate,D!==E&&(D===null?ne.firstBaseUpdate=G:D.next=G,ne.lastBaseUpdate=I))}if(w!==null){var re=b.baseState;E=0,ne=G=I=null,D=w;do{var K=D.lane&-536870913,X=K!==D.lane;if(X?(Qe&K)===K:(p&K)===K){K!==0&&K===Ua&&(Sd=!0),ne!==null&&(ne=ne.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var xe=a,Pe=D;K=l;var ht=d;switch(Pe.tag){case 1:if(xe=Pe.payload,typeof xe=="function"){re=xe.call(ht,re,K);break e}re=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=Pe.payload,K=typeof xe=="function"?xe.call(ht,re,K):xe,K==null)break e;re=m({},re,K);break e;case 2:pi=!0}}K=D.callback,K!==null&&(a.flags|=64,X&&(a.flags|=8192),X=b.callbacks,X===null?b.callbacks=[K]:X.push(K))}else X={lane:K,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ne===null?(G=ne=X,I=re):ne=ne.next=X,E|=K;if(D=D.next,D===null){if(D=b.shared.pending,D===null)break;X=D,D=X.next,X.next=null,b.lastBaseUpdate=X,b.shared.pending=null}}while(!0);ne===null&&(I=re),b.baseState=I,b.firstBaseUpdate=G,b.lastBaseUpdate=ne,w===null&&(b.shared.lanes=0),wi|=E,a.lanes=E,a.memoizedState=re}}function Wg(a,l){if(typeof a!="function")throw Error(n(191,a));a.call(l)}function Xg(a,l){var d=a.callbacks;if(d!==null)for(a.callbacks=null,a=0;a<d.length;a++)Wg(d[a],l)}var Qa=j(null),Cc=j(0);function Jg(a,l){a=Ws,Y(Cc,a),Y(Qa,l),Ws=a|l.baseLanes}function Md(){Y(Cc,Ws),Y(Qa,Qa.current)}function Rd(){Ws=Cc.current,F(Qa),F(Cc)}var Rn=j(null),Bn=null;function yi(a){var l=a.alternate;Y(Dt,Dt.current&1),Y(Rn,a),Bn===null&&(l===null||Qa.current!==null||l.memoizedState!==null)&&(Bn=a)}function Ed(a){Y(Dt,Dt.current),Y(Rn,a),Bn===null&&(Bn=a)}function Zg(a){a.tag===22?(Y(Dt,Dt.current),Y(Rn,a),Bn===null&&(Bn=a)):vi()}function vi(){Y(Dt,Dt.current),Y(Rn,Rn.current)}function En(a){F(Rn),Bn===a&&(Bn=null),F(Dt)}var Dt=j(0);function Sc(a){for(var l=a;l!==null;){if(l.tag===13){var d=l.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Ph(d)||Nh(d)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Bs=0,Oe=null,ut=null,Ot=null,Mc=!1,Ka=!1,oa=!1,Rc=0,Jo=0,Ya=null,h1=0;function Rt(){throw Error(n(321))}function kd(a,l){if(l===null)return!1;for(var d=0;d<l.length&&d<a.length;d++)if(!Sn(a[d],l[d]))return!1;return!0}function Td(a,l,d,p,b,w){return Bs=w,Oe=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,L.H=a===null||a.memoizedState===null?zm:Ud,oa=!1,w=d(p,b),oa=!1,Ka&&(w=tm(l,d,p,b)),em(a),w}function em(a){L.H=tr;var l=ut!==null&&ut.next!==null;if(Bs=0,Ot=ut=Oe=null,Mc=!1,Jo=0,Ya=null,l)throw Error(n(300));a===null||Ht||(a=a.dependencies,a!==null&&gc(a)&&(Ht=!0))}function tm(a,l,d,p){Oe=a;var b=0;do{if(Ka&&(Ya=null),Jo=0,Ka=!1,25<=b)throw Error(n(301));if(b+=1,Ot=ut=null,a.updateQueue!=null){var w=a.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}L.H=Im,w=l(d,p)}while(Ka);return w}function f1(){var a=L.H,l=a.useState()[0];return l=typeof l.then=="function"?Zo(l):l,a=a.useState()[0],(ut!==null?ut.memoizedState:null)!==a&&(Oe.flags|=1024),l}function Ad(){var a=Rc!==0;return Rc=0,a}function Dd(a,l,d){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~d}function _d(a){if(Mc){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}Mc=!1}Bs=0,Ot=ut=Oe=null,Ka=!1,Jo=Rc=0,Ya=null}function dn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?Oe.memoizedState=Ot=a:Ot=Ot.next=a,Ot}function _t(){if(ut===null){var a=Oe.alternate;a=a!==null?a.memoizedState:null}else a=ut.next;var l=Ot===null?Oe.memoizedState:Ot.next;if(l!==null)Ot=l,ut=a;else{if(a===null)throw Oe.alternate===null?Error(n(467)):Error(n(310));ut=a,a={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},Ot===null?Oe.memoizedState=Ot=a:Ot=Ot.next=a}return Ot}function Ec(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Zo(a){var l=Jo;return Jo+=1,Ya===null&&(Ya=[]),a=Vg(Ya,a,l),l=Oe,(Ot===null?l.memoizedState:Ot.next)===null&&(l=l.alternate,L.H=l===null||l.memoizedState===null?zm:Ud),a}function kc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Zo(a);if(a.$$typeof===k)return tn(a)}throw Error(n(438,String(a)))}function Pd(a){var l=null,d=Oe.updateQueue;if(d!==null&&(l=d.memoCache),l==null){var p=Oe.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(l={data:p.data.map(function(b){return b.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),d===null&&(d=Ec(),Oe.updateQueue=d),d.memoCache=l,d=l.data[l.index],d===void 0)for(d=l.data[l.index]=Array(a),p=0;p<a;p++)d[p]=se;return l.index++,d}function Us(a,l){return typeof l=="function"?l(a):l}function Tc(a){var l=_t();return Nd(l,ut,a)}function Nd(a,l,d){var p=a.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=d;var b=a.baseQueue,w=p.pending;if(w!==null){if(b!==null){var E=b.next;b.next=w.next,w.next=E}l.baseQueue=b=w,p.pending=null}if(w=a.baseState,b===null)a.memoizedState=w;else{l=b.next;var D=E=null,I=null,G=l,ne=!1;do{var re=G.lane&-536870913;if(re!==G.lane?(Qe&re)===re:(Bs&re)===re){var K=G.revertLane;if(K===0)I!==null&&(I=I.next={lane:0,revertLane:0,gesture:null,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),re===Ua&&(ne=!0);else if((Bs&K)===K){G=G.next,K===Ua&&(ne=!0);continue}else re={lane:0,revertLane:G.revertLane,gesture:null,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},I===null?(D=I=re,E=w):I=I.next=re,Oe.lanes|=K,wi|=K;re=G.action,oa&&d(w,re),w=G.hasEagerState?G.eagerState:d(w,re)}else K={lane:re,revertLane:G.revertLane,gesture:G.gesture,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},I===null?(D=I=K,E=w):I=I.next=K,Oe.lanes|=re,wi|=re;G=G.next}while(G!==null&&G!==l);if(I===null?E=w:I.next=D,!Sn(w,a.memoizedState)&&(Ht=!0,ne&&(d=Fa,d!==null)))throw d;a.memoizedState=w,a.baseState=E,a.baseQueue=I,p.lastRenderedState=w}return b===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function jd(a){var l=_t(),d=l.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=a;var p=d.dispatch,b=d.pending,w=l.memoizedState;if(b!==null){d.pending=null;var E=b=b.next;do w=a(w,E.action),E=E.next;while(E!==b);Sn(w,l.memoizedState)||(Ht=!0),l.memoizedState=w,l.baseQueue===null&&(l.baseState=w),d.lastRenderedState=w}return[w,p]}function nm(a,l,d){var p=Oe,b=_t(),w=Xe;if(w){if(d===void 0)throw Error(n(407));d=d()}else d=l();var E=!Sn((ut||b).memoizedState,d);if(E&&(b.memoizedState=d,Ht=!0),b=b.queue,Id(am.bind(null,p,b,a),[a]),b.getSnapshot!==l||E||Ot!==null&&Ot.memoizedState.tag&1){if(p.flags|=2048,Wa(9,{destroy:void 0},im.bind(null,p,b,d,l),null),pt===null)throw Error(n(349));w||(Bs&127)!==0||sm(p,l,d)}return d}function sm(a,l,d){a.flags|=16384,a={getSnapshot:l,value:d},l=Oe.updateQueue,l===null?(l=Ec(),Oe.updateQueue=l,l.stores=[a]):(d=l.stores,d===null?l.stores=[a]:d.push(a))}function im(a,l,d,p){l.value=d,l.getSnapshot=p,om(l)&&rm(a)}function am(a,l,d){return d(function(){om(l)&&rm(a)})}function om(a){var l=a.getSnapshot;a=a.value;try{var d=l();return!Sn(a,d)}catch{return!0}}function rm(a){var l=Xi(a,2);l!==null&&bn(l,a,2)}function Ld(a){var l=dn();if(typeof a=="function"){var d=a;if(a=d(),oa){Kt(!0);try{d()}finally{Kt(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Us,lastRenderedState:a},l}function cm(a,l,d,p){return a.baseState=d,Nd(a,ut,typeof p=="function"?p:Us)}function p1(a,l,d,p,b){if(_c(a))throw Error(n(485));if(a=l.action,a!==null){var w={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){w.listeners.push(E)}};L.T!==null?d(!0):w.isTransition=!1,p(w),d=l.pending,d===null?(w.next=l.pending=w,lm(l,w)):(w.next=d.next,l.pending=d.next=w)}}function lm(a,l){var d=l.action,p=l.payload,b=a.state;if(l.isTransition){var w=L.T,E={};L.T=E;try{var D=d(b,p),I=L.S;I!==null&&I(E,D),um(a,l,D)}catch(G){zd(a,l,G)}finally{w!==null&&E.types!==null&&(w.types=E.types),L.T=w}}else try{w=d(b,p),um(a,l,w)}catch(G){zd(a,l,G)}}function um(a,l,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(p){dm(a,l,p)},function(p){return zd(a,l,p)}):dm(a,l,d)}function dm(a,l,d){l.status="fulfilled",l.value=d,hm(l),a.state=d,l=a.pending,l!==null&&(d=l.next,d===l?a.pending=null:(d=d.next,l.next=d,lm(a,d)))}function zd(a,l,d){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do l.status="rejected",l.reason=d,hm(l),l=l.next;while(l!==p)}a.action=null}function hm(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function fm(a,l){return l}function pm(a,l){if(Xe){var d=pt.formState;if(d!==null){e:{var p=Oe;if(Xe){if(wt){t:{for(var b=wt,w=$n;b.nodeType!==8;){if(!w){b=null;break t}if(b=Un(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){wt=Un(b.nextSibling),p=b.data==="F!";break e}}hi(p)}p=!1}p&&(l=d[0])}}return d=dn(),d.memoizedState=d.baseState=l,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fm,lastRenderedState:l},d.queue=p,d=Nm.bind(null,Oe,p),p.dispatch=d,p=Ld(!1),w=Bd.bind(null,Oe,!1,p.queue),p=dn(),b={state:l,dispatch:null,action:a,pending:null},p.queue=b,d=p1.bind(null,Oe,b,w,d),b.dispatch=d,p.memoizedState=a,[l,d,!1]}function gm(a){var l=_t();return mm(l,ut,a)}function mm(a,l,d){if(l=Nd(a,l,fm)[0],a=Tc(Us)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var p=Zo(l)}catch(E){throw E===Va?vc:E}else p=l;l=_t();var b=l.queue,w=b.dispatch;return d!==l.memoizedState&&(Oe.flags|=2048,Wa(9,{destroy:void 0},g1.bind(null,b,d),null)),[p,w,a]}function g1(a,l){a.action=l}function ym(a){var l=_t(),d=ut;if(d!==null)return mm(l,d,a);_t(),l=l.memoizedState,d=_t();var p=d.queue.dispatch;return d.memoizedState=a,[l,p,!1]}function Wa(a,l,d,p){return a={tag:a,create:d,deps:p,inst:l,next:null},l=Oe.updateQueue,l===null&&(l=Ec(),Oe.updateQueue=l),d=l.lastEffect,d===null?l.lastEffect=a.next=a:(p=d.next,d.next=a,a.next=p,l.lastEffect=a),a}function vm(){return _t().memoizedState}function Ac(a,l,d,p){var b=dn();Oe.flags|=a,b.memoizedState=Wa(1|l,{destroy:void 0},d,p===void 0?null:p)}function Dc(a,l,d,p){var b=_t();p=p===void 0?null:p;var w=b.memoizedState.inst;ut!==null&&p!==null&&kd(p,ut.memoizedState.deps)?b.memoizedState=Wa(l,w,d,p):(Oe.flags|=a,b.memoizedState=Wa(1|l,w,d,p))}function bm(a,l){Ac(8390656,8,a,l)}function Id(a,l){Dc(2048,8,a,l)}function m1(a){Oe.flags|=4;var l=Oe.updateQueue;if(l===null)l=Ec(),Oe.updateQueue=l,l.events=[a];else{var d=l.events;d===null?l.events=[a]:d.push(a)}}function xm(a){var l=_t().memoizedState;return m1({ref:l,nextImpl:a}),function(){if((st&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function wm(a,l){return Dc(4,2,a,l)}function Cm(a,l){return Dc(4,4,a,l)}function Sm(a,l){if(typeof l=="function"){a=a();var d=l(a);return function(){typeof d=="function"?d():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Mm(a,l,d){d=d!=null?d.concat([a]):null,Dc(4,4,Sm.bind(null,l,a),d)}function Od(){}function Rm(a,l){var d=_t();l=l===void 0?null:l;var p=d.memoizedState;return l!==null&&kd(l,p[1])?p[0]:(d.memoizedState=[a,l],a)}function Em(a,l){var d=_t();l=l===void 0?null:l;var p=d.memoizedState;if(l!==null&&kd(l,p[1]))return p[0];if(p=a(),oa){Kt(!0);try{a()}finally{Kt(!1)}}return d.memoizedState=[p,l],p}function Hd(a,l,d){return d===void 0||(Bs&1073741824)!==0&&(Qe&261930)===0?a.memoizedState=l:(a.memoizedState=d,a=ky(),Oe.lanes|=a,wi|=a,d)}function km(a,l,d,p){return Sn(d,l)?d:Qa.current!==null?(a=Hd(a,d,p),Sn(a,l)||(Ht=!0),a):(Bs&42)===0||(Bs&1073741824)!==0&&(Qe&261930)===0?(Ht=!0,a.memoizedState=d):(a=ky(),Oe.lanes|=a,wi|=a,l)}function Tm(a,l,d,p,b){var w=N.p;N.p=w!==0&&8>w?w:8;var E=L.T,D={};L.T=D,Bd(a,!1,l,d);try{var I=b(),G=L.S;if(G!==null&&G(D,I),I!==null&&typeof I=="object"&&typeof I.then=="function"){var ne=d1(I,p);er(a,l,ne,An(a))}else er(a,l,p,An(a))}catch(re){er(a,l,{then:function(){},status:"rejected",reason:re},An())}finally{N.p=w,E!==null&&D.types!==null&&(E.types=D.types),L.T=E}}function y1(){}function qd(a,l,d,p){if(a.tag!==5)throw Error(n(476));var b=Am(a).queue;Tm(a,b,l,O,d===null?y1:function(){return Dm(a),d(p)})}function Am(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Us,lastRenderedState:O},next:null};var d={};return l.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Us,lastRenderedState:d},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function Dm(a){var l=Am(a);l.next===null&&(l=a.alternate.memoizedState),er(a,l.next.queue,{},An())}function $d(){return tn(yr)}function _m(){return _t().memoizedState}function Pm(){return _t().memoizedState}function v1(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var d=An();a=gi(d);var p=mi(l,a,d);p!==null&&(bn(p,l,d),Yo(p,l,d)),l={cache:md()},a.payload=l;return}l=l.return}}function b1(a,l,d){var p=An();d={lane:p,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},_c(a)?jm(l,d):(d=ad(a,l,d,p),d!==null&&(bn(d,a,p),Lm(d,l,p)))}function Nm(a,l,d){var p=An();er(a,l,d,p)}function er(a,l,d,p){var b={lane:p,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(_c(a))jm(l,b);else{var w=a.alternate;if(a.lanes===0&&(w===null||w.lanes===0)&&(w=l.lastRenderedReducer,w!==null))try{var E=l.lastRenderedState,D=w(E,d);if(b.hasEagerState=!0,b.eagerState=D,Sn(D,E))return dc(a,l,b,0),pt===null&&uc(),!1}catch{}finally{}if(d=ad(a,l,b,p),d!==null)return bn(d,a,p),Lm(d,l,p),!0}return!1}function Bd(a,l,d,p){if(p={lane:2,revertLane:xh(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},_c(a)){if(l)throw Error(n(479))}else l=ad(a,d,p,2),l!==null&&bn(l,a,2)}function _c(a){var l=a.alternate;return a===Oe||l!==null&&l===Oe}function jm(a,l){Ka=Mc=!0;var d=a.pending;d===null?l.next=l:(l.next=d.next,d.next=l),a.pending=l}function Lm(a,l,d){if((d&4194048)!==0){var p=l.lanes;p&=a.pendingLanes,d|=p,l.lanes=d,lt(a,d)}}var tr={readContext:tn,use:kc,useCallback:Rt,useContext:Rt,useEffect:Rt,useImperativeHandle:Rt,useLayoutEffect:Rt,useInsertionEffect:Rt,useMemo:Rt,useReducer:Rt,useRef:Rt,useState:Rt,useDebugValue:Rt,useDeferredValue:Rt,useTransition:Rt,useSyncExternalStore:Rt,useId:Rt,useHostTransitionStatus:Rt,useFormState:Rt,useActionState:Rt,useOptimistic:Rt,useMemoCache:Rt,useCacheRefresh:Rt};tr.useEffectEvent=Rt;var zm={readContext:tn,use:kc,useCallback:function(a,l){return dn().memoizedState=[a,l===void 0?null:l],a},useContext:tn,useEffect:bm,useImperativeHandle:function(a,l,d){d=d!=null?d.concat([a]):null,Ac(4194308,4,Sm.bind(null,l,a),d)},useLayoutEffect:function(a,l){return Ac(4194308,4,a,l)},useInsertionEffect:function(a,l){Ac(4,2,a,l)},useMemo:function(a,l){var d=dn();l=l===void 0?null:l;var p=a();if(oa){Kt(!0);try{a()}finally{Kt(!1)}}return d.memoizedState=[p,l],p},useReducer:function(a,l,d){var p=dn();if(d!==void 0){var b=d(l);if(oa){Kt(!0);try{d(l)}finally{Kt(!1)}}}else b=l;return p.memoizedState=p.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},p.queue=a,a=a.dispatch=b1.bind(null,Oe,a),[p.memoizedState,a]},useRef:function(a){var l=dn();return a={current:a},l.memoizedState=a},useState:function(a){a=Ld(a);var l=a.queue,d=Nm.bind(null,Oe,l);return l.dispatch=d,[a.memoizedState,d]},useDebugValue:Od,useDeferredValue:function(a,l){var d=dn();return Hd(d,a,l)},useTransition:function(){var a=Ld(!1);return a=Tm.bind(null,Oe,a.queue,!0,!1),dn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,d){var p=Oe,b=dn();if(Xe){if(d===void 0)throw Error(n(407));d=d()}else{if(d=l(),pt===null)throw Error(n(349));(Qe&127)!==0||sm(p,l,d)}b.memoizedState=d;var w={value:d,getSnapshot:l};return b.queue=w,bm(am.bind(null,p,w,a),[a]),p.flags|=2048,Wa(9,{destroy:void 0},im.bind(null,p,w,d,l),null),d},useId:function(){var a=dn(),l=pt.identifierPrefix;if(Xe){var d=gs,p=ps;d=(p&~(1<<32-Lt(p)-1)).toString(32)+d,l="_"+l+"R_"+d,d=Rc++,0<d&&(l+="H"+d.toString(32)),l+="_"}else d=h1++,l="_"+l+"r_"+d.toString(32)+"_";return a.memoizedState=l},useHostTransitionStatus:$d,useFormState:pm,useActionState:pm,useOptimistic:function(a){var l=dn();l.memoizedState=l.baseState=a;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=d,l=Bd.bind(null,Oe,!0,d),d.dispatch=l,[a,l]},useMemoCache:Pd,useCacheRefresh:function(){return dn().memoizedState=v1.bind(null,Oe)},useEffectEvent:function(a){var l=dn(),d={impl:a};return l.memoizedState=d,function(){if((st&2)!==0)throw Error(n(440));return d.impl.apply(void 0,arguments)}}},Ud={readContext:tn,use:kc,useCallback:Rm,useContext:tn,useEffect:Id,useImperativeHandle:Mm,useInsertionEffect:wm,useLayoutEffect:Cm,useMemo:Em,useReducer:Tc,useRef:vm,useState:function(){return Tc(Us)},useDebugValue:Od,useDeferredValue:function(a,l){var d=_t();return km(d,ut.memoizedState,a,l)},useTransition:function(){var a=Tc(Us)[0],l=_t().memoizedState;return[typeof a=="boolean"?a:Zo(a),l]},useSyncExternalStore:nm,useId:_m,useHostTransitionStatus:$d,useFormState:gm,useActionState:gm,useOptimistic:function(a,l){var d=_t();return cm(d,ut,a,l)},useMemoCache:Pd,useCacheRefresh:Pm};Ud.useEffectEvent=xm;var Im={readContext:tn,use:kc,useCallback:Rm,useContext:tn,useEffect:Id,useImperativeHandle:Mm,useInsertionEffect:wm,useLayoutEffect:Cm,useMemo:Em,useReducer:jd,useRef:vm,useState:function(){return jd(Us)},useDebugValue:Od,useDeferredValue:function(a,l){var d=_t();return ut===null?Hd(d,a,l):km(d,ut.memoizedState,a,l)},useTransition:function(){var a=jd(Us)[0],l=_t().memoizedState;return[typeof a=="boolean"?a:Zo(a),l]},useSyncExternalStore:nm,useId:_m,useHostTransitionStatus:$d,useFormState:ym,useActionState:ym,useOptimistic:function(a,l){var d=_t();return ut!==null?cm(d,ut,a,l):(d.baseState=a,[a,d.queue.dispatch])},useMemoCache:Pd,useCacheRefresh:Pm};Im.useEffectEvent=xm;function Fd(a,l,d,p){l=a.memoizedState,d=d(p,l),d=d==null?l:m({},l,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var Vd={enqueueSetState:function(a,l,d){a=a._reactInternals;var p=An(),b=gi(p);b.payload=l,d!=null&&(b.callback=d),l=mi(a,b,p),l!==null&&(bn(l,a,p),Yo(l,a,p))},enqueueReplaceState:function(a,l,d){a=a._reactInternals;var p=An(),b=gi(p);b.tag=1,b.payload=l,d!=null&&(b.callback=d),l=mi(a,b,p),l!==null&&(bn(l,a,p),Yo(l,a,p))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var d=An(),p=gi(d);p.tag=2,l!=null&&(p.callback=l),l=mi(a,p,d),l!==null&&(bn(l,a,d),Yo(l,a,d))}};function Om(a,l,d,p,b,w,E){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,w,E):l.prototype&&l.prototype.isPureReactComponent?!$o(d,p)||!$o(b,w):!0}function Hm(a,l,d,p){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(d,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(d,p),l.state!==a&&Vd.enqueueReplaceState(l,l.state,null)}function ra(a,l){var d=l;if("ref"in l){d={};for(var p in l)p!=="ref"&&(d[p]=l[p])}if(a=a.defaultProps){d===l&&(d=m({},d));for(var b in a)d[b]===void 0&&(d[b]=a[b])}return d}function qm(a){lc(a)}function $m(a){console.error(a)}function Bm(a){lc(a)}function Pc(a,l){try{var d=a.onUncaughtError;d(l.value,{componentStack:l.stack})}catch(p){setTimeout(function(){throw p})}}function Um(a,l,d){try{var p=a.onCaughtError;p(d.value,{componentStack:d.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Gd(a,l,d){return d=gi(d),d.tag=3,d.payload={element:null},d.callback=function(){Pc(a,l)},d}function Fm(a){return a=gi(a),a.tag=3,a}function Vm(a,l,d,p){var b=d.type.getDerivedStateFromError;if(typeof b=="function"){var w=p.value;a.payload=function(){return b(w)},a.callback=function(){Um(l,d,p)}}var E=d.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(a.callback=function(){Um(l,d,p),typeof b!="function"&&(Ci===null?Ci=new Set([this]):Ci.add(this));var D=p.stack;this.componentDidCatch(p.value,{componentStack:D!==null?D:""})})}function x1(a,l,d,p,b){if(d.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(l=d.alternate,l!==null&&Ba(l,d,b,!0),d=Rn.current,d!==null){switch(d.tag){case 31:case 13:return Bn===null?Fc():d.alternate===null&&Et===0&&(Et=3),d.flags&=-257,d.flags|=65536,d.lanes=b,p===bc?d.flags|=16384:(l=d.updateQueue,l===null?d.updateQueue=new Set([p]):l.add(p),yh(a,p,b)),!1;case 22:return d.flags|=65536,p===bc?d.flags|=16384:(l=d.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([p])},d.updateQueue=l):(d=l.retryQueue,d===null?l.retryQueue=new Set([p]):d.add(p)),yh(a,p,b)),!1}throw Error(n(435,d.tag))}return yh(a,p,b),Fc(),!1}if(Xe)return l=Rn.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=b,p!==dd&&(a=Error(n(422),{cause:p}),Fo(On(a,d)))):(p!==dd&&(l=Error(n(423),{cause:p}),Fo(On(l,d))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,p=On(p,d),b=Gd(a.stateNode,p,b),Cd(a,b),Et!==4&&(Et=2)),!1;var w=Error(n(520),{cause:p});if(w=On(w,d),lr===null?lr=[w]:lr.push(w),Et!==4&&(Et=2),l===null)return!0;p=On(p,d),d=l;do{switch(d.tag){case 3:return d.flags|=65536,a=b&-b,d.lanes|=a,a=Gd(d.stateNode,p,a),Cd(d,a),!1;case 1:if(l=d.type,w=d.stateNode,(d.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ci===null||!Ci.has(w))))return d.flags|=65536,b&=-b,d.lanes|=b,b=Fm(b),Vm(b,a,d,p),Cd(d,b),!1}d=d.return}while(d!==null);return!1}var Qd=Error(n(461)),Ht=!1;function nn(a,l,d,p){l.child=a===null?Yg(l,null,d,p):aa(l,a.child,d,p)}function Gm(a,l,d,p,b){d=d.render;var w=l.ref;if("ref"in p){var E={};for(var D in p)D!=="ref"&&(E[D]=p[D])}else E=p;return ta(l),p=Td(a,l,d,E,w,b),D=Ad(),a!==null&&!Ht?(Dd(a,l,b),Fs(a,l,b)):(Xe&&D&&ld(l),l.flags|=1,nn(a,l,p,b),l.child)}function Qm(a,l,d,p,b){if(a===null){var w=d.type;return typeof w=="function"&&!od(w)&&w.defaultProps===void 0&&d.compare===null?(l.tag=15,l.type=w,Km(a,l,w,p,b)):(a=fc(d.type,null,p,l,l.mode,b),a.ref=l.ref,a.return=l,l.child=a)}if(w=a.child,!th(a,b)){var E=w.memoizedProps;if(d=d.compare,d=d!==null?d:$o,d(E,p)&&a.ref===l.ref)return Fs(a,l,b)}return l.flags|=1,a=Os(w,p),a.ref=l.ref,a.return=l,l.child=a}function Km(a,l,d,p,b){if(a!==null){var w=a.memoizedProps;if($o(w,p)&&a.ref===l.ref)if(Ht=!1,l.pendingProps=p=w,th(a,b))(a.flags&131072)!==0&&(Ht=!0);else return l.lanes=a.lanes,Fs(a,l,b)}return Kd(a,l,d,p,b)}function Ym(a,l,d,p){var b=p.children,w=a!==null?a.memoizedState:null;if(a===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((l.flags&128)!==0){if(w=w!==null?w.baseLanes|d:d,a!==null){for(p=l.child=a.child,b=0;p!==null;)b=b|p.lanes|p.childLanes,p=p.sibling;p=b&~w}else p=0,l.child=null;return Wm(a,l,w,d,p)}if((d&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&yc(l,w!==null?w.cachePool:null),w!==null?Jg(l,w):Md(),Zg(l);else return p=l.lanes=536870912,Wm(a,l,w!==null?w.baseLanes|d:d,d,p)}else w!==null?(yc(l,w.cachePool),Jg(l,w),vi(),l.memoizedState=null):(a!==null&&yc(l,null),Md(),vi());return nn(a,l,b,d),l.child}function nr(a,l){return a!==null&&a.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function Wm(a,l,d,p,b){var w=vd();return w=w===null?null:{parent:It._currentValue,pool:w},l.memoizedState={baseLanes:d,cachePool:w},a!==null&&yc(l,null),Md(),Zg(l),a!==null&&Ba(a,l,p,!0),l.childLanes=b,null}function Nc(a,l){return l=Lc({mode:l.mode,children:l.children},a.mode),l.ref=a.ref,a.child=l,l.return=a,l}function Xm(a,l,d){return aa(l,a.child,null,d),a=Nc(l,l.pendingProps),a.flags|=2,En(l),l.memoizedState=null,a}function w1(a,l,d){var p=l.pendingProps,b=(l.flags&128)!==0;if(l.flags&=-129,a===null){if(Xe){if(p.mode==="hidden")return a=Nc(l,p),l.lanes=536870912,nr(null,a);if(Ed(l),(a=wt)?(a=l0(a,$n),a=a!==null&&a.data==="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:ui!==null?{id:ps,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},d=jg(a),d.return=l,l.child=d,en=l,wt=null)):a=null,a===null)throw hi(l);return l.lanes=536870912,null}return Nc(l,p)}var w=a.memoizedState;if(w!==null){var E=w.dehydrated;if(Ed(l),b)if(l.flags&256)l.flags&=-257,l=Xm(a,l,d);else if(l.memoizedState!==null)l.child=a.child,l.flags|=128,l=null;else throw Error(n(558));else if(Ht||Ba(a,l,d,!1),b=(d&a.childLanes)!==0,Ht||b){if(p=pt,p!==null&&(E=zt(p,d),E!==0&&E!==w.retryLane))throw w.retryLane=E,Xi(a,E),bn(p,a,E),Qd;Fc(),l=Xm(a,l,d)}else a=w.treeContext,wt=Un(E.nextSibling),en=l,Xe=!0,di=null,$n=!1,a!==null&&Ig(l,a),l=Nc(l,p),l.flags|=4096;return l}return a=Os(a.child,{mode:p.mode,children:p.children}),a.ref=l.ref,l.child=a,a.return=l,a}function jc(a,l){var d=l.ref;if(d===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(n(284));(a===null||a.ref!==d)&&(l.flags|=4194816)}}function Kd(a,l,d,p,b){return ta(l),d=Td(a,l,d,p,void 0,b),p=Ad(),a!==null&&!Ht?(Dd(a,l,b),Fs(a,l,b)):(Xe&&p&&ld(l),l.flags|=1,nn(a,l,d,b),l.child)}function Jm(a,l,d,p,b,w){return ta(l),l.updateQueue=null,d=tm(l,p,d,b),em(a),p=Ad(),a!==null&&!Ht?(Dd(a,l,w),Fs(a,l,w)):(Xe&&p&&ld(l),l.flags|=1,nn(a,l,d,w),l.child)}function Zm(a,l,d,p,b){if(ta(l),l.stateNode===null){var w=Oa,E=d.contextType;typeof E=="object"&&E!==null&&(w=tn(E)),w=new d(p,w),l.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Vd,l.stateNode=w,w._reactInternals=l,w=l.stateNode,w.props=p,w.state=l.memoizedState,w.refs={},xd(l),E=d.contextType,w.context=typeof E=="object"&&E!==null?tn(E):Oa,w.state=l.memoizedState,E=d.getDerivedStateFromProps,typeof E=="function"&&(Fd(l,d,E,p),w.state=l.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(E=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),E!==w.state&&Vd.enqueueReplaceState(w,w.state,null),Xo(l,p,w,b),Wo(),w.state=l.memoizedState),typeof w.componentDidMount=="function"&&(l.flags|=4194308),p=!0}else if(a===null){w=l.stateNode;var D=l.memoizedProps,I=ra(d,D);w.props=I;var G=w.context,ne=d.contextType;E=Oa,typeof ne=="object"&&ne!==null&&(E=tn(ne));var re=d.getDerivedStateFromProps;ne=typeof re=="function"||typeof w.getSnapshotBeforeUpdate=="function",D=l.pendingProps!==D,ne||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(D||G!==E)&&Hm(l,w,p,E),pi=!1;var K=l.memoizedState;w.state=K,Xo(l,p,w,b),Wo(),G=l.memoizedState,D||K!==G||pi?(typeof re=="function"&&(Fd(l,d,re,p),G=l.memoizedState),(I=pi||Om(l,d,I,p,K,G,E))?(ne||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(l.flags|=4194308)):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=G),w.props=p,w.state=G,w.context=E,p=I):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{w=l.stateNode,wd(a,l),E=l.memoizedProps,ne=ra(d,E),w.props=ne,re=l.pendingProps,K=w.context,G=d.contextType,I=Oa,typeof G=="object"&&G!==null&&(I=tn(G)),D=d.getDerivedStateFromProps,(G=typeof D=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(E!==re||K!==I)&&Hm(l,w,p,I),pi=!1,K=l.memoizedState,w.state=K,Xo(l,p,w,b),Wo();var X=l.memoizedState;E!==re||K!==X||pi||a!==null&&a.dependencies!==null&&gc(a.dependencies)?(typeof D=="function"&&(Fd(l,d,D,p),X=l.memoizedState),(ne=pi||Om(l,d,ne,p,K,X,I)||a!==null&&a.dependencies!==null&&gc(a.dependencies))?(G||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(p,X,I),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(p,X,I)),typeof w.componentDidUpdate=="function"&&(l.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof w.componentDidUpdate!="function"||E===a.memoizedProps&&K===a.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||E===a.memoizedProps&&K===a.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=X),w.props=p,w.state=X,w.context=I,p=ne):(typeof w.componentDidUpdate!="function"||E===a.memoizedProps&&K===a.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||E===a.memoizedProps&&K===a.memoizedState||(l.flags|=1024),p=!1)}return w=p,jc(a,l),p=(l.flags&128)!==0,w||p?(w=l.stateNode,d=p&&typeof d.getDerivedStateFromError!="function"?null:w.render(),l.flags|=1,a!==null&&p?(l.child=aa(l,a.child,null,b),l.child=aa(l,null,d,b)):nn(a,l,d,b),l.memoizedState=w.state,a=l.child):a=Fs(a,l,b),a}function ey(a,l,d,p){return Zi(),l.flags|=256,nn(a,l,d,p),l.child}var Yd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wd(a){return{baseLanes:a,cachePool:Ug()}}function Xd(a,l,d){return a=a!==null?a.childLanes&~d:0,l&&(a|=Tn),a}function ty(a,l,d){var p=l.pendingProps,b=!1,w=(l.flags&128)!==0,E;if((E=w)||(E=a!==null&&a.memoizedState===null?!1:(Dt.current&2)!==0),E&&(b=!0,l.flags&=-129),E=(l.flags&32)!==0,l.flags&=-33,a===null){if(Xe){if(b?yi(l):vi(),(a=wt)?(a=l0(a,$n),a=a!==null&&a.data!=="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:ui!==null?{id:ps,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},d=jg(a),d.return=l,l.child=d,en=l,wt=null)):a=null,a===null)throw hi(l);return Nh(a)?l.lanes=32:l.lanes=536870912,null}var D=p.children;return p=p.fallback,b?(vi(),b=l.mode,D=Lc({mode:"hidden",children:D},b),p=Ji(p,b,d,null),D.return=l,p.return=l,D.sibling=p,l.child=D,p=l.child,p.memoizedState=Wd(d),p.childLanes=Xd(a,E,d),l.memoizedState=Yd,nr(null,p)):(yi(l),Jd(l,D))}var I=a.memoizedState;if(I!==null&&(D=I.dehydrated,D!==null)){if(w)l.flags&256?(yi(l),l.flags&=-257,l=Zd(a,l,d)):l.memoizedState!==null?(vi(),l.child=a.child,l.flags|=128,l=null):(vi(),D=p.fallback,b=l.mode,p=Lc({mode:"visible",children:p.children},b),D=Ji(D,b,d,null),D.flags|=2,p.return=l,D.return=l,p.sibling=D,l.child=p,aa(l,a.child,null,d),p=l.child,p.memoizedState=Wd(d),p.childLanes=Xd(a,E,d),l.memoizedState=Yd,l=nr(null,p));else if(yi(l),Nh(D)){if(E=D.nextSibling&&D.nextSibling.dataset,E)var G=E.dgst;E=G,p=Error(n(419)),p.stack="",p.digest=E,Fo({value:p,source:null,stack:null}),l=Zd(a,l,d)}else if(Ht||Ba(a,l,d,!1),E=(d&a.childLanes)!==0,Ht||E){if(E=pt,E!==null&&(p=zt(E,d),p!==0&&p!==I.retryLane))throw I.retryLane=p,Xi(a,p),bn(E,a,p),Qd;Ph(D)||Fc(),l=Zd(a,l,d)}else Ph(D)?(l.flags|=192,l.child=a.child,l=null):(a=I.treeContext,wt=Un(D.nextSibling),en=l,Xe=!0,di=null,$n=!1,a!==null&&Ig(l,a),l=Jd(l,p.children),l.flags|=4096);return l}return b?(vi(),D=p.fallback,b=l.mode,I=a.child,G=I.sibling,p=Os(I,{mode:"hidden",children:p.children}),p.subtreeFlags=I.subtreeFlags&65011712,G!==null?D=Os(G,D):(D=Ji(D,b,d,null),D.flags|=2),D.return=l,p.return=l,p.sibling=D,l.child=p,nr(null,p),p=l.child,D=a.child.memoizedState,D===null?D=Wd(d):(b=D.cachePool,b!==null?(I=It._currentValue,b=b.parent!==I?{parent:I,pool:I}:b):b=Ug(),D={baseLanes:D.baseLanes|d,cachePool:b}),p.memoizedState=D,p.childLanes=Xd(a,E,d),l.memoizedState=Yd,nr(a.child,p)):(yi(l),d=a.child,a=d.sibling,d=Os(d,{mode:"visible",children:p.children}),d.return=l,d.sibling=null,a!==null&&(E=l.deletions,E===null?(l.deletions=[a],l.flags|=16):E.push(a)),l.child=d,l.memoizedState=null,d)}function Jd(a,l){return l=Lc({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function Lc(a,l){return a=Mn(22,a,null,l),a.lanes=0,a}function Zd(a,l,d){return aa(l,a.child,null,d),a=Jd(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function ny(a,l,d){a.lanes|=l;var p=a.alternate;p!==null&&(p.lanes|=l),pd(a.return,l,d)}function eh(a,l,d,p,b,w){var E=a.memoizedState;E===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:b,treeForkCount:w}:(E.isBackwards=l,E.rendering=null,E.renderingStartTime=0,E.last=p,E.tail=d,E.tailMode=b,E.treeForkCount=w)}function sy(a,l,d){var p=l.pendingProps,b=p.revealOrder,w=p.tail;p=p.children;var E=Dt.current,D=(E&2)!==0;if(D?(E=E&1|2,l.flags|=128):E&=1,Y(Dt,E),nn(a,l,p,d),p=Xe?Uo:0,!D&&a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ny(a,d,l);else if(a.tag===19)ny(a,d,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(b){case"forwards":for(d=l.child,b=null;d!==null;)a=d.alternate,a!==null&&Sc(a)===null&&(b=d),d=d.sibling;d=b,d===null?(b=l.child,l.child=null):(b=d.sibling,d.sibling=null),eh(l,!1,b,d,w,p);break;case"backwards":case"unstable_legacy-backwards":for(d=null,b=l.child,l.child=null;b!==null;){if(a=b.alternate,a!==null&&Sc(a)===null){l.child=b;break}a=b.sibling,b.sibling=d,d=b,b=a}eh(l,!0,d,null,w,p);break;case"together":eh(l,!1,null,null,void 0,p);break;default:l.memoizedState=null}return l.child}function Fs(a,l,d){if(a!==null&&(l.dependencies=a.dependencies),wi|=l.lanes,(d&l.childLanes)===0)if(a!==null){if(Ba(a,l,d,!1),(d&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(n(153));if(l.child!==null){for(a=l.child,d=Os(a,a.pendingProps),l.child=d,d.return=l;a.sibling!==null;)a=a.sibling,d=d.sibling=Os(a,a.pendingProps),d.return=l;d.sibling=null}return l.child}function th(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&gc(a)))}function C1(a,l,d){switch(l.tag){case 3:Q(l,l.stateNode.containerInfo),fi(l,It,a.memoizedState.cache),Zi();break;case 27:case 5:me(l);break;case 4:Q(l,l.stateNode.containerInfo);break;case 10:fi(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Ed(l),null;break;case 13:var p=l.memoizedState;if(p!==null)return p.dehydrated!==null?(yi(l),l.flags|=128,null):(d&l.child.childLanes)!==0?ty(a,l,d):(yi(l),a=Fs(a,l,d),a!==null?a.sibling:null);yi(l);break;case 19:var b=(a.flags&128)!==0;if(p=(d&l.childLanes)!==0,p||(Ba(a,l,d,!1),p=(d&l.childLanes)!==0),b){if(p)return sy(a,l,d);l.flags|=128}if(b=l.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Y(Dt,Dt.current),p)break;return null;case 22:return l.lanes=0,Ym(a,l,d,l.pendingProps);case 24:fi(l,It,a.memoizedState.cache)}return Fs(a,l,d)}function iy(a,l,d){if(a!==null)if(a.memoizedProps!==l.pendingProps)Ht=!0;else{if(!th(a,d)&&(l.flags&128)===0)return Ht=!1,C1(a,l,d);Ht=(a.flags&131072)!==0}else Ht=!1,Xe&&(l.flags&1048576)!==0&&zg(l,Uo,l.index);switch(l.lanes=0,l.tag){case 16:e:{var p=l.pendingProps;if(a=sa(l.elementType),l.type=a,typeof a=="function")od(a)?(p=ra(a,p),l.tag=1,l=Zm(null,l,a,p,d)):(l.tag=0,l=Kd(null,l,a,p,d));else{if(a!=null){var b=a.$$typeof;if(b===A){l.tag=11,l=Gm(null,l,a,p,d);break e}else if(b===z){l.tag=14,l=Qm(null,l,a,p,d);break e}}throw l=le(a)||a,Error(n(306,l,""))}}return l;case 0:return Kd(a,l,l.type,l.pendingProps,d);case 1:return p=l.type,b=ra(p,l.pendingProps),Zm(a,l,p,b,d);case 3:e:{if(Q(l,l.stateNode.containerInfo),a===null)throw Error(n(387));p=l.pendingProps;var w=l.memoizedState;b=w.element,wd(a,l),Xo(l,p,null,d);var E=l.memoizedState;if(p=E.cache,fi(l,It,p),p!==w.cache&&gd(l,[It],d,!0),Wo(),p=E.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:E.cache},l.updateQueue.baseState=w,l.memoizedState=w,l.flags&256){l=ey(a,l,p,d);break e}else if(p!==b){b=On(Error(n(424)),l),Fo(b),l=ey(a,l,p,d);break e}else{switch(a=l.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(wt=Un(a.firstChild),en=l,Xe=!0,di=null,$n=!0,d=Yg(l,null,p,d),l.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Zi(),p===b){l=Fs(a,l,d);break e}nn(a,l,p,d)}l=l.child}return l;case 26:return jc(a,l),a===null?(d=g0(l.type,null,l.pendingProps,null))?l.memoizedState=d:Xe||(d=l.type,a=l.pendingProps,p=Xc(ae.current).createElement(d),p[vt]=l,p[Bt]=a,sn(p,d,a),Yt(p),l.stateNode=p):l.memoizedState=g0(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return me(l),a===null&&Xe&&(p=l.stateNode=h0(l.type,l.pendingProps,ae.current),en=l,$n=!0,b=wt,Ei(l.type)?(jh=b,wt=Un(p.firstChild)):wt=b),nn(a,l,l.pendingProps.children,d),jc(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&Xe&&((b=p=wt)&&(p=J1(p,l.type,l.pendingProps,$n),p!==null?(l.stateNode=p,en=l,wt=Un(p.firstChild),$n=!1,b=!0):b=!1),b||hi(l)),me(l),b=l.type,w=l.pendingProps,E=a!==null?a.memoizedProps:null,p=w.children,Ah(b,w)?p=null:E!==null&&Ah(b,E)&&(l.flags|=32),l.memoizedState!==null&&(b=Td(a,l,f1,null,null,d),yr._currentValue=b),jc(a,l),nn(a,l,p,d),l.child;case 6:return a===null&&Xe&&((a=d=wt)&&(d=Z1(d,l.pendingProps,$n),d!==null?(l.stateNode=d,en=l,wt=null,a=!0):a=!1),a||hi(l)),null;case 13:return ty(a,l,d);case 4:return Q(l,l.stateNode.containerInfo),p=l.pendingProps,a===null?l.child=aa(l,null,p,d):nn(a,l,p,d),l.child;case 11:return Gm(a,l,l.type,l.pendingProps,d);case 7:return nn(a,l,l.pendingProps,d),l.child;case 8:return nn(a,l,l.pendingProps.children,d),l.child;case 12:return nn(a,l,l.pendingProps.children,d),l.child;case 10:return p=l.pendingProps,fi(l,l.type,p.value),nn(a,l,p.children,d),l.child;case 9:return b=l.type._context,p=l.pendingProps.children,ta(l),b=tn(b),p=p(b),l.flags|=1,nn(a,l,p,d),l.child;case 14:return Qm(a,l,l.type,l.pendingProps,d);case 15:return Km(a,l,l.type,l.pendingProps,d);case 19:return sy(a,l,d);case 31:return w1(a,l,d);case 22:return Ym(a,l,d,l.pendingProps);case 24:return ta(l),p=tn(It),a===null?(b=vd(),b===null&&(b=pt,w=md(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=d),b=w),l.memoizedState={parent:p,cache:b},xd(l),fi(l,It,b)):((a.lanes&d)!==0&&(wd(a,l),Xo(l,null,null,d),Wo()),b=a.memoizedState,w=l.memoizedState,b.parent!==p?(b={parent:p,cache:p},l.memoizedState=b,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=b),fi(l,It,p)):(p=w.cache,fi(l,It,p),p!==b.cache&&gd(l,[It],d,!0))),nn(a,l,l.pendingProps.children,d),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function Vs(a){a.flags|=4}function nh(a,l,d,p,b){if((l=(a.mode&32)!==0)&&(l=!1),l){if(a.flags|=16777216,(b&335544128)===b)if(a.stateNode.complete)a.flags|=8192;else if(_y())a.flags|=8192;else throw ia=bc,bd}else a.flags&=-16777217}function ay(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!x0(l))if(_y())a.flags|=8192;else throw ia=bc,bd}function zc(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?ee():536870912,a.lanes|=l,eo|=l)}function sr(a,l){if(!Xe)switch(a.tailMode){case"hidden":l=a.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Ct(a){var l=a.alternate!==null&&a.alternate.child===a.child,d=0,p=0;if(l)for(var b=a.child;b!==null;)d|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)d|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=p,a.childLanes=d,l}function S1(a,l,d){var p=l.pendingProps;switch(ud(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ct(l),null;case 1:return Ct(l),null;case 3:return d=l.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),l.memoizedState.cache!==p&&(l.flags|=2048),$s(It),pe(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(a===null||a.child===null)&&($a(l)?Vs(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,hd())),Ct(l),null;case 26:var b=l.type,w=l.memoizedState;return a===null?(Vs(l),w!==null?(Ct(l),ay(l,w)):(Ct(l),nh(l,b,null,p,d))):w?w!==a.memoizedState?(Vs(l),Ct(l),ay(l,w)):(Ct(l),l.flags&=-16777217):(a=a.memoizedProps,a!==p&&Vs(l),Ct(l),nh(l,b,a,p,d)),null;case 27:if(ye(l),d=ae.current,b=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==p&&Vs(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return Ct(l),null}a=ie.current,$a(l)?Og(l):(a=h0(b,p,d),l.stateNode=a,Vs(l))}return Ct(l),null;case 5:if(ye(l),b=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==p&&Vs(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return Ct(l),null}if(w=ie.current,$a(l))Og(l);else{var E=Xc(ae.current);switch(w){case 1:w=E.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=E.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=E.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof p.is=="string"?E.createElement("select",{is:p.is}):E.createElement("select"),p.multiple?w.multiple=!0:p.size&&(w.size=p.size);break;default:w=typeof p.is=="string"?E.createElement(b,{is:p.is}):E.createElement(b)}}w[vt]=l,w[Bt]=p;e:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)w.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break e;for(;E.sibling===null;){if(E.return===null||E.return===l)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=w;e:switch(sn(w,b,p),b){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Vs(l)}}return Ct(l),nh(l,l.type,a===null?null:a.memoizedProps,l.pendingProps,d),null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==p&&Vs(l);else{if(typeof p!="string"&&l.stateNode===null)throw Error(n(166));if(a=ae.current,$a(l)){if(a=l.stateNode,d=l.memoizedProps,p=null,b=en,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}a[vt]=l,a=!!(a.nodeValue===d||p!==null&&p.suppressHydrationWarning===!0||t0(a.nodeValue,d)),a||hi(l,!0)}else a=Xc(a).createTextNode(p),a[vt]=l,l.stateNode=a}return Ct(l),null;case 31:if(d=l.memoizedState,a===null||a.memoizedState!==null){if(p=$a(l),d!==null){if(a===null){if(!p)throw Error(n(318));if(a=l.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[vt]=l}else Zi(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Ct(l),a=!1}else d=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=d),a=!0;if(!a)return l.flags&256?(En(l),l):(En(l),null);if((l.flags&128)!==0)throw Error(n(558))}return Ct(l),null;case 13:if(p=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=$a(l),p!==null&&p.dehydrated!==null){if(a===null){if(!b)throw Error(n(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[vt]=l}else Zi(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Ct(l),b=!1}else b=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return l.flags&256?(En(l),l):(En(l),null)}return En(l),(l.flags&128)!==0?(l.lanes=d,l):(d=p!==null,a=a!==null&&a.memoizedState!==null,d&&(p=l.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool),w=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(w=p.memoizedState.cachePool.pool),w!==b&&(p.flags|=2048)),d!==a&&d&&(l.child.flags|=8192),zc(l,l.updateQueue),Ct(l),null);case 4:return pe(),a===null&&Mh(l.stateNode.containerInfo),Ct(l),null;case 10:return $s(l.type),Ct(l),null;case 19:if(F(Dt),p=l.memoizedState,p===null)return Ct(l),null;if(b=(l.flags&128)!==0,w=p.rendering,w===null)if(b)sr(p,!1);else{if(Et!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(w=Sc(a),w!==null){for(l.flags|=128,sr(p,!1),a=w.updateQueue,l.updateQueue=a,zc(l,a),l.subtreeFlags=0,a=d,d=l.child;d!==null;)Ng(d,a),d=d.sibling;return Y(Dt,Dt.current&1|2),Xe&&Hs(l,p.treeForkCount),l.child}a=a.sibling}p.tail!==null&&Ze()>$c&&(l.flags|=128,b=!0,sr(p,!1),l.lanes=4194304)}else{if(!b)if(a=Sc(w),a!==null){if(l.flags|=128,b=!0,a=a.updateQueue,l.updateQueue=a,zc(l,a),sr(p,!0),p.tail===null&&p.tailMode==="hidden"&&!w.alternate&&!Xe)return Ct(l),null}else 2*Ze()-p.renderingStartTime>$c&&d!==536870912&&(l.flags|=128,b=!0,sr(p,!1),l.lanes=4194304);p.isBackwards?(w.sibling=l.child,l.child=w):(a=p.last,a!==null?a.sibling=w:l.child=w,p.last=w)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=Ze(),a.sibling=null,d=Dt.current,Y(Dt,b?d&1|2:d&1),Xe&&Hs(l,p.treeForkCount),a):(Ct(l),null);case 22:case 23:return En(l),Rd(),p=l.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(l.flags|=8192):p&&(l.flags|=8192),p?(d&536870912)!==0&&(l.flags&128)===0&&(Ct(l),l.subtreeFlags&6&&(l.flags|=8192)):Ct(l),d=l.updateQueue,d!==null&&zc(l,d.retryQueue),d=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==d&&(l.flags|=2048),a!==null&&F(na),null;case 24:return d=null,a!==null&&(d=a.memoizedState.cache),l.memoizedState.cache!==d&&(l.flags|=2048),$s(It),Ct(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function M1(a,l){switch(ud(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return $s(It),pe(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return ye(l),null;case 31:if(l.memoizedState!==null){if(En(l),l.alternate===null)throw Error(n(340));Zi()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 13:if(En(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Zi()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return F(Dt),null;case 4:return pe(),null;case 10:return $s(l.type),null;case 22:case 23:return En(l),Rd(),a!==null&&F(na),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return $s(It),null;case 25:return null;default:return null}}function oy(a,l){switch(ud(l),l.tag){case 3:$s(It),pe();break;case 26:case 27:case 5:ye(l);break;case 4:pe();break;case 31:l.memoizedState!==null&&En(l);break;case 13:En(l);break;case 19:F(Dt);break;case 10:$s(l.type);break;case 22:case 23:En(l),Rd(),a!==null&&F(na);break;case 24:$s(It)}}function ir(a,l){try{var d=l.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var b=p.next;d=b;do{if((d.tag&a)===a){p=void 0;var w=d.create,E=d.inst;p=w(),E.destroy=p}d=d.next}while(d!==b)}}catch(D){ct(l,l.return,D)}}function bi(a,l,d){try{var p=l.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var w=b.next;p=w;do{if((p.tag&a)===a){var E=p.inst,D=E.destroy;if(D!==void 0){E.destroy=void 0,b=l;var I=d,G=D;try{G()}catch(ne){ct(b,I,ne)}}}p=p.next}while(p!==w)}}catch(ne){ct(l,l.return,ne)}}function ry(a){var l=a.updateQueue;if(l!==null){var d=a.stateNode;try{Xg(l,d)}catch(p){ct(a,a.return,p)}}}function cy(a,l,d){d.props=ra(a.type,a.memoizedProps),d.state=a.memoizedState;try{d.componentWillUnmount()}catch(p){ct(a,l,p)}}function ar(a,l){try{var d=a.ref;if(d!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof d=="function"?a.refCleanup=d(p):d.current=p}}catch(b){ct(a,l,b)}}function ms(a,l){var d=a.ref,p=a.refCleanup;if(d!==null)if(typeof p=="function")try{p()}catch(b){ct(a,l,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(b){ct(a,l,b)}else d.current=null}function ly(a){var l=a.type,d=a.memoizedProps,p=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":d.autoFocus&&p.focus();break e;case"img":d.src?p.src=d.src:d.srcSet&&(p.srcset=d.srcSet)}}catch(b){ct(a,a.return,b)}}function sh(a,l,d){try{var p=a.stateNode;G1(p,a.type,d,l),p[Bt]=l}catch(b){ct(a,a.return,b)}}function uy(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ei(a.type)||a.tag===4}function ih(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||uy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ei(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ah(a,l,d){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(a,l):(l=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,l.appendChild(a),d=d._reactRootContainer,d!=null||l.onclick!==null||(l.onclick=zs));else if(p!==4&&(p===27&&Ei(a.type)&&(d=a.stateNode,l=null),a=a.child,a!==null))for(ah(a,l,d),a=a.sibling;a!==null;)ah(a,l,d),a=a.sibling}function Ic(a,l,d){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?d.insertBefore(a,l):d.appendChild(a);else if(p!==4&&(p===27&&Ei(a.type)&&(d=a.stateNode),a=a.child,a!==null))for(Ic(a,l,d),a=a.sibling;a!==null;)Ic(a,l,d),a=a.sibling}function dy(a){var l=a.stateNode,d=a.memoizedProps;try{for(var p=a.type,b=l.attributes;b.length;)l.removeAttributeNode(b[0]);sn(l,p,d),l[vt]=a,l[Bt]=d}catch(w){ct(a,a.return,w)}}var Gs=!1,qt=!1,oh=!1,hy=typeof WeakSet=="function"?WeakSet:Set,Wt=null;function R1(a,l){if(a=a.containerInfo,kh=il,a=Mg(a),Zu(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var p=d.getSelection&&d.getSelection();if(p&&p.rangeCount!==0){d=p.anchorNode;var b=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{d.nodeType,w.nodeType}catch{d=null;break e}var E=0,D=-1,I=-1,G=0,ne=0,re=a,K=null;t:for(;;){for(var X;re!==d||b!==0&&re.nodeType!==3||(D=E+b),re!==w||p!==0&&re.nodeType!==3||(I=E+p),re.nodeType===3&&(E+=re.nodeValue.length),(X=re.firstChild)!==null;)K=re,re=X;for(;;){if(re===a)break t;if(K===d&&++G===b&&(D=E),K===w&&++ne===p&&(I=E),(X=re.nextSibling)!==null)break;re=K,K=re.parentNode}re=X}d=D===-1||I===-1?null:{start:D,end:I}}else d=null}d=d||{start:0,end:0}}else d=null;for(Th={focusedElem:a,selectionRange:d},il=!1,Wt=l;Wt!==null;)if(l=Wt,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Wt=a;else for(;Wt!==null;){switch(l=Wt,w=l.alternate,a=l.flags,l.tag){case 0:if((a&4)!==0&&(a=l.updateQueue,a=a!==null?a.events:null,a!==null))for(d=0;d<a.length;d++)b=a[d],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&w!==null){a=void 0,d=l,b=w.memoizedProps,w=w.memoizedState,p=d.stateNode;try{var xe=ra(d.type,b);a=p.getSnapshotBeforeUpdate(xe,w),p.__reactInternalSnapshotBeforeUpdate=a}catch(Pe){ct(d,d.return,Pe)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,d=a.nodeType,d===9)_h(a);else if(d===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":_h(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=l.sibling,a!==null){a.return=l.return,Wt=a;break}Wt=l.return}}function fy(a,l,d){var p=d.flags;switch(d.tag){case 0:case 11:case 15:Ks(a,d),p&4&&ir(5,d);break;case 1:if(Ks(a,d),p&4)if(a=d.stateNode,l===null)try{a.componentDidMount()}catch(E){ct(d,d.return,E)}else{var b=ra(d.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(b,l,a.__reactInternalSnapshotBeforeUpdate)}catch(E){ct(d,d.return,E)}}p&64&&ry(d),p&512&&ar(d,d.return);break;case 3:if(Ks(a,d),p&64&&(a=d.updateQueue,a!==null)){if(l=null,d.child!==null)switch(d.child.tag){case 27:case 5:l=d.child.stateNode;break;case 1:l=d.child.stateNode}try{Xg(a,l)}catch(E){ct(d,d.return,E)}}break;case 27:l===null&&p&4&&dy(d);case 26:case 5:Ks(a,d),l===null&&p&4&&ly(d),p&512&&ar(d,d.return);break;case 12:Ks(a,d);break;case 31:Ks(a,d),p&4&&my(a,d);break;case 13:Ks(a,d),p&4&&yy(a,d),p&64&&(a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(d=j1.bind(null,d),eR(a,d))));break;case 22:if(p=d.memoizedState!==null||Gs,!p){l=l!==null&&l.memoizedState!==null||qt,b=Gs;var w=qt;Gs=p,(qt=l)&&!w?Ys(a,d,(d.subtreeFlags&8772)!==0):Ks(a,d),Gs=b,qt=w}break;case 30:break;default:Ks(a,d)}}function py(a){var l=a.alternate;l!==null&&(a.alternate=null,py(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&zu(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Mt=null,gn=!1;function Qs(a,l,d){for(d=d.child;d!==null;)gy(a,l,d),d=d.sibling}function gy(a,l,d){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(hs,d)}catch{}switch(d.tag){case 26:qt||ms(d,l),Qs(a,l,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:qt||ms(d,l);var p=Mt,b=gn;Ei(d.type)&&(Mt=d.stateNode,gn=!1),Qs(a,l,d),pr(d.stateNode),Mt=p,gn=b;break;case 5:qt||ms(d,l);case 6:if(p=Mt,b=gn,Mt=null,Qs(a,l,d),Mt=p,gn=b,Mt!==null)if(gn)try{(Mt.nodeType===9?Mt.body:Mt.nodeName==="HTML"?Mt.ownerDocument.body:Mt).removeChild(d.stateNode)}catch(w){ct(d,l,w)}else try{Mt.removeChild(d.stateNode)}catch(w){ct(d,l,w)}break;case 18:Mt!==null&&(gn?(a=Mt,r0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,d.stateNode),co(a)):r0(Mt,d.stateNode));break;case 4:p=Mt,b=gn,Mt=d.stateNode.containerInfo,gn=!0,Qs(a,l,d),Mt=p,gn=b;break;case 0:case 11:case 14:case 15:bi(2,d,l),qt||bi(4,d,l),Qs(a,l,d);break;case 1:qt||(ms(d,l),p=d.stateNode,typeof p.componentWillUnmount=="function"&&cy(d,l,p)),Qs(a,l,d);break;case 21:Qs(a,l,d);break;case 22:qt=(p=qt)||d.memoizedState!==null,Qs(a,l,d),qt=p;break;default:Qs(a,l,d)}}function my(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{co(a)}catch(d){ct(l,l.return,d)}}}function yy(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{co(a)}catch(d){ct(l,l.return,d)}}function E1(a){switch(a.tag){case 31:case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new hy),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new hy),l;default:throw Error(n(435,a.tag))}}function Oc(a,l){var d=E1(a);l.forEach(function(p){if(!d.has(p)){d.add(p);var b=L1.bind(null,a,p);p.then(b,b)}})}function mn(a,l){var d=l.deletions;if(d!==null)for(var p=0;p<d.length;p++){var b=d[p],w=a,E=l,D=E;e:for(;D!==null;){switch(D.tag){case 27:if(Ei(D.type)){Mt=D.stateNode,gn=!1;break e}break;case 5:Mt=D.stateNode,gn=!1;break e;case 3:case 4:Mt=D.stateNode.containerInfo,gn=!0;break e}D=D.return}if(Mt===null)throw Error(n(160));gy(w,E,b),Mt=null,gn=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)vy(l,a),l=l.sibling}var es=null;function vy(a,l){var d=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:mn(l,a),yn(a),p&4&&(bi(3,a,a.return),ir(3,a),bi(5,a,a.return));break;case 1:mn(l,a),yn(a),p&512&&(qt||d===null||ms(d,d.return)),p&64&&Gs&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(d=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=d===null?p:d.concat(p))));break;case 26:var b=es;if(mn(l,a),yn(a),p&512&&(qt||d===null||ms(d,d.return)),p&4){var w=d!==null?d.memoizedState:null;if(p=a.memoizedState,d===null)if(p===null)if(a.stateNode===null){e:{p=a.type,d=a.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":w=b.getElementsByTagName("title")[0],(!w||w[Po]||w[vt]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(p),b.head.insertBefore(w,b.querySelector("head > title"))),sn(w,p,d),w[vt]=a,Yt(w),p=w;break e;case"link":var E=v0("link","href",b).get(p+(d.href||""));if(E){for(var D=0;D<E.length;D++)if(w=E[D],w.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&w.getAttribute("rel")===(d.rel==null?null:d.rel)&&w.getAttribute("title")===(d.title==null?null:d.title)&&w.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){E.splice(D,1);break t}}w=b.createElement(p),sn(w,p,d),b.head.appendChild(w);break;case"meta":if(E=v0("meta","content",b).get(p+(d.content||""))){for(D=0;D<E.length;D++)if(w=E[D],w.getAttribute("content")===(d.content==null?null:""+d.content)&&w.getAttribute("name")===(d.name==null?null:d.name)&&w.getAttribute("property")===(d.property==null?null:d.property)&&w.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&w.getAttribute("charset")===(d.charSet==null?null:d.charSet)){E.splice(D,1);break t}}w=b.createElement(p),sn(w,p,d),b.head.appendChild(w);break;default:throw Error(n(468,p))}w[vt]=a,Yt(w),p=w}a.stateNode=p}else b0(b,a.type,a.stateNode);else a.stateNode=y0(b,p,a.memoizedProps);else w!==p?(w===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):w.count--,p===null?b0(b,a.type,a.stateNode):y0(b,p,a.memoizedProps)):p===null&&a.stateNode!==null&&sh(a,a.memoizedProps,d.memoizedProps)}break;case 27:mn(l,a),yn(a),p&512&&(qt||d===null||ms(d,d.return)),d!==null&&p&4&&sh(a,a.memoizedProps,d.memoizedProps);break;case 5:if(mn(l,a),yn(a),p&512&&(qt||d===null||ms(d,d.return)),a.flags&32){b=a.stateNode;try{_a(b,"")}catch(xe){ct(a,a.return,xe)}}p&4&&a.stateNode!=null&&(b=a.memoizedProps,sh(a,b,d!==null?d.memoizedProps:b)),p&1024&&(oh=!0);break;case 6:if(mn(l,a),yn(a),p&4){if(a.stateNode===null)throw Error(n(162));p=a.memoizedProps,d=a.stateNode;try{d.nodeValue=p}catch(xe){ct(a,a.return,xe)}}break;case 3:if(el=null,b=es,es=Jc(l.containerInfo),mn(l,a),es=b,yn(a),p&4&&d!==null&&d.memoizedState.isDehydrated)try{co(l.containerInfo)}catch(xe){ct(a,a.return,xe)}oh&&(oh=!1,by(a));break;case 4:p=es,es=Jc(a.stateNode.containerInfo),mn(l,a),yn(a),es=p;break;case 12:mn(l,a),yn(a);break;case 31:mn(l,a),yn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Oc(a,p)));break;case 13:mn(l,a),yn(a),a.child.flags&8192&&a.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(qc=Ze()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Oc(a,p)));break;case 22:b=a.memoizedState!==null;var I=d!==null&&d.memoizedState!==null,G=Gs,ne=qt;if(Gs=G||b,qt=ne||I,mn(l,a),qt=ne,Gs=G,yn(a),p&8192)e:for(l=a.stateNode,l._visibility=b?l._visibility&-2:l._visibility|1,b&&(d===null||I||Gs||qt||ca(a)),d=null,l=a;;){if(l.tag===5||l.tag===26){if(d===null){I=d=l;try{if(w=I.stateNode,b)E=w.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{D=I.stateNode;var re=I.memoizedProps.style,K=re!=null&&re.hasOwnProperty("display")?re.display:null;D.style.display=K==null||typeof K=="boolean"?"":(""+K).trim()}}catch(xe){ct(I,I.return,xe)}}}else if(l.tag===6){if(d===null){I=l;try{I.stateNode.nodeValue=b?"":I.memoizedProps}catch(xe){ct(I,I.return,xe)}}}else if(l.tag===18){if(d===null){I=l;try{var X=I.stateNode;b?c0(X,!0):c0(I.stateNode,!1)}catch(xe){ct(I,I.return,xe)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;d===l&&(d=null),l=l.return}d===l&&(d=null),l.sibling.return=l.return,l=l.sibling}p&4&&(p=a.updateQueue,p!==null&&(d=p.retryQueue,d!==null&&(p.retryQueue=null,Oc(a,d))));break;case 19:mn(l,a),yn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Oc(a,p)));break;case 30:break;case 21:break;default:mn(l,a),yn(a)}}function yn(a){var l=a.flags;if(l&2){try{for(var d,p=a.return;p!==null;){if(uy(p)){d=p;break}p=p.return}if(d==null)throw Error(n(160));switch(d.tag){case 27:var b=d.stateNode,w=ih(a);Ic(a,w,b);break;case 5:var E=d.stateNode;d.flags&32&&(_a(E,""),d.flags&=-33);var D=ih(a);Ic(a,D,E);break;case 3:case 4:var I=d.stateNode.containerInfo,G=ih(a);ah(a,G,I);break;default:throw Error(n(161))}}catch(ne){ct(a,a.return,ne)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function by(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;by(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function Ks(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)fy(a,l.alternate,l),l=l.sibling}function ca(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:bi(4,l,l.return),ca(l);break;case 1:ms(l,l.return);var d=l.stateNode;typeof d.componentWillUnmount=="function"&&cy(l,l.return,d),ca(l);break;case 27:pr(l.stateNode);case 26:case 5:ms(l,l.return),ca(l);break;case 22:l.memoizedState===null&&ca(l);break;case 30:ca(l);break;default:ca(l)}a=a.sibling}}function Ys(a,l,d){for(d=d&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var p=l.alternate,b=a,w=l,E=w.flags;switch(w.tag){case 0:case 11:case 15:Ys(b,w,d),ir(4,w);break;case 1:if(Ys(b,w,d),p=w,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(G){ct(p,p.return,G)}if(p=w,b=p.updateQueue,b!==null){var D=p.stateNode;try{var I=b.shared.hiddenCallbacks;if(I!==null)for(b.shared.hiddenCallbacks=null,b=0;b<I.length;b++)Wg(I[b],D)}catch(G){ct(p,p.return,G)}}d&&E&64&&ry(w),ar(w,w.return);break;case 27:dy(w);case 26:case 5:Ys(b,w,d),d&&p===null&&E&4&&ly(w),ar(w,w.return);break;case 12:Ys(b,w,d);break;case 31:Ys(b,w,d),d&&E&4&&my(b,w);break;case 13:Ys(b,w,d),d&&E&4&&yy(b,w);break;case 22:w.memoizedState===null&&Ys(b,w,d),ar(w,w.return);break;case 30:break;default:Ys(b,w,d)}l=l.sibling}}function rh(a,l){var d=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==d&&(a!=null&&a.refCount++,d!=null&&Vo(d))}function ch(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Vo(a))}function ts(a,l,d,p){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)xy(a,l,d,p),l=l.sibling}function xy(a,l,d,p){var b=l.flags;switch(l.tag){case 0:case 11:case 15:ts(a,l,d,p),b&2048&&ir(9,l);break;case 1:ts(a,l,d,p);break;case 3:ts(a,l,d,p),b&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Vo(a)));break;case 12:if(b&2048){ts(a,l,d,p),a=l.stateNode;try{var w=l.memoizedProps,E=w.id,D=w.onPostCommit;typeof D=="function"&&D(E,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(I){ct(l,l.return,I)}}else ts(a,l,d,p);break;case 31:ts(a,l,d,p);break;case 13:ts(a,l,d,p);break;case 23:break;case 22:w=l.stateNode,E=l.alternate,l.memoizedState!==null?w._visibility&2?ts(a,l,d,p):or(a,l):w._visibility&2?ts(a,l,d,p):(w._visibility|=2,Xa(a,l,d,p,(l.subtreeFlags&10256)!==0||!1)),b&2048&&rh(E,l);break;case 24:ts(a,l,d,p),b&2048&&ch(l.alternate,l);break;default:ts(a,l,d,p)}}function Xa(a,l,d,p,b){for(b=b&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var w=a,E=l,D=d,I=p,G=E.flags;switch(E.tag){case 0:case 11:case 15:Xa(w,E,D,I,b),ir(8,E);break;case 23:break;case 22:var ne=E.stateNode;E.memoizedState!==null?ne._visibility&2?Xa(w,E,D,I,b):or(w,E):(ne._visibility|=2,Xa(w,E,D,I,b)),b&&G&2048&&rh(E.alternate,E);break;case 24:Xa(w,E,D,I,b),b&&G&2048&&ch(E.alternate,E);break;default:Xa(w,E,D,I,b)}l=l.sibling}}function or(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var d=a,p=l,b=p.flags;switch(p.tag){case 22:or(d,p),b&2048&&rh(p.alternate,p);break;case 24:or(d,p),b&2048&&ch(p.alternate,p);break;default:or(d,p)}l=l.sibling}}var rr=8192;function Ja(a,l,d){if(a.subtreeFlags&rr)for(a=a.child;a!==null;)wy(a,l,d),a=a.sibling}function wy(a,l,d){switch(a.tag){case 26:Ja(a,l,d),a.flags&rr&&a.memoizedState!==null&&hR(d,es,a.memoizedState,a.memoizedProps);break;case 5:Ja(a,l,d);break;case 3:case 4:var p=es;es=Jc(a.stateNode.containerInfo),Ja(a,l,d),es=p;break;case 22:a.memoizedState===null&&(p=a.alternate,p!==null&&p.memoizedState!==null?(p=rr,rr=16777216,Ja(a,l,d),rr=p):Ja(a,l,d));break;default:Ja(a,l,d)}}function Cy(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function cr(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var d=0;d<l.length;d++){var p=l[d];Wt=p,My(p,a)}Cy(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Sy(a),a=a.sibling}function Sy(a){switch(a.tag){case 0:case 11:case 15:cr(a),a.flags&2048&&bi(9,a,a.return);break;case 3:cr(a);break;case 12:cr(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,Hc(a)):cr(a);break;default:cr(a)}}function Hc(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var d=0;d<l.length;d++){var p=l[d];Wt=p,My(p,a)}Cy(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:bi(8,l,l.return),Hc(l);break;case 22:d=l.stateNode,d._visibility&2&&(d._visibility&=-3,Hc(l));break;default:Hc(l)}a=a.sibling}}function My(a,l){for(;Wt!==null;){var d=Wt;switch(d.tag){case 0:case 11:case 15:bi(8,d,l);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var p=d.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Vo(d.memoizedState.cache)}if(p=d.child,p!==null)p.return=d,Wt=p;else e:for(d=a;Wt!==null;){p=Wt;var b=p.sibling,w=p.return;if(py(p),p===d){Wt=null;break e}if(b!==null){b.return=w,Wt=b;break e}Wt=w}}}var k1={getCacheForType:function(a){var l=tn(It),d=l.data.get(a);return d===void 0&&(d=a(),l.data.set(a,d)),d},cacheSignal:function(){return tn(It).controller.signal}},T1=typeof WeakMap=="function"?WeakMap:Map,st=0,pt=null,Ve=null,Qe=0,rt=0,kn=null,xi=!1,Za=!1,lh=!1,Ws=0,Et=0,wi=0,la=0,uh=0,Tn=0,eo=0,lr=null,vn=null,dh=!1,qc=0,Ry=0,$c=1/0,Bc=null,Ci=null,Ut=0,Si=null,to=null,Xs=0,hh=0,fh=null,Ey=null,ur=0,ph=null;function An(){return(st&2)!==0&&Qe!==0?Qe&-Qe:L.T!==null?xh():un()}function ky(){if(Tn===0)if((Qe&536870912)===0||Xe){var a=Vi;Vi<<=1,(Vi&3932160)===0&&(Vi=262144),Tn=a}else Tn=536870912;return a=Rn.current,a!==null&&(a.flags|=32),Tn}function bn(a,l,d){(a===pt&&(rt===2||rt===9)||a.cancelPendingCommit!==null)&&(no(a,0),Mi(a,Qe,Tn,!1)),be(a,d),((st&2)===0||a!==pt)&&(a===pt&&((st&2)===0&&(la|=d),Et===4&&Mi(a,Qe,Tn,!1)),ys(a))}function Ty(a,l,d){if((st&6)!==0)throw Error(n(327));var p=!d&&(l&127)===0&&(l&a.expiredLanes)===0||js(a,l),b=p?_1(a,l):mh(a,l,!0),w=p;do{if(b===0){Za&&!p&&Mi(a,l,0,!1);break}else{if(d=a.current.alternate,w&&!A1(d)){b=mh(a,l,!1),w=!1;continue}if(b===2){if(w=l,a.errorRecoveryDisabledLanes&w)var E=0;else E=a.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){l=E;e:{var D=a;b=lr;var I=D.current.memoizedState.isDehydrated;if(I&&(no(D,E).flags|=256),E=mh(D,E,!1),E!==2){if(lh&&!I){D.errorRecoveryDisabledLanes|=w,la|=w,b=4;break e}w=vn,vn=b,w!==null&&(vn===null?vn=w:vn.push.apply(vn,w))}b=E}if(w=!1,b!==2)continue}}if(b===1){no(a,0),Mi(a,l,0,!0);break}e:{switch(p=a,w=b,w){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Mi(p,l,Tn,!xi);break e;case 2:vn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(b=qc+300-Ze(),10<b)){if(Mi(p,l,Tn,!xi),Ns(p,0,!0)!==0)break e;Xs=l,p.timeoutHandle=a0(Ay.bind(null,p,d,vn,Bc,dh,l,Tn,la,eo,xi,w,"Throttled",-0,0),b);break e}Ay(p,d,vn,Bc,dh,l,Tn,la,eo,xi,w,null,-0,0)}}break}while(!0);ys(a)}function Ay(a,l,d,p,b,w,E,D,I,G,ne,re,K,X){if(a.timeoutHandle=-1,re=l.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zs},wy(l,w,re);var xe=(w&62914560)===w?qc-Ze():(w&4194048)===w?Ry-Ze():0;if(xe=fR(re,xe),xe!==null){Xs=w,a.cancelPendingCommit=xe(Iy.bind(null,a,l,w,d,p,b,E,D,I,ne,re,null,K,X)),Mi(a,w,E,!G);return}}Iy(a,l,w,d,p,b,E,D,I)}function A1(a){for(var l=a;;){var d=l.tag;if((d===0||d===11||d===15)&&l.flags&16384&&(d=l.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var p=0;p<d.length;p++){var b=d[p],w=b.getSnapshot;b=b.value;try{if(!Sn(w(),b))return!1}catch{return!1}}if(d=l.child,l.subtreeFlags&16384&&d!==null)d.return=l,l=d;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Mi(a,l,d,p){l&=~uh,l&=~la,a.suspendedLanes|=l,a.pingedLanes&=~l,p&&(a.warmLanes|=l),p=a.expirationTimes;for(var b=l;0<b;){var w=31-Lt(b),E=1<<w;p[w]=-1,b&=~E}d!==0&&Ie(a,d,l)}function Uc(){return(st&6)===0?(dr(0),!1):!0}function gh(){if(Ve!==null){if(rt===0)var a=Ve.return;else a=Ve,qs=ea=null,_d(a),Ga=null,Qo=0,a=Ve;for(;a!==null;)oy(a.alternate,a),a=a.return;Ve=null}}function no(a,l){var d=a.timeoutHandle;d!==-1&&(a.timeoutHandle=-1,Y1(d)),d=a.cancelPendingCommit,d!==null&&(a.cancelPendingCommit=null,d()),Xs=0,gh(),pt=a,Ve=d=Os(a.current,null),Qe=l,rt=0,kn=null,xi=!1,Za=js(a,l),lh=!1,eo=Tn=uh=la=wi=Et=0,vn=lr=null,dh=!1,(l&8)!==0&&(l|=l&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=l;0<p;){var b=31-Lt(p),w=1<<b;l|=a[b],p&=~w}return Ws=l,uc(),d}function Dy(a,l){Oe=null,L.H=tr,l===Va||l===vc?(l=Gg(),rt=3):l===bd?(l=Gg(),rt=4):rt=l===Qd?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,kn=l,Ve===null&&(Et=1,Pc(a,On(l,a.current)))}function _y(){var a=Rn.current;return a===null?!0:(Qe&4194048)===Qe?Bn===null:(Qe&62914560)===Qe||(Qe&536870912)!==0?a===Bn:!1}function Py(){var a=L.H;return L.H=tr,a===null?tr:a}function Ny(){var a=L.A;return L.A=k1,a}function Fc(){Et=4,xi||(Qe&4194048)!==Qe&&Rn.current!==null||(Za=!0),(wi&134217727)===0&&(la&134217727)===0||pt===null||Mi(pt,Qe,Tn,!1)}function mh(a,l,d){var p=st;st|=2;var b=Py(),w=Ny();(pt!==a||Qe!==l)&&(Bc=null,no(a,l)),l=!1;var E=Et;e:do try{if(rt!==0&&Ve!==null){var D=Ve,I=kn;switch(rt){case 8:gh(),E=6;break e;case 3:case 2:case 9:case 6:Rn.current===null&&(l=!0);var G=rt;if(rt=0,kn=null,so(a,D,I,G),d&&Za){E=0;break e}break;default:G=rt,rt=0,kn=null,so(a,D,I,G)}}D1(),E=Et;break}catch(ne){Dy(a,ne)}while(!0);return l&&a.shellSuspendCounter++,qs=ea=null,st=p,L.H=b,L.A=w,Ve===null&&(pt=null,Qe=0,uc()),E}function D1(){for(;Ve!==null;)jy(Ve)}function _1(a,l){var d=st;st|=2;var p=Py(),b=Ny();pt!==a||Qe!==l?(Bc=null,$c=Ze()+500,no(a,l)):Za=js(a,l);e:do try{if(rt!==0&&Ve!==null){l=Ve;var w=kn;t:switch(rt){case 1:rt=0,kn=null,so(a,l,w,1);break;case 2:case 9:if(Fg(w)){rt=0,kn=null,Ly(l);break}l=function(){rt!==2&&rt!==9||pt!==a||(rt=7),ys(a)},w.then(l,l);break e;case 3:rt=7;break e;case 4:rt=5;break e;case 7:Fg(w)?(rt=0,kn=null,Ly(l)):(rt=0,kn=null,so(a,l,w,7));break;case 5:var E=null;switch(Ve.tag){case 26:E=Ve.memoizedState;case 5:case 27:var D=Ve;if(E?x0(E):D.stateNode.complete){rt=0,kn=null;var I=D.sibling;if(I!==null)Ve=I;else{var G=D.return;G!==null?(Ve=G,Vc(G)):Ve=null}break t}}rt=0,kn=null,so(a,l,w,5);break;case 6:rt=0,kn=null,so(a,l,w,6);break;case 8:gh(),Et=6;break e;default:throw Error(n(462))}}P1();break}catch(ne){Dy(a,ne)}while(!0);return qs=ea=null,L.H=p,L.A=b,st=d,Ve!==null?0:(pt=null,Qe=0,uc(),Et)}function P1(){for(;Ve!==null&&!mt();)jy(Ve)}function jy(a){var l=iy(a.alternate,a,Ws);a.memoizedProps=a.pendingProps,l===null?Vc(a):Ve=l}function Ly(a){var l=a,d=l.alternate;switch(l.tag){case 15:case 0:l=Jm(d,l,l.pendingProps,l.type,void 0,Qe);break;case 11:l=Jm(d,l,l.pendingProps,l.type.render,l.ref,Qe);break;case 5:_d(l);default:oy(d,l),l=Ve=Ng(l,Ws),l=iy(d,l,Ws)}a.memoizedProps=a.pendingProps,l===null?Vc(a):Ve=l}function so(a,l,d,p){qs=ea=null,_d(l),Ga=null,Qo=0;var b=l.return;try{if(x1(a,b,l,d,Qe)){Et=1,Pc(a,On(d,a.current)),Ve=null;return}}catch(w){if(b!==null)throw Ve=b,w;Et=1,Pc(a,On(d,a.current)),Ve=null;return}l.flags&32768?(Xe||p===1?a=!0:Za||(Qe&536870912)!==0?a=!1:(xi=a=!0,(p===2||p===9||p===3||p===6)&&(p=Rn.current,p!==null&&p.tag===13&&(p.flags|=16384))),zy(l,a)):Vc(l)}function Vc(a){var l=a;do{if((l.flags&32768)!==0){zy(l,xi);return}a=l.return;var d=S1(l.alternate,l,Ws);if(d!==null){Ve=d;return}if(l=l.sibling,l!==null){Ve=l;return}Ve=l=a}while(l!==null);Et===0&&(Et=5)}function zy(a,l){do{var d=M1(a.alternate,a);if(d!==null){d.flags&=32767,Ve=d;return}if(d=a.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!l&&(a=a.sibling,a!==null)){Ve=a;return}Ve=a=d}while(a!==null);Et=6,Ve=null}function Iy(a,l,d,p,b,w,E,D,I){a.cancelPendingCommit=null;do Gc();while(Ut!==0);if((st&6)!==0)throw Error(n(327));if(l!==null){if(l===a.current)throw Error(n(177));if(w=l.lanes|l.childLanes,w|=id,Le(a,d,w,E,D,I),a===pt&&(Ve=pt=null,Qe=0),to=l,Si=a,Xs=d,hh=w,fh=b,Ey=p,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,z1(Xt,function(){return By(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||p){p=L.T,L.T=null,b=N.p,N.p=2,E=st,st|=4;try{R1(a,l,d)}finally{st=E,N.p=b,L.T=p}}Ut=1,Oy(),Hy(),qy()}}function Oy(){if(Ut===1){Ut=0;var a=Si,l=to,d=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||d){d=L.T,L.T=null;var p=N.p;N.p=2;var b=st;st|=4;try{vy(l,a);var w=Th,E=Mg(a.containerInfo),D=w.focusedElem,I=w.selectionRange;if(E!==D&&D&&D.ownerDocument&&Sg(D.ownerDocument.documentElement,D)){if(I!==null&&Zu(D)){var G=I.start,ne=I.end;if(ne===void 0&&(ne=G),"selectionStart"in D)D.selectionStart=G,D.selectionEnd=Math.min(ne,D.value.length);else{var re=D.ownerDocument||document,K=re&&re.defaultView||window;if(K.getSelection){var X=K.getSelection(),xe=D.textContent.length,Pe=Math.min(I.start,xe),ht=I.end===void 0?Pe:Math.min(I.end,xe);!X.extend&&Pe>ht&&(E=ht,ht=Pe,Pe=E);var $=Cg(D,Pe),H=Cg(D,ht);if($&&H&&(X.rangeCount!==1||X.anchorNode!==$.node||X.anchorOffset!==$.offset||X.focusNode!==H.node||X.focusOffset!==H.offset)){var V=re.createRange();V.setStart($.node,$.offset),X.removeAllRanges(),Pe>ht?(X.addRange(V),X.extend(H.node,H.offset)):(V.setEnd(H.node,H.offset),X.addRange(V))}}}}for(re=[],X=D;X=X.parentNode;)X.nodeType===1&&re.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<re.length;D++){var oe=re[D];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}il=!!kh,Th=kh=null}finally{st=b,N.p=p,L.T=d}}a.current=l,Ut=2}}function Hy(){if(Ut===2){Ut=0;var a=Si,l=to,d=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||d){d=L.T,L.T=null;var p=N.p;N.p=2;var b=st;st|=4;try{fy(a,l.alternate,l)}finally{st=b,N.p=p,L.T=d}}Ut=3}}function qy(){if(Ut===4||Ut===3){Ut=0,$t();var a=Si,l=to,d=Xs,p=Ey;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Ut=5:(Ut=0,to=Si=null,$y(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(Ci=null),At(d),l=l.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(hs,l,void 0,(l.current.flags&128)===128)}catch{}if(p!==null){l=L.T,b=N.p,N.p=2,L.T=null;try{for(var w=a.onRecoverableError,E=0;E<p.length;E++){var D=p[E];w(D.value,{componentStack:D.stack})}}finally{L.T=l,N.p=b}}(Xs&3)!==0&&Gc(),ys(a),b=a.pendingLanes,(d&261930)!==0&&(b&42)!==0?a===ph?ur++:(ur=0,ph=a):ur=0,dr(0)}}function $y(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,Vo(l)))}function Gc(){return Oy(),Hy(),qy(),By()}function By(){if(Ut!==5)return!1;var a=Si,l=hh;hh=0;var d=At(Xs),p=L.T,b=N.p;try{N.p=32>d?32:d,L.T=null,d=fh,fh=null;var w=Si,E=Xs;if(Ut=0,to=Si=null,Xs=0,(st&6)!==0)throw Error(n(331));var D=st;if(st|=4,Sy(w.current),xy(w,w.current,E,d),st=D,dr(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(hs,w)}catch{}return!0}finally{N.p=b,L.T=p,$y(a,l)}}function Uy(a,l,d){l=On(d,l),l=Gd(a.stateNode,l,2),a=mi(a,l,2),a!==null&&(be(a,2),ys(a))}function ct(a,l,d){if(a.tag===3)Uy(a,a,d);else for(;l!==null;){if(l.tag===3){Uy(l,a,d);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Ci===null||!Ci.has(p))){a=On(d,a),d=Fm(2),p=mi(l,d,2),p!==null&&(Vm(d,p,l,a),be(p,2),ys(p));break}}l=l.return}}function yh(a,l,d){var p=a.pingCache;if(p===null){p=a.pingCache=new T1;var b=new Set;p.set(l,b)}else b=p.get(l),b===void 0&&(b=new Set,p.set(l,b));b.has(d)||(lh=!0,b.add(d),a=N1.bind(null,a,l,d),l.then(a,a))}function N1(a,l,d){var p=a.pingCache;p!==null&&p.delete(l),a.pingedLanes|=a.suspendedLanes&d,a.warmLanes&=~d,pt===a&&(Qe&d)===d&&(Et===4||Et===3&&(Qe&62914560)===Qe&&300>Ze()-qc?(st&2)===0&&no(a,0):uh|=d,eo===Qe&&(eo=0)),ys(a)}function Fy(a,l){l===0&&(l=ee()),a=Xi(a,l),a!==null&&(be(a,l),ys(a))}function j1(a){var l=a.memoizedState,d=0;l!==null&&(d=l.retryLane),Fy(a,d)}function L1(a,l){var d=0;switch(a.tag){case 31:case 13:var p=a.stateNode,b=a.memoizedState;b!==null&&(d=b.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(n(314))}p!==null&&p.delete(l),Fy(a,d)}function z1(a,l){return Ue(a,l)}var Qc=null,io=null,vh=!1,Kc=!1,bh=!1,Ri=0;function ys(a){a!==io&&a.next===null&&(io===null?Qc=io=a:io=io.next=a),Kc=!0,vh||(vh=!0,O1())}function dr(a,l){if(!bh&&Kc){bh=!0;do for(var d=!1,p=Qc;p!==null;){if(a!==0){var b=p.pendingLanes;if(b===0)var w=0;else{var E=p.suspendedLanes,D=p.pingedLanes;w=(1<<31-Lt(42|a)+1)-1,w&=b&~(E&~D),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(d=!0,Ky(p,w))}else w=Qe,w=Ns(p,p===pt?w:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(w&3)===0||js(p,w)||(d=!0,Ky(p,w));p=p.next}while(d);bh=!1}}function I1(){Vy()}function Vy(){Kc=vh=!1;var a=0;Ri!==0&&K1()&&(a=Ri);for(var l=Ze(),d=null,p=Qc;p!==null;){var b=p.next,w=Gy(p,l);w===0?(p.next=null,d===null?Qc=b:d.next=b,b===null&&(io=d)):(d=p,(a!==0||(w&3)!==0)&&(Kc=!0)),p=b}Ut!==0&&Ut!==5||dr(a),Ri!==0&&(Ri=0)}function Gy(a,l){for(var d=a.suspendedLanes,p=a.pingedLanes,b=a.expirationTimes,w=a.pendingLanes&-62914561;0<w;){var E=31-Lt(w),D=1<<E,I=b[E];I===-1?((D&d)===0||(D&p)!==0)&&(b[E]=Lu(D,l)):I<=l&&(a.expiredLanes|=D),w&=~D}if(l=pt,d=Qe,d=Ns(a,a===l?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,d===0||a===l&&(rt===2||rt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&bt(p),a.callbackNode=null,a.callbackPriority=0;if((d&3)===0||js(a,d)){if(l=d&-d,l===a.callbackPriority)return l;switch(p!==null&&bt(p),At(d)){case 2:case 8:d=yt;break;case 32:d=Xt;break;case 268435456:d=_s;break;default:d=Xt}return p=Qy.bind(null,a),d=Ue(d,p),a.callbackPriority=l,a.callbackNode=d,l}return p!==null&&p!==null&&bt(p),a.callbackPriority=2,a.callbackNode=null,2}function Qy(a,l){if(Ut!==0&&Ut!==5)return a.callbackNode=null,a.callbackPriority=0,null;var d=a.callbackNode;if(Gc()&&a.callbackNode!==d)return null;var p=Qe;return p=Ns(a,a===pt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(Ty(a,p,l),Gy(a,Ze()),a.callbackNode!=null&&a.callbackNode===d?Qy.bind(null,a):null)}function Ky(a,l){if(Gc())return null;Ty(a,l,!0)}function O1(){W1(function(){(st&6)!==0?Ue(xt,I1):Vy()})}function xh(){if(Ri===0){var a=Ua;a===0&&(a=Ps,Ps<<=1,(Ps&261888)===0&&(Ps=256)),Ri=a}return Ri}function Yy(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:nc(""+a)}function Wy(a,l){var d=l.ownerDocument.createElement("input");return d.name=l.name,d.value=l.value,a.id&&d.setAttribute("form",a.id),l.parentNode.insertBefore(d,l),a=new FormData(a),d.parentNode.removeChild(d),a}function H1(a,l,d,p,b){if(l==="submit"&&d&&d.stateNode===b){var w=Yy((b[Bt]||null).action),E=p.submitter;E&&(l=(l=E[Bt]||null)?Yy(l.formAction):E.getAttribute("formAction"),l!==null&&(w=l,E=null));var D=new oc("action","action",null,p,b);a.push({event:D,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ri!==0){var I=E?Wy(b,E):new FormData(b);qd(d,{pending:!0,data:I,method:b.method,action:w},null,I)}}else typeof w=="function"&&(D.preventDefault(),I=E?Wy(b,E):new FormData(b),qd(d,{pending:!0,data:I,method:b.method,action:w},w,I))},currentTarget:b}]})}}for(var wh=0;wh<sd.length;wh++){var Ch=sd[wh],q1=Ch.toLowerCase(),$1=Ch[0].toUpperCase()+Ch.slice(1);Zn(q1,"on"+$1)}Zn(kg,"onAnimationEnd"),Zn(Tg,"onAnimationIteration"),Zn(Ag,"onAnimationStart"),Zn("dblclick","onDoubleClick"),Zn("focusin","onFocus"),Zn("focusout","onBlur"),Zn(s1,"onTransitionRun"),Zn(i1,"onTransitionStart"),Zn(a1,"onTransitionCancel"),Zn(Dg,"onTransitionEnd"),Aa("onMouseEnter",["mouseout","mouseover"]),Aa("onMouseLeave",["mouseout","mouseover"]),Aa("onPointerEnter",["pointerout","pointerover"]),Aa("onPointerLeave",["pointerout","pointerover"]),Qi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),B1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hr));function Xy(a,l){l=(l&4)!==0;for(var d=0;d<a.length;d++){var p=a[d],b=p.event;p=p.listeners;e:{var w=void 0;if(l)for(var E=p.length-1;0<=E;E--){var D=p[E],I=D.instance,G=D.currentTarget;if(D=D.listener,I!==w&&b.isPropagationStopped())break e;w=D,b.currentTarget=G;try{w(b)}catch(ne){lc(ne)}b.currentTarget=null,w=I}else for(E=0;E<p.length;E++){if(D=p[E],I=D.instance,G=D.currentTarget,D=D.listener,I!==w&&b.isPropagationStopped())break e;w=D,b.currentTarget=G;try{w(b)}catch(ne){lc(ne)}b.currentTarget=null,w=I}}}}function Ge(a,l){var d=l[Fe];d===void 0&&(d=l[Fe]=new Set);var p=a+"__bubble";d.has(p)||(Jy(l,a,2,!1),d.add(p))}function Sh(a,l,d){var p=0;l&&(p|=4),Jy(d,a,p,l)}var Yc="_reactListening"+Math.random().toString(36).slice(2);function Mh(a){if(!a[Yc]){a[Yc]=!0,Vp.forEach(function(d){d!=="selectionchange"&&(B1.has(d)||Sh(d,!1,a),Sh(d,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[Yc]||(l[Yc]=!0,Sh("selectionchange",!1,l))}}function Jy(a,l,d,p){switch(k0(l)){case 2:var b=mR;break;case 8:b=yR;break;default:b=Hh}d=b.bind(null,l,d,a),b=void 0,!Fu||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(b=!0),p?b!==void 0?a.addEventListener(l,d,{capture:!0,passive:b}):a.addEventListener(l,d,!0):b!==void 0?a.addEventListener(l,d,{passive:b}):a.addEventListener(l,d,!1)}function Rh(a,l,d,p,b){var w=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var E=p.tag;if(E===3||E===4){var D=p.stateNode.containerInfo;if(D===b)break;if(E===4)for(E=p.return;E!==null;){var I=E.tag;if((I===3||I===4)&&E.stateNode.containerInfo===b)return;E=E.return}for(;D!==null;){if(E=Ea(D),E===null)return;if(I=E.tag,I===5||I===6||I===26||I===27){p=w=E;continue e}D=D.parentNode}}p=p.return}sg(function(){var G=w,ne=Bu(d),re=[];e:{var K=_g.get(a);if(K!==void 0){var X=oc,xe=a;switch(a){case"keypress":if(ic(d)===0)break e;case"keydown":case"keyup":X=LM;break;case"focusin":xe="focus",X=Ku;break;case"focusout":xe="blur",X=Ku;break;case"beforeblur":case"afterblur":X=Ku;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=og;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=SM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=OM;break;case kg:case Tg:case Ag:X=EM;break;case Dg:X=qM;break;case"scroll":case"scrollend":X=wM;break;case"wheel":X=BM;break;case"copy":case"cut":case"paste":X=TM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=cg;break;case"toggle":case"beforetoggle":X=FM}var Pe=(l&4)!==0,ht=!Pe&&(a==="scroll"||a==="scrollend"),$=Pe?K!==null?K+"Capture":null:K;Pe=[];for(var H=G,V;H!==null;){var oe=H;if(V=oe.stateNode,oe=oe.tag,oe!==5&&oe!==26&&oe!==27||V===null||$===null||(oe=jo(H,$),oe!=null&&Pe.push(fr(H,oe,V))),ht)break;H=H.return}0<Pe.length&&(K=new X(K,xe,null,d,ne),re.push({event:K,listeners:Pe}))}}if((l&7)===0){e:{if(K=a==="mouseover"||a==="pointerover",X=a==="mouseout"||a==="pointerout",K&&d!==$u&&(xe=d.relatedTarget||d.fromElement)&&(Ea(xe)||xe[fs]))break e;if((X||K)&&(K=ne.window===ne?ne:(K=ne.ownerDocument)?K.defaultView||K.parentWindow:window,X?(xe=d.relatedTarget||d.toElement,X=G,xe=xe?Ea(xe):null,xe!==null&&(ht=i(xe),Pe=xe.tag,xe!==ht||Pe!==5&&Pe!==27&&Pe!==6)&&(xe=null)):(X=null,xe=G),X!==xe)){if(Pe=og,oe="onMouseLeave",$="onMouseEnter",H="mouse",(a==="pointerout"||a==="pointerover")&&(Pe=cg,oe="onPointerLeave",$="onPointerEnter",H="pointer"),ht=X==null?K:No(X),V=xe==null?K:No(xe),K=new Pe(oe,H+"leave",X,d,ne),K.target=ht,K.relatedTarget=V,oe=null,Ea(ne)===G&&(Pe=new Pe($,H+"enter",xe,d,ne),Pe.target=V,Pe.relatedTarget=ht,oe=Pe),ht=oe,X&&xe)t:{for(Pe=U1,$=X,H=xe,V=0,oe=$;oe;oe=Pe(oe))V++;oe=0;for(var Ae=H;Ae;Ae=Pe(Ae))oe++;for(;0<V-oe;)$=Pe($),V--;for(;0<oe-V;)H=Pe(H),oe--;for(;V--;){if($===H||H!==null&&$===H.alternate){Pe=$;break t}$=Pe($),H=Pe(H)}Pe=null}else Pe=null;X!==null&&Zy(re,K,X,Pe,!1),xe!==null&&ht!==null&&Zy(re,ht,xe,Pe,!0)}}e:{if(K=G?No(G):window,X=K.nodeName&&K.nodeName.toLowerCase(),X==="select"||X==="input"&&K.type==="file")var et=mg;else if(pg(K))if(yg)et=e1;else{et=JM;var Me=XM}else X=K.nodeName,!X||X.toLowerCase()!=="input"||K.type!=="checkbox"&&K.type!=="radio"?G&&qu(G.elementType)&&(et=mg):et=ZM;if(et&&(et=et(a,G))){gg(re,et,d,ne);break e}Me&&Me(a,K,G),a==="focusout"&&G&&K.type==="number"&&G.memoizedProps.value!=null&&Hu(K,"number",K.value)}switch(Me=G?No(G):window,a){case"focusin":(pg(Me)||Me.contentEditable==="true")&&(La=Me,ed=G,Bo=null);break;case"focusout":Bo=ed=La=null;break;case"mousedown":td=!0;break;case"contextmenu":case"mouseup":case"dragend":td=!1,Rg(re,d,ne);break;case"selectionchange":if(n1)break;case"keydown":case"keyup":Rg(re,d,ne)}var He;if(Wu)e:{switch(a){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else ja?hg(a,d)&&(Ke="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(Ke="onCompositionStart");Ke&&(lg&&d.locale!=="ko"&&(ja||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&ja&&(He=ig()):(li=ne,Vu="value"in li?li.value:li.textContent,ja=!0)),Me=Wc(G,Ke),0<Me.length&&(Ke=new rg(Ke,a,null,d,ne),re.push({event:Ke,listeners:Me}),He?Ke.data=He:(He=fg(d),He!==null&&(Ke.data=He)))),(He=GM?QM(a,d):KM(a,d))&&(Ke=Wc(G,"onBeforeInput"),0<Ke.length&&(Me=new rg("onBeforeInput","beforeinput",null,d,ne),re.push({event:Me,listeners:Ke}),Me.data=He)),H1(re,a,G,d,ne)}Xy(re,l)})}function fr(a,l,d){return{instance:a,listener:l,currentTarget:d}}function Wc(a,l){for(var d=l+"Capture",p=[];a!==null;){var b=a,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=jo(a,d),b!=null&&p.unshift(fr(a,b,w)),b=jo(a,l),b!=null&&p.push(fr(a,b,w))),a.tag===3)return p;a=a.return}return[]}function U1(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Zy(a,l,d,p,b){for(var w=l._reactName,E=[];d!==null&&d!==p;){var D=d,I=D.alternate,G=D.stateNode;if(D=D.tag,I!==null&&I===p)break;D!==5&&D!==26&&D!==27||G===null||(I=G,b?(G=jo(d,w),G!=null&&E.unshift(fr(d,G,I))):b||(G=jo(d,w),G!=null&&E.push(fr(d,G,I)))),d=d.return}E.length!==0&&a.push({event:l,listeners:E})}var F1=/\r\n?/g,V1=/\u0000|\uFFFD/g;function e0(a){return(typeof a=="string"?a:""+a).replace(F1,`
`).replace(V1,"")}function t0(a,l){return l=e0(l),e0(a)===l}function dt(a,l,d,p,b,w){switch(d){case"children":typeof p=="string"?l==="body"||l==="textarea"&&p===""||_a(a,p):(typeof p=="number"||typeof p=="bigint")&&l!=="body"&&_a(a,""+p);break;case"className":ec(a,"class",p);break;case"tabIndex":ec(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":ec(a,d,p);break;case"style":tg(a,p,w);break;case"data":if(l!=="object"){ec(a,"data",p);break}case"src":case"href":if(p===""&&(l!=="a"||d!=="href")){a.removeAttribute(d);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(d);break}p=nc(""+p),a.setAttribute(d,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(d==="formAction"?(l!=="input"&&dt(a,l,"name",b.name,b,null),dt(a,l,"formEncType",b.formEncType,b,null),dt(a,l,"formMethod",b.formMethod,b,null),dt(a,l,"formTarget",b.formTarget,b,null)):(dt(a,l,"encType",b.encType,b,null),dt(a,l,"method",b.method,b,null),dt(a,l,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(d);break}p=nc(""+p),a.setAttribute(d,p);break;case"onClick":p!=null&&(a.onclick=zs);break;case"onScroll":p!=null&&Ge("scroll",a);break;case"onScrollEnd":p!=null&&Ge("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(d=p.__html,d!=null){if(b.children!=null)throw Error(n(60));a.innerHTML=d}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}d=nc(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(d,""+p):a.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(d,""):a.removeAttribute(d);break;case"capture":case"download":p===!0?a.setAttribute(d,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(d,p):a.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(d,p):a.removeAttribute(d);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(d):a.setAttribute(d,p);break;case"popover":Ge("beforetoggle",a),Ge("toggle",a),Zr(a,"popover",p);break;case"xlinkActuate":Ls(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Ls(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Ls(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Ls(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Ls(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Ls(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Ls(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Ls(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Ls(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Zr(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=bM.get(d)||d,Zr(a,d,p))}}function Eh(a,l,d,p,b,w){switch(d){case"style":tg(a,p,w);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(d=p.__html,d!=null){if(b.children!=null)throw Error(n(60));a.innerHTML=d}}break;case"children":typeof p=="string"?_a(a,p):(typeof p=="number"||typeof p=="bigint")&&_a(a,""+p);break;case"onScroll":p!=null&&Ge("scroll",a);break;case"onScrollEnd":p!=null&&Ge("scrollend",a);break;case"onClick":p!=null&&(a.onclick=zs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Gp.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(b=d.endsWith("Capture"),l=d.slice(2,b?d.length-7:void 0),w=a[Bt]||null,w=w!=null?w[d]:null,typeof w=="function"&&a.removeEventListener(l,w,b),typeof p=="function")){typeof w!="function"&&w!==null&&(d in a?a[d]=null:a.hasAttribute(d)&&a.removeAttribute(d)),a.addEventListener(l,p,b);break e}d in a?a[d]=p:p===!0?a.setAttribute(d,""):Zr(a,d,p)}}}function sn(a,l,d){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ge("error",a),Ge("load",a);var p=!1,b=!1,w;for(w in d)if(d.hasOwnProperty(w)){var E=d[w];if(E!=null)switch(w){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:dt(a,l,w,E,d,null)}}b&&dt(a,l,"srcSet",d.srcSet,d,null),p&&dt(a,l,"src",d.src,d,null);return;case"input":Ge("invalid",a);var D=w=E=b=null,I=null,G=null;for(p in d)if(d.hasOwnProperty(p)){var ne=d[p];if(ne!=null)switch(p){case"name":b=ne;break;case"type":E=ne;break;case"checked":I=ne;break;case"defaultChecked":G=ne;break;case"value":w=ne;break;case"defaultValue":D=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(n(137,l));break;default:dt(a,l,p,ne,d,null)}}Xp(a,w,D,I,G,E,b,!1);return;case"select":Ge("invalid",a),p=E=w=null;for(b in d)if(d.hasOwnProperty(b)&&(D=d[b],D!=null))switch(b){case"value":w=D;break;case"defaultValue":E=D;break;case"multiple":p=D;default:dt(a,l,b,D,d,null)}l=w,d=E,a.multiple=!!p,l!=null?Da(a,!!p,l,!1):d!=null&&Da(a,!!p,d,!0);return;case"textarea":Ge("invalid",a),w=b=p=null;for(E in d)if(d.hasOwnProperty(E)&&(D=d[E],D!=null))switch(E){case"value":p=D;break;case"defaultValue":b=D;break;case"children":w=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(n(91));break;default:dt(a,l,E,D,d,null)}Zp(a,p,b,w);return;case"option":for(I in d)if(d.hasOwnProperty(I)&&(p=d[I],p!=null))switch(I){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:dt(a,l,I,p,d,null)}return;case"dialog":Ge("beforetoggle",a),Ge("toggle",a),Ge("cancel",a),Ge("close",a);break;case"iframe":case"object":Ge("load",a);break;case"video":case"audio":for(p=0;p<hr.length;p++)Ge(hr[p],a);break;case"image":Ge("error",a),Ge("load",a);break;case"details":Ge("toggle",a);break;case"embed":case"source":case"link":Ge("error",a),Ge("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(G in d)if(d.hasOwnProperty(G)&&(p=d[G],p!=null))switch(G){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:dt(a,l,G,p,d,null)}return;default:if(qu(l)){for(ne in d)d.hasOwnProperty(ne)&&(p=d[ne],p!==void 0&&Eh(a,l,ne,p,d,void 0));return}}for(D in d)d.hasOwnProperty(D)&&(p=d[D],p!=null&&dt(a,l,D,p,d,null))}function G1(a,l,d,p){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,E=null,D=null,I=null,G=null,ne=null;for(X in d){var re=d[X];if(d.hasOwnProperty(X)&&re!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":I=re;default:p.hasOwnProperty(X)||dt(a,l,X,null,p,re)}}for(var K in p){var X=p[K];if(re=d[K],p.hasOwnProperty(K)&&(X!=null||re!=null))switch(K){case"type":w=X;break;case"name":b=X;break;case"checked":G=X;break;case"defaultChecked":ne=X;break;case"value":E=X;break;case"defaultValue":D=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(n(137,l));break;default:X!==re&&dt(a,l,K,X,p,re)}}Ou(a,E,D,I,G,ne,w,b);return;case"select":X=E=D=K=null;for(w in d)if(I=d[w],d.hasOwnProperty(w)&&I!=null)switch(w){case"value":break;case"multiple":X=I;default:p.hasOwnProperty(w)||dt(a,l,w,null,p,I)}for(b in p)if(w=p[b],I=d[b],p.hasOwnProperty(b)&&(w!=null||I!=null))switch(b){case"value":K=w;break;case"defaultValue":D=w;break;case"multiple":E=w;default:w!==I&&dt(a,l,b,w,p,I)}l=D,d=E,p=X,K!=null?Da(a,!!d,K,!1):!!p!=!!d&&(l!=null?Da(a,!!d,l,!0):Da(a,!!d,d?[]:"",!1));return;case"textarea":X=K=null;for(D in d)if(b=d[D],d.hasOwnProperty(D)&&b!=null&&!p.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:dt(a,l,D,null,p,b)}for(E in p)if(b=p[E],w=d[E],p.hasOwnProperty(E)&&(b!=null||w!=null))switch(E){case"value":K=b;break;case"defaultValue":X=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==w&&dt(a,l,E,b,p,w)}Jp(a,K,X);return;case"option":for(var xe in d)if(K=d[xe],d.hasOwnProperty(xe)&&K!=null&&!p.hasOwnProperty(xe))switch(xe){case"selected":a.selected=!1;break;default:dt(a,l,xe,null,p,K)}for(I in p)if(K=p[I],X=d[I],p.hasOwnProperty(I)&&K!==X&&(K!=null||X!=null))switch(I){case"selected":a.selected=K&&typeof K!="function"&&typeof K!="symbol";break;default:dt(a,l,I,K,p,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pe in d)K=d[Pe],d.hasOwnProperty(Pe)&&K!=null&&!p.hasOwnProperty(Pe)&&dt(a,l,Pe,null,p,K);for(G in p)if(K=p[G],X=d[G],p.hasOwnProperty(G)&&K!==X&&(K!=null||X!=null))switch(G){case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(n(137,l));break;default:dt(a,l,G,K,p,X)}return;default:if(qu(l)){for(var ht in d)K=d[ht],d.hasOwnProperty(ht)&&K!==void 0&&!p.hasOwnProperty(ht)&&Eh(a,l,ht,void 0,p,K);for(ne in p)K=p[ne],X=d[ne],!p.hasOwnProperty(ne)||K===X||K===void 0&&X===void 0||Eh(a,l,ne,K,p,X);return}}for(var $ in d)K=d[$],d.hasOwnProperty($)&&K!=null&&!p.hasOwnProperty($)&&dt(a,l,$,null,p,K);for(re in p)K=p[re],X=d[re],!p.hasOwnProperty(re)||K===X||K==null&&X==null||dt(a,l,re,K,p,X)}function n0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Q1(){if(typeof performance.getEntriesByType=="function"){for(var a=0,l=0,d=performance.getEntriesByType("resource"),p=0;p<d.length;p++){var b=d[p],w=b.transferSize,E=b.initiatorType,D=b.duration;if(w&&D&&n0(E)){for(E=0,D=b.responseEnd,p+=1;p<d.length;p++){var I=d[p],G=I.startTime;if(G>D)break;var ne=I.transferSize,re=I.initiatorType;ne&&n0(re)&&(I=I.responseEnd,E+=ne*(I<D?1:(D-G)/(I-G)))}if(--p,l+=8*(w+E)/(b.duration/1e3),a++,10<a)break}}if(0<a)return l/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var kh=null,Th=null;function Xc(a){return a.nodeType===9?a:a.ownerDocument}function s0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function i0(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function Ah(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Dh=null;function K1(){var a=window.event;return a&&a.type==="popstate"?a===Dh?!1:(Dh=a,!0):(Dh=null,!1)}var a0=typeof setTimeout=="function"?setTimeout:void 0,Y1=typeof clearTimeout=="function"?clearTimeout:void 0,o0=typeof Promise=="function"?Promise:void 0,W1=typeof queueMicrotask=="function"?queueMicrotask:typeof o0<"u"?function(a){return o0.resolve(null).then(a).catch(X1)}:a0;function X1(a){setTimeout(function(){throw a})}function Ei(a){return a==="head"}function r0(a,l){var d=l,p=0;do{var b=d.nextSibling;if(a.removeChild(d),b&&b.nodeType===8)if(d=b.data,d==="/$"||d==="/&"){if(p===0){a.removeChild(b),co(l);return}p--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")p++;else if(d==="html")pr(a.ownerDocument.documentElement);else if(d==="head"){d=a.ownerDocument.head,pr(d);for(var w=d.firstChild;w;){var E=w.nextSibling,D=w.nodeName;w[Po]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&w.rel.toLowerCase()==="stylesheet"||d.removeChild(w),w=E}}else d==="body"&&pr(a.ownerDocument.body);d=b}while(d);co(l)}function c0(a,l){var d=a;a=0;do{var p=d.nextSibling;if(d.nodeType===1?l?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(l?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),p&&p.nodeType===8)if(d=p.data,d==="/$"){if(a===0)break;a--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||a++;d=p}while(d)}function _h(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var d=l;switch(l=l.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":_h(d),zu(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}a.removeChild(d)}}function J1(a,l,d,p){for(;a.nodeType===1;){var b=d;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Po])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(w=a.getAttribute("rel"),w==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(w!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(w=a.getAttribute("src"),(w!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===w)return a}else return a;if(a=Un(a.nextSibling),a===null)break}return null}function Z1(a,l,d){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!d||(a=Un(a.nextSibling),a===null))return null;return a}function l0(a,l){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=Un(a.nextSibling),a===null))return null;return a}function Ph(a){return a.data==="$?"||a.data==="$~"}function Nh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function eR(a,l){var d=a.ownerDocument;if(a.data==="$~")a._reactRetry=l;else if(a.data!=="$?"||d.readyState!=="loading")l();else{var p=function(){l(),d.removeEventListener("DOMContentLoaded",p)};d.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function Un(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return a}var jh=null;function u0(a){a=a.nextSibling;for(var l=0;a;){if(a.nodeType===8){var d=a.data;if(d==="/$"||d==="/&"){if(l===0)return Un(a.nextSibling);l--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||l++}a=a.nextSibling}return null}function d0(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(l===0)return a;l--}else d!=="/$"&&d!=="/&"||l++}a=a.previousSibling}return null}function h0(a,l,d){switch(l=Xc(d),a){case"html":if(a=l.documentElement,!a)throw Error(n(452));return a;case"head":if(a=l.head,!a)throw Error(n(453));return a;case"body":if(a=l.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function pr(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);zu(a)}var Fn=new Map,f0=new Set;function Jc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Js=N.d;N.d={f:tR,r:nR,D:sR,C:iR,L:aR,m:oR,X:cR,S:rR,M:lR};function tR(){var a=Js.f(),l=Uc();return a||l}function nR(a){var l=ka(a);l!==null&&l.tag===5&&l.type==="form"?Dm(l):Js.r(a)}var ao=typeof document>"u"?null:document;function p0(a,l,d){var p=ao;if(p&&typeof l=="string"&&l){var b=zn(l);b='link[rel="'+a+'"][href="'+b+'"]',typeof d=="string"&&(b+='[crossorigin="'+d+'"]'),f0.has(b)||(f0.add(b),a={rel:a,crossOrigin:d,href:l},p.querySelector(b)===null&&(l=p.createElement("link"),sn(l,"link",a),Yt(l),p.head.appendChild(l)))}}function sR(a){Js.D(a),p0("dns-prefetch",a,null)}function iR(a,l){Js.C(a,l),p0("preconnect",a,l)}function aR(a,l,d){Js.L(a,l,d);var p=ao;if(p&&a&&l){var b='link[rel="preload"][as="'+zn(l)+'"]';l==="image"&&d&&d.imageSrcSet?(b+='[imagesrcset="'+zn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(b+='[imagesizes="'+zn(d.imageSizes)+'"]')):b+='[href="'+zn(a)+'"]';var w=b;switch(l){case"style":w=oo(a);break;case"script":w=ro(a)}Fn.has(w)||(a=m({rel:"preload",href:l==="image"&&d&&d.imageSrcSet?void 0:a,as:l},d),Fn.set(w,a),p.querySelector(b)!==null||l==="style"&&p.querySelector(gr(w))||l==="script"&&p.querySelector(mr(w))||(l=p.createElement("link"),sn(l,"link",a),Yt(l),p.head.appendChild(l)))}}function oR(a,l){Js.m(a,l);var d=ao;if(d&&a){var p=l&&typeof l.as=="string"?l.as:"script",b='link[rel="modulepreload"][as="'+zn(p)+'"][href="'+zn(a)+'"]',w=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=ro(a)}if(!Fn.has(w)&&(a=m({rel:"modulepreload",href:a},l),Fn.set(w,a),d.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(mr(w)))return}p=d.createElement("link"),sn(p,"link",a),Yt(p),d.head.appendChild(p)}}}function rR(a,l,d){Js.S(a,l,d);var p=ao;if(p&&a){var b=Ta(p).hoistableStyles,w=oo(a);l=l||"default";var E=b.get(w);if(!E){var D={loading:0,preload:null};if(E=p.querySelector(gr(w)))D.loading=5;else{a=m({rel:"stylesheet",href:a,"data-precedence":l},d),(d=Fn.get(w))&&Lh(a,d);var I=E=p.createElement("link");Yt(I),sn(I,"link",a),I._p=new Promise(function(G,ne){I.onload=G,I.onerror=ne}),I.addEventListener("load",function(){D.loading|=1}),I.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Zc(E,l,p)}E={type:"stylesheet",instance:E,count:1,state:D},b.set(w,E)}}}function cR(a,l){Js.X(a,l);var d=ao;if(d&&a){var p=Ta(d).hoistableScripts,b=ro(a),w=p.get(b);w||(w=d.querySelector(mr(b)),w||(a=m({src:a,async:!0},l),(l=Fn.get(b))&&zh(a,l),w=d.createElement("script"),Yt(w),sn(w,"link",a),d.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(b,w))}}function lR(a,l){Js.M(a,l);var d=ao;if(d&&a){var p=Ta(d).hoistableScripts,b=ro(a),w=p.get(b);w||(w=d.querySelector(mr(b)),w||(a=m({src:a,async:!0,type:"module"},l),(l=Fn.get(b))&&zh(a,l),w=d.createElement("script"),Yt(w),sn(w,"link",a),d.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(b,w))}}function g0(a,l,d,p){var b=(b=ae.current)?Jc(b):null;if(!b)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(l=oo(d.href),d=Ta(b).hoistableStyles,p=d.get(l),p||(p={type:"style",instance:null,count:0,state:null},d.set(l,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){a=oo(d.href);var w=Ta(b).hoistableStyles,E=w.get(a);if(E||(b=b.ownerDocument||b,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(a,E),(w=b.querySelector(gr(a)))&&!w._p&&(E.instance=w,E.state.loading=5),Fn.has(a)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Fn.set(a,d),w||uR(b,a,d,E.state))),l&&p===null)throw Error(n(528,""));return E}if(l&&p!==null)throw Error(n(529,""));return null;case"script":return l=d.async,d=d.src,typeof d=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=ro(d),d=Ta(b).hoistableScripts,p=d.get(l),p||(p={type:"script",instance:null,count:0,state:null},d.set(l,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function oo(a){return'href="'+zn(a)+'"'}function gr(a){return'link[rel="stylesheet"]['+a+"]"}function m0(a){return m({},a,{"data-precedence":a.precedence,precedence:null})}function uR(a,l,d,p){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?p.loading=1:(l=a.createElement("link"),p.preload=l,l.addEventListener("load",function(){return p.loading|=1}),l.addEventListener("error",function(){return p.loading|=2}),sn(l,"link",d),Yt(l),a.head.appendChild(l))}function ro(a){return'[src="'+zn(a)+'"]'}function mr(a){return"script[async]"+a}function y0(a,l,d){if(l.count++,l.instance===null)switch(l.type){case"style":var p=a.querySelector('style[data-href~="'+zn(d.href)+'"]');if(p)return l.instance=p,Yt(p),p;var b=m({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Yt(p),sn(p,"style",b),Zc(p,d.precedence,a),l.instance=p;case"stylesheet":b=oo(d.href);var w=a.querySelector(gr(b));if(w)return l.state.loading|=4,l.instance=w,Yt(w),w;p=m0(d),(b=Fn.get(b))&&Lh(p,b),w=(a.ownerDocument||a).createElement("link"),Yt(w);var E=w;return E._p=new Promise(function(D,I){E.onload=D,E.onerror=I}),sn(w,"link",p),l.state.loading|=4,Zc(w,d.precedence,a),l.instance=w;case"script":return w=ro(d.src),(b=a.querySelector(mr(w)))?(l.instance=b,Yt(b),b):(p=d,(b=Fn.get(w))&&(p=m({},d),zh(p,b)),a=a.ownerDocument||a,b=a.createElement("script"),Yt(b),sn(b,"link",p),a.head.appendChild(b),l.instance=b);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(p=l.instance,l.state.loading|=4,Zc(p,d.precedence,a));return l.instance}function Zc(a,l,d){for(var p=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,w=b,E=0;E<p.length;E++){var D=p[E];if(D.dataset.precedence===l)w=D;else if(w!==b)break}w?w.parentNode.insertBefore(a,w.nextSibling):(l=d.nodeType===9?d.head:d,l.insertBefore(a,l.firstChild))}function Lh(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function zh(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var el=null;function v0(a,l,d){if(el===null){var p=new Map,b=el=new Map;b.set(d,p)}else b=el,p=b.get(d),p||(p=new Map,b.set(d,p));if(p.has(a))return p;for(p.set(a,null),d=d.getElementsByTagName(a),b=0;b<d.length;b++){var w=d[b];if(!(w[Po]||w[vt]||a==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var E=w.getAttribute(l)||"";E=a+E;var D=p.get(E);D?D.push(w):p.set(E,[w])}}return p}function b0(a,l,d){a=a.ownerDocument||a,a.head.insertBefore(d,l==="title"?a.querySelector("head > title"):null)}function dR(a,l,d){if(d===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return a=l.disabled,typeof l.precedence=="string"&&a==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function x0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function hR(a,l,d,p){if(d.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var b=oo(p.href),w=l.querySelector(gr(b));if(w){l=w._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(a.count++,a=tl.bind(a),l.then(a,a)),d.state.loading|=4,d.instance=w,Yt(w);return}w=l.ownerDocument||l,p=m0(p),(b=Fn.get(b))&&Lh(p,b),w=w.createElement("link"),Yt(w);var E=w;E._p=new Promise(function(D,I){E.onload=D,E.onerror=I}),sn(w,"link",p),d.instance=w}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(d,l),(l=d.state.preload)&&(d.state.loading&3)===0&&(a.count++,d=tl.bind(a),l.addEventListener("load",d),l.addEventListener("error",d))}}var Ih=0;function fR(a,l){return a.stylesheets&&a.count===0&&sl(a,a.stylesheets),0<a.count||0<a.imgCount?function(d){var p=setTimeout(function(){if(a.stylesheets&&sl(a,a.stylesheets),a.unsuspend){var w=a.unsuspend;a.unsuspend=null,w()}},6e4+l);0<a.imgBytes&&Ih===0&&(Ih=62500*Q1());var b=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&sl(a,a.stylesheets),a.unsuspend)){var w=a.unsuspend;a.unsuspend=null,w()}},(a.imgBytes>Ih?50:800)+l);return a.unsuspend=d,function(){a.unsuspend=null,clearTimeout(p),clearTimeout(b)}}:null}function tl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)sl(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var nl=null;function sl(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,nl=new Map,l.forEach(pR,a),nl=null,tl.call(a))}function pR(a,l){if(!(l.state.loading&4)){var d=nl.get(a);if(d)var p=d.get(null);else{d=new Map,nl.set(a,d);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var E=b[w];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(d.set(E.dataset.precedence,E),p=E)}p&&d.set(null,p)}b=l.instance,E=b.getAttribute("data-precedence"),w=d.get(E)||p,w===p&&d.set(null,b),d.set(E,b),this.count++,p=tl.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),w?w.parentNode.insertBefore(b,w.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),l.state.loading|=4}}var yr={$$typeof:k,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function gR(a,l,d,p,b,w,E,D,I){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=he(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=he(0),this.hiddenUpdates=he(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=I,this.incompleteTransitions=new Map}function w0(a,l,d,p,b,w,E,D,I,G,ne,re){return a=new gR(a,l,d,E,I,G,ne,re,D),l=1,w===!0&&(l|=24),w=Mn(3,null,null,l),a.current=w,w.stateNode=a,l=md(),l.refCount++,a.pooledCache=l,l.refCount++,w.memoizedState={element:p,isDehydrated:d,cache:l},xd(w),a}function C0(a){return a?(a=Oa,a):Oa}function S0(a,l,d,p,b,w){b=C0(b),p.context===null?p.context=b:p.pendingContext=b,p=gi(l),p.payload={element:d},w=w===void 0?null:w,w!==null&&(p.callback=w),d=mi(a,p,l),d!==null&&(bn(d,a,l),Yo(d,a,l))}function M0(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<l?d:l}}function Oh(a,l){M0(a,l),(a=a.alternate)&&M0(a,l)}function R0(a){if(a.tag===13||a.tag===31){var l=Xi(a,67108864);l!==null&&bn(l,a,67108864),Oh(a,67108864)}}function E0(a){if(a.tag===13||a.tag===31){var l=An();l=Zt(l);var d=Xi(a,l);d!==null&&bn(d,a,l),Oh(a,l)}}var il=!0;function mR(a,l,d,p){var b=L.T;L.T=null;var w=N.p;try{N.p=2,Hh(a,l,d,p)}finally{N.p=w,L.T=b}}function yR(a,l,d,p){var b=L.T;L.T=null;var w=N.p;try{N.p=8,Hh(a,l,d,p)}finally{N.p=w,L.T=b}}function Hh(a,l,d,p){if(il){var b=qh(p);if(b===null)Rh(a,l,p,al,d),T0(a,p);else if(bR(b,a,l,d,p))p.stopPropagation();else if(T0(a,p),l&4&&-1<vR.indexOf(a)){for(;b!==null;){var w=ka(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var E=Jn(w.pendingLanes);if(E!==0){var D=w;for(D.pendingLanes|=2,D.entangledLanes|=2;E;){var I=1<<31-Lt(E);D.entanglements[1]|=I,E&=~I}ys(w),(st&6)===0&&($c=Ze()+500,dr(0))}}break;case 31:case 13:D=Xi(w,2),D!==null&&bn(D,w,2),Uc(),Oh(w,2)}if(w=qh(p),w===null&&Rh(a,l,p,al,d),w===b)break;b=w}b!==null&&p.stopPropagation()}else Rh(a,l,p,null,d)}}function qh(a){return a=Bu(a),$h(a)}var al=null;function $h(a){if(al=null,a=Ea(a),a!==null){var l=i(a);if(l===null)a=null;else{var d=l.tag;if(d===13){if(a=o(l),a!==null)return a;a=null}else if(d===31){if(a=c(l),a!==null)return a;a=null}else if(d===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return al=a,null}function k0(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(jt()){case xt:return 2;case yt:return 8;case Xt:case Qt:return 32;case _s:return 268435456;default:return 32}default:return 32}}var Bh=!1,ki=null,Ti=null,Ai=null,vr=new Map,br=new Map,Di=[],vR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function T0(a,l){switch(a){case"focusin":case"focusout":ki=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Ai=null;break;case"pointerover":case"pointerout":vr.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":br.delete(l.pointerId)}}function xr(a,l,d,p,b,w){return a===null||a.nativeEvent!==w?(a={blockedOn:l,domEventName:d,eventSystemFlags:p,nativeEvent:w,targetContainers:[b]},l!==null&&(l=ka(l),l!==null&&R0(l)),a):(a.eventSystemFlags|=p,l=a.targetContainers,b!==null&&l.indexOf(b)===-1&&l.push(b),a)}function bR(a,l,d,p,b){switch(l){case"focusin":return ki=xr(ki,a,l,d,p,b),!0;case"dragenter":return Ti=xr(Ti,a,l,d,p,b),!0;case"mouseover":return Ai=xr(Ai,a,l,d,p,b),!0;case"pointerover":var w=b.pointerId;return vr.set(w,xr(vr.get(w)||null,a,l,d,p,b)),!0;case"gotpointercapture":return w=b.pointerId,br.set(w,xr(br.get(w)||null,a,l,d,p,b)),!0}return!1}function A0(a){var l=Ea(a.target);if(l!==null){var d=i(l);if(d!==null){if(l=d.tag,l===13){if(l=o(d),l!==null){a.blockedOn=l,St(a.priority,function(){E0(d)});return}}else if(l===31){if(l=c(d),l!==null){a.blockedOn=l,St(a.priority,function(){E0(d)});return}}else if(l===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ol(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var d=qh(a.nativeEvent);if(d===null){d=a.nativeEvent;var p=new d.constructor(d.type,d);$u=p,d.target.dispatchEvent(p),$u=null}else return l=ka(d),l!==null&&R0(l),a.blockedOn=d,!1;l.shift()}return!0}function D0(a,l,d){ol(a)&&d.delete(l)}function xR(){Bh=!1,ki!==null&&ol(ki)&&(ki=null),Ti!==null&&ol(Ti)&&(Ti=null),Ai!==null&&ol(Ai)&&(Ai=null),vr.forEach(D0),br.forEach(D0)}function rl(a,l){a.blockedOn===l&&(a.blockedOn=null,Bh||(Bh=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,xR)))}var cl=null;function _0(a){cl!==a&&(cl=a,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){cl===a&&(cl=null);for(var l=0;l<a.length;l+=3){var d=a[l],p=a[l+1],b=a[l+2];if(typeof p!="function"){if($h(p||d)===null)continue;break}var w=ka(d);w!==null&&(a.splice(l,3),l-=3,qd(w,{pending:!0,data:b,method:d.method,action:p},p,b))}}))}function co(a){function l(I){return rl(I,a)}ki!==null&&rl(ki,a),Ti!==null&&rl(Ti,a),Ai!==null&&rl(Ai,a),vr.forEach(l),br.forEach(l);for(var d=0;d<Di.length;d++){var p=Di[d];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Di.length&&(d=Di[0],d.blockedOn===null);)A0(d),d.blockedOn===null&&Di.shift();if(d=(a.ownerDocument||a).$$reactFormReplay,d!=null)for(p=0;p<d.length;p+=3){var b=d[p],w=d[p+1],E=b[Bt]||null;if(typeof w=="function")E||_0(d);else if(E){var D=null;if(w&&w.hasAttribute("formAction")){if(b=w,E=w[Bt]||null)D=E.formAction;else if($h(b)!==null)continue}else D=E.action;typeof D=="function"?d[p+1]=D:(d.splice(p,3),p-=3),_0(d)}}}function P0(){function a(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(E){return b=E})},focusReset:"manual",scroll:"manual"})}function l(){b!==null&&(b(),b=null),p||setTimeout(d,20)}function d(){if(!p&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,b=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(d,100),function(){p=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),b!==null&&(b(),b=null)}}}function Uh(a){this._internalRoot=a}ll.prototype.render=Uh.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(n(409));var d=l.current,p=An();S0(d,p,a,l,null,null)},ll.prototype.unmount=Uh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;S0(a.current,2,null,a,null,null),Uc(),l[fs]=null}};function ll(a){this._internalRoot=a}ll.prototype.unstable_scheduleHydration=function(a){if(a){var l=un();a={blockedOn:null,target:a,priority:l};for(var d=0;d<Di.length&&l!==0&&l<Di[d].priority;d++);Di.splice(d,0,a),d===0&&A0(a)}};var N0=t.version;if(N0!=="19.2.0")throw Error(n(527,N0,"19.2.0"));N.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=h(l),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var wR={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ul.isDisabled&&ul.supportsFiber)try{hs=ul.inject(wR),Jt=ul}catch{}}return Cr.createRoot=function(a,l){if(!s(a))throw Error(n(299));var d=!1,p="",b=qm,w=$m,E=Bm;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(w=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=w0(a,1,!1,null,null,d,p,null,b,w,E,P0),a[fs]=l.current,Mh(a),new Uh(l)},Cr.hydrateRoot=function(a,l,d){if(!s(a))throw Error(n(299));var p=!1,b="",w=qm,E=$m,D=Bm,I=null;return d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(b=d.identifierPrefix),d.onUncaughtError!==void 0&&(w=d.onUncaughtError),d.onCaughtError!==void 0&&(E=d.onCaughtError),d.onRecoverableError!==void 0&&(D=d.onRecoverableError),d.formState!==void 0&&(I=d.formState)),l=w0(a,1,!0,l,d??null,p,b,I,w,E,D,P0),l.context=C0(null),d=l.current,p=An(),p=Zt(p),b=gi(p),b.callback=null,mi(d,b,p),d=p,l.current.lanes=d,be(l,d),ys(l),a[fs]=l.current,Mh(a),new ll(l)},Cr.version="19.2.0",Cr}var U0;function _R(){if(U0)return Gh.exports;U0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Gh.exports=DR(),Gh.exports}var PR=_R();const NR=Hf(PR);let jR={data:""},LR=r=>{if(typeof window=="object"){let t=(r?r.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return t.nonce=window.__nonce__,t.parentNode||(r||document.head).appendChild(t),t.firstChild}return r||jR},zR=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,IR=/\/\*[^]*?\*\/|  +/g,F0=/\n+/g,ji=(r,t)=>{let e="",n="",s="";for(let i in r){let o=r[i];i[0]=="@"?i[1]=="i"?e=i+" "+o+";":n+=i[1]=="f"?ji(o,i):i+"{"+ji(o,i[1]=="k"?"":t)+"}":typeof o=="object"?n+=ji(o,t?t.replace(/([^,])+/g,c=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,u=>/&/.test(u)?u.replace(/&/g,c):c?c+" "+u:u)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=ji.p?ji.p(i,o):i+":"+o+";")}return e+(t&&s?t+"{"+s+"}":s)+n},Zs={},Jv=r=>{if(typeof r=="object"){let t="";for(let e in r)t+=e+Jv(r[e]);return t}return r},OR=(r,t,e,n,s)=>{let i=Jv(r),o=Zs[i]||(Zs[i]=(u=>{let h=0,f=11;for(;h<u.length;)f=101*f+u.charCodeAt(h++)>>>0;return"go"+f})(i));if(!Zs[o]){let u=i!==r?r:(h=>{let f,m,y=[{}];for(;f=zR.exec(h.replace(IR,""));)f[4]?y.shift():f[3]?(m=f[3].replace(F0," ").trim(),y.unshift(y[0][m]=y[0][m]||{})):y[0][f[1]]=f[2].replace(F0," ").trim();return y[0]})(r);Zs[o]=ji(s?{["@keyframes "+o]:u}:u,e?"":"."+o)}let c=e&&Zs.g?Zs.g:null;return e&&(Zs.g=Zs[o]),((u,h,f,m)=>{m?h.data=h.data.replace(m,u):h.data.indexOf(u)===-1&&(h.data=f?u+h.data:h.data+u)})(Zs[o],t,n,c),o},HR=(r,t,e)=>r.reduce((n,s,i)=>{let o=t[i];if(o&&o.call){let c=o(e),u=c&&c.props&&c.props.className||/^go/.test(c)&&c;o=u?"."+u:c&&typeof c=="object"?c.props?"":ji(c,""):c===!1?"":c}return n+s+(o??"")},"");function Wl(r){let t=this||{},e=r.call?r(t.p):r;return OR(e.unshift?e.raw?HR(e,[].slice.call(arguments,1),t.p):e.reduce((n,s)=>Object.assign(n,s&&s.call?s(t.p):s),{}):e,LR(t.target),t.g,t.o,t.k)}let Zv,yf,vf;Wl.bind({g:1});let si=Wl.bind({k:1});function qR(r,t,e,n){ji.p=t,Zv=r,yf=e,vf=n}function qi(r,t){let e=this||{};return function(){let n=arguments;function s(i,o){let c=Object.assign({},i),u=c.className||s.className;e.p=Object.assign({theme:yf&&yf()},c),e.o=/ *go\d+/.test(u),c.className=Wl.apply(e,n)+(u?" "+u:"");let h=r;return r[0]&&(h=c.as||r,delete c.as),vf&&h[0]&&vf(c),Zv(h,c)}return s}}var $R=r=>typeof r=="function",Ll=(r,t)=>$R(r)?r(t):r,BR=(()=>{let r=0;return()=>(++r).toString()})(),eb=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");r=!t||t.matches}return r}})(),UR=20,Bf="default",tb=(r,t)=>{let{toastLimit:e}=r.settings;switch(t.type){case 0:return{...r,toasts:[t.toast,...r.toasts].slice(0,e)};case 1:return{...r,toasts:r.toasts.map(o=>o.id===t.toast.id?{...o,...t.toast}:o)};case 2:let{toast:n}=t;return tb(r,{type:r.toasts.find(o=>o.id===n.id)?1:0,toast:n});case 3:let{toastId:s}=t;return{...r,toasts:r.toasts.map(o=>o.id===s||s===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(o=>o.id!==t.toastId)};case 5:return{...r,pausedAt:t.time};case 6:let i=t.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},Rl=[],nb={toasts:[],pausedAt:void 0,settings:{toastLimit:UR}},bs={},sb=(r,t=Bf)=>{bs[t]=tb(bs[t]||nb,r),Rl.forEach(([e,n])=>{e===t&&n(bs[t])})},ib=r=>Object.keys(bs).forEach(t=>sb(r,t)),FR=r=>Object.keys(bs).find(t=>bs[t].toasts.some(e=>e.id===r)),Xl=(r=Bf)=>t=>{sb(t,r)},VR={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},GR=(r={},t=Bf)=>{let[e,n]=C.useState(bs[t]||nb),s=C.useRef(bs[t]);C.useEffect(()=>(s.current!==bs[t]&&n(bs[t]),Rl.push([t,n]),()=>{let o=Rl.findIndex(([c])=>c===t);o>-1&&Rl.splice(o,1)}),[t]);let i=e.toasts.map(o=>{var c,u,h;return{...r,...r[o.type],...o,removeDelay:o.removeDelay||((c=r[o.type])==null?void 0:c.removeDelay)||r?.removeDelay,duration:o.duration||((u=r[o.type])==null?void 0:u.duration)||r?.duration||VR[o.type],style:{...r.style,...(h=r[o.type])==null?void 0:h.style,...o.style}}});return{...e,toasts:i}},QR=(r,t="blank",e)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...e,id:e?.id||BR()}),Hr=r=>(t,e)=>{let n=QR(t,r,e);return Xl(n.toasterId||FR(n.id))({type:2,toast:n}),n.id},Gt=(r,t)=>Hr("blank")(r,t);Gt.error=Hr("error");Gt.success=Hr("success");Gt.loading=Hr("loading");Gt.custom=Hr("custom");Gt.dismiss=(r,t)=>{let e={type:3,toastId:r};t?Xl(t)(e):ib(e)};Gt.dismissAll=r=>Gt.dismiss(void 0,r);Gt.remove=(r,t)=>{let e={type:4,toastId:r};t?Xl(t)(e):ib(e)};Gt.removeAll=r=>Gt.remove(void 0,r);Gt.promise=(r,t,e)=>{let n=Gt.loading(t.loading,{...e,...e?.loading});return typeof r=="function"&&(r=r()),r.then(s=>{let i=t.success?Ll(t.success,s):void 0;return i?Gt.success(i,{id:n,...e,...e?.success}):Gt.dismiss(n),s}).catch(s=>{let i=t.error?Ll(t.error,s):void 0;i?Gt.error(i,{id:n,...e,...e?.error}):Gt.dismiss(n)}),r};var KR=1e3,YR=(r,t="default")=>{let{toasts:e,pausedAt:n}=GR(r,t),s=C.useRef(new Map).current,i=C.useCallback((m,y=KR)=>{if(s.has(m))return;let v=setTimeout(()=>{s.delete(m),o({type:4,toastId:m})},y);s.set(m,v)},[]);C.useEffect(()=>{if(n)return;let m=Date.now(),y=e.map(v=>{if(v.duration===1/0)return;let x=(v.duration||0)+v.pauseDuration-(m-v.createdAt);if(x<0){v.visible&&Gt.dismiss(v.id);return}return setTimeout(()=>Gt.dismiss(v.id,t),x)});return()=>{y.forEach(v=>v&&clearTimeout(v))}},[e,n,t]);let o=C.useCallback(Xl(t),[t]),c=C.useCallback(()=>{o({type:5,time:Date.now()})},[o]),u=C.useCallback((m,y)=>{o({type:1,toast:{id:m,height:y}})},[o]),h=C.useCallback(()=>{n&&o({type:6,time:Date.now()})},[n,o]),f=C.useCallback((m,y)=>{let{reverseOrder:v=!1,gutter:x=8,defaultPosition:S}=y||{},R=e.filter(k=>(k.position||S)===(m.position||S)&&k.height),M=R.findIndex(k=>k.id===m.id),T=R.filter((k,A)=>A<M&&k.visible).length;return R.filter(k=>k.visible).slice(...v?[T+1]:[0,T]).reduce((k,A)=>k+(A.height||0)+x,0)},[e]);return C.useEffect(()=>{e.forEach(m=>{if(m.dismissed)i(m.id,m.removeDelay);else{let y=s.get(m.id);y&&(clearTimeout(y),s.delete(m.id))}})},[e,i]),{toasts:e,handlers:{updateHeight:u,startPause:c,endPause:h,calculateOffset:f}}},WR=si`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,XR=si`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,JR=si`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ZR=qi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${WR} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${XR} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${JR} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,eE=si`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,tE=qi("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${eE} 1s linear infinite;
`,nE=si`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,sE=si`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,iE=qi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${nE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${sE} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,aE=qi("div")`
  position: absolute;
`,oE=qi("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,rE=si`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,cE=qi("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${rE} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,lE=({toast:r})=>{let{icon:t,type:e,iconTheme:n}=r;return t!==void 0?typeof t=="string"?C.createElement(cE,null,t):t:e==="blank"?null:C.createElement(oE,null,C.createElement(tE,{...n}),e!=="loading"&&C.createElement(aE,null,e==="error"?C.createElement(ZR,{...n}):C.createElement(iE,{...n})))},uE=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,dE=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,hE="0%{opacity:0;} 100%{opacity:1;}",fE="0%{opacity:1;} 100%{opacity:0;}",pE=qi("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,gE=qi("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,mE=(r,t)=>{let e=r.includes("top")?1:-1,[n,s]=eb()?[hE,fE]:[uE(e),dE(e)];return{animation:t?`${si(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${si(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},yE=C.memo(({toast:r,position:t,style:e,children:n})=>{let s=r.height?mE(r.position||t||"top-center",r.visible):{opacity:0},i=C.createElement(lE,{toast:r}),o=C.createElement(gE,{...r.ariaProps},Ll(r.message,r));return C.createElement(pE,{className:r.className,style:{...s,...e,...r.style}},typeof n=="function"?n({icon:i,message:o}):C.createElement(C.Fragment,null,i,o))});qR(C.createElement);var vE=({id:r,className:t,style:e,onHeightUpdate:n,children:s})=>{let i=C.useCallback(o=>{if(o){let c=()=>{let u=o.getBoundingClientRect().height;n(r,u)};c(),new MutationObserver(c).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[r,n]);return C.createElement("div",{ref:i,className:t,style:e},s)},bE=(r,t)=>{let e=r.includes("top"),n=e?{top:0}:{bottom:0},s=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:eb()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(e?1:-1)}px)`,...n,...s}},xE=Wl`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dl=16,wE=({reverseOrder:r,position:t="top-center",toastOptions:e,gutter:n,children:s,toasterId:i,containerStyle:o,containerClassName:c})=>{let{toasts:u,handlers:h}=YR(e,i);return C.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:dl,left:dl,right:dl,bottom:dl,pointerEvents:"none",...o},className:c,onMouseEnter:h.startPause,onMouseLeave:h.endPause},u.map(f=>{let m=f.position||t,y=h.calculateOffset(f,{reverseOrder:r,gutter:n,defaultPosition:t}),v=bE(m,y);return C.createElement(vE,{id:f.id,key:f.id,onHeightUpdate:h.updateHeight,className:f.visible?xE:"",style:v},f.type==="custom"?Ll(f.message,f):s?s(f):C.createElement(yE,{toast:f,position:m}))}))},l3=Gt;function V0(r,t){if(typeof r=="function")return r(t);r!=null&&(r.current=t)}function Ts(...r){return t=>{let e=!1;const n=r.map(s=>{const i=V0(s,t);return!e&&typeof i=="function"&&(e=!0),i});if(e)return()=>{for(let s=0;s<n.length;s++){const i=n[s];typeof i=="function"?i():V0(r[s],null)}}}}function Ne(...r){return C.useCallback(Ts(...r),r)}var CE=Symbol.for("react.lazy"),zl=$f[" use ".trim().toString()];function SE(r){return typeof r=="object"&&r!==null&&"then"in r}function ab(r){return r!=null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===CE&&"_payload"in r&&SE(r._payload)}function Uf(r){const t=RE(r),e=C.forwardRef((n,s)=>{let{children:i,...o}=n;ab(i)&&typeof zl=="function"&&(i=zl(i._payload));const c=C.Children.toArray(i),u=c.find(kE);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}var ME=Uf("Slot");function RE(r){const t=C.forwardRef((e,n)=>{let{children:s,...i}=e;if(ab(s)&&typeof zl=="function"&&(s=zl(s._payload)),C.isValidElement(s)){const o=AE(s),c=TE(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var EE=Symbol("radix.slottable");function kE(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===EE}function TE(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function AE(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function ob(r){var t,e,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(t=0;t<s;t++)r[t]&&(e=ob(r[t]))&&(n&&(n+=" "),n+=e)}else for(e in r)r[e]&&(n&&(n+=" "),n+=e);return n}function rb(){for(var r,t,e=0,n="",s=arguments.length;e<s;e++)(r=arguments[e])&&(t=ob(r))&&(n&&(n+=" "),n+=t);return n}const G0=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,Q0=rb,Ff=(r,t)=>e=>{var n;if(t?.variants==null)return Q0(r,e?.class,e?.className);const{variants:s,defaultVariants:i}=t,o=Object.keys(s).map(h=>{const f=e?.[h],m=i?.[h];if(f===null)return null;const y=G0(f)||G0(m);return s[h][y]}),c=e&&Object.entries(e).reduce((h,f)=>{let[m,y]=f;return y===void 0||(h[m]=y),h},{}),u=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((h,f)=>{let{class:m,className:y,...v}=f;return Object.entries(v).every(x=>{let[S,R]=x;return Array.isArray(R)?R.includes({...i,...c}[S]):{...i,...c}[S]===R})?[...h,m,y]:h},[]);return Q0(r,o,u,e?.class,e?.className)},DE=(r,t)=>{const e=new Array(r.length+t.length);for(let n=0;n<r.length;n++)e[n]=r[n];for(let n=0;n<t.length;n++)e[r.length+n]=t[n];return e},_E=(r,t)=>({classGroupId:r,validator:t}),cb=(r=new Map,t=null,e)=>({nextPart:r,validators:t,classGroupId:e}),Il="-",K0=[],PE="arbitrary..",NE=r=>{const t=LE(r),{conflictingClassGroups:e,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:o=>{if(o.startsWith("[")&&o.endsWith("]"))return jE(o);const c=o.split(Il),u=c[0]===""&&c.length>1?1:0;return lb(c,u,t)},getConflictingClassGroupIds:(o,c)=>{if(c){const u=n[o],h=e[o];return u?h?DE(h,u):u:h||K0}return e[o]||K0}}},lb=(r,t,e)=>{if(r.length-t===0)return e.classGroupId;const s=r[t],i=e.nextPart.get(s);if(i){const h=lb(r,t+1,i);if(h)return h}const o=e.validators;if(o===null)return;const c=t===0?r.join(Il):r.slice(t).join(Il),u=o.length;for(let h=0;h<u;h++){const f=o[h];if(f.validator(c))return f.classGroupId}},jE=r=>r.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=r.slice(1,-1),e=t.indexOf(":"),n=t.slice(0,e);return n?PE+n:void 0})(),LE=r=>{const{theme:t,classGroups:e}=r;return zE(e,t)},zE=(r,t)=>{const e=cb();for(const n in r){const s=r[n];Vf(s,e,n,t)}return e},Vf=(r,t,e,n)=>{const s=r.length;for(let i=0;i<s;i++){const o=r[i];IE(o,t,e,n)}},IE=(r,t,e,n)=>{if(typeof r=="string"){OE(r,t,e);return}if(typeof r=="function"){HE(r,t,e,n);return}qE(r,t,e,n)},OE=(r,t,e)=>{const n=r===""?t:ub(t,r);n.classGroupId=e},HE=(r,t,e,n)=>{if($E(r)){Vf(r(n),t,e,n);return}t.validators===null&&(t.validators=[]),t.validators.push(_E(e,r))},qE=(r,t,e,n)=>{const s=Object.entries(r),i=s.length;for(let o=0;o<i;o++){const[c,u]=s[o];Vf(u,ub(t,c),e,n)}},ub=(r,t)=>{let e=r;const n=t.split(Il),s=n.length;for(let i=0;i<s;i++){const o=n[i];let c=e.nextPart.get(o);c||(c=cb(),e.nextPart.set(o,c)),e=c}return e},$E=r=>"isThemeGetter"in r&&r.isThemeGetter===!0,BE=r=>{if(r<1)return{get:()=>{},set:()=>{}};let t=0,e=Object.create(null),n=Object.create(null);const s=(i,o)=>{e[i]=o,t++,t>r&&(t=0,n=e,e=Object.create(null))};return{get(i){let o=e[i];if(o!==void 0)return o;if((o=n[i])!==void 0)return s(i,o),o},set(i,o){i in e?e[i]=o:s(i,o)}}},bf="!",Y0=":",UE=[],W0=(r,t,e,n,s)=>({modifiers:r,hasImportantModifier:t,baseClassName:e,maybePostfixModifierPosition:n,isExternal:s}),FE=r=>{const{prefix:t,experimentalParseClassName:e}=r;let n=s=>{const i=[];let o=0,c=0,u=0,h;const f=s.length;for(let S=0;S<f;S++){const R=s[S];if(o===0&&c===0){if(R===Y0){i.push(s.slice(u,S)),u=S+1;continue}if(R==="/"){h=S;continue}}R==="["?o++:R==="]"?o--:R==="("?c++:R===")"&&c--}const m=i.length===0?s:s.slice(u);let y=m,v=!1;m.endsWith(bf)?(y=m.slice(0,-1),v=!0):m.startsWith(bf)&&(y=m.slice(1),v=!0);const x=h&&h>u?h-u:void 0;return W0(i,v,y,x)};if(t){const s=t+Y0,i=n;n=o=>o.startsWith(s)?i(o.slice(s.length)):W0(UE,!1,o,void 0,!0)}if(e){const s=n;n=i=>e({className:i,parseClassName:s})}return n},VE=r=>{const t=new Map;return r.orderSensitiveModifiers.forEach((e,n)=>{t.set(e,1e6+n)}),e=>{const n=[];let s=[];for(let i=0;i<e.length;i++){const o=e[i],c=o[0]==="[",u=t.has(o);c||u?(s.length>0&&(s.sort(),n.push(...s),s=[]),n.push(o)):s.push(o)}return s.length>0&&(s.sort(),n.push(...s)),n}},GE=r=>({cache:BE(r.cacheSize),parseClassName:FE(r),sortModifiers:VE(r),...NE(r)}),QE=/\s+/,KE=(r,t)=>{const{parseClassName:e,getClassGroupId:n,getConflictingClassGroupIds:s,sortModifiers:i}=t,o=[],c=r.trim().split(QE);let u="";for(let h=c.length-1;h>=0;h-=1){const f=c[h],{isExternal:m,modifiers:y,hasImportantModifier:v,baseClassName:x,maybePostfixModifierPosition:S}=e(f);if(m){u=f+(u.length>0?" "+u:u);continue}let R=!!S,M=n(R?x.substring(0,S):x);if(!M){if(!R){u=f+(u.length>0?" "+u:u);continue}if(M=n(x),!M){u=f+(u.length>0?" "+u:u);continue}R=!1}const T=y.length===0?"":y.length===1?y[0]:i(y).join(":"),k=v?T+bf:T,A=k+M;if(o.indexOf(A)>-1)continue;o.push(A);const _=s(M,R);for(let P=0;P<_.length;++P){const z=_[P];o.push(k+z)}u=f+(u.length>0?" "+u:u)}return u},YE=(...r)=>{let t=0,e,n,s="";for(;t<r.length;)(e=r[t++])&&(n=db(e))&&(s&&(s+=" "),s+=n);return s},db=r=>{if(typeof r=="string")return r;let t,e="";for(let n=0;n<r.length;n++)r[n]&&(t=db(r[n]))&&(e&&(e+=" "),e+=t);return e},WE=(r,...t)=>{let e,n,s,i;const o=u=>{const h=t.reduce((f,m)=>m(f),r());return e=GE(h),n=e.cache.get,s=e.cache.set,i=c,c(u)},c=u=>{const h=n(u);if(h)return h;const f=KE(u,e);return s(u,f),f};return i=o,(...u)=>i(YE(...u))},XE=[],Ft=r=>{const t=e=>e[r]||XE;return t.isThemeGetter=!0,t},hb=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,fb=/^\((?:(\w[\w-]*):)?(.+)\)$/i,JE=/^\d+\/\d+$/,ZE=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ek=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,nk=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,sk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,lo=r=>JE.test(r),qe=r=>!!r&&!Number.isNaN(Number(r)),Pi=r=>!!r&&Number.isInteger(Number(r)),Wh=r=>r.endsWith("%")&&qe(r.slice(0,-1)),ei=r=>ZE.test(r),ik=()=>!0,ak=r=>ek.test(r)&&!tk.test(r),pb=()=>!1,ok=r=>nk.test(r),rk=r=>sk.test(r),ck=r=>!Ce(r)&&!Se(r),lk=r=>Mo(r,yb,pb),Ce=r=>hb.test(r),ua=r=>Mo(r,vb,ak),Xh=r=>Mo(r,pk,qe),X0=r=>Mo(r,gb,pb),uk=r=>Mo(r,mb,rk),hl=r=>Mo(r,bb,ok),Se=r=>fb.test(r),Sr=r=>Ro(r,vb),dk=r=>Ro(r,gk),J0=r=>Ro(r,gb),hk=r=>Ro(r,yb),fk=r=>Ro(r,mb),fl=r=>Ro(r,bb,!0),Mo=(r,t,e)=>{const n=hb.exec(r);return n?n[1]?t(n[1]):e(n[2]):!1},Ro=(r,t,e=!1)=>{const n=fb.exec(r);return n?n[1]?t(n[1]):e:!1},gb=r=>r==="position"||r==="percentage",mb=r=>r==="image"||r==="url",yb=r=>r==="length"||r==="size"||r==="bg-size",vb=r=>r==="length",pk=r=>r==="number",gk=r=>r==="family-name",bb=r=>r==="shadow",mk=()=>{const r=Ft("color"),t=Ft("font"),e=Ft("text"),n=Ft("font-weight"),s=Ft("tracking"),i=Ft("leading"),o=Ft("breakpoint"),c=Ft("container"),u=Ft("spacing"),h=Ft("radius"),f=Ft("shadow"),m=Ft("inset-shadow"),y=Ft("text-shadow"),v=Ft("drop-shadow"),x=Ft("blur"),S=Ft("perspective"),R=Ft("aspect"),M=Ft("ease"),T=Ft("animate"),k=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],_=()=>[...A(),Se,Ce],P=()=>["auto","hidden","clip","visible","scroll"],z=()=>["auto","contain","none"],q=()=>[Se,Ce,u],Z=()=>[lo,"full","auto",...q()],se=()=>[Pi,"none","subgrid",Se,Ce],ce=()=>["auto",{span:["full",Pi,Se,Ce]},Pi,Se,Ce],J=()=>[Pi,"auto",Se,Ce],te=()=>["auto","min","max","fr",Se,Ce],le=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],ue=()=>["start","end","center","stretch","center-safe","end-safe"],L=()=>["auto",...q()],N=()=>[lo,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...q()],O=()=>[r,Se,Ce],W=()=>[...A(),J0,X0,{position:[Se,Ce]}],fe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],j=()=>["auto","cover","contain",hk,lk,{size:[Se,Ce]}],F=()=>[Wh,Sr,ua],Y=()=>["","none","full",h,Se,Ce],ie=()=>["",qe,Sr,ua],U=()=>["solid","dashed","dotted","double"],ae=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],B=()=>[qe,Wh,J0,X0],Q=()=>["","none",x,Se,Ce],pe=()=>["none",qe,Se,Ce],me=()=>["none",qe,Se,Ce],ye=()=>[qe,Se,Ce],ve=()=>[lo,"full",...q()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ei],breakpoint:[ei],color:[ik],container:[ei],"drop-shadow":[ei],ease:["in","out","in-out"],font:[ck],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ei],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ei],shadow:[ei],spacing:["px",qe],text:[ei],"text-shadow":[ei],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",lo,Ce,Se,R]}],container:["container"],columns:[{columns:[qe,Ce,Se,c]}],"break-after":[{"break-after":k()}],"break-before":[{"break-before":k()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:_()}],overflow:[{overflow:P()}],"overflow-x":[{"overflow-x":P()}],"overflow-y":[{"overflow-y":P()}],overscroll:[{overscroll:z()}],"overscroll-x":[{"overscroll-x":z()}],"overscroll-y":[{"overscroll-y":z()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Z()}],"inset-x":[{"inset-x":Z()}],"inset-y":[{"inset-y":Z()}],start:[{start:Z()}],end:[{end:Z()}],top:[{top:Z()}],right:[{right:Z()}],bottom:[{bottom:Z()}],left:[{left:Z()}],visibility:["visible","invisible","collapse"],z:[{z:[Pi,"auto",Se,Ce]}],basis:[{basis:[lo,"full","auto",c,...q()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[qe,lo,"auto","initial","none",Ce]}],grow:[{grow:["",qe,Se,Ce]}],shrink:[{shrink:["",qe,Se,Ce]}],order:[{order:[Pi,"first","last","none",Se,Ce]}],"grid-cols":[{"grid-cols":se()}],"col-start-end":[{col:ce()}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":se()}],"row-start-end":[{row:ce()}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":te()}],"auto-rows":[{"auto-rows":te()}],gap:[{gap:q()}],"gap-x":[{"gap-x":q()}],"gap-y":[{"gap-y":q()}],"justify-content":[{justify:[...le(),"normal"]}],"justify-items":[{"justify-items":[...ue(),"normal"]}],"justify-self":[{"justify-self":["auto",...ue()]}],"align-content":[{content:["normal",...le()]}],"align-items":[{items:[...ue(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...ue(),{baseline:["","last"]}]}],"place-content":[{"place-content":le()}],"place-items":[{"place-items":[...ue(),"baseline"]}],"place-self":[{"place-self":["auto",...ue()]}],p:[{p:q()}],px:[{px:q()}],py:[{py:q()}],ps:[{ps:q()}],pe:[{pe:q()}],pt:[{pt:q()}],pr:[{pr:q()}],pb:[{pb:q()}],pl:[{pl:q()}],m:[{m:L()}],mx:[{mx:L()}],my:[{my:L()}],ms:[{ms:L()}],me:[{me:L()}],mt:[{mt:L()}],mr:[{mr:L()}],mb:[{mb:L()}],ml:[{ml:L()}],"space-x":[{"space-x":q()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":q()}],"space-y-reverse":["space-y-reverse"],size:[{size:N()}],w:[{w:[c,"screen",...N()]}],"min-w":[{"min-w":[c,"screen","none",...N()]}],"max-w":[{"max-w":[c,"screen","none","prose",{screen:[o]},...N()]}],h:[{h:["screen","lh",...N()]}],"min-h":[{"min-h":["screen","lh","none",...N()]}],"max-h":[{"max-h":["screen","lh",...N()]}],"font-size":[{text:["base",e,Sr,ua]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,Se,Xh]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Wh,Ce]}],"font-family":[{font:[dk,Ce,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,Se,Ce]}],"line-clamp":[{"line-clamp":[qe,"none",Se,Xh]}],leading:[{leading:[i,...q()]}],"list-image":[{"list-image":["none",Se,Ce]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Se,Ce]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[qe,"from-font","auto",Se,ua]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[qe,"auto",Se,Ce]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:q()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Se,Ce]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Se,Ce]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:W()}],"bg-repeat":[{bg:fe()}],"bg-size":[{bg:j()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Pi,Se,Ce],radial:["",Se,Ce],conic:[Pi,Se,Ce]},fk,uk]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:F()}],"gradient-via-pos":[{via:F()}],"gradient-to-pos":[{to:F()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:ie()}],"border-w-x":[{"border-x":ie()}],"border-w-y":[{"border-y":ie()}],"border-w-s":[{"border-s":ie()}],"border-w-e":[{"border-e":ie()}],"border-w-t":[{"border-t":ie()}],"border-w-r":[{"border-r":ie()}],"border-w-b":[{"border-b":ie()}],"border-w-l":[{"border-l":ie()}],"divide-x":[{"divide-x":ie()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ie()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[qe,Se,Ce]}],"outline-w":[{outline:["",qe,Sr,ua]}],"outline-color":[{outline:O()}],shadow:[{shadow:["","none",f,fl,hl]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",m,fl,hl]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[qe,ua]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":ie()}],"inset-ring-color":[{"inset-ring":O()}],"text-shadow":[{"text-shadow":["none",y,fl,hl]}],"text-shadow-color":[{"text-shadow":O()}],opacity:[{opacity:[qe,Se,Ce]}],"mix-blend":[{"mix-blend":[...ae(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ae()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[qe]}],"mask-image-linear-from-pos":[{"mask-linear-from":B()}],"mask-image-linear-to-pos":[{"mask-linear-to":B()}],"mask-image-linear-from-color":[{"mask-linear-from":O()}],"mask-image-linear-to-color":[{"mask-linear-to":O()}],"mask-image-t-from-pos":[{"mask-t-from":B()}],"mask-image-t-to-pos":[{"mask-t-to":B()}],"mask-image-t-from-color":[{"mask-t-from":O()}],"mask-image-t-to-color":[{"mask-t-to":O()}],"mask-image-r-from-pos":[{"mask-r-from":B()}],"mask-image-r-to-pos":[{"mask-r-to":B()}],"mask-image-r-from-color":[{"mask-r-from":O()}],"mask-image-r-to-color":[{"mask-r-to":O()}],"mask-image-b-from-pos":[{"mask-b-from":B()}],"mask-image-b-to-pos":[{"mask-b-to":B()}],"mask-image-b-from-color":[{"mask-b-from":O()}],"mask-image-b-to-color":[{"mask-b-to":O()}],"mask-image-l-from-pos":[{"mask-l-from":B()}],"mask-image-l-to-pos":[{"mask-l-to":B()}],"mask-image-l-from-color":[{"mask-l-from":O()}],"mask-image-l-to-color":[{"mask-l-to":O()}],"mask-image-x-from-pos":[{"mask-x-from":B()}],"mask-image-x-to-pos":[{"mask-x-to":B()}],"mask-image-x-from-color":[{"mask-x-from":O()}],"mask-image-x-to-color":[{"mask-x-to":O()}],"mask-image-y-from-pos":[{"mask-y-from":B()}],"mask-image-y-to-pos":[{"mask-y-to":B()}],"mask-image-y-from-color":[{"mask-y-from":O()}],"mask-image-y-to-color":[{"mask-y-to":O()}],"mask-image-radial":[{"mask-radial":[Se,Ce]}],"mask-image-radial-from-pos":[{"mask-radial-from":B()}],"mask-image-radial-to-pos":[{"mask-radial-to":B()}],"mask-image-radial-from-color":[{"mask-radial-from":O()}],"mask-image-radial-to-color":[{"mask-radial-to":O()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":A()}],"mask-image-conic-pos":[{"mask-conic":[qe]}],"mask-image-conic-from-pos":[{"mask-conic-from":B()}],"mask-image-conic-to-pos":[{"mask-conic-to":B()}],"mask-image-conic-from-color":[{"mask-conic-from":O()}],"mask-image-conic-to-color":[{"mask-conic-to":O()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:W()}],"mask-repeat":[{mask:fe()}],"mask-size":[{mask:j()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Se,Ce]}],filter:[{filter:["","none",Se,Ce]}],blur:[{blur:Q()}],brightness:[{brightness:[qe,Se,Ce]}],contrast:[{contrast:[qe,Se,Ce]}],"drop-shadow":[{"drop-shadow":["","none",v,fl,hl]}],"drop-shadow-color":[{"drop-shadow":O()}],grayscale:[{grayscale:["",qe,Se,Ce]}],"hue-rotate":[{"hue-rotate":[qe,Se,Ce]}],invert:[{invert:["",qe,Se,Ce]}],saturate:[{saturate:[qe,Se,Ce]}],sepia:[{sepia:["",qe,Se,Ce]}],"backdrop-filter":[{"backdrop-filter":["","none",Se,Ce]}],"backdrop-blur":[{"backdrop-blur":Q()}],"backdrop-brightness":[{"backdrop-brightness":[qe,Se,Ce]}],"backdrop-contrast":[{"backdrop-contrast":[qe,Se,Ce]}],"backdrop-grayscale":[{"backdrop-grayscale":["",qe,Se,Ce]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[qe,Se,Ce]}],"backdrop-invert":[{"backdrop-invert":["",qe,Se,Ce]}],"backdrop-opacity":[{"backdrop-opacity":[qe,Se,Ce]}],"backdrop-saturate":[{"backdrop-saturate":[qe,Se,Ce]}],"backdrop-sepia":[{"backdrop-sepia":["",qe,Se,Ce]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":q()}],"border-spacing-x":[{"border-spacing-x":q()}],"border-spacing-y":[{"border-spacing-y":q()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Se,Ce]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[qe,"initial",Se,Ce]}],ease:[{ease:["linear","initial",M,Se,Ce]}],delay:[{delay:[qe,Se,Ce]}],animate:[{animate:["none",T,Se,Ce]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[S,Se,Ce]}],"perspective-origin":[{"perspective-origin":_()}],rotate:[{rotate:pe()}],"rotate-x":[{"rotate-x":pe()}],"rotate-y":[{"rotate-y":pe()}],"rotate-z":[{"rotate-z":pe()}],scale:[{scale:me()}],"scale-x":[{"scale-x":me()}],"scale-y":[{"scale-y":me()}],"scale-z":[{"scale-z":me()}],"scale-3d":["scale-3d"],skew:[{skew:ye()}],"skew-x":[{"skew-x":ye()}],"skew-y":[{"skew-y":ye()}],transform:[{transform:[Se,Ce,"","none","gpu","cpu"]}],"transform-origin":[{origin:_()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ve()}],"translate-x":[{"translate-x":ve()}],"translate-y":[{"translate-y":ve()}],"translate-z":[{"translate-z":ve()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Se,Ce]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":q()}],"scroll-mx":[{"scroll-mx":q()}],"scroll-my":[{"scroll-my":q()}],"scroll-ms":[{"scroll-ms":q()}],"scroll-me":[{"scroll-me":q()}],"scroll-mt":[{"scroll-mt":q()}],"scroll-mr":[{"scroll-mr":q()}],"scroll-mb":[{"scroll-mb":q()}],"scroll-ml":[{"scroll-ml":q()}],"scroll-p":[{"scroll-p":q()}],"scroll-px":[{"scroll-px":q()}],"scroll-py":[{"scroll-py":q()}],"scroll-ps":[{"scroll-ps":q()}],"scroll-pe":[{"scroll-pe":q()}],"scroll-pt":[{"scroll-pt":q()}],"scroll-pr":[{"scroll-pr":q()}],"scroll-pb":[{"scroll-pb":q()}],"scroll-pl":[{"scroll-pl":q()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Se,Ce]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[qe,Sr,ua,Xh]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},yk=WE(mk);function ke(...r){return yk(rb(r))}function u3(r,t){return r?{...t,...r}:t}const Gf=Ff("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Te=C.forwardRef(({className:r,variant:t,size:e,asChild:n=!1,...s},i)=>{const o=n?ME:"button";return g.jsx(o,{className:ke(Gf({variant:t,size:e,className:r})),ref:i,...s})});Te.displayName="Button";var qr=Xv();const vk=Hf(qr);var bk=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xk=bk.reduce((r,t)=>{const e=Uf(`Primitive.${t}`),n=C.forwardRef((s,i)=>{const{asChild:o,...c}=s,u=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(u,{...c,ref:i})});return n.displayName=`Primitive.${t}`,{...r,[t]:n}},{}),wk="Separator",Z0="horizontal",Ck=["horizontal","vertical"],xb=C.forwardRef((r,t)=>{const{decorative:e,orientation:n=Z0,...s}=r,i=Sk(n)?n:Z0,c=e?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return g.jsx(xk.div,{"data-orientation":i,...c,...s,ref:t})});xb.displayName=wk;function Sk(r){return Ck.includes(r)}var wb=xb;const xn=C.forwardRef(({className:r,orientation:t="horizontal",decorative:e=!0,...n},s)=>g.jsx(wb,{ref:s,decorative:e,orientation:t,className:ke("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...n}));xn.displayName=wb.displayName;const ev=r=>{let t;const e=new Set,n=(h,f)=>{const m=typeof h=="function"?h(t):h;if(!Object.is(m,t)){const y=t;t=f??(typeof m!="object"||m===null)?m:Object.assign({},t,m),e.forEach(v=>v(t,y))}},s=()=>t,c={setState:n,getState:s,getInitialState:()=>u,subscribe:h=>(e.add(h),()=>e.delete(h))},u=t=r(n,s,c);return c},Mk=(r=>r?ev(r):ev),Rk=r=>r;function Ek(r,t=Rk){const e=kt.useSyncExternalStore(r.subscribe,kt.useCallback(()=>t(r.getState()),[r,t]),kt.useCallback(()=>t(r.getInitialState()),[r,t]));return kt.useDebugValue(e),e}const tv=r=>{const t=Mk(r),e=n=>Ek(t,n);return Object.assign(e,t),e},us=(r=>r?tv(r):tv);class kk{nodes=[];connections=[];handlers=new Map;postgresQueryEngine=null;messageQueue=new Map;messageHistory=[];isRunning=!1;updateInterval=200;intervalId=null;messageIdCounter=0;MAX_HISTORY=1e3;traceContexts=new Map;traceIdCounter=0;constructor(){this.registerDefaultHandlers()}registerDefaultHandlers(){this.registerHandler("crm",this.createBusinessDataHandler("crm")),this.registerHandler("erp",this.createBusinessDataHandler("erp")),this.registerHandler("payment-gateway",this.createBusinessDataHandler("payment")),this.registerHandler("postgres",this.createDatabaseHandler("postgres")),this.registerHandler("mongodb",this.createDatabaseHandler("mongodb")),this.registerHandler("redis",this.createDatabaseHandler("redis")),this.registerHandler("cassandra",this.createDatabaseHandler("cassandra")),this.registerHandler("clickhouse",this.createDatabaseHandler("clickhouse")),this.registerHandler("snowflake",this.createDatabaseHandler("snowflake")),this.registerHandler("elasticsearch",this.createDatabaseHandler("elasticsearch")),this.registerHandler("s3-datalake",this.createStorageHandler("s3-datalake")),this.registerHandler("kafka",this.createMessageBrokerHandler("kafka")),this.registerHandler("rabbitmq",this.createMessageBrokerHandler("rabbitmq")),this.registerHandler("activemq",this.createMessageBrokerHandler("activemq")),this.registerHandler("aws-sqs",this.createMessageBrokerHandler("aws-sqs")),this.registerHandler("gcp-pubsub",this.createMessageBrokerHandler("gcp-pubsub")),this.registerHandler("rest",this.createAPIHandler("rest")),this.registerHandler("grpc",this.createAPIHandler("grpc")),this.registerHandler("graphql",this.createAPIHandler("graphql")),this.registerHandler("websocket",this.createAPIHandler("websocket")),this.registerHandler("kong",this.createIntegrationHandler("kong")),this.registerHandler("api-gateway",this.createIntegrationHandler("api-gateway")),this.registerHandler("nginx",this.createIntegrationHandler("nginx")),this.registerHandler("haproxy",this.createIntegrationHandler("haproxy")),this.registerHandler("traefik",this.createIntegrationHandler("traefik")),this.registerHandler("envoy",this.createIntegrationHandler("envoy")),this.registerHandler("cdn",this.createIntegrationHandler("cdn")),this.registerHandler("apigee",this.createIntegrationHandler("apigee")),this.registerHandler("mulesoft",this.createIntegrationHandler("mulesoft")),this.registerHandler("graphql-gateway",this.createIntegrationHandler("graphql-gateway")),this.registerHandler("bff-service",this.createIntegrationHandler("bff-service")),this.registerHandler("webhook-relay",this.createIntegrationHandler("webhook-relay")),this.registerHandler("loki",this.createLokiHandler()),this.registerHandler("otel-collector",this.createOpenTelemetryCollectorHandler()),this.registerHandler("keycloak",this.createKeycloakHandler()),this.registerHandler("secrets-vault",this.createVaultHandler()),this.registerHandler("waf",this.createWAFHandler()),this.registerHandler("firewall",this.createFirewallHandler()),this.registerHandler("ids-ips",this.createIDSIPSHandler()),this.registerHandler("jenkins",this.createJenkinsHandler()),this.registerHandler("gitlab-ci",this.createGitLabCIHandler()),this.registerHandler("argo-cd",this.createArgoCDHandler()),this.registerHandler("terraform",this.createTerraformHandler()),this.registerHandler("harbor",this.createHarborHandler()),this.registerHandler("docker",this.createDockerHandler())}registerHandler(t,e){this.handlers.set(t,e)}initialize(t,e){this.nodes=t,this.connections=e,this.messageQueue.clear(),this.messageHistory=[];for(const n of e)this.messageQueue.set(n.id,[])}updateNodesAndConnections(t,e){this.nodes=t,this.connections=e;const n=new Set(e.map(s=>s.id));for(const[s]of this.messageQueue.entries())n.has(s)||this.messageQueue.delete(s);for(const s of e)this.messageQueue.has(s.id)||this.messageQueue.set(s.id,[])}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.processDataFlow()},this.updateInterval))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}processDataFlow(){this.generateSourceData(),this.processInTransitMessages(),this.deliverMessages()}generateSourceData(){for(const t of this.connections){const e=this.nodes.find(o=>o.id===t.source);if(!e)continue;const n=this.handlers.get(e.type);if(!n?.generateData)continue;const s=e.data.config||{},i=n.generateData(e,s);if(i&&i.length>0){const o=this.messageQueue.get(t.id)||[];for(const c of i)c.connectionId=t.id,c.target=t.target,c.status="pending",c.id=`msg-${++this.messageIdCounter}`,c.timestamp=Date.now(),o.push(c);this.messageQueue.set(t.id,o)}}}processInTransitMessages(){for(const[t,e]of this.messageQueue.entries()){const n=this.connections.find(o=>o.id===t);if(!n)continue;const s=this.nodes.find(o=>o.id===n.source),i=this.nodes.find(o=>o.id===n.target);if(!(!s||!i)){for(const o of e)if(o.status==="pending")this.transformMessageIfNeeded(o,s,i,n)&&(o.status="in-transit",o.latency=this.calculateTransitTime(n));else if(o.status==="in-transit"){const c=Date.now()-o.timestamp;o.latency&&c>=o.latency&&(o.status="delivered")}}}}deliverMessages(){for(const[t,e]of this.messageQueue.entries()){const n=this.connections.find(u=>u.id===t);if(!n)continue;const s=this.nodes.find(u=>u.id===n.target);if(!s)continue;const i=this.handlers.get(s.type);if(!i?.processData)continue;const o=s.data.config||{},c=e.filter(u=>u.status==="delivered");for(const u of c)try{const h=this.nodes.find(m=>m.id===n.source),f=i.processData(s,u,o);f&&(h&&this.generateTraceForMessage(u,h,s,n,f),this.addToHistory(u),e.splice(e.indexOf(u),1))}catch(h){u.status="failed",u.error=h instanceof Error?h.message:"Unknown error";const f=this.nodes.find(m=>m.id===n.source);f&&this.generateTraceForMessage(u,f,s,n,u),this.addToHistory(u),e.splice(e.indexOf(u),1)}this.messageQueue.set(t,e)}}transformMessageIfNeeded(t,e,n,s){const i=this.handlers.get(e.type),o=this.handlers.get(n.type),c=i?.getSupportedFormats?.(e)||[t.format],u=o?.getSupportedFormats?.(n)||[t.format];if(u.includes(t.format))return t;const h=u.find(m=>c.includes(m));if(h)return t.format=h,t.status="transformed",t;const f=this.findIntegrationHandler(s);if(f?.transformData){const m=f.transformData(e,t,n.type,e.data.config||{});if(m)return m}if(i?.transformData){const m=i.transformData(e,t,n.type,e.data.config||{});if(m)return m}return t.status="failed",t.error=`Format ${t.format} not supported by target ${n.type}`,null}findIntegrationHandler(t){const e=this.nodes.find(n=>n.id===t.source);return e&&["kong","api-gateway","apigee","mulesoft","bff-service"].includes(e.type)&&this.handlers.get(e.type)||null}calculateTransitTime(t){const e=t.data||{},n=e.latencyMs||10,s=(e.jitterMs||0)*(Math.random()-.5);return Math.max(1,n+s)}generateTraceForMessage(t,e,n,s,i){const o=Re.getAllJaegerEngines();if(o.size===0)return;let c=t.metadata?.traceContext;if(!c){const v=this.generateTraceId(),x=this.generateSpanId();c={traceId:v,spanId:x,sampled:!0},this.traceContexts.set(v,c)}const u=t.timestamp*1e3,h=(t.timestamp+(t.latency||0))*1e3,f=h-u,m=this.getOperationName(t,e,n),y={traceId:c.traceId,spanId:c.spanId,parentSpanId:c.parentSpanId,operationName:m,serviceName:e.data.label||e.type,startTime:u,duration:f,tags:[{key:"component.type",value:e.type},{key:"target.component",value:n.data.label||n.type},{key:"target.type",value:n.type},{key:"message.format",value:t.format},{key:"message.size",value:t.size},{key:"connection.id",value:s.id},{key:"status",value:i.status}],logs:[]};if((i.status==="failed"||i.error)&&(y.tags.push({key:"error",value:!0}),y.logs.push({timestamp:h,fields:[{key:"event",value:"error"},{key:"error.message",value:i.error||"Unknown error"}]})),t.metadata)for(const[v,x]of Object.entries(t.metadata))v!=="traceContext"&&x!==void 0&&x!==null&&y.tags.push({key:`metadata.${v}`,value:String(x)});for(const[,v]of o)v.receiveSpan(y);if(i.status==="delivered"&&n){const v=this.generateSpanId(),x={traceId:c.traceId,spanId:v,parentSpanId:c.spanId,sampled:c.sampled};i.metadata||(i.metadata={}),i.metadata.traceContext=x}}generateTraceId(){return`trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getOperationName(t,e,n){return t.metadata?.operation?String(t.metadata.operation):e.type==="api-gateway"||e.type==="kong"||e.type==="apigee"?`HTTP ${t.metadata?.method||"REQUEST"}`:e.type.includes("database")||e.type==="postgres"||e.type==="mongodb"?`DB ${t.metadata?.queryType||"QUERY"}`:e.type.includes("queue")||e.type==="rabbitmq"||e.type==="kafka"?`MQ ${t.metadata?.queue||"SEND"}`:`${e.type} -> ${n.type}`}addToHistory(t){this.messageHistory.push(t),this.messageHistory.length>this.MAX_HISTORY&&this.messageHistory.shift()}getConnectionMessages(t){return this.messageQueue.get(t)||[]}getMessageHistory(t){const e=[...this.messageHistory].reverse();return t?e.slice(0,t):e}getComponentMessages(t){const e=[];for(const n of this.messageQueue.values())for(const s of n)(s.source===t||s.target===t)&&e.push(s);return e}createBusinessDataHandler(t){return{generateData:(e,n)=>{const s=[],i=n.generateInterval||2e3,o=e._lastGenerate||0,c=Date.now();if(c-o<i)return null;switch(e._lastGenerate=c,t){case"crm":s.push(this.createCRMDataMessage(e));break;case"erp":s.push(this.createERPDataMessage(e));break;case"payment":s.push(this.createPaymentDataMessage(e));break}return s},getSupportedFormats:()=>["json","xml"]}}validateMongoDBSchema(t,e){if(!e||!e.$jsonSchema)return{valid:!0};const n=e.$jsonSchema;if(n.required&&Array.isArray(n.required)){for(const s of n.required)if(!(s in t)||t[s]===void 0||t[s]===null)return{valid:!1,error:`Required field "${s}" is missing`}}if(n.properties){for(const[s,i]of Object.entries(n.properties))if(s in t){const o=t[s],c=i;if(c.type){const u=c.type,h=Array.isArray(o)?"array":typeof o;if(u==="string"&&h!=="string")return{valid:!1,error:`Field "${s}" must be of type string`};if(u==="number"&&h!=="number")return{valid:!1,error:`Field "${s}" must be of type number`};if(u==="boolean"&&h!=="boolean")return{valid:!1,error:`Field "${s}" must be of type boolean`};if(u==="array"&&h!=="array")return{valid:!1,error:`Field "${s}" must be of type array`};if(u==="object"&&(h!=="object"||Array.isArray(o)))return{valid:!1,error:`Field "${s}" must be of type object`}}}}return{valid:!0}}createDatabaseHandler(t){return{processData:(e,n,s)=>{if(t==="postgres"&&n.payload?.sql)return this.processPostgreSQLQuery(e,n,s);if(t==="redis")return this.processRedisCommand(e,n,s);if(t==="cassandra")return this.processCQLQuery(e,n,s);if(t==="clickhouse")return this.processClickHouseQuery(e,n,s);if(t==="snowflake")return this.processSnowflakeQuery(e,n,s);if(t==="elasticsearch")return this.processElasticsearchOperation(e,n,s);const i=n.payload?.operation||"insert";switch(i){case"insert":case"update":{const c=s.queryLatency||10;if(n.latency=c,t==="mongodb"){const h=e.data.config?.collections||[],f=n.payload;let m=f?.collection;if(!m&&h.length>0&&(f?.type?m=h.find(v=>v.name.toLowerCase().includes(f.type.toLowerCase()))?.name||h[0].name:m=h[0].name),m){const y=h.find(v=>v.name===m);if(y){if(y.validation){const v=y.validation;if(v.validationLevel!=="off"){const S={...f?.document||f?.data||f};delete S._id;const R=this.validateMongoDBSchema(S,v.validator);if(!R.valid){if(v.validationAction==="error")return n.status="failed",n.error=`Schema validation failed for collection "${m}": ${R.error}`,n;v.validationAction==="warn"&&(n.metadata={...n.metadata,validationWarning:R.error,collection:m})}}}i==="insert"?n.metadata={...n.metadata,collection:m,documentStored:!0}:i==="update"&&(n.metadata={...n.metadata,collection:m,documentUpdated:!0})}else return n.status="failed",n.error=`Collection "${m}" not found`,n}}return n.status="delivered",n}case"delete":const o=s.queryLatency||10;return n.latency=o,n.status="delivered",n;case"query":{let c=[];if(t==="mongodb"){const h=e.data.config?.collections||[],f=n.payload,m=f?.collection||h[0]?.name;if(m){const y=h.find(v=>v.name===m);if(y?.documents&&y.documents.length>0){if(c=y.documents.map(x=>({...x})),f?.filter)try{const x=typeof f.filter=="string"?JSON.parse(f.filter):f.filter;c=c.filter(S=>{for(const[R,M]of Object.entries(x))if(S[R]!==M)return!1;return!0})}catch{}const v=f?.limit||100;c=c.slice(0,v)}else c=this.generateQueryResults(t,f?.query)}else c=this.generateQueryResults(t,f?.query)}else c=this.generateQueryResults(t,n.payload?.query);return n.payload={...n.payload,results:c},n.status="delivered",n}default:return n.status="failed",n.error=`Unknown operation: ${i}`,n}},getSupportedFormats:()=>["json","binary"]}}processClickHouseQuery(t,e,n){const s=e.payload,i=Re.getClickHouseRoutingEngine(t.id);if(!i)return e.status="failed",e.error="ClickHouse Routing Engine not initialized",e;let o;if(s?.sql)o=s.sql;else if(s?.query)o=s.query;else if(typeof s=="string")o=s;else{const u=s?.operation||"select",h=t.data.config,f=s?.database||h?.database||"default",m=s?.table||"default_table";switch(u.toLowerCase()){case"select":case"read":case"query":o=`SELECT * FROM ${f}.${m}`,s?.where&&(o+=` WHERE ${s.where}`),s?.limit&&(o+=` LIMIT ${s.limit}`);break;case"insert":case"write":const y=s?.columns?Object.keys(s.columns).join(", "):"id, data",v=s?.columns?Object.values(s.columns).map(x=>`'${x}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${f}.${m} (${y}) VALUES (${v})`;break;default:return e.status="failed",e.error=`Unknown ClickHouse operation: ${u}`,e}}const c=i.executeQuery(o);return c.success?(e.status="delivered",e.latency=c.latency||45,e.payload={...e.payload,sql:o,rows:c.rows||[],rowCount:c.rowCount||0,columns:c.columns||[],dataRead:c.dataRead,dataWritten:c.dataWritten,clickHouseResult:c.rows},e.metadata={...e.metadata,clickHouseQuery:o,rowsRead:c.dataRead,rowsWritten:c.dataWritten}):(e.status="failed",e.error=c.error||"ClickHouse query execution failed",e.latency=c.latency||0),e}processSnowflakeQuery(t,e,n){const s=e.payload,i=Re.getSnowflakeRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Snowflake Routing Engine not initialized",e;let o,c,u,h;if(s?.sql)o=s.sql,c=s.warehouse,u=s.database,h=s.schema;else if(s?.query)o=s.query,c=s.warehouse,u=s.database,h=s.schema;else if(typeof s=="string")o=s;else{const m=s?.operation||"select",y=t.data.config;u=s?.database||y?.database||"PUBLIC",h=s?.schema||y?.schema||"PUBLIC",c=s?.warehouse||y?.warehouse;const v=s?.table||"default_table";switch(m.toLowerCase()){case"select":case"read":case"query":o=`SELECT * FROM ${u}.${h}.${v}`,s?.where&&(o+=` WHERE ${s.where}`),s?.limit&&(o+=` LIMIT ${s.limit}`);break;case"insert":case"write":const x=s?.columns?Object.keys(s.columns).join(", "):"id, data",S=s?.columns?Object.values(s.columns).map(R=>`'${R}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${u}.${h}.${v} (${x}) VALUES (${S})`;break;default:return e.status="failed",e.error=`Unknown Snowflake operation: ${m}`,e}}const f=i.executeQuery(o,c,u,h);return f.success?(e.status="delivered",e.latency=f.latency||50,e.payload={...e.payload,sql:o,rows:f.rows||[],rowCount:f.rowCount||0,columns:f.columns||[],dataRead:f.dataRead,dataWritten:f.dataWritten,snowflakeResult:f.rows,queryId:f.queryId,warehouse:f.warehouse,resultCacheUsed:f.resultCacheUsed},e.metadata={...e.metadata,snowflakeQuery:o,rowsRead:f.dataRead,rowsWritten:f.dataWritten,warehouse:f.warehouse,queryId:f.queryId,cacheHit:f.resultCacheUsed||!1}):(e.status="failed",e.error=f.error||"Snowflake query execution failed",e.latency=f.latency||0),e}processElasticsearchOperation(t,e,n){const s=e.payload,i=Re.getElasticsearchRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Elasticsearch Routing Engine not initialized",e;const o=s?.operation||s?.method||"index",c=s?.index||s?._index||t.data.config?.index||"archiphoenix-index",u=s?.id||s?._id,h=s?.document||s?._source||s?.body||s,f=s?.query,m=s?.routing||s?._routing;let y;switch(o.toLowerCase()){case"index":case"create":case"update":if(!u||!h)return e.status="failed",e.error="Index operation requires id and document",e;y=i.indexDocument(c,u,h,m);break;case"get":case"read":if(!u)return e.status="failed",e.error="Get operation requires id",e;y=i.getDocument(c,u,m);break;case"search":case"query":f?y=i.search(c,f):s?.queryString?y=i.executeQuery(s.queryString):y=i.search(c,{query:{match_all:{}}});break;case"delete":if(!u)return e.status="failed",e.error="Delete operation requires id",e;y=i.deleteDocument(c,u,m);break;default:if(typeof s=="string"||s?.queryString){const v=typeof s=="string"?s:s.queryString;y=i.executeQuery(v)}else return e.status="failed",e.error=`Unsupported Elasticsearch operation: ${o}`,e}return y.success?(e.status="delivered",e.latency=y.latency||y.took||10,e.payload={...e.payload,operation:y.operation,index:y.index,id:y.id,document:y.document,hits:y.hits,took:y.took,elasticsearchResult:y},e.metadata={...e.metadata,elasticsearchOperation:y.operation,index:y.index,hits:y.hits,took:y.took}):(e.status="failed",e.error=y.error||"Elasticsearch operation failed",e.latency=y.latency||y.took||0),e}createStorageHandler(t){return t==="s3-datalake"?{processData:(e,n,s)=>this.processS3Operation(e,n,s),getSupportedFormats:()=>["json","binary","text","xml"]}:{processData:(e,n,s)=>(n.status="delivered",n.latency=50,n),getSupportedFormats:()=>["json","binary","text"]}}processS3Operation(t,e,n){const s=e.payload,i=Re.getS3RoutingEngine(t.id);if(!i)return e.status="failed",e.error="S3 Routing Engine not initialized",e;const o=s?.operation||s?.method||"PUT",c=s?.bucket||s?.bucketName||t.data.config?.buckets?.[0]?.name||"default-bucket",u=s?.key||s?.objectKey||e.metadata?.key,h=s?.versionId||e.metadata?.versionId;let f;switch(o.toUpperCase()){case"PUT":case"UPLOAD":if(!u||!e.payload)return e.status="failed",e.error="PUT operation requires key and payload",e;const m=s?.data||s?.body||e.payload,y=s?.contentType||e.metadata?.contentType,v=s?.metadata||e.metadata;f=i.putObject(c,u,m,e.size,v,y);break;case"GET":case"DOWNLOAD":if(!u)return e.status="failed",e.error="GET operation requires key",e;f=i.getObject(c,u,h);break;case"DELETE":if(!u)return e.status="failed",e.error="DELETE operation requires key",e;f=i.deleteObject(c,u,h);break;case"LIST":const x=s?.prefix||e.metadata?.prefix,S=s?.maxKeys||s?.maxKeys||1e3;f=i.listObjects(c,x,S);break;case"HEAD":if(!u)return e.status="failed",e.error="HEAD operation requires key",e;f=i.headObject(c,u);break;default:return e.status="failed",e.error=`Unsupported S3 operation: ${o}`,e}return f.success?(e.status="delivered",e.latency=f.latency||50,f.object?e.payload={...e.payload,operation:o.toUpperCase(),bucket:c,key:u,object:f.object,etag:f.object.etag,versionId:f.versionId||f.object.versionId,size:f.object.size,storageClass:f.object.storageClass}:f.objects?e.payload={...e.payload,operation:"LIST",bucket:c,objects:f.objects,count:f.objects.length}:e.payload={...e.payload,operation:o.toUpperCase(),bucket:c,key:u,success:!0,versionId:f.versionId,deleteMarker:f.deleteMarker},e.metadata={...e.metadata,s3Operation:o.toUpperCase(),bucket:c,key:u,latency:f.latency}):(e.status="failed",e.error=f.error||`S3 ${o} operation failed`,e.latency=f.latency||0),e}processPostgreSQLQuery(t,e,n){if(!this.postgresQueryEngine)return e.status="failed",e.error="PostgreSQL Query Engine not initialized",e;const s=e.payload?.sql;if(!s||typeof s!="string")return e.status="failed",e.error="No SQL query provided",e;const i=t.data.config,o=i.tables||[],c=this.extractIndexesFromConfig(i,o),u=i.views||[],h=this.postgresQueryEngine.execute(s,o,c,u);return h.success?(e.status="delivered",e.latency=h.executionTime||n.queryLatency||10,e.payload={...e.payload,results:h.rows||[],rowCount:h.rowCount||0,queryPlan:h.queryPlan,indexesUsed:h.indexesUsed||[]}):(e.status="failed",e.error=h.error||"Query execution failed",e.latency=h.executionTime||0),e}processRedisCommand(t,e,n){const s=e.payload,i=Re.getRedisRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Redis Routing Engine not initialized",e;let o,c;if(s?.command)o=s.command,c=s.args||[];else if(s?.redisCommand){const h=String(s.redisCommand).trim().split(/\s+/);o=h[0],c=h.slice(1)}else if(typeof s=="string"){const h=s.trim().split(/\s+/);o=h[0],c=h.slice(1)}else{const h=s?.operation||"get";switch(h.toLowerCase()){case"get":o="GET",c=[s?.key||"default:key"];break;case"set":o="SET",c=[s?.key||"default:key",typeof s?.value=="string"?s.value:JSON.stringify(s?.value||"")],s?.ttl&&c.push("EX",String(s.ttl));break;case"delete":case"del":o="DEL",c=Array.isArray(s?.keys)?s.keys:[s?.key||"default:key"];break;case"exists":o="EXISTS",c=Array.isArray(s?.keys)?s.keys:[s?.key||"default:key"];break;default:return e.status="failed",e.error=`Unknown Redis operation: ${h}`,e}}const u=i.executeCommand(o,c);return u.success?(e.status="delivered",e.latency=u.latency||1,e.payload={...e.payload,command:o,args:c,result:u.value,redisResult:u.value}):(e.status="failed",e.error=u.error||"Redis command execution failed",e.latency=u.latency||0),e}processCQLQuery(t,e,n){const s=e.payload,i=Re.getCassandraRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Cassandra Routing Engine not initialized",e;let o,c;if(s?.cql)o=s.cql,c=s.consistency;else if(s?.query)o=s.query,c=s.consistency;else if(typeof s=="string")o=s;else{const h=s?.operation||"select",f=t.data.config,m=s?.keyspace||f?.keyspace||"system",y=s?.table||"default_table";switch(h.toLowerCase()){case"select":case"read":o=`SELECT * FROM ${m}.${y}`,s?.limit&&(o+=` LIMIT ${s.limit}`);break;case"insert":case"write":const v=s?.columns?Object.keys(s.columns).join(", "):"id, data",x=s?.columns?Object.values(s.columns).map(M=>`'${M}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${m}.${y} (${v}) VALUES (${x})`;break;case"update":const S=s?.columns||{},R=Object.entries(S).map(([M,T])=>`${M} = '${T}'`).join(", ");o=`UPDATE ${m}.${y} SET ${R}`,s?.where&&(o+=` WHERE ${s.where}`);break;case"delete":o=`DELETE FROM ${m}.${y}`,s?.where&&(o+=` WHERE ${s.where}`);break;default:return e.status="failed",e.error=`Unknown CQL operation: ${h}`,e}}c||(c=t.data.config?.consistencyLevel||"QUORUM");const u=i.executeCQL(o,c);return u.success?(e.status="delivered",e.latency=u.latency||5,e.payload={...e.payload,cql:o,consistency:u.consistency,rows:u.rows||[],rowCount:u.rowCount||0,replicasQueried:u.replicasQueried,cqlResult:u.rows},e.metadata={...e.metadata,cassandraConsistency:u.consistency,cassandraReplicasQueried:u.replicasQueried}):(e.status="failed",e.error=u.error||"CQL query execution failed",e.latency=u.latency||0),e}extractIndexesFromConfig(t,e){const n=[];for(const s of e)for(const i of s.indexes||[]){const o=i.match(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+(\w+)\s+ON\s+\w+\s*\(([^)]+)\)/i);o?n.push({name:o[1],table:s.name,schema:s.schema,columns:o[2].split(",").map(c=>c.trim()),unique:i.toUpperCase().includes("UNIQUE")}):n.push({name:i,table:s.name,schema:s.schema,columns:[i.replace(/^idx_|^index_/i,"")]})}return n}createMessageBrokerHandler(t){return t==="rabbitmq"?{processData:(e,n,s)=>{const i=Re.getRabbitMQRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=s?.messaging||n.metadata?.messaging||{},c=o.exchange||"amq.topic",u=o.routingKey||n.metadata?.routingKey||"default",h=n.metadata?.headers,f=n.metadata?.priority,m=i.routeMessage(c,u,n.payload,n.size,h,f);return m.length>0?(n.status="delivered",n.metadata={...n.metadata,routedQueues:m,exchange:c,routingKey:u}):(n.status="failed",n.error=`No queues bound to exchange '${c}' with routing key '${u}'`),n},getSupportedFormats:()=>["json","binary","text"]}:t==="activemq"?{processData:(e,n,s)=>{const i=Re.getActiveMQRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=s?.messaging||n.metadata?.messaging||{},c=o.queue,u=o.topic,h=n.metadata?.headers,f=n.metadata?.priority;let m=!1,y="";const v=e.data.config||{},x=v.acls||[],R=this.nodes.find(T=>T.id===n.source)?.data.config,M=n.metadata?.principal||R?.username||R?.clientId||v.username||`user-${n.source.slice(0,8)}`;if(c){if(!(Re.checkActiveMQACLPermissionPublic?.(x,M,`queue://${c}`,"write")??!0))return n.status="failed",n.error=`Access denied: principal '${M}' does not have write permission for queue '${c}'`,n;i.routeToQueue(c,n.payload,n.size,h,f)&&(m=!0,y=c)}if(u){if(!(Re.checkActiveMQACLPermissionPublic?.(x,M,`topic://${u}`,"write")??!0))return n.status="failed",n.error=`Access denied: principal '${M}' does not have write permission for topic '${u}'`,n;i.publishToTopic(u,n.payload,n.size,h,f).length>0&&(m=!0,y=u)}return m?(n.status="delivered",n.metadata={...n.metadata,destination:y,queue:c||void 0,topic:u||void 0}):(n.status="failed",n.error=`No queue or topic found. Queue: '${c||"none"}', Topic: '${u||"none"}'`),n},getSupportedFormats:()=>["json","binary","text"]}:t==="aws-sqs"?{processData:(e,n,s)=>{const i=Re.getSQSRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=s?.messaging||n.metadata?.messaging||{},c=o.queueUrl,u=o.queueName||(c?c.split("/").pop():null)||n.metadata?.queueName||"default-queue",h=e.data.config||{},f=h.iamPolicies||[],y=this.nodes.find(k=>k.id===n.source)?.data.config,v=n.metadata?.principal||y?.accessKeyId||y?.clientId||h.accessKeyId||`arn:aws:iam::123456789012:user/${n.source.slice(0,8)}`;if(!(Re.checkSQSIAMPolicy?.(f,v,u,"sqs:SendMessage")??!0))return n.status="failed",n.error=`Access denied: principal '${v}' does not have sqs:SendMessage permission for queue '${u}'`,n;const S=n.metadata?.messageGroupId,R=n.metadata?.messageDeduplicationId,M=n.metadata?.attributes,T=i.sendMessage(u,n.payload,n.size,M,S,R);return T?(n.status="delivered",n.metadata={...n.metadata,queueName:u,messageId:T,queueUrl:c||`https://sqs.${h.defaultRegion||"us-east-1"}.amazonaws.com/.../${u}`}):(n.status="failed",n.error=`Queue '${u}' not found`),n},getSupportedFormats:()=>["json","binary","text"]}:t==="azure-service-bus"?{processData:(e,n,s)=>{const i=Re.getAzureServiceBusRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=s?.messaging||n.metadata?.messaging||{},c=o.queue,u=o.topic,h=n.metadata?.properties||n.metadata?.headers,f=n.metadata?.sessionId,m=n.metadata?.scheduledEnqueueTime;let y=!1,v="",x=[];if(c){const S=i.sendToQueue(c,n.payload,n.size,h,f,m);S&&(y=!0,v=c,x.push(S))}if(u){const S=i.publishToTopic(u,n.payload,n.size,h,m);S.length>0&&(y=!0,v=u,x=S)}return y?(n.status="delivered",n.metadata={...n.metadata,destination:v,queue:c||void 0,topic:u||void 0,messageIds:x,sessionId:f||void 0}):(n.status="failed",n.error=`No queue or topic found. Queue: '${c||"none"}', Topic: '${u||"none"}'`),n},getSupportedFormats:()=>["json","binary","text"]}:t==="gcp-pubsub"?{processData:(e,n,s)=>{const i=Re.getPubSubRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=s?.messaging||n.metadata?.messaging||{},c=o.topic||n.metadata?.topic,u=o.orderingKey||n.metadata?.orderingKey,h=n.metadata?.attributes||n.metadata?.headers,f=e.data.config||{},m=c||f.topics&&f.topics[0]?.name||null;if(!m)return n.status="failed",n.error="No topic specified for Pub/Sub message",n;const y=i.publishToTopic(m,n.payload,n.size,h,u);return y?(n.status="delivered",n.metadata={...n.metadata,topic:m,messageId:y,orderingKey:u||void 0}):(n.status="failed",n.error=`Topic '${m}' not found`),n},getSupportedFormats:()=>["json","binary","text"]}:{processData:(e,n,s)=>(n.status="delivered",n),getSupportedFormats:()=>["json","binary","text"]}}createAPIHandler(t){return t==="rest"?{processData:(e,n,s)=>{const i=Re.getRestApiRoutingEngine(e.id);if(!i){const x={status:"success",data:n.payload,timestamp:Date.now()};return n.payload=x,n.status="delivered",n}const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=o?.body||o||n.payload,y=o?.clientIP||n.metadata?.clientIP,v=i.routeRequest({path:c,method:u,headers:h,query:f,body:m,clientIP:y});return v.status>=200&&v.status<300?(n.status="delivered",n.latency=v.latency,n.payload=v.data,n.metadata={...n.metadata,restApiEndpoint:v.endpoint,restApiStatus:v.status,restApiHeaders:v.headers}):(n.status="failed",n.error=v.error||`HTTP ${v.status}`,n.latency=v.latency,n.metadata={...n.metadata,restApiEndpoint:v.endpoint,restApiStatus:v.status}),n},transformData:(e,n,s,i)=>(n.format!=="json"&&(n.format="json",n.status="transformed"),n),getSupportedFormats:()=>["json","xml"]}:{processData:(e,n,s)=>{const i={status:"success",data:n.payload,timestamp:Date.now()};return n.payload=i,n.status="delivered",n},transformData:(e,n,s,i)=>(t==="grpc"&&n.format!=="protobuf"&&(n.format="protobuf",n.status="transformed"),n),getSupportedFormats:()=>{switch(t){case"grpc":return["protobuf","binary"];case"graphql":return["json"];case"websocket":return["json","text","binary"];default:return["json"]}}}}createIntegrationHandler(t){return t==="kong"?{processData:(e,n,s)=>{const i=Re.getKongRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h.apikey||h["X-API-Key"]||f.apikey,y=n.metadata?.consumerId,v=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,consumerId:y,apiKey:m});return v.response.status>=200&&v.response.status<300?(n.status="delivered",n.latency=v.response.latency,n.metadata={...n.metadata,kongRoute:v.match?.route.id,kongService:v.match?.service.id,kongTarget:v.target,kongResponseStatus:v.response.status}):(n.status="failed",n.error=v.response.error||`HTTP ${v.response.status}`,n.latency=v.response.latency),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:t==="api-gateway"?{processData:(e,n,s)=>{const i=Re.getCloudAPIGatewayEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["x-api-key"]||h["X-API-Key"]||h["ocp-apim-subscription-key"]||f.key||f["subscription-key"]||f.apikey,y={path:c,method:u.toUpperCase(),headers:h,query:f,body:o?.body,apiKey:m},v=i.processRequest(y);if(v.status>=200&&v.status<300){if(n.status="delivered",n.latency=(n.latency||0)+v.latency,n.metadata={...n.metadata,gatewayProvider:v.metadata?.gatewayProvider,gatewayApiId:v.metadata?.apiId,gatewayKeyId:v.metadata?.keyId,gatewayCacheHit:v.metadata?.cacheHit||!1,gatewayRateLimitRemaining:v.metadata?.rateLimitRemaining,gatewayResponseStatus:v.status},v.metadata?.cacheHit)return n.status="delivered",n.payload=v.body||n.payload,n}else return n.status="failed",n.error=v.error||`HTTP ${v.status}`,n.latency=(n.latency||0)+v.latency,n.metadata={...n.metadata,gatewayProvider:v.metadata?.gatewayProvider,gatewayApiId:v.metadata?.apiId,gatewayError:v.error,gatewayResponseStatus:v.status},n;return n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:t==="nginx"?{processData:(e,n,s)=>{const i=Re.getNginxRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",v=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,clientIP:m,protocol:y});return v.response.status>=200&&v.response.status<300?(n.status="delivered",n.latency=v.response.latency,n.metadata={...n.metadata,nginxLocation:v.match?.location.path,nginxUpstream:v.upstreamTarget,nginxResponseStatus:v.response.status,nginxCacheHit:v.response.cacheHit},v.response.body&&(n.payload=v.response.body)):(n.status="failed",n.error=v.response.error||`HTTP ${v.response.status}`,n.latency=v.response.latency),n},transformData:(e,n,s,i)=>{(e.data.config||{}).enableGzip&&n.metadata?.nginxCacheHit&&(n.metadata={...n.metadata,contentEncoding:"gzip"});const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="envoy"?{processData:(e,n,s)=>{const i=Re.getEnvoyRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",v=h.Host||n.metadata?.host,x=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,clientIP:m,protocol:y,host:v});return x.response.status>=200&&x.response.status<300?(n.status="delivered",n.latency=(n.latency||0)+(x.response.latency||0),n.metadata={...n.metadata,envoyListener:x.listener?.name,envoyRoute:x.route?.name,envoyCluster:x.cluster?.name,envoyEndpoint:x.endpointTarget,envoyResponseStatus:x.response.status},x.response.body&&(n.payload=x.response.body)):(n.status="failed",n.error=x.response.error||`HTTP ${x.response.status}`,n.latency=(n.latency||0)+(x.response.latency||0)),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text","grpc"]}:t==="haproxy"?{processData:(e,n,s)=>{const i=Re.getHAProxyRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",v=h.Host||n.metadata?.host,x=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,clientIP:m,protocol:y,host:v});return x.response.status>=200&&x.response.status<300?(n.status="delivered",n.latency=x.response.latency,n.metadata={...n.metadata,haproxyFrontend:x.frontend?.name,haproxyBackend:x.backendTarget,haproxyServer:x.serverTarget,haproxyResponseStatus:x.response.status},x.response.body&&(n.payload=x.response.body)):(n.status="failed",n.error=x.response.error||`HTTP ${x.response.status}`,n.latency=x.response.latency),n},transformData:(e,n,s,i)=>{e.data.config;const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="traefik"?{processData:(e,n,s)=>{const i=Re.getTraefikEmulationEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",v=h.Host||n.metadata?.host,x=n.metadata?.entryPoint||(y==="https"?"websecure":"web"),S=i.processRequest({path:c,method:u,headers:h,query:f,body:o?.body,clientIP:m,protocol:y,host:v,entryPoint:x});return S.success?(n.status="delivered",n.latency=S.latency,n.metadata={...n.metadata,traefikRouter:S.routerMatched,traefikService:S.serviceTarget,traefikServer:S.serverTarget,traefikResponseStatus:S.status},o?.body&&(n.payload=o.body)):(n.status="failed",n.error=S.error||`HTTP ${S.status}`,n.latency=S.latency),n},transformData:(e,n,s,i)=>{e.data.config;const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="cdn"?{processData:(e,n,s)=>{const i=Re.getCDNEmulationEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["User-Agent"]||n.metadata?.userAgent,x=(e.data.config||{}).distributions||[],S=h.Host||n.metadata?.host||(x.length>0?x[0].domain:"cdn.example.com"),R=i.processRequest({method:u.toUpperCase(),path:c,domain:S,headers:h,query:f,body:o?.body,clientIP:m,userAgent:y});return R.success?(n.status="delivered",n.latency=(n.latency||0)+R.latency,n.metadata={...n.metadata,cdnCacheHit:R.cacheHit,cdnLatency:R.latency,cdnSize:R.size},R.cacheHit&&(n.payload={status:"ok",cached:!0})):(n.status="failed",n.error=R.error||"CDN request failed",n.latency=(n.latency||0)+R.latency),n},transformData:(e,n,s,i)=>{const o=e.data.config||{};o.enableCompression&&n.metadata?.cdnCacheHit&&(n.metadata={...n.metadata,contentEncoding:o.compressionType||"gzip"});const c=this.getTargetFormats(s);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text","html"]}:t==="service-mesh"?{processData:(e,n,s)=>{const i=Re.getServiceMeshRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",v=h.Host||n.metadata?.host,x=h.Host||n.metadata?.authority,S=h["X-Source-Principal"]||n.metadata?.sourcePrincipal,R=h["X-Destination-Principal"]||n.metadata?.destinationPrincipal,M=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,clientIP:m,protocol:y==="https"?"https":y==="grpc"?"grpc":"http",host:v,authority:x,sourcePrincipal:S,destinationPrincipal:R});return M.response.status>=200&&M.response.status<300?(n.status="delivered",n.latency=M.response.latency,n.metadata={...n.metadata,serviceMeshVirtualService:M.virtualService?.name,serviceMeshDestinationRule:M.destinationRule?.name,serviceMeshService:M.serviceTarget,serviceMeshSubset:M.subsetTarget,serviceMeshEndpoint:M.endpointTarget,serviceMeshResponseStatus:M.response.status,serviceMeshRetryAttempts:M.response.retryAttempts,serviceMeshCircuitBreakerOpen:M.response.circuitBreakerOpen},M.response.body&&(n.payload=M.response.body)):(n.status="failed",n.error=M.response.error||`HTTP ${M.response.status}`,n.latency=M.response.latency,n.metadata={...n.metadata,serviceMeshVirtualService:M.virtualService?.name,serviceMeshDestinationRule:M.destinationRule?.name,serviceMeshService:M.serviceTarget,serviceMeshSubset:M.subsetTarget,serviceMeshEndpoint:M.endpointTarget,serviceMeshResponseStatus:M.response.status,serviceMeshError:M.response.error,serviceMeshRetryAttempts:M.response.retryAttempts,serviceMeshCircuitBreakerOpen:M.response.circuitBreakerOpen}),n},transformData:(e,n,s,i)=>{e.data.config;const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="istio"?{processData:(e,n,s)=>{const i=Re.getIstioRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||n.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||n.metadata?.protocol==="https"?"https":"http",v=h.Host||n.metadata?.host,x=h.Host||n.metadata?.authority,S=h["X-Source-Principal"]||n.metadata?.sourcePrincipal,R=h["X-Destination-Principal"]||n.metadata?.destinationPrincipal,M=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,clientIP:m,protocol:y==="https"?"https":y==="grpc"?"grpc":"http",host:v,authority:x,sourcePrincipal:S,destinationPrincipal:R});return M.response.status>=200&&M.response.status<300?(n.status="delivered",n.latency=M.response.latency,n.metadata={...n.metadata,istioVirtualService:M.virtualService?.name,istioDestinationRule:M.destinationRule?.name,istioService:M.serviceTarget,istioSubset:M.subsetTarget,istioEndpoint:M.endpointTarget,istioResponseStatus:M.response.status,istioRetryAttempts:M.response.retryAttempts,istioCircuitBreakerOpen:M.response.circuitBreakerOpen},M.response.body&&(n.payload=M.response.body)):(n.status="failed",n.error=M.response.error||`HTTP ${M.response.status}`,n.latency=M.response.latency,n.metadata={...n.metadata,istioVirtualService:M.virtualService?.name,istioDestinationRule:M.destinationRule?.name,istioService:M.serviceTarget,istioSubset:M.subsetTarget,istioEndpoint:M.endpointTarget,istioResponseStatus:M.response.status,istioError:M.response.error,istioRetryAttempts:M.response.retryAttempts,istioCircuitBreakerOpen:M.response.circuitBreakerOpen}),n},transformData:(e,n,s,i)=>{e.data.config;const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text","grpc"]}:t==="apigee"?{processData:(e,n,s)=>{const i=Re.getApigeeRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=h.apikey||h["X-API-Key"]||f.apikey,y=h.Authorization||"",v=y.startsWith("OAuth ")?y.replace("OAuth ",""):void 0,x=y.startsWith("Bearer ")?y.replace("Bearer ",""):h["X-JWT-Token"],S=i.routeRequest({path:c,method:u,headers:h,query:f,body:o?.body,apiKey:m,oauthToken:v,jwtToken:x});return S.response.status>=200&&S.response.status<300?(n.status="delivered",n.latency=S.response.latency,n.metadata={...n.metadata,apigeeProxy:S.match?.proxy.name,apigeeTarget:S.target,apigeeResponseStatus:S.response.status,apigeeEnvironment:S.match?.proxy.environment}):(n.status="failed",n.error=S.response.error||`HTTP ${S.response.status}`,n.latency=S.response.latency),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:t==="graphql-gateway"?{processData:(e,n,s)=>{const i=Re.getGraphQLGatewayRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.query||o?.body||n.metadata?.query,u=o?.variables||n.metadata?.variables,h=o?.operationName||n.metadata?.operationName,f=o?.headers||n.metadata?.headers||{},m=i.routeRequest({query:c||"",variables:u,headers:f,operationName:h});if(n.latency=m.latency,m.status>=200&&m.status<300){n.status="delivered";const x=i.getServiceRegistry().getConnectedServices().map(S=>S.endpoint);n.metadata={...n.metadata,graphqlGatewayStatus:m.status,graphqlGatewayEndpoints:x}}else n.status="failed",n.error=m.error||`HTTP ${m.status}`;return n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json"]}:t==="mulesoft"?{processData:(e,n,s)=>{const i=Re.getMuleSoftRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=this.nodes.find(f=>f.id===n.source),u=this.nodes.find(f=>f.id===n.target),h=i.processData({path:o?.path||n.metadata?.path,method:o?.method||n.metadata?.method||"POST",headers:o?.headers||n.metadata?.headers||{},query:o?.query||n.metadata?.query||{},body:o?.body||o||n.payload,format:n.format,sourceComponentType:c?.type,sourceComponentId:c?.id,targetComponentType:u?.type,targetComponentId:u?.id});return h.response.status==="success"?(n.status="delivered",n.latency=h.response.latency,n.payload=h.response.data,h.response.format&&(n.format=h.response.format),n.metadata={...n.metadata,mulesoftApplication:h.response.application,mulesoftFlow:h.response.flow,mulesoftConnector:h.response.connector}):(n.status="failed",n.error=h.response.error||"MuleSoft processing failed",n.latency=h.response.latency||0),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="bff-service"?{processData:(e,n,s)=>{const i=Re.getBFFRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.path||n.metadata?.path||"/",u=o?.method||n.metadata?.method||"GET",h=o?.headers||n.metadata?.headers||{},f=o?.query||n.metadata?.query||{},m=o?.body||o||n.payload,y=i.routeRequest({path:c,method:u,headers:h,query:f,body:m});return y.status>=200&&y.status<300?(n.status="delivered",n.latency=y.latency,n.payload=y.data,n.metadata={...n.metadata,bffCacheHit:y.cacheHit,bffBackendResponses:y.backendResponses.length,bffStatus:y.status}):(n.status="failed",n.error=y.error||`HTTP ${y.status}`,n.latency=y.latency),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json"]}:t==="webhook-relay"?{processData:(e,n,s)=>{const i=Re.getWebhookRelayRoutingEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.url||n.metadata?.url||o?.path||"/",u=o?.method||n.metadata?.method||"POST",h=o?.headers||n.metadata?.headers||{},f=o?.body||o||n.payload,m=o?.ip||n.metadata?.ip||h["x-forwarded-for"]?.split(",")[0]?.trim(),y=o?.event||n.metadata?.event||h["x-event"]||h["x-github-event"]||"",v=i.relayWebhook({url:c,method:u,headers:h,body:f,ip:m,event:y});return v.success?(n.status="delivered",n.latency=v.latency,n.metadata={...n.metadata,webhookRelayId:v.relayId,webhookDeliveryId:v.deliveryId,webhookAttempts:v.attempts,webhookStatus:v.status}):(n.status="failed",n.error=v.error||`Webhook relay failed (HTTP ${v.status})`,n.latency=v.latency,n.metadata={...n.metadata,webhookRelayId:v.relayId,webhookDeliveryId:v.deliveryId,webhookAttempts:v.attempts,webhookStatus:v.status}),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","text","binary"]}:t==="vpn"?{processData:(e,n,s)=>{const i=Re.getVPNEmulationEngine(e.id);if(!i)return n.status="delivered",n;const o=n.payload,c=o?.source||n.metadata?.source||n.source||"0.0.0.0",u=o?.destination||n.metadata?.destination||n.target||"0.0.0.0",h=o?.protocol||n.metadata?.protocol||"tcp",f=o?.port||n.metadata?.port,m=o?.sourcePort||n.metadata?.sourcePort,y=o?.encrypted||n.metadata?.encrypted||!1,v=o?.connectionId||n.metadata?.connectionId,x=o?.tunnelId||n.metadata?.tunnelId,S=i.processPacket({source:c,destination:u,protocol:h,port:f,sourcePort:m,payload:n.payload,encrypted:y,connectionId:v,tunnelId:x});return S.success?(n.status="delivered",n.latency=(n.latency||0)+S.latency,n.metadata={...n.metadata,vpnEncrypted:S.encrypted,vpnConnectionId:S.connectionId,vpnTunnelId:S.tunnelId,vpnBytesProcessed:S.bytesProcessed},S.encrypted&&(n.metadata={...n.metadata,encrypted:!0})):(n.status="failed",n.error=S.error||"VPN processing failed",n.latency=(n.latency||0)+S.latency),n},transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:{transformData:(e,n,s,i)=>{const o=this.getTargetFormats(s);return o.length>0&&!o.includes(n.format)&&(n.format=o[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}}getTargetFormats(t){return this.handlers.get(t)?.getSupportedFormats?.({type:t})||["json"]}createLokiHandler(){return{processData:(t,e,n)=>{const s=Re.getLokiEmulationEngine(t.id);if(!s)return e.status="delivered",e;const i=e.payload;if(i?.query||i?.logql){const o=i.query||i.logql,c=i.startTime||i.start,u=i.endTime||i.end,h=i.limit||100,f=s.executeQuery(o,c,u,h);f.success?(e.status="delivered",e.latency=f.latency,e.payload={...e.payload,query:o,results:f.result||[],resultsCount:f.resultsCount}):(e.status="failed",e.error=f.error||"LogQL query execution failed",e.latency=f.latency||0)}else{const o=[],c=i?.stream||i?.labels||e.metadata?.labels||{app:t.data.label?.toLowerCase().replace(/\s+/g,"-")||"unknown",source:e.source.slice(0,8)};let u=[];if(i?.values&&Array.isArray(i.values))u=i.values;else if(i?.logs&&Array.isArray(i.logs)){const h=Date.now()*1e6;u=i.logs.map((f,m)=>[(h+m).toString(),String(f)])}else if(i?.log)u=[[(Date.now()*1e6).toString(),String(i.log)]];else if(typeof i=="string")u=[[(Date.now()*1e6).toString(),i]];else{const h=JSON.stringify(i);u=[[(Date.now()*1e6).toString(),h]]}if(u.length>0){o.push({stream:c,values:u});const h=s.processIngestion(o,e.source);h.success?(e.status="delivered",e.latency=10,e.payload={...e.payload,ingestedLines:h.ingestedLines,ingestedBytes:h.ingestedBytes}):(e.status="failed",e.error=h.error||"Log ingestion failed")}else e.status="failed",e.error="No log entries found in payload"}return e},getSupportedFormats:()=>["json","text"]}}createKeycloakHandler(){return{processData:(t,e,n)=>{const s=Re.getKeycloakEmulationEngine(t.id);if(!s)return e.status="failed",e.error="Keycloak engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||i.grant_type;let c="login";if(typeof o=="string"){const y=o.toLowerCase();y.includes("refresh")||y==="refresh_token"?c="refresh":y.includes("introspect")?c="introspect":y.includes("userinfo")||y.includes("user_info")?c="userinfo":c="login"}const u=i.clientId||i.client_id||e.metadata?.clientId,h=i.username||i.user||e.metadata?.username,f=i.sub||i.subject||e.metadata?.subject||h,m=s.processAuthRequest(c,{clientId:u,username:h,subject:f,grantType:typeof o=="string"?o:void 0});return e.latency=m.latency,m.success?(e.status="delivered",e.payload={...i||{},keycloak:{realm:m.realm,clientId:m.clientId,subject:m.subject,tokenType:m.tokenType,expiresIn:m.expiresIn}},e.metadata={...e.metadata,authRealm:m.realm,authClientId:m.clientId,authSubject:m.subject,authResult:"success"}):(e.status="failed",e.error=m.error||"Keycloak auth failed"),e},getSupportedFormats:()=>["json","text"]}}createJenkinsHandler(){return{processData:(t,e,n)=>{const s=Re.getJenkinsEmulationEngine(t.id);if(!s)return e.status="failed",e.error="Jenkins engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit){const c=i.pipelineId||i.pipeline||i.job,u=i.branch||i.ref?.replace("refs/heads/","")||"main",h=i.commit||i.sha||void 0;if(c){const f=s.triggerWebhook(c,u,h);f.success?(e.status="delivered",e.latency=50,e.payload={...i||{},jenkins:{webhookReceived:!0,pipelineId:c,branch:u,commit:h,triggered:!0}}):(e.status="failed",e.error=f.reason||"Failed to trigger build",e.latency=50)}else e.status="delivered",e.latency=50,e.payload={...i||{},jenkins:{webhookReceived:!0,branch:u,commit:h,triggered:!1,reason:"No pipeline ID specified"}}}else if(o==="getBuildStatus"||i.buildId||i.buildNumber){const c=i.buildId||i.buildNumber,u=i.pipelineId||i.pipeline,h=s.getBuildById(c||`${u}-${i.buildNumber}`),f=h?.status||"unknown";e.status="delivered",e.latency=20,e.payload={...i||{},jenkins:{buildId:c,pipelineId:u,status:f,progress:h?.progress,duration:h?.duration}}}else e.status="delivered",e.latency=30,e.payload={...i||{},jenkins:{processed:!0,operation:o}};return s.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createGitLabCIHandler(){return{processData:(t,e,n)=>{const s=Re.getGitLabCIEmulationEngine(t.id);if(!s)return e.status="failed",e.error="GitLab CI engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit){const c=i.ref||i.branch?.replace("refs/heads/","")||"main",u=i.variables||{},h=s.triggerWebhook(c,u);h.success?(e.status="delivered",e.latency=50,e.payload={...i||{},gitlab:{webhookReceived:!0,pipelineId:h.pipelineId,ref:c,variables:u,triggered:!0}}):(e.status="failed",e.error=h.reason||"Failed to trigger pipeline",e.latency=50)}else if(o==="getPipelineStatus"||i.pipelineId||i.pipelineIid){const c=i.pipelineId||i.pipelineIid?.toString(),u=s.getPipeline(c||"");e.status="delivered",e.latency=20,e.payload={...i||{},gitlab:{pipelineId:c,status:u?.status||"unknown",duration:u?.duration,stages:u?.stages.map(h=>({name:h.name,status:h.status,duration:h.duration}))}}}else if(o==="getJobStatus"||i.jobId){const c=i.jobId,u=s.getJob(c||"");e.status="delivered",e.latency=20,e.payload={...i||{},gitlab:{jobId:c,status:u?.status||"unknown",progress:u?.progress,duration:u?.duration,logs:u?.logs?.slice(-10)}}}else if(o==="cancelPipeline"||i.cancel){const c=i.pipelineId,u=s.cancelPipeline(c||"");e.status=u.success?"delivered":"failed",e.error=u.reason,e.latency=30,e.payload={...i||{},gitlab:{pipelineId:c,canceled:u.success}}}else e.status="delivered",e.latency=30,e.payload={...i||{},gitlab:{processed:!0,operation:o}};return s.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createArgoCDHandler(){return{processData:(t,e,n)=>{const s=Re.getArgoCDEmulationEngine(t.id);if(!s)return e.status="failed",e.error="Argo CD engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit||i.repository){const c=i.repository||i.repo||"",u=i.ref||i.branch||i.commit||"main",h=i.application||i.app||"";h?s.startSync(h)?(e.status="delivered",e.latency=50,e.payload={...i||{},argocd:{webhookReceived:!0,application:h,repository:c,ref:u,syncTriggered:!0}}):(e.status="failed",e.error="Failed to trigger sync or application already syncing",e.latency=50):(e.status="delivered",e.latency=30,e.payload={...i||{},argocd:{webhookReceived:!0,repository:c,ref:u,syncTriggered:!1,reason:"No application specified"}})}else if(o==="sync"||o==="startSync"){const c=i.application||i.app||e.metadata?.application;if(!c)return e.status="failed",e.error="Application name is required for sync operation",e;s.startSync(c)?(e.status="delivered",e.latency=50,e.payload={...i||{},argocd:{operation:"sync",application:c,syncStarted:!0}}):(e.status="failed",e.error="Failed to start sync or application already syncing",e.latency=50)}else if(o==="getApplicationStatus"||o==="getAppStatus"||i.application){const c=i.application||i.app||"",u=s.getApplication(c);e.status="delivered",e.latency=20,e.payload={...i||{},argocd:{application:c,status:u?.status||"unknown",health:u?.health||"unknown",lastSync:u?.lastSync,lastSyncDuration:u?.lastSyncDuration,revision:u?.revision,sourceRevision:u?.sourceRevision}}}else if(o==="getSyncStatus"||i.syncOperationId){const c=i.syncOperationId||i.operationId,h=s.getSyncOperations().find(f=>f.id===c);e.status="delivered",e.latency=20,e.payload={...i||{},argocd:{syncOperationId:c,status:h?.status||"unknown",phase:h?.phase,startedAt:h?.startedAt,finishedAt:h?.finishedAt,error:h?.error}}}else if(o==="getMetrics"||o==="getStats"){const c=s.getMetrics(),u=s.getStats();e.status="delivered",e.latency=15,e.payload={...i||{},argocd:{metrics:c,stats:u}}}else e.status="delivered",e.latency=30,e.payload={...i||{},argocd:{processed:!0,operation:o}};return s.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createTerraformHandler(){return{processData:(t,e,n)=>{const s=Re.getTerraformEmulationEngine(t.id);if(!s)return e.status="failed",e.error="Terraform engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit||i.repository){const c=i.workspace||i.workspaceId||"",u=i.workspaceId||i.workspace,h=i.ref?.replace("refs/heads/","")||i.branch||"main",f=i.commit||i.sha||void 0;if(c||u){const m=s.getWorkspaces(),y=u?m.find(v=>v.id===u):m.find(v=>v.name===c);if(y){const v=s.triggerRun(y.id,{planOnly:i.planOnly??!1,source:"vcs",triggeredBy:"vcs-webhook"});v.success?(e.status="delivered",e.latency=50,e.payload={...i||{},terraform:{webhookReceived:!0,workspaceId:y.id,workspaceName:y.name,branch:h,commit:f,runTriggered:!0,runId:v.runId}}):(e.status="failed",e.error=v.reason||"Failed to trigger run",e.latency=50)}else e.status="failed",e.error="Workspace not found",e.latency=50}else e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{webhookReceived:!0,branch:h,commit:f,runTriggered:!1,reason:"No workspace specified"}}}else if(o==="triggerRun"||o==="createRun"||o==="run"){const c=i.workspaceId||i.workspace||e.metadata?.workspaceId,u=i.planOnly??!1;if(!c)return e.status="failed",e.error="Workspace ID is required for run operation",e;const h=s.triggerRun(c,{planOnly:u,source:"api",triggeredBy:i.triggeredBy||"user"});h.success?(e.status="delivered",e.latency=50,e.payload={...i||{},terraform:{operation:"triggerRun",workspaceId:c,planOnly:u,runId:h.runId,runTriggered:!0}}):(e.status="failed",e.error=h.reason||"Failed to trigger run",e.latency=50)}else if(o==="cancelRun"||o==="cancel"){const c=i.runId||i.run||e.metadata?.runId;if(!c)return e.status="failed",e.error="Run ID is required for cancel operation",e;const u=s.cancelRun(c);u.success?(e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{operation:"cancelRun",runId:c,canceled:!0}}):(e.status="failed",e.error=u.reason||"Failed to cancel run",e.latency=30)}else if(o==="getRunStatus"||o==="getRun"||i.runId){const c=i.runId||i.run||"",u=s.getRun(c);e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{runId:c,status:u?.status||"unknown",workspaceId:u?.workspaceId,workspaceName:u?.workspaceName,createdAt:u?.createdAt,startedAt:u?.startedAt,finishedAt:u?.finishedAt,duration:u?.duration,planOnly:u?.planOnly,message:u?.message,error:u?.error,hasChanges:u?.hasChanges,resourceAdditions:u?.resourceAdditions,resourceChanges:u?.resourceChanges,resourceDestructions:u?.resourceDestructions}}}else if(o==="getWorkspaceStatus"||o==="getWorkspace"||i.workspaceId){const c=i.workspaceId||i.workspace||"",u=s.getWorkspace(c),h=u?s.getStateForWorkspace(c):void 0;e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{workspaceId:c,workspace:u?{id:u.id,name:u.name,description:u.description,terraformVersion:u.terraformVersion,autoApply:u.autoApply,lastRun:u.lastRun}:null,state:h?{version:h.version,serial:h.serial,resources:h.resources,updatedAt:h.updatedAt}:null}}}else if(o==="getMetrics"||o==="getStats"){const c=s.getMetrics();e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{metrics:{workspacesTotal:c.workspacesTotal,runsTotal:c.runsTotal,runsSuccess:c.runsSuccess,runsFailed:c.runsFailed,runsRunning:c.runsRunning,runsPending:c.runsPending,runsPerHour:c.runsPerHour,averageRunDuration:c.averageRunDuration,statesTotal:c.statesTotal,resourcesManaged:c.resourcesManaged}}}}else e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{processed:!0,operation:o}};return s.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createHarborHandler(){return{processData:(t,e,n)=>{if(!Re.getHarborEmulationEngine(t.id))return e.status="failed",e.error="Harbor engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"pull";return o==="push"?(e.status="delivered",e.latency=500+Math.random()*1500,e.payload={...i||{},harbor:{operation:"push",repository:i.repository||"unknown",tag:i.tag||"latest",size:i.size||0,status:"completed"}}):o==="pull"?(e.status="delivered",e.latency=200+Math.random()*800,e.payload={...i||{},harbor:{operation:"pull",repository:i.repository||"unknown",tag:i.tag||"latest",status:"completed"}}):o==="scan"?(e.status="delivered",e.latency=5e3+Math.random()*15e3,e.payload={...i||{},harbor:{operation:"scan",repository:i.repository||"unknown",tag:i.tag||"latest",status:"completed"}}):(e.status="delivered",e.latency=100+Math.random()*200,e.payload={...i||{},harbor:{operation:o,status:"completed"}}),e},getSupportedFormats:()=>["json","binary"]}}createDockerHandler(){return{processData:(t,e,n)=>{if(!Re.getDockerEmulationEngine(t.id))return e.status="failed",e.error="Docker engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"container-operation";if(o.startsWith("container-")){const c=o.replace("container-","");switch(e.status="delivered",c){case"create":e.latency=500+Math.random()*1e3;break;case"start":e.latency=200+Math.random()*500;break;case"stop":e.latency=100+Math.random()*300;break;case"restart":e.latency=300+Math.random()*700;break;default:e.latency=100+Math.random()*200}e.payload={...i||{},docker:{operation:c,containerId:i.containerId||"unknown",status:"completed"}}}else if(o.startsWith("image-")){const c=o.replace("image-","");switch(e.status="delivered",c){case"pull":e.latency=2e3+Math.random()*8e3;break;case"push":e.latency=3e3+Math.random()*1e4;break;case"build":e.latency=5e3+Math.random()*15e3;break;default:e.latency=1e3+Math.random()*2e3}e.payload={...i||{},docker:{operation:c,imageId:i.imageId||"unknown",status:"completed"}}}else e.status="delivered",e.latency=100+Math.random()*200,e.payload={...i||{},docker:{operation:o,status:"completed"}};return e},getSupportedFormats:()=>["json","text"]}}createVaultHandler(){return{processData:(t,e,n)=>{const s=Re.getVaultEmulationEngine(t.id);if(!s)return e.status="failed",e.error="Vault engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"read",c=i?.path||e.metadata?.path||"secret/default",u=i?.token||e.metadata?.token;let h;if(typeof o=="string"){const f=o.toLowerCase();if(f.includes("write")||f==="create"||f==="update"){const m=i?.data||i?.value||{};h=s.processWriteRequest(c,m,u)}else if(f.includes("delete")||f==="remove")h=s.processDeleteRequest(c,u);else if(f.includes("encrypt")){const m=i?.plaintext||i?.data||"",y=i?.key||i?.keyName||"default";h=s.processEncryptRequest(m,y,u)}else if(f.includes("decrypt")){const m=i?.ciphertext||i?.data||"",y=i?.key||i?.keyName||"default";h=s.processDecryptRequest(m,y,u)}else if(f.includes("auth")||f==="login"||f==="authenticate"){const m=i?.method||i?.authMethod||"token";h=s.processAuthRequest(m,i)}else{const m=i?.key;h=s.processReadRequest(c,m,u)}}else{const f=i?.key;h=s.processReadRequest(c,f,u)}return e.latency=(e.latency||0)+h.latency,h.success?(e.status="delivered",e.payload={...i||{},vault:{path:c,data:h.data,token:h.token,policies:h.policies}},h.token&&(e.metadata={...e.metadata,vaultToken:h.token,vaultPolicies:h.policies})):(e.status="failed",e.error=h.error||"Vault operation failed"),e},getSupportedFormats:()=>["json","text"]}}createWAFHandler(){return{processData:(t,e,n)=>{const s=Re.getWAFEmulationEngine(t.id);if(!s)return e.status="delivered",e;const i=e.payload||{},o=i?.path||e.metadata?.path||"/",c=i?.method||e.metadata?.method||"GET",u=i?.headers||e.metadata?.headers||{},h=i?.query||e.metadata?.query||{},f=i?.body||i,m=i?.sourceIP||e.metadata?.sourceIP||u["x-forwarded-for"]||u["x-real-ip"],y=i?.country||e.metadata?.country||u["cf-ipcountry"],v=i?.userAgent||e.metadata?.userAgent||u["user-agent"],x=s.processRequest({path:o,method:c,headers:u,query:h,body:f,sourceIP:m,country:y,userAgent:v});return e.latency=(e.latency||0)+x.latency,x.blocked?(e.status="failed",e.error=x.error||`Request blocked by WAF: ${x.threatDetected?"Threat detected":"Rule matched"}`,x.threatDetected&&(e.metadata={...e.metadata,wafBlocked:!0,wafThreatDetected:!0,wafAction:"block"})):!x.success&&x.action==="challenge"?(e.status="pending",e.metadata={...e.metadata,wafChallenge:!0,wafAction:"challenge"}):(e.status="delivered",e.metadata={...e.metadata,wafChecked:!0,wafAllowed:!0,wafLatency:x.latency},x.threatDetected&&(e.metadata.wafThreatDetected=!0,e.metadata.wafAction="log")),e},getSupportedFormats:()=>["json","text","xml"]}}createFirewallHandler(){return{processData:(t,e,n)=>{const s=Re.getFirewallEmulationEngine(t.id);if(!s)return e.status="delivered",e;const i=e.payload||{},o=i?.source||e.metadata?.sourceIP||i?.sourceIP||"0.0.0.0",c=i?.destination||e.metadata?.destinationIP||i?.destinationIP||"10.0.0.1",u=i?.protocol||e.metadata?.protocol||"tcp",h=i?.port||e.metadata?.port||i?.destinationPort,f=i?.sourcePort||e.metadata?.sourcePort,m=s.processPacket({source:o,destination:c,protocol:u,port:h,sourcePort:f});return e.latency=(e.latency||0)+m.latency,m.blocked?(e.status="failed",e.error=m.error||`Packet ${m.action} by Firewall: ${m.matchedRule?.name||"Default policy"}`,e.metadata={...e.metadata,firewallBlocked:!0,firewallAction:m.action,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}):(e.status="delivered",e.metadata={...e.metadata,firewallChecked:!0,firewallAllowed:!0,firewallLatency:m.latency,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}),e},getSupportedFormats:()=>["json","text","binary"]}}createIDSIPSHandler(){return{processData:(t,e,n)=>{const s=Re.getIDSIPSEmulationEngine(t.id);if(!s)return e.status="delivered",e;const i=e.payload||{},o=i?.source||e.metadata?.sourceIP||i?.sourceIP||"0.0.0.0",c=i?.destination||e.metadata?.destinationIP||i?.destinationIP||"10.0.0.1",u=i?.protocol||e.metadata?.protocol||"tcp",h=i?.port||e.metadata?.port||i?.destinationPort,f=i?.sourcePort||e.metadata?.sourcePort,m=i?.payload||i?.body||(typeof i=="string"?i:JSON.stringify(i)),y=s.processPacket({source:o,destination:c,protocol:u,port:h,sourcePort:f,payload:m});return e.latency=(e.latency||0)+y.latency,y.blocked?(e.status="failed",e.error=y.error||"Packet blocked by IDS/IPS: Intrusion detected",e.metadata={...e.metadata,idsipsBlocked:!0,idsipsAlertGenerated:y.alertGenerated,idsipsAction:"block"},y.alertGenerated&&(e.metadata.idsipsAlertType="intrusion")):(e.status="delivered",e.metadata={...e.metadata,idsipsChecked:!0,idsipsAllowed:!0,idsipsLatency:y.latency,idsipsAlertGenerated:y.alertGenerated},y.alertGenerated&&(e.metadata.idsipsAction="alert",e.metadata.idsipsAlertType="intrusion")),e},getSupportedFormats:()=>["json","text","binary"]}}createOpenTelemetryCollectorHandler(){return{processData:(t,e,n)=>{const s=Re.getOpenTelemetryCollectorRoutingEngine(t.id);if(!s)return e.status="delivered",e;const i=this.nodes.find(c=>c.id===e.source),o=s.processMessage(e,i||void 0);return o.success?(e.status="delivered",e.latency=o.latency):(e.status="failed",e.error=o.error||"OpenTelemetry Collector processing failed",e.latency=o.latency),e},getSupportedFormats:()=>["json","protobuf","binary","text"]}}createCRMDataMessage(t){const e=t.data.config||{},n=e.contacts||[],s=e.deals||[],i=Math.random()>.5?"contact":"deal";let o;if(i==="contact"&&n.length>0){const u=n[Math.floor(Math.random()*n.length)];o={operation:"create",type:"contact",data:{name:u.name,email:u.email,company:u.company,status:u.status}}}else if(s.length>0){const u=s[Math.floor(Math.random()*s.length)];o={operation:"update",type:"deal",data:{id:u.id,name:u.name,value:u.value,stage:u.stage}}}else o={operation:"create",type:"contact",data:{name:`Contact ${Date.now()}`,email:`contact${Date.now()}@example.com`}};const c=JSON.stringify(o);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:o,size:new Blob([c]).size,metadata:{contentType:"application/json",operation:o.operation},status:"pending"}}createERPDataMessage(t){const e=t.data.config||{},n=e.orders||[],s=e.inventory||[],i=Math.random()>.5?"order":"inventory";let o;if(i==="order"&&n.length>0){const u=n[Math.floor(Math.random()*n.length)];o={operation:"create",type:"order",data:{orderNumber:u.orderNumber,customer:u.customer,total:u.total,items:u.items}}}else if(s.length>0){const u=s[Math.floor(Math.random()*s.length)];o={operation:"update",type:"inventory",data:{sku:u.sku,quantity:u.quantity,status:u.status}}}else o={operation:"create",type:"order",data:{orderNumber:`ORD-${Date.now()}`,total:Math.random()*1e3}};const c=JSON.stringify(o);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:o,size:new Blob([c]).size,metadata:{contentType:"application/json",operation:o.operation},status:"pending"}}createPaymentDataMessage(t){const n=(t.data.config||{}).transactions||[];let s;if(n.length>0){const o=n[Math.floor(Math.random()*n.length)];s={operation:"process",type:"transaction",data:{id:o.id,amount:o.amount,currency:o.currency,status:o.status}}}else s={operation:"process",type:"transaction",data:{amount:Math.random()*1e3,currency:"USD"}};const i=JSON.stringify(s);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:s,size:new Blob([i]).size,metadata:{contentType:"application/json",operation:s.operation},status:"pending"}}generateQueryResults(t,e){const n=Math.floor(Math.random()*10)+1,s=[];for(let i=0;i<n;i++)s.push({id:i+1,name:`Record ${i+1}`,value:Math.random()*100,timestamp:new Date().toISOString()});return s}}const hn=new kk;class Tk{componentStates=new Map;setComponentState(t,e,n){const s={nodeId:t,state:e,degradedLevel:n?.degradedLevel||.5,failureRate:n?.failureRate||.1,latencyMultiplier:n?.latencyMultiplier||2,throughputMultiplier:n?.throughputMultiplier||.5};this.componentStates.set(t,s)}getComponentState(t){return this.componentStates.get(t)}isEnabled(t){const e=this.componentStates.get(t);return!e||e.state==="enabled"}applyStateEffects(t,e){const n=this.componentStates.get(t);if(!n||n.state==="enabled")return{...e};if(n.state==="disabled"||n.state==="failed")return{throughput:0,latency:1/0,errorRate:1,utilization:0};if(n.state==="degraded"){const s=n.degradedLevel||.5;return{throughput:e.throughput*(n.throughputMultiplier||.5)*(1-s*.5),latency:e.latency*(n.latencyMultiplier||2)*(1+s),errorRate:Math.min(1,e.errorRate+(n.failureRate||.1)*s),utilization:Math.min(1,e.utilization*(1+s*.3))}}return{...e}}reset(){this.componentStates.clear()}resetComponent(t){this.componentStates.delete(t)}getAllStates(){return Array.from(this.componentStates.values())}}const mo=new Tk;class Ak{queues=new Map;exchanges=new Map;bindings=new Map;queueMessages=new Map;unackedMessages=new Map;queueState=new Map;initialize(t){if(this.queues.clear(),this.exchanges.clear(),this.bindings.clear(),this.queueMessages.clear(),this.unackedMessages.clear(),this.queueState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.unackedMessages.set(e.name,[]),this.queueState.set(e.name,{ready:e.ready||0,unacked:e.unacked||0,total:e.messages||0,lastUpdate:Date.now()});if(t.exchanges)for(const e of t.exchanges)this.exchanges.set(e.name,{...e}),this.bindings.set(e.name,[]);if(t.bindings)for(const e of t.bindings){const n=this.bindings.get(e.source)||[];n.push(e),this.bindings.set(e.source,n)}}routeMessage(t,e,n,s,i,o){const c=this.exchanges.get(t);if(!c)return[];const u=this.bindings.get(t)||[],h=[];for(const y of u)this.shouldRouteToQueue(c,y,e,i)&&h.push(y.destination);const f=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,m=Date.now();for(const y of h){const v=this.queues.get(y);if(!v)continue;if(v.maxLength&&(this.queueMessages.get(y)||[]).length>=v.maxLength){v.deadLetterExchange&&this.routeToDeadLetterExchange(v.deadLetterExchange,v.deadLetterRoutingKey||e,n,s,i,o);continue}const x={id:f,timestamp:m,routingKey:e,exchange:t,payload:n,size:s,priority:o||v.maxPriority?o||0:void 0,headers:i,ttl:v.messageTtl?m+v.messageTtl:void 0},S=this.queueMessages.get(y)||[];S.push(x),v.maxPriority&&x.priority!==void 0&&S.sort((R,M)=>(M.priority||0)-(R.priority||0)),this.queueMessages.set(y,S)}return h}shouldRouteToQueue(t,e,n,s){switch(t.type){case"direct":return e.routingKey===n;case"topic":return this.matchTopicPattern(e.routingKey,n);case"fanout":return!0;case"headers":if(!s||!e.arguments)return!1;for(const[i,o]of Object.entries(e.arguments))if(!i.startsWith("x-")&&s[i]!==o)return!1;return!0;default:return!1}}matchTopicPattern(t,e){const n=t.replace(/\./g,"\\.").replace(/\*/g,"[^.]+").replace(/#/g,".*");return new RegExp(`^${n}$`).test(e)}routeToDeadLetterExchange(t,e,n,s,i,o){this.routeMessage(t,e,n,s,i,o)}processConsumption(t){const e=Date.now();for(const[n,s]of this.queues.entries()){let i=this.queueMessages.get(n)||[],o=this.unackedMessages.get(n)||[];const c=this.queueState.get(n)||{ready:0,unacked:0,total:0,lastUpdate:e};i=i.filter(R=>R.ttl&&e>R.ttl?(s.deadLetterExchange&&this.routeToDeadLetterExchange(s.deadLetterExchange,s.deadLetterRoutingKey||R.routingKey,R.payload,R.size,R.headers,R.priority),!1):!0),this.queueMessages.set(n,i);const f=(s.consumers||0)*10*t/1e3,m=Math.min(f,i.length),y=i.splice(0,m);o.push(...y),this.unackedMessages.set(n,o);const x=t/100*o.length,S=Math.min(x,o.length);o.splice(0,Math.floor(S)),this.unackedMessages.set(n,o),c.ready=i.length,c.unacked=o.length,c.total=i.length+o.length,c.lastUpdate=e,this.queueState.set(n,c)}}getQueueMetrics(t){const e=this.queues.get(t);if(!e)return null;const n=this.queueMessages.get(t)||[],s=this.unackedMessages.get(t)||[];this.queueState.get(t);const i=n.length,o=s.length;return{messages:i+o,ready:i,unacked:o,consumers:e.consumers||0}}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const n=this.getQueueMetrics(e);n&&t.set(e,n)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;for(const e of this.unackedMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queues.values())e.consumers&&(t+=e.consumers);return t+=this.exchanges.size,Math.max(1,t)}updateQueue(t,e){const n=this.queues.get(t);n&&(Object.assign(n,e),this.queues.set(t,n))}}class Dk{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;queueState=new Map;topicState=new Map;initialize(t){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.queueState.clear(),this.topicState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.queueState.set(e.name,{queueSize:e.queueSize||0,consumerCount:e.consumerCount||0,enqueueCount:e.enqueueCount||0,dequeueCount:e.dequeueCount||0,lastUpdate:Date.now()});if(t.topics)for(const e of t.topics)this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.subscriptions.set(e.name,[]),this.topicState.set(e.name,{subscriberCount:e.subscriberCount||0,enqueueCount:e.enqueueCount||0,dequeueCount:e.dequeueCount||0,lastUpdate:Date.now()});if(t.subscriptions)for(const e of t.subscriptions){const n=this.subscriptions.get(e.destination)||[];n.push(e),this.subscriptions.set(e.destination,n),this.subscriptionMessages.set(e.id,[])}}routeToQueue(t,e,n,s,i){if(!this.queues.get(t))return!1;const c=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=Date.now(),h={id:c,timestamp:u,destination:t,payload:e,size:n,headers:s,priority:i},f=this.queueMessages.get(t)||[];f.push(h),i!==void 0&&f.sort((y,v)=>(v.priority||0)-(y.priority||0)),this.queueMessages.set(t,f);const m=this.queueState.get(t)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:u};return m.queueSize=f.length,m.enqueueCount=(m.enqueueCount||0)+1,m.lastUpdate=u,this.queueState.set(t,m),!0}publishToTopic(t,e,n,s,i){if(!this.topics.get(t))return[];const c=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=Date.now(),h=this.subscriptions.get(t)||[],f=[],m={id:c,timestamp:u,destination:t,payload:e,size:n,headers:s,priority:i};for(const v of h){if(v.selector&&!this.matchesSelector(v.selector,s))continue;const x=this.subscriptionMessages.get(v.id)||[];x.push(m),this.subscriptionMessages.set(v.id,x),f.push(v.id),v.pendingQueueSize=(v.pendingQueueSize||0)+1,v.enqueueCounter=(v.enqueueCounter||0)+1}if(h.length===0){const v=this.topicMessages.get(t)||[];v.push(m),this.topicMessages.set(t,v)}const y=this.topicState.get(t)||{subscriberCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:u};return y.enqueueCount=(y.enqueueCount||0)+1,y.lastUpdate=u,this.topicState.set(t,y),f}matchesSelector(t,e){if(!e||!t)return!0;try{const n=t.trim(),s=n.match(/^(\w+)\s*=\s*['"]([^'"]+)['"]$/);if(s){const o=s[1],c=s[2];return e[o]===c}const i=n.match(/^(\w+)\s*([><=]+)\s*(\d+)$/);if(i){const o=i[1],c=i[2],u=Number(i[3]),h=Number(e[o]);if(isNaN(h))return!1;switch(c){case">":return h>u;case"<":return h<u;case">=":return h>=u;case"<=":return h<=u;case"=":return h===u;default:return!1}}for(const o in e)if(n.includes(o))return!0;return!1}catch{return!0}}processConsumption(t){const e=Date.now();for(const[n,s]of this.queues.entries()){let i=this.queueMessages.get(n)||[];const o=this.queueState.get(n)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:e};i=i.filter(y=>!(y.ttl&&e>y.ttl)),this.queueMessages.set(n,i);const h=(s.consumerCount||o.consumerCount||0)*10*t/1e3,f=Math.min(h,i.length),m=i.splice(0,Math.floor(f));this.queueMessages.set(n,i),o.queueSize=i.length,o.dequeueCount=(o.dequeueCount||0)+m.length,o.lastUpdate=e,this.queueState.set(n,o)}for(const[n,s]of this.subscriptions.entries()){for(const o of s){let c=this.subscriptionMessages.get(o.id)||[];c=c.filter(y=>!(y.ttl&&e>y.ttl));const h=10*t/1e3,f=Math.min(h,c.length),m=c.splice(0,Math.floor(f));o.pendingQueueSize=c.length,o.dispatchedQueueSize=(o.dispatchedQueueSize||0)+m.length,o.dequeueCounter=(o.dequeueCounter||0)+m.length,this.subscriptionMessages.set(o.id,c)}const i=this.topicState.get(n);i&&(i.dequeueCount=s.reduce((o,c)=>o+(c.dequeueCounter||0),0),i.lastUpdate=e)}}getQueueMetrics(t){if(!this.queues.get(t))return null;const n=this.queueState.get(t);return n?{queueSize:n.queueSize,consumerCount:n.consumerCount,enqueueCount:n.enqueueCount,dequeueCount:n.dequeueCount}:null}getTopicMetrics(t){if(!this.topics.get(t))return null;const n=this.topicState.get(t);return n?{subscriberCount:n.subscriberCount,enqueueCount:n.enqueueCount,dequeueCount:n.dequeueCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const n=this.getQueueMetrics(e);n&&t.set(e,n)}return t}getAllTopicMetrics(){const t=new Map;for(const e of this.topics.keys()){const n=this.getTopicMetrics(e);n&&t.set(e,n)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;return t}getTotalTopicMessages(){let t=0;for(const e of this.subscriptionMessages.values())t+=e.length;for(const e of this.topicMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queues.values())e.consumerCount&&(t+=e.consumerCount);for(const e of this.subscriptions.values())t+=e.length;return Math.max(1,t+1)}updateQueue(t,e){const n=this.queues.get(t);if(n){Object.assign(n,e),this.queues.set(t,n);const s=this.queueState.get(t);s&&e.consumerCount!==void 0&&(s.consumerCount=e.consumerCount)}}updateTopic(t,e){const n=this.topics.get(t);if(n){Object.assign(n,e),this.topics.set(t,n);const s=this.topicState.get(t);s&&e.subscriberCount!==void 0&&(s.subscriberCount=e.subscriberCount)}}}class _k{queues=new Map;queueMessages=new Map;inFlightMessages=new Map;dlqMessages=new Map;queueState=new Map;messageGroups=new Map;deduplicationIds=new Map;initialize(t){if(this.queues.clear(),this.queueMessages.clear(),this.inFlightMessages.clear(),this.dlqMessages.clear(),this.queueState.clear(),this.messageGroups.clear(),this.deduplicationIds.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.inFlightMessages.set(e.name,[]),this.queueState.set(e.name,{approximateMessages:0,approximateMessagesNotVisible:0,approximateMessagesDelayed:0,sentCount:0,receivedCount:0,deletedCount:0,dlqCount:0,lastUpdate:Date.now()}),e.type==="fifo"&&(this.messageGroups.set(e.name,new Map),this.deduplicationIds.set(e.name,new Set))}sendMessage(t,e,n,s,i,o){const c=this.queues.get(t);if(!c)return null;const u=Date.now(),h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f=`${t}-${h}`;if(c.type==="fifo"){if(c.contentBasedDedup&&!o){const T=JSON.stringify(e);o=this.hashString(T)}if(o){const T=this.deduplicationIds.get(t);if(T&&T.has(o))return f;T?.add(o)}i||(i="default-group")}const m=c.messageRetention*24*60*60*1e3,y=u+m,v=c.delaySeconds*1e3,x=v>0?u+v:void 0,S={id:h,messageId:f,timestamp:u,queueName:t,payload:e,size:n,attributes:s,messageGroupId:i,messageDeduplicationId:o,receiveCount:0,retentionExpiresAt:y,delayUntil:x},R=this.queueMessages.get(t)||[];if(c.type==="fifo"&&i){const T=this.messageGroups.get(t);if(T){const k=T.get(i)||[];k.push(S),T.set(i,k)}}R.push(S),this.queueMessages.set(t,R);const M=this.queueState.get(t);if(M){const T=this.queueMessages.get(t)||[],k=this.inFlightMessages.get(t)||[],A=T.filter(_=>_.delayUntil&&u<_.delayUntil);M.approximateMessages=T.length,M.approximateMessagesNotVisible=k.length,M.approximateMessagesDelayed=A.length,M.sentCount=(M.sentCount||0)+1,M.lastUpdate=u}return f}receiveMessage(t,e=1,n){const s=this.queues.get(t);if(!s)return[];const i=Date.now(),c=(n!==void 0?n:s.visibilityTimeout)*1e3;let u=(this.queueMessages.get(t)||[]).filter(y=>!(y.delayUntil&&i<y.delayUntil||i>=y.retentionExpiresAt));if(s.type==="fifo"){const y=this.messageGroups.get(t);if(y){u=[];let v=0;for(const[x,S]of y.entries()){if(v>=e)break;if(S.length>0){const R=S[0];(!R.delayUntil||i>=R.delayUntil)&&i<R.retentionExpiresAt&&(u.push(R),v++)}}}}const h=Math.min(e,u.length),f=[];for(let y=0;y<h;y++){const v=u[y],x=`receipt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;v.receiptHandle=x,v.receiveCount=(v.receiveCount||0)+1,v.firstReceivedAt||(v.firstReceivedAt=i);const S={message:v,receivedAt:i,visibilityTimeoutExpiresAt:i+c},R=this.inFlightMessages.get(t)||[];R.push(S),this.inFlightMessages.set(t,R);const M=this.queueMessages.get(t)||[],T=M.indexOf(v);if(T>-1&&M.splice(T,1),this.queueMessages.set(t,M),s.type==="fifo"&&v.messageGroupId){const k=this.messageGroups.get(t);if(k){const A=k.get(v.messageGroupId)||[],_=A.indexOf(v);_>-1&&A.splice(_,1),A.length===0?k.delete(v.messageGroupId):k.set(v.messageGroupId,A)}}f.push(v)}const m=this.queueState.get(t);return m&&(m.receivedCount=(m.receivedCount||0)+f.length,m.lastUpdate=i),f}deleteMessage(t,e){if(!this.queues.get(t))return!1;const s=this.inFlightMessages.get(t)||[],i=s.findIndex(c=>c.message.receiptHandle===e);if(i===-1)return!1;s[i],s.splice(i,1),this.inFlightMessages.set(t,s);const o=this.queueState.get(t);return o&&(o.deletedCount=(o.deletedCount||0)+1,o.lastUpdate=Date.now()),!0}processConsumption(t){const e=Date.now();for(const[n,s]of this.queues.entries()){const i=this.inFlightMessages.get(n)||[],o=[],c=[];for(const m of i)if(e>=m.visibilityTimeoutExpiresAt){const y=m.message;y.receiptHandle=void 0,s.maxReceiveCount&&y.receiveCount>=s.maxReceiveCount?this.sendToDLQ(s,y):o.push(y)}else c.push(m);if(this.inFlightMessages.set(n,c),o.length>0){const m=this.queueMessages.get(n)||[];if(s.type==="fifo"){const y=this.messageGroups.get(n);if(y)for(const v of o){const x=v.messageGroupId||"default-group",S=y.get(x)||[];S.push(v),y.set(x,S)}}m.push(...o),this.queueMessages.set(n,m)}const h=(this.queueMessages.get(n)||[]).filter(m=>e>=m.retentionExpiresAt?(s.deadLetterQueue&&this.sendToDLQ(s,m),!1):!0);if(this.queueMessages.set(n,h),s.type==="fifo"){const m=this.messageGroups.get(n);if(m)for(const[y,v]of m.entries()){const x=v.filter(S=>e>=S.retentionExpiresAt?(s.deadLetterQueue&&this.sendToDLQ(s,S),!1):!0);x.length===0?m.delete(y):m.set(y,x)}}const f=this.queueState.get(n);if(f){const m=this.queueMessages.get(n)||[],y=this.inFlightMessages.get(n)||[],v=m.filter(x=>x.delayUntil&&e<x.delayUntil);f.approximateMessages=m.length,f.approximateMessagesNotVisible=y.length,f.approximateMessagesDelayed=v.length,f.lastUpdate=e}}}sendToDLQ(t,e){if(!t.deadLetterQueue||!this.queues.get(t.deadLetterQueue))return;const s=this.dlqMessages.get(t.deadLetterQueue)||[];s.push(e),this.dlqMessages.set(t.deadLetterQueue,s);const i=this.queueState.get(t.deadLetterQueue);i&&(i.dlqCount=(i.dlqCount||0)+1,i.approximateMessages=s.length);const o=this.queueState.get(t.name);o&&(o.dlqCount=(o.dlqCount||0)+1)}hashString(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return Math.abs(e).toString(36)}getQueueMetrics(t){if(!this.queues.get(t))return null;const n=this.queueState.get(t);return n?{approximateMessages:n.approximateMessages,approximateMessagesNotVisible:n.approximateMessagesNotVisible,approximateMessagesDelayed:n.approximateMessagesDelayed,sentCount:n.sentCount,receivedCount:n.receivedCount,deletedCount:n.deletedCount,dlqCount:n.dlqCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const n=this.getQueueMetrics(e);n&&t.set(e,n)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;for(const e of this.inFlightMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queueState.values())(e.sentCount>0||e.receivedCount>0)&&(t+=1);return Math.max(1,t)}updateQueue(t,e){const n=this.queues.get(t);n&&(Object.assign(n,e),this.queues.set(t,n))}}class Pk{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;lockedMessages=new Map;deadLetterMessages=new Map;scheduledMessages=new Map;sessionMessages=new Map;queueState=new Map;subscriptionState=new Map;initialize(t){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.lockedMessages.clear(),this.deadLetterMessages.clear(),this.scheduledMessages.clear(),this.sessionMessages.clear(),this.queueState.clear(),this.subscriptionState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.lockedMessages.set(e.name,[]),this.deadLetterMessages.set(e.name,[]),this.scheduledMessages.set(e.name,[]),this.queueState.set(e.name,{activeMessageCount:e.activeMessageCount||0,deadLetterMessageCount:e.deadLetterMessageCount||0,scheduledMessageCount:e.scheduledMessageCount||0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),e.enableSessions&&this.sessionMessages.set(e.name,new Map);if(t.topics){for(const e of t.topics)if(this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.scheduledMessages.set(e.name,[]),this.subscriptions.set(e.name,[]),e.subscriptions)for(const n of e.subscriptions){const s=this.subscriptions.get(e.name)||[];s.push(n),this.subscriptions.set(e.name,s);const i=`${e.name}/subscriptions/${n.name}`;this.subscriptionMessages.set(i,[]),this.lockedMessages.set(i,[]),this.deadLetterMessages.set(i,[]),this.subscriptionState.set(i,{activeMessageCount:n.activeMessageCount||0,deadLetterMessageCount:0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),this.sessionMessages.set(i,new Map)}}}sendToQueue(t,e,n,s,i,o){const c=this.queues.get(t);if(!c)return null;const u=Date.now(),h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f=`${t}-${h}`,m=c.defaultMessageTimeToLive*1e3,y=u+m,v={id:h,messageId:f,timestamp:u,destination:t,payload:e,size:n,properties:s,sessionId:i,scheduledEnqueueTime:o,expirationTime:y,deliveryCount:0,enqueuedTime:o||u};if(o&&o>u){const S=this.scheduledMessages.get(t)||[];S.push(v),this.scheduledMessages.set(t,S);const R=this.queueState.get(t);return R&&(R.scheduledMessageCount=S.length),f}if(c.enableSessions&&i){const S=this.sessionMessages.get(t);if(S){const R=S.get(i)||[];R.push(v),S.set(i,R)}}else{const S=this.queueMessages.get(t)||[];S.push(v),this.queueMessages.set(t,S)}const x=this.queueState.get(t);if(x){const S=this.getAvailableMessages(t);x.activeMessageCount=S.length,x.sentCount=(x.sentCount||0)+1,x.lastUpdate=u}return f}publishToTopic(t,e,n,s,i){const o=this.topics.get(t);if(!o)return[];const c=Date.now(),u=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=`${t}-${u}`,f=o.defaultMessageTimeToLive*1e3,m=c+f,y={id:u,messageId:h,timestamp:c,destination:t,payload:e,size:n,properties:s,scheduledEnqueueTime:i,expirationTime:m,deliveryCount:0,enqueuedTime:i||c},v=[];if(i&&i>c){const S=this.scheduledMessages.get(t)||[];return S.push(y),this.scheduledMessages.set(t,S),[h]}const x=this.subscriptions.get(t)||[];if(x.length===0)return[];for(const S of x){const R=`${t}/subscriptions/${S.name}`,M=this.subscriptionMessages.get(R)||[],T={...y,id:`${u}-${S.name}`,messageId:`${h}-${S.name}`,subscriptionName:S.name};M.push(T),this.subscriptionMessages.set(R,M),v.push(T.messageId);const k=this.subscriptionState.get(R);if(k){const A=this.getAvailableSubscriptionMessages(R);k.activeMessageCount=A.length,k.sentCount=(k.sentCount||0)+1,k.lastUpdate=c}}return v}receiveFromQueue(t,e,n){const s=this.queues.get(t);if(!s)return null;const i=Date.now(),o=(e||s.lockDuration)*1e3,c=i+o;let u;if(s.enableSessions&&n){const y=this.sessionMessages.get(t);if(!y)return null;u=y.get(n)||[]}else u=this.getAvailableMessages(t);if(u.length===0)return null;const h=u.shift();h.deliveryCount=(h.deliveryCount||0)+1,h.lockedUntil=c,h.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const f=this.lockedMessages.get(t)||[];if(f.push({message:h,lockedAt:i,lockExpiresAt:c}),this.lockedMessages.set(t,f),s.enableSessions&&n){const y=this.sessionMessages.get(t);if(y){const v=y.get(n)||[],x=v.findIndex(S=>S.id===h.id);x>=0&&(v.splice(x,1),y.set(n,v))}}const m=this.queueState.get(t);if(m){const y=this.getAvailableMessages(t);m.activeMessageCount=y.length,m.receivedCount=(m.receivedCount||0)+1,m.lastUpdate=i}return h}receiveFromSubscription(t,e,n){const s=`${t}/subscriptions/${e}`,i=this.getAvailableSubscriptionMessages(s);if(i.length===0)return null;const o=this.subscriptions.get(t)?.find(v=>v.name===e);if(!o)return null;const c=Date.now(),u=(n||o.lockDuration)*1e3,h=c+u,f=i.shift();f.deliveryCount=(f.deliveryCount||0)+1,f.lockedUntil=h,f.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const m=this.lockedMessages.get(s)||[];m.push({message:f,lockedAt:c,lockExpiresAt:h}),this.lockedMessages.set(s,m);const y=this.subscriptionState.get(s);if(y){const v=this.getAvailableSubscriptionMessages(s);y.activeMessageCount=v.length,y.receivedCount=(y.receivedCount||0)+1,y.lastUpdate=c}return f}completeMessage(t,e){const n=this.lockedMessages.get(t)||[],s=n.findIndex(o=>o.message.lockToken===e);if(s<0)return!1;if(n.splice(s,1),this.lockedMessages.set(t,n),this.queues.has(t)){const o=this.queueState.get(t);o&&(o.completedCount=(o.completedCount||0)+1,o.lastUpdate=Date.now())}else{const o=this.subscriptionState.get(t);o&&(o.completedCount=(o.completedCount||0)+1,o.lastUpdate=Date.now())}return!0}abandonMessage(t,e){const n=this.lockedMessages.get(t)||[],s=n.findIndex(h=>h.message.lockToken===e);if(s<0)return!1;const i=n[s];n.splice(s,1),this.lockedMessages.set(t,n);const o=i.message;o.lockToken=void 0,o.lockedUntil=void 0;const c=this.queues.has(t),u=c?this.queues.get(t)?.maxDeliveryCount||10:this.subscriptions.get(o.destination)?.find(h=>h.name===o.subscriptionName)?.maxDeliveryCount||10;if(o.deliveryCount>=u){const h=this.deadLetterMessages.get(t)||[];if(h.push(o),this.deadLetterMessages.set(t,h),c){const f=this.queueState.get(t);f&&(f.deadLetterMessageCount=h.length,f.abandonedCount=(f.abandonedCount||0)+1,f.lastUpdate=Date.now())}else{const f=this.subscriptionState.get(t);f&&(f.deadLetterMessageCount=h.length,f.abandonedCount=(f.abandonedCount||0)+1,f.lastUpdate=Date.now())}}else{if(c){const h=this.queues.get(t);if(h)if(h.enableSessions&&o.sessionId){const f=this.sessionMessages.get(t);if(f){const m=f.get(o.sessionId)||[];m.push(o),f.set(o.sessionId,m)}}else{const f=this.queueMessages.get(t)||[];f.push(o),this.queueMessages.set(t,f)}}else{const h=this.subscriptionMessages.get(t)||[];h.push(o),this.subscriptionMessages.set(t,h)}if(c){const h=this.queueState.get(t);if(h){const f=this.getAvailableMessages(t);h.activeMessageCount=f.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now()}}else{const h=this.subscriptionState.get(t);if(h){const f=this.getAvailableSubscriptionMessages(t);h.activeMessageCount=f.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now()}}}return!0}processConsumption(t){const e=Date.now();for(const[n,s]of this.queues.entries()){const i=this.scheduledMessages.get(n)||[],o=this.queueMessages.get(n)||[],c=this.sessionMessages.get(n);for(let m=i.length-1;m>=0;m--){const y=i[m];if(y.scheduledEnqueueTime&&y.scheduledEnqueueTime<=e)if(i.splice(m,1),s.enableSessions&&y.sessionId&&c){const v=c.get(y.sessionId)||[];v.push(y),c.set(y.sessionId,v)}else o.push(y)}this.scheduledMessages.set(n,i),this.queueMessages.set(n,o);const u=this.lockedMessages.get(n)||[];for(let m=u.length-1;m>=0;m--){const y=u[m];y.lockExpiresAt<=e&&(u.splice(m,1),this.abandonMessage(n,y.message.lockToken))}this.lockedMessages.set(n,u);const h=this.getAvailableMessages(n);for(let m=h.length-1;m>=0;m--){const y=h[m];if(y.expirationTime<=e&&(h.splice(m,1),s.enableDeadLetteringOnMessageExpiration)){const v=this.deadLetterMessages.get(n)||[];v.push(y),this.deadLetterMessages.set(n,v)}}this.queueMessages.set(n,h);const f=this.queueState.get(n);f&&(f.activeMessageCount=this.getAvailableMessages(n).length,f.deadLetterMessageCount=(this.deadLetterMessages.get(n)||[]).length,f.scheduledMessageCount=i.length,f.lastUpdate=e)}for(const[n,s]of this.topics.entries()){const i=this.scheduledMessages.get(n)||[];for(let c=i.length-1;c>=0;c--){const u=i[c];u.scheduledEnqueueTime&&u.scheduledEnqueueTime<=e&&(i.splice(c,1),this.publishToTopic(n,u.payload,u.size,u.properties))}this.scheduledMessages.set(n,i);const o=this.subscriptions.get(n)||[];for(const c of o){const u=`${n}/subscriptions/${c.name}`,h=this.lockedMessages.get(u)||[];for(let y=h.length-1;y>=0;y--){const v=h[y];v.lockExpiresAt<=e&&(h.splice(y,1),this.abandonMessage(u,v.message.lockToken))}this.lockedMessages.set(u,h);const f=this.getAvailableSubscriptionMessages(u);for(let y=f.length-1;y>=0;y--){const v=f[y];if(v.expirationTime<=e&&(f.splice(y,1),c.enableDeadLetteringOnMessageExpiration)){const x=this.deadLetterMessages.get(u)||[];x.push(v),this.deadLetterMessages.set(u,x)}}this.subscriptionMessages.set(u,f);const m=this.subscriptionState.get(u);m&&(m.activeMessageCount=this.getAvailableSubscriptionMessages(u).length,m.deadLetterMessageCount=(this.deadLetterMessages.get(u)||[]).length,m.lastUpdate=e)}}}getAvailableMessages(t){if(!this.queues.get(t))return[];const n=Date.now();return(this.queueMessages.get(t)||[]).filter(i=>i.expirationTime>n)}getAvailableSubscriptionMessages(t){const e=Date.now();return(this.subscriptionMessages.get(t)||[]).filter(s=>s.expirationTime>e)}getTotalQueueDepth(){let t=0;for(const e of this.queues.keys())t+=this.getAvailableMessages(e).length;return t}getTotalSubscriptionMessages(){let t=0;for(const e of this.subscriptionMessages.keys())t+=this.getAvailableSubscriptionMessages(e).length;return t}getQueueMetrics(t){const e=this.queueState.get(t);return e?{activeMessageCount:e.activeMessageCount,deadLetterMessageCount:e.deadLetterMessageCount,scheduledMessageCount:e.scheduledMessageCount,sentCount:e.sentCount,receivedCount:e.receivedCount,completedCount:e.completedCount,abandonedCount:e.abandonedCount}:null}getSubscriptionMetrics(t,e){const n=`${t}/subscriptions/${e}`,s=this.subscriptionState.get(n);return s?{activeMessageCount:s.activeMessageCount,deadLetterMessageCount:s.deadLetterMessageCount,sentCount:s.sentCount,receivedCount:s.receivedCount,completedCount:s.completedCount,abandonedCount:s.abandonedCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const n=this.getQueueMetrics(e);n&&t.set(e,n)}return t}getAllSubscriptionMetrics(){const t=new Map;for(const[e,n]of this.subscriptionState.entries())t.set(e,{activeMessageCount:n.activeMessageCount,deadLetterMessageCount:n.deadLetterMessageCount,sentCount:n.sentCount,receivedCount:n.receivedCount,completedCount:n.completedCount,abandonedCount:n.abandonedCount});return t}getActiveConnections(){return this.queues.size+this.topics.size}}class Nk{topics=new Map;subscriptions=new Map;topicSubscriptions=new Map;topicMessages=new Map;subscriptionMessages=new Map;unackedMessages=new Map;orderingKeyQueues=new Map;topicState=new Map;subscriptionState=new Map;initialize(t){if(this.topics.clear(),this.subscriptions.clear(),this.topicSubscriptions.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.unackedMessages.clear(),this.orderingKeyQueues.clear(),this.topicState.clear(),this.subscriptionState.clear(),t.topics)for(const e of t.topics)this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.topicSubscriptions.set(e.name,[]),this.orderingKeyQueues.set(e.name,new Map),this.topicState.set(e.name,{messageCount:e.messageCount||0,byteCount:e.byteCount||0,publishedCount:0,lastUpdate:Date.now()});if(t.subscriptions)for(const e of t.subscriptions){this.subscriptions.set(e.name,{...e}),this.subscriptionMessages.set(e.name,[]),this.unackedMessages.set(e.name,[]);const n=this.topicSubscriptions.get(e.topic)||[];n.includes(e.name)||n.push(e.name),this.topicSubscriptions.set(e.topic,n),this.subscriptionState.set(e.name,{messageCount:e.messageCount||0,unackedMessageCount:e.unackedMessageCount||0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:Date.now()})}}publishToTopic(t,e,n,s,i){if(!this.topics.get(t))return null;const c=Date.now(),u=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=c,f={id:`pubsub_${u}`,messageId:u,publishTime:h,data:e,attributes:s,orderingKey:i,size:n},m=this.topicMessages.get(t)||[];if(i){const x=this.orderingKeyQueues.get(t)||new Map,S=x.get(i)||[];S.push(f),x.set(i,S),this.orderingKeyQueues.set(t,x)}else m.push(f),this.topicMessages.set(t,m);const y=this.topicSubscriptions.get(t)||[];for(const x of y){const S=this.subscriptions.get(x);if(!S)continue;const R={...f,id:`${f.id}_${x}`},M=this.subscriptionMessages.get(x)||[];S.enableMessageOrdering,M.push(R),this.subscriptionMessages.set(x,M)}const v=this.topicState.get(t)||{messageCount:0,byteCount:0,publishedCount:0,lastUpdate:c};return v.messageCount=m.length+(i&&this.orderingKeyQueues.get(t)?.get(i)?.length||0),v.byteCount=(v.byteCount||0)+n,v.publishedCount=(v.publishedCount||0)+1,v.lastUpdate=c,this.topicState.set(t,v),u}pullFromSubscription(t,e=100){const n=this.subscriptions.get(t);if(!n)return[];const s=this.subscriptionMessages.get(t)||[];if(s.length===0)return[];const i=Date.now(),o=n.ackDeadlineSeconds*1e3,c=[],u=[];if(n.enableMessageOrdering){const m=new Map;for(const y of s){const v=y.orderingKey||"__no_key__";m.has(v)||m.set(v,[]),m.get(v).push(y)}for(const[y,v]of m.entries()){if(c.length>=e)break;const x=Math.min(v.length,e-c.length),S=v.splice(0,x);c.push(...S),u.push(...v)}for(const[y,v]of m.entries())v.length>0&&u.find(x=>(x.orderingKey||"__no_key__")===y)===void 0&&u.push(...v)}else{const m=Math.min(s.length,e);c.push(...s.splice(0,m)),u.push(...s)}this.subscriptionMessages.set(t,u);const h=this.unackedMessages.get(t)||[];for(const m of c){const y=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;m.ackId=y,h.push({message:m,subscriptionName:t,ackDeadlineExpiresAt:i+o,deliveryAttempt:1,orderingKey:m.orderingKey})}this.unackedMessages.set(t,h);const f=this.subscriptionState.get(t)||{messageCount:0,unackedMessageCount:0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:i};return f.messageCount=u.length,f.unackedMessageCount=h.length,f.deliveredCount=(f.deliveredCount||0)+c.length,f.lastUpdate=i,this.subscriptionState.set(t,f),c}ackMessage(t,e){if(!this.subscriptions.get(t))return!1;const s=this.unackedMessages.get(t)||[],i=s.length,o=s.filter(c=>c.message.ackId!==e);if(this.unackedMessages.set(t,o),o.length<i){const c=this.subscriptionState.get(t);return c&&(c.unackedMessageCount=o.length,c.acknowledgedCount=(c.acknowledgedCount||0)+1,c.lastUpdate=Date.now()),!0}return!1}nackMessage(t,e){if(!this.subscriptions.get(t))return!1;const s=this.unackedMessages.get(t)||[],i=s.findIndex(f=>f.message.ackId===e);if(i===-1)return!1;const c=s[i].message;s.splice(i,1),this.unackedMessages.set(t,s);const u=this.subscriptionMessages.get(t)||[];c.ackId=void 0,u.push(c),this.subscriptionMessages.set(t,u);const h=this.subscriptionState.get(t);return h&&(h.unackedMessageCount=s.length,h.messageCount=u.length,h.nackedCount=(h.nackedCount||0)+1,h.lastUpdate=Date.now()),!0}processConsumption(t){const e=Date.now();for(const[n,s]of this.unackedMessages.entries()){if(!this.subscriptions.get(n))continue;const o=[],c=[];for(const u of s)e>=u.ackDeadlineExpiresAt?o.push(u):c.push(u);if(o.length>0){const u=this.subscriptionMessages.get(n)||[];for(const f of o){const m=f.message;m.ackId=void 0,u.push(m)}this.subscriptionMessages.set(n,u);const h=this.subscriptionState.get(n);h&&(h.unackedMessageCount=c.length,h.messageCount=u.length)}this.unackedMessages.set(n,c)}for(const[n,s]of this.subscriptions.entries())if(s.pushEndpoint){const i=this.subscriptionMessages.get(n)||[];if(i.length>0){const c=Math.min(i.length,10),u=i.splice(0,c),h=this.unackedMessages.get(n)||[],f=Date.now(),m=s.ackDeadlineSeconds*1e3;for(const v of u){const x=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;v.ackId=x,h.push({message:v,subscriptionName:n,ackDeadlineExpiresAt:f+m,deliveryAttempt:1,orderingKey:v.orderingKey})}this.subscriptionMessages.set(n,i),this.unackedMessages.set(n,h);const y=this.subscriptionState.get(n);y&&(y.messageCount=i.length,y.unackedMessageCount=h.length,y.deliveredCount=(y.deliveredCount||0)+u.length)}}for(const[n,s]of this.topics.entries()){const o=(s.messageRetentionDuration||604800)*1e3,c=this.topicMessages.get(n)||[],u=Date.now(),h=c.filter(f=>u-f.publishTime<o);if(h.length<c.length){c.length-h.length,this.topicMessages.set(n,h);const f=this.topicState.get(n);f&&(f.messageCount=h.length)}}}getTopicMetrics(t){if(!this.topics.get(t))return null;const n=this.topicState.get(t);return n?{messageCount:n.messageCount,byteCount:n.byteCount,publishedCount:n.publishedCount}:null}getSubscriptionMetrics(t){if(!this.subscriptions.get(t))return null;const n=this.subscriptionState.get(t);return n?{messageCount:n.messageCount,unackedMessageCount:n.unackedMessageCount,deliveredCount:n.deliveredCount,acknowledgedCount:n.acknowledgedCount,nackedCount:n.nackedCount}:null}getAllTopicMetrics(){const t=new Map;for(const e of this.topics.keys()){const n=this.getTopicMetrics(e);n&&t.set(e,n)}return t}getAllSubscriptionMetrics(){const t=new Map;for(const e of this.subscriptions.keys()){const n=this.getSubscriptionMetrics(e);n&&t.set(e,n)}return t}getTotalTopicMessages(){let t=0;for(const e of this.topicMessages.values())t+=e.length;for(const e of this.orderingKeyQueues.values())for(const n of e.values())t+=n.length;return t}getTotalUnackedMessages(){let t=0;for(const e of this.unackedMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.subscriptions.values())e.pushEndpoint,t+=1;return Math.max(1,t+1)}updateTopic(t,e){const n=this.topics.get(t);n&&(Object.assign(n,e),this.topics.set(t,n))}updateSubscription(t,e){const n=this.subscriptions.get(t);n&&(Object.assign(n,e),this.subscriptions.set(t,n))}}class jk{services=new Map;routes=new Map;upstreams=new Map;consumers=new Map;plugins=[];roundRobinCounters=new Map;connectionCounts=new Map;consistentHashRing=new Map;rateLimitCounters=new Map;initialize(t){if(this.services.clear(),this.routes.clear(),this.upstreams.clear(),this.consumers.clear(),this.plugins=[],this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.consistentHashRing.clear(),this.rateLimitCounters.clear(),t.services)for(const e of t.services)this.services.set(e.id,{...e});if(t.routes)for(const e of t.routes)this.routes.set(e.id,{...e});if(t.upstreams){for(const e of t.upstreams)if(this.upstreams.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),e.algorithm==="consistent-hashing"&&e.targets){const n=[...e.targets].filter(s=>s.health==="healthy").sort((s,i)=>s.target.localeCompare(i.target));this.consistentHashRing.set(e.name,n.map(s=>s.target))}}if(t.consumers)for(const e of t.consumers)this.consumers.set(e.id,{...e});t.plugins&&(this.plugins=t.plugins.filter(e=>e.enabled))}routeRequest(t){const e=Date.now(),n=this.matchRoute(t);if(!n)return{match:null,response:{status:404,error:"No route matched",latency:Date.now()-e}};const s=this.executePlugins(t,n,"access");if(s.blocked)return{match:n,response:{status:s.status||403,error:s.error||"Request blocked by plugin",latency:Date.now()-e}};const i=this.selectUpstreamTarget(n.service);if(!i)return{match:n,response:{status:503,error:"No healthy upstream target available",latency:Date.now()-e}};this.transformPath(t.path,n);const o={status:200,latency:Date.now()-e};return o.latency=(o.latency||0)+this.simulateUpstreamLatency(i),{match:n,response:o,target:i}}matchRoute(t){const e=Array.from(this.routes.values()).sort((n,s)=>(s.priority||0)-(n.priority||0));for(const n of e){if(n.method&&n.method.toUpperCase()!==t.method.toUpperCase())continue;const s=this.matchPath(n.path,t.path);if(s){const i=this.services.get(n.service);if(!i||!i.enabled)continue;return{route:n,service:i,matchedPath:s.matched,remainingPath:s.remaining}}}return null}matchPath(t,e){if(e.startsWith(t))return{matched:t,remaining:e.substring(t.length)};try{if(new RegExp(`^${t}$`).test(e))return{matched:e,remaining:""}}catch{}return null}selectUpstreamTarget(t){const e=t.upstream||t.name,n=this.upstreams.get(e);if(!n||!n.targets||n.targets.length===0)return t.url;const s=n.targets.filter(o=>o.health==="healthy");if(s.length===0)return null;switch(n.algorithm||"round-robin"){case"round-robin":return this.selectRoundRobin(e,s);case"consistent-hashing":return this.selectConsistentHash(e,s,t.name);case"least-connections":return this.selectLeastConnections(s);default:return s[0].target}}selectRoundRobin(t,e){const n=this.roundRobinCounters.get(t)||0,s=e[n%e.length];return this.roundRobinCounters.set(t,(n+1)%e.length),s.target}selectConsistentHash(t,e,n){const i=this.simpleHash(n)%e.length;return e[i].target}selectLeastConnections(t){let e=1/0,n=t[0].target;for(const i of t){const o=this.connectionCounts.get(i.target)||0;o<e&&(e=o,n=i.target)}const s=this.connectionCounts.get(n)||0;return this.connectionCounts.set(n,s+1),n}simpleHash(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}transformPath(t,e){return e.route.stripPath?e.remainingPath||"/":t}executePlugins(t,e,n){const s=this.plugins.filter(i=>!(i.route&&i.route!==e.route.id||i.service&&i.service!==e.service.id));for(const i of s){const o=this.executePlugin(i,t,e,n);if(o.blocked)return o}return{blocked:!1}}executePlugin(t,e,n,s){const i=t.config||{};switch(t.name){case"rate-limiting":return this.executeRateLimiting(t,e,n,i);case"key-auth":return this.executeKeyAuth(t,e,n,i);case"jwt":return this.executeJWT(t,e,n,i);case"cors":return{blocked:!1};case"ip-restriction":return this.executeIPRestriction(t,e,n,i);default:return{blocked:!1}}}executeRateLimiting(t,e,n,s){const i=e.consumerId||n.service.id||n.route.id,o=Date.now();let c=this.rateLimitCounters.get(t.id);c||(c=new Map,this.rateLimitCounters.set(t.id,c));let u=c.get(i);(!u||u.resetAt<o)&&(u={count:0,resetAt:o+6e4},c.set(i,u));const h=s.minute||1e3;return s.hour,u.count++,u.count>h?{blocked:!0,status:429,error:"Rate limit exceeded (per minute)"}:{blocked:!1}}executeKeyAuth(t,e,n,s){const i=s.key_names||["apikey"],o=e.apiKey||e.headers?.[i[0]]||e.query?.[i[0]];return o?Array.from(this.consumers.values()).find(u=>u.credentials?.some(h=>h.type==="key-auth"&&h.key===o))?{blocked:!1}:{blocked:!0,status:401,error:"Invalid API key"}:{blocked:!0,status:401,error:"API key required"}}executeJWT(t,e,n,s){const i=e.headers?.Authorization;return!i||!i.startsWith("Bearer ")?{blocked:!0,status:401,error:"JWT token required"}:{blocked:!1}}executeIPRestriction(t,e,n,s){const i=e.headers?.["X-Forwarded-For"]||e.headers?.["X-Real-IP"]||"unknown",o=s.whitelist||[];return(s.blacklist||[]).includes(i)?{blocked:!0,status:403,error:"IP address blocked"}:o.length>0&&!o.includes(i)?{blocked:!0,status:403,error:"IP address not whitelisted"}:{blocked:!1}}simulateUpstreamLatency(t){return 10+Math.random()*40}getStats(){return{services:this.services.size,routes:this.routes.size,upstreams:this.upstreams.size,consumers:this.consumers.size,plugins:this.plugins.length}}}class Lk{proxies=new Map;policies=[];organization;environment;quotaCounters=new Map;spikeArrestBuckets=new Map;apiKeyCache=new Map;oauthTokenCache=new Map;jwtTokenCache=new Map;proxyMetrics=new Map;initialize(t){if(this.proxies.clear(),this.policies=[],this.quotaCounters.clear(),this.spikeArrestBuckets.clear(),this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear(),this.proxyMetrics.clear(),this.organization=t.organization||"archiphoenix-org",this.environment=t.environment||"prod",t.proxies)for(const e of t.proxies)this.proxies.set(e.name,{...e}),this.proxyMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),e.spikeArrest&&e.spikeArrest>0&&this.spikeArrestBuckets.set(e.name,{tokens:e.spikeArrest,lastRefill:Date.now(),rate:e.spikeArrest});t.policies&&(this.policies=t.policies.filter(e=>e.enabled))}routeRequest(t){const e=Date.now(),n=this.matchProxy(t);if(!n)return{match:null,response:{status:404,error:"No API proxy matched for path",latency:Date.now()-e}};if(n.proxy.status==="undeployed")return this.updateProxyMetrics(n.proxy.name,!1,Date.now()-e),{match:n,response:{status:503,error:`Proxy '${n.proxy.name}' is not deployed`,latency:Date.now()-e}};const s=this.policies.filter(v=>v.enabled&&(v.executionFlow==="PreFlow"||!v.executionFlow&&this.isPreFlowPolicy(v.type))),i=this.executePolicies(s,t,n,"PreFlow");if(i.blocked)return this.updateProxyMetrics(n.proxy.name,!0,Date.now()-e),{match:n,response:{status:i.status||401,error:i.error||"Authentication failed",latency:Date.now()-e}};const o=this.policies.filter(v=>v.enabled&&(v.executionFlow==="RequestFlow"||!v.executionFlow&&this.isRequestFlowPolicy(v.type))),c=this.executePolicies(o,t,n,"RequestFlow");if(c.blocked)return this.updateProxyMetrics(n.proxy.name,!0,Date.now()-e),{match:n,response:{status:c.status||429,error:c.error||"Request policy violation",latency:Date.now()-e}};const u=this.buildTargetUrl(n.proxy,n.remainingPath),h=this.simulateUpstreamLatency(u),f=Date.now()-e+h,m=this.policies.filter(v=>v.enabled&&(v.executionFlow==="PostFlow"||!v.executionFlow&&this.isPostFlowPolicy(v.type))),y={status:200,latency:f};return this.executePolicies(m,t,n,"PostFlow",y),this.updateProxyMetrics(n.proxy.name,!1,f),{match:n,response:y,target:u}}matchProxy(t){const e=Array.from(this.proxies.values()).filter(n=>n.status==="deployed"||n.status===void 0).sort((n,s)=>s.basePath.length-n.basePath.length);for(const n of e)if(t.path.startsWith(n.basePath)){const s=t.path.slice(n.basePath.length)||"/";return{proxy:n,matchedPath:n.basePath,remainingPath:s}}return null}isPreFlowPolicy(t){return["verify-api-key","oauth","jwt"].includes(t)}isRequestFlowPolicy(t){return["quota","spike-arrest"].includes(t)}isPostFlowPolicy(t){return["cors","xml-to-json"].includes(t)}evaluateCondition(t,e,n){if(!t)return!0;try{if(t.includes("request.path")){const s=t.match(/request\.path\s*[=!]=\s*['"]([^'"]+)['"]/);if(s)return e.path===s[1]}return t.length>0}catch{return!0}}executePolicies(t,e,n,s,i){for(const o of t)if(this.evaluateCondition(o.condition,e,n))if(s==="PreFlow"){const c=this.executePreFlowPolicy(o,e,n);if(c.blocked)return c}else if(s==="RequestFlow"){const c=this.executeRequestFlowPolicy(o,e,n);if(c.blocked)return c}else s==="PostFlow"&&i&&this.executePostFlowPolicy(o,e,n,i);return{blocked:!1}}executePreFlowPolicy(t,e,n){if(n.proxy,t.type==="verify-api-key"){const s=e.apiKey||e.headers?.["X-API-Key"]||e.headers?.apikey||e.query?.apikey;if(!s)return{blocked:!0,status:401,error:"API key is required"};if(!this.validateApiKey(s))return{blocked:!0,status:401,error:"Invalid API key"}}if(t.type==="oauth"&&n.proxy.enableOAuth){const i=e.oauthToken||e.headers?.Authorization?.replace("Bearer ","")||e.headers?.Authorization?.replace("OAuth ","");if(!i)return{blocked:!0,status:401,error:"OAuth token is required"};if(!this.validateOAuthToken(i))return{blocked:!0,status:401,error:"Invalid or expired OAuth token"}}if(t.type==="jwt"){const s=n.proxy;if(s.jwtIssuer){const i=e.jwtToken||e.headers?.Authorization?.replace("Bearer ","")||e.headers?.["X-JWT-Token"];if(!i)return{blocked:!0,status:401,error:"JWT token is required"};if(!this.validateJWTToken(i,s.jwtIssuer))return{blocked:!0,status:401,error:"Invalid or expired JWT token"}}}return{blocked:!1}}executeRequestFlowPolicy(t,e,n){const s=n.proxy,i=e.headers?.["X-Consumer-ID"]||"default";if(t.type==="quota"){const o=t.config?.quota||s.quota,c=t.config?.interval||s.quotaInterval;if(o&&c&&!this.checkQuota(s.name,i,o,c))return{blocked:!0,status:429,error:`Quota exceeded: ${o} requests per ${c} seconds`}}if(t.type==="spike-arrest"){const o=t.config?.rate||s.spikeArrest;if(o&&o>0&&!this.checkSpikeArrest(s.name,o))return{blocked:!0,status:429,error:`Spike arrest limit exceeded: ${o} requests per second`}}return{blocked:!1}}executePostFlowPolicy(t,e,n,s){t.type==="cors"&&(s.headers||(s.headers={}),s.headers["Access-Control-Allow-Origin"]=t.config?.origins?.[0]||"*",s.headers["Access-Control-Allow-Methods"]=t.config?.methods?.join(", ")||"GET, POST, PUT, DELETE",s.headers["Access-Control-Allow-Headers"]=t.config?.headers?.join(", ")||"Content-Type, Authorization"),t.type==="xml-to-json"&&(s.headers||(s.headers={}),s.headers["Content-Type"]="application/json")}checkQuota(t,e,n,s){const i=Date.now(),o=s*1e3;let c=this.quotaCounters.get(t);c||(c=new Map,this.quotaCounters.set(t,c));let u=c.get(e);return(!u||u.resetAt<i)&&(u={count:0,resetAt:i+o,identifier:e},c.set(e,u)),u.count>=n?!1:(u.count++,!0)}checkSpikeArrest(t,e){const n=Date.now();let s=this.spikeArrestBuckets.get(t);s||(s={tokens:e,lastRefill:n,rate:e},this.spikeArrestBuckets.set(t,s));const o=(n-s.lastRefill)/1e3*s.rate;return s.tokens=Math.min(s.rate,s.tokens+o),s.lastRefill=n,s.tokens<1?!1:(s.tokens-=1,!0)}validateApiKey(t){const e=this.apiKeyCache.get(t);if(e&&e.expiresAt>Date.now())return e.valid;const n=t.length>=10;return this.apiKeyCache.set(t,{valid:n,expiresAt:Date.now()+300*1e3}),n}validateOAuthToken(t){const e=this.oauthTokenCache.get(t);if(e&&e.expiresAt>Date.now())return e.valid;const n=t.length>=20;return this.oauthTokenCache.set(t,{valid:n,expiresAt:Date.now()+3600*1e3}),n}validateJWTToken(t,e){const n=this.jwtTokenCache.get(t);if(n&&n.expiresAt>Date.now())return n.valid&&n.issuer===e;const s=t.length>=20;return this.jwtTokenCache.set(t,{valid:s,issuer:e,expiresAt:Date.now()+3600*1e3}),s}buildTargetUrl(t,e){const n=t.targetEndpoint.replace(/\/$/,""),s=e.startsWith("/")?e:`/${e}`;return`${n}${s}`}simulateUpstreamLatency(t){const e=10+Math.random()*40,n=(Math.random()-.5)*10;return Math.max(1,e+n)}updateProxyMetrics(t,e,n){const s=this.proxyMetrics.get(t);s&&(s.requestCount++,e&&s.errorCount++,s.totalLatency+=n,s.lastRequestTime=Date.now())}getStats(){let t=0,e=0,n=0;for(const i of this.proxyMetrics.values())t+=i.requestCount,e+=i.errorCount,n+=i.totalLatency;const s=t>0?n/t:0;return{proxies:this.proxies.size,policies:this.policies.length,totalRequests:t,totalErrors:e,avgLatency:s}}getProxyMetrics(t){const e=this.proxyMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgResponseTime:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}clearCaches(){this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear()}}class zk{applications=new Map;connectors=new Map;organization;environment;applicationMetrics=new Map;connectorMetrics=new Map;reconnectionState=new Map;initialize(t){if(this.applications.clear(),this.connectors.clear(),this.applicationMetrics.clear(),this.connectorMetrics.clear(),this.reconnectionState.clear(),this.organization=t.organization||"archiphoenix-org",this.environment=t.environment||"production",t.applications)for(const e of t.applications)this.applications.set(e.name,{...e}),this.applicationMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0});if(t.connectors)for(const e of t.connectors)this.connectors.set(e.name,{...e}),this.connectorMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),this.reconnectionState.set(e.name,{attempts:0,lastAttempt:0,nextAttempt:0})}processData(t){const e=Date.now(),n=this.matchApplication(t);if(!n)return{match:null,response:{status:"error",error:"No Mule application matched for request",latency:Date.now()-e}};if(n.application.status!=="running")return this.updateApplicationMetrics(n.application.name,!1,Date.now()-e),{match:n,response:{status:"error",error:`Application '${n.application.name}' is not running (status: ${n.application.status})`,latency:Date.now()-e}};let s=0,i;try{s=this.processFlow(n,t)}catch(c){i=c instanceof Error?c.message:"Unknown error"}if(i&&!this.handleError(n.application,i))return this.updateApplicationMetrics(n.application.name,!0,Date.now()-e),{match:n,response:{status:"error",error:i,latency:Date.now()-e,application:n.application.name,flow:n.flow?.name}};const o=this.transformData(t,n);return this.updateApplicationMetrics(n.application.name,!1,Date.now()-e),n.matchedConnector&&this.updateConnectorMetrics(n.matchedConnector.name,!1,Date.now()-e),{match:n,response:{status:"success",data:o.data,format:o.format||t.format,latency:Date.now()-e,application:n.application.name,flow:n.flow?.name,connector:n.matchedConnector?.name}}}matchApplication(t){if(t.sourceComponentType||t.targetComponentType)for(const[e,n]of this.applications.entries()){if(n.status!=="running")continue;const s=this.findMatchingConnector(n,t.sourceComponentType,t.targetComponentType);if(s){const i=n.flows?.find(o=>o.source===s.name||o.target===s.name)||n.flows?.[0];return{application:n,flow:i,matchedConnector:s}}}for(const[e,n]of this.applications.entries())if(n.status==="running")return{application:n,flow:n.flows?.[0]};return null}findMatchingConnector(t,e,n){const s=t.connectors||[];for(const i of s){const o=this.connectors.get(i);if(!(!o||!o.enabled)&&(e&&this.connectorMatchesComponentType(o,e)||n&&this.connectorMatchesComponentType(o,n)))return o}return null}connectorMatchesComponentType(t,e){const n={database:["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],api:["rest","grpc","graphql","soap","websocket","webhook"],messaging:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],file:["s3-datalake"],business:["crm","erp","payment-gateway"]};for(const[s,i]of Object.entries(n))if(t.type===s&&i.includes(e))return!0;return t.targetComponentType===e}processFlow(t,e){if(!t.flow)return this.calculateBaseProcessingTime(t.application);let n=this.calculateBaseProcessingTime(t.application);if(t.flow.processors)for(const s of t.flow.processors)n+=this.processProcessor(s,e);return t.matchedConnector&&(n+=this.calculateConnectorLatency(t.matchedConnector)),n}calculateBaseProcessingTime(t){const e=5+Math.random()*10,n=parseFloat(t.runtimeVersion)>=4.5?.9:1;return e*n}processProcessor(t,e){switch(t.type){case"transform":return 2+Math.random()*6;case"validate":return 1+Math.random()*2;case"filter":return .5+Math.random()*1.5;case"enrich":return 3+Math.random()*7;case"route":return .5+Math.random()*.5;default:return 1}}calculateConnectorLatency(t){const n={database:10,api:20,messaging:5,file:50,custom:15}[t.type]||15,s=n*.5*Math.random();return n+s}transformData(t,e){if(t.targetComponentType){const n=this.getTargetFormat(t.targetComponentType);if(n&&n!==t.format)return{data:t.body,format:n}}return{data:t.body,format:t.format}}getTargetFormat(t){return{postgres:"json",mongodb:"json",redis:"json",rest:"json",graphql:"json",soap:"xml",grpc:"binary",kafka:"json",rabbitmq:"json"}[t]}handleError(t,e){switch(t.errorStrategy||"continue"){case"continue":return!0;case"rollback":return!1;case"propagate":return!1;default:return!1}}updateApplicationMetrics(t,e,n){const s=this.applicationMetrics.get(t);s&&(s.requestCount++,e&&s.errorCount++,s.totalLatency+=n,s.lastRequestTime=Date.now())}updateConnectorMetrics(t,e,n){const s=this.connectorMetrics.get(t);s&&(s.requestCount++,e&&s.errorCount++,s.totalLatency+=n,s.lastRequestTime=Date.now())}getStats(){let t=0,e=0,n=0;for(const o of this.applicationMetrics.values())t+=o.requestCount,e+=o.errorCount,n+=o.totalLatency;const s=Array.from(this.applications.values()).filter(o=>o.status==="running").length,i=Array.from(this.connectors.values()).filter(o=>o.enabled).length;return{applications:this.applications.size,runningApplications:s,connectors:this.connectors.size,enabledConnectors:i,totalRequests:t,totalErrors:e,avgLatency:t>0?n/t:0}}getApplicationMetrics(t){const e=this.applicationMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgLatency:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}getConnectorMetrics(t){const e=this.connectorMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgLatency:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}}class Ik{locations=[];upstreams=new Map;rateLimitZones=new Map;sslCertificates=new Map;roundRobinCounters=new Map;connectionCounts=new Map;ipHashMap=new Map;hashRing=new Map;rateLimitCounters=new Map;cache=new Map;enableSSL=!1;sslPort=443;enableGzip=!0;enableCache=!0;maxWorkers=4;requestCount=0;cacheHits=0;cacheMisses=0;rateLimitBlocks=0;initialize(t){if(this.locations=[],this.upstreams.clear(),this.rateLimitZones.clear(),this.sslCertificates.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.ipHashMap.clear(),this.hashRing.clear(),this.rateLimitCounters.clear(),this.cache.clear(),t.locations&&(this.locations=[...t.locations].sort((e,n)=>n.path.length!==e.path.length?n.path.length-e.path.length:e.path.localeCompare(n.path))),t.upstreams){for(const e of t.upstreams)if(this.upstreams.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),e.method==="hash"&&e.servers){const n=[...e.servers].filter(s=>!s.down&&s.health!=="unhealthy").sort((s,i)=>s.address.localeCompare(i.address));this.hashRing.set(e.name,n.map(s=>s.address))}}if(t.rateLimitZones)for(const e of t.rateLimitZones)this.rateLimitZones.set(e.name,{...e});if(t.sslCertificates)for(const e of t.sslCertificates)this.sslCertificates.set(e.name,{...e});this.enableSSL=t.enableSSL??!1,this.sslPort=t.sslPort||443,this.enableGzip=t.enableGzip??!0,this.enableCache=t.enableCache??!0,this.maxWorkers=t.maxWorkers||4}routeRequest(t){const e=Date.now();if(this.requestCount++,!this.enableSSL&&t.protocol==="https")return{match:null,response:{status:400,error:"HTTPS not enabled",latency:Date.now()-e}};const n=this.matchLocation(t);if(!n)return{match:null,response:{status:404,error:"No location matched",latency:Date.now()-e}};if(n.location.rateLimit){const o=this.checkRateLimit(n.location.rateLimit,t);if(o.blocked)return this.rateLimitBlocks++,{match:n,response:{status:429,error:o.error||"Rate limit exceeded",latency:Date.now()-e}}}if(this.enableCache&&n.location.cache?.enabled&&t.method==="GET"){const o=this.getCacheKey(t,n),c=this.cache.get(o);if(c&&c.expiresAt>Date.now())return this.cacheHits++,{match:n,response:{status:200,body:c.data,latency:Date.now()-e,cacheHit:!0}};this.cacheMisses++}let s,i;switch(n.location.method){case"proxy":case"grpc":if(s=this.selectUpstreamTarget(n.location,t),!s)return{match:n,response:{status:503,error:"No healthy upstream server available",latency:Date.now()-e}};i=this.proxyRequest(t,n,s);break;case"static":i=this.serveStatic(t,n);break;case"fastcgi":case"uwsgi":case"scgi":if(s=this.selectUpstreamTarget(n.location,t),!s)return{match:n,response:{status:503,error:"No upstream server available",latency:Date.now()-e}};i=this.processFastCGI(t,n,s);break;default:i={status:501,error:"Method not implemented",latency:Date.now()-e}}if(this.enableGzip&&this.shouldCompress(i)&&(i.headers={...i.headers,"Content-Encoding":"gzip"}),this.enableCache&&n.location.cache?.enabled&&t.method==="GET"&&i.status===200){const o=this.getCacheKey(t,n),c=this.parseCacheValid(n.location.cache.valid||"1h");this.cache.set(o,{data:i.body,expiresAt:Date.now()+c})}return i.latency=Date.now()-e,i.upstreamTarget=s,{match:n,response:i,upstreamTarget:s}}matchLocation(t){for(const e of this.locations){const n=this.matchPath(e.path,t.path);if(n)return{location:e,matchedPath:n.matched,remainingPath:n.remaining,priority:this.getLocationPriority(e.path)}}return null}matchPath(t,e){const n=t.replace(/^[=~*^]/,""),s=t[0];switch(s){case"=":if(e===n)return{matched:e,remaining:""};break;case"~":case"~*":try{if(new RegExp(n,s==="~*"?"i":"").test(e))return{matched:e,remaining:""}}catch{}break;case"^~":case"*":default:if(e.startsWith(n))return{matched:n,remaining:e.substring(n.length)}}return null}getLocationPriority(t){return t.startsWith("=")?4:t.startsWith("^~")?3:t.startsWith("~")||t.startsWith("~*")?2:1}selectUpstreamTarget(t,e){const n=t.upstream||this.extractUpstreamFromProxyPass(t.proxyPass);if(!n)return t.proxyPass||null;const s=this.upstreams.get(n);if(!s||!s.servers||s.servers.length===0)return null;const i=s.servers.filter(c=>!c.down&&c.health!=="unhealthy");if(i.length===0)return null;switch(s.method||"round-robin"){case"round-robin":return this.selectRoundRobin(n,i);case"least_conn":return this.selectLeastConnections(i);case"ip_hash":return this.selectIPHash(n,i,e);case"hash":return this.selectHash(n,i,e);default:return i[0].address}}selectRoundRobin(t,e){const n=e.reduce((o,c)=>o+(c.weight||1),0);let s=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,s<i)return this.roundRobinCounters.set(t,(s+1)%n),o.address;return this.roundRobinCounters.set(t,(s+1)%n),e[0].address}selectLeastConnections(t){let e=1/0,n=t[0].address;for(const i of t){const c=(this.connectionCounts.get(i.address)||0)/(i.weight||1);c<e&&(e=c,n=i.address)}const s=this.connectionCounts.get(n)||0;return this.connectionCounts.set(n,s+1),n}selectIPHash(t,e,n){const s=n.clientIP||n.headers?.["X-Real-IP"]||n.headers?.["X-Forwarded-For"]||"0.0.0.0",i=this.ipHashMap.get(s);if(i&&e.some(h=>h.address===i))return i;const c=this.simpleHash(s)%e.length,u=e[c].address;return this.ipHashMap.set(s,u),u}selectHash(t,e,n){const s=this.hashRing.get(t);if(!s||s.length===0)return e[0].address;const i=n.path,c=this.simpleHash(i)%s.length;return s[c]}simpleHash(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}extractUpstreamFromProxyPass(t){if(!t)return null;const e=t.match(/^https?:\/\/([^\/:]+)/);return e&&this.upstreams.has(e[1])?e[1]:null}checkRateLimit(t,e){const n=this.rateLimitZones.get(t.zone);if(!n)return{blocked:!1};const s=n.rate.match(/^(\d+)r\/([smhd])$/);if(!s)return{blocked:!1};const i=parseInt(s[1],10),o=s[2],c=this.getPeriodMs(o),u=e.clientIP||e.headers?.["X-Real-IP"]||"default";let h=this.rateLimitCounters.get(t.zone);h||(h=new Map,this.rateLimitCounters.set(t.zone,h));let f=h.get(u);const m=Date.now();(!f||f.resetAt<m)&&(f={count:0,resetAt:m+c,burst:t.burst||0},h.set(u,f));const y=t.burst||0,v=i+y;return f.count>=v?{blocked:!0,error:`Rate limit exceeded: ${i} requests per ${o}`}:(f.count++,{blocked:!1})}getPeriodMs(t){switch(t){case"s":return 1e3;case"m":return 6e4;case"h":return 36e5;case"d":return 864e5;default:return 1e3}}proxyRequest(t,e,n){const s=10+Math.random()*90;return{status:200,body:{proxied:!0,upstream:n},latency:s}}serveStatic(t,e){const n=1+Math.random()*4;return{status:200,body:{static:!0,path:e.matchedPath},latency:n}}processFastCGI(t,e,n){const s=20+Math.random()*180;return{status:200,body:{processed:!0,upstream:n},latency:s}}getCacheKey(t,e){return e.location.cache?.key?e.location.cache.key.replace(/\$(\w+)/g,(n,s)=>{switch(s){case"uri":return t.path;case"args":return JSON.stringify(t.query);default:return""}}):`${t.method}:${t.path}:${JSON.stringify(t.query)}`}parseCacheValid(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 36e5;const n=parseInt(e[1],10),s=e[2];return n*this.getPeriodMs(s)}shouldCompress(t){if(!t.body)return!1;const e=t.headers?.["Content-Type"]||"";return["text/","application/json","application/javascript","application/xml"].some(s=>e.includes(s))}getStats(){const t=this.cacheHits+this.cacheMisses,e=t>0?this.cacheHits/t:0;return{locations:this.locations.length,upstreams:this.upstreams.size,rateLimitZones:this.rateLimitZones.size,sslCertificates:this.sslCertificates.size,requests:this.requestCount,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses,rateLimitBlocks:this.rateLimitBlocks,cacheHitRate:e}}updateServerHealth(t,e,n){const s=this.upstreams.get(t);if(!s)return;const i=s.servers.find(o=>o.address===e);i&&(i.health=n)}clearCache(){this.cache.clear(),this.cacheHits=0,this.cacheMisses=0}}class Ok{frontends=new Map;backends=new Map;globalConfig={};roundRobinCounters=new Map;connectionCounts=new Map;sourceHashMap=new Map;uriHashMap=new Map;stickTable=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;rateLimitBlocks=0;timeoutErrors=0;connectionRejects=0;healthCheckTimers=new Map;serverCheckFailures=new Map;serverCheckSuccesses=new Map;rateLimitTracker=new Map;initialize(t){this.frontends.clear(),this.backends.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.sourceHashMap.clear(),this.uriHashMap.clear(),this.stickTable.clear(),this.serverCheckFailures.clear(),this.serverCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.frontends)for(const e of t.frontends)this.frontends.set(e.name,{...e,acls:e.acls||[]});if(t.backends){for(const e of t.backends)if(this.backends.set(e.name,{...e,acls:e.acls||[]}),this.roundRobinCounters.set(e.name,0),e.healthCheck?.enabled&&e.servers)for(const n of e.servers)n.check&&this.startHealthCheck(e.name,n,e.healthCheck)}this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.rateLimitBlocks=0,this.timeoutErrors=0,this.connectionRejects=0}routeRequest(t,e){const n=Date.now();this.requestCount++;const s=this.globalConfig.maxConnections||4096;if(this.activeConnections>=s)return this.connectionRejects++,this.errorCount++,{frontend:null,backend:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-n}};if(this.activeConnections++,this.globalConfig.rateLimit?.enabled&&!this.checkRateLimit(t).allowed)return this.activeConnections--,this.rateLimitBlocks++,this.errorCount++,{frontend:null,backend:null,response:{status:429,error:"Rate limit exceeded",latency:Date.now()-n}};let i=null;if(e)i=this.frontends.get(e)||null;else{for(const[T,k]of this.frontends.entries()){const A=this.extractPort(k.bind);if(t.protocol==="https"&&A===443){i=k;break}else if(t.protocol==="http"&&A===80){i=k;break}}!i&&this.frontends.size>0&&(i=Array.from(this.frontends.values())[0])}if(!i)return this.activeConnections--,{frontend:null,backend:null,response:{status:503,error:"No frontend available",latency:Date.now()-n}};if(i.acls&&i.acls.length>0){const T=this.evaluateACLs(i.acls,t);if(!T.matched)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:403,error:T.error||"ACL rule denied",latency:Date.now()-n}}}const o=i.defaultBackend||(i.backends&&i.backends.length>0?i.backends[0]:null);if(!o)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:503,error:"No backend configured",latency:Date.now()-n}};const c=this.backends.get(o);if(!c)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:503,error:`Backend ${o} not found`,latency:Date.now()-n}};if(c.acls&&c.acls.length>0){const T=this.evaluateACLs(c.acls,t);if(!T.matched)return this.activeConnections--,this.errorCount++,{frontend:i,backend:c,response:{status:403,error:T.error||"Backend ACL rule denied",latency:Date.now()-n}}}const u=this.selectServer(c,t);if(!u)return this.activeConnections--,this.errorCount++,{frontend:i,backend:c,response:{status:503,error:"No healthy server available",latency:Date.now()-n}};const h=c.servers.find(T=>`${T.address}:${T.port}`===u);if(h){h.sessions=(h.sessions||0)+1;const T=this.connectionCounts.get(u)||0;this.connectionCounts.set(u,T+1)}const f=10+Math.random()*90,m=i.ssl?5+Math.random()*15:0,y=this.globalConfig.timeoutServer||5e4,v=this.globalConfig.timeoutConnect||5e3,x=this.globalConfig.timeoutHttpRequest||1e4,S=Math.min(50+Math.random()*100,v);if(S>=v*.9)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,h&&(h.errors=(h.errors||0)+1),{frontend:i,backend:c,response:{status:504,error:"Connection timeout",latency:v,backendTarget:o,serverTarget:u}};const R=S+f+m;if(R>y)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,h&&(h.errors=(h.errors||0)+1),{frontend:i,backend:c,response:{status:504,error:"Server timeout",latency:y,backendTarget:o,serverTarget:u}};if(R>x)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,h&&(h.errors=(h.errors||0)+1),{frontend:i,backend:c,response:{status:408,error:"Request timeout",latency:x,backendTarget:o,serverTarget:u}};const M={status:200,body:{proxied:!0,backend:o,server:u},latency:R,backendTarget:o,serverTarget:u};return h&&(h.bytesIn=(h.bytesIn||0)+1024,h.bytesOut=(h.bytesOut||0)+2048,h.responseTime=R,this.totalBytesIn+=1024,this.totalBytesOut+=2048),this.responseCount++,this.activeConnections--,{frontend:i,backend:c,response:M,backendTarget:o,serverTarget:u}}selectServer(t,e){const n=t.servers.filter(o=>o.status==="up"&&o.check!==!1);if(n.length===0)return null;if(t.stickTable?.enabled){const o=this.getStickTableKey(e,t.stickTable.type),c=this.stickTable.get(o);if(c&&c.expiresAt>Date.now()&&n.find(h=>`${h.address}:${h.port}`===c.server))return c.server}const s=t.balance||"roundrobin";let i;switch(s){case"roundrobin":i=this.selectRoundRobin(t.name,n);break;case"leastconn":i=this.selectLeastConnections(n);break;case"source":i=this.selectSourceIP(t.name,n,e);break;case"uri":i=this.selectURIHash(t.name,n,e);break;case"hdr":i=this.selectHeaderHash(t.name,n,e);break;default:i=`${n[0].address}:${n[0].port}`}if(t.stickTable?.enabled&&i){const o=this.getStickTableKey(e,t.stickTable.type),c=(t.stickTable.expire||3600)*1e3;this.stickTable.set(o,{server:i,expiresAt:Date.now()+c})}return i}selectRoundRobin(t,e){const n=e.reduce((o,c)=>o+(c.weight||1),0);let s=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,s<i)return this.roundRobinCounters.set(t,(s+1)%n),`${o.address}:${o.port}`;return this.roundRobinCounters.set(t,(s+1)%n),`${e[0].address}:${e[0].port}`}selectLeastConnections(t){let e=1/0,n=t[0];for(const s of t){const i=`${s.address}:${s.port}`,c=(this.connectionCounts.get(i)||s.sessions||0)/(s.weight||1);c<e&&(e=c,n=s)}return`${n.address}:${n.port}`}selectSourceIP(t,e,n){const s=n.clientIP||n.headers?.["X-Real-IP"]||n.headers?.["X-Forwarded-For"]||"0.0.0.0",i=this.sourceHashMap.get(`${t}:${s}`);if(i&&e.some(h=>`${h.address}:${h.port}`===i))return i;const c=this.simpleHash(s)%e.length,u=`${e[c].address}:${e[c].port}`;return this.sourceHashMap.set(`${t}:${s}`,u),u}selectURIHash(t,e,n){const s=n.path,i=`${t}:${s}`,o=this.uriHashMap.get(i);if(o&&e.some(f=>`${f.address}:${f.port}`===o))return o;const u=this.simpleHash(s)%e.length,h=`${e[u].address}:${e[u].port}`;return this.uriHashMap.set(i,h),h}selectHeaderHash(t,e,n){const s=n.host||n.headers?.Host||n.path,o=this.simpleHash(s)%e.length;return`${e[o].address}:${e[o].port}`}simpleHash(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}getStickTableKey(t,e){switch(e){case"ip":return t.clientIP||t.headers?.["X-Real-IP"]||"0.0.0.0";case"string":return t.host||t.headers?.Host||"";case"integer":return t.headers?.["X-Forwarded-Port"]||"0";default:return t.clientIP||"0.0.0.0"}}evaluateACLs(t,e){for(const n of t)if(!this.evaluateACL(n,e).matched)return{matched:!1,error:`ACL ${n.name} failed`};return{matched:!0}}evaluateACL(t,e){const n=t.operator||"eq",s=t.value||"";if(t.criterion.startsWith("hdr(")){const i=t.criterion.match(/hdr\(([^)]+)\)/)?.[1];if(i){const o=(e.headers?.[i.toLowerCase()]||"").toLowerCase(),c=s.toLowerCase();return{matched:this.compareValues(o,c,n)}}}else{if(t.criterion==="path_beg")return{matched:e.path.toLowerCase().startsWith(s.toLowerCase())};if(t.criterion==="path_end")return{matched:e.path.toLowerCase().endsWith(s.toLowerCase())};if(t.criterion==="path")return{matched:this.compareValues(e.path.toLowerCase(),s.toLowerCase(),n)};if(t.criterion==="src"){const i=e.clientIP||e.headers?.["X-Real-IP"]||e.headers?.["X-Forwarded-For"]||"0.0.0.0";if(s.includes("/")){const[o,c]=s.split("/");return{matched:this.isIPInCIDR(i,o,parseInt(c||"32",10))}}else return{matched:this.compareValues(i,s,n)}}else{if(t.criterion==="method")return{matched:this.compareValues(e.method.toUpperCase(),s.toUpperCase(),n)};if(t.criterion==="url_param"){const i=s.split("=")[0],o=s.split("=")[1]||"",c=e.query?.[i]||"";return o?{matched:this.compareValues(c,o,n)}:{matched:!!c}}}}return{matched:!0}}compareValues(t,e,n){switch(n){case"eq":return t===e;case"ne":return t!==e;case"beg":return t.startsWith(e);case"end":return t.endsWith(e);case"sub":return t.includes(e);case"gt":return parseFloat(t)>parseFloat(e);case"lt":return parseFloat(t)<parseFloat(e);case"gte":return parseFloat(t)>=parseFloat(e);case"lte":return parseFloat(t)<=parseFloat(e);default:return t===e}}isIPInCIDR(t,e,n){if(n===32)return t===e;const s=t.split("."),i=e.split(".");if(s.length!==4||i.length!==4)return!1;const o=Math.floor(n/8);for(let c=0;c<o;c++)if(s[c]!==i[c])return!1;return!0}checkRateLimit(t){if(!this.globalConfig.rateLimit?.enabled)return{allowed:!0};const e=this.globalConfig.rateLimit,n=e.rate||"10r/s",s=e.burst||5,i=n.match(/(\d+)r\/([smh])/);if(!i)return{allowed:!0};const o=parseInt(i[1],10),c=i[2];let u=1e3;switch(c){case"s":u=1e3;break;case"m":u=6e4;break;case"h":u=36e5;break}const h=t.clientIP||t.headers?.["X-Real-IP"]||t.headers?.["X-Forwarded-For"]||"0.0.0.0",f=Date.now(),m=h;let y=this.rateLimitTracker.get(m);return(!y||f>=y.resetAt)&&(y={count:0,resetAt:f+u}),y.count>=o+s?{allowed:!1}:(y.count++,this.rateLimitTracker.set(m,y),{allowed:!0})}startHealthCheck(t,e,n){const s=`${t}:${e.address}:${e.port}`,i=this.healthCheckTimers.get(s);i&&clearInterval(i);const o=n.interval||2e3,c=n.timeout||1e3,u=n.fall||3,h=n.rise||2,f=setInterval(()=>{e.lastCheck=Date.now(),e.checkStatus="checking";const m=Math.random()>.1;setTimeout(()=>{if(m){const y=(this.serverCheckSuccesses.get(s)||0)+1;this.serverCheckSuccesses.set(s,y),this.serverCheckFailures.set(s,0),e.status==="down"&&y>=h?(e.status="up",e.checkStatus="passed"):e.status==="up"&&(e.checkStatus="passed")}else{const y=(this.serverCheckFailures.get(s)||0)+1;this.serverCheckFailures.set(s,y),this.serverCheckSuccesses.set(s,0),e.status==="up"&&y>=u?(e.status="down",e.checkStatus="failed"):e.status==="down"&&(e.checkStatus="failed")}},c)},o);this.healthCheckTimers.set(s,f)}extractPort(t){const e=t.match(/:(\d+)$/);return e?parseInt(e[1],10):80}getStats(){let t=0,e=0,n=0;for(const i of this.backends.values()){t+=i.servers.length;for(const o of i.servers)o.status==="up"?e++:n++}const s=this.requestCount>0?this.errorCount/this.requestCount:0;return{frontends:this.frontends.size,backends:this.backends.size,totalServers:t,upServers:e,downServers:n,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:s,rateLimitBlocks:this.rateLimitBlocks,timeoutErrors:this.timeoutErrors,connectionRejects:this.connectionRejects}}getFrontendStats(t){const e=this.frontends.get(t);return e?{requests:e.requests||0,responses:e.responses||0,bytesIn:e.bytesIn||0,bytesOut:e.bytesOut||0}:null}getBackendStats(t){const e=this.backends.get(t);if(!e)return null;let n=0,s=0,i=0,o=0,c=0,u=0;for(const h of e.servers)h.status==="up"?n++:s++,i+=h.sessions||0,o+=h.bytesIn||0,c+=h.bytesOut||0,u+=h.errors||0;return{servers:e.servers.length,upServers:n,downServers:s,totalSessions:i,totalBytesIn:o,totalBytesOut:c,totalErrors:u}}updateServerStatus(t,e,n){const s=this.backends.get(t);if(!s)return;const i=s.servers.find(o=>o.id===e);i&&(i.status=n)}destroy(){for(const t of this.healthCheckTimers.values())clearInterval(t);this.healthCheckTimers.clear()}}class Hk{clusters=new Map;listeners=new Map;routes=new Map;globalConfig={};roundRobinCounters=new Map;leastRequestCounts=new Map;connectionCounts=new Map;ringHashMapping=new Map;maglevTable=new Map;circuitBreakerState=new Map;outlierDetectionState=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;rateLimitBlocks=0;timeoutErrors=0;circuitBreakerTrips=0;healthCheckTimers=new Map;endpointCheckFailures=new Map;endpointCheckSuccesses=new Map;rateLimitTracker=new Map;initialize(t){this.clusters.clear(),this.listeners.clear(),this.routes.clear(),this.roundRobinCounters.clear(),this.leastRequestCounts.clear(),this.connectionCounts.clear(),this.ringHashMapping.clear(),this.maglevTable.clear(),this.circuitBreakerState.clear(),this.outlierDetectionState.clear(),this.endpointCheckFailures.clear(),this.endpointCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.clusters)for(const e of t.clusters){if(this.clusters.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),this.leastRequestCounts.set(e.name,new Map),this.circuitBreakerState.set(e.name,{isOpen:!1,consecutiveErrors:0}),this.outlierDetectionState.set(e.name,new Map),e.healthCheck?.enabled&&e.endpoints)for(const n of e.endpoints){const s=`${n.address}:${n.port}`;this.leastRequestCounts.get(e.name).set(s,0),this.startHealthCheck(e.name,n,e.healthCheck)}else for(const n of e.endpoints){const s=`${n.address}:${n.port}`;this.leastRequestCounts.get(e.name).set(s,0)}(e.loadBalancingPolicy==="RING_HASH"||e.loadBalancingPolicy==="MAGLEV")&&this.buildHashTable(e.name,e)}if(t.listeners)for(const e of t.listeners)this.listeners.set(e.name,{...e});if(t.routes){const e=[...t.routes].sort((n,s)=>(s.priority||0)-(n.priority||0));for(const n of e)this.routes.set(n.name,{...n})}this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.rateLimitBlocks=0,this.timeoutErrors=0,this.circuitBreakerTrips=0}routeRequest(t,e){const n=Date.now();this.requestCount++;const s=this.globalConfig.maxConnections||1024;if(this.activeConnections>=s)return this.errorCount++,{listener:null,route:null,cluster:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-n}};if(this.activeConnections++,this.globalConfig.rateLimit?.enabled&&!this.checkRateLimit(t).allowed)return this.activeConnections--,this.rateLimitBlocks++,this.errorCount++,{listener:null,route:null,cluster:null,response:{status:429,error:"Rate limit exceeded",latency:Date.now()-n}};let i=null;if(e)i=this.listeners.get(e)||null;else{for(const[_,P]of this.listeners.entries()){const z=P.protocol||"HTTP";if(t.protocol==="https"&&(z==="HTTPS"||P.port===443)){i=P;break}else if(t.protocol==="http"&&(z==="HTTP"||P.port===80)){i=P;break}}!i&&this.listeners.size>0&&(i=Array.from(this.listeners.values())[0])}if(!i)return this.activeConnections--,this.errorCount++,{listener:null,route:null,cluster:null,response:{status:503,error:"No listener available",latency:Date.now()-n}};i.requests=(i.requests||0)+1,i.activeConnections=(i.activeConnections||0)+1;for(const _ of i.filters){const P=this.processFilter(_,t);if(!P.allowed)return this.activeConnections--,this.errorCount++,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:null,cluster:null,response:{status:P.status||403,error:P.error||"Filter denied",latency:Date.now()-n}};P.modifiedRequest&&(t=P.modifiedRequest)}let o=null;for(const _ of this.routes.values())if(this.matchRoute(_,t)){o=_;break}if(!o)return this.activeConnections--,this.errorCount++,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:null,cluster:null,response:{status:404,error:"No route matched",latency:Date.now()-n}};o.requests=(o.requests||0)+1;const c=this.clusters.get(o.cluster);if(!c)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:null,response:{status:503,error:`Cluster ${o.cluster} not found`,latency:Date.now()-n}};const u=this.circuitBreakerState.get(c.name);if(u&&c.circuitBreaker?.enabled&&u.isOpen){if(u.openUntil&&Date.now()<u.openUntil)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,c.errors=(c.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:c,response:{status:503,error:"Circuit breaker is open",latency:Date.now()-n,clusterTarget:c.name}};u.isOpen=!1,u.consecutiveErrors=0}const h=this.selectEndpoint(c,t);if(!h)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,c.errors=(c.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:c,response:{status:503,error:"No healthy endpoint available",latency:Date.now()-n,clusterTarget:c.name}};c.requests=(c.requests||0)+1,c.activeConnections=(c.activeConnections||0)+1;const f=c.endpoints.find(_=>`${_.address}:${_.port}`===h);f&&(f.requests=(f.requests||0)+1);const m=c.connectTimeout||this.globalConfig.connectTimeout||5e3,y=o.timeout||this.globalConfig.requestTimeout||15e3,v=Math.min(50+Math.random()*100,m);if(v>=m*.9)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,o.errors=(o.errors||0)+1,c.errors=(c.errors||0)+1,c.activeConnections=(c.activeConnections||1)-1,i.activeConnections=(i.activeConnections||1)-1,f&&(f.errors=(f.errors||0)+1,this.updateOutlierDetection(c.name,h,!0)),{listener:i,route:o,cluster:c,response:{status:504,error:"Connection timeout",latency:m,clusterTarget:c.name,endpointTarget:h}};const x=10+Math.random()*90,S=v+x;if(S>y)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,o.errors=(o.errors||0)+1,c.errors=(c.errors||0)+1,c.activeConnections=(c.activeConnections||1)-1,i.activeConnections=(i.activeConnections||1)-1,f&&(f.errors=(f.errors||0)+1,this.updateOutlierDetection(c.name,h,!0)),{listener:i,route:o,cluster:c,response:{status:504,error:"Request timeout",latency:y,clusterTarget:c.name,endpointTarget:h}};const R=Math.random()>.1,M=R?200:500+Math.floor(Math.random()*3);R?(this.updateCircuitBreaker(c.name,!1),this.responseCount++,o.responses=(o.responses||0)+1):(this.errorCount++,o.errors=(o.errors||0)+1,c.errors=(c.errors||0)+1,f&&(f.errors=(f.errors||0)+1,this.updateOutlierDetection(c.name,h,!0)),this.updateCircuitBreaker(c.name,!0));const T=1024,k=2048;this.totalBytesIn+=T,this.totalBytesOut+=k,f&&(f.responseTime=S),this.activeConnections--,i.activeConnections=(i.activeConnections||1)-1,c.activeConnections=(c.activeConnections||1)-1;const A={status:M,body:{proxied:!0,cluster:c.name,endpoint:h},latency:S,clusterTarget:c.name,endpointTarget:h};return{listener:i,route:o,cluster:c,response:A,clusterTarget:c.name,endpointTarget:h}}matchRoute(t,e){const n=t.match;if(n.prefix&&!e.path.startsWith(n.prefix)||n.path&&e.path!==n.path||n.regex&&!new RegExp(n.regex).test(e.path))return!1;if(n.headers)for(const s of n.headers){const i=e.headers?.[qk(s.name)]||"";if(s.exact&&i!==s.exact||s.prefix&&!i.startsWith(s.prefix)||s.suffix&&!i.endsWith(s.suffix)||s.regex&&!new RegExp(s.regex).test(i))return!1}if(n.queryParameters)for(const s of n.queryParameters){const i=e.query?.[s.name]||"";if(s.exact&&i!==s.exact||s.regex&&!new RegExp(s.regex).test(i))return!1}return!0}processFilter(t,e){switch(t.type){case"http_connection_manager":return{allowed:!0};case"tls_inspector":return e.protocol==="https"?{allowed:!0}:{allowed:!0};case"router":return{allowed:!0};case"cors":return{allowed:!0,modifiedRequest:e};case"ratelimit":return{allowed:!0};case"fault":const n=t.config?.faultRate||0;return Math.random()<n?{allowed:!1,status:t.config?.faultStatusCode||503,error:"Fault injected"}:{allowed:!0};case"ext_authz":return{allowed:!0};default:return{allowed:!0}}}selectEndpoint(t,e){const n=t.endpoints.filter(o=>{const c=`${o.address}:${o.port}`,u=this.outlierDetectionState.get(t.name)?.get(c);return u?.ejectedUntil&&Date.now()<u.ejectedUntil?!1:o.healthStatus!=="unhealthy"&&o.healthStatus!=="timeout"});if(n.length===0)return null;const s=t.loadBalancingPolicy||"ROUND_ROBIN";let i;switch(s){case"ROUND_ROBIN":i=this.selectRoundRobin(t.name,n);break;case"LEAST_REQUEST":i=this.selectLeastRequest(t.name,n);break;case"RING_HASH":case"MAGLEV":i=this.selectHashBased(t.name,n,e);break;case"RANDOM":i=n[Math.floor(Math.random()*n.length)];break;default:i=n[0]}return`${i.address}:${i.port}`}selectRoundRobin(t,e){const n=e.reduce((o,c)=>o+(c.weight||1),0);let s=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,s<i)return this.roundRobinCounters.set(t,(s+1)%n),o;return this.roundRobinCounters.set(t,(s+1)%n),e[0]}selectLeastRequest(t,e){const n=this.leastRequestCounts.get(t)||new Map;let s=1/0,i=e[0];for(const u of e){const h=`${u.address}:${u.port}`,m=(n.get(h)||0)/(u.weight||1);m<s&&(s=m,i=u)}const o=`${i.address}:${i.port}`,c=n.get(o)||0;return n.set(o,c+1),i}selectHashBased(t,e,n){const s=n.host||n.path||n.clientIP||"default",o=this.simpleHash(s)%e.length;return e[o]}simpleHash(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}buildHashTable(t,e){const n=e.endpoints.map(s=>`${s.address}:${s.port}`);this.ringHashMapping.set(t,n)}checkRateLimit(t){if(!this.globalConfig.rateLimit?.enabled)return{allowed:!0};const e=this.globalConfig.rateLimit.rate||100,n=this.globalConfig.rateLimit.burst||10,s=t.clientIP||t.headers?.["X-Real-IP"]||t.headers?.["X-Forwarded-For"]||"0.0.0.0",i=Date.now(),o=s;let c=this.rateLimitTracker.get(o);return(!c||i>=c.resetAt)&&(c={count:0,resetAt:i+1e3}),c.count>=e+n?{allowed:!1}:(c.count++,this.rateLimitTracker.set(o,c),{allowed:!0})}updateCircuitBreaker(t,e){const n=this.clusters.get(t);if(!n||!n.circuitBreaker?.enabled)return;const s=this.circuitBreakerState.get(t);if(s)if(e){s.consecutiveErrors++;const i=n.circuitBreaker.consecutiveErrors||5;s.consecutiveErrors>=i&&!s.isOpen&&(s.isOpen=!0,s.openUntil=Date.now()+3e4,this.circuitBreakerTrips++)}else s.consecutiveErrors=0,s.isOpen&&(s.isOpen=!1,s.openUntil=void 0)}updateOutlierDetection(t,e,n){const s=this.clusters.get(t);if(!s||!s.outlierDetection?.enabled)return;let i=this.outlierDetectionState.get(t);i||(i=new Map,this.outlierDetectionState.set(t,i));let o=i.get(e);if(o||(o={consecutiveErrors:0},i.set(e,o)),n){o.consecutiveErrors++;const c=s.outlierDetection.consecutiveErrors||5,u=s.outlierDetection.baseEjectionTime||3e4;if(o.consecutiveErrors>=c){o.ejectedUntil=Date.now()+u;const h=s.endpoints.find(f=>`${f.address}:${f.port}`===e);h&&(h.healthStatus="unhealthy")}}else if(o.consecutiveErrors=0,o.ejectedUntil&&Date.now()>=o.ejectedUntil){o.ejectedUntil=void 0;const c=s.endpoints.find(u=>`${u.address}:${u.port}`===e);c&&(c.healthStatus="healthy")}}startHealthCheck(t,e,n){const s=`${t}:${e.address}:${e.port}`,i=this.healthCheckTimers.get(s);i&&clearInterval(i);const o=n.interval||1e4,c=n.timeout||5e3,u=n.healthyThreshold||1,h=n.unhealthyThreshold||2,f=setInterval(()=>{e.lastCheck=Date.now();const m=Math.random()>.1;setTimeout(()=>{if(m){const y=(this.endpointCheckSuccesses.get(s)||0)+1;this.endpointCheckSuccesses.set(s,y),this.endpointCheckFailures.set(s,0),(e.healthStatus==="unhealthy"&&y>=u||!e.healthStatus||e.healthStatus==="unknown")&&(e.healthStatus="healthy")}else{const y=(this.endpointCheckFailures.get(s)||0)+1;this.endpointCheckFailures.set(s,y),this.endpointCheckSuccesses.set(s,0),(e.healthStatus==="healthy"&&y>=h||!e.healthStatus||e.healthStatus==="unknown")&&(e.healthStatus="unhealthy")}},c)},o);this.healthCheckTimers.set(s,f)}getStats(){let t=0,e=0,n=0;for(const i of this.clusters.values()){t+=i.endpoints.length;for(const o of i.endpoints)o.healthStatus==="healthy"?e++:o.healthStatus==="unhealthy"&&n++}const s=this.requestCount>0?this.errorCount/this.requestCount:0;return{clusters:this.clusters.size,listeners:this.listeners.size,routes:this.routes.size,totalEndpoints:t,healthyEndpoints:e,unhealthyEndpoints:n,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:s,rateLimitBlocks:this.rateLimitBlocks,timeoutErrors:this.timeoutErrors,circuitBreakerTrips:this.circuitBreakerTrips}}getClusterStats(t){const e=this.clusters.get(t);if(!e)return null;let n=0,s=0;for(const i of e.endpoints)i.healthStatus==="healthy"?n++:i.healthStatus==="unhealthy"&&s++;return{requests:e.requests||0,errors:e.errors||0,activeConnections:e.activeConnections||0,healthyEndpoints:n,unhealthyEndpoints:s}}getListenerStats(t){const e=this.listeners.get(t);return e?{activeConnections:e.activeConnections||0,requests:e.requests||0,responses:e.responses||0}:null}getRouteStats(t){const e=this.routes.get(t);return e?{requests:e.requests||0,responses:e.responses||0,errors:e.errors||0}:null}destroy(){for(const t of this.healthCheckTimers.values())clearInterval(t);this.healthCheckTimers.clear()}}function qk(r){return r.toLowerCase()}class $k{parseQuery(t){const e=t.query.trim(),n=this.extractOperationType(e),s=t.operationName||this.extractOperationName(e),i=this.extractFields(e),o=this.calculateDepth(e),c=this.estimateComplexity(e,s);return{operationName:s,operationType:n,fields:i,depth:o,complexity:c,rawQuery:e}}extractOperationType(t){const e=t.trim();return e.startsWith("mutation")?"mutation":e.startsWith("subscription")?"subscription":"query"}extractOperationName(t){const e=t.match(/(?:query|mutation|subscription)\s+([a-zA-Z0-9_]+)/);return e?e[1]:void 0}extractFields(t){const e=[],n=/([a-zA-Z0-9_]+)\s*(?:\(|\{)/g;let s;for(;(s=n.exec(t))!==null;)e.push(s[1]);return e.length>0?e:["unknown"]}calculateDepth(t){let e=0,n=0;for(const s of t)s==="{"?(e+=1,n=Math.max(n,e)):s==="}"&&(e=Math.max(0,e-1));return n}estimateComplexity(t,e){const n=t.match(/[a-zA-Z0-9_]+(\s*[({])/g),s=n?n.length:5,i=this.calculateDepth(t),o=e?Math.max(1,e.length%5):1;return Math.round(s*(1+i*.5)*o*10)}}class Bk{federationConfig;constructor(t){this.federationConfig=t}planQuery(t,e){if(e.length===0)return{subqueries:[],requiresFederation:!1,estimatedLatency:0};const n=this.federationConfig?.enabled??!1,i=this.selectServices(t,e).map(u=>({serviceId:u.id,serviceName:u.name,endpoint:u.endpoint,query:t.rawQuery,fields:t.fields,estimatedLatency:this.estimateServiceLatency(u,t)})),o=i.reduce((u,h)=>u+h.estimatedLatency,0),c=n?3+Math.random()*5:0;return{subqueries:i,requiresFederation:n,estimatedLatency:o+c}}selectServices(t,e){if(this.federationConfig?.enabled&&this.federationConfig.services?.length){const i=e.filter(o=>this.federationConfig.services.includes(o.name));return i.length>0?i:e.slice(0,Math.min(2,e.length))}const n=this.hashString(t.operationName||t.rawQuery),s=Math.abs(n)%e.length;return[e[s]]}estimateServiceLatency(t,e){const n=t.avgLatencyMs,s=Math.sqrt(e.complexity)*.8,i=e.depth*1.5,o=Math.random()*5;return n+s+i+o}hashString(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e|=0}return e}updateFederationConfig(t){this.federationConfig=t}}class Uk{serviceRegistry;constructor(t){this.serviceRegistry=t}executePlan(t){if(t.subqueries.length===0)return{success:!1,totalLatency:0,error:"No services available",executedEndpoints:[]};let e=0;const n=[];for(const s of t.subqueries){const i=this.serviceRegistry.getService(s.serviceId);if(!i)return{success:!1,totalLatency:e,error:`Service ${s.serviceId} not found`,failedService:s.serviceId,executedEndpoints:n};const o=s.endpoint||i.endpoint;n.push(o);const u=this.getEndpointLatency(o,i.avgLatencyMs)+(s.estimatedLatency-i.avgLatencyMs);if(e+=u,Math.random()<i.errorRate)return this.serviceRegistry.recordRequest(i.id,u,!1),{success:!1,totalLatency:e,error:`Upstream error at ${i.name} (${o})`,failedService:i.id,executedEndpoints:n};this.serviceRegistry.recordRequest(i.id,u,!0)}return{success:!0,totalLatency:e,executedEndpoints:n}}getEndpointLatency(t,e){return t.includes("localhost")||t.includes("127.0.0.1")?e*.8:t.includes("https://")?e*1.1:e}}class Fk{services=new Map;registerService(t){const e=this.services.get(t.id);this.services.set(t.id,{id:t.id,name:t.name,endpoint:t.endpoint,avgLatencyMs:t.avgLatencyMs??20,errorRate:t.errorRate??.01,status:t.status??"connected",rollingLatency:e?.rollingLatency||[],rollingErrors:e?.rollingErrors||[]})}unregisterService(t){this.services.delete(t)}getConnectedServices(){return Array.from(this.services.values()).filter(t=>t.status==="connected")}getService(t){return this.services.get(t)}getServiceByName(t){return Array.from(this.services.values()).find(e=>e.name===t)}recordRequest(t,e,n){const s=this.services.get(t);if(!s)return;s.rollingLatency.push(e),s.rollingLatency.length>50&&s.rollingLatency.shift(),n||(s.rollingErrors.push(e),s.rollingErrors.length>50&&s.rollingErrors.shift());const i=s.rollingLatency.reduce((c,u)=>c+u,0)/s.rollingLatency.length;s.avgLatencyMs=i;const o=s.rollingErrors.length/Math.max(s.rollingLatency.length,1);s.errorRate=o}initialize(t){this.services.clear();for(const e of t)this.registerService(e)}getAllServices(){return Array.from(this.services.values())}}class Vk{cache=new Map;ttl;persistQueries;constructor(t=0,e=!1){this.ttl=t,this.persistQueries=e}generateCacheKey(t,e){const n=e?JSON.stringify(e):"";return this.hashString(t+n)}getCached(t,e){if(this.ttl<=0||!this.persistQueries)return{hit:!1,latencyReduction:0};const n=this.generateCacheKey(t,e),s=this.cache.get(n);return s?Date.now()-s.timestamp>s.ttl*1e3?(this.cache.delete(n),{hit:!1,latencyReduction:0}):{hit:!0,latencyReduction:.7}:{hit:!1,latencyReduction:0}}setCached(t,e,n){if(this.ttl<=0||!this.persistQueries)return;const s=this.generateCacheKey(t,n);if(this.cache.set(s,{query:t,response:e,timestamp:Date.now(),ttl:this.ttl}),this.cache.size>1e3){const i=this.cache.keys().next().value;this.cache.delete(i)}}getCacheHitProbability(t){if(this.ttl<=0||!this.persistQueries)return 0;const e=.2,n=Math.min(t.complexity/2e3,.4);return Math.min(e+n,.6)}updateConfig(t,e){t!==void 0&&(this.ttl=t),e!==void 0&&(this.persistQueries=e)}clearCache(){this.cache.clear()}hashString(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e|=0}return Math.abs(e).toString(16)}}class Gk{enabled;limits=new Map;defaultLimit=100;windowMs=6e4;constructor(t=!1,e=100){this.enabled=t,this.defaultLimit=e}checkLimit(t,e){if(!this.enabled)return{allowed:!0,remaining:1/0,resetAt:Date.now()+this.windowMs};const n=e||this.defaultLimit,s=Date.now(),i=this.limits.get(t);if(!i||s>=i.resetAt){const o={count:1,resetAt:s+this.windowMs,windowStart:s};return this.limits.set(t,o),{allowed:!0,remaining:n-1,resetAt:o.resetAt}}return i.count>=n?{allowed:!1,remaining:0,resetAt:i.resetAt}:(i.count+=1,{allowed:!0,remaining:n-i.count,resetAt:i.resetAt})}getIdentifier(t){if(!t)return"default";const e=t["x-api-key"]||t.apikey;if(e)return`key:${e}`;const n=t["x-client-id"];return n?`client:${n}`:"default"}setEnabled(t){this.enabled=t}updateDefaultLimit(t){this.defaultLimit=t}clearLimits(){this.limits.clear()}}class Qk{maxQueryDepth;maxQueryComplexity;enabled;constructor(t=15,e=1e3,n=!0){this.maxQueryDepth=t,this.maxQueryComplexity=e,this.enabled=n}validateQuery(t){return this.enabled?t.depth>this.maxQueryDepth?{valid:!1,error:`Query depth ${t.depth} exceeds limit ${this.maxQueryDepth}`}:t.complexity>this.maxQueryComplexity?{valid:!1,error:`Query complexity ${t.complexity} exceeds limit ${this.maxQueryComplexity}`}:{valid:!0}:{valid:!0}}updateLimits(t,e){t!==void 0&&(this.maxQueryDepth=t),e!==void 0&&(this.maxQueryComplexity=e)}setEnabled(t){this.enabled=t}}class Kk{config;constructor(t){this.config=t}isEnabled(){return this.config?.enabled??!1}getVersion(){return this.config?.version}getFederatedServices(){return this.config?.services||[]}getPlanningOverhead(){return this.isEnabled()?(this.config?.version==="2"?2:4)+Math.random()*3:0}isFederatedService(t){return this.isEnabled()?this.config?.services?.includes(t.name)??!1:!1}getSupergraphSchema(){return this.config?.supergraph}updateConfig(t){this.config=t}}class Yk{queryParser;queryPlanner;queryExecutor;serviceRegistry;cacheManager;rateLimiter;complexityAnalyzer;federationComposer;constructor(){this.serviceRegistry=new Fk,this.queryParser=new $k,this.queryPlanner=new Bk,this.queryExecutor=new Uk(this.serviceRegistry),this.cacheManager=new Vk,this.rateLimiter=new Gk,this.complexityAnalyzer=new Qk,this.federationComposer=new Kk}initialize(t){t.services&&this.serviceRegistry.initialize(t.services),this.federationComposer.updateConfig(t.federation),this.queryPlanner.updateFederationConfig(t.federation),this.cacheManager.updateConfig(t.cacheTtl??0,t.persistQueries??!1),this.rateLimiter.setEnabled(t.enableRateLimiting??!1),this.complexityAnalyzer.updateLimits(t.maxQueryDepth??15,t.maxQueryComplexity??1e3),this.complexityAnalyzer.setEnabled(t.enableQueryComplexityAnalysis??!0)}routeRequest(t){const e=Date.now();if(!t.query||t.query.trim().length===0)return{status:400,latency:Date.now()-e,error:"Empty query"};const n=this.rateLimiter.getIdentifier(t.headers);if(!this.rateLimiter.checkLimit(n).allowed)return{status:429,latency:Date.now()-e,error:"Rate limit exceeded"};const i=this.queryParser.parseQuery(t),o=this.cacheManager.getCached(t.query,t.variables);if(o.hit)return{status:200,latency:(Date.now()-e)*(1-o.latencyReduction)};const c=this.complexityAnalyzer.validateQuery(i);if(!c.valid)return{status:413,latency:Date.now()-e,error:c.error};const u=this.serviceRegistry.getConnectedServices();if(u.length===0)return{status:503,latency:Date.now()-e,error:"No connected services"};const h=this.queryPlanner.planQuery(i,u),f=this.queryExecutor.executePlan(h);return f.success?(this.cacheManager.setCached(t.query,{success:!0},t.variables),{status:200,latency:f.totalLatency+(Date.now()-e)}):{status:502,latency:f.totalLatency+(Date.now()-e),error:f.error}}getServiceRegistry(){return this.serviceRegistry}getCacheManager(){return this.cacheManager}getRateLimiter(){return this.rateLimiter}}class Wk{backends=new Map;endpoints=new Map;config={};circuitBreakers=new Map;cache=new Map;cacheMode="memory";defaultCacheTtl=5;redisEngine=null;redisNodeId="";backendMetrics=new Map;batchQueue=new Map;batchTimer=null;batchSize=10;batchTimeout=50;initialize(t){if(this.config=t,this.backends.clear(),this.endpoints.clear(),this.circuitBreakers.clear(),this.cache.clear(),this.backendMetrics.clear(),this.cacheMode=t.cacheMode||"memory",this.defaultCacheTtl=t.cacheTtl||5,this.redisEngine=t.redisEngine||null,this.redisNodeId=t.redisNodeId||"",t.backends)for(const e of t.backends)this.backends.set(e.id,{...e}),this.initializeCircuitBreaker(e.id,e.circuitBreaker),this.initializeBackendMetrics(e.id);if(t.endpoints)for(const e of t.endpoints)this.endpoints.set(e.id,{...e})}initializeCircuitBreaker(t,e){e?.enabled&&this.circuitBreakers.set(t,{failures:0,successes:0,state:"closed",lastFailureTime:0,nextAttemptTime:0})}initializeBackendMetrics(t){this.backendMetrics.set(t,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,cacheHits:0,cacheMisses:0})}routeRequest(t){const e=Date.now(),n=this.matchEndpoint(t);if(!n)return{status:404,error:"Endpoint not found",latency:Date.now()-e,backendResponses:[],cacheHit:!1};if(this.config.enableCaching&&this.cacheMode!=="off"){const o=this.getCacheKey(n,t),c=this.getCached(o);if(c){const u=this.backendMetrics.get(n.backends[0])||this.initializeBackendMetrics(n.backends[0]);return u&&u.cacheHits++,{status:200,data:c.data,latency:Date.now()-e,backendResponses:[],cacheHit:!0}}}const s=this.aggregateBackends(n,t),i=this.aggregateResponses(n,s);if(this.config.enableCaching&&this.cacheMode!=="off"&&i.status===200){const o=this.getCacheKey(n,t),c=n.cacheTtl||this.defaultCacheTtl;this.setCached(o,i.data,c)}for(const o of s){const c=this.backendMetrics.get(o.backendId);c&&(c.requestCount++,o.status>=400&&c.errorCount++,c.totalLatency+=o.latency,c.averageLatency=c.totalLatency/c.requestCount,c.lastRequestTime=Date.now(),o.cached||c.cacheMisses++)}return{...i,latency:Date.now()-e,backendResponses:s,cacheHit:!1}}matchEndpoint(t){for(const e of this.endpoints.values())if(e.path===t.path&&e.method===t.method)return e;return null}aggregateBackends(t,e){const n=t.backends;switch(t.aggregator){case"parallel":return this.executeBackendsParallel(n,e,t);case"sequential":return this.executeBackendsSequential(n,e,t);case"merge":default:return this.executeBackendsParallel(n,e,t)}}executeBackendsParallel(t,e,n){const s=[];for(const i of t){const o=this.executeBackend(i,e,n);s.push(o)}return s}executeBackendsSequential(t,e,n){const s=[];let i={};for(const o of t){const c={...e,body:{...typeof e.body=="object"?e.body:{},...i}},u=this.executeBackend(o,c,n);if(s.push(u),u.status>=200&&u.status<300&&u.data)typeof u.data=="object"&&(i={...i,...u.data});else break}return s}executeBackend(t,e,n){const s=this.backends.get(t);if(!s)return{backendId:t,status:503,error:"Backend not found",latency:0,cached:!1};const i=this.circuitBreakers.get(t);if(i){const f=Date.now();if(i.state==="open"){if(f<i.nextAttemptTime)return{backendId:t,status:503,error:"Circuit breaker is open",latency:0,cached:!1};i.state="half-open"}}if(this.config.enableCaching&&this.cacheMode!=="off"){const f=`${t}:${n.path}:${JSON.stringify(e.query||{})}`,m=this.getCached(f);if(m)return{backendId:t,status:200,data:m.data,latency:1,cached:!0}}n.timeout||s.timeout||this.config.defaultTimeout;const o=s.retries||0,c=s.retryBackoff||"exponential";let u,h=0;for(let f=0;f<=o;f++){if(f>0){const R=this.calculateBackoff(f,c);h+=R}const m=50+Math.random()*150,y=(Math.random()-.5)*20,v=m+y;h+=v;const x=s.status==="connected"?.95:.5;if(Math.random()<x){i&&(i.state==="half-open"?(i.successes++,i.successes>=(s.circuitBreaker?.successThreshold||2)&&(i.state="closed",i.failures=0,i.successes=0)):i.failures=Math.max(0,i.failures-1));const R=this.generateMockResponse(s,e);return{backendId:t,status:200,data:R,latency:h,cached:!1}}else u=`Backend error (attempt ${f+1}/${o+1})`,i&&(i.failures++,i.lastFailureTime=Date.now(),i.failures>=(s.circuitBreaker?.failureThreshold||5)&&(i.state="open",i.nextAttemptTime=Date.now()+(s.circuitBreaker?.timeout||6e4)))}return{backendId:t,status:503,error:u||"Backend request failed",latency:h,cached:!1}}calculateBackoff(t,e){switch(e){case"exponential":return Math.min(1e3*Math.pow(2,t-1),1e4);case"linear":return 100*t;case"constant":default:return 100}}generateMockResponse(t,e){const n=t.name.toLowerCase();return n.includes("user")||n.includes("profile")?{id:Math.floor(Math.random()*1e3),name:"John Doe",email:"john.doe@example.com",avatar:"https://example.com/avatar.jpg"}:n.includes("order")||n.includes("cart")?{id:Math.floor(Math.random()*1e3),items:[{id:1,name:"Product 1",price:29.99,quantity:2},{id:2,name:"Product 2",price:49.99,quantity:1}],total:109.97}:n.includes("product")||n.includes("catalog")?{products:[{id:1,name:"Product 1",price:29.99,inStock:!0},{id:2,name:"Product 2",price:49.99,inStock:!0}],total:2}:{data:"Mock response",timestamp:Date.now()}}aggregateResponses(t,e){if(e.length===0)return{status:503,error:"No backends configured for endpoint"};if(e.every(i=>i.status>=400))return{status:503,error:"All backends failed"};const s=e.some(i=>i.status>=400);if(t.aggregator==="merge"||t.aggregator==="parallel"){const i={};for(const o of e)if(o.status>=200&&o.status<300&&o.data){const u=this.backends.get(o.backendId)?.name||o.backendId;typeof o.data=="object"&&o.data,i[u]=o.data}return{status:s?207:200,data:i}}else{const i=e[e.length-1];return i.status>=200&&i.status<300?{status:200,data:i.data}:{status:i.status,error:i.error}}}getCacheKey(t,e){return t.cacheKey?t.cacheKey:`${t.path}:${t.method}:${JSON.stringify(e.query||{})}`}getCached(t){if(this.cacheMode==="off")return null;if(this.cacheMode==="redis"&&this.redisEngine){const n=this.getRedisCacheKey(t),s=this.redisEngine.executeCommand("GET",[n]);if(s.success&&s.value!==null)try{const i=typeof s.value=="string"?JSON.parse(s.value):s.value;return{key:t,data:i,expiresAt:Date.now()+this.defaultCacheTtl*1e3,hitCount:1}}catch{return null}return null}const e=this.cache.get(t);return e?Date.now()>e.expiresAt?(this.cache.delete(t),null):(e.hitCount++,e):null}setCached(t,e,n){if(this.cacheMode!=="off"){if(this.cacheMode==="redis"&&this.redisEngine){const s=this.getRedisCacheKey(t),i=typeof e=="string"?e:JSON.stringify(e),o=[s,i];n>0&&o.push("EX",String(n)),this.redisEngine.executeCommand("SET",o);return}this.cache.set(t,{key:t,data:e,expiresAt:Date.now()+n*1e3,hitCount:0}),this.cache.size>1e3&&this.cleanupCache()}}getRedisCacheKey(t){return`${this.redisNodeId?`bff:${this.redisNodeId}:`:"bff:"}${t}`}cleanupCache(){const t=Date.now();for(const[e,n]of this.cache.entries())t>n.expiresAt&&this.cache.delete(e)}getStats(){let t=0,e=0,n=0,s=0,i=0;const o={};for(const[c,u]of this.backendMetrics.entries())t+=u.requestCount,e+=u.errorCount,n+=u.totalLatency,s+=u.cacheHits,i+=u.cacheMisses,o[c]={...u};return{totalRequests:t,totalErrors:e,averageLatency:t>0?n/t:0,cacheHitRate:s+i>0?s/(s+i):0,backendStats:o}}getBackendMetrics(t){return this.backendMetrics.get(t)}getBackends(){return Array.from(this.backends.values())}getEndpoints(){return Array.from(this.endpoints.values())}updateBackendStatus(t,e){const n=this.backends.get(t);n&&(n.status=e)}}class Xk{endpoints=new Map;config={};endpointMetrics=new Map;rateLimitState=new Map;globalRateLimitState=null;requestHistory=[];maxHistorySize=1e3;initialize(t){if(this.config=t,this.endpoints.clear(),this.endpointMetrics.clear(),this.rateLimitState.clear(),this.requestHistory=[],this.globalRateLimitState=null,t.endpoints)for(const e of t.endpoints){const n=e.id||`${e.method}:${e.path}`;this.endpoints.set(n,{...e,id:n,enabled:e.enabled!==!1}),this.initializeEndpointMetrics(n),e.rateLimit&&this.rateLimitState.set(n,{count:0,resetAt:Date.now()+1e3,burst:e.rateLimit})}t.rateLimit?.enabled&&(this.globalRateLimitState={count:0,resetAt:Date.now()+1e3,burst:t.rateLimit.burst||t.rateLimit.requestsPerSecond||1e3})}initializeEndpointMetrics(t){this.endpointMetrics.set(t,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,statusCodeCounts:new Map})}routeRequest(t){const e=Date.now(),n=this.matchEndpoint(t);if(!n)return{status:404,error:"Endpoint not found",latency:Date.now()-e};if(n.enabled===!1)return{status:503,error:"Endpoint is disabled",latency:Date.now()-e,endpoint:n.id};if(this.config.rateLimit?.enabled&&this.globalRateLimitState){const u=this.checkGlobalRateLimit();if(!u.allowed)return this.updateEndpointMetrics(n.id,Date.now()-e,429),{status:429,error:"Rate limit exceeded",latency:Date.now()-e,endpoint:n.id,headers:{"X-RateLimit-Limit":String(this.config.rateLimit.requestsPerSecond||1e3),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(u.resetAt||Date.now()+1e3)}}}if(n.rateLimit&&n.id){const u=this.checkEndpointRateLimit(n.id,n.rateLimit);if(!u.allowed)return this.updateEndpointMetrics(n.id,Date.now()-e,429),{status:429,error:"Endpoint rate limit exceeded",latency:Date.now()-e,endpoint:n.id,headers:{"X-RateLimit-Limit":String(n.rateLimit),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(u.resetAt||Date.now()+1e3)}}}const s=this.authenticate(t);if(!s.success)return this.updateEndpointMetrics(n.id,Date.now()-e,s.status||401),{status:s.status||401,error:s.error||"Authentication failed",latency:Date.now()-e,endpoint:n.id};const i=this.validateParameters(t,n);if(!i.valid)return this.updateEndpointMetrics(n.id,Date.now()-e,400),{status:400,error:i.error||"Invalid parameters",latency:Date.now()-e,endpoint:n.id};const o=this.simulateProcessingLatency(n),c=Date.now()-e+o;return this.updateEndpointMetrics(n.id,c,200),{status:200,data:this.generateResponse(n,t),latency:c,endpoint:n.id,headers:{"Content-Type":"application/json",...this.config.cors?.enabled?this.getCorsHeaders():{}}}}matchEndpoint(t){for(const e of this.endpoints.values())if(e.method===t.method&&e.path===t.path)return e;for(const e of this.endpoints.values())if(e.method===t.method&&this.matchPathPattern(e.path,t.path))return e;return null}matchPathPattern(t,e){const n=t.replace(/:[^/]+/g,"[^/]+").replace(/\*/g,".*");return new RegExp(`^${n}$`).test(e)}checkGlobalRateLimit(){if(!this.globalRateLimitState)return{allowed:!0};const t=Date.now();t>=this.globalRateLimitState.resetAt&&(this.globalRateLimitState.count=0,this.globalRateLimitState.resetAt=t+1e3);const e=this.config.rateLimit?.requestsPerSecond||1e3;return this.globalRateLimitState.count>=e?{allowed:!1,resetAt:this.globalRateLimitState.resetAt}:(this.globalRateLimitState.count++,{allowed:!0})}checkEndpointRateLimit(t,e){let n=this.rateLimitState.get(t);n||(n={count:0,resetAt:Date.now()+1e3,burst:e},this.rateLimitState.set(t,n));const s=Date.now();return s>=n.resetAt&&(n.count=0,n.resetAt=s+1e3),n.count>=e?{allowed:!1,resetAt:n.resetAt}:(n.count++,{allowed:!0})}authenticate(t){const e=this.config.authentication;if(!e||e.type==="none")return{success:!0};switch(e.type){case"bearer":{const n=t.headers?.Authorization||t.headers?.authorization;if(!n||!n.startsWith("Bearer "))return{success:!1,status:401,error:"Missing or invalid Bearer token"};const s=n.replace("Bearer ","");return e.token&&s!==e.token?{success:!1,status:401,error:"Invalid Bearer token"}:{success:!0}}case"apiKey":{const n=e.apiKeyHeader||"X-API-Key",s=t.headers?.[n]||t.headers?.[n.toLowerCase()];return s?e.apiKey&&s!==e.apiKey?{success:!1,status:401,error:"Invalid API key"}:{success:!0}:{success:!1,status:401,error:"Missing API key"}}case"oauth2":{const n=t.headers?.Authorization||t.headers?.authorization;return!n||!n.startsWith("Bearer ")?{success:!1,status:401,error:"Missing OAuth2 token"}:{success:!0}}case"basic":{const n=t.headers?.Authorization||t.headers?.authorization;if(!n||!n.startsWith("Basic "))return{success:!1,status:401,error:"Missing Basic Auth credentials"};const s=n.replace("Basic ","");try{const i=atob(s),[o,c]=i.split(":");return e.username&&o!==e.username?{success:!1,status:401,error:"Invalid username"}:e.password&&c!==e.password?{success:!1,status:401,error:"Invalid password"}:{success:!0}}catch{return{success:!1,status:401,error:"Invalid Basic Auth format"}}}default:return{success:!0}}}validateParameters(t,e){if(!e.parameters||e.parameters.length===0)return{valid:!0};for(const n of e.parameters)if(n.required){let s;switch(n.in){case"query":s=t.query?.[n.name];break;case"path":s="present";break;case"header":s=t.headers?.[n.name]||t.headers?.[n.name.toLowerCase()];break}if(!s&&!n.defaultValue)return{valid:!1,error:`Missing required parameter: ${n.name} (in ${n.in})`}}return{valid:!0}}simulateProcessingLatency(t){const e=10+Math.random()*40,s={GET:0,POST:20,PUT:15,PATCH:10,DELETE:5}[t.method]||0,i=t.timeout?Math.random()*.1*t.timeout:0;return e+s+i}generateResponse(t,e){if(t.responseExample)try{return JSON.parse(t.responseExample)}catch{return{message:t.responseExample}}switch(t.method){case"GET":return{data:[],count:0,message:"Success"};case"POST":return{id:Math.random().toString(36).substring(7),...e.body||{},createdAt:new Date().toISOString()};case"PUT":case"PATCH":return{...e.body||{},updatedAt:new Date().toISOString()};case"DELETE":return{message:"Deleted successfully"};default:return{message:"Success"}}}getCorsHeaders(){const t=this.config.cors;return!t||!t.enabled?{}:{"Access-Control-Allow-Origin":t.allowedOrigins?.join(",")||"*","Access-Control-Allow-Methods":t.allowedMethods?.join(",")||"GET,POST,PUT,DELETE,PATCH","Access-Control-Allow-Headers":t.allowedHeaders?.join(",")||"Content-Type,Authorization"}}updateEndpointMetrics(t,e,n){let s=this.endpointMetrics.get(t);s||(this.initializeEndpointMetrics(t),s=this.endpointMetrics.get(t)),s.requestCount++,n>=400&&s.errorCount++,s.totalLatency+=e,s.averageLatency=s.totalLatency/s.requestCount,s.lastRequestTime=Date.now();const i=s.statusCodeCounts.get(n)||0;s.statusCodeCounts.set(n,i+1),this.requestHistory.push({endpoint:t,timestamp:Date.now(),latency:e,status:n}),this.requestHistory.length>this.maxHistorySize&&this.requestHistory.shift()}getEndpointStats(t){const e=this.endpointMetrics.get(t);if(!e)return null;const n={};for(const[s,i]of e.statusCodeCounts.entries())n[s]=i;return{requestCount:e.requestCount,errorCount:e.errorCount,averageLatency:e.averageLatency,lastRequestTime:e.lastRequestTime,statusCodeCounts:n}}getAllEndpointStats(){const t={};for(const e of this.endpoints.keys())t[e]=this.getEndpointStats(e);return t}getStats(){let t=0,e=0,n=0,s=0;for(const i of this.endpoints.values()){i.enabled!==!1&&s++;const o=this.endpointMetrics.get(i.id);o&&(t+=o.requestCount,e+=o.errorCount,n+=o.totalLatency)}return{totalEndpoints:this.endpoints.size,enabledEndpoints:s,totalRequests:t,totalErrors:e,averageLatency:t>0?n/t:0}}}class Jk{relays=new Map;config={};deliveries=new Map;pendingDeliveries=new Map;relayMetrics=new Map;initialize(t){if(this.config=t,this.relays.clear(),this.deliveries.clear(),this.pendingDeliveries.clear(),this.relayMetrics.clear(),t.relays)for(const e of t.relays)e.enabled&&(this.relays.set(e.id,{...e}),this.initializeRelayMetrics(e.id))}initializeRelayMetrics(t){this.relayMetrics.set(t,{totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0})}relayWebhook(t){const e=Date.now(),n=this.findMatchingRelay(t);if(!n)return{success:!1,status:404,latency:Date.now()-e,attempts:0,error:"No matching relay found"};if(n.allowedIps&&n.allowedIps.length>0&&t.ip&&!this.isIpAllowed(t.ip,n.allowedIps))return this.updateRelayMetrics(n.id,!1,Date.now()-e),{success:!1,status:403,latency:Date.now()-e,attempts:0,error:"IP address not allowed",relayId:n.id};if(this.config.enableSignatureVerification&&n.signatureSecret&&!this.verifySignature(t,n.signatureSecret,n.signatureHeader||"X-Signature"))return this.updateRelayMetrics(n.id,!1,Date.now()-e),{success:!1,status:401,latency:Date.now()-e,attempts:0,error:"Invalid signature",relayId:n.id};let s=t.body;n.transformTemplate&&(s=this.transformPayload(t.body,n.transformTemplate));const i=this.deliverWebhook(n,{...t,body:s});return this.updateRelayMetrics(n.id,i.success,i.latency),{...i,relayId:n.id}}findMatchingRelay(t){for(const e of this.relays.values())if(t.url.startsWith(e.sourceUrl)||e.sourceUrl==="*"||t.url.includes(e.sourceUrl)){if(e.events&&e.events.length>0){const n=t.event||t.headers["x-event"]||t.headers["x-github-event"]||"";if(!e.events.includes(n)&&n!=="")continue}return e}return null}isIpAllowed(t,e){for(const n of e)if(this.matchesCidr(t,n))return!0;return!1}matchesCidr(t,e){if(e==="*"||e===t)return!0;if(e.includes("/")){const[n,s]=e.split("/"),i=parseInt(s,10),o=n.split("."),c=t.split(".");if(o.length!==4||c.length!==4)return!1;const u=Math.floor(i/8);for(let h=0;h<u;h++)if(o[h]!==c[h])return!1;return!0}return t===e}verifySignature(t,e,n){const s=t.headers[n.toLowerCase()]||t.headers[n]||t.headers["x-signature"]||t.headers["x-hub-signature-256"];return s?(typeof t.body=="string"?t.body:JSON.stringify(t.body),s.length>0&&e.length>0):!1}transformPayload(t,e){try{let n=e;if(n.includes("{{raw}}")){const s=typeof t=="string"?t:JSON.stringify(t);n=n.replace(/\{\{raw\}\}/g,s)}if(n.includes("{{json}}")){const s=typeof t=="string"?JSON.parse(t):t;n=n.replace(/\{\{json\}\}/g,JSON.stringify(s))}try{return JSON.parse(n)}catch{return n}}catch{return t}}deliverWebhook(t,e){const n=t.maxRetryAttempts||this.config.maxRetryAttempts||3,s=t.retryDelay||this.config.retryDelay||5,i=t.timeout||this.config.timeout||30,o=this.config.enableRetryOnFailure!==!1,c=t.retryBackoff||"exponential";let u=0,h,f;const m=Date.now();for(;u<n;){u++;const x=this.simulateHttpRequest(t.targetUrl,e,i);if(x.success){const S=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,R={id:S,relayId:t.id,event:e.event||"unknown",payload:typeof e.body=="string"?e.body:JSON.stringify(e.body),status:"success",timestamp:new Date().toISOString(),attempts:u,responseCode:x.statusCode};return this.deliveries.set(S,R),{success:!0,status:x.statusCode||200,latency:Date.now()-m,deliveryId:S,attempts:u}}if(h=x.error,f=x.statusCode,!o||u>=n)break;this.calculateRetryDelay(u,s,c)}const y=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,v={id:y,relayId:t.id,event:e.event||"unknown",payload:typeof e.body=="string"?e.body:JSON.stringify(e.body),status:"failed",timestamp:new Date().toISOString(),attempts:u,responseCode:f,error:h};return this.deliveries.set(y,v),{success:!1,status:f||500,latency:Date.now()-m,deliveryId:y,attempts:u,error:h||"Delivery failed after all retry attempts"}}simulateHttpRequest(t,e,n){const s=10+Math.random()*40,i=5+Math.random()*95,o=Math.random()<.05;if(Math.random()<.02)return{success:!1,statusCode:504,error:"Request timeout",latency:n*1e3};if(o){const u=[500,502,503,429],h=u[Math.floor(Math.random()*u.length)];return{success:!1,statusCode:h,error:`HTTP ${h} error`,latency:s+i}}return{success:!0,statusCode:200,latency:s+i}}calculateRetryDelay(t,e,n){switch(n){case"exponential":return e*Math.pow(2,t-1);case"linear":return e*t;case"constant":default:return e}}updateRelayMetrics(t,e,n){let s=this.relayMetrics.get(t);s||(s={totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0},this.relayMetrics.set(t,s)),s.totalRequests++,s.totalLatency+=n,s.averageLatency=s.totalLatency/s.totalRequests,s.lastRequestTime=Date.now(),e?s.successfulDeliveries++:s.failedDeliveries++}getDeliveries(t){const e=Array.from(this.deliveries.values());return t?e.filter(n=>n.relayId===t):e}getRelayMetrics(t){return this.relayMetrics.get(t)}getAllRelayMetrics(){return new Map(this.relayMetrics)}getRelay(t){return this.relays.get(t)}getAllRelays(){return Array.from(this.relays.values())}}class Zk{keys=new Map;config={};maxMemoryBytes=256*1024*1024;currentMemoryUsage=0;metrics={totalKeys:0,keysByType:{string:0,hash:0,list:0,set:0,zset:0,stream:0},memoryUsage:0,memoryUsagePercent:0,operationsPerSecond:0,hitCount:0,missCount:0,hitRate:0,expiredKeys:0,evictedKeys:0,connectedClients:0};operationCount=0;lastMetricsUpdate=Date.now();operationHistory=[];clusterSlots=new Map;clusterNodes=[];initialize(t){if(this.config={...t},this.keys.clear(),this.currentMemoryUsage=0,this.operationCount=0,this.lastMetricsUpdate=Date.now(),this.operationHistory=[],t.maxMemory&&(this.maxMemoryBytes=this.parseMemorySize(t.maxMemory)),t.enableCluster&&t.clusterNodes&&(this.clusterNodes=[...t.clusterNodes],this.initializeClusterSlots()),t.keys)for(const e of t.keys)this.setKey(e.key,e.type,e.value,e.ttl);this.updateMetrics()}parseMemorySize(t){const e=t.match(/^(\d+)([kmg]?b?)$/i);if(!e)return 256*1024*1024;const n=parseInt(e[1]);switch(e[2].toLowerCase()){case"kb":return n*1024;case"mb":return n*1024*1024;case"gb":return n*1024*1024*1024;default:return n}}initializeClusterSlots(){if(this.clusterNodes.length===0)return;const t=Math.floor(16384/this.clusterNodes.length);let e=0;for(let n=0;n<this.clusterNodes.length;n++){const s=n===this.clusterNodes.length-1?16383:e+t-1;for(let i=e;i<=s;i++)this.clusterSlots.set(i,this.clusterNodes[n]);e=s+1}}getClusterSlot(t){const e=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935];let n=0;for(let s=0;s<t.length;s++){const i=t.charCodeAt(s);n=(n<<8^e[(n>>8^i)&255])&65535}return n%16384}isKeyForThisNode(t){if(!this.config.enableCluster||this.clusterNodes.length===0)return!0;const e=this.getClusterSlot(t);return this.clusterSlots.get(e),!0}executeCommand(t,e){const n=Date.now(),s=t.toUpperCase();try{let i;switch(s){case"GET":i=this.get(e[0]);break;case"SET":i=this.set(e[0],e[1],e[2]?parseInt(e[2]):void 0);break;case"DEL":i=this.del(e);break;case"EXISTS":i=this.exists(e);break;case"EXPIRE":i=this.expire(e[0],parseInt(e[1]));break;case"TTL":i=this.ttl(e[0]);break;case"KEYS":i=this.keys(e[0]||"*");break;case"HGET":i=this.hget(e[0],e[1]);break;case"HSET":i=this.hset(e[0],e.slice(1));break;case"HGETALL":i=this.hgetall(e[0]);break;case"HDEL":i=this.hdel(e[0],e.slice(1));break;case"HKEYS":i=this.hkeys(e[0]);break;case"HVALS":i=this.hvals(e[0]);break;case"LPUSH":i=this.lpush(e[0],e.slice(1));break;case"RPUSH":i=this.rpush(e[0],e.slice(1));break;case"LPOP":i=this.lpop(e[0]);break;case"RPOP":i=this.rpop(e[0]);break;case"LLEN":i=this.llen(e[0]);break;case"LRANGE":i=this.lrange(e[0],parseInt(e[1]),parseInt(e[2]));break;case"SADD":i=this.sadd(e[0],e.slice(1));break;case"SREM":i=this.srem(e[0],e.slice(1));break;case"SMEMBERS":i=this.smembers(e[0]);break;case"SISMEMBER":i=this.sismember(e[0],e[1]);break;case"SCARD":i=this.scard(e[0]);break;case"ZADD":i=this.zadd(e[0],e.slice(1));break;case"ZREM":i=this.zrem(e[0],e.slice(1));break;case"ZRANGE":i=this.zrange(e[0],parseInt(e[1]),parseInt(e[2]));break;case"ZSCORE":i=this.zscore(e[0],e[1]);break;case"ZCARD":i=this.zcard(e[0]);break;case"PING":i="PONG";break;case"INFO":i=this.info(e[0]);break;case"DBSIZE":i=this.dbsize();break;default:return{success:!1,error:`Unknown command: ${t}`,latency:Date.now()-n}}const o=Date.now()-n;return this.recordOperation(),{success:!0,value:i,latency:o}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",latency:Date.now()-n}}}recordOperation(){this.operationCount++,this.operationHistory.push({timestamp:Date.now()}),this.operationHistory.length>1e3&&this.operationHistory.shift()}get(t){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");const e=this.keys.get(t);return e?this.isExpired(e)?(this.deleteKey(t),this.metrics.missCount++,null):(this.metrics.hitCount++,typeof e.value=="string"?e.value:JSON.stringify(e.value)):(this.metrics.missCount++,null)}set(t,e,n){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();const s=this.keys.get(t);s&&(this.currentMemoryUsage-=this.calculateKeySize(s));const i={key:t,type:"string",value:e,ttl:n!==void 0?n:s?.ttl,expiresAt:n!==void 0&&n>0?Date.now()+n*1e3:s?.expiresAt,size:this.estimateSize(e)};return this.keys.set(t,i),this.currentMemoryUsage+=this.calculateKeySize(i),"OK"}del(t){let e=0;for(const n of t)this.deleteKey(n)&&e++;return e}exists(t){let e=0;for(const n of t){const s=this.keys.get(n);s&&!this.isExpired(s)&&e++}return e}expire(t,e){const n=this.keys.get(t);return n?this.isExpired(n)?(this.deleteKey(t),0):(n.ttl=e,n.expiresAt=e>0?Date.now()+e*1e3:void 0,1):0}ttl(t){const e=this.keys.get(t);if(!e)return-2;if(this.isExpired(e))return this.deleteKey(t),-2;if(!e.expiresAt)return-1;const n=Math.floor((e.expiresAt-Date.now())/1e3);return n>0?n:-2}keys(t){const e=this.patternToRegex(t),n=[];for(const[s,i]of this.keys.entries()){if(this.isExpired(i)){this.deleteKey(s);continue}e.test(s)&&n.push(s)}return n}hget(t,e){const n=this.keys.get(t);return!n||n.type!=="hash"?null:this.isExpired(n)?(this.deleteKey(t),null):n.value[e]||null}hset(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(t);(!n||n.type!=="hash")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:t,type:"hash",value:{},size:0});const s=n.value;let i=0;for(let o=0;o<e.length;o+=2){const c=e[o],u=e[o+1];s[c]||i++,s[c]=u}return n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,n),this.currentMemoryUsage+=this.calculateKeySize(n),i}hgetall(t){const e=this.keys.get(t);return!e||e.type!=="hash"?{}:this.isExpired(e)?(this.deleteKey(t),{}):{...e.value}}hdel(t,e){const n=this.keys.get(t);if(!n||n.type!=="hash")return 0;if(this.isExpired(n))return this.deleteKey(t),0;const s=n.value;let i=0;for(const o of e)s[o]&&(delete s[o],i++);return i>0&&(n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,n)),i}hkeys(t){const e=this.keys.get(t);return!e||e.type!=="hash"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Object.keys(e.value)}hvals(t){const e=this.keys.get(t);return!e||e.type!=="hash"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Object.values(e.value)}lpush(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(t);(!n||n.type!=="list")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:t,type:"list",value:[],size:0});const s=n.value;return s.unshift(...e),n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,n),this.currentMemoryUsage+=this.calculateKeySize(n),s.length}rpush(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(t);(!n||n.type!=="list")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:t,type:"list",value:[],size:0});const s=n.value;return s.push(...e),n.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,n),this.currentMemoryUsage+=this.calculateKeySize(n),s.length}lpop(t){const e=this.keys.get(t);if(!e||e.type!=="list")return null;if(this.isExpired(e))return this.deleteKey(t),null;const n=e.value;if(n.length===0)return null;const s=n.shift();return e.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,e),s}rpop(t){const e=this.keys.get(t);if(!e||e.type!=="list")return null;if(this.isExpired(e))return this.deleteKey(t),null;const n=e.value;if(n.length===0)return null;const s=n.pop();return e.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,e),s}llen(t){const e=this.keys.get(t);return!e||e.type!=="list"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.length}lrange(t,e,n){const s=this.keys.get(t);if(!s||s.type!=="list")return[];if(this.isExpired(s))return this.deleteKey(t),[];const i=s.value,o=i.length,c=e<0?Math.max(0,o+e):Math.min(e,o),u=n<0?Math.max(0,o+n):Math.min(n,o-1);return i.slice(c,u+1)}sadd(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(t);(!n||n.type!=="set")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:t,type:"set",value:new Set,size:0});const s=n.value;let i=0;for(const o of e)s.has(o)||(s.add(o),i++);return n.size=this.estimateSize(JSON.stringify(Array.from(s))),this.keys.set(t,n),this.currentMemoryUsage+=this.calculateKeySize(n),i}srem(t,e){const n=this.keys.get(t);if(!n||n.type!=="set")return 0;if(this.isExpired(n))return this.deleteKey(t),0;const s=n.value;let i=0;for(const o of e)s.has(o)&&(s.delete(o),i++);return i>0&&(n.size=this.estimateSize(JSON.stringify(Array.from(s))),this.keys.set(t,n)),i}smembers(t){const e=this.keys.get(t);return!e||e.type!=="set"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Array.from(e.value)}sismember(t,e){const n=this.keys.get(t);return!n||n.type!=="set"?0:this.isExpired(n)?(this.deleteKey(t),0):n.value.has(e)?1:0}scard(t){const e=this.keys.get(t);return!e||e.type!=="set"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.size}zadd(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(t);(!n||n.type!=="zset")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:t,type:"zset",value:new Map,size:0});const s=n.value;let i=0;for(let o=0;o<e.length;o+=2){const c=parseFloat(e[o]),u=e[o+1];s.has(u)||i++,s.set(u,c)}return n.size=this.estimateSize(JSON.stringify(Array.from(s.entries()))),this.keys.set(t,n),this.currentMemoryUsage+=this.calculateKeySize(n),i}zrem(t,e){const n=this.keys.get(t);if(!n||n.type!=="zset")return 0;if(this.isExpired(n))return this.deleteKey(t),0;const s=n.value;let i=0;for(const o of e)s.has(o)&&(s.delete(o),i++);return i>0&&(n.size=this.estimateSize(JSON.stringify(Array.from(s.entries()))),this.keys.set(t,n)),i}zrange(t,e,n){const s=this.keys.get(t);if(!s||s.type!=="zset")return[];if(this.isExpired(s))return this.deleteKey(t),[];const i=s.value,o=Array.from(i.entries()).sort((f,m)=>f[1]-m[1]),c=o.length,u=e<0?Math.max(0,c+e):Math.min(e,c),h=n<0?Math.max(0,c+n):Math.min(n,c-1);return o.slice(u,h+1).map(f=>f[0])}zscore(t,e){const n=this.keys.get(t);return!n||n.type!=="zset"?null:this.isExpired(n)?(this.deleteKey(t),null):n.value.get(e)??null}zcard(t){const e=this.keys.get(t);return!e||e.type!=="zset"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.size}info(t){const e=this.getMetrics();return`# Server
redis_version:7.2.0
redis_mode:${this.config.enableCluster?"cluster":"standalone"}

# Memory
used_memory:${e.memoryUsage}
used_memory_human:${this.formatBytes(e.memoryUsage)}
maxmemory:${this.maxMemoryBytes}
maxmemory_human:${this.formatBytes(this.maxMemoryBytes)}
maxmemory_policy:${this.config.maxMemoryPolicy||"noeviction"}
mem_fragmentation_ratio:1.0

# Stats
total_keys:${e.totalKeys}
expired_keys:${e.expiredKeys}
evicted_keys:${e.evictedKeys}
keyspace_hits:${e.hitCount}
keyspace_misses:${e.missCount}

# Cluster
cluster_enabled:${this.config.enableCluster?1:0}
`}dbsize(){return this.cleanupExpiredKeys(),this.keys.size}setKey(t,e,n,s){const i={key:t,type:e,value:n,ttl:s!==void 0?s:-1,expiresAt:s!==void 0&&s>0?Date.now()+s*1e3:void 0,size:this.estimateSize(typeof n=="string"?n:JSON.stringify(n))};this.keys.set(t,i),this.currentMemoryUsage+=this.calculateKeySize(i)}deleteKey(t){const e=this.keys.get(t);return e?(this.currentMemoryUsage-=this.calculateKeySize(e),this.keys.delete(t),!0):!1}isExpired(t){return t.expiresAt?Date.now()>=t.expiresAt:!1}cleanupExpiredKeys(){let t=0;for(const[e,n]of this.keys.entries())this.isExpired(n)&&(this.deleteKey(e),t++);t>0&&(this.metrics.expiredKeys+=t)}checkMemoryAndEvict(){if(this.currentMemoryUsage<=this.maxMemoryBytes)return;const t=this.config.maxMemoryPolicy||"noeviction";if(t==="noeviction")return;const e=this.selectKeysToEvict(t);let n=0;for(const s of e)if(this.deleteKey(s),n++,this.currentMemoryUsage<=this.maxMemoryBytes*.9)break;n>0&&(this.metrics.evictedKeys+=n)}selectKeysToEvict(t){const e=Array.from(this.keys.keys());switch(t){case"allkeys-lru":case"allkeys-lfu":case"allkeys-random":return e;case"volatile-lru":case"volatile-lfu":case"volatile-ttl":case"volatile-random":return e.filter(n=>{const s=this.keys.get(n);return s&&s.expiresAt!==void 0});default:return[]}}calculateKeySize(t){if(t.size)return t.size;let e=0;return typeof t.value=="string"?e=Buffer.byteLength(t.value,"utf8"):e=Buffer.byteLength(JSON.stringify(t.value),"utf8"),Buffer.byteLength(t.key,"utf8")+e+100}estimateSize(t){return Buffer.byteLength(t,"utf8")}patternToRegex(t){const e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${e}$`)}formatBytes(t){if(t===0)return"0B";const e=1024,n=["B","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,s)*100)/100+n[s]}getMetrics(){return this.cleanupExpiredKeys(),this.updateMetrics(),{...this.metrics}}updateMetrics(){const t=Date.now();(t-this.lastMetricsUpdate)/1e3;const e={string:0,hash:0,list:0,set:0,zset:0,stream:0};for(const o of this.keys.values())e[o.type]++;const n=this.operationHistory.filter(o=>o.timestamp>t-1e3).length,s=this.metrics.hitCount+this.metrics.missCount,i=s>0?this.metrics.hitCount/s:0;this.metrics={totalKeys:this.keys.size,keysByType:e,memoryUsage:this.currentMemoryUsage,memoryUsagePercent:this.maxMemoryBytes>0?this.currentMemoryUsage/this.maxMemoryBytes*100:0,operationsPerSecond:n,hitCount:this.metrics.hitCount,missCount:this.metrics.missCount,hitRate:i,expiredKeys:this.metrics.expiredKeys,evictedKeys:this.metrics.evictedKeys,connectedClients:1},this.lastMetricsUpdate=t}getAllKeys(){return this.cleanupExpiredKeys(),Array.from(this.keys.values())}getKey(t){const e=this.keys.get(t);if(e&&this.isExpired(e)){this.deleteKey(t);return}return e}syncKeysFromConfig(t){const e=new Map;for(const n of t)e.set(n.key,n);for(const[n,s]of this.keys.entries());for(const n of t){const s=this.keys.get(n.key);if(!s)this.setKey(n.key,n.type,n.value,n.ttl);else if(s.type!==n.type||JSON.stringify(s.value)!==JSON.stringify(n.value)||s.ttl!==n.ttl){this.currentMemoryUsage-=this.calculateKeySize(s);const i={...n,expiresAt:n.ttl!==void 0&&n.ttl>0?Date.now()+n.ttl*1e3:void 0,size:this.estimateSize(typeof n.value=="string"?n.value:JSON.stringify(n.value))};this.keys.set(n.key,i),this.currentMemoryUsage+=this.calculateKeySize(i)}}this.updateMetrics()}}class eT{clusterName="archiphoenix-cluster";nodes=new Map;keyspaces=new Map;tables=new Map;tableData=new Map;defaultConsistencyLevel="QUORUM";defaultReplicationFactor=3;enableCompaction=!0;compactionStrategy="SizeTieredCompactionStrategy";datacenter="dc1";metrics={readLatency:5,writeLatency:10,totalNodes:0,healthyNodes:0,totalKeyspaces:0,totalTables:0,totalRows:0,totalSize:0,readOperationsPerSecond:0,writeOperationsPerSecond:0,readConsistencyViolations:0,writeConsistencyViolations:0,pendingCompactions:0,hintedHandoffs:0};readOperations=[];writeOperations=[];lastMetricsUpdate=Date.now();initialize(t){if(this.clusterName=t.clusterName||"archiphoenix-cluster",this.defaultConsistencyLevel=t.defaultConsistencyLevel||"QUORUM",this.defaultReplicationFactor=t.defaultReplicationFactor||3,this.enableCompaction=t.enableCompaction??!0,this.compactionStrategy=t.compactionStrategy||"SizeTieredCompactionStrategy",this.datacenter=t.datacenter||"dc1",this.nodes.clear(),t.nodes)for(const e of t.nodes)this.nodes.set(e.address,{...e});else this.nodes.set("localhost:9042",{address:"localhost:9042",status:"up",load:.5,tokens:256});if(this.keyspaces.clear(),t.keyspaces)for(const e of t.keyspaces)this.keyspaces.set(e.name,{...e});else this.keyspaces.set("system",{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0});if(this.tables.clear(),this.tableData.clear(),t.tables)for(const e of t.tables){const n=`${e.keyspace}.${e.name}`;this.tables.set(n,{...e}),this.tableData.set(n,[])}this.updateMetrics()}syncFromConfig(t){if(t.clusterName&&(this.clusterName=t.clusterName),t.defaultConsistencyLevel&&(this.defaultConsistencyLevel=t.defaultConsistencyLevel),t.defaultReplicationFactor!==void 0&&(this.defaultReplicationFactor=t.defaultReplicationFactor),t.nodes)for(const e of t.nodes)this.nodes.set(e.address,{...e});if(t.keyspaces){new Set(this.keyspaces.keys());for(const e of t.keyspaces)this.keyspaces.set(e.name,{...e,tables:this.countTablesInKeyspace(e.name)})}if(t.tables)for(const e of t.tables){const n=`${e.keyspace}.${e.name}`,s=this.tables.get(n);if(s){const i=this.tableData.get(n)||[];this.tables.set(n,{...e,rows:s.rows||i.length||0,size:s.size||i.length*1024||0})}else this.tables.set(n,{...e,rows:0,size:0}),this.tableData.has(n)||this.tableData.set(n,[])}this.updateMetrics()}executeCQL(t,e){const n=Date.now(),s=e||this.defaultConsistencyLevel;try{const i=t.trim().replace(/\s+/g," "),o=i.toUpperCase();return o.startsWith("SELECT")?this.executeSelect(i,s,n):o.startsWith("INSERT")?this.executeInsert(i,s,n):o.startsWith("UPDATE")?this.executeUpdate(i,s,n):o.startsWith("DELETE")?this.executeDelete(i,s,n):o.startsWith("CREATE KEYSPACE")?this.executeCreateKeyspace(i,n):o.startsWith("CREATE TABLE")?this.executeCreateTable(i,n):o.startsWith("DROP TABLE")?this.executeDropTable(i,n):o.startsWith("DROP KEYSPACE")?this.executeDropKeyspace(i,n):{success:!1,error:`Unsupported CQL statement: ${i}`,latency:Date.now()-n}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",latency:Date.now()-n}}}executeSelect(t,e,n){const s=t.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-n};const i=s[1].trim(),o=this.normalizeTableKey(i),c=this.tables.get(o);if(!c)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-n};const u=this.tableData.get(o)||[],h=t.match(/LIMIT\s+(\d+)/i),f=h?parseInt(h[1],10):void 0;let m=[...u];const y=t.match(/WHERE\s+(.+?)(?:\s+LIMIT|$)/i);if(y){const M=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(M){const T=M[1],k=M[2];m=u.filter(A=>String(A[T])===k)}}f!==void 0&&f>0&&(m=m.slice(0,f));const v=this.calculateReadLatency(e),x=this.checkConsistencyViolation(e,c.keyspace);this.recordReadOperation(v,x);const S=this.getRequiredReplicas(e,c.keyspace);return{success:!0,latency:v,consistency:e,rows:m,rowCount:m.length,replicasQueried:S}}executeInsert(t,e,n){const s=t.match(/INTO\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-n};const i=s[1].trim(),o=this.normalizeTableKey(i);let c=this.tables.get(o);if(!c)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-n};const u=t.match(/\(([^)]+)\)\s*VALUES/i),h=t.match(/VALUES\s*\(([^)]+)\)/i);if(!u||!h)return{success:!1,error:"Invalid INSERT query: missing columns or values",latency:Date.now()-n};const f=u[1].split(",").map(T=>T.trim()),m=h[1],y=this.parseValueList(m);if(f.length!==y.length)return{success:!1,error:"Column count does not match value count",latency:Date.now()-n};const v={};for(let T=0;T<f.length;T++)v[f[T]]=y[T];const x=this.tableData.get(o)||[];x.push(v),this.tableData.set(o,x),c.rows=x.length,c.size=x.length*1024,this.tables.set(o,c);const S=this.calculateWriteLatency(e,c.keyspace),R=this.checkConsistencyViolation(e,c.keyspace);this.recordWriteOperation(S,R);const M=this.getRequiredReplicas(e,c.keyspace);return this.updateMetrics(),{success:!0,latency:S,consistency:e,rowCount:1,replicasQueried:M}}executeUpdate(t,e,n){const s=t.match(/UPDATE\s+([\w.]+)\s+SET/i);if(!s)return{success:!1,error:"Invalid UPDATE query",latency:Date.now()-n};const i=s[1].trim(),o=this.normalizeTableKey(i),c=this.tables.get(o);if(!c)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-n};const u=t.match(/SET\s+(.+?)(?:\s+WHERE|$)/i);if(!u)return{success:!1,error:"Invalid UPDATE query: missing SET clause",latency:Date.now()-n};const h=u[1].trim(),f={},m=h.split(",").map(P=>P.trim());for(const P of m){const z=P.match(/(\w+)\s*=\s*(.+)/);if(z){const q=z[1].trim(),Z=this.parseValue(z[2].trim());f[q]=Z}}const y=t.match(/WHERE\s+(.+)/i);if(!y)return{success:!1,error:"UPDATE requires WHERE clause",latency:Date.now()-n};const x=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!x)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-n};const S=x[1],R=x[2],M=this.tableData.get(o)||[];let T=0;for(const P of M)String(P[S])===R&&(Object.assign(P,f),T++);c.rows=M.length,c.size=M.length*1024,this.tables.set(o,c);const k=this.calculateWriteLatency(e,c.keyspace),A=this.checkConsistencyViolation(e,c.keyspace);this.recordWriteOperation(k,A);const _=this.getRequiredReplicas(e,c.keyspace);return this.updateMetrics(),{success:!0,latency:k,consistency:e,rowCount:T,replicasQueried:_}}executeDelete(t,e,n){const s=t.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DELETE query: missing FROM clause",latency:Date.now()-n};const i=s[1].trim(),o=this.normalizeTableKey(i),c=this.tables.get(o);if(!c)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-n};const u=t.match(/WHERE\s+(.+)/i);if(!u)return{success:!1,error:"DELETE requires WHERE clause",latency:Date.now()-n};const f=u[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!f)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-n};const m=f[1],y=f[2],v=this.tableData.get(o)||[],x=v.length,S=v.filter(A=>String(A[m])!==y);this.tableData.set(o,S),c.rows=S.length,c.size=S.length*1024,this.tables.set(o,c);const R=x-S.length,M=this.calculateWriteLatency(e,c.keyspace),T=this.checkConsistencyViolation(e,c.keyspace);this.recordWriteOperation(M,T);const k=this.getRequiredReplicas(e,c.keyspace);return this.updateMetrics(),{success:!0,latency:M,consistency:e,rowCount:R,replicasQueried:k}}executeCreateKeyspace(t,e){const n=t.match(/KEYSPACE\s+(\w+)/i);if(!n)return{success:!1,error:"Invalid CREATE KEYSPACE query",latency:Date.now()-e};const s=n[1].trim();if(this.keyspaces.has(s))return{success:!1,error:`Keyspace ${s} already exists`,latency:Date.now()-e};let i=this.defaultReplicationFactor;const o=t.match(/replication.*?(\d+)/i);return o&&(i=parseInt(o[1],10)),this.keyspaces.set(s,{name:s,replication:i,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeCreateTable(t,e){const n=t.match(/TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s);if(this.tables.has(i))return{success:!1,error:`Table ${s} already exists`,latency:Date.now()-e};let o=t;const c=t.toUpperCase().indexOf(" WITH ");c>0&&(o=t.substring(0,c));const u=o.match(/\(([^)]+)\)/);if(!u)return{success:!1,error:"Invalid CREATE TABLE query: missing column definitions",latency:Date.now()-e};const h=u[1],f=[],m=h.split(",").map(M=>M.trim());for(const M of m){if(M.toUpperCase().includes("PRIMARY KEY"))continue;const T=M.match(/(\w+)\s+(\w+)/);T&&f.push({name:T[1],type:T[2]})}const y=s.split("."),v=y.length>1?y[0]:"system",x=y.length>1?y[1]:y[0];if(!this.keyspaces.has(v))return{success:!1,error:`Keyspace ${v} does not exist`,latency:Date.now()-e};const S={name:x,keyspace:v,columns:f,rows:0,size:0};this.tables.set(i,S),this.tableData.set(i,[]);const R=this.keyspaces.get(v);return R&&(R.tables=this.countTablesInKeyspace(v),this.keyspaces.set(v,R)),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeDropTable(t,e){const n=t.match(/TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s);if(!this.tables.has(i))return{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-e};const o=this.tables.get(i);this.tables.delete(i),this.tableData.delete(i);const c=this.keyspaces.get(o.keyspace);return c&&(c.tables=this.countTablesInKeyspace(o.keyspace),this.keyspaces.set(o.keyspace,c)),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeDropKeyspace(t,e){const n=t.match(/KEYSPACE\s+(\w+)/i);if(!n)return{success:!1,error:"Invalid DROP KEYSPACE query",latency:Date.now()-e};const s=n[1].trim();if(!this.keyspaces.has(s))return{success:!1,error:`Keyspace ${s} does not exist`,latency:Date.now()-e};const i=[];for(const[o,c]of this.tables.entries())c.keyspace===s&&i.push(o);for(const o of i)this.tables.delete(o),this.tableData.delete(o);return this.keyspaces.delete(s),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}getNodes(){return Array.from(this.nodes.values())}getKeyspaces(){return Array.from(this.keyspaces.values())}getTables(){return Array.from(this.tables.values())}getMetrics(){return this.updateMetrics(),{...this.metrics}}calculateReadLatency(t){const n=this.getRequiredReplicas(t,"system"),s=Math.log(n+1)*3,i=Math.random()*2;return Math.round(2+s+i)}calculateWriteLatency(t,e){const i=this.getRequiredReplicas(t,e)*2,o=Math.random()*3;return Math.round(5+i+o)}getRequiredReplicas(t,e){const s=this.keyspaces.get(e)?.replication||this.defaultReplicationFactor;switch(t){case"ONE":case"LOCAL_ONE":return 1;case"TWO":return 2;case"THREE":return 3;case"QUORUM":case"LOCAL_QUORUM":return Math.floor(s/2)+1;case"ALL":case"EACH_QUORUM":return s;case"SERIAL":case"LOCAL_SERIAL":return Math.floor(s/2)+1;default:return Math.floor(s/2)+1}}checkConsistencyViolation(t,e){const n=this.metrics.healthyNodes,s=this.getRequiredReplicas(t,e),i=n<s?.8:.05;return Math.random()<i}recordReadOperation(t,e){const n=Date.now();this.readOperations.push({timestamp:n,latency:t,violated:e}),this.readOperations.length>1e3&&this.readOperations.shift(),e&&this.metrics.readConsistencyViolations++}recordWriteOperation(t,e){const n=Date.now();this.writeOperations.push({timestamp:n,latency:t,violated:e}),this.writeOperations.length>1e3&&this.writeOperations.shift(),e&&this.metrics.writeConsistencyViolations++}updateMetrics(){const t=Date.now();(t-this.lastMetricsUpdate)/1e3,this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(h=>h.status==="up").length,this.metrics.totalKeyspaces=this.keyspaces.size,this.metrics.totalTables=this.tables.size;let e=0,n=0;for(const[h,f]of this.tableData.entries())e+=f.length,n+=f.length*1024;this.metrics.totalRows=e,this.metrics.totalSize=n;const s=t-1e3,i=this.readOperations.filter(h=>h.timestamp>s),o=this.writeOperations.filter(h=>h.timestamp>s);if(this.metrics.readOperationsPerSecond=i.length,this.metrics.writeOperationsPerSecond=o.length,i.length>0){const h=i.reduce((f,m)=>f+m.latency,0)/i.length;this.metrics.readLatency=Math.round(h*10)/10}if(o.length>0){const h=o.reduce((f,m)=>f+m.latency,0)/o.length;this.metrics.writeLatency=Math.round(h*10)/10}this.metrics.pendingCompactions=Math.floor(this.metrics.totalSize/(10*1024*1024));const c=this.metrics.totalNodes-this.metrics.healthyNodes;this.metrics.hintedHandoffs=c>0?c*5:0;const u=this.metrics.readOperationsPerSecond+this.metrics.writeOperationsPerSecond;for(const h of this.nodes.values())if(h.status==="up"){const f=Math.min(.95,.3+u/100*.3);h.load=h.load*.9+f*.1,h.load+=(Math.random()-.5)*.05,h.load=Math.max(.1,Math.min(.95,h.load))}this.lastMetricsUpdate=t}countTablesInKeyspace(t){let e=0;for(const n of this.tables.values())n.keyspace===t&&e++;return e}normalizeTableKey(t){return t.includes(".")?t:`system.${t}`}parseValueList(t){const e=[];let n="",s=!1,i="";for(let o=0;o<t.length;o++){const c=t[o];if((c==='"'||c==="'")&&!s){s=!0,i=c;continue}else if(c===i&&s){s=!1,i="";continue}c===","&&!s?(e.push(this.parseValue(n.trim())),n=""):n+=c}return n.trim()&&e.push(this.parseValue(n.trim())),e}parseValue(t){return t=t.trim(),t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):t.toUpperCase()==="TRUE"?!0:t.toUpperCase()==="FALSE"?!1:t.toUpperCase()==="NULL"?null:t}}class tT{cluster="archiphoenix-cluster";replication=!1;tables=new Map;tableData=new Map;tableParts=new Map;maxMemoryUsage=10*1024*1024*1024;compression="LZ4";metrics={queryThroughput:0,avgQueryTime:45,queriesPerSecond:0,readRowsPerSecond:0,writtenRowsPerSecond:0,totalRows:0,totalSize:0,compressionRatio:5,activeQueries:0,memoryUsage:0,memoryUsagePercent:0,partsCount:0,pendingMerges:0,totalTables:0,clusterNodes:1,healthyNodes:1};queryOperations=[];lastMetricsUpdate=Date.now();activeQueriesSet=new Set;initialize(t){if(this.cluster=t.cluster||"archiphoenix-cluster",this.replication=t.replication||!1,this.maxMemoryUsage=t.maxMemoryUsage||10*1024*1024*1024,this.compression=t.compression||"LZ4",this.tables.clear(),this.tableData.clear(),this.tableParts.clear(),t.tables)for(const e of t.tables){const n=`${e.database||"default"}.${e.name}`;this.tables.set(n,{...e}),this.tableData.set(n,[]),this.tableParts.set(n,[])}this.updateMetrics()}syncFromConfig(t){if(t.cluster&&(this.cluster=t.cluster),t.replication!==void 0&&(this.replication=t.replication),t.maxMemoryUsage&&(this.maxMemoryUsage=t.maxMemoryUsage),t.compression&&(this.compression=t.compression),t.tables)for(const e of t.tables){const n=`${e.database||"default"}.${e.name}`,s=this.tables.get(n),i=this.tableData.get(n)||[];s?this.tables.set(n,{...e,rows:s.rows||i.length||0,size:s.size||i.length*512||0}):(this.tables.set(n,{...e,rows:0,size:0}),this.tableData.has(n)||(this.tableData.set(n,[]),this.tableParts.set(n,[])))}this.updateMetrics()}executeQuery(t){const e=Date.now(),n=`query-${Date.now()}-${Math.random()}`;try{const s=t.trim().replace(/\s+/g," "),i=s.toUpperCase();this.activeQueriesSet.add(n),this.metrics.activeQueries=this.activeQueriesSet.size;let o;i.startsWith("SELECT")?o=this.executeSelect(s,e):i.startsWith("INSERT")?o=this.executeInsert(s,e):i.startsWith("ALTER")?o=this.executeAlter(s,e):i.startsWith("CREATE TABLE")?o=this.executeCreateTable(s,e):i.startsWith("DROP TABLE")?o=this.executeDropTable(s,e):o={success:!1,error:`Unsupported SQL statement: ${s}`,latency:Date.now()-e};const c=o.latency||Date.now()-e;return this.queryOperations.push({timestamp:Date.now(),latency:c,rowsRead:o.dataRead||0,rowsWritten:o.dataWritten||0}),this.activeQueriesSet.delete(n),this.metrics.activeQueries=this.activeQueriesSet.size,o}catch(s){return this.activeQueriesSet.delete(n),this.metrics.activeQueries=this.activeQueriesSet.size,{success:!1,error:s instanceof Error?s.message:"Unknown error",latency:Date.now()-e}}}executeSelect(t,e){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s),o=this.tables.get(i);if(!o)return{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-e};const c=this.tableData.get(i)||[],u=t.match(/SELECT\s+(.+?)\s+FROM/i),h=u?u[1].trim().split(",").map(T=>T.trim()):["*"];let f=[...c];const m=t.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(m){const k=m[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(k){const A=k[1],_=k[2];f=c.filter(P=>String(P[A])===_)}}const y=t.match(/GROUP\s+BY\s+(\w+)/i);if(y){const T=y[1],k=new Map;f.forEach(A=>{const _=String(A[T]||"null");k.set(_,(k.get(_)||0)+1)}),f=Array.from(k.entries()).map(([A,_])=>({[T]:A,count:_}))}const v=t.match(/ORDER\s+BY\s+(\w+)(?:\s+(ASC|DESC))?/i);if(v){const T=v[1],k=(v[2]||"ASC").toUpperCase();f.sort((A,_)=>{const P=A[T],z=_[T];return k==="DESC"?P>z?-1:P<z?1:0:P<z?-1:P>z?1:0})}const x=t.match(/LIMIT\s+(\d+)/i),S=x?parseInt(x[1],10):void 0;S!==void 0&&S>0&&(f=f.slice(0,S));const R=this.calculateQueryLatency(t,o,f.length);let M=f;return!h.includes("*")&&h.length>0&&(M=f.map(T=>{const k={};return h.forEach(A=>{T.hasOwnProperty(A)&&(k[A]=T[A])}),k})),{success:!0,latency:R,rows:M,rowCount:M.length,columns:h.includes("*")?Object.keys(c[0]||{}):h,dataRead:c.length}}executeInsert(t,e){const n=t.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s);let o=this.tables.get(i);if(!o)return{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-e};const c=t.match(/VALUES\s+(.+)/i);if(!c)return{success:!1,error:"Invalid INSERT query: missing VALUES clause",latency:Date.now()-e};const u=c[1].trim(),h=this.parseValues(u),f=this.tableData.get(i)||[],m={},y=t.match(/\(([^)]+)\)\s+VALUES/i),v=y?y[1].split(",").map(S=>S.trim()):[];v.length>0&&v.length===h.length?v.forEach((S,R)=>{m[S]=h[R]}):h.forEach((S,R)=>{m[`column_${R}`]=S}),f.push(m),this.tableData.set(i,f),o.rows=f.length,o.size=f.length*512,this.tables.set(i,o);const x=10+Math.random()*5;return this.simulatePartCreation(i),this.updateMetrics(),{success:!0,latency:x,rowCount:1,dataWritten:1}}executeCreateTable(t,e){const n=t.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s);if(this.tables.has(i))return{success:!1,error:`Table ${s} already exists`,latency:Date.now()-e};const o=t.match(/ENGINE\s*=\s*(\w+)/i),c=o?o[1]:"MergeTree",[u,h]=i.split("."),f={name:h,database:u||"default",engine:c,rows:0,size:0,partitions:0};return this.tables.set(i,f),this.tableData.set(i,[]),this.tableParts.set(i,[]),this.updateMetrics(),{success:!0,latency:Date.now()-e}}executeDropTable(t,e){const n=t.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s);return this.tables.has(i)?(this.tables.delete(i),this.tableData.delete(i),this.tableParts.delete(i),this.updateMetrics(),{success:!0,latency:Date.now()-e}):{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-e}}executeAlter(t,e){const n=t.match(/ALTER\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid ALTER TABLE query",latency:Date.now()-e};const s=n[1].trim(),i=this.normalizeTableKey(s);return this.tables.get(i)?{success:!0,latency:Date.now()-e}:{success:!1,error:`Table ${s} does not exist`,latency:Date.now()-e}}calculateQueryLatency(t,e,n){const i=n/1e6*5;let o=1;const c=t.toUpperCase();c.includes("JOIN")&&(o*=2),c.includes("GROUP BY")&&(o*=1.5),c.includes("ORDER BY")&&(o*=1.3),c.includes("COUNT")&&(o*=.8),(c.includes("SUM")||c.includes("AVG"))&&(o*=.9);const u=this.tableParts.get(`${e.database}.${e.name}`)||[],h=Math.min(1.5,1+u.length/100);return 10+i*o*h}parseValues(t){let e=t.trim();e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,-1));const n=[];let s="",i=!1,o="";for(let c=0;c<e.length;c++){const u=e[c];(u==='"'||u==="'")&&!i?(i=!0,o=u):u===o&&i?(i=!1,o=""):u===","&&!i?(n.push(this.parseValue(s.trim())),s=""):s+=u}return s.trim()&&n.push(this.parseValue(s.trim())),n}parseValue(t){const e=t.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):/^-?\d+$/.test(e)?parseInt(e,10):/^-?\d*\.\d+$/.test(e)?parseFloat(e):e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e.toLowerCase()==="null"?null:e}normalizeTableKey(t){return t.includes(".")?t:`default.${t}`}simulatePartCreation(t){const e=this.tableParts.get(t)||[],n=new Date().toISOString().split("T")[0],s={name:`${n}_${e.length+1}`,minDate:n,maxDate:n,rows:1e3,size:512*1e3,level:0};if(e.push(s),this.tableParts.set(t,e),e.length>10){const i=e.splice(0,5),o={name:`merged_${Date.now()}`,minDate:i[0].minDate,maxDate:i[i.length-1].maxDate,rows:i.reduce((c,u)=>c+u.rows,0),size:i.reduce((c,u)=>c+u.size,0),level:Math.max(...i.map(c=>c.level))+1};e.unshift(o),this.tableParts.set(t,e)}}updateMetrics(){const t=Date.now(),e=(t-this.lastMetricsUpdate)/1e3;this.metrics.totalTables=this.tables.size;let n=0,s=0,i=0;for(const[h,f]of this.tables.entries()){n+=f.rows,s+=f.size;const m=this.tableParts.get(h)||[];i+=m.length}this.metrics.totalRows=n,this.metrics.totalSize=s,this.metrics.partsCount=i;const o=t-1e3,c=this.queryOperations.filter(h=>h.timestamp>o);if(this.metrics.queriesPerSecond=c.length,this.metrics.queryThroughput=c.length,c.length>0){const h=c.reduce((y,v)=>y+v.latency,0)/c.length;this.metrics.avgQueryTime=Math.round(h*10)/10;const f=c.reduce((y,v)=>y+v.rowsRead,0),m=c.reduce((y,v)=>y+v.rowsWritten,0);this.metrics.readRowsPerSecond=Math.round(f/e),this.metrics.writtenRowsPerSecond=Math.round(m/e)}const u=s/this.metrics.compressionRatio;this.metrics.memoryUsage=u,this.metrics.memoryUsagePercent=u/this.maxMemoryUsage*100,this.metrics.pendingMerges=Math.floor(i/10),this.metrics.clusterNodes=this.replication?3:1,this.metrics.healthyNodes=this.metrics.clusterNodes,this.lastMetricsUpdate=t}getMetrics(){return this.updateMetrics(),{...this.metrics}}insertData(t,e){const n=this.normalizeTableKey(t),s=this.tables.get(n);if(!s)return{success:!1,rowsInserted:0,error:`Table ${t} does not exist`};const i=this.tableData.get(n)||[];return i.push(...e),this.tableData.set(n,i),s.rows=i.length,s.size=i.length*512,this.tables.set(n,s),this.simulatePartCreation(n),this.updateMetrics(),{success:!0,rowsInserted:e.length}}}const uo={"X-Small":{servers:1,creditsPerHour:1},Small:{servers:2,creditsPerHour:2},Medium:{servers:4,creditsPerHour:4},Large:{servers:8,creditsPerHour:8},"X-Large":{servers:16,creditsPerHour:16},"2X-Large":{servers:32,creditsPerHour:32},"3X-Large":{servers:64,creditsPerHour:64},"4X-Large":{servers:128,creditsPerHour:128}};class nT{account="archiphoenix";region="us-east-1";warehouses=new Map;databases=new Map;tables=new Map;tableData=new Map;queries=new Map;queryQueue=[];activeQueries=new Map;resultCache=new Map;cacheHits=0;cacheMisses=0;metrics={totalWarehouses:0,runningWarehouses:0,suspendedWarehouses:0,totalQueries:0,runningQueries:0,queuedQueries:0,queriesPerSecond:0,avgQueryTime:0,totalComputeTime:0,totalDataRead:0,totalDataWritten:0,cacheHitRate:0,warehouseUtilization:0,totalCost:0};queryOperations=[];lastMetricsUpdate=Date.now();warehouseLastUpdate=new Map;suspendTimers=new Map;initialize(t){if(this.account=t.account||"archiphoenix",this.region=t.region||"us-east-1",this.warehouses.clear(),t.warehouses&&t.warehouses.length>0)for(const e of t.warehouses)this.warehouses.set(e.name,{...e,status:e.status||"suspended",currentClusterCount:e.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});else this.warehouses.set("COMPUTE_WH",{name:"COMPUTE_WH",size:"Small",status:"suspended",autoSuspend:60,autoResume:!0,minClusterCount:1,maxClusterCount:1,currentClusterCount:1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});if(this.databases.clear(),this.tables.clear(),this.tableData.clear(),t.databases){for(const e of t.databases)if(this.databases.set(e.name,{...e}),e.schemas){for(const n of e.schemas)if(n.tables)for(const s of n.tables){const i=`${e.name}.${n.name}.${s.name}`;this.tables.set(i,{...s}),this.tableData.set(i,[])}}}this.databases.has("SNOWFLAKE")||this.databases.set("SNOWFLAKE",{name:"SNOWFLAKE",comment:"System database",retentionTime:1,size:0,schemas:[{name:"INFORMATION_SCHEMA",tables:[],views:0,functions:0}]}),this.updateMetrics()}syncFromConfig(t){if(t.account&&(this.account=t.account),t.region&&(this.region=t.region),t.warehouses){for(const n of t.warehouses){const s=this.warehouses.get(n.name);s?(this.warehouses.set(n.name,{...n,status:s.status,currentClusterCount:s.currentClusterCount,runningQueries:s.runningQueries,queuedQueries:s.queuedQueries,totalQueriesExecuted:s.totalQueriesExecuted,totalComputeTime:s.totalComputeTime,lastUsed:s.lastUsed}),this.updateWarehouseAutoSuspend(n.name,n)):this.warehouses.set(n.name,{...n,status:"suspended",currentClusterCount:n.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0})}const e=new Set(t.warehouses.map(n=>n.name));for(const[n]of this.warehouses.entries())if(!e.has(n)){this.warehouses.delete(n);const s=this.suspendTimers.get(n);s&&(clearTimeout(s),this.suspendTimers.delete(n))}}if(t.databases){for(const e of t.databases)if(this.databases.get(e.name),this.databases.set(e.name,{...e}),e.schemas){for(const n of e.schemas)if(n.tables)for(const s of n.tables){const i=`${e.name}.${n.name}.${s.name}`,o=this.tables.get(i),c=this.tableData.get(i)||[];o?this.tables.set(i,{...s,rows:o.rows||c.length||0,size:o.size||c.length*512||0}):(this.tables.set(i,{...s,rows:0,size:0}),this.tableData.set(i,[]))}}}this.updateMetrics()}executeQuery(t,e,n,s){const i=Date.now(),o=`query-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,c=this.getCacheKey(t,n,s),u=this.resultCache.get(c);if(u&&Date.now()-u.timestamp<u.ttl)return this.cacheHits++,this.updateMetrics(),{success:!0,latency:10,rows:u.data,rowCount:u.data.length,queryId:o,resultCacheUsed:!0};this.cacheMisses++;let h;if(e?h=this.warehouses.get(e):h=Array.from(this.warehouses.values()).find(m=>m.status==="running")||Array.from(this.warehouses.values())[0],!h)return{success:!1,error:"No warehouse available",latency:Date.now()-i,queryId:o};const f={id:o,queryText:t,status:"queued",warehouse:h.name,database:n,schema:s,startedAt:i};return this.queries.set(o,f),h.status==="suspended"&&h.autoResume&&this.resumeWarehouse(h.name),h.status==="running"?this.executeQueryOnWarehouse(f,h,i):(h.queuedQueries++,this.queryQueue.push(f),f.status="queued",h.autoResume&&this.resumeWarehouse(h.name),h.status==="running"&&this.processQueryQueue(h),{success:!0,latency:50,queryId:o,warehouse:h.name})}executeQueryOnWarehouse(t,e,n){t.status="running",t.startedAt=Date.now(),e.runningQueries++,this.activeQueries.set(t.id,t),1/(uo[e.size]||uo.Small).servers,this.estimateQueryComplexity(t.queryText);const i=this.executeSQL(t.queryText,t.database,t.schema),o=Date.now();if(t.completedAt=o,t.duration=o-(t.startedAt||n),t.status=i.success?"success":"failed",t.rowsReturned=i.rowCount,t.error=i.error,e.runningQueries--,e.totalQueriesExecuted++,e.totalComputeTime+=t.duration/1e3,e.lastUsed=o,this.activeQueries.delete(t.id),i.success&&i.rows){const c=this.getCacheKey(t.queryText,t.database,t.schema);this.resultCache.set(c,{data:i.rows,timestamp:o,ttl:3e5})}return this.queryOperations.push({timestamp:o,latency:t.duration,rowsRead:i.dataRead||0,rowsWritten:i.dataWritten||0}),e.autoSuspend&&e.runningQueries===0&&e.queuedQueries===0&&this.scheduleWarehouseSuspend(e.name,e.autoSuspend),this.updateMetrics(),{...i,queryId:t.id,warehouse:e.name,latency:t.duration}}executeSQL(t,e,n){const s=t.trim().replace(/\s+/g," "),i=s.toUpperCase();try{return i.startsWith("SELECT")?this.executeSelect(s,e,n):i.startsWith("INSERT")?this.executeInsert(s,e,n):i.startsWith("UPDATE")?this.executeUpdate(s,e,n):i.startsWith("DELETE")?this.executeDelete(s,e,n):i.startsWith("CREATE TABLE")?this.executeCreateTable(s,e,n):i.startsWith("DROP TABLE")?this.executeDropTable(s,e,n):{success:!1,error:`Unsupported SQL statement: ${s}`}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}executeSelect(t,e,n){const s=t.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid SELECT query: missing FROM clause"};const i=s[1].trim(),o=this.normalizeTableKey(i,e,n),c=this.tables.get(o);if(!c)return{success:!1,error:`Table ${i} does not exist`};const u=this.tableData.get(o)||[],h=t.match(/SELECT\s+(.+?)\s+FROM/i),f=h?h[1].trim().split(",").map(x=>x.trim()):["*"];let m=[...u];const y=t.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(y){const S=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(S){const R=S[1],M=S[2];m=u.filter(T=>String(T[R])===M)}}const v=t.match(/LIMIT\s+(\d+)/i);if(v){const x=parseInt(v[1],10);m=m.slice(0,x)}return{success:!0,rows:m,rowCount:m.length,columns:f.includes("*")?c.columns?.map(x=>x.name)||[]:f,dataRead:u.length}}executeInsert(t,e,n){const s=t.match(/INTO\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid INSERT query: missing INTO clause"};const i=s[1].trim(),o=this.normalizeTableKey(i,e,n),c=this.tables.get(o);if(!c)return{success:!1,error:`Table ${i} does not exist`};const u=t.match(/VALUES\s*\((.+?)\)/i);if(!u)return{success:!1,error:"Invalid INSERT query: missing VALUES clause"};const h=u[1].split(",").map(v=>v.trim().replace(/^['"]|['"]$/g,"")),f=c.columns||[];if(h.length!==f.length)return{success:!1,error:`Column count mismatch: expected ${f.length}, got ${h.length}`};const m={};f.forEach((v,x)=>{m[v.name]=h[x]});const y=this.tableData.get(o)||[];return y.push(m),this.tableData.set(o,y),c.rows=y.length,c.size=y.length*512,{success:!0,rowCount:1,dataWritten:1}}executeUpdate(t,e,n){return{success:!0,rowCount:0,dataWritten:0}}executeDelete(t,e,n){return{success:!0,rowCount:0,dataWritten:0}}executeCreateTable(t,e,n){const s=t.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid CREATE TABLE query"};const i=s[1].trim(),o=this.normalizeTableKey(i,e,n);if(this.tables.has(o))return{success:!1,error:`Table ${i} already exists`};const c=t.match(/\((.+?)\)/),u=[];if(c){const v=c[1].split(",").map(x=>x.trim());for(const x of v){const S=x.split(/\s+/);S.length>=2&&u.push({name:S[0],type:S[1],nullable:!x.toUpperCase().includes("NOT NULL")})}}const[h,f,m]=this.parseTableName(i,e,n),y={name:m,schema:f,database:h,columns:u,rows:0,size:0,created:Date.now()};return this.tables.set(o,y),this.tableData.set(o,[]),{success:!0,rowCount:0}}executeDropTable(t,e,n){const s=t.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DROP TABLE query"};const i=s[1].trim(),o=this.normalizeTableKey(i,e,n);return this.tables.has(o)?(this.tables.delete(o),this.tableData.delete(o),{success:!0,rowCount:0}):{success:!1,error:`Table ${i} does not exist`}}resumeWarehouse(t){const e=this.warehouses.get(t);if(!e)return!1;if(e.status==="running")return!0;const n=this.suspendTimers.get(t);return n&&(clearTimeout(n),this.suspendTimers.delete(t)),e.status="running",e.currentClusterCount=e.minClusterCount,this.processQueryQueue(e),this.updateMetrics(),!0}suspendWarehouse(t){const e=this.warehouses.get(t);return e?e.status==="suspended"?!0:e.runningQueries>0?!1:(e.status="suspended",e.currentClusterCount=0,this.updateMetrics(),!0):!1}scheduleWarehouseSuspend(t,e){const n=this.suspendTimers.get(t);n&&clearTimeout(n);const s=setTimeout(()=>{const i=this.warehouses.get(t);i&&i.runningQueries===0&&i.queuedQueries===0&&this.suspendWarehouse(t),this.suspendTimers.delete(t)},e*1e3);this.suspendTimers.set(t,s)}updateWarehouseAutoSuspend(t,e){const n=this.warehouses.get(t);if(n){if(e.autoSuspend!==void 0||e.autoResume!==void 0){const s=this.suspendTimers.get(t);s&&(clearTimeout(s),this.suspendTimers.delete(t))}n.status==="running"&&n.autoSuspend&&n.runningQueries===0&&n.queuedQueries===0&&this.scheduleWarehouseSuspend(t,n.autoSuspend)}}processQueryQueue(t){if(t.status!=="running")return;const e=this.queryQueue.filter(n=>n.warehouse===t.name&&n.status==="queued");for(const n of e)t.runningQueries<this.getMaxConcurrentQueries(t)&&(t.queuedQueries--,this.queryQueue=this.queryQueue.filter(s=>s.id!==n.id),this.executeQueryOnWarehouse(n,t,n.startedAt||Date.now()))}getMaxConcurrentQueries(t){return(uo[t.size]||uo.Small).servers*t.currentClusterCount*8}estimateQueryComplexity(t){let e=1;const n=(t.match(/\bJOIN\b/gi)||[]).length;e+=n*.5,t.match(/\bGROUP\s+BY\b/i)&&(e+=.3),t.match(/\bORDER\s+BY\b/i)&&(e+=.2);const s=(t.match(/\b(COUNT|SUM|AVG|MAX|MIN)\s*\(/gi)||[]).length;return e+=s*.2,Math.max(1,e)}normalizeTableKey(t,e,n){const s=t.split(".");return s.length===3?s.join("."):s.length===2?`${e||"PUBLIC"}.${s.join(".")}`:`${e||"PUBLIC"}.${n||"PUBLIC"}.${s[0]}`}parseTableName(t,e,n){const s=t.split(".");return s.length===3?[s[0],s[1],s[2]]:s.length===2?[e||"PUBLIC",s[0],s[1]]:[e||"PUBLIC",n||"PUBLIC",s[0]]}getCacheKey(t,e,n){return`${t}|${e||""}|${n||""}`}updateMetrics(){const t=Date.now(),e=(t-this.lastMetricsUpdate)/1e3;if(this.metrics.totalWarehouses=this.warehouses.size,this.metrics.runningWarehouses=Array.from(this.warehouses.values()).filter(c=>c.status==="running").length,this.metrics.suspendedWarehouses=Array.from(this.warehouses.values()).filter(c=>c.status==="suspended").length,this.metrics.totalQueries=this.queries.size,this.metrics.runningQueries=Array.from(this.warehouses.values()).reduce((c,u)=>c+u.runningQueries,0),this.metrics.queuedQueries=Array.from(this.warehouses.values()).reduce((c,u)=>c+u.queuedQueries,0),e>0){const c=this.queryOperations.filter(u=>u.timestamp>t-1e3);this.metrics.queriesPerSecond=c.length}if(this.queryOperations.length>0){const c=this.queryOperations.slice(-100),u=c.reduce((h,f)=>h+f.latency,0)/c.length;this.metrics.avgQueryTime=u}this.metrics.totalComputeTime=Array.from(this.warehouses.values()).reduce((c,u)=>c+u.totalComputeTime,0);const n=this.queryOperations.slice(-1e3);this.metrics.totalDataRead=n.reduce((c,u)=>c+u.rowsRead,0),this.metrics.totalDataWritten=n.reduce((c,u)=>c+u.rowsWritten,0);const s=this.cacheHits+this.cacheMisses;this.metrics.cacheHitRate=s>0?this.cacheHits/s:0;let i=0;for(const c of this.warehouses.values())if(c.status==="running"){const u=this.getMaxConcurrentQueries(c),h=u>0?c.runningQueries/u:0;i+=h}this.metrics.warehouseUtilization=this.metrics.runningWarehouses>0?i/this.metrics.runningWarehouses:0;let o=0;for(const c of this.warehouses.values())if(c.status==="running"&&c.totalComputeTime>0){const u=uo[c.size]||uo.Small,h=c.totalComputeTime/3600;o+=u.creditsPerHour*h*c.currentClusterCount}this.metrics.totalCost=o,this.lastMetricsUpdate=t}getMetrics(){return this.updateMetrics(),{...this.metrics}}getWarehouse(t){return this.warehouses.get(t)}getWarehouses(){return Array.from(this.warehouses.values())}getQuery(t){return this.queries.get(t)}getRecentQueries(t=100){return Array.from(this.queries.values()).sort((e,n)=>(n.startedAt||0)-(e.startedAt||0)).slice(0,t)}getTables(t,e){return!t&&!e?Array.from(this.tables.values()):Array.from(this.tables.values()).filter(n=>!(t&&n.database!==t||e&&n.schema!==e))}}class sT{clusterName="archiphoenix-cluster";nodes=new Map;indices=new Map;shards=new Map;documents=new Map;defaultShards=5;defaultReplicas=1;refreshInterval="1s";metrics={clusterHealth:"green",totalNodes:0,healthyNodes:0,totalIndices:0,totalDocs:0,totalSize:0,activeShards:0,relocatingShards:0,initializingShards:0,unassignedShards:0,indexOperationsPerSecond:0,searchOperationsPerSecond:0,averageIndexLatency:5,averageSearchLatency:10,averageGetLatency:2};indexOperations=[];searchOperations=[];getOperations=[];lastMetricsUpdate=Date.now();recentQueries=[];initialize(t){if(this.clusterName=t.clusterName||"archiphoenix-cluster",this.defaultShards=t.defaultShards||5,this.defaultReplicas=t.defaultReplicas||1,this.refreshInterval=t.refreshInterval||"1s",this.nodes.clear(),t.nodes&&t.nodes.length>0)for(const e of t.nodes)this.nodes.set(e,{address:e,status:"up",load:.3+Math.random()*.4,shards:0});else this.nodes.set("localhost:9200",{address:"localhost:9200",status:"up",load:.5,shards:0});if(this.indices.clear(),this.shards.clear(),this.documents.clear(),t.indices&&t.indices.length>0)for(const e of t.indices)this.createIndex(e.name,e.shards||this.defaultShards,e.replicas||this.defaultReplicas,e);else this.createIndex("archiphoenix-index",this.defaultShards,this.defaultReplicas);this.updateMetrics()}syncFromConfig(t){if(t.clusterName&&(this.clusterName=t.clusterName),t.defaultShards!==void 0&&(this.defaultShards=t.defaultShards),t.defaultReplicas!==void 0&&(this.defaultReplicas=t.defaultReplicas),t.refreshInterval&&(this.refreshInterval=t.refreshInterval),t.nodes){new Set(this.nodes.keys());for(const e of t.nodes)this.nodes.has(e)||this.nodes.set(e,{address:e,status:"up",load:.3+Math.random()*.4,shards:0})}if(t.indices){new Set(this.indices.keys());for(const e of t.indices)if(!this.indices.has(e.name))this.createIndex(e.name,e.shards||this.defaultShards,e.replicas||this.defaultReplicas,e);else{const n=this.indices.get(e.name),s=this.getTotalDocsForIndex(e.name),i=this.getTotalSizeForIndex(e.name);this.indices.set(e.name,{...e,docs:n.docs||s,size:n.size||i,health:this.calculateIndexHealth(e.name)})}}this.updateMetrics()}createIndex(t,e=5,n=1,s){const i={name:t,docs:s?.docs||0,size:s?.size||0,shards:e,replicas:n,health:"yellow",mappings:s?.mappings,settings:s?.settings};this.indices.set(t,i);const o=[],c=Array.from(this.nodes.keys());for(let u=0;u<e;u++){const h=c[u%c.length];o.push({index:t,shard:u,primary:!0,node:h,state:"STARTED",docs:0,size:0});for(let f=0;f<n;f++){const m=c[(u+f+1)%c.length];o.push({index:t,shard:u,primary:!1,node:m,state:"STARTED",docs:0,size:0})}}if(this.shards.set(t,o),!this.documents.has(t)){const u=new Map;for(let h=0;h<e;h++)u.set(h,[]);this.documents.set(t,u)}i.health=this.calculateIndexHealth(t),this.updateMetrics()}routeToShard(t,e){const n=this.indices.get(t);if(!n)return 0;let s=0;for(let i=0;i<e.length;i++){const o=e.charCodeAt(i);s=(s<<5)-s+o,s=s&s}return Math.abs(s)%n.shards}indexDocument(t,e,n,s){const i=Date.now(),o=this.indices.get(t);if(!o)return{operation:"index",index:t,id:e,document:n,routing:s,latency:Date.now()-i,success:!1,error:`Index ${t} does not exist`};const c=s||e,u=this.routeToShard(t,c),h={_id:e,_index:t,_source:n,_routing:s},f=this.documents.get(t),m=f.get(u)||[],y=m.findIndex(S=>S._id===e);y>=0?m[y]=h:m.push(h),f.set(u,m),this.documents.set(t,f),o.docs=this.getTotalDocsForIndex(t),o.size=this.getTotalSizeForIndex(t),o.health=this.calculateIndexHealth(t);const v=this.shards.get(t);for(const S of v)S.index===t&&S.shard===u&&S.primary&&(S.docs=m.length,S.size=m.length*1024);const x=this.calculateIndexLatency();return this.recordIndexOperation(x),this.updateMetrics(),{operation:"index",index:t,id:e,document:n,routing:s,latency:x,success:!0,took:x}}getDocument(t,e,n){const s=Date.now();if(!this.indices.get(t))return{operation:"get",index:t,id:e,routing:n,latency:Date.now()-s,success:!1,error:`Index ${t} does not exist`};const o=n||e,c=this.routeToShard(t,o),f=(this.documents.get(t).get(c)||[]).find(y=>y._id===e),m=this.calculateGetLatency();return this.recordGetOperation(m),this.updateMetrics(),f?{operation:"get",index:t,id:e,document:f._source,routing:n,latency:m,success:!0,took:m}:{operation:"get",index:t,id:e,routing:n,latency:m,success:!1,error:`Document ${e} not found`,took:m}}search(t,e){const n=Date.now(),s=this.indices.get(t);if(!s)return{operation:"search",index:t,query:e,latency:Date.now()-n,success:!1,error:`Index ${t} does not exist`};const i=this.documents.get(t);let o=[];for(let m=0;m<s.shards;m++){const y=i.get(m)||[];o=o.concat(y)}let c=o;if(e&&e.query){if(e.query.match_all)c=o;else if(e.query.match){const m=Object.keys(e.query.match)[0],y=e.query.match[m];y&&typeof y=="string"&&(c=o.filter(v=>{const x=v._source[m];return x&&String(x).toLowerCase().includes(y.toLowerCase())}))}}const u=e?.size||10;c=c.slice(0,u);const h=this.calculateSearchLatency(s.shards,c.length);this.recordSearchOperation(h,c.length),this.updateMetrics();const f={operation:"search",index:t,query:e,latency:h,success:!0,hits:c.length,took:h};return this.recentQueries.unshift(f),this.recentQueries.length>100&&(this.recentQueries=this.recentQueries.slice(0,100)),f}deleteDocument(t,e,n){const s=Date.now(),i=this.indices.get(t);if(!i)return{operation:"delete",index:t,id:e,routing:n,latency:Date.now()-s,success:!1,error:`Index ${t} does not exist`};const o=n||e,c=this.routeToShard(t,o),u=this.documents.get(t),h=u.get(c)||[],f=h.length,m=h.filter(x=>x._id!==e);u.set(c,m),this.documents.set(t,u),i.docs=this.getTotalDocsForIndex(t),i.size=this.getTotalSizeForIndex(t),i.health=this.calculateIndexHealth(t);const y=this.shards.get(t);for(const x of y)x.index===t&&x.shard===c&&x.primary&&(x.docs=m.length,x.size=m.length*1024);const v=this.calculateIndexLatency();return this.updateMetrics(),m.length===f?{operation:"delete",index:t,id:e,routing:n,latency:v,success:!1,error:`Document ${e} not found`,took:v}:{operation:"delete",index:t,id:e,routing:n,latency:v,success:!0,took:v}}executeQuery(t){const e=Date.now();try{let n;try{n=JSON.parse(t)}catch{const s=t.split(`
`);if(s.length>=2){const i=s[0].match(/^(GET|POST|PUT|DELETE)\s+(.+)/);if(i){const o=i[1],c=i[2].trim();if(o==="GET"&&c.includes("/_search")){n=s.length>1?JSON.parse(s.slice(1).join(`
`)):{query:{match_all:{}}};const u=c.match(/^\/([^\/]+)\/_search/),h=u?u[1]:"_all";return this.search(h,n)}else if(o==="GET"&&c.match(/\/[^\/]+\/_doc\/[^\/]+/)){const u=c.match(/\/([^\/]+)\/_doc\/([^\/]+)/);if(u)return this.getDocument(u[1],u[2])}}}return{operation:"search",query:t,latency:Date.now()-e,success:!1,error:"Invalid query format"}}return n.query||n.match_all?this.search("_all",n):{operation:"search",query:t,latency:Date.now()-e,success:!1,error:"Unsupported query format"}}catch(n){return{operation:"search",query:t,latency:Date.now()-e,success:!1,error:n instanceof Error?n.message:"Unknown error"}}}getMetrics(){return this.updateMetrics(),{...this.metrics}}getIndices(){return Array.from(this.indices.values())}getShards(t){return this.shards.get(t)||[]}getRecentQueries(t=10){return this.recentQueries.slice(0,t)}calculateIndexHealth(t){const e=this.shards.get(t)||[],n=e.filter(o=>o.state==="UNASSIGNED").length,s=e.filter(o=>o.state==="INITIALIZING").length,i=e.filter(o=>o.state==="RELOCATING").length;return n>0?"red":s>0||i>0?"yellow":"green"}calculateClusterHealth(){let t=!1,e=!1;for(const i of this.indices.values())i.health==="red"?t=!0:i.health==="yellow"&&(e=!0);const n=Array.from(this.nodes.values()).filter(i=>i.status==="up").length,s=this.nodes.size;return n===0||t?"red":n<s||e?"yellow":"green"}getTotalDocsForIndex(t){const e=this.documents.get(t);if(!e)return 0;let n=0;for(const s of e.values())n+=s.length;return n}getTotalSizeForIndex(t){const e=this.documents.get(t);if(!e)return 0;let n=0;for(const s of e.values())n+=s.length*1024;return n}calculateIndexLatency(){const e=this.metrics.totalDocs;return 5+Math.min(20,e/1e4)+Math.random()*5}calculateSearchLatency(t,e){const s=t*2,i=Math.min(50,e/100);return 10+s+i+Math.random()*10}calculateGetLatency(){return 2+Math.random()*3}recordIndexOperation(t){this.indexOperations.push({timestamp:Date.now(),latency:t}),this.indexOperations.length>500&&(this.indexOperations=this.indexOperations.slice(-500))}recordSearchOperation(t,e){this.searchOperations.push({timestamp:Date.now(),latency:t,hits:e}),this.searchOperations.length>500&&(this.searchOperations=this.searchOperations.slice(-500))}recordGetOperation(t){this.getOperations.push({timestamp:Date.now(),latency:t}),this.getOperations.length>500&&(this.getOperations=this.getOperations.slice(-500))}updateMetrics(){const t=Date.now(),e=1e3,n=this.indexOperations.filter(f=>t-f.timestamp<e),s=this.searchOperations.filter(f=>t-f.timestamp<e),i=this.getOperations.filter(f=>t-f.timestamp<e);this.metrics.indexOperationsPerSecond=n.length,this.metrics.searchOperationsPerSecond=s.length,n.length>0&&(this.metrics.averageIndexLatency=n.reduce((f,m)=>f+m.latency,0)/n.length),s.length>0&&(this.metrics.averageSearchLatency=s.reduce((f,m)=>f+m.latency,0)/s.length),i.length>0&&(this.metrics.averageGetLatency=i.reduce((f,m)=>f+m.latency,0)/i.length),this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(f=>f.status==="up").length,this.metrics.totalIndices=this.indices.size,this.metrics.totalDocs=Array.from(this.indices.values()).reduce((f,m)=>f+m.docs,0),this.metrics.totalSize=Array.from(this.indices.values()).reduce((f,m)=>f+m.size,0);let o=0,c=0,u=0,h=0;for(const f of this.shards.values())for(const m of f)if(m.primary)switch(m.state){case"STARTED":o++;break;case"RELOCATING":c++;break;case"INITIALIZING":u++;break;case"UNASSIGNED":h++;break}this.metrics.activeShards=o,this.metrics.relocatingShards=c,this.metrics.initializingShards=u,this.metrics.unassignedShards=h,this.metrics.clusterHealth=this.calculateClusterHealth();for(const f of this.indices.values())f.health=this.calculateIndexHealth(f.name);this.lastMetricsUpdate=t}}class iT{buckets=new Map;objects=new Map;versions=new Map;operations=[];metrics=new Map;lifecycleTransitions=new Map;initialize(t){if(this.buckets.clear(),this.objects.clear(),this.versions.clear(),this.operations=[],this.metrics.clear(),this.lifecycleTransitions.clear(),t.buckets)for(const e of t.buckets)this.buckets.set(e.name,{...e}),this.objects.set(e.name,new Map),e.versioning&&this.versions.set(e.name,new Map),this.metrics.set(e.name,{bucket:e.name,objectCount:0,totalSize:0,versionsCount:0,putCount:0,getCount:0,deleteCount:0,listCount:0,errorCount:0,averageLatency:0}),this.lifecycleTransitions.set(e.name,new Map)}putObject(t,e,n,s,i,o){const c=Date.now(),u=this.buckets.get(t);if(!u)return{success:!1,etag:"",latency:Date.now()-c,error:`Bucket '${t}' does not exist`};const h=this.generateETag(e,s),f=u.versioning?`${Date.now()}-${Math.random().toString(36).substr(2,9)}`:void 0,m={key:e,bucket:t,size:s,lastModified:Date.now(),storageClass:"STANDARD",etag:h,contentType:o||"application/octet-stream",metadata:i||{},versionId:f,encryption:u.encryption},y=this.objects.get(t);if(u.versioning&&f){const M=this.versions.get(t),T=M.get(e)||[];T.push({versionId:f,object:m,isDeleteMarker:!1}),M.set(e,T),this.versions.set(t,M);const k=this.metrics.get(t);k.versionsCount=this.getTotalVersionsCount(t)}y.set(e,m),this.objects.set(t,y);const v=this.findMatchingLifecycleRule(u,e);if(v&&v.transitions&&v.transitions.length>0){const M=this.lifecycleTransitions.get(t),T=v.transitions[0],k=Date.now()+T.days*24*60*60*1e3;M.set(e,{currentClass:"STANDARD",transitionScheduled:k,targetClass:T.storageClass,ruleId:v.id,transitionIndex:0,allTransitions:v.transitions}),this.lifecycleTransitions.set(t,M)}else if(u.lifecycleEnabled&&u.lifecycleDays){const M=this.lifecycleTransitions.get(t),T=Date.now()+u.lifecycleDays*24*60*60*1e3;M.set(e,{currentClass:"STANDARD",transitionScheduled:T,targetClass:u.glacierEnabled?"GLACIER":"STANDARD_IA"}),this.lifecycleTransitions.set(t,M)}const x=this.metrics.get(t),S=y.get(e);S?x.totalSize-=S.size:x.objectCount++,x.totalSize+=s,x.putCount++;const R=this.calculatePutLatency(s);return this.recordOperation("PUT",t,e,!0,R),this.updateMetrics(t,R,!0),{success:!0,versionId:f,etag:h,latency:R}}getObject(t,e,n){const s=Date.now(),i=this.buckets.get(t);if(!i)return{success:!1,latency:Date.now()-s,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t);if(i.versioning&&n){const m=(this.versions.get(t).get(e)||[]).find(v=>v.versionId===n);if(!m||m.isDeleteMarker){const v=this.calculateGetLatency(0);return this.recordOperation("GET",t,e,!1,v),this.updateMetrics(t,v,!1),{success:!1,latency:v,error:m?.isDeleteMarker?"Object version is a delete marker":`Object version '${n}' not found`}}if(m.object.storageClass==="GLACIER"||m.object.storageClass==="DEEP_ARCHIVE"){const v=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",t,e,!1,v),this.updateMetrics(t,v,!1),{success:!1,latency:v,error:`Object is archived in ${m.object.storageClass}. Restore operation required.`}}const y=this.calculateGetLatency(m.object.size);return this.recordOperation("GET",t,e,!0,y),this.updateMetrics(t,y,!0),{success:!0,object:m.object,latency:y}}const c=o.get(e);if(!c){const h=this.calculateGetLatency(0);return this.recordOperation("GET",t,e,!1,h),this.updateMetrics(t,h,!1),{success:!1,latency:h,error:`Object '${e}' not found`}}if(c.storageClass==="GLACIER"||c.storageClass==="DEEP_ARCHIVE"){const h=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",t,e,!1,h),this.updateMetrics(t,h,!1),{success:!1,latency:h,error:`Object is archived in ${c.storageClass}. Restore operation required.`}}const u=this.calculateGetLatency(c.size);return this.recordOperation("GET",t,e,!0,u),this.updateMetrics(t,u,!0),{success:!0,object:c,latency:u}}deleteObject(t,e,n){const s=Date.now(),i=this.buckets.get(t);if(!i)return{success:!1,latency:Date.now()-s,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t),c=o.get(e);if(!c){const m=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!1,m),this.updateMetrics(t,m,!1),{success:!1,latency:m,error:`Object '${e}' not found`}}if(i.versioning){const m=this.versions.get(t),y=m.get(e)||[],v=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;y.push({versionId:v,object:{...c},isDeleteMarker:!0}),m.set(e,y),this.versions.set(t,m),o.delete(e),this.objects.set(t,o);const x=this.metrics.get(t);x.versionsCount=this.getTotalVersionsCount(t),x.deleteCount++;const S=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!0,S),this.updateMetrics(t,S,!0),{success:!0,deleteMarker:!0,latency:S}}const u=c.size;o.delete(e),this.objects.set(t,o);const h=this.metrics.get(t);h.objectCount--,h.totalSize-=u,h.deleteCount++;const f=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!0,f),this.updateMetrics(t,f,!0),{success:!0,latency:f}}listObjects(t,e,n){const s=Date.now();if(!this.buckets.get(t))return{success:!1,objects:[],latency:Date.now()-s,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t);let c=Array.from(o.values());e&&(c=c.filter(f=>f.key.startsWith(e))),c.sort((f,m)=>f.key.localeCompare(m.key)),n&&(c=c.slice(0,n));const u=this.calculateListLatency(c.length);this.recordOperation("LIST",t,void 0,!0,u);const h=this.metrics.get(t);return h.listCount++,this.updateMetrics(t,u,!0),{success:!0,objects:c,latency:u}}headObject(t,e){const n=Date.now();if(!this.buckets.get(t))return{success:!1,latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t).get(e);if(!o){const u=this.calculateHeadLatency();return this.recordOperation("HEAD",t,e,!1,u),this.updateMetrics(t,u,!1),{success:!1,latency:u,error:`Object '${e}' not found`}}const c=this.calculateHeadLatency();return this.recordOperation("HEAD",t,e,!0,c),this.updateMetrics(t,c,!0),{success:!0,object:o,latency:c}}processLifecycleTransitions(t=Date.now()){for(const[e,n]of this.lifecycleTransitions.entries()){const s=this.buckets.get(e);if(!(s&&(s.lifecycleEnabled||s.lifecycleRules&&s.lifecycleRules.some(c=>c.status==="Enabled"))))continue;const o=this.objects.get(e);for(const[c,u]of n.entries())if(t>=u.transitionScheduled){const h=o.get(c);if(h&&h.storageClass===u.currentClass)if(h.storageClass=u.targetClass,o.set(c,h),this.objects.set(e,o),u.ruleId&&u.allTransitions&&u.transitionIndex!==void 0){const f=u.transitionIndex+1;if(f<u.allTransitions.length){const m=u.allTransitions[f],y=t+m.days*24*60*60*1e3;n.set(c,{currentClass:u.targetClass,transitionScheduled:y,targetClass:m.storageClass,ruleId:u.ruleId,transitionIndex:f,allTransitions:u.allTransitions})}else{const m=this.findLifecycleRuleById(s,u.ruleId);if(m?.expiration?.days){const y=t+m.expiration.days*24*60*60*1e3;n.set(c,{currentClass:u.targetClass,transitionScheduled:y,targetClass:u.targetClass,ruleId:u.ruleId,expiration:!0})}else n.delete(c)}}else if(s.glacierEnabled&&s.glacierDays&&u.targetClass==="STANDARD_IA"){const f=t+s.glacierDays*24*60*60*1e3;n.set(c,{currentClass:"STANDARD_IA",transitionScheduled:f,targetClass:"GLACIER"})}else n.delete(c);else h||n.delete(c)}this.lifecycleTransitions.set(e,n)}this.processExpirations(t)}processExpirations(t){for(const[e,n]of this.lifecycleTransitions.entries()){if(!this.buckets.get(e))continue;const i=this.objects.get(e),o=[];for(const[c,u]of n.entries())u.expiration&&t>=u.transitionScheduled&&i.has(c)&&o.push(c);for(const c of o){const u=i.get(c);if(u){const h=this.metrics.get(e);h&&(h.objectCount=Math.max(0,h.objectCount-1),h.totalSize=Math.max(0,h.totalSize-u.size))}i.delete(c),n.delete(c)}this.objects.set(e,i),this.lifecycleTransitions.set(e,n)}}findMatchingLifecycleRule(t,e){return!t.lifecycleRules||t.lifecycleRules.length===0?void 0:t.lifecycleRules.filter(s=>s.status==="Enabled").filter(s=>!s.prefix||e.startsWith(s.prefix)).sort((s,i)=>{const o=s.prefix||"";return(i.prefix||"").length-o.length})[0]}findLifecycleRuleById(t,e){if(t.lifecycleRules)return t.lifecycleRules.find(n=>n.id===e)}findLifecycleRuleById(t,e){if(t.lifecycleRules)return t.lifecycleRules.find(n=>n.id===e)}getBucketMetrics(t){return this.metrics.get(t)}getAllBucketMetrics(){return new Map(this.metrics)}getTotalStorageSize(){let t=0;for(const e of this.metrics.values())t+=e.totalSize;return t}getTotalObjectCount(){let t=0;for(const e of this.metrics.values())t+=e.objectCount;return t}generateETag(t,e){const n=`${t}_${e}_${Date.now()}`;let s=0;for(let i=0;i<n.length;i++){const o=n.charCodeAt(i);s=(s<<5)-s+o,s=s&s}return Math.abs(s).toString(16)}calculatePutLatency(t){const n=t/1024*.1,s=(Math.random()-.5)*10;return Math.max(10,50+n+s)}calculateGetLatency(t){const n=t/1024*.15,s=(Math.random()-.5)*10;return Math.max(10,30+n+s)}calculateDeleteLatency(){const e=(Math.random()-.5)*5;return Math.max(5,20+e)}calculateListLatency(t){const n=t*.01,s=(Math.random()-.5)*10;return Math.max(20,40+n+s)}calculateHeadLatency(){const e=(Math.random()-.5)*5;return Math.max(5,15+e)}calculateGlacierRestoreLatency(){return 5e3}recordOperation(t,e,n,s,i){this.operations.push({operation:t,bucket:e,key:n,success:s,latency:i,timestamp:Date.now()}),this.operations.length>1e3&&this.operations.shift()}updateMetrics(t,e,n){const s=this.metrics.get(t);if(!s)return;const i=s.putCount+s.getCount+s.deleteCount+s.listCount;i>0?s.averageLatency=(s.averageLatency*(i-1)+e)/i:s.averageLatency=e,n||s.errorCount++,s.lastOperation=Date.now()}getTotalVersionsCount(t){const e=this.versions.get(t);if(!e)return 0;let n=0;for(const s of e.values())n+=s.length;return n}}class aT{connections=new Map;config;connectionCounter=0;queryHistory=[];MAX_HISTORY=1e3;constructor(t){this.config={maxConnections:t.maxConnections||100,minConnections:t.minConnections||0,idleTimeout:t.idleTimeout||3e5,maxLifetime:t.maxLifetime||36e5,connectionTimeout:t.connectionTimeout||5e3}}acquireConnection(t){const e=Date.now();this.cleanupIdleConnections(e);for(const[n,s]of this.connections.entries())if(s.status==="idle")return s.status="active",s.lastActivity=e,s.currentQuery=t,s.queryCount++,n;return this.connections.size<this.config.maxConnections?this.createConnection(t,e):null}releaseConnection(t,e){const n=this.connections.get(t);n&&(n.status="idle",n.lastActivity=Date.now(),n.currentQuery=void 0,e!==void 0&&this.recordQuery(e))}terminateConnection(t){const e=this.connections.get(t);e&&(e.status="terminated",this.connections.delete(t))}createConnection(t,e){const n=`conn_${++this.connectionCounter}_${e}`,s={id:n,status:"active",createdAt:e,lastActivity:e,queryCount:1,currentQuery:t};return this.connections.set(n,s),n}cleanupIdleConnections(t){const e=[];for(const[n,s]of this.connections.entries())s.status==="idle"&&(t-s.lastActivity>this.config.idleTimeout||t-s.createdAt>this.config.maxLifetime)&&e.push(n);for(const n of e)this.connections.delete(n)}recordQuery(t){const e=Date.now();this.queryHistory.push({timestamp:e,duration:t}),this.queryHistory.length>this.MAX_HISTORY&&this.queryHistory.shift()}getMetrics(){const t=Date.now();let e=0,n=0,s=0;for(const y of this.connections.values())switch(y.status){case"active":e++;break;case"idle":n++;break;case"waiting":s++;break}const i=this.connections.size,o=i>0?e/this.config.maxConnections:0,c=this.queryHistory.filter(y=>t-y.timestamp<6e4),u=c.length>0?c.reduce((y,v)=>y+v.duration,0)/c.length:0,f=this.queryHistory.filter(y=>t-y.timestamp<1e3).length,m=i>=this.config.maxConnections?this.config.connectionTimeout/2:0;return{totalConnections:i,activeConnections:e,idleConnections:n,waitingConnections:s,utilization:o,averageQueryTime:u,queriesPerSecond:f,connectionWaitTime:m}}getConnection(t){return this.connections.get(t)}getAllConnections(){return Array.from(this.connections.values())}updateConfig(t){if(this.config={...this.config,...t},t.maxConnections!==void 0&&t.maxConnections<this.connections.size){const e=this.connections.size-t.maxConnections,n=Array.from(this.connections.entries()).filter(([s,i])=>i.status==="idle").slice(0,e);for(const[s]of n)this.terminateConnection(s)}}reset(){this.connections.clear(),this.connectionCounter=0,this.queryHistory=[]}}class oT{static exportMetrics(t,e){const n=[],s=this.buildLabels(t,e),i=e.timestamp||Date.now();if(n.push("# HELP component_throughput_total Component throughput in operations per second"),n.push("# TYPE component_throughput_total gauge"),n.push(`component_throughput_total{${s}} ${e.throughput||0} ${i}`),n.push("# HELP component_latency_ms Component latency in milliseconds"),n.push("# TYPE component_latency_ms gauge"),n.push(`component_latency_ms{${s}} ${e.latency||0} ${i}`),e.latencyP50!==void 0&&(n.push("# HELP component_latency_p50_ms Component 50th percentile latency in milliseconds"),n.push("# TYPE component_latency_p50_ms gauge"),n.push(`component_latency_p50_ms{${s}} ${e.latencyP50} ${i}`)),e.latencyP99!==void 0&&(n.push("# HELP component_latency_p99_ms Component 99th percentile latency in milliseconds"),n.push("# TYPE component_latency_p99_ms gauge"),n.push(`component_latency_p99_ms{${s}} ${e.latencyP99} ${i}`)),n.push("# HELP component_error_rate Component error rate (0-1)"),n.push("# TYPE component_error_rate gauge"),n.push(`component_error_rate{${s}} ${e.errorRate||0} ${i}`),n.push("# HELP component_utilization Component utilization (0-1)"),n.push("# TYPE component_utilization gauge"),n.push(`component_utilization{${s}} ${e.utilization||0} ${i}`),e.customMetrics)for(const[o,c]of Object.entries(e.customMetrics)){const u=this.sanitizeMetricName(o);n.push(`# HELP component_${u} Component custom metric: ${o}`),n.push(`# TYPE component_${u} gauge`),n.push(`component_${u}{${s}} ${c} ${i}`)}return n.join(`
`)+`
`}static buildLabels(t,e){const n=[];n.push(`component_id="${this.escapeLabelValue(t.id)}"`),n.push(`component_type="${this.escapeLabelValue(t.type)}"`),t.data.label&&n.push(`component_name="${this.escapeLabelValue(t.data.label)}"`);const s=t.data.config||{};return s.environment&&n.push(`environment="${this.escapeLabelValue(String(s.environment))}"`),s.namespace&&n.push(`namespace="${this.escapeLabelValue(String(s.namespace))}"`),n.join(",")}static escapeLabelValue(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}static sanitizeMetricName(t){return t.replace(/[^a-zA-Z0-9_:]/g,"_").replace(/^[^a-zA-Z]/,"_")}static exportAllMetrics(t,e){const n=[];for(const s of t){const i=e.get(s.id);i&&n.push(this.exportMetrics(s,i))}return n.join(`
`)}static exportEndpointMetrics(t,e){return e?this.exportMetrics(t,e):""}}class rT{config=null;targetStatuses=new Map;scrapedMetrics=new Map;lastScrapeTimes=new Map;prometheusMetrics={scrapeRequestsTotal:0,scrapeErrorsTotal:0,scrapeDurationTotal:0,targetsUp:0,targetsDown:0,samplesScraped:0};initializeConfig(t){const e=t.data.config||{},n=typeof e.scrapeInterval=="number"?`${e.scrapeInterval/1e3}s`:e.scrapeInterval||"15s",s=typeof e.evaluationInterval=="number"?`${e.evaluationInterval/1e3}s`:e.evaluationInterval||"15s";this.config={global:{scrape_interval:n,evaluation_interval:s,external_labels:{prometheus:"archiphoenix"}},scrape_configs:this.buildScrapeConfigs(e),alerting:e.enableAlertmanager?{alertmanagers:[{static_configs:[{targets:[e.alertmanagerUrl||"http://alertmanager:9093"].map(i=>{const o=i.match(/^https?:\/\/([^\/]+)/);return o?o[1]:i})}]}]}:void 0,remote_write:e.enableRemoteWrite&&e.remoteWrite?e.remoteWrite.map(i=>({url:i.url})):void 0},this.initializeTargetStatuses()}buildScrapeConfigs(t){if(t.scrape_configs&&Array.isArray(t.scrape_configs))return t.scrape_configs.map(s=>({job_name:s.job_name,scrape_interval:s.scrape_interval,scrape_timeout:s.scrape_timeout,metrics_path:s.metrics_path,static_configs:s.static_configs||[]}));const e=[],n=t.scrapeInterval||"15s";if(t.targets&&Array.isArray(t.targets)){const s=new Map;for(const i of t.targets){const o=i.job||"default";s.has(o)||s.set(o,[]),s.get(o).push(i)}for(const[i,o]of s.entries()){const c=o[0],u=c.interval||n,h=c.metricsPath||"/metrics",f=o.map(m=>{try{const y=new URL(m.endpoint);return`${y.hostname}${y.port?":"+y.port:""}`}catch{const y=m.endpoint.match(/^https?:\/\/([^\/]+)/);return y?y[1]:m.endpoint}});e.push({job_name:i,scrape_interval:u,metrics_path:h,static_configs:[{targets:f,labels:c.labels||{}}]})}}return e}initializeTargetStatuses(){if(this.targetStatuses.clear(),!!this.config){for(const t of this.config.scrape_configs)if(t.static_configs)for(const e of t.static_configs)for(const n of e.targets){const s=t.metrics_path?`http://${n}${t.metrics_path}`:`http://${n}/metrics`,i=`${t.job_name}:${n}`;this.targetStatuses.set(i,{job:t.job_name,endpoint:s,lastScrape:0,lastSuccess:null,lastError:null,scrapeDuration:null,up:!1,labels:e.labels})}}}performScraping(t,e,n){if(this.config){this.parseDuration(this.config.global.scrape_interval||"15s"),this.prometheusMetrics.targetsUp=0,this.prometheusMetrics.targetsDown=0;for(const[s,i]of this.targetStatuses.entries()){const o=this.lastScrapeTimes.get(s)||0,c=this.getScrapeIntervalForTarget(i.job),u=this.parseDuration(c);t-o>=u&&(this.scrapeTarget(s,i,t,e,n),this.lastScrapeTimes.set(s,t)),i.up?this.prometheusMetrics.targetsUp++:this.prometheusMetrics.targetsDown++}}}scrapeTarget(t,e,n,s,i){const o=performance.now();this.prometheusMetrics.scrapeRequestsTotal++;try{const c=this.findNodeByEndpoint(e.endpoint,s);if(!c)throw new Error(`Target not found: ${e.endpoint}`);const u=i.get(c.id);if(!u)throw new Error(`Metrics not available for component: ${c.id}`);const h=oT.exportMetrics(c,u);e.lastScrape=n,e.lastSuccess=n,e.lastError=null,e.up=!0;const f=performance.now()-o;e.scrapeDuration=f,this.prometheusMetrics.scrapeDurationTotal+=f,this.prometheusMetrics.samplesScraped+=this.countSamples(h),this.scrapedMetrics.set(t,u)}catch(c){const u=performance.now()-o;e.lastScrape=n,e.lastSuccess=null,e.lastError=c instanceof Error?c.message:String(c),e.up=!1,e.scrapeDuration=u,this.prometheusMetrics.scrapeErrorsTotal++}}findNodeByEndpoint(t,e){try{const n=new URL(t),s=n.hostname,i=n.port?parseInt(n.port):null;for(const o of e){const c=o.data.config||{},u=c.port||c.metricsPort||c.metrics?.port;if(o.data.label?.toLowerCase().replace(/\s+/g,"-")===s||i&&u===i)return o}}catch{}return null}getScrapeIntervalForTarget(t){return this.config&&(this.config.scrape_configs.find(n=>n.job_name===t)?.scrape_interval||this.config.global.scrape_interval)||"15s"}parseDuration(t){if(typeof t=="number")return t;if(typeof t!="string")return 15e3;const e=t.match(/^(\d+)([smhd])$/);if(!e)return 15e3;const n=parseInt(e[1]);switch(e[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 15e3}}countSamples(t){return t.split(`
`).filter(e=>e.trim()&&!e.startsWith("#")).length}getTargetStatuses(){return Array.from(this.targetStatuses.values())}getPrometheusMetrics(){return{...this.prometheusMetrics}}calculateLoad(){const t=this.prometheusMetrics.scrapeRequestsTotal,e=this.prometheusMetrics.scrapeErrorsTotal,n=this.prometheusMetrics.scrapeDurationTotal,s=this.prometheusMetrics.samplesScraped,i=this.targetStatuses.size,o=this.parseDuration(this.config?.global.scrape_interval||"15s"),c=i>0?1e3/o*i:0,u=t>0?n/t:0,h=t>0?e/t:0,f=c*(s/t||0);return{scrapeRequestsPerSecond:c,averageScrapeDuration:u,errorRate:h,samplesPerSecond:f}}}class cT{config=null;lastRefreshTimes=new Map;lastAlertEvaluationTimes=new Map;grafanaMetrics={queriesPerSecond:0,dashboardRefreshesPerSecond:0,alertEvaluationsPerSecond:0,datasourceErrors:0,activeDashboards:0,activePanels:0,totalQueries:0,cachedQueries:0,queryLatency:0,renderingLatency:0};queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(t){const e=t.data.config||{};this.config=e,this.initializeRefreshTimes(),this.initializeAlertEvaluationTimes()}initializeRefreshTimes(){if(this.lastRefreshTimes.clear(),!this.config?.dashboards)return;const t=this.normalizeDashboards(this.config.dashboards);for(const e of t)this.lastRefreshTimes.set(e.id,0)}initializeAlertEvaluationTimes(){if(this.lastAlertEvaluationTimes.clear(),!(!this.config?.alerts||!this.config.enableAlerting))for(const t of this.config.alerts)this.lastAlertEvaluationTimes.set(t.id,0)}normalizeDashboards(t){return!t||!Array.isArray(t)?[]:t.map(e=>{if(e&&typeof e=="object"){if(typeof e.panels=="number")return{id:e.id||String(Date.now()),name:e.name||"Dashboard",panels:[],tags:Array.isArray(e.tags)?e.tags:[],refresh:e.refresh||"30s"};if(Array.isArray(e.panels))return{id:e.id||String(Date.now()),name:e.name||"Dashboard",panels:e.panels.map(n=>({id:n.id||`panel-${Date.now()}`,title:n.title||"Panel",type:n.type||"graph",datasource:n.datasource||"Prometheus",queries:Array.isArray(n.queries)?n.queries:[{refId:"A",expr:"up"}],gridPos:n.gridPos||{x:0,y:0,w:12,h:8}})),tags:Array.isArray(e.tags)?e.tags:[],variables:e.variables,refresh:e.refresh||"30s",timeRange:e.timeRange}}return e}).filter(e=>e&&typeof e=="object"&&e.id)}performUpdate(t,e=!0,n){this.config&&(this.updateDashboards(t,e,n),this.config.enableAlerting&&this.evaluateAlerts(t,e),this.updateMetrics())}updateDashboards(t,e,n){if(!this.config?.dashboards)return;const s=this.normalizeDashboards(this.config.dashboards);let i=0,o=0;for(const c of s){const u=this.parseDuration(c.refresh||"30s"),h=this.lastRefreshTimes.get(c.id)||0;if(t-h>=u){this.lastRefreshTimes.set(c.id,t);for(const f of c.panels){const m=f.datasource,y=m&&this.isLokiDatasource(m);for(const S of f.queries){i++;const R=this.simulateQueryExecution(S,e,y,n);o+=R,this.queryLatencyHistory.push(R),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift()}const v=this.simulatePanelRendering(f),x=this.grafanaMetrics.renderingLatency;this.grafanaMetrics.renderingLatency=x*.9+v*.1}}}this.grafanaMetrics.totalQueries+=i,i>0&&(this.grafanaMetrics.queryLatency=o/i)}isLokiDatasource(t){if(!this.config?.datasources)return!1;const n=(Array.isArray(this.config.datasources)?this.config.datasources:[]).find(s=>typeof s=="string"?s===t:s.name===t);return typeof n=="object"&&n.type?n.type==="loki":!1}evaluateAlerts(t,e){if(this.config?.alerts)for(const n of this.config.alerts){const s=this.parseDuration(n.for||"1m"),i=this.lastAlertEvaluationTimes.get(n.id)||0;t-i>=s&&(this.lastAlertEvaluationTimes.set(n.id,t),this.simulateQueryExecution({refId:"A",expr:n.condition.query},e),e||this.grafanaMetrics.datasourceErrors++)}}simulateQueryExecution(t,e,n=!1,s){if(n&&s)try{const u=Date.now()-36e5,h=Date.now(),f=s(t.expr,u,h,100);return f.success||this.grafanaMetrics.datasourceErrors++,f.latency}catch{return this.grafanaMetrics.datasourceErrors++,1e3}if(!e)return this.grafanaMetrics.datasourceErrors++,1e3;let i=50;const o=this.estimateQueryComplexity(t.expr);i+=o*10;const c=(Math.random()-.5)*20;return Math.max(10,i+c)}estimateQueryComplexity(t){if(!t)return 0;let e=1;t.includes("[")&&(e+=2);const n=["sum","avg","max","min","count","rate","irate","increase"];for(const i of n)t.toLowerCase().includes(i)&&(e+=1);const s=(t.match(/\|/g)||[]).length;return e+=s,e}simulatePanelRendering(t){const n={stat:5,gauge:10,piechart:15,bargraph:20,table:25,graph:30}[t.type]||20,s=Math.sqrt(t.queries.length);return n*s}updateMetrics(){if(!this.config)return;const t=this.normalizeDashboards(this.config.dashboards);this.grafanaMetrics.activeDashboards=t.length,this.grafanaMetrics.activePanels=t.reduce((s,i)=>s+i.panels.length,0);let e=0,n=0;for(const s of t){const o=1e3/this.parseDuration(s.refresh||"30s");n+=o;const c=s.panels.reduce((u,h)=>u+h.queries.length,0);e+=o*c}if(this.grafanaMetrics.queriesPerSecond=e,this.grafanaMetrics.dashboardRefreshesPerSecond=n,this.config.enableAlerting&&this.config.alerts){let s=0;for(const i of this.config.alerts){const c=1e3/this.parseDuration(i.for||"1m");s+=c}this.grafanaMetrics.alertEvaluationsPerSecond=s}else this.grafanaMetrics.alertEvaluationsPerSecond=0;if(this.queryLatencyHistory.length>0){const s=this.queryLatencyHistory.reduce((i,o)=>i+o,0)/this.queryLatencyHistory.length;this.grafanaMetrics.queryLatency=s}}parseDuration(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 3e4;const n=parseInt(e[1]);switch(e[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 3e4}}getGrafanaMetrics(){return{...this.grafanaMetrics}}calculateLoad(){const t=this.grafanaMetrics,e=.1,n=Math.min(.7,t.queriesPerSecond/100),s=Math.min(.1,t.alertEvaluationsPerSecond/10),i=Math.min(.1,t.activePanels/100),o=Math.min(.95,e+n+s+i),c=.2,u=Math.min(.4,t.activeDashboards/50),h=Math.min(.3,t.cachedQueries/1e3),f=Math.min(.95,c+u+h),m=t.totalQueries+t.alertEvaluationsPerSecond,y=m>0?t.datasourceErrors/m:0;return{queriesPerSecond:t.queriesPerSecond,dashboardRefreshesPerSecond:t.dashboardRefreshesPerSecond,alertEvaluationsPerSecond:t.alertEvaluationsPerSecond,averageQueryLatency:t.queryLatency,averageRenderingLatency:t.renderingLatency,errorRate:y,cpuUtilization:o,memoryUtilization:f}}getActiveDatasources(){return this.config?.datasources?this.config.datasources.length>0&&typeof this.config.datasources[0]=="string"?this.config.datasources.map(t=>({name:t,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:t===this.config.datasources[0]})):this.config.datasources.filter(t=>t&&typeof t=="object"&&t.name):[]}isPrometheusAvailable(t){return!(!t||!this.getActiveDatasources().find(s=>s.type==="prometheus"))}}class lT{config=null;streams=new Map;queryStatuses=new Map;lastIngestionTimes=new Map;lokiMetrics={ingestionRequestsTotal:0,ingestionErrorsTotal:0,ingestionLinesTotal:0,ingestionBytesTotal:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,activeStreams:0,totalStorageSize:0,retentionDeletions:0};ingestionLatencyHistory=[];queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||"http://loki:3100",retentionPeriod:e.retentionPeriod||"168h",maxStreams:e.maxStreams||1e4,maxLineSize:e.maxLineSize||256e3,enableCompression:e.enableCompression??!0,compressionType:e.compressionType||"gzip",enableAuth:e.enableAuth??!1,enableMultiTenancy:e.enableMultiTenancy??!1,tenants:e.tenants||[],ingestionRateLimit:e.ingestionRateLimit,queryRateLimit:e.queryRateLimit},this.initializeStreamsFromConfig(e),this.initializeQueriesFromConfig(e)}initializeStreamsFromConfig(t){if(t.streams&&Array.isArray(t.streams))for(const e of t.streams){const n=this.getStreamKey(e.labels||{}),s=[];if(e.entries&&Array.isArray(e.entries))for(const o of e.entries)s.push({timestamp:o.timestamp||Date.now().toString()+"000000",line:o.line||""});const i=e.size?e.size*1024*1024*1024:0;this.streams.set(n,{labels:e.labels||{},entries:s,size:i,lastEntryTime:Date.now()})}}initializeQueriesFromConfig(t){if(t.queries&&Array.isArray(t.queries))for(const e of t.queries){const n=e.id||`query-${Date.now()}-${Math.random()}`;this.queryStatuses.set(n,{id:n,query:e.query||"",lastExecution:0,lastSuccess:null,lastError:null,executionDuration:null,resultsCount:e.results||0,success:!0})}}processIngestion(t,e){if(!this.config)return{success:!1,error:"Loki not configured",ingestedLines:0,ingestedBytes:0};const n=performance.now();this.lokiMetrics.ingestionRequestsTotal++;try{if(this.config.ingestionRateLimit){const c=e||"default",u=this.lastIngestionTimes.get(c)||0,h=Date.now();h-u<1e3,this.lastIngestionTimes.set(c,h)}let s=0,i=0;for(const c of t){const u=this.getStreamKey(c.stream);if(!this.streams.has(u)&&this.streams.size>=(this.config.maxStreams||1e4)){this.lokiMetrics.ingestionErrorsTotal++;continue}let h=this.streams.get(u);h||(h={labels:c.stream,entries:[],size:0,lastEntryTime:Date.now()},this.streams.set(u,h));for(const[f,m]of c.values){const y=new Blob([m]).size;if(y>(this.config.maxLineSize||256e3)){this.lokiMetrics.ingestionErrorsTotal++;continue}h.entries.push({timestamp:f,line:m}),h.size+=y,h.lastEntryTime=Math.max(h.lastEntryTime,this.parseTimestamp(f)),s++,i+=y}if(this.config.enableCompression){const f=this.getCompressionRatio(this.config.compressionType||"gzip");h.size=Math.floor(h.size*f)}}this.lokiMetrics.ingestionLinesTotal+=s,this.lokiMetrics.ingestionBytesTotal+=i,this.lokiMetrics.totalStorageSize+=i,this.lokiMetrics.activeStreams=this.streams.size;const o=performance.now()-n;return this.ingestionLatencyHistory.push(o),this.ingestionLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.ingestionLatencyHistory.shift(),{success:!0,ingestedLines:s,ingestedBytes:i}}catch(s){return performance.now()-n,this.lokiMetrics.ingestionErrorsTotal++,{success:!1,error:s instanceof Error?s.message:String(s),ingestedLines:0,ingestedBytes:0}}}executeQuery(t,e,n,s){if(!this.config)return{success:!1,error:"Loki not configured",latency:0,resultsCount:0};const i=performance.now();this.lokiMetrics.queryRequestsTotal++;try{this.config.queryRateLimit;const o=this.parseLogQL(t),c=this.executeLogQLQuery(o,e,n,s),u=performance.now()-i;return this.lokiMetrics.queryDurationTotal+=u,this.queryLatencyHistory.push(u),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift(),{success:!0,result:c,latency:u,resultsCount:c.reduce((h,f)=>h+f.values.length,0)}}catch(o){const c=performance.now()-i;return this.lokiMetrics.queryErrorsTotal++,{success:!1,error:o instanceof Error?o.message:String(o),latency:c,resultsCount:0}}}parseLogQL(t){const e={},n=[],s=[],i=t.match(/^\{([^}]+)\}/);if(i){const v=i[1].matchAll(/(\w+)=["']([^"']+)["']/g);for(const x of v)e[x[1]]=x[2]}const o=t.match(/\|\s*=\s*["']([^"']+)["']/);o&&n.push({type:"contains",pattern:o[1]});const c=t.match(/!\s*=\s*["']([^"']+)["']/);c&&n.push({type:"not_contains",pattern:c[1]});const u=t.match(/\|\s*~\s*["']([^"']+)["']/);u&&n.push({type:"regex",pattern:u[1]});const h=t.matchAll(/\|\s*(\w+)\s*(=|=~|!=|!~)\s*["']([^"']+)["']/g);for(const y of h)s.push({label:y[1],operator:y[2],value:y[3]});let f;const m=t.match(/\|\s*(\w+)\(([^)]*)\)/);return m&&(f={function:m[1],params:m[2]?m[2].split(",").map(y=>y.trim()):[]}),{streamSelector:e,lineFilters:n,labelFilters:s,aggregation:f}}executeLogQLQuery(t,e,n,s){const i=[],o=Date.now(),c=e||o-36e5,u=n||o;for(const[h,f]of this.streams.entries()){let m=!0;for(const[x,S]of Object.entries(t.streamSelector))if(f.labels[x]!==S){m=!1;break}if(!m)continue;let v=f.entries.filter(x=>{const S=this.parseTimestamp(x.timestamp);return S>=c&&S<=u});for(const x of t.lineFilters)v=v.filter(S=>{switch(x.type){case"contains":return S.line.includes(x.pattern);case"not_contains":return!S.line.includes(x.pattern);case"regex":try{return new RegExp(x.pattern).test(S.line)}catch{return!1}}});for(const x of t.labelFilters){const S=f.labels[x.label];if(S===void 0){v=[];break}switch(x.operator){case"=":S!==x.value&&(v=[]);break;case"!=":S===x.value&&(v=[]);break;case"=~":try{new RegExp(x.value).test(S)||(v=[])}catch{v=[]}break;case"!~":try{new RegExp(x.value).test(S)&&(v=[])}catch{}break}}if(s&&v.length>s&&(v=v.slice(0,s)),t.aggregation){const x=this.applyAggregation(t.aggregation,v);i.push({stream:f.labels,values:[[Date.now().toString()+"000000",x.toString()]]})}else v.length>0&&i.push({stream:f.labels,values:v.map(x=>[x.timestamp,x.line])})}return i}applyAggregation(t,e){switch(t.function.toLowerCase()){case"rate":if(e.length<2)return 0;const n=this.parseTimestamp(e[0].timestamp),i=(this.parseTimestamp(e[e.length-1].timestamp)-n)/1e3;return i>0?e.length/i:0;case"count_over_time":return e.length;case"sum":return e.reduce((c,u)=>{const h=parseFloat(u.line);return c+(isNaN(h)?0:h)},0);case"avg":case"average":const o=e.map(c=>parseFloat(c.line)).filter(c=>!isNaN(c));return o.length>0?o.reduce((c,u)=>c+u,0)/o.length:0;default:return e.length}}performRetention(t){if(!this.config)return;const e=this.parseDuration(this.config.retentionPeriod||"168h"),n=t-e;let s=0,i=0;for(const[o,c]of this.streams.entries()){const u=c.entries.length;c.entries=c.entries.filter(h=>this.parseTimestamp(h.timestamp)>n),c.entries.length<u&&(s+=u-c.entries.length,c.size=c.entries.reduce((h,f)=>h+new Blob([f.line]).size,0),i+=c.size),c.entries.length===0&&this.streams.delete(o)}this.lokiMetrics.retentionDeletions+=s,this.lokiMetrics.totalStorageSize=Math.max(0,this.lokiMetrics.totalStorageSize-i),this.lokiMetrics.activeStreams=this.streams.size}getStreams(){return Array.from(this.streams.values())}getLokiMetrics(){return{...this.lokiMetrics}}calculateLoad(){const t=this.lokiMetrics.ingestionRequestsTotal,e=this.lokiMetrics.ingestionErrorsTotal,n=this.lokiMetrics.ingestionLinesTotal,s=this.lokiMetrics.ingestionBytesTotal,i=this.lokiMetrics.queryRequestsTotal,o=this.lokiMetrics.queryErrorsTotal,c=this.lokiMetrics.queryDurationTotal,u=this.ingestionLatencyHistory.length>0?this.ingestionLatencyHistory.reduce((M,T)=>M+T,0)/this.ingestionLatencyHistory.length:0,h=this.queryLatencyHistory.length>0?this.queryLatencyHistory.reduce((M,T)=>M+T,0)/this.queryLatencyHistory.length:i>0?c/i:0,f=t>0?e/t:0,m=i>0?o/i:0,y=n>0?n/100:0,v=s>0?s/100:0,x=i>0?i/100:0,S=(this.config?.maxStreams||1e4)*100*1024*1024,R=Math.min(1,this.lokiMetrics.totalStorageSize/S);return{ingestionLinesPerSecond:y,ingestionBytesPerSecond:v,averageIngestionLatency:u,ingestionErrorRate:f,queriesPerSecond:x,averageQueryLatency:h,queryErrorRate:m,storageUtilization:R,streamCount:this.streams.size}}getStreamKey(t){return Object.keys(t).sort().map(n=>`${n}=${t[n]}`).join(",")}parseTimestamp(t){const e=BigInt(t);return Number(e/BigInt(1e6))}parseDuration(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 10080*60*1e3;const n=parseInt(e[1]);switch(e[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 10080*60*1e3}}getCompressionRatio(t){switch(t){case"gzip":return .3;case"snappy":return .5;case"lz4":return .4;default:return .3}}}class uT{config=null;traces=new Map;serviceStats=new Map;jaegerMetrics={spansReceivedTotal:0,spansDroppedTotal:0,spansProcessedTotal:0,samplingDecisionsTotal:0,samplingErrorsTotal:0,tracesStoredTotal:0,tracesDroppedTotal:0,storageSizeBytes:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,spansSentTotal:0,spansFailedTotal:0};samplingState={};queryHistory=[];MAX_QUERY_HISTORY=100;lastCleanupTime=0;CLEANUP_INTERVAL=6e4;initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||"http://jaeger:16686",agentEndpoint:e.agentEndpoint||"http://jaeger-agent:6831",collectorEndpoint:e.collectorEndpoint||"http://jaeger-collector:14268",queryEndpoint:e.queryEndpoint||"http://jaeger-query:16686",samplingType:e.samplingType||"probabilistic",samplingParam:e.samplingParam??.001,storageBackend:e.storageBackend||"elasticsearch",storageUrl:e.storageUrl||"http://elasticsearch:9200",enableUIGraphQL:e.enableUIGraphQL??!0,enableMetrics:e.enableMetrics??!0,metricsBackend:e.metricsBackend||"prometheus",metricsUrl:e.metricsUrl||"http://prometheus:9090",maxTraces:e.maxTraces||1e4,traceTTL:e.traceTTL||864e5},this.initializeSampling()}initializeSampling(){if(!this.config)return;const{samplingType:t,samplingParam:e}=this.config;switch(t){case"probabilistic":this.samplingState.probabilistic={probability:Math.max(0,Math.min(1,e||.001))};break;case"ratelimiting":this.samplingState.rateLimiting={maxTracesPerSecond:Math.max(1,e||10),bucket:{tokens:e||10,lastRefill:Date.now()}};break;case"peroperation":this.samplingState.perOperation=new Map;break}}receiveSpan(t){if(!this.config)return{sample:!1};this.jaegerMetrics.spansReceivedTotal++;const e=this.makeSamplingDecision(t);return this.jaegerMetrics.samplingDecisionsTotal++,e.sample?(this.processSpan(t),e):(this.jaegerMetrics.spansDroppedTotal++,e)}receiveSpansFromDataFlow(t){for(const e of t)this.receiveSpan(e)}makeSamplingDecision(t){if(!this.config)return{sample:!1};const{samplingType:e}=this.config;try{switch(e){case"probabilistic":return this.probabilisticSampling(t);case"ratelimiting":return this.rateLimitingSampling(t);case"peroperation":return this.perOperationSampling(t);default:return{sample:!0}}}catch{return this.jaegerMetrics.samplingErrorsTotal++,{sample:!1}}}probabilisticSampling(t){const e=this.samplingState.probabilistic;if(!e)return{sample:!0};const n=Math.random()<e.probability;return{sample:n,tags:n?[{key:"sampler.type",value:"probabilistic"},{key:"sampler.param",value:e.probability.toString()}]:void 0}}rateLimitingSampling(t){const e=this.samplingState.rateLimiting;if(!e)return{sample:!0};const n=Date.now(),s=n-e.bucket.lastRefill,i=1e3/e.maxTracesPerSecond,o=Math.floor(s/i);return o>0&&(e.bucket.tokens=Math.min(e.maxTracesPerSecond,e.bucket.tokens+o),e.bucket.lastRefill=n),e.bucket.tokens>0?(e.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"ratelimiting"},{key:"sampler.param",value:e.maxTracesPerSecond.toString()}]}):{sample:!1}}perOperationSampling(t){this.samplingState.perOperation||(this.samplingState.perOperation=new Map);const e=`${t.serviceName}:${t.operationName}`;let n=this.samplingState.perOperation.get(e);if(!n){const u=this.config?.samplingParam||10;n={maxTracesPerSecond:u,bucket:{tokens:u,lastRefill:Date.now()}},this.samplingState.perOperation.set(e,n)}const s=Date.now(),i=s-n.bucket.lastRefill,o=1e3/n.maxTracesPerSecond,c=Math.floor(i/o);return c>0&&(n.bucket.tokens=Math.min(n.maxTracesPerSecond,n.bucket.tokens+c),n.bucket.lastRefill=s),n.bucket.tokens>0?(n.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"peroperation"},{key:"sampler.param",value:n.maxTracesPerSecond.toString()}]}):{sample:!1}}processSpan(t){this.jaegerMetrics.spansProcessedTotal++;let e=this.traces.get(t.traceId);e||(e={traceId:t.traceId,spans:[],startTime:t.startTime,duration:t.duration,serviceCount:0,spanCount:0,hasErrors:!1},this.traces.set(t.traceId,e),this.jaegerMetrics.tracesStoredTotal++),e.spans.push(t),e.spanCount=e.spans.length,t.startTime<e.startTime&&(e.startTime=t.startTime);const n=Math.max(...e.spans.map(i=>i.startTime+i.duration));e.duration=n-e.startTime,!t.parentSpanId&&!e.rootService&&(e.rootService=t.serviceName,e.rootOperation=t.operationName),(t.tags.some(i=>i.key==="error"&&i.value===!0)||t.logs.some(i=>i.fields.some(o=>o.key==="error")))&&(e.hasErrors=!0),this.updateServiceStats(t,e),this.config&&this.traces.size>this.config.maxTraces&&this.evictOldestTraces()}updateServiceStats(t,e){let n=this.serviceStats.get(t.serviceName);n||(n={name:t.serviceName,tracesTotal:0,errorsTotal:0,avgDuration:0,spansTotal:0,lastTraceTime:0},this.serviceStats.set(t.serviceName,n)),n.spansTotal++,n.lastTraceTime=Math.max(n.lastTraceTime,t.startTime/1e3);const s=n.avgDuration*(n.spansTotal-1)+t.duration;n.avgDuration=s/n.spansTotal,(e.spans.length===1||e.spans[0].serviceName===t.serviceName)&&(n.tracesTotal++,e.hasErrors&&n.errorsTotal++)}evictOldestTraces(){if(!this.config)return;const t=Date.now()*1e3,e=this.config.traceTTL*1e3,n=this.config.maxTraces,s=[];for(const[i,o]of this.traces.entries())t-o.startTime>e&&s.push(i);if(this.traces.size-s.length>n){const o=Array.from(this.traces.entries()).filter(([c])=>!s.includes(c)).sort(([,c],[,u])=>c.startTime-u.startTime).slice(0,this.traces.size-s.length-n);s.push(...o.map(([c])=>c))}for(const i of s){const o=this.traces.get(i);if(o){for(const u of o.spans){const h=this.serviceStats.get(u.serviceName);h&&(h.tracesTotal=Math.max(0,h.tracesTotal-1),o.hasErrors&&(h.errorsTotal=Math.max(0,h.errorsTotal-1)))}const c=this.calculateTraceSize(o);this.jaegerMetrics.storageSizeBytes=Math.max(0,this.jaegerMetrics.storageSizeBytes-c),this.jaegerMetrics.tracesDroppedTotal++,this.traces.delete(i)}}}performCleanup(t){t-this.lastCleanupTime<this.CLEANUP_INTERVAL||(this.lastCleanupTime=t,this.evictOldestTraces())}queryTraces(t){const e=performance.now();this.jaegerMetrics.queryRequestsTotal++;try{let n=Array.from(this.traces.values());if(t.service&&(n=n.filter(c=>c.spans.some(u=>u.serviceName===t.service))),t.operation&&(n=n.filter(c=>c.spans.some(u=>u.operationName===t.operation))),t.tags&&(n=n.filter(c=>c.spans.some(u=>Object.entries(t.tags).every(([h,f])=>u.tags.some(m=>m.key===h&&String(m.value)===String(f)))))),t.startTime){const c=t.startTime*1e3;n=n.filter(u=>u.startTime>=c)}if(t.endTime){const c=t.endTime*1e3;n=n.filter(u=>u.startTime+u.duration<=c)}n.sort((c,u)=>u.startTime-c.startTime);const s=t.limit||20,i=n.length;n=n.slice(0,s);const o=performance.now()-e;return this.jaegerMetrics.queryDurationTotal+=o,this.queryHistory.push({params:t,timestamp:Date.now(),duration:o,resultsCount:n.length}),this.queryHistory.length>this.MAX_QUERY_HISTORY&&this.queryHistory.shift(),{traces:n,total:i,limit:s}}catch(n){return this.jaegerMetrics.queryErrorsTotal++,{traces:[],total:0,limit:t.limit||20,errors:[n instanceof Error?n.message:String(n)]}}}getServiceStats(){return Array.from(this.serviceStats.values())}getRecentTraces(t=20){const e=Array.from(this.traces.values());return e.sort((n,s)=>s.startTime-n.startTime),e.slice(0,t)}getTraceById(t){return this.traces.get(t)}getJaegerMetrics(){return{...this.jaegerMetrics}}calculateTraceSize(t){let e=0;for(const n of t.spans)e+=100,e+=n.operationName.length,e+=n.serviceName.length,e+=n.tags.length*50,e+=n.logs.length*100;return e}calculateLoad(){const t=this.jaegerMetrics.spansReceivedTotal,e=this.jaegerMetrics.tracesStoredTotal,n=this.jaegerMetrics.spansDroppedTotal,s=this.jaegerMetrics.queryRequestsTotal,i=this.jaegerMetrics.queryDurationTotal,o=this.jaegerMetrics.queryErrorsTotal,c=t>0?1-n/t:0,u=s>0?i/s:0,h=s>0?o/s:0,f=this.config?.maxTraces||1e4,m=this.traces.size/f,y=t/60,v=e/60;return{spansPerSecond:y,tracesPerSecond:v,samplingRate:c,storageUtilization:m,queryLatency:u,errorRate:h}}getConfig(){return this.config?{...this.config}:null}}class dT{config=null;receivers=new Map;processors=new Map;exporters=new Map;pipelines=new Map;metricsReceived=0;tracesReceived=0;logsReceived=0;metricsExported=0;tracesExported=0;logsExported=0;initializeConfig(t){const e=t.data.config||{};if(this.config={receivers:Array.isArray(e.receivers)?e.receivers:[],processors:Array.isArray(e.processors)?e.processors:[],exporters:Array.isArray(e.exporters)?e.exporters:[],pipelines:Array.isArray(e.pipelines)?e.pipelines:[]},this.receivers.clear(),this.config.receivers)for(const n of this.config.receivers)n.id&&this.receivers.set(n.id,n);if(this.processors.clear(),this.config.processors)for(const n of this.config.processors)n.id&&this.processors.set(n.id,n);if(this.exporters.clear(),this.config.exporters)for(const n of this.config.exporters)n.id&&this.exporters.set(n.id,n);if(this.pipelines.clear(),this.config.pipelines)for(const n of this.config.pipelines)n.id&&this.pipelines.set(n.id,n)}processMessage(t,e){const n=Date.now();try{const s=this.determineDataType(t,e),i=Array.from(this.pipelines.values()).filter(o=>o.type===s&&o.enabled!==!1);if(i.length===0)return{success:!0,latency:Date.now()-n};for(const o of i){if(o.receivers.map(m=>this.receivers.get(m)).filter(m=>m&&m.enabled).length===0)continue;let u=t.payload;const h=o.processors.map(m=>this.processors.get(m)).filter(m=>m&&m.enabled);for(const m of h)u=this.applyProcessor(m,u);const f=o.exporters.map(m=>this.exporters.get(m)).filter(m=>m&&m.enabled);for(const m of f)this.applyExporter(m,u,s);s==="metrics"?(this.metricsReceived++,this.metricsExported+=f.length):s==="traces"?(this.tracesReceived++,this.tracesExported+=f.length):s==="logs"&&(this.logsReceived++,this.logsExported+=f.length)}return{success:!0,latency:Date.now()-n}}catch(s){return{success:!1,latency:Date.now()-n,error:s instanceof Error?s.message:"Unknown error"}}}determineDataType(t,e){if(e){const n=e.type?.toLowerCase()||"";if(n.includes("prometheus")||n.includes("metric"))return"metrics";if(n.includes("jaeger")||n.includes("trace"))return"traces";if(n.includes("loki")||n.includes("log"))return"logs"}if(t.format){const n=t.format.toLowerCase();if(n.includes("prometheus")||n.includes("metric"))return"metrics";if(n.includes("jaeger")||n.includes("trace")||n.includes("zipkin"))return"traces";if(n.includes("log"))return"logs"}return"traces"}applyProcessor(t,e){switch(t.type){case"batch":return e;case"memory_limiter":return e;case"filter":return e;case"transform":return e;case"resource":return e;case"attributes":return e;default:return e}}applyExporter(t,e,n){t.type}getMetrics(){return{metricsReceived:this.metricsReceived,tracesReceived:this.tracesReceived,logsReceived:this.logsReceived,metricsExported:this.metricsExported,tracesExported:this.tracesExported,logsExported:this.logsExported,receiversCount:this.receivers.size,processorsCount:this.processors.size,exportersCount:this.exporters.size,pipelinesCount:this.pipelines.size}}resetMetrics(){this.metricsReceived=0,this.tracesReceived=0,this.logsReceived=0,this.metricsExported=0,this.tracesExported=0,this.logsExported=0}}class hT{config=null;incidents=new Map;incidentState=new Map;metrics={notificationsSent:0,escalationsTriggered:0,acknowledgements:0,totalAckLatency:0,totalAckCount:0,totalResolveLatency:0,totalResolveCount:0,apiRequests:0,webhookCalls:0,errors:0};initializeFromNode(t){const e=t.data.config||{},n=(e.services||[]).map(o=>({id:String(o.id??o.name??"service"),name:String(o.name??"service"),integrationKey:o.integrationKey,status:o.status??"active",escalationPolicy:o.escalationPolicy??e.escalationPolicy??"default-policy",autoResolve:o.autoResolve??e.enableAutoResolve??!0,resolveTimeout:o.resolveTimeout??e.resolveTimeout??300})),s=(e.escalationPolicies||[]).map(o=>({id:String(o.id??o.name??"policy"),name:String(o.name??"policy"),levels:Array.isArray(o.levels)?o.levels.map((c,u)=>({level:typeof c.level=="number"?c.level:u+1,timeout:typeof c.timeout=="number"?c.timeout:5,targets:Array.isArray(c.targets)?c.targets.map(h=>String(h)):[]})):[]})),i=(e.onCallUsers||[]).map(o=>({id:String(o.id??o.email??o.name??"user"),name:String(o.name??"On-Call User"),email:String(o.email??"user@example.com"),status:o.status==="off-call"?"off-call":"on-call"}));this.config={services:n,escalationPolicies:s,onCallUsers:i,severityMapping:e.severityMapping??"standard",enableAutoResolve:e.enableAutoResolve??!0,resolveTimeout:e.resolveTimeout??300}}processAlerts(t,e){if(!(!this.config||e.length===0))for(const n of e){const s=this.findServiceForAlert(n);if(!s||s.status==="disabled")continue;const i=this.mapSeverity(n),o=this.findExistingIncident(n,s);if(o)o.lastSignalAt=t,o.alertIds=Array.from(new Set([...o.alertIds||[],n.id])),this.incidents.set(o.id,o),this.metrics.apiRequests++;else{const c=`inc-${Date.now()}-${Math.floor(Math.random()*1e3)}`,u={id:c,title:n.title,serviceId:s.id,status:"triggered",severity:i,createdAt:t,lastSignalAt:t,alertIds:[n.id]};this.incidents.set(c,u),this.incidentState.set(c,{escalationLevelIndex:0,lastEscalationAt:t}),this.metrics.apiRequests++,this.triggerEscalation(t,u,s)}}}advanceTime(t){if(this.config)for(const[e,n]of this.incidents.entries()){if(n.status==="resolved")continue;const s=this.config.services.find(y=>y.id===n.serviceId);if(!s)continue;const i=s.autoResolve??this.config.enableAutoResolve,o=(s.resolveTimeout??this.config.resolveTimeout)*1e3;if(i&&n.status!=="resolved"&&n.lastSignalAt&&t-n.lastSignalAt>=o){this.resolveIncident(t,n),this.incidents.set(e,n);continue}const c=this.findEscalationPolicy(s);if(!c||c.levels.length===0)continue;const u=this.incidentState.get(e);if(!u)continue;const h=c.levels[u.escalationLevelIndex];if(!h)continue;const f=h.timeout*60*1e3;n.status==="triggered"&&t-u.lastEscalationAt>=f&&u.escalationLevelIndex<c.levels.length-1&&(u.escalationLevelIndex+=1,u.lastEscalationAt=t,this.incidentState.set(e,u),this.triggerEscalation(t,n,s,u.escalationLevelIndex))}}acknowledgeIncident(t,e){const n=this.incidents.get(e);!n||n.status!=="triggered"||(n.status="acknowledged",n.acknowledgedAt=t,this.incidents.set(e,n),this.metrics.acknowledgements++,this.metrics.totalAckCount++,this.metrics.totalAckLatency+=t-n.createdAt)}resolveIncidentManually(t,e){const n=this.incidents.get(e);!n||n.status==="resolved"||(this.resolveIncident(t,n),this.incidents.set(e,n))}getIncidents(){return Array.from(this.incidents.values())}getMetrics(){const t=Array.from(this.incidents.values()),e=t.length,n=t.filter(S=>S.status!=="resolved").length,s=t.filter(S=>S.status==="resolved").length,i=this.metrics.totalAckCount>0?this.metrics.totalAckLatency/this.metrics.totalAckCount:0,o=this.metrics.totalResolveCount>0?this.metrics.totalResolveLatency/this.metrics.totalResolveCount:0,c=300,u=this.metrics.apiRequests/c,h=this.metrics.webhookCalls/c,f=u+h+n*.1+this.metrics.notificationsSent/c,m=Math.min(.95,.1+f/200),y=Math.min(.95,.2+e/1e3),v=this.metrics.apiRequests+this.metrics.webhookCalls+1,x=this.metrics.errors/v;return{incidentsTotal:e,incidentsActive:n,incidentsResolved:s,notificationsSent:this.metrics.notificationsSent,escalationsTriggered:this.metrics.escalationsTriggered,acknowledgements:this.metrics.acknowledgements,averageAckLatency:i,averageResolveLatency:o,apiRequestsPerSecond:u,webhooksPerSecond:h,errorRate:x,cpuUtilization:m,memoryUtilization:y}}calculateLoad(){const t=this.getMetrics(),e=t.apiRequestsPerSecond+t.webhooksPerSecond+t.incidentsActive/60+t.notificationsSent/300,s=100+(t.averageAckLatency||0)*.01+(t.averageResolveLatency||0)*.005,i=(t.cpuUtilization+t.memoryUtilization)/2;return{throughput:e,latency:s,errorRate:t.errorRate,utilization:i}}findServiceForAlert(t){if(this.config){if(t.nodeLabel){const e=t.nodeLabel.toLowerCase(),n=this.config.services.find(s=>s.name.toLowerCase()===e||e.includes(s.name.toLowerCase()));if(n)return n}if(t.nodeId){const e=this.config.services.find(n=>n.id===t.nodeId);if(e)return e}return this.config.services[0]}}mapSeverity(t){if(!this.config)return"warning";const e=t.type==="critical"?"critical":t.type==="warning"?"warning":"info";switch(this.config.severityMapping){case"error-focused":return e==="warning"?"error":e;case"warning-demoted":return e==="warning"?"info":e;default:return e}}findExistingIncident(t,e){for(const n of this.incidents.values())if(n.serviceId===e.id&&n.status!=="resolved"&&n.title===t.title)return n}findEscalationPolicy(t){if(this.config)return t.escalationPolicy?this.config.escalationPolicies.find(e=>e.id===t.escalationPolicy||e.name===t.escalationPolicy)??this.config.escalationPolicies[0]:this.config.escalationPolicies[0]}resolveIncident(t,e){e.status!=="resolved"&&(e.status="resolved",e.resolvedAt=t,this.metrics.totalResolveCount++,this.metrics.totalResolveLatency+=t-e.createdAt)}triggerEscalation(t,e,n,s=0){if(!this.config)return;const i=this.findEscalationPolicy(n);if(!i)return;const o=i.levels[s];if(!o)return;const c=this.config.onCallUsers.filter(f=>f.status==="on-call"&&o.targets.includes(f.id)),u=c.length>0?c:this.config.onCallUsers,h=Math.max(1,u.length);this.metrics.notificationsSent+=h,this.metrics.escalationsTriggered++,this.metrics.webhookCalls+=1}}class fT{alerts=new Map;alertCallbacks=[];isAnalyzing=!1;onAlert(t){this.alertCallbacks.push(t)}analyze(t,e,n,s){if(this.isAnalyzing)return[];this.isAnalyzing=!0;const i=[];try{for(const o of t){const c=e.get(o.id),u=s.find(h=>h.nodeId===o.id);if(!(!c||!u)){if(u.health==="down"){const h=`down-${o.id}`;if(!this.alerts.has(h)){const f={id:h,type:"critical",title:"Component Down",message:`${o.data.label} is down and not responding`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:1};this.addAlert(f),i.push(f)}}if(c.errorRate>.1){const h=`error-${o.id}`,f=this.alerts.get(h);if(!f||f.acknowledged){const m={id:h,type:"critical",title:"High Error Rate",message:`${o.data.label} has ${(c.errorRate*100).toFixed(1)}% error rate`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.9};this.addAlert(m),i.push(m)}}if(c.latency>2e3){const h=`latency-${o.id}`,f=this.alerts.get(h);if(!f||f.acknowledged){const m={id:h,type:"warning",title:"High Latency",message:`${o.data.label} has latency of ${c.latency.toFixed(0)}ms`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.7};this.addAlert(m),i.push(m)}}if(c.utilization>.9){const h=`utilization-${o.id}`,f=this.alerts.get(h);if(!f||f.acknowledged){const m={id:h,type:"warning",title:"High Utilization",message:`${o.data.label} is at ${(c.utilization*100).toFixed(0)}% capacity`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.6};this.addAlert(m),i.push(m)}}}}for(const[o,c]of n.entries())if(c.bottleneck){const u=`bottleneck-${o}`,h=this.alerts.get(u);if(!h||h.acknowledged){const f={id:u,type:"critical",title:"Connection Bottleneck",message:"Bottleneck detected in connection",timestamp:Date.now(),acknowledged:!1,severity:.85};this.addAlert(f),i.push(f)}}this.cleanupResolvedAlerts(t,e,n,s)}finally{this.isAnalyzing=!1}return i}addAlert(t){this.alerts.set(t.id,t),this.alertCallbacks.forEach(e=>e(t))}cleanupResolvedAlerts(t,e,n,s){new Set(t.map(i=>i.id)),new Set(n.keys());for(const[i,o]of this.alerts.entries()){if(o.acknowledged)continue;let c=!1;if(o.nodeId)if(!t.find(h=>h.id===o.nodeId))c=!0;else{const h=e.get(o.nodeId),f=s.find(m=>m.nodeId===o.nodeId);(i.startsWith("down-")&&f&&f.health!=="down"||i.startsWith("error-")&&h&&h.errorRate<=.1||i.startsWith("latency-")&&h&&h.latency<=2e3||i.startsWith("utilization-")&&h&&h.utilization<=.9)&&(c=!0)}else if(i.startsWith("bottleneck-")){const u=i.replace("bottleneck-",""),h=n.get(u);(!h||!h.bottleneck)&&(c=!0)}c&&this.alerts.delete(i)}}acknowledge(t){const e=this.alerts.get(t);e&&(e.acknowledged=!0,this.alerts.set(t,e))}getAlerts(){return Array.from(this.alerts.values()).filter(t=>!t.acknowledged).sort((t,e)=>e.severity-t.severity)}getAlertsByType(t){return this.getAlerts().filter(e=>e.type===t)}clear(){this.alerts.clear()}}const ha=new fT;class pT{config=null;metrics={loginRequestsTotal:0,loginErrorsTotal:0,tokenRefreshTotal:0,introspectionRequestsTotal:0,userInfoRequestsTotal:0,sessionsCreatedTotal:0,sessionsExpiredTotal:0,activeSessions:0};sessions=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(t){const e=t.data.config||{},n=Array.isArray(e.clients)?e.clients.map(i=>({id:String(i.id??i.clientId??"client"),name:String(i.name??i.id??"Client"),type:i.type??"public",enabled:i.enabled??!0,protocol:i.protocol??"openid-connect"})):[{id:"archiphoenix-app",name:"ArchiPhoenix App",type:"public",enabled:!0,protocol:"openid-connect"}],s=Array.isArray(e.users)?e.users.map(i=>({id:String(i.id??i.username??"user"),username:String(i.username??`user-${i.id??"1"}`),email:i.email?String(i.email):void 0,enabled:i.enabled??!0,roles:Array.isArray(i.roles)?i.roles.map(o=>String(o)):[]})):[{id:"1",username:"admin",email:"admin@archiphoenix.com",enabled:!0,roles:["admin","user"]}];this.config={realm:String(e.realm||"archiphoenix"),adminUrl:String(e.adminUrl||"http://keycloak:8080"),enableSSL:e.enableSSL??!1,sslRequired:e.sslRequired||"external",accessTokenLifespan:Number(e.accessTokenLifespan||300),ssoSessionIdle:Number(e.ssoSessionIdle||1800),ssoSessionMax:Number(e.ssoSessionMax||36e3),enableOAuth2:e.enableOAuth2??!0,enableSAML:e.enableSAML??!1,enableLDAP:e.enableLDAP??!1,passwordPolicy:String(e.passwordPolicy||"length(8)"),clients:n,users:s}}processAuthRequest(t,e){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredSessions(n);const s=this.config;if(!s)return this.recordLatency(50),this.metrics.loginErrorsTotal++,{success:!1,latency:50,error:"Keycloak not configured"};const i=e.clientId||this.inferDefaultClientId(),o=s.clients.find(m=>m.id===i&&m.enabled);let c=t==="login"?80:t==="refresh"?40:t==="introspect"?60:40;t==="login"&&(c+=this.estimatePasswordPolicyCost(s.passwordPolicy)),s.enableLDAP&&(c*=1.3);const u=(Math.random()-.5)*20,h=Math.max(10,c+u);if(this.recordLatency(h),!o)return this.metrics.loginErrorsTotal++,this.bumpCounter(t),{success:!1,latency:h,error:`Client ${i} not found or disabled`,clientId:i,realm:s.realm};let f;if(t==="login"||t==="userinfo"){const m=e.username||e.subject;if(m&&(f=s.users.find(y=>y.username===m)),!f||!f.enabled)return this.metrics.loginErrorsTotal++,this.bumpCounter(t),{success:!1,latency:h,error:`User ${m||"unknown"} not found or disabled`,clientId:i,realm:s.realm}}switch(t){case"login":return this.metrics.loginRequestsTotal++,this.createOrUpdateSession(n,s,i,f),{success:!0,latency:h,tokenType:"access",expiresIn:s.accessTokenLifespan,subject:f.username,clientId:i,realm:s.realm};case"refresh":return this.metrics.tokenRefreshTotal++,e.subject&&this.touchUserSessions(n,e.subject),{success:!0,latency:h,tokenType:"access",expiresIn:s.accessTokenLifespan,subject:e.subject,clientId:i,realm:s.realm};case"introspect":return this.metrics.introspectionRequestsTotal++,{success:!0,latency:h,tokenType:"access",expiresIn:s.accessTokenLifespan,subject:e.subject,clientId:i,realm:s.realm};case"userinfo":return this.metrics.userInfoRequestsTotal++,{success:!0,latency:h,tokenType:"id",expiresIn:s.accessTokenLifespan,subject:f?.username??e.subject,clientId:i,realm:s.realm}}}calculateLoad(){const t=this.metrics,e=t.loginRequestsTotal+t.tokenRefreshTotal+t.introspectionRequestsTotal+t.userInfoRequestsTotal,n=e>0?Math.min(1,t.loginErrorsTotal/e):0,s=this.latencyHistory.length>0?this.latencyHistory.reduce((c,u)=>c+u,0)/this.latencyHistory.length:0;let i=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const c=(this.lastRequestTime-this.firstRequestTime)/1e3;i=e/Math.max(c,1)}const o=t.loginRequestsTotal>0?1-t.loginErrorsTotal/t.loginRequestsTotal:1;return{requestsPerSecond:i,averageLatency:s,errorRate:n,activeSessions:this.metrics.activeSessions,authSuccessRate:o}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}inferDefaultClientId(){return this.config?.clients.length?(this.config.clients.filter(e=>e.enabled)[0]||this.config.clients[0]).id:"default-client"}estimatePasswordPolicyCost(t){if(!t)return 0;let e=0;const n=t.toLowerCase();n.includes("length(")&&(e+=10),n.includes("digits(")&&(e+=15),n.includes("special(")&&(e+=20),n.includes("uppercase(")&&(e+=10),n.includes("lowercase(")&&(e+=5);const s=(t.match(/\)/g)||[]).length;return e+=s*5,e}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}bumpCounter(t){switch(t){case"login":this.metrics.loginRequestsTotal++;break;case"refresh":this.metrics.tokenRefreshTotal++;break;case"introspect":this.metrics.introspectionRequestsTotal++;break;case"userinfo":this.metrics.userInfoRequestsTotal++;break}}createOrUpdateSession(t,e,n,s){for(const h of this.sessions.values())if(h.userId===s.id&&h.clientId===n)return h.lastAccess=t,h.sessionId;const i=`sess-${t}-${Math.random().toString(36).slice(2,8)}`,o=e.ssoSessionIdle*1e3,c=e.ssoSessionMax*1e3,u={sessionId:i,userId:s.id,clientId:n,realm:e.realm,createdAt:t,lastAccess:t,idleTimeoutMs:o,maxLifespanMs:c};return this.sessions.set(i,u),this.metrics.sessionsCreatedTotal++,this.metrics.activeSessions=this.sessions.size,i}touchUserSessions(t,e){if(!this.config)return;const n=this.config.users.find(s=>s.username===e);if(n)for(const s of this.sessions.values())s.userId===n.id&&(s.lastAccess=t)}cleanupExpiredSessions(t){let e=0;for(const[n,s]of this.sessions.entries()){const i=t-s.lastAccess>s.idleTimeoutMs,o=t-s.createdAt>s.maxLifespanMs;(i||o)&&(this.sessions.delete(n),e++)}e>0&&(this.metrics.sessionsExpiredTotal+=e,this.metrics.activeSessions=this.sessions.size)}}class gT{config=null;rules=new Map;threats=[];stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0};rateLimitTracker=new Map;RATE_LIMIT_WINDOW_MS=6e4;ddosTracker=new Map;DDOS_WINDOW_MS=1e3;MAX_THREATS=1e3;initializeConfig(t){const e=t.data.config||{};if(this.config={mode:e.mode||"detection",enableOWASP:e.enableOWASP??!0,owaspRuleset:e.owaspRuleset||"3.3",enableRateLimiting:e.enableRateLimiting??!0,rateLimitPerMinute:e.rateLimitPerMinute||100,enableGeoBlocking:e.enableGeoBlocking??!1,blockedCountries:Array.isArray(e.blockedCountries)?e.blockedCountries:[],enableIPWhitelist:e.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(e.whitelistedIPs)?e.whitelistedIPs:[],enableDDoSProtection:e.enableDDoSProtection??!0,ddosThreshold:e.ddosThreshold||1e3,rules:Array.isArray(e.rules)?e.rules:[]},this.rules.clear(),this.config.rules)for(const n of this.config.rules)n.id&&this.rules.set(n.id,n);this.stats.activeRules=Array.from(this.rules.values()).filter(n=>n.enabled).length}processRequest(t){const e=performance.now(),n=t.timestamp||Date.now(),s=t.sourceIP||"0.0.0.0";if(this.stats.totalRequests++,this.config?.enableIPWhitelist&&this.config.whitelistedIPs?.includes(s))return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e};if(this.config?.enableGeoBlocking&&t.country&&this.config.blockedCountries?.includes(t.country)){const o={id:`threat-${Date.now()}-${Math.random()}`,type:"geo-block",sourceIP:s,target:t.path,timestamp:n,severity:"medium",blocked:!0,details:{country:t.country}};if(this.addThreat(o),this.stats.geoBlockHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:o}}if(this.config?.enableDDoSProtection){const o=this.checkDDoS(s,n);if(o.blocked){const c={id:`threat-${Date.now()}-${Math.random()}`,type:"ddos",sourceIP:s,target:t.path,timestamp:n,severity:"critical",blocked:!0,details:{requestCount:o.count}};if(this.addThreat(c),this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:c}}}if(this.config?.enableRateLimiting){const o=this.checkRateLimit(s,n);if(o.blocked){const c={id:`threat-${Date.now()}-${Math.random()}`,type:"rate-limit",sourceIP:s,target:t.path,timestamp:n,severity:"medium",blocked:!0,details:{requestCount:o.count}};if(this.addThreat(c),this.stats.rateLimitHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:c}}}if(this.config?.enableOWASP){const o=this.checkOWASPRules(t);if(o.detected){const c={id:`threat-${Date.now()}-${Math.random()}`,type:o.threatType||"custom",sourceIP:s,target:t.path,timestamp:n,severity:o.severity||"high",blocked:!0,details:o.details};if(this.addThreat(c),this.stats.owaspHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:c}}}const i=Array.from(this.rules.values()).filter(o=>o.enabled).sort((o,c)=>o.priority-c.priority);for(const o of i){const c=this.matchRule(o,t);if(c.matched){const u={id:`threat-${Date.now()}-${Math.random()}`,type:"custom",sourceIP:s,target:t.path,timestamp:n,severity:c.severity||"medium",blocked:o.action==="block",ruleId:o.id,ruleName:o.name,details:c.details};if(this.addThreat(u),this.stats.threatsDetected++,o.action==="block"&&this.config?.mode==="prevention")return this.stats.blockedRequests++,{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:u,matchedRule:o};if(o.action==="log")continue;if(o.action==="challenge")return{allowed:!1,blocked:!1,action:"challenge",latency:performance.now()-e,threatDetected:u,matchedRule:o}}}return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e}}matchRule(t,e){if(!t.conditions||t.conditions.length===0)return{matched:!1};for(const n of t.conditions){let s,i=!1;switch(n.type){case"ip":s=e.sourceIP;break;case"uri":s=e.path;break;case"method":s=e.method;break;case"header":s=e.headers?.[n.value]||"";break;case"body":s=typeof e.body=="string"?e.body:JSON.stringify(e.body||"");break;case"country":s=e.country;break;case"user-agent":s=e.userAgent;break}if(s===void 0)return{matched:!1};switch(n.operator){case"equals":i=s===n.value;break;case"contains":i=s.toLowerCase().includes(n.value.toLowerCase());break;case"startsWith":i=s.toLowerCase().startsWith(n.value.toLowerCase());break;case"endsWith":i=s.toLowerCase().endsWith(n.value.toLowerCase());break;case"regex":try{i=new RegExp(n.value,"i").test(s)}catch{i=!1}break;case"in":i=n.value.split(",").map(u=>u.trim()).includes(s);break;case"not-in":i=!n.value.split(",").map(u=>u.trim()).includes(s);break}if(!i)return{matched:!1}}return{matched:!0,severity:"medium",details:{matchedConditions:t.conditions.length}}}checkOWASPRules(t){const e=typeof t.body=="string"?t.body:JSON.stringify(t.body||""),n=t.path||"",s=JSON.stringify(t.query||""),i=`${e} ${n} ${s}`.toLowerCase(),o=[/(\bunion\b.*\bselect\b)/i,/(\bselect\b.*\bfrom\b)/i,/(\bdrop\b.*\btable\b)/i,/(\binsert\b.*\binto\b)/i,/(\bdelete\b.*\bfrom\b)/i,/('.*--)/,/(\bor\b.*=.*)/i,/(\band\b.*=.*)/i];for(const f of o)if(f.test(i))return{detected:!0,threatType:"sql-injection",severity:"critical",details:{pattern:f.toString()}};const c=[/<script[^>]*>/i,/javascript:/i,/on\w+\s*=/i,/<iframe[^>]*>/i,/eval\s*\(/i,/expression\s*\(/i];for(const f of c)if(f.test(i))return{detected:!0,threatType:"xss",severity:"high",details:{pattern:f.toString()}};const u=[/\.\.\//,/\.\.\\/,/\.\.%2f/i,/\.\.%5c/i];for(const f of u)if(f.test(i))return{detected:!0,threatType:"path-traversal",severity:"high",details:{pattern:f.toString()}};const h=[/\$\{[^}]*\}/,/\$\([^)]*\)/,/`[^`]*`/,/\|\s*\w+.*\s*\|/];for(const f of h)if(f.test(i))return{detected:!0,threatType:"rce",severity:"critical",details:{pattern:f.toString()}};return{detected:!1}}checkRateLimit(t,e){if(!this.config?.enableRateLimiting||!this.config.rateLimitPerMinute)return{blocked:!1,count:0};const n=e-this.RATE_LIMIT_WINDOW_MS,s=this.rateLimitTracker.get(t)||[],i=s.filter(o=>o>n);return i.length>=this.config.rateLimitPerMinute?{blocked:!0,count:i.length}:(i.push(e),this.rateLimitTracker.set(t,i),s.length>this.config.rateLimitPerMinute*2&&this.rateLimitTracker.set(t,i),{blocked:!1,count:i.length})}checkDDoS(t,e){if(!this.config?.enableDDoSProtection||!this.config.ddosThreshold)return{blocked:!1,count:0};const n=this.ddosTracker.get(t),s=e-this.DDOS_WINDOW_MS;return!n||n.windowStart<s?(this.ddosTracker.set(t,{count:1,windowStart:e}),{blocked:!1,count:1}):(n.count++,this.ddosTracker.set(t,n),n.count>=this.config.ddosThreshold?{blocked:!0,count:n.count}:{blocked:!1,count:n.count})}addThreat(t){this.threats.push(t),this.threats.length>this.MAX_THREATS&&this.threats.shift()}getThreats(t=100){return this.threats.slice(-t).reverse()}getStats(){return{...this.stats}}resetStats(){this.stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:this.stats.activeRules,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0},this.threats=[],this.rateLimitTracker.clear(),this.ddosTracker.clear()}}class mT{config=null;routingEngine;metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:0,averageLatency:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new gT}initializeConfig(t){const e=t.data.config||{};this.config={mode:e.mode||"detection",enableOWASP:e.enableOWASP??!0,owaspRuleset:e.owaspRuleset||"3.3",enableRateLimiting:e.enableRateLimiting??!0,rateLimitPerMinute:e.rateLimitPerMinute||100,enableGeoBlocking:e.enableGeoBlocking??!1,blockedCountries:Array.isArray(e.blockedCountries)?e.blockedCountries:[],enableIPWhitelist:e.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(e.whitelistedIPs)?e.whitelistedIPs:[],enableDDoSProtection:e.enableDDoSProtection??!0,ddosThreshold:e.ddosThreshold||1e3,rules:Array.isArray(e.rules)?e.rules:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),n={path:t.path||"/",method:t.method||"GET",headers:t.headers,query:t.query,body:t.body,sourceIP:t.sourceIP||this.generateRandomIP(),country:t.country||this.generateRandomCountry(),userAgent:t.userAgent||"Mozilla/5.0",timestamp:Date.now()},s=this.routingEngine.processRequest(n),i=performance.now()-e+s.latency;if(this.recordLatency(i),this.metrics.requestsTotal++,s.allowed?this.metrics.requestsAllowed++:(this.metrics.requestsBlocked++,s.blocked&&this.metrics.threatsBlocked++),s.threatDetected){this.metrics.threatsDetected++;const c=this.routingEngine.getStats();this.metrics.rateLimitHits=c.rateLimitHits,this.metrics.geoBlockHits=c.geoBlockHits,this.metrics.ipBlockHits=c.ipBlockHits,this.metrics.owaspHits=c.owaspHits,this.metrics.customRuleHits=c.threatsDetected-c.owaspHits-c.rateLimitHits-c.geoBlockHits-c.ipBlockHits}const o=Date.now();return this.firstRequestTime||(this.firstRequestTime=o),this.lastRequestTime=o,{success:s.allowed,blocked:s.blocked,latency:i,threatDetected:!!s.threatDetected,error:s.error}}simulateRequests(t){const e=Date.now(),n=e-this.lastSimulationTime;if(this.lastSimulationTime=e,n<=0||t<=0)return;const s=Math.floor(t*n/1e3);if(s!==0){for(let i=0;i<s;i++){const o=this.generateRandomRequest();this.processRequest(o)}this.updateMetricsFromStats()}}generateRandomRequest(){const t=["GET","POST","PUT","DELETE","PATCH"],e=["/api/users","/api/products","/api/orders","/api/auth","/api/data"],n=["US","GB","DE","FR","CN","RU","JP"],s=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"],i=Math.random()<.05;let o=e[Math.floor(Math.random()*e.length)],c=null;return i?Math.random()<.5?(o+="?id=1' OR '1'='1",c={query:"SELECT * FROM users WHERE id = '1' OR '1'='1'"}):c={content:'<script>alert("XSS")<\/script>'}:Math.random()<.3&&(c={data:Math.random().toString(36).substring(7)}),{path:o,method:t[Math.floor(Math.random()*t.length)],headers:{"Content-Type":"application/json","User-Agent":s[Math.floor(Math.random()*s.length)]},body:c,sourceIP:this.generateRandomIP(),country:n[Math.floor(Math.random()*n.length)],userAgent:s[Math.floor(Math.random()*s.length)]}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomCountry(){const t=["US","GB","DE","FR","CN","RU","JP","BR","IN","AU"];return t[Math.floor(Math.random()*t.length)]}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((n,s)=>n+s,0);this.metrics.averageLatency=e/this.latencyHistory.length}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.requestsTotal=t.totalRequests,this.metrics.requestsAllowed=t.allowedRequests,this.metrics.requestsBlocked=t.blockedRequests,this.metrics.threatsDetected=t.threatsDetected,this.metrics.rateLimitHits=t.rateLimitHits,this.metrics.geoBlockHits=t.geoBlockHits,this.metrics.ipBlockHits=t.ipBlockHits,this.metrics.owaspHits=t.owaspHits,this.metrics.activeRules=t.activeRules,this.metrics.customRuleHits=t.threatsDetected-t.owaspHits-t.rateLimitHits-t.geoBlockHits-t.ipBlockHits}calculateLoad(){let t=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const o=(this.lastRequestTime-this.firstRequestTime)/1e3;o>0&&(t=this.metrics.requestsTotal/o)}t===0&&this.simulatedRequestRate>0&&(t=this.simulatedRequestRate);const e=this.metrics.averageLatency||5,n=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,s=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,i=this.metrics.requestsTotal>0?this.metrics.threatsDetected/this.metrics.requestsTotal:0;return{requestsPerSecond:t,averageLatency:e,errorRate:n,blockRate:s,threatDetectionRate:i}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getThreats(t=100){return this.routingEngine.getThreats(t)}getStats(){return this.routingEngine.getStats()}setSimulatedRequestRate(t){this.simulatedRequestRate=t}resetMetrics(){this.metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:this.metrics.activeRules,averageLatency:0},this.latencyHistory=[],this.firstRequestTime=null,this.lastRequestTime=null,this.routingEngine.resetStats()}}class yT{config=null;rules=new Map;logs=[];stats={totalPackets:0,allowedPackets:0,blockedPackets:0,rejectedPackets:0,activeRules:0,totalConnections:0,activeConnections:0};connections=new Map;MAX_CONNECTIONS=1e4;CONNECTION_TIMEOUT_MS=3e5;MAX_LOGS=1e4;initializeConfig(t){const e=t.data.config||{};if(this.config={enableFirewall:e.enableFirewall??!0,enableLogging:e.enableLogging??!0,enableIntrusionDetection:e.enableIntrusionDetection??!1,enableStatefulInspection:e.enableStatefulInspection??!0,defaultPolicy:e.defaultPolicy||"deny",logRetention:e.logRetention||30,rules:Array.isArray(e.rules)?e.rules:[]},this.rules.clear(),this.config.rules)for(const n of this.config.rules)n.id&&n.enabled&&this.rules.set(n.id,n);this.stats.activeRules=Array.from(this.rules.values()).filter(n=>n.enabled).length,this.cleanOldLogs()}processPacket(t){const e=performance.now(),n=t.timestamp||Date.now();if(!this.config?.enableFirewall)return{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e};if(this.stats.totalPackets++,this.config?.enableStatefulInspection){const c=this.getConnectionKey(t),u=this.connections.get(c);if(u){if(u.lastSeen=n,u.packets++,u.state="established",u.state==="established")return this.stats.allowedPackets++,this.logPacket(t,"allowed",void 0,"Established connection"),{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e}}else this.connections.size<this.MAX_CONNECTIONS&&(this.connections.set(c,{source:t.source,destination:t.destination,sourcePort:t.sourcePort||0,destinationPort:t.port||0,protocol:t.protocol,state:"new",firstSeen:n,lastSeen:n,packets:1}),this.stats.totalConnections++)}const s=Array.from(this.rules.values()).filter(c=>c.enabled).sort((c,u)=>u.priority-c.priority);for(const c of s){const u=this.matchRule(c,t);if(u.matched){if(c.hits=(c.hits||0)+1,this.config?.enableLogging&&this.logPacket(t,c.action==="allow"?"allowed":c.action==="deny"?"blocked":"rejected",c,u.reason),c.action==="allow"?this.stats.allowedPackets++:c.action==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,c.action==="allow"&&this.config?.enableStatefulInspection){const h=this.getConnectionKey(t),f=this.connections.get(h);f&&(f.state="established")}return{allowed:c.action==="allow",blocked:c.action==="deny"||c.action==="reject",action:c.action,latency:performance.now()-e,matchedRule:c}}}const i=this.config?.defaultPolicy||"deny",o=i==="allow"?"allowed":i==="deny"?"blocked":"rejected";return this.config?.enableLogging&&this.logPacket(t,o,void 0,`Default policy: ${i}`),i==="allow"?this.stats.allowedPackets++:i==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,{allowed:i==="allow",blocked:i==="deny"||i==="reject",action:i,latency:performance.now()-e}}matchRule(t,e){return t.protocol!=="all"&&t.protocol!==e.protocol?{matched:!1}:t.source&&!this.matchIP(e.source,t.source)?{matched:!1}:t.destination&&!this.matchIP(e.destination,t.destination)?{matched:!1}:(e.protocol==="tcp"||e.protocol==="udp")&&t.port!==void 0&&e.port!==t.port?{matched:!1}:(e.protocol==="tcp"||e.protocol==="udp")&&t.sourcePort!==void 0&&e.sourcePort!==t.sourcePort?{matched:!1}:{matched:!0,reason:`Matched rule: ${t.name}`}}matchIP(t,e){if(t===e)return!0;if(e.includes("/")){const[n,s]=e.split("/"),i=parseInt(s,10);if(isNaN(i)||i<0||i>32)return!1;const o=this.ipToNumber(t),c=this.ipToNumber(n),u=4294967295<<32-i>>>0;return(o&u)===(c&u)}return!1}ipToNumber(t){const e=t.split(".");return e.length!==4?0:(parseInt(e[0],10)<<24)+(parseInt(e[1],10)<<16)+(parseInt(e[2],10)<<8)+parseInt(e[3],10)}getConnectionKey(t){return`${t.source}:${t.sourcePort||0}-${t.destination}:${t.port||0}-${t.protocol}`}logPacket(t,e,n,s){if(!this.config?.enableLogging)return;const i={id:`log-${Date.now()}-${Math.random()}`,timestamp:t.timestamp||Date.now(),action:e,source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,ruleId:n?.id,ruleName:n?.name,reason:s||n?.name};this.logs.push(i),this.logs.length>this.MAX_LOGS&&this.logs.shift()}cleanOldLogs(){if(!this.config?.logRetention)return;const t=this.config.logRetention*24*60*60*1e3,e=Date.now()-t;this.logs=this.logs.filter(n=>n.timestamp>=e)}cleanupConnections(){const t=Date.now(),e=this.CONNECTION_TIMEOUT_MS;for(const[n,s]of this.connections.entries())t-s.lastSeen>e&&this.connections.delete(n);this.stats.activeConnections=this.connections.size}getStats(){return this.stats.activeConnections=this.connections.size,{...this.stats}}getLogs(t){const e=[...this.logs].reverse();return t?e.slice(0,t):e}getRules(){return Array.from(this.rules.values())}getConfig(){return this.config}}class vT{config=null;routingEngine;metrics={packetsTotal:0,packetsAllowed:0,packetsBlocked:0,packetsRejected:0,activeRules:0,totalConnections:0,activeConnections:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new yT}initializeConfig(t){const e=t.data.config||{};this.config={enableFirewall:e.enableFirewall??!0,enableLogging:e.enableLogging??!0,enableIntrusionDetection:e.enableIntrusionDetection??!1,enableStatefulInspection:e.enableStatefulInspection??!0,defaultPolicy:e.defaultPolicy||"deny",logRetention:e.logRetention||30,rules:Array.isArray(e.rules)?e.rules:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){const e=performance.now(),n={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,timestamp:Date.now()},s=this.routingEngine.processPacket(n),i=performance.now()-e;return this.recordLatency(i),this.updateMetricsFromStats(),{success:s.allowed,blocked:s.blocked,latency:i,error:s.blocked?s.matchedRule?.name||`Packet ${s.action}`:void 0}}simulatePackets(t){const e=Date.now(),n=e-this.lastSimulationTime;if(this.lastSimulationTime=e,n<=0||t<=0)return;const s=Math.floor(t*n/1e3);if(s!==0){for(let i=0;i<s;i++){const o=this.generateRandomPacket();this.processPacket(o)}this.updateMetricsFromStats()}}generateRandomPacket(){const t=["tcp","udp","icmp"],e=t[Math.floor(Math.random()*t.length)],n=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,s=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i=e==="icmp"?void 0:Math.floor(Math.random()*65535),o=e==="icmp"?void 0:Math.floor(Math.random()*65535);return{source:n,destination:s,protocol:e,port:i,sourcePort:o}}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}updateMetricsFromStats(){const t=this.routingEngine.getStats();if(this.routingEngine.getRules(),this.metrics.packetsTotal=t.totalPackets,this.metrics.packetsAllowed=t.allowedPackets,this.metrics.packetsBlocked=t.blockedPackets,this.metrics.packetsRejected=t.rejectedPackets,this.metrics.activeRules=t.activeRules,this.metrics.totalConnections=t.totalConnections,this.metrics.activeConnections=t.activeConnections,this.latencyHistory.length>0){const e=this.latencyHistory.reduce((n,s)=>n+s,0);this.metrics.averageLatency=e/this.latencyHistory.length}}setSimulatedPacketRate(t){this.simulatedPacketRate=t}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLogs(t){return this.routingEngine.getLogs(t)}getRules(){return this.routingEngine.getRules()}getConfig(){return this.config}calculateLoad(){let t=0;if(this.firstPacketTime&&this.lastPacketTime){const s=(this.lastPacketTime-this.firstPacketTime)/1e3;s>0&&(t=this.metrics.packetsTotal/s)}t===0&&this.simulatedPacketRate>0&&(t=this.simulatedPacketRate);const e=this.metrics.packetsTotal>0?this.metrics.packetsBlocked/this.metrics.packetsTotal:0,n=this.metrics.packetsTotal>0?this.metrics.packetsRejected/this.metrics.packetsTotal:0;return{packetsPerSecond:t,averageLatency:this.metrics.averageLatency,blockRate:e,rejectionRate:n}}cleanup(){this.routingEngine.cleanupConnections(),this.updateMetricsFromStats()}}class bT{config=null;signatures=new Map;alerts=[];stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0};blockedIPs=new Map;behavioralPatterns=new Map;MAX_BEHAVIORAL_PATTERNS=1e4;BEHAVIORAL_WINDOW_MS=3e5;MAX_ALERTS=1e4;initializeConfig(t){const e=t.data.config||{};if(this.config={mode:e.mode||"ids",enableSignatureDetection:e.enableSignatureDetection??!0,enableAnomalyDetection:e.enableAnomalyDetection??!0,enableBehavioralAnalysis:e.enableBehavioralAnalysis??!1,alertThreshold:e.alertThreshold||"medium",enableAutoBlock:e.enableAutoBlock??!1,blockDuration:e.blockDuration||3600,enableLogging:e.enableLogging??!0,logRetention:e.logRetention||30,signatures:Array.isArray(e.signatures)?e.signatures:[]},this.signatures.clear(),this.config.signatures)for(const n of this.config.signatures)n.id&&n.enabled&&this.signatures.set(n.id,n);if(Array.isArray(e.blockedIPs)){this.blockedIPs.clear();for(const n of e.blockedIPs)if(n.ip){const s=n.expiresAt?new Date(n.expiresAt).getTime():Date.now()+(this.config.blockDuration||3600)*1e3;this.blockedIPs.set(n.ip,{ip:n.ip,reason:n.reason||"Intrusion detected",blockedAt:n.blockedAt?new Date(n.blockedAt).getTime():Date.now(),expiresAt:s})}}this.stats.activeSignatures=Array.from(this.signatures.values()).filter(n=>n.enabled).length,this.stats.blockedIPs=this.blockedIPs.size,this.cleanExpiredBlocks()}processPacket(t){const e=performance.now();if(this.stats.totalPackets++,this.isIPBlocked(t.source))return this.stats.alertsBlocked++,{allowed:!1,blocked:!0,alertGenerated:!1,latency:performance.now()-e,error:`IP ${t.source} is blocked`};this.stats.packetsAnalyzed++;let n,s=!1;if(this.config?.enableSignatureDetection){const o=this.detectSignature(t);if(o&&(n=o,this.stats.signatureMatches++,this.stats.alertsGenerated++,o.signatureId)){const c=this.signatures.get(o.signatureId);c&&c.action==="block"&&this.config.mode==="ips"&&(s=!0)}}if(!n&&this.config?.enableAnomalyDetection){const o=this.detectAnomaly(t);o&&(n=o,this.stats.anomalyDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&o.anomalyScore&&o.anomalyScore>.8&&(s=!0))}if(!n&&this.config?.enableBehavioralAnalysis){const o=this.detectBehavioral(t);o&&(n=o,this.stats.behavioralDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&o.behavioralPattern==="suspicious"&&(s=!0))}s&&this.config?.mode==="ips"&&(this.blockIP(t.source,n?.description||"Intrusion detected",n?.signatureId),this.stats.alertsBlocked++,n=n?{...n,blocked:!0}:void 0),n&&this.shouldGenerateAlert(n.severity)&&this.addAlert(n);const i=performance.now()-e;return{allowed:!s,blocked:s,alertGenerated:!!n,latency:i,alert:n}}detectSignature(t){const e=Array.from(this.signatures.values()).filter(n=>n.enabled).sort((n,s)=>{const i={critical:4,high:3,medium:2,low:1};return i[s.severity]-i[n.severity]});for(const n of e)if(!(n.protocol&&n.protocol!=="all"&&n.protocol!==t.protocol)&&!(n.sourceIP&&!this.matchIP(t.source,n.sourceIP))&&!(n.destinationIP&&!this.matchIP(t.destination,n.destinationIP))&&!(n.port!==void 0&&t.port!==void 0&&n.port!==t.port)&&!(n.sourcePort!==void 0&&t.sourcePort!==void 0&&n.sourcePort!==t.sourcePort)){if(n.pattern&&t.payload)try{if(new RegExp(n.pattern,"i").test(t.payload))return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:n.severity,timestamp:t.timestamp||Date.now(),description:n.description||`Signature match: ${n.name}`,blocked:!1,signature:n.name,signatureId:n.id}}catch{}else if(!n.pattern)return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:n.severity,timestamp:t.timestamp||Date.now(),description:n.description||`Signature match: ${n.name}`,blocked:!1,signature:n.name,signatureId:n.id}}return null}detectAnomaly(t){let e=0;const n=[22,23,80,443,3306,5432,27017,6379,8080];if(t.port&&n.includes(t.port)&&(e+=.2),t.protocol==="icmp"&&(e+=.1),t.payload){const i=t.payload.length;(i>1e4||i<10)&&(e+=.3)}if(t.payload){const i=["SELECT","UNION","DROP","DELETE","INSERT","UPDATE","<script","eval(","base64"];for(const o of i)if(t.payload.toLowerCase().includes(o.toLowerCase())){e+=.4;break}}const s=this.getAnomalyThreshold();if(e>=s){const i=e>=.8?"critical":e>=.6?"high":"medium";return{id:`alert-${Date.now()}-${Math.random()}`,type:"anomaly",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:i,timestamp:t.timestamp||Date.now(),description:`Anomaly detected: unusual network activity (score: ${e.toFixed(2)})`,blocked:!1,anomalyScore:e}}return null}detectBehavioral(t){const e=`${t.source}-${t.destination}-${t.protocol}-${t.port||"any"}`,n=Date.now();let s=this.behavioralPatterns.get(e);s||(s={sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,requestCount:0,firstSeen:n,lastSeen:n,suspiciousScore:0},this.behavioralPatterns.set(e,s)),s.requestCount++,s.lastSeen=n,this.behavioralPatterns.size>this.MAX_BEHAVIORAL_PATTERNS&&this.cleanOldBehavioralPatterns();const i=(n-s.firstSeen)/1e3,o=i>0?s.requestCount/i:s.requestCount;return o>10&&(s.suspiciousScore=Math.min(1,o/100)),s.suspiciousScore>.7?{id:`alert-${Date.now()}-${Math.random()}`,type:"behavioral",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:s.suspiciousScore>.9?"critical":"high",timestamp:n,description:`Behavioral pattern detected: high request rate (${o.toFixed(2)} req/s)`,blocked:!1,behavioralPattern:"suspicious"}:null}isIPBlocked(t){return this.cleanExpiredBlocks(),this.blockedIPs.has(t)}blockIP(t,e,n){const s=Date.now()+(this.config?.blockDuration||3600)*1e3;this.blockedIPs.set(t,{ip:t,reason:e,blockedAt:Date.now(),expiresAt:s}),this.stats.blockedIPs=this.blockedIPs.size}cleanExpiredBlocks(){const t=Date.now();for(const[e,n]of this.blockedIPs.entries())n.expiresAt<t&&this.blockedIPs.delete(e);this.stats.blockedIPs=this.blockedIPs.size}cleanOldBehavioralPatterns(){const t=Date.now();for(const[e,n]of this.behavioralPatterns.entries())t-n.lastSeen>this.BEHAVIORAL_WINDOW_MS&&this.behavioralPatterns.delete(e)}shouldGenerateAlert(t){const e=this.config?.alertThreshold||"medium",n={critical:4,high:3,medium:2,low:1},s={critical:4,high:3,medium:2,low:1};return n[t]>=s[e]}getAnomalyThreshold(){const t=this.config?.alertThreshold||"medium";return{low:.9,medium:.7,high:.5,critical:.3}[t]}matchIP(t,e){if(t===e)return!0;if(e.includes("/")){const[n,s]=e.split("/"),i=parseInt(s,10);return t.startsWith(n.split(".").slice(0,Math.floor(i/8)).join("."))}return!1}addAlert(t){this.alerts.push(t),this.alerts.length>this.MAX_ALERTS&&this.alerts.shift()}getAlerts(t=100){return this.alerts.slice(-t).reverse()}getBlockedIPs(){return this.cleanExpiredBlocks(),Array.from(this.blockedIPs.values())}unblockIP(t){this.blockedIPs.delete(t),this.stats.blockedIPs=this.blockedIPs.size}getStats(){return{...this.stats}}getSignatures(){return Array.from(this.signatures.values())}resetStats(){this.stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.stats.activeSignatures,blockedIPs:this.blockedIPs.size}}}class xT{config=null;routingEngine;metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new bT}initializeConfig(t){const e=t.data.config||{};this.config={mode:e.mode||"ids",enableSignatureDetection:e.enableSignatureDetection??!0,enableAnomalyDetection:e.enableAnomalyDetection??!0,enableBehavioralAnalysis:e.enableBehavioralAnalysis??!1,alertThreshold:e.alertThreshold||"medium",enableAutoBlock:e.enableAutoBlock??!1,blockDuration:e.blockDuration||3600,enableLogging:e.enableLogging??!0,logRetention:e.logRetention||30,signatures:Array.isArray(e.signatures)?e.signatures:[],blockedIPs:Array.isArray(e.blockedIPs)?e.blockedIPs:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){const e=performance.now(),n={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,payload:t.payload,timestamp:Date.now()},s=this.routingEngine.processPacket(n),i=performance.now()-e+s.latency;this.recordLatency(i),this.metrics.packetsTotal++,s.alertGenerated&&this.metrics.alertsGenerated++,s.blocked&&this.metrics.alertsBlocked++;const o=Date.now();return this.firstPacketTime||(this.firstPacketTime=o),this.lastPacketTime=o,this.updateMetricsFromStats(),{success:s.allowed,blocked:s.blocked,latency:i,alertGenerated:s.alertGenerated,error:s.error}}simulatePackets(t){const e=Date.now(),n=e-this.lastSimulationTime;if(this.lastSimulationTime=e,n<=0||t<=0)return;const s=Math.floor(t*n/1e3);if(s!==0){for(let i=0;i<s;i++){const o=this.generateRandomPacket();this.processPacket(o)}this.updateMetricsFromStats()}}generateRandomPacket(){const t=["tcp","udp","icmp"],e=t[Math.floor(Math.random()*t.length)],n=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,s=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i=e==="icmp"?void 0:Math.floor(Math.random()*65535),o=e==="icmp"?void 0:Math.floor(Math.random()*65535),c=Math.random()<.05;let u;if(c){const h=["SELECT * FROM users WHERE id = 1 OR 1=1",'<script>alert("XSS")<\/script>',"DROP TABLE users","UNION SELECT password FROM users","../../../etc/passwd","eval(base64_decode("];u=h[Math.floor(Math.random()*h.length)]}else Math.random()<.3&&(u=`GET /api/data HTTP/1.1\r
Host: example.com\r
User-Agent: Mozilla/5.0`);return{source:n,destination:s,protocol:e,port:i,sourcePort:o,payload:u}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((n,s)=>n+s,0);this.metrics.averageLatency=e/this.latencyHistory.length}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.packetsTotal=t.totalPackets,this.metrics.packetsAnalyzed=t.packetsAnalyzed,this.metrics.alertsGenerated=t.alertsGenerated,this.metrics.alertsBlocked=t.alertsBlocked,this.metrics.signatureMatches=t.signatureMatches,this.metrics.anomalyDetections=t.anomalyDetections,this.metrics.behavioralDetections=t.behavioralDetections,this.metrics.activeSignatures=t.activeSignatures,this.metrics.blockedIPs=t.blockedIPs}calculateLoad(){let t=0;if(this.firstPacketTime&&this.lastPacketTime&&this.lastPacketTime>this.firstPacketTime){const o=(this.lastPacketTime-this.firstPacketTime)/1e3;o>0&&(t=this.metrics.packetsTotal/o)}t===0&&this.simulatedPacketRate>0&&(t=this.simulatedPacketRate);const e=this.metrics.averageLatency||5,n=this.config?.mode==="ips"&&this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,s=this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,i=this.metrics.packetsTotal>0?this.metrics.alertsGenerated/this.metrics.packetsTotal:0;return{packetsPerSecond:t,averageLatency:e,errorRate:n,blockRate:s,alertRate:i}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getAlerts(t=100){return this.routingEngine.getAlerts(t)}getStats(){return this.routingEngine.getStats()}getBlockedIPs(){return this.routingEngine.getBlockedIPs()}unblockIP(t){this.routingEngine.unblockIP(t),this.updateMetricsFromStats()}setSimulatedPacketRate(t){this.simulatedPacketRate=t}resetMetrics(){this.metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.metrics.activeSignatures,blockedIPs:this.metrics.blockedIPs,averageLatency:0},this.latencyHistory=[],this.firstPacketTime=null,this.lastPacketTime=null,this.routingEngine.resetStats()}}class wT{config=null;metrics={readRequestsTotal:0,writeRequestsTotal:0,deleteRequestsTotal:0,listRequestsTotal:0,authRequestsTotal:0,authErrorsTotal:0,tokenIssuedTotal:0,tokenRenewedTotal:0,tokenRevokedTotal:0,encryptionOperationsTotal:0,decryptionOperationsTotal:0,activeTokens:0,secretsTotal:0};tokens=new Map;secrets=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(t){const e=t.data.config||{},n=Array.isArray(e.secrets)?e.secrets.map(c=>({id:String(c.id??`secret-${Date.now()}`),path:String(c.path??"secret/default"),key:String(c.key??"key"),value:String(c.value??""),version:Number(c.version??1),created:c.created?String(c.created):new Date().toISOString(),updated:c.updated?String(c.updated):new Date().toISOString(),visible:c.visible??!1})):[],s=Array.isArray(e.engines)?e.engines.map(c=>({id:String(c.id??`engine-${Date.now()}`),name:String(c.name??"secret/"),type:c.type??"kv",enabled:c.enabled??!0,version:c.version?Number(c.version):void 0,description:c.description?String(c.description):void 0})):[{id:"1",name:"secret/",type:"kv",enabled:e.enableKV??!0,version:e.kvVersion==="1"?1:2,description:"Key-Value secrets"}],i=Array.isArray(e.policies)?e.policies.map(c=>({id:String(c.id??`policy-${Date.now()}`),name:String(c.name??"default"),rules:String(c.rules??'path "*" { capabilities = ["read"] }'),enabled:c.enabled??!0})):[{id:"1",name:"default",rules:'path "*" { capabilities = ["read", "list"] }',enabled:!0}],o=String(e.tokenTTL||"24h");this.parseTTL(o),this.config={vaultType:e.vaultType||"hashicorp",address:String(e.address||"http://vault:8200"),enableTLS:e.enableTLS??!1,enableTransit:e.enableTransit??!0,enableKV:e.enableKV??!0,kvVersion:String(e.kvVersion||"2"),enablePKI:e.enablePKI??!1,enableAuth:e.enableAuth??!0,authMethod:e.authMethod||"token",tokenTTL:o,secrets:n,engines:s,policies:i},this.secrets.clear(),n.forEach(c=>{this.secrets.set(c.id,c)}),this.metrics.secretsTotal=n.length,this.cleanupExpiredTokens(Date.now())}processReadRequest(t,e,n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.readRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(i.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.readRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=Array.from(this.secrets.values()).find(f=>f.path===t&&(!e||f.key===e)),c=15,u=(Math.random()-.5)*10,h=Math.max(5,c+u);return this.recordLatency(h),this.metrics.readRequestsTotal++,o?{success:!0,latency:h,data:{[o.key]:o.value,version:o.version}}:{success:!1,latency:h,error:`Secret not found at path: ${t}`}}processWriteRequest(t,e,n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const i=this.config;if(!i)return this.recordLatency(60),this.metrics.writeRequestsTotal++,{success:!1,latency:60,error:"Vault not configured"};if(i.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.writeRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};if(!i.enableKV)return this.recordLatency(20),this.metrics.writeRequestsTotal++,{success:!1,latency:20,error:"KV engine is not enabled"};const o=25,c=(Math.random()-.5)*15,u=Math.max(10,o+c);this.recordLatency(u),this.metrics.writeRequestsTotal++;const h=Array.from(this.secrets.values()).find(f=>f.path===t&&f.key===Object.keys(e)[0]);if(h)h.value=Object.values(e)[0],h.version=(h.version||1)+1,h.updated=new Date().toISOString(),this.secrets.set(h.id,h);else{const f={id:`secret-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,path:t,key:Object.keys(e)[0],value:Object.values(e)[0],version:1,created:new Date().toISOString(),updated:new Date().toISOString(),visible:!1};this.secrets.set(f.id,f),this.metrics.secretsTotal=this.secrets.size}return{success:!0,latency:u,data:{path:t,version:h?.version||1}}}processDeleteRequest(t,e){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const s=this.config;if(!s)return this.recordLatency(50),this.metrics.deleteRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(s.enableAuth&&e&&!this.validateToken(e,n))return this.recordLatency(30),this.metrics.deleteRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const i=20,o=(Math.random()-.5)*10,c=Math.max(8,i+o);this.recordLatency(c),this.metrics.deleteRequestsTotal++;const u=Array.from(this.secrets.values()).find(h=>h.path===t);return u?(this.secrets.delete(u.id),this.metrics.secretsTotal=this.secrets.size,{success:!0,latency:c}):{success:!1,latency:c,error:`Secret not found at path: ${t}`}}processAuthRequest(t,e){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const s=this.config;if(!s)return this.recordLatency(50),this.metrics.authRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!s.enableAuth)return this.recordLatency(20),this.metrics.authRequestsTotal++,{success:!1,latency:20,error:"Authentication is not enabled"};let i=40;t==="ldap"?i=80:t==="approle"?i=50:t==="aws"&&(i=60);const o=(Math.random()-.5)*20,c=Math.max(15,i+o);this.recordLatency(c),this.metrics.authRequestsTotal++;const u=this.parseTTL(s.tokenTTL),h=`vault-token-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,f={id:h,token:h,policies:s.policies.filter(m=>m.enabled).map(m=>m.name),ttl:u,renewable:!0,createdAt:n,expiresAt:n+u*1e3};return this.tokens.set(h,f),this.metrics.tokenIssuedTotal++,this.metrics.activeTokens=this.tokens.size,{success:!0,latency:c,token:h,policies:f.policies}}processEncryptRequest(t,e="default",n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.encryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!i.enableTransit)return this.recordLatency(20),this.metrics.encryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(i.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.encryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=t.length,c=30+Math.min(100,o/100),u=(Math.random()-.5)*15,h=Math.max(15,c+u);this.recordLatency(h),this.metrics.encryptionOperationsTotal++;const f=Buffer.from(t).toString("base64");return{success:!0,latency:h,data:{ciphertext:`vault:v1:${f}`,key:e}}}processDecryptRequest(t,e="default",n){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.decryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!i.enableTransit)return this.recordLatency(20),this.metrics.decryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(i.enableAuth&&n&&!this.validateToken(n,s))return this.recordLatency(30),this.metrics.decryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=25+Math.min(80,t.length/150),c=(Math.random()-.5)*12,u=Math.max(12,o+c);this.recordLatency(u),this.metrics.decryptionOperationsTotal++;const h=t.replace(/^vault:v1:/,"");let f;try{f=Buffer.from(h,"base64").toString("utf-8")}catch{return{success:!1,latency:u,error:"Invalid ciphertext format"}}return{success:!0,latency:u,data:{plaintext:f,key:e}}}calculateLoad(){const t=this.metrics,e=t.readRequestsTotal+t.writeRequestsTotal+t.deleteRequestsTotal+t.listRequestsTotal+t.authRequestsTotal+t.encryptionOperationsTotal+t.decryptionOperationsTotal,n=e>0?Math.min(1,t.authErrorsTotal/e):0,s=this.latencyHistory.length>0?this.latencyHistory.reduce((c,u)=>c+u,0)/this.latencyHistory.length:0;let i=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const c=(this.lastRequestTime-this.firstRequestTime)/1e3;i=e/Math.max(c,1)}const o=this.config?.engines.filter(c=>c.enabled).length||0;return{requestsPerSecond:i,averageLatency:s,errorRate:n,activeTokens:this.metrics.activeTokens,secretsCount:this.metrics.secretsTotal,enginesEnabled:o}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}getSecrets(){return Array.from(this.secrets.values())}getActiveTokens(){const t=Date.now();return this.cleanupExpiredTokens(t),Array.from(this.tokens.values())}parseTTL(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 86400;const n=parseInt(e[1],10);switch(e[2]){case"s":return n;case"m":return n*60;case"h":return n*3600;case"d":return n*86400;default:return 86400}}validateToken(t,e){const n=this.tokens.get(t);return n?e>n.expiresAt?(this.tokens.delete(t),this.metrics.activeTokens=this.tokens.size,!1):!0:!1}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}cleanupExpiredTokens(t){let e=0;for(const[n,s]of this.tokens.entries())t>s.expiresAt&&(this.tokens.delete(n),e++);e>0&&(this.metrics.tokenRevokedTotal+=e,this.metrics.activeTokens=this.tokens.size)}}class CT{config=null;connections=new Map;tunnels=new Map;stats={totalConnections:0,activeConnections:0,totalTunnels:0,activeTunnels:0,totalBytesIn:0,totalBytesOut:0,totalPacketsIn:0,totalPacketsOut:0,encryptionOperations:0,compressionOperations:0,failedConnections:0,averageLatency:0};latencyHistory=[];MAX_LATENCY_HISTORY=200;CONNECTION_TIMEOUT_MS=3e5;initializeConfig(t){const e=t.data.config||{};if(this.config={vpnProtocol:e.vpnProtocol||"openvpn",encryptionAlgorithm:e.encryptionAlgorithm||"aes-256",enableCompression:e.enableCompression??!0,enableKeepAlive:e.enableKeepAlive??!0,maxConnections:e.maxConnections||1e3,connectionTimeout:e.connectionTimeout||300,enableSSL:e.enableSSL??!0,sslPort:e.sslPort||443,enableIPSec:e.enableIPSec??!0,ipsecPort:e.ipsecPort||500,enableL2TP:e.enableL2TP??!1,enablePPTP:e.enablePPTP??!1,enableRadius:e.enableRadius??!1,radiusServer:e.radiusServer||"",enableMFA:e.enableMFA??!1,mfaProvider:e.mfaProvider||"totp",connections:Array.isArray(e.connections)?e.connections:[],tunnels:Array.isArray(e.tunnels)?e.tunnels:[]},this.connections.clear(),this.config.connections)for(const n of this.config.connections)n.id&&this.connections.set(n.id,{...n,bytesIn:n.bytesIn||0,bytesOut:n.bytesOut||0,packetsIn:n.packetsIn||0,packetsOut:n.packetsOut||0,protocol:n.protocol||this.config.vpnProtocol||"openvpn",encryptionAlgorithm:n.encryptionAlgorithm||this.config.encryptionAlgorithm,compressionEnabled:n.compressionEnabled??this.config.enableCompression,lastActivity:n.lastActivity||Date.now()});if(this.tunnels.clear(),this.config.tunnels)for(const n of this.config.tunnels)n.id&&this.tunnels.set(n.id,{...n,bytesIn:n.bytesIn||0,bytesOut:n.bytesOut||0,packetsIn:n.packetsIn||0,packetsOut:n.packetsOut||0,protocol:n.protocol||this.config.vpnProtocol||"openvpn",encryptionAlgorithm:n.encryptionAlgorithm||this.config.encryptionAlgorithm,compressionEnabled:n.compressionEnabled??this.config.enableCompression,keepAliveEnabled:n.keepAliveEnabled??this.config.enableKeepAlive,keepAliveInterval:n.keepAliveInterval||30,connections:n.connections||[],lastActivity:n.lastActivity||Date.now()});this.updateStats()}processPacket(t){performance.now();const e=t.timestamp||Date.now();let n,s;if(t.connectionId)n=this.connections.get(t.connectionId);else if(t.tunnelId)s=this.tunnels.get(t.tunnelId);else for(const f of this.connections.values())if(f.remoteIP===t.source&&f.status==="connected"){n=f;break}if(!n&&!s){const f=this.calculateEncryptionLatency(this.config?.encryptionAlgorithm||"aes-256");return this.recordLatency(f),{success:!1,encrypted:!1,latency:f,error:"No active VPN connection or tunnel found",bytesProcessed:0}}const i=!t.encrypted&&n?.status==="connected",o=!!(t.encrypted&&n?.status==="connected");let c=0,u=0;(i||o)&&(c+=this.calculateEncryptionLatency(n?.encryptionAlgorithm||s?.encryptionAlgorithm||this.config?.encryptionAlgorithm||"aes-256"),this.stats.encryptionOperations++),(n?.compressionEnabled||s?.compressionEnabled||this.config?.enableCompression)&&(c+=this.calculateCompressionLatency(),this.stats.compressionOperations++);const h=this.estimatePacketSize(t);return u=h,n&&(i||o?(n.bytesIn+=h,n.packetsIn++,this.stats.totalBytesIn+=h,this.stats.totalPacketsIn++):(n.bytesOut+=h,n.packetsOut++,this.stats.totalBytesOut+=h,this.stats.totalPacketsOut++),n.lastActivity=e),s&&(i||o?(s.bytesIn+=h,s.packetsIn++):(s.bytesOut+=h,s.packetsOut++),s.lastActivity=e),this.recordLatency(c),this.updateStats(),{success:!0,encrypted:!!(i||t.encrypted&&o),latency:c,connectionId:n?.id,tunnelId:s?.id,bytesProcessed:u}}createConnection(t){if(this.connections.size>=(this.config?.maxConnections||1e3))throw this.stats.failedConnections++,new Error("Maximum connections reached");this.connections.set(t.id,{...t,bytesIn:t.bytesIn||0,bytesOut:t.bytesOut||0,packetsIn:t.packetsIn||0,packetsOut:t.packetsOut||0,protocol:t.protocol||this.config?.vpnProtocol||"openvpn",encryptionAlgorithm:t.encryptionAlgorithm||this.config?.encryptionAlgorithm,compressionEnabled:t.compressionEnabled??this.config?.enableCompression??!0,lastActivity:t.lastActivity||Date.now()}),this.stats.totalConnections++,this.updateStats()}updateConnectionStatus(t,e){const n=this.connections.get(t);n&&(n.status=e,e==="connected"&&(n.connectedAt=n.connectedAt||Date.now()),this.updateStats())}removeConnection(t){this.connections.delete(t)&&this.updateStats()}createTunnel(t){this.tunnels.set(t.id,{...t,bytesIn:t.bytesIn||0,bytesOut:t.bytesOut||0,packetsIn:t.packetsIn||0,packetsOut:t.packetsOut||0,protocol:t.protocol||this.config?.vpnProtocol||"openvpn",encryptionAlgorithm:t.encryptionAlgorithm||this.config?.encryptionAlgorithm,compressionEnabled:t.compressionEnabled??this.config?.enableCompression,keepAliveEnabled:t.keepAliveEnabled??this.config?.enableKeepAlive,keepAliveInterval:t.keepAliveInterval||30,connections:t.connections||[],lastActivity:t.lastActivity||Date.now()}),this.stats.totalTunnels++,this.updateStats()}updateTunnelStatus(t,e){const n=this.tunnels.get(t);n&&(n.status=e,this.updateStats())}removeTunnel(t){this.tunnels.delete(t)&&this.updateStats()}getConnections(){return Array.from(this.connections.values())}getTunnels(){return Array.from(this.tunnels.values())}getStats(){return{...this.stats}}getConfig(){return this.config?{...this.config}:null}calculateEncryptionLatency(t){switch(t){case"aes-128":return .5+Math.random()*.5;case"aes-256":return .8+Math.random()*.7;case"chacha20-poly1305":return .6+Math.random()*.6;default:return 1+Math.random()*1}}calculateCompressionLatency(){return .2+Math.random()*.3}estimatePacketSize(t){if(t.payload){if(typeof t.payload=="string")return Buffer.byteLength(t.payload,"utf8");if(typeof t.payload=="object")return Buffer.byteLength(JSON.stringify(t.payload),"utf8")}return 1500}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((n,s)=>n+s,0);this.stats.averageLatency=e/this.latencyHistory.length}updateStats(){this.stats.activeConnections=Array.from(this.connections.values()).filter(i=>i.status==="connected").length,this.stats.activeTunnels=Array.from(this.tunnels.values()).filter(i=>i.status==="up").length;let t=0,e=0,n=0,s=0;for(const i of this.connections.values())t+=i.bytesIn,e+=i.bytesOut,n+=i.packetsIn,s+=i.packetsOut;for(const i of this.tunnels.values())t+=i.bytesIn,e+=i.bytesOut,n+=i.packetsIn,s+=i.packetsOut;this.stats.totalBytesIn=t,this.stats.totalBytesOut=e,this.stats.totalPacketsIn=n,this.stats.totalPacketsOut=s}cleanupStaleConnections(){const t=(this.config?.connectionTimeout||300)*1e3,e=Date.now();for(const[n,s]of this.connections.entries())s.status==="connected"&&s.lastActivity&&e-s.lastActivity>t&&(s.status="disconnected",this.updateStats())}}class ST{config=null;routingEngine;metrics={totalConnections:0,activeConnections:0,totalTunnels:0,activeTunnels:0,totalBytesIn:0,totalBytesOut:0,totalPacketsIn:0,totalPacketsOut:0,encryptionOperations:0,compressionOperations:0,failedConnections:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;packetCount=0;byteCount=0;connectionCount=0;lastConnectionTime=null;simulatedPacketRate=0;simulatedConnectionRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new CT}initializeConfig(t){const e=t.data.config||{};this.config={vpnProtocol:e.vpnProtocol||"openvpn",encryptionAlgorithm:e.encryptionAlgorithm||"aes-256",enableCompression:e.enableCompression??!0,enableKeepAlive:e.enableKeepAlive??!0,maxConnections:e.maxConnections||1e3,connectionTimeout:e.connectionTimeout||300,enableSSL:e.enableSSL??!0,sslPort:e.sslPort||443,enableIPSec:e.enableIPSec??!0,ipsecPort:e.ipsecPort||500,enableL2TP:e.enableL2TP??!1,enablePPTP:e.enablePPTP??!1,enableRadius:e.enableRadius??!1,radiusServer:e.radiusServer||"",enableMFA:e.enableMFA??!1,mfaProvider:e.mfaProvider||"totp",connections:Array.isArray(e.connections)?e.connections:[],tunnels:Array.isArray(e.tunnels)?e.tunnels:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){performance.now();const e={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,payload:t.payload,encrypted:t.encrypted,connectionId:t.connectionId,tunnelId:t.tunnelId,timestamp:Date.now()},n=this.routingEngine.processPacket(e),s=Date.now();return this.firstPacketTime||(this.firstPacketTime=s),this.lastPacketTime=s,this.packetCount++,this.byteCount+=n.bytesProcessed,this.updateMetricsFromStats(),{success:n.success,encrypted:n.encrypted,latency:n.latency,error:n.error,bytesProcessed:n.bytesProcessed}}createConnection(t){try{this.routingEngine.createConnection(t),this.connectionCount++,this.lastConnectionTime=Date.now(),this.updateMetricsFromStats()}catch(e){throw this.metrics.failedConnections++,e}}updateConnectionStatus(t,e){this.routingEngine.updateConnectionStatus(t,e),this.updateMetricsFromStats()}removeConnection(t){this.routingEngine.removeConnection(t),this.updateMetricsFromStats()}createTunnel(t){this.routingEngine.createTunnel(t),this.updateMetricsFromStats()}updateTunnelStatus(t,e){this.routingEngine.updateTunnelStatus(t,e),this.updateMetricsFromStats()}removeTunnel(t){this.routingEngine.removeTunnel(t),this.updateMetricsFromStats()}getConnections(){return this.routingEngine.getConnections()}getTunnels(){return this.routingEngine.getTunnels()}getConfig(){return this.config?{...this.config}:null}getMetrics(){return{...this.metrics}}getRoutingEngine(){return this.routingEngine}calculateLoad(){const t=Date.now(),e=1e3;let n=0,s=0,i=0;if(this.firstPacketTime&&this.lastPacketTime){const x=(this.lastPacketTime-this.firstPacketTime)/1e3;x>0&&(n=this.packetCount/x,s=this.byteCount/x)}if(this.lastConnectionTime){const x=(t-this.lastConnectionTime)/1e3;x>0&&x<e&&(i=this.connectionCount/x)}n===0&&(n=this.simulatedPacketRate),s===0&&(s=n*1500),i===0&&(i=this.simulatedConnectionRate);const o=this.config?.maxConnections||1e3,c=Math.min(1,this.metrics.activeConnections/o),u=this.metrics.activeTunnels>0?.3:0,h=Math.min(.5,s/(100*1024*1024)),f=Math.min(.2,this.metrics.encryptionOperations/1e4),m=Math.min(.95,.1+c*.4+u+h+f),y=this.metrics.totalConnections+this.metrics.failedConnections,v=y>0?this.metrics.failedConnections/y:0;return{connectionsPerSecond:i,packetsPerSecond:n,bytesPerSecond:s,averageLatency:this.metrics.averageLatency,errorRate:v,utilization:m}}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics={totalConnections:t.totalConnections,activeConnections:t.activeConnections,totalTunnels:t.totalTunnels,activeTunnels:t.activeTunnels,totalBytesIn:t.totalBytesIn,totalBytesOut:t.totalBytesOut,totalPacketsIn:t.totalPacketsIn,totalPacketsOut:t.totalPacketsOut,encryptionOperations:t.encryptionOperations,compressionOperations:t.compressionOperations,failedConnections:t.failedConnections,averageLatency:t.averageLatency}}simulateIncomingTraffic(t,e){this.simulatedPacketRate=t,this.simulatedConnectionRate=e,this.lastSimulationTime=Date.now()}cleanupStaleConnections(){this.routingEngine.cleanupStaleConnections(),this.updateMetricsFromStats()}}class MT{distributions=new Map;edgeLocations=new Map;cache=new Map;stats;requestHistory=[];MAX_CACHE_SIZE=1e3;MAX_HISTORY_SIZE=1e3;constructor(){this.stats={totalRequests:0,totalCacheHits:0,totalCacheMisses:0,totalBandwidth:0,totalErrors:0,averageLatency:0,averageCacheHitRate:0,requestsPerSecond:0,bandwidthPerSecond:0,errorRate:0,distributions:new Map,edgeLocations:new Map}}initializeConfig(t){const e=t.data.config||{},n=e.distributions||[];this.distributions.clear();for(const i of n)this.distributions.set(i.id,{id:i.id,domain:i.domain,origin:i.origin,status:i.status||"deployed",edgeLocations:i.edgeLocations||0,cachePolicy:i.cachePolicy||e.cachePolicy||"cache-first",defaultTTL:i.defaultTTL||e.defaultTTL||3600,maxTTL:i.maxTTL||e.maxTTL||86400,enableCompression:i.enableCompression??e.enableCompression??!0,compressionType:i.compressionType||e.compressionType||"gzip",enableHTTP2:i.enableHTTP2??e.enableHTTP2??!0,enableHTTP3:i.enableHTTP3??e.enableHTTP3??!1,enableHTTPS:i.enableHTTPS??e.enableHTTPS??!0,enableGeoRouting:i.enableGeoRouting??e.enableGeoRouting??!1,enableDDoSProtection:i.enableDDoSProtection??e.enableDDoSProtection??!0});const s=e.edgeLocations||[];this.edgeLocations.clear();for(const i of s)this.edgeLocations.set(i.id,{id:i.id,region:i.region,city:i.city,status:i.status||"active",capacity:i.capacity||1e4,latency:i.latency||50});for(const i of this.distributions.keys())this.stats.distributions.set(i,{requests:0,cacheHits:0,cacheMisses:0,bandwidth:0,errors:0});for(const i of this.edgeLocations.keys())this.stats.edgeLocations.set(i,{requests:0,cacheHits:0,bandwidth:0,latency:0})}processRequest(t){const e=Date.now();this.stats.totalRequests++;const n=Array.from(this.distributions.values()).find(f=>f.domain===t.domain&&f.status==="deployed");if(!n)return this.stats.totalErrors++,{status:404,headers:{},cacheHit:!1,servedFrom:"origin",latency:Date.now()-e,size:0};const s=this.stats.distributions.get(n.id);s&&s.requests++;const i=this.selectEdgeLocation(t,n);if(i){const f=this.stats.edgeLocations.get(i.id);f&&f.requests++}let o=!1,c;if(t.method==="GET"&&n.cachePolicy!=="bypass"){const f=this.getCacheKey(t,n);if(c=this.cache.get(f),c&&c.expiresAt>Date.now()){if(o=!0,this.stats.totalCacheHits++,c.hitCount++,c.lastAccessed=Date.now(),s&&s.cacheHits++,i){const m=this.stats.edgeLocations.get(i.id);m&&m.cacheHits++}}else this.stats.totalCacheMisses++,s&&s.cacheMisses++}let u=0;o&&c?u=i?.latency?i.latency*.1:5:(u=i?.latency?i.latency*2:100,u+=50+Math.random()*50);let h=c?.size||1024;if(n.enableCompression&&t.method==="GET"){const f=.3+Math.random()*.2;h=Math.floor(h*f)}if(this.stats.totalBandwidth+=h,s&&(s.bandwidth+=h),i){const f=this.stats.edgeLocations.get(i.id);f&&(f.bandwidth+=h)}if(!o&&t.method==="GET"&&n.cachePolicy!=="bypass"){const f=this.getCacheKey(t,n),m=n.defaultTTL||3600;this.cache.set(f,{key:f,data:{status:200,body:"cached"},headers:{"content-type":"application/json"},expiresAt:Date.now()+m*1e3,size:h,hitCount:0,lastAccessed:Date.now()}),this.cache.size>this.MAX_CACHE_SIZE&&this.evictCacheEntries()}return this.requestHistory.push({timestamp:Date.now(),size:h}),this.requestHistory.length>this.MAX_HISTORY_SIZE&&this.requestHistory.shift(),this.updateStats(),{status:200,headers:{"content-type":"application/json","cache-control":`max-age=${n.defaultTTL||3600}`,"x-cache":o?"HIT":"MISS","x-edge-location":i?.city||"unknown"},body:o?c?.data:{status:"ok"},cacheHit:o,servedFrom:o?"cache":"origin",edgeLocation:i?.city,latency:u,size:h}}selectEdgeLocation(t,e){const n=Array.from(this.edgeLocations.values()).filter(s=>s.status==="active");if(n.length!==0){if(e.enableGeoRouting&&t.clientIP){const s=this.hashString(t.clientIP);return n[s%n.length]}return n.reduce((s,i)=>(i.latency||50)<(s.latency||50)?i:s)}}getCacheKey(t,e){const n=t.query?"?"+Object.entries(t.query).sort().map(([s,i])=>`${s}=${i}`).join("&"):"";return`${e.id}:${t.method}:${t.path}${n}`}evictCacheEntries(){const t=Array.from(this.cache.entries());t.sort((n,s)=>n[1].lastAccessed-s[1].lastAccessed);const e=Math.floor(t.length*.1);for(let n=0;n<e;n++)this.cache.delete(t[n][0])}updateStats(){const t=this.stats.totalCacheHits+this.stats.totalCacheMisses;this.stats.averageCacheHitRate=t>0?this.stats.totalCacheHits/t:0,this.stats.averageLatency=50;const n=Date.now()-1e3,s=this.requestHistory.filter(o=>o.timestamp>n);this.stats.requestsPerSecond=s.length;const i=s.reduce((o,c)=>o+c.size,0);this.stats.bandwidthPerSecond=i,this.stats.errorRate=this.stats.totalRequests>0?this.stats.totalErrors/this.stats.totalRequests:0}purgeCache(t,e){let n=0;if(t&&e){const s=`${t}:`;for(const[i,o]of this.cache.entries())i.startsWith(s)&&i.includes(e)&&(this.cache.delete(i),n++)}else if(t){const s=`${t}:`;for(const[i]of this.cache.entries())i.startsWith(s)&&(this.cache.delete(i),n++)}else n=this.cache.size,this.cache.clear();return n}getStats(){return{...this.stats}}getDistributions(){return Array.from(this.distributions.values())}getEdgeLocations(){return Array.from(this.edgeLocations.values())}hashString(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}}class RT{config=null;routingEngine;metrics={totalDistributions:0,activeDistributions:0,totalEdgeLocations:0,activeEdgeLocations:0,totalRequests:0,totalCacheHits:0,totalCacheMisses:0,totalBandwidth:0,averageCacheHitRate:0,averageLatency:0,requestsPerSecond:0,bandwidthPerSecond:0,errorRate:0};simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new MT}initializeConfig(t){const e=t.data.config||{};this.config={cdnProvider:e.cdnProvider||"cloudflare",distributions:Array.isArray(e.distributions)?e.distributions:[],edgeLocations:Array.isArray(e.edgeLocations)?e.edgeLocations:[],enableCaching:e.enableCaching??!0,cacheTTL:e.cacheTTL||3600,enableCompression:e.enableCompression??!0,compressionType:e.compressionType||"gzip",enableSSL:e.enableSSL??!0,enableHTTP2:e.enableHTTP2??!0,enableHTTP3:e.enableHTTP3??!1,enablePurge:e.enablePurge??!0,enableGeoRouting:e.enableGeoRouting??!1,enableDDoSProtection:e.enableDDoSProtection??!0,defaultTTL:e.defaultTTL||3600,maxTTL:e.maxTTL||86400,cachePolicy:e.cachePolicy||"cache-first"},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),n={id:`req-${Date.now()}-${Math.random()}`,method:t.method,path:t.path,domain:t.domain,headers:t.headers,query:t.query,body:t.body,clientIP:t.clientIP,userAgent:t.userAgent,timestamp:Date.now()},s=this.routingEngine.processRequest(n);return performance.now()-e,this.updateMetricsFromStats(),{success:s.status<400,cacheHit:s.cacheHit,latency:s.latency,error:s.status>=400?`HTTP ${s.status}`:void 0,size:s.size}}getConfig(){return this.config?{...this.config}:null}getMetrics(){return{...this.metrics}}getRoutingEngine(){return this.routingEngine}calculateLoad(){const t=this.routingEngine.getStats(),e=this.routingEngine.getDistributions(),n=this.routingEngine.getEdgeLocations(),s=t.requestsPerSecond||this.simulatedRequestRate,i=t.bandwidthPerSecond||s*1024,o=t.averageLatency||50,c=t.errorRate||0,u=t.averageCacheHitRate||0,h=e.filter(T=>T.status==="deployed").length,f=e.length||1,m=h/f,y=n.filter(T=>T.status==="active").length,v=n.length||1,x=y/v,S=n.reduce((T,k)=>T+(k.capacity||1e4),0),R=S>0?Math.min(1,s/S):0,M=Math.min(.95,.1+m*.2+x*.2+R*.5);return{requestsPerSecond:s,bandwidthPerSecond:i,averageLatency:o,errorRate:c,utilization:M,cacheHitRate:u}}updateMetricsFromStats(){const t=this.routingEngine.getStats(),e=this.routingEngine.getDistributions(),n=this.routingEngine.getEdgeLocations();this.metrics={totalDistributions:e.length,activeDistributions:e.filter(s=>s.status==="deployed").length,totalEdgeLocations:n.length,activeEdgeLocations:n.filter(s=>s.status==="active").length,totalRequests:t.totalRequests,totalCacheHits:t.totalCacheHits,totalCacheMisses:t.totalCacheMisses,totalBandwidth:t.totalBandwidth,averageCacheHitRate:t.averageCacheHitRate,averageLatency:t.averageLatency,requestsPerSecond:t.requestsPerSecond,bandwidthPerSecond:t.bandwidthPerSecond,errorRate:t.errorRate}}simulateIncomingTraffic(t){if(this.simulatedRequestRate=t,this.lastSimulationTime=Date.now(),t>0){const n=this.routingEngine.getDistributions().filter(s=>s.status==="deployed");if(n.length>0){const s=t/n.length;for(const i of n){const o=Math.floor(s*.8);for(let u=0;u<o;u++)this.routingEngine.processRequest({id:`sim-${Date.now()}-${Math.random()}`,method:"GET",path:`/api/resource/${Math.floor(Math.random()*100)}`,domain:i.domain,timestamp:Date.now(),clientIP:`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`});const c=Math.floor(s*.2);for(let u=0;u<c;u++)this.routingEngine.processRequest({id:`sim-${Date.now()}-${Math.random()}`,method:"POST",path:"/api/update",domain:i.domain,timestamp:Date.now(),clientIP:`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`})}}}}purgeCache(t,e){return this.routingEngine.purgeCache(t,e)}getDistributions(){return this.routingEngine.getDistributions()}getEdgeLocations(){return this.routingEngine.getEdgeLocations()}}class ET{config=null;pipelines=new Map;activeBuilds=new Map;nodes=new Map;plugins=new Map;jenkinsMetrics={buildsTotal:0,buildsSuccess:0,buildsFailed:0,buildsRunning:0,buildsPending:0,buildsPerMinute:0,averageBuildDuration:0,executorUtilization:0,executorIdle:0,executorBusy:0,pipelinesTotal:0,pipelinesEnabled:0,nodesTotal:0,nodesOnline:0,pluginsTotal:0,pluginsActive:0,artifactStorageBytes:0,requestsTotal:0,requestsErrors:0};processRequest(t=!0){this.jenkinsMetrics.requestsTotal++,t||this.jenkinsMetrics.requestsErrors++}buildHistory=[];MAX_BUILD_HISTORY=1e3;lastBuildTrigger=new Map;buildTriggerCounter=0;artifacts=new Map;initializeConfig(t){const e=t.data.config||{};this.config={jenkinsUrl:e.jenkinsUrl||"http://jenkins:8080",enableCSRF:e.enableCSRF??!0,executorCount:e.executorCount||2,enablePlugins:e.enablePlugins??!0,plugins:e.plugins||["git","docker","kubernetes"],enablePipeline:e.enablePipeline??!0,enableBlueOcean:e.enableBlueOcean??!1,enableArtifactArchiving:e.enableArtifactArchiving??!0,retentionDays:e.retentionDays||30,pipelines:e.pipelines||[],nodes:e.nodes||[],buildTriggerRate:e.buildTriggerRate||.5,averageBuildDuration:e.averageBuildDuration||12e4,failureRate:e.failureRate||.1},this.initializePipelines(),this.initializeNodes(),this.initializePlugins()}initializePipelines(){if(this.pipelines.clear(),!this.config||!this.config.enablePipeline)return;const t=this.config.pipelines||[];for(const e of t){const n=e.lastBuild||0,s={id:e.id,name:e.name,status:"pending",lastBuild:n,lastSuccessfulBuild:void 0,lastFailedBuild:void 0,duration:void 0,branch:e.branch||"main",enabled:e.enabled!==!1,builds:[],nextBuildNumber:n+1};s.config={triggers:e.triggers||[],parameters:e.parameters||[],environmentVariables:e.environmentVariables||{},postBuildActions:e.postBuildActions||[]},this.pipelines.set(s.id,s)}}calculatePipelineStatus(t){return t.builds.length===0?Array.from(this.activeBuilds.values()).find(s=>s.pipelineId===t.id&&s.status==="running")?"running":"pending":t.builds[t.builds.length-1].status}initializeNodes(){this.nodes.clear();const t={id:"master",name:"master",status:"online",numExecutors:this.config?.executorCount||2,busyExecutors:0,idleExecutors:this.config?.executorCount||2,labels:["master"]};this.nodes.set("master",t);const e=this.config?.nodes||[];for(const n of e){const s={id:n.id,name:n.name,status:"online",numExecutors:n.numExecutors||1,busyExecutors:0,idleExecutors:n.numExecutors||1,labels:n.labels||[]};this.nodes.set(s.id,s)}}initializePlugins(){if(this.plugins.clear(),!this.config||!this.config.enablePlugins)return;const t={git:{version:"4.11.0",description:"Git integration plugin"},docker:{version:"1.2.9",description:"Docker pipeline plugin",dependencies:["workflow-aggregator"]},kubernetes:{version:"1.31.1",description:"Kubernetes plugin for dynamic agent provisioning"},"workflow-aggregator":{version:"2.6",description:"Pipeline plugin aggregator"},"blue-ocean":{version:"1.25.3",description:"Blue Ocean UI for Jenkins",dependencies:["workflow-aggregator"]},credentials:{version:"2.6.1",description:"Credentials management plugin"},"ssh-slaves":{version:"1.32.0",description:"SSH agent plugin"},junit:{version:"1.53",description:"JUnit test result publisher"},"maven-plugin":{version:"3.20",description:"Maven integration plugin"},gradle:{version:"1.36.1",description:"Gradle plugin"}},e=this.config.plugins||[];for(const n of e){let s,i=!0;typeof n=="string"?s=n:(s=n.name||n,i=n.enabled!==!1);const o=t[s]||{version:"1.0.0",description:`${s} plugin`},c={name:s,version:o.version,description:o.description,enabled:i,active:i,dependencies:o.dependencies};this.plugins.set(s,c)}this.updatePluginActiveStatus()}updatePluginActiveStatus(){for(const t of this.plugins.values()){if(!t.enabled){t.active=!1;continue}if(t.dependencies&&t.dependencies.length>0){const e=t.dependencies.every(n=>{const s=this.plugins.get(n);return s&&s.enabled&&s.active});t.active=e}else t.active=t.enabled}}addPlugin(t,e,n){if(this.plugins.has(t))return!1;const s={name:t,version:e||"1.0.0",description:n||`${t} plugin`,enabled:!0,active:!0};return this.plugins.set(t,s),this.updatePluginActiveStatus(),!0}removePlugin(t){if(!this.plugins.get(t))return{success:!1,reason:"Plugin not found"};const n=Array.from(this.plugins.values()).filter(s=>s.dependencies?.includes(t));return n.length>0?{success:!1,reason:`Cannot remove plugin. It is required by: ${n.map(s=>s.name).join(", ")}`}:(this.plugins.delete(t),this.updatePluginActiveStatus(),{success:!0})}setPluginEnabled(t,e){const n=this.plugins.get(t);return n?(n.enabled=e,this.updatePluginActiveStatus(),!0):!1}performUpdate(t){this.config&&(this.updateActiveBuilds(t),this.config.enablePipeline&&this.triggerBuilds(t),this.config.enableArtifactArchiving&&this.cleanupArtifacts(t),this.updateMetrics())}updateActiveBuilds(t){const e=Array.from(this.activeBuilds.entries());for(const[n,s]of e)if(s.status==="running")try{s.startTime&&(t-s.startTime)%5e3<100&&this.updateBuildLogs(s,t);const i=t-s.startTime,o=s.estimatedDuration||this.config?.averageBuildDuration||12e4;if(i<0)continue;if(s.progress=Math.min(100,Math.max(0,Math.floor(i/o*100))),i>=o){const c=Math.random()<(this.config?.failureRate||.1);if(s.status=c?"failed":"success",s.duration=i,s.progress=100,s.logs&&(c?(s.logs.push("[Pipeline] FAILED"),s.logs.push(`Build failed after ${(i/1e3).toFixed(1)}s`)):(s.logs.push("[Pipeline] SUCCESS"),s.logs.push(`Build completed successfully in ${(i/1e3).toFixed(1)}s`)),s.logs.push(`Finished: ${s.status}`)),s.stages)for(const h of s.stages)(h.status==="running"||h.status==="pending")&&(h.status=s.status,h.startTime&&(h.duration=t-h.startTime));this.executePostBuildActions(s,s.status==="success");const u=this.pipelines.get(s.pipelineId);u&&(u.lastBuild=s.number,s.status==="success"?u.lastSuccessfulBuild=s.number:s.status==="failed"&&(u.lastFailedBuild=s.number),u.duration=s.duration,u.builds.push(s),u.builds.length>50&&u.builds.shift(),u.status=this.calculatePipelineStatus(u)),this.freeExecutor(n),this.addBuildToHistory(s),this.activeBuilds.delete(n)}}catch(i){console.error(`Error updating build ${n}:`,i),s.status="failed",this.activeBuilds.delete(n),this.freeExecutor(n)}}triggerBuilds(t){if(!(!this.config||!this.config.enablePipeline))for(const[e,n]of this.pipelines.entries()){if(!n.enabled)continue;const i=(n.config||{}).triggers||[];let o=!1;if(i.length===0){const c=this.config.buildTriggerRate||0;if(c>0){const u=6e4/c,h=this.lastBuildTrigger.get(e)||0;t-h>=u&&(o=!0)}}else for(const c of i)if(c.enabled){if(c.type==="cron"&&c.config?.schedule)o=this.shouldTriggerCron(c.config.schedule,e,t);else if(c.type==="scm"&&c.config?.pollInterval){const u=c.config.pollInterval*60*1e3,h=this.lastBuildTrigger.get(`${e}-scm`)||0;t-h>=u&&(o=!0,this.lastBuildTrigger.set(`${e}-scm`,t))}}o&&this.hasAvailableExecutor()&&(this.startBuild(e,t),this.lastBuildTrigger.set(e,t))}}shouldTriggerCron(t,e,n){const s=this.lastBuildTrigger.get(`${e}-cron`)||0,i=60*1e3;return n-s>=i?(this.lastBuildTrigger.set(`${e}-cron`,n),!0):!1}triggerWebhook(t,e,n){const s=this.pipelines.get(t);if(!s)return{success:!1,reason:"Pipeline not found"};if(!s.enabled)return{success:!1,reason:"Pipeline is disabled"};const o=(s.config||{}).triggers||[],c=o.find(h=>h.type==="webhook"&&h.enabled);if(!c&&o.length>0)return{success:!1,reason:"Webhook trigger not configured or disabled"};if(c?.config?.branches&&e&&!c.config.branches.includes(e))return{success:!1,reason:`Branch ${e} not in allowed branches`};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const u=Date.now();return this.startBuild(t,u,{branch:e,commit:n,triggeredBy:"webhook"}),{success:!0}}triggerBuildManually(t){const e=this.pipelines.get(t);if(!e)return{success:!1,reason:"Pipeline not found"};if(!e.enabled)return{success:!1,reason:"Pipeline is disabled"};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const n=Date.now();return this.startBuild(t,n),{success:!0,buildId:`${t}-${e.nextBuildNumber-1}`}}startBuild(t,e,n){const s=this.pipelines.get(t);if(!s)return;const i=s.nextBuildNumber++,o=`${t}-${i}`,c=this.config?.averageBuildDuration||12e4,u=c*.3,h=c+(Math.random()*2-1)*u,f=this.generateBuildLogs(i,s.name,s.branch||"main"),m=this.generateArtifacts(s.name,i),y=s.config||{},v=n?.parameters||{},x=y.parameters||[],S={};for(const T of x)T.defaultValue!==void 0&&(S[T.name]=T.defaultValue);Object.assign(S,v);const R={...y.environmentVariables||{},...S},M={id:o,number:i,pipelineId:t,status:"running",startTime:e,estimatedDuration:h,progress:0,branch:n?.branch||s.branch,commit:n?.commit,logs:f,artifacts:m.map(T=>T.name),triggeredBy:n?.triggeredBy||"system",stages:[{name:"Checkout",status:"running",startTime:e},{name:"Build",status:"pending"},{name:"Test",status:"pending"},{name:"Deploy",status:"pending"}]};M.parameters=S,M.environmentVariables=R,M.postBuildActions=y.postBuildActions||[];for(const T of m)this.artifacts.set(`${o}-${T.name}`,{size:T.size,created:e});this.activeBuilds.set(o,M),s.status=this.calculatePipelineStatus(s),this.allocateExecutor(o),this.jenkinsMetrics.buildsTotal++,this.jenkinsMetrics.buildsRunning++}generateBuildLogs(t,e,n){const s=[];return s.push("Started by system"),s.push(`Building on master in workspace /var/jenkins_home/workspace/${e}`),s.push(`[${e}] $ /usr/bin/git rev-parse --is-inside-work-tree`),s.push("true"),s.push(`[${e}] $ /usr/bin/git config remote.origin.url https://github.com/example/${e}.git`),s.push(`[${e}] $ /usr/bin/git --version`),s.push("git version 2.39.0"),s.push(`[${e}] $ /usr/bin/git fetch --tags --force --progress -- https://github.com/example/${e}.git +refs/heads/${n}:refs/remotes/origin/${n}`),s.push(`From https://github.com/example/${e}`),s.push(` * [new branch]      ${n}       -> origin/${n}`),s.push(`[${e}] $ /usr/bin/git rev-parse "refs/remotes/origin/${n}^{commit}"`),s.push("abc123def456789"),s.push(`[${e}] $ /usr/bin/git checkout -f abc123def456789`),s.push(`HEAD is now at abc123def456789 Commit message for build #${t}`),s.push(`[${e}] $ /usr/bin/git clean -fdx`),s.push("Removing .gradle/"),s.push("Removing build/"),s.push("[Pipeline] Start of Pipeline"),s.push("[Pipeline] node"),s.push(`Running on Jenkins in /var/jenkins_home/workspace/${e}`),s.push("[Pipeline] {"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Checkout)"),s.push("[Pipeline] checkout"),s.push(`Checking out abc123def456789 from ${n}`),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Build)"),s.push("[Pipeline] sh"),s.push('+ echo "Building application..."'),s.push("Building application..."),s.push("[Pipeline] sh"),s.push("+ ./gradlew build -x test"),s.push("> Task :compileJava"),s.push("> Task :processResources"),s.push("> Task :classes"),s.push("> Task :jar"),s.push("BUILD SUCCESSFUL in 45s"),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Test)"),s.push("[Pipeline] sh"),s.push('+ echo "Running tests..."'),s.push("Running tests..."),s.push("[Pipeline] sh"),s.push("+ ./gradlew test"),s.push("> Task :test"),s.push("Test results: 127 passed, 0 failed"),s.push("BUILD SUCCESSFUL in 30s"),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] stage"),s.push("[Pipeline] { (Deploy)"),s.push("[Pipeline] sh"),s.push('+ echo "Deploying to staging..."'),s.push("Deploying to staging..."),s.push("[Pipeline] }"),s.push("[Pipeline] // stage"),s.push("[Pipeline] }"),s.push("[Pipeline] // node"),s.push("[Pipeline] End of Pipeline"),s}generateArtifacts(t,e){const n=[];return n.push({name:`app-${e}.jar`,size:15*1024*1024}),n.push({name:`app-${e}-sources.jar`,size:3*1024*1024}),n.push({name:`test-results-${e}.xml`,size:512*1024}),n.push({name:`coverage-report-${e}.html`,size:2*1024*1024}),n}cancelBuild(t){const e=this.activeBuilds.get(t);if(!e)return{success:!1,reason:"Build not found or already completed"};if(e.status!=="running"&&e.status!=="pending")return{success:!1,reason:"Build is not running"};if(e.status="aborted",e.duration=Date.now()-e.startTime,e.progress=0,e.logs&&(e.logs.push("[Pipeline] Aborted by user"),e.logs.push("[Pipeline] Terminated")),e.stages)for(const s of e.stages)(s.status==="running"||s.status==="pending")&&(s.status="aborted");this.freeExecutor(t);const n=this.pipelines.get(e.pipelineId);return n&&(n.builds.push(e),n.builds.length>50&&n.builds.shift(),n.status=this.calculatePipelineStatus(n),!n.builds.some(i=>i.status==="success")&&n.builds.every(i=>i.status==="aborted"||i.status==="failed")&&(n.status="pending")),this.activeBuilds.delete(t),this.jenkinsMetrics.buildsRunning--,{success:!0}}updateBuildLogs(t,e){if(!t.logs||t.status!=="running")return;const n=e-t.startTime,s=t.estimatedDuration||12e4,i=Math.min(100,Math.floor(n/s*100)),o=[10,30,50,70,90];for(const c of o)i>=c&&!t.logs.some(u=>u.includes(`Progress: ${c}%`))&&t.logs.push(`[Pipeline] Progress: ${c}% completed`);if(t.stages){const c=Math.floor(i/(100/t.stages.length));for(let u=0;u<t.stages.length;u++)(u<c&&t.stages[u].status==="pending"||u===c&&t.stages[u].status==="pending")&&(t.stages[u].status="running",t.stages[u].startTime=e)}}getBuildLogs(t){return this.getBuildById(t)?.logs}getBuildArtifacts(t){const e=this.getBuildById(t);if(!e||!e.artifacts)return[];const n=[];for(const s of e.artifacts){const i=`${t}-${s}`,o=this.artifacts.get(i);o&&n.push({name:s,size:o.size})}return n}executePostBuildActions(t,e){const n=t.postBuildActions||[];for(const s of n)if(s.enabled)switch(s.type){case"email":if(t.logs){const i=s.config?.recipients||["default@example.com"];t.logs.push(`[Post-Build] Sending email notification to: ${i.join(", ")}`),t.logs.push(`[Post-Build] Email subject: Build ${t.status==="success"?"SUCCESS":"FAILED"} - ${t.pipelineId} #${t.number}`)}break;case"archive":if(t.logs){const i=s.config?.archivePattern||"**/*";t.logs.push(`[Post-Build] Archiving artifacts matching pattern: ${i}`),t.artifacts&&t.artifacts.length>0&&t.logs.push(`[Post-Build] Archived ${t.artifacts.length} artifact(s)`)}break;case"publish":if(t.logs){const i=s.config?.publishTarget||"default";t.logs.push(`[Post-Build] Publishing test results to: ${i}`),t.logs.push("[Post-Build] Published build metrics and artifacts")}break;case"deploy":if(e&&s.config?.deployEnv){if(t.logs){const i=s.config.deployEnv;t.logs.push(`[Post-Build] Deploying to environment: ${i}`),t.logs.push(`[Post-Build] Deployment initiated for build #${t.number}`),t.logs.push(`[Post-Build] Deployment to ${i} completed successfully`)}}else e||t.logs&&t.logs.push("[Post-Build] Skipping deployment - build failed");break}}getPipelineConfig(t){const e=this.pipelines.get(t);return e?e.config||{}:null}updatePipelineConfig(t,e){const n=this.pipelines.get(t);return n?(n.config={...n.config||{},...e},!0):!1}hasAvailableExecutor(){for(const t of this.nodes.values())if(t.idleExecutors>0)return!0;return!1}allocateExecutor(t){for(const e of this.nodes.values())if(e.idleExecutors>0){e.idleExecutors--,e.busyExecutors++;return}}freeExecutor(t){for(const e of this.nodes.values())if(e.busyExecutors>0){e.busyExecutors--,e.idleExecutors++;return}}addBuildToHistory(t){t.duration&&(this.buildHistory.push({timestamp:t.startTime,duration:t.duration,status:t.status}),this.buildHistory.length>this.MAX_BUILD_HISTORY&&this.buildHistory.shift(),t.status==="success"?this.jenkinsMetrics.buildsSuccess++:t.status==="failed"&&this.jenkinsMetrics.buildsFailed++,this.jenkinsMetrics.buildsRunning--)}cleanupArtifacts(t){if(!this.config)return;const e=(this.config.retentionDays||30)*24*60*60*1e3;for(const[n,s]of this.artifacts.entries())t-s.created>e&&this.artifacts.delete(n)}updateMetrics(){this.jenkinsMetrics.buildsRunning=this.activeBuilds.size,this.jenkinsMetrics.buildsPending=Array.from(this.activeBuilds.values()).filter(u=>u.status==="pending").length;const t=this.buildHistory.length;this.jenkinsMetrics.buildsTotal=t+this.activeBuilds.size;const e=Date.now()-6e4,n=this.buildHistory.filter(u=>u.timestamp>e);if(this.jenkinsMetrics.buildsPerMinute=n.length,this.buildHistory.length>0){const u=this.buildHistory.slice(-100),h=u.reduce((f,m)=>f+m.duration,0)/u.length;this.jenkinsMetrics.averageBuildDuration=h}let s=0,i=0,o=0;for(const u of this.nodes.values())s+=u.numExecutors,i+=u.busyExecutors,o+=u.idleExecutors;this.jenkinsMetrics.executorBusy=i,this.jenkinsMetrics.executorIdle=o,this.jenkinsMetrics.executorUtilization=s>0?i/s*100:0,this.jenkinsMetrics.pipelinesTotal=this.pipelines.size,this.jenkinsMetrics.pipelinesEnabled=Array.from(this.pipelines.values()).filter(u=>u.enabled).length,this.jenkinsMetrics.nodesTotal=this.nodes.size,this.jenkinsMetrics.nodesOnline=Array.from(this.nodes.values()).filter(u=>u.status==="online").length,this.jenkinsMetrics.pluginsTotal=this.plugins.size,this.jenkinsMetrics.pluginsActive=Array.from(this.plugins.values()).filter(u=>u.active).length;let c=0;for(const u of this.artifacts.values())c+=u.size;this.jenkinsMetrics.artifactStorageBytes=c}getJenkinsMetrics(){return{...this.jenkinsMetrics}}getPipelines(){for(const t of this.pipelines.values())t.status=this.calculatePipelineStatus(t);return Array.from(this.pipelines.values())}getActiveBuilds(){return Array.from(this.activeBuilds.values())}getNodes(){return Array.from(this.nodes.values())}getPlugins(){return Array.from(this.plugins.values())}getPipelineBuilds(t){const e=this.pipelines.get(t);return e?e.builds:[]}getAllBuilds(){const t=[];t.push(...Array.from(this.activeBuilds.values()));for(const e of this.pipelines.values()){const n=e.builds.slice(-50);t.push(...n)}return t.sort((e,n)=>{const s=e.startTime||0;return(n.startTime||0)-s})}getBuildById(t){if(this.activeBuilds.has(t))return this.activeBuilds.get(t);for(const e of this.pipelines.values()){const n=e.builds.find(s=>s.id===t);if(n)return n}}updateConfig(t){const e=this.config,n=new Set(this.pipelines.keys());this.initializeConfig(t);const s=this.config?.executorCount||2;e&&e.executorCount!==s&&this.updateExecutorCount(s);const i=new Set(this.pipelines.keys());for(const h of n)if(!i.has(h)){for(const[f,m]of this.activeBuilds.entries())m.pipelineId===h&&(m.status="aborted",this.freeExecutor(f),this.activeBuilds.delete(f));this.pipelines.delete(h)}const o=this.config?.pipelines||[];for(const h of o){const f=this.pipelines.get(h.id);f&&(f.name=h.name,f.branch=h.branch||"main",f.enabled=h.enabled!==!1,f.config={triggers:h.triggers||[],parameters:h.parameters||[],environmentVariables:h.environmentVariables||{},postBuildActions:h.postBuildActions||[]})}const c=this.config?.nodes||[],u=new Set(this.nodes.keys());for(const h of u)h!=="master"&&!c.find(f=>f.id===h)&&this.nodes.delete(h);for(const h of c){const f=this.nodes.get(h.id);if(f)f.name=h.name,f.numExecutors=h.numExecutors||1,f.labels=h.labels||[],f.idleExecutors=f.numExecutors-f.busyExecutors;else{const m={id:h.id,name:h.name,status:"online",numExecutors:h.numExecutors||1,busyExecutors:0,idleExecutors:h.numExecutors||1,labels:h.labels||[]};this.nodes.set(h.id,m)}}}setPipelineEnabled(t,e){const n=this.pipelines.get(t);return n?(n.enabled=e,!0):!1}updateExecutorCount(t){const e=this.nodes.get("master");return!e||t<e.busyExecutors?!1:(e.numExecutors,e.numExecutors=t,e.idleExecutors=t-e.busyExecutors,!0)}canUpdateExecutorCount(t){const e=this.nodes.get("master");return e?t<1||t>100?{can:!1,reason:"Executor count must be between 1 and 100"}:t<e.busyExecutors?{can:!1,reason:`Cannot reduce executors to ${t}. Currently ${e.busyExecutors} executors are busy.`}:{can:!0}:{can:!1,reason:"Master node not found"}}setPipelineEnabled(t,e){const n=this.pipelines.get(t);return n?(n.enabled=e,!0):!1}calculateComponentMetrics(){const t=this.getJenkinsMetrics(),e=t.buildsPerMinute/60,n=t.averageBuildDuration,s=t.executorUtilization,i=t.buildsSuccess+t.buildsFailed,o=i>0?t.buildsFailed/i*100:0;return{throughput:e,latency:n,utilization:s,errorRate:o}}}class kT{config=null;pipelines=new Map;activeJobs=new Map;runners=new Map;variables=new Map;environments=new Map;schedules=new Map;artifacts=new Map;cacheEntries=new Map;gitlabMetrics={pipelinesTotal:0,pipelinesSuccess:0,pipelinesFailed:0,pipelinesRunning:0,pipelinesPending:0,pipelinesPerHour:0,averagePipelineDuration:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,averageJobDuration:0,runnersTotal:0,runnersOnline:0,runnersBusy:0,runnersIdle:0,runnerUtilization:0,cacheHits:0,cacheMisses:0,cacheHitRate:0,artifactsTotal:0,artifactsSizeBytes:0,requestsTotal:0,requestsErrors:0};pipelineHistory=[];MAX_PIPELINE_HISTORY=1e3;jobHistory=[];MAX_JOB_HISTORY=5e3;lastPipelineTrigger=new Map;pipelineIidCounter=0;scheduleLastRun=new Map;processRequest(t=!0){this.gitlabMetrics.requestsTotal++,t||this.gitlabMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={gitlabUrl:e.gitlabUrl||"https://gitlab.com",projectId:e.projectId||"1",projectUrl:e.projectUrl||"https://gitlab.com/archiphoenix/project",enableRunners:e.enableRunners??!0,runnerType:e.runnerType||"docker",concurrentJobs:e.concurrentJobs||4,enableCache:e.enableCache??!0,cacheType:e.cacheType||"s3",enableArtifacts:e.enableArtifacts??!0,artifactsExpiry:e.artifactsExpiry||"7d",enableKubernetes:e.enableKubernetes??!1,k8sNamespace:e.k8sNamespace||"gitlab-runner",pipelines:e.pipelines||[],runners:e.runners||[],variables:e.variables||[],environments:e.environments||[],schedules:e.schedules||[],pipelineTriggerRate:e.pipelineTriggerRate||2,averagePipelineDuration:e.averagePipelineDuration||3e5,averageJobDuration:e.averageJobDuration||6e4,failureRate:e.failureRate||.1,cacheHitRate:e.cacheHitRate||.7},this.initializePipelines(),this.initializeRunners(),this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}initializePipelines(){this.pipelines.clear();const t=this.config?.pipelines||[];for(const e of t){const n=e.id,i=(e.stages||[{name:"build",jobs:[{name:"build",stage:"build"}]},{name:"test",jobs:[{name:"test",stage:"test"}]},{name:"deploy",jobs:[{name:"deploy",stage:"deploy"}]}]).map(c=>({name:c.name,status:"pending",jobs:(c.jobs||[]).map(u=>({id:`${n}-${c.name}-${u.name}`,name:u.name,stage:c.name,status:"created",pipelineId:n,when:u.when||"on_success",allowFailure:u.allowFailure||!1,tags:u.tags||[],image:u.image,script:u.script||[`echo "Running ${u.name}"`]}))})),o={id:n,iid:++this.pipelineIidCounter,status:"created",ref:e.ref||"main",source:e.source||"push",stages:i,createdAt:Date.now(),updatedAt:Date.now(),variables:{}};this.pipelines.set(n,o)}}initializeRunners(){this.runners.clear();const t=this.config?.runners||[];if(t.length===0&&this.config?.enableRunners){const e={id:"default-runner-1",name:"docker-runner-1",status:"online",runnerType:"project_type",executor:this.config.runnerType||"docker",active:!0,isShared:!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",currentJobs:0,maxJobs:this.config.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(e.id,e);return}for(const e of t){const n={id:e.id,name:e.name,status:"online",runnerType:"project_type",executor:e.executor||this.config?.runnerType||"docker",active:!0,isShared:e.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:e.tags||[],currentJobs:0,maxJobs:e.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(n.id,n)}}initializeVariables(){this.variables.clear();const t=this.config?.variables||[];for(const e of t){const n={key:e.key,value:e.value,variableType:"env_var",protected:e.protected??!1,masked:e.masked??!1,raw:!1,environmentScope:e.environmentScope||"*"};this.variables.set(e.key,n)}}initializeEnvironments(){this.environments.clear();const t=this.config?.environments||[];for(const e of t){const n={id:e.id,name:e.name,slug:e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),externalUrl:e.externalUrl,state:"available",deployments:[]};this.environments.set(e.id,n)}}initializeSchedules(){this.schedules.clear();const t=this.config?.schedules||[];for(const e of t){const n={id:e.id,description:e.description,ref:e.ref,cron:e.cron,active:e.active!==!1,variables:e.variables||{}};n.nextRunAt=this.calculateNextRunTime(n.cron),this.schedules.set(e.id,n)}}calculateNextRunTime(t){const e=Date.now(),n=3600*1e3;return e+n}performUpdate(t){this.config&&(this.updateActiveJobs(t),this.updateActivePipelines(t),this.triggerPipelines(t),this.checkSchedules(t),this.config.enableArtifacts&&this.cleanupArtifacts(t),this.updateMetrics())}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[n,s]of e)if(s.status==="running")try{if(!s.startTime){s.startTime=t;continue}const i=t-s.startTime,o=s.estimatedDuration||this.config?.averageJobDuration||6e4;if(i<0)continue;if(s.progress=Math.min(100,Math.max(0,Math.floor(i/o*100))),i%5e3<100&&s.logs&&this.updateJobLogs(s,i,o),i>=o){const c=Math.random()<(this.config?.failureRate||.1);s.status=c?"failed":"success",s.duration=i,s.progress=100,s.logs&&(c?s.logs.push(`Job ${s.name} failed after ${(i/1e3).toFixed(1)}s`):s.logs.push(`Job ${s.name} succeeded in ${(i/1e3).toFixed(1)}s`)),s.status==="success"&&this.config?.enableArtifacts&&this.generateJobArtifacts(s,t),this.freeRunner(s.runnerId),s.runnerId=void 0,this.updatePipelineStage(s),this.addJobToHistory(s),this.activeJobs.delete(n)}}catch(i){console.error(`Error updating job ${n}:`,i),s.status="failed",this.activeJobs.delete(n),this.freeRunner(s.runnerId)}}updateActivePipelines(t){for(const e of this.pipelines.values()){if(e.status!=="running"&&e.status!=="pending")continue;const n=e.stages.every(s=>s.status==="success"||s.status==="failed"||s.status==="canceled");if(n&&e.status==="running"){const s=e.stages.some(i=>i.status==="failed");e.status=s?"failed":"success",e.finishedAt=t,e.startedAt&&(e.duration=t-e.startedAt),e.status==="success"&&(e.coverage=75+Math.random()*20),this.addPipelineToHistory(e),e.status==="success"?this.gitlabMetrics.pipelinesSuccess++:this.gitlabMetrics.pipelinesFailed++,this.gitlabMetrics.pipelinesRunning--}else if(e.status==="pending"&&!n){const s=e.stages.find(i=>i.status==="pending");s&&this.hasAvailableRunner(s.jobs[0]?.tags)&&(e.status="running",e.startedAt=t,this.startStage(s,e.id,t))}else if(e.status==="running")for(let s=0;s<e.stages.length;s++){const i=e.stages[s],o=s>0?e.stages[s-1]:null;if(i.status==="pending"&&(!o||o.status==="success")){this.startStage(i,e.id,t);break}}e.updatedAt=t}}startStage(t,e,n){t.status="running",t.startTime=n;for(const s of t.jobs)if(s.status==="created"||s.status==="pending"){const i=this.findAvailableRunner(s.tags);i?(s.status="running",s.startTime=n,s.runnerId=i.id,s.estimatedDuration=this.config?.averageJobDuration||6e4,s.progress=0,s.logs=this.generateJobLogs(s),i.currentJobs++,i.busy=i.currentJobs>=i.maxJobs,this.activeJobs.set(s.id,s),this.gitlabMetrics.jobsRunning++):(s.status="pending",this.gitlabMetrics.jobsPending++)}}updateJobLogs(t,e,n){if(!t.logs)return;const s=Math.floor(e/n*100),i=[10,30,50,70,90];for(const o of i)s>=o&&!t.logs.some(c=>c.includes(`Progress: ${o}%`))&&t.logs.push(`[${t.name}] Progress: ${o}% completed`)}generateJobLogs(t){const e=[];if(e.push(`Running with ${t.image||"default"} image`),e.push(`$ ${t.script?.[0]||`echo "Running ${t.name}"`}`),t.script)for(const n of t.script)n.startsWith("echo")?e.push(n.replace("echo ","")):(e.push(`$ ${n}`),e.push(`[output from ${n}]`));return e}generateJobArtifacts(t,e){if(!this.config?.enableArtifacts)return;const n=[{name:`${t.name}-output.log`,size:1024*10,fileType:"text/plain"},{name:`${t.name}-results.json`,size:1024*5,fileType:"application/json"}];for(const s of n){const i=`${t.id}-${s.name}`,o={id:i,jobId:t.id,pipelineId:t.pipelineId,name:s.name,size:s.size,fileType:s.fileType,filename:s.name,createdAt:e},c=parseInt(this.config.artifactsExpiry?.replace("d","")||"7");o.expiresAt=e+c*24*60*60*1e3,this.artifacts.set(i,o),t.artifacts||(t.artifacts=[]),t.artifacts.push(s.name)}}updatePipelineStage(t){const e=this.pipelines.get(t.pipelineId);if(!e)return;const n=e.stages.find(o=>o.name===t.stage);if(!n)return;const s=n.jobs.find(o=>o.id===t.id);if(s&&(s.status=t.status,s.duration=t.duration),n.jobs.every(o=>o.status==="success"||o.status==="failed"||o.status==="canceled"||o.status==="skipped")){const o=n.jobs.some(c=>c.status==="failed"&&!c.allowFailure);n.status=o?"failed":"success",n.startTime&&(n.duration=Date.now()-n.startTime)}}triggerPipelines(t){if(!this.config)return;const e=this.config.pipelineTriggerRate||2,n=3600*1e3/e;for(const[s,i]of this.pipelines.entries()){if(i.status==="running"||i.status==="pending")continue;const o=this.lastPipelineTrigger.get(s)||0;t-o>=n&&(this.startPipeline(s,t),this.lastPipelineTrigger.set(s,t))}}checkSchedules(t){for(const[e,n]of this.schedules.entries())if(n.active&&n.nextRunAt&&t>=n.nextRunAt){const s=Array.from(this.pipelines.values()).find(i=>i.ref===n.ref&&(i.status==="created"||i.status==="success"||i.status==="failed"));s&&(this.startPipeline(s.id,t,"schedule",n.variables),n.lastRunPipelineId=s.id),n.nextRunAt=this.calculateNextRunTime(n.cron),this.scheduleLastRun.set(e,t)}}startPipeline(t,e,n="push",s){const i=this.pipelines.get(t);if(!i)return{success:!1,reason:"Pipeline not found"};if(i.status==="running"||i.status==="pending")return{success:!1,reason:"Pipeline already running"};i.status="pending",i.source=n,i.createdAt=e,i.updatedAt=e,i.startedAt=void 0,i.finishedAt=void 0,i.duration=void 0,i.coverage=void 0,s&&(i.variables={...i.variables,...s});for(const o of i.stages){o.status="pending",o.startTime=void 0,o.duration=void 0;for(const c of o.jobs)c.status="created",c.startTime=void 0,c.duration=void 0,c.progress=0,c.logs=void 0,c.artifacts=void 0,c.runnerId=void 0}return this.gitlabMetrics.pipelinesTotal++,this.gitlabMetrics.pipelinesPending++,{success:!0}}triggerWebhook(t,e){const n=Array.from(this.pipelines.values()).find(i=>i.ref===t&&(i.status==="created"||i.status==="success"||i.status==="failed"));if(!n)return{success:!1,reason:`No pipeline found for ref: ${t}`};const s=this.startPipeline(n.id,Date.now(),"trigger",e);return s.success?{success:!0,pipelineId:n.id}:s}cancelPipeline(t){const e=this.pipelines.get(t);if(!e)return{success:!1,reason:"Pipeline not found"};if(e.status!=="running"&&e.status!=="pending")return{success:!1,reason:"Pipeline is not running"};e.status="canceled",e.finishedAt=Date.now(),e.startedAt&&(e.duration=Date.now()-e.startedAt);for(const n of e.stages){n.status="canceled";for(const s of n.jobs)(s.status==="running"||s.status==="pending")&&(s.status="canceled",this.freeRunner(s.runnerId),this.activeJobs.delete(s.id),this.gitlabMetrics.jobsRunning--)}return this.gitlabMetrics.pipelinesRunning--,{success:!0}}hasAvailableRunner(t){for(const e of this.runners.values())if(!(e.status!=="online"||!e.active)&&!(e.currentJobs>=e.maxJobs)&&!(t&&t.length>0&&(!e.runUntagged&&(!e.tagList||e.tagList.length===0)||e.tagList&&e.tagList.length>0&&!t.some(s=>e.tagList?.includes(s))&&!e.runUntagged)))return!0;return!1}findAvailableRunner(t){for(const e of this.runners.values())if(!(e.status!=="online"||!e.active)&&!(e.currentJobs>=e.maxJobs)&&!(t&&t.length>0&&(!e.runUntagged&&(!e.tagList||e.tagList.length===0)||e.tagList&&e.tagList.length>0&&!t.some(s=>e.tagList?.includes(s))&&!e.runUntagged)))return e}freeRunner(t){if(!t)return;const e=this.runners.get(t);e&&e.currentJobs>0&&(e.currentJobs--,e.busy=e.currentJobs>=e.maxJobs)}addPipelineToHistory(t){t.duration&&(this.pipelineHistory.push({timestamp:t.startedAt||t.createdAt,duration:t.duration,status:t.status}),this.pipelineHistory.length>this.MAX_PIPELINE_HISTORY&&this.pipelineHistory.shift())}addJobToHistory(t){t.duration&&(this.jobHistory.push({timestamp:t.startTime||Date.now(),duration:t.duration,status:t.status}),this.jobHistory.length>this.MAX_JOB_HISTORY&&this.jobHistory.shift(),t.status==="success"?this.gitlabMetrics.jobsSuccess++:t.status==="failed"&&this.gitlabMetrics.jobsFailed++,this.gitlabMetrics.jobsRunning--)}cleanupArtifacts(t){if(!this.config)return;const n=parseInt(this.config.artifactsExpiry?.replace("d","")||"7")*24*60*60*1e3;for(const[s,i]of this.artifacts.entries())i.expiresAt&&t>i.expiresAt?this.artifacts.delete(s):t-i.createdAt>n&&this.artifacts.delete(s)}updateMetrics(){this.gitlabMetrics.pipelinesRunning=Array.from(this.pipelines.values()).filter(h=>h.status==="running").length,this.gitlabMetrics.pipelinesPending=Array.from(this.pipelines.values()).filter(h=>h.status==="pending").length;const t=Date.now()-3600*1e3,e=this.pipelineHistory.filter(h=>h.timestamp>t);if(this.gitlabMetrics.pipelinesPerHour=e.length,this.pipelineHistory.length>0){const h=this.pipelineHistory.slice(-100),f=h.reduce((m,y)=>m+y.duration,0)/h.length;this.gitlabMetrics.averagePipelineDuration=f}if(this.gitlabMetrics.jobsRunning=this.activeJobs.size,this.gitlabMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(h=>h.status==="pending").length,this.jobHistory.length>0){const h=this.jobHistory.slice(-500),f=h.reduce((m,y)=>m+y.duration,0)/h.length;this.gitlabMetrics.averageJobDuration=f}this.gitlabMetrics.runnersTotal=this.runners.size,this.gitlabMetrics.runnersOnline=Array.from(this.runners.values()).filter(h=>h.status==="online").length;let n=0,s=0,i=0;for(const h of this.runners.values())h.status==="online"&&(n+=h.currentJobs,s+=h.maxJobs-h.currentJobs,i+=h.maxJobs);this.gitlabMetrics.runnersBusy=n,this.gitlabMetrics.runnersIdle=s,this.gitlabMetrics.runnerUtilization=i>0?n/i*100:0;const o=this.gitlabMetrics.cacheHits+this.gitlabMetrics.cacheMisses;o>0?this.gitlabMetrics.cacheHitRate=this.gitlabMetrics.cacheHits/o:(this.gitlabMetrics.cacheHits=Math.floor(Math.random()*100),this.gitlabMetrics.cacheMisses=Math.floor(this.gitlabMetrics.cacheHits*.3),this.gitlabMetrics.cacheHitRate=this.config?.cacheHitRate||.7),this.gitlabMetrics.artifactsTotal=this.artifacts.size;let c=0;for(const h of this.artifacts.values())c+=h.size;this.gitlabMetrics.artifactsSizeBytes=c;const u=Array.from(this.pipelines.values()).filter(h=>h.status==="success"&&h.coverage!==void 0);if(u.length>0){const h=u.reduce((f,m)=>f+(m.coverage||0),0)/u.length;this.gitlabMetrics.coverage=h}}getGitLabCIMetrics(){return{...this.gitlabMetrics}}getMetrics(){return this.getGitLabCIMetrics()}getPipelines(){return Array.from(this.pipelines.values())}getPipeline(t){return this.pipelines.get(t)}getActiveJobs(){return Array.from(this.activeJobs.values())}getJob(t){if(this.activeJobs.has(t))return this.activeJobs.get(t);for(const e of this.pipelines.values())for(const n of e.stages){const s=n.jobs.find(i=>i.id===t);if(s)return s}}getRunners(){return Array.from(this.runners.values())}getVariables(){return Array.from(this.variables.values())}getEnvironments(){return Array.from(this.environments.values())}getSchedules(){return Array.from(this.schedules.values())}getArtifacts(){return Array.from(this.artifacts.values())}getJobLogs(t){return this.getJob(t)?.logs}updateConfig(t){this.config;const e=new Set(this.pipelines.keys());this.initializeConfig(t);const n=new Set(this.pipelines.keys());for(const c of e)if(!n.has(c)){for(const[u,h]of this.activeJobs.entries())h.pipelineId===c&&(h.status="canceled",this.freeRunner(h.runnerId),this.activeJobs.delete(u));this.pipelines.delete(c)}const s=this.config?.pipelines||[];for(const c of s){const u=this.pipelines.get(c.id);u&&(u.ref=c.ref||u.ref,u.source=c.source||u.source,u.status!=="running"&&u.status)}const i=this.config?.runners||[],o=new Set(this.runners.keys());for(const c of o)if(!i.find(u=>u.id===c)){for(const[u,h]of this.activeJobs.entries())h.runnerId===c&&(h.status="canceled",this.activeJobs.delete(u));this.runners.delete(c)}for(const c of i){const u=this.runners.get(c.id);if(u)u.name=c.name,u.executor=c.executor||u.executor,u.maxJobs=c.maxJobs||u.maxJobs,u.tagList=c.tags||u.tagList,u.isShared=c.isShared??u.isShared;else{const h={id:c.id,name:c.name,status:"online",runnerType:"project_type",executor:c.executor||this.config?.runnerType||"docker",active:!0,isShared:c.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:c.tags||[],currentJobs:0,maxJobs:c.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(c.id,h)}}this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}calculateComponentMetrics(){const t=this.getGitLabCIMetrics(),e=t.pipelinesPerHour/3600,n=t.averagePipelineDuration,s=t.runnerUtilization/100,i=t.pipelinesSuccess+t.pipelinesFailed,o=i>0?t.pipelinesFailed/i:0;return{throughput:e,latency:n,utilization:s,errorRate:o}}}class TT{config=null;applications=new Map;repositories=new Map;projects=new Map;syncOperations=new Map;argoMetrics={applicationsTotal:0,applicationsSynced:0,applicationsOutOfSync:0,applicationsProgressing:0,applicationsDegraded:0,applicationsHealthy:0,syncOperationsTotal:0,syncOperationsSuccess:0,syncOperationsFailed:0,syncOperationsRunning:0,syncRate:0,averageSyncDuration:0,repositoriesTotal:0,repositoriesConnected:0,repositoriesFailed:0,projectsTotal:0,requestsTotal:0,requestsErrors:0};syncHistory=[];MAX_SYNC_HISTORY=1e3;lastSyncTime=new Map;lastHealthCheck=new Map;processRequest(t=!0){this.argoMetrics.requestsTotal++,t||this.argoMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||e.argoUrl||"https://argocd.example.com",enableSSO:e.enableSSO??!1,ssoProvider:e.ssoProvider||"oidc",enableRBAC:e.enableRBAC??!0,enableSyncPolicy:e.enableSyncPolicy??!0,autoSync:e.autoSync??!1,syncPolicy:e.syncPolicy||"manual",enableHealthChecks:e.enableHealthChecks??!0,enableNotifications:e.enableNotifications??!0,notificationChannels:e.notificationChannels||["slack"],applications:e.applications||[],repositories:e.repositories||[],projects:e.projects||[],syncRate:e.syncRate||1,averageSyncDuration:e.averageSyncDuration||3e4,failureRate:e.failureRate||.05,healthCheckInterval:e.healthCheckInterval||3e5},this.initializeApplications(),this.initializeRepositories(),this.initializeProjects()}initializeApplications(){this.applications.clear();const t=this.config?.applications||[];if(t.length===0){const e={name:"web-app",namespace:"production",project:"default",repository:"https://github.com/example/web-app",path:"k8s",targetRevision:"main",destination:{server:"https://kubernetes.default.svc",namespace:"production"},syncPolicy:this.config?.syncPolicy||"manual",status:"synced",health:"healthy",lastSync:Date.now()-12e4,revision:"abc123",sourceRevision:"abc123"};this.applications.set(e.name,e);return}for(const e of t){const n={name:e.name,namespace:e.namespace,project:e.project||"default",repository:e.repository,path:e.path||".",targetRevision:e.targetRevision||"main",destination:e.destination||{server:"https://kubernetes.default.svc",namespace:e.namespace||"default"},syncPolicy:e.syncPolicy||this.config?.syncPolicy||"manual",status:e.status||"synced",health:e.health||"healthy",lastSync:Date.now()-Math.random()*36e5,revision:this.generateRevision(),sourceRevision:this.generateRevision()};this.applications.set(n.name,n)}}initializeRepositories(){this.repositories.clear();const t=this.config?.repositories||[],e=new Set;for(const n of this.applications.values())e.add(n.repository);for(const n of t){const s={name:n.name||n.url,url:n.url,type:n.type||"git",username:n.username,password:n.password,insecure:n.insecure??!1,project:n.project,connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(s.name,s)}for(const n of e)if(!this.repositories.has(n)){const s={name:n,url:n,type:"git",connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(n,s)}}initializeProjects(){this.projects.clear();const t=this.config?.projects||[];if(t.length===0){const e={name:"default",description:"Default project",sourceRepos:["*"],destinations:[{server:"*",namespace:"*"}]};this.projects.set("default",e);return}for(const e of t){const n={name:e.name,description:e.description,sourceRepos:e.sourceRepos||["*"],destinations:e.destinations||[{server:"*",namespace:"*"}]};this.projects.set(n.name,n)}}generateRevision(){return Math.random().toString(36).substring(2,8)}performUpdate(t){this.config&&(this.updateSyncOperations(t),(this.config.autoSync||this.config.syncPolicy==="automated")&&this.triggerAutoSyncs(t),this.config.enableHealthChecks&&this.performHealthChecks(t),this.checkRepositoryConnections(t),this.updateMetrics())}updateSyncOperations(t){const e=Array.from(this.syncOperations.entries());for(const[n,s]of e){if(s.status!=="running")continue;if(!s.startedAt){s.startedAt=t;continue}const i=t-s.startedAt,o=this.config?.averageSyncDuration||3e4;if(i>=o){const c=Math.random()<(this.config?.failureRate||.05);s.status=c?"failed":"success",s.finishedAt=t,c&&(s.error="Sync failed: resource conflict or validation error");const u=this.applications.get(s.application);u&&(s.status==="success"?(u.status="synced",u.health="healthy",u.lastSync=t,u.lastSyncDuration=i,u.revision=u.sourceRevision=this.generateRevision(),u.history||(u.history=[]),u.history.unshift({id:n,revision:u.revision,deployedAt:t}),u.history.length>10&&u.history.pop()):(u.status="degraded",u.health="degraded")),this.addSyncToHistory(s),s.status==="success"?this.argoMetrics.syncOperationsSuccess++:this.argoMetrics.syncOperationsFailed++,this.argoMetrics.syncOperationsRunning--,this.syncOperations.delete(n)}}}triggerAutoSyncs(t){const n=36e5/(this.config?.syncRate||1);for(const s of this.applications.values()){if(s.syncPolicy!=="automated"&&s.syncPolicy!=="auto")continue;const i=this.lastSyncTime.get(s.name)||s.lastSync||0;t-i>=n&&(s.status==="outofsync"||s.status==="synced")&&(this.startSync(s.name,t),this.lastSyncTime.set(s.name,t))}}performHealthChecks(t){const e=this.config?.healthCheckInterval||3e5;for(const n of this.applications.values()){const s=this.lastHealthCheck.get(n.name)||0;t-s>=e&&(Math.random()<.05&&n.health==="healthy"?(n.health="degraded",n.status="degraded"):n.health==="degraded"&&Math.random()<.3&&(n.health="healthy",n.status==="degraded"&&(n.status="synced")),this.lastHealthCheck.set(n.name,t))}}checkRepositoryConnections(t){for(const n of this.repositories.values()){const s=n.lastVerifiedAt||0;t-s>=6e5&&(Math.random()<.95?(n.connectionStatus="successful",n.lastVerifiedAt=t,n.lastConnectionError=void 0):(n.connectionStatus="failed",n.lastConnectionError="Connection timeout or authentication failed",n.lastVerifiedAt=t))}}startSync(t,e=Date.now()){const n=this.applications.get(t);if(!n||Array.from(this.syncOperations.values()).find(c=>c.application===t&&c.status==="running"))return!1;const i=`sync-${t}-${e}`,o={id:i,application:t,startedAt:e,status:"running",phase:"sync"};return this.syncOperations.set(i,o),this.argoMetrics.syncOperationsRunning++,this.argoMetrics.syncOperationsTotal++,n.status="progressing",n.syncStartedAt=e,!0}updateMetrics(){if(this.argoMetrics.applicationsTotal=this.applications.size,this.argoMetrics.applicationsSynced=Array.from(this.applications.values()).filter(t=>t.status==="synced").length,this.argoMetrics.applicationsOutOfSync=Array.from(this.applications.values()).filter(t=>t.status==="outofsync").length,this.argoMetrics.applicationsProgressing=Array.from(this.applications.values()).filter(t=>t.status==="progressing").length,this.argoMetrics.applicationsDegraded=Array.from(this.applications.values()).filter(t=>t.status==="degraded").length,this.argoMetrics.applicationsHealthy=Array.from(this.applications.values()).filter(t=>t.health==="healthy").length,this.argoMetrics.repositoriesTotal=this.repositories.size,this.argoMetrics.repositoriesConnected=Array.from(this.repositories.values()).filter(t=>t.connectionStatus==="successful").length,this.argoMetrics.repositoriesFailed=Array.from(this.repositories.values()).filter(t=>t.connectionStatus==="failed").length,this.argoMetrics.projectsTotal=this.projects.size,this.syncHistory.length>0){const t=Date.now()-36e5,e=this.syncHistory.filter(s=>s.timestamp>=t).length;this.argoMetrics.syncRate=e;const n=this.syncHistory.filter(s=>s.status==="success");if(n.length>0){const s=n.reduce((i,o)=>i+o.duration,0);this.argoMetrics.averageSyncDuration=s/n.length}}}addSyncToHistory(t){if(!t.finishedAt||!t.startedAt)return;const e=t.finishedAt-t.startedAt,n=t.status==="success"?"success":"failed";this.syncHistory.push({timestamp:t.finishedAt,duration:e,status:n}),this.syncHistory.length>this.MAX_SYNC_HISTORY&&this.syncHistory.shift()}getMetrics(){return{...this.argoMetrics}}getApplications(){return Array.from(this.applications.values())}getApplication(t){return this.applications.get(t)}addApplication(t){this.applications.set(t.name,t)}removeApplication(t){return this.applications.delete(t)}updateApplication(t,e){const n=this.applications.get(t);return n?(this.applications.set(t,{...n,...e}),!0):!1}getRepositories(){return Array.from(this.repositories.values())}getRepository(t){return this.repositories.get(t)}addRepository(t){this.repositories.set(t.name,t)}removeRepository(t){return this.repositories.delete(t)}updateRepository(t,e){const n=this.repositories.get(t);return n?(this.repositories.set(t,{...n,...e}),!0):!1}getProjects(){return Array.from(this.projects.values())}getProject(t){return this.projects.get(t)}addProject(t){this.projects.set(t.name,t)}updateProject(t,e){const n=this.projects.get(t);return n?(this.projects.set(t,{...n,...e}),!0):!1}removeProject(t){return this.projects.delete(t)}getSyncOperations(){return Array.from(this.syncOperations.values())}getStats(){return{metrics:this.getMetrics(),applications:this.getApplications(),repositories:this.getRepositories(),projects:this.getProjects(),activeSyncs:this.getSyncOperations()}}}class AT{config=null;workspaces=new Map;activeRuns=new Map;runHistory=new Map;MAX_RUN_HISTORY=1e3;states=new Map;terraformMetrics={workspacesTotal:0,runsTotal:0,runsSuccess:0,runsFailed:0,runsRunning:0,runsPending:0,runsPerHour:0,averageRunDuration:0,statesTotal:0,resourcesManaged:0,requestsTotal:0,requestsErrors:0};runHistoryList=[];MAX_RUN_HISTORY_LIST=1e3;lastRunTime=new Map;lastVCSWebhook=new Map;processRequest(t=!0){this.terraformMetrics.requestsTotal++,t||this.terraformMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={organizationName:e.organizationName||"archiphoenix",enableVCS:e.enableVCS??!0,enableStateLocking:e.enableStateLocking??!0,enableRemoteState:e.enableRemoteState??!0,defaultTerraformVersion:e.defaultTerraformVersion||"1.5.0",workspaces:e.workspaces||[],runs:e.runs||[],states:e.states||[],runTriggerRate:e.runTriggerRate||.5,averagePlanDuration:e.averagePlanDuration||3e4,averageApplyDuration:e.averageApplyDuration||12e4,failureRate:e.failureRate??.05,changeProbability:e.changeProbability??.7,maxResourceAdditions:e.maxResourceAdditions||10,maxResourceChanges:e.maxResourceChanges||5,maxResourceDestructions:e.maxResourceDestructions||3,vcsWebhookProbability:e.vcsWebhookProbability??.3,defaultStateResources:e.defaultStateResources||10,durationVariation:e.durationVariation??.3,resourceTimeMultiplier:e.resourceTimeMultiplier||500},this.initializeWorkspaces(),this.initializeRuns(),this.initializeStates()}updateConfig(t){this.initializeConfig(t)}initializeWorkspaces(){this.workspaces.clear();const t=this.config?.workspaces||[];if(t.length===0){const e={id:"default",name:"production",description:"Production infrastructure",terraformVersion:this.config?.defaultTerraformVersion||"1.5.0",autoApply:!1,queueAllRuns:!0,workingDirectory:"/terraform"};this.workspaces.set("default",e);return}for(const e of t){const n={id:e.id,name:e.name,description:e.description,terraformVersion:e.terraformVersion||this.config?.defaultTerraformVersion||"1.5.0",autoApply:e.autoApply??!1,queueAllRuns:e.queueAllRuns??!0,workingDirectory:e.workingDirectory,vcsRepo:e.vcsRepo,variables:e.variables||[]};this.workspaces.set(n.id,n)}}initializeRuns(){const t=new Set(Array.from(this.activeRuns.keys())),e=new Set((this.config?.runs||[]).map(s=>s.id));for(const[s,i]of this.runHistory.entries())!t.has(s)&&!e.has(s)&&this.runHistory.delete(s);const n=this.config?.runs||[];for(const s of n){const i=this.workspaces.values().next().value;if(!i)continue;const o={id:s.id,workspaceId:i.id,workspaceName:s.workspace||i.name,status:s.status||"applied",createdAt:s.createdAt?new Date(s.createdAt).getTime():Date.now()-36e5,finishedAt:s.createdAt?new Date(s.createdAt).getTime()+(s.duration||12e4):Date.now()-348e4,duration:s.duration||12e4,planOnly:s.planOnly??!1,message:s.message,hasChanges:s.status==="applied"};["pending","planning","applying"].includes(o.status)?this.activeRuns.set(o.id,o):this.runHistory.set(o.id,o)}}initializeStates(){this.states.clear();const t=this.config?.states||[];if(t.length===0){const e=this.config?.defaultStateResources||10;for(const n of this.workspaces.values()){const s={id:`state-${n.id}`,workspaceId:n.id,workspaceName:n.name,version:1,serial:1,resources:e,updatedAt:Date.now()-(36e5+Math.random()*36e5),createdAt:Date.now()-(864e5+Math.random()*864e5)};this.states.set(s.id,s)}return}for(const e of t){const n=Array.from(this.workspaces.values()).find(i=>i.name===e.workspace);if(!n)continue;const s={id:e.id,workspaceId:n.id,workspaceName:e.workspace,version:e.version||1,serial:e.serial||1,resources:e.resources,updatedAt:e.updatedAt?new Date(e.updatedAt).getTime():Date.now(),createdAt:e.updatedAt?new Date(e.updatedAt).getTime()-864e5:Date.now()-864e5};this.states.set(s.id,s)}}performUpdate(t){this.config&&(this.updateActiveRuns(t),this.config.enableVCS&&this.triggerVCSWebhooks(t),this.triggerAutoRuns(t),this.updateMetrics())}updateActiveRuns(t){const e=Array.from(this.activeRuns.entries());for(const[n,s]of e){if(!["pending","planning","applying"].includes(s.status)){if(this.runHistory.set(n,s),this.runHistory.size>this.MAX_RUN_HISTORY){const R=this.runHistory.keys().next().value;R&&this.runHistory.delete(R)}this.activeRuns.delete(n);continue}if(!s.startedAt){s.startedAt=t;continue}const i=t-s.startedAt;let o;const u=this.getStateForWorkspace(s.workspaceId)?.resources||this.config?.defaultStateResources||10,h=this.config?.resourceTimeMultiplier||500,f=this.config?.averagePlanDuration||3e4,m=this.config?.averageApplyDuration||12e4,y=this.config?.durationVariation||.3,v=Math.log10(Math.max(1,u))*h,x=f+v,S=m+v*2;if(s.status==="pending"){s.status="planning";const M=s.estimatedPlanDuration||x,T=M*y*(Math.random()*2-1);o=M+T}else if(s.status==="planning"){const R=x*y*(Math.random()*2-1);if(o=x+R,i>=o){const M=this.config?.changeProbability??.7,T=Math.random()<M;if(s.hasChanges=T,T){const k=this.config?.maxResourceAdditions||10,A=this.config?.maxResourceChanges||5,_=this.config?.maxResourceDestructions||3,P=Math.min(1.5,1+u/100);s.resourceAdditions=Math.floor(Math.random()*k*P)+1,s.resourceChanges=Math.floor(Math.random()*A*P),s.resourceDestructions=Math.floor(Math.random()*_*P)}else s.resourceAdditions=0,s.resourceChanges=0,s.resourceDestructions=0;if(s.planOnly)s.status="planned",s.finishedAt=t,s.duration=i,s.message=T?`Plan completed with ${s.resourceAdditions+s.resourceChanges+s.resourceDestructions} changes`:"No changes detected";else if(this.workspaces.get(s.workspaceId)?.autoApply&&T){s.status="applying";const A=S*y*(Math.random()*2-1);o=S+A}else T?(s.status="planned",s.message=`Plan completed. ${s.resourceAdditions+s.resourceChanges+s.resourceDestructions} changes detected.`):(s.status="applied",s.finishedAt=t,s.duration=i,s.message="No changes detected")}}else if(s.status==="applying"){const R=S*y*(Math.random()*2-1);if(o=S+R,i>=o){const M=this.config?.failureRate??.05,T=Math.random()<M;s.status=T?"errored":"applied",s.finishedAt=t,s.duration=i,T?(s.error="Apply failed: resource provisioning error or validation failure",s.message=s.error):(s.message="Apply completed successfully",this.updateStateAfterApply(s))}}}}updateStateAfterApply(t){const e=Array.from(this.states.values()).find(s=>s.workspaceId===t.workspaceId);if(!e)return;e.version++,e.serial++,e.updatedAt=Date.now(),t.resourceAdditions!==void 0&&(e.resources=(e.resources||0)+t.resourceAdditions,t.resourceDestructions!==void 0&&(e.resources=Math.max(0,e.resources-t.resourceDestructions)));const n=this.workspaces.get(t.workspaceId);n&&(n.lastRun={id:t.id,status:t.status,createdAt:t.finishedAt||Date.now()})}triggerVCSWebhooks(t){for(const n of this.workspaces.values()){if(!n.vcsRepo)continue;const s=this.lastVCSWebhook.get(n.id)||0;if(t-s<36e5)continue;const i=this.config?.vcsWebhookProbability??.3;Math.random()<i&&(this.lastVCSWebhook.set(n.id,t),this.triggerRun(n.id,{source:"vcs"}))}}triggerAutoRuns(t){const n=36e5/(this.config?.runTriggerRate||.5);for(const s of this.workspaces.values()){const i=this.lastRunTime.get(s.id)||0;t-i>=n&&!Array.from(this.activeRuns.values()).some(u=>u.workspaceId===s.id&&["pending","planning","applying"].includes(u.status))&&s.queueAllRuns&&(this.lastRunTime.set(s.id,t),this.triggerRun(s.id,{source:"scheduled"}))}}triggerRun(t,e){const n=this.workspaces.get(t);if(!n)return{success:!1,reason:"Workspace not found"};if(Array.from(this.activeRuns.values()).some(v=>v.workspaceId===t&&["pending","planning","applying"].includes(v.status))&&!n.queueAllRuns)return{success:!1,reason:"Workspace already has an active run"};const i=Date.now(),o=`run-${t}-${i}`,u=this.getStateForWorkspace(t)?.resources||this.config?.defaultStateResources||10,h=this.config?.resourceTimeMultiplier||500,f=this.config?.averagePlanDuration||3e4,m=Math.log10(Math.max(1,u))*h,y={id:o,workspaceId:n.id,workspaceName:n.name,status:"pending",createdAt:i,planOnly:e?.planOnly??!1,source:e?.source||"api",triggeredBy:e?.triggeredBy||"user"};return y.estimatedPlanDuration=f+m,this.activeRuns.set(o,y),this.terraformMetrics.runsTotal++,this.terraformMetrics.runsPending++,n.lastRun={id:o,status:"pending",createdAt:i},{success:!0,runId:o}}cancelRun(t){const e=this.activeRuns.get(t);if(!e)return{success:!1,reason:"Run not found or not active"};if(!["pending","planning","applying"].includes(e.status))return{success:!1,reason:"Run is not in a cancelable state"};if(e.status="canceled",e.finishedAt=Date.now(),e.duration=e.startedAt?Date.now()-e.startedAt:0,e.message="Run canceled by user",this.runHistory.set(t,e),this.runHistory.size>this.MAX_RUN_HISTORY){const n=this.runHistory.keys().next().value;n&&this.runHistory.delete(n)}return this.activeRuns.delete(t),{success:!0}}updateMetrics(){const t=Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values()));this.terraformMetrics.workspacesTotal=this.workspaces.size,this.terraformMetrics.statesTotal=this.states.size,this.terraformMetrics.runsRunning=Array.from(this.activeRuns.values()).filter(i=>["planning","applying"].includes(i.status)).length,this.terraformMetrics.runsPending=Array.from(this.activeRuns.values()).filter(i=>i.status==="pending").length,this.terraformMetrics.runsSuccess=t.filter(i=>i.status==="applied").length,this.terraformMetrics.runsFailed=t.filter(i=>i.status==="errored").length,this.terraformMetrics.resourcesManaged=Array.from(this.states.values()).reduce((i,o)=>i+(o.resources||0),0);const e=t.filter(i=>i.duration!==void 0);if(e.length>0){const i=e.reduce((o,c)=>o+(c.duration||0),0);this.terraformMetrics.averageRunDuration=i/e.length}const n=Date.now()-36e5,s=this.runHistoryList.filter(i=>i.timestamp>=n);this.terraformMetrics.runsPerHour=s.length}addRunToHistory(t){t.duration!==void 0&&(this.runHistoryList.push({timestamp:t.finishedAt||Date.now(),duration:t.duration,status:t.status}),this.runHistoryList.length>this.MAX_RUN_HISTORY_LIST&&this.runHistoryList.shift())}getMetrics(){return{...this.terraformMetrics}}getWorkspace(t){return this.workspaces.get(t)}getWorkspaces(){return Array.from(this.workspaces.values())}getRun(t){return this.activeRuns.get(t)||this.runHistory.get(t)}getActiveRuns(){return Array.from(this.activeRuns.values())}getRunsForWorkspace(t,e=100){return Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values())).filter(s=>s.workspaceId===t).sort((s,i)=>(i.createdAt||0)-(s.createdAt||0)).slice(0,e)}getStateForWorkspace(t){return Array.from(this.states.values()).find(e=>e.workspaceId===t)}getStates(){return Array.from(this.states.values())}getConfig(){return this.config}}class DT{config=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;pushLatencyHistory=[];pullLatencyHistory=[];scanLatencyHistory=[];MAX_LATENCY_HISTORY=500;harborMetrics={pushOperationsPerSecond:0,pullOperationsPerSecond:0,scanOperationsPerSecond:0,replicationOperationsPerSecond:0,averagePushLatency:0,averagePullLatency:0,averageScanLatency:0,storageUsed:0,storageTotal:100,totalProjects:0,totalRepositories:0,totalTags:0,totalVulnerabilities:0,scansCompleted:0,scansRunning:0,scansFailed:0,replicationPoliciesEnabled:0,activeReplications:0,gcOperationsTotal:0,gcStorageFreed:0};lastGCRun=0;initializeConfig(t){const e=t.data.config||{};this.config=e,this.updateMetricsFromConfig()}updateConfig(t){const e=t.data.config||{};this.config=e,this.updateMetricsFromConfig()}updateMetricsFromConfig(){if(!this.config)return;this.harborMetrics.totalProjects=this.config.projects?.length||0,this.harborMetrics.totalRepositories=this.config.repositories?.length||0,this.harborMetrics.totalTags=this.config.tags?.length||0;let t=0;this.config.projects&&(t=this.config.projects.reduce((n,s)=>n+(s.storageUsed||0),0)),this.harborMetrics.storageUsed=t;let e=0;this.config.tags&&this.config.tags.forEach(n=>{n.vulnerabilityScan?.totalVulnerabilities&&(e+=n.vulnerabilityScan.totalVulnerabilities)}),this.harborMetrics.totalVulnerabilities=e,this.harborMetrics.replicationPoliciesEnabled=(this.config.replicationPolicies||[]).filter(n=>n.enabled).length,this.harborMetrics.scansRunning=(this.config.tags||[]).filter(n=>n.vulnerabilityScan?.status==="running").length}performUpdate(t,e=!1){this.config&&(e&&this.simulatePushPullOperations(t),(this.config.enableVulnerabilityScanning||this.config.enableImageScanning)&&this.simulateVulnerabilityScans(t),this.config.replicationPolicies&&this.config.replicationPolicies.length>0&&this.simulateReplication(t),this.config.enableGarbageCollection&&this.simulateGarbageCollection(t),this.updateActiveOperations(t),this.updateMetrics(t))}simulatePushPullOperations(t){if(!this.config?.repositories||this.config.repositories.length===0)return;const e=Math.min(2,.1+this.config.repositories.length/10);if(Math.random()<e/10){const n=this.config.repositories[Math.floor(Math.random()*this.config.repositories.length)];Math.random()<.3?this.simulatePush(n,t):this.simulatePull(n,t)}}simulatePush(t,e){const n=`push-${e}-${Math.random()}`,s=50+Math.random()*500,i=500+Math.random()*1500,o=e+i,c={id:n,type:"push",repository:t.name,project:t.project,startTime:e,status:"running",size:s,completionTime:o};this.activeOperations.set(n,c)}simulatePull(t,e){const n=`pull-${e}-${Math.random()}`,s=200+Math.random()*800,i=e+s,o={id:n,type:"pull",repository:t.name,project:t.project,startTime:e,status:"running",completionTime:i};this.activeOperations.set(n,o)}simulateVulnerabilityScans(t){if(!this.config?.tags)return;const e=this.config.tags.filter(n=>{const s=n.vulnerabilityScan;return!s||s.status==="pending"||s.status==="completed"&&this.shouldRescan(n)});if(e.length!==0){if(this.harborMetrics.scansRunning<3&&Math.random()<.1){const n=e[Math.floor(Math.random()*e.length)];this.startVulnerabilityScan(n.id,t)}this.completeVulnerabilityScans(t)}}startVulnerabilityScan(t,e){if(!this.config?.tags)return;const n=this.config.tags.find(h=>h.id===t);if(!n)return;const s=`scan-${t}-${e}`,i=5e3+Math.random()*15e3,o=e+i,c={id:s,type:"scan",repository:n.repository,tag:n.name,startTime:e,status:"running",completionTime:o};this.activeOperations.set(s,c),this.harborMetrics.scansRunning++;const u=this.config.tags.map(h=>h.id===t?{...h,vulnerabilityScan:{status:"running",severity:"none",scannedAt:new Date(e).toISOString()}}:h);this.config.tags=u}completeVulnerabilityScans(t){}shouldRescan(t){if(!t.vulnerabilityScan?.scannedAt)return!0;const e=new Date(t.vulnerabilityScan.scannedAt).getTime(),n=Date.now()-e,s=10080*60*1e3;return n>s}simulateReplication(t){if(!this.config?.replicationPolicies)return;const e=this.config.replicationPolicies.filter(n=>n.enabled);e.length!==0&&e.forEach(n=>{if(n.trigger==="event-based"&&Math.random()<.05)this.simulateReplicationOperation(n,t);else if(n.trigger==="scheduled"){const s=this.getLastReplicationRun(n.id);t-s>36e5&&(this.simulateReplicationOperation(n,t),this.setLastReplicationRun(n.id,t))}})}lastReplicationRuns=new Map;getLastReplicationRun(t){return this.lastReplicationRuns.get(t)||0}setLastReplicationRun(t,e){this.lastReplicationRuns.set(t,e)}simulateReplicationOperation(t,e){const n=`replication-${t.id}-${e}`,s=2e3+Math.random()*5e3,i=e+s,o={id:n,type:"replication",startTime:e,status:"running",completionTime:i};this.activeOperations.set(n,o),this.harborMetrics.activeReplications++}simulateGarbageCollection(t){this.config?.gcSchedule&&t-this.lastGCRun>1440*60*1e3&&(this.runGarbageCollection(t),this.lastGCRun=t)}runGarbageCollection(t){const e=`gc-${t}`,n=3e4+Math.random()*6e4,s=t+n,i=Math.random()*5,o={id:e,type:"gc",startTime:t,status:"running",completionTime:s,size:i*1024};this.activeOperations.set(e,o)}updateActiveOperations(t){const e=[];for(const[s,i]of this.activeOperations.entries())i.completionTime&&t>=i.completionTime&&i.status==="running"&&e.push(i);for(const s of e)this.completeOperation(s,t);const n=t-6e4;for(const[s,i]of this.activeOperations.entries())i.startTime<n&&i.status==="completed"&&this.activeOperations.delete(s)}completeOperation(t,e){const n=t.completionTime?t.completionTime-t.startTime:0;switch(t.status="completed",t.duration=n,this.activeOperations.delete(t.id),this.addOperationToHistory(t),t.type){case"push":this.config&&t.size&&(this.harborMetrics.storageUsed+=t.size/1024),n>0&&(this.pushLatencyHistory.push(n),this.pushLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pushLatencyHistory.shift());break;case"pull":n>0&&(this.pullLatencyHistory.push(n),this.pullLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pullLatencyHistory.shift());break;case"scan":if(this.config?.tags&&t.id){const s=t.id.match(/^scan-(.+?)-/);if(s){const i=s[1];if(this.config.tags.find(c=>c.id===i)){const c=Math.floor(Math.random()*3),u=Math.floor(Math.random()*5),h=Math.floor(Math.random()*10),f=Math.floor(Math.random()*15),m=c+u+h+f,y=c>0?"critical":u>0?"high":h>0?"medium":f>0?"low":"none",v=this.config.tags.map(x=>x.id===i?{...x,vulnerabilityScan:{status:"completed",severity:y,totalVulnerabilities:m,critical:c,high:u,medium:h,low:f,scannedAt:new Date(e).toISOString(),scanDuration:n}}:x);this.config.tags=v,this.harborMetrics.scansRunning=Math.max(0,this.harborMetrics.scansRunning-1),this.harborMetrics.scansCompleted++,this.scanLatencyHistory.push(n),this.scanLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.scanLatencyHistory.shift()}}}break;case"replication":this.harborMetrics.activeReplications=Math.max(0,this.harborMetrics.activeReplications-1);break;case"gc":if(t.size){const s=t.size/1024;this.harborMetrics.gcOperationsTotal++,this.harborMetrics.gcStorageFreed+=s,this.harborMetrics.storageUsed=Math.max(0,this.harborMetrics.storageUsed-s)}break}}addOperationToHistory(t){this.operationHistory.push(t),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(t){const e=t-1e4,n=this.operationHistory.filter(s=>s.startTime>e);this.harborMetrics.pushOperationsPerSecond=n.filter(s=>s.type==="push").length/10,this.harborMetrics.pullOperationsPerSecond=n.filter(s=>s.type==="pull").length/10,this.harborMetrics.scanOperationsPerSecond=n.filter(s=>s.type==="scan").length/10,this.harborMetrics.replicationOperationsPerSecond=n.filter(s=>s.type==="replication").length/10,this.pushLatencyHistory.length>0&&(this.harborMetrics.averagePushLatency=this.pushLatencyHistory.reduce((s,i)=>s+i,0)/this.pushLatencyHistory.length),this.pullLatencyHistory.length>0&&(this.harborMetrics.averagePullLatency=this.pullLatencyHistory.reduce((s,i)=>s+i,0)/this.pullLatencyHistory.length),this.scanLatencyHistory.length>0&&(this.harborMetrics.averageScanLatency=this.scanLatencyHistory.reduce((s,i)=>s+i,0)/this.scanLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const t=this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond+this.harborMetrics.replicationOperationsPerSecond,e=(this.harborMetrics.averagePushLatency*this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.averagePullLatency*this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.averageScanLatency*this.harborMetrics.scanOperationsPerSecond)/Math.max(1,this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond),n=this.operationHistory.filter(h=>h.status==="failed").length,s=Math.min(1,n/Math.max(1,this.operationHistory.length)),i=Math.min(.95,.1+t/10*.4),o=Math.min(.95,.2+this.harborMetrics.storageUsed/this.harborMetrics.storageTotal*.5),c=this.harborMetrics.storageUsed/this.harborMetrics.storageTotal,u=Math.min(.95,t/20*.6);return{throughput:t,averageLatency:e||0,errorRate:s,cpuUtilization:i,memoryUtilization:o,storageUtilization:c,networkUtilization:u}}getMetrics(){return{...this.harborMetrics}}getConfig(){return this.config?{...this.config}:null}}class _T{config;connected=!1;eventSubscribers=new Set;eventStream=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;reconnectTimeout=3e3;constructor(t){this.config=t}getBaseUrl(){if(this.config.type==="local")return"/api/docker";{const t=this.config.useTLS?"https":"http",e=this.config.host||"localhost",n=this.config.port||2376;return`${t}://${e}:${n}`}}async request(t,e,n,s){const i=`${this.getBaseUrl()}${e}`,o=s?.timeout||this.config.timeout||3e4,c=new AbortController,u=setTimeout(()=>c.abort(),o);try{const h={"Content-Type":"application/json"};this.config.useTLS&&this.config.clientCert&&this.config.clientKey&&(h["X-Client-Cert"]=this.config.clientCert,h["X-Client-Key"]=this.config.clientKey);const f=await fetch(i,{method:t,headers:h,body:n?JSON.stringify(n):void 0,signal:c.signal});if(clearTimeout(u),!f.ok){const y=await f.text();throw new Error(`Docker API error: ${f.status} ${f.statusText} - ${y}`)}const m=f.headers.get("content-type");return m&&m.includes("application/json")?await f.json():{}}catch(h){throw clearTimeout(u),h.name==="AbortError"?new Error(`Request timeout after ${o}ms`):h}}async connect(){try{return await this.getSystemInfo()?(this.connected=!0,this.reconnectAttempts=0,this.startEventStream(),!0):!1}catch(t){return this.connected=!1,console.error("Failed to connect to Docker daemon:",t),!1}}async disconnect(){this.connected=!1,this.stopEventStream(),this.eventSubscribers.clear()}isConnected(){return this.connected}async testConnection(){try{return{success:!!await this.getSystemInfo()}}catch(t){return{success:!1,error:t.message}}}startEventStream(){if(this.eventSubscribers.size!==0)try{const t=`${this.getBaseUrl()}/events`;this.pollEvents()}catch(t){console.error("Failed to start event stream:",t)}}stopEventStream(){this.eventStream&&(this.eventStream.close(),this.eventStream=null)}async pollEvents(){}async listContainers(){return(await this.request("GET","/containers/json?all=true")).map(this.mapContainerFromAPI)}async getContainer(t){try{const e=await this.request("GET",`/containers/${t}/json`);return this.mapContainerFromAPI(e)}catch(e){if(e.message.includes("404"))return null;throw e}}async createContainer(t){const e=this.mapContainerConfigToAPI(t),n=await this.request("POST","/containers/create",e);return await this.getContainer(n.Id)||this.createContainerFromConfig(t,n.Id)}async startContainer(t){await this.request("POST",`/containers/${t}/start`)}async stopContainer(t){await this.request("POST",`/containers/${t}/stop`)}async pauseContainer(t){await this.request("POST",`/containers/${t}/pause`)}async unpauseContainer(t){await this.request("POST",`/containers/${t}/unpause`)}async restartContainer(t){await this.request("POST",`/containers/${t}/restart`)}async removeContainer(t,e=!1){await this.request("DELETE",`/containers/${t}?force=${e}`)}async listImages(){return(await this.request("GET","/images/json")).map(this.mapImageFromAPI)}async pullImage(t,e="latest"){await this.request("POST",`/images/create?fromImage=${t}&tag=${e}`);const s=(await this.listImages()).find(i=>i.repository===t&&i.tag===e);if(!s)throw new Error(`Failed to find pulled image ${t}:${e}`);return s}async buildImage(t){throw new Error("Build image not fully implemented - requires streaming support")}async removeImage(t,e=!1){await this.request("DELETE",`/images/${t}?force=${e}`)}async listNetworks(){return(await this.request("GET","/networks")).map(this.mapNetworkFromAPI)}async createNetwork(t){const e=this.mapNetworkConfigToAPI(t),n=await this.request("POST","/networks/create",e),i=(await this.listNetworks()).find(o=>o.id===n.Id);if(!i)throw new Error(`Failed to find created network ${n.Id}`);return i}async removeNetwork(t){await this.request("DELETE",`/networks/${t}`)}async listVolumes(){return(await this.request("GET","/volumes")).Volumes.map(this.mapVolumeFromAPI)}async createVolume(t){const e=this.mapVolumeConfigToAPI(t),n=await this.request("POST","/volumes/create",e),i=(await this.listVolumes()).find(o=>o.name===n.Name);if(!i)throw new Error(`Failed to find created volume ${n.Name}`);return i}async removeVolume(t){await this.request("DELETE",`/volumes/${t}`)}async getContainerStats(t){try{const e=await this.request("GET",`/containers/${t}/stats?stream=false`);return this.mapStatsFromAPI(e,t)}catch(e){if(e.message.includes("404"))return null;throw e}}async getSystemInfo(){try{const t=await this.request("GET","/info"),e=await this.request("GET","/version");return this.mapSystemInfoFromAPI(t,e)}catch(t){return console.error("Failed to get system info:",t),null}}subscribeToEvents(t){return this.eventSubscribers.add(t),this.connected&&!this.eventStream&&this.startEventStream(),()=>{this.eventSubscribers.delete(t),this.eventSubscribers.size===0&&this.stopEventStream()}}mapContainerFromAPI(t){const n=(t.Names||[])[0]?.replace(/^\//,"")||t.Id?.substring(0,12)||"unknown";return{id:t.Id||t.ID||"",name:n,image:t.Image||"",imageId:t.ImageID||"",status:this.mapContainerStatus(t.Status||t.State||"unknown"),createdAt:t.Created?new Date(t.Created).getTime():Date.now(),startedAt:t.StartedAt?new Date(t.StartedAt).getTime():void 0,finishedAt:t.FinishedAt?new Date(t.FinishedAt).getTime():void 0,restartCount:t.RestartCount||0,ports:this.mapPortsFromAPI(t.Ports),environment:t.Env?this.parseEnvVars(t.Env):void 0,volumes:t.Mounts?t.Mounts.map(s=>s.Name||s.Source):void 0,networks:t.NetworkSettings?Object.keys(t.NetworkSettings.Networks||{}):void 0,health:this.mapHealthStatus(t.Health)}}mapContainerStatus(t){const e=t.toLowerCase();return e.includes("running")?"running":e.includes("paused")?"paused":e.includes("restarting")?"restarting":e.includes("removing")?"removing":e.includes("exited")||e.includes("stopped")?"exited":e.includes("dead")?"dead":"created"}mapPortsFromAPI(t){if(t)return t.map(e=>({containerPort:e.PrivatePort||e.ContainerPort||0,hostPort:e.PublicPort||e.HostPort,protocol:(e.Type||"tcp").toLowerCase()}))}parseEnvVars(t){const e={};for(const n of t){const[s,...i]=n.split("=");s&&(e[s]=i.join("="))}return e}mapHealthStatus(t){if(!t)return"none";const e=t.Status||t.status||"";return e==="healthy"?"healthy":e==="unhealthy"?"unhealthy":e==="starting"?"starting":"none"}mapImageFromAPI(t){const e=t.RepoTags&&t.RepoTags[0]||"<none>:<none>",[n,s]=e.split(":");return{id:t.Id||t.ID||"",repository:n||"<none>",tag:s||"latest",digest:t.RepoDigests?.[0]?.split("@")[1],size:t.Size||0,createdAt:t.Created?new Date(t.Created*1e3).getTime():Date.now(),layers:t.Layers?.length}}mapNetworkFromAPI(t){return{id:t.Id||t.ID||"",name:t.Name||"",driver:t.Driver||"bridge",scope:t.Scope||"local",subnet:t.IPAM?.Config?.[0]?.Subnet,gateway:t.IPAM?.Config?.[0]?.Gateway,containers:t.Containers?Object.keys(t.Containers):void 0,created:t.Created?new Date(t.Created).getTime():Date.now(),internal:t.Internal||!1,enableIPv6:t.EnableIPv6||!1}}mapVolumeFromAPI(t){return{id:t.Name||t.Driver||"",name:t.Name||"",driver:t.Driver||"local",mountpoint:t.Mountpoint,size:t.UsageData?.Size,usedBy:t.UsageData?.RefCount?[t.UsageData.RefCount]:void 0,created:t.CreatedAt?new Date(t.CreatedAt).getTime():Date.now(),labels:t.Labels}}mapStatsFromAPI(t,e){const n=t.cpu_stats?.cpu_usage?.total_usage-(t.precpu_stats?.cpu_usage?.total_usage||0),s=t.cpu_stats?.system_cpu_usage-(t.precpu_stats?.system_cpu_usage||0),i=t.cpu_stats?.online_cpus||1,o=s>0?n/s*i*100:0,c=t.memory_stats?.usage||0,u=t.memory_stats?.limit||0,h=t.networks?Object.values(t.networks).reduce((m,y)=>m+(y.rx_bytes||0),0):0,f=t.networks?Object.values(t.networks).reduce((m,y)=>m+(y.tx_bytes||0),0):0;return{id:e,name:t.name||"",cpuUsage:Math.min(100,Math.max(0,o)),memoryUsage:c,memoryLimit:u,networkRx:h,networkTx:f,timestamp:Date.now()}}mapSystemInfoFromAPI(t,e){return{version:e.Version||"unknown",apiVersion:e.ApiVersion||"unknown",os:t.OperatingSystem||"unknown",arch:t.Architecture||"unknown",kernelVersion:t.KernelVersion||"unknown",totalMemory:t.MemTotal||0,totalCpus:t.NCPU||0,containers:t.Containers||0,containersRunning:t.ContainersRunning||0,containersPaused:t.ContainersPaused||0,containersStopped:t.ContainersStopped||0,images:t.Images||0,imagesSize:0}}mapContainerConfigToAPI(t){const e={Image:t.image,Cmd:t.command,Env:t.env?Object.entries(t.env).map(([n,s])=>`${n}=${s}`):void 0,HostConfig:{}};if(t.ports){e.ExposedPorts={},e.HostConfig.PortBindings={};for(const n of t.ports){const s=`${n.containerPort}/${n.protocol||"tcp"}`;e.ExposedPorts[s]={},n.hostPort&&(e.HostConfig.PortBindings[s]=[{HostPort:n.hostPort.toString()}])}}if(t.volumes&&(e.Volumes={},e.HostConfig.Binds=t.volumes),t.memoryLimit&&(e.HostConfig.Memory=t.memoryLimit),t.cpuLimit){const n=parseFloat(t.cpuLimit);isNaN(n)||(e.HostConfig.CpuQuota=Math.floor(n*1e5),e.HostConfig.CpuPeriod=1e5)}return t.restartPolicy&&(e.HostConfig.RestartPolicy={Name:t.restartPolicy}),t.healthCheck&&(e.Healthcheck={Test:t.healthCheck.test,Interval:t.healthCheck.interval||3e10,Timeout:t.healthCheck.timeout||5e9,Retries:t.healthCheck.retries||3,StartPeriod:t.healthCheck.startPeriod||0}),e}createContainerFromConfig(t,e){return{id:e,name:t.name||e.substring(0,12),image:t.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:t.ports,environment:t.env,volumes:t.volumes,networks:t.networks,health:"none"}}mapNetworkConfigToAPI(t){return{Name:t.name,Driver:t.driver||"bridge",IPAM:t.subnet||t.gateway?{Config:[{Subnet:t.subnet,Gateway:t.gateway}]}:void 0,Internal:t.internal||!1,EnableIPv6:t.enableIPv6||!1,Labels:t.labels}}mapVolumeConfigToAPI(t){return{Name:t.name,Driver:t.driver||"local",Labels:t.labels,DriverOpts:t.options}}}class PT{containers=new Map;images=new Map;networks=new Map;volumes=new Map;eventSubscribers=new Set;statsCache=new Map;systemInfo=null;constructor(t,e,n,s){if(t)for(const i of t)this.containers.set(i.id,{...i});if(e)for(const i of e)this.images.set(i.id,{...i});if(n)for(const i of n)this.networks.set(i.id,{...i});if(s)for(const i of s)this.volumes.set(i.id,{...i});this.systemInfo={version:"24.0.0",apiVersion:"1.43",os:"linux",arch:"amd64",kernelVersion:"5.15.0",totalMemory:16*1024*1024*1024,totalCpus:8,containers:this.containers.size,containersRunning:Array.from(this.containers.values()).filter(i=>i.status==="running").length,containersPaused:Array.from(this.containers.values()).filter(i=>i.status==="paused").length,containersStopped:Array.from(this.containers.values()).filter(i=>i.status==="exited"||i.status==="dead").length,images:this.images.size,imagesSize:Array.from(this.images.values()).reduce((i,o)=>i+o.size,0)}}async connect(){return!0}async disconnect(){this.eventSubscribers.clear()}isConnected(){return!0}async testConnection(){return{success:!0}}async listContainers(){return Array.from(this.containers.values())}async getContainer(t){return this.containers.get(t)||null}async createContainer(t){const e=`sim-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:e,name:t.name||e.substring(0,12),image:t.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:t.ports,environment:t.env,volumes:t.volumes,networks:t.networks,health:"none",memoryLimit:t.memoryLimit};return this.containers.set(e,n),this.emitEvent("container","create",e,{}),n}async startContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",e.startedAt=Date.now(),this.emitEvent("container","start",t,{})}async stopContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="exited",e.finishedAt=Date.now(),e.cpuUsage=0,e.memoryUsage=0,this.emitEvent("container","stop",t,{})}async pauseContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="paused",this.emitEvent("container","pause",t,{})}async unpauseContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",this.emitEvent("container","unpause",t,{})}async restartContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",e.startedAt=Date.now(),e.restartCount=(e.restartCount||0)+1,this.emitEvent("container","restart",t,{})}async removeContainer(t,e=!1){const n=this.containers.get(t);if(!n)throw new Error(`Container ${t} not found`);if(n.status==="running"&&!e)throw new Error("Cannot remove running container without force");this.containers.delete(t),this.statsCache.delete(t),this.emitEvent("container","destroy",t,{})}async listImages(){return Array.from(this.images.values())}async pullImage(t,e="latest"){await new Promise(i=>setTimeout(i,1e3));const n=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:n,repository:t,tag:e,size:100*1024*1024+Math.random()*500*1024*1024,createdAt:Date.now(),pulledAt:Date.now()};return this.images.set(n,s),this.emitEvent("image","pull",n,{repository:t,tag:e}),s}async buildImage(t){await new Promise(o=>setTimeout(o,2e3));const e=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[n,s]=t.tag.split(":"),i={id:e,repository:n||t.tag,tag:s||"latest",size:200*1024*1024+Math.random()*800*1024*1024,createdAt:Date.now(),builtAt:Date.now()};return this.images.set(e,i),this.emitEvent("image","build",e,{tag:t.tag}),i}async removeImage(t,e=!1){if(!this.images.get(t))throw new Error(`Image ${t} not found`);this.images.delete(t),this.emitEvent("image","delete",t,{})}async listNetworks(){return Array.from(this.networks.values())}async createNetwork(t){const e=`net-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:e,name:t.name,driver:t.driver||"bridge",scope:"local",subnet:t.subnet,gateway:t.gateway,created:Date.now(),internal:t.internal||!1,enableIPv6:t.enableIPv6||!1};return this.networks.set(e,n),this.emitEvent("network","create",e,{name:t.name}),n}async removeNetwork(t){if(!this.networks.get(t))throw new Error(`Network ${t} not found`);this.networks.delete(t),this.emitEvent("network","destroy",t,{})}async listVolumes(){return Array.from(this.volumes.values())}async createVolume(t){const e=`vol-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:e,name:t.name,driver:t.driver||"local",created:Date.now(),labels:t.labels};return this.volumes.set(e,n),this.emitEvent("volume","create",e,{name:t.name}),n}async removeVolume(t){if(!this.volumes.get(t))throw new Error(`Volume ${t} not found`);this.volumes.delete(t),this.emitEvent("volume","destroy",t,{})}async getContainerStats(t){const e=this.containers.get(t);if(!e||e.status!=="running")return null;let n=this.statsCache.get(t);return n||(n={id:t,name:e.name,cpuUsage:e.cpuUsage||10+Math.random()*70,memoryUsage:e.memoryUsage||(e.memoryLimit||512*1024*1024)*.3,memoryLimit:e.memoryLimit||512*1024*1024,networkRx:e.networkRx||0,networkTx:e.networkTx||0,timestamp:Date.now()},this.statsCache.set(t,n)),n.cpuUsage=e.cpuUsage||n.cpuUsage,n.memoryUsage=e.memoryUsage||n.memoryUsage,n.networkRx=e.networkRx||n.networkRx,n.networkTx=e.networkTx||n.networkTx,n.timestamp=Date.now(),n}async getSystemInfo(){return this.systemInfo?(this.systemInfo.containers=this.containers.size,this.systemInfo.containersRunning=Array.from(this.containers.values()).filter(t=>t.status==="running").length,this.systemInfo.containersPaused=Array.from(this.containers.values()).filter(t=>t.status==="paused").length,this.systemInfo.containersStopped=Array.from(this.containers.values()).filter(t=>t.status==="exited"||t.status==="dead").length,this.systemInfo.images=this.images.size,this.systemInfo.imagesSize=Array.from(this.images.values()).reduce((t,e)=>t+e.size,0),{...this.systemInfo}):null}subscribeToEvents(t){return this.eventSubscribers.add(t),()=>{this.eventSubscribers.delete(t)}}emitEvent(t,e,n,s){const i={id:`evt-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,action:e,actor:{id:n,attributes:s},time:Math.floor(Date.now()/1e3),timeNano:Date.now()*1e6};for(const o of this.eventSubscribers)try{o(i)}catch(c){console.error("Error in event callback:",c)}}updateContainerStats(t,e){const n=this.containers.get(t);n&&(e.cpuUsage!==void 0&&(n.cpuUsage=e.cpuUsage),e.memoryUsage!==void 0&&(n.memoryUsage=e.memoryUsage),e.memoryLimit!==void 0&&(n.memoryLimit=e.memoryLimit),e.networkRx!==void 0&&(n.networkRx=e.networkRx),e.networkTx!==void 0&&(n.networkTx=e.networkTx))}}class NT{config=null;mode="simulation";simulationProvider=null;realProvider=null;currentProvider=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;operationLatencyHistory=[];MAX_LATENCY_HISTORY=500;containers=new Map;syncInterval=null;syncEnabled=!1;lastSyncTime=0;dockerMetrics={containersTotal:0,containersRunning:0,containersStopped:0,containersPaused:0,imagesTotal:0,imagesSize:0,networksTotal:0,volumesTotal:0,volumesSize:0,operationsPerSecond:0,averageOperationLatency:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryLimit:0,totalNetworkRx:0,totalNetworkTx:0,buildOperationsPerSecond:0,pullOperationsPerSecond:0,pushOperationsPerSecond:0};lastUpdateTime=Date.now();initializeConfig(t){const e=t.data.config||{};if(this.config=e,this.mode=e.mode||"simulation",this.initializeProviders(),e.containers)for(const n of e.containers)this.containers.set(n.id,{...n});this.updateMetricsFromConfig(),this.mode!=="simulation"&&e.syncSettings?.enabled&&this.startSync()}initializeProviders(){if(this.simulationProvider=new PT(this.config?.containers,this.config?.images,this.config?.networks,this.config?.volumes),(this.mode==="real"||this.mode==="hybrid")&&this.config?.dockerConnection){const t={type:this.config.dockerConnection.type,url:this.config.dockerConnection.url,host:this.config.dockerConnection.host,port:this.config.dockerConnection.port,useTLS:this.config.dockerConnection.useTLS,caCert:this.config.dockerConnection.caCert,clientCert:this.config.dockerConnection.clientCert,clientKey:this.config.dockerConnection.clientKey};this.realProvider=new _T(t)}this.currentProvider=this.mode==="simulation"?this.simulationProvider:this.realProvider||this.simulationProvider}setMode(t){this.mode!==t&&(this.mode=t,this.stopSync(),this.initializeProviders(),this.mode!=="simulation"&&this.config?.syncSettings?.enabled&&this.startSync())}getMode(){return this.mode}startSync(){if(this.syncInterval)return;const t=this.config?.syncSettings?.interval||2e3;this.syncEnabled=!0,this.syncFromProvider(),this.syncInterval=setInterval(()=>{this.syncFromProvider()},t),this.config?.syncSettings?.useEvents&&this.currentProvider&&this.currentProvider.subscribeToEvents(e=>{this.handleDockerEvent(e)})}stopSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.syncEnabled=!1}async syncFromProvider(){if(!(!this.currentProvider||!this.currentProvider.isConnected()))try{const t=await this.currentProvider.listContainers();this.syncContainers(t);const e=await this.currentProvider.listImages();this.config&&(this.config.images=e);const n=await this.currentProvider.listNetworks();this.config&&(this.config.networks=n);const s=await this.currentProvider.listVolumes();this.config&&(this.config.volumes=s),this.lastSyncTime=Date.now(),this.updateMetricsFromConfig()}catch(t){console.error("Failed to sync from Docker provider:",t)}}syncContainers(t){for(const n of t){const s=this.containers.get(n.id);s?Object.assign(s,n):this.containers.set(n.id,{...n})}const e=new Set(t.map(n=>n.id));for(const[n]of this.containers.entries())e.has(n)||this.containers.delete(n);this.config&&(this.config.containers=Array.from(this.containers.values()))}handleDockerEvent(t){switch(t.type){case"container":this.handleContainerEvent(t);break;case"image":this.handleImageEvent(t);break;case"network":this.handleNetworkEvent(t);break;case"volume":this.handleVolumeEvent(t);break}}handleContainerEvent(t){const e=t.actor.id;t.action==="destroy"||t.action==="die"?this.containers.delete(e):this.currentProvider&&this.currentProvider.getContainer(e).then(n=>{n&&this.containers.set(e,n)})}handleImageEvent(t){}handleNetworkEvent(t){}handleVolumeEvent(t){}updateConfig(t){const e=t.data.config||{};this.config;const n=this.mode;this.config=e;const s=e.mode||"simulation";if(s!==n&&this.setMode(s),e.containers){const i=new Set(e.containers.map(o=>o.id));for(const[o,c]of this.containers.entries())i.has(o)||this.containers.delete(o);for(const o of e.containers){const c=this.containers.get(o.id);if(c){const u={...c,name:o.name,image:o.image,imageId:o.imageId,ports:o.ports,environment:o.environment,volumes:o.volumes,networks:o.networks,health:o.health,cpuUsage:c.status==="running"?c.cpuUsage:o.cpuUsage,memoryUsage:c.status==="running"?c.memoryUsage:o.memoryUsage,memoryLimit:o.memoryLimit||c.memoryLimit,networkRx:c.status==="running"?c.networkRx:o.networkRx,networkTx:c.status==="running"?c.networkTx:o.networkTx,status:o.status||c.status,createdAt:o.createdAt||c.createdAt,startedAt:o.startedAt||c.startedAt,finishedAt:o.finishedAt||c.finishedAt,restartCount:o.restartCount!==void 0?o.restartCount:c.restartCount,exitCode:o.exitCode!==void 0?o.exitCode:c.exitCode};this.containers.set(o.id,u)}else{const u={id:o.id,name:o.name,image:o.image,imageId:o.imageId,status:o.status||"created",createdAt:o.createdAt||Date.now(),startedAt:o.startedAt,finishedAt:o.finishedAt,restartCount:o.restartCount||0,cpuUsage:o.cpuUsage,memoryUsage:o.memoryUsage,memoryLimit:o.memoryLimit,networkRx:o.networkRx,networkTx:o.networkTx,ports:o.ports,environment:o.environment,volumes:o.volumes,networks:o.networks,health:o.health,exitCode:o.exitCode};this.containers.set(o.id,u)}}}this.updateMetricsFromConfig()}updateMetricsFromConfig(){this.config&&(this.dockerMetrics.containersTotal=this.containers.size,this.dockerMetrics.containersRunning=Array.from(this.containers.values()).filter(t=>t.status==="running").length,this.dockerMetrics.containersStopped=Array.from(this.containers.values()).filter(t=>t.status==="exited"||t.status==="dead").length,this.dockerMetrics.containersPaused=Array.from(this.containers.values()).filter(t=>t.status==="paused").length,this.dockerMetrics.imagesTotal=this.config.images?.length||0,this.dockerMetrics.imagesSize=(this.config.images||[]).reduce((t,e)=>t+e.size,0),this.dockerMetrics.networksTotal=this.config.networks?.length||0,this.dockerMetrics.volumesTotal=this.config.volumes?.length||0,this.dockerMetrics.volumesSize=(this.config.volumes||[]).reduce((t,e)=>t+(e.size||0),0))}performUpdate(t,e=!1){if(!this.config)return;const n=t-this.lastUpdateTime;this.lastUpdateTime=t,this.mode!=="simulation"&&this.currentProvider?.isConnected()&&this.updateContainerStatsFromProvider(),this.mode==="simulation"&&e&&this.simulateContainerOperations(t),this.mode==="simulation"&&this.simulateImageOperations(t,e),this.mode==="simulation"&&this.updateContainerResources(n),this.updateActiveOperations(t),this.updateMetrics(t)}async updateContainerStatsFromProvider(){if(!this.currentProvider)return;const t=Array.from(this.containers.values()).filter(e=>e.status==="running");for(const e of t)try{const n=await this.currentProvider.getContainerStats(e.id);n&&(e.cpuUsage=n.cpuUsage,e.memoryUsage=n.memoryUsage,e.memoryLimit=n.memoryLimit,e.networkRx=n.networkRx,e.networkTx=n.networkTx,this.mode==="hybrid"&&this.simulationProvider&&this.simulationProvider.updateContainerStats(e.id,n))}catch(n){console.error(`Failed to get stats for container ${e.id}:`,n)}}simulateContainerOperations(t){if(this.containers.size===0)return;const e=Math.min(1,.1+this.containers.size/20);if(Math.random()<e/10){const n=Array.from(this.containers.values()),s=n[Math.floor(Math.random()*n.length)];let i;s.status==="running"?i=Math.random()<.1?"stop":Math.random()<.2?"pause":Math.random()<.3?"restart":"create":s.status==="exited"||s.status==="dead"?i=Math.random()<.5?"start":"create":s.status==="paused"?i=Math.random()<.5?"unpause":"stop":i="create",this.simulateContainerOperation(s.id,i,t)}}simulateContainerOperation(t,e,n){if(!this.containers.get(t))return;const i=`${e}-${t}-${n}-${Math.random()}`;let o=100;switch(e){case"create":o=500+Math.random()*1e3;break;case"start":o=200+Math.random()*500;break;case"stop":o=100+Math.random()*300;break;case"pause":o=50+Math.random()*100;break;case"unpause":o=50+Math.random()*100;break;case"restart":o=300+Math.random()*700;break;case"remove":o=200+Math.random()*400;break}const c=n+o,u={id:i,type:e,containerId:t,startTime:n,status:"running",completionTime:c};this.activeOperations.set(i,u)}simulateImageOperations(t,e){if(!this.config?.images||this.config.images.length===0)return;const n=Math.min(.5,.05+this.config.images.length/50);if(e&&Math.random()<n/10){const s=this.config.images[Math.floor(Math.random()*this.config.images.length)],i=Math.random()<.7?"pull":Math.random()<.9?"build":"push";this.simulateImageOperation(s.id,i,t)}}simulateImageOperation(t,e,n){const s=`${e}-${t}-${n}-${Math.random()}`;let i=1e3;switch(e){case"pull":i=2e3+Math.random()*8e3;break;case"push":i=3e3+Math.random()*1e4;break;case"build":i=5e3+Math.random()*15e3;break}const o=n+i,c={id:s,type:e,imageId:t,startTime:n,status:"running",completionTime:o};this.activeOperations.set(s,c)}updateContainerResources(t){const e=Array.from(this.containers.values()).filter(u=>u.status==="running");let n=0,s=0,i=0,o=0,c=0;for(const u of e){const h=10+Math.random()*70,f=(Math.random()-.5)*10;u.cpuUsage=Math.max(0,Math.min(100,h+f));const m=u.memoryLimit||512*1024*1024;if(u.memoryLimit=m,!u.memoryUsage)u.memoryUsage=m*.3;else{const x=1+(Math.random()-.4)*.1;u.memoryUsage=Math.min(m*.95,u.memoryUsage*x)}const v=(1e3+Math.random()*9e3)*t/1e3;u.networkRx=(u.networkRx||0)+v,u.networkTx=(u.networkTx||0)+v*.8,n+=u.cpuUsage,s+=u.memoryUsage,i+=m,o+=u.networkRx||0,c+=u.networkTx||0}this.dockerMetrics.totalCpuUsage=e.length>0?n/e.length:0,this.dockerMetrics.totalMemoryUsage=s,this.dockerMetrics.totalMemoryLimit=i,this.dockerMetrics.totalNetworkRx=o,this.dockerMetrics.totalNetworkTx=c}updateActiveOperations(t){const e=[];for(const[s,i]of this.activeOperations.entries())i.completionTime&&t>=i.completionTime&&i.status==="running"&&e.push(i);for(const s of e)this.completeOperation(s,t);const n=t-6e4;for(const[s,i]of this.activeOperations.entries())i.startTime<n&&i.status==="completed"&&this.activeOperations.delete(s)}completeOperation(t,e){const n=t.completionTime?t.completionTime-t.startTime:0;switch(t.status="completed",t.duration=n,this.activeOperations.delete(t.id),this.addOperationToHistory(t),t.type){case"create":case"start":if(t.containerId){const s=this.containers.get(t.containerId);s&&(s.status="running",s.startedAt=e,s.restartCount=s.restartCount||0)}break;case"stop":if(t.containerId){const s=this.containers.get(t.containerId);s&&(s.status="exited",s.finishedAt=e,s.cpuUsage=0,s.memoryUsage=0)}break;case"pause":if(t.containerId){const s=this.containers.get(t.containerId);s&&(s.status="paused")}break;case"unpause":if(t.containerId){const s=this.containers.get(t.containerId);s&&(s.status="running")}break;case"restart":if(t.containerId){const s=this.containers.get(t.containerId);s&&(s.status="running",s.startedAt=e,s.restartCount=(s.restartCount||0)+1)}break;case"remove":t.containerId&&this.containers.delete(t.containerId);break}n>0&&(this.operationLatencyHistory.push(n),this.operationLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.operationLatencyHistory.shift())}addOperationToHistory(t){this.operationHistory.push(t),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(t){const e=t-1e4,n=this.operationHistory.filter(s=>s.startTime>e);this.dockerMetrics.operationsPerSecond=n.length/10,this.dockerMetrics.buildOperationsPerSecond=n.filter(s=>s.type==="build").length/10,this.dockerMetrics.pullOperationsPerSecond=n.filter(s=>s.type==="pull").length/10,this.dockerMetrics.pushOperationsPerSecond=n.filter(s=>s.type==="push").length/10,this.operationLatencyHistory.length>0&&(this.dockerMetrics.averageOperationLatency=this.operationLatencyHistory.reduce((s,i)=>s+i,0)/this.operationLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const t=this.dockerMetrics.operationsPerSecond,e=this.dockerMetrics.averageOperationLatency,n=this.operationHistory.filter(y=>y.status==="failed").length,s=Math.min(1,n/Math.max(1,this.operationHistory.length)),i=Math.min(.95,this.dockerMetrics.totalCpuUsage/100),o=this.dockerMetrics.totalMemoryLimit>0?Math.min(.95,this.dockerMetrics.totalMemoryUsage/this.dockerMetrics.totalMemoryLimit):.1,c=1e3*1024*1024,u=Math.min(.95,(this.dockerMetrics.totalNetworkRx+this.dockerMetrics.totalNetworkTx)/c*8),h=100*1024*1024*1024,f=this.dockerMetrics.imagesSize+this.dockerMetrics.volumesSize,m=Math.min(.95,f/h);return{throughput:t,averageLatency:e||0,errorRate:s,cpuUtilization:i,memoryUtilization:o,networkUtilization:u,diskUtilization:m}}getMetrics(){return{...this.dockerMetrics}}getConfig(){return this.config?{...this.config}:null}getContainers(){return Array.from(this.containers.values())}getContainer(t){return this.containers.get(t)}getImages(){return this.config?.images||[]}getNetworks(){return this.config?.networks||[]}getVolumes(){return this.config?.volumes||[]}getProvider(){return this.currentProvider}async testConnection(){return this.currentProvider?await this.currentProvider.testConnection():{success:!1,error:"No provider available"}}async connect(){if(!this.currentProvider)return!1;const t=await this.currentProvider.connect();return t&&this.config?.syncSettings?.enabled&&this.startSync(),t}async disconnect(){this.stopSync(),this.currentProvider&&await this.currentProvider.disconnect()}isConnected(){return this.currentProvider?.isConnected()||!1}async createContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");const e={name:t.name,image:t.image,command:t.command,env:t.env,ports:t.ports,volumes:t.volumes,networks:t.networks,memoryLimit:t.memoryLimit,cpuLimit:t.cpuLimit},n=await this.currentProvider.createContainer(e);return this.containers.set(n.id,n),this.config&&(this.config.containers=Array.from(this.containers.values())),n}async startContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.startContainer(t);const e=this.containers.get(t);e&&(e.status="running",e.startedAt=Date.now())}async stopContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.stopContainer(t);const e=this.containers.get(t);e&&(e.status="exited",e.finishedAt=Date.now())}async removeContainerViaProvider(t,e=!1){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.removeContainer(t,e),this.containers.delete(t),this.config&&(this.config.containers=Array.from(this.containers.values()))}async pullImageViaProvider(t,e="latest"){if(!this.currentProvider)throw new Error("No provider available");const n=await this.currentProvider.pullImage(t,e);if(this.config){this.config.images||(this.config.images=[]);const s=this.config.images.findIndex(i=>i.id===n.id);s>=0?this.config.images[s]=n:this.config.images.push(n)}return n}async getSystemInfo(){return this.currentProvider?await this.currentProvider.getSystemInfo():null}}class jT{config=null;pods=new Map;deployments=new Map;services=new Map;configMaps=new Map;secrets=new Map;namespaces=new Map;nodes=new Map;events=[];persistentVolumeClaims=new Map;kubernetesMetrics={podsTotal:0,podsRunning:0,podsPending:0,podsFailed:0,podsSucceeded:0,deploymentsTotal:0,deploymentsReady:0,deploymentsNotReady:0,servicesTotal:0,servicesClusterIP:0,servicesNodePort:0,servicesLoadBalancer:0,nodesTotal:0,nodesReady:0,nodesNotReady:0,totalCpuRequests:0,totalCpuLimits:0,totalMemoryRequests:0,totalMemoryLimits:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryCapacity:0,namespacesTotal:0,configMapsTotal:0,secretsTotal:0};lastUpdateTime=Date.now();updateInterval=1e3;initializeConfig(t){const e=t.data.config||{};this.config=e,this.config.defaultNamespace||(this.config.defaultNamespace="default"),this.config.namespaces||(this.config.namespaces=[]),this.config.namespaces.some(s=>s.name===(this.config?.defaultNamespace||"default"))||this.config.namespaces.push({id:this.generateId(),name:this.config.defaultNamespace,phase:"Active",createdAt:Date.now()}),(!this.config.nodes||this.config.nodes.length===0)&&(this.config.nodes=[{id:this.generateId(),name:"node-1",roles:["worker"],conditions:[{type:"Ready",status:"True",lastTransitionTime:Date.now()}],allocatable:{cpu:"4",memory:"8Gi",pods:"110"},capacity:{cpu:"4",memory:"8Gi",pods:"110"},createdAt:Date.now(),unschedulable:!1,podCount:0}]),this.initializeResources(),this.updateMetricsFromResources()}initializeResources(){if(this.config){if(this.pods.clear(),this.config.pods)for(const t of this.config.pods)this.pods.set(t.id,{...t});if(this.deployments.clear(),this.config.deployments)for(const t of this.config.deployments)this.deployments.set(t.id,{...t});if(this.services.clear(),this.config.services)for(const t of this.config.services)this.services.set(t.id,{...t});if(this.configMaps.clear(),this.config.configMaps)for(const t of this.config.configMaps)this.configMaps.set(t.id,{...t});if(this.secrets.clear(),this.config.secrets)for(const t of this.config.secrets)this.secrets.set(t.id,{...t});if(this.namespaces.clear(),this.config.namespaces)for(const t of this.config.namespaces)this.namespaces.set(t.id,{...t});if(this.nodes.clear(),this.config.nodes)for(const t of this.config.nodes)this.nodes.set(t.id,{...t});if(this.persistentVolumeClaims.clear(),this.config.persistentVolumeClaims)for(const t of this.config.persistentVolumeClaims)this.persistentVolumeClaims.set(t.id,{...t});this.events=this.config.events||[]}}updateConfig(t){const e=t.data.config||{};this.config,this.config=e,this.syncResources(),this.updateMetricsFromResources()}syncResources(){if(this.config){if(this.config.pods){const t=new Set(this.config.pods.map(e=>e.id));for(const[e]of this.pods.entries())t.has(e)||this.pods.delete(e);for(const e of this.config.pods){const n=this.pods.get(e.id);n?this.pods.set(e.id,{...n,...e,totalCpuUsage:n.phase==="Running"?n.totalCpuUsage:e.totalCpuUsage,totalMemoryUsage:n.phase==="Running"?n.totalMemoryUsage:e.totalMemoryUsage,startedAt:e.startedAt||n.startedAt}):this.pods.set(e.id,{...e})}}this.initializeResources()}}updateMetricsFromResources(){this.kubernetesMetrics.podsTotal=this.pods.size,this.kubernetesMetrics.podsRunning=Array.from(this.pods.values()).filter(s=>s.phase==="Running").length,this.kubernetesMetrics.podsPending=Array.from(this.pods.values()).filter(s=>s.phase==="Pending").length,this.kubernetesMetrics.podsFailed=Array.from(this.pods.values()).filter(s=>s.phase==="Failed").length,this.kubernetesMetrics.podsSucceeded=Array.from(this.pods.values()).filter(s=>s.phase==="Succeeded").length,this.kubernetesMetrics.deploymentsTotal=this.deployments.size,this.kubernetesMetrics.deploymentsReady=Array.from(this.deployments.values()).filter(s=>s.readyReplicas===s.replicas&&s.replicas>0).length,this.kubernetesMetrics.deploymentsNotReady=Array.from(this.deployments.values()).filter(s=>s.readyReplicas!==s.replicas||s.replicas===0).length,this.kubernetesMetrics.servicesTotal=this.services.size,this.kubernetesMetrics.servicesClusterIP=Array.from(this.services.values()).filter(s=>s.type==="ClusterIP").length,this.kubernetesMetrics.servicesNodePort=Array.from(this.services.values()).filter(s=>s.type==="NodePort").length,this.kubernetesMetrics.servicesLoadBalancer=Array.from(this.services.values()).filter(s=>s.type==="LoadBalancer").length,this.kubernetesMetrics.nodesTotal=this.nodes.size,this.kubernetesMetrics.nodesReady=Array.from(this.nodes.values()).filter(s=>s.conditions?.some(i=>i.type==="Ready"&&i.status==="True")).length,this.kubernetesMetrics.nodesNotReady=this.kubernetesMetrics.nodesTotal-this.kubernetesMetrics.nodesReady;let t=0,e=0,n=0;for(const s of this.pods.values())s.totalCpuUsage&&(t+=s.totalCpuUsage),s.totalMemoryUsage&&(e+=s.totalMemoryUsage);for(const s of this.nodes.values())s.memoryCapacity&&(n+=s.memoryCapacity);this.kubernetesMetrics.totalCpuUsage=t,this.kubernetesMetrics.totalMemoryUsage=e,this.kubernetesMetrics.totalMemoryCapacity=n,this.kubernetesMetrics.namespacesTotal=this.namespaces.size,this.kubernetesMetrics.configMapsTotal=this.configMaps.size,this.kubernetesMetrics.secretsTotal=this.secrets.size}simulateStep(){const t=Date.now(),e=t-this.lastUpdateTime;this.lastUpdateTime=t,this.simulatePodLifecycle(e),this.simulateDeploymentReconciliation(e),this.simulateNodeMetrics(e),this.updateMetricsFromResources()}simulatePodLifecycle(t){for(const e of this.pods.values())e.phase==="Running"&&(e.totalCpuUsage?e.totalCpuUsage=Math.max(0,Math.min(100,e.totalCpuUsage+(Math.random()-.5)*5)):e.totalCpuUsage=20+Math.random()*60,e.totalMemoryUsage?e.totalMemoryUsage=Math.max(0,e.totalMemoryUsage+(Math.random()-.5)*100*1024*1024):e.totalMemoryUsage=512*1024*1024+Math.random()*(2*1024*1024*1024),e.totalMemoryLimit||(e.totalMemoryLimit=e.totalMemoryUsage*1.5))}simulateDeploymentReconciliation(t){for(const e of this.deployments.values()){const n=Array.from(this.pods.values()).filter(o=>o.namespace!==e.namespace?!1:e.selector?Object.entries(e.selector).every(([c,u])=>o.labels?.[c]===u):!1),s=n.filter(o=>o.phase==="Running"),i=s.filter(o=>o.conditions?.find(u=>u.type==="Ready")?.status==="True");e.readyReplicas=i.length,e.availableReplicas=s.length,e.updatedReplicas=s.length,e.unavailableReplicas=Math.max(0,e.replicas-e.availableReplicas),n.length<e.replicas&&!e.paused&&e.replicas-n.length>0&&Math.random()>.7&&this.createPodForDeployment(e)}}createPodForDeployment(t){const e=`${t.name}-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,n=this.generateId(),s={id:n,name:e,namespace:t.namespace||this.config?.defaultNamespace||"default",labels:t.template?.labels||t.selector,phase:"Pending",status:"Pending",createdAt:Date.now(),restartPolicy:"Always",restartCount:0};this.pods.set(n,s),this.config&&this.config.pods?this.config.pods.push(s):this.config&&(this.config.pods=[s]),setTimeout(()=>{const i=this.pods.get(n);i&&(i.phase="Running",i.status="Running",i.startedAt=Date.now(),i.podIP=`10.244.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i.conditions=[{type:"Ready",status:"True",lastTransitionTime:Date.now()},{type:"PodScheduled",status:"True",lastTransitionTime:Date.now()}])},1e3+Math.random()*2e3)}simulateNodeMetrics(t){for(const e of this.nodes.values()){const n=Array.from(this.pods.values()).filter(o=>o.nodeName===e.name);e.podCount=n.length;let s=0,i=0;for(const o of n)o.totalCpuUsage&&(s+=o.totalCpuUsage),o.totalMemoryUsage&&(i+=o.totalMemoryUsage);e.cpuUsage=Math.min(100,s),e.capacity?.memory&&!e.memoryCapacity&&(e.memoryCapacity=this.parseMemoryString(e.capacity.memory)),e.memoryCapacity&&(e.memoryUsage=Math.min(e.memoryCapacity,i))}}parseMemoryString(t){const e=t.match(/^(\d+)([KMGT]?i?)$/);if(!e)return 0;const n=parseInt(e[1],10),s=e[2].toLowerCase(),i={"":1,k:1024,ki:1024,m:1024*1024,mi:1024*1024,g:1024*1024*1024,gi:1024*1024*1024,t:1024*1024*1024*1024,ti:1024*1024*1024*1024};return n*(i[s]||1)}createEvent(t,e,n,s){const i={id:this.generateId(),name:`${s.name}.${Date.now()}`,namespace:s.namespace||this.config?.defaultNamespace||"default",type:t,reason:e,message:n,involvedObject:s,firstTimestamp:Date.now(),lastTimestamp:Date.now(),count:1};this.events.push(i),this.events.length>1e3&&(this.events=this.events.slice(-1e3)),this.config&&(this.config.events=[...this.events])}syncResourcesToConfig(){this.config&&(this.config.pods=Array.from(this.pods.values()),this.config.deployments=Array.from(this.deployments.values()),this.config.services=Array.from(this.services.values()),this.config.configMaps=Array.from(this.configMaps.values()),this.config.secrets=Array.from(this.secrets.values()),this.config.namespaces=Array.from(this.namespaces.values()),this.config.nodes=Array.from(this.nodes.values()),this.config.events=this.events,this.config.persistentVolumeClaims=Array.from(this.persistentVolumeClaims.values()))}createPod(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const n={...t,id:this.generateId(),createdAt:Date.now(),phase:t.phase||"Pending",status:t.status||"Pending"};return this.pods.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Pod ${n.name} created`,{kind:"Pod",name:n.name,namespace:n.namespace,uid:n.id}),n}updatePod(t,e){const n=this.pods.get(t);if(!n)throw new Error(`Pod with id "${t}" not found`);const s={...n,...e,id:n.id};return this.pods.set(t,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Pod ${n.name} updated`,{kind:"Pod",name:n.name,namespace:n.namespace,uid:n.id}),s}deletePod(t){const e=this.pods.get(t);if(!e)throw new Error(`Pod with id "${t}" not found`);this.pods.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Pod ${e.name} deleted`,{kind:"Pod",name:e.name,namespace:e.namespace,uid:e.id})}createDeployment(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const n={...t,id:this.generateId(),createdAt:Date.now(),readyReplicas:0,availableReplicas:0,updatedReplicas:0,unavailableReplicas:t.replicas,paused:!1};if(this.deployments.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),n.replicas>0)for(let s=0;s<n.replicas;s++)this.createPodForDeployment(n);return this.createEvent("Normal","Created",`Deployment ${n.name} created`,{kind:"Deployment",name:n.name,namespace:n.namespace,uid:n.id}),n}updateDeployment(t,e){const n=this.deployments.get(t);if(!n)throw new Error(`Deployment with id "${t}" not found`);const s=n.replicas,i={...n,...e,id:n.id};if(e.replicas!==void 0&&e.replicas!==s){const o=e.replicas-s;if(o>0)for(let c=0;c<o;c++)this.createPodForDeployment(i);else if(o<0){const u=Array.from(this.pods.values()).filter(h=>h.namespace!==n.namespace?!1:n.selector?Object.entries(n.selector).every(([f,m])=>h.labels?.[f]===m):!1).slice(0,Math.abs(o));for(const h of u)this.deletePod(h.id)}}return this.deployments.set(t,i),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Deployment ${n.name} updated`,{kind:"Deployment",name:n.name,namespace:n.namespace,uid:n.id}),i}deleteDeployment(t){const e=this.deployments.get(t);if(!e)throw new Error(`Deployment with id "${t}" not found`);const n=Array.from(this.pods.values()).filter(s=>s.namespace!==e.namespace?!1:e.selector?Object.entries(e.selector).every(([i,o])=>s.labels?.[i]===o):!1);for(const s of n)this.deletePod(s.id);this.deployments.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Deployment ${e.name} deleted`,{kind:"Deployment",name:e.name,namespace:e.namespace,uid:e.id})}createService(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const n={...t,id:this.generateId(),createdAt:Date.now(),type:t.type||"ClusterIP",clusterIP:t.clusterIP||`10.96.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`};if(n.selector){const s=Array.from(this.pods.values()).filter(i=>i.namespace!==n.namespace?!1:Object.entries(n.selector).every(([o,c])=>i.labels?.[o]===c));n.endpoints=[{addresses:s.filter(i=>i.podIP).map(i=>i.podIP),ports:n.ports?.map(i=>({port:typeof i.targetPort=="number"?i.targetPort:parseInt(i.targetPort,10),protocol:i.protocol||"TCP"}))}]}return this.services.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Service ${n.name} created`,{kind:"Service",name:n.name,namespace:n.namespace,uid:n.id}),n}updateService(t,e){const n=this.services.get(t);if(!n)throw new Error(`Service with id "${t}" not found`);const s={...n,...e,id:n.id};if(e.selector&&s.selector){const i=Array.from(this.pods.values()).filter(o=>o.namespace!==n.namespace?!1:Object.entries(s.selector).every(([c,u])=>o.labels?.[c]===u));s.endpoints=[{addresses:i.filter(o=>o.podIP).map(o=>o.podIP),ports:s.ports?.map(o=>({port:typeof o.targetPort=="number"?o.targetPort:parseInt(o.targetPort,10),protocol:o.protocol||"TCP"}))}]}return this.services.set(t,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Service ${n.name} updated`,{kind:"Service",name:n.name,namespace:n.namespace,uid:n.id}),s}deleteService(t){const e=this.services.get(t);if(!e)throw new Error(`Service with id "${t}" not found`);this.services.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Service ${e.name} deleted`,{kind:"Service",name:e.name,namespace:e.namespace,uid:e.id})}createConfigMap(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const n={...t,id:this.generateId(),createdAt:Date.now(),data:t.data||{}};return this.configMaps.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`ConfigMap ${n.name} created`,{kind:"ConfigMap",name:n.name,namespace:n.namespace,uid:n.id}),n}updateConfigMap(t,e){const n=this.configMaps.get(t);if(!n)throw new Error(`ConfigMap with id "${t}" not found`);if(n.immutable)throw new Error(`ConfigMap "${n.name}" is immutable`);const s={...n,...e,id:n.id};return this.configMaps.set(t,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`ConfigMap ${n.name} updated`,{kind:"ConfigMap",name:n.name,namespace:n.namespace,uid:n.id}),s}deleteConfigMap(t){const e=this.configMaps.get(t);if(!e)throw new Error(`ConfigMap with id "${t}" not found`);this.configMaps.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`ConfigMap ${e.name} deleted`,{kind:"ConfigMap",name:e.name,namespace:e.namespace,uid:e.id})}createSecret(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const n=t.data||{};if(t.stringData)for(const[i,o]of Object.entries(t.stringData))n[i]=btoa(o);const s={...t,id:this.generateId(),createdAt:Date.now(),type:t.type||"Opaque",data:n};return this.secrets.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Secret ${s.name} created`,{kind:"Secret",name:s.name,namespace:s.namespace,uid:s.id}),s}updateSecret(t,e){const n=this.secrets.get(t);if(!n)throw new Error(`Secret with id "${t}" not found`);if(n.immutable)throw new Error(`Secret "${n.name}" is immutable`);const s={...n,...e,id:n.id};if(e.stringData){s.data={...s.data};for(const[i,o]of Object.entries(e.stringData))s.data[i]=btoa(o)}return this.secrets.set(t,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Secret ${n.name} updated`,{kind:"Secret",name:n.name,namespace:n.namespace,uid:n.id}),s}deleteSecret(t){const e=this.secrets.get(t);if(!e)throw new Error(`Secret with id "${t}" not found`);this.secrets.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Secret ${e.name} deleted`,{kind:"Secret",name:e.name,namespace:e.namespace,uid:e.id})}createNamespace(t){if(!this.config)throw new Error("Engine not initialized");if(Array.from(this.namespaces.values()).find(s=>s.name===t.name))throw new Error(`Namespace "${t.name}" already exists`);const n={...t,id:this.generateId(),createdAt:Date.now(),phase:"Active"};return this.namespaces.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Namespace ${n.name} created`,{kind:"Namespace",name:n.name,uid:n.id}),n}deleteNamespace(t){const e=this.namespaces.get(t);if(!e)throw new Error(`Namespace with id "${t}" not found`);if(e.name==="default"||e.name===this.config?.defaultNamespace)throw new Error("Cannot delete default namespace");const n=Array.from(this.pods.values()).some(o=>o.namespace===e.name),s=Array.from(this.deployments.values()).some(o=>o.namespace===e.name),i=Array.from(this.services.values()).some(o=>o.namespace===e.name);if(n||s||i)throw new Error(`Namespace "${e.name}" contains resources and cannot be deleted`);this.namespaces.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Namespace ${e.name} deleted`,{kind:"Namespace",name:e.name,uid:e.id})}getPods(){return Array.from(this.pods.values())}getPodsByNamespace(t){return Array.from(this.pods.values()).filter(e=>e.namespace===t)}getDeployments(){return Array.from(this.deployments.values())}getDeploymentsByNamespace(t){return Array.from(this.deployments.values()).filter(e=>e.namespace===t)}getServices(){return Array.from(this.services.values())}getServicesByNamespace(t){return Array.from(this.services.values()).filter(e=>e.namespace===t)}getConfigMaps(){return Array.from(this.configMaps.values())}getConfigMapsByNamespace(t){return Array.from(this.configMaps.values()).filter(e=>e.namespace===t)}getSecrets(){return Array.from(this.secrets.values())}getSecretsByNamespace(t){return Array.from(this.secrets.values()).filter(e=>e.namespace===t)}getNamespaces(){return Array.from(this.namespaces.values())}getNodes(){return Array.from(this.nodes.values())}getEvents(){return[...this.events]}getEventsByNamespace(t){return this.events.filter(e=>e.namespace===t)}getPersistentVolumeClaims(){return Array.from(this.persistentVolumeClaims.values())}getMetrics(){return{...this.kubernetesMetrics}}getLoad(){const t=Array.from(this.nodes.values()).reduce((u,h)=>{if(h.capacity?.cpu){const f=parseFloat(h.capacity.cpu);return u+f*1e3}return u},0),e=this.kubernetesMetrics.totalCpuUsage,n=t>0?e/t:0,s=this.kubernetesMetrics.totalMemoryCapacity>0?this.kubernetesMetrics.totalMemoryUsage/this.kubernetesMetrics.totalMemoryCapacity:0,i=Array.from(this.nodes.values()).reduce((u,h)=>h.capacity?.pods?u+parseInt(h.capacity.pods,10):u,0),o=i>0?this.kubernetesMetrics.podsTotal/i:0,c=this.kubernetesMetrics.podsTotal>0?this.kubernetesMetrics.podsFailed/this.kubernetesMetrics.podsTotal:0;return{throughput:this.kubernetesMetrics.podsRunning*10,averageLatency:100+Math.random()*200,errorRate:c,cpuUtilization:Math.min(1,n),memoryUtilization:Math.min(1,s),podUtilization:Math.min(1,o),networkUtilization:.1+Math.random()*.3,diskUtilization:.2+Math.random()*.2}}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getConfig(){return this.config?(this.syncResourcesToConfig(),{...this.config}):null}}class LT{config=null;inventories=new Map;projects=new Map;credentials=new Map;jobTemplates=new Map;activeJobs=new Map;jobHistory=new Map;MAX_JOB_HISTORY=1e3;schedules=new Map;ansibleMetrics={inventoriesTotal:0,projectsTotal:0,credentialsTotal:0,jobTemplatesTotal:0,jobTemplatesEnabled:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,jobsPerHour:0,averageJobDuration:0,hostsTotal:0,hostsOk:0,hostsChanged:0,hostsFailed:0,hostsUnreachable:0,schedulesTotal:0,schedulesEnabled:0,requestsTotal:0,requestsErrors:0};jobHistoryList=[];MAX_JOB_HISTORY_LIST=1e3;lastJobTime=new Map;scheduleNextRuns=new Map;processRequest(t=!0){this.ansibleMetrics.requestsTotal++,t||this.ansibleMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={towerUrl:e.towerUrl||"https://tower.example.com",organizationName:e.organizationName||"Default",defaultExecutionEnvironment:e.defaultExecutionEnvironment||"default",inventories:e.inventories||[],projects:e.projects||[],credentials:e.credentials||[],jobTemplates:e.jobTemplates||[],jobs:e.jobs||[],schedules:e.schedules||[],jobTriggerRate:e.jobTriggerRate||.5,averageJobDuration:e.averageJobDuration||12e4,failureRate:e.failureRate??.05,hostFailureRate:e.hostFailureRate??.02,playbookComplexity:e.playbookComplexity??.5,maxForks:e.maxForks||5,defaultTimeout:e.defaultTimeout||3600},this.initializeInventories(),this.initializeProjects(),this.initializeCredentials(),this.initializeJobTemplates(),this.initializeJobs(),this.initializeSchedules()}updateConfig(t){this.initializeConfig(t)}initializeInventories(){this.inventories.clear();const t=this.config?.inventories||[];if(t.length===0){const e={id:"default",name:"Default",description:"Default inventory",type:"static",organization:this.config?.organizationName||"Default",hosts:[],groups:[]};this.inventories.set("default",e);return}for(const e of t){const n={id:e.id,name:e.name,description:e.description,type:e.type||"static",organization:this.config?.organizationName||"Default",hosts:(e.hosts||[]).map((s,i)=>({id:s.id||`host-${e.id}-${i}`,name:s.name,enabled:!0,groups:s.groups||[],variables:s.variables||{}})),groups:(e.groups||[]).map((s,i)=>({id:s.id||`group-${e.id}-${i}`,name:s.name,hosts:s.hosts||[],variables:s.variables||{},children:s.children||[]}))};this.inventories.set(n.id,n)}}initializeProjects(){this.projects.clear();const t=this.config?.projects||[];if(t.length===0){const e={id:"default",name:"Default",description:"Default project",organization:this.config?.organizationName||"Default",scmType:"manual",playbooks:["playbook.yml"]};this.projects.set("default",e);return}for(const e of t){const n={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",scmType:e.scmType||"manual",scmUrl:e.scmUrl,scmBranch:e.scmBranch||"main",playbooks:e.playbooks||["playbook.yml"],status:"successful",lastUpdateTime:Date.now()-Math.random()*864e5};this.projects.set(n.id,n)}}initializeCredentials(){this.credentials.clear();const t=this.config?.credentials||[];for(const e of t){const n={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",credentialType:e.credentialType||"machine",username:e.username,password:e.password,sshKey:e.sshKey,becomeMethod:e.becomeMethod,becomeUsername:e.becomeUsername};this.credentials.set(n.id,n)}}initializeJobTemplates(){this.jobTemplates.clear();const t=this.config?.jobTemplates||[];for(const e of t){const n={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",inventory:e.inventory,project:e.project,playbook:e.playbook,credential:e.credential,enabled:e.enabled!==!1,jobType:e.jobType||"run",becomeEnabled:e.becomeEnabled,becomeUser:e.becomeUser,forks:e.forks||this.config?.maxForks||5,timeout:e.timeout||this.config?.defaultTimeout||3600,verbosity:e.verbosity||0};this.jobTemplates.set(n.id,n)}}initializeJobs(){const t=new Set(Array.from(this.activeJobs.keys())),e=new Set((this.config?.jobs||[]).map(s=>s.id));for(const[s,i]of this.jobHistory.entries())!t.has(s)&&!e.has(s)&&this.jobHistory.delete(s);const n=this.config?.jobs||[];for(const s of n){const i={id:s.id,name:s.name||`Job ${s.id}`,type:s.type||"job",status:s.status||"successful",jobTemplate:s.jobTemplate,created:s.startedAt?new Date(s.startedAt).getTime():Date.now()-36e5,started:s.startedAt?new Date(s.startedAt).getTime():void 0,finished:s.finishedAt?new Date(s.finishedAt).getTime():void 0,elapsed:s.duration,hosts:s.hosts?.map((o,c)=>({id:`host-${s.id}-${c}`,name:o.name,status:o.status,failed:o.status==="failed"||o.status==="unreachable",changed:o.status==="changed",unreachable:o.status==="unreachable",skipped:o.status==="skipped"}))};["new","pending","waiting","running"].includes(i.status)?this.activeJobs.set(i.id,i):this.jobHistory.set(i.id,i)}}initializeSchedules(){this.schedules.clear();const t=this.config?.schedules||[];for(const e of t){const n={id:e.id,name:e.name,unifiedJobTemplate:e.unifiedJobTemplate,enabled:e.enabled!==!1,rrule:e.rrule||`DTSTART:20240101T000000Z
RRULE:FREQ=HOURLY;INTERVAL=1`,nextRun:Date.now()+36e5};this.schedules.set(n.id,n),this.scheduleNextRuns.set(n.id,n.nextRun||Date.now()+36e5)}}performUpdate(t){this.config&&(this.updateActiveJobs(t),this.triggerScheduledJobs(t),this.triggerAutomaticJobs(t),this.updateMetrics())}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[n,s]of e){if(!["new","pending","waiting","running"].includes(s.status)){if(this.jobHistory.set(n,s),this.jobHistory.size>this.MAX_JOB_HISTORY){const m=this.jobHistory.keys().next().value;m&&this.jobHistory.delete(m)}this.activeJobs.delete(n);continue}if(!s.started){s.started=t,s.status="running";continue}const i=(t-s.started)/1e3,o=this.config?.averageJobDuration||12e4,c=this.config?.playbookComplexity||.5,f=o*(1+c*.5)*(1+(Math.random()-.5)*.3)/1e3;if(i>=f){if(Math.random()<(this.config?.failureRate||.05)?s.status="failed":s.status="successful",s.finished=t,s.elapsed=i,s.hosts&&s.hosts.length>0){const y=this.config?.hostFailureRate||.02;for(const v of s.hosts)s.status==="failed"?Math.random()<y*2?(v.status=Math.random()<.5?"failed":"unreachable",v.failed=!0):Math.random()<.3?(v.status="changed",v.changed=!0):v.status="ok":Math.random()<y?(v.status="unreachable",v.unreachable=!0):Math.random()<.4?(v.status="changed",v.changed=!0):v.status="ok"}s.hosts&&(s.resultSummary={ok:s.hosts.filter(y=>y.status==="ok").length,changed:s.hosts.filter(y=>y.status==="changed").length,unreachable:s.hosts.filter(y=>y.status==="unreachable").length,failed:s.hosts.filter(y=>y.status==="failed").length,skipped:s.hosts.filter(y=>y.status==="skipped").length}),this.jobHistoryList.push({timestamp:t,duration:i,status:s.status}),this.jobHistoryList.length>this.MAX_JOB_HISTORY_LIST&&this.jobHistoryList.shift()}else if(s.elapsed=i,s.hosts){const m=i/f;for(let y=0;y<s.hosts.length;y++)m+(Math.random()-.5)*.2>=.9&&s.hosts[y].status==="ok"&&Math.random()<.3&&(s.hosts[y].status="changed",s.hosts[y].changed=!0)}}}triggerScheduledJobs(t){for(const[e,n]of this.schedules.entries()){if(!n.enabled)continue;const s=this.scheduleNextRuns.get(e);if(!s||t<s)continue;const i=this.jobTemplates.get(n.unifiedJobTemplate);if(!i||!i.enabled)continue;this.launchJobFromTemplate(i.id,n.extraData||{});const o=t+36e5;this.scheduleNextRuns.set(e,o),n.nextRun=o,n.lastRun=t}}triggerAutomaticJobs(t){if(!this.config)return;const n=36e5/(this.config.jobTriggerRate||.5);for(const[s,i]of this.jobTemplates.entries()){if(!i.enabled)continue;const o=this.lastJobTime.get(s)||0;t-o>=n&&Math.random()<.1&&(this.launchJobFromTemplate(s),this.lastJobTime.set(s,t))}}launchJobFromTemplate(t,e){const n=this.jobTemplates.get(t);if(!n||!n.enabled)return null;const s=this.inventories.get(n.inventory);if(!s)return null;const i=this.projects.get(n.project);if(!i)return null;const o=`job-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,c=s.hosts||[],u={id:o,name:`${n.name} - ${new Date().toISOString()}`,type:"job",status:"pending",jobTemplate:t,jobTemplateName:n.name,inventory:n.inventory,inventoryName:s.name,project:n.project,projectName:i.name,playbook:n.playbook,credential:n.credential,vaultCredential:n.vaultCredential,organization:n.organization,created:Date.now(),jobType:n.jobType,becomeEnabled:n.becomeEnabled,forks:n.forks||this.config?.maxForks||5,limit:n.limit||e?.limit,verbosity:n.verbosity||0,extraVars:n.extraVars||e?.extraVars,jobTags:n.jobTags||e?.jobTags,skipTags:n.skipTags||e?.skipTags,timeout:n.timeout||this.config?.defaultTimeout||3600,hosts:c.map((h,f)=>({id:h.id,name:h.name,status:"ok",failed:!1,changed:!1,unreachable:!1,skipped:!1}))};return this.activeJobs.set(o,u),n.lastJobRun=o,n.lastJobStatus="running",n.lastJobStarted=Date.now(),u}updateMetrics(){this.ansibleMetrics.inventoriesTotal=this.inventories.size,this.ansibleMetrics.projectsTotal=this.projects.size,this.ansibleMetrics.credentialsTotal=this.credentials.size,this.ansibleMetrics.jobTemplatesTotal=this.jobTemplates.size,this.ansibleMetrics.jobTemplatesEnabled=Array.from(this.jobTemplates.values()).filter(h=>h.enabled).length;const t=[...this.activeJobs.values(),...this.jobHistory.values()];this.ansibleMetrics.jobsTotal=t.length,this.ansibleMetrics.jobsSuccess=t.filter(h=>h.status==="successful").length,this.ansibleMetrics.jobsFailed=t.filter(h=>h.status==="failed"||h.status==="error").length,this.ansibleMetrics.jobsRunning=this.activeJobs.size,this.ansibleMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(h=>h.status==="pending"||h.status==="waiting").length;const e=Date.now()-36e5,n=this.jobHistoryList.filter(h=>h.timestamp>=e);if(this.ansibleMetrics.jobsPerHour=n.length,this.jobHistoryList.length>0){const h=this.jobHistoryList.reduce((f,m)=>f+m.duration,0);this.ansibleMetrics.averageJobDuration=h/this.jobHistoryList.length}else this.ansibleMetrics.averageJobDuration=0;let s=0,i=0,o=0,c=0,u=0;for(const h of this.inventories.values())s+=h.hosts?.length||0;for(const h of this.activeJobs.values())if(h.hosts)for(const f of h.hosts)f.status==="ok"&&i++,f.status==="changed"&&o++,f.status==="failed"&&c++,f.status==="unreachable"&&u++;this.ansibleMetrics.hostsTotal=s,this.ansibleMetrics.hostsOk=i,this.ansibleMetrics.hostsChanged=o,this.ansibleMetrics.hostsFailed=c,this.ansibleMetrics.hostsUnreachable=u,this.ansibleMetrics.schedulesTotal=this.schedules.size,this.ansibleMetrics.schedulesEnabled=Array.from(this.schedules.values()).filter(h=>h.enabled).length}getMetrics(){return{...this.ansibleMetrics}}getInventories(){return Array.from(this.inventories.values())}getProjects(){return Array.from(this.projects.values())}getCredentials(){return Array.from(this.credentials.values())}getJobTemplates(){return Array.from(this.jobTemplates.values())}getActiveJobs(){return Array.from(this.activeJobs.values())}getAllJobs(){return[...Array.from(this.activeJobs.values()),...Array.from(this.jobHistory.values())]}getJob(t){return this.activeJobs.get(t)||this.jobHistory.get(t)}getSchedules(){return Array.from(this.schedules.values())}getJobLogs(t){const e=this.getJob(t);if(!e)return[];const n=[];if(n.push(`Starting job ${e.name} (ID: ${e.id})`),n.push(`Job Template: ${e.jobTemplateName||"N/A"}`),n.push(`Inventory: ${e.inventoryName||"N/A"}`),n.push(`Playbook: ${e.playbook||"N/A"}`),e.hosts){n.push(`
Running on ${e.hosts.length} host(s)...`);for(const s of e.hosts)n.push(`
${s.name}:`),s.status==="ok"?n.push("  OK - Task completed successfully"):s.status==="changed"?n.push("  CHANGED - Task made changes to the system"):s.status==="failed"?n.push("  FAILED - Task failed to execute"):s.status==="unreachable"?n.push("  UNREACHABLE - Host is unreachable"):s.status==="skipped"&&n.push("  SKIPPED - Task was skipped")}return e.resultSummary&&(n.push(`
PLAY RECAP`),n.push(`ok: ${e.resultSummary.ok}, changed: ${e.resultSummary.changed}, unreachable: ${e.resultSummary.unreachable}, failed: ${e.resultSummary.failed}, skipped: ${e.resultSummary.skipped}`)),e.status==="successful"?n.push(`
Job completed successfully in ${e.elapsed?.toFixed(2)}s`):e.status==="failed"&&n.push(`
Job failed after ${e.elapsed?.toFixed(2)}s`),n}cancelJob(t){const e=this.activeJobs.get(t);return!e||!["pending","waiting","running"].includes(e.status)?!1:(e.status="canceled",e.canceled=!0,e.canceledBy="user",e.finished=Date.now(),e.started&&(e.elapsed=(Date.now()-e.started)/1e3),this.jobHistory.set(t,e),this.activeJobs.delete(t),!0)}}class zT{routers=new Map;services=new Map;middlewares=new Map;entryPoints=new Map;globalConfig={};roundRobinCounters=new Map;connectionCounts=new Map;serverHealthStatus=new Map;serverCheckFailures=new Map;serverCheckSuccesses=new Map;healthCheckTimers=new Map;rateLimitTracker=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;totalLatency=0;latencyCount=0;initialize(t){this.routers.clear(),this.services.clear(),this.middlewares.clear(),this.entryPoints.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.serverHealthStatus.clear(),this.serverCheckFailures.clear(),this.serverCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.entryPoints)for(const e of t.entryPoints)this.entryPoints.set(e.name,e);else this.entryPoints.set("web",{name:"web",address:":80"}),this.entryPoints.set("websecure",{name:"websecure",address:":443"});if(t.routers)for(const e of t.routers)this.routers.set(e.name,{...e,priority:e.priority||0,requests:e.requests||0,responses:e.responses||0,errors:e.errors||0,bytesIn:e.bytesIn||0,bytesOut:e.bytesOut||0});if(t.services){for(const e of t.services)if(this.services.set(e.name,e),this.roundRobinCounters.set(e.name,0),e.loadBalancer?.healthCheck?.enabled&&e.loadBalancer.servers)for(const n of e.loadBalancer.servers)this.startHealthCheck(e.name,n.url,e.loadBalancer.healthCheck)}if(t.middlewares)for(const e of t.middlewares)this.middlewares.set(e.name,e);this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.latencyCount=0}routeRequest(t){const e=Date.now();this.requestCount++;const n=this.globalConfig.maxConnections||1e4;if(this.activeConnections>=n)return this.connectionRejects++,this.errorCount++,{router:null,service:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-e}};this.activeConnections++;const s=this.findMatchingRouter(t);if(!s)return this.activeConnections--,this.errorCount++,{router:null,service:null,response:{status:404,error:"No matching router found",latency:Date.now()-e}};s.requests=(s.requests||0)+1;let i={...t};const o=[];if(s.middlewares&&s.middlewares.length>0)for(const M of s.middlewares){const T=this.middlewares.get(M);if(T){const k=this.applyMiddleware(T,i);if(k.block)return this.activeConnections--,this.errorCount++,s.errors=(s.errors||0)+1,{router:s,service:null,response:{status:k.status||403,error:k.error||"Middleware blocked request",latency:Date.now()-e,routerMatched:s.name},middlewaresApplied:o};k.request&&(i=k.request),o.push(M)}}const c=this.services.get(s.service);if(!c)return this.activeConnections--,this.errorCount++,s.errors=(s.errors||0)+1,{router:s,service:null,response:{status:503,error:`Service ${s.service} not found`,latency:Date.now()-e,routerMatched:s.name},middlewaresApplied:o};const u=this.selectServer(c,i);if(!u)return this.activeConnections--,this.errorCount++,s.errors=(s.errors||0)+1,{router:s,service:c,response:{status:503,error:"No healthy server available",latency:Date.now()-e,routerMatched:s.name},middlewaresApplied:o};const h=5+Math.random()*95,f=s.tls?.enabled?5+Math.random()*15:0,m=this.globalConfig.responseTimeout||3e4,y=h+f;if(y>m)return this.activeConnections--,this.errorCount++,s.errors=(s.errors||0)+1,{router:s,service:c,response:{status:504,error:"Response timeout",latency:m,serviceTarget:c.name,serverTarget:u,routerMatched:s.name},middlewaresApplied:o};const v={status:200,body:{proxied:!0,service:c.name,server:u},latency:y,serviceTarget:c.name,serverTarget:u,routerMatched:s.name},x=1024,S=2048;s.bytesIn=(s.bytesIn||0)+x,s.bytesOut=(s.bytesOut||0)+S,s.responses=(s.responses||0)+1,s.averageLatency=((s.averageLatency||0)*(s.responses-1)+y)/s.responses,c.totalRequests=(c.totalRequests||0)+1,c.totalResponses=(c.totalResponses||0)+1,this.totalBytesIn+=x,this.totalBytesOut+=S,this.responseCount++,this.activeConnections--,this.totalLatency+=y,this.latencyCount++;const R=this.connectionCounts.get(u)||0;return this.connectionCounts.set(u,R+1),{router:s,service:c,response:v,middlewaresApplied:o}}findMatchingRouter(t){let e=[];for(const n of this.routers.values())t.entryPoint&&!n.entryPoints.includes(t.entryPoint)||this.evaluateRule(n.rule,t)&&e.push(n);return e.sort((n,s)=>(s.priority||0)-(n.priority||0)),e.length>0?e[0]:null}evaluateRule(t,e){try{const n=t.split("&&").map(s=>s.trim());for(const s of n){if(s.startsWith("Host(")){const i=s.match(/Host\(`([^`]+)`\)/);if(i){const o=i[1],c=e.host||e.headers?.Host||"";if(c!==o&&!c.endsWith(`.${o}`))return!1}}if(s.startsWith("PathPrefix(")){const i=s.match(/PathPrefix\(`([^`]+)`\)/);if(i){const o=i[1];if(!e.path.startsWith(o))return!1}}if(s.startsWith("Path(")&&!s.startsWith("PathPrefix(")){const i=s.match(/Path\(`([^`]+)`\)/);if(i){const o=i[1];if(e.path!==o)return!1}}if(s.startsWith("Method(")){const i=s.match(/Method\(`([^`]+)`\)/);if(i){const o=i[1];if(e.method.toUpperCase()!==o.toUpperCase())return!1}}}return!0}catch(n){return console.warn("Failed to parse Traefik rule:",t,n),!0}}applyMiddleware(t,e){switch(t.type){case"rateLimit":return this.applyRateLimit(t,e);case"ipAllowList":case"ipWhiteList":return this.applyIPAllowList(t,e);case"auth":case"basicAuth":case"digestAuth":return this.applyAuth(t,e);case"headers":return this.applyHeaders(t,e);case"redirect":return this.applyRedirect(t,e);case"stripPrefix":return this.applyStripPrefix(t,e);case"addPrefix":return this.applyAddPrefix(t,e);default:return{block:!1,request:e}}}applyRateLimit(t,e){if(!t.config)return{block:!1};const n=t.config.average||100,s=t.config.burst||50,i=this.parsePeriod(t.config.period||"1s"),o=e.clientIP||"0.0.0.0",c=`${t.name}:${o}`,u=Date.now();let h=this.rateLimitTracker.get(c);return(!h||h.resetAt<u)&&(h={count:0,resetAt:u+i,burst:s},this.rateLimitTracker.set(c,h)),h.count>=n+s?{block:!0,status:429,error:"Rate limit exceeded"}:(h.count++,{block:!1})}applyIPAllowList(t,e){if(!t.config?.sourceRange)return{block:!1};const n=e.clientIP||"0.0.0.0";return t.config.sourceRange.some(i=>i.includes("/")?n.startsWith(i.split("/")[0]):n===i)?{block:!1}:{block:!0,status:403,error:"IP not allowed"}}applyAuth(t,e){return t.config?.headerField&&!e.headers?.[t.config.headerField]?{block:!0,status:401,error:"Authentication required"}:{block:!1}}applyHeaders(t,e){const n={...e};return n.headers||(n.headers={}),t.config?.customRequestHeaders&&Object.assign(n.headers,t.config.customRequestHeaders),{block:!1,request:n}}applyRedirect(t,e){return{block:!1}}applyStripPrefix(t,e){if(!t.config?.prefix)return{block:!1,request:e};const n={...e};return n.path.startsWith(t.config.prefix)&&(n.path=n.path.substring(t.config.prefix.length)),{block:!1,request:n}}applyAddPrefix(t,e){if(!t.config?.prefix)return{block:!1,request:e};const n={...e};return n.path=t.config.prefix+n.path,{block:!1,request:n}}selectServer(t,e){const s=(t.loadBalancer?.servers||[]).filter(o=>{const c=this.serverHealthStatus.get(o.url);return c==="healthy"||c===void 0});if(s.length===0)return null;switch(t.loadBalancer?.strategy||"roundRobin"){case"roundRobin":return this.selectRoundRobin(t.name,s);case"wrr":return this.selectWeightedRoundRobin(t.name,s);case"drr":return this.selectDynamicRoundRobin(t.name,s);default:return s[0]?.url||null}}selectRoundRobin(t,e){const n=this.roundRobinCounters.get(t)||0,s=e[n%e.length];return this.roundRobinCounters.set(t,(n+1)%e.length),s.url}selectWeightedRoundRobin(t,e){const n=e.reduce((o,c)=>o+(c.weight||1),0);let s=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,s<i)return this.roundRobinCounters.set(t,(s+1)%n),o.url;return this.roundRobinCounters.set(t,(s+1)%n),e[0]?.url||""}selectDynamicRoundRobin(t,e){let n=1/0,s=e[0];for(const i of e){const c=(this.connectionCounts.get(i.url)||0)/(i.weight||1);c<n&&(n=c,s=i)}return s.url}startHealthCheck(t,e,n){const s=(n.interval||10)*1e3,i=`${t}:${e}`;this.serverHealthStatus.set(e,"checking");const o=async()=>{try{if(Math.random()>.1){this.serverHealthStatus.set(e,"healthy");const f=this.serverCheckSuccesses.get(e)||0;this.serverCheckSuccesses.set(e,f+1),this.serverCheckFailures.set(e,0)}else{const f=(this.serverCheckFailures.get(e)||0)+1;this.serverCheckFailures.set(e,f),f>=3&&this.serverHealthStatus.set(e,"unhealthy")}}catch{const h=(this.serverCheckFailures.get(e)||0)+1;this.serverCheckFailures.set(e,h),h>=3&&this.serverHealthStatus.set(e,"unhealthy")}};o();const c=setInterval(o,s);this.healthCheckTimers.set(i,c)}parsePeriod(t){const e=t.match(/^(\d+)([smh])$/);if(!e)return 1e3;const n=parseInt(e[1],10);switch(e[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;default:return 1e3}}getStats(){let t=0,e=0;for(const o of this.services.values()){const c=o.loadBalancer?.servers||[];t+=c.length;for(const u of c){const h=this.serverHealthStatus.get(u.url);(h==="healthy"||h===void 0)&&e++}}const n=Array.from(this.routers.values()).filter(o=>(o.requests||0)>0).length,s=this.latencyCount>0?this.totalLatency/this.latencyCount:0,i=this.requestCount>0?this.errorCount/this.requestCount:0;return{routers:this.routers.size,activeRouters:n,services:this.services.size,middlewares:this.middlewares.size,entryPoints:this.entryPoints.size,totalServers:t,healthyServers:e,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:i,averageLatency:s}}getRouter(t){return this.routers.get(t)}getService(t){return this.services.get(t)}getMiddleware(t){return this.middlewares.get(t)}resetStats(){this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.latencyCount=0;for(const t of this.routers.values())t.requests=0,t.responses=0,t.errors=0,t.bytesIn=0,t.bytesOut=0,t.averageLatency=0;for(const t of this.services.values())t.totalRequests=0,t.totalResponses=0,t.activeConnections=0}connectionRejects=0}class IT{config=null;routingEngine;metrics={requestsTotal:0,responsesTotal:0,errorsTotal:0,activeRouters:0,totalRouters:0,totalServices:0,totalMiddlewares:0,totalServers:0,healthyServers:0,activeConnections:0,totalBytesIn:0,totalBytesOut:0,averageLatency:0,errorRate:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new zT}initializeConfig(t){const e=t.data.config||{},n=Array.isArray(e.routers)?e.routers.map(c=>({id:c.id||c.name,name:c.name,rule:c.rule||`Host(\`${c.name||"example.com"}\`)`,service:c.service,entryPoints:Array.isArray(c.entryPoints)?c.entryPoints:["web"],middlewares:Array.isArray(c.middlewares)?c.middlewares:[],tls:c.tls?{enabled:c.tls===!0||c.tls.enabled===!0}:void 0,priority:c.priority||0,requests:c.requests||0,responses:c.responses||0,errors:c.errors||0})):[],s=Array.isArray(e.services)?e.services.map(c=>({id:c.id||c.name,name:c.name,loadBalancer:{servers:Array.isArray(c.servers)?c.servers.map(u=>({url:u.url||u.address||"http://localhost:8080",weight:u.weight||1})):c.url?[{url:c.url,weight:1}]:[],strategy:c.loadBalancer||"roundRobin",healthCheck:c.healthCheck?.enabled?{enabled:!0,path:c.healthCheck.path||"/health",interval:c.healthCheck.interval||10,timeout:c.healthCheck.timeout||5}:void 0},totalRequests:c.totalRequests||0,totalResponses:c.totalResponses||0})):[],i=Array.isArray(e.middlewares)?e.middlewares.map(c=>({id:c.id||c.name,name:c.name,type:c.type||"headers",config:c.config||{}})):[],o=Array.isArray(e.entryPoints)?e.entryPoints.map(c=>typeof c=="string"?{name:c,address:c.includes(":")?c:`:${c==="web"?"80":c==="websecure"?"443":"80"}`}:c):[{name:"web",address:":80"},{name:"websecure",address:":443"}];this.config={routers:n,services:s,middlewares:i,entryPoints:o,enableDashboard:e.enableDashboard??!0,enableAPI:e.enableAPI??!0,autoDiscoverServices:e.autoDiscoverServices??!0,maxConnections:e.maxConnections||1e4,idleTimeout:e.idleTimeout||18e4,responseTimeout:e.responseTimeout||3e4},this.routingEngine.initialize({routers:n,services:s,middlewares:i,entryPoints:o,globalConfig:{maxConnections:this.config.maxConnections,idleTimeout:this.config.idleTimeout,responseTimeout:this.config.responseTimeout}}),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),n={path:t.path||"/",method:t.method||"GET",headers:t.headers,query:t.query,body:t.body,clientIP:t.clientIP||this.generateRandomIP(),protocol:t.protocol||"http",host:t.host||t.headers?.Host||"localhost",entryPoint:t.entryPoint||"web"},s=this.routingEngine.routeRequest(n),i=performance.now()-e+(s.response.latency||0);this.recordLatency(i);const o=Date.now();return this.firstRequestTime||(this.firstRequestTime=o),this.lastRequestTime=o,this.updateMetricsFromStats(),{success:s.response.status>=200&&s.response.status<400,latency:i,status:s.response.status,serviceTarget:s.response.serviceTarget,serverTarget:s.response.serverTarget,routerMatched:s.response.routerMatched,error:s.response.error}}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.requestsTotal=t.totalRequests,this.metrics.responsesTotal=t.totalResponses,this.metrics.activeRouters=t.activeRouters,this.metrics.totalRouters=t.routers,this.metrics.totalServices=t.services,this.metrics.totalMiddlewares=t.middlewares,this.metrics.totalServers=t.totalServers,this.metrics.healthyServers=t.healthyServers,this.metrics.activeConnections=t.activeConnections,this.metrics.totalBytesIn=t.totalBytesIn,this.metrics.totalBytesOut=t.totalBytesOut,this.metrics.averageLatency=t.averageLatency,this.metrics.errorRate=t.errorRate,this.metrics.errorsTotal=Math.floor(t.totalRequests*t.errorRate)}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLoad(){const t=this.getStats(),e=this.config?.maxConnections||1e4;let n=this.simulatedRequestRate;if(this.firstRequestTime&&this.lastRequestTime){const i=(this.lastRequestTime-this.firstRequestTime)/1e3;i>0&&(n=t.totalRequests/i)}n===0&&this.simulatedRequestRate>0&&(n=this.simulatedRequestRate);const s=e>0?Math.min(1,t.activeConnections/e):0;return{requestsPerSecond:n,averageLatency:t.averageLatency||0,errorRate:t.errorRate||0,utilization:s}}simulateRequests(t){this.simulatedRequestRate=t;const e=Date.now(),n=(e-this.lastSimulationTime)/1e3;if(this.lastSimulationTime=e,t<=0||n<=0)return;const s=Math.floor(t*n);for(let i=0;i<s;i++){const o=this.generateRandomPath(),c=["GET","POST","PUT","DELETE"][Math.floor(Math.random()*4)];this.processRequest({path:o,method:c,headers:{Host:"example.com","User-Agent":"Mozilla/5.0"},clientIP:this.generateRandomIP(),protocol:Math.random()>.5?"https":"http",host:"example.com",entryPoint:Math.random()>.5?"websecure":"web"})}}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomPath(){const t=["/","/api","/api/users","/api/products","/health","/status","/docs"];return t[Math.floor(Math.random()*t.length)]}updateConfig(t){this.initializeConfig(t)}resetStats(){this.routingEngine.resetStats(),this.firstRequestTime=null,this.lastRequestTime=null,this.latencyHistory=[],this.updateMetricsFromStats()}}class Cb{services=new Map;virtualServices=new Map;destinationRules=new Map;gateways=new Map;peerAuthentications=new Map;authorizationPolicies=new Map;serviceEntries=new Map;sidecars=new Map;globalConfig={};roundRobinCounters=new Map;leastConnCounts=new Map;consistentHashRing=new Map;connectionPoolCounts=new Map;circuitBreakerState=new Map;outlierDetectionState=new Map;mtlsConnections=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;totalLatency=0;circuitBreakerTrips=0;retryAttempts=0;timeoutErrors=0;rateLimitBlocks=0;serviceEndpoints=new Map;initialize(t){if(this.services.clear(),this.virtualServices.clear(),this.destinationRules.clear(),this.gateways.clear(),this.peerAuthentications.clear(),this.authorizationPolicies.clear(),this.serviceEntries.clear(),this.sidecars.clear(),this.roundRobinCounters.clear(),this.leastConnCounts.clear(),this.consistentHashRing.clear(),this.circuitBreakerState.clear(),this.outlierDetectionState.clear(),this.mtlsConnections.clear(),this.serviceEndpoints.clear(),this.connectionPoolCounts.clear(),this.globalConfig=t.globalConfig||{},t.services)for(const e of t.services){const n=this.normalizeHost(e.host);if(this.services.set(n,e),e.ports&&e.ports.length>0){const s=e.ports[0].number,i=`${n}:default`;this.serviceEndpoints.set(i,[{address:e.host,port:s,weight:100,healthy:!0,labels:e.labels}])}}if(t.virtualServices)for(const e of t.virtualServices)this.virtualServices.set(e.name,e);if(t.destinationRules){for(const e of t.destinationRules)if(this.destinationRules.set(e.name,e),e.subsets)for(const n of e.subsets){const s=`${e.host}:${n.name}`;this.roundRobinCounters.set(s,0),this.leastConnCounts.set(s,new Map);const i=this.services.get(this.normalizeHost(e.host));if(i&&i.ports&&i.ports.length>0){const o=i.ports[0].number;this.serviceEndpoints.set(s,[{address:i.host,port:o,weight:100,healthy:!0,labels:n.labels}])}}}if(t.gateways)for(const e of t.gateways)this.gateways.set(e.name,e);if(t.peerAuthentications)for(const e of t.peerAuthentications)this.peerAuthentications.set(e.name,e);if(t.authorizationPolicies)for(const e of t.authorizationPolicies)this.authorizationPolicies.set(e.name,e);if(t.serviceEntries){for(const e of t.serviceEntries)if(this.serviceEntries.set(e.name,e),e.endpoints)for(const n of e.hosts){const s=this.normalizeHost(n);if(e.ports&&e.ports.length>0){const i=e.ports[0].number,o=`${s}:default`;this.serviceEndpoints.set(o,e.endpoints.map(c=>({address:c.address,port:c.ports?Object.values(c.ports)[0]:i,weight:c.weight||100,healthy:!0,labels:c.labels})))}}}if(t.sidecars)for(const e of t.sidecars)this.sidecars.set(e.name,e);this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.circuitBreakerTrips=0,this.retryAttempts=0,this.timeoutErrors=0,this.rateLimitBlocks=0}routeRequest(t,e){const n=Date.now();this.requestCount++,this.activeConnections++;try{if(!this.checkMTLS(t).allowed)return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:403,error:"mTLS authentication failed",latency:Date.now()-n}};const i=this.checkAuthorization(t);if(!i.allowed)return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:403,error:i.reason||"Authorization denied",latency:Date.now()-n}};const o=this.findMatchingVirtualService(t,e);if(!o){const y=this.findServiceByHost(t.host||"");if(!y)return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:404,error:`Service not found: ${t.host}`,latency:Date.now()-n}};const v=this.routeToService(y.host,void 0,t,n);return this.activeConnections--,v}const c=this.matchHTTPRoute(o,t);if(!c)return this.activeConnections--,this.errorCount++,{virtualService:o,destinationRule:null,response:{status:404,error:"No matching route in VirtualService",latency:Date.now()-n}};const u=this.applyFaultInjection(c.fault,t);if(u.abort)return this.activeConnections--,this.errorCount++,{virtualService:o,destinationRule:null,response:{status:u.abort.httpStatus||500,error:"Fault injection: abort",latency:Date.now()-n}};if(u.delay){const y=this.parseDuration(u.delay.fixedDelay||"0s")}let h=null;if(c.route&&c.route.length>0)h=this.selectDestination(c.route,t);else if(c.redirect)return this.activeConnections--,this.responseCount++,{virtualService:o,destinationRule:null,response:{status:c.redirect.redirectCode||301,headers:{Location:c.redirect.uri||c.redirect.authority||""},latency:Date.now()-n}};if(!h)return this.activeConnections--,this.errorCount++,{virtualService:o,destinationRule:null,response:{status:500,error:"No destination configured",latency:Date.now()-n}};const f=this.findDestinationRule(h.host),m=this.routeToService(h.host,h.subset,h.port,t,n,c.retries,c.timeout,f);return m.virtualService=o,m.destinationRule=f,this.activeConnections--,m}catch(s){return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:500,error:s.message||"Internal error",latency:Date.now()-n}}}}checkMTLS(t){const e=this.globalConfig.mtlsMode||(this.globalConfig.enableMTLS?"PERMISSIVE":"DISABLE");if(e==="DISABLE")return{allowed:!0};for(const n of this.peerAuthentications.values())if(n.mtls){if(n.mtls.mode==="STRICT"&&!t.sourcePrincipal)return{allowed:!1,reason:"mTLS required but not provided"};if(n.mtls.mode==="DISABLE")return{allowed:!0}}return e==="STRICT"&&!t.sourcePrincipal?{allowed:!1,reason:"mTLS required in STRICT mode"}:{allowed:!0}}checkAuthorization(t){const e=[];for(const n of this.authorizationPolicies.values())this.matchesAuthorizationPolicy(n,t)&&e.push(n);if(e.length===0)return{allowed:!0};for(const n of e){const s=n.action||"ALLOW";if(s==="DENY")return{allowed:!1,reason:`Denied by policy: ${n.name}`};if(s==="ALLOW"){if(n.rules&&n.rules.length>0){let i=!1;for(const o of n.rules)if(this.matchesAuthorizationRule(o,t)){i=!0;break}if(!i)return{allowed:!1,reason:`No matching rule in policy: ${n.name}`}}return{allowed:!0}}}return{allowed:!0}}matchesAuthorizationPolicy(t,e){return!t.selector||!t.selector.matchLabels,!0}matchesAuthorizationRule(t,e){if(t.from&&t.from.length>0){let n=!1;for(const s of t.from)if(s.source)if(s.source.principals&&e.sourcePrincipal){if(s.source.principals.includes(e.sourcePrincipal)||s.source.principals.includes("*")){n=!0;break}}else n=!0;else n=!0;if(!n)return!1}if(t.to&&t.to.length>0){let n=!1;for(const s of t.to)if(s.operation){if(s.operation.methods&&!s.operation.methods.includes(e.method)||s.operation.paths&&!s.operation.paths.some(i=>e.path.startsWith(i))||s.operation.hosts&&e.host&&!s.operation.hosts.includes(e.host))continue;n=!0;break}else n=!0;if(!n)return!1}return!0}findMatchingVirtualService(t,e){const n=t.host||t.authority||"";for(const s of this.virtualServices.values())if(s.hosts.some(o=>{if(o==="*"||o===n)return!0;if(o.startsWith("*.")){const c=o.substring(2);return n.endsWith("."+c)||n===c}return!1})&&!(e&&s.gateways&&s.gateways.length>0&&!s.gateways.includes(e)))return s;return null}matchHTTPRoute(t,e){if(!t.http||t.http.length===0)return null;for(const n of t.http){if(!n.match||n.match.length===0)return{route:n.route,redirect:n.redirect,rewrite:n.rewrite,timeout:n.timeout,retries:n.retries,fault:n.fault};for(const s of n.match){let i=!0;if(s.uri){if(s.uri.exact&&e.path!==s.uri.exact){i=!1;continue}if(s.uri.prefix&&!e.path.startsWith(s.uri.prefix)){i=!1;continue}if(s.uri.regex&&!new RegExp(s.uri.regex).test(e.path)){i=!1;continue}}if(s.method){if(s.method.exact&&e.method!==s.method.exact){i=!1;continue}if(s.method.regex&&!new RegExp(s.method.regex).test(e.method)){i=!1;continue}}if(s.headers)for(const[o,c]of Object.entries(s.headers)){const u=e.headers?.[o.toLowerCase()];if(!u){i=!1;break}if(c.exact&&u!==c.exact){i=!1;break}if(c.prefix&&!u.startsWith(c.prefix)){i=!1;break}if(c.regex&&!new RegExp(c.regex).test(u)){i=!1;break}}if(i)return{route:n.route,redirect:n.redirect,rewrite:n.rewrite,timeout:n.timeout,retries:n.retries,fault:n.fault}}}return null}applyFaultInjection(t,e){if(!t)return{};const n={};if(t.delay){const s=t.delay.percentage?.value||0;Math.random()*100<s&&(n.delay=t.delay)}if(t.abort){const s=t.abort.percentage?.value||0;Math.random()*100<s&&(n.abort=t.abort)}return n}selectDestination(t,e){if(t.length===0)return null;if(t.length===1)return t[0].destination;const n=t.reduce((o,c)=>o+(c.weight||100),0),s=Math.random()*n;let i=0;for(const o of t)if(i+=o.weight||100,s<=i)return o.destination;return t[0].destination}findDestinationRule(t){const e=this.normalizeHost(t);for(const n of this.destinationRules.values())if(this.normalizeHost(n.host)===e)return n;return null}routeToService(t,e,n,s,i,o,c,u){const h=`${t}:${e||"default"}`,f=this.circuitBreakerState.get(h);if(f?.isOpen&&(!f.openUntil||Date.now()<f.openUntil))return this.circuitBreakerTrips++,this.errorCount++,{virtualService:null,destinationRule:u||null,response:{status:503,error:"Circuit breaker is open",latency:Date.now()-i,circuitBreakerOpen:!0},serviceTarget:t,subsetTarget:e};const m=this.serviceEndpoints.get(h)||[];if(m.length===0)return this.errorCount++,{virtualService:null,destinationRule:u||null,response:{status:503,error:"No endpoints available",latency:Date.now()-i},serviceTarget:t,subsetTarget:e};const y=this.getTrafficPolicy(t,e,u),v=y?.connectionPool?.tcp?.maxConnections;if(v){const k=this.connectionPoolCounts.get(h)||0;if(k>=v)return this.errorCount++,{virtualService:null,destinationRule:u||null,response:{status:503,error:"Connection pool exhausted",latency:Date.now()-i},serviceTarget:t,subsetTarget:e};this.connectionPoolCounts.set(h,k+1)}const x=this.selectEndpoint(m,h,s,y),S=y?.connectionPool?.tcp?.connectTimeout,R=c?this.parseDuration(c):S?this.parseDuration(S):this.globalConfig.defaultTimeout?this.parseDuration(this.globalConfig.defaultTimeout):3e4,M=o?.attempts||this.globalConfig.defaultRetryAttempts||0;let T=null;for(let k=0;k<=M;k++){k>0&&this.retryAttempts++;const A=this.simulateEndpointRequest(x,s,R);if(A.status>=200&&A.status<500){if(this.responseCount++,this.totalLatency+=A.latency||0,v){const _=this.connectionPoolCounts.get(h)||0;_>0&&this.connectionPoolCounts.set(h,_-1)}return f&&(f.consecutiveErrors=0,f.isOpen&&f.halfOpenRequests!==void 0&&(f.halfOpenRequests++,f.halfOpenRequests>=3&&(f.isOpen=!1,f.halfOpenRequests=void 0))),{virtualService:null,destinationRule:u||null,response:{...A,serviceTarget:t,subsetTarget:e,endpointTarget:`${x.address}:${x.port}`,retryAttempts:k}}}if(!(A.status>=500&&(T=A,(o?.retryOn||"5xx,reset,connect-failure").includes("5xx")&&A.status>=500&&k<M))){if(v){const _=this.connectionPoolCounts.get(h)||0;_>0&&this.connectionPoolCounts.set(h,_-1)}if(f){f.consecutiveErrors++;const _=u?.trafficPolicy?.outlierDetection?.consecutiveErrors||5;f.consecutiveErrors>=_&&(f.isOpen=!0,f.openUntil=Date.now()+(this.parseDuration(u?.trafficPolicy?.outlierDetection?.baseEjectionTime||"30s")||3e4),f.halfOpenRequests=0)}this.errorCount++;break}}return{virtualService:null,destinationRule:u||null,response:{...T||{status:500,error:"Request failed after retries",latency:Date.now()-i},serviceTarget:t,subsetTarget:e,endpointTarget:`${x.address}:${x.port}`,retryAttempts:M}}}getTrafficPolicy(t,e,n){if(!n)return null;if(e&&n.subsets){const s=n.subsets.find(i=>i.name===e);if(s?.trafficPolicy)return s.trafficPolicy}return n.trafficPolicy||null}selectEndpoint(t,e,n,s){const i=t.filter(c=>c.healthy!==!1);if(i.length===0)return t[0];switch(s?.loadBalancer?.simple||"ROUND_ROBIN"){case"ROUND_ROBIN":{const c=this.roundRobinCounters.get(e)||0,u=i[c%i.length];return this.roundRobinCounters.set(e,c+1),u}case"LEAST_CONN":{let c=1/0,u=i[0];const h=this.leastConnCounts.get(e)||new Map;for(const m of i){const y=`${m.address}:${m.port}`,v=h.get(y)||0;v<c&&(c=v,u=m)}const f=`${u.address}:${u.port}`;return h.set(f,(h.get(f)||0)+1),this.leastConnCounts.set(e,h),u}case"RANDOM":return i[Math.floor(Math.random()*i.length)];case"PASSTHROUGH":default:return i[0]}}simulateEndpointRequest(t,e,n){const s=10+Math.random()*90,i=Math.random()*50,o=s+i;return Math.random()<.01?{status:500,error:"Internal server error",latency:o}:o>n?(this.timeoutErrors++,{status:504,error:"Gateway timeout",latency:n}):{status:200,latency:o}}findServiceByHost(t){const e=this.normalizeHost(t);return this.services.get(e)||null}normalizeHost(t){return t.toLowerCase().trim()}parseDuration(t){const e=t.match(/^(\d+)(ms|s|m|h)$/);if(!e)return 0;const n=parseInt(e[1],10);switch(e[2]){case"ms":return n;case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;default:return 0}}getStats(){const t=this.responseCount>0?this.totalLatency/this.responseCount:0,e=this.requestCount>0?this.errorCount/this.requestCount:0;return{services:this.services.size,virtualServices:this.virtualServices.size,destinationRules:this.destinationRules.size,gateways:this.gateways.size,totalRequests:this.requestCount,totalResponses:this.responseCount,totalErrors:this.errorCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:e,averageLatency:t,mtlsConnections:Array.from(this.mtlsConnections.values()).filter(n=>n).length,circuitBreakerTrips:this.circuitBreakerTrips,retryAttempts:this.retryAttempts,timeoutErrors:this.timeoutErrors,rateLimitBlocks:this.rateLimitBlocks}}resetStats(){this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.circuitBreakerTrips=0,this.retryAttempts=0,this.timeoutErrors=0,this.rateLimitBlocks=0}}class OT{istioEngine;constructor(){this.istioEngine=new Cb}initialize(t){const e=(t.services||[]).map(n=>({id:n.id||n.name,name:n.name,namespace:n.namespace||"default",host:n.host||`${n.name}.${n.namespace||"default"}.svc.cluster.local`,ports:n.ports||[{number:80,protocol:"HTTP"}],labels:n.labels||{},requests:n.requests||0,errors:n.errors||0,latency:n.latency||0,pods:n.pods||1,healthyPods:n.healthyPods||n.pods||1}));this.istioEngine.initialize({services:e,virtualServices:t.virtualServices||[],destinationRules:t.destinationRules||[],gateways:t.gateways||[],peerAuthentications:t.peerAuthentications||[],authorizationPolicies:t.authorizationPolicies||[],serviceEntries:t.serviceEntries||[],sidecars:t.sidecars||[],globalConfig:t.globalConfig})}updateConfig(t){this.initialize(t)}routeRequest(t){return this.istioEngine.routeRequest(t)}getStats(){return this.istioEngine.getStats()}resetStats(){this.istioEngine.resetStats()}getIstioEngine(){return this.istioEngine}}class HT{errors=[];maxErrors=200;errorCounts=new Map;listeners=[];addError(t,e={}){const n=this.generateErrorId(t,e),s=this.errorCounts.get(n)||0;this.errorCounts.set(n,s+1);const i=this.errors.find(c=>c.id===n);if(i&&i.count!==void 0)return i.count=s+1,i.timestamp=Date.now(),this.notifyListeners(i),n;const o={id:n,timestamp:Date.now(),severity:e.severity||this.determineSeverity(t),source:e.source||"unknown",componentId:e.componentId,componentLabel:e.componentLabel,componentType:e.componentType,message:t instanceof Error?t.message:String(t),errorType:t instanceof Error?t.constructor.name:void 0,stack:t instanceof Error?t.stack:void 0,context:e.context,count:s+1};if(this.errors.unshift(o),this.errors.length>this.maxErrors){const c=this.errors.pop();c&&this.errorCounts.delete(c.id)}return this.notifyListeners(o),n}generateErrorId(t,e){const n=t instanceof Error?t.message:String(t),s=`${e.source||"unknown"}-${e.componentType||"unknown"}-${e.componentId||"global"}-${n}`;let i=0;for(let o=0;o<s.length;o++){const c=s.charCodeAt(o);i=(i<<5)-i+c,i=i&i}return`error-${Math.abs(i)}`}determineSeverity(t){if(t instanceof Error){const e=t.constructor.name,n=t.message.toLowerCase();if(e==="RangeError"||e==="ReferenceError"||n.includes("maximum call stack")||n.includes("cannot read property")||n.includes("is not a function"))return"critical";if(e==="TypeError"||n.includes("undefined")||n.includes("null"))return"warning"}return"info"}getErrors(){return[...this.errors]}getErrorsBySeverity(t){return this.errors.filter(e=>e.severity===t)}getErrorsBySource(t){return this.errors.filter(e=>e.source===t)}getErrorsByComponent(t){return this.errors.filter(e=>e.componentId===t)}getCriticalErrors(){return this.getErrorsBySeverity("critical")}getErrorCount(t){return t?this.getErrorsBySeverity(t).length:this.errors.length}clear(){this.errors=[],this.errorCounts.clear()}clearByFilter(t){this.errors=this.errors.filter(e=>{const n=!t(e);return n||this.errorCounts.delete(e.id),n})}removeError(t){this.errors=this.errors.filter(e=>e.id!==t),this.errorCounts.delete(t)}onError(t){return this.listeners.push(t),()=>{const e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}}notifyListeners(t){this.listeners.forEach(e=>{try{e(t)}catch(n){console.error("Error in error listener:",n)}})}getStats(){const t={total:this.errors.length,critical:this.getErrorCount("critical"),warning:this.getErrorCount("warning"),info:this.getErrorCount("info"),bySource:{}};return["emulation-engine","component-engine","alert-system","data-flow","routing-engine","initialization","configuration","unknown"].forEach(n=>{t.bySource[n]=this.getErrorsBySource(n).length}),t}}const nt=new HT;class Qf{config;constructor(t){this.config=t}}class nv extends Qf{cache=new Map;rateLimitCounters=new Map;awsConfig;constructor(t){super(t),this.awsConfig=t.providerConfig}authenticate(t,e){if(e.authRequired===!1)return{success:!0};if(!(e.authRequired!==void 0?e.authRequired:this.config.enableAuthentication))return{success:!0};if(this.config.authType==="api-key"&&this.config.keys){const s=this.config.keys.find(i=>i.key===t.apiKey||t.headers?.["x-api-key"]===i.key);return!s||!s.enabled?{success:!1,statusCode:403,error:"Invalid API Key"}:s.apiIds.includes(e.id)?(e.authScopes&&e.authScopes.length>0&&this.config.authType,{success:!0,key:s}):{success:!1,statusCode:403,error:"API Key does not have access to this API"}}return this.awsConfig.authorizers&&this.awsConfig.authorizers.length>0?{success:!0}:{success:!1,statusCode:401,error:"Unauthorized"}}checkRateLimit(t,e,n){if(!this.config.enableRateLimiting)return{allowed:!0};const s=Date.now(),i=n?`key-${n.id}`:`api-${e.id}`,o=n?.rateLimit||e.rateLimit||this.config.defaultRateLimit||1e3,c=60*1e3,u=this.rateLimitCounters.get(i);return!u||u.resetAt<s?(this.rateLimitCounters.set(i,{count:1,resetAt:s+c}),{allowed:!0,remaining:o-1,resetAt:s+c}):u.count>=o?{allowed:!1,remaining:0,resetAt:u.resetAt}:(u.count++,{allowed:!0,remaining:o-u.count,resetAt:u.resetAt})}calculateLatency(t,e){let n=50+Math.random()*50;this.config.enableAuthentication&&(n+=10,this.awsConfig.authorizers&&this.awsConfig.authorizers.length>0&&(n+=20)),this.config.enableRateLimiting&&(n+=5),(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching)&&(n+=3),this.config.enableRequestLogging&&(n+=2),this.awsConfig.enableXRay&&(n+=5);const i=this.calculateUtilization();return n+=i*30,Math.round(n)}getCachedResponse(t,e){if(!(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching))return null;const s=this.cache.get(t);return!s||s.expiresAt<Date.now()?(this.cache.delete(t),null):s.response}setCachedResponse(t,e,n){const s=Date.now()+n*1e3;this.cache.set(t,{response:e,expiresAt:s})}generateCacheKey(t,e){const s=(e.caching?.cacheKey||["method","path"]).map(i=>i==="method"?t.method:i==="path"?t.path:i==="query"?JSON.stringify(t.query||{}):t.headers?.[i]||"");return`${e.id}:${s.join(":")}`}getProviderSpecificMetrics(){return{cacheHitRate:this.calculateCacheHitRate(),xRayEnabled:this.awsConfig.enableXRay?1:0,stagesCount:this.awsConfig.stages?.length||0,usagePlansCount:this.awsConfig.usagePlans?.length||0}}calculateUtilization(){const t=Array.from(this.rateLimitCounters.values()).reduce((n,s)=>n+s.count,0),e=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1);return Math.min(t/e,1)}calculateCacheHitRate(){return .3}}class sv extends Qf{cache=new Map;rateLimitCounters=new Map;azureConfig;constructor(t){super(t),this.azureConfig=t.providerConfig}authenticate(t,e){if(e.authRequired===!1)return{success:!0};if(!(e.authRequired!==void 0?e.authRequired:this.config.enableAuthentication))return{success:!0};if(this.config.authType==="api-key"){const s=t.headers?.["ocp-apim-subscription-key"]||t.query?.["subscription-key"]||t.apiKey;if(!s)return{success:!1,statusCode:401,error:"Missing subscription key"};const i=this.azureConfig.subscriptions?.find(c=>c.primaryKey===s||c.secondaryKey===s);if(!i||i.state!=="active")return{success:!1,statusCode:401,error:"Invalid subscription key"};const o=this.azureConfig.products?.find(c=>c.apis?.includes(e.id));return o&&o.subscriptionRequired&&i.productId!==o.id?{success:!1,statusCode:403,error:"Subscription does not have access to this API"}:{success:!0}}return{success:!1,statusCode:401,error:"Unauthorized"}}checkRateLimit(t,e,n){if(!this.config.enableRateLimiting)return{allowed:!0};const s=t.headers?.["ocp-apim-subscription-key"]||t.query?.["subscription-key"],i=this.azureConfig.subscriptions?.find(m=>m.primaryKey===s||m.secondaryKey===s),o=Date.now(),c=i?`sub-${i.id}`:`api-${e.id}`,u=e.rateLimit||this.config.defaultRateLimit||1e3,h=60*1e3,f=this.rateLimitCounters.get(c);return!f||f.resetAt<o?(this.rateLimitCounters.set(c,{count:1,resetAt:o+h}),{allowed:!0,remaining:u-1,resetAt:o+h}):f.count>=u?{allowed:!1,remaining:0,resetAt:f.resetAt}:(f.count++,{allowed:!0,remaining:u-f.count,resetAt:f.resetAt})}calculateLatency(t,e){let n=30+Math.random()*50;const s=this.azureConfig.policies?.filter(c=>c.scope==="Global"||c.scope==="API"||c.scope==="Operation"&&c.scopeId===e.id).length||0;n+=s*5,this.config.enableAuthentication&&(n+=8),this.config.enableRateLimiting&&(n+=4),(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching)&&(n+=2),this.azureConfig.enableApplicationInsights&&(n+=3);const o=this.calculateUtilization();return n+=o*25,Math.round(n)}getCachedResponse(t,e){if(!(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching))return null;const s=this.cache.get(t);return!s||s.expiresAt<Date.now()?(this.cache.delete(t),null):s.response}setCachedResponse(t,e,n){const s=Date.now()+n*1e3;this.cache.set(t,{response:e,expiresAt:s})}generateCacheKey(t,e){const s=(e.caching?.cacheKey||["method","path"]).map(i=>i==="method"?t.method:i==="path"?t.path:i==="query"?JSON.stringify(t.query||{}):t.headers?.[i]||"");return`${e.id}:${s.join(":")}`}getProviderSpecificMetrics(){return{cacheHitRate:this.calculateCacheHitRate(),productsCount:this.azureConfig.products?.length||0,subscriptionsCount:this.azureConfig.subscriptions?.length||0,policiesCount:this.azureConfig.policies?.length||0,applicationInsightsEnabled:this.azureConfig.enableApplicationInsights?1:0}}calculateUtilization(){const t=Array.from(this.rateLimitCounters.values()).reduce((n,s)=>n+s.count,0),e=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1);return Math.min(t/e,1)}calculateCacheHitRate(){return .25}}class iv extends Qf{cache=new Map;rateLimitCounters=new Map;gcpConfig;constructor(t){super(t),this.gcpConfig=t.providerConfig}authenticate(t,e){if(e.authRequired===!1)return{success:!0};if(!(e.authRequired!==void 0?e.authRequired:this.config.enableAuthentication))return{success:!0};if(this.config.authType==="api-key"&&this.config.keys){const s=t.headers?.["x-api-key"]||t.query?.key||t.apiKey;if(!s)return{success:!1,statusCode:401,error:"Missing API key"};const i=this.config.keys.find(c=>c.key===s);if(!i||!i.enabled)return{success:!1,statusCode:403,error:"Invalid API key"};const o=i.providerMetadata?.gcp?.restrictions;if(o){if(o.apiTargets&&!o.apiTargets.some(c=>c.service===this.gcpConfig.serviceName&&(c.methods.includes(e.method)||c.methods.includes("*"))))return{success:!1,statusCode:403,error:"API key does not have access to this endpoint"};if(o.httpReferrers&&t.headers?.referer){const c=t.headers.referer;if(!o.httpReferrers.some(u=>c.includes(u)))return{success:!1,statusCode:403,error:"API key restricted by referer"}}if(o.ipAddresses&&t.headers?.["x-forwarded-for"]){const c=t.headers["x-forwarded-for"].split(",")[0].trim();if(!o.ipAddresses.some(u=>c.startsWith(u)))return{success:!1,statusCode:403,error:"API key restricted by IP address"}}}return i.apiIds.includes(e.id)?{success:!0,key:i}:{success:!1,statusCode:403,error:"API key does not have access to this API"}}return{success:!1,statusCode:401,error:"Unauthorized"}}checkRateLimit(t,e,n){if(!this.config.enableRateLimiting)return{allowed:!0};const s=this.gcpConfig.quotas?.find(f=>f.metric==="requests");if(s){const f=Date.now(),m=`quota-${s.id}`,y=this.rateLimitCounters.get(m);return!y||y.resetAt<f?(this.rateLimitCounters.set(m,{count:1,resetAt:f+6e4}),{allowed:!0,remaining:s.limit-1,resetAt:f+6e4}):y.count>=s.limit?{allowed:!1,remaining:0,resetAt:y.resetAt}:(y.count++,{allowed:!0,remaining:s.limit-y.count,resetAt:y.resetAt})}const i=Date.now(),o=n?`key-${n.id}`:`api-${e.id}`,c=n?.rateLimit||e.rateLimit||this.config.defaultRateLimit||1e3,u=60*1e3,h=this.rateLimitCounters.get(o);return!h||h.resetAt<i?(this.rateLimitCounters.set(o,{count:1,resetAt:i+u}),{allowed:!0,remaining:c-1,resetAt:i+u}):h.count>=c?{allowed:!1,remaining:0,resetAt:h.resetAt}:(h.count++,{allowed:!0,remaining:c-h.count,resetAt:h.resetAt})}calculateLatency(t,e){let n=40+Math.random()*50;this.gcpConfig.openApiSpec&&(n+=15),n+=10,this.config.enableAuthentication&&(n+=12),this.config.enableRateLimiting&&(n+=5),(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching)&&(n+=3),this.gcpConfig.enableCloudLogging&&(n+=4);const i=this.calculateUtilization();return n+=i*30,Math.round(n)}getCachedResponse(t,e){if(!(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching))return null;const s=this.cache.get(t);return!s||s.expiresAt<Date.now()?(this.cache.delete(t),null):s.response}setCachedResponse(t,e,n){const s=Date.now()+n*1e3;this.cache.set(t,{response:e,expiresAt:s})}generateCacheKey(t,e){const s=(e.caching?.cacheKey||["method","path"]).map(i=>i==="method"?t.method:i==="path"?t.path:i==="query"?JSON.stringify(t.query||{}):t.headers?.[i]||"");return`${e.id}:${s.join(":")}`}getProviderSpecificMetrics(){return{cacheHitRate:this.calculateCacheHitRate(),quotasCount:this.gcpConfig.quotas?.length||0,serviceAccountsCount:this.gcpConfig.serviceAccounts?.length||0,openApiSpecSize:this.gcpConfig.openApiSpec?.length||0,cloudLoggingEnabled:this.gcpConfig.enableCloudLogging?1:0,cloudMonitoringEnabled:this.gcpConfig.enableCloudMonitoring?1:0}}calculateUtilization(){const t=Array.from(this.rateLimitCounters.values()).reduce((n,s)=>n+s.count,0),e=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1);return Math.min(t/e,1)}calculateCacheHitRate(){return .35}}class qT{config;providerEngine;requestCount=0;errorCount=0;totalLatency=0;latencyHistory=[];constructor(t){switch(this.config=t,t.provider){case"aws":this.providerEngine=new nv(t);break;case"azure":this.providerEngine=new sv(t);break;case"gcp":this.providerEngine=new iv(t);break;default:throw new Error(`Unsupported provider: ${t.provider}`)}}processRequest(t){const e=this.findRoute(t);if(!e||!e.enabled)return{status:404,latency:5,error:"API not found",metadata:{gatewayProvider:this.config.provider}};const n=this.providerEngine.authenticate(t,e);if(!n.success)return this.errorCount++,{status:n.statusCode||401,latency:this.providerEngine.calculateLatency(t,e),error:n.error,metadata:{gatewayProvider:this.config.provider,apiId:e.id}};const s=this.providerEngine.checkRateLimit(t,e,n.key);if(!s.allowed)return this.errorCount++,{status:429,latency:this.providerEngine.calculateLatency(t,e),error:"Rate limit exceeded",headers:{"X-RateLimit-Limit":String(e.rateLimit||this.config.defaultRateLimit||1e3),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(s.resetAt||Date.now()+6e4)},metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:n.key?.id}};const i=this.providerEngine.generateCacheKey(t,e),o=this.providerEngine.getCachedResponse(i,e);if(o)return this.requestCount++,{...o,metadata:{...o.metadata,cacheHit:!0}};const c=this.providerEngine.calculateLatency(t,e),h=(e.timeout||this.config.requestTimeout||30)*1e3,f=c+Math.random()*100;if(f>h)return this.errorCount++,{status:504,latency:h,error:"Gateway Timeout",metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:n.key?.id}};const m=f/h,y=m>.8?Math.min(f+(m-.8)*200,h-10):f;this.requestCount++,this.totalLatency+=y,this.latencyHistory.push(y),this.latencyHistory.length>100&&this.latencyHistory.shift();const v=e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching,x={status:200,latency:Math.round(y),metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:n.key?.id,cacheHit:!1,rateLimitRemaining:s.remaining,rateLimitReset:s.resetAt}};if(v){const S=e.caching?.ttl||this.config.cacheTTL||300;this.providerEngine.setCachedResponse(i,x,S)}return{status:200,latency:Math.round(y),metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:n.key?.id,cacheHit:!1,rateLimitRemaining:s.remaining,rateLimitReset:s.resetAt}}}findRoute(t){if(!this.config.apis)return;let e=this.config.apis.find(n=>n.path===t.path&&(n.method===t.method||n.method==="ALL")&&n.enabled);return e||(e=this.config.apis.find(n=>t.path.startsWith(n.path)&&(n.method===t.method||n.method==="ALL")&&n.enabled)),e}calculateMetrics(){const t=this.requestCount/60,e=this.requestCount>0?this.totalLatency/this.requestCount:0,n=[...this.latencyHistory].sort((m,y)=>m-y),s=n.length>0?n[Math.floor(n.length*.5)]:void 0,i=n.length>0?n[Math.floor(n.length*.95)]:void 0,o=n.length>0?n[Math.floor(n.length*.99)]:void 0,c=this.requestCount>0?this.errorCount/this.requestCount:0,u=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1),h=Math.min(t/u,1),f=this.providerEngine.getProviderSpecificMetrics();return{throughput:t,latency:e,latencyP50:s,latencyP95:i,latencyP99:o,errorRate:c,utilization:h,customMetrics:{...f,totalRequests:this.requestCount,totalErrors:this.errorCount,apisCount:this.config.apis?.length||0,keysCount:this.config.keys?.length||0}}}resetMetrics(){this.requestCount=0,this.errorCount=0,this.totalLatency=0,this.latencyHistory=[]}updateConfig(t){switch(this.config=t,t.provider){case"aws":this.providerEngine=new nv(t);break;case"azure":this.providerEngine=new sv(t);break;case"gcp":this.providerEngine=new iv(t);break}}}class $T{nodes=[];connections=[];metrics=new Map;connectionMetrics=new Map;isRunning=!1;simulationTime=0;baseTime=Date.now();pausedTime=0;updateInterval=100;intervalId=null;latencyHistory=new Map;connectionLatencyHistory=new Map;HISTORY_SIZE=500;rabbitMQRoutingEngines=new Map;lastRabbitMQUpdate=new Map;activeMQRoutingEngines=new Map;lastActiveMQUpdate=new Map;sqsRoutingEngines=new Map;lastSQSUpdate=new Map;azureServiceBusRoutingEngines=new Map;lastAzureServiceBusUpdate=new Map;pubSubRoutingEngines=new Map;lastPubSubUpdate=new Map;kongRoutingEngines=new Map;cloudAPIGatewayEngines=new Map;nginxRoutingEngines=new Map;haproxyRoutingEngines=new Map;envoyRoutingEngines=new Map;istioRoutingEngines=new Map;serviceMeshRoutingEngines=new Map;apigeeRoutingEngines=new Map;mulesoftRoutingEngines=new Map;graphQLGatewayRoutingEngines=new Map;lastGraphQLGatewayUpdate=new Map;bffRoutingEngines=new Map;restApiRoutingEngines=new Map;webhookRelayRoutingEngines=new Map;redisRoutingEngines=new Map;cassandraRoutingEngines=new Map;clickHouseRoutingEngines=new Map;snowflakeRoutingEngines=new Map;elasticsearchRoutingEngines=new Map;s3RoutingEngines=new Map;postgresConnectionPools=new Map;prometheusEngines=new Map;grafanaEngines=new Map;lokiEngines=new Map;jaegerEngines=new Map;otelCollectorEngines=new Map;pagerDutyEngines=new Map;keycloakEngines=new Map;vaultEngines=new Map;wafEngines=new Map;firewallEngines=new Map;vpnEngines=new Map;cdnEngines=new Map;idsIpsEngines=new Map;jenkinsEngines=new Map;gitlabCIEngines=new Map;argoCDEngines=new Map;terraformEngines=new Map;harborEngines=new Map;dockerEngines=new Map;kubernetesEngines=new Map;ansibleEngines=new Map;traefikEngines=new Map;constructor(){this.initializeMetrics()}calculatePercentile(t,e){if(t.length===0)return 0;const n=e/100*(t.length-1),s=Math.floor(n),i=Math.ceil(n),o=n-s;return s===i?t[s]:t[s]*(1-o)+t[i]*o}updateLatencyPercentiles(t,e,n){let s=this.latencyHistory.get(t);if(s||(s=[],this.latencyHistory.set(t,s)),s.push(e),s.length>this.HISTORY_SIZE&&s.shift(),s.length>0){const i=[...s].sort((o,c)=>o-c);n.latencyP50=this.calculatePercentile(i,50),n.latencyP99=this.calculatePercentile(i,99)}}updateConnectionLatencyPercentiles(t,e,n){let s=this.connectionLatencyHistory.get(t);if(s||(s=[],this.connectionLatencyHistory.set(t,s)),s.push(e),s.length>this.HISTORY_SIZE&&s.shift(),s.length>0){const i=[...s].sort((o,c)=>o-c);n.latencyP50=this.calculatePercentile(i,50),n.latencyP99=this.calculatePercentile(i,99)}}initialize(t,e){this.nodes=t,this.connections=e,this.initializeMetrics();for(const n of t){if(n.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(n),n.type==="activemq"&&this.initializeActiveMQRoutingEngine(n),n.type==="aws-sqs"&&this.initializeSQSRoutingEngine(n),n.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(n),n.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(n),n.type==="kong"&&this.initializeKongRoutingEngine(n),n.type==="api-gateway"&&this.initializeCloudAPIGatewayEngine(n),n.type==="nginx"&&this.initializeNginxRoutingEngine(n),n.type==="haproxy"&&this.initializeHAProxyRoutingEngine(n),n.type==="envoy"&&this.initializeEnvoyRoutingEngine(n),n.type==="istio"&&this.initializeIstioRoutingEngine(n),n.type==="apigee"&&this.initializeApigeeRoutingEngine(n),n.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(n),n.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(n),n.type==="bff-service"&&this.initializeBFFRoutingEngine(n),n.type==="rest"&&this.initializeRestApiRoutingEngine(n),n.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(n),n.type==="postgres"&&this.initializePostgreSQLConnectionPool(n),n.type==="redis"&&this.initializeRedisRoutingEngine(n),n.type==="cassandra"&&this.initializeCassandraRoutingEngine(n),n.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(n),n.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(n),n.type==="elasticsearch"&&this.initializeElasticsearchRoutingEngine(n),n.type==="s3-datalake"&&this.initializeS3RoutingEngine(n),n.type==="prometheus"&&this.initializePrometheusEngine(n),n.type==="grafana"&&this.initializeGrafanaEngine(n),n.type==="jaeger"&&this.initializeJaegerEngine(n),n.type==="otel-collector"&&this.initializeOpenTelemetryCollectorEngine(n),n.type==="pagerduty"&&this.initializePagerDutyEngine(n),n.type==="keycloak")try{this.initializeKeycloakEngine(n)}catch(s){nt.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeKeycloakEngine"}})}if(n.type==="secrets-vault")try{this.initializeVaultEngine(n)}catch(s){nt.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeVaultEngine"}})}if(n.type==="waf")try{this.initializeWAFEngine(n)}catch(s){nt.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeWAFEngine"}})}if(n.type==="firewall")try{this.initializeFirewallEngine(n)}catch(s){nt.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeFirewallEngine"}})}if(n.type==="ids-ips")try{this.initializeIDSIPSEngine(n)}catch(s){nt.addError(s,{severity:"critical",source:"initialization",componentId:n.id,componentLabel:n.data.label,componentType:n.type,context:{operation:"initializeIDSIPSEngine"}})}n.type==="jenkins"&&this.initializeJenkinsEngine(n),n.type==="gitlab-ci"&&this.initializeGitLabCIEngine(n),n.type==="argo-cd"&&this.initializeArgoCDEngine(n),n.type==="terraform"&&this.initializeTerraformEngine(n),n.type==="ansible"&&(this.ansibleEngines.has(n.id)?this.ansibleEngines.get(n.id).updateConfig(n):this.initializeAnsibleEngine(n)),n.type==="harbor"&&(this.harborEngines.has(n.id)?this.harborEngines.get(n.id).updateConfig(n):this.initializeHarborEngine(n)),n.type==="docker"&&(this.dockerEngines.has(n.id)?this.dockerEngines.get(n.id).updateConfig(n):this.initializeDockerEngine(n)),n.type==="kubernetes"&&(this.kubernetesEngines.has(n.id)?this.kubernetesEngines.get(n.id).updateConfig(n):this.initializeKubernetesEngine(n))}for(const n of t)if(n.type==="postgres"){const s=this.postgresConnectionPools.get(n.id);if(s){const i=n.data.config;s.updateConfig({maxConnections:i.maxConnections||100,minConnections:i.minConnections||0,idleTimeout:i.idleTimeout||3e5,maxLifetime:i.maxLifetime||36e5,connectionTimeout:i.connectionTimeout||5e3})}}hn.initialize(t,e)}updateNodesAndConnections(t,e){this.nodes=t,this.connections=e;for(const i of t){if(this.metrics.has(i.id)||this.metrics.set(i.id,this.createDefaultMetrics(i.id,i.type)),i.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(i),i.type==="activemq"&&this.initializeActiveMQRoutingEngine(i),i.type==="aws-sqs"&&this.initializeSQSRoutingEngine(i),i.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(i),i.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(i),i.type==="kong"&&this.initializeKongRoutingEngine(i),i.type==="nginx"&&this.initializeNginxRoutingEngine(i),i.type==="haproxy"&&this.initializeHAProxyRoutingEngine(i),i.type==="envoy"&&this.initializeEnvoyRoutingEngine(i),i.type==="istio"&&this.initializeIstioRoutingEngine(i),i.type==="apigee"&&this.initializeApigeeRoutingEngine(i),i.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(i),i.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(i),i.type==="bff-service"&&this.initializeBFFRoutingEngine(i),i.type==="rest"&&this.initializeRestApiRoutingEngine(i),i.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(i),i.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(i),i.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(i),i.type==="waf")try{this.wafEngines.has(i.id)?this.wafEngines.get(i.id).initializeConfig(i):this.initializeWAFEngine(i)}catch(o){nt.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeWAFEngine"}})}if(i.type==="firewall")try{this.firewallEngines.has(i.id)?this.firewallEngines.get(i.id).initializeConfig(i):this.initializeFirewallEngine(i)}catch(o){nt.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeFirewallEngine"}})}if(i.type==="vpn")try{this.vpnEngines.has(i.id)?this.vpnEngines.get(i.id).initializeConfig(i):this.initializeVPNEngine(i)}catch(o){nt.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeVPNEngine"}})}if(i.type==="ids-ips")try{this.idsIpsEngines.has(i.id)?this.idsIpsEngines.get(i.id).initializeConfig(i):this.initializeIDSIPSEngine(i)}catch(o){nt.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeIDSIPSEngine"}})}if(i.type==="jenkins"&&(this.jenkinsEngines.has(i.id)?this.jenkinsEngines.get(i.id).updateConfig(i):this.initializeJenkinsEngine(i)),i.type==="gitlab-ci"&&(this.gitlabCIEngines.has(i.id)?this.gitlabCIEngines.get(i.id).updateConfig(i):this.initializeGitLabCIEngine(i)),i.type==="argo-cd"&&(this.argoCDEngines.has(i.id)?this.argoCDEngines.get(i.id).initializeConfig(i):this.initializeArgoCDEngine(i)),i.type==="terraform"&&(this.terraformEngines.has(i.id)?this.terraformEngines.get(i.id).updateConfig(i):this.initializeTerraformEngine(i)),i.type==="ansible"&&(this.ansibleEngines.has(i.id)?this.ansibleEngines.get(i.id).updateConfig(i):this.initializeAnsibleEngine(i)),i.type==="traefik"&&(this.traefikEngines.has(i.id)?this.traefikEngines.get(i.id).updateConfig(i):this.initializeTraefikEngine(i)),i.type==="cdn")try{this.cdnEngines.has(i.id)?this.cdnEngines.get(i.id).initializeConfig(i):this.initializeCDNEngine(i)}catch(o){nt.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeCDNEngine"}})}}const n=new Set(t.map(i=>i.id));for(const[i]of this.metrics.entries())n.has(i)||(this.metrics.delete(i),this.rabbitMQRoutingEngines.delete(i),this.activeMQRoutingEngines.delete(i),this.sqsRoutingEngines.delete(i),this.azureServiceBusRoutingEngines.delete(i),this.pubSubRoutingEngines.delete(i),this.kongRoutingEngines.delete(i),this.nginxRoutingEngines.delete(i),this.haproxyRoutingEngines.delete(i),this.envoyRoutingEngines.delete(i),this.istioRoutingEngines.delete(i),this.apigeeRoutingEngines.delete(i),this.mulesoftRoutingEngines.delete(i),this.graphQLGatewayRoutingEngines.delete(i),this.bffRoutingEngines.delete(i),this.restApiRoutingEngines.delete(i),this.webhookRelayRoutingEngines.delete(i),this.redisRoutingEngines.delete(i),this.cassandraRoutingEngines.delete(i),this.clickHouseRoutingEngines.delete(i),this.snowflakeRoutingEngines.delete(i),this.elasticsearchRoutingEngines.delete(i),this.s3RoutingEngines.delete(i),this.graphQLGatewayRoutingEngines.delete(i),this.keycloakEngines.delete(i),this.vaultEngines.delete(i),this.wafEngines.delete(i),this.firewallEngines.delete(i),this.vpnEngines.delete(i),this.cdnEngines.delete(i),this.idsIpsEngines.delete(i),this.jenkinsEngines.delete(i),this.gitlabCIEngines.delete(i),this.argoCDEngines.delete(i),this.terraformEngines.delete(i),this.ansibleEngines.delete(i),this.traefikEngines.delete(i),this.harborEngines.delete(i),this.lastRabbitMQUpdate.delete(i),this.lastActiveMQUpdate.delete(i),this.lastSQSUpdate.delete(i),this.lastAzureServiceBusUpdate.delete(i),this.lastPubSubUpdate.delete(i),this.lastGraphQLGatewayUpdate.delete(i));for(const i of e)this.connectionMetrics.has(i.id)||this.connectionMetrics.set(i.id,this.createDefaultConnectionMetrics(i));const s=new Set(e.map(i=>i.id));for(const[i]of this.connectionMetrics.entries())s.has(i)||this.connectionMetrics.delete(i);hn.updateNodesAndConnections(t,e)}start(){if(console.log("EmulationEngine.start() called",{isRunning:this.isRunning,hasInterval:!!this.intervalId}),this.isRunning&&!this.intervalId&&(console.log("Inconsistent state detected: isRunning=true but no interval, stopping first..."),this.stop()),this.isRunning){console.log("Already running, returning early");return}console.log("Setting isRunning to true and creating interval..."),this.isRunning=!0,this.baseTime=Date.now()-this.pausedTime,console.log("Starting data flow engine..."),hn.start(),console.log("Creating simulation interval..."),this.intervalId=setInterval(()=>{try{this.simulate()}catch(t){console.error("Error in simulation step:",t),nt.addError(t,{severity:"critical",source:"emulation-engine",context:{simulationTime:this.simulationTime}})}},this.updateInterval),console.log("EmulationEngine.start() complete",{intervalId:!!this.intervalId})}stop(){this.isRunning&&(this.isRunning=!1,this.pausedTime=this.simulationTime,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),hn.stop())}resetSimulation(){this.stop(),this.simulationTime=0,this.pausedTime=0,this.baseTime=Date.now(),this.initializeMetrics()}simulate(){this.simulationTime=Date.now()-this.baseTime;const t=Date.now();for(const[n,s]of this.rabbitMQRoutingEngines.entries()){const i=this.lastRabbitMQUpdate.get(n)||t,o=t-i;o>0&&(s.processConsumption(o),this.lastRabbitMQUpdate.set(n,t))}for(const[n,s]of this.activeMQRoutingEngines.entries()){const i=this.lastActiveMQUpdate.get(n)||t,o=t-i;o>0&&(s.processConsumption(o),this.lastActiveMQUpdate.set(n,t))}for(const[n,s]of this.sqsRoutingEngines.entries()){const i=this.lastSQSUpdate.get(n)||t,o=t-i;o>0&&(s.processConsumption(o),this.lastSQSUpdate.set(n,t))}for(const[n,s]of this.azureServiceBusRoutingEngines.entries()){const i=this.lastAzureServiceBusUpdate.get(n)||t,o=t-i;o>0&&(s.processConsumption(o),this.lastAzureServiceBusUpdate.set(n,t))}for(const[n,s]of this.pubSubRoutingEngines.entries()){const i=this.lastPubSubUpdate.get(n)||t,o=t-i;o>0&&(s.processConsumption(o),this.lastPubSubUpdate.set(n,t))}for(const n of this.nodes)this.updateComponentMetrics(n);try{ha.analyze(this.nodes,this.metrics,this.connectionMetrics,[])}catch(n){nt.addError(n,{severity:"critical",source:"alert-system",context:{operation:"analyze"}})}const e=ha.getAlerts();for(const[n,s]of this.pagerDutyEngines.entries())s.processAlerts(t,e),s.advanceTime(t);for(const[n,s]of this.prometheusEngines.entries())s.performScraping(t,this.nodes,this.metrics);for(const[n,s]of this.grafanaEngines.entries()){const i=this.nodes.find(o=>o.id===n);if(i){const o=this.isPrometheusAvailableForGrafana(i),c=this.createLokiQueryExecutor(i);s.performUpdate(t,o,c)}}for(const[n,s]of this.lokiEngines.entries())s.performRetention(t);for(const[n,s]of this.jaegerEngines.entries())s.performCleanup(t);for(const[n,s]of this.jenkinsEngines.entries())try{const i=this.nodes.find(u=>u.id===n);s.performUpdate(t);const o=s.calculateComponentMetrics(),c=this.metrics.get(n);c&&o&&(c.throughput=o.throughput||c.throughput,c.latency=o.latency||c.latency,c.utilization=(o.utilization||0)/100,c.errorRate=(o.errorRate||0)/100,c.timestamp=t)}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"jenkins",operation:"performUpdate"}})}for(const[n,s]of this.gitlabCIEngines.entries())try{const i=this.nodes.find(u=>u.id===n);s.performUpdate(t);const o=s.getMetrics(),c=this.metrics.get(n);if(c&&o){c.throughput=o.pipelinesPerHour/3600,c.latency=o.averagePipelineDuration||0;const u=o.pipelinesSuccess+o.pipelinesFailed;c.errorRate=u>0?o.pipelinesFailed/u:0,c.utilization=o.pipelinesTotal>0?o.pipelinesRunning/o.pipelinesTotal:0,c.customMetrics={pipelinesTotal:o.pipelinesTotal,pipelinesRunning:o.pipelinesRunning,jobsRunning:o.jobsRunning,runnersOnline:o.runnersOnline}}}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"gitlab-ci",operation:"performUpdate"}})}for(const[n,s]of this.argoCDEngines.entries())try{const i=this.nodes.find(u=>u.id===n);s.performUpdate(t);const o=s.getMetrics(),c=this.metrics.get(n);if(c&&o){c.throughput=o.syncRate/3600,c.latency=o.averageSyncDuration||0;const u=o.syncOperationsSuccess+o.syncOperationsFailed;c.errorRate=u>0?o.syncOperationsFailed/u:0,c.utilization=o.applicationsTotal>0?o.syncOperationsRunning/o.applicationsTotal:0,c.customMetrics={applicationsTotal:o.applicationsTotal,applicationsSynced:o.applicationsSynced,applicationsOutOfSync:o.applicationsOutOfSync,syncOperationsRunning:o.syncOperationsRunning,repositoriesConnected:o.repositoriesConnected}}}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"argo-cd",operation:"performUpdate"}})}for(const[n,s]of this.harborEngines.entries())try{if(!this.nodes.find(c=>c.id===n))continue;const o=this.connections.some(c=>c.target===n);s.performUpdate(t,o)}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"harbor",operation:"performUpdate"}})}for(const[n,s]of this.dockerEngines.entries())try{if(!this.nodes.find(c=>c.id===n))continue;const o=this.connections.some(c=>c.target===n);s.performUpdate(t,o)}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"docker",operation:"performUpdate"}})}for(const[n,s]of this.kubernetesEngines.entries())try{if(!this.nodes.find(o=>o.id===n))continue;s.simulateStep()}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"kubernetes",operation:"simulateStep"}})}for(const[n,s]of this.ansibleEngines.entries())try{if(!this.nodes.find(u=>u.id===n))continue;s.performUpdate(t);const o=s.getMetrics(),c=this.metrics.get(n);c&&o&&(c.throughput=o.jobsPerHour/3600,c.latency=o.averageJobDuration*1e3)}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"ansible",operation:"performUpdate"}})}for(const[n,s]of this.otelCollectorEngines.entries())try{const i=this.nodes.find(o=>o.id===n)}catch(i){const o=this.nodes.find(c=>c.id===n);nt.addError(i,{severity:"warning",source:"component-engine",componentId:n,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"opentelemetry",operation:"processBatchFlush"}})}for(const n of this.connections)try{this.updateConnectionMetrics(n)}catch(s){nt.addError(s,{severity:"warning",source:"emulation-engine",context:{operation:"updateConnectionMetrics",connectionId:n.id}})}}updateComponentMetrics(t){const e=t.data.config||{},n=this.metrics.get(t.id)||this.createDefaultMetrics(t.id,t.type),s=this.connections.some(u=>u.target===t.id),i=this.connections.some(u=>u.source===t.id);if(!(s||i))n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,n.customMetrics={};else switch(t.type){case"kafka":this.simulateKafka(t,e,n,s);break;case"rabbitmq":this.simulateRabbitMQ(t,e,n,s);break;case"activemq":this.simulateActiveMQ(t,e,n,s);break;case"aws-sqs":this.simulateSQS(t,e,n,s);break;case"azure-service-bus":this.simulateAzureServiceBus(t,e,n,s);break;case"gcp-pubsub":this.simulatePubSub(t,e,n,s);break;case"postgres":case"mongodb":case"redis":case"cassandra":this.simulateDatabase(t,e,n,s);break;case"nginx":this.simulateNginx(t,e,n,s);break;case"haproxy":this.simulateHAProxy(t,e,n,s);break;case"traefik":this.simulateTraefik(t,e,n,s);break;case"envoy":this.simulateEnvoy(t,e,n,s);break;case"istio":this.simulateIstio(t,e,n,s);break;case"service-mesh":this.simulateServiceMesh(t,e,n,s);break;case"docker":this.simulateDocker(t,e,n,s);break;case"kubernetes":this.simulateKubernetes(t,e,n,s);break;case"rest":case"grpc":case"websocket":this.simulateAPI(t,e,n,s);break;case"kong":this.simulateKong(t,e,n,s);break;case"api-gateway":this.simulateAPIGateway(t,e,n,s);break;case"apigee":this.simulateApigee(t,e,n,s);break;case"mulesoft":this.simulateMuleSoft(t,e,n,s);break;case"bff-service":this.simulateBFF(t,e,n,s);break;case"prometheus":this.simulatePrometheus(t,e,n,s);break;case"grafana":this.simulateGrafana(t,e,n,s);break;case"loki":this.simulateLoki(t,e,n,s);break;case"keycloak":this.simulateKeycloak(t,e,n,s);break;case"secrets-vault":this.simulateVault(t,e,n,s);break;case"pagerduty":this.simulatePagerDuty(t,e,n,s);break;case"waf":this.simulateWAF(t,e,n,s);break;case"firewall":this.simulateFirewall(t,e,n,s);break;case"vpn":this.simulateVPN(t,e,n,s);break;case"cdn":this.simulateCDN(t,e,n,s);break;case"ids-ips":this.simulateIDSIPS(t,e,n,s);break;case"argo-cd":this.simulateArgoCD(t,e,n,s);break;case"terraform":this.simulateTerraform(t,e,n,s);break;case"ansible":this.simulateAnsible(t,e,n,s);break;case"harbor":this.simulateHarbor(t,e,n,s);break;case"docker":this.simulateDocker(t,e,n,s);break}this.applyCascadeEffects(t,n);const c=mo.applyStateEffects(t.id,{throughput:n.throughput,latency:n.latency,errorRate:n.errorRate,utilization:n.utilization});n.throughput=c.throughput,n.latency=c.latency,n.errorRate=c.errorRate,n.utilization=c.utilization,this.updateLatencyPercentiles(t.id,n.latency,n),n.timestamp=Date.now(),this.metrics.set(t.id,n)}applyCascadeEffects(t,e){const n=this.connections.filter(f=>f.target===t.id);if(n.length===0)return;let s=0,i=0,o=0;const c=e.latency;for(const f of n){const m=this.metrics.get(f.source),y=this.connectionMetrics.get(f.id);if(!m||!y)continue;const v=y.throughputDependency||.5;o+=v;const x=m.errorRate*v*.3;s+=x*v;const R=Math.min(m.latency,500)*v*.2;i+=R*v,(m.errorRate>.5||m.utilization>.95)&&(s+=.1*v,i+=100*v)}o>0&&(s/=o,i/=o),i=Math.min(i,500),e.errorRate=Math.min(1,e.errorRate+s),e.latency=c+i;const h=1e4;e.latency=Math.min(e.latency,h),i>50&&(e.utilization=Math.min(1,e.utilization+.1)),s>.1&&(e.throughput=e.throughput*(1-s*.5))}updateConnectionMetrics(t){const e=this.metrics.get(t.source),n=this.metrics.get(t.target);if(!e||!n)return;const s=this.connectionMetrics.get(t.id)||{id:t.id,source:t.source,target:t.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0},i=this.nodes.find(u=>u.id===t.source),o=this.nodes.find(u=>u.id===t.target),c=i?.data.config?.avgPayloadSize||1024;s.traffic=e.throughput*c/1024,s.latency=this.calculateConnectionLatency(t,e,n),s.errorRate=e.errorRate*.1,this.calculateInteractionMetrics(t,s,e,n,i,o),this.updateConnectionLatencyPercentiles(t.id,s.latency,s),s.timestamp=Date.now(),this.connectionMetrics.set(t.id,s)}calculateInteractionMetrics(t,e,n,s,i,o){const c=t.data||{},h=(c.bandwidthMbps||1e3)*1024*1024/8;this.getComponentCapacity(i);const f=this.getComponentCapacity(o),m=n.throughput,y=i?.data.config?.avgPayloadSize||1024,v=m*y,x=Math.min(v,h),S=f*y,R=Math.min(x,S);e.effectiveThroughput=R/y;const T=this.connections.filter(J=>J.target===t.target).reduce((J,te)=>{const le=this.metrics.get(te.source);return J+(le?.throughput||0)},0);e.throughputDependency=T>0?m/T:0;const k=s.utilization,A=v/h,_=m/f,P=(c.packetLossPercent||0)/100;e.backpressure=Math.min(1,k*.4+A*.3+_*.2+P*.1);const z=v>h*.8,q=m>f*.8,Z=e.backpressure>.7;e.bottleneck=z||q||Z;const se=this.getBaseLatency(t.type),ce=Math.max(0,e.latency-se)/se;e.congestion=Math.min(1,A*.4+ce*.3+P*.3),e.utilization=Math.min(1,e.effectiveThroughput/f)}getComponentCapacity(t){if(!t)return 1e3;const e=t.data.config||{};switch(t.type){case"kafka":case"rabbitmq":case"activemq":return e.throughputMsgs||1e3;case"postgres":case"mongodb":case"redis":return e.maxConnections?e.maxConnections*10:1e3;case"nginx":case"haproxy":case"rest":case"grpc":case"websocket":return e.requestsPerSecond||1e3;case"docker":case"kubernetes":return(e.workerThreads||1)*500;default:return 1e3}}getBaseLatency(t){return{sync:5,async:2,http:10,grpc:5,websocket:3}[t]||10}simulateKafka(t,e,n,s){const i=t.data.config,o=i?.brokers||["localhost:9092"],c=i?.topics||[],u=i?.consumerGroups||[],h=c.length||e.topicCount||5,f=c.reduce((N,O)=>N+(O.partitions||3),0)||e.partitions||3,m=c.length>0?c.reduce((N,O)=>N+(O.replication||1),0)/c.length:e.replicationFactor||1,y=this.connections.filter(N=>N.target===t.id);let v=0;for(const N of y){const O=this.metrics.get(N.source);O&&(v+=O.throughput||0)}const x=e.throughputMsgs||Math.max(1e3,v);if(!s&&x<=0){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,c.length>0)for(const N of c)N.messages=N.messages||0,N.size=N.size||0;for(const N of u)N.lag=0;n.customMetrics={topics:h,partitions:f,replication:Math.round(m*10)/10,brokers:o.length,consumer_groups:u.length,total_lag:0};return}const S=.2*Math.sin(this.simulationTime/1e3);n.throughput=x*(1+S);const R=3,M=Math.min(f/10,10),T=Math.max(1,(m-1)*2),k=Math.max(0,(m-1)*1),A=this.calculateCompressionOverhead(c);if(n.latency=R+M+T+k+A,o.length>1){const N=Math.min(5,o.length*.5);n.latency+=N}const _=this.calculateUnderReplicatedPartitions(c,o.length),P=m>1?(m-1)*5e-4:0,z=_>0?_*.001:0,q=i?.acls||[];let Z=0,se=0;for(const N of y){const O=this.nodes.find(Y=>Y.id===N.source);if(!O)continue;const W=O.data.config||{},fe=W.messaging?.producerId||W.clientId||`User:${O.id.slice(0,8)}`,j=W.messaging?.topic||c[0]?.name||"default-topic";if(!this.checkACLPermission(q,fe,"Topic",j,"Write")){const Y=this.metrics.get(N.source);Y&&(se+=Y.throughput*.9,Z+=.45)}}se>0&&(n.throughput=Math.max(0,n.throughput-se)),n.errorRate=Math.max(0,Math.min(.1,P+z+Z+1e-4));const J=Math.min(1,n.throughput/1e4),te=Math.min(1,f/200);n.utilization=Math.min(1,J*.7+te*.3);const le=e.avgPayloadSize||1024,ue=this.updateInterval/1e3;for(const N of c){const O=n.throughput/h,W=O*ue;N.messages=(N.messages||0)+W;const fe=this.getCompressionRatio(N.config?.compressionType),j=W*le*fe;if(N.size=(N.size||0)+j,N.config?.retentionMs&&N.config.retentionMs>0){const F=N.config.retentionMs/1e3,ie=O*F;if(N.messages>ie){const U=N.messages-ie;N.messages=ie,N.size=Math.max(0,N.size-U*le*fe)}}if(N.config?.retentionBytes&&N.config.retentionBytes>0&&N.size>N.config.retentionBytes){const F=1-N.config.retentionBytes/N.size;N.size=N.config.retentionBytes,N.messages=Math.max(0,N.messages*(1-F))}if((N.config?.cleanupPolicy==="compact"||N.config?.cleanupPolicy==="delete,compact")&&this.simulationTime%3e5<this.updateInterval){const ie=Math.round(N.messages*.85),U=N.messages-ie;N.messages=ie,N.size=Math.max(0,N.size-U*le*fe)}if(N.config?.minInsyncReplicas){const F=N.config.minInsyncReplicas,Y=this.getAverageISRCount(N,o.length);if(Y<F){const ie=F-Y;n.errorRate+=ie*.01}}if(N.config?.maxMessageBytes&&le>N.config.maxMessageBytes){const F=Math.min(.1,(le-N.config.maxMessageBytes)/N.config.maxMessageBytes);n.errorRate+=F*.5}}let L=0;for(const N of u){const O=c.find(at=>at.name===N.topic);if(!O)continue;const W=N.members||1,fe=O.partitions||1,j=this.assignPartitionsToConsumers(W,fe),F=300;let Y=0;for(const at of j){const Je=at.partitions.length;Y+=Je*F}const ie=Math.min(Y,W*F),U=n.throughput/h||0,ae=N.id||`Group:${N.id}`,B=this.checkACLPermission(q,ae,"Topic",N.topic,"Read"),Q=this.checkACLPermission(q,ae,"Group",N.id,"Read");let pe=ie;(!B||!Q)&&(pe=0);const me=U,ye=pe,ve=Math.max(0,(me-ye)*ue),je=N.lag||0,Be=Math.max(0,je+ve-ye*ue);N.lag=Be,L+=Be,this.isRebalancing(t.id,N.id)&&(N.lag=Math.min(Be*1.2,Be+me*ue*.3),L+=Be*.2)}n.customMetrics={topics:h,partitions:f,replication:Math.round(m*10)/10,brokers:o.length,consumer_groups:u.length,total_lag:Math.round(L),avg_topic_messages:h>0?Math.round(c.reduce((N,O)=>N+(O.messages||0),0)/h):0,total_topic_size_mb:Math.round(c.reduce((N,O)=>N+(O.size||0),0)/1024/1024*100)/100,under_replicated_partitions:_}}calculateCompressionOverhead(t){if(t.length===0)return 0;const e={uncompressed:0,gzip:2,snappy:.5,lz4:.3,zstd:1};let n=0,s=0;for(const i of t){const o=i.config?.compressionType||"gzip",c=e[o]||0;c>0&&(n+=c,s++)}return s>0?n/s:0}getCompressionRatio(t){return{uncompressed:1,gzip:.3,snappy:.5,lz4:.4,zstd:.25}[t||"gzip"]||.3}calculateUnderReplicatedPartitions(t,e){let n=0;for(const s of t){const i=s.replication||1,o=s.partitions||1;if(s.partitionInfo&&Array.isArray(s.partitionInfo))for(const c of s.partitionInfo){const u=i;(c.isr?.length||c.replicas?.length||1)<u&&n++}else i>e&&(n+=o*Math.max(0,1-e/i)),Math.random()<.05&&i>1&&(n+=o*.1)}return Math.round(n)}assignPartitionsToConsumers(t,e){if(t===0||e===0)return[];const n=[],s=Math.floor(e/t),i=e%t;let o=0;for(let c=0;c<t;c++){const u=[],h=s+(c<i?1:0);for(let f=0;f<h;f++)o<e&&(u.push(o),o++);n.push({consumerId:c,partitions:u})}return n}consumerGroupMemberCounts=new Map;rebalancingGroups=new Map;isRebalancing(t,e){const n=`${t}:${e}`,s=this.rebalancingGroups.get(n);if(s&&Date.now()<s)return!0;const i=this.getCurrentGroupMembers(t,e),o=this.consumerGroupMemberCounts.get(n);return o!==void 0&&i!==o?(this.rebalancingGroups.set(n,Date.now()+2e3),this.consumerGroupMemberCounts.set(n,i),!0):((o===void 0||i!==o)&&this.consumerGroupMemberCounts.set(n,i),!1)}getCurrentGroupMembers(t,e){const n=this.nodes.find(c=>c.id===t);return n&&(n.data.config?.consumerGroups||[]).find(c=>c.id===e)?.members||0}getAverageISRCount(t,e){if(!t.partitionInfo||!Array.isArray(t.partitionInfo)||t.partitionInfo.length===0){const i=t.replication||1;return Math.min(i,e)*.95}let n=0,s=0;for(const i of t.partitionInfo){const o=i.isr?.length||i.replicas?.length||1;n+=o,s++}return s>0?n/s:1}checkACLPermission(t,e,n,s,i,o){if(!t||t.length===0)return!0;const c=e.includes(":")?e:`User:${e}`,u=t.filter(m=>{const y=m.principal||"";if(y!==c&&y!=="*"&&!c.includes(y)||m.resourceType!==n)return!1;const v=m.resourcePatternType||"Literal",x=m.resourceName||"";let S=!1;switch(v){case"Literal":S=x===s||x==="*";break;case"Prefixed":if(x==="*")S=!0;else if(x.endsWith("*")){const R=x.slice(0,-1);S=s.startsWith(R)}else S=s.startsWith(x);break;case"Match":if(x==="*")S=!0;else{const R=x.replace(/\./g,"\\.").replace(/\*/g,".*");S=new RegExp(`^${R}$`).test(s)}break;default:S=x===s||x==="*"}return!(!S||m.operation!==i&&m.operation!=="All"||m.host&&m.host!=="*"&&o&&m.host!==o)});return u.length===0||u.filter(m=>m.permission==="Deny").length>0?!1:u.filter(m=>m.permission==="Allow").length>0}simulateRabbitMQ(t,e,n,s){this.rabbitMQRoutingEngines.has(t.id)||this.initializeRabbitMQRoutingEngine(t);const i=this.rabbitMQRoutingEngines.get(t.id);if(t.data.config,!s){n.throughput=0,n.latency=2,n.errorRate=0;const k=i.getTotalQueueDepth();n.utilization=Math.min(1,k/1e5);const A=i.getAllQueueMetrics(),_=i.getActiveConnections();n.customMetrics={queue_depth:k,connections:_,replication:e.replicationFactor||1},this.updateQueueMetricsInConfig(t,A);return}const o=this.connections.filter(k=>k.target===t.id);let c=0;for(const k of o){const A=this.connectionMetrics.get(k.id);if(A){const P=A.traffic/1024;c+=P}}const u=e.throughputMsgs||c||1e3,h=e.replicationFactor||1,f=(Math.random()-.5)*.1;n.throughput=u*(1+f);const m=i.getTotalQueueDepth(),y=2,v=Math.min(50,m/1e3);n.latency=y+h*5+v+Math.random()*5;const x=5e-4,S=Math.min(.01,m/1e6);n.errorRate=x+S,n.utilization=Math.min(1,m/1e5);const R=i.getAllQueueMetrics(),M=i.getActiveConnections();let T=0;for(const k of R.values())T+=k.consumers;n.customMetrics={queue_depth:m,connections:M,replication:h,queues:R.size,consumers:T},this.updateQueueMetricsInConfig(t,R)}initializeRabbitMQRoutingEngine(t){const e=t.data.config||{},n=new Ak;n.initialize({queues:e.queues||[],exchanges:e.exchanges||[{name:"amq.direct",type:"direct",durable:!0,autoDelete:!1,internal:!1},{name:"amq.topic",type:"topic",durable:!0,autoDelete:!1,internal:!1},{name:"amq.fanout",type:"fanout",durable:!0,autoDelete:!1,internal:!1}],bindings:e.bindings||[]}),this.rabbitMQRoutingEngines.set(t.id,n),this.lastRabbitMQUpdate.set(t.id,Date.now())}updateQueueMetricsInConfig(t,e){const n=t.data.config||{},s=n.queues||[];for(let i=0;i<s.length;i++){const o=s[i],c=e.get(o.name);c&&(s[i]={...o,messages:c.messages,ready:c.ready,unacked:c.unacked,consumers:c.consumers})}n.queues=s}simulateActiveMQ(t,e,n,s){this.activeMQRoutingEngines.has(t.id)||this.initializeActiveMQRoutingEngine(t);const i=this.activeMQRoutingEngines.get(t.id),o=t.data.config||{},c=o.protocol||"openwire",u=o.persistenceEnabled??!0,h=o.maxConnections||1e3,f=o.memoryLimit||1024,m=o.storeUsage||0,y=o.tempUsage||0,v=o.connections||[];if(!s){n.throughput=0,n.latency=this.getProtocolBaseLatency(c),n.errorRate=0;const U=i.getTotalQueueDepth(),ae=i.getTotalTopicMessages(),B=U+ae;n.utilization=Math.min(1,B/1e5);const Q=i.getAllQueueMetrics(),pe=i.getAllTopicMetrics(),me=i.getActiveConnections();let ye=0;for(const je of Q.values())ye+=je.consumerCount;let ve=0;for(const je of pe.values())ve+=je.subscriberCount;n.customMetrics={queue_depth:U,topic_messages:ae,connections:me,queues:Q.size,topics:pe.size,consumers:ye,subscribers:ve,memory_usage:m+y,memory_percent:f>0?(m+y)/f*100:0},this.updateActiveMQMetricsInConfig(t,Q,pe);return}const x=this.connections.filter(U=>U.target===t.id);let S=0;for(const U of x){const ae=this.connectionMetrics.get(U.id);if(ae){const Q=ae.traffic/1024;S+=Q}}const R=e.throughputMsgs||S||1e3,M=(Math.random()-.5)*.1;n.throughput=R*(1+M);const T=i.getTotalQueueDepth(),k=i.getTotalTopicMessages(),A=T+k,_=this.getProtocolBaseLatency(c),P=u?5:0,z=Math.min(50,A/1e3),q=f>0&&m+y>f*.8?10:0;n.latency=_+P+z+q+Math.random()*5;const Z=o.acls||[];let se=0,ce=0;for(const U of x){const ae=this.nodes.find(me=>me.id===U.source);if(!ae)continue;const B=ae.data.config,Q=B?.messaging||{},pe=B?.username||B?.clientId||o.username||`user-${U.source.slice(0,8)}`;if(Q.queue&&!this.checkActiveMQACLPermission(Z,pe,`queue://${Q.queue}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,se+=.45)}if(Q.topic&&!this.checkActiveMQACLPermission(Z,pe,`topic://${Q.topic}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,se+=.45)}}const J=o.queues||[];for(const U of J)U.consumerCount&&U.consumerCount>0&&(this.checkActiveMQACLPermission(Z,o.username||"admin",`queue://${U.name}`,"read")||(se+=.1));const te=5e-4,le=Math.min(.01,A/1e6),ue=f>0&&m+y>f?.01:0,L=v.length>=h?.005:0;ce>0&&(n.throughput=Math.max(0,n.throughput-ce)),n.errorRate=Math.min(1,te+le+ue+L+se);const N=Math.min(1,A/1e5),O=f>0?Math.min(1,(m+y)/f):0,W=Math.min(1,v.length/h);n.utilization=Math.max(N,O,W);const fe=i.getAllQueueMetrics(),j=i.getAllTopicMetrics(),F=i.getActiveConnections();let Y=0;for(const U of fe.values())Y+=U.consumerCount;let ie=0;for(const U of j.values())ie+=U.subscriberCount;n.customMetrics={queue_depth:T,topic_messages:k,connections:F,queues:fe.size,topics:j.size,consumers:Y,subscribers:ie,memory_usage:m+y,memory_percent:f>0?(m+y)/f*100:0,protocol:c},this.updateActiveMQMetricsInConfig(t,fe,j)}checkActiveMQACLPermission(t,e,n,s){if(!t||t.length===0)return!0;const i=t.filter(u=>{const h=u.principal||"";if(h!==e&&h!=="*"&&!e.includes(h))return!1;const f=u.resource||"";let m=!1;if(f==="*"||f===n)m=!0;else if(f.endsWith("*")){const x=f.slice(0,-1);m=n.startsWith(x)}else f.includes("://")?m=f===n:m=n.includes(f);if(!m)return!1;const y=(u.operation||"").toLowerCase(),v=s.toLowerCase();return!(y!==v&&y!=="all"&&y!=="*")});return i.length===0?!0:i.filter(u=>u.permission==="deny").length>0?!1:(i.filter(u=>u.permission==="allow").length>0,!0)}getProtocolBaseLatency(t){return{openwire:2,amqp:5,mqtt:8,stomp:10,ws:12}[t]||5}initializeActiveMQRoutingEngine(t){const e=t.data.config||{},n=new Dk;n.initialize({queues:e.queues||[],topics:e.topics||[],subscriptions:e.subscriptions||[]}),this.activeMQRoutingEngines.set(t.id,n),this.lastActiveMQUpdate.set(t.id,Date.now())}updateActiveMQMetricsInConfig(t,e,n){const s=t.data.config||{},i=s,o=s.queues||[];for(let m=0;m<o.length;m++){const y=o[m],v=e.get(y.name);v&&(o[m]={...y,queueSize:v.queueSize,consumerCount:v.consumerCount,enqueueCount:v.enqueueCount,dequeueCount:v.dequeueCount})}s.queues=o;const c=s.topics||[];for(let m=0;m<c.length;m++){const y=c[m],v=n.get(y.name);v&&(c[m]={...y,subscriberCount:v.subscriberCount,enqueueCount:v.enqueueCount,dequeueCount:v.dequeueCount})}s.topics=c;const u=this.connections.filter(m=>m.target===t.id),h=[];for(const m of u){const y=this.nodes.find(M=>M.id===m.source);if(!y)continue;y.data.config?.messaging;const x=i.protocol||"openwire",S=this.connectionMetrics.get(m.id),R=S?Math.floor(S.traffic/1024):0;h.push({id:m.id,remoteAddress:`${y.data.label||y.id}`,clientId:`client-${m.source.slice(0,8)}`,userName:i.username||"admin",connectedSince:new Date().toISOString(),messageCount:R,protocol:x==="openwire"?"OpenWire":x==="amqp"?"AMQP":x==="mqtt"?"MQTT":x==="stomp"?"STOMP":x==="ws"?"WebSocket":"OpenWire"})}s.connections=h;const f=[];for(const m of c)for(const y of u){const v=this.nodes.find(R=>R.id===y.source);if(!v)continue;const S=v.data.config?.messaging||{};if(S.topic===m.name||!S.queue){const R=n.get(m.name);f.push({id:`sub-${y.id}-${m.name}`,destination:m.name,clientId:`client-${y.source.slice(0,8)}`,pendingQueueSize:0,dispatchedQueueSize:0,dispatchedCounter:R?.enqueueCount||0,enqueueCounter:R?.enqueueCount||0,dequeueCounter:R?.dequeueCount||0})}}s.subscriptions=f}simulateAzureServiceBus(t,e,n,s){this.azureServiceBusRoutingEngines.has(t.id)||this.initializeAzureServiceBusRoutingEngine(t);const i=this.azureServiceBusRoutingEngines.get(t.id),o=t.data.config||{};if(!s){n.throughput=0,n.latency=5,n.errorRate=0;const se=i.getTotalQueueDepth(),ce=i.getTotalSubscriptionMessages(),J=se+ce;n.utilization=Math.min(1,J/1e5);const te=i.getAllQueueMetrics(),le=i.getAllSubscriptionMetrics(),ue=i.getActiveConnections();n.customMetrics={queue_depth:se,subscription_messages:ce,connections:ue,queues:o.queues?.length||0,topics:o.topics?.length||0},this.updateAzureServiceBusMetricsInConfig(t,te,le);return}const c=this.connections.filter(se=>se.target===t.id);let u=0;for(const se of c){const ce=this.connectionMetrics.get(se.id);if(ce){const te=ce.traffic/1024;u+=te}}const h=e.throughputMsgs||u||1e3,f=(Math.random()-.5)*.1;n.throughput=h*(1+f);const m=i.getTotalQueueDepth(),y=i.getTotalSubscriptionMessages(),v=m+y,x=5,S=Math.min(50,v/1e3),R=2;n.latency=x+S+R+Math.random()*5;const M=i.getAllQueueMetrics(),T=i.getAllSubscriptionMetrics(),k=i.getActiveConnections(),A=5e-4,_=Math.min(.01,v/1e6);let P=0;for(const se of M.values())P+=se.deadLetterMessageCount||0;for(const se of T.values())P+=se.deadLetterMessageCount||0;const z=P>0?Math.min(.05,P/1e4):0;n.errorRate=Math.min(1,A+_+z),n.utilization=Math.min(1,v/1e5);let q=0;const Z=o.topics||[];for(const se of Z)q+=(se.subscriptions||[]).length;n.customMetrics={queue_depth:m,subscription_messages:y,dead_letter_messages:P,connections:k,queues:o.queues?.length||0,topics:o.topics?.length||0,subscriptions:q},this.updateAzureServiceBusMetricsInConfig(t,M,T)}initializeAzureServiceBusRoutingEngine(t){const e=t.data.config||{},n=new Pk,s=(e.queues||[]).map(o=>({name:o.name,namespace:o.namespace||e.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:o.maxSizeInMegabytes||1024,defaultMessageTimeToLive:o.defaultMessageTimeToLive||2592e3,lockDuration:o.lockDuration||30,maxDeliveryCount:o.maxDeliveryCount||10,enablePartitioning:o.enablePartitioning||!1,enableDeadLetteringOnMessageExpiration:o.enableDeadLetteringOnMessageExpiration!==void 0?o.enableDeadLetteringOnMessageExpiration:!0,enableSessions:o.enableSessions||!1,activeMessageCount:o.activeMessageCount||0,deadLetterMessageCount:o.deadLetterMessageCount||0,scheduledMessageCount:o.scheduledMessageCount||0})),i=(e.topics||[]).map(o=>({name:o.name,namespace:o.namespace||e.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:o.maxSizeInMegabytes||1024,defaultMessageTimeToLive:o.defaultMessageTimeToLive||2592e3,enablePartitioning:o.enablePartitioning||!1,subscriptions:(o.subscriptions||[]).map(c=>({name:c.name,maxDeliveryCount:c.maxDeliveryCount||10,lockDuration:c.lockDuration||30,enableDeadLetteringOnMessageExpiration:c.enableDeadLetteringOnMessageExpiration!==void 0?c.enableDeadLetteringOnMessageExpiration:!0,activeMessageCount:c.activeMessageCount||0}))}));n.initialize({queues:s,topics:i}),this.azureServiceBusRoutingEngines.set(t.id,n),this.lastAzureServiceBusUpdate.set(t.id,Date.now())}updateAzureServiceBusMetricsInConfig(t,e,n){const s=t.data.config||{},i=s.queues||[];for(let c=0;c<i.length;c++){const u=i[c],h=e.get(u.name);h&&(i[c]={...u,activeMessageCount:h.activeMessageCount,deadLetterMessageCount:h.deadLetterMessageCount,scheduledMessageCount:h.scheduledMessageCount})}s.queues=i;const o=s.topics||[];for(let c=0;c<o.length;c++){const u=o[c],h=u.subscriptions||[];for(let f=0;f<h.length;f++){const m=h[f],y=`${u.name}/subscriptions/${m.name}`,v=n.get(y);v&&(h[f]={...m,activeMessageCount:v.activeMessageCount})}o[c]={...u,subscriptions:h}}s.topics=o}simulatePubSub(t,e,n,s){this.pubSubRoutingEngines.has(t.id)||this.initializePubSubRoutingEngine(t);const i=this.pubSubRoutingEngines.get(t.id),o=t.data.config||{},c=o.topics||[],u=o.subscriptions||[];if(!s){n.throughput=0,n.latency=3,n.errorRate=0;const L=i.getTotalTopicMessages(),N=i.getTotalUnackedMessages(),O=L+N;n.utilization=Math.min(1,O/1e5);const W=i.getAllTopicMetrics(),fe=i.getAllSubscriptionMetrics(),j=i.getActiveConnections();n.customMetrics={topic_messages:L,unacked_messages:N,connections:j,topics:c.length,subscriptions:u.length},this.updatePubSubMetricsInConfig(t,W,fe);return}const h=this.connections.filter(L=>L.target===t.id);let f=0;for(const L of h){const N=this.connectionMetrics.get(L.id);if(N){const W=N.traffic/1024;f+=W}}const m=e.throughputMsgs||f||1e3,y=(Math.random()-.5)*.1;n.throughput=m*(1+y);const v=i.getTotalTopicMessages(),x=i.getTotalUnackedMessages(),S=v+x,R=3,M=Math.min(15,S/1e4),T=u.filter(L=>L.pushEndpoint).length,k=T>0?2:0,A=x>0?.5:0;n.latency=R+M+k+A+Math.random()*2;const _=i.getAllTopicMetrics(),P=i.getAllSubscriptionMetrics(),z=i.getActiveConnections(),q=1e-4,Z=Math.min(.001,S/5e6),se=T>0&&x>0?Math.min(.002,x/1e5):0,ce=u.length>0?u.reduce((L,N)=>L+(N.ackDeadlineSeconds||10),0)/u.length:10,J=x>0&&ce<60?Math.min(.005,x/1e5):0;n.errorRate=Math.min(1,q+Z+se+J);const te=Math.min(1,n.throughput/1e5),le=Math.min(.3,S/5e5);n.utilization=Math.min(1,te*.7+le*.3);const ue=u.length-T;n.customMetrics={topic_messages:v,unacked_messages:x,connections:z,topics:c.length,subscriptions:u.length,push_subscriptions:T,pull_subscriptions:ue,total_bytes:Array.from(_.values()).reduce((L,N)=>L+N.byteCount,0)},this.updatePubSubMetricsInConfig(t,_,P)}initializePubSubRoutingEngine(t){const e=t.data.config||{},n=new Nk,s=(e.topics||[]).map(o=>({name:o.name,projectId:o.projectId||e.projectId||"archiphoenix-lab",messageRetentionDuration:o.messageRetentionDuration||604800,labels:o.labels||{},messageCount:o.messageCount||0,byteCount:o.byteCount||0})),i=(e.subscriptions||[]).map(o=>({name:o.name,topic:o.topic,projectId:o.projectId||e.projectId||"archiphoenix-lab",ackDeadlineSeconds:o.ackDeadlineSeconds||10,messageRetentionDuration:o.messageRetentionDuration,enableMessageOrdering:o.enableMessageOrdering||!1,pushEndpoint:o.pushEndpoint,pushAttributes:o.pushAttributes||{},messageCount:o.messageCount||0,unackedMessageCount:o.unackedMessageCount||0}));n.initialize({topics:s,subscriptions:i}),this.pubSubRoutingEngines.set(t.id,n),this.lastPubSubUpdate.set(t.id,Date.now())}updatePubSubMetricsInConfig(t,e,n){const s=t.data.config||{},i=s.topics||[];for(let c=0;c<i.length;c++){const u=i[c],h=e.get(u.name);h&&(i[c]={...u,messageCount:h.messageCount,byteCount:h.byteCount})}s.topics=i;const o=s.subscriptions||[];for(let c=0;c<o.length;c++){const u=o[c],h=n.get(u.name);h&&(o[c]={...u,messageCount:h.messageCount,unackedMessageCount:h.unackedMessageCount})}s.subscriptions=o}simulateSQS(t,e,n,s){this.sqsRoutingEngines.has(t.id)||this.initializeSQSRoutingEngine(t);const i=this.sqsRoutingEngines.get(t.id);if(t.data.config,!s){n.throughput=0,n.latency=5,n.errorRate=0;const M=i.getTotalQueueDepth();n.utilization=Math.min(1,M/1e5);const T=i.getAllQueueMetrics(),k=i.getActiveConnections();n.customMetrics={queue_depth:M,connections:k,queues:T.size},this.updateSQSQueueMetricsInConfig(t,T);return}const o=this.connections.filter(M=>M.target===t.id);let c=0;for(const M of o){const T=this.connectionMetrics.get(M.id);if(T){const A=T.traffic/1024;c+=A}}const u=e.throughputMsgs||c||1e3,h=(Math.random()-.5)*.1;n.throughput=u*(1+h);const f=i.getTotalQueueDepth(),m=5,y=Math.min(50,f/1e3);n.latency=m+y+Math.random()*5;const v=5e-4,x=Math.min(.01,f/1e6);n.errorRate=v+x,n.utilization=Math.min(1,f/1e5);const S=i.getAllQueueMetrics(),R=i.getActiveConnections();n.customMetrics={queue_depth:f,connections:R,queues:S.size},this.updateSQSQueueMetricsInConfig(t,S)}initializeSQSRoutingEngine(t){const e=t.data.config||{},n=new _k,s=(e.queues||[]).map(i=>({name:i.name,type:i.type||"standard",region:i.region||e.defaultRegion||"us-east-1",visibilityTimeout:i.visibilityTimeout||30,messageRetention:i.messageRetention||4,delaySeconds:i.delaySeconds||0,maxReceiveCount:i.maxReceiveCount,deadLetterQueue:i.deadLetterQueue,contentBasedDedup:i.contentBasedDedup,fifoThroughputLimit:i.fifoThroughputLimit||"perQueue"}));n.initialize({queues:s}),this.sqsRoutingEngines.set(t.id,n),this.lastSQSUpdate.set(t.id,Date.now())}updateSQSQueueMetricsInConfig(t,e){const n=t.data.config||{},s=n.queues||[];for(let i=0;i<s.length;i++){const o=s[i],c=e.get(o.name);c&&(s[i]={...o,approximateMessages:c.approximateMessages,approximateMessagesNotVisible:c.approximateMessagesNotVisible,approximateMessagesDelayed:c.approximateMessagesDelayed})}n.queues=s}simulateDatabase(t,e,n,s){if(!s){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,n.customMetrics={},t.type==="postgres"){const y=this.postgresConnectionPools.get(t.id);y&&y.reset()}return}const i=e.maxConnections||100,o=e.queryLatency||10;if(t.type==="postgres"){const y=this.postgresConnectionPools.get(t.id);if(y){const x=this.connections.filter(P=>P.target===t.id).reduce((P,z)=>{const q=this.metrics.get(z.source);return P+(q?.throughput||0)},0),R=Math.min(x,i*10)*this.updateInterval/1e3;for(let P=0;P<Math.floor(R);P++){const z=y.acquireConnection("SELECT");if(z){const q=o+Math.random()*20;setTimeout(()=>{y.releaseConnection(z,q)},q)}}const M=y.getMetrics();n.throughput=M.queriesPerSecond,n.latency=M.averageQueryTime||o,n.utilization=M.utilization,n.errorRate=M.waitingConnections>0?.01:.001;const k=t.data.config.tables||[];let A=0;for(const P of k)A+=(P.indexes||[]).length;A===0&&(A=5);const _=this.calculateCacheHitRatio(t,M.queriesPerSecond);n.customMetrics={active_connections:M.activeConnections,idle_connections:M.idleConnections,waiting_connections:M.waitingConnections,total_connections:M.totalConnections,max_connections:i,indexes:A,cache_hit_ratio:_,connection_wait_time:M.connectionWaitTime};return}}if(t.type==="redis"){this.redisRoutingEngines.has(t.id)||this.initializeRedisRoutingEngine(t);const y=this.redisRoutingEngines.get(t.id),v=t.data.config;v?.keys&&y.syncKeysFromConfig(v.keys);const x=y.getMetrics(),R=this.connections.filter(A=>A.target===t.id).reduce((A,_)=>{const P=this.metrics.get(_.source);return A+(P?.throughput||0)},0);n.throughput=Math.max(x.operationsPerSecond,R);const M=.5,T=x.memoryUsagePercent/100,k=Math.min(1,x.totalKeys/1e5);n.latency=M+T*2+k*1,n.errorRate=T>.95?.01:.001,n.utilization=x.memoryUsagePercent/100,n.customMetrics={total_keys:x.totalKeys,keys_string:x.keysByType.string,keys_hash:x.keysByType.hash,keys_list:x.keysByType.list,keys_set:x.keysByType.set,keys_zset:x.keysByType.zset,keys_stream:x.keysByType.stream,memory_usage:x.memoryUsage,memory_usage_percent:x.memoryUsagePercent,operations_per_second:x.operationsPerSecond,hit_count:x.hitCount,miss_count:x.missCount,hit_rate:x.hitRate,expired_keys:x.expiredKeys,evicted_keys:x.evictedKeys,connected_clients:x.connectedClients};return}if(t.type==="cassandra"){this.cassandraRoutingEngines.has(t.id)||this.initializeCassandraRoutingEngine(t);const y=this.cassandraRoutingEngines.get(t.id),v=t.data.config;v&&y.syncFromConfig({clusterName:v.clusterName,nodes:v.nodes,keyspaces:v.keyspaces,tables:v.tables,defaultConsistencyLevel:v.consistencyLevel,defaultReplicationFactor:v.replicationFactor});const x=y.getMetrics(),R=this.connections.filter(_=>_.target===t.id).reduce((_,P)=>{const z=this.metrics.get(P.source);return _+(z?.throughput||0)},0);n.throughput=Math.max(x.readOperationsPerSecond+x.writeOperationsPerSecond,R);const M=x.readOperationsPerSecond+x.writeOperationsPerSecond;if(M>0){const _=x.readOperationsPerSecond/M,P=x.writeOperationsPerSecond/M;n.latency=x.readLatency*_+x.writeLatency*P}else n.latency=(x.readLatency+x.writeLatency)/2;const T=x.readConsistencyViolations+x.writeConsistencyViolations;n.errorRate=Math.min(.1,T/Math.max(1,M))||.001;const k=x.totalNodes>0?(x.totalNodes-x.healthyNodes)/x.totalNodes:0,A=Math.min(1,x.pendingCompactions/100);n.utilization=Math.min(1,k*.7+A*.3),n.customMetrics={total_nodes:x.totalNodes,healthy_nodes:x.healthyNodes,total_keyspaces:x.totalKeyspaces,total_tables:x.totalTables,total_rows:x.totalRows,total_size_gb:x.totalSize/(1024*1024*1024),read_latency_ms:x.readLatency,write_latency_ms:x.writeLatency,read_ops_per_sec:x.readOperationsPerSecond,write_ops_per_sec:x.writeOperationsPerSecond,pending_compactions:x.pendingCompactions,read_consistency_violations:x.readConsistencyViolations,write_consistency_violations:x.writeConsistencyViolations,hinted_handoffs:x.hintedHandoffs};return}if(t.type==="clickhouse"){this.clickHouseRoutingEngines.has(t.id)||this.initializeClickHouseRoutingEngine(t);const y=this.clickHouseRoutingEngines.get(t.id),v=t.data.config;v&&y.syncFromConfig({cluster:v.cluster,replication:v.replication,tables:v.tables?.map(A=>({name:A.name,database:v.database||"default",engine:A.engine||"MergeTree",rows:A.rows||0,size:A.size||0,partitions:A.partitions||0,columns:A.columns||[]})),maxMemoryUsage:v.maxMemoryUsage,compression:v.compression});const x=y.getMetrics(),R=this.connections.filter(A=>A.target===t.id).reduce((A,_)=>{const P=this.metrics.get(_.source);return A+(P?.throughput||0)},0);n.throughput=Math.max(x.queriesPerSecond,R),n.latency=x.avgQueryTime;const M=x.memoryUsagePercent/100;n.errorRate=M>.95?.01:.001;const T=Math.min(1,x.activeQueries/10),k=M;n.utilization=Math.max(T,k),n.customMetrics={total_tables:x.totalTables,total_rows:x.totalRows,total_size_gb:x.totalSize/(1024*1024*1024),queries_per_sec:x.queriesPerSecond,read_rows_per_sec:x.readRowsPerSecond,written_rows_per_sec:x.writtenRowsPerSecond,avg_query_time_ms:x.avgQueryTime,active_queries:x.activeQueries,memory_usage_bytes:x.memoryUsage,memory_usage_percent:x.memoryUsagePercent,parts_count:x.partsCount,pending_merges:x.pendingMerges,compression_ratio:x.compressionRatio,cluster_nodes:x.clusterNodes,healthy_nodes:x.healthyNodes};return}if(t.type==="snowflake"){this.snowflakeRoutingEngines.has(t.id)||this.initializeSnowflakeRoutingEngine(t);const y=this.snowflakeRoutingEngines.get(t.id),v=t.data.config;v&&y.syncFromConfig({account:v.account,region:v.region,warehouses:v.warehouses,databases:v.databases,role:v.role,enableAutoSuspend:v.enableAutoSuspend,autoSuspendSeconds:v.autoSuspendSeconds,enableAutoResume:v.enableAutoResume});const x=y.getMetrics(),R=this.connections.filter(M=>M.target===t.id).reduce((M,T)=>{const k=this.metrics.get(T.source);return M+(k?.throughput||0)},0);n.throughput=Math.max(x.queriesPerSecond,R),n.latency=x.avgQueryTime,n.errorRate=.001,n.utilization=x.warehouseUtilization,n.customMetrics={total_warehouses:x.totalWarehouses,running_warehouses:x.runningWarehouses,suspended_warehouses:x.suspendedWarehouses,total_queries:x.totalQueries,running_queries:x.runningQueries,queued_queries:x.queuedQueries,queries_per_sec:x.queriesPerSecond,avg_query_time_ms:x.avgQueryTime,total_compute_time_sec:x.totalComputeTime,total_data_read:x.totalDataRead,total_data_written:x.totalDataWritten,cache_hit_rate:x.cacheHitRate,warehouse_utilization:x.warehouseUtilization,total_cost_credits:x.totalCost};return}if(t.type==="elasticsearch"){this.elasticsearchRoutingEngines.has(t.id)||this.initializeElasticsearchRoutingEngine(t);const y=this.elasticsearchRoutingEngines.get(t.id),v=t.data.config;v&&y.syncFromConfig({clusterName:v.clusterName,nodes:v.nodes,indices:v.indices,defaultShards:v.shards,defaultReplicas:v.replicas,refreshInterval:v.refreshInterval});const x=y.getMetrics(),R=this.connections.filter(_=>_.target===t.id).reduce((_,P)=>{const z=this.metrics.get(P.source);return _+(z?.throughput||0)},0);n.throughput=Math.max(x.indexOperationsPerSecond+x.searchOperationsPerSecond,R);const M=x.indexOperationsPerSecond+x.searchOperationsPerSecond;if(M>0){const _=x.indexOperationsPerSecond/M,P=x.searchOperationsPerSecond/M;n.latency=x.averageIndexLatency*_+x.averageSearchLatency*P}else n.latency=x.averageSearchLatency||10;const T=x.clusterHealth==="red"?.01:x.clusterHealth==="yellow"?.002:.001;n.errorRate=T;const k=x.unassignedShards>0?1:x.relocatingShards>0?.7:x.initializingShards>0?.5:.3,A=x.healthyNodes/x.totalNodes;n.utilization=Math.max(k,1-A),this.updateElasticsearchMetricsInConfig(t,x),n.customMetrics={cluster_health:x.clusterHealth==="green"?1:x.clusterHealth==="yellow"?.5:0,total_nodes:x.totalNodes,healthy_nodes:x.healthyNodes,total_indices:x.totalIndices,total_docs:x.totalDocs,total_size_gb:x.totalSize/(1024*1024*1024),active_shards:x.activeShards,relocating_shards:x.relocatingShards,initializing_shards:x.initializingShards,unassigned_shards:x.unassignedShards,index_ops_per_sec:x.indexOperationsPerSecond,search_ops_per_sec:x.searchOperationsPerSecond,avg_index_latency_ms:x.averageIndexLatency,avg_search_latency_ms:x.averageSearchLatency,avg_get_latency_ms:x.averageGetLatency};return}if(t.type==="s3-datalake"){this.s3RoutingEngines.has(t.id)||this.initializeS3RoutingEngine(t);const y=this.s3RoutingEngines.get(t.id);if(y.processLifecycleTransitions(),!s){n.throughput=0,n.latency=50,n.errorRate=0;const J=y.getAllBucketMetrics(),te=y.getTotalStorageSize(),le=y.getTotalObjectCount(),ue=1024*1024*1024*1024,L=J.size,N=ue*L;n.utilization=N>0?Math.min(1,te/N):0,n.customMetrics={buckets:L,total_objects:le,total_size:te,total_size_mb:Math.round(te/(1024*1024)*100)/100},this.updateS3BucketMetricsInConfig(t,J);return}const v=this.connections.filter(J=>J.target===t.id);let x=0,S=0;for(const J of v){const te=this.connectionMetrics.get(J.id);te&&(x+=te.traffic/1024,S+=te.traffic)}const R=1024*1024,M=S>0?S/R:0;n.throughput=Math.max(0,M),n.latency=50+(M>100?(M-100)*.1:0),n.errorRate=.001;const T=y.getAllBucketMetrics(),k=y.getTotalStorageSize(),A=y.getTotalObjectCount(),_=T.size,z=1024*1024*1024*1024*_,q=z>0?Math.min(1,k/z):0,se=3500*_,ce=se>0?Math.min(1,M/se):0;n.utilization=Math.max(q,ce),n.customMetrics={buckets:_,total_objects:A,total_size:k,total_size_mb:Math.round(k/(1024*1024)*100)/100,total_size_gb:Math.round(k/(1024*1024*1024)*100)/100,estimated_ops_per_sec:Math.round(M*100)/100,storage_utilization:Math.round(q*1e3)/10,ops_utilization:Math.round(ce*1e3)/10},this.updateS3BucketMetricsInConfig(t,T);return}let c=e.indexCount||5;t.type==="mongodb"&&(c=(t.data.config?.collections||[]).reduce((x,S)=>x+(S.indexes?.length||0),0),c===0&&(c=1));const h=this.connections.filter(y=>y.target===t.id).reduce((y,v)=>{const x=this.metrics.get(v.source);return y+(x?.throughput||0)},0),f=Math.min(i,Math.floor(h/10)||Math.floor(i*.3));n.throughput=f*(1e3/(o+Math.random()*20));const m=Math.min(.3,c*.02);if(n.latency=o+f/i*50*(1-m),n.errorRate=.001,n.utilization=f/i,n.customMetrics={active_connections:f,max_connections:i,indexes:c,cache_hit_ratio:Math.random()*.8+.2},t.type==="mongodb"){const y=t.data.config,v=y?.collections||[],x=v.filter(k=>k.validation&&k.validation.validationLevel!=="off").length;if(x>0){const k=Math.min(.05,x*.01);n.errorRate=Math.max(n.errorRate,k)}const S=y?.enableReplicaSet||!1,R=y?.replicaSetMembers||[];if(S&&R.length>1){const k=R.length,A=Math.min(.3,(k-1)*.1);n.errorRate=Math.max(0,n.errorRate*(1-A)),n.latency=n.latency*(1+.05*(k-1))}const M=y?.enableSharding||!1,T=y?.shardConfig;if(M&&T?.shards){const k=T.shards.length,A=1+(k-1)*.3;n.throughput=n.throughput*A,n.latency=n.latency*(1+.02*(k-1))}n.customMetrics={...n.customMetrics,collections:v.length,collections_with_validation:x,total_documents:v.reduce((k,A)=>k+(A.documentCount||0),0),replica_set_enabled:S,replica_members:S?R.length:0,sharding_enabled:M,shard_count:M&&T?.shards?.length||0}}}simulateNginx(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.nginxRoutingEngines.get(t.id);if(!i){const M=e.workerThreads||e.maxWorkers||4,T=e.requestsPerSecond||1e4,k=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=T*k,n.latency=1+(1-k)*4,n.errorRate=1e-5,n.utilization=Math.min(1,n.throughput/T*(M/4)),n.customMetrics={worker_threads:M,active_connections:Math.floor(n.throughput*.1)};return}const o=e||{},c=o.maxWorkers||4,u=o.requestsPerSecond||1e4;o.enableCache;const h=o.enableGzip??!0,f=i.getStats(),m=.5*Math.sin(this.simulationTime/2e3)+.5;let y=u*m;if(f.rateLimitBlocks>0){const M=Math.min(.1,f.rateLimitBlocks/Math.max(1,f.requests));y=y*(1-M)}n.throughput=y;const v=1+(1-m)*4,x=10+Math.random()*90;n.latency=v+x*.3;const S=f.rateLimitBlocks>0?Math.min(.05,f.rateLimitBlocks/Math.max(1,f.requests)):0;n.errorRate=1e-5+S;const R=Math.min(1,n.throughput/u*(c/4));n.utilization=R,n.customMetrics={worker_threads:c,active_connections:Math.floor(n.throughput*.1),cache_hits:f.cacheHits,cache_misses:f.cacheMisses,cache_hit_rate:Math.round(f.cacheHitRate*100)/100,rate_limit_blocks:f.rateLimitBlocks,locations:f.locations,upstreams:f.upstreams,ssl_enabled:o.enableSSL?1:0,gzip_enabled:h?1:0}}simulateHAProxy(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.haproxyRoutingEngines.get(t.id);if(!i){const R=e.maxConnections||4096,M=e.requestsPerSecond||1e4,T=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=M*T,n.latency=1+(1-T)*4,n.errorRate=1e-5,n.utilization=Math.min(1,n.throughput/M*(R/4096)),n.customMetrics={max_connections:R,active_connections:Math.floor(n.throughput*.1)};return}const o=e||{},c=o.maxConnections||4096,u=o.requestsPerSecond||1e4,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=u*f;const y=h.totalServers>0?h.upServers/h.totalServers:1;m=m*y,n.throughput=m;const v=1+(1-f)*4,x=10+Math.random()*90;n.latency=v+x*.3,n.errorRate=h.errorRate||1e-5;const S=Math.min(1,h.activeConnections/c);n.utilization=S,n.customMetrics={max_connections:c,active_connections:h.activeConnections,frontends:h.frontends,backends:h.backends,total_servers:h.totalServers,up_servers:h.upServers,down_servers:h.downServers,total_requests:h.totalRequests,total_responses:h.totalResponses,total_bytes_in:h.totalBytesIn,total_bytes_out:h.totalBytesOut}}simulateEnvoy(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.envoyRoutingEngines.get(t.id);if(!i){const R=e.maxConnections||1024,M=e.requestsPerSecond||1e4,T=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=M*T,n.latency=1+(1-T)*4,n.errorRate=1e-5,n.utilization=Math.min(1,n.throughput/M*(R/1024)),n.customMetrics={max_connections:R,active_connections:Math.floor(n.throughput*.1)};return}const o=e||{},c=o.maxConnections||1024,u=o.requestsPerSecond||1e4,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=u*f;const y=h.totalEndpoints>0?h.healthyEndpoints/h.totalEndpoints:1;m=m*y,n.throughput=m;const v=1+(1-f)*4,x=10+Math.random()*90;n.latency=v+x*.2,n.errorRate=h.errorRate||1e-5;const S=Math.min(1,h.activeConnections/c);n.utilization=S,n.customMetrics={max_connections:c,active_connections:h.activeConnections,clusters:h.clusters,listeners:h.listeners,routes:h.routes,total_endpoints:h.totalEndpoints,healthy_endpoints:h.healthyEndpoints,unhealthy_endpoints:h.unhealthyEndpoints,total_requests:h.totalRequests,total_responses:h.totalResponses,total_bytes_in:h.totalBytesIn,total_bytes_out:h.totalBytesOut,rate_limit_blocks:h.rateLimitBlocks||0,timeout_errors:h.timeoutErrors||0,circuit_breaker_trips:h.circuitBreakerTrips||0}}simulateServiceMesh(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.serviceMeshRoutingEngines.get(t.id);if(!i){const T=e.maxConnections||1e4,k=e.requestsPerSecond||5e3,A=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=k*A,n.latency=5+(1-A)*10,n.errorRate=1e-4,n.utilization=Math.min(1,n.throughput/k*(T/1e4)),n.customMetrics={max_connections:T,active_connections:Math.floor(n.throughput*.1),services:e.services?.length||0};return}const o=e||{},c=o.maxConnections||1e4,u=o.requestsPerSecond||5e3,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=u*f;const y=h.services,v=y>0?Math.min(1,y/Math.max(1,o.services?.length||y)):1;m=m*v,n.throughput=m;const x=5+(1-f)*10,S=10+Math.random()*90,R=o.enableMTLS?2:0;n.latency=x+S*.15+R,n.errorRate=h.errorRate||1e-4;const M=Math.min(1,h.activeConnections/c);n.utilization=M,n.customMetrics={max_connections:c,active_connections:h.activeConnections,services:h.services,virtual_services:h.virtualServices,destination_rules:h.destinationRules,gateways:h.gateways,total_requests:h.totalRequests,total_responses:h.totalResponses,total_errors:h.totalErrors,total_bytes_in:h.totalBytesIn,total_bytes_out:h.totalBytesOut,mtls_connections:h.mtlsConnections,circuit_breaker_trips:h.circuitBreakerTrips,retry_attempts:h.retryAttempts,timeout_errors:h.timeoutErrors,rate_limit_blocks:h.rateLimitBlocks,average_latency:Math.round(h.averageLatency)}}simulateIstio(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.istioRoutingEngines.get(t.id);if(!i){const T=e.maxConnections||1e4,k=e.requestsPerSecond||5e3,A=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=k*A,n.latency=5+(1-A)*10,n.errorRate=1e-4,n.utilization=Math.min(1,n.throughput/k*(T/1e4)),n.customMetrics={max_connections:T,active_connections:Math.floor(n.throughput*.1),services:e.services?.length||0};return}const o=e||{},c=o.maxConnections||1e4,u=o.requestsPerSecond||5e3,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=u*f;const y=h.services,v=y>0?Math.min(1,y/Math.max(1,o.services?.length||y)):1;m=m*v,n.throughput=m;const x=5+(1-f)*10,S=10+Math.random()*90,R=o.enableMTLS?2:0;n.latency=x+S*.15+R,n.errorRate=h.errorRate||1e-4;const M=Math.min(1,h.activeConnections/c);n.utilization=M,n.customMetrics={max_connections:c,active_connections:h.activeConnections,services:h.services,virtual_services:h.virtualServices,destination_rules:h.destinationRules,gateways:h.gateways,total_requests:h.totalRequests,total_responses:h.totalResponses,total_errors:h.totalErrors,total_bytes_in:h.totalBytesIn,total_bytes_out:h.totalBytesOut,mtls_connections:h.mtlsConnections,circuit_breaker_trips:h.circuitBreakerTrips,retry_attempts:h.retryAttempts,timeout_errors:h.timeoutErrors,rate_limit_blocks:h.rateLimitBlocks,average_latency:Math.round(h.averageLatency)}}simulateInfrastructure(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=e.workerThreads||1;n.throughput=100*i+Math.random()*50,n.latency=50+Math.random()*100,n.errorRate=1e-4,n.utilization=Math.random()*.8,n.customMetrics={replicas:i,cpu_percent:Math.random()*80,memory_percent:Math.random()*70}}simulateAPI(t,e,n,s){if(!s){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,t.type==="rest"){const u=this.restApiRoutingEngines.get(t.id);u&&u.getStats()}return}if(t.type==="rest"){const u=this.restApiRoutingEngines.get(t.id);if(u){const h=u.getStats(),f=u.getAllEndpointStats(),m=h.totalRequests,y=h.totalErrors,v=h.averageLatency,x=e.requestsPerSecond||100,S=Math.sin(this.simulationTime/1500)*.1+1;n.throughput=x*S,n.latency=v>0?v:(e.responseLatency||50)+Math.random()*30,m>0?n.errorRate=y/m:n.errorRate=.005,n.utilization=Math.min(1,n.throughput/x);const R=h.enabledEndpoints,M={};for(const[T,k]of Object.entries(f))k&&(M[`endpoint_${T}_requests`]=k.requestCount,M[`endpoint_${T}_errors`]=k.errorCount,M[`endpoint_${T}_latency`]=k.averageLatency);n.customMetrics={rps:n.throughput,total_requests:m,total_errors:y,p50_latency:Math.round(n.latency*.5),p99_latency:Math.round(n.latency*2),errors:Math.round(n.throughput*n.errorRate),endpoints:h.totalEndpoints,enabled_endpoints:R,...M};return}}const i=e.requestsPerSecond||100,o=e.responseLatency||50,c=Math.sin(this.simulationTime/1500)*.1+1;n.throughput=i*c,n.latency=o+Math.random()*30,n.errorRate=.005,n.utilization=n.throughput/i*Math.random(),n.customMetrics={rps:i,p50_latency:Math.round(o*.5),p99_latency:Math.round(o*2),errors:Math.round(n.throughput*n.errorRate)}}simulateKong(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.kongRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,n,s);return}const o=e||{},c=o.requestsPerSecond||e.requestsPerSecond||450,u=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let f=c*h;const m=(o.plugins||[]).filter(M=>M.name==="rate-limiting"&&M.enabled);if(m.length>0){const M=Math.min(...m.map(T=>T.config?.minute||1e3));f=Math.min(f,M*h)}n.throughput=f;const y=2+Math.random()*3,v=u.plugins*.5,x=10+Math.random()*40;n.latency=y+v+x;const S=.001,R=u.consumers>0?.02:0;n.errorRate=Math.min(1,S+R),n.utilization=Math.min(1,n.throughput/c),n.customMetrics={services:u.services,routes:u.routes,upstreams:u.upstreams,consumers:u.consumers,plugins:u.plugins,requests_per_second:c,gateway_latency:y+v,upstream_latency:x}}simulateAPIGateway(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;const h=this.cloudAPIGatewayEngines.get(t.id);h&&h.resetMetrics();return}const i=this.cloudAPIGatewayEngines.get(t.id);if(!i){this.simulateAPI(t,e,n,s);return}const o=t.data.config||{},c=o.apis||[],u=i.calculateMetrics();n.throughput=u.throughput,n.latency=u.latency,n.latencyP50=u.latencyP50,n.latencyP99=u.latencyP99,n.errorRate=u.errorRate,n.utilization=u.utilization,n.customMetrics={...u.customMetrics,apis_count:c.length,keys_count:o.keys?.length||0,provider:o.provider==="aws"?1:o.provider==="azure"?2:3,auth_enabled:o.enableAuthentication?1:0,rate_limiting_enabled:o.enableRateLimiting?1:0,caching_enabled:o.enableCaching?1:0}}simulateApigee(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.apigeeRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,n,s);return}const o=e||{},c=o.proxies||[],u=o.requestsPerSecond||e.requestsPerSecond||500,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=u*f;const y=c.filter(k=>k.status!=="undeployed");if(y.length>0){const k=y.filter(_=>_.quota&&_.quotaInterval).map(_=>_.quota/_.quotaInterval*f);if(k.length>0){const _=Math.min(...k);m=Math.min(m,_)}const A=y.filter(_=>_.spikeArrest&&_.spikeArrest>0).map(_=>_.spikeArrest);if(A.length>0){const _=Math.min(...A);m=Math.min(m,_*f)}}n.throughput=m;const v=3+Math.random()*2,x=h.policies*.8,S=15+Math.random()*35;n.latency=v+x+S;const R=.001,M=h.policies>0?.015:0,T=h.totalErrors>0?h.totalErrors/Math.max(h.totalRequests,1)*.1:0;n.errorRate=Math.min(1,R+M+T),n.utilization=Math.min(1,n.throughput/u),n.customMetrics={proxies:h.proxies,policies:h.policies,total_requests:h.totalRequests,total_errors:h.totalErrors,avg_latency:Math.round(h.avgLatency),requests_per_second:u,gateway_latency:v+x,upstream_latency:S}}simulateMuleSoft(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.mulesoftRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,n,s);return}const c=(e||{}).applications||[],u=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let f=0,m=0;for(const _ of c)if(_.status==="running"){const P=_.workerCount||2;m+=P,f+=P*75}f===0&&(f=100);let y=f*h;n.throughput=y;const v=5+Math.random()*10,x=u.enabledConnectors*2,S=3+Math.random()*5,R=15+Math.random()*25;n.latency=v+x+S+R;const M=.002,T=u.totalErrors>0?u.totalErrors/Math.max(u.totalRequests,1)*.15:0,k=u.runningApplications>0?.005:.01;n.errorRate=Math.min(1,M+T+k);const A=m>0?Math.min(1,n.throughput/(m*75)):.5;n.utilization=Math.min(1,A),n.customMetrics={applications:u.applications,running_applications:u.runningApplications,connectors:u.connectors,enabled_connectors:u.enabledConnectors,total_requests:u.totalRequests,total_errors:u.totalErrors,avg_latency:Math.round(u.avgLatency),total_workers:m,runtime_latency:v,connector_latency:R,transformation_latency:S}}simulateGrafana(t,e,n,s){const i=this.grafanaEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.getGrafanaMetrics(),c=i.calculateLoad();n.throughput=c.queriesPerSecond+c.alertEvaluationsPerSecond,n.latency=c.averageQueryLatency+c.averageRenderingLatency,n.errorRate=c.errorRate,n.utilization=(c.cpuUtilization+c.memoryUtilization)/2,n.customMetrics={queries_per_second:c.queriesPerSecond,dashboard_refreshes_per_second:c.dashboardRefreshesPerSecond,alert_evaluations_per_second:c.alertEvaluationsPerSecond,average_query_latency:c.averageQueryLatency,average_rendering_latency:c.averageRenderingLatency,datasource_errors:o.datasourceErrors,active_dashboards:o.activeDashboards,active_panels:o.activePanels,total_queries:o.totalQueries,cpu_utilization:c.cpuUtilization,memory_utilization:c.memoryUtilization}}simulateKeycloak(t,e,n,s){const i=this.keycloakEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics(),u=i.getConfig();n.throughput=o.requestsPerSecond,n.latency=o.averageLatency,n.errorRate=o.errorRate;const h=Math.min(.6,(o.activeSessions||0)/500),f=Math.min(.3,o.requestsPerSecond/200),m=u?.passwordPolicy?this.estimateKeycloakPolicyComplexity(u.passwordPolicy):0,y=Math.min(.2,m/100);n.utilization=Math.min(.95,.1+h+f+y),n.customMetrics={...n.customMetrics||{},keycloak_login_requests_total:c.loginRequestsTotal,keycloak_login_errors_total:c.loginErrorsTotal,keycloak_token_refresh_total:c.tokenRefreshTotal,keycloak_introspection_requests_total:c.introspectionRequestsTotal,keycloak_userinfo_requests_total:c.userInfoRequestsTotal,keycloak_sessions_active:c.activeSessions,keycloak_sessions_created_total:c.sessionsCreatedTotal,keycloak_sessions_expired_total:c.sessionsExpiredTotal,keycloak_auth_success_rate:o.authSuccessRate,keycloak_clients_configured:u?.clients.length??0,keycloak_users_configured:u?.users.length??0}}simulateVault(t,e,n,s){const i=this.vaultEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();i.getConfig(),n.throughput=o.requestsPerSecond,n.latency=o.averageLatency,n.errorRate=o.errorRate;const u=Math.min(.4,(o.secretsCount||0)/1e3),h=Math.min(.3,(o.activeTokens||0)/500),f=Math.min(.2,o.requestsPerSecond/300),m=Math.min(.1,(o.enginesEnabled||0)/10);n.utilization=Math.min(.95,.1+u+h+f+m),n.customMetrics={...n.customMetrics||{},vault_read_requests_total:c.readRequestsTotal,vault_write_requests_total:c.writeRequestsTotal,vault_delete_requests_total:c.deleteRequestsTotal,vault_list_requests_total:c.listRequestsTotal,vault_auth_requests_total:c.authRequestsTotal,vault_auth_errors_total:c.authErrorsTotal,vault_token_issued_total:c.tokenIssuedTotal,vault_token_renewed_total:c.tokenRenewedTotal,vault_token_revoked_total:c.tokenRevokedTotal,vault_tokens_active:c.activeTokens,vault_secrets_total:c.secretsTotal,vault_encryption_operations_total:c.encryptionOperationsTotal,vault_decryption_operations_total:c.decryptionOperationsTotal,vault_engines_enabled:o.enginesEnabled}}estimateKeycloakPolicyComplexity(t){if(!t)return 0;let e=0;const n=t.toLowerCase();n.includes("length(")&&(e+=20),n.includes("digits(")&&(e+=25),n.includes("special(")&&(e+=30),n.includes("uppercase(")&&(e+=15),n.includes("lowercase(")&&(e+=10);const s=(t.match(/\)/g)||[]).length;return e+=s*5,e}simulatePrometheus(t,e,n,s){const i=this.prometheusEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.getPrometheusMetrics(),c=i.calculateLoad();n.throughput=c.scrapeRequestsPerSecond,n.latency=c.averageScrapeDuration,n.errorRate=c.errorRate;const u=i.getTargetStatuses().length,h=Math.min(.95,.1+u/100*.5+c.scrapeRequestsPerSecond/10*.2);n.utilization=h,n.customMetrics={scrape_requests_total:o.scrapeRequestsTotal,scrape_errors_total:o.scrapeErrorsTotal,targets_up:o.targetsUp,targets_down:o.targetsDown,samples_scraped:o.samplesScraped,scrape_requests_per_second:c.scrapeRequestsPerSecond,samples_per_second:c.samplesPerSecond}}simulateWAF(t,e,n,s){const i=this.wafEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();i.getStats(),n.throughput=o.requestsPerSecond,n.latency=o.averageLatency;const u=i.getConfig();u?.mode==="prevention"?n.errorRate=o.blockRate:n.errorRate=0;const h=Math.min(.4,(c.activeRules||0)/50),f=Math.min(.3,o.requestsPerSecond/1e3),m=u?.enableOWASP?.15:0,y=u?.enableRateLimiting?.1:0,v=u?.enableGeoBlocking?.05:0;if(n.utilization=Math.min(.95,.1+h+f+m+y+v),n.customMetrics={...n.customMetrics||{},waf_requests_total:c.requestsTotal,waf_requests_allowed:c.requestsAllowed,waf_requests_blocked:c.requestsBlocked,waf_threats_detected:c.threatsDetected,waf_threats_blocked:c.threatsBlocked,waf_rate_limit_hits:c.rateLimitHits,waf_geo_block_hits:c.geoBlockHits,waf_ip_block_hits:c.ipBlockHits,waf_owasp_hits:c.owaspHits,waf_custom_rule_hits:c.customRuleHits,waf_active_rules:c.activeRules,waf_block_rate:o.blockRate,waf_threat_detection_rate:o.threatDetectionRate,waf_average_latency:o.averageLatency},s){const x=this.connections.filter(R=>R.target===t.id);let S=0;for(const R of x){const M=this.metrics.get(R.source);M&&(S+=M.throughput||0)}S>0&&(i.setSimulatedRequestRate(S),i.simulateRequests(S))}}simulateFirewall(t,e,n,s){const i=this.firewallEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();i.getStats(),n.throughput=o.packetsPerSecond,n.latency=o.averageLatency,n.errorRate=o.blockRate+o.rejectionRate;const u=Math.min(.3,(c.activeRules||0)/100),h=Math.min(.3,o.packetsPerSecond/1e4),f=i.getConfig()?.enableStatefulInspection?.2:0,m=i.getConfig()?.enableIntrusionDetection?.2:0;if(n.utilization=Math.min(.95,.1+u+h+f+m),n.customMetrics={...n.customMetrics||{},firewall_packets_total:c.packetsTotal,firewall_packets_allowed:c.packetsAllowed,firewall_packets_blocked:c.packetsBlocked,firewall_packets_rejected:c.packetsRejected,firewall_active_rules:c.activeRules,firewall_total_connections:c.totalConnections,firewall_active_connections:c.activeConnections,firewall_block_rate:o.blockRate,firewall_rejection_rate:o.rejectionRate,firewall_average_latency:o.averageLatency},s){const y=this.connections.filter(x=>x.target===t.id);let v=0;for(const x of y){const S=this.metrics.get(x.source);S&&(v+=S.throughput||0)}v>0&&(i.setSimulatedPacketRate(v),i.simulatePackets(v))}i.cleanup()}simulateVPN(t,e,n,s){const i=this.vpnEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();i.getConfig(),n.throughput=o.packetsPerSecond,n.latency=o.averageLatency,n.errorRate=o.errorRate;const u=Math.min(.3,o.utilization*.5),h=Math.min(.2,(c.activeTunnels||0)/10),f=Math.min(.3,o.bytesPerSecond/(100*1024*1024)),m=Math.min(.2,(c.encryptionOperations||0)/1e4);if(n.utilization=Math.min(.95,.1+u+h+f+m),n.customMetrics={...n.customMetrics||{},vpn_total_connections:c.totalConnections,vpn_active_connections:c.activeConnections,vpn_total_tunnels:c.totalTunnels,vpn_active_tunnels:c.activeTunnels,vpn_bytes_in:c.totalBytesIn,vpn_bytes_out:c.totalBytesOut,vpn_packets_in:c.totalPacketsIn,vpn_packets_out:c.totalPacketsOut,vpn_encryption_operations:c.encryptionOperations,vpn_compression_operations:c.compressionOperations,vpn_failed_connections:c.failedConnections,vpn_average_latency:o.averageLatency,vpn_connections_per_second:o.connectionsPerSecond,vpn_bytes_per_second:o.bytesPerSecond},s){const y=this.connections.filter(S=>S.target===t.id);let v=0,x=0;for(const S of y){const R=this.metrics.get(S.source);R&&(v+=R.throughput||0,x+=(R.throughput||0)*1500)}v>0&&i.simulateIncomingTraffic(v,o.connectionsPerSecond)}i.cleanupStaleConnections()}simulateCDN(t,e,n,s){const i=this.cdnEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();i.getConfig(),n.throughput=o.requestsPerSecond,n.latency=o.averageLatency,n.errorRate=o.errorRate;const u=Math.min(.2,c.activeDistributions/Math.max(1,c.totalDistributions)),h=Math.min(.2,c.activeEdgeLocations/Math.max(1,c.totalEdgeLocations)),f=Math.min(.5,o.utilization*.5),m=o.cacheHitRate>.8?.1:0;if(n.utilization=Math.min(.95,.1+u+h+f-m),n.customMetrics={...n.customMetrics||{},cdn_total_distributions:c.totalDistributions,cdn_active_distributions:c.activeDistributions,cdn_total_edge_locations:c.totalEdgeLocations,cdn_active_edge_locations:c.activeEdgeLocations,cdn_total_requests:c.totalRequests,cdn_total_cache_hits:c.totalCacheHits,cdn_total_cache_misses:c.totalCacheMisses,cdn_total_bandwidth:c.totalBandwidth,cdn_average_cache_hit_rate:c.averageCacheHitRate,cdn_average_latency:o.averageLatency,cdn_requests_per_second:o.requestsPerSecond,cdn_bandwidth_per_second:o.bandwidthPerSecond,cdn_error_rate:o.errorRate,cdn_cache_hit_rate:o.cacheHitRate},s){const y=this.connections.filter(x=>x.target===t.id);let v=0;for(const x of y){const S=this.metrics.get(x.source);S&&(v+=S.throughput||0)}v>0&&i.simulateIncomingTraffic(v)}}simulateArgoCD(t,e,n,s){const i=this.argoCDEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const o=i.getMetrics();n.throughput=o.syncRate/3600,n.latency=o.averageSyncDuration||0;const c=o.syncOperationsSuccess+o.syncOperationsFailed;n.errorRate=c>0?o.syncOperationsFailed/c:0,n.utilization=o.applicationsTotal>0?o.syncOperationsRunning/o.applicationsTotal:0,n.customMetrics={applicationsTotal:o.applicationsTotal,applicationsSynced:o.applicationsSynced,applicationsOutOfSync:o.applicationsOutOfSync,syncOperationsRunning:o.syncOperationsRunning,repositoriesConnected:o.repositoriesConnected}}simulateTerraform(t,e,n,s){const i=this.terraformEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const o=i.getMetrics();n.throughput=o.runsPerHour/3600,n.latency=o.averageRunDuration||0;const c=o.runsSuccess+o.runsFailed;n.errorRate=c>0?o.runsFailed/c:0,n.utilization=o.workspacesTotal>0?Math.min(1,o.runsRunning/o.workspacesTotal):0,n.customMetrics={workspacesTotal:o.workspacesTotal,runsTotal:o.runsTotal,runsRunning:o.runsRunning,runsPending:o.runsPending,runsSuccess:o.runsSuccess,runsFailed:o.runsFailed,statesTotal:o.statesTotal,resourcesManaged:o.resourcesManaged,runsPerHour:o.runsPerHour,averageRunDuration:o.averageRunDuration}}simulateTraefik(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.traefikEngines.get(t.id);if(!i){const u=e.maxConnections||1e4,h=e.requestsPerSecond||1e4,f=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=h*f,n.latency=1+(1-f)*4,n.errorRate=1e-5,n.utilization=Math.min(1,n.throughput/h*(u/1e4)),n.customMetrics={max_connections:u,active_connections:Math.floor(n.throughput*.1)};return}const o=i.getStats(),c=i.getLoad();if(s&&o.totalRequests===0){const h=(e||{}).requestsPerSecond||100;i.simulateRequests(h)}n.throughput=c.requestsPerSecond,n.latency=c.averageLatency,n.errorRate=c.errorRate,n.utilization=c.utilization,n.customMetrics={routers:o.routers,active_routers:o.activeRouters,services:o.services,middlewares:o.middlewares,entry_points:o.entryPoints,total_servers:o.totalServers,healthy_servers:o.healthyServers,total_requests:o.totalRequests,total_responses:o.totalResponses,active_connections:o.activeConnections,total_bytes_in:o.totalBytesIn,total_bytes_out:o.totalBytesOut,error_rate:o.errorRate,average_latency:o.averageLatency}}simulateAnsible(t,e,n,s){const i=this.ansibleEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const o=i.getMetrics();n.throughput=o.jobsPerHour/3600,n.latency=o.averageJobDuration*1e3;const c=o.jobsSuccess+o.jobsFailed;n.errorRate=c>0?o.jobsFailed/c:0;const u=o.jobTemplatesEnabled||o.jobTemplatesTotal||1;n.utilization=Math.min(1,o.jobsRunning/u),n.customMetrics={inventoriesTotal:o.inventoriesTotal,projectsTotal:o.projectsTotal,credentialsTotal:o.credentialsTotal,jobTemplatesTotal:o.jobTemplatesTotal,jobTemplatesEnabled:o.jobTemplatesEnabled,jobsTotal:o.jobsTotal,jobsSuccess:o.jobsSuccess,jobsFailed:o.jobsFailed,jobsRunning:o.jobsRunning,jobsPending:o.jobsPending,jobsPerHour:o.jobsPerHour,averageJobDuration:o.averageJobDuration,hostsTotal:o.hostsTotal,hostsOk:o.hostsOk,hostsChanged:o.hostsChanged,hostsFailed:o.hostsFailed,hostsUnreachable:o.hostsUnreachable,schedulesTotal:o.schedulesTotal,schedulesEnabled:o.schedulesEnabled,requestsTotal:o.requestsTotal,requestsErrors:o.requestsErrors}}simulateHarbor(t,e,n,s){const i=this.harborEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();n.throughput=o.throughput,n.latency=o.averageLatency,n.errorRate=o.errorRate,n.utilization=(o.cpuUtilization+o.memoryUtilization+o.storageUtilization+o.networkUtilization)/4,n.customMetrics={...n.customMetrics||{},harbor_push_ops_per_sec:c.pushOperationsPerSecond,harbor_pull_ops_per_sec:c.pullOperationsPerSecond,harbor_scan_ops_per_sec:c.scanOperationsPerSecond,harbor_replication_ops_per_sec:c.replicationOperationsPerSecond,harbor_avg_push_latency:c.averagePushLatency,harbor_avg_pull_latency:c.averagePullLatency,harbor_avg_scan_latency:c.averageScanLatency,harbor_storage_used:c.storageUsed,harbor_storage_total:c.storageTotal,harbor_projects_total:c.totalProjects,harbor_repositories_total:c.totalRepositories,harbor_tags_total:c.totalTags,harbor_vulnerabilities_total:c.totalVulnerabilities,harbor_scans_completed:c.scansCompleted,harbor_scans_running:c.scansRunning,harbor_scans_failed:c.scansFailed,harbor_replication_policies_enabled:c.replicationPoliciesEnabled,harbor_active_replications:c.activeReplications,harbor_gc_operations_total:c.gcOperationsTotal,harbor_gc_storage_freed:c.gcStorageFreed,harbor_cpu_utilization:o.cpuUtilization,harbor_memory_utilization:o.memoryUtilization,harbor_storage_utilization:o.storageUtilization,harbor_network_utilization:o.networkUtilization}}simulateDocker(t,e,n,s){const i=this.dockerEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();n.throughput=o.throughput,n.latency=o.averageLatency,n.errorRate=o.errorRate,n.utilization=(o.cpuUtilization+o.memoryUtilization+o.networkUtilization+o.diskUtilization)/4,n.customMetrics={...n.customMetrics||{},docker_containers_total:c.containersTotal,docker_containers_running:c.containersRunning,docker_containers_stopped:c.containersStopped,docker_containers_paused:c.containersPaused,docker_images_total:c.imagesTotal,docker_images_size:c.imagesSize,docker_networks_total:c.networksTotal,docker_volumes_total:c.volumesTotal,docker_volumes_size:c.volumesSize,docker_ops_per_sec:c.operationsPerSecond,docker_avg_operation_latency:c.averageOperationLatency,docker_total_cpu_usage:c.totalCpuUsage,docker_total_memory_usage:c.totalMemoryUsage,docker_total_memory_limit:c.totalMemoryLimit,docker_total_network_rx:c.totalNetworkRx,docker_total_network_tx:c.totalNetworkTx,docker_build_ops_per_sec:c.buildOperationsPerSecond,docker_pull_ops_per_sec:c.pullOperationsPerSecond,docker_push_ops_per_sec:c.pushOperationsPerSecond,docker_cpu_utilization:o.cpuUtilization,docker_memory_utilization:o.memoryUtilization,docker_network_utilization:o.networkUtilization,docker_disk_utilization:o.diskUtilization}}simulateKubernetes(t,e,n,s){const i=this.kubernetesEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.getLoad(),c=i.getMetrics();n.throughput=o.throughput,n.latency=o.averageLatency,n.errorRate=o.errorRate,n.utilization=(o.cpuUtilization+o.memoryUtilization+o.podUtilization+o.networkUtilization+o.diskUtilization)/5,n.customMetrics={...n.customMetrics||{},k8s_pods_total:c.podsTotal,k8s_pods_running:c.podsRunning,k8s_pods_pending:c.podsPending,k8s_pods_failed:c.podsFailed,k8s_pods_succeeded:c.podsSucceeded,k8s_deployments_total:c.deploymentsTotal,k8s_deployments_ready:c.deploymentsReady,k8s_deployments_not_ready:c.deploymentsNotReady,k8s_services_total:c.servicesTotal,k8s_services_clusterip:c.servicesClusterIP,k8s_services_nodeport:c.servicesNodePort,k8s_services_loadbalancer:c.servicesLoadBalancer,k8s_nodes_total:c.nodesTotal,k8s_nodes_ready:c.nodesReady,k8s_nodes_not_ready:c.nodesNotReady,k8s_namespaces_total:c.namespacesTotal,k8s_configmaps_total:c.configMapsTotal,k8s_secrets_total:c.secretsTotal,k8s_total_cpu_usage:c.totalCpuUsage,k8s_total_memory_usage:c.totalMemoryUsage,k8s_total_memory_capacity:c.totalMemoryCapacity,k8s_cpu_utilization:o.cpuUtilization,k8s_memory_utilization:o.memoryUtilization,k8s_pod_utilization:o.podUtilization,k8s_network_utilization:o.networkUtilization,k8s_disk_utilization:o.diskUtilization}}simulateIDSIPS(t,e,n,s){const i=this.idsIpsEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();i.getStats(),n.throughput=o.packetsPerSecond,n.latency=o.averageLatency;const u=i.getConfig();u?.mode==="ips"?n.errorRate=o.blockRate:n.errorRate=0;const h=Math.min(.3,(c.activeSignatures||0)/100),f=Math.min(.3,o.packetsPerSecond/1e4),m=u?.enableSignatureDetection?.15:0,y=u?.enableAnomalyDetection?.15:0,v=u?.enableBehavioralAnalysis?.1:0;if(n.utilization=Math.min(.95,.1+h+f+m+y+v),n.customMetrics={...n.customMetrics||{},idsips_packets_total:c.packetsTotal,idsips_packets_analyzed:c.packetsAnalyzed,idsips_alerts_generated:c.alertsGenerated,idsips_alerts_blocked:c.alertsBlocked,idsips_signature_matches:c.signatureMatches,idsips_anomaly_detections:c.anomalyDetections,idsips_behavioral_detections:c.behavioralDetections,idsips_active_signatures:c.activeSignatures,idsips_blocked_ips:c.blockedIPs,idsips_alert_rate:o.alertRate,idsips_block_rate:o.blockRate},this.updateLatencyPercentiles(t.id,n.latency,n),!s){const x=this.connections.filter(R=>R.target===t.id);let S=0;for(const R of x){const M=this.metrics.get(R.source);M&&(S+=M.throughput||0)}S>0&&(i.setSimulatedPacketRate(S),i.simulatePackets(S))}}simulatePagerDuty(t,e,n,s){const i=this.pagerDutyEngines.get(t.id);if(!i){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const o=i.calculateLoad(),c=i.getMetrics();n.throughput=o.throughput,n.latency=o.latency,n.errorRate=o.errorRate,n.utilization=o.utilization,n.customMetrics={incidents_total:c.incidentsTotal,incidents_active:c.incidentsActive,incidents_resolved:c.incidentsResolved,notifications_sent:c.notificationsSent,escalations_triggered:c.escalationsTriggered,acknowledgements:c.acknowledgements,average_ack_latency_ms:c.averageAckLatency,average_resolve_latency_ms:c.averageResolveLatency,api_requests_per_second:c.apiRequestsPerSecond,webhooks_per_second:c.webhooksPerSecond,cpu_utilization:c.cpuUtilization,memory_utilization:c.memoryUtilization}}simulateLoki(t,e,n,s){if(!this.lokiEngines.has(t.id)){const m=new lT;m.initializeConfig(t),this.lokiEngines.set(t.id,m)}const i=this.lokiEngines.get(t.id);s&&this.processLokiIngestion(t,i);const o=i.getLokiMetrics(),c=i.calculateLoad();n.throughput=c.ingestionLinesPerSecond+c.queriesPerSecond;const u=c.ingestionLinesPerSecond/(c.ingestionLinesPerSecond+c.queriesPerSecond||1),h=1-u;n.latency=c.averageIngestionLatency*u+c.averageQueryLatency*h,n.errorRate=c.ingestionErrorRate*u+c.queryErrorRate*h;const f=Math.min(1,c.streamCount/(e.maxStreams||1e4));n.utilization=Math.max(c.storageUtilization,f),n.customMetrics={ingestion_lines_per_second:c.ingestionLinesPerSecond,ingestion_bytes_per_second:c.ingestionBytesPerSecond,ingestion_requests_total:o.ingestionRequestsTotal,ingestion_errors_total:o.ingestionErrorsTotal,ingestion_lines_total:o.ingestionLinesTotal,ingestion_bytes_total:o.ingestionBytesTotal,queries_per_second:c.queriesPerSecond,query_requests_total:o.queryRequestsTotal,query_errors_total:o.queryErrorsTotal,average_query_latency:c.averageQueryLatency,average_ingestion_latency:c.averageIngestionLatency,active_streams:c.streamCount,total_storage_size:o.totalStorageSize,storage_utilization:c.storageUtilization,retention_deletions:o.retentionDeletions}}processLokiIngestion(t,e){const n=this.connections.filter(s=>s.target===t.id);for(const s of n){const i=this.nodes.find(f=>f.id===s.source);if(!i)continue;const o=this.connectionMetrics.get(s.id);if(!o||o.traffic===0)continue;const u=o.traffic/200,h=this.generateLogsFromComponent(i,u);h.length>0&&e.processIngestion(h,i.id)}}generateLogsFromComponent(t,e){const n=[],s=t.type,i=t.data.label||t.id,o={app:i.toLowerCase().replace(/\s+/g,"-"),component:s,source:t.id.slice(0,8)},c=this.metrics.get(t.id),u=Math.ceil(e/100),h=Math.floor(e/u)||1;for(let f=0;f<u&&f<10;f++){const m=[];for(let y=0;y<h;y++){const v=Date.now()*1e6+y,x=this.getLogLevel(c),S=this.generateLogMessage(s,i,x,c);m.push([v.toString(),S])}m.length>0&&n.push({stream:{...o,level:this.getLogLevel(c)},values:m})}return n}getLogLevel(t){return t?t.errorRate>.1?"error":t.errorRate>.05||t.utilization>.9?"warn":"info":"info"}generateLogMessage(t,e,n,s){const i=new Date().toISOString();return n==="error"&&s?`[${i}] ERROR ${t}: Request failed, error rate: ${(s.errorRate*100).toFixed(2)}%`:n==="warn"&&s?`[${i}] WARN ${t}: High utilization: ${(s.utilization*100).toFixed(2)}%`:`[${i}] INFO ${t}: ${e} processing requests, throughput: ${s?.throughput.toFixed(2)||0}/s`}simulateBFF(t,e,n,s){if(!s){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const i=this.bffRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,n,s);return}const o=e||{},c=o.endpoints||[],u=o.backends||[],h=this.connections.filter(Z=>Z.target===t.id);let f=0;for(const Z of h){const se=this.connectionMetrics.get(Z.id);if(se){const J=se.traffic/2048;f+=J}}const m=e.requestsPerSecond||f||100,y=i.getStats(),v=.3*Math.sin(this.simulationTime/2e3)+.7;n.throughput=m*v;let x=y.averageLatency||100;const S=5+Math.random()*10,R=y.cacheHitRate||0,M=R*.8,T=x*(1-M)+S;n.latency=T+Math.random()*20;const k=y.totalRequests>0?y.totalErrors/y.totalRequests:.005,A=.001;n.errorRate=Math.min(1,k+A);const _=o.maxConcurrentRequests||100,P=n.throughput*(n.latency/1e3);n.utilization=Math.min(1,P/_);const z=c.reduce((Z,se)=>Z+(se.requests||0),0),q=u.filter(Z=>Z.status==="connected").length;n.customMetrics={endpoints:c.length,backends:u.length,connected_backends:q,total_requests:y.totalRequests,total_errors:y.totalErrors,avg_latency:Math.round(y.averageLatency),cache_hit_rate:Math.round(R*100)/100,endpoint_requests:z,aggregation_overhead:Math.round(S),concurrent_requests:Math.round(P)}}initializeKongRoutingEngine(t){const e=t.data.config||{},n=new jk;n.initialize({services:e.services||[],routes:e.routes||[],upstreams:e.upstreams||[],consumers:e.consumers||[],plugins:e.plugins||[]}),this.kongRoutingEngines.set(t.id,n)}initializeCloudAPIGatewayEngine(t){const e=t.data.config||{};e.provider||(e.provider="aws");const n=new qT(e);this.cloudAPIGatewayEngines.set(t.id,n)}initializeNginxRoutingEngine(t){const e=t.data.config||{},n=new Ik;n.initialize({locations:e.locations||[],upstreams:e.upstreams||[],rateLimitZones:e.rateLimitZones||[],sslCertificates:e.sslCertificates||[],enableSSL:e.enableSSL,sslPort:e.sslPort,enableGzip:e.enableGzip,enableCache:e.enableCache,maxWorkers:e.maxWorkers}),this.nginxRoutingEngines.set(t.id,n)}initializeHAProxyRoutingEngine(t){const e=t.data.config||{},n=new Ok,s=(e.frontends||[]).map(o=>({id:o.id,name:o.name,bind:o.bind,mode:o.mode,defaultBackend:o.backends&&o.backends.length>0?o.backends[0]:void 0,backends:o.backends,ssl:o.ssl,requests:o.requests||0,responses:o.responses||0,bytesIn:o.bytesIn||0,bytesOut:o.bytesOut||0})),i=(e.backends||[]).map(o=>({id:o.id,name:o.name,mode:o.mode,balance:o.balance,servers:o.servers||[],healthCheck:o.healthCheck,stickTable:o.stickTable}));n.initialize({frontends:s,backends:i}),this.haproxyRoutingEngines.set(t.id,n)}initializeEnvoyRoutingEngine(t){const e=t.data.config||{},n=new Hk,s=(e.clusters||[]).map(c=>({name:c.name,type:c.type||"STRICT_DNS",endpoints:(c.hosts||[]).map(u=>({address:u.address,port:u.port,weight:u.weight||1,healthStatus:u.healthStatus||"unknown"})),connectTimeout:c.connectTimeout||5e3,healthCheck:c.healthChecks?{enabled:!0,interval:c.healthCheckInterval||1e4,timeout:c.healthCheckTimeout||5e3,path:c.healthCheckPath||"/health",healthyThreshold:c.healthCheckHealthyThreshold||1,unhealthyThreshold:c.healthCheckUnhealthyThreshold||2}:void 0,circuitBreaker:c.circuitBreaker?{enabled:!0,maxConnections:c.circuitBreakerMaxConnections,maxRequests:c.circuitBreakerMaxRequests,maxRetries:c.circuitBreakerMaxRetries,consecutiveErrors:c.circuitBreakerConsecutiveErrors||5}:void 0,loadBalancingPolicy:c.loadBalancingPolicy||"ROUND_ROBIN",outlierDetection:c.outlierDetection?{enabled:!0,consecutiveErrors:c.outlierDetectionConsecutiveErrors||5,interval:c.outlierDetectionInterval||1e4,baseEjectionTime:c.outlierDetectionBaseEjectionTime||3e4,maxEjectionPercent:c.outlierDetectionMaxEjectionPercent||50}:void 0})),i=(e.listeners||[]).map(c=>({name:c.name,address:c.address||"0.0.0.0",port:c.port,protocol:c.protocol||"HTTP",filters:(c.filters||[]).map(u=>typeof u=="string"?{name:u,type:u}:u)})),o=(e.routes||[]).map(c=>({name:c.name,match:{prefix:c.match?.startsWith("/")?c.match:void 0,path:c.match&&!c.match.includes("*")&&!c.match.startsWith("/")?c.match:void 0,regex:c.match?.includes("*")?c.match.replace(/\*/g,".*"):void 0},cluster:c.cluster,priority:c.priority||0,timeout:c.timeout,retryPolicy:c.retryPolicy}));n.initialize({clusters:s,listeners:i,routes:o,globalConfig:{maxConnections:e.maxConnections||1024,connectTimeout:e.connectTimeout||5e3,requestTimeout:e.requestTimeout||15e3,drainTime:e.drainTime||600,rateLimit:e.enableRateLimiting?{enabled:!0,rate:e.rateLimitPerSecond||100,burst:e.rateLimitBurst||10}:void 0,tracing:e.enableTracing?{enabled:!0,provider:e.tracingProvider||"jaeger"}:void 0}}),this.envoyRoutingEngines.set(t.id,n)}initializeServiceMeshRoutingEngine(t){const e=t.data.config||{},n=new OT;n.initialize({services:e.services||[],virtualServices:e.virtualServices||[],destinationRules:e.destinationRules||[],gateways:e.gateways||[],peerAuthentications:e.peerAuthentications||[],authorizationPolicies:e.authorizationPolicies||[],serviceEntries:e.serviceEntries||[],sidecars:e.sidecars||[],globalConfig:{enableMTLS:e.enableMTLS,mtlsMode:e.mtlsMode,enableTracing:e.enableTracing,tracingProvider:e.tracingProvider,enableMetrics:e.enableMetrics,metricsProvider:e.metricsProvider,enableAccessLog:e.enableAccessLog,maxConnections:e.maxConnections,defaultTimeout:e.defaultTimeout,defaultRetryAttempts:e.defaultRetryAttempts,defaultLoadBalancer:e.defaultLoadBalancer}}),this.serviceMeshRoutingEngines.set(t.id,n)}initializeIstioRoutingEngine(t){const e=t.data.config||{},n=new Cb,s=(e.services||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",host:y.host||`${y.name}.${y.namespace||"default"}.svc.cluster.local`,ports:y.ports||[{number:80,protocol:"HTTP"}],labels:y.labels||{},requests:y.requests||0,errors:y.errors||0,latency:y.latency||0,pods:y.pods||1,healthyPods:y.healthyPods||y.pods||1})),i=(e.virtualServices||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",hosts:y.hosts||[],gateways:y.gateways||[],http:y.http||[],tcp:y.tcp||[],tls:y.tls||[]})),o=(e.destinationRules||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",host:y.host,subsets:y.subsets||[],trafficPolicy:y.trafficPolicy||{}})),c=(e.gateways||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",selector:y.selector||{},servers:y.servers||[]})),u=(e.peerAuthentications||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",selector:y.selector||{},mtls:y.mtls||{mode:"PERMISSIVE"},portLevelMtls:y.portLevelMtls||{}})),h=(e.authorizationPolicies||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",selector:y.selector||{},action:y.action||"ALLOW",rules:y.rules||[]})),f=(e.serviceEntries||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",hosts:y.hosts||[],addresses:y.addresses||[],ports:y.ports||[],location:y.location||"MESH_EXTERNAL",resolution:y.resolution||"DNS",endpoints:y.endpoints||[]})),m=(e.sidecars||[]).map(y=>({id:y.id||y.name,name:y.name,namespace:y.namespace||"default",workloadSelector:y.workloadSelector||{},egress:y.egress||[],ingress:y.ingress||[]}));n.initialize({services:s,virtualServices:i,destinationRules:o,gateways:c,peerAuthentications:u,authorizationPolicies:h,serviceEntries:f,sidecars:m,globalConfig:{enableMTLS:e.enableMTLS??!0,mtlsMode:e.mtlsMode||"PERMISSIVE",enableTracing:e.enableTracing??!0,tracingProvider:e.tracingProvider||"jaeger",enableMetrics:e.enableMetrics??!0,metricsProvider:e.metricsProvider||"prometheus",enableAccessLog:e.enableAccessLog??!0,maxConnections:e.maxConnections||1e4,defaultTimeout:e.defaultTimeout||"30s",defaultRetryAttempts:e.defaultRetryAttempts||3}}),this.istioRoutingEngines.set(t.id,n)}initializeApigeeRoutingEngine(t){const e=t.data.config||{},n=new Lk;n.initialize({organization:e.organization,environment:e.environment,proxies:e.proxies||[],policies:e.policies||[]}),this.apigeeRoutingEngines.set(t.id,n)}initializeMuleSoftRoutingEngine(t){const e=t.data.config||{},n=new zk,s=(e.applications||[]).map(o=>({name:o.name,runtimeVersion:o.runtimeVersion||"4.6.0",workerCount:o.workerCount||2,status:o.status||"stopped",connectors:o.connectors||[],errorStrategy:o.errorStrategy||"continue",reconnectionStrategy:o.reconnectionStrategy||"exponential",auditLogging:o.auditLogging||!1,flows:o.flows||[]})),i=(e.connectors||[]).map(o=>({name:o.name,type:o.type||"api",enabled:o.enabled!==!1,config:o.config||{},targetComponentType:o.targetComponentType,targetComponentId:o.targetComponentId}));n.initialize({organization:e.organization,environment:e.environment,applications:s,connectors:i}),this.mulesoftRoutingEngines.set(t.id,n)}initializeGraphQLGatewayRoutingEngine(t){const e=t.data.config||{},n=new Yk;n.initialize({services:e.services||[],federation:e.federation,cacheTtl:e.cacheTtl,persistQueries:e.persistQueries,subscriptions:e.subscriptions,enableIntrospection:e.enableIntrospection,enableQueryComplexityAnalysis:e.enableQueryComplexityAnalysis,enableRateLimiting:e.enableRateLimiting,maxQueryDepth:e.maxQueryDepth,maxQueryComplexity:e.maxQueryComplexity,endpoint:e.endpoint}),this.graphQLGatewayRoutingEngines.set(t.id,n),this.lastGraphQLGatewayUpdate.set(t.id,Date.now())}initializeBFFRoutingEngine(t){const e=t.data.config||{},n=new Wk;let s=null,i="";if(e.cacheMode==="redis"){const o=this.connections.find(c=>(c.source===t.id||c.target===t.id)&&this.nodes.find(u=>u.id===(c.source===t.id?c.target:c.source))?.type==="redis");if(o){const c=this.nodes.find(u=>u.id===(o.source===t.id?o.target:o.source));c&&c.type==="redis"&&(this.redisRoutingEngines.has(c.id)||this.initializeRedisRoutingEngine(c),s=this.redisRoutingEngines.get(c.id),i=c.id)}}n.initialize({backends:e.backends||[],endpoints:e.endpoints||[],enableCaching:e.enableCaching??!0,enableRequestBatching:e.enableRequestBatching??!1,enableResponseCompression:e.enableResponseCompression??!0,defaultTimeout:e.defaultTimeout||5e3,maxConcurrentRequests:e.maxConcurrentRequests||100,cacheMode:e.cacheMode||"memory",cacheTtl:e.cacheTtl||5,fallbackEnabled:e.fallbackEnabled??!0,fallbackComponent:e.fallbackComponent,redisEngine:s||void 0,redisNodeId:i||void 0}),this.bffRoutingEngines.set(t.id,n)}initializeRestApiRoutingEngine(t){const e=t.data.config||{},n=new Xk;n.initialize({baseUrl:e.baseUrl||"https://api.example.com",version:e.version||"v1",title:e.title||"REST API",description:e.description||"RESTful API service",endpoints:(e.endpoints||[]).map(s=>({id:s.id||`${s.method}:${s.path}`,path:s.path,method:s.method,description:s.description,summary:s.summary,tags:s.tags,parameters:s.parameters,requestBody:s.requestBody,responseExample:s.responseExample,targetService:s.targetService,enabled:s.enabled!==!1,timeout:s.timeout,rateLimit:s.rateLimit})),authentication:e.authentication||{type:"none"},rateLimit:e.rateLimit,cors:e.cors}),this.restApiRoutingEngines.set(t.id,n)}initializeWebhookRelayRoutingEngine(t){const e=t.data.config||{},n=new Jk;n.initialize({relays:e.relays||[],enableRetryOnFailure:e.enableRetryOnFailure??!0,enableSignatureVerification:e.enableSignatureVerification??!0,enableRequestLogging:e.enableRequestLogging??!0,maxRetryAttempts:e.maxRetryAttempts||3,retryDelay:e.retryDelay||5,timeout:e.timeout||30}),this.webhookRelayRoutingEngines.set(t.id,n)}initializeRedisRoutingEngine(t){const e=t.data.config||{},n=new Zk;n.initialize({host:e.host||"localhost",port:e.port||6379,password:e.password||"",database:e.database||0,maxMemory:e.maxMemory||"256mb",maxMemoryPolicy:e.maxMemoryPolicy||"noeviction",enablePersistence:e.enablePersistence??!0,persistenceType:e.persistenceType||"rdb",enableCluster:e.enableCluster??!1,clusterNodes:e.clusterNodes||[],keys:e.keys||[]}),this.redisRoutingEngines.set(t.id,n)}initializeCassandraRoutingEngine(t){const e=t.data.config||{},n=new eT;n.initialize({clusterName:e.clusterName||"archiphoenix-cluster",nodes:e.nodes||[],keyspaces:e.keyspaces||[],tables:e.tables||[],defaultConsistencyLevel:e.consistencyLevel||"QUORUM",defaultReplicationFactor:e.replicationFactor||3,datacenter:e.datacenter||"dc1"}),this.cassandraRoutingEngines.set(t.id,n)}initializeClickHouseRoutingEngine(t){const e=t.data.config||{},n=new tT;n.initialize({cluster:e.cluster||"archiphoenix-cluster",replication:e.replication||!1,tables:e.tables?.map(s=>({name:s.name,database:e.database||"default",engine:s.engine||"MergeTree",rows:s.rows||0,size:s.size||0,partitions:s.partitions||0,columns:s.columns||[]}))||[],maxMemoryUsage:e.maxMemoryUsage||10*1024*1024*1024,compression:e.compression||"LZ4"}),this.clickHouseRoutingEngines.set(t.id,n)}initializeSnowflakeRoutingEngine(t){const e=t.data.config||{},n=new nT;n.initialize({account:e.account||"archiphoenix",region:e.region||"us-east-1",warehouses:e.warehouses?.map(s=>({name:s.name,size:s.size||"Small",status:s.status||"suspended",autoSuspend:s.autoSuspend||(e.enableAutoSuspend?e.autoSuspendSeconds:void 0),autoResume:s.autoResume!==void 0?s.autoResume:e.enableAutoResume!==!1,minClusterCount:s.minClusterCount||1,maxClusterCount:s.maxClusterCount||1,currentClusterCount:s.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0}))||[],databases:e.databases?.map(s=>({name:s.name,comment:s.comment,retentionTime:s.retentionTime,size:s.size,schemas:s.schemas?.map(i=>({name:i.name,tables:i.tables||[],views:i.views||0,functions:i.functions||0}))||[]}))||[],role:e.role||"ACCOUNTADMIN",enableAutoSuspend:e.enableAutoSuspend,autoSuspendSeconds:e.autoSuspendSeconds,enableAutoResume:e.enableAutoResume}),this.snowflakeRoutingEngines.set(t.id,n)}initializeElasticsearchRoutingEngine(t){const e=t.data.config||{},n=new sT;n.initialize({clusterName:e.clusterName||"archiphoenix-cluster",nodes:e.nodes||["localhost:9200"],indices:e.indices||[],defaultShards:e.shards||5,defaultReplicas:e.replicas||1,refreshInterval:e.refreshInterval||"1s",enableSSL:e.enableSSL??!1,enableAuth:e.enableAuth??!1,username:e.username||"elastic",password:e.password||""}),this.elasticsearchRoutingEngines.set(t.id,n)}initializeS3RoutingEngine(t){const e=t.data.config||{},n=new iT,s=(e.buckets||[]).map(i=>({name:i.name,region:i.region||e.defaultRegion||"us-east-1",versioning:i.versioning||!1,encryption:i.encryption||"AES256",lifecycleEnabled:i.lifecycleEnabled||!1,lifecycleDays:i.lifecycleDays,glacierEnabled:i.glacierEnabled||!1,glacierDays:i.glacierDays,publicAccess:i.publicAccess||!1,lifecycleRules:e.lifecycleRules||[]}));n.initialize({buckets:s,defaultRegion:e.defaultRegion||"us-east-1"}),this.s3RoutingEngines.set(t.id,n)}initializePrometheusEngine(t){const e=new rT;e.initializeConfig(t),this.prometheusEngines.set(t.id,e)}initializeGrafanaEngine(t){const e=new cT;e.initializeConfig(t),this.grafanaEngines.set(t.id,e)}initializeJaegerEngine(t){const e=new uT;e.initializeConfig(t),this.jaegerEngines.set(t.id,e)}initializeOpenTelemetryCollectorEngine(t){if(this.otelCollectorEngines.has(t.id))this.otelCollectorEngines.get(t.id).initializeConfig(t);else{const e=new dT;e.initializeConfig(t),this.otelCollectorEngines.set(t.id,e)}}initializePagerDutyEngine(t){const e=new hT;e.initializeFromNode(t),this.pagerDutyEngines.set(t.id,e)}initializeKeycloakEngine(t){const e=new pT;e.initializeConfig(t),this.keycloakEngines.set(t.id,e)}initializeVaultEngine(t){const e=new wT;e.initializeConfig(t),this.vaultEngines.set(t.id,e)}initializeWAFEngine(t){const e=new mT;e.initializeConfig(t),this.wafEngines.set(t.id,e)}initializeFirewallEngine(t){const e=new vT;e.initializeConfig(t),this.firewallEngines.set(t.id,e)}initializeVPNEngine(t){const e=new ST;e.initializeConfig(t),this.vpnEngines.set(t.id,e)}initializeCDNEngine(t){const e=new RT;e.initializeConfig(t),this.cdnEngines.set(t.id,e)}initializeIDSIPSEngine(t){const e=new xT;e.initializeConfig(t),this.idsIpsEngines.set(t.id,e)}initializeJenkinsEngine(t){const e=new ET;e.initializeConfig(t),this.jenkinsEngines.set(t.id,e)}initializeGitLabCIEngine(t){const e=new kT;e.initializeConfig(t),this.gitlabCIEngines.set(t.id,e)}initializeArgoCDEngine(t){const e=new TT;e.initializeConfig(t),this.argoCDEngines.set(t.id,e)}initializeTerraformEngine(t){const e=new AT;e.initializeConfig(t),this.terraformEngines.set(t.id,e)}initializeAnsibleEngine(t){const e=new LT;e.initializeConfig(t),this.ansibleEngines.set(t.id,e)}initializeTraefikEngine(t){const e=new IT;e.initializeConfig(t),this.traefikEngines.set(t.id,e)}initializeHarborEngine(t){const e=new DT;e.initializeConfig(t),this.harborEngines.set(t.id,e)}initializeDockerEngine(t){const e=new NT;e.initializeConfig(t),this.dockerEngines.set(t.id,e)}initializeKubernetesEngine(t){const e=new jT;e.initializeConfig(t),this.kubernetesEngines.set(t.id,e)}createLokiQueryExecutor(t){const s=((t.data.config||{}).datasources||[]).find(u=>typeof u=="string"?!1:u.type==="loki");if(!s||typeof s=="string")return;const i=s.url||"",o=this.nodes.find(u=>u.type!=="loki"?!1:((u.data.config||{}).serverUrl||"http://loki:3100")===i||i.includes(u.id)||i.includes(u.data.label||""));if(!o)return;const c=this.lokiEngines.get(o.id);if(c)return(u,h,f,m)=>{const y=c.executeQuery(u,h,f,m);return{success:y.success,latency:y.latency,resultsCount:y.resultsCount,error:y.error}}}isPrometheusAvailableForGrafana(t){const e=this.connections.find(o=>o.source===t.id&&this.nodes.find(c=>c.id===o.target)?.type==="prometheus");if(!e)return!1;const n=this.nodes.find(o=>o.id===e.target);if(!n||!this.prometheusEngines.get(n.id))return!1;const i=this.metrics.get(n.id);return!(i&&i.errorRate>.5)}initializePostgreSQLConnectionPool(t){const e=t.data.config||{},n={maxConnections:e.maxConnections||100,minConnections:e.minConnections||0,idleTimeout:e.idleTimeout||3e5,maxLifetime:e.maxLifetime||36e5,connectionTimeout:e.connectionTimeout||5e3},s=new aT(n);this.postgresConnectionPools.set(t.id,s)}updateElasticsearchMetricsInConfig(t,e){const n=t.data.config||{};n.clusterHealth=e.clusterHealth,n.activeShards=e.activeShards,n.relocatingShards=e.relocatingShards,n.initializingShards=e.initializingShards;const s=n.indices||[],i=this.elasticsearchRoutingEngines.get(t.id)?.getIndices()||[];for(let o=0;o<s.length;o++){const c=s[o],u=i.find(h=>h.name===c.name);u&&(s[o]={...c,docs:u.docs,size:u.size,health:u.health})}n.indices=s,n.totalDocs=e.totalDocs,n.totalSize=e.totalSize}updateS3BucketMetricsInConfig(t,e){const n=t.data.config||{},s=n.buckets||[];for(let i=0;i<s.length;i++){const o=s[i],c=e.get(o.name);c&&(s[i]={...o,objectCount:c.objectCount,totalSize:c.totalSize})}n.buckets=s}calculateConnectionLatency(t,e,n){const i={sync:5,async:2,http:10,grpc:5,websocket:3}[t.type]||10,o=e.latency||0,c=n.latency||0,u=t.data||{},h=u.latencyMs||0,f=(u.jitterMs||0)*(Math.random()-.5),m=2+Math.random()*8+h+f;return i+(o+c)/2+m}calculateCacheHitRatio(t,e){let n=.95;e>0&&e<100?n=.9+Math.random()*.05:e>=100&&e<1e3?n=.95+Math.random()*.04:e>=1e3&&(n=.92+Math.random()*.05);const s=Math.sin(this.simulationTime/1e4)*.02;return Math.max(.85,Math.min(.99,n+s))}createDefaultMetrics(t,e){return{id:t,type:e,throughput:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now()}}createDefaultConnectionMetrics(t){return{id:t.id,source:t.source,target:t.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0}}initializeMetrics(){this.metrics.clear(),this.connectionMetrics.clear(),this.latencyHistory.clear(),this.connectionLatencyHistory.clear();for(const t of this.nodes)this.metrics.set(t.id,this.createDefaultMetrics(t.id,t.type))}getComponentMetrics(t){return this.metrics.get(t)}getRabbitMQRoutingEngine(t){return this.rabbitMQRoutingEngines.get(t)}getActiveMQRoutingEngine(t){return this.activeMQRoutingEngines.get(t)}getSQSRoutingEngine(t){return this.sqsRoutingEngines.get(t)}getAzureServiceBusRoutingEngine(t){return this.azureServiceBusRoutingEngines.get(t)}getPubSubRoutingEngine(t){return this.pubSubRoutingEngines.get(t)}getRedisRoutingEngine(t){return this.redisRoutingEngines.get(t)}getCassandraRoutingEngine(t){return this.cassandraRoutingEngines.get(t)}getClickHouseRoutingEngine(t){return this.clickHouseRoutingEngines.get(t)}getSnowflakeRoutingEngine(t){return this.snowflakeRoutingEngines.get(t)}getElasticsearchRoutingEngine(t){return this.elasticsearchRoutingEngines.get(t)}getKongRoutingEngine(t){return this.kongRoutingEngines.get(t)}getCloudAPIGatewayEngine(t){return this.cloudAPIGatewayEngines.get(t)}getNginxRoutingEngine(t){return this.nginxRoutingEngines.get(t)}getHAProxyRoutingEngine(t){return this.haproxyRoutingEngines.get(t)}getTraefikEmulationEngine(t){return this.traefikEngines.get(t)}getEnvoyRoutingEngine(t){return this.envoyRoutingEngines.get(t)}getIstioRoutingEngine(t){return this.istioRoutingEngines.get(t)}getServiceMeshRoutingEngine(t){return this.serviceMeshRoutingEngines.get(t)}getApigeeRoutingEngine(t){return this.apigeeRoutingEngines.get(t)}getMuleSoftRoutingEngine(t){return this.mulesoftRoutingEngines.get(t)}getGraphQLGatewayRoutingEngine(t){return this.graphQLGatewayRoutingEngines.get(t)}getBFFRoutingEngine(t){return this.bffRoutingEngines.get(t)}getRestApiRoutingEngine(t){return this.restApiRoutingEngines.get(t)}getWebhookRelayRoutingEngine(t){return this.webhookRelayRoutingEngines.get(t)}getLokiEmulationEngine(t){return this.lokiEngines.get(t)}getKeycloakEmulationEngine(t){return this.keycloakEngines.get(t)}getJenkinsEmulationEngine(t){return this.jenkinsEngines.get(t)}getGitLabCIEmulationEngine(t){return this.gitlabCIEngines.get(t)}getArgoCDEmulationEngine(t){return this.argoCDEngines.get(t)}getTerraformEmulationEngine(t){return this.terraformEngines.get(t)}getAnsibleEmulationEngine(t){return this.ansibleEngines.get(t)}getHarborEmulationEngine(t){return this.harborEngines.get(t)}getDockerEmulationEngine(t){return this.dockerEngines.get(t)}getKubernetesEmulationEngine(t){return this.kubernetesEngines.get(t)}getVaultEmulationEngine(t){return this.vaultEngines.get(t)}getWAFEmulationEngine(t){return this.wafEngines.get(t)}getFirewallEmulationEngine(t){return this.firewallEngines.get(t)}getVPNEmulationEngine(t){return this.vpnEngines.get(t)}getCDNEmulationEngine(t){return this.cdnEngines.get(t)}getIDSIPSEmulationEngine(t){return this.idsIpsEngines.get(t)}getJaegerEmulationEngine(t){return this.jaegerEngines.get(t)}getAllJaegerEngines(){return new Map(this.jaegerEngines)}getOpenTelemetryCollectorRoutingEngine(t){return this.otelCollectorEngines.get(t)}checkSQSIAMPolicy(t,e,n,s){if(!t||t.length===0)return!0;const i=t.filter(u=>{const h=u.principal||"";if(h!==e&&h!=="*"&&!e.includes(h))return!1;const f=u.resource||"";let m=!1;if(f==="*"||f===n)m=!0;else if(f.endsWith("*")){const v=f.slice(0,-1);m=n.startsWith(v.replace(/.*:/,""))}else if(f.includes("sqs:")||f.includes("arn:aws:sqs")){const v=f.split(":").pop()||f.split("/").pop()||"";m=v===n||v==="*"||n.includes(v)}else m=n.includes(f)||f==="*";if(!m)return!1;const y=u.action||"";return!(y!==s&&y!=="*"&&!y.includes(s))});return i.length===0?!0:i.filter(u=>u.effect==="Deny").length>0?!1:(i.filter(u=>u.effect==="Allow").length>0,!0)}checkActiveMQACLPermissionPublic(t,e,n,s){return this.checkActiveMQACLPermission(t,e,n,s)}getConnectionMetrics(t){return this.connectionMetrics.get(t)}getAllComponentMetrics(){return Array.from(this.metrics.values())}getAllConnectionMetrics(){return Array.from(this.connectionMetrics.values())}getPagerDutyIncidents(t){const e=this.pagerDutyEngines.get(t);return e?e.getIncidents():[]}getPagerDutyMetrics(t){const e=this.pagerDutyEngines.get(t);return e?e.getMetrics():null}acknowledgePagerDutyIncident(t,e){const n=this.pagerDutyEngines.get(t);n&&n.acknowledgeIncident(Date.now(),e)}resolvePagerDutyIncident(t,e){const n=this.pagerDutyEngines.get(t);n&&n.resolveIncidentManually(Date.now(),e)}getIsRunning(){return this.isRunning}getSimulationTime(){return this.simulationTime}}const Re=new $T;function BT(r,t){let e=null;return function(...s){const i=()=>{e=null,r(...s)};e!==null&&clearTimeout(e),e=setTimeout(i,t)}}class UT{logLevel;logs=[];maxLogs=100;constructor(){this.logLevel=2}debug(t,e){this.log(0,t,void 0,e)}info(t,e){this.log(1,t,void 0,e)}warn(t,e,n){this.log(2,t,e,n)}error(t,e,n){this.log(3,t,e,n)}log(t,e,n,s){if(t<this.logLevel)return;const i={level:t,message:e,error:n,timestamp:Date.now(),context:s};this.logs.push(i),this.logs.length>this.maxLogs&&this.logs.shift();const o=`[${this.getLevelName(t)}] ${e}`,c=s?{...s,error:n}:n;switch(t){case 0:console.debug(o,c||"");break;case 1:console.info(o,c||"");break;case 2:console.warn(o,c||"");break;case 3:console.error(o,c||"");break}}getLevelName(t){switch(t){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARN";case 3:return"ERROR";default:return"UNKNOWN"}}getRecentLogs(t,e=50){let n=this.logs;return t!==void 0&&(n=this.logs.filter(s=>s.level>=t)),n.slice(-e)}clearLogs(){this.logs=[]}setLogLevel(t){this.logLevel=t}}const Sb=new UT,Mb=(r,t,e)=>Sb.warn(r,t,e),ii=(r,t,e)=>Sb.error(r,t,e),El="archiphoenix_diagram",Kf=1,FT=500,VT=()=>{try{const r=localStorage.getItem(El);if(!r)return null;const t=JSON.parse(r);return t.version!==Kf?(Mb("Diagram version mismatch, using defaults"),null):t}catch(r){return ii("Failed to load diagram from storage",r instanceof Error?r:new Error(String(r))),null}},GT=(r,t="My Diagram")=>{try{const e={...r,version:Kf,name:t,createdAt:localStorage.getItem(`${El}_createdAt`)||new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem(El,JSON.stringify(e)),localStorage.setItem(`${El}_createdAt`,e.createdAt)}catch(e){ii("Failed to save diagram to storage",e instanceof Error?e:new Error(String(e)))}},gt=BT(GT,FT),QT=(r,t="diagram.json")=>{try{const e={...r,version:Kf,name:t.replace(".json",""),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},n=JSON.stringify(e,null,2),s=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(e){ii("Failed to export diagram",e instanceof Error?e:new Error(String(e)))}},KT=r=>new Promise(t=>{try{const e=new FileReader;e.onload=n=>{try{const s=n.target?.result,i=JSON.parse(s);if(!i.nodes||!i.connections||typeof i.zoom!="number"||!i.pan)throw new Error("Invalid diagram format");i.groups||(i.groups=[]),t(i)}catch(s){ii("Failed to parse diagram file",s instanceof Error?s:new Error(String(s))),t(null)}},e.readAsText(r)}catch(e){ii("Failed to import diagram",e instanceof Error?e:new Error(String(e))),t(null)}}),YT=50,Ar=us((r,t)=>({past:[],future:[],canUndo:!1,canRedo:!1,pushState:e=>{r(n=>{const s=[...n.past,e];return s.length>YT&&s.shift(),{past:s,future:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{past:e,future:n}=t();if(e.length===0)return null;const s=e[e.length-1],i=e.slice(0,-1);return r({past:i,future:[s,...n],canUndo:i.length>0,canRedo:!0}),s},redo:()=>{const{past:e,future:n}=t();if(n.length===0)return null;const s=n[0],i=n.slice(1);return r({past:[...e,s],future:i,canUndo:!0,canRedo:i.length>0}),s},clearHistory:()=>{r({past:[],future:[],canUndo:!1,canRedo:!1})}}));class WT{rules=new Map;allRules=[];register(t){const e=t.sourceType;this.rules.has(e)||this.rules.set(e,[]);const n=this.rules.get(e);n&&(n.push(t),this.allRules.push(t),n.sort((s,i)=>(i.priority||0)-(s.priority||0)))}registerMany(t){t.forEach(e=>this.register(e))}findRules(t,e){const n=[],s=this.rules.get(t)||[];for(const o of s)(o.targetTypes==="*"||Array.isArray(o.targetTypes)&&o.targetTypes.includes(e))&&n.push(o);const i=this.rules.get("*")||[];for(const o of i)(o.targetTypes==="*"||Array.isArray(o.targetTypes)&&o.targetTypes.includes(e))&&n.push(o);return n.sort((o,c)=>(c.priority||0)-(o.priority||0))}getAllRules(){return[...this.allRules]}getRulesForSource(t){return this.rules.get(t)||[]}clear(){this.rules.clear(),this.allRules=[]}}const XT={postgres:5432,mongodb:27017,redis:6379,cassandra:9042,clickhouse:8123,elasticsearch:9200,rest:8080,grpc:50051,graphql:4e3,websocket:8080,webhook:8080,soap:8080,nginx:80,envoy:80,haproxy:80,traefik:80,docker:2375,kubernetes:6443,kafka:9092,rabbitmq:5672,activemq:61616,"aws-sqs":9324,prometheus:9090,grafana:3e3,loki:3100,jaeger:16686,keycloak:8080,"secrets-vault":8200,crm:8080,erp:8080,"payment-gateway":443},JT={"api-gateway":9100,postgres:9187,redis:9121,"service-mesh":15014,istio:15014,envoy:9901,cdn:9101,"aws-sqs":9102};class Rb{getHost(t){return t.data.label?t.data.label.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):t.id.slice(0,8)}getPort(t,e){const n=t.data.config||{};switch(e){case"main":return n.port||n.host?.split(":")[1]||XT[t.type];case"metrics":return n.metricsPort||n.metrics?.port||JT[t.type];case"admin":return n.adminPort||n.admin?.port}}getEndpoint(t,e="main"){const n=this.getHost(t),s=this.getPort(t,e);if(!s)throw new Error(`Port not found for ${t.type}:${e}`);return`${n}:${s}`}getURL(t,e="main",n="http"){const s=this.getEndpoint(t,e);return`${n}://${s}`}getConnectionMetadata(t,e,n){const s=this.getHost(t),i=this.getHost(e),o=this.getPort(t,"main"),c=this.getPort(e,"main");let u="http";return n.type==="grpc"?u="grpc":n.type==="websocket"?u="websocket":e.type==="kafka"?u="kafka":e.type==="rabbitmq"||e.type==="activemq"?u="rabbitmq":n.type==="async"?u="async":n.type==="sync"&&(u="sync"),{protocol:u,sourceHost:s,targetHost:i,sourcePort:o,targetPort:c,endpoint:c?`${i}:${c}`:void 0}}getCapabilities(t){return{defaultPort:this.getPort(t,"main"),metricsPort:this.getPort(t,"metrics"),adminPort:this.getPort(t,"admin"),getHost:e=>this.getHost(e),getPort:(e,n)=>this.getPort(e,n)}}}class ZT{registry;discovery;constructor(){this.registry=new WT,this.discovery=new Rb}initialize(t){this.registry.registerMany(t)}handleConnectionCreated(t,e,n,s){const i=this.registry.findRules(t.type,e.type);if(i.length===0)return{sourceUpdated:!1,targetUpdated:!1};let o=!1,c=!1;const u=this.discovery.getConnectionMetadata(t,e,n);for(const h of i)try{const f=h.updateSourceConfig(t,e,n,u);if(f&&Object.keys(f).length>0&&(s(t.id,{data:{...t.data,config:{...t.data.config,...f}}}),o=!0),h.updateTargetConfig){const m=h.updateTargetConfig(t,e,n,u);m&&Object.keys(m).length>0&&(s(e.id,{data:{...e.data,config:{...e.data.config,...m}}}),c=!0)}}catch(f){ii(`Error applying rule for ${t.type} -> ${e.type}`,f instanceof Error?f:new Error(String(f)),{sourceType:t.type,targetType:e.type})}return{sourceUpdated:o,targetUpdated:c}}handleConnectionDeleted(t,e,n,s){const i=this.registry.findRules(t.type,e.type);if(i.length===0)return{sourceUpdated:!1,targetUpdated:!1};let o=!1,c=!1;const u=this.discovery.getConnectionMetadata(t,e,n);for(const h of i)try{if(h.cleanupSourceConfig){const f=h.cleanupSourceConfig(t,e,n,u);f&&Object.keys(f).length>0&&(s(t.id,{data:{...t.data,config:{...t.data.config,...f}}}),o=!0)}if(h.cleanupTargetConfig){const f=h.cleanupTargetConfig(t,e,n,u);f&&Object.keys(f).length>0&&(s(e.id,{data:{...e.data,config:{...e.data.config,...f}}}),c=!0)}}catch(f){ii(`Error cleaning up rule for ${t.type} -> ${e.type}`,f instanceof Error?f:new Error(String(f)),{sourceType:t.type,targetType:e.type})}return{sourceUpdated:o,targetUpdated:c}}getDiscovery(){return this.discovery}getRegistry(){return this.registry}}function eA(r){return{sourceType:"envoy",targetTypes:["rest","grpc","graphql","websocket","soap","webhook","postgres","mongodb","redis","cassandra","clickhouse","crm","erp","payment-gateway","bpmn-engine"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).clusters||[],c=o.find(m=>!m.hosts||!Array.isArray(m.hosts)?!1:m.hosts.some(y=>y.address===s.targetHost&&y.port===s.targetPort));if(c)return c.hosts.some(y=>y.address===s.targetHost&&y.port===s.targetPort)?null:{clusters:o.map(y=>y===c?{...y,hosts:[...y.hosts||[],{address:s.targetHost,port:s.targetPort}]}:y)};e.data.label||e.type;const u=`${e.type}-${e.id.slice(0,8)}-cluster`;let h="STRICT_DNS";s.protocol==="grpc"?h="STRICT_DNS":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(h="STATIC_DNS");const f={name:u,type:h,hosts:[{address:s.targetHost,port:s.targetPort}],healthChecks:!0,connectTimeout:5e3,requests:0,errors:0};return{clusters:[...o,f],totalClusters:o.length+1}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function tA(r){return{sourceType:"api-gateway",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).apis||[],u=`${s.protocol==="grpc","http"}://${s.targetHost}:${s.targetPort}`,h=`https://${s.targetHost}:${s.targetPort}`;if(o.find(R=>R.backendUrl===u||R.backendUrl===h||R.backend===u||R.backend===h))return null;const y=`${e.data.label||e.type}-api`,v=`/api/${e.type}`;let x="GET";e.type==="grpc"?x="POST":e.type==="websocket"&&(x="GET");const S={id:`api-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:y,path:v,method:x,backendUrl:u,enabled:!0,requests:0,errors:0,providerMetadata:{}};return{apis:[...o,S]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function nA(r){return{sourceType:"kong",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const i=t.data.config||{},o=i.services||[],c=i.routes||[],h=`${s.protocol==="grpc","http"}://${s.targetHost}:${s.targetPort}`,m=`${e.data.label||e.type}-service`;let y=o.find(M=>M.name===m||M.url===h);y||(y={id:String(o.length+1),name:m,url:h,routes:0,enabled:!0},o.push(y));const v=`/api/${e.type}`;if(c.find(M=>M.service===y.name&&M.path===v))return null;let S="GET";e.type==="grpc"?S="POST":(e.type==="websocket"||e.type==="rest"||e.type==="graphql")&&(S="GET");const R={id:String(c.length+1),path:v,method:S,service:y.name,stripPath:!0,protocols:["http","https"]};return y.routes=(y.routes||0)+1,{services:o,routes:[...c,R]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function sA(r){return{sourceType:"service-mesh",targetTypes:"*",priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).services||[];if(o.find(y=>y.host===s.targetHost&&y.port===s.targetPort))return null;const h=(e.data.label||e.type).toLowerCase().replace(/\s+/g,"-");let f="http";s.protocol==="grpc"?f="grpc":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(f="tcp");const m={name:h,namespace:"default",host:s.targetHost,port:s.targetPort,protocol:f,enabled:!0};return{services:[...o,m]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function iA(r){return{sourceType:"istio",targetTypes:"*",priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).services||[];if(o.find(y=>y.host===s.targetHost&&y.port===s.targetPort))return null;const h=(e.data.label||e.type).toLowerCase().replace(/\s+/g,"-");let f="http";s.protocol==="grpc"?f="grpc":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(f="tcp");const m={name:h,namespace:"default",host:s.targetHost,port:s.targetPort,protocol:f,enabled:!0};return{services:[...o,m]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function aA(r){return{sourceType:"nginx",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).upstreams||[],c=`${e.type}-upstream`;let u=o.find(f=>f.name===c);if(u)return u.servers?.some(m=>(m.host===s.targetHost||m.address===`${s.targetHost}:${s.targetPort}`)&&(m.port===s.targetPort||m.address?.includes(`:${s.targetPort}`)))?null:{upstreams:o.map(m=>m.name===c?{...m,servers:[...m.servers||[],{host:s.targetHost,port:s.targetPort}]}:m)};const h={name:c,servers:[{host:s.targetHost,port:s.targetPort}],loadBalancing:"round-robin"};return{upstreams:[...o,h]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function oA(r){return{sourceType:"haproxy",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).backends||[],c=`${e.type}-backend`;let u=o.find(f=>f.name===c);if(u)return u.servers?.some(m=>(m.host===s.targetHost||m.address===`${s.targetHost}:${s.targetPort}`)&&(m.port===s.targetPort||m.address?.includes(`:${s.targetPort}`)))?null:{backends:o.map(m=>m.name===c?{...m,servers:[...m.servers||[],{host:s.targetHost,port:s.targetPort}]}:m)};const h={name:c,servers:[{host:s.targetHost,port:s.targetPort}],balance:"roundrobin"};return{backends:[...o,h]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function rA(r){return{sourceType:"traefik",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const i=t.data.config||{},o=i.services||{},c=i.routers||{},u=`${e.type}-service`,h=`${e.type}-router`;if(o[u])return o[u].servers?.some(v=>v.url===`http://${s.targetHost}:${s.targetPort}`)?null:{services:{...o,[u]:{...o[u],servers:[...o[u].servers||[],{url:`http://${s.targetHost}:${s.targetPort}`}]}}};const m=`Host(\`${(e.data.label||e.type).toLowerCase()}.local\`)`;return{services:{...o,[u]:{loadBalancer:{servers:[{url:`http://${s.targetHost}:${s.targetPort}`}]}}},routers:{...c,[h]:{rule:m,service:u}}}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function cA(r){return{sourceType:"*",targetTypes:["postgres","mongodb","redis","cassandra","clickhouse","elasticsearch"],priority:5,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const i=t.data.config||{},o=e.type;let c={};switch(o){case"postgres":c={database:{host:s.targetHost,port:s.targetPort,database:i.database?.database||"postgres",username:i.database?.username||"postgres",password:i.database?.password||""}};break;case"mongodb":c={database:{connectionString:`mongodb://${s.targetHost}:${s.targetPort}`,database:i.database?.database||"admin"}};break;case"redis":c={database:{host:s.targetHost,port:s.targetPort,password:i.database?.password||""}};break;case"cassandra":c={database:{hosts:[`${s.targetHost}:${s.targetPort}`],keyspace:i.database?.keyspace||"system"}};break;case"clickhouse":c={database:{host:s.targetHost,port:s.targetPort,database:i.database?.database||"default"}};break;case"elasticsearch":c={database:{hosts:[`http://${s.targetHost}:${s.targetPort}`]}};break;default:return null}return c},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function lA(r){return{sourceType:"*",targetTypes:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],priority:5,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const i=t.data.config||{},o=e.type;let c={};switch(o){case"kafka":c={messaging:{broker:`${s.targetHost}:${s.targetPort}`,topic:i.messaging?.topic||e.data.config?.defaultTopic||"default-topic",producerId:i.messaging?.producerId||t.id.slice(0,8)}};break;case"rabbitmq":c={messaging:{broker:`${s.targetHost}:${s.targetPort}`,exchange:i.messaging?.exchange||e.data.config?.defaultExchange||"amq.topic",routingKey:i.messaging?.routingKey||"default"}};break;case"activemq":const u=e.data.config?.queues||[],h=u.length>0&&typeof u[0]=="object"?u[0].name:u.length>0?u[0]:null;c={messaging:{broker:`${s.targetHost}:${s.targetPort}`,queue:i.messaging?.queue||h||"default-queue"}};break;case"aws-sqs":{const f=e.data.config?.queues||[],m=f.length>0&&typeof f[0]=="object"?f[0].name:f.length>0?f[0]:null,y=f.length>0&&typeof f[0]=="object"?f[0].region:e.data.config?.defaultRegion||"us-east-1";c={messaging:{queueUrl:`https://sqs.${y}.amazonaws.com/account/${m||"default-queue"}`,queueName:m||"default-queue",region:i.messaging?.region||y}};break}case"azure-service-bus":{const f=e.data.config||{},m=f.namespace||"archiphoenix.servicebus.windows.net";f.connectionString||`${m}`;const y=i.messaging?.entityType||f.entityType||"queue",v=i.messaging?.entityName||i.messaging?.queue||i.messaging?.topic||f.entityName||(y==="queue"?"events":"events-topic"),x=i.messaging?.subscriptionName||f.subscriptionName;c={messaging:{connectionString:f.connectionString||`Endpoint=sb://${m}/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=...`,namespace:m,entityType:y,queue:y==="queue"?v:void 0,topic:y==="topic"?v:void 0,subscriptionName:y==="topic"&&x?x:void 0}};break}case"gcp-pubsub":c={messaging:{projectId:i.messaging?.projectId||"default-project",topic:i.messaging?.topic||e.data.config?.defaultTopic||"default-topic"}};break;default:return null}return c},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function uA(r,t){const e=r.data.config||{};return e.metrics?.port?e.metrics.port:e.metricsPort?e.metricsPort:(r.type==="service-mesh"||r.type==="istio")&&e.metrics?.controlPlanePort?e.metrics.controlPlanePort:t.getPort(r,"metrics")}function dA(r){const t=r.data.config||{};return t.metrics?.path?t.metrics.path:t.metricsPath?t.metricsPath:r.type==="envoy"?t.metrics?.prometheusPath||"/stats/prometheus":"/metrics"}function av(r){return r.data.label?r.data.label.toLowerCase().replace(/\s+/g,"-"):`${r.type}-${r.id.slice(0,8)}`}function ov(r,t){const e=t.getHost(r),n=uA(r,t);if(!n){const s=t.getPort(r,"main");return s?`${e}:${s}`:null}return`${e}:${n}`}function hA(r){return{sourceType:"*",targetTypes:["prometheus"],priority:5,updateTargetConfig:(t,e,n,s)=>{const i=e.data.config||{},o=i.scrape_configs||[],c=i.scrapeInterval||"15s",u=dA(t),h=ov(t,r);if(!h)return null;const f=av(t),m={component:t.type,componentId:t.id},y=o.findIndex(x=>x.job_name===f);if(y>=0){const x=o[y];let S=!1;for(const R of x.static_configs||[]){if(R.targets&&R.targets.includes(h)){S=!0;break}if(R.labels?.componentId===t.id){R.targets.includes(h)||R.targets.push(h),S=!0;break}}if(!S){const R=[...o],M=[...x.static_configs||[]];return M.push({targets:[h],labels:m}),R[y]={...x,static_configs:M},{scrape_configs:R}}return null}const v={job_name:f,scrape_interval:c!=="15s"?c:void 0,metrics_path:u!=="/metrics"?u:void 0,static_configs:[{targets:[h],labels:m}]};return{scrape_configs:[...o,v]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n),cleanupTargetConfig:(t,e,n,s)=>{const o=(e.data.config||{}).scrape_configs||[];if(!o||o.length===0)return null;const c=ov(t,r),u=av(t),h=t.id;let f=!1;const m=o.map(y=>{if(y.job_name!==u)return y;const v=(y.static_configs||[]).map(x=>{if(x.labels?.componentId===h)return f=!0,null;if(c&&x.targets&&x.targets.includes(c)){const S=x.targets.filter(R=>R!==c);return S.length===0?(f=!0,null):(f=!0,{...x,targets:S})}return x}).filter(x=>x!==null);return v.length===0?(f=!0,null):{...y,static_configs:v}}).filter(y=>y!==null);return f?{scrape_configs:m}:null}}}function fA(r){return{sourceType:"grafana",targetTypes:["prometheus"],priority:10,updateSourceConfig:(t,e,n,s)=>{let o=(t.data.config||{}).datasources||[];o.length>0&&typeof o[0]=="string"&&(o=o.map(y=>({name:y,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:y===o[0]})));const c=r.getURL(e,"main"),u=s.targetHost||r.getHost(e),h=s.targetPort||r.getPort(e,"main")||9090,f=h===9090?`http://${u}:${h}`:c,m=o.findIndex(y=>y&&typeof y=="object"&&(y.type==="prometheus"||y.name?.toLowerCase().includes("prometheus")));if(m>=0){const y=[...o];return y[m]={...y[m],url:f,type:"prometheus",isDefault:y[m].isDefault??!0},{datasources:y}}else{const y={name:"Prometheus",type:"prometheus",url:f,access:"proxy",isDefault:o.length===0};return{datasources:[...o,y]}}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n),cleanupSourceConfig:(t,e,n,s)=>{let o=(t.data.config||{}).datasources||[];if(o.length>0&&typeof o[0]=="string")return null;const c=r.getURL(e,"main"),u=s.targetHost||r.getHost(e),h=s.targetPort||r.getPort(e,"main")||9090,f=h===9090?`http://${u}:${h}`:c,m=o.filter(y=>!(y&&typeof y=="object"&&y.url===f&&y.type==="prometheus"));return m.length!==o.length?{datasources:m}:null}}}function Eb(r){const t=["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],e=["rest","grpc","graphql","soap","websocket","webhook"],n=["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],s=["s3-datalake"],i=["crm","erp","payment-gateway"];return t.includes(r)?"database":e.includes(r)?"api":n.includes(r)?"messaging":s.includes(r)?"file":i.includes(r)?"api":"custom"}function Ol(r,t,e){const n=e?r.label||r.type:t.label||t.type,s=e?r.id.slice(0,8):t.id.slice(0,8);return`${n}-${s}`.toLowerCase().replace(/\s+/g,"-")}function pA(r){return{sourceType:"*",targetTypes:["mulesoft"],priority:5,updateTargetConfig:(t,e,n,s)=>{const o=(e.data.config||{}).connectors||[];if(o.find(m=>m.targetComponentId===t.id||m.name===Ol(t,e,!0)))return null;const u=Eb(t.type),f={name:Ol(t,e,!0),type:u,enabled:!0,config:{},targetComponentType:t.type,targetComponentId:t.id};return u==="database"&&s.targetHost&&s.targetPort?f.config={host:s.targetHost,port:s.targetPort}:u==="api"&&s.targetHost&&s.targetPort?f.config={baseUrl:`http://${s.targetHost}:${s.targetPort}`}:u==="messaging"&&(f.config={broker:s.targetHost&&s.targetPort?`${s.targetHost}:${s.targetPort}`:void 0}),{connectors:[...o,f]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function gA(r){return{sourceType:"mulesoft",targetTypes:"*",priority:5,updateSourceConfig:(t,e,n,s)=>{const o=(t.data.config||{}).connectors||[];if(o.find(m=>m.targetComponentId===e.id||m.name===Ol(t,e,!1)))return null;const u=Eb(e.type),f={name:Ol(t,e,!1),type:u,enabled:!0,config:{},targetComponentType:e.type,targetComponentId:e.id};return u==="database"&&s.targetHost&&s.targetPort?f.config={host:s.targetHost,port:s.targetPort}:u==="api"&&s.targetHost&&s.targetPort?f.config={baseUrl:`http://${s.targetHost}:${s.targetPort}`}:u==="messaging"&&s.targetHost&&s.targetPort&&(f.config={broker:`${s.targetHost}:${s.targetPort}`}),{connectors:[...o,f]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function mA(r){return{sourceType:"graphql-gateway",targetTypes:["graphql"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).services||[],c=`http://${s.targetHost}:${s.targetPort}/graphql`;if(o.find(m=>m.endpoint===c||m.name===e.data.label))return null;const h=e.data.label||e.type,f={id:`svc-${o.length+1}`,name:h,endpoint:c,status:"connected",requests:0,errors:0};return{services:[...o,f]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function yA(r){return{sourceType:"bff-service",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,n,s)=>{if(!s.targetHost||!s.targetPort)return null;const o=(t.data.config||{}).backends||[],c=e.data.label||e.type;if(o.find(m=>m.name===c||m.endpoint===`http://${s.targetHost}:${s.targetPort}`||m.id===e.id))return null;let h="http";e.type==="grpc"?h="grpc":e.type==="graphql"&&(h="graphql");const f={id:e.id||`backend-${Date.now()}`,name:c,endpoint:`http://${s.targetHost}:${s.targetPort}`,protocol:h,status:"connected",timeout:5e3,retries:3,retryBackoff:"exponential",circuitBreaker:{enabled:!0,failureThreshold:5,successThreshold:2,timeout:6e4}};return{backends:[...o,f]}},extractMetadata:(t,e,n)=>r.getConnectionMetadata(t,e,n)}}function vA(r){return[eA(r),aA(r),oA(r),rA(r),tA(r),nA(r),mA(r),yA(r),sA(r),iA(r),cA(r),lA(r),hA(r),fA(r),pA(r),gA(r)]}let Jh=null;function rv(){if(!Jh){const r=new Rb,t=new ZT,e=vA(r);t.initialize(e),Jh=t}return Jh}const Kn=2e3,cv=140,lv=200,pl=(r,t)=>({x:Math.floor(r/Kn),y:Math.floor(t/Kn)}),bA=(r,t,e,n,s,i)=>{const o=s*Kn,c=(s+1)*Kn,u=i*Kn,h=(i+1)*Kn,f=r,m=r+e,y=t,v=t+n;return!(m<o||f>c||v<u||y>h)},Zh=r=>{const t=new Set,e=cv+lv,n=cv+lv,s=r.position.x,i=s+e,o=r.position.y,c=o+n,u=pl(s,o).x,h=pl(i,c).x,f=pl(s,o).y,m=pl(i,c).y;for(let y=u;y<=h;y++)for(let v=f;v<=m;v++)bA(s,o,e,n,y,v)&&t.add(`${y},${v}`);return t},Vn=(r,t=[])=>{if(r.length===0)return[];const e=new Set,n=new Map(r.map(s=>[s.id,s]));return r.forEach(s=>{Zh(s).forEach(o=>e.add(o))}),t.forEach(s=>{const i=n.get(s.source),o=n.get(s.target);i&&Zh(i).forEach(u=>e.add(u)),o&&Zh(o).forEach(u=>e.add(u))}),Array.from(e).map(s=>{const[i,o]=s.split(",").map(Number);return{x:i,y:o}})},Gn=r=>{if(r.length===0)return{minX:0,minY:0,maxX:Kn,maxY:Kn};const t=r.map(c=>c.x),e=r.map(c=>c.y),n=Math.min(...t),s=Math.min(...e),i=Math.max(...t),o=Math.max(...e);return{minX:n*Kn,minY:s*Kn,maxX:(i+1)*Kn,maxY:(o+1)*Kn}},ef={nodes:[],connections:[],groups:[],zoom:1,pan:{x:0,y:0}},Ee=us((r,t)=>{const e=VT(),n=e?{...ef,...e,groups:e.groups||[]}:ef;let s=!1,i=!1;const o=()=>{const f=t();return{nodes:f.nodes,connections:f.connections,groups:f.groups||[],zoom:f.zoom,pan:f.pan}},c=()=>{Ar.getState().pushState(o())},u=Vn(n.nodes,n.connections||[]),h=Gn(u);return{...n,selectedNodeId:null,selectedConnectionId:null,diagramName:e?.name||"Untitled Diagram",viewportWidth:0,viewportHeight:0,canvasBounds:h,canvasChunks:u,getDiagramState:o,updateCanvasBounds:()=>r(f=>{const m=Vn(f.nodes,f.connections);return{canvasChunks:m,canvasBounds:Gn(m)}}),addNode:f=>r(m=>{c();const y=[...m.nodes,f],v=Vn(y,m.connections),x={nodes:y,canvasChunks:v,canvasBounds:Gn(v)};return gt({...m,...x},m.diagramName),x}),updateNode:(f,m,y=!1)=>r(v=>{!y&&!s&&c();const x=v.nodes.map(M=>M.id===f?{...M,...m}:M),S=Vn(x,v.connections),R={nodes:x,canvasChunks:S,canvasBounds:Gn(S)};return(!s||!y)&&gt({...v,...R},v.diagramName),R}),updateNodes:(f,m=!1)=>r(y=>{!m&&!s&&!i&&c();const v=new Map(f.map(M=>[M.id,M.updates])),x=y.nodes.map(M=>{const T=v.get(M.id);return T?{...M,...T}:M}),S=Vn(x,y.connections),R={nodes:x,canvasChunks:S,canvasBounds:Gn(S)};return(!i||!m)&&gt({...y,...R},y.diagramName),R}),deleteNode:f=>r(m=>{c();const y=m.nodes.filter(R=>R.id!==f),v=m.connections.filter(R=>R.source!==f&&R.target!==f),x=Vn(y,v),S={nodes:y,connections:v,selectedNodeId:m.selectedNodeId===f?null:m.selectedNodeId,canvasChunks:x,canvasBounds:Gn(x)};return gt({...m,...S},m.diagramName),S}),selectNode:(f,m=!1)=>r(y=>m&&f&&y.nodes.find(x=>x.id===f)?{selectedNodeId:f,nodes:y.nodes.map(x=>({...x,selected:x.id===f?!x.selected:x.selected||!1}))}:{selectedNodeId:f,nodes:y.nodes.map(v=>({...v,selected:v.id===f}))}),selectNodesByIds:f=>r(m=>({selectedNodeId:f.length>0?f[0]:null,nodes:m.nodes.map(y=>({...y,selected:f.includes(y.id)}))})),addConnection:f=>r(m=>{c();const y={...f,type:f.type||"async"},v=m.nodes.find(k=>k.id===y.source),x=m.nodes.find(k=>k.id===y.target);let S=[...m.nodes];if(v&&x){const k=rv(),A=(_,P)=>{const z=S.findIndex(q=>q.id===_);z!==-1&&(S[z]={...S[z],...P})};k.handleConnectionCreated(v,x,y,A)}const R=[...m.connections,y],M=Vn(S,R),T={nodes:S,connections:R,canvasChunks:M,canvasBounds:Gn(M)};return gt({...m,...T},m.diagramName),T}),updateConnection:(f,m)=>r(y=>{c();const v={connections:y.connections.map(x=>x.id===f?{...x,...m}:x)};return gt({...y,...v},y.diagramName),v}),deleteConnection:f=>r(m=>{c();const y=m.connections.find(M=>M.id===f);let v=[...m.nodes];if(y){const M=m.nodes.find(k=>k.id===y.source),T=m.nodes.find(k=>k.id===y.target);if(M&&T){const k=rv(),A=(_,P)=>{const z=v.findIndex(q=>q.id===_);z!==-1&&(v[z]={...v[z],...P})};k.handleConnectionDeleted(M,T,y,A)}}const x=m.connections.filter(M=>M.id!==f),S=Vn(v,x),R={nodes:v,connections:x,selectedConnectionId:m.selectedConnectionId===f?null:m.selectedConnectionId,canvasChunks:S,canvasBounds:Gn(S)};return gt({...m,...R},m.diagramName),R}),selectConnection:f=>r(m=>({selectedConnectionId:f,selectedNodeId:null,selectedGroupId:null,connections:m.connections.map(y=>({...y,selected:y.id===f}))})),addGroup:f=>r(m=>{c();const y={groups:[...m.groups,f]};return gt({...m,...y},m.diagramName),y}),updateGroup:(f,m)=>r(y=>{c();const v={groups:y.groups.map(x=>x.id===f?{...x,...m}:x)};return gt({...y,...v},y.diagramName),v}),deleteGroup:f=>r(m=>{c();const y={groups:m.groups.filter(v=>v.id!==f)};return gt({...m,...y},m.diagramName),y}),addNodeToGroup:(f,m)=>r(y=>{c();const v={groups:y.groups.map(x=>x.id===f&&!x.nodeIds.includes(m)?{...x,nodeIds:[...x.nodeIds,m]}:x)};return gt({...y,...v},y.diagramName),v}),removeNodeFromGroup:(f,m)=>r(y=>{c();const v={groups:y.groups.map(x=>x.id===f?{...x,nodeIds:x.nodeIds.filter(S=>S!==m)}:x)};return gt({...y,...v},y.diagramName),v}),selectGroup:f=>r(m=>({selectedGroupId:f,selectedNodeId:null,selectedConnectionId:null})),createGroupFromSelection:f=>r(m=>{c();const y=m.nodes.filter(S=>S.selected||S.id===m.selectedNodeId).map(S=>S.id);if(y.length===0)return m;const v={id:`group-${Date.now()}`,name:f,nodeIds:y,color:`hsl(${Math.random()*360}, 70%, 50%)`},x={groups:[...m.groups,v],nodes:m.nodes.map(S=>({...S,selected:!1})),selectedNodeId:null};return gt({...m,...x},m.diagramName),x}),autoGroupByConnections:()=>r(f=>{c();const m=new Set;f.groups.forEach(k=>{k.nodeIds.forEach(A=>m.add(A))});const y=new Map,v=k=>{y.has(k)||y.set(k,k);const A=y.get(k);if(A!==void 0&&A!==k){const _=v(A);return y.set(k,_),_}return A??k},x=(k,A)=>{const _=v(k),P=v(A);_!==P&&y.set(_,P)};f.connections.forEach(k=>{!m.has(k.source)&&!m.has(k.target)&&x(k.source,k.target)});const S=new Map;f.nodes.forEach(k=>{if(!m.has(k.id)){const A=v(k.id);S.has(A)||S.set(A,[]);const _=S.get(A);_&&_.push(k.id)}});const R=[];let M=f.groups.length+1;S.forEach((k,A)=>{k.length>=2&&R.push({id:`group-${Date.now()}-${R.length}`,name:`Group ${M++}`,nodeIds:k,color:`hsl(${Math.random()*360}, 70%, 50%)`})});const T={groups:[...f.groups,...R]};return gt({...f,...T},f.diagramName),T}),setZoom:f=>r(m=>(gt({...m,zoom:f},m.diagramName),{zoom:f})),setPan:f=>r(m=>(gt({...m,pan:f},m.diagramName),{pan:f})),setViewportSize:f=>r(()=>({viewportWidth:f.width,viewportHeight:f.height})),setDiagramName:f=>r(m=>(gt(m,f),{diagramName:f})),loadDiagramState:(f,m=!1)=>r(()=>{m||c();const y=Vn(f.nodes||[],f.connections||[]),v={...f,canvasChunks:y,canvasBounds:Gn(y)};return gt(v,t().diagramName),v}),saveDiagram:()=>{const f=t();gt(f,f.diagramName)},resetCanvas:()=>{c();const f=Vn([],[]);r({...ef,canvasChunks:f,canvasBounds:Gn(f)})},undo:()=>{const f=Ar.getState().undo();f&&r(()=>{const m=Vn(f.nodes||[],f.connections||[]),y={...f,canvasChunks:m,canvasBounds:Gn(m)};return gt(y,t().diagramName),y})},redo:()=>{const f=Ar.getState().redo();f&&r(()=>{const m=Vn(f.nodes||[],f.connections||[]),y={...f,canvasChunks:m,canvasBounds:Gn(m)};return gt(y,t().diagramName),y})},startDragOperation:f=>{const m=t();s=!0,m.nodes.find(y=>y.id===f),c()},endDragOperation:()=>{s=!1;const f=t();gt(f,f.diagramName)},setGroupDragging:f=>{i=f},getIsGroupDragging:()=>i,bringToFront:f=>r(m=>{c();const y=m.nodes.findIndex(R=>R.id===f);if(y===-1)return m;const v=[...m.nodes],[x]=v.splice(y,1);v.push(x);const S={nodes:v};return gt({...m,...S},m.diagramName),S}),sendToBack:f=>r(m=>{c();const y=m.nodes.findIndex(R=>R.id===f);if(y===-1)return m;const v=[...m.nodes],[x]=v.splice(y,1);v.unshift(x);const S={nodes:v};return gt({...m,...S},m.diagramName),S}),bringForward:f=>r(m=>{c();const y=m.nodes.findIndex(S=>S.id===f);if(y===-1||y===m.nodes.length-1)return m;const v=[...m.nodes];[v[y],v[y+1]]=[v[y+1],v[y]];const x={nodes:v};return gt({...m,...x},m.diagramName),x}),sendBackward:f=>r(m=>{c();const y=m.nodes.findIndex(S=>S.id===f);if(y===-1||y===0)return m;const v=[...m.nodes];[v[y],v[y-1]]=[v[y-1],v[y]];const x={nodes:v};return gt({...m,...x},m.diagramName),x})}}),Li=us((r,t)=>({isRunning:!1,messages:new Map,messageHistory:[],initialize:(e,n)=>{hn.initialize(e,n),t().updateMessages(e,n)},start:()=>{hn.start(),r({isRunning:!0});const e=setInterval(()=>{const{nodes:n,connections:s}=Ee.getState();t().updateMessages(n,s)},200);hn._pollInterval=e},stop:()=>{hn.stop();const e=hn._pollInterval;e&&clearInterval(e),r({isRunning:!1})},updateMessages:(e,n)=>{hn.updateNodesAndConnections(e,n);const s=new Map;for(const o of n)s.set(o.id,hn.getConnectionMessages(o.id));const i=hn.getMessageHistory(100);r({messages:s,messageHistory:i})},getConnectionMessages:e=>hn.getConnectionMessages(e),getComponentMessages:e=>hn.getComponentMessages(e),getMessageHistory:e=>hn.getMessageHistory(e)}));class xA{nodes=[];connections=[];componentMetrics=new Map;connectionMetrics=new Map;dependencyGraph=new Map;componentStatuses=new Map;update(t,e,n,s){this.nodes=t,this.connections=e,this.componentMetrics=n,this.connectionMetrics=s,this.buildDependencyGraph(),this.analyzeComponentHealth(),this.identifyCriticalPaths(),this.calculateImpactScores()}buildDependencyGraph(){this.dependencyGraph.clear();for(const t of this.nodes){const e=[],n=this.connections.filter(s=>s.target===t.id);for(const s of n){const i=this.connectionMetrics.get(s.id),o=this.componentMetrics.get(s.source);if(!i||!o)continue;const c=Math.max(i.throughputDependency,i.utilization,i.backpressure);let u="direct";i.bottleneck?u="critical":c>.7&&(u="indirect"),e.push({sourceId:s.source,targetId:t.id,connectionId:s.id,type:u,strength:c,impact:this.calculateDependencyImpact(s,o)})}this.dependencyGraph.set(t.id,e)}}calculateDependencyImpact(t,e){const n=this.connectionMetrics.get(t.id);if(!n)return 0;const s=e.errorRate,i=Math.min(1,n.latency/1e3),o=n.backpressure,c=e.utilization>.8?.5:0;return Math.min(1,s*.4+i*.2+o*.3+c*.1)}analyzeComponentHealth(){this.componentStatuses.clear();for(const t of this.nodes){const e=this.componentMetrics.get(t.id),n=this.dependencyGraph.get(t.id)||[];if(!e){this.componentStatuses.set(t.id,{nodeId:t.id,health:"down",dependencies:n,dependents:[],criticalPath:!1,impactScore:0,failureRisk:1});continue}let s="healthy",i=0;e.errorRate>.1?(s="critical",i+=.4):e.errorRate>.05&&(s="degraded",i+=.2),e.utilization>.9?(s==="healthy"&&(s="degraded"),i+=.3):e.utilization>.8&&(i+=.15),e.latency>1e3?(s==="healthy"&&(s="degraded"),i+=.2):e.latency>500&&(i+=.1);for(const c of n){const u=this.componentStatuses.get(c.sourceId);u&&(u.health==="critical"||u.health==="down"?(s==="healthy"&&(s="degraded"),i+=c.impact*.3):u.health==="degraded"&&(i+=c.impact*.15))}i=Math.min(1,i);const o=[];for(const c of this.connections)if(c.source===t.id){const u=this.connectionMetrics.get(c.id);u&&o.push({sourceId:t.id,targetId:c.target,connectionId:c.id,type:u.bottleneck?"critical":"direct",strength:u.throughputDependency,impact:this.calculateDependencyImpact(c,e)})}this.componentStatuses.set(t.id,{nodeId:t.id,health:s,dependencies:n,dependents:o,criticalPath:!1,impactScore:0,failureRisk:i})}}identifyCriticalPaths(){const t=this.nodes.filter(n=>!this.connections.some(s=>s.target===n.id)),e=this.nodes.filter(n=>!this.connections.some(s=>s.source===n.id));for(const n of t)for(const s of e){const i=this.findPath(n.id,s.id);i&&i.length>1&&i.some(c=>{const u=this.componentStatuses.get(c),h=this.connections.find(f=>i.includes(f.source)&&i.includes(f.target)&&i.indexOf(f.source)<i.indexOf(f.target));if(h){const f=this.connectionMetrics.get(h.id);return f?.bottleneck||(f?.backpressure||0)>.7}return u?.health==="critical"||u?.health==="down"})&&i.forEach(c=>{const u=this.componentStatuses.get(c);u&&(u.criticalPath=!0)})}}findPath(t,e){if(t===e)return[t];const n=[{nodeId:t,path:[t]}],s=new Set([t]);for(;n.length>0;){const{nodeId:i,path:o}=n.shift(),c=this.connections.filter(u=>u.source===i);for(const u of c){if(u.target===e)return[...o,e];s.has(u.target)||(s.add(u.target),n.push({nodeId:u.target,path:[...o,u.target]}))}}return null}calculateImpactScores(){for(const[t,e]of this.componentStatuses.entries()){let n=0;n+=Math.min(1,e.dependents.length/5)*.3,e.health==="critical"||e.health==="down"?n+=.4:e.health==="degraded"&&(n+=.2),e.criticalPath&&(n+=.2),n+=e.failureRisk*.1,e.impactScore=Math.min(1,n),this.componentStatuses.set(t,e)}}analyzeSystem(){const t=[],e=[],n=[],s=[];for(const[u,h]of this.componentStatuses.entries())if(h.criticalPath){const f=this.findPathToSink(u);f&&!t.some(m=>JSON.stringify(m)===JSON.stringify(f))&&t.push(f)}for(const[u,h]of this.connectionMetrics.entries())if(h.bottleneck){const f=this.connections.find(m=>m.id===u);f&&(e.includes(f.source)||e.push(f.source),e.includes(f.target)||e.push(f.target))}for(const[u,h]of this.componentStatuses.entries())(h.failureRisk>.6||h.health==="critical"||h.health==="down")&&n.push(u);this.generateRecommendations(s);const i=Array.from(this.componentStatuses.values()).map(u=>{switch(u.health){case"down":return 0;case"critical":return .25;case"degraded":return .5;case"healthy":return 1}}),o=i.length>0?i.reduce((u,h)=>u+h,0)/i.length:1;let c="healthy";return o<.25?c="down":o<.5?c="critical":o<.75&&(c="degraded"),{criticalPaths:t,bottlenecks:e,riskComponents:n,recommendations:s,overallHealth:c}}findPathToSink(t){const e=this.nodes.filter(n=>!this.connections.some(s=>s.source===n.id));for(const n of e){const s=this.findPath(t,n.id);if(s)return s}return null}generateRecommendations(t){for(const[n,s]of this.componentStatuses.entries()){const i=this.nodes.find(c=>c.id===n),o=this.componentMetrics.get(n);!i||!o||(o.utilization>.85&&t.push({type:"scaling",priority:o.utilization>.95?"critical":"high",componentId:n,message:`${i.data.label} is highly utilized (${(o.utilization*100).toFixed(0)}%)`,impact:"May cause performance degradation and increased latency",suggestion:`Consider scaling ${i.data.label} horizontally or vertically`}),o.errorRate>.05&&t.push({type:"monitoring",priority:o.errorRate>.1?"critical":"high",componentId:n,message:`${i.data.label} has high error rate (${(o.errorRate*100).toFixed(1)}%)`,impact:"Affects system reliability and user experience",suggestion:`Investigate error logs and implement error handling for ${i.data.label}`}),o.latency>500&&t.push({type:"optimization",priority:o.latency>1e3?"high":"medium",componentId:n,message:`${i.data.label} has high latency (${o.latency.toFixed(0)}ms)`,impact:"Affects end-to-end response time",suggestion:`Optimize ${i.data.label} performance or add caching`}),s.criticalPath&&s.failureRisk>.5&&t.push({type:"redundancy",priority:"high",componentId:n,message:`${i.data.label} is on a critical path and at risk`,impact:"Failure would significantly impact system",suggestion:`Add redundancy or failover for ${i.data.label}`}))}for(const[n,s]of this.connectionMetrics.entries()){const i=this.connections.find(u=>u.id===n);if(!i)continue;const o=this.nodes.find(u=>u.id===i.source),c=this.nodes.find(u=>u.id===i.target);s.bottleneck&&t.push({type:"optimization",priority:"critical",connectionId:n,message:`Connection between ${o?.data.label||"source"} and ${c?.data.label||"target"} is a bottleneck`,impact:"Limiting overall system throughput",suggestion:"Increase bandwidth or optimize data transfer between these components"}),s.backpressure>.7&&t.push({type:"optimization",priority:"high",connectionId:n,message:`High backpressure (${(s.backpressure*100).toFixed(0)}%) on connection`,impact:"Target component cannot process data fast enough",suggestion:"Scale target component or implement buffering/queuing"})}const e={critical:0,high:1,medium:2,low:3};t.sort((n,s)=>e[n.priority]-e[s.priority])}getComponentStatus(t){return this.componentStatuses.get(t)}getAllComponentStatuses(){return Array.from(this.componentStatuses.values())}getDependencies(t){return this.dependencyGraph.get(t)||[]}}const tf=new xA,ma=us((r,t)=>({componentStatuses:new Map,systemAnalysis:null,updateAnalysis:()=>{const{nodes:e,connections:n}=Ee.getState(),{componentMetrics:s,connectionMetrics:i}=Pt.getState();tf.update(e,n,s,i);const o=tf.analyzeSystem(),c=new Map(tf.getAllComponentStatuses().map(u=>[u.nodeId,u]));r({componentStatuses:c,systemAnalysis:o})},getComponentStatus:e=>t().componentStatuses.get(e),getAllComponentStatuses:()=>Array.from(t().componentStatuses.values()),getSystemAnalysis:()=>t().systemAnalysis})),Yf=us((r,t)=>({alerts:[],updateAlerts:()=>{try{const{nodes:e,connections:n}=Ee.getState(),{componentMetrics:s,connectionMetrics:i}=Pt.getState(),o=ma.getState().getAllComponentStatuses();ha.analyze(e,s,i,o);const c=ha.getAlerts();r({alerts:c})}catch(e){console.error("Error in updateAlerts:",e)}},acknowledgeAlert:e=>{ha.acknowledge(e);const n=ha.getAlerts();r({alerts:n})},clearAlerts:()=>{ha.clear(),r({alerts:[]})},getCriticalAlerts:()=>t().alerts.filter(e=>e.type==="critical"),getWarningAlerts:()=>t().alerts.filter(e=>e.type==="warning")})),kb=us((r,t)=>(nt.onError(()=>{t().updateErrors()}),{errors:[],updateErrors:()=>{const e=nt.getErrors();r({errors:e})},clearErrors:()=>{nt.clear(),r({errors:[]})},clearErrorsByFilter:e=>{nt.clearByFilter(e),t().updateErrors()},removeError:e=>{nt.removeError(e),t().updateErrors()},getErrorsBySeverity:e=>nt.getErrorsBySeverity(e),getErrorsBySource:e=>nt.getErrorsBySource(e),getErrorsByComponent:e=>nt.getErrorsByComponent(e),getCriticalErrors:()=>nt.getCriticalErrors(),getErrorCount:e=>nt.getErrorCount(e),getStats:()=>nt.getStats()})),Pt=us((r,t)=>({isRunning:!1,simulationTime:0,updateInterval:100,componentMetrics:new Map,connectionMetrics:new Map,initialize:(e,n)=>{Re.initialize(e,n),r({componentMetrics:new Map(Re.getAllComponentMetrics().map(s=>[s.id,s])),connectionMetrics:new Map(Re.getAllConnectionMetrics().map(s=>[s.id,s]))}),Li.getState().initialize(e,n)},start:()=>{console.log("useEmulationStore.start() called");try{const e=Re.getIsRunning();console.log("Engine running state:",e),e&&(console.log("Stopping engine first..."),Re.stop()),console.log("Calling emulationEngine.start()..."),Re.start(),console.log("Engine started, setting store isRunning to true"),r({isRunning:!0}),console.log("Starting data flow..."),Li.getState().start(),console.log("Setting up polling interval...");const n=setInterval(()=>{t().updateMetrics()},t().updateInterval);Re._pollInterval=n,console.log("Start complete, polling interval set")}catch(e){throw console.error("Error in useEmulationStore.start():",e),e}},stop:()=>{Re.stop();const e=Re._pollInterval;e&&clearInterval(e),Li.getState().stop(),r({isRunning:!1})},reset:()=>{Re.resetSimulation();const e=Re._pollInterval;e&&clearInterval(e),Li.getState().stop(),r({isRunning:!1,simulationTime:0,componentMetrics:new Map,connectionMetrics:new Map})},setUpdateInterval:e=>{r({updateInterval:e})},updateMetrics:()=>{const{nodes:e,connections:n}=Ee.getState();Re.updateNodesAndConnections(e,n),r(s=>({simulationTime:Re.getSimulationTime(),componentMetrics:new Map(Re.getAllComponentMetrics().map(i=>[i.id,i])),connectionMetrics:new Map(Re.getAllConnectionMetrics().map(i=>[i.id,i]))})),Li.getState().updateMessages(e,n),ma.getState().updateAnalysis(),Yf.getState().updateAlerts(),kb.getState().updateErrors()},getComponentMetrics:e=>t().componentMetrics.get(e),getConnectionMetrics:e=>t().connectionMetrics.get(e)}));const wA=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),CA=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,n)=>n?n.toUpperCase():e.toLowerCase()),uv=r=>{const t=CA(r);return t.charAt(0).toUpperCase()+t.slice(1)},Tb=(...r)=>r.filter((t,e,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===e).join(" ").trim(),SA=r=>{for(const t in r)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var MA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const RA=C.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:o,...c},u)=>C.createElement("svg",{ref:u,...MA,width:t,height:t,stroke:r,strokeWidth:n?Number(e)*24/Number(t):e,className:Tb("lucide",s),...!i&&!SA(c)&&{"aria-hidden":"true"},...c},[...o.map(([h,f])=>C.createElement(h,f)),...Array.isArray(i)?i:[i]]));const _e=(r,t)=>{const e=C.forwardRef(({className:n,...s},i)=>C.createElement(RA,{ref:i,iconNode:t,className:Tb(`lucide-${wA(uv(r))}`,`lucide-${r}`,n),...s}));return e.displayName=uv(r),e};const EA=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ya=_e("activity",EA);const kA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],TA=_e("arrow-down",kA);const AA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],DA=_e("arrow-right",AA);const _A=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],PA=_e("arrow-up",_A);const NA=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],jA=_e("ban",NA);const LA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Wf=_e("check",LA);const zA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Jl=_e("chevron-down",zA);const IA=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Xf=_e("chevron-right",IA);const OA=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ab=_e("chevron-up",OA);const HA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],va=_e("circle-alert",HA);const qA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Jf=_e("circle-check",qA);const $A=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],BA=_e("circle-question-mark",$A);const UA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pa=_e("circle-x",UA);const FA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],VA=_e("circle",FA);const GA=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Db=_e("copy",GA);const QA=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],KA=_e("download",QA);const YA=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],WA=_e("eye",YA);const XA=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],dv=_e("file-text",XA);const JA=[["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],ZA=_e("folder-minus",JA);const eD=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],xf=_e("folder-plus",eD);const tD=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],_b=_e("funnel",tD);const nD=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],sD=_e("grip-vertical",nD);const iD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Pb=_e("info",iD);const aD=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Nb=_e("layers",aD);const oD=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],rD=_e("map",oD);const cD=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],lD=_e("maximize-2",cD);const uD=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],dD=_e("network",uD);const hD=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],fD=_e("pause",hD);const pD=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],gD=_e("play",pD);const mD=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Hl=_e("plus",mD);const yD=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],kl=_e("power-off",yD);const vD=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],nf=_e("power",vD);const bD=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],xD=_e("redo-2",bD);const wD=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],CD=_e("refresh-cw",wD);const SD=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],jb=_e("rotate-ccw",SD);const MD=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],RD=_e("ruler",MD);const ED=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],kD=_e("save",ED);const TD=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$r=_e("search",TD);const AD=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],sf=_e("settings-2",AD);const DD=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],_D=_e("settings",DD);const PD=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],ND=_e("sparkles",PD);const jD=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],LD=_e("square-pen",jD);const zD=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ID=_e("star",zD);const OD=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Zl=_e("trash-2",OD);const HD=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Lb=_e("trending-down",HD);const qD=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],as=_e("triangle-alert",qD);const $D=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],BD=_e("undo-2",$D);const UD=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],FD=_e("upload",UD);const VD=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],os=_e("x",VD);const GD=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],zb=_e("zap",GD);const QD=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],KD=_e("zoom-in",QD);const YD=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],WD=_e("zoom-out",YD);function XD(){const{isRunning:r,simulationTime:t,initialize:e,start:n,stop:s,reset:i}=Pt(),{nodes:o,connections:c}=Ee();C.useEffect(()=>{const y=Re.getIsRunning();console.log("EmulationPanel mounted/updated",{storeIsRunning:r,engineIsRunning:y,simulationTime:t,nodesCount:o.length,connectionsCount:c.length}),r!==y&&(console.warn("State mismatch detected!",{storeIsRunning:r,engineIsRunning:y}),r&&!y?(console.log("Fixing: stopping store"),s()):!r&&y&&(console.log("Fixing: stopping engine"),Re.stop()))},[r,t,o.length,c.length,s]);const u=()=>{console.log("handleStart called",{isRunning:r,simulationTime:t,nodesCount:o.length,connectionsCount:c.length});try{t===0&&(console.log("Initializing emulation..."),e(o,c),console.log("Initialization complete")),console.log("Starting emulation..."),n(),console.log("Start called, isRunning should be true now")}catch(y){console.error("Error starting emulation:",y)}},h=()=>{s()},f=()=>{i()},m=y=>{const v=Math.floor(y/1e3),x=Math.floor(v/60),S=v%60;return`${x}:${S.toString().padStart(2,"0")}`};return g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-sm text-muted-foreground w-12",children:m(t)}),g.jsx(Te,{size:"sm",variant:r?"default":"outline",onClick:y=>{console.log("Button clicked!",{isRunning:r,simulationTime:t,disabled:r}),y.preventDefault(),y.stopPropagation(),r?console.warn("Button clicked but isRunning is true, button should be disabled"):u()},disabled:r,title:"Start emulation",style:{pointerEvents:r?"none":"auto"},children:g.jsx(gD,{className:"w-4 h-4"})}),g.jsx(Te,{size:"sm",variant:r?"default":"outline",onClick:h,disabled:!r,title:"Stop emulation",children:g.jsx(fD,{className:"w-4 h-4"})}),g.jsx(Te,{size:"sm",variant:"outline",onClick:f,title:"Reset simulation",children:g.jsx(jb,{className:"w-4 h-4"})})]})}const Tt=C.forwardRef(({className:r,type:t,...e},n)=>g.jsx("input",{type:t,className:ke("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n,...e}));Tt.displayName="Input";function JD(r){const t=ZD(r),e=C.forwardRef((n,s)=>{const{children:i,...o}=n,c=C.Children.toArray(i),u=c.find(t2);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}function ZD(r){const t=C.forwardRef((e,n)=>{const{children:s,...i}=e;if(C.isValidElement(s)){const o=s2(s),c=n2(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var e2=Symbol("radix.slottable");function t2(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===e2}function n2(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function s2(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var i2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],De=i2.reduce((r,t)=>{const e=JD(`Primitive.${t}`),n=C.forwardRef((s,i)=>{const{asChild:o,...c}=s,u=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(u,{...c,ref:i})});return n.displayName=`Primitive.${t}`,{...r,[t]:n}},{});function Ib(r,t){r&&qr.flushSync(()=>r.dispatchEvent(t))}var rn=globalThis?.document?C.useLayoutEffect:()=>{};function a2(r,t){return C.useReducer((e,n)=>t[e][n]??e,r)}var ln=r=>{const{present:t,children:e}=r,n=o2(t),s=typeof e=="function"?e({present:n.isPresent}):C.Children.only(e),i=Ne(n.ref,r2(s));return typeof e=="function"||n.isPresent?C.cloneElement(s,{ref:i}):null};ln.displayName="Presence";function o2(r){const[t,e]=C.useState(),n=C.useRef(null),s=C.useRef(r),i=C.useRef("none"),o=r?"mounted":"unmounted",[c,u]=a2(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return C.useEffect(()=>{const h=gl(n.current);i.current=c==="mounted"?h:"none"},[c]),rn(()=>{const h=n.current,f=s.current;if(f!==r){const y=i.current,v=gl(h);r?u("MOUNT"):v==="none"||h?.display==="none"?u("UNMOUNT"):u(f&&y!==v?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,u]),rn(()=>{if(t){let h;const f=t.ownerDocument.defaultView??window,m=v=>{const S=gl(n.current).includes(CSS.escape(v.animationName));if(v.target===t&&S&&(u("ANIMATION_END"),!s.current)){const R=t.style.animationFillMode;t.style.animationFillMode="forwards",h=f.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=R)})}},y=v=>{v.target===t&&(i.current=gl(n.current))};return t.addEventListener("animationstart",y),t.addEventListener("animationcancel",m),t.addEventListener("animationend",m),()=>{f.clearTimeout(h),t.removeEventListener("animationstart",y),t.removeEventListener("animationcancel",m),t.removeEventListener("animationend",m)}}else u("ANIMATION_END")},[t,u]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:C.useCallback(h=>{n.current=h?getComputedStyle(h):null,e(h)},[])}}function gl(r){return r?.animationName||"none"}function r2(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function c2(r,t){const e=C.createContext(t),n=i=>{const{children:o,...c}=i,u=C.useMemo(()=>c,Object.values(c));return g.jsx(e.Provider,{value:u,children:o})};n.displayName=r+"Provider";function s(i){const o=C.useContext(e);if(o)return o;if(t!==void 0)return t;throw new Error(`\`${i}\` must be used within \`${r}\``)}return[n,s]}function Cn(r,t=[]){let e=[];function n(i,o){const c=C.createContext(o),u=e.length;e=[...e,o];const h=m=>{const{scope:y,children:v,...x}=m,S=y?.[r]?.[u]||c,R=C.useMemo(()=>x,Object.values(x));return g.jsx(S.Provider,{value:R,children:v})};h.displayName=i+"Provider";function f(m,y){const v=y?.[r]?.[u]||c,x=C.useContext(v);if(x)return x;if(o!==void 0)return o;throw new Error(`\`${m}\` must be used within \`${i}\``)}return[h,f]}const s=()=>{const i=e.map(o=>C.createContext(o));return function(c){const u=c?.[r]||i;return C.useMemo(()=>({[`__scope${r}`]:{...c,[r]:u}}),[c,u])}};return s.scopeName=r,[n,l2(s,...t)]}function l2(...r){const t=r[0];if(r.length===1)return t;const e=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((c,{useScope:u,scopeName:h})=>{const m=u(i)[`__scope${h}`];return{...c,...m}},{});return C.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return e.scopeName=t.scopeName,e}function on(r){const t=C.useRef(r);return C.useEffect(()=>{t.current=r}),C.useMemo(()=>(...e)=>t.current?.(...e),[])}var u2=C.createContext(void 0);function Eo(r){const t=C.useContext(u2);return r||t||"ltr"}function Nr(r,[t,e]){return Math.min(e,Math.max(t,r))}function ge(r,t,{checkForDefaultPrevented:e=!0}={}){return function(s){if(r?.(s),e===!1||!s.defaultPrevented)return t?.(s)}}function d2(r,t){return C.useReducer((e,n)=>t[e][n]??e,r)}var Zf="ScrollArea",[Ob]=Cn(Zf),[h2,Wn]=Ob(Zf),Hb=C.forwardRef((r,t)=>{const{__scopeScrollArea:e,type:n="hover",dir:s,scrollHideDelay:i=600,...o}=r,[c,u]=C.useState(null),[h,f]=C.useState(null),[m,y]=C.useState(null),[v,x]=C.useState(null),[S,R]=C.useState(null),[M,T]=C.useState(0),[k,A]=C.useState(0),[_,P]=C.useState(!1),[z,q]=C.useState(!1),Z=Ne(t,ce=>u(ce)),se=Eo(s);return g.jsx(h2,{scope:e,type:n,dir:se,scrollHideDelay:i,scrollArea:c,viewport:h,onViewportChange:f,content:m,onContentChange:y,scrollbarX:v,onScrollbarXChange:x,scrollbarXEnabled:_,onScrollbarXEnabledChange:P,scrollbarY:S,onScrollbarYChange:R,scrollbarYEnabled:z,onScrollbarYEnabledChange:q,onCornerWidthChange:T,onCornerHeightChange:A,children:g.jsx(De.div,{dir:se,...o,ref:Z,style:{position:"relative","--radix-scroll-area-corner-width":M+"px","--radix-scroll-area-corner-height":k+"px",...r.style}})})});Hb.displayName=Zf;var qb="ScrollAreaViewport",$b=C.forwardRef((r,t)=>{const{__scopeScrollArea:e,children:n,nonce:s,...i}=r,o=Wn(qb,e),c=C.useRef(null),u=Ne(t,c,o.onViewportChange);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),g.jsx(De.div,{"data-radix-scroll-area-viewport":"",...i,ref:u,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...r.style},children:g.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});$b.displayName=qb;var As="ScrollAreaScrollbar",ep=C.forwardRef((r,t)=>{const{forceMount:e,...n}=r,s=Wn(As,r.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=s,c=r.orientation==="horizontal";return C.useEffect(()=>(c?i(!0):o(!0),()=>{c?i(!1):o(!1)}),[c,i,o]),s.type==="hover"?g.jsx(f2,{...n,ref:t,forceMount:e}):s.type==="scroll"?g.jsx(p2,{...n,ref:t,forceMount:e}):s.type==="auto"?g.jsx(Bb,{...n,ref:t,forceMount:e}):s.type==="always"?g.jsx(tp,{...n,ref:t}):null});ep.displayName=As;var f2=C.forwardRef((r,t)=>{const{forceMount:e,...n}=r,s=Wn(As,r.__scopeScrollArea),[i,o]=C.useState(!1);return C.useEffect(()=>{const c=s.scrollArea;let u=0;if(c){const h=()=>{window.clearTimeout(u),o(!0)},f=()=>{u=window.setTimeout(()=>o(!1),s.scrollHideDelay)};return c.addEventListener("pointerenter",h),c.addEventListener("pointerleave",f),()=>{window.clearTimeout(u),c.removeEventListener("pointerenter",h),c.removeEventListener("pointerleave",f)}}},[s.scrollArea,s.scrollHideDelay]),g.jsx(ln,{present:e||i,children:g.jsx(Bb,{"data-state":i?"visible":"hidden",...n,ref:t})})}),p2=C.forwardRef((r,t)=>{const{forceMount:e,...n}=r,s=Wn(As,r.__scopeScrollArea),i=r.orientation==="horizontal",o=tu(()=>u("SCROLL_END"),100),[c,u]=d2("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return C.useEffect(()=>{if(c==="idle"){const h=window.setTimeout(()=>u("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(h)}},[c,s.scrollHideDelay,u]),C.useEffect(()=>{const h=s.viewport,f=i?"scrollLeft":"scrollTop";if(h){let m=h[f];const y=()=>{const v=h[f];m!==v&&(u("SCROLL"),o()),m=v};return h.addEventListener("scroll",y),()=>h.removeEventListener("scroll",y)}},[s.viewport,i,u,o]),g.jsx(ln,{present:e||c!=="hidden",children:g.jsx(tp,{"data-state":c==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:ge(r.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:ge(r.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),Bb=C.forwardRef((r,t)=>{const e=Wn(As,r.__scopeScrollArea),{forceMount:n,...s}=r,[i,o]=C.useState(!1),c=r.orientation==="horizontal",u=tu(()=>{if(e.viewport){const h=e.viewport.offsetWidth<e.viewport.scrollWidth,f=e.viewport.offsetHeight<e.viewport.scrollHeight;o(c?h:f)}},10);return xo(e.viewport,u),xo(e.content,u),g.jsx(ln,{present:n||i,children:g.jsx(tp,{"data-state":i?"visible":"hidden",...s,ref:t})})}),tp=C.forwardRef((r,t)=>{const{orientation:e="vertical",...n}=r,s=Wn(As,r.__scopeScrollArea),i=C.useRef(null),o=C.useRef(0),[c,u]=C.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),h=Qb(c.viewport,c.content),f={...n,sizes:c,onSizesChange:u,hasThumb:h>0&&h<1,onThumbChange:y=>i.current=y,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:y=>o.current=y};function m(y,v){return x2(y,o.current,c,v)}return e==="horizontal"?g.jsx(g2,{...f,ref:t,onThumbPositionChange:()=>{if(s.viewport&&i.current){const y=s.viewport.scrollLeft,v=hv(y,c,s.dir);i.current.style.transform=`translate3d(${v}px, 0, 0)`}},onWheelScroll:y=>{s.viewport&&(s.viewport.scrollLeft=y)},onDragScroll:y=>{s.viewport&&(s.viewport.scrollLeft=m(y,s.dir))}}):e==="vertical"?g.jsx(m2,{...f,ref:t,onThumbPositionChange:()=>{if(s.viewport&&i.current){const y=s.viewport.scrollTop,v=hv(y,c);i.current.style.transform=`translate3d(0, ${v}px, 0)`}},onWheelScroll:y=>{s.viewport&&(s.viewport.scrollTop=y)},onDragScroll:y=>{s.viewport&&(s.viewport.scrollTop=m(y))}}):null}),g2=C.forwardRef((r,t)=>{const{sizes:e,onSizesChange:n,...s}=r,i=Wn(As,r.__scopeScrollArea),[o,c]=C.useState(),u=C.useRef(null),h=Ne(t,u,i.onScrollbarXChange);return C.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),g.jsx(Fb,{"data-orientation":"horizontal",...s,ref:h,sizes:e,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":eu(e)+"px",...r.style},onThumbPointerDown:f=>r.onThumbPointerDown(f.x),onDragScroll:f=>r.onDragScroll(f.x),onWheelScroll:(f,m)=>{if(i.viewport){const y=i.viewport.scrollLeft+f.deltaX;r.onWheelScroll(y),Yb(y,m)&&f.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&n({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:$l(o.paddingLeft),paddingEnd:$l(o.paddingRight)}})}})}),m2=C.forwardRef((r,t)=>{const{sizes:e,onSizesChange:n,...s}=r,i=Wn(As,r.__scopeScrollArea),[o,c]=C.useState(),u=C.useRef(null),h=Ne(t,u,i.onScrollbarYChange);return C.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),g.jsx(Fb,{"data-orientation":"vertical",...s,ref:h,sizes:e,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":eu(e)+"px",...r.style},onThumbPointerDown:f=>r.onThumbPointerDown(f.y),onDragScroll:f=>r.onDragScroll(f.y),onWheelScroll:(f,m)=>{if(i.viewport){const y=i.viewport.scrollTop+f.deltaY;r.onWheelScroll(y),Yb(y,m)&&f.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&n({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:$l(o.paddingTop),paddingEnd:$l(o.paddingBottom)}})}})}),[y2,Ub]=Ob(As),Fb=C.forwardRef((r,t)=>{const{__scopeScrollArea:e,sizes:n,hasThumb:s,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:c,onThumbPositionChange:u,onDragScroll:h,onWheelScroll:f,onResize:m,...y}=r,v=Wn(As,e),[x,S]=C.useState(null),R=Ne(t,Z=>S(Z)),M=C.useRef(null),T=C.useRef(""),k=v.viewport,A=n.content-n.viewport,_=on(f),P=on(u),z=tu(m,10);function q(Z){if(M.current){const se=Z.clientX-M.current.left,ce=Z.clientY-M.current.top;h({x:se,y:ce})}}return C.useEffect(()=>{const Z=se=>{const ce=se.target;x?.contains(ce)&&_(se,A)};return document.addEventListener("wheel",Z,{passive:!1}),()=>document.removeEventListener("wheel",Z,{passive:!1})},[k,x,A,_]),C.useEffect(P,[n,P]),xo(x,z),xo(v.content,z),g.jsx(y2,{scope:e,scrollbar:x,hasThumb:s,onThumbChange:on(i),onThumbPointerUp:on(o),onThumbPositionChange:P,onThumbPointerDown:on(c),children:g.jsx(De.div,{...y,ref:R,style:{position:"absolute",...y.style},onPointerDown:ge(r.onPointerDown,Z=>{Z.button===0&&(Z.target.setPointerCapture(Z.pointerId),M.current=x.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",v.viewport&&(v.viewport.style.scrollBehavior="auto"),q(Z))}),onPointerMove:ge(r.onPointerMove,q),onPointerUp:ge(r.onPointerUp,Z=>{const se=Z.target;se.hasPointerCapture(Z.pointerId)&&se.releasePointerCapture(Z.pointerId),document.body.style.webkitUserSelect=T.current,v.viewport&&(v.viewport.style.scrollBehavior=""),M.current=null})})})}),ql="ScrollAreaThumb",Vb=C.forwardRef((r,t)=>{const{forceMount:e,...n}=r,s=Ub(ql,r.__scopeScrollArea);return g.jsx(ln,{present:e||s.hasThumb,children:g.jsx(v2,{ref:t,...n})})}),v2=C.forwardRef((r,t)=>{const{__scopeScrollArea:e,style:n,...s}=r,i=Wn(ql,e),o=Ub(ql,e),{onThumbPositionChange:c}=o,u=Ne(t,m=>o.onThumbChange(m)),h=C.useRef(void 0),f=tu(()=>{h.current&&(h.current(),h.current=void 0)},100);return C.useEffect(()=>{const m=i.viewport;if(m){const y=()=>{if(f(),!h.current){const v=w2(m,c);h.current=v,c()}};return c(),m.addEventListener("scroll",y),()=>m.removeEventListener("scroll",y)}},[i.viewport,f,c]),g.jsx(De.div,{"data-state":o.hasThumb?"visible":"hidden",...s,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:ge(r.onPointerDownCapture,m=>{const v=m.target.getBoundingClientRect(),x=m.clientX-v.left,S=m.clientY-v.top;o.onThumbPointerDown({x,y:S})}),onPointerUp:ge(r.onPointerUp,o.onThumbPointerUp)})});Vb.displayName=ql;var np="ScrollAreaCorner",Gb=C.forwardRef((r,t)=>{const e=Wn(np,r.__scopeScrollArea),n=!!(e.scrollbarX&&e.scrollbarY);return e.type!=="scroll"&&n?g.jsx(b2,{...r,ref:t}):null});Gb.displayName=np;var b2=C.forwardRef((r,t)=>{const{__scopeScrollArea:e,...n}=r,s=Wn(np,e),[i,o]=C.useState(0),[c,u]=C.useState(0),h=!!(i&&c);return xo(s.scrollbarX,()=>{const f=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(f),u(f)}),xo(s.scrollbarY,()=>{const f=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(f),o(f)}),h?g.jsx(De.div,{...n,ref:t,style:{width:i,height:c,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function $l(r){return r?parseInt(r,10):0}function Qb(r,t){const e=r/t;return isNaN(e)?0:e}function eu(r){const t=Qb(r.viewport,r.content),e=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-e)*t;return Math.max(n,18)}function x2(r,t,e,n="ltr"){const s=eu(e),i=s/2,o=t||i,c=s-o,u=e.scrollbar.paddingStart+o,h=e.scrollbar.size-e.scrollbar.paddingEnd-c,f=e.content-e.viewport,m=n==="ltr"?[0,f]:[f*-1,0];return Kb([u,h],m)(r)}function hv(r,t,e="ltr"){const n=eu(t),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=t.scrollbar.size-s,o=t.content-t.viewport,c=i-n,u=e==="ltr"?[0,o]:[o*-1,0],h=Nr(r,u);return Kb([0,o],[0,c])(h)}function Kb(r,t){return e=>{if(r[0]===r[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(r[1]-r[0]);return t[0]+n*(e-r[0])}}function Yb(r,t){return r>0&&r<t}var w2=(r,t=()=>{})=>{let e={left:r.scrollLeft,top:r.scrollTop},n=0;return(function s(){const i={left:r.scrollLeft,top:r.scrollTop},o=e.left!==i.left,c=e.top!==i.top;(o||c)&&t(),e=i,n=window.requestAnimationFrame(s)})(),()=>window.cancelAnimationFrame(n)};function tu(r,t){const e=on(r),n=C.useRef(0);return C.useEffect(()=>()=>window.clearTimeout(n.current),[]),C.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(e,t)},[e,t])}function xo(r,t){const e=on(t);rn(()=>{let n=0;if(r){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(e)});return s.observe(r),()=>{window.cancelAnimationFrame(n),s.unobserve(r)}}},[r,e])}var Wb=Hb,C2=$b,S2=Gb;const an=C.forwardRef(({className:r,children:t,...e},n)=>g.jsxs(Wb,{ref:n,className:ke("relative overflow-hidden",r),scrollHideDelay:0,...e,children:[g.jsx(C2,{className:"h-full w-full rounded-[inherit]",children:t}),g.jsx(nu,{}),g.jsx(S2,{})]}));an.displayName=Wb.displayName;const nu=C.forwardRef(({className:r,orientation:t="vertical",...e},n)=>g.jsx(ep,{ref:n,orientation:t,className:ke("flex touch-none select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]","data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30","[&[data-state=hidden]]:opacity-0 [&[data-state=visible]]:opacity-100",r),style:{transition:"none !important",transitionDelay:"0ms !important",transitionDuration:"0ms !important"},...e,children:g.jsx(Vb,{className:"relative flex-1 rounded-full bg-accent/80 hover:bg-accent",style:{transition:"none !important"}})}));nu.displayName=ep.displayName;const Br=us(r=>({showMinimap:!0,setShowMinimap:t=>r({showMinimap:t}),toggleMinimap:()=>r(t=>({showMinimap:!t.showMinimap})),showHeatMapLegend:!0,setShowHeatMapLegend:t=>r({showHeatMapLegend:t}),toggleHeatMapLegend:()=>r(t=>({showHeatMapLegend:!t.showHeatMapLegend})),showRuler:!1,setShowRuler:t=>r({showRuler:t}),toggleRuler:()=>r(t=>({showRuler:!t.showRuler})),autoCenterOnSelect:!0,setAutoCenterOnSelect:t=>r({autoCenterOnSelect:t}),searchQuery:"",setSearchQuery:t=>r({searchQuery:t}),highlightedNodeId:null,setHighlightedNodeId:t=>r({highlightedNodeId:t})})),jr=[{id:"kafka",type:"kafka",label:"Apache Kafka",icon:"",color:"#000000",category:"messaging"},{id:"rabbitmq",type:"rabbitmq",label:"RabbitMQ",icon:"",color:"#FF6600",category:"messaging"},{id:"activemq",type:"activemq",label:"ActiveMQ",icon:"",color:"#A1005A",category:"messaging"},{id:"aws-sqs",type:"aws-sqs",label:"AWS SQS",icon:"",color:"#FF9900",category:"messaging"},{id:"azure-service-bus",type:"azure-service-bus",label:"Azure Service Bus",icon:"",color:"#0078D7",category:"messaging"},{id:"gcp-pubsub",type:"gcp-pubsub",label:"Google Pub/Sub",icon:"",color:"#4285F4",category:"messaging"},{id:"kong",type:"kong",label:"Kong Gateway",icon:"",color:"#003459",category:"integration"},{id:"apigee",type:"apigee",label:"Apigee",icon:"",color:"#F26522",category:"integration"},{id:"mulesoft",type:"mulesoft",label:"MuleSoft",icon:"",color:"#00A0DF",category:"integration"},{id:"graphql-gateway",type:"graphql-gateway",label:"GraphQL Gateway",icon:"",color:"#E10098",category:"integration"},{id:"bff-service",type:"bff-service",label:"BFF Service",icon:"",color:"#6C5CE7",category:"integration"},{id:"webhook-relay",type:"webhook-relay",label:"Webhook Relay",icon:"",color:"#1ABC9C",category:"integration"},{id:"postgres",type:"postgres",label:"PostgreSQL",icon:"",color:"#336791",category:"data"},{id:"mongodb",type:"mongodb",label:"MongoDB",icon:"",color:"#47A248",category:"data"},{id:"redis",type:"redis",label:"Redis",icon:"",color:"#DC382D",category:"data"},{id:"cassandra",type:"cassandra",label:"Apache Cassandra",icon:"",color:"#1287B1",category:"data"},{id:"clickhouse",type:"clickhouse",label:"ClickHouse",icon:"",color:"#FFCC00",category:"data"},{id:"snowflake",type:"snowflake",label:"Snowflake",icon:"",color:"#29B5E8",category:"data"},{id:"elasticsearch",type:"elasticsearch",label:"Elasticsearch",icon:"",color:"#00A79D",category:"data"},{id:"s3-datalake",type:"s3-datalake",label:"S3 Data Lake",icon:"",color:"#FF9900",category:"data"},{id:"prometheus",type:"prometheus",label:"Prometheus",icon:"",color:"#E6522C",category:"observability"},{id:"grafana",type:"grafana",label:"Grafana",icon:"",color:"#F56815",category:"observability"},{id:"loki",type:"loki",label:"Loki",icon:"",color:"#7CBA3C",category:"observability"},{id:"jaeger",type:"jaeger",label:"Jaeger",icon:"",color:"#65D6AD",category:"observability"},{id:"otel-collector",type:"otel-collector",label:"OpenTelemetry Collector",icon:"",color:"#6E56CF",category:"observability"},{id:"pagerduty",type:"pagerduty",label:"PagerDuty",icon:"",color:"#06AC38",category:"observability"},{id:"keycloak",type:"keycloak",label:"Keycloak",icon:"",color:"#5C6BC0",category:"security"},{id:"waf",type:"waf",label:"WAF / API Shield",icon:"",color:"#F44336",category:"security"},{id:"firewall",type:"firewall",label:"Firewall",icon:"",color:"#FF7043",category:"security"},{id:"secrets-vault",type:"secrets-vault",label:"Secrets Vault",icon:"",color:"#009688",category:"security"},{id:"ids-ips",type:"ids-ips",label:"IDS / IPS",icon:"",color:"#512DA8",category:"security"},{id:"jenkins",type:"jenkins",label:"Jenkins",icon:"",color:"#D24939",category:"devops"},{id:"gitlab-ci",type:"gitlab-ci",label:"GitLab CI",icon:"",color:"#FC6D26",category:"devops"},{id:"argo-cd",type:"argo-cd",label:"Argo CD",icon:"",color:"#EF7B45",category:"devops"},{id:"terraform",type:"terraform",label:"Terraform",icon:"",color:"#7B42BC",category:"devops"},{id:"ansible",type:"ansible",label:"Ansible",icon:"",color:"#000000",category:"devops"},{id:"harbor",type:"harbor",label:"Harbor Registry",icon:"",color:"#3BC1C4",category:"devops"},{id:"nginx",type:"nginx",label:"NGINX",icon:"",color:"#009639",category:"infrastructure"},{id:"docker",type:"docker",label:"Docker",icon:"",color:"#2496ED",category:"infrastructure"},{id:"kubernetes",type:"kubernetes",label:"Kubernetes",icon:"",color:"#326CE5",category:"infrastructure"},{id:"haproxy",type:"haproxy",label:"HAProxy",icon:"",color:"#009FDF",category:"infrastructure"},{id:"envoy",type:"envoy",label:"Envoy Proxy",icon:"",color:"#D63384",category:"infrastructure"},{id:"traefik",type:"traefik",label:"Traefik",icon:"",color:"#24A1DE",category:"infrastructure"},{id:"istio",type:"istio",label:"Istio Mesh",icon:"",color:"#466BB0",category:"edge"},{id:"service-mesh",type:"service-mesh",label:"Service Mesh",icon:"",color:"#5E81AC",category:"edge"},{id:"api-gateway",type:"api-gateway",label:"Cloud API Gateway",icon:"",color:"#FFB300",category:"edge"},{id:"vpn",type:"vpn",label:"VPN Concentrator",icon:"",color:"#2D9CDB",category:"edge"},{id:"cdn",type:"cdn",label:"CDN Edge",icon:"",color:"#FF5A5F",category:"edge"},{id:"rest",type:"rest",label:"REST API",icon:"",color:"#61DAFB",category:"api"},{id:"grpc",type:"grpc",label:"gRPC",icon:"",color:"#244C5A",category:"api"},{id:"graphql",type:"graphql",label:"GraphQL",icon:"",color:"#DE33A6",category:"api"},{id:"soap",type:"soap",label:"SOAP",icon:"",color:"#2196F3",category:"api"},{id:"websocket",type:"websocket",label:"WebSocket",icon:"",color:"#010101",category:"api"},{id:"webhook",type:"webhook",label:"Webhook Endpoint",icon:"",color:"#0FA3B1",category:"api"},{id:"spark",type:"spark",label:"Apache Spark",icon:"",color:"#E25A1C",category:"ml"},{id:"tensorflow-serving",type:"tensorflow-serving",label:"TensorFlow Serving",icon:"",color:"#FF6F00",category:"ml"},{id:"pytorch-serve",type:"pytorch-serve",label:"PyTorch Serve",icon:"",color:"#EE4C2C",category:"ml"},{id:"mlflow",type:"mlflow",label:"MLflow",icon:"",color:"#4285F4",category:"ml"},{id:"feature-store",type:"feature-store",label:"Feature Store",icon:"",color:"#8E44AD",category:"ml"},{id:"crm",type:"crm",label:"CRM System",icon:"",color:"#F39C12",category:"business"},{id:"erp",type:"erp",label:"ERP / SAP",icon:"",color:"#1B75BC",category:"business"},{id:"payment-gateway",type:"payment-gateway",label:"Payment Gateway",icon:"",color:"#4CAF50",category:"business"},{id:"bpmn-engine",type:"bpmn-engine",label:"BPMN Engine",icon:"",color:"#34495E",category:"business"},{id:"rpa-bot",type:"rpa-bot",label:"RPA Bot",icon:"",color:"#9B59B6",category:"business"}],Mr=[{id:"messaging",label:"Messaging & Event Bus",icon:""},{id:"integration",label:"Integration & API",icon:""},{id:"data",label:"Data & Storage",icon:""},{id:"observability",label:"Observability",icon:""},{id:"security",label:"Security & IAM",icon:""},{id:"devops",label:"DevOps & Platform",icon:""},{id:"infrastructure",label:"Runtime & Infra",icon:""},{id:"edge",label:"Edge & Networking",icon:""},{id:"api",label:"Protocols & APIs",icon:""},{id:"ml",label:"ML & Analytics",icon:""},{id:"business",label:"Business Systems",icon:""}];function M2(){const{nodes:r,selectNode:t,zoom:e,pan:n,setPan:s,setZoom:i}=Ee(),{searchQuery:o,setSearchQuery:c,highlightedNodeId:u,setHighlightedNodeId:h}=Br(),[f,m]=C.useState(!1),y=C.useRef(null);C.useEffect(()=>{const S=R=>{y.current&&!y.current.contains(R.target)&&m(!1)};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[]);const v=C.useMemo(()=>{if(!o.trim())return[];const S=o.toLowerCase();return r.filter(R=>{const M=jr.find(_=>_.type===R.type),T=R.data?.label||"",k=R.type||"",A=M?.category||"";return T.toLowerCase().includes(S)||k.toLowerCase().includes(S)||A.toLowerCase().includes(S)})},[r,o]),x=S=>{t(S),h(S);const R=r.find(M=>M.id===S);if(R&&f){const M=window.innerWidth/2,T=window.innerHeight/2,k=R.position.x+70,A=R.position.y+70,_=M-k*e,P=T-A*e;s({x:_,y:P}),e<.8&&i(1)}setTimeout(()=>h(null),2e3)};return g.jsxs("div",{className:"relative",ref:y,children:[g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),g.jsx(Tt,{type:"text",placeholder:"Search components...",value:o,onChange:S=>{c(S.target.value),m(!0)},onFocus:()=>m(!0),className:"pl-8 pr-8 w-64"}),o&&g.jsx(Te,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>{c(""),m(!1),h(null)},children:g.jsx(os,{className:"h-3 w-3"})})]}),f&&o&&g.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-card border border-border rounded-md shadow-lg z-50 max-h-80 overflow-hidden",children:v.length>0?g.jsx(an,{className:"max-h-80",children:g.jsx("div",{className:"p-1",children:v.map(S=>{const R=jr.find(T=>T.type===S.type),M=u===S.id;return g.jsxs("button",{onClick:()=>x(S.id),className:ke("w-full text-left px-3 py-2 rounded-sm hover:bg-accent transition-colors flex items-center justify-between",M&&"bg-accent"),children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:S.data?.label||S.type}),g.jsxs("div",{className:"text-xs text-muted-foreground truncate",children:[R?.category||"Unknown","  ",S.type]})]}),g.jsx(Xf,{className:"h-4 w-4 text-muted-foreground flex-shrink-0 ml-2"})]},S.id)})})}):g.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No components found"})})]})}function R2(r){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",t.appendChild(e),e.styleSheet?e.styleSheet.cssText=r:e.appendChild(document.createTextNode(r))}Array(12).fill(0);let wf=1;class E2{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;const{message:n,...s}=t,i=typeof t?.id=="number"||((e=t.id)==null?void 0:e.length)>0?t.id:wf++,o=this.toasts.find(u=>u.id===i),c=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(u=>u.id===i?(this.publish({...u,...t,id:i,title:n}),{...u,...t,id:i,dismissible:c,title:n}):u):this.addToast({title:n,...s,dismissible:c,id:i}),i},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(e=>e({id:t,dismiss:!0})))):this.toasts.forEach(e=>{this.subscribers.forEach(n=>n({id:e.id,dismiss:!0}))}),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let n;e.loading!==void 0&&(n=this.create({...e,promise:t,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));const s=Promise.resolve(t instanceof Function?t():t);let i=n!==void 0,o;const c=s.then(async h=>{if(o=["resolve",h],kt.isValidElement(h))i=!1,this.create({id:n,type:"default",message:h});else if(T2(h)&&!h.ok){i=!1;const m=typeof e.error=="function"?await e.error(`HTTP error! status: ${h.status}`):e.error,y=typeof e.description=="function"?await e.description(`HTTP error! status: ${h.status}`):e.description,x=typeof m=="object"&&!kt.isValidElement(m)?m:{message:m};this.create({id:n,type:"error",description:y,...x})}else if(h instanceof Error){i=!1;const m=typeof e.error=="function"?await e.error(h):e.error,y=typeof e.description=="function"?await e.description(h):e.description,x=typeof m=="object"&&!kt.isValidElement(m)?m:{message:m};this.create({id:n,type:"error",description:y,...x})}else if(e.success!==void 0){i=!1;const m=typeof e.success=="function"?await e.success(h):e.success,y=typeof e.description=="function"?await e.description(h):e.description,x=typeof m=="object"&&!kt.isValidElement(m)?m:{message:m};this.create({id:n,type:"success",description:y,...x})}}).catch(async h=>{if(o=["reject",h],e.error!==void 0){i=!1;const f=typeof e.error=="function"?await e.error(h):e.error,m=typeof e.description=="function"?await e.description(h):e.description,v=typeof f=="object"&&!kt.isValidElement(f)?f:{message:f};this.create({id:n,type:"error",description:m,...v})}}).finally(()=>{i&&(this.dismiss(n),n=void 0),e.finally==null||e.finally.call(e)}),u=()=>new Promise((h,f)=>c.then(()=>o[0]==="reject"?f(o[1]):h(o[1])).catch(f));return typeof n!="string"&&typeof n!="number"?{unwrap:u}:Object.assign(n,{unwrap:u})},this.custom=(t,e)=>{const n=e?.id||wf++;return this.create({jsx:t(n),id:n,...e}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Qn=new E2,k2=(r,t)=>{const e=t?.id||wf++;return Qn.addToast({title:r,...t,id:e}),e},T2=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",A2=k2,D2=()=>Qn.toasts,_2=()=>Qn.getActiveToasts(),Ye=Object.assign(A2,{success:Qn.success,info:Qn.info,warning:Qn.warning,error:Qn.error,custom:Qn.custom,message:Qn.message,promise:Qn.promise,dismiss:Qn.dismiss,loading:Qn.loading},{getHistory:D2,getToasts:_2});R2("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");var P2=$f[" useId ".trim().toString()]||(()=>{}),N2=0;function rs(r){const[t,e]=C.useState(P2());return rn(()=>{e(n=>n??String(N2++))},[r]),t?`radix-${t}`:""}var j2=$f[" useInsertionEffect ".trim().toString()]||rn;function Es({prop:r,defaultProp:t,onChange:e=()=>{},caller:n}){const[s,i,o]=L2({defaultProp:t,onChange:e}),c=r!==void 0,u=c?r:s;{const f=C.useRef(r!==void 0);C.useEffect(()=>{const m=f.current;m!==c&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=c},[c,n])}const h=C.useCallback(f=>{if(c){const m=z2(f)?f(r):f;m!==r&&o.current?.(m)}else i(f)},[c,r,i,o]);return[u,h]}function L2({defaultProp:r,onChange:t}){const[e,n]=C.useState(r),s=C.useRef(e),i=C.useRef(t);return j2(()=>{i.current=t},[t]),C.useEffect(()=>{s.current!==e&&(i.current?.(e),s.current=e)},[e,s]),[e,n,i]}function z2(r){return typeof r=="function"}function I2(r,t=globalThis?.document){const e=on(r);C.useEffect(()=>{const n=s=>{s.key==="Escape"&&e(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[e,t])}var O2="DismissableLayer",Cf="dismissableLayer.update",H2="dismissableLayer.pointerDownOutside",q2="dismissableLayer.focusOutside",fv,Xb=C.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ur=C.forwardRef((r,t)=>{const{disableOutsidePointerEvents:e=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:c,...u}=r,h=C.useContext(Xb),[f,m]=C.useState(null),y=f?.ownerDocument??globalThis?.document,[,v]=C.useState({}),x=Ne(t,z=>m(z)),S=Array.from(h.layers),[R]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),M=S.indexOf(R),T=f?S.indexOf(f):-1,k=h.layersWithOutsidePointerEventsDisabled.size>0,A=T>=M,_=U2(z=>{const q=z.target,Z=[...h.branches].some(se=>se.contains(q));!A||Z||(s?.(z),o?.(z),z.defaultPrevented||c?.())},y),P=F2(z=>{const q=z.target;[...h.branches].some(se=>se.contains(q))||(i?.(z),o?.(z),z.defaultPrevented||c?.())},y);return I2(z=>{T===h.layers.size-1&&(n?.(z),!z.defaultPrevented&&c&&(z.preventDefault(),c()))},y),C.useEffect(()=>{if(f)return e&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(fv=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(f)),h.layers.add(f),pv(),()=>{e&&h.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=fv)}},[f,y,e,h]),C.useEffect(()=>()=>{f&&(h.layers.delete(f),h.layersWithOutsidePointerEventsDisabled.delete(f),pv())},[f,h]),C.useEffect(()=>{const z=()=>v({});return document.addEventListener(Cf,z),()=>document.removeEventListener(Cf,z)},[]),g.jsx(De.div,{...u,ref:x,style:{pointerEvents:k?A?"auto":"none":void 0,...r.style},onFocusCapture:ge(r.onFocusCapture,P.onFocusCapture),onBlurCapture:ge(r.onBlurCapture,P.onBlurCapture),onPointerDownCapture:ge(r.onPointerDownCapture,_.onPointerDownCapture)})});Ur.displayName=O2;var $2="DismissableLayerBranch",B2=C.forwardRef((r,t)=>{const e=C.useContext(Xb),n=C.useRef(null),s=Ne(t,n);return C.useEffect(()=>{const i=n.current;if(i)return e.branches.add(i),()=>{e.branches.delete(i)}},[e.branches]),g.jsx(De.div,{...r,ref:s})});B2.displayName=$2;function U2(r,t=globalThis?.document){const e=on(r),n=C.useRef(!1),s=C.useRef(()=>{});return C.useEffect(()=>{const i=c=>{if(c.target&&!n.current){let u=function(){Jb(H2,e,h,{discrete:!0})};const h={originalEvent:c};c.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=u,t.addEventListener("click",s.current,{once:!0})):u()}else t.removeEventListener("click",s.current);n.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",i),t.removeEventListener("click",s.current)}},[t,e]),{onPointerDownCapture:()=>n.current=!0}}function F2(r,t=globalThis?.document){const e=on(r),n=C.useRef(!1);return C.useEffect(()=>{const s=i=>{i.target&&!n.current&&Jb(q2,e,{originalEvent:i},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,e]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function pv(){const r=new CustomEvent(Cf);document.dispatchEvent(r)}function Jb(r,t,e,{discrete:n}){const s=e.originalEvent.target,i=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:e});t&&s.addEventListener(r,t,{once:!0}),n?Ib(s,i):s.dispatchEvent(i)}var af="focusScope.autoFocusOnMount",of="focusScope.autoFocusOnUnmount",gv={bubbles:!1,cancelable:!0},V2="FocusScope",Fr=C.forwardRef((r,t)=>{const{loop:e=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=r,[c,u]=C.useState(null),h=on(s),f=on(i),m=C.useRef(null),y=Ne(t,S=>u(S)),v=C.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;C.useEffect(()=>{if(n){let S=function(k){if(v.paused||!c)return;const A=k.target;c.contains(A)?m.current=A:Ni(m.current,{select:!0})},R=function(k){if(v.paused||!c)return;const A=k.relatedTarget;A!==null&&(c.contains(A)||Ni(m.current,{select:!0}))},M=function(k){if(document.activeElement===document.body)for(const _ of k)_.removedNodes.length>0&&Ni(c)};document.addEventListener("focusin",S),document.addEventListener("focusout",R);const T=new MutationObserver(M);return c&&T.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",S),document.removeEventListener("focusout",R),T.disconnect()}}},[n,c,v.paused]),C.useEffect(()=>{if(c){yv.add(v);const S=document.activeElement;if(!c.contains(S)){const M=new CustomEvent(af,gv);c.addEventListener(af,h),c.dispatchEvent(M),M.defaultPrevented||(G2(X2(Zb(c)),{select:!0}),document.activeElement===S&&Ni(c))}return()=>{c.removeEventListener(af,h),setTimeout(()=>{const M=new CustomEvent(of,gv);c.addEventListener(of,f),c.dispatchEvent(M),M.defaultPrevented||Ni(S??document.body,{select:!0}),c.removeEventListener(of,f),yv.remove(v)},0)}}},[c,h,f,v]);const x=C.useCallback(S=>{if(!e&&!n||v.paused)return;const R=S.key==="Tab"&&!S.altKey&&!S.ctrlKey&&!S.metaKey,M=document.activeElement;if(R&&M){const T=S.currentTarget,[k,A]=Q2(T);k&&A?!S.shiftKey&&M===A?(S.preventDefault(),e&&Ni(k,{select:!0})):S.shiftKey&&M===k&&(S.preventDefault(),e&&Ni(A,{select:!0})):M===T&&S.preventDefault()}},[e,n,v.paused]);return g.jsx(De.div,{tabIndex:-1,...o,ref:y,onKeyDown:x})});Fr.displayName=V2;function G2(r,{select:t=!1}={}){const e=document.activeElement;for(const n of r)if(Ni(n,{select:t}),document.activeElement!==e)return}function Q2(r){const t=Zb(r),e=mv(t,r),n=mv(t.reverse(),r);return[e,n]}function Zb(r){const t=[],e=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();)t.push(e.currentNode);return t}function mv(r,t){for(const e of r)if(!K2(e,{upTo:t}))return e}function K2(r,{upTo:t}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(t!==void 0&&r===t)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function Y2(r){return r instanceof HTMLInputElement&&"select"in r}function Ni(r,{select:t=!1}={}){if(r&&r.focus){const e=document.activeElement;r.focus({preventScroll:!0}),r!==e&&Y2(r)&&t&&r.select()}}var yv=W2();function W2(){let r=[];return{add(t){const e=r[0];t!==e&&e?.pause(),r=vv(r,t),r.unshift(t)},remove(t){r=vv(r,t),r[0]?.resume()}}}function vv(r,t){const e=[...r],n=e.indexOf(t);return n!==-1&&e.splice(n,1),e}function X2(r){return r.filter(t=>t.tagName!=="A")}var J2="Portal",Vr=C.forwardRef((r,t)=>{const{container:e,...n}=r,[s,i]=C.useState(!1);rn(()=>i(!0),[]);const o=e||s&&globalThis?.document?.body;return o?vk.createPortal(g.jsx(De.div,{...n,ref:t}),o):null});Vr.displayName=J2;var rf=0;function su(){C.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??bv()),document.body.insertAdjacentElement("beforeend",r[1]??bv()),rf++,()=>{rf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),rf--}},[])}function bv(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var vs=function(){return vs=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},vs.apply(this,arguments)};function ex(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(e[n[s]]=r[n[s]]);return e}function Z2(r,t,e){if(e||arguments.length===2)for(var n=0,s=t.length,i;n<s;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return r.concat(i||Array.prototype.slice.call(t))}var Tl="right-scroll-bar-position",Al="width-before-scroll-bar",e_="with-scroll-bars-hidden",t_="--removed-body-scroll-bar-size";function cf(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function n_(r,t){var e=C.useState(function(){return{value:r,callback:t,facade:{get current(){return e.value},set current(n){var s=e.value;s!==n&&(e.value=n,e.callback(n,s))}}}})[0];return e.callback=t,e.facade}var s_=typeof window<"u"?C.useLayoutEffect:C.useEffect,xv=new WeakMap;function i_(r,t){var e=n_(null,function(n){return r.forEach(function(s){return cf(s,n)})});return s_(function(){var n=xv.get(e);if(n){var s=new Set(n),i=new Set(r),o=e.current;s.forEach(function(c){i.has(c)||cf(c,null)}),i.forEach(function(c){s.has(c)||cf(c,o)})}xv.set(e,r)},[r]),e}function a_(r){return r}function o_(r,t){t===void 0&&(t=a_);var e=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return e.length?e[e.length-1]:r},useMedium:function(i){var o=t(i,n);return e.push(o),function(){e=e.filter(function(c){return c!==o})}},assignSyncMedium:function(i){for(n=!0;e.length;){var o=e;e=[],o.forEach(i)}e={push:function(c){return i(c)},filter:function(){return e}}},assignMedium:function(i){n=!0;var o=[];if(e.length){var c=e;e=[],c.forEach(i),o=e}var u=function(){var f=o;o=[],f.forEach(i)},h=function(){return Promise.resolve().then(u)};h(),e={push:function(f){o.push(f),h()},filter:function(f){return o=o.filter(f),e}}}};return s}function r_(r){r===void 0&&(r={});var t=o_(null);return t.options=vs({async:!0,ssr:!1},r),t}var tx=function(r){var t=r.sideCar,e=ex(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return C.createElement(n,vs({},e))};tx.isSideCarExport=!0;function c_(r,t){return r.useMedium(t),tx}var nx=r_(),lf=function(){},iu=C.forwardRef(function(r,t){var e=C.useRef(null),n=C.useState({onScrollCapture:lf,onWheelCapture:lf,onTouchMoveCapture:lf}),s=n[0],i=n[1],o=r.forwardProps,c=r.children,u=r.className,h=r.removeScrollBar,f=r.enabled,m=r.shards,y=r.sideCar,v=r.noRelative,x=r.noIsolation,S=r.inert,R=r.allowPinchZoom,M=r.as,T=M===void 0?"div":M,k=r.gapMode,A=ex(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=y,P=i_([e,t]),z=vs(vs({},A),s);return C.createElement(C.Fragment,null,f&&C.createElement(_,{sideCar:nx,removeScrollBar:h,shards:m,noRelative:v,noIsolation:x,inert:S,setCallbacks:i,allowPinchZoom:!!R,lockRef:e,gapMode:k}),o?C.cloneElement(C.Children.only(c),vs(vs({},z),{ref:P})):C.createElement(T,vs({},z,{className:u,ref:P}),c))});iu.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};iu.classNames={fullWidth:Al,zeroRight:Tl};var l_=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function u_(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=l_();return t&&r.setAttribute("nonce",t),r}function d_(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function h_(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var f_=function(){var r=0,t=null;return{add:function(e){r==0&&(t=u_())&&(d_(t,e),h_(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},p_=function(){var r=f_();return function(t,e){C.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&e])}},sx=function(){var r=p_(),t=function(e){var n=e.styles,s=e.dynamic;return r(n,s),null};return t},g_={left:0,top:0,right:0,gap:0},uf=function(r){return parseInt(r||"",10)||0},m_=function(r){var t=window.getComputedStyle(document.body),e=t[r==="padding"?"paddingLeft":"marginLeft"],n=t[r==="padding"?"paddingTop":"marginTop"],s=t[r==="padding"?"paddingRight":"marginRight"];return[uf(e),uf(n),uf(s)]},y_=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return g_;var t=m_(r),e=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-e+t[2]-t[0])}},v_=sx(),yo="data-scroll-locked",b_=function(r,t,e,n){var s=r.left,i=r.top,o=r.right,c=r.gap;return e===void 0&&(e="margin"),`
  .`.concat(e_,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(c,"px ").concat(n,`;
  }
  body[`).concat(yo,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),e==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(n,`;
    `),e==="padding"&&"padding-right: ".concat(c,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Tl,` {
    right: `).concat(c,"px ").concat(n,`;
  }
  
  .`).concat(Al,` {
    margin-right: `).concat(c,"px ").concat(n,`;
  }
  
  .`).concat(Tl," .").concat(Tl,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Al," .").concat(Al,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(yo,`] {
    `).concat(t_,": ").concat(c,`px;
  }
`)},wv=function(){var r=parseInt(document.body.getAttribute(yo)||"0",10);return isFinite(r)?r:0},x_=function(){C.useEffect(function(){return document.body.setAttribute(yo,(wv()+1).toString()),function(){var r=wv()-1;r<=0?document.body.removeAttribute(yo):document.body.setAttribute(yo,r.toString())}},[])},w_=function(r){var t=r.noRelative,e=r.noImportant,n=r.gapMode,s=n===void 0?"margin":n;x_();var i=C.useMemo(function(){return y_(s)},[s]);return C.createElement(v_,{styles:b_(i,!t,s,e?"":"!important")})},Sf=!1;if(typeof window<"u")try{var ml=Object.defineProperty({},"passive",{get:function(){return Sf=!0,!0}});window.addEventListener("test",ml,ml),window.removeEventListener("test",ml,ml)}catch{Sf=!1}var ho=Sf?{passive:!1}:!1,C_=function(r){return r.tagName==="TEXTAREA"},ix=function(r,t){if(!(r instanceof Element))return!1;var e=window.getComputedStyle(r);return e[t]!=="hidden"&&!(e.overflowY===e.overflowX&&!C_(r)&&e[t]==="visible")},S_=function(r){return ix(r,"overflowY")},M_=function(r){return ix(r,"overflowX")},Cv=function(r,t){var e=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=ax(r,n);if(s){var i=ox(r,n),o=i[1],c=i[2];if(o>c)return!0}n=n.parentNode}while(n&&n!==e.body);return!1},R_=function(r){var t=r.scrollTop,e=r.scrollHeight,n=r.clientHeight;return[t,e,n]},E_=function(r){var t=r.scrollLeft,e=r.scrollWidth,n=r.clientWidth;return[t,e,n]},ax=function(r,t){return r==="v"?S_(t):M_(t)},ox=function(r,t){return r==="v"?R_(t):E_(t)},k_=function(r,t){return r==="h"&&t==="rtl"?-1:1},T_=function(r,t,e,n,s){var i=k_(r,window.getComputedStyle(t).direction),o=i*n,c=e.target,u=t.contains(c),h=!1,f=o>0,m=0,y=0;do{if(!c)break;var v=ox(r,c),x=v[0],S=v[1],R=v[2],M=S-R-i*x;(x||M)&&ax(r,c)&&(m+=M,y+=x);var T=c.parentNode;c=T&&T.nodeType===Node.DOCUMENT_FRAGMENT_NODE?T.host:T}while(!u&&c!==document.body||u&&(t.contains(c)||t===c));return(f&&Math.abs(m)<1||!f&&Math.abs(y)<1)&&(h=!0),h},yl=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Sv=function(r){return[r.deltaX,r.deltaY]},Mv=function(r){return r&&"current"in r?r.current:r},A_=function(r,t){return r[0]===t[0]&&r[1]===t[1]},D_=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},__=0,fo=[];function P_(r){var t=C.useRef([]),e=C.useRef([0,0]),n=C.useRef(),s=C.useState(__++)[0],i=C.useState(sx)[0],o=C.useRef(r);C.useEffect(function(){o.current=r},[r]),C.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(s));var S=Z2([r.lockRef.current],(r.shards||[]).map(Mv),!0).filter(Boolean);return S.forEach(function(R){return R.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),S.forEach(function(R){return R.classList.remove("allow-interactivity-".concat(s))})}}},[r.inert,r.lockRef.current,r.shards]);var c=C.useCallback(function(S,R){if("touches"in S&&S.touches.length===2||S.type==="wheel"&&S.ctrlKey)return!o.current.allowPinchZoom;var M=yl(S),T=e.current,k="deltaX"in S?S.deltaX:T[0]-M[0],A="deltaY"in S?S.deltaY:T[1]-M[1],_,P=S.target,z=Math.abs(k)>Math.abs(A)?"h":"v";if("touches"in S&&z==="h"&&P.type==="range")return!1;var q=Cv(z,P);if(!q)return!0;if(q?_=z:(_=z==="v"?"h":"v",q=Cv(z,P)),!q)return!1;if(!n.current&&"changedTouches"in S&&(k||A)&&(n.current=_),!_)return!0;var Z=n.current||_;return T_(Z,R,S,Z==="h"?k:A)},[]),u=C.useCallback(function(S){var R=S;if(!(!fo.length||fo[fo.length-1]!==i)){var M="deltaY"in R?Sv(R):yl(R),T=t.current.filter(function(_){return _.name===R.type&&(_.target===R.target||R.target===_.shadowParent)&&A_(_.delta,M)})[0];if(T&&T.should){R.cancelable&&R.preventDefault();return}if(!T){var k=(o.current.shards||[]).map(Mv).filter(Boolean).filter(function(_){return _.contains(R.target)}),A=k.length>0?c(R,k[0]):!o.current.noIsolation;A&&R.cancelable&&R.preventDefault()}}},[]),h=C.useCallback(function(S,R,M,T){var k={name:S,delta:R,target:M,should:T,shadowParent:N_(M)};t.current.push(k),setTimeout(function(){t.current=t.current.filter(function(A){return A!==k})},1)},[]),f=C.useCallback(function(S){e.current=yl(S),n.current=void 0},[]),m=C.useCallback(function(S){h(S.type,Sv(S),S.target,c(S,r.lockRef.current))},[]),y=C.useCallback(function(S){h(S.type,yl(S),S.target,c(S,r.lockRef.current))},[]);C.useEffect(function(){return fo.push(i),r.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:y}),document.addEventListener("wheel",u,ho),document.addEventListener("touchmove",u,ho),document.addEventListener("touchstart",f,ho),function(){fo=fo.filter(function(S){return S!==i}),document.removeEventListener("wheel",u,ho),document.removeEventListener("touchmove",u,ho),document.removeEventListener("touchstart",f,ho)}},[]);var v=r.removeScrollBar,x=r.inert;return C.createElement(C.Fragment,null,x?C.createElement(i,{styles:D_(s)}):null,v?C.createElement(w_,{noRelative:r.noRelative,gapMode:r.gapMode}):null)}function N_(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const j_=c_(nx,P_);var Gr=C.forwardRef(function(r,t){return C.createElement(iu,vs({},r,{ref:t,sideCar:j_}))});Gr.classNames=iu.classNames;var L_=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},po=new WeakMap,vl=new WeakMap,bl={},df=0,rx=function(r){return r&&(r.host||rx(r.parentNode))},z_=function(r,t){return t.map(function(e){if(r.contains(e))return e;var n=rx(e);return n&&r.contains(n)?n:(console.error("aria-hidden",e,"in not contained inside",r,". Doing nothing"),null)}).filter(function(e){return!!e})},I_=function(r,t,e,n){var s=z_(t,Array.isArray(r)?r:[r]);bl[e]||(bl[e]=new WeakMap);var i=bl[e],o=[],c=new Set,u=new Set(s),h=function(m){!m||c.has(m)||(c.add(m),h(m.parentNode))};s.forEach(h);var f=function(m){!m||u.has(m)||Array.prototype.forEach.call(m.children,function(y){if(c.has(y))f(y);else try{var v=y.getAttribute(n),x=v!==null&&v!=="false",S=(po.get(y)||0)+1,R=(i.get(y)||0)+1;po.set(y,S),i.set(y,R),o.push(y),S===1&&x&&vl.set(y,!0),R===1&&y.setAttribute(e,"true"),x||y.setAttribute(n,"true")}catch(M){console.error("aria-hidden: cannot operate on ",y,M)}})};return f(t),c.clear(),df++,function(){o.forEach(function(m){var y=po.get(m)-1,v=i.get(m)-1;po.set(m,y),i.set(m,v),y||(vl.has(m)||m.removeAttribute(n),vl.delete(m)),v||m.removeAttribute(e)}),df--,df||(po=new WeakMap,po=new WeakMap,vl=new WeakMap,bl={})}},au=function(r,t,e){e===void 0&&(e="data-aria-hidden");var n=Array.from(Array.isArray(r)?r:[r]),s=L_(r);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live], script"))),I_(n,s,e,"aria-hidden")):function(){return null}};function O_(r){const t=H_(r),e=C.forwardRef((n,s)=>{const{children:i,...o}=n,c=C.Children.toArray(i),u=c.find($_);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}function H_(r){const t=C.forwardRef((e,n)=>{const{children:s,...i}=e;if(C.isValidElement(s)){const o=U_(s),c=B_(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var q_=Symbol("radix.slottable");function $_(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===q_}function B_(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function U_(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var ou="Dialog",[cx,lx]=Cn(ou),[F_,ds]=cx(ou),ux=r=>{const{__scopeDialog:t,children:e,open:n,defaultOpen:s,onOpenChange:i,modal:o=!0}=r,c=C.useRef(null),u=C.useRef(null),[h,f]=Es({prop:n,defaultProp:s??!1,onChange:i,caller:ou});return g.jsx(F_,{scope:t,triggerRef:c,contentRef:u,contentId:rs(),titleId:rs(),descriptionId:rs(),open:h,onOpenChange:f,onOpenToggle:C.useCallback(()=>f(m=>!m),[f]),modal:o,children:e})};ux.displayName=ou;var dx="DialogTrigger",hx=C.forwardRef((r,t)=>{const{__scopeDialog:e,...n}=r,s=ds(dx,e),i=Ne(t,s.triggerRef);return g.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":ap(s.open),...n,ref:i,onClick:ge(r.onClick,s.onOpenToggle)})});hx.displayName=dx;var sp="DialogPortal",[V_,fx]=cx(sp,{forceMount:void 0}),px=r=>{const{__scopeDialog:t,forceMount:e,children:n,container:s}=r,i=ds(sp,t);return g.jsx(V_,{scope:t,forceMount:e,children:C.Children.map(n,o=>g.jsx(ln,{present:e||i.open,children:g.jsx(Vr,{asChild:!0,container:s,children:o})}))})};px.displayName=sp;var Bl="DialogOverlay",gx=C.forwardRef((r,t)=>{const e=fx(Bl,r.__scopeDialog),{forceMount:n=e.forceMount,...s}=r,i=ds(Bl,r.__scopeDialog);return i.modal?g.jsx(ln,{present:n||i.open,children:g.jsx(Q_,{...s,ref:t})}):null});gx.displayName=Bl;var G_=O_("DialogOverlay.RemoveScroll"),Q_=C.forwardRef((r,t)=>{const{__scopeDialog:e,...n}=r,s=ds(Bl,e);return g.jsx(Gr,{as:G_,allowPinchZoom:!0,shards:[s.contentRef],children:g.jsx(De.div,{"data-state":ap(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),ba="DialogContent",mx=C.forwardRef((r,t)=>{const e=fx(ba,r.__scopeDialog),{forceMount:n=e.forceMount,...s}=r,i=ds(ba,r.__scopeDialog);return g.jsx(ln,{present:n||i.open,children:i.modal?g.jsx(K_,{...s,ref:t}):g.jsx(Y_,{...s,ref:t})})});mx.displayName=ba;var K_=C.forwardRef((r,t)=>{const e=ds(ba,r.__scopeDialog),n=C.useRef(null),s=Ne(t,e.contentRef,n);return C.useEffect(()=>{const i=n.current;if(i)return au(i)},[]),g.jsx(yx,{...r,ref:s,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(r.onCloseAutoFocus,i=>{i.preventDefault(),e.triggerRef.current?.focus()}),onPointerDownOutside:ge(r.onPointerDownOutside,i=>{const o=i.detail.originalEvent,c=o.button===0&&o.ctrlKey===!0;(o.button===2||c)&&i.preventDefault()}),onFocusOutside:ge(r.onFocusOutside,i=>i.preventDefault())})}),Y_=C.forwardRef((r,t)=>{const e=ds(ba,r.__scopeDialog),n=C.useRef(!1),s=C.useRef(!1);return g.jsx(yx,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{r.onCloseAutoFocus?.(i),i.defaultPrevented||(n.current||e.triggerRef.current?.focus(),i.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:i=>{r.onInteractOutside?.(i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;e.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),yx=C.forwardRef((r,t)=>{const{__scopeDialog:e,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:i,...o}=r,c=ds(ba,e),u=C.useRef(null),h=Ne(t,u);return su(),g.jsxs(g.Fragment,{children:[g.jsx(Fr,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:i,children:g.jsx(Ur,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":ap(c.open),...o,ref:h,onDismiss:()=>c.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(X_,{titleId:c.titleId}),g.jsx(Z_,{contentRef:u,descriptionId:c.descriptionId})]})]})}),ip="DialogTitle",vx=C.forwardRef((r,t)=>{const{__scopeDialog:e,...n}=r,s=ds(ip,e);return g.jsx(De.h2,{id:s.titleId,...n,ref:t})});vx.displayName=ip;var bx="DialogDescription",xx=C.forwardRef((r,t)=>{const{__scopeDialog:e,...n}=r,s=ds(bx,e);return g.jsx(De.p,{id:s.descriptionId,...n,ref:t})});xx.displayName=bx;var wx="DialogClose",Cx=C.forwardRef((r,t)=>{const{__scopeDialog:e,...n}=r,s=ds(wx,e);return g.jsx(De.button,{type:"button",...n,ref:t,onClick:ge(r.onClick,()=>s.onOpenChange(!1))})});Cx.displayName=wx;function ap(r){return r?"open":"closed"}var Sx="DialogTitleWarning",[W_,Mx]=c2(Sx,{contentName:ba,titleName:ip,docsSlug:"dialog"}),X_=({titleId:r})=>{const t=Mx(Sx),e=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return C.useEffect(()=>{r&&(document.getElementById(r)||console.error(e))},[e,r]),null},J_="DialogDescriptionWarning",Z_=({contentRef:r,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Mx(J_).contentName}}.`;return C.useEffect(()=>{const s=r.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,r,t]),null},Rx=ux,Ex=hx,kx=px,op=gx,rp=mx,cp=vx,lp=xx,up=Cx,eP=Symbol("radix.slottable");function tP(r){const t=({children:e})=>g.jsx(g.Fragment,{children:e});return t.displayName=`${r}.Slottable`,t.__radixId=eP,t}var Tx="AlertDialog",[nP]=Cn(Tx,[lx]),ri=lx(),Ax=r=>{const{__scopeAlertDialog:t,...e}=r,n=ri(t);return g.jsx(Rx,{...n,...e,modal:!0})};Ax.displayName=Tx;var sP="AlertDialogTrigger",Dx=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...n}=r,s=ri(e);return g.jsx(Ex,{...s,...n,ref:t})});Dx.displayName=sP;var iP="AlertDialogPortal",_x=r=>{const{__scopeAlertDialog:t,...e}=r,n=ri(t);return g.jsx(kx,{...n,...e})};_x.displayName=iP;var aP="AlertDialogOverlay",Px=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...n}=r,s=ri(e);return g.jsx(op,{...s,...n,ref:t})});Px.displayName=aP;var vo="AlertDialogContent",[oP,rP]=nP(vo),cP=tP("AlertDialogContent"),Nx=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,children:n,...s}=r,i=ri(e),o=C.useRef(null),c=Ne(t,o),u=C.useRef(null);return g.jsx(W_,{contentName:vo,titleName:jx,docsSlug:"alert-dialog",children:g.jsx(oP,{scope:e,cancelRef:u,children:g.jsxs(rp,{role:"alertdialog",...i,...s,ref:c,onOpenAutoFocus:ge(s.onOpenAutoFocus,h=>{h.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[g.jsx(cP,{children:n}),g.jsx(uP,{contentRef:o})]})})})});Nx.displayName=vo;var jx="AlertDialogTitle",Lx=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...n}=r,s=ri(e);return g.jsx(cp,{...s,...n,ref:t})});Lx.displayName=jx;var zx="AlertDialogDescription",Ix=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...n}=r,s=ri(e);return g.jsx(lp,{...s,...n,ref:t})});Ix.displayName=zx;var lP="AlertDialogAction",Ox=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...n}=r,s=ri(e);return g.jsx(up,{...s,...n,ref:t})});Ox.displayName=lP;var Hx="AlertDialogCancel",qx=C.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...n}=r,{cancelRef:s}=rP(Hx,e),i=ri(e),o=Ne(t,s);return g.jsx(up,{...i,...n,ref:o})});qx.displayName=Hx;var uP=({contentRef:r})=>{const t=`\`${vo}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${vo}\` by passing a \`${zx}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${vo}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return C.useEffect(()=>{document.getElementById(r.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,r]),null},dP=Ax,hP=Dx,fP=_x,$x=Px,Bx=Nx,Ux=Ox,Fx=qx,Vx=Lx,Gx=Ix;const Qx=dP,d3=hP,pP=fP,Kx=C.forwardRef(({className:r,...t},e)=>g.jsx($x,{className:ke("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:e}));Kx.displayName=$x.displayName;const dp=C.forwardRef(({className:r,...t},e)=>g.jsxs(pP,{children:[g.jsx(Kx,{}),g.jsx(Bx,{ref:e,className:ke("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t})]}));dp.displayName=Bx.displayName;const Yx=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col space-y-2 text-center sm:text-left",r),...t});Yx.displayName="AlertDialogHeader";const Wx=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});Wx.displayName="AlertDialogFooter";const hp=C.forwardRef(({className:r,...t},e)=>g.jsx(Vx,{ref:e,className:ke("text-lg font-semibold",r),...t}));hp.displayName=Vx.displayName;const fp=C.forwardRef(({className:r,...t},e)=>g.jsx(Gx,{ref:e,className:ke("text-sm text-muted-foreground",r),...t}));fp.displayName=Gx.displayName;const pp=C.forwardRef(({className:r,...t},e)=>g.jsx(Ux,{ref:e,className:ke(Gf(),r),...t}));pp.displayName=Ux.displayName;const gp=C.forwardRef(({className:r,...t},e)=>g.jsx(Fx,{ref:e,className:ke(Gf({variant:"outline"}),"mt-2 sm:mt-0",r),...t}));gp.displayName=Fx.displayName;const mp=Rx,h3=Ex,gP=kx,Xx=C.forwardRef(({className:r,...t},e)=>g.jsx(op,{ref:e,className:ke("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));Xx.displayName=op.displayName;const ru=C.forwardRef(({className:r,children:t,...e},n)=>g.jsxs(gP,{children:[g.jsx(Xx,{}),g.jsxs(rp,{ref:n,className:ke("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...e,children:[t,g.jsxs(up,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[g.jsx(os,{className:"h-4 w-4"}),g.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ru.displayName=rp.displayName;const cu=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});cu.displayName="DialogHeader";const lu=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});lu.displayName="DialogFooter";const uu=C.forwardRef(({className:r,...t},e)=>g.jsx(cp,{ref:e,className:ke("text-lg font-semibold leading-none tracking-tight",r),...t}));uu.displayName=cp.displayName;const du=C.forwardRef(({className:r,...t},e)=>g.jsx(lp,{ref:e,className:ke("text-sm text-muted-foreground",r),...t}));du.displayName=lp.displayName;var mP=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],yP=mP.reduce((r,t)=>{const e=Uf(`Primitive.${t}`),n=C.forwardRef((s,i)=>{const{asChild:o,...c}=s,u=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(u,{...c,ref:i})});return n.displayName=`Primitive.${t}`,{...r,[t]:n}},{}),vP="Label",Jx=C.forwardRef((r,t)=>g.jsx(yP.label,{...r,ref:t,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(r.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));Jx.displayName=vP;var Zx=Jx;const bP=Ff("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),it=C.forwardRef(({className:r,...t},e)=>g.jsx(Zx,{ref:e,className:ke(bP(),r),...t}));it.displayName=Zx.displayName;function yp({open:r,initialName:t="",onConfirm:e,onCancel:n}){const[s,i]=C.useState(t);C.useEffect(()=>{r&&i(t)},[r,t]);const o=()=>{s.trim()&&e(s.trim())};return g.jsx(mp,{open:r,onOpenChange:c=>!c&&n(),children:g.jsxs(ru,{children:[g.jsxs(cu,{children:[g.jsx(uu,{children:t?"Rename Group":"Create Group"}),g.jsx(du,{children:t?"Enter a new name for the group":"Enter a name for the new group"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(it,{htmlFor:"group-name",children:"Group Name"}),g.jsx(Tt,{id:"group-name",value:s,onChange:c=>i(c.target.value),onKeyDown:c=>{c.key==="Enter"&&o()},className:"mt-2",autoFocus:!0})]}),g.jsxs(lu,{children:[g.jsx(Te,{variant:"outline",onClick:n,children:"Cancel"}),g.jsx(Te,{onClick:o,disabled:!s.trim(),children:t?"Save":"Create"})]})]})})}function xP(){const{zoom:r,setZoom:t,diagramName:e,setDiagramName:n,saveDiagram:s,loadDiagramState:i,undo:o,redo:c,selectedNodeId:u,createGroupFromSelection:h,autoGroupByConnections:f,nodes:m,pan:y,setPan:v,viewportWidth:x,viewportHeight:S}=Ee(),{canUndo:R,canRedo:M}=Ar(),T=C.useRef(null),[k,A]=C.useState(!1),[_,P]=C.useState(e),[z,q]=C.useState(!1),{showMinimap:Z,toggleMinimap:se,showHeatMapLegend:ce,toggleHeatMapLegend:J,showRuler:te,toggleRuler:le}=Br(),ue=()=>t(Math.min(r+.1,2)),L=()=>t(r-.1),N=()=>{const ae=m;if(!ae.length){t(1),v({x:0,y:0});return}const B=100,Q=ae.map(Qt=>Qt.position.x),pe=ae.map(Qt=>Qt.position.y),me=ae.map(Qt=>Qt.position.x+140),ye=ae.map(Qt=>Qt.position.y+140),ve=Math.min(...Q)-B,je=Math.min(...pe)-B,Be=Math.max(...me)+B,at=Math.max(...ye)+B,Je=Be-ve,Nt=at-je,de=x||window.innerWidth,$e=S||window.innerHeight-56,Ue=de/Je,bt=$e/Nt;let mt=Math.min(Ue,bt);mt=Math.min(Math.max(mt,.2),2.5);const $t=ve+Je/2,Ze=je+Nt/2,jt=de/2,xt=$e/2,yt=jt-$t*mt,Xt=xt-Ze*mt;t(mt),v({x:yt,y:Xt})},O=()=>{s(),Ye.success("Diagram saved to browser storage")},W=()=>{const ae=`${e.replace(/\s+/g,"_")}_${Date.now()}.json`;QT(Ee.getState(),ae),Ye.success("Diagram exported as JSON")},fe=()=>{T.current?.click()},j=async ae=>{const B=ae.target.files?.[0];if(B){try{const Q=await KT(B);if(!Q){Ye.error("Failed to import diagram: Invalid file format");return}i({nodes:Q.nodes||[],connections:Q.connections||[],groups:Q.groups||[],zoom:Q.zoom||1,pan:Q.pan||{x:0,y:0}}),n(Q.name),Ye.success(`Diagram "${Q.name}" imported successfully`)}catch(Q){Ye.error("Failed to import diagram"),ii("Failed to import diagram",Q instanceof Error?Q:new Error(String(Q)))}T.current&&(T.current.value="")}},F=()=>{_.trim()&&(n(_.trim()),Ye.success("Diagram renamed")),A(!1)},Y=()=>{const{nodes:ae}=Ee.getState();if(ae.filter(Q=>Q.selected||Q.id===u).length===0){Ye.error("Select at least one component to create a group");return}q(!0)},ie=ae=>{h(ae),Ye.success(`Group "${ae}" created`),q(!1)},U=()=>{f(),Ye.success("Groups created automatically from connections")};return g.jsxs(g.Fragment,{children:[g.jsx(yp,{open:z,onConfirm:ie,onCancel:()=>q(!1)}),g.jsxs("div",{className:"h-14 bg-toolbar-bg border-b border-border flex items-center justify-between px-4",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("button",{onClick:()=>A(!0),className:"text-lg font-semibold text-foreground hover:text-primary transition-colors cursor-pointer",title:"Click to rename diagram",children:[g.jsx("span",{className:"text-primary",children:"Archi"}),"Phoenix",g.jsxs("span",{className:"text-xs text-secondary-foreground ml-2",children:[" ",e]})]}),g.jsx(xn,{orientation:"vertical",className:"h-6 mx-2"}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:o,disabled:!R,title:"Undo (Ctrl/Cmd+Z)",children:g.jsx(BD,{className:"h-4 w-4"})}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:c,disabled:!M,title:"Redo (Ctrl/Cmd+Shift+Z or Ctrl/Cmd+Y)",children:g.jsx(xD,{className:"h-4 w-4"})})]}),g.jsx(xn,{orientation:"vertical",className:"h-6 mx-2"}),g.jsx(M2,{})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 rounded-md p-1",children:[g.jsx(Te,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ue,title:"Zoom In",children:g.jsx(KD,{className:"h-4 w-4"})}),g.jsxs("span",{className:"text-sm font-mono px-2 min-w-[60px] text-center",children:[Math.round(r*100),"%"]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:L,title:"Zoom Out",children:g.jsx(WD,{className:"h-4 w-4"})}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:N,title:"Fit to View",children:g.jsx(lD,{className:"h-4 w-4"})})]}),g.jsx(xn,{orientation:"vertical",className:"h-6"}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:O,title:"Save diagram to browser storage (auto-saves on changes)",children:g.jsx(kD,{className:"h-4 w-4"})}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:W,title:"Export diagram as JSON file",children:g.jsx(KA,{className:"h-4 w-4"})}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:fe,title:"Import diagram from JSON file",children:g.jsx(FD,{className:"h-4 w-4"})}),g.jsx(xn,{orientation:"vertical",className:"h-6"}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Create group from selection",onClick:Y,disabled:!u,children:g.jsx(Nb,{className:"h-4 w-4"})}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Auto-group by connections",onClick:U,children:g.jsx(ND,{className:"h-4 w-4"})}),g.jsx(xn,{orientation:"vertical",className:"h-6"}),g.jsx(XD,{}),g.jsx(Te,{variant:Z?"default":"ghost",size:"icon",className:"h-9 w-9",title:Z?"Hide minimap":"Show minimap",onClick:se,children:g.jsx(rD,{className:"h-4 w-4"})}),g.jsx(Te,{variant:ce?"default":"ghost",size:"icon",className:"h-9 w-9",title:ce?"Hide heat map legend":"Show heat map legend",onClick:J,children:g.jsx(ya,{className:"h-4 w-4"})}),g.jsx(Te,{variant:te?"default":"ghost",size:"icon",className:"h-9 w-9",title:te?"Hide ruler":"Show ruler",onClick:le,children:g.jsx(RD,{className:"h-4 w-4"})}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Settings",children:g.jsx(_D,{className:"h-4 w-4"})})]})]}),g.jsx("input",{ref:T,type:"file",accept:".json",onChange:j,className:"hidden","aria-label":"Import diagram from file"}),g.jsx(Qx,{open:k,onOpenChange:A,children:g.jsxs(dp,{children:[g.jsx(hp,{children:"Rename Diagram"}),g.jsx(fp,{children:"Enter a new name for your diagram"}),g.jsx("div",{className:"py-4",children:g.jsx(Tt,{value:_,onChange:ae=>P(ae.target.value),placeholder:"Diagram name",onKeyDown:ae=>{ae.key==="Enter"&&F()},autoFocus:!0})}),g.jsxs("div",{className:"flex gap-2 justify-end",children:[g.jsx(gp,{children:"Cancel"}),g.jsx(pp,{onClick:F,children:"Save"})]})]})})]})}function Rv(r){const t=wP(r),e=C.forwardRef((n,s)=>{const{children:i,...o}=n,c=C.Children.toArray(i),u=c.find(SP);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}function wP(r){const t=C.forwardRef((e,n)=>{const{children:s,...i}=e;if(C.isValidElement(s)){const o=RP(s),c=MP(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var CP=Symbol("radix.slottable");function SP(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===CP}function MP(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function RP(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function hu(r){const t=r+"CollectionProvider",[e,n]=Cn(t),[s,i]=e(t,{collectionRef:{current:null},itemMap:new Map}),o=S=>{const{scope:R,children:M}=S,T=kt.useRef(null),k=kt.useRef(new Map).current;return g.jsx(s,{scope:R,itemMap:k,collectionRef:T,children:M})};o.displayName=t;const c=r+"CollectionSlot",u=Rv(c),h=kt.forwardRef((S,R)=>{const{scope:M,children:T}=S,k=i(c,M),A=Ne(R,k.collectionRef);return g.jsx(u,{ref:A,children:T})});h.displayName=c;const f=r+"CollectionItemSlot",m="data-radix-collection-item",y=Rv(f),v=kt.forwardRef((S,R)=>{const{scope:M,children:T,...k}=S,A=kt.useRef(null),_=Ne(R,A),P=i(f,M);return kt.useEffect(()=>(P.itemMap.set(A,{ref:A,...k}),()=>void P.itemMap.delete(A))),g.jsx(y,{[m]:"",ref:_,children:T})});v.displayName=f;function x(S){const R=i(r+"CollectionConsumer",S);return kt.useCallback(()=>{const T=R.collectionRef.current;if(!T)return[];const k=Array.from(T.querySelectorAll(`[${m}]`));return Array.from(R.itemMap.values()).sort((P,z)=>k.indexOf(P.ref.current)-k.indexOf(z.ref.current))},[R.collectionRef,R.itemMap])}return[{Provider:o,Slot:h,ItemSlot:v},x,n]}var hf="rovingFocusGroup.onEntryFocus",EP={bubbles:!1,cancelable:!0},Qr="RovingFocusGroup",[Mf,ew,kP]=hu(Qr),[TP,fu]=Cn(Qr,[kP]),[AP,DP]=TP(Qr),tw=C.forwardRef((r,t)=>g.jsx(Mf.Provider,{scope:r.__scopeRovingFocusGroup,children:g.jsx(Mf.Slot,{scope:r.__scopeRovingFocusGroup,children:g.jsx(_P,{...r,ref:t})})}));tw.displayName=Qr;var _P=C.forwardRef((r,t)=>{const{__scopeRovingFocusGroup:e,orientation:n,loop:s=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:u,onEntryFocus:h,preventScrollOnEntryFocus:f=!1,...m}=r,y=C.useRef(null),v=Ne(t,y),x=Eo(i),[S,R]=Es({prop:o,defaultProp:c??null,onChange:u,caller:Qr}),[M,T]=C.useState(!1),k=on(h),A=ew(e),_=C.useRef(!1),[P,z]=C.useState(0);return C.useEffect(()=>{const q=y.current;if(q)return q.addEventListener(hf,k),()=>q.removeEventListener(hf,k)},[k]),g.jsx(AP,{scope:e,orientation:n,dir:x,loop:s,currentTabStopId:S,onItemFocus:C.useCallback(q=>R(q),[R]),onItemShiftTab:C.useCallback(()=>T(!0),[]),onFocusableItemAdd:C.useCallback(()=>z(q=>q+1),[]),onFocusableItemRemove:C.useCallback(()=>z(q=>q-1),[]),children:g.jsx(De.div,{tabIndex:M||P===0?-1:0,"data-orientation":n,...m,ref:v,style:{outline:"none",...r.style},onMouseDown:ge(r.onMouseDown,()=>{_.current=!0}),onFocus:ge(r.onFocus,q=>{const Z=!_.current;if(q.target===q.currentTarget&&Z&&!M){const se=new CustomEvent(hf,EP);if(q.currentTarget.dispatchEvent(se),!se.defaultPrevented){const ce=A().filter(L=>L.focusable),J=ce.find(L=>L.active),te=ce.find(L=>L.id===S),ue=[J,te,...ce].filter(Boolean).map(L=>L.ref.current);iw(ue,f)}}_.current=!1}),onBlur:ge(r.onBlur,()=>T(!1))})})}),nw="RovingFocusGroupItem",sw=C.forwardRef((r,t)=>{const{__scopeRovingFocusGroup:e,focusable:n=!0,active:s=!1,tabStopId:i,children:o,...c}=r,u=rs(),h=i||u,f=DP(nw,e),m=f.currentTabStopId===h,y=ew(e),{onFocusableItemAdd:v,onFocusableItemRemove:x,currentTabStopId:S}=f;return C.useEffect(()=>{if(n)return v(),()=>x()},[n,v,x]),g.jsx(Mf.ItemSlot,{scope:e,id:h,focusable:n,active:s,children:g.jsx(De.span,{tabIndex:m?0:-1,"data-orientation":f.orientation,...c,ref:t,onMouseDown:ge(r.onMouseDown,R=>{n?f.onItemFocus(h):R.preventDefault()}),onFocus:ge(r.onFocus,()=>f.onItemFocus(h)),onKeyDown:ge(r.onKeyDown,R=>{if(R.key==="Tab"&&R.shiftKey){f.onItemShiftTab();return}if(R.target!==R.currentTarget)return;const M=jP(R,f.orientation,f.dir);if(M!==void 0){if(R.metaKey||R.ctrlKey||R.altKey||R.shiftKey)return;R.preventDefault();let k=y().filter(A=>A.focusable).map(A=>A.ref.current);if(M==="last")k.reverse();else if(M==="prev"||M==="next"){M==="prev"&&k.reverse();const A=k.indexOf(R.currentTarget);k=f.loop?LP(k,A+1):k.slice(A+1)}setTimeout(()=>iw(k))}}),children:typeof o=="function"?o({isCurrentTabStop:m,hasTabStop:S!=null}):o})})});sw.displayName=nw;var PP={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function NP(r,t){return t!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function jP(r,t,e){const n=NP(r.key,e);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return PP[n]}function iw(r,t=!1){const e=document.activeElement;for(const n of r)if(n===e||(n.focus({preventScroll:t}),document.activeElement!==e))return}function LP(r,t){return r.map((e,n)=>r[(t+n)%r.length])}var aw=tw,ow=sw,pu="Tabs",[zP]=Cn(pu,[fu]),rw=fu(),[IP,vp]=zP(pu),cw=C.forwardRef((r,t)=>{const{__scopeTabs:e,value:n,onValueChange:s,defaultValue:i,orientation:o="horizontal",dir:c,activationMode:u="automatic",...h}=r,f=Eo(c),[m,y]=Es({prop:n,onChange:s,defaultProp:i??"",caller:pu});return g.jsx(IP,{scope:e,baseId:rs(),value:m,onValueChange:y,orientation:o,dir:f,activationMode:u,children:g.jsx(De.div,{dir:f,"data-orientation":o,...h,ref:t})})});cw.displayName=pu;var lw="TabsList",uw=C.forwardRef((r,t)=>{const{__scopeTabs:e,loop:n=!0,...s}=r,i=vp(lw,e),o=rw(e);return g.jsx(aw,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:n,children:g.jsx(De.div,{role:"tablist","aria-orientation":i.orientation,...s,ref:t})})});uw.displayName=lw;var dw="TabsTrigger",hw=C.forwardRef((r,t)=>{const{__scopeTabs:e,value:n,disabled:s=!1,...i}=r,o=vp(dw,e),c=rw(e),u=gw(o.baseId,n),h=mw(o.baseId,n),f=n===o.value;return g.jsx(ow,{asChild:!0,...c,focusable:!s,active:f,children:g.jsx(De.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":h,"data-state":f?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:u,...i,ref:t,onMouseDown:ge(r.onMouseDown,m=>{!s&&m.button===0&&m.ctrlKey===!1?o.onValueChange(n):m.preventDefault()}),onKeyDown:ge(r.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&o.onValueChange(n)}),onFocus:ge(r.onFocus,()=>{const m=o.activationMode!=="manual";!f&&!s&&m&&o.onValueChange(n)})})})});hw.displayName=dw;var fw="TabsContent",pw=C.forwardRef((r,t)=>{const{__scopeTabs:e,value:n,forceMount:s,children:i,...o}=r,c=vp(fw,e),u=gw(c.baseId,n),h=mw(c.baseId,n),f=n===c.value,m=C.useRef(f);return C.useEffect(()=>{const y=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(y)},[]),g.jsx(ln,{present:s||f,children:({present:y})=>g.jsx(De.div,{"data-state":f?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!y,id:h,tabIndex:0,...o,ref:t,style:{...r.style,animationDuration:m.current?"0s":void 0},children:y&&i})})});pw.displayName=fw;function gw(r,t){return`${r}-trigger-${t}`}function mw(r,t){return`${r}-content-${t}`}var OP=cw,yw=uw,vw=hw,bw=pw;const bp=OP,gu=C.forwardRef(({className:r,...t},e)=>g.jsx(yw,{ref:e,className:ke("inline-flex items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground","flex-wrap gap-1",r),...t}));gu.displayName=yw.displayName;const ss=C.forwardRef(({className:r,...t},e)=>g.jsx(vw,{ref:e,className:ke("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...t}));ss.displayName=vw.displayName;const ni=C.forwardRef(({className:r,...t},e)=>g.jsx(bw,{ref:e,className:ke("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));ni.displayName=bw.displayName;const HP=["top","right","bottom","left"],Ii=Math.min,Dn=Math.max,Ul=Math.round,xl=Math.floor,Cs=r=>({x:r,y:r}),qP={left:"right",right:"left",bottom:"top",top:"bottom"},$P={start:"end",end:"start"};function Rf(r,t,e){return Dn(r,Ii(t,e))}function ai(r,t){return typeof r=="function"?r(t):r}function oi(r){return r.split("-")[0]}function ko(r){return r.split("-")[1]}function xp(r){return r==="x"?"y":"x"}function wp(r){return r==="y"?"height":"width"}const BP=new Set(["top","bottom"]);function xs(r){return BP.has(oi(r))?"y":"x"}function Cp(r){return xp(xs(r))}function UP(r,t,e){e===void 0&&(e=!1);const n=ko(r),s=Cp(r),i=wp(s);let o=s==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(o=Fl(o)),[o,Fl(o)]}function FP(r){const t=Fl(r);return[Ef(r),t,Ef(t)]}function Ef(r){return r.replace(/start|end/g,t=>$P[t])}const Ev=["left","right"],kv=["right","left"],VP=["top","bottom"],GP=["bottom","top"];function QP(r,t,e){switch(r){case"top":case"bottom":return e?t?kv:Ev:t?Ev:kv;case"left":case"right":return t?VP:GP;default:return[]}}function KP(r,t,e,n){const s=ko(r);let i=QP(oi(r),e==="start",n);return s&&(i=i.map(o=>o+"-"+s),t&&(i=i.concat(i.map(Ef)))),i}function Fl(r){return r.replace(/left|right|bottom|top/g,t=>qP[t])}function YP(r){return{top:0,right:0,bottom:0,left:0,...r}}function xw(r){return typeof r!="number"?YP(r):{top:r,right:r,bottom:r,left:r}}function Vl(r){const{x:t,y:e,width:n,height:s}=r;return{width:n,height:s,top:e,left:t,right:t+n,bottom:e+s,x:t,y:e}}function Tv(r,t,e){let{reference:n,floating:s}=r;const i=xs(t),o=Cp(t),c=wp(o),u=oi(t),h=i==="y",f=n.x+n.width/2-s.width/2,m=n.y+n.height/2-s.height/2,y=n[c]/2-s[c]/2;let v;switch(u){case"top":v={x:f,y:n.y-s.height};break;case"bottom":v={x:f,y:n.y+n.height};break;case"right":v={x:n.x+n.width,y:m};break;case"left":v={x:n.x-s.width,y:m};break;default:v={x:n.x,y:n.y}}switch(ko(t)){case"start":v[o]-=y*(e&&h?-1:1);break;case"end":v[o]+=y*(e&&h?-1:1);break}return v}const WP=async(r,t,e)=>{const{placement:n="bottom",strategy:s="absolute",middleware:i=[],platform:o}=e,c=i.filter(Boolean),u=await(o.isRTL==null?void 0:o.isRTL(t));let h=await o.getElementRects({reference:r,floating:t,strategy:s}),{x:f,y:m}=Tv(h,n,u),y=n,v={},x=0;for(let S=0;S<c.length;S++){const{name:R,fn:M}=c[S],{x:T,y:k,data:A,reset:_}=await M({x:f,y:m,initialPlacement:n,placement:y,strategy:s,middlewareData:v,rects:h,platform:o,elements:{reference:r,floating:t}});f=T??f,m=k??m,v={...v,[R]:{...v[R],...A}},_&&x<=50&&(x++,typeof _=="object"&&(_.placement&&(y=_.placement),_.rects&&(h=_.rects===!0?await o.getElementRects({reference:r,floating:t,strategy:s}):_.rects),{x:f,y:m}=Tv(h,y,u)),S=-1)}return{x:f,y:m,placement:y,strategy:s,middlewareData:v}};async function Lr(r,t){var e;t===void 0&&(t={});const{x:n,y:s,platform:i,rects:o,elements:c,strategy:u}=r,{boundary:h="clippingAncestors",rootBoundary:f="viewport",elementContext:m="floating",altBoundary:y=!1,padding:v=0}=ai(t,r),x=xw(v),R=c[y?m==="floating"?"reference":"floating":m],M=Vl(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(R)))==null||e?R:R.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(c.floating)),boundary:h,rootBoundary:f,strategy:u})),T=m==="floating"?{x:n,y:s,width:o.floating.width,height:o.floating.height}:o.reference,k=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c.floating)),A=await(i.isElement==null?void 0:i.isElement(k))?await(i.getScale==null?void 0:i.getScale(k))||{x:1,y:1}:{x:1,y:1},_=Vl(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:T,offsetParent:k,strategy:u}):T);return{top:(M.top-_.top+x.top)/A.y,bottom:(_.bottom-M.bottom+x.bottom)/A.y,left:(M.left-_.left+x.left)/A.x,right:(_.right-M.right+x.right)/A.x}}const XP=r=>({name:"arrow",options:r,async fn(t){const{x:e,y:n,placement:s,rects:i,platform:o,elements:c,middlewareData:u}=t,{element:h,padding:f=0}=ai(r,t)||{};if(h==null)return{};const m=xw(f),y={x:e,y:n},v=Cp(s),x=wp(v),S=await o.getDimensions(h),R=v==="y",M=R?"top":"left",T=R?"bottom":"right",k=R?"clientHeight":"clientWidth",A=i.reference[x]+i.reference[v]-y[v]-i.floating[x],_=y[v]-i.reference[v],P=await(o.getOffsetParent==null?void 0:o.getOffsetParent(h));let z=P?P[k]:0;(!z||!await(o.isElement==null?void 0:o.isElement(P)))&&(z=c.floating[k]||i.floating[x]);const q=A/2-_/2,Z=z/2-S[x]/2-1,se=Ii(m[M],Z),ce=Ii(m[T],Z),J=se,te=z-S[x]-ce,le=z/2-S[x]/2+q,ue=Rf(J,le,te),L=!u.arrow&&ko(s)!=null&&le!==ue&&i.reference[x]/2-(le<J?se:ce)-S[x]/2<0,N=L?le<J?le-J:le-te:0;return{[v]:y[v]+N,data:{[v]:ue,centerOffset:le-ue-N,...L&&{alignmentOffset:N}},reset:L}}}),JP=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:s,middlewareData:i,rects:o,initialPlacement:c,platform:u,elements:h}=t,{mainAxis:f=!0,crossAxis:m=!0,fallbackPlacements:y,fallbackStrategy:v="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:S=!0,...R}=ai(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const M=oi(s),T=xs(c),k=oi(c)===c,A=await(u.isRTL==null?void 0:u.isRTL(h.floating)),_=y||(k||!S?[Fl(c)]:FP(c)),P=x!=="none";!y&&P&&_.push(...KP(c,S,x,A));const z=[c,..._],q=await Lr(t,R),Z=[];let se=((n=i.flip)==null?void 0:n.overflows)||[];if(f&&Z.push(q[M]),m){const le=UP(s,o,A);Z.push(q[le[0]],q[le[1]])}if(se=[...se,{placement:s,overflows:Z}],!Z.every(le=>le<=0)){var ce,J;const le=(((ce=i.flip)==null?void 0:ce.index)||0)+1,ue=z[le];if(ue&&(!(m==="alignment"?T!==xs(ue):!1)||se.every(O=>xs(O.placement)===T?O.overflows[0]>0:!0)))return{data:{index:le,overflows:se},reset:{placement:ue}};let L=(J=se.filter(N=>N.overflows[0]<=0).sort((N,O)=>N.overflows[1]-O.overflows[1])[0])==null?void 0:J.placement;if(!L)switch(v){case"bestFit":{var te;const N=(te=se.filter(O=>{if(P){const W=xs(O.placement);return W===T||W==="y"}return!0}).map(O=>[O.placement,O.overflows.filter(W=>W>0).reduce((W,fe)=>W+fe,0)]).sort((O,W)=>O[1]-W[1])[0])==null?void 0:te[0];N&&(L=N);break}case"initialPlacement":L=c;break}if(s!==L)return{reset:{placement:L}}}return{}}}};function Av(r,t){return{top:r.top-t.height,right:r.right-t.width,bottom:r.bottom-t.height,left:r.left-t.width}}function Dv(r){return HP.some(t=>r[t]>=0)}const ZP=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(t){const{rects:e}=t,{strategy:n="referenceHidden",...s}=ai(r,t);switch(n){case"referenceHidden":{const i=await Lr(t,{...s,elementContext:"reference"}),o=Av(i,e.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Dv(o)}}}case"escaped":{const i=await Lr(t,{...s,altBoundary:!0}),o=Av(i,e.floating);return{data:{escapedOffsets:o,escaped:Dv(o)}}}default:return{}}}}},ww=new Set(["left","top"]);async function eN(r,t){const{placement:e,platform:n,elements:s}=r,i=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=oi(e),c=ko(e),u=xs(e)==="y",h=ww.has(o)?-1:1,f=i&&u?-1:1,m=ai(t,r);let{mainAxis:y,crossAxis:v,alignmentAxis:x}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return c&&typeof x=="number"&&(v=c==="end"?x*-1:x),u?{x:v*f,y:y*h}:{x:y*h,y:v*f}}const tN=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:s,y:i,placement:o,middlewareData:c}=t,u=await eN(t,r);return o===((e=c.offset)==null?void 0:e.placement)&&(n=c.arrow)!=null&&n.alignmentOffset?{}:{x:s+u.x,y:i+u.y,data:{...u,placement:o}}}}},nN=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:s}=t,{mainAxis:i=!0,crossAxis:o=!1,limiter:c={fn:R=>{let{x:M,y:T}=R;return{x:M,y:T}}},...u}=ai(r,t),h={x:e,y:n},f=await Lr(t,u),m=xs(oi(s)),y=xp(m);let v=h[y],x=h[m];if(i){const R=y==="y"?"top":"left",M=y==="y"?"bottom":"right",T=v+f[R],k=v-f[M];v=Rf(T,v,k)}if(o){const R=m==="y"?"top":"left",M=m==="y"?"bottom":"right",T=x+f[R],k=x-f[M];x=Rf(T,x,k)}const S=c.fn({...t,[y]:v,[m]:x});return{...S,data:{x:S.x-e,y:S.y-n,enabled:{[y]:i,[m]:o}}}}}},sN=function(r){return r===void 0&&(r={}),{options:r,fn(t){const{x:e,y:n,placement:s,rects:i,middlewareData:o}=t,{offset:c=0,mainAxis:u=!0,crossAxis:h=!0}=ai(r,t),f={x:e,y:n},m=xs(s),y=xp(m);let v=f[y],x=f[m];const S=ai(c,t),R=typeof S=="number"?{mainAxis:S,crossAxis:0}:{mainAxis:0,crossAxis:0,...S};if(u){const k=y==="y"?"height":"width",A=i.reference[y]-i.floating[k]+R.mainAxis,_=i.reference[y]+i.reference[k]-R.mainAxis;v<A?v=A:v>_&&(v=_)}if(h){var M,T;const k=y==="y"?"width":"height",A=ww.has(oi(s)),_=i.reference[m]-i.floating[k]+(A&&((M=o.offset)==null?void 0:M[m])||0)+(A?0:R.crossAxis),P=i.reference[m]+i.reference[k]+(A?0:((T=o.offset)==null?void 0:T[m])||0)-(A?R.crossAxis:0);x<_?x=_:x>P&&(x=P)}return{[y]:v,[m]:x}}}},iN=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:s,rects:i,platform:o,elements:c}=t,{apply:u=()=>{},...h}=ai(r,t),f=await Lr(t,h),m=oi(s),y=ko(s),v=xs(s)==="y",{width:x,height:S}=i.floating;let R,M;m==="top"||m==="bottom"?(R=m,M=y===(await(o.isRTL==null?void 0:o.isRTL(c.floating))?"start":"end")?"left":"right"):(M=m,R=y==="end"?"top":"bottom");const T=S-f.top-f.bottom,k=x-f.left-f.right,A=Ii(S-f[R],T),_=Ii(x-f[M],k),P=!t.middlewareData.shift;let z=A,q=_;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(q=k),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(z=T),P&&!y){const se=Dn(f.left,0),ce=Dn(f.right,0),J=Dn(f.top,0),te=Dn(f.bottom,0);v?q=x-2*(se!==0||ce!==0?se+ce:Dn(f.left,f.right)):z=S-2*(J!==0||te!==0?J+te:Dn(f.top,f.bottom))}await u({...t,availableWidth:q,availableHeight:z});const Z=await o.getDimensions(c.floating);return x!==Z.width||S!==Z.height?{reset:{rects:!0}}:{}}}};function mu(){return typeof window<"u"}function To(r){return Cw(r)?(r.nodeName||"").toLowerCase():"#document"}function _n(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function Ds(r){var t;return(t=(Cw(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function Cw(r){return mu()?r instanceof Node||r instanceof _n(r).Node:!1}function cs(r){return mu()?r instanceof Element||r instanceof _n(r).Element:!1}function ks(r){return mu()?r instanceof HTMLElement||r instanceof _n(r).HTMLElement:!1}function _v(r){return!mu()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof _n(r).ShadowRoot}const aN=new Set(["inline","contents"]);function Kr(r){const{overflow:t,overflowX:e,overflowY:n,display:s}=ls(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!aN.has(s)}const oN=new Set(["table","td","th"]);function rN(r){return oN.has(To(r))}const cN=[":popover-open",":modal"];function yu(r){return cN.some(t=>{try{return r.matches(t)}catch{return!1}})}const lN=["transform","translate","scale","rotate","perspective"],uN=["transform","translate","scale","rotate","perspective","filter"],dN=["paint","layout","strict","content"];function Sp(r){const t=Mp(),e=cs(r)?ls(r):r;return lN.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||uN.some(n=>(e.willChange||"").includes(n))||dN.some(n=>(e.contain||"").includes(n))}function hN(r){let t=Oi(r);for(;ks(t)&&!wo(t);){if(Sp(t))return t;if(yu(t))return null;t=Oi(t)}return null}function Mp(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const fN=new Set(["html","body","#document"]);function wo(r){return fN.has(To(r))}function ls(r){return _n(r).getComputedStyle(r)}function vu(r){return cs(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Oi(r){if(To(r)==="html")return r;const t=r.assignedSlot||r.parentNode||_v(r)&&r.host||Ds(r);return _v(t)?t.host:t}function Sw(r){const t=Oi(r);return wo(t)?r.ownerDocument?r.ownerDocument.body:r.body:ks(t)&&Kr(t)?t:Sw(t)}function zr(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const s=Sw(r),i=s===((n=r.ownerDocument)==null?void 0:n.body),o=_n(s);if(i){const c=kf(o);return t.concat(o,o.visualViewport||[],Kr(s)?s:[],c&&e?zr(c):[])}return t.concat(s,zr(s,[],e))}function kf(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function Mw(r){const t=ls(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=ks(r),i=s?r.offsetWidth:e,o=s?r.offsetHeight:n,c=Ul(e)!==i||Ul(n)!==o;return c&&(e=i,n=o),{width:e,height:n,$:c}}function Rp(r){return cs(r)?r:r.contextElement}function bo(r){const t=Rp(r);if(!ks(t))return Cs(1);const e=t.getBoundingClientRect(),{width:n,height:s,$:i}=Mw(t);let o=(i?Ul(e.width):e.width)/n,c=(i?Ul(e.height):e.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!c||!Number.isFinite(c))&&(c=1),{x:o,y:c}}const pN=Cs(0);function Rw(r){const t=_n(r);return!Mp()||!t.visualViewport?pN:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function gN(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==_n(r)?!1:t}function xa(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const s=r.getBoundingClientRect(),i=Rp(r);let o=Cs(1);t&&(n?cs(n)&&(o=bo(n)):o=bo(r));const c=gN(i,e,n)?Rw(i):Cs(0);let u=(s.left+c.x)/o.x,h=(s.top+c.y)/o.y,f=s.width/o.x,m=s.height/o.y;if(i){const y=_n(i),v=n&&cs(n)?_n(n):n;let x=y,S=kf(x);for(;S&&n&&v!==x;){const R=bo(S),M=S.getBoundingClientRect(),T=ls(S),k=M.left+(S.clientLeft+parseFloat(T.paddingLeft))*R.x,A=M.top+(S.clientTop+parseFloat(T.paddingTop))*R.y;u*=R.x,h*=R.y,f*=R.x,m*=R.y,u+=k,h+=A,x=_n(S),S=kf(x)}}return Vl({width:f,height:m,x:u,y:h})}function bu(r,t){const e=vu(r).scrollLeft;return t?t.left+e:xa(Ds(r)).left+e}function Ew(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-bu(r,e),s=e.top+t.scrollTop;return{x:n,y:s}}function mN(r){let{elements:t,rect:e,offsetParent:n,strategy:s}=r;const i=s==="fixed",o=Ds(n),c=t?yu(t.floating):!1;if(n===o||c&&i)return e;let u={scrollLeft:0,scrollTop:0},h=Cs(1);const f=Cs(0),m=ks(n);if((m||!m&&!i)&&((To(n)!=="body"||Kr(o))&&(u=vu(n)),ks(n))){const v=xa(n);h=bo(n),f.x=v.x+n.clientLeft,f.y=v.y+n.clientTop}const y=o&&!m&&!i?Ew(o,u):Cs(0);return{width:e.width*h.x,height:e.height*h.y,x:e.x*h.x-u.scrollLeft*h.x+f.x+y.x,y:e.y*h.y-u.scrollTop*h.y+f.y+y.y}}function yN(r){return Array.from(r.getClientRects())}function vN(r){const t=Ds(r),e=vu(r),n=r.ownerDocument.body,s=Dn(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Dn(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let o=-e.scrollLeft+bu(r);const c=-e.scrollTop;return ls(n).direction==="rtl"&&(o+=Dn(t.clientWidth,n.clientWidth)-s),{width:s,height:i,x:o,y:c}}const Pv=25;function bN(r,t){const e=_n(r),n=Ds(r),s=e.visualViewport;let i=n.clientWidth,o=n.clientHeight,c=0,u=0;if(s){i=s.width,o=s.height;const f=Mp();(!f||f&&t==="fixed")&&(c=s.offsetLeft,u=s.offsetTop)}const h=bu(n);if(h<=0){const f=n.ownerDocument,m=f.body,y=getComputedStyle(m),v=f.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,x=Math.abs(n.clientWidth-m.clientWidth-v);x<=Pv&&(i-=x)}else h<=Pv&&(i+=h);return{width:i,height:o,x:c,y:u}}const xN=new Set(["absolute","fixed"]);function wN(r,t){const e=xa(r,!0,t==="fixed"),n=e.top+r.clientTop,s=e.left+r.clientLeft,i=ks(r)?bo(r):Cs(1),o=r.clientWidth*i.x,c=r.clientHeight*i.y,u=s*i.x,h=n*i.y;return{width:o,height:c,x:u,y:h}}function Nv(r,t,e){let n;if(t==="viewport")n=bN(r,e);else if(t==="document")n=vN(Ds(r));else if(cs(t))n=wN(t,e);else{const s=Rw(r);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return Vl(n)}function kw(r,t){const e=Oi(r);return e===t||!cs(e)||wo(e)?!1:ls(e).position==="fixed"||kw(e,t)}function CN(r,t){const e=t.get(r);if(e)return e;let n=zr(r,[],!1).filter(c=>cs(c)&&To(c)!=="body"),s=null;const i=ls(r).position==="fixed";let o=i?Oi(r):r;for(;cs(o)&&!wo(o);){const c=ls(o),u=Sp(o);!u&&c.position==="fixed"&&(s=null),(i?!u&&!s:!u&&c.position==="static"&&!!s&&xN.has(s.position)||Kr(o)&&!u&&kw(r,o))?n=n.filter(f=>f!==o):s=c,o=Oi(o)}return t.set(r,n),n}function SN(r){let{element:t,boundary:e,rootBoundary:n,strategy:s}=r;const o=[...e==="clippingAncestors"?yu(t)?[]:CN(t,this._c):[].concat(e),n],c=o[0],u=o.reduce((h,f)=>{const m=Nv(t,f,s);return h.top=Dn(m.top,h.top),h.right=Ii(m.right,h.right),h.bottom=Ii(m.bottom,h.bottom),h.left=Dn(m.left,h.left),h},Nv(t,c,s));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function MN(r){const{width:t,height:e}=Mw(r);return{width:t,height:e}}function RN(r,t,e){const n=ks(t),s=Ds(t),i=e==="fixed",o=xa(r,!0,i,t);let c={scrollLeft:0,scrollTop:0};const u=Cs(0);function h(){u.x=bu(s)}if(n||!n&&!i)if((To(t)!=="body"||Kr(s))&&(c=vu(t)),n){const v=xa(t,!0,i,t);u.x=v.x+t.clientLeft,u.y=v.y+t.clientTop}else s&&h();i&&!n&&s&&h();const f=s&&!n&&!i?Ew(s,c):Cs(0),m=o.left+c.scrollLeft-u.x-f.x,y=o.top+c.scrollTop-u.y-f.y;return{x:m,y,width:o.width,height:o.height}}function ff(r){return ls(r).position==="static"}function jv(r,t){if(!ks(r)||ls(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return Ds(r)===e&&(e=e.ownerDocument.body),e}function Tw(r,t){const e=_n(r);if(yu(r))return e;if(!ks(r)){let s=Oi(r);for(;s&&!wo(s);){if(cs(s)&&!ff(s))return s;s=Oi(s)}return e}let n=jv(r,t);for(;n&&rN(n)&&ff(n);)n=jv(n,t);return n&&wo(n)&&ff(n)&&!Sp(n)?e:n||hN(r)||e}const EN=async function(r){const t=this.getOffsetParent||Tw,e=this.getDimensions,n=await e(r.floating);return{reference:RN(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function kN(r){return ls(r).direction==="rtl"}const TN={convertOffsetParentRelativeRectToViewportRelativeRect:mN,getDocumentElement:Ds,getClippingRect:SN,getOffsetParent:Tw,getElementRects:EN,getClientRects:yN,getDimensions:MN,getScale:bo,isElement:cs,isRTL:kN};function Aw(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function AN(r,t){let e=null,n;const s=Ds(r);function i(){var c;clearTimeout(n),(c=e)==null||c.disconnect(),e=null}function o(c,u){c===void 0&&(c=!1),u===void 0&&(u=1),i();const h=r.getBoundingClientRect(),{left:f,top:m,width:y,height:v}=h;if(c||t(),!y||!v)return;const x=xl(m),S=xl(s.clientWidth-(f+y)),R=xl(s.clientHeight-(m+v)),M=xl(f),k={rootMargin:-x+"px "+-S+"px "+-R+"px "+-M+"px",threshold:Dn(0,Ii(1,u))||1};let A=!0;function _(P){const z=P[0].intersectionRatio;if(z!==u){if(!A)return o();z?o(!1,z):n=setTimeout(()=>{o(!1,1e-7)},1e3)}z===1&&!Aw(h,r.getBoundingClientRect())&&o(),A=!1}try{e=new IntersectionObserver(_,{...k,root:s.ownerDocument})}catch{e=new IntersectionObserver(_,k)}e.observe(r)}return o(!0),i}function DN(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:u=!1}=n,h=Rp(r),f=s||i?[...h?zr(h):[],...zr(t)]:[];f.forEach(M=>{s&&M.addEventListener("scroll",e,{passive:!0}),i&&M.addEventListener("resize",e)});const m=h&&c?AN(h,e):null;let y=-1,v=null;o&&(v=new ResizeObserver(M=>{let[T]=M;T&&T.target===h&&v&&(v.unobserve(t),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var k;(k=v)==null||k.observe(t)})),e()}),h&&!u&&v.observe(h),v.observe(t));let x,S=u?xa(r):null;u&&R();function R(){const M=xa(r);S&&!Aw(S,M)&&e(),S=M,x=requestAnimationFrame(R)}return e(),()=>{var M;f.forEach(T=>{s&&T.removeEventListener("scroll",e),i&&T.removeEventListener("resize",e)}),m?.(),(M=v)==null||M.disconnect(),v=null,u&&cancelAnimationFrame(x)}}const _N=tN,PN=nN,NN=JP,jN=iN,LN=ZP,Lv=XP,zN=sN,IN=(r,t,e)=>{const n=new Map,s={platform:TN,...e},i={...s.platform,_c:n};return WP(r,t,{...s,platform:i})};var ON=typeof document<"u",HN=function(){},Dl=ON?C.useLayoutEffect:HN;function Gl(r,t){if(r===t)return!0;if(typeof r!=typeof t)return!1;if(typeof r=="function"&&r.toString()===t.toString())return!0;let e,n,s;if(r&&t&&typeof r=="object"){if(Array.isArray(r)){if(e=r.length,e!==t.length)return!1;for(n=e;n--!==0;)if(!Gl(r[n],t[n]))return!1;return!0}if(s=Object.keys(r),e=s.length,e!==Object.keys(t).length)return!1;for(n=e;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=e;n--!==0;){const i=s[n];if(!(i==="_owner"&&r.$$typeof)&&!Gl(r[i],t[i]))return!1}return!0}return r!==r&&t!==t}function Dw(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function zv(r,t){const e=Dw(r);return Math.round(t*e)/e}function pf(r){const t=C.useRef(r);return Dl(()=>{t.current=r}),t}function qN(r){r===void 0&&(r={});const{placement:t="bottom",strategy:e="absolute",middleware:n=[],platform:s,elements:{reference:i,floating:o}={},transform:c=!0,whileElementsMounted:u,open:h}=r,[f,m]=C.useState({x:0,y:0,strategy:e,placement:t,middlewareData:{},isPositioned:!1}),[y,v]=C.useState(n);Gl(y,n)||v(n);const[x,S]=C.useState(null),[R,M]=C.useState(null),T=C.useCallback(O=>{O!==P.current&&(P.current=O,S(O))},[]),k=C.useCallback(O=>{O!==z.current&&(z.current=O,M(O))},[]),A=i||x,_=o||R,P=C.useRef(null),z=C.useRef(null),q=C.useRef(f),Z=u!=null,se=pf(u),ce=pf(s),J=pf(h),te=C.useCallback(()=>{if(!P.current||!z.current)return;const O={placement:t,strategy:e,middleware:y};ce.current&&(O.platform=ce.current),IN(P.current,z.current,O).then(W=>{const fe={...W,isPositioned:J.current!==!1};le.current&&!Gl(q.current,fe)&&(q.current=fe,qr.flushSync(()=>{m(fe)}))})},[y,t,e,ce,J]);Dl(()=>{h===!1&&q.current.isPositioned&&(q.current.isPositioned=!1,m(O=>({...O,isPositioned:!1})))},[h]);const le=C.useRef(!1);Dl(()=>(le.current=!0,()=>{le.current=!1}),[]),Dl(()=>{if(A&&(P.current=A),_&&(z.current=_),A&&_){if(se.current)return se.current(A,_,te);te()}},[A,_,te,se,Z]);const ue=C.useMemo(()=>({reference:P,floating:z,setReference:T,setFloating:k}),[T,k]),L=C.useMemo(()=>({reference:A,floating:_}),[A,_]),N=C.useMemo(()=>{const O={position:e,left:0,top:0};if(!L.floating)return O;const W=zv(L.floating,f.x),fe=zv(L.floating,f.y);return c?{...O,transform:"translate("+W+"px, "+fe+"px)",...Dw(L.floating)>=1.5&&{willChange:"transform"}}:{position:e,left:W,top:fe}},[e,c,L.floating,f.x,f.y]);return C.useMemo(()=>({...f,update:te,refs:ue,elements:L,floatingStyles:N}),[f,te,ue,L,N])}const $N=r=>{function t(e){return{}.hasOwnProperty.call(e,"current")}return{name:"arrow",options:r,fn(e){const{element:n,padding:s}=typeof r=="function"?r(e):r;return n&&t(n)?n.current!=null?Lv({element:n.current,padding:s}).fn(e):{}:n?Lv({element:n,padding:s}).fn(e):{}}}},BN=(r,t)=>({..._N(r),options:[r,t]}),UN=(r,t)=>({...PN(r),options:[r,t]}),FN=(r,t)=>({...zN(r),options:[r,t]}),VN=(r,t)=>({...NN(r),options:[r,t]}),GN=(r,t)=>({...jN(r),options:[r,t]}),QN=(r,t)=>({...LN(r),options:[r,t]}),KN=(r,t)=>({...$N(r),options:[r,t]});var YN="Arrow",_w=C.forwardRef((r,t)=>{const{children:e,width:n=10,height:s=5,...i}=r;return g.jsx(De.svg,{...i,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?e:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});_w.displayName=YN;var WN=_w;function xu(r){const[t,e]=C.useState(void 0);return rn(()=>{if(r){e({width:r.offsetWidth,height:r.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const i=s[0];let o,c;if("borderBoxSize"in i){const u=i.borderBoxSize,h=Array.isArray(u)?u[0]:u;o=h.inlineSize,c=h.blockSize}else o=r.offsetWidth,c=r.offsetHeight;e({width:o,height:c})});return n.observe(r,{box:"border-box"}),()=>n.unobserve(r)}else e(void 0)},[r]),t}var Ep="Popper",[Pw,Ao]=Cn(Ep),[XN,Nw]=Pw(Ep),jw=r=>{const{__scopePopper:t,children:e}=r,[n,s]=C.useState(null);return g.jsx(XN,{scope:t,anchor:n,onAnchorChange:s,children:e})};jw.displayName=Ep;var Lw="PopperAnchor",zw=C.forwardRef((r,t)=>{const{__scopePopper:e,virtualRef:n,...s}=r,i=Nw(Lw,e),o=C.useRef(null),c=Ne(t,o),u=C.useRef(null);return C.useEffect(()=>{const h=u.current;u.current=n?.current||o.current,h!==u.current&&i.onAnchorChange(u.current)}),n?null:g.jsx(De.div,{...s,ref:c})});zw.displayName=Lw;var kp="PopperContent",[JN,ZN]=Pw(kp),Iw=C.forwardRef((r,t)=>{const{__scopePopper:e,side:n="bottom",sideOffset:s=0,align:i="center",alignOffset:o=0,arrowPadding:c=0,avoidCollisions:u=!0,collisionBoundary:h=[],collisionPadding:f=0,sticky:m="partial",hideWhenDetached:y=!1,updatePositionStrategy:v="optimized",onPlaced:x,...S}=r,R=Nw(kp,e),[M,T]=C.useState(null),k=Ne(t,B=>T(B)),[A,_]=C.useState(null),P=xu(A),z=P?.width??0,q=P?.height??0,Z=n+(i!=="center"?"-"+i:""),se=typeof f=="number"?f:{top:0,right:0,bottom:0,left:0,...f},ce=Array.isArray(h)?h:[h],J=ce.length>0,te={padding:se,boundary:ce.filter(tj),altBoundary:J},{refs:le,floatingStyles:ue,placement:L,isPositioned:N,middlewareData:O}=qN({strategy:"fixed",placement:Z,whileElementsMounted:(...B)=>DN(...B,{animationFrame:v==="always"}),elements:{reference:R.anchor},middleware:[BN({mainAxis:s+q,alignmentAxis:o}),u&&UN({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?FN():void 0,...te}),u&&VN({...te}),GN({...te,apply:({elements:B,rects:Q,availableWidth:pe,availableHeight:me})=>{const{width:ye,height:ve}=Q.reference,je=B.floating.style;je.setProperty("--radix-popper-available-width",`${pe}px`),je.setProperty("--radix-popper-available-height",`${me}px`),je.setProperty("--radix-popper-anchor-width",`${ye}px`),je.setProperty("--radix-popper-anchor-height",`${ve}px`)}}),A&&KN({element:A,padding:c}),nj({arrowWidth:z,arrowHeight:q}),y&&QN({strategy:"referenceHidden",...te})]}),[W,fe]=qw(L),j=on(x);rn(()=>{N&&j?.()},[N,j]);const F=O.arrow?.x,Y=O.arrow?.y,ie=O.arrow?.centerOffset!==0,[U,ae]=C.useState();return rn(()=>{M&&ae(window.getComputedStyle(M).zIndex)},[M]),g.jsx("div",{ref:le.setFloating,"data-radix-popper-content-wrapper":"",style:{...ue,transform:N?ue.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:U,"--radix-popper-transform-origin":[O.transformOrigin?.x,O.transformOrigin?.y].join(" "),...O.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:g.jsx(JN,{scope:e,placedSide:W,onArrowChange:_,arrowX:F,arrowY:Y,shouldHideArrow:ie,children:g.jsx(De.div,{"data-side":W,"data-align":fe,...S,ref:k,style:{...S.style,animation:N?void 0:"none"}})})})});Iw.displayName=kp;var Ow="PopperArrow",ej={top:"bottom",right:"left",bottom:"top",left:"right"},Hw=C.forwardRef(function(t,e){const{__scopePopper:n,...s}=t,i=ZN(Ow,n),o=ej[i.placedSide];return g.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:g.jsx(WN,{...s,ref:e,style:{...s.style,display:"block"}})})});Hw.displayName=Ow;function tj(r){return r!==null}var nj=r=>({name:"transformOrigin",options:r,fn(t){const{placement:e,rects:n,middlewareData:s}=t,o=s.arrow?.centerOffset!==0,c=o?0:r.arrowWidth,u=o?0:r.arrowHeight,[h,f]=qw(e),m={start:"0%",center:"50%",end:"100%"}[f],y=(s.arrow?.x??0)+c/2,v=(s.arrow?.y??0)+u/2;let x="",S="";return h==="bottom"?(x=o?m:`${y}px`,S=`${-u}px`):h==="top"?(x=o?m:`${y}px`,S=`${n.floating.height+u}px`):h==="right"?(x=`${-u}px`,S=o?m:`${v}px`):h==="left"&&(x=`${n.floating.width+u}px`,S=o?m:`${v}px`),{data:{x,y:S}}}});function qw(r){const[t,e="center"]=r.split("-");return[t,e]}var Tp=jw,wu=zw,Ap=Iw,Dp=Hw;function sj(r){const t=ij(r),e=C.forwardRef((n,s)=>{const{children:i,...o}=n,c=C.Children.toArray(i),u=c.find(oj);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}function ij(r){const t=C.forwardRef((e,n)=>{const{children:s,...i}=e;if(C.isValidElement(s)){const o=cj(s),c=rj(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var aj=Symbol("radix.slottable");function oj(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===aj}function rj(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function cj(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var Tf=["Enter"," "],lj=["ArrowDown","PageUp","Home"],$w=["ArrowUp","PageDown","End"],uj=[...lj,...$w],dj={ltr:[...Tf,"ArrowRight"],rtl:[...Tf,"ArrowLeft"]},hj={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Yr="Menu",[Ir,fj,pj]=hu(Yr),[Sa,Bw]=Cn(Yr,[pj,Ao,fu]),Cu=Ao(),Uw=fu(),[gj,Ma]=Sa(Yr),[mj,Wr]=Sa(Yr),Fw=r=>{const{__scopeMenu:t,open:e=!1,children:n,dir:s,onOpenChange:i,modal:o=!0}=r,c=Cu(t),[u,h]=C.useState(null),f=C.useRef(!1),m=on(i),y=Eo(s);return C.useEffect(()=>{const v=()=>{f.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>f.current=!1;return document.addEventListener("keydown",v,{capture:!0}),()=>{document.removeEventListener("keydown",v,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),g.jsx(Tp,{...c,children:g.jsx(gj,{scope:t,open:e,onOpenChange:m,content:u,onContentChange:h,children:g.jsx(mj,{scope:t,onClose:C.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:f,dir:y,modal:o,children:n})})})};Fw.displayName=Yr;var yj="MenuAnchor",_p=C.forwardRef((r,t)=>{const{__scopeMenu:e,...n}=r,s=Cu(e);return g.jsx(wu,{...s,...n,ref:t})});_p.displayName=yj;var Pp="MenuPortal",[vj,Vw]=Sa(Pp,{forceMount:void 0}),Gw=r=>{const{__scopeMenu:t,forceMount:e,children:n,container:s}=r,i=Ma(Pp,t);return g.jsx(vj,{scope:t,forceMount:e,children:g.jsx(ln,{present:e||i.open,children:g.jsx(Vr,{asChild:!0,container:s,children:n})})})};Gw.displayName=Pp;var Yn="MenuContent",[bj,Np]=Sa(Yn),Qw=C.forwardRef((r,t)=>{const e=Vw(Yn,r.__scopeMenu),{forceMount:n=e.forceMount,...s}=r,i=Ma(Yn,r.__scopeMenu),o=Wr(Yn,r.__scopeMenu);return g.jsx(Ir.Provider,{scope:r.__scopeMenu,children:g.jsx(ln,{present:n||i.open,children:g.jsx(Ir.Slot,{scope:r.__scopeMenu,children:o.modal?g.jsx(xj,{...s,ref:t}):g.jsx(wj,{...s,ref:t})})})})}),xj=C.forwardRef((r,t)=>{const e=Ma(Yn,r.__scopeMenu),n=C.useRef(null),s=Ne(t,n);return C.useEffect(()=>{const i=n.current;if(i)return au(i)},[]),g.jsx(jp,{...r,ref:s,trapFocus:e.open,disableOutsidePointerEvents:e.open,disableOutsideScroll:!0,onFocusOutside:ge(r.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>e.onOpenChange(!1)})}),wj=C.forwardRef((r,t)=>{const e=Ma(Yn,r.__scopeMenu);return g.jsx(jp,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>e.onOpenChange(!1)})}),Cj=sj("MenuContent.ScrollLock"),jp=C.forwardRef((r,t)=>{const{__scopeMenu:e,loop:n=!1,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:c,onEntryFocus:u,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:m,onInteractOutside:y,onDismiss:v,disableOutsideScroll:x,...S}=r,R=Ma(Yn,e),M=Wr(Yn,e),T=Cu(e),k=Uw(e),A=fj(e),[_,P]=C.useState(null),z=C.useRef(null),q=Ne(t,z,R.onContentChange),Z=C.useRef(0),se=C.useRef(""),ce=C.useRef(0),J=C.useRef(null),te=C.useRef("right"),le=C.useRef(0),ue=x?Gr:C.Fragment,L=x?{as:Cj,allowPinchZoom:!0}:void 0,N=W=>{const fe=se.current+W,j=A().filter(B=>!B.disabled),F=document.activeElement,Y=j.find(B=>B.ref.current===F)?.textValue,ie=j.map(B=>B.textValue),U=jj(ie,fe,Y),ae=j.find(B=>B.textValue===U)?.ref.current;(function B(Q){se.current=Q,window.clearTimeout(Z.current),Q!==""&&(Z.current=window.setTimeout(()=>B(""),1e3))})(fe),ae&&setTimeout(()=>ae.focus())};C.useEffect(()=>()=>window.clearTimeout(Z.current),[]),su();const O=C.useCallback(W=>te.current===J.current?.side&&zj(W,J.current?.area),[]);return g.jsx(bj,{scope:e,searchRef:se,onItemEnter:C.useCallback(W=>{O(W)&&W.preventDefault()},[O]),onItemLeave:C.useCallback(W=>{O(W)||(z.current?.focus(),P(null))},[O]),onTriggerLeave:C.useCallback(W=>{O(W)&&W.preventDefault()},[O]),pointerGraceTimerRef:ce,onPointerGraceIntentChange:C.useCallback(W=>{J.current=W},[]),children:g.jsx(ue,{...L,children:g.jsx(Fr,{asChild:!0,trapped:s,onMountAutoFocus:ge(i,W=>{W.preventDefault(),z.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:g.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:m,onInteractOutside:y,onDismiss:v,children:g.jsx(aw,{asChild:!0,...k,dir:M.dir,orientation:"vertical",loop:n,currentTabStopId:_,onCurrentTabStopIdChange:P,onEntryFocus:ge(u,W=>{M.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(Ap,{role:"menu","aria-orientation":"vertical","data-state":lC(R.open),"data-radix-menu-content":"",dir:M.dir,...T,...S,ref:q,style:{outline:"none",...S.style},onKeyDown:ge(S.onKeyDown,W=>{const j=W.target.closest("[data-radix-menu-content]")===W.currentTarget,F=W.ctrlKey||W.altKey||W.metaKey,Y=W.key.length===1;j&&(W.key==="Tab"&&W.preventDefault(),!F&&Y&&N(W.key));const ie=z.current;if(W.target!==ie||!uj.includes(W.key))return;W.preventDefault();const ae=A().filter(B=>!B.disabled).map(B=>B.ref.current);$w.includes(W.key)&&ae.reverse(),Pj(ae)}),onBlur:ge(r.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(Z.current),se.current="")}),onPointerMove:ge(r.onPointerMove,Or(W=>{const fe=W.target,j=le.current!==W.clientX;if(W.currentTarget.contains(fe)&&j){const F=W.clientX>le.current?"right":"left";te.current=F,le.current=W.clientX}}))})})})})})})});Qw.displayName=Yn;var Sj="MenuGroup",Lp=C.forwardRef((r,t)=>{const{__scopeMenu:e,...n}=r;return g.jsx(De.div,{role:"group",...n,ref:t})});Lp.displayName=Sj;var Mj="MenuLabel",Kw=C.forwardRef((r,t)=>{const{__scopeMenu:e,...n}=r;return g.jsx(De.div,{...n,ref:t})});Kw.displayName=Mj;var Ql="MenuItem",Iv="menu.itemSelect",Su=C.forwardRef((r,t)=>{const{disabled:e=!1,onSelect:n,...s}=r,i=C.useRef(null),o=Wr(Ql,r.__scopeMenu),c=Np(Ql,r.__scopeMenu),u=Ne(t,i),h=C.useRef(!1),f=()=>{const m=i.current;if(!e&&m){const y=new CustomEvent(Iv,{bubbles:!0,cancelable:!0});m.addEventListener(Iv,v=>n?.(v),{once:!0}),Ib(m,y),y.defaultPrevented?h.current=!1:o.onClose()}};return g.jsx(Yw,{...s,ref:u,disabled:e,onClick:ge(r.onClick,f),onPointerDown:m=>{r.onPointerDown?.(m),h.current=!0},onPointerUp:ge(r.onPointerUp,m=>{h.current||m.currentTarget?.click()}),onKeyDown:ge(r.onKeyDown,m=>{const y=c.searchRef.current!=="";e||y&&m.key===" "||Tf.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Su.displayName=Ql;var Yw=C.forwardRef((r,t)=>{const{__scopeMenu:e,disabled:n=!1,textValue:s,...i}=r,o=Np(Ql,e),c=Uw(e),u=C.useRef(null),h=Ne(t,u),[f,m]=C.useState(!1),[y,v]=C.useState("");return C.useEffect(()=>{const x=u.current;x&&v((x.textContent??"").trim())},[i.children]),g.jsx(Ir.ItemSlot,{scope:e,disabled:n,textValue:s??y,children:g.jsx(ow,{asChild:!0,...c,focusable:!n,children:g.jsx(De.div,{role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...i,ref:h,onPointerMove:ge(r.onPointerMove,Or(x=>{n?o.onItemLeave(x):(o.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ge(r.onPointerLeave,Or(x=>o.onItemLeave(x))),onFocus:ge(r.onFocus,()=>m(!0)),onBlur:ge(r.onBlur,()=>m(!1))})})})}),Rj="MenuCheckboxItem",Ww=C.forwardRef((r,t)=>{const{checked:e=!1,onCheckedChange:n,...s}=r;return g.jsx(tC,{scope:r.__scopeMenu,checked:e,children:g.jsx(Su,{role:"menuitemcheckbox","aria-checked":Kl(e)?"mixed":e,...s,ref:t,"data-state":Ip(e),onSelect:ge(s.onSelect,()=>n?.(Kl(e)?!0:!e),{checkForDefaultPrevented:!1})})})});Ww.displayName=Rj;var Xw="MenuRadioGroup",[Ej,kj]=Sa(Xw,{value:void 0,onValueChange:()=>{}}),Jw=C.forwardRef((r,t)=>{const{value:e,onValueChange:n,...s}=r,i=on(n);return g.jsx(Ej,{scope:r.__scopeMenu,value:e,onValueChange:i,children:g.jsx(Lp,{...s,ref:t})})});Jw.displayName=Xw;var Zw="MenuRadioItem",eC=C.forwardRef((r,t)=>{const{value:e,...n}=r,s=kj(Zw,r.__scopeMenu),i=e===s.value;return g.jsx(tC,{scope:r.__scopeMenu,checked:i,children:g.jsx(Su,{role:"menuitemradio","aria-checked":i,...n,ref:t,"data-state":Ip(i),onSelect:ge(n.onSelect,()=>s.onValueChange?.(e),{checkForDefaultPrevented:!1})})})});eC.displayName=Zw;var zp="MenuItemIndicator",[tC,Tj]=Sa(zp,{checked:!1}),nC=C.forwardRef((r,t)=>{const{__scopeMenu:e,forceMount:n,...s}=r,i=Tj(zp,e);return g.jsx(ln,{present:n||Kl(i.checked)||i.checked===!0,children:g.jsx(De.span,{...s,ref:t,"data-state":Ip(i.checked)})})});nC.displayName=zp;var Aj="MenuSeparator",sC=C.forwardRef((r,t)=>{const{__scopeMenu:e,...n}=r;return g.jsx(De.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});sC.displayName=Aj;var Dj="MenuArrow",iC=C.forwardRef((r,t)=>{const{__scopeMenu:e,...n}=r,s=Cu(e);return g.jsx(Dp,{...s,...n,ref:t})});iC.displayName=Dj;var _j="MenuSub",[f3,aC]=Sa(_j),kr="MenuSubTrigger",oC=C.forwardRef((r,t)=>{const e=Ma(kr,r.__scopeMenu),n=Wr(kr,r.__scopeMenu),s=aC(kr,r.__scopeMenu),i=Np(kr,r.__scopeMenu),o=C.useRef(null),{pointerGraceTimerRef:c,onPointerGraceIntentChange:u}=i,h={__scopeMenu:r.__scopeMenu},f=C.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return C.useEffect(()=>f,[f]),C.useEffect(()=>{const m=c.current;return()=>{window.clearTimeout(m),u(null)}},[c,u]),g.jsx(_p,{asChild:!0,...h,children:g.jsx(Yw,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":e.open,"aria-controls":s.contentId,"data-state":lC(e.open),...r,ref:Ts(t,s.onTriggerChange),onClick:m=>{r.onClick?.(m),!(r.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),e.open||e.onOpenChange(!0))},onPointerMove:ge(r.onPointerMove,Or(m=>{i.onItemEnter(m),!m.defaultPrevented&&!r.disabled&&!e.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{e.onOpenChange(!0),f()},100))})),onPointerLeave:ge(r.onPointerLeave,Or(m=>{f();const y=e.content?.getBoundingClientRect();if(y){const v=e.content?.dataset.side,x=v==="right",S=x?-5:5,R=y[x?"left":"right"],M=y[x?"right":"left"];i.onPointerGraceIntentChange({area:[{x:m.clientX+S,y:m.clientY},{x:R,y:y.top},{x:M,y:y.top},{x:M,y:y.bottom},{x:R,y:y.bottom}],side:v}),window.clearTimeout(c.current),c.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(m),m.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:ge(r.onKeyDown,m=>{const y=i.searchRef.current!=="";r.disabled||y&&m.key===" "||dj[n.dir].includes(m.key)&&(e.onOpenChange(!0),e.content?.focus(),m.preventDefault())})})})});oC.displayName=kr;var rC="MenuSubContent",cC=C.forwardRef((r,t)=>{const e=Vw(Yn,r.__scopeMenu),{forceMount:n=e.forceMount,...s}=r,i=Ma(Yn,r.__scopeMenu),o=Wr(Yn,r.__scopeMenu),c=aC(rC,r.__scopeMenu),u=C.useRef(null),h=Ne(t,u);return g.jsx(Ir.Provider,{scope:r.__scopeMenu,children:g.jsx(ln,{present:n||i.open,children:g.jsx(Ir.Slot,{scope:r.__scopeMenu,children:g.jsx(jp,{id:c.contentId,"aria-labelledby":c.triggerId,...s,ref:h,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:f=>{o.isUsingKeyboardRef.current&&u.current?.focus(),f.preventDefault()},onCloseAutoFocus:f=>f.preventDefault(),onFocusOutside:ge(r.onFocusOutside,f=>{f.target!==c.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:ge(r.onEscapeKeyDown,f=>{o.onClose(),f.preventDefault()}),onKeyDown:ge(r.onKeyDown,f=>{const m=f.currentTarget.contains(f.target),y=hj[o.dir].includes(f.key);m&&y&&(i.onOpenChange(!1),c.trigger?.focus(),f.preventDefault())})})})})})});cC.displayName=rC;function lC(r){return r?"open":"closed"}function Kl(r){return r==="indeterminate"}function Ip(r){return Kl(r)?"indeterminate":r?"checked":"unchecked"}function Pj(r){const t=document.activeElement;for(const e of r)if(e===t||(e.focus(),document.activeElement!==t))return}function Nj(r,t){return r.map((e,n)=>r[(t+n)%r.length])}function jj(r,t,e){const s=t.length>1&&Array.from(t).every(h=>h===t[0])?t[0]:t,i=e?r.indexOf(e):-1;let o=Nj(r,Math.max(i,0));s.length===1&&(o=o.filter(h=>h!==e));const u=o.find(h=>h.toLowerCase().startsWith(s.toLowerCase()));return u!==e?u:void 0}function Lj(r,t){const{x:e,y:n}=r;let s=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const c=t[i],u=t[o],h=c.x,f=c.y,m=u.x,y=u.y;f>n!=y>n&&e<(m-h)*(n-f)/(y-f)+h&&(s=!s)}return s}function zj(r,t){if(!t)return!1;const e={x:r.clientX,y:r.clientY};return Lj(e,t)}function Or(r){return t=>t.pointerType==="mouse"?r(t):void 0}var Ij=Fw,Oj=_p,Hj=Gw,qj=Qw,$j=Lp,Bj=Kw,Uj=Su,Fj=Ww,Vj=Jw,Gj=eC,Qj=nC,Kj=sC,Yj=iC,Wj=oC,Xj=cC,Mu="DropdownMenu",[Jj]=Cn(Mu,[Bw]),fn=Bw(),[Zj,uC]=Jj(Mu),dC=r=>{const{__scopeDropdownMenu:t,children:e,dir:n,open:s,defaultOpen:i,onOpenChange:o,modal:c=!0}=r,u=fn(t),h=C.useRef(null),[f,m]=Es({prop:s,defaultProp:i??!1,onChange:o,caller:Mu});return g.jsx(Zj,{scope:t,triggerId:rs(),triggerRef:h,contentId:rs(),open:f,onOpenChange:m,onOpenToggle:C.useCallback(()=>m(y=>!y),[m]),modal:c,children:g.jsx(Ij,{...u,open:f,onOpenChange:m,dir:n,modal:c,children:e})})};dC.displayName=Mu;var hC="DropdownMenuTrigger",fC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,disabled:n=!1,...s}=r,i=uC(hC,e),o=fn(e);return g.jsx(Oj,{asChild:!0,...o,children:g.jsx(De.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:Ts(t,i.triggerRef),onPointerDown:ge(r.onPointerDown,c=>{!n&&c.button===0&&c.ctrlKey===!1&&(i.onOpenToggle(),i.open||c.preventDefault())}),onKeyDown:ge(r.onKeyDown,c=>{n||(["Enter"," "].includes(c.key)&&i.onOpenToggle(),c.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(c.key)&&c.preventDefault())})})})});fC.displayName=hC;var eL="DropdownMenuPortal",pC=r=>{const{__scopeDropdownMenu:t,...e}=r,n=fn(t);return g.jsx(Hj,{...n,...e})};pC.displayName=eL;var gC="DropdownMenuContent",mC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=uC(gC,e),i=fn(e),o=C.useRef(!1);return g.jsx(qj,{id:s.contentId,"aria-labelledby":s.triggerId,...i,...n,ref:t,onCloseAutoFocus:ge(r.onCloseAutoFocus,c=>{o.current||s.triggerRef.current?.focus(),o.current=!1,c.preventDefault()}),onInteractOutside:ge(r.onInteractOutside,c=>{const u=c.detail.originalEvent,h=u.button===0&&u.ctrlKey===!0,f=u.button===2||h;(!s.modal||f)&&(o.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mC.displayName=gC;var tL="DropdownMenuGroup",nL=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx($j,{...s,...n,ref:t})});nL.displayName=tL;var sL="DropdownMenuLabel",yC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Bj,{...s,...n,ref:t})});yC.displayName=sL;var iL="DropdownMenuItem",vC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Uj,{...s,...n,ref:t})});vC.displayName=iL;var aL="DropdownMenuCheckboxItem",bC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Fj,{...s,...n,ref:t})});bC.displayName=aL;var oL="DropdownMenuRadioGroup",rL=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Vj,{...s,...n,ref:t})});rL.displayName=oL;var cL="DropdownMenuRadioItem",xC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Gj,{...s,...n,ref:t})});xC.displayName=cL;var lL="DropdownMenuItemIndicator",wC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Qj,{...s,...n,ref:t})});wC.displayName=lL;var uL="DropdownMenuSeparator",CC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Kj,{...s,...n,ref:t})});CC.displayName=uL;var dL="DropdownMenuArrow",hL=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Yj,{...s,...n,ref:t})});hL.displayName=dL;var fL="DropdownMenuSubTrigger",SC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Wj,{...s,...n,ref:t})});SC.displayName=fL;var pL="DropdownMenuSubContent",MC=C.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...n}=r,s=fn(e);return g.jsx(Xj,{...s,...n,ref:t,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});MC.displayName=pL;var gL=dC,mL=fC,yL=pC,RC=mC,EC=yC,kC=vC,TC=bC,AC=xC,DC=wC,_C=CC,PC=SC,NC=MC;const vL=gL,bL=mL,xL=C.forwardRef(({className:r,inset:t,children:e,...n},s)=>g.jsxs(PC,{ref:s,className:ke("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",r),...n,children:[e,g.jsx(Xf,{className:"ml-auto"})]}));xL.displayName=PC.displayName;const wL=C.forwardRef(({className:r,...t},e)=>g.jsx(NC,{ref:e,className:ke("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",r),...t}));wL.displayName=NC.displayName;const jC=C.forwardRef(({className:r,sideOffset:t=4,...e},n)=>g.jsx(yL,{children:g.jsx(RC,{ref:n,sideOffset:t,className:ke("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",r),...e})}));jC.displayName=RC.displayName;const _l=C.forwardRef(({className:r,inset:t,...e},n)=>g.jsx(kC,{ref:n,className:ke("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",r),...e}));_l.displayName=kC.displayName;const CL=C.forwardRef(({className:r,children:t,checked:e,...n},s)=>g.jsxs(TC,{ref:s,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:e,...n,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(DC,{children:g.jsx(Wf,{className:"h-4 w-4"})})}),t]}));CL.displayName=TC.displayName;const SL=C.forwardRef(({className:r,children:t,...e},n)=>g.jsxs(AC,{ref:n,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...e,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(DC,{children:g.jsx(VA,{className:"h-2 w-2 fill-current"})})}),t]}));SL.displayName=AC.displayName;const Af=C.forwardRef(({className:r,inset:t,...e},n)=>g.jsx(EC,{ref:n,className:ke("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",r),...e}));Af.displayName=EC.displayName;const LC=C.forwardRef(({className:r,...t},e)=>g.jsx(_C,{ref:e,className:ke("-mx-1 my-1 h-px bg-muted",r),...t}));LC.displayName=_C.displayName;const zC="archiphoenix_component_library",Ov=()=>{if(typeof window>"u")return{favorites:[],collections:[]};try{const r=window.localStorage.getItem(zC);if(!r)return{favorites:[],collections:[]};const t=JSON.parse(r);return{favorites:Array.isArray(t.favorites)?t.favorites:[],collections:Array.isArray(t.collections)?t.collections:[]}}catch(r){return Mb("Failed to load component library state",r instanceof Error?r:new Error(String(r))),{favorites:[],collections:[]}}},go=r=>{typeof window>"u"||window.localStorage.setItem(zC,JSON.stringify(r))},ML=us((r,t)=>({favorites:Ov().favorites,collections:Ov().collections,toggleFavorite:e=>{r(n=>{const i=n.favorites.includes(e)?n.favorites.filter(o=>o!==e):[...n.favorites,e];return go({favorites:i,collections:n.collections}),{favorites:i}})},createCollection:e=>{const n=e.trim();if(!n)return null;const s={id:`collection-${Date.now()}`,name:n,componentIds:[]};return r(i=>{const o=[...i.collections,s];return go({favorites:i.favorites,collections:o}),{collections:o}}),s.id},renameCollection:(e,n)=>{r(s=>{const i=s.collections.map(o=>o.id===e?{...o,name:n}:o);return go({favorites:s.favorites,collections:i}),{collections:i}})},deleteCollection:e=>{r(n=>{const s=n.collections.filter(i=>i.id!==e);return go({favorites:n.favorites,collections:s}),{collections:s}})},addComponentToCollection:(e,n)=>{r(s=>{const i=s.collections.map(o=>o.id!==e||o.componentIds.includes(n)?o:{...o,componentIds:[...o.componentIds,n]});return go({favorites:s.favorites,collections:i}),{collections:i}})},removeComponentFromCollection:(e,n)=>{r(s=>{const i=s.collections.map(o=>o.id!==e?o:{...o,componentIds:o.componentIds.filter(c=>c!==n)});return go({favorites:s.favorites,collections:i}),{collections:i}})}}));function Hv({open:r,initialName:t="",onConfirm:e,onCancel:n}){const[s,i]=C.useState(t);C.useEffect(()=>{r&&i(t)},[r,t]);const o=()=>{s.trim()&&e(s.trim())};return g.jsx(mp,{open:r,onOpenChange:c=>!c&&n(),children:g.jsxs(ru,{children:[g.jsxs(cu,{children:[g.jsx(uu,{children:t?"Rename Collection":"Create Collection"}),g.jsx(du,{children:t?"Enter a new name for the collection":"Enter a name for the new collection"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(it,{htmlFor:"collection-name",children:"Collection Name"}),g.jsx(Tt,{id:"collection-name",value:s,onChange:c=>i(c.target.value),onKeyDown:c=>{c.key==="Enter"&&o()},className:"mt-2",autoFocus:!0})]}),g.jsxs(lu,{children:[g.jsx(Te,{variant:"outline",onClick:n,children:"Cancel"}),g.jsx(Te,{onClick:o,disabled:!s.trim(),children:t?"Save":"Create"})]})]})})}function RL(){const[r,t]=C.useState(""),[e,n]=C.useState("all"),[s,i]=C.useState(!1),[o,c]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null),[y,v]=C.useState(180),[x,S]=C.useState(!1),R=C.useRef(null),[M,T]=C.useState(()=>{const U=localStorage.getItem("sidebar-expanded-categories");if(U)try{const ae=JSON.parse(U);return Mr.reduce((B,Q)=>(B[Q.id]=ae[Q.id]!==void 0?ae[Q.id]:!0,B),{})}catch{}return Mr.reduce((ae,B)=>(ae[B.id]=!0,ae),{})}),{favorites:k,collections:A,toggleFavorite:_,createCollection:P,renameCollection:z,deleteCollection:q,addComponentToCollection:Z,removeComponentFromCollection:se}=ML(),ce=U=>{T(ae=>({...ae,[U]:!ae[U]}))},J=r.toLowerCase(),te=C.useMemo(()=>jr.filter(U=>U.label.toLowerCase().includes(J)),[J]),le=C.useMemo(()=>te.filter(U=>k.includes(U.id)),[k,te]),ue=(U,ae)=>{U.dataTransfer.setData("application/json",JSON.stringify(ae)),U.dataTransfer.effectAllowed="copy"},L=()=>{h(null),i(!0)},N=U=>{if(u)z(u.id,U),h(null);else{if(A.some(Q=>Q.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}P(U)||alert("Failed to create collection")}i(!1)},O=()=>{i(!1),h(null)},W=U=>{m(U),h(null),c(!0)},fe=U=>{if(!f)return;if(A.some(Q=>Q.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}const B=P(U);B?Z(B,f):alert("Failed to create collection"),c(!1),m(null)},j=()=>{c(!1),m(null)},F=U=>{h(U),i(!0)};C.useEffect(()=>{localStorage.setItem("sidebar-expanded-categories",JSON.stringify(M))},[M]),C.useEffect(()=>{if(!x)return;const U=B=>{if(!R.current)return;const Q=R.current.closest(".h-full");if(!Q)return;const pe=Q.getBoundingClientRect();R.current.getBoundingClientRect();const me=pe.bottom-B.clientY,ye=70,ve=pe.height*.8;v(Math.max(ye,Math.min(ve,me)))},ae=()=>{S(!1)};return document.addEventListener("mousemove",U),document.addEventListener("mouseup",ae),()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",ae)}},[x]);const Y=(U,ae)=>{const B=k.includes(U.id);return g.jsxs("div",{draggable:!0,onDragStart:Q=>ue(Q,U),className:`flex items-center gap-1 px-1 ${ae?.compact?"py-0.5 text-[10px]":"py-1 text-xs"} rounded-md bg-secondary/50 hover:bg-secondary cursor-move transition-colors border border-border/50`,children:[g.jsxs("div",{className:"flex items-center gap-0.5 flex-1 min-w-0",children:[g.jsx("span",{className:"text-sm flex-shrink-0",children:U.icon}),g.jsx("span",{className:"text-foreground truncate min-w-0",children:U.label})]}),g.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[g.jsx("button",{type:"button",onClick:Q=>{Q.preventDefault(),Q.stopPropagation(),_(U.id)},onMouseDown:Q=>Q.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:B?"Remove from favorites":"Add to favorites",children:g.jsx(ID,{className:`h-4 w-4 ${B?"text-yellow-400":"text-muted-foreground"}`,fill:B?"currentColor":"none"})}),g.jsxs(vL,{children:[g.jsx(bL,{asChild:!0,children:g.jsx("button",{type:"button",onMouseDown:Q=>Q.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Add to collection",children:g.jsx(Hl,{className:"h-4 w-4 text-muted-foreground"})})}),g.jsxs(jC,{align:"end",className:"w-48",children:[A.length===0&&g.jsxs(g.Fragment,{children:[g.jsx(Af,{children:"No collections"}),g.jsxs(_l,{onSelect:Q=>{Q.preventDefault(),W(U.id)},children:[g.jsx(xf,{className:"h-4 w-4 mr-2"}),"Create and add"]})]}),A.length>0&&g.jsxs(g.Fragment,{children:[g.jsx(Af,{children:"Add to collection"}),A.map(Q=>g.jsx(_l,{onSelect:pe=>{pe.preventDefault(),Z(Q.id,U.id)},children:Q.name},Q.id)),g.jsx(LC,{}),g.jsxs(_l,{onSelect:Q=>{Q.preventDefault(),W(U.id)},children:[g.jsx(xf,{className:"h-4 w-4 mr-2"}),"New collection"]})]})]})]}),ae?.onRemove&&g.jsx("button",{type:"button",onClick:Q=>{Q.preventDefault(),Q.stopPropagation(),ae.onRemove?.()},onMouseDown:Q=>Q.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Remove from collection",children:g.jsx(os,{className:"h-4 w-4 text-muted-foreground"})})]})]},`${U.id}-${ae?.compact?"compact":"default"}`)},ie=e==="all"?Mr:Mr.filter(U=>U.id===e);return g.jsxs("div",{className:"w-60 h-full bg-sidebar-bg border-r border-border flex flex-col",children:[g.jsxs("div",{className:"p-3 border-b border-border",children:[g.jsx("h2",{className:"text-xs font-semibold text-foreground mb-2",children:"Components"}),g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),g.jsx(Tt,{type:"text",placeholder:"Search...",value:r,onChange:U=>t(U.target.value),className:"pl-7 h-8 text-xs"})]})]}),g.jsx("div",{className:"px-3 py-1.5 border-b border-border pb-2",children:g.jsx(bp,{value:e,onValueChange:n,children:g.jsxs(an,{orientation:"horizontal",className:"w-full",children:[g.jsxs(gu,{className:"flex w-max gap-0.5",children:[g.jsx(ss,{value:"all",className:"text-xs px-2 py-1",children:"All"}),Mr.map(U=>g.jsx(ss,{value:U.id,className:"text-xs px-2 py-1",children:U.icon},U.id))]}),g.jsx(nu,{orientation:"horizontal",className:"data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30 [&>[data-radix-scroll-area-thumb]]:bg-accent/80 hover:[&>[data-radix-scroll-area-thumb]]:bg-accent rounded-full",style:{transition:"none"}})]})})}),le.length>0&&g.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsx("span",{className:"text-[10px] font-semibold uppercase text-muted-foreground",children:"Favorites"}),g.jsx("span",{className:"text-[10px] text-muted-foreground",children:le.length})]}),g.jsx("div",{className:"space-y-1",children:le.map(U=>Y(U,{compact:!0}))})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"pl-3 pr-6 py-2",children:ie.map(U=>{const ae=te.filter(B=>B.category===U.id);return ae.length===0&&r?null:g.jsxs("div",{className:"mb-1.5",children:[g.jsxs(Te,{variant:"ghost",className:"w-full justify-start px-1 h-7 text-xs",onClick:()=>ce(U.id),children:[M[U.id]?g.jsx(Jl,{className:"h-3.5 w-3.5 mr-0.5"}):g.jsx(Xf,{className:"h-3.5 w-3.5 mr-0.5"}),g.jsx("span",{className:"mr-1",children:U.icon}),g.jsx("span",{className:"flex-1 text-left truncate min-w-0 mr-1",children:U.label}),g.jsx("span",{className:"text-[10px] text-muted-foreground flex-shrink-0",children:ae.length})]}),M[U.id]&&g.jsx("div",{className:"ml-1.5 mt-1 space-y-1",children:ae.map(B=>Y(B,{compact:!0}))})]},U.id)})})}),g.jsx("div",{ref:R,className:"h-2 border-t border-border cursor-row-resize hover:bg-accent/50 transition-colors relative group flex items-center justify-center",onMouseDown:U=>{U.preventDefault(),S(!0)},style:{userSelect:"none"},children:g.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:g.jsx(sD,{className:"h-3 w-3 text-muted-foreground"})})}),g.jsxs("div",{className:"border-t border-border overflow-hidden flex flex-col",style:{height:`${y}px`},children:[g.jsx("div",{className:"p-2 pb-1.5 flex-shrink-0",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-[10px] uppercase font-semibold text-muted-foreground",children:"Collections"}),g.jsxs(Te,{size:"xs",variant:"outline",className:"h-6 text-[10px] px-2",onClick:U=>{U.preventDefault(),U.stopPropagation(),L()},type:"button",children:[g.jsx(Hl,{className:"h-3 w-3 mr-0.5"}),"New"]})]})}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"pl-1.5 pr-4 pb-2 space-y-1.5",children:A.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground px-0.5",children:"Create collections to quickly build typical architectures."}):A.map(U=>{const ae=U.componentIds.map(B=>jr.find(Q=>Q.id===B)).filter(B=>!!B).filter(B=>B.label.toLowerCase().includes(J));return g.jsxs("div",{className:"rounded-md border border-border/60 p-1.5",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:U.name}),g.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[ae.length," items"]})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Te,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Rename",onClick:()=>F(U),children:""}),g.jsx(Te,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Delete collection",onClick:()=>q(U.id),children:g.jsx(os,{className:"h-4 w-4"})})]})]}),ae.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground",children:'Add components via "+" menu.'}):g.jsx("div",{className:"space-y-1",children:ae.map(B=>Y(B,{compact:!0,onRemove:()=>se(U.id,B.id)}))})]},U.id)})})})]}),g.jsx(Hv,{open:s,initialName:u?.name||"",onConfirm:N,onCancel:O}),g.jsx(Hv,{open:o,initialName:"",onConfirm:fe,onCancel:j})]})}const Ru=us(r=>({tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}],addTab:t=>r(e=>{if(t.componentId){const s=e.tabs.find(i=>i.componentId===t.componentId);if(s)return{tabs:e.tabs.map(i=>({...i,active:i.id===s.id}))}}const n={...t,id:`${t.type}-${Date.now()}`,active:!0};return{tabs:[...e.tabs.map(s=>({...s,active:!1})),n]}}),closeTab:t=>r(e=>{const n=e.tabs.filter(o=>o.id!==t);if(n.length===0)return{tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}]};const s=e.tabs.findIndex(o=>o.id===t);if(e.tabs[s]?.active&&n.length>0){const o=Math.min(s,n.length-1);n[o].active=!0}return{tabs:n}}),setActiveTab:t=>r(e=>({tabs:e.tabs.map(n=>({...n,active:n.id===t}))})),updateTab:(t,e)=>r(n=>({tabs:n.tabs.map(s=>s.id===t?{...s,...e}:s)}))}));function EL(r){const t=kL(r),e=C.forwardRef((n,s)=>{const{children:i,...o}=n,c=C.Children.toArray(i),u=c.find(AL);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}function kL(r){const t=C.forwardRef((e,n)=>{const{children:s,...i}=e;if(C.isValidElement(s)){const o=_L(s),c=DL(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var TL=Symbol("radix.slottable");function AL(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===TL}function DL(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function _L(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function Eu(r){const t=C.useRef({value:r,previous:r});return C.useMemo(()=>(t.current.value!==r&&(t.current.previous=t.current.value,t.current.value=r),t.current.previous),[r])}var IC=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),PL="VisuallyHidden",OC=C.forwardRef((r,t)=>g.jsx(De.span,{...r,ref:t,style:{...IC,...r.style}}));OC.displayName=PL;var p3=OC,NL=[" ","Enter","ArrowUp","ArrowDown"],jL=[" ","Enter"],wa="Select",[ku,Tu,LL]=hu(wa),[Do]=Cn(wa,[LL,Ao]),Au=Ao(),[zL,$i]=Do(wa),[IL,OL]=Do(wa),HC=r=>{const{__scopeSelect:t,children:e,open:n,defaultOpen:s,onOpenChange:i,value:o,defaultValue:c,onValueChange:u,dir:h,name:f,autoComplete:m,disabled:y,required:v,form:x}=r,S=Au(t),[R,M]=C.useState(null),[T,k]=C.useState(null),[A,_]=C.useState(!1),P=Eo(h),[z,q]=Es({prop:n,defaultProp:s??!1,onChange:i,caller:wa}),[Z,se]=Es({prop:o,defaultProp:c,onChange:u,caller:wa}),ce=C.useRef(null),J=R?x||!!R.closest("form"):!0,[te,le]=C.useState(new Set),ue=Array.from(te).map(L=>L.props.value).join(";");return g.jsx(Tp,{...S,children:g.jsxs(zL,{required:v,scope:t,trigger:R,onTriggerChange:M,valueNode:T,onValueNodeChange:k,valueNodeHasChildren:A,onValueNodeHasChildrenChange:_,contentId:rs(),value:Z,onValueChange:se,open:z,onOpenChange:q,dir:P,triggerPointerDownPosRef:ce,disabled:y,children:[g.jsx(ku.Provider,{scope:t,children:g.jsx(IL,{scope:r.__scopeSelect,onNativeOptionAdd:C.useCallback(L=>{le(N=>new Set(N).add(L))},[]),onNativeOptionRemove:C.useCallback(L=>{le(N=>{const O=new Set(N);return O.delete(L),O})},[]),children:e})}),J?g.jsxs(lS,{"aria-hidden":!0,required:v,tabIndex:-1,name:f,autoComplete:m,value:Z,onChange:L=>se(L.target.value),disabled:y,form:x,children:[Z===void 0?g.jsx("option",{value:""}):null,Array.from(te)]},ue):null]})})};HC.displayName=wa;var qC="SelectTrigger",$C=C.forwardRef((r,t)=>{const{__scopeSelect:e,disabled:n=!1,...s}=r,i=Au(e),o=$i(qC,e),c=o.disabled||n,u=Ne(t,o.onTriggerChange),h=Tu(e),f=C.useRef("touch"),[m,y,v]=dS(S=>{const R=h().filter(k=>!k.disabled),M=R.find(k=>k.value===o.value),T=hS(R,S,M);T!==void 0&&o.onValueChange(T.value)}),x=S=>{c||(o.onOpenChange(!0),v()),S&&(o.triggerPointerDownPosRef.current={x:Math.round(S.pageX),y:Math.round(S.pageY)})};return g.jsx(wu,{asChild:!0,...i,children:g.jsx(De.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":uS(o.value)?"":void 0,...s,ref:u,onClick:ge(s.onClick,S=>{S.currentTarget.focus(),f.current!=="mouse"&&x(S)}),onPointerDown:ge(s.onPointerDown,S=>{f.current=S.pointerType;const R=S.target;R.hasPointerCapture(S.pointerId)&&R.releasePointerCapture(S.pointerId),S.button===0&&S.ctrlKey===!1&&S.pointerType==="mouse"&&(x(S),S.preventDefault())}),onKeyDown:ge(s.onKeyDown,S=>{const R=m.current!=="";!(S.ctrlKey||S.altKey||S.metaKey)&&S.key.length===1&&y(S.key),!(R&&S.key===" ")&&NL.includes(S.key)&&(x(),S.preventDefault())})})})});$C.displayName=qC;var BC="SelectValue",UC=C.forwardRef((r,t)=>{const{__scopeSelect:e,className:n,style:s,children:i,placeholder:o="",...c}=r,u=$i(BC,e),{onValueNodeHasChildrenChange:h}=u,f=i!==void 0,m=Ne(t,u.onValueNodeChange);return rn(()=>{h(f)},[h,f]),g.jsx(De.span,{...c,ref:m,style:{pointerEvents:"none"},children:uS(u.value)?g.jsx(g.Fragment,{children:o}):i})});UC.displayName=BC;var HL="SelectIcon",FC=C.forwardRef((r,t)=>{const{__scopeSelect:e,children:n,...s}=r;return g.jsx(De.span,{"aria-hidden":!0,...s,ref:t,children:n||""})});FC.displayName=HL;var qL="SelectPortal",VC=r=>g.jsx(Vr,{asChild:!0,...r});VC.displayName=qL;var Ca="SelectContent",GC=C.forwardRef((r,t)=>{const e=$i(Ca,r.__scopeSelect),[n,s]=C.useState();if(rn(()=>{s(new DocumentFragment)},[]),!e.open){const i=n;return i?qr.createPortal(g.jsx(QC,{scope:r.__scopeSelect,children:g.jsx(ku.Slot,{scope:r.__scopeSelect,children:g.jsx("div",{children:r.children})})}),i):null}return g.jsx(KC,{...r,ref:t})});GC.displayName=Ca;var ns=10,[QC,Bi]=Do(Ca),$L="SelectContentImpl",BL=EL("SelectContent.RemoveScroll"),KC=C.forwardRef((r,t)=>{const{__scopeSelect:e,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:i,onPointerDownOutside:o,side:c,sideOffset:u,align:h,alignOffset:f,arrowPadding:m,collisionBoundary:y,collisionPadding:v,sticky:x,hideWhenDetached:S,avoidCollisions:R,...M}=r,T=$i(Ca,e),[k,A]=C.useState(null),[_,P]=C.useState(null),z=Ne(t,B=>A(B)),[q,Z]=C.useState(null),[se,ce]=C.useState(null),J=Tu(e),[te,le]=C.useState(!1),ue=C.useRef(!1);C.useEffect(()=>{if(k)return au(k)},[k]),su();const L=C.useCallback(B=>{const[Q,...pe]=J().map(ve=>ve.ref.current),[me]=pe.slice(-1),ye=document.activeElement;for(const ve of B)if(ve===ye||(ve?.scrollIntoView({block:"nearest"}),ve===Q&&_&&(_.scrollTop=0),ve===me&&_&&(_.scrollTop=_.scrollHeight),ve?.focus(),document.activeElement!==ye))return},[J,_]),N=C.useCallback(()=>L([q,k]),[L,q,k]);C.useEffect(()=>{te&&N()},[te,N]);const{onOpenChange:O,triggerPointerDownPosRef:W}=T;C.useEffect(()=>{if(k){let B={x:0,y:0};const Q=me=>{B={x:Math.abs(Math.round(me.pageX)-(W.current?.x??0)),y:Math.abs(Math.round(me.pageY)-(W.current?.y??0))}},pe=me=>{B.x<=10&&B.y<=10?me.preventDefault():k.contains(me.target)||O(!1),document.removeEventListener("pointermove",Q),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",Q),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Q),document.removeEventListener("pointerup",pe,{capture:!0})}}},[k,O,W]),C.useEffect(()=>{const B=()=>O(!1);return window.addEventListener("blur",B),window.addEventListener("resize",B),()=>{window.removeEventListener("blur",B),window.removeEventListener("resize",B)}},[O]);const[fe,j]=dS(B=>{const Q=J().filter(ye=>!ye.disabled),pe=Q.find(ye=>ye.ref.current===document.activeElement),me=hS(Q,B,pe);me&&setTimeout(()=>me.ref.current.focus())}),F=C.useCallback((B,Q,pe)=>{const me=!ue.current&&!pe;(T.value!==void 0&&T.value===Q||me)&&(Z(B),me&&(ue.current=!0))},[T.value]),Y=C.useCallback(()=>k?.focus(),[k]),ie=C.useCallback((B,Q,pe)=>{const me=!ue.current&&!pe;(T.value!==void 0&&T.value===Q||me)&&ce(B)},[T.value]),U=n==="popper"?Df:YC,ae=U===Df?{side:c,sideOffset:u,align:h,alignOffset:f,arrowPadding:m,collisionBoundary:y,collisionPadding:v,sticky:x,hideWhenDetached:S,avoidCollisions:R}:{};return g.jsx(QC,{scope:e,content:k,viewport:_,onViewportChange:P,itemRefCallback:F,selectedItem:q,onItemLeave:Y,itemTextRefCallback:ie,focusSelectedItem:N,selectedItemText:se,position:n,isPositioned:te,searchRef:fe,children:g.jsx(Gr,{as:BL,allowPinchZoom:!0,children:g.jsx(Fr,{asChild:!0,trapped:T.open,onMountAutoFocus:B=>{B.preventDefault()},onUnmountAutoFocus:ge(s,B=>{T.trigger?.focus({preventScroll:!0}),B.preventDefault()}),children:g.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:B=>B.preventDefault(),onDismiss:()=>T.onOpenChange(!1),children:g.jsx(U,{role:"listbox",id:T.contentId,"data-state":T.open?"open":"closed",dir:T.dir,onContextMenu:B=>B.preventDefault(),...M,...ae,onPlaced:()=>le(!0),ref:z,style:{display:"flex",flexDirection:"column",outline:"none",...M.style},onKeyDown:ge(M.onKeyDown,B=>{const Q=B.ctrlKey||B.altKey||B.metaKey;if(B.key==="Tab"&&B.preventDefault(),!Q&&B.key.length===1&&j(B.key),["ArrowUp","ArrowDown","Home","End"].includes(B.key)){let me=J().filter(ye=>!ye.disabled).map(ye=>ye.ref.current);if(["ArrowUp","End"].includes(B.key)&&(me=me.slice().reverse()),["ArrowUp","ArrowDown"].includes(B.key)){const ye=B.target,ve=me.indexOf(ye);me=me.slice(ve+1)}setTimeout(()=>L(me)),B.preventDefault()}})})})})})})});KC.displayName=$L;var UL="SelectItemAlignedPosition",YC=C.forwardRef((r,t)=>{const{__scopeSelect:e,onPlaced:n,...s}=r,i=$i(Ca,e),o=Bi(Ca,e),[c,u]=C.useState(null),[h,f]=C.useState(null),m=Ne(t,z=>f(z)),y=Tu(e),v=C.useRef(!1),x=C.useRef(!0),{viewport:S,selectedItem:R,selectedItemText:M,focusSelectedItem:T}=o,k=C.useCallback(()=>{if(i.trigger&&i.valueNode&&c&&h&&S&&R&&M){const z=i.trigger.getBoundingClientRect(),q=h.getBoundingClientRect(),Z=i.valueNode.getBoundingClientRect(),se=M.getBoundingClientRect();if(i.dir!=="rtl"){const ye=se.left-q.left,ve=Z.left-ye,je=z.left-ve,Be=z.width+je,at=Math.max(Be,q.width),Je=window.innerWidth-ns,Nt=Nr(ve,[ns,Math.max(ns,Je-at)]);c.style.minWidth=Be+"px",c.style.left=Nt+"px"}else{const ye=q.right-se.right,ve=window.innerWidth-Z.right-ye,je=window.innerWidth-z.right-ve,Be=z.width+je,at=Math.max(Be,q.width),Je=window.innerWidth-ns,Nt=Nr(ve,[ns,Math.max(ns,Je-at)]);c.style.minWidth=Be+"px",c.style.right=Nt+"px"}const ce=y(),J=window.innerHeight-ns*2,te=S.scrollHeight,le=window.getComputedStyle(h),ue=parseInt(le.borderTopWidth,10),L=parseInt(le.paddingTop,10),N=parseInt(le.borderBottomWidth,10),O=parseInt(le.paddingBottom,10),W=ue+L+te+O+N,fe=Math.min(R.offsetHeight*5,W),j=window.getComputedStyle(S),F=parseInt(j.paddingTop,10),Y=parseInt(j.paddingBottom,10),ie=z.top+z.height/2-ns,U=J-ie,ae=R.offsetHeight/2,B=R.offsetTop+ae,Q=ue+L+B,pe=W-Q;if(Q<=ie){const ye=ce.length>0&&R===ce[ce.length-1].ref.current;c.style.bottom="0px";const ve=h.clientHeight-S.offsetTop-S.offsetHeight,je=Math.max(U,ae+(ye?Y:0)+ve+N),Be=Q+je;c.style.height=Be+"px"}else{const ye=ce.length>0&&R===ce[0].ref.current;c.style.top="0px";const je=Math.max(ie,ue+S.offsetTop+(ye?F:0)+ae)+pe;c.style.height=je+"px",S.scrollTop=Q-ie+S.offsetTop}c.style.margin=`${ns}px 0`,c.style.minHeight=fe+"px",c.style.maxHeight=J+"px",n?.(),requestAnimationFrame(()=>v.current=!0)}},[y,i.trigger,i.valueNode,c,h,S,R,M,i.dir,n]);rn(()=>k(),[k]);const[A,_]=C.useState();rn(()=>{h&&_(window.getComputedStyle(h).zIndex)},[h]);const P=C.useCallback(z=>{z&&x.current===!0&&(k(),T?.(),x.current=!1)},[k,T]);return g.jsx(VL,{scope:e,contentWrapper:c,shouldExpandOnScrollRef:v,onScrollButtonChange:P,children:g.jsx("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:g.jsx(De.div,{...s,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});YC.displayName=UL;var FL="SelectPopperPosition",Df=C.forwardRef((r,t)=>{const{__scopeSelect:e,align:n="start",collisionPadding:s=ns,...i}=r,o=Au(e);return g.jsx(Ap,{...o,...i,ref:t,align:n,collisionPadding:s,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Df.displayName=FL;var[VL,Op]=Do(Ca,{}),_f="SelectViewport",WC=C.forwardRef((r,t)=>{const{__scopeSelect:e,nonce:n,...s}=r,i=Bi(_f,e),o=Op(_f,e),c=Ne(t,i.onViewportChange),u=C.useRef(0);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),g.jsx(ku.Slot,{scope:e,children:g.jsx(De.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:ge(s.onScroll,h=>{const f=h.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:y}=o;if(y?.current&&m){const v=Math.abs(u.current-f.scrollTop);if(v>0){const x=window.innerHeight-ns*2,S=parseFloat(m.style.minHeight),R=parseFloat(m.style.height),M=Math.max(S,R);if(M<x){const T=M+v,k=Math.min(x,T),A=T-k;m.style.height=k+"px",m.style.bottom==="0px"&&(f.scrollTop=A>0?A:0,m.style.justifyContent="flex-end")}}}u.current=f.scrollTop})})})]})});WC.displayName=_f;var XC="SelectGroup",[GL,QL]=Do(XC),KL=C.forwardRef((r,t)=>{const{__scopeSelect:e,...n}=r,s=rs();return g.jsx(GL,{scope:e,id:s,children:g.jsx(De.div,{role:"group","aria-labelledby":s,...n,ref:t})})});KL.displayName=XC;var JC="SelectLabel",ZC=C.forwardRef((r,t)=>{const{__scopeSelect:e,...n}=r,s=QL(JC,e);return g.jsx(De.div,{id:s.id,...n,ref:t})});ZC.displayName=JC;var Yl="SelectItem",[YL,eS]=Do(Yl),tS=C.forwardRef((r,t)=>{const{__scopeSelect:e,value:n,disabled:s=!1,textValue:i,...o}=r,c=$i(Yl,e),u=Bi(Yl,e),h=c.value===n,[f,m]=C.useState(i??""),[y,v]=C.useState(!1),x=Ne(t,T=>u.itemRefCallback?.(T,n,s)),S=rs(),R=C.useRef("touch"),M=()=>{s||(c.onValueChange(n),c.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return g.jsx(YL,{scope:e,value:n,disabled:s,textId:S,isSelected:h,onItemTextChange:C.useCallback(T=>{m(k=>k||(T?.textContent??"").trim())},[]),children:g.jsx(ku.ItemSlot,{scope:e,value:n,disabled:s,textValue:f,children:g.jsx(De.div,{role:"option","aria-labelledby":S,"data-highlighted":y?"":void 0,"aria-selected":h&&y,"data-state":h?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...o,ref:x,onFocus:ge(o.onFocus,()=>v(!0)),onBlur:ge(o.onBlur,()=>v(!1)),onClick:ge(o.onClick,()=>{R.current!=="mouse"&&M()}),onPointerUp:ge(o.onPointerUp,()=>{R.current==="mouse"&&M()}),onPointerDown:ge(o.onPointerDown,T=>{R.current=T.pointerType}),onPointerMove:ge(o.onPointerMove,T=>{R.current=T.pointerType,s?u.onItemLeave?.():R.current==="mouse"&&T.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ge(o.onPointerLeave,T=>{T.currentTarget===document.activeElement&&u.onItemLeave?.()}),onKeyDown:ge(o.onKeyDown,T=>{u.searchRef?.current!==""&&T.key===" "||(jL.includes(T.key)&&M(),T.key===" "&&T.preventDefault())})})})})});tS.displayName=Yl;var Tr="SelectItemText",nS=C.forwardRef((r,t)=>{const{__scopeSelect:e,className:n,style:s,...i}=r,o=$i(Tr,e),c=Bi(Tr,e),u=eS(Tr,e),h=OL(Tr,e),[f,m]=C.useState(null),y=Ne(t,M=>m(M),u.onItemTextChange,M=>c.itemTextRefCallback?.(M,u.value,u.disabled)),v=f?.textContent,x=C.useMemo(()=>g.jsx("option",{value:u.value,disabled:u.disabled,children:v},u.value),[u.disabled,u.value,v]),{onNativeOptionAdd:S,onNativeOptionRemove:R}=h;return rn(()=>(S(x),()=>R(x)),[S,R,x]),g.jsxs(g.Fragment,{children:[g.jsx(De.span,{id:u.textId,...i,ref:y}),u.isSelected&&o.valueNode&&!o.valueNodeHasChildren?qr.createPortal(i.children,o.valueNode):null]})});nS.displayName=Tr;var sS="SelectItemIndicator",iS=C.forwardRef((r,t)=>{const{__scopeSelect:e,...n}=r;return eS(sS,e).isSelected?g.jsx(De.span,{"aria-hidden":!0,...n,ref:t}):null});iS.displayName=sS;var Pf="SelectScrollUpButton",aS=C.forwardRef((r,t)=>{const e=Bi(Pf,r.__scopeSelect),n=Op(Pf,r.__scopeSelect),[s,i]=C.useState(!1),o=Ne(t,n.onScrollButtonChange);return rn(()=>{if(e.viewport&&e.isPositioned){let c=function(){const h=u.scrollTop>0;i(h)};const u=e.viewport;return c(),u.addEventListener("scroll",c),()=>u.removeEventListener("scroll",c)}},[e.viewport,e.isPositioned]),s?g.jsx(rS,{...r,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:u}=e;c&&u&&(c.scrollTop=c.scrollTop-u.offsetHeight)}}):null});aS.displayName=Pf;var Nf="SelectScrollDownButton",oS=C.forwardRef((r,t)=>{const e=Bi(Nf,r.__scopeSelect),n=Op(Nf,r.__scopeSelect),[s,i]=C.useState(!1),o=Ne(t,n.onScrollButtonChange);return rn(()=>{if(e.viewport&&e.isPositioned){let c=function(){const h=u.scrollHeight-u.clientHeight,f=Math.ceil(u.scrollTop)<h;i(f)};const u=e.viewport;return c(),u.addEventListener("scroll",c),()=>u.removeEventListener("scroll",c)}},[e.viewport,e.isPositioned]),s?g.jsx(rS,{...r,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:u}=e;c&&u&&(c.scrollTop=c.scrollTop+u.offsetHeight)}}):null});oS.displayName=Nf;var rS=C.forwardRef((r,t)=>{const{__scopeSelect:e,onAutoScroll:n,...s}=r,i=Bi("SelectScrollButton",e),o=C.useRef(null),c=Tu(e),u=C.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return C.useEffect(()=>()=>u(),[u]),rn(()=>{c().find(f=>f.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),g.jsx(De.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:ge(s.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(n,50))}),onPointerMove:ge(s.onPointerMove,()=>{i.onItemLeave?.(),o.current===null&&(o.current=window.setInterval(n,50))}),onPointerLeave:ge(s.onPointerLeave,()=>{u()})})}),WL="SelectSeparator",cS=C.forwardRef((r,t)=>{const{__scopeSelect:e,...n}=r;return g.jsx(De.div,{"aria-hidden":!0,...n,ref:t})});cS.displayName=WL;var jf="SelectArrow",XL=C.forwardRef((r,t)=>{const{__scopeSelect:e,...n}=r,s=Au(e),i=$i(jf,e),o=Bi(jf,e);return i.open&&o.position==="popper"?g.jsx(Dp,{...s,...n,ref:t}):null});XL.displayName=jf;var JL="SelectBubbleInput",lS=C.forwardRef(({__scopeSelect:r,value:t,...e},n)=>{const s=C.useRef(null),i=Ne(n,s),o=Eu(t);return C.useEffect(()=>{const c=s.current;if(!c)return;const u=window.HTMLSelectElement.prototype,f=Object.getOwnPropertyDescriptor(u,"value").set;if(o!==t&&f){const m=new Event("change",{bubbles:!0});f.call(c,t),c.dispatchEvent(m)}},[o,t]),g.jsx(De.select,{...e,style:{...IC,...e.style},ref:i,defaultValue:t})});lS.displayName=JL;function uS(r){return r===""||r===void 0}function dS(r){const t=on(r),e=C.useRef(""),n=C.useRef(0),s=C.useCallback(o=>{const c=e.current+o;t(c),(function u(h){e.current=h,window.clearTimeout(n.current),h!==""&&(n.current=window.setTimeout(()=>u(""),1e3))})(c)},[t]),i=C.useCallback(()=>{e.current="",window.clearTimeout(n.current)},[]);return C.useEffect(()=>()=>window.clearTimeout(n.current),[]),[e,s,i]}function hS(r,t,e){const s=t.length>1&&Array.from(t).every(h=>h===t[0])?t[0]:t,i=e?r.indexOf(e):-1;let o=ZL(r,Math.max(i,0));s.length===1&&(o=o.filter(h=>h!==e));const u=o.find(h=>h.textValue.toLowerCase().startsWith(s.toLowerCase()));return u!==e?u:void 0}function ZL(r,t){return r.map((e,n)=>r[(t+n)%r.length])}var ez=HC,fS=$C,tz=UC,nz=FC,sz=VC,pS=GC,iz=WC,gS=ZC,mS=tS,az=nS,oz=iS,yS=aS,vS=oS,bS=cS;const Pl=ez,Nl=tz,Dr=C.forwardRef(({className:r,children:t,...e},n)=>g.jsxs(fS,{ref:n,className:ke("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...e,children:[t,g.jsx(nz,{asChild:!0,children:g.jsx(Jl,{className:"h-4 w-4 opacity-50"})})]}));Dr.displayName=fS.displayName;const xS=C.forwardRef(({className:r,...t},e)=>g.jsx(yS,{ref:e,className:ke("flex cursor-default items-center justify-center py-1",r),...t,children:g.jsx(Ab,{className:"h-4 w-4"})}));xS.displayName=yS.displayName;const wS=C.forwardRef(({className:r,...t},e)=>g.jsx(vS,{ref:e,className:ke("flex cursor-default items-center justify-center py-1",r),...t,children:g.jsx(Jl,{className:"h-4 w-4"})}));wS.displayName=vS.displayName;const _r=C.forwardRef(({className:r,children:t,position:e="popper",...n},s)=>g.jsx(sz,{children:g.jsxs(pS,{ref:s,className:ke("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",e==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:e,...n,children:[g.jsx(xS,{}),g.jsx(iz,{className:ke("p-1",e==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),g.jsx(wS,{})]})}));_r.displayName=pS.displayName;const rz=C.forwardRef(({className:r,...t},e)=>g.jsx(gS,{ref:e,className:ke("px-2 py-1.5 text-sm font-semibold",r),...t}));rz.displayName=gS.displayName;const Vt=C.forwardRef(({className:r,children:t,...e},n)=>g.jsxs(mS,{ref:n,className:ke("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...e,children:[g.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(oz,{children:g.jsx(Wf,{className:"h-4 w-4"})})}),g.jsx(az,{children:t})]}));Vt.displayName=mS.displayName;const cz=C.forwardRef(({className:r,...t},e)=>g.jsx(bS,{ref:e,className:ke("-mx-1 my-1 h-px bg-muted",r),...t}));cz.displayName=bS.displayName;var CS=["PageUp","PageDown"],SS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],MS={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},_o="Slider",[Lf,lz,uz]=hu(_o),[RS]=Cn(_o,[uz]),[dz,Du]=RS(_o),ES=C.forwardRef((r,t)=>{const{name:e,min:n=0,max:s=100,step:i=1,orientation:o="horizontal",disabled:c=!1,minStepsBetweenThumbs:u=0,defaultValue:h=[n],value:f,onValueChange:m=()=>{},onValueCommit:y=()=>{},inverted:v=!1,form:x,...S}=r,R=C.useRef(new Set),M=C.useRef(0),k=o==="horizontal"?hz:fz,[A=[],_]=Es({prop:f,defaultProp:h,onChange:ce=>{[...R.current][M.current]?.focus(),m(ce)}}),P=C.useRef(A);function z(ce){const J=vz(A,ce);se(ce,J)}function q(ce){se(ce,M.current)}function Z(){const ce=P.current[M.current];A[M.current]!==ce&&y(A)}function se(ce,J,{commit:te}={commit:!1}){const le=Cz(i),ue=Sz(Math.round((ce-n)/i)*i+n,le),L=Nr(ue,[n,s]);_((N=[])=>{const O=mz(N,L,J);if(wz(O,u*i)){M.current=O.indexOf(L);const W=String(O)!==String(N);return W&&te&&y(O),W?O:N}else return N})}return g.jsx(dz,{scope:r.__scopeSlider,name:e,disabled:c,min:n,max:s,valueIndexToChangeRef:M,thumbs:R.current,values:A,orientation:o,form:x,children:g.jsx(Lf.Provider,{scope:r.__scopeSlider,children:g.jsx(Lf.Slot,{scope:r.__scopeSlider,children:g.jsx(k,{"aria-disabled":c,"data-disabled":c?"":void 0,...S,ref:t,onPointerDown:ge(S.onPointerDown,()=>{c||(P.current=A)}),min:n,max:s,inverted:v,onSlideStart:c?void 0:z,onSlideMove:c?void 0:q,onSlideEnd:c?void 0:Z,onHomeKeyDown:()=>!c&&se(n,0,{commit:!0}),onEndKeyDown:()=>!c&&se(s,A.length-1,{commit:!0}),onStepKeyDown:({event:ce,direction:J})=>{if(!c){const ue=CS.includes(ce.key)||ce.shiftKey&&SS.includes(ce.key)?10:1,L=M.current,N=A[L],O=i*ue*J;se(N+O,L,{commit:!0})}}})})})})});ES.displayName=_o;var[kS,TS]=RS(_o,{startEdge:"left",endEdge:"right",size:"width",direction:1}),hz=C.forwardRef((r,t)=>{const{min:e,max:n,dir:s,inverted:i,onSlideStart:o,onSlideMove:c,onSlideEnd:u,onStepKeyDown:h,...f}=r,[m,y]=C.useState(null),v=Ne(t,k=>y(k)),x=C.useRef(void 0),S=Eo(s),R=S==="ltr",M=R&&!i||!R&&i;function T(k){const A=x.current||m.getBoundingClientRect(),_=[0,A.width],z=Hp(_,M?[e,n]:[n,e]);return x.current=A,z(k-A.left)}return g.jsx(kS,{scope:r.__scopeSlider,startEdge:M?"left":"right",endEdge:M?"right":"left",direction:M?1:-1,size:"width",children:g.jsx(AS,{dir:S,"data-orientation":"horizontal",...f,ref:v,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:k=>{const A=T(k.clientX);o?.(A)},onSlideMove:k=>{const A=T(k.clientX);c?.(A)},onSlideEnd:()=>{x.current=void 0,u?.()},onStepKeyDown:k=>{const _=MS[M?"from-left":"from-right"].includes(k.key);h?.({event:k,direction:_?-1:1})}})})}),fz=C.forwardRef((r,t)=>{const{min:e,max:n,inverted:s,onSlideStart:i,onSlideMove:o,onSlideEnd:c,onStepKeyDown:u,...h}=r,f=C.useRef(null),m=Ne(t,f),y=C.useRef(void 0),v=!s;function x(S){const R=y.current||f.current.getBoundingClientRect(),M=[0,R.height],k=Hp(M,v?[n,e]:[e,n]);return y.current=R,k(S-R.top)}return g.jsx(kS,{scope:r.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:g.jsx(AS,{"data-orientation":"vertical",...h,ref:m,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:S=>{const R=x(S.clientY);i?.(R)},onSlideMove:S=>{const R=x(S.clientY);o?.(R)},onSlideEnd:()=>{y.current=void 0,c?.()},onStepKeyDown:S=>{const M=MS[v?"from-bottom":"from-top"].includes(S.key);u?.({event:S,direction:M?-1:1})}})})}),AS=C.forwardRef((r,t)=>{const{__scopeSlider:e,onSlideStart:n,onSlideMove:s,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:c,onStepKeyDown:u,...h}=r,f=Du(_o,e);return g.jsx(De.span,{...h,ref:t,onKeyDown:ge(r.onKeyDown,m=>{m.key==="Home"?(o(m),m.preventDefault()):m.key==="End"?(c(m),m.preventDefault()):CS.concat(SS).includes(m.key)&&(u(m),m.preventDefault())}),onPointerDown:ge(r.onPointerDown,m=>{const y=m.target;y.setPointerCapture(m.pointerId),m.preventDefault(),f.thumbs.has(y)?y.focus():n(m)}),onPointerMove:ge(r.onPointerMove,m=>{m.target.hasPointerCapture(m.pointerId)&&s(m)}),onPointerUp:ge(r.onPointerUp,m=>{const y=m.target;y.hasPointerCapture(m.pointerId)&&(y.releasePointerCapture(m.pointerId),i(m))})})}),DS="SliderTrack",_S=C.forwardRef((r,t)=>{const{__scopeSlider:e,...n}=r,s=Du(DS,e);return g.jsx(De.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:t})});_S.displayName=DS;var zf="SliderRange",PS=C.forwardRef((r,t)=>{const{__scopeSlider:e,...n}=r,s=Du(zf,e),i=TS(zf,e),o=C.useRef(null),c=Ne(t,o),u=s.values.length,h=s.values.map(y=>LS(y,s.min,s.max)),f=u>1?Math.min(...h):0,m=100-Math.max(...h);return g.jsx(De.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:c,style:{...r.style,[i.startEdge]:f+"%",[i.endEdge]:m+"%"}})});PS.displayName=zf;var If="SliderThumb",NS=C.forwardRef((r,t)=>{const e=lz(r.__scopeSlider),[n,s]=C.useState(null),i=Ne(t,c=>s(c)),o=C.useMemo(()=>n?e().findIndex(c=>c.ref.current===n):-1,[e,n]);return g.jsx(pz,{...r,ref:i,index:o})}),pz=C.forwardRef((r,t)=>{const{__scopeSlider:e,index:n,name:s,...i}=r,o=Du(If,e),c=TS(If,e),[u,h]=C.useState(null),f=Ne(t,T=>h(T)),m=u?o.form||!!u.closest("form"):!0,y=xu(u),v=o.values[n],x=v===void 0?0:LS(v,o.min,o.max),S=yz(n,o.values.length),R=y?.[c.size],M=R?bz(R,x,c.direction):0;return C.useEffect(()=>{if(u)return o.thumbs.add(u),()=>{o.thumbs.delete(u)}},[u,o.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${x}% + ${M}px)`},children:[g.jsx(Lf.ItemSlot,{scope:r.__scopeSlider,children:g.jsx(De.span,{role:"slider","aria-label":r["aria-label"]||S,"aria-valuemin":o.min,"aria-valuenow":v,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:f,style:v===void 0?{display:"none"}:r.style,onFocus:ge(r.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),m&&g.jsx(jS,{name:s??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:v},n)]})});NS.displayName=If;var gz="RadioBubbleInput",jS=C.forwardRef(({__scopeSlider:r,value:t,...e},n)=>{const s=C.useRef(null),i=Ne(s,n),o=Eu(t);return C.useEffect(()=>{const c=s.current;if(!c)return;const u=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(u,"value").set;if(o!==t&&f){const m=new Event("input",{bubbles:!0});f.call(c,t),c.dispatchEvent(m)}},[o,t]),g.jsx(De.input,{style:{display:"none"},...e,ref:i,defaultValue:t})});jS.displayName=gz;function mz(r=[],t,e){const n=[...r];return n[e]=t,n.sort((s,i)=>s-i)}function LS(r,t,e){const i=100/(e-t)*(r-t);return Nr(i,[0,100])}function yz(r,t){return t>2?`Value ${r+1} of ${t}`:t===2?["Minimum","Maximum"][r]:void 0}function vz(r,t){if(r.length===1)return 0;const e=r.map(s=>Math.abs(s-t)),n=Math.min(...e);return e.indexOf(n)}function bz(r,t,e){const n=r/2,i=Hp([0,50],[0,n]);return(n-i(t)*e)*e}function xz(r){return r.slice(0,-1).map((t,e)=>r[e+1]-t)}function wz(r,t){if(t>0){const e=xz(r);return Math.min(...e)>=t}return!0}function Hp(r,t){return e=>{if(r[0]===r[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(r[1]-r[0]);return t[0]+n*(e-r[0])}}function Cz(r){return(String(r).split(".")[1]||"").length}function Sz(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}var zS=ES,Mz=_S,Rz=PS,Ez=NS;const is=C.forwardRef(({className:r,...t},e)=>g.jsxs(zS,{ref:e,className:ke("relative flex w-full touch-none select-none items-center",r),...t,children:[g.jsx(Mz,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:g.jsx(Rz,{className:"absolute h-full bg-primary"})}),g.jsx(Ez,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));is.displayName=zS.displayName;var _u="Switch",[kz]=Cn(_u),[Tz,Az]=kz(_u),IS=C.forwardRef((r,t)=>{const{__scopeSwitch:e,name:n,checked:s,defaultChecked:i,required:o,disabled:c,value:u="on",onCheckedChange:h,form:f,...m}=r,[y,v]=C.useState(null),x=Ne(t,k=>v(k)),S=C.useRef(!1),R=y?f||!!y.closest("form"):!0,[M,T]=Es({prop:s,defaultProp:i??!1,onChange:h,caller:_u});return g.jsxs(Tz,{scope:e,checked:M,disabled:c,children:[g.jsx(De.button,{type:"button",role:"switch","aria-checked":M,"aria-required":o,"data-state":$S(M),"data-disabled":c?"":void 0,disabled:c,value:u,...m,ref:x,onClick:ge(r.onClick,k=>{T(A=>!A),R&&(S.current=k.isPropagationStopped(),S.current||k.stopPropagation())})}),R&&g.jsx(qS,{control:y,bubbles:!S.current,name:n,value:u,checked:M,required:o,disabled:c,form:f,style:{transform:"translateX(-100%)"}})]})});IS.displayName=_u;var OS="SwitchThumb",HS=C.forwardRef((r,t)=>{const{__scopeSwitch:e,...n}=r,s=Az(OS,e);return g.jsx(De.span,{"data-state":$S(s.checked),"data-disabled":s.disabled?"":void 0,...n,ref:t})});HS.displayName=OS;var Dz="SwitchBubbleInput",qS=C.forwardRef(({__scopeSwitch:r,control:t,checked:e,bubbles:n=!0,...s},i)=>{const o=C.useRef(null),c=Ne(o,i),u=Eu(e),h=xu(t);return C.useEffect(()=>{const f=o.current;if(!f)return;const m=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(m,"checked").set;if(u!==e&&v){const x=new Event("click",{bubbles:n});v.call(f,e),f.dispatchEvent(x)}},[u,e,n]),g.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...s,tabIndex:-1,ref:c,style:{...s.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});qS.displayName=Dz;function $S(r){return r?"checked":"unchecked"}var BS=IS,_z=HS;const fa=C.forwardRef(({className:r,...t},e)=>g.jsx(BS,{className:ke("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...t,ref:e,children:g.jsx(_z,{className:ke("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));fa.displayName=BS.displayName;const wn=C.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("rounded-xl border bg-card text-card-foreground shadow",r),...t}));wn.displayName="Card";const Ss=C.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("flex flex-col space-y-1.5 p-6",r),...t}));Ss.displayName="CardHeader";const Ms=C.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("font-semibold leading-none tracking-tight",r),...t}));Ms.displayName="CardTitle";const ga=C.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("text-sm text-muted-foreground",r),...t}));ga.displayName="CardDescription";const Rs=C.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("p-6 pt-0",r),...t}));Rs.displayName="CardContent";const Pz=C.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("flex items-center p-6 pt-0",r),...t}));Pz.displayName="CardFooter";const Nz=Ff("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ft({className:r,variant:t,...e}){return g.jsx("div",{className:ke(Nz({variant:t}),r),...e})}const Pr={heading:{h1:"text-2xl font-bold text-foreground",h2:"text-lg font-semibold text-foreground",h3:"text-sm font-semibold text-foreground",h4:"text-xs font-semibold text-foreground",h5:"text-[10px] font-semibold text-muted-foreground uppercase"},body:{base:"text-sm text-foreground",small:"text-xs text-foreground",micro:"text-[10px] text-foreground"},muted:{base:"text-sm text-muted-foreground",small:"text-xs text-muted-foreground",micro:"text-[10px] text-muted-foreground"},mono:{base:"font-mono text-sm text-foreground",small:"font-mono text-xs text-foreground",micro:"font-mono text-[10px] text-foreground"},status:{success:"text-success",warning:"text-warning",error:"text-destructive",info:"text-primary"}},ws=C.forwardRef(({level:r,as:t,className:e,children:n,...s},i)=>{const o=t||`h${r}`,c=`h${r}`;return g.jsx(o,{ref:i,className:ke(Pr.heading[c],e),...s,children:n})});ws.displayName="Heading";const We=C.forwardRef(({size:r="base",muted:t=!1,mono:e=!1,as:n="p",className:s,children:i,...o},c)=>{const u=n;let h;return e?h=Pr.mono[r]:t?h=Pr.muted[r]:h=Pr.body[r],g.jsx(u,{ref:c,className:ke(h,s),...o,children:i})});We.displayName="Text";const da=C.forwardRef(({status:r,size:t="base",weight:e="normal",as:n="span",className:s,children:i,...o},c)=>{const u=n,h={base:"text-sm",small:"text-xs",micro:"text-[10px]"},f={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};return g.jsx(u,{ref:c,className:ke(h[t],f[e],Pr.status[r],s),...o,children:i})});da.displayName="StatusText";const jz=C.forwardRef(({as:r="h2",className:t,children:e,...n},s)=>g.jsx(ws,{ref:s,level:1,as:r,className:t,...n,children:e}));jz.displayName="PageTitle";const Lz=C.forwardRef(({as:r="h3",className:t,children:e,...n},s)=>g.jsx(ws,{ref:s,level:2,as:r,className:t,...n,children:e}));Lz.displayName="SectionTitle";const ti=C.forwardRef(({as:r="h3",className:t,children:e,...n},s)=>g.jsx(ws,{ref:s,level:3,as:r,className:t,...n,children:e}));ti.displayName="PanelTitle";const zz=C.forwardRef(({as:r="p",className:t,children:e,...n},s)=>g.jsx(We,{ref:s,size:"base",muted:!0,as:r,className:ke("mt-1",t),...n,children:e}));zz.displayName="Description";function Iz({connection:r,onUpdate:t}){const e=r.data||{},{isRunning:n}=Pt(),{getConnectionMessages:s,getMessageHistory:i}=Li(),[o,c]=C.useState([]),[u,h]=C.useState([]);C.useEffect(()=>{if(!n){c([]),h([]);return}const M=setInterval(()=>{const T=s(r.id),k=i(50).filter(A=>A.connectionId===r.id);c(T),h(k)},200);return()=>clearInterval(M)},[n,r.id,s,i]);const f=M=>{const T={...e,...M};t(r.id,{data:T})},m=M=>{f({latencyMs:Math.max(0,M)})},y=M=>{f({bandwidthMbps:Math.max(1,M)})},v=M=>{f({packetLossPercent:Math.max(0,Math.min(100,M))})},x=M=>{f({jitterMs:Math.max(0,M)})},S=M=>{f({retryCount:Math.max(0,M)})},R=M=>{f({timeoutMs:Math.max(1e3,M)})};return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx(ti,{children:"Connection"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs(We,{size:"micro",muted:!0,children:["From: ",r.source]}),g.jsxs(We,{size:"micro",muted:!0,children:["To: ",r.target]}),g.jsxs(We,{size:"micro",muted:!0,children:["Type: ",r.type]})]})]}),g.jsxs("div",{className:"border-t border-border pt-2 space-y-2",children:[g.jsxs("div",{children:[g.jsx(ws,{level:5,className:"mb-1.5 opacity-70",children:"Network Parameters"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(it,{className:"text-xs",children:"Latency (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.latencyMs??0})]}),g.jsx(is,{value:[e.latencyMs??0],onValueChange:M=>m(M[0]),min:0,max:5e3,step:10,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.latencyMs??0,onChange:M=>m(parseInt(M.target.value)||0),placeholder:"0-5000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(it,{className:"text-xs",children:"Bandwidth (Mbps)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.bandwidthMbps??1e3})]}),g.jsx(is,{value:[e.bandwidthMbps??1e3],onValueChange:M=>y(M[0]),min:1,max:1e5,step:10,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.bandwidthMbps??1e3,onChange:M=>y(parseInt(M.target.value)||1e3),placeholder:"1-100000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(it,{className:"text-xs",children:"Packet Loss (%)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.packetLossPercent??0})]}),g.jsx(is,{value:[e.packetLossPercent??0],onValueChange:M=>v(M[0]),min:0,max:100,step:.1,className:"w-full"}),g.jsx(Tt,{type:"number",step:"0.1",value:e.packetLossPercent??0,onChange:M=>v(parseFloat(M.target.value)||0),placeholder:"0-100",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(it,{className:"text-xs",children:"Jitter (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.jitterMs??0})]}),g.jsx(is,{value:[e.jitterMs??0],onValueChange:M=>x(M[0]),min:0,max:1e3,step:5,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.jitterMs??0,onChange:M=>x(parseInt(M.target.value)||0),placeholder:"0-1000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx("h4",{className:"text-[9px] font-semibold text-foreground mb-1.5 uppercase opacity-70",children:"Traffic Characteristics"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsx(it,{className:"text-xs",children:"Priority Level"}),g.jsxs(Pl,{value:e.priorityLevel||"medium",onValueChange:M=>f({priorityLevel:M}),children:[g.jsx(Dr,{className:"h-7 text-[11px]",children:g.jsx(Nl,{})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"low",children:"Low"}),g.jsx(Vt,{value:"medium",children:"Medium"}),g.jsx(Vt,{value:"high",children:"High"}),g.jsx(Vt,{value:"critical",children:"Critical"})]})]})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(it,{className:"text-xs",children:"Retry Count"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.retryCount??3})]}),g.jsx(is,{value:[e.retryCount??3],onValueChange:M=>S(M[0]),min:0,max:10,step:1,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.retryCount??3,onChange:M=>S(parseInt(M.target.value)||0),placeholder:"0-10",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(it,{className:"text-xs",children:"Timeout (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.timeoutMs??3e4})]}),g.jsx(is,{value:[e.timeoutMs??3e4],onValueChange:M=>R(M[0]),min:1e3,max:12e4,step:1e3,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.timeoutMs??3e4,onChange:M=>R(parseInt(M.target.value)||3e4),placeholder:"1000-120000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx(ws,{level:5,className:"mb-1.5 opacity-70",children:"Monitoring"}),g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-accent/20 rounded-md",children:[g.jsx(it,{className:"text-xs cursor-pointer",children:"Enable Monitoring"}),g.jsx(fa,{checked:e.enableMonitoring??!1,onCheckedChange:M=>f({enableMonitoring:M})})]})]}),g.jsx(wn,{className:"bg-card/50 border-border/50 p-1.5 mt-2",children:g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Bandwidth:"}),g.jsxs(We,{mono:!0,size:"micro",children:[Math.max(1,(e.bandwidthMbps??1e3)*(1-(e.packetLossPercent??0)/100)).toFixed(2)," Mbps"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Latency:"}),g.jsxs(We,{mono:!0,size:"micro",children:[((e.latencyMs??0)+(e.jitterMs??0)/2).toFixed(0)," ms"]})]})]})}),n&&g.jsx("div",{className:"border-t border-border pt-2 mt-2",children:g.jsxs(bp,{defaultValue:"active",className:"w-full",children:[g.jsxs(gu,{className:"grid w-full grid-cols-2 h-7",children:[g.jsxs(ss,{value:"active",className:"text-xs px-2",children:[g.jsx(ya,{className:"h-3 w-3 mr-1"}),"Active (",o.length,")"]}),g.jsxs(ss,{value:"history",className:"text-xs px-2",children:[g.jsx(dv,{className:"h-3 w-3 mr-1"}),"History (",u.length,")"]})]}),g.jsx(ni,{value:"active",className:"mt-1.5 space-y-1",children:o.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(ya,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"No active messages"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:o.map((M,T)=>g.jsxs(wn,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(ft,{variant:"outline",className:"text-xs px-0.5 py-0",children:M.format}),g.jsx(ft,{variant:M.status==="delivered"?"default":M.status==="failed"?"destructive":M.status==="transformed"?"secondary":"outline",className:"text-xs px-0.5 py-0",children:M.status})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(M.size/1024).toFixed(2)," KB"]}),M.latency&&g.jsxs("div",{children:["Latency: ",M.latency.toFixed(0)," ms"]})]}),M.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(va,{className:"h-2.5 w-2.5"}),M.error]})]})}),M.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(M.payload,null,2)})]})]},M.id||T))})}),g.jsx(ni,{value:"history",className:"mt-1.5 space-y-1",children:u.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(dv,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"History is empty"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:u.map((M,T)=>g.jsxs(wn,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(ft,{variant:"outline",className:"text-xs px-0.5 py-0",children:M.format}),g.jsx(ft,{variant:M.status==="delivered"?"default":M.status==="failed"?"destructive":"outline",className:"text-xs px-0.5 py-0",children:M.status}),g.jsx("span",{className:"text-[9px] text-muted-foreground",children:new Date(M.timestamp).toLocaleTimeString()})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(M.size/1024).toFixed(2)," KB"]}),M.latency&&g.jsxs("div",{children:["Latency: ",M.latency.toFixed(0)," ms"]})]}),M.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(va,{className:"h-2.5 w-2.5"}),M.error]})]})}),M.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(M.payload,null,2)})]})]},M.id||T))})})]})})]})]})}function Oz(r){const t=Hz(r),e=C.forwardRef((n,s)=>{const{children:i,...o}=n,c=C.Children.toArray(i),u=c.find($z);if(u){const h=u.props.children,f=c.map(m=>m===u?C.Children.count(h)>1?C.Children.only(null):C.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:s,children:C.isValidElement(h)?C.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:s,children:i})});return e.displayName=`${r}.Slot`,e}function Hz(r){const t=C.forwardRef((e,n)=>{const{children:s,...i}=e;if(C.isValidElement(s)){const o=Uz(s),c=Bz(i,s.props);return s.type!==C.Fragment&&(c.ref=n?Ts(n,o):o),C.cloneElement(s,c)}return C.Children.count(s)>1?C.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var qz=Symbol("radix.slottable");function $z(r){return C.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===qz}function Bz(r,t){const e={...t};for(const n in t){const s=r[n],i=t[n];/^on[A-Z]/.test(n)?s&&i?e[n]=(...c)=>{const u=i(...c);return s(...c),u}:s&&(e[n]=s):n==="style"?e[n]={...s,...i}:n==="className"&&(e[n]=[s,i].filter(Boolean).join(" "))}return{...r,...e}}function Uz(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var Pu="Popover",[US]=Cn(Pu,[Ao]),Xr=Ao(),[Fz,Ui]=US(Pu),FS=r=>{const{__scopePopover:t,children:e,open:n,defaultOpen:s,onOpenChange:i,modal:o=!1}=r,c=Xr(t),u=C.useRef(null),[h,f]=C.useState(!1),[m,y]=Es({prop:n,defaultProp:s??!1,onChange:i,caller:Pu});return g.jsx(Tp,{...c,children:g.jsx(Fz,{scope:t,contentId:rs(),triggerRef:u,open:m,onOpenChange:y,onOpenToggle:C.useCallback(()=>y(v=>!v),[y]),hasCustomAnchor:h,onCustomAnchorAdd:C.useCallback(()=>f(!0),[]),onCustomAnchorRemove:C.useCallback(()=>f(!1),[]),modal:o,children:e})})};FS.displayName=Pu;var VS="PopoverAnchor",Vz=C.forwardRef((r,t)=>{const{__scopePopover:e,...n}=r,s=Ui(VS,e),i=Xr(e),{onCustomAnchorAdd:o,onCustomAnchorRemove:c}=s;return C.useEffect(()=>(o(),()=>c()),[o,c]),g.jsx(wu,{...i,...n,ref:t})});Vz.displayName=VS;var GS="PopoverTrigger",QS=C.forwardRef((r,t)=>{const{__scopePopover:e,...n}=r,s=Ui(GS,e),i=Xr(e),o=Ne(t,s.triggerRef),c=g.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":JS(s.open),...n,ref:o,onClick:ge(r.onClick,s.onOpenToggle)});return s.hasCustomAnchor?c:g.jsx(wu,{asChild:!0,...i,children:c})});QS.displayName=GS;var qp="PopoverPortal",[Gz,Qz]=US(qp,{forceMount:void 0}),KS=r=>{const{__scopePopover:t,forceMount:e,children:n,container:s}=r,i=Ui(qp,t);return g.jsx(Gz,{scope:t,forceMount:e,children:g.jsx(ln,{present:e||i.open,children:g.jsx(Vr,{asChild:!0,container:s,children:n})})})};KS.displayName=qp;var Co="PopoverContent",YS=C.forwardRef((r,t)=>{const e=Qz(Co,r.__scopePopover),{forceMount:n=e.forceMount,...s}=r,i=Ui(Co,r.__scopePopover);return g.jsx(ln,{present:n||i.open,children:i.modal?g.jsx(Yz,{...s,ref:t}):g.jsx(Wz,{...s,ref:t})})});YS.displayName=Co;var Kz=Oz("PopoverContent.RemoveScroll"),Yz=C.forwardRef((r,t)=>{const e=Ui(Co,r.__scopePopover),n=C.useRef(null),s=Ne(t,n),i=C.useRef(!1);return C.useEffect(()=>{const o=n.current;if(o)return au(o)},[]),g.jsx(Gr,{as:Kz,allowPinchZoom:!0,children:g.jsx(WS,{...r,ref:s,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(r.onCloseAutoFocus,o=>{o.preventDefault(),i.current||e.triggerRef.current?.focus()}),onPointerDownOutside:ge(r.onPointerDownOutside,o=>{const c=o.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,h=c.button===2||u;i.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:ge(r.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),Wz=C.forwardRef((r,t)=>{const e=Ui(Co,r.__scopePopover),n=C.useRef(!1),s=C.useRef(!1);return g.jsx(WS,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{r.onCloseAutoFocus?.(i),i.defaultPrevented||(n.current||e.triggerRef.current?.focus(),i.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:i=>{r.onInteractOutside?.(i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;e.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),WS=C.forwardRef((r,t)=>{const{__scopePopover:e,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:f,...m}=r,y=Ui(Co,e),v=Xr(e);return su(),g.jsx(Fr,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:i,children:g.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:f,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:h,onDismiss:()=>y.onOpenChange(!1),children:g.jsx(Ap,{"data-state":JS(y.open),role:"dialog",id:y.contentId,...v,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),XS="PopoverClose",Xz=C.forwardRef((r,t)=>{const{__scopePopover:e,...n}=r,s=Ui(XS,e);return g.jsx(De.button,{type:"button",...n,ref:t,onClick:ge(r.onClick,()=>s.onOpenChange(!1))})});Xz.displayName=XS;var Jz="PopoverArrow",Zz=C.forwardRef((r,t)=>{const{__scopePopover:e,...n}=r,s=Xr(e);return g.jsx(Dp,{...s,...n,ref:t})});Zz.displayName=Jz;function JS(r){return r?"open":"closed"}var eI=FS,tI=QS,nI=KS,ZS=YS;const sI=eI,iI=tI,eM=C.forwardRef(({className:r,align:t="center",sideOffset:e=4,...n},s)=>g.jsx(nI,{children:g.jsx(ZS,{ref:s,align:t,sideOffset:e,className:ke("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",r),...n})}));eM.displayName=ZS.displayName;const tM=us((r,t)=>({componentStates:new Map,setComponentState:(e,n,s)=>{mo.setComponentState(e,n,s);const i=mo.getComponentState(e);i&&r(o=>({componentStates:new Map(o.componentStates).set(e,i)}))},resetComponent:e=>{mo.resetComponent(e),r(n=>{const s=new Map(n.componentStates);return s.delete(e),{componentStates:s}})},resetAll:()=>{mo.reset(),r({componentStates:new Map})},getComponentState:e=>t().componentStates.get(e),isEnabled:e=>mo.isEnabled(e),getAllStates:()=>Array.from(t().componentStates.values())}));function aI({componentId:r,componentLabel:t}){const{isRunning:e}=Pt(),{getComponentState:n,setComponentState:s,resetComponent:i}=tM(),o=n(r),c=o?.state||"enabled",[u,h]=C.useState(o?.degradedLevel||.5),[f,m]=C.useState(o?.failureRate||.1),[y,v]=C.useState(o?.latencyMultiplier||2),[x,S]=C.useState(o?.throughputMultiplier||.5),R=A=>{A==="degraded"?s(r,A,{degradedLevel:u,failureRate:f,latencyMultiplier:y,throughputMultiplier:x}):s(r,A)},M=()=>{i(r),h(.5),m(.1),v(2),S(.5)},T=A=>{switch(A){case"enabled":return"bg-green-500/20 text-green-500 border-green-500/50";case"disabled":return"bg-gray-500/20 text-gray-500 border-gray-500/50";case"degraded":return"bg-yellow-500/20 text-yellow-500 border-yellow-500/50";case"failed":return"bg-red-500/20 text-red-500 border-red-500/50"}},k=A=>{switch(A){case"enabled":return g.jsx(nf,{className:"w-4 h-4"});case"disabled":return g.jsx(kl,{className:"w-4 h-4"});case"degraded":return g.jsx(as,{className:"w-4 h-4"});case"failed":return g.jsx(pa,{className:"w-4 h-4"})}};return g.jsxs(wn,{className:"border",children:[g.jsx(Ss,{className:"p-2 pb-1.5",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsxs(Ms,{className:"text-[11px] flex items-center gap-1",children:[g.jsx(ya,{className:"w-3 h-3"}),"Component State",g.jsxs(sI,{children:[g.jsx(iI,{asChild:!0,children:g.jsx(Te,{variant:"ghost",size:"icon",className:"h-3.5 w-3.5 rounded-full",children:g.jsx(BA,{className:"w-2.5 h-2.5 text-muted-foreground"})})}),g.jsx(eM,{className:"w-72 text-xs",align:"start",children:g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"font-semibold text-sm",children:"Component States"}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(nf,{className:"w-3.5 h-3.5 text-green-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-green-500",children:"Enabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  normal operation"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(kl,{className:"w-3.5 h-3.5 text-gray-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-gray-500",children:"Disabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  turned off. Throughput=0, Errors=100%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(as,{className:"w-3.5 h-3.5 text-yellow-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-yellow-500",children:"Degraded"}),g.jsx("span",{className:"text-muted-foreground",children:"  partial failure. Throughput 50%, Latency 2x, Errors 10%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(pa,{className:"w-3.5 h-3.5 text-red-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-red-500",children:"Failed"}),g.jsx("span",{className:"text-muted-foreground",children:"  crashed. Same as Disabled but indicates failure"})]})]})]}),g.jsx("p",{className:"text-muted-foreground pt-1 border-t border-border",children:"Use to simulate failures and test architecture resilience."})]})})]})]}),g.jsx(ga,{className:"text-[9px] mt-0.5",children:"Control operational state"})]}),o&&g.jsxs(ft,{variant:"outline",className:`${T(c)} text-xs px-1 py-0.5`,children:[k(c),g.jsx("span",{className:"ml-0.5",children:c.toUpperCase()})]})]})}),g.jsxs(Rs,{className:"p-2 pt-1.5 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[g.jsxs(Te,{variant:c==="enabled"?"default":"outline",size:"sm",onClick:()=>R("enabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(nf,{className:"w-3.5 h-3.5"}),"Enabled"]}),g.jsxs(Te,{variant:c==="disabled"?"destructive":"outline",size:"sm",onClick:()=>R("disabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(kl,{className:"w-3.5 h-3.5"}),"Disabled"]}),g.jsxs(Te,{variant:c==="degraded"?"default":"outline",size:"sm",onClick:()=>R("degraded"),className:"flex items-center gap-1 h-7 text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-600 dark:text-yellow-400",disabled:!e,children:[g.jsx(as,{className:"w-3.5 h-3.5"}),"Degraded"]}),g.jsxs(Te,{variant:c==="failed"?"destructive":"outline",size:"sm",onClick:()=>R("failed"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(pa,{className:"w-3.5 h-3.5"}),"Failed"]})]}),c==="degraded"&&g.jsxs("div",{className:"space-y-2 p-2 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[g.jsx(Lb,{className:"w-3 h-3 text-yellow-600 dark:text-yellow-400"}),g.jsx(it,{className:"text-[11px] font-semibold text-yellow-600 dark:text-yellow-400",children:"Degradation Settings"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(it,{className:"text-[10px]",children:"Degradation Level"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(u*100).toFixed(0),"%"]})]}),g.jsx(is,{value:[u],onValueChange:A=>{h(A[0]),R("degraded")},min:0,max:1,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(it,{className:"text-[10px]",children:"Failure Rate"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(f*100).toFixed(0),"%"]})]}),g.jsx(is,{value:[f],onValueChange:A=>{m(A[0]),R("degraded")},min:0,max:1,step:.05,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(it,{className:"text-[10px]",children:"Latency Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[y.toFixed(1),"x"]})]}),g.jsx(is,{value:[y],onValueChange:A=>{v(A[0]),R("degraded")},min:1,max:5,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(it,{className:"text-[10px]",children:"Throughput Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(x*100).toFixed(0),"%"]})]}),g.jsx(is,{value:[x],onValueChange:A=>{S(A[0]),R("degraded")},min:0,max:1,step:.05,className:"w-full"})]})]})]}),o&&g.jsxs(Te,{variant:"outline",size:"sm",onClick:M,className:"w-full flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(jb,{className:"w-3.5 h-3.5"}),"Reset to Normal"]}),!e&&g.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded text-[9px] text-muted-foreground",children:[g.jsx(va,{className:"w-3 h-3"}),"Start emulation to control component state"]})]})]})}function oI({onFilterChange:r}){const{nodes:t,connections:e,selectNode:n}=Ee(),{isRunning:s,getComponentMetrics:i}=Pt(),{getAllComponentStatuses:o}=ma(),[c,u]=C.useState(""),[h,f]=C.useState(!1),[m,y]=C.useState(!0),[v,x]=C.useState(!0),[S,R]=C.useState(!0),[M,T]=C.useState(!0),[k,A]=C.useState(100),[_,P]=C.useState(5),[z,q]=C.useState(new Set),Z=kt.useMemo(()=>s?t.filter(te=>{if(c&&!te.data.label.toLowerCase().includes(c.toLowerCase()))return!1;if(!h)return!0;const le=i(te.id),L=o().find(N=>N.nodeId===te.id);return!!(m&&e.some(O=>O.source===te.id||O.target===te.id?Pt.getState().getConnectionMetrics(O.id)?.bottleneck:!1)||v&&le&&le.errorRate*100>=_||M&&le&&le.latency>=k||S&&L?.criticalPath||L&&(L.health==="critical"||L.health==="down"))}):t,[c,h,m,v,M,S,k,_,s,t,e]);kt.useEffect(()=>{if(h){const te=new Set(Z.map(le=>le.id));q(te),r?.(Array.from(te))}else q(new Set),r?.(t.map(te=>te.id))},[h,Z,t,r]);const se=te=>{n(te)},ce=Z.length,J=t.filter(te=>{if(!s)return!1;const le=i(te.id),L=o().find(N=>N.nodeId===te.id);return le&&(le.errorRate*100>=_||le.latency>=k)||L?.criticalPath||L&&(L.health==="critical"||L.health==="down")||e.some(N=>N.source===te.id||N.target===te.id?Pt.getState().getConnectionMetrics(N.id)?.bottleneck:!1)}).length;return g.jsxs(wn,{className:"h-full border-2",children:[g.jsx(Ss,{className:"pb-3",children:g.jsxs(Ms,{className:"text-sm flex items-center gap-2",children:[g.jsx(_b,{className:"w-4 h-4"}),"Problem Filters",ce>0&&g.jsx(ft,{variant:"destructive",className:"ml-auto",children:ce})]})}),g.jsxs(Rs,{className:"space-y-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(it,{className:"text-xs",children:"Search Components"}),g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search by name...",value:c,onChange:te=>u(te.target.value),className:"pl-8 h-8 text-xs"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(it,{className:"text-xs flex items-center gap-2",children:[g.jsx(WA,{className:"w-4 h-4"}),"Show Only Problems"]}),g.jsx(fa,{checked:h,onCheckedChange:f})]}),h&&g.jsxs("div",{className:"pl-6 space-y-2 border-l-2 border-border",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(it,{className:"text-xs flex items-center gap-2",children:[g.jsx(Lb,{className:"w-4 h-4 text-red-500"}),"Bottlenecks"]}),g.jsx(fa,{checked:m,onCheckedChange:y})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(it,{className:"text-xs flex items-center gap-2",children:[g.jsx(pa,{className:"w-4 h-4 text-orange-500"}),"High Error Rate (>",_,"%)"]}),g.jsx(fa,{checked:v,onCheckedChange:x})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(it,{className:"text-xs flex items-center gap-2",children:[g.jsx(zb,{className:"w-4 h-4 text-yellow-500"}),"High Latency (>",k,"ms)"]}),g.jsx(fa,{checked:M,onCheckedChange:T})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(it,{className:"text-xs flex items-center gap-2",children:[g.jsx(ya,{className:"w-4 h-4 text-purple-500"}),"Critical Paths"]}),g.jsx(fa,{checked:S,onCheckedChange:R})]})]})]}),h&&g.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[g.jsxs("div",{children:[g.jsx(it,{className:"text-xs",children:"Min Latency (ms)"}),g.jsx(Tt,{type:"number",value:k,onChange:te=>A(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0})]}),g.jsxs("div",{children:[g.jsx(it,{className:"text-xs",children:"Min Error Rate (%)"}),g.jsx(Tt,{type:"number",value:_,onChange:te=>P(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0,max:100})]})]}),s&&g.jsx("div",{className:"pt-2 border-t border-border",children:g.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total problems detected: ",g.jsx("span",{className:"font-semibold text-foreground",children:J})]})}),h&&Z.length>0&&g.jsx(an,{className:"h-48 border border-border rounded p-2",children:g.jsx("div",{className:"space-y-1",children:Z.map(te=>{const le=i(te.id),L=o().find(N=>N.nodeId===te.id);return g.jsx(Te,{variant:"ghost",size:"sm",className:"w-full justify-start text-xs h-auto py-1.5",onClick:()=>se(te.id),children:g.jsxs("div",{className:"flex items-center gap-2 w-full",children:[L?.criticalPath&&g.jsx(ft,{variant:"outline",className:"bg-purple-500/20 text-purple-500 border-purple-500/50 text-xs px-1",children:"Critical"}),g.jsx("span",{className:"flex-1 text-left truncate",children:te.data.label}),le&&le.errorRate*100>=_&&g.jsxs(ft,{variant:"destructive",className:"text-xs px-1",children:[(le.errorRate*100).toFixed(0),"%"]})]})},te.id)})})}),!s&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-4",children:"Start emulation to see problems"})]})]})}function rI(){const{nodes:r,connections:t}=Ee(),{isRunning:e,getComponentMetrics:n,getConnectionMetrics:s}=Pt(),{getAllComponentStatuses:i,getSystemAnalysis:o}=ma(),[c,u]=C.useState(""),[h,f]=C.useState("all");if(!e)return g.jsx(wn,{className:"h-full",children:g.jsxs(Ss,{children:[g.jsx(Ms,{children:"Diagnostics"}),g.jsx(ga,{children:"Start emulation to see diagnostics"})]})});const m=[],y=i();o(),r.forEach(R=>{const M=n(R.id),T=y.find(_=>_.nodeId===R.id);if(!M||!T)return;const k={nodeId:R.id,nodeLabel:R.data.label,problem:"",severity:"info",metrics:{throughput:M.throughput,latency:M.latency,errorRate:M.errorRate,utilization:M.utilization},affectedConnections:[],recommendations:[]},A=t.filter(_=>_.source===R.id||_.target===R.id?s(_.id)?.bottleneck:!1);if(A.length>0){k.problem=`Bottleneck detected in ${A.length} connection(s)`,k.severity="critical",k.affectedConnections=A.map(_=>_.id),k.rootCause="High throughput dependency or backpressure",k.recommendations=["Consider scaling this component horizontally","Optimize data processing logic","Check for connection bandwidth limits"],m.push(k);return}if(M.errorRate>.05){k.problem=`High error rate: ${(M.errorRate*100).toFixed(1)}%`,k.severity=M.errorRate>.1?"critical":"warning",k.rootCause="Component is experiencing failures",k.recommendations=["Check component logs for error details","Verify input data format and validation","Review retry and error handling logic"],m.push(k);return}if(M.latency>1e3){k.problem=`High latency: ${M.latency.toFixed(0)}ms`,k.severity=M.latency>2e3?"critical":"warning",k.rootCause="Component processing is slow",k.recommendations=["Optimize database queries or data processing","Consider caching frequently accessed data","Review component configuration for performance"],m.push(k);return}if(M.utilization>.9){k.problem=`High utilization: ${(M.utilization*100).toFixed(0)}%`,k.severity="warning",k.rootCause="Component is near capacity",k.recommendations=["Consider scaling this component","Optimize resource usage","Monitor for potential failures"],m.push(k);return}(T.health==="critical"||T.health==="down")&&(k.problem=`Component health: ${T.health}`,k.severity="critical",k.rootCause="Component is in critical state or down",k.recommendations=["Immediately check component status","Review error logs and metrics","Consider failover or restart"],m.push(k))});const v=m.filter(R=>!(h!=="all"&&R.severity!==h||c&&!R.nodeLabel.toLowerCase().includes(c.toLowerCase()))),x=R=>{switch(R){case"critical":return g.jsx(pa,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(as,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(va,{className:"w-4 h-4 text-blue-500"})}},S=R=>{switch(R){case"critical":return g.jsx(ft,{variant:"destructive",className:"text-xs",children:"Critical"});case"warning":return g.jsx(ft,{variant:"outline",className:"border-yellow-500 text-yellow-600 text-xs",children:"Warning"});default:return g.jsx(ft,{variant:"outline",className:"text-xs",children:"Info"})}};return g.jsxs(wn,{className:"h-full flex flex-col",children:[g.jsxs(Ss,{className:"pb-3",children:[g.jsx(Ms,{className:"text-sm font-semibold",children:"Diagnostics"}),g.jsxs(ga,{className:"text-xs text-muted-foreground",children:[v.length," problem",v.length!==1?"s":""," detected"]})]}),g.jsxs(Rs,{className:"flex-1 flex flex-col overflow-hidden p-0",children:[g.jsxs("div",{className:"p-4 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search components...",value:c,onChange:R=>u(R.target.value),className:"pl-8 h-8 text-xs"})]}),g.jsxs("div",{className:"flex gap-1",children:[g.jsx(Te,{variant:h==="all"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>f("all"),children:"All"}),g.jsx(Te,{variant:h==="critical"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>f("critical"),children:"Critical"}),g.jsx(Te,{variant:h==="warning"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>f("warning"),children:"Warning"})]})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-4 space-y-2",children:v.length===0?g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-6",children:[g.jsx(ya,{className:"w-6 h-6 mx-auto mb-1.5 opacity-50"}),g.jsx("p",{children:"No problems detected"})]}):v.map((R,M)=>g.jsxs(wn,{className:`border-l-4 ${R.severity==="critical"?"border-l-red-500":R.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsxs(Ss,{className:"pb-2 p-3",children:[g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[x(R.severity),g.jsx(Ms,{className:"text-xs font-semibold",children:R.nodeLabel}),S(R.severity)]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{r.find(k=>k.id===R.nodeId)&&Ee.getState().selectNode(R.nodeId)},children:g.jsx(DA,{className:"w-3.5 h-3.5"})})]}),g.jsx(ga,{className:"text-xs mt-0.5",children:R.problem})]}),g.jsxs(Rs,{className:"pt-0 p-3 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[R.metrics.throughput!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Throughput: "}),g.jsxs("span",{className:"font-mono",children:[R.metrics.throughput.toFixed(0)," ops/s"]})]}),R.metrics.latency!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Latency: "}),g.jsxs("span",{className:"font-mono",children:[R.metrics.latency.toFixed(0),"ms"]})]}),R.metrics.errorRate!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Error Rate: "}),g.jsxs("span",{className:"font-mono",children:[(R.metrics.errorRate*100).toFixed(1),"%"]})]}),R.metrics.utilization!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Utilization: "}),g.jsxs("span",{className:"font-mono",children:[(R.metrics.utilization*100).toFixed(0),"%"]})]})]}),R.rootCause&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Root Cause:"}),g.jsx("div",{className:"text-xs",children:R.rootCause})]}),R.recommendations.length>0&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Recommendations:"}),g.jsx("ul",{className:"text-xs space-y-0.5 list-disc list-inside",children:R.recommendations.map((T,k)=>g.jsx("li",{className:"text-muted-foreground",children:T},k))})]})]})]},M))})})]})]})}function cI(){const{alerts:r,acknowledgeAlert:t,clearAlerts:e,getCriticalAlerts:n,getWarningAlerts:s}=Yf(),{selectNode:i}=Ee(),o=n(),c=s();r.filter(f=>f.type==="info");const u=f=>{switch(f){case"critical":return g.jsx(pa,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(as,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(Pb,{className:"w-4 h-4 text-blue-500"})}},h=f=>{i(f)};return r.length===0?g.jsxs(wn,{className:"h-full",children:[g.jsx(Ss,{children:g.jsx(Ms,{className:"text-sm",children:"Alerts"})}),g.jsx(Rs,{children:g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(Jf,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),g.jsx("p",{children:"No active alerts"})]})})]}):g.jsxs(wn,{className:"h-full flex flex-col",children:[g.jsx(Ss,{className:"pb-3",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx(Ms,{className:"text-sm",children:"Alerts"}),g.jsxs("div",{className:"flex gap-2 mt-1",children:[o.length>0&&g.jsxs(ft,{variant:"destructive",className:"text-xs",children:[o.length," Critical"]}),c.length>0&&g.jsxs(ft,{variant:"outline",className:"text-xs border-yellow-500 text-yellow-600",children:[c.length," Warning"]})]})]}),g.jsx(Te,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:e,children:"Clear All"})]})}),g.jsx(Rs,{className:"flex-1 overflow-hidden p-0",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-4 space-y-2",children:r.map(f=>g.jsx(wn,{className:`border-l-4 ${f.type==="critical"?"border-l-red-500 bg-red-500/5":f.type==="warning"?"border-l-yellow-500 bg-yellow-500/5":"border-l-blue-500 bg-blue-500/5"}`,children:g.jsx(Rs,{className:"p-3",children:g.jsxs("div",{className:"flex items-start justify-between gap-2",children:[g.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[u(f.type),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("h4",{className:"text-xs font-semibold",children:f.title}),g.jsx(ft,{variant:f.type==="critical"?"destructive":f.type==="warning"?"outline":"secondary",className:"text-xs",children:f.type})]}),g.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:f.message}),f.nodeLabel&&g.jsxs(Te,{variant:"ghost",size:"sm",className:"h-6 text-xs p-1",onClick:()=>f.nodeId&&h(f.nodeId),children:["View: ",f.nodeLabel]}),g.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(f.timestamp).toLocaleTimeString()})]})]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>t(f.id),children:g.jsx(os,{className:"w-3 h-3"})})]})})},f.id))})})})]})}function lI(){const{nodes:r,connections:t}=Ee(),{isRunning:e,componentMetrics:n,connectionMetrics:s}=Pt(),{getSystemAnalysis:i}=ma(),{getCriticalAlerts:o,getWarningAlerts:c}=Yf(),u=C.useMemo(()=>{if(!e)return{totalThroughput:0,averageLatency:0,totalErrorRate:0,activeComponents:0,activeConnections:0,bottlenecks:0,healthyComponents:0,degradedComponents:0,criticalComponents:0};let m=0,y=0,v=0,x=0,S=0,R=0,M=0,T=0,k=0;n.forEach(z=>{(z.throughput>.1||z.errorRate>.001)&&(x++,m+=z.throughput||0,y+=z.latency||0,v+=z.errorRate||0)}),s.forEach(z=>{(z.effectiveThroughput>0||z.traffic>0)&&(S++,z.bottleneck&&R++)});const A=ma.getState();r.forEach(z=>{const q=A.getComponentStatus(z.id);if(q)switch(q.health){case"healthy":M++;break;case"degraded":T++;break;case"critical":case"down":k++;break}});const _=x>0?y/x:0,P=x>0?v/x:0;return{totalThroughput:m,averageLatency:_,totalErrorRate:P,activeComponents:x,activeConnections:S,bottlenecks:R,healthyComponents:M,degradedComponents:T,criticalComponents:k}},[e,n,s,r]),h=o(),f=c();return e?g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Performance"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Total Throughput"}),g.jsxs(da,{status:"success",size:"base",weight:"bold",children:[u.totalThroughput.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ops/s"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Avg Latency"}),g.jsxs(da,{status:"warning",size:"base",weight:"bold",children:[u.averageLatency.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ms"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Error Rate"}),g.jsxs(da,{status:"error",size:"base",weight:"bold",children:[(u.totalErrorRate*100).toFixed(2),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"%"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Bottlenecks"}),g.jsxs(da,{status:"warning",size:"base",weight:"bold",children:[u.bottlenecks,g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"conn"})]})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Component Health"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(Jf,{className:"w-4 h-4 text-success"}),g.jsx(We,{size:"micro",children:"Healthy"})]}),g.jsx(ft,{variant:"outline",className:"bg-success/20 border-success/50 text-success text-xs px-1 py-0",children:u.healthyComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(as,{className:"w-4 h-4 text-warning"}),g.jsx(We,{size:"micro",children:"Degraded"})]}),g.jsx(ft,{variant:"outline",className:"bg-warning/20 border-warning/50 text-warning text-xs px-1 py-0",children:u.degradedComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(as,{className:"w-4 h-4 text-destructive"}),g.jsx(We,{size:"micro",children:"Critical/Down"})]}),g.jsx(ft,{variant:"outline",className:"bg-destructive/20 border-destructive/50 text-destructive text-xs px-1 py-0",children:u.criticalComponents})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Activity"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(dD,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Components"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[u.activeComponents," / ",r.length]})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(zb,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Connections"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[u.activeConnections," / ",t.length]})]})]})]}),(h.length>0||f.length>0)&&g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ws,{level:5,children:"Alerts"}),g.jsxs("div",{className:"space-y-0.5",children:[h.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(da,{status:"error",size:"micro",children:"Critical"}),g.jsx(ft,{variant:"destructive",className:"text-xs px-1 py-0",children:h.length})]}),f.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(da,{status:"warning",size:"micro",children:"Warnings"}),g.jsx(ft,{variant:"outline",className:"border-warning text-warning text-xs px-1 py-0",children:f.length})]})]})]})]}):g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(ya,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),g.jsx("p",{children:"Start emulation to see system statistics"})]})}const wl=43200,qv=1440,$v=Symbol.for("constructDateFrom");function $p(r,t){return typeof r=="function"?r(t):r&&typeof r=="object"&&$v in r?r[$v](t):r instanceof Date?new r.constructor(t):new Date(t)}function Hi(r,t){return $p(r,r)}let uI={};function dI(){return uI}function Bv(r){const t=Hi(r),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+r-+e}function Bp(r,...t){const e=$p.bind(null,r||t.find(n=>typeof n=="object"));return t.map(e)}function jl(r,t){const e=+Hi(r)-+Hi(t);return e<0?-1:e>0?1:e}function hI(r){return $p(r,Date.now())}function fI(r,t,e){const[n,s]=Bp(e?.in,r,t),i=n.getFullYear()-s.getFullYear(),o=n.getMonth()-s.getMonth();return i*12+o}function pI(r){return t=>{const n=(r?Math[r]:Math.trunc)(t);return n===0?0:n}}function gI(r,t){return+Hi(r)-+Hi(t)}function mI(r,t){const e=Hi(r);return e.setHours(23,59,59,999),e}function yI(r,t){const e=Hi(r),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function vI(r,t){const e=Hi(r);return+mI(e)==+yI(e)}function bI(r,t,e){const[n,s,i]=Bp(e?.in,r,r,t),o=jl(s,i),c=Math.abs(fI(s,i));if(c<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-o*c);let u=jl(s,i)===-o;vI(n)&&c===1&&jl(n,i)===1&&(u=!1);const h=o*(c-+u);return h===0?0:h}function xI(r,t,e){const n=gI(r,t)/1e3;return pI(e?.roundingMethod)(n)}const wI={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},CI=(r,t,e)=>{let n;const s=wI[r];return typeof s=="string"?n=s:t===1?n=s.one:n=s.other.replace("{{count}}",t.toString()),e?.addSuffix?e.comparison&&e.comparison>0?"in "+n:n+" ago":n};function gf(r){return(t={})=>{const e=t.width?String(t.width):r.defaultWidth;return r.formats[e]||r.formats[r.defaultWidth]}}const SI={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},MI={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},RI={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},EI={date:gf({formats:SI,defaultWidth:"full"}),time:gf({formats:MI,defaultWidth:"full"}),dateTime:gf({formats:RI,defaultWidth:"full"})},kI={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},TI=(r,t,e,n)=>kI[r];function Rr(r){return(t,e)=>{const n=e?.context?String(e.context):"standalone";let s;if(n==="formatting"&&r.formattingValues){const o=r.defaultFormattingWidth||r.defaultWidth,c=e?.width?String(e.width):o;s=r.formattingValues[c]||r.formattingValues[o]}else{const o=r.defaultWidth,c=e?.width?String(e.width):r.defaultWidth;s=r.values[c]||r.values[o]}const i=r.argumentCallback?r.argumentCallback(t):t;return s[i]}}const AI={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},DI={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_I={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},PI={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},NI={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},jI={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},LI=(r,t)=>{const e=Number(r),n=e%100;if(n>20||n<10)switch(n%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"},zI={ordinalNumber:LI,era:Rr({values:AI,defaultWidth:"wide"}),quarter:Rr({values:DI,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Rr({values:_I,defaultWidth:"wide"}),day:Rr({values:PI,defaultWidth:"wide"}),dayPeriod:Rr({values:NI,defaultWidth:"wide",formattingValues:jI,defaultFormattingWidth:"wide"})};function Er(r){return(t,e={})=>{const n=e.width,s=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],i=t.match(s);if(!i)return null;const o=i[0],c=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],u=Array.isArray(c)?OI(c,m=>m.test(o)):II(c,m=>m.test(o));let h;h=r.valueCallback?r.valueCallback(u):u,h=e.valueCallback?e.valueCallback(h):h;const f=t.slice(o.length);return{value:h,rest:f}}}function II(r,t){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)&&t(r[e]))return e}function OI(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return e}function HI(r){return(t,e={})=>{const n=t.match(r.matchPattern);if(!n)return null;const s=n[0],i=t.match(r.parsePattern);if(!i)return null;let o=r.valueCallback?r.valueCallback(i[0]):i[0];o=e.valueCallback?e.valueCallback(o):o;const c=t.slice(s.length);return{value:o,rest:c}}}const qI=/^(\d+)(th|st|nd|rd)?/i,$I=/\d+/i,BI={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},UI={any:[/^b/i,/^(a|c)/i]},FI={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},VI={any:[/1/i,/2/i,/3/i,/4/i]},GI={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},QI={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},KI={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},YI={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},WI={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},XI={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},JI={ordinalNumber:HI({matchPattern:qI,parsePattern:$I,valueCallback:r=>parseInt(r,10)}),era:Er({matchPatterns:BI,defaultMatchWidth:"wide",parsePatterns:UI,defaultParseWidth:"any"}),quarter:Er({matchPatterns:FI,defaultMatchWidth:"wide",parsePatterns:VI,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Er({matchPatterns:GI,defaultMatchWidth:"wide",parsePatterns:QI,defaultParseWidth:"any"}),day:Er({matchPatterns:KI,defaultMatchWidth:"wide",parsePatterns:YI,defaultParseWidth:"any"}),dayPeriod:Er({matchPatterns:WI,defaultMatchWidth:"any",parsePatterns:XI,defaultParseWidth:"any"})},ZI={code:"en-US",formatDistance:CI,formatLong:EI,formatRelative:TI,localize:zI,match:JI,options:{weekStartsOn:0,firstWeekContainsDate:1}};function e5(r,t,e){const n=dI(),s=e?.locale??n.locale??ZI,i=2520,o=jl(r,t);if(isNaN(o))throw new RangeError("Invalid time value");const c=Object.assign({},e,{addSuffix:e?.addSuffix,comparison:o}),[u,h]=Bp(e?.in,...o>0?[t,r]:[r,t]),f=xI(h,u),m=(Bv(h)-Bv(u))/1e3,y=Math.round((f-m)/60);let v;if(y<2)return e?.includeSeconds?f<5?s.formatDistance("lessThanXSeconds",5,c):f<10?s.formatDistance("lessThanXSeconds",10,c):f<20?s.formatDistance("lessThanXSeconds",20,c):f<40?s.formatDistance("halfAMinute",0,c):f<60?s.formatDistance("lessThanXMinutes",1,c):s.formatDistance("xMinutes",1,c):y===0?s.formatDistance("lessThanXMinutes",1,c):s.formatDistance("xMinutes",y,c);if(y<45)return s.formatDistance("xMinutes",y,c);if(y<90)return s.formatDistance("aboutXHours",1,c);if(y<qv){const x=Math.round(y/60);return s.formatDistance("aboutXHours",x,c)}else{if(y<i)return s.formatDistance("xDays",1,c);if(y<wl){const x=Math.round(y/qv);return s.formatDistance("xDays",x,c)}else if(y<wl*2)return v=Math.round(y/wl),s.formatDistance("aboutXMonths",v,c)}if(v=bI(h,u),v<12){const x=Math.round(y/wl);return s.formatDistance("xMonths",x,c)}else{const x=v%12,S=Math.trunc(v/12);return x<3?s.formatDistance("aboutXYears",S,c):x<9?s.formatDistance("overXYears",S,c):s.formatDistance("almostXYears",S+1,c)}}function t5(r,t){return e5(r,hI(r),t)}function n5(){const{errors:r,updateErrors:t,clearErrors:e,removeError:n,getErrorCount:s,getStats:i}=kb(),{nodes:o}=Ee(),[c,u]=C.useState("all"),[h,f]=C.useState("all"),[m,y]=C.useState("all"),[v,x]=C.useState("");C.useEffect(()=>{t();const P=setInterval(()=>{t()},1e3);return()=>clearInterval(P)},[t]);const S=i(),R=C.useMemo(()=>{let P=r;if(c!=="all"&&(P=P.filter(z=>z.severity===c)),h!=="all"&&(P=P.filter(z=>z.source===h)),m!=="all"&&(P=P.filter(z=>z.componentId===m)),v){const z=v.toLowerCase();P=P.filter(q=>q.message.toLowerCase().includes(z)||q.componentLabel?.toLowerCase().includes(z)||q.componentType?.toLowerCase().includes(z)||q.errorType?.toLowerCase().includes(z))}return P},[r,c,h,m,v]),M=C.useMemo(()=>{const P=new Map;return r.forEach(z=>{z.componentId&&z.componentLabel&&P.set(z.componentId,{id:z.componentId,label:z.componentLabel,type:z.componentType||"unknown"})}),Array.from(P.values())},[r]),T=P=>{switch(P){case"critical":return g.jsx(jA,{className:"h-3 w-3 text-red-500"});case"warning":return g.jsx(as,{className:"h-3 w-3 text-yellow-500"});case"info":return g.jsx(Pb,{className:"h-3 w-3 text-blue-500"})}},k=P=>{switch(P){case"critical":return g.jsx(ft,{variant:"destructive",className:"text-[9px] px-1 py-0 h-4",children:"Critical"});case"warning":return g.jsx(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"Warning"});case"info":return g.jsx(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-blue-500/10 text-blue-600 border-blue-500",children:"Info"})}},A=P=>{const z={"emulation-engine":"bg-purple-500/10 text-purple-600 border-purple-500","component-engine":"bg-green-500/10 text-green-600 border-green-500","alert-system":"bg-orange-500/10 text-orange-600 border-orange-500","data-flow":"bg-cyan-500/10 text-cyan-600 border-cyan-500","routing-engine":"bg-pink-500/10 text-pink-600 border-pink-500",initialization:"bg-indigo-500/10 text-indigo-600 border-indigo-500",configuration:"bg-gray-500/10 text-gray-600 border-gray-500",unknown:"bg-gray-500/10 text-gray-600 border-gray-500"},q={"emulation-engine":"Engine","component-engine":"Component","alert-system":"Alert","data-flow":"DataFlow","routing-engine":"Routing",initialization:"Init",configuration:"Config",unknown:"Unknown"};return g.jsx(ft,{variant:"outline",className:`text-[9px] px-1 py-0 h-4 ${z[P]||z.unknown}`,children:q[P]||q.unknown})},_=P=>{try{return t5(new Date(P),{addSuffix:!0})}catch{return"unknown time"}};return g.jsxs("div",{className:"h-full flex flex-col",children:[g.jsxs("div",{className:"p-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(va,{className:"h-4 w-4 text-muted-foreground"}),g.jsx("h3",{className:"text-sm font-semibold",children:"Simulation Errors"})]}),r.length>0&&g.jsxs(Te,{variant:"ghost",size:"sm",onClick:e,className:"h-6 text-xs",children:[g.jsx(Zl,{className:"h-3 w-3 mr-1"}),"Clear All"]})]}),g.jsxs("div",{className:"flex gap-2 text-xs",children:[g.jsxs(ft,{variant:"outline",className:"text-xs",children:["Total: ",S.total]}),S.critical>0&&g.jsxs(ft,{variant:"destructive",className:"text-xs",children:["Critical: ",S.critical]}),S.warning>0&&g.jsxs(ft,{variant:"outline",className:"text-xs bg-yellow-500/10 text-yellow-600 border-yellow-500",children:["Warning: ",S.warning]}),S.info>0&&g.jsxs(ft,{variant:"outline",className:"text-xs bg-blue-500/10 text-blue-600 border-blue-500",children:["Info: ",S.info]})]})]}),g.jsxs("div",{className:"p-2 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search errors...",value:v,onChange:P=>x(P.target.value),className:"h-7 pl-7 text-xs"})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[g.jsxs(Pl,{value:c,onValueChange:P=>u(P),children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(Nl,{placeholder:"Severity"})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"all",children:"All Severities"}),g.jsx(Vt,{value:"critical",children:"Critical"}),g.jsx(Vt,{value:"warning",children:"Warning"}),g.jsx(Vt,{value:"info",children:"Info"})]})]}),g.jsxs(Pl,{value:h,onValueChange:P=>f(P),children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(Nl,{placeholder:"Source"})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"all",children:"All Sources"}),g.jsx(Vt,{value:"emulation-engine",children:"Emulation Engine"}),g.jsx(Vt,{value:"component-engine",children:"Component Engine"}),g.jsx(Vt,{value:"alert-system",children:"Alert System"}),g.jsx(Vt,{value:"data-flow",children:"Data Flow"}),g.jsx(Vt,{value:"routing-engine",children:"Routing Engine"}),g.jsx(Vt,{value:"initialization",children:"Initialization"}),g.jsx(Vt,{value:"configuration",children:"Configuration"})]})]})]}),M.length>0&&g.jsxs(Pl,{value:m,onValueChange:y,children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(Nl,{placeholder:"Component"})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"all",children:"All Components"}),M.map(P=>g.jsxs(Vt,{value:P.id,children:[P.label," (",P.type,")"]},P.id))]})]})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:R.length===0?g.jsx("div",{className:"text-center text-sm text-muted-foreground py-8",children:r.length===0?g.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g.jsx(va,{className:"h-8 w-8 opacity-50"}),g.jsx("p",{children:"No errors detected"})]}):g.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g.jsx(_b,{className:"h-8 w-8 opacity-50"}),g.jsx("p",{children:"No errors match the filters"})]})}):R.map(P=>g.jsxs(wn,{className:`border-l-2 ${P.severity==="critical"?"border-l-red-500":P.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsx(Ss,{className:"pb-1 p-1.5",children:g.jsxs("div",{className:"flex items-start justify-between gap-1",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5 flex-wrap",children:[g.jsx("span",{className:"flex-shrink-0",children:T(P.severity)}),g.jsx(Ms,{className:"text-[11px] font-semibold truncate",children:P.componentLabel||"System"}),g.jsx("span",{className:"flex-shrink-0",children:k(P.severity)}),g.jsx("span",{className:"flex-shrink-0",children:A(P.source)}),P.count&&P.count>1&&g.jsxs(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4",children:[P.count,"x"]})]}),g.jsx(ga,{className:"text-[10px] mt-0.5 break-words line-clamp-2",children:P.message}),g.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[9px] text-muted-foreground",children:[g.jsx("span",{children:_(P.timestamp)}),P.componentType&&g.jsxs("span",{className:"truncate",children:[" ",P.componentType]}),P.errorType&&g.jsxs("span",{className:"truncate",children:[" ",P.errorType]})]})]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-5 w-5 flex-shrink-0",onClick:()=>n(P.id),children:g.jsx(os,{className:"h-3 w-3"})})]})}),P.context&&Object.keys(P.context).length>0||P.stack?g.jsxs(Rs,{className:"pt-0 p-1.5 space-y-1",children:[P.context&&Object.keys(P.context).length>0&&g.jsxs("details",{className:"text-[9px]",children:[g.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Context"}),g.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:JSON.stringify(P.context,null,2)})]}),P.stack&&g.jsxs("details",{className:"text-[9px]",children:[g.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Stack"}),g.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:P.stack})]})]}):null]},P.id))})})]})}var Nu="Checkbox",[s5]=Cn(Nu),[i5,Up]=s5(Nu);function a5(r){const{__scopeCheckbox:t,checked:e,children:n,defaultChecked:s,disabled:i,form:o,name:c,onCheckedChange:u,required:h,value:f="on",internal_do_not_use_render:m}=r,[y,v]=Es({prop:e,defaultProp:s??!1,onChange:u,caller:Nu}),[x,S]=C.useState(null),[R,M]=C.useState(null),T=C.useRef(!1),k=x?!!o||!!x.closest("form"):!0,A={checked:y,disabled:i,setChecked:v,control:x,setControl:S,name:c,form:o,value:f,hasConsumerStoppedPropagationRef:T,required:h,defaultChecked:zi(s)?!1:s,isFormControl:k,bubbleInput:R,setBubbleInput:M};return g.jsx(i5,{scope:t,...A,children:o5(m)?m(A):n})}var nM="CheckboxTrigger",sM=C.forwardRef(({__scopeCheckbox:r,onKeyDown:t,onClick:e,...n},s)=>{const{control:i,value:o,disabled:c,checked:u,required:h,setControl:f,setChecked:m,hasConsumerStoppedPropagationRef:y,isFormControl:v,bubbleInput:x}=Up(nM,r),S=Ne(s,f),R=C.useRef(u);return C.useEffect(()=>{const M=i?.form;if(M){const T=()=>m(R.current);return M.addEventListener("reset",T),()=>M.removeEventListener("reset",T)}},[i,m]),g.jsx(De.button,{type:"button",role:"checkbox","aria-checked":zi(u)?"mixed":u,"aria-required":h,"data-state":cM(u),"data-disabled":c?"":void 0,disabled:c,value:o,...n,ref:S,onKeyDown:ge(t,M=>{M.key==="Enter"&&M.preventDefault()}),onClick:ge(e,M=>{m(T=>zi(T)?!0:!T),x&&v&&(y.current=M.isPropagationStopped(),y.current||M.stopPropagation())})})});sM.displayName=nM;var Fp=C.forwardRef((r,t)=>{const{__scopeCheckbox:e,name:n,checked:s,defaultChecked:i,required:o,disabled:c,value:u,onCheckedChange:h,form:f,...m}=r;return g.jsx(a5,{__scopeCheckbox:e,checked:s,defaultChecked:i,disabled:c,required:o,onCheckedChange:h,name:n,form:f,value:u,internal_do_not_use_render:({isFormControl:y})=>g.jsxs(g.Fragment,{children:[g.jsx(sM,{...m,ref:t,__scopeCheckbox:e}),y&&g.jsx(rM,{__scopeCheckbox:e})]})})});Fp.displayName=Nu;var iM="CheckboxIndicator",aM=C.forwardRef((r,t)=>{const{__scopeCheckbox:e,forceMount:n,...s}=r,i=Up(iM,e);return g.jsx(ln,{present:n||zi(i.checked)||i.checked===!0,children:g.jsx(De.span,{"data-state":cM(i.checked),"data-disabled":i.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...r.style}})})});aM.displayName=iM;var oM="CheckboxBubbleInput",rM=C.forwardRef(({__scopeCheckbox:r,...t},e)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:i,defaultChecked:o,required:c,disabled:u,name:h,value:f,form:m,bubbleInput:y,setBubbleInput:v}=Up(oM,r),x=Ne(e,v),S=Eu(i),R=xu(n);C.useEffect(()=>{const T=y;if(!T)return;const k=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(k,"checked").set,P=!s.current;if(S!==i&&_){const z=new Event("click",{bubbles:P});T.indeterminate=zi(i),_.call(T,zi(i)?!1:i),T.dispatchEvent(z)}},[y,S,i,s]);const M=C.useRef(zi(i)?!1:i);return g.jsx(De.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??M.current,required:c,disabled:u,name:h,value:f,form:m,...t,tabIndex:-1,ref:x,style:{...t.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});rM.displayName=oM;function o5(r){return typeof r=="function"}function zi(r){return r==="indeterminate"}function cM(r){return zi(r)?"indeterminate":r?"checked":"unchecked"}const Of=C.forwardRef(({className:r,...t},e)=>g.jsx(Fp,{ref:e,className:ke("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...t,children:g.jsx(aM,{className:ke("grid place-content-center text-current"),children:g.jsx(Wf,{className:"h-4 w-4"})})}));Of.displayName=Fp.displayName;function lM({open:r,groupName:t,onConfirm:e,onCancel:n}){return g.jsx(Qx,{open:r,onOpenChange:s=>!s&&n(),children:g.jsxs(dp,{children:[g.jsxs(Yx,{children:[g.jsx(hp,{children:"Delete Group?"}),g.jsxs(fp,{children:['Are you sure you want to delete the group "',t,'"? This action cannot be undone.']})]}),g.jsxs(Wx,{children:[g.jsx(gp,{onClick:n,children:"Cancel"}),g.jsx(pp,{onClick:e,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}function r5({group:r}){const{nodes:t,updateGroup:e,deleteGroup:n,removeNodeFromGroup:s,addNodeToGroup:i,selectGroup:o}=Ee(),[c,u]=C.useState(!1),[h,f]=C.useState(!1),[m,y]=C.useState(!1),[v,x]=C.useState(new Set),S=A=>{e(r.id,{name:A}),Ye.success("Group renamed"),f(!1)},R=()=>{u(!0)},M=()=>{n(r.id),o(null),Ye.success("Group deleted"),u(!1)},T=A=>{s(r.id,A),Ye.success("Component removed from group")},k=t.filter(A=>r.nodeIds.includes(A.id));return g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{children:[g.jsx(it,{htmlFor:"group-name",className:"text-xs font-medium",children:"Group Name"}),g.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[g.jsx(Tt,{id:"group-name",value:r.name,onChange:A=>e(r.id,{name:A.target.value}),className:"flex-1 h-8 text-xs"}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:R,children:g.jsx(Zl,{className:"h-3.5 w-3.5 text-destructive"})})]})]}),g.jsx(lM,{open:c,groupName:r.name,onConfirm:M,onCancel:()=>u(!1)}),g.jsx(yp,{open:h,initialName:r.name,onConfirm:S,onCancel:()=>f(!1)}),g.jsx(xn,{}),g.jsxs("div",{className:"flex items-center space-x-2",children:[g.jsx(Of,{id:"show-name",checked:r.showName!==!1,onCheckedChange:A=>e(r.id,{showName:A!==!1})}),g.jsx(it,{htmlFor:"show-name",className:"text-xs font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show name on canvas"})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(it,{className:"text-xs font-medium mb-1.5 block",children:"Color"}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("input",{type:"color",value:r.color||"#3b82f6",onChange:A=>e(r.id,{color:A.target.value}),className:"w-10 h-8 rounded border border-border cursor-pointer"}),g.jsx(Tt,{value:r.color||"#3b82f6",onChange:A=>e(r.id,{color:A.target.value}),className:"flex-1 font-mono text-xs h-8",placeholder:"#3b82f6"})]})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs(it,{className:"text-xs font-medium",children:["Components (",r.nodeIds.length,")"]}),g.jsxs(Te,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{if(Ee.getState().nodes.filter(P=>!r.nodeIds.includes(P.id)).length===0){Ye.info("All components are already in this group");return}x(new Set),y(!0)},children:[g.jsx(Hl,{className:"h-3 w-3 mr-1"}),"Add"]})]}),g.jsxs("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[k.map(A=>g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-secondary/50 rounded border border-border",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-xs font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:A.type})]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>T(A.id),title:"Remove from group",children:g.jsx(os,{className:"h-3 w-3"})})]},A.id)),k.length===0&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-3",children:"No components in group"})]})]}),g.jsx(xn,{}),g.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[g.jsx("span",{children:"Group ID:"}),g.jsx("code",{className:"font-mono bg-secondary/50 px-1.5 py-0.5 rounded text-[10px]",children:r.id})]}),g.jsx(mp,{open:m,onOpenChange:y,children:g.jsxs(ru,{className:"max-w-md",children:[g.jsxs(cu,{children:[g.jsx(uu,{children:"Add Components to Group"}),g.jsxs(du,{children:['Select components to add to "',r.name,'"']})]}),g.jsx(an,{className:"max-h-96",children:g.jsxs("div",{className:"space-y-2 py-2",children:[t.filter(A=>!r.nodeIds.includes(A.id)).map(A=>g.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border border-border hover:bg-secondary/50 cursor-pointer",onClick:()=>{const _=new Set(v);_.has(A.id)?_.delete(A.id):_.add(A.id),x(_)},children:[g.jsx(Of,{checked:v.has(A.id),onCheckedChange:_=>{const P=new Set(v);_?P.add(A.id):P.delete(A.id),x(P)}}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-xs text-muted-foreground truncate",children:A.type})]})]},A.id)),t.filter(A=>!r.nodeIds.includes(A.id)).length===0&&g.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"All components are already in this group"})]})}),g.jsxs(lu,{children:[g.jsx(Te,{variant:"outline",onClick:()=>{y(!1),x(new Set)},children:"Cancel"}),g.jsxs(Te,{onClick:()=>{if(v.size===0){Ye.error("Select at least one component");return}v.forEach(A=>{i(r.id,A)}),Ye.success(`${v.size} component(s) added to group`),y(!1),x(new Set)},children:["Add Selected (",v.size,")"]})]})]})})]})}function c5(){const{selectedNodeId:r,nodes:t,updateNode:e,selectNode:n,connections:s,updateConnection:i,selectedConnectionId:o,selectConnection:c,selectedGroupId:u,groups:h,selectGroup:f}=Ee(),{addTab:m}=Ru(),y=t.find(S=>S.id===r),v=s.find(S=>S.id===o),x=h.find(S=>S.id===u);return x?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(sf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Group Properties"})]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>f(null),children:g.jsx(os,{className:"h-3 w-3"})})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(r5,{group:x})})})]}):!y&&!v?g.jsx("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:g.jsxs(bp,{defaultValue:"stats",className:"h-full flex flex-col",children:[g.jsx("div",{className:"p-1 border-b border-border",children:g.jsxs(gu,{className:"grid w-full grid-cols-6 h-6 gap-0.5 p-0.5",children:[g.jsx(ss,{value:"stats",className:"text-xs px-1 py-0.5",children:"Stats"}),g.jsx(ss,{value:"diagnostics",className:"text-xs px-1 py-0.5",children:"Diag"}),g.jsx(ss,{value:"alerts",className:"text-xs px-1 py-0.5",children:"Alerts"}),g.jsx(ss,{value:"errors",className:"text-xs px-1 py-0.5",children:"Errors"}),g.jsx(ss,{value:"filters",className:"text-xs px-1 py-0.5",children:"Filter"}),g.jsx(ss,{value:"properties",className:"text-xs px-1 py-0.5",children:"Groups"})]})}),g.jsx(ni,{value:"stats",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(lI,{})})})}),g.jsx(ni,{value:"diagnostics",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(rI,{})}),g.jsx(ni,{value:"alerts",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(cI,{})}),g.jsx(ni,{value:"errors",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(n5,{})}),g.jsx(ni,{value:"filters",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(oI,{})})})}),g.jsx(ni,{value:"properties",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(an,{className:"h-full",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:g.jsxs("div",{children:[g.jsxs(ti,{as:"h4",className:"mb-1",children:["Groups (",h.length,")"]}),h.length>0?g.jsx("div",{className:"space-y-1",children:h.map(S=>g.jsx("div",{className:"p-1.5 bg-secondary/50 rounded border border-border cursor-pointer hover:bg-secondary transition-colors",onClick:()=>f(S.id),children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx(We,{size:"small",className:"font-medium truncate",children:S.name}),g.jsxs(We,{size:"micro",muted:!0,children:[S.nodeIds.length," component",S.nodeIds.length!==1?"s":""]})]}),g.jsx("div",{className:"w-2.5 h-2.5 rounded border-2 border-border flex-shrink-0 ml-1",style:{backgroundColor:S.color||"hsl(var(--primary))"}})]})},S.id))}):g.jsx(We,{size:"micro",muted:!0,className:"text-center py-2",children:"No groups created yet"})]})})})})]})}):v?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(sf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Connection"})]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>c(null),children:g.jsx(os,{className:"h-3 w-3"})})]}),g.jsx(an,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(Iz,{connection:v,onUpdate:(S,R)=>i(S,R)})})})]}):g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(sf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Properties"})]}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>n(null),children:g.jsx(os,{className:"h-3 w-3"})})]}),g.jsx(an,{className:"flex-1",children:g.jsxs("div",{className:"p-1.5 space-y-1.5",children:[g.jsx(aI,{componentId:y.id,componentLabel:y.data.label}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(it,{htmlFor:"label",className:"text-xs font-medium",children:"Label"}),g.jsx(Tt,{id:"label",value:y.data.label,onChange:S=>e(y.id,{data:{...y.data,label:S.target.value}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Position"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{children:[g.jsx(it,{htmlFor:"pos-x",className:"text-xs text-muted-foreground",children:"X"}),g.jsx(Tt,{id:"pos-x",type:"number",value:Math.round(y.position.x),onChange:S=>e(y.id,{position:{...y.position,x:parseInt(S.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsxs("div",{children:[g.jsx(it,{htmlFor:"pos-y",className:"text-xs text-muted-foreground",children:"Y"}),g.jsx(Tt,{id:"pos-y",type:"number",value:Math.round(y.position.y),onChange:S=>e(y.id,{position:{...y.position,y:parseInt(S.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]})]})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Component Type"}),g.jsx("div",{className:"bg-secondary/50 rounded-md p-1.5 border border-border",children:g.jsx(We,{mono:!0,size:"small",children:y.type})})]}),g.jsx(xn,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Configuration"}),g.jsx(Te,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:()=>{m({title:`${y.data.label} Config`,type:"component",componentId:y.id,componentType:y.type})},children:"Open Configuration Panel"})]})]})})]})}function l5(){const{tabs:r,setActiveTab:t,closeTab:e,addTab:n}=Ru(),s=()=>{n({title:"Untitled Diagram",type:"diagram"})};return g.jsx("div",{className:"h-10 bg-secondary/30 border-b border-border flex items-center",children:g.jsxs(an,{className:"flex-1",children:[g.jsxs("div",{className:"flex items-center",children:[r.map(i=>g.jsxs("div",{className:`
                flex items-center gap-2 px-4 h-10 border-r border-border cursor-pointer group
                transition-colors
                ${i.active?"bg-canvas-bg text-foreground":"text-muted-foreground hover:bg-secondary/50"}
              `,onClick:()=>t(i.id),children:[g.jsx("span",{className:"text-sm",children:i.title}),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:bg-destructive/10",onClick:o=>{o.stopPropagation(),e(i.id)},children:g.jsx(os,{className:"h-3 w-3"})})]},i.id)),g.jsx(Te,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:s,children:g.jsx(Hl,{className:"h-4 w-4"})})]}),g.jsx(nu,{orientation:"horizontal"})]})})}const Uv=r=>Symbol.iterator in r,Fv=r=>"entries"in r,Vv=(r,t)=>{const e=r instanceof Map?r:new Map(r.entries()),n=t instanceof Map?t:new Map(t.entries());if(e.size!==n.size)return!1;for(const[s,i]of e)if(!n.has(s)||!Object.is(i,n.get(s)))return!1;return!0},u5=(r,t)=>{const e=r[Symbol.iterator](),n=t[Symbol.iterator]();let s=e.next(),i=n.next();for(;!s.done&&!i.done;){if(!Object.is(s.value,i.value))return!1;s=e.next(),i=n.next()}return!!s.done&&!!i.done};function d5(r,t){return Object.is(r,t)?!0:typeof r!="object"||r===null||typeof t!="object"||t===null||Object.getPrototypeOf(r)!==Object.getPrototypeOf(t)?!1:Uv(r)&&Uv(t)?Fv(r)&&Fv(t)?Vv(r,t):u5(r,t):Vv({entries:()=>Object.entries(r)},{entries:()=>Object.entries(t)})}function uM(r){const t=kt.useRef(void 0);return e=>{const n=r(e);return d5(t.current,n)?t.current:t.current=n}}const Gv=globalThis;function Cl(r){try{if(typeof Gv.structuredClone=="function")return Gv.structuredClone(r)}catch{}return JSON.parse(JSON.stringify(r))}function So(r,t,e=140,n=100,s=16){const i=[],o=e/2,c=n/2,u=r+o,h=t+c;for(let f=0;f<s;f++){const m=f/s*2*Math.PI-Math.PI/2;let y,v;const x=(m%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(x>=0&&x<Math.PI/2){const S=x/(Math.PI/2);y=u+o,v=h-c+S*n}else if(x>=Math.PI/2&&x<Math.PI){const S=(x-Math.PI/2)/(Math.PI/2);y=u+o-S*e,v=h+c}else if(x>=Math.PI&&x<3*Math.PI/2){const S=(x-Math.PI)/(Math.PI/2);y=u-o,v=h+c-S*n}else{const S=(x-3*Math.PI/2)/(Math.PI/2);y=u-o+S*e,v=h-c}i.push({x:y,y:v,index:f})}return i}function h5(r,t,e){let n=1/0,s=0;for(let i=0;i<r.length;i++){const o=r[i],c=Math.sqrt(Math.pow(t-o.x,2)+Math.pow(e-o.y,2));c<n&&(n=c,s=i)}return s}function Qv(r,t,e,n,s,i,o,c=140,u=100){const h=So(i,o,c,u),f=h5(h,e,n);if(s.filter(y=>y.source===r&&y.target===t&&y.sourcePort===f||y.target===r&&y.source===t&&y.targetPort===f).length===0)return f;for(let y=1;y<h.length;y++){const v=(f+y)%h.length,x=(f-y+h.length)%h.length;if(s.filter(M=>M.source===r&&M.target===t&&M.sourcePort===v||M.target===r&&M.source===t&&M.targetPort===v).length===0)return v;if(s.filter(M=>M.source===r&&M.target===t&&M.sourcePort===x||M.target===r&&M.source===t&&M.targetPort===x).length===0)return x}return f}const dM=C.createContext(null);function f5({children:r}){const t=C.useRef(new Map),e=C.useCallback((o,c)=>{c?t.current.set(o,c):t.current.delete(o)},[]),n=C.useCallback(o=>t.current.get(o)||null,[]),s=C.useCallback(o=>{t.current.delete(o)},[]),i={registerNodeRef:e,getNodeRef:n,unregisterNodeRef:s};return g.jsx(dM.Provider,{value:i,children:r})}function ju(){const r=C.useContext(dM);if(!r)throw new Error("useNodeRefs must be used within NodeRefsProvider");return r}function p5({node:r,onConnectionStart:t,onConnectionEnd:e,isConnecting:n=!1,onContextMenu:s}){const{registerNodeRef:i,unregisterNodeRef:o}=ju(),c=C.useRef(null);C.useEffect(()=>(c.current&&i(r.id,c.current),()=>{o(r.id)}),[r.id,i,o]);const u=Ee(de=>de.selectNode),h=Ee(de=>de.updateNode),f=Ee(de=>de.updateNodes),m=Ee(de=>de.deleteNode);Ee(de=>de.addNode);const y=Ee(de=>de.startDragOperation),v=Ee(de=>de.endDragOperation);Ee(de=>de.bringToFront),Ee(de=>de.sendToBack),Ee(de=>de.bringForward),Ee(de=>de.sendBackward);const{connections:x,zoom:S,pan:R,nodes:M}=Ee(uM(de=>({connections:de.connections,zoom:de.zoom,pan:de.pan,nodes:de.nodes}))),{addTab:T}=Ru(),[k,A]=C.useState(!1),[_,P]=C.useState(!1),z=C.useRef({x:0,y:0}),q=C.useRef({x:0,y:0}),Z=C.useRef({x:0,y:0}),se=C.useRef({x:0,y:0}),ce=C.useRef(null),J=C.useRef(null),te=C.useRef(!1),le=C.useRef(!1),ue=C.useRef({}),L=C.useMemo(()=>jr.find(de=>de.type===r.type),[r.type]),{isRunning:N,getComponentMetrics:O}=Pt(),W=ma(de=>de.getComponentStatus(r.id)),fe=tM(de=>de.getComponentState(r.id)),j=N?O(r.id):void 0,Y=Br(de=>de.highlightedNodeId)===r.id,ie=C.useMemo(()=>x.some(de=>de.source===r.id||de.target===r.id),[x,r.id]),U=j&&(j.throughput&&j.throughput>.1||j.errorRate&&j.errorRate>.001||j.utilization&&j.utilization>.01),ae=()=>{if(!N||!j||!ie||!U)return"";const de=j.utilization||0,$e=j.errorRate||0,Ue=Math.min(1,de*.7+$e*.3);return Ue>.8?"border-red-500":Ue>.6?"border-orange-500":Ue>.4?"border-yellow-500":Ue>.2?"border-green-500":""},B=()=>{if(!N)return null;if(fe)switch(fe.state){case"disabled":case"failed":return g.jsx(kl,{className:"text-red-500",size:16});case"degraded":return g.jsx(as,{className:"text-yellow-500",size:16})}if(!ie||!U||!W)return null;const de=W.health,$e=16;switch(de){case"healthy":return g.jsx(Jf,{className:"text-green-500",size:$e});case"degraded":return g.jsx(as,{className:"text-yellow-500",size:$e});case"critical":return g.jsx(va,{className:"text-orange-500",size:$e});case"down":return g.jsx(pa,{className:"text-red-500",size:$e});default:return null}},Q=()=>{if(!N)return r.selected?"border-primary":"border-border";if(fe)switch(fe.state){case"disabled":case"failed":return"border-red-500 border-2";case"degraded":return"border-yellow-500 border-2"}if(!W)return r.selected?"border-primary":"border-border";if(W.criticalPath)return"border-purple-500 border-2";switch(W.health){case"down":return"border-red-500 border-2";case"critical":return"border-orange-500";case"degraded":return"border-yellow-500";default:return r.selected?"border-primary":"border-border"}},pe=C.useRef(S),me=C.useRef(R);C.useEffect(()=>{pe.current=S,me.current=R},[S,R]),C.useEffect(()=>{const de=Ue=>{if(!te.current)return;if(Ee.getState().getIsGroupDragging()){te.current=!1,le.current=!1,A(!1);return}const mt=Ue.clientX-q.current.x,$t=Ue.clientY-q.current.y,Ze=Math.sqrt(mt*mt+$t*$t);if(!le.current&&Ze>3){le.current=!0,A(!0),y(r.id);const xt=Ee.getState().nodes.filter(yt=>yt.selected);ue.current={},xt.forEach(yt=>{ue.current[yt.id]={x:yt.position.x,y:yt.position.y}})}if(le.current&&ce.current){const jt=pe.current,xt=me.current,yt=ce.current.getBoundingClientRect(),Xt=(Ue.clientX-yt.left-xt.x)/jt,Qt=(Ue.clientY-yt.top-xt.y)/jt,_s=Xt-Z.current.x,Xn=Qt-Z.current.y,hs=Ee.getState().nodes.filter(Kt=>Kt.selected),Jt=Object.keys(ue.current).length>0;if(hs.length>1&&Jt){const Kt=[];hs.forEach(Lt=>{const Fi=ue.current[Lt.id];Fi&&Kt.push({id:Lt.id,updates:{position:{x:Fi.x+_s,y:Fi.y+Xn}}})}),Kt.length>0&&f(Kt,!0)}else{const Kt=se.current.x+_s,Lt=se.current.y+Xn;h(r.id,{position:{x:Kt,y:Lt}},!0)}}},$e=()=>{te.current&&(te.current=!1,le.current&&(le.current=!1,A(!1),v()))};return document.addEventListener("mousemove",de),document.addEventListener("mouseup",$e),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",$e)}},[r.id,h,f,y,v]);const ye=de=>{if(de.button!==0)return;const Ue=Ee.getState().nodes.filter(Pn=>Pn.selected),bt=r.selected,mt=Ue.some(Pn=>Pn.id!==r.id);if(!(bt&&mt&&!de.ctrlKey&&!de.metaKey)){const Pn=de.ctrlKey||de.metaKey;u(r.id,Pn)}const $t=document.querySelector(".flex-1.overflow-hidden.relative");if(!$t){z.current={x:0,y:0},Z.current={x:0,y:0},se.current={x:0,y:0},ce.current=null,J.current=null;return}ce.current=$t;const Ze=pe.current,jt=me.current,xt=$t.getBoundingClientRect();J.current=xt;const yt=(de.clientX-xt.left-jt.x)/Ze,Xt=(de.clientY-xt.top-jt.y)/Ze;Z.current={x:yt,y:Xt};const Xn=Ee.getState().nodes.find(Pn=>Pn.id===r.id)?.position||r.position;se.current={x:Xn.x,y:Xn.y},z.current={x:yt-Xn.x,y:Xt-Xn.y},q.current={x:de.clientX,y:de.clientY},te.current=!0,le.current=!1,de.stopPropagation()},ve=de=>{de.stopPropagation(),de.preventDefault(),k&&(A(!1),v()),T({title:`${r.data.label} Config`,type:"component",componentId:r.id,componentType:r.type})},je=de=>{de.key==="Delete"&&r.selected&&m(r.id)},Be=de=>{if(de.preventDefault(),de.stopPropagation(),!r.selected){const $e=M.some(Ue=>Ue.id!==r.id&&Ue.selected);u(r.id,$e)}s?.(de.clientX,de.clientY)},at=(de,$e)=>{de.stopPropagation(),t?.($e)},Je=C.useCallback(()=>{if(!c.current)return{width:140,height:100};const Ue=(c.current.querySelector(".bg-card")||c.current).getBoundingClientRect();return{width:Ue.width/S,height:Ue.height/S}},[S]),Nt=de=>{if(n){de.stopPropagation();const $e=Je(),Ue=So(r.position.x,r.position.y,$e.width,$e.height,16),bt=document.querySelector(".flex-1.overflow-hidden.relative");if(bt){const mt=bt.getBoundingClientRect(),$t=(de.clientX-mt.left-R.x)/S,Ze=(de.clientY-mt.top-R.y)/S;let jt=1/0,xt=0;for(let yt=0;yt<Ue.length;yt++){const Xt=Ue[yt],Qt=Math.sqrt(Math.pow($t-Xt.x,2)+Math.pow(Ze-Xt.y,2));Qt<jt&&(jt=Qt,xt=yt)}e?.(xt)}else e?.()}};return g.jsx(g.Fragment,{children:g.jsx("div",{ref:c,"data-node-id":r.id,className:`
          absolute cursor-move select-none
          transition-shadow
          ${r.selected?"glow-primary":""}
          ${k?"pointer-events-none":""}
        `,style:{left:`${r.position.x}px`,top:`${r.position.y}px`},onMouseDown:ye,onMouseUp:Nt,onDoubleClick:ve,onContextMenu:Be,onKeyDown:je,onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),tabIndex:0,children:g.jsxs("div",{className:ke("bg-card border-2 rounded-lg p-4 min-w-[140px] relative",Q(),ae(),"hover:border-primary/50 transition-colors",W?.criticalPath&&"shadow-lg shadow-purple-500/20",Y&&"ring-4 ring-yellow-400 ring-offset-2 animate-pulse"),children:[N&&W&&g.jsx("div",{className:"absolute -top-2 -right-2 bg-card rounded-full p-0.5 border border-border",children:B()}),N&&W?.criticalPath&&g.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 bg-purple-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-semibold",children:"CRITICAL"}),g.jsxs("div",{className:"flex flex-col items-center gap-2 select-none",children:[g.jsx("div",{className:"text-3xl select-none pointer-events-none",children:L?.icon}),g.jsx("div",{className:"text-sm font-medium text-center text-foreground select-none pointer-events-none",children:r.data.label})]}),(_||n)&&(()=>{const de=c.current?(()=>{const mt=(c.current.querySelector(".bg-card")||c.current).getBoundingClientRect();return{width:mt.width/S,height:mt.height/S}})():{width:140,height:100},$e=So(r.position.x,r.position.y,de.width,de.height,16);return g.jsx(g.Fragment,{children:$e.map((Ue,bt)=>{const mt=Ue.x-r.position.x,$t=Ue.y-r.position.y;return g.jsx("div",{className:"absolute w-3 h-3 rounded-full bg-primary/80 border-2 border-card cursor-crosshair hover:scale-150 hover:bg-primary transition-all z-10",style:{left:`${mt-6}px`,top:`${$t-6}px`},onMouseDown:Ze=>{Ze.stopPropagation(),at(Ze,bt)},onMouseUp:Ze=>{Ze.stopPropagation(),n&&e?.(bt)},title:"Connection point"},bt)})})})()]})})})}const g5=C.memo(p5,(r,t)=>!(r.node.id!==t.node.id||r.node.position.x!==t.node.position.x||r.node.position.y!==t.node.position.y||r.node.selected!==t.node.selected||r.node.type!==t.node.type||r.node.data.label!==t.node.data.label||r.isConnecting!==t.isConnecting||r.onConnectionStart!==t.onConnectionStart||r.onConnectionEnd!==t.onConnectionEnd||r.onContextMenu!==t.onContextMenu));function m5({selectedNodeId:r,highlightPath:t=!0}){const{nodes:e,connections:n}=Ee(),{isRunning:s}=Pt(),{getConnectionMessages:i}=Li(),[o,c]=C.useState(new Set),[u,h]=C.useState(new Map);return C.useEffect(()=>{if(!r||!t||!s){c(new Set),h(new Map);return}const f=new Set,m=new Map,y=[{nodeId:r,path:[r]}];for(;y.length>0;){const{nodeId:v,path:x}=y.shift();if(f.has(v))continue;f.add(v);const S=n.filter(R=>R.source===v);for(const R of S){const M=R.target,T=[...x,M];m.set(R.id,T),f.has(M)||y.push({nodeId:M,path:T})}}h(m),c(new Set(m.keys()))},[r,n,t,s]),C.useEffect(()=>{if(!r||!t||!s)return;const f=new Set,m=[{nodeId:r,path:[r]}];for(;m.length>0;){const{nodeId:y,path:v}=m.shift();if(f.has(y))continue;f.add(y);const x=n.filter(S=>S.target===y);for(const S of x){const R=S.source,M=[R,...v],T=u.get(S.id)||[];(T.length===0||M.length<T.length)&&(u.set(S.id,M),h(new Map(u))),f.has(R)||m.push({nodeId:R,path:M})}}c(new Set(u.keys()))},[r,n,t,s]),null}function y5(r){const{selectedNodeId:t}=Ee(),{isRunning:e}=Pt(),[n,s]=C.useState(!1);return C.useEffect(()=>{if(!t||!e){s(!1);return}const{nodes:i,connections:o}=Ee.getState();if(!i.find(h=>h.id===t)){s(!1);return}const u=o.find(h=>h.id===r);u&&(u.source===t||u.target===t)?s(!0):s(!1)},[t,r,e]),n}const hM=C.createContext(null);function v5({children:r}){const t=C.useRef(null),e=C.useRef(new WeakMap);C.useEffect(()=>(t.current=new ResizeObserver(i=>{i.forEach(o=>{const c=e.current.get(o.target);c&&c()})}),()=>{t.current&&(t.current.disconnect(),t.current=null)}),[]);const s={observe:C.useCallback((i,o)=>t.current?(e.current.set(i,o),t.current.observe(i),()=>{t.current&&(t.current.unobserve(i),e.current.delete(i))}):()=>{},[])};return g.jsx(hM.Provider,{value:s,children:r})}function fM(){const r=C.useContext(hM);if(!r)throw new Error("useResizeObserver must be used within ResizeObserverProvider");return r}function b5({connection:r,sourceNode:t,targetNode:e,zoom:n,pan:s,isSelected:i=!1,onClick:o,onContextMenu:c}){const[u,h]=C.useState(!1),{isRunning:f,connectionMetrics:m}=Pt(uM(Q=>({isRunning:Q.isRunning,connectionMetrics:Q.connectionMetrics}))),y=f?m.get(r.id):void 0,{getConnectionMessages:v}=Li(),x=Ee(Q=>Q.selectedNodeId),S=Ee(Q=>Q.connections),R=f?v(r.id):[],M=C.useMemo(()=>R.filter(Q=>Q.status==="in-transit"||Q.status==="pending"),[R]),T=y5(r.id);C.useMemo(()=>S.some(Q=>Q.source===r.target&&Q.target===r.source),[S,r.target,r.source]);const{getNodeRef:k}=ju(),{observe:A}=fM(),[_,P]=C.useState(()=>{const Q=pe=>{const me=k(pe);if(!me)return{width:140,height:100};const je=(me.querySelector(".bg-card")||me).getBoundingClientRect();return{width:je.width/n,height:je.height/n}};return{source:Q(t.id),target:Q(e.id)}});C.useEffect(()=>{const Q=()=>{const Je=Nt=>{const de=k(Nt);if(!de)return{width:140,height:100};const bt=(de.querySelector(".bg-card")||de).getBoundingClientRect();return{width:bt.width/n,height:bt.height/n}};P({source:Je(t.id),target:Je(e.id)})};Q();const pe=k(t.id),me=k(e.id),ye=pe?.querySelector(".bg-card"),ve=me?.querySelector(".bg-card"),je=ye||pe,Be=ve||me,at=[];if(je){const Je=A(je,Q);at.push(Je)}if(Be){const Je=A(Be,Q);at.push(Je)}return()=>{at.forEach(Je=>Je())}},[t.id,e.id,n,k,A]);const z=_.source.width,q=_.source.height,Z=_.target.width,se=_.target.height,ce=z/2,J=q/2,te=Z/2,le=se/2;let ue,L,N,O;if(r.sourcePort!==void 0&&r.targetPort!==void 0){const Q=So(t.position.x,t.position.y,z,q,16),pe=So(e.position.x,e.position.y,Z,se,16),me=Q[r.sourcePort],ye=pe[r.targetPort];ue=me.x,L=me.y,N=ye.x,O=ye.y}else{const Q=t.position.x+ce,pe=t.position.y+J,me=e.position.x+te,ye=e.position.y+le,ve=Math.atan2(ye-pe,me-Q),je=(Je,Nt,de,$e)=>{const Ue=Math.abs(de),bt=$e?ce:te,mt=$e?J:le,$t=Math.atan2(mt,bt);let Ze,jt;if(Ue<$t||Ue>Math.PI-$t){const xt=$e?1:-1;Ze=Je+xt*bt*Math.sign(Math.cos(de)),jt=Nt+xt*bt*Math.tan(de)*Math.sign(Math.cos(de))}else{const xt=$e?1:-1;Ze=Je+xt*mt/Math.tan(de)*Math.sign(Math.sin(de)),jt=Nt+xt*mt*Math.sign(Math.sin(de))}return{x:Ze,y:jt}},Be=je(Q,pe,ve,!0),at=je(me,ye,ve,!1);ue=Be.x,L=Be.y,N=at.x,O=at.y}const W=N-ue,fe=O-L,j=Math.min(Math.abs(W),Math.abs(fe))*.3+30,F=`
    M ${ue},${L}
    C ${ue+j*Math.sign(W)},${L}
      ${N-j*Math.sign(W)},${O}
      ${N},${O}
  `;let Y="hsl(var(--border))",ie=2;T&&x?(Y="hsl(280 100% 70%)",ie=3):i?(Y="hsl(var(--primary))",ie=2.5):u?(Y="hsl(var(--accent))",ie=2.5):y&&f&&(y.effectiveThroughput>0||y.traffic>0)&&(y.bottleneck?(Y="hsl(0 84% 60%)",ie=3):y.backpressure>.7?(Y="hsl(25 95% 53%)",ie=2.5):y.congestion>.6?(Y="hsl(45 93% 47%)",ie=2.5):y.throughputDependency>.5?(Y="hsl(142 76% 36%)",ie=2):y.effectiveThroughput>0&&(Y="hsl(var(--primary))",ie=2));const U=Q=>{Q.stopPropagation(),o?.()},ae=Q=>{Q.preventDefault(),Q.stopPropagation(),c?.(Q)},B=f&&y&&y.effectiveThroughput>0?y.effectiveThroughput%40/2:0;return g.jsxs("g",{children:[g.jsx("path",{d:F,fill:"none",stroke:"transparent",strokeWidth:20/n,style:{cursor:"pointer"},onClick:U,onContextMenu:ae,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)}),f&&y&&y.effectiveThroughput>0&&y.traffic>0&&g.jsx("path",{d:F,fill:"none",stroke:Y,strokeWidth:Math.max(1,ie/n),strokeLinecap:"round",strokeDasharray:`${Math.max(4,8/n)} ${Math.max(2,4/n)}`,strokeDashoffset:-B,style:{opacity:.4,pointerEvents:"none",animation:"flow 2s linear infinite"}}),f&&M.map((Q,pe)=>{const me=Date.now()-Q.timestamp,ve=Q.latency?Math.min(1,me/Q.latency):0,je=ue+(N-ue)*ve,Be=L+(O-L)*ve,Je={json:"hsl(142 76% 36%)",xml:"hsl(25 95% 53%)",binary:"hsl(221 83% 53%)",protobuf:"hsl(280 100% 70%)",text:"hsl(210 40% 50%)"}[Q.format]||"hsl(var(--primary))";return g.jsxs("g",{children:[g.jsx("circle",{cx:je,cy:Be,r:4/n,fill:Je,stroke:"hsl(var(--background))",strokeWidth:1/n,style:{pointerEvents:"none",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.3))"},children:g.jsx("animate",{attributeName:"opacity",values:"0.5;1;0.5",dur:"1s",repeatCount:"indefinite"})}),Q.size>1e3&&g.jsx("text",{x:je,y:Be-8/n,fill:Je,fontSize:8/n,textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:Q.format})]},Q.id||pe)}),g.jsx("path",{d:F,fill:"none",stroke:Y,strokeWidth:Math.max(1,ie/n),strokeLinecap:"round",markerEnd:f&&y&&(y.effectiveThroughput>0||y.traffic>0)?`url(#arrowhead-${i?"selected":y?.bottleneck?"bottleneck":"default"})`:i?"url(#arrowhead-selected)":"url(#arrowhead-default)",style:{transition:"stroke 0.3s, stroke-width 0.3s",pointerEvents:"none"}}),f&&y&&(y.effectiveThroughput>0||y.traffic>0)?g.jsxs("g",{children:[g.jsx("text",{x:(ue+N)/2,y:(L+O)/2-10/n,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/n),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:r.label||`${y.latency.toFixed(1)}ms`}),g.jsx("text",{x:(ue+N)/2,y:(L+O)/2+8/n,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(7,9/n),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:y.traffic>0?`${y.traffic.toFixed(1)} KB/s`:`${y.effectiveThroughput.toFixed(0)} msg/s`}),r.data?.bandwidthMbps&&y.traffic>0&&g.jsxs("text",{x:(ue+N)/2,y:(L+O)/2+20/n,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(6,8/n),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none",opacity:.7},children:["Limit: ",r.data.bandwidthMbps,"Mbps"]})]}):r.label?g.jsx("g",{children:g.jsx("text",{x:(ue+N)/2,y:(L+O)/2-10/n,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/n),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:r.label})}):null]})}const x5=C.memo(b5,(r,t)=>!(r.connection.id!==t.connection.id||r.connection.sourcePort!==t.connection.sourcePort||r.connection.targetPort!==t.connection.targetPort||r.connection.label!==t.connection.label||r.sourceNode.id!==t.sourceNode.id||r.sourceNode.position.x!==t.sourceNode.position.x||r.sourceNode.position.y!==t.sourceNode.position.y||r.targetNode.id!==t.targetNode.id||r.targetNode.position.x!==t.targetNode.position.x||r.targetNode.position.y!==t.targetNode.position.y||r.zoom!==t.zoom||r.pan.x!==t.pan.x||r.pan.y!==t.pan.y||r.isSelected!==t.isSelected||r.onClick!==t.onClick||r.onContextMenu!==t.onContextMenu)),w5=140,C5=140,S5=16;function M5({nodeId:r,position:t}){const e=Pt(f=>f.componentMetrics.get(r)),{connections:n}=Ee(),{isRunning:s}=Pt(),i=n.some(f=>f.source===r||f.target===r),o=e&&(e.throughput&&e.throughput>.1||e.errorRate&&e.errorRate>.001||e.utilization&&e.utilization>.01),c=C.useMemo(()=>{if(!e)return[];const f=[{label:"Throughput",value:`${Math.round(e.throughput)}`,unit:"ops/s",color:"text-blue-400"},{label:"Latency (avg)",value:`${Math.round(e.latency)}`,unit:"ms",color:"text-yellow-400"}];return e.latencyP50!==void 0&&f.push({label:"Latency (p50)",value:`${Math.round(e.latencyP50)}`,unit:"ms",color:"text-green-400"}),e.latencyP99!==void 0&&f.push({label:"Latency (p99)",value:`${Math.round(e.latencyP99)}`,unit:"ms",color:"text-red-400"}),f.push({label:"Error Rate",value:`${(e.errorRate*100).toFixed(2)}`,unit:"%",color:"text-orange-400"},{label:"Utilization",value:`${Math.round(e.utilization*100)}`,unit:"%",color:"text-purple-400"}),f},[e]);if(!s||!e||!i||!o||c.length===0)return null;const u=t.x+w5/2,h=t.y+C5+S5;return g.jsx("div",{className:"absolute pointer-events-none",style:{left:`${u}px`,top:`${h}px`,transform:"translateX(-50%)",zIndex:10},children:g.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-2 shadow-lg min-w-max",children:g.jsx("div",{className:"text-xs space-y-1",children:c.map(f=>g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("span",{className:"text-slate-400",children:[f.label,":"]}),g.jsxs("span",{className:`font-mono font-semibold ${f.color}`,children:[f.value," ",f.unit]})]},f.label))})})})}function R5({isVisible:r=!0}){return r?g.jsx("div",{className:"absolute bottom-4 right-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-muted-foreground",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-green-500/20 border border-green-500/30"}),g.jsx("span",{children:"<20%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500/20 border border-yellow-500/30"}),g.jsx("span",{children:"20-40%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-orange-500/20 border border-orange-500/30"}),g.jsx("span",{children:"40-60%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-red-500/20 border border-red-500/30"}),g.jsx("span",{children:">60%"})]})]})}):null}function E5({isVisible:r=!0}){const{nodes:t,connections:e,zoom:n,pan:s}=Ee(),{isRunning:i}=Pt(),o=kt.useMemo(()=>{if(t.length===0)return{minX:0,minY:0,maxX:2e3,maxY:2e3};const T=t.map(q=>q.position.x),k=t.map(q=>q.position.y),A=Math.min(...T)-200,_=Math.min(...k)-200,P=Math.max(...T)+200,z=Math.max(...k)+200;return{minX:A,minY:_,maxX:P,maxY:z}},[t]),c=o.maxX-o.minX,u=o.maxY-o.minY,h=120,f=80,m=h/Math.max(c,1e3),y=f/Math.max(u,1e3),v=Math.min(m,y),x=window.innerWidth/n*v,S=window.innerHeight/n*v,R=(-s.x/n-o.minX)*v,M=(-s.y/n-o.minY)*v;return r?g.jsx("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("svg",{width:h,height:f,className:"border border-border/50 rounded",style:{background:"hsl(var(--background))"},children:[e.map(T=>{const k=t.find(Z=>Z.id===T.source),A=t.find(Z=>Z.id===T.target);if(!k||!A)return null;const _=(k.position.x-o.minX)*v,P=(k.position.y-o.minY)*v,z=(A.position.x-o.minX)*v,q=(A.position.y-o.minY)*v;return g.jsx("line",{x1:_,y1:P,x2:z,y2:q,stroke:"hsl(var(--border))",strokeWidth:.3,opacity:.2},T.id)}),t.map(T=>g.jsx("circle",{cx:(T.position.x-o.minX)*v,cy:(T.position.y-o.minY)*v,r:1.5,fill:"hsl(var(--muted-foreground))",opacity:.5},T.id)),g.jsx("rect",{x:R,y:M,width:x,height:S,fill:"hsl(var(--primary))",fillOpacity:.2,stroke:"hsl(var(--primary))",strokeWidth:1.5,strokeDasharray:"2 2"})]})}):null}function k5({x:r,y:t,onDelete:e,onRename:n,onCopyId:s,onClose:i}){const o=C.useRef(null),[c,u]=C.useState({x:r,y:t});return C.useEffect(()=>{if(o.current){const h=o.current.getBoundingClientRect(),f=window.innerWidth,m=window.innerHeight;let y=r,v=t;r+h.width>f&&(y=f-h.width-10),t+h.height>m&&(v=m-h.height-10),y=Math.max(10,y),v=Math.max(10,v),u({x:y,y:v})}},[r,t]),C.useEffect(()=>{const h=m=>{o.current&&!o.current.contains(m.target)&&i()},f=m=>{m.key==="Escape"&&i()};return document.addEventListener("mousedown",h),document.addEventListener("keydown",f),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("keydown",f)}},[i]),g.jsxs("div",{ref:o,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[120px]",style:{left:`${c.x}px`,top:`${c.y}px`},children:[g.jsxs("button",{onClick:()=>{n(),i()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(LD,{className:"w-3.5 h-3.5"}),"Rename"]}),g.jsxs("button",{onClick:()=>{s(),i()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Db,{className:"w-3.5 h-3.5"}),"Copy ID"]}),g.jsx("div",{className:"border-t border-border my-0.5"}),g.jsxs("button",{onClick:()=>{e(),i()},className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}const T5=140,A5=100;function D5(r,t,e){const n=e(r);if(!n)return{width:T5,height:A5};const o=(n.querySelector(".bg-card")||n).getBoundingClientRect();return{width:o.width/t,height:o.height/t}}function _5(r,t){const{getNodeRef:e}=ju(),{observe:n}=fM(),[s,i]=C.useState({}),o=C.useCallback(()=>{const c={};r.forEach(u=>{const h=D5(u,t,e);h&&(c[u]=h)}),i(u=>({...u,...c}))},[r,t,e]);return C.useEffect(()=>{if(r.length===0)return;o();const c=[];return r.forEach(u=>{const h=e(u);if(h){const m=h.querySelector(".bg-card")||h;if(m){const y=n(m,o);c.push(y)}}}),()=>{c.forEach(u=>u())}},[r,t,o,e,n]),s}const mf=20,P5=140,N5=100,j5=18,L5=6,z5=j5+L5*2;function I5(r,t,e,n){return C.useMemo(()=>{const s=t.filter(y=>r.nodeIds.includes(y.id));if(s.length===0)return null;const i=mf,o=mf,c=r.showName!==!1?z5:mf;let u=1/0,h=1/0,f=-1/0,m=-1/0;return s.forEach(y=>{const v=e[y.id]||{width:P5,height:N5},x=y.position.x,S=y.position.y,R=x+v.width,M=S+v.height;u=Math.min(u,x),h=Math.min(h,S),f=Math.max(f,R),m=Math.max(m,M)}),{x:u-i,y:h-c,width:f-u+i*2,height:m-h+c+o}},[t,r.nodeIds,e,n,r.showName])}function O5(r,t){const{nodes:e,updateNodes:n}=Ee(),[s,i]=C.useState(!1),o=C.useRef({x:0,y:0}),c=C.useRef({}),u=C.useCallback(h=>{if(h.button!==0||h.target.closest("[data-node-id]"))return;h.stopPropagation();const y=Ee.getState();y.selectGroup(r.id),i(!0),o.current.x=h.clientX,o.current.y=h.clientY,y.setGroupDragging(!0);const v=e.filter(x=>r.nodeIds.includes(x.id));c.current={},v.forEach(x=>{c.current[x.id]={...x.position}})},[r.id,r.nodeIds,e]);return C.useEffect(()=>{if(!s)return;let h=null,f=null,m=!0;const y=x=>{if(!m)return;const S=(x.clientX-o.current.x)/t,R=(x.clientY-o.current.y)/t;f={dx:S,dy:R},h===null&&(h=requestAnimationFrame(()=>{if(!m||!f){h=null,f=null;return}const{dx:M,dy:T}=f,k=Ee.getState(),A=r.nodeIds.map(_=>{const P=c.current[_];return P?{id:_,updates:{position:{x:P.x+M,y:P.y+T}}}:null}).filter(_=>_!==null);A.length>0&&k.updateNodes(A,!0),h=null,f=null}))},v=x=>{if(x&&x.button!==0)return;m=!1,h!==null&&(cancelAnimationFrame(h),h=null);const S=Ee.getState();if(f){const{dx:R,dy:M}=f,T=r.nodeIds.map(k=>{const A=c.current[k];return A?{id:k,updates:{position:{x:A.x+R,y:A.y+M}}}:null}).filter(k=>k!==null);if(S.setGroupDragging(!1),T.length>0){S.updateNodes(T,!0);const k=Ee.getState();gt(k,k.diagramName)}}else S.setGroupDragging(!1);f=null,i(!1)};return document.addEventListener("mousemove",y,{passive:!0}),document.addEventListener("mouseup",v,{capture:!0}),()=>{m=!1,h!==null&&cancelAnimationFrame(h),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",v,{capture:!0}),Ee.getState().setGroupDragging(!1)}},[s,r.nodeIds,t]),{isDragging:s,handleMouseDown:u}}const Kv=18,Sl=6;function H5({group:r,zoom:t}){const{nodes:e,selectedGroupId:n,selectGroup:s,deleteGroup:i,updateGroup:o}=Ee(),[c,u]=C.useState(null),[h,f]=C.useState(!1),[m,y]=C.useState(!1),v=_5(r.nodeIds,t),x=I5(r,e,v,t),{handleMouseDown:S}=O5(r,t);if(!x)return null;const R=n===r.id,M=r.color||"hsl(var(--primary))",T=q=>{q.preventDefault(),q.stopPropagation(),s(r.id),u({x:q.clientX,y:q.clientY})},k=()=>{f(!0)},A=()=>{i(r.id),Ye.success("Group deleted"),f(!1)},_=()=>{y(!0)},P=q=>{o(r.id,{name:q}),Ye.success("Group renamed"),y(!1)},z=()=>{navigator.clipboard.writeText(r.id),Ye.success("Group ID copied to clipboard")};return g.jsxs(g.Fragment,{children:[g.jsxs("g",{children:[g.jsx("rect",{x:x.x,y:x.y,width:x.width,height:x.height,fill:M,fillOpacity:R?.1:.05,stroke:M,strokeWidth:R?3/t:2/t,strokeDasharray:R?"0":"5,5",rx:8/t,ry:8/t,style:{cursor:"pointer",transition:"all 0.2s"},onMouseDown:S,onContextMenu:T}),r.showName!==!1&&g.jsxs("g",{onClick:q=>{q.stopPropagation(),s(r.id)},onContextMenu:T,style:{cursor:"pointer"},children:[g.jsx("rect",{x:x.x+Sl,y:x.y+Sl,width:Math.max(80,r.name.length*6.5+16),height:Kv,fill:M,fillOpacity:.85,rx:3,ry:3,stroke:M,strokeWidth:.5}),g.jsx("text",{x:x.x+Sl+8,y:x.y+Sl+Kv/2,fill:"white",fontSize:11,fontWeight:"600",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:r.name})]})]}),c&&g.jsx(k5,{x:c.x,y:c.y,onDelete:k,onRename:_,onCopyId:z,onClose:()=>u(null)}),g.jsx(lM,{open:h,groupName:r.name,onConfirm:A,onCancel:()=>f(!1)}),g.jsx(yp,{open:m,initialName:r.name,onConfirm:P,onCancel:()=>y(!1)})]})}const q5=C.memo(H5,(r,t)=>!(r.group.id!==t.group.id||r.group.name!==t.group.name||r.group.color!==t.group.color||r.group.nodeIds.length!==t.group.nodeIds.length||r.group.nodeIds.some((e,n)=>e!==t.group.nodeIds[n])||r.zoom!==t.zoom));function $5({isVisible:r,canvasRef:t}){const{zoom:e,pan:n}=Ee(),[s,i]=C.useState(null),o=C.useRef(null);if(C.useEffect(()=>{if(!r){i(null);return}const _=()=>{if(t?.current)i(t.current.getBoundingClientRect());else if(o.current?.parentElement){const se=o.current.parentElement.getBoundingClientRect(),ce=24;i({...se,width:se.width-ce,height:se.height-ce,left:se.left+ce,top:se.top+ce})}},P=setTimeout(_,10),z=requestAnimationFrame(_),q=requestAnimationFrame(()=>{requestAnimationFrame(_)});return window.addEventListener("resize",_),()=>{clearTimeout(P),cancelAnimationFrame(z),cancelAnimationFrame(q),window.removeEventListener("resize",_)}},[r,t]),C.useEffect(()=>{if(!r)return;const P=requestAnimationFrame(()=>{t?.current&&i(t.current.getBoundingClientRect())});return()=>cancelAnimationFrame(P)},[e,n,r,t]),!r)return null;if(!s)return g.jsx("div",{ref:o,className:"absolute inset-0 pointer-events-none z-20"});const c=20,u=c*e;let h=1;u<10?h=10:u<20?h=5:u<40&&(h=2);const f=c*h,m=24,y=24,v=s.width,x=s.height,S=Math.floor(-n.x/e/f)*f,R=Math.floor(-n.y/e/f)*f,M=S+v/e+f*2,T=R+x/e+f*2,k=[];for(let _=S;_<=M;_+=f)k.push(_);const A=[];for(let _=R;_<=T;_+=f)A.push(_);return g.jsxs("div",{ref:o,className:"absolute inset-0 pointer-events-none z-20",children:[g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-border pointer-events-none",style:{top:0,left:`${m}px`,right:0,height:`${y}px`,transform:`translate(${n.x}px, 0) scale(${e})`,transformOrigin:"0 0"},children:k.map(_=>g.jsx("div",{className:"absolute top-0 bottom-0 border-l border-border/60",style:{left:`${_}px`,width:"1px"},children:g.jsx("span",{className:"absolute top-0.5 left-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/e})`,transformOrigin:"0 0"},children:_})},`h-${_}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-r border-border pointer-events-none",style:{top:`${y}px`,left:0,bottom:0,width:`${m}px`,transform:`translate(0, ${n.y}px) scale(${e})`,transformOrigin:"0 0"},children:A.map(_=>g.jsx("div",{className:"absolute left-0 right-0 border-t border-border/60",style:{top:`${_}px`,height:"1px"},children:g.jsx("span",{className:"absolute left-0.5 top-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/e})`,transformOrigin:"0 0"},children:_})},`v-${_}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-r border-border pointer-events-none",style:{top:0,left:0,width:`${m}px`,height:`${y}px`}})]})}function B5({x:r,y:t,onDelete:e,onDuplicate:n,onCopyId:s,onBringToFront:i,onSendToBack:o,onBringForward:c,onSendBackward:u,onAddToGroup:h,onRemoveFromGroup:f,onClose:m}){const y=C.useRef(null);C.useEffect(()=>{const P=q=>{y.current&&!y.current.contains(q.target)&&m()},z=q=>{q.key==="Escape"&&m()};return document.addEventListener("mousedown",P),document.addEventListener("keydown",z),()=>{document.removeEventListener("mousedown",P),document.removeEventListener("keydown",z)}},[m]);const v=()=>{e(),m()},x=()=>{n(),m()},S=()=>{s(),m()},R=()=>{i?.(),m()},M=()=>{o?.(),m()},T=()=>{c?.(),m()},k=()=>{u?.(),m()},A=()=>{h?.(),m()},_=()=>{f?.(),m()};return g.jsxs("div",{ref:y,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[140px]",style:{left:`${r}px`,top:`${t}px`},children:[g.jsxs("button",{onClick:x,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Nb,{className:"w-3.5 h-3.5"}),"Duplicate"]}),g.jsxs("button",{onClick:S,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Db,{className:"w-3.5 h-3.5"}),"Copy ID"]}),(h||f)&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"border-t border-border my-0.5"}),f&&g.jsxs("button",{onClick:_,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(ZA,{className:"w-3.5 h-3.5"}),"Remove from Group"]}),h&&g.jsxs("button",{onClick:A,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(xf,{className:"w-3.5 h-3.5"}),"Add to Group"]})]}),g.jsx("div",{className:"border-t border-border my-0.5"}),(i||o||c||u)&&g.jsxs(g.Fragment,{children:[g.jsxs("button",{onClick:R,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(PA,{className:"w-3.5 h-3.5"}),"Bring to Front"]}),g.jsxs("button",{onClick:M,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(TA,{className:"w-3.5 h-3.5"}),"Send to Back"]}),g.jsxs("button",{onClick:T,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Ab,{className:"w-3.5 h-3.5"}),"Bring Forward"]}),g.jsxs("button",{onClick:k,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Jl,{className:"w-3.5 h-3.5"}),"Send Backward"]}),g.jsx("div",{className:"border-t border-border my-0.5"})]}),g.jsxs("button",{onClick:v,className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}function U5({nodeId:r,x:t,y:e,onClose:n}){const s=C.useRef(null),{groups:i,addNodeToGroup:o}=Ee();return C.useEffect(()=>{const c=h=>{s.current&&!s.current.contains(h.target)&&n()},u=h=>{h.key==="Escape"&&n()};return document.addEventListener("mousedown",c),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("keydown",u)}},[n]),g.jsxs("div",{ref:s,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${t}px`,top:`${e}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Add to Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:(()=>{const c=i.filter(u=>!u.nodeIds.includes(r));return c.length>0?c.map(u=>g.jsxs("button",{onClick:()=>{o(u.id,r),Ye.success(`Added to "${u.name}"`),n()},className:"w-full px-2 py-1.5 text-xs text-left text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:u.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:u.name})]},u.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:i.length===0?"No groups available":"Already in all groups"})})()}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:n,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function F5({nodeId:r,x:t,y:e,onClose:n}){const s=C.useRef(null),{groups:i,removeNodeFromGroup:o}=Ee(),c=i.filter(u=>u.nodeIds.includes(r));return C.useEffect(()=>{const u=f=>{s.current&&!s.current.contains(f.target)&&n()},h=f=>{f.key==="Escape"&&n()};return document.addEventListener("mousedown",u),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("keydown",h)}},[n]),g.jsxs("div",{ref:s,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${t}px`,top:`${e}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Remove from Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:c.length>0?c.map(u=>g.jsxs("button",{onClick:()=>{o(u.id,r),Ye.success(`Removed from "${u.name}"`),n()},className:"w-full px-2 py-1.5 text-xs text-left text-destructive hover:bg-destructive/10 hover:text-destructive flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:u.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:u.name})]},u.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:"Not in any groups"})}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:n,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function V5({x:r,y:t,onDelete:e,onClose:n}){const s=C.useRef(null),[i,o]=C.useState({x:r,y:t});return C.useEffect(()=>{if(s.current){const c=s.current.getBoundingClientRect(),u=window.innerWidth,h=window.innerHeight;let f=r,m=t;r+c.width>u&&(f=u-c.width-8),t+c.height>h&&(m=h-c.height-8),f=Math.max(8,f),m=Math.max(8,m),o({x:f,y:m})}},[r,t]),C.useEffect(()=>{const c=h=>{s.current&&!s.current.contains(h.target)&&n()},u=h=>{h.key==="Escape"&&n()};return document.addEventListener("mousedown",c),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("keydown",u)}},[n]),g.jsx("div",{ref:s,className:"fixed bg-card border border-border rounded-md shadow-lg z-50",style:{left:`${i.x}px`,top:`${i.y}px`},children:g.jsx("button",{className:"w-full px-3 py-2 text-sm text-left hover:bg-accent transition-colors first:rounded-t-md last:rounded-b-md",onClick:e,children:"Delete"})})}function Yv(){const r=C.useRef(null),{nodes:t,connections:e,groups:n=[],addNode:s,addConnection:i,deleteConnection:o,zoom:c,pan:u,setPan:h,setZoom:f,selectNode:m,selectConnection:y,selectGroup:v,selectNodesByIds:x,selectedConnectionId:S,selectedNodeId:R,setViewportSize:M,deleteNode:T,updateNode:k,bringToFront:A,sendToBack:_,bringForward:P,sendBackward:z,canvasBounds:q,canvasChunks:Z,addNodeToGroup:se,removeNodeFromGroup:ce}=Ee(),{isRunning:J}=Pt(),{showMinimap:te,showHeatMapLegend:le,showRuler:ue}=Br(),{getNodeRef:L}=ju(),[N,O]=C.useState(!1),[W,fe]=C.useState({x:0,y:0}),[j,F]=C.useState(!1),[Y,ie]=C.useState(null),[U,ae]=C.useState(void 0),[B,Q]=C.useState(null),[pe,me]=C.useState(null),[ye,ve]=C.useState(null),[je,Be]=C.useState(null),[at,Je]=C.useState(null),[Nt,de]=C.useState(null),[$e,Ue]=C.useState(null);C.useEffect(()=>{if(!r.current)return;const ee=()=>{if(!r.current)return;const be=r.current.getBoundingClientRect();M({width:be.width,height:be.height})};ee();const he=new ResizeObserver(()=>{ee()});return he.observe(r.current),window.addEventListener("resize",ee),()=>{he.disconnect(),window.removeEventListener("resize",ee)}},[M]),C.useEffect(()=>{const ee=he=>{if((he.ctrlKey||he.metaKey)&&r.current){const be=r.current.getBoundingClientRect();he.clientX>=be.left&&he.clientX<=be.right&&he.clientY>=be.top&&he.clientY<=be.bottom&&he.preventDefault()}};return document.addEventListener("wheel",ee,{passive:!1,capture:!0}),()=>{document.removeEventListener("wheel",ee,{capture:!0})}},[]);const bt=ee=>{if(ee.preventDefault(),!r.current)return;const he=ee.dataTransfer.getData("application/json");if(!he)return;const be=JSON.parse(he),Le=r.current.getBoundingClientRect(),Ie=(ee.clientX-Le.left-u.x)/c,lt=(ee.clientY-Le.top-u.y)/c,zt={id:`node-${Date.now()}`,type:be.type,position:{x:Ie,y:lt},data:{label:be.label}};s(zt)},mt=ee=>{ee.preventDefault(),ee.dataTransfer.dropEffect="copy"},$t=ee=>{const he=ee.button===0;if(ee.button===1||he&&ee.ctrlKey){O(!0),fe({x:ee.clientX-u.x,y:ee.clientY-u.y}),ee.preventDefault();return}if(he&&!j&&!ee.ctrlKey&&!ee.metaKey){if(r.current){const Le=r.current.getBoundingClientRect(),Ie=(ee.clientX-Le.left-u.x)/c,lt=(ee.clientY-Le.top-u.y)/c;Be({x:Ie,y:lt}),Je({x:Ie,y:lt,width:0,height:0})}m(null),y(null),v(null)}},Ze=ee=>{if(N)h({x:ee.clientX-W.x,y:ee.clientY-W.y});else if(j&&r.current){const he=r.current.getBoundingClientRect();Q({x:(ee.clientX-he.left-u.x)/c,y:(ee.clientY-he.top-u.y)/c})}else if(je&&r.current){const he=r.current.getBoundingClientRect(),be=(ee.clientX-he.left-u.x)/c,Le=(ee.clientY-he.top-u.y)/c,Ie=Math.min(je.x,be),lt=Math.min(je.y,Le),zt=Math.abs(be-je.x),Zt=Math.abs(Le-je.y),At={x:Ie,y:lt,width:zt,height:Zt};Je(At);const un=t.filter(St=>{const ot=St.position.x,vt=St.position.y,Bt=St.position.x+140,fs=St.position.y+140;return Bt>=At.x&&ot<=At.x+At.width&&fs>=At.y&&vt<=At.y+At.height}).map(St=>St.id);x(un)}},jt=()=>{O(!1),j&&(F(!1),ie(null),Q(null)),je&&(Be(null),Je(null))},xt=C.useCallback((ee,he)=>{F(!0),ie(ee),ae(he)},[]),yt=C.useCallback(ee=>{const he=L(ee);if(!he)return{width:140,height:100};const Ie=(he.querySelector(".bg-card")||he).getBoundingClientRect();return{width:Ie.width/c,height:Ie.height/c}},[L,c]),Xt=C.useCallback((ee,he)=>{if(j&&Y&&Y!==ee){const be=t.find(Ie=>Ie.id===Y),Le=t.find(Ie=>Ie.id===ee);if(be&&Le){const Ie=yt(Y),lt=yt(ee),zt=B?.x??Le.position.x+lt.width/2,Zt=B?.y??Le.position.y+lt.height/2,At=be.position.x+Ie.width/2,un=be.position.y+Ie.height/2,St=U!==void 0?U:Qv(Y,ee,zt,Zt,e,be.position.x,be.position.y,Ie.width,Ie.height),ot=he!==void 0?he:Qv(ee,Y,At,un,e,Le.position.x,Le.position.y,lt.width,lt.height),vt={id:`conn-${Date.now()}`,source:Y,target:ee,type:"async",sourcePort:St,targetPort:ot};i(vt)}}F(!1),ie(null),ae(void 0),Q(null)},[j,Y,U,t,e,i,B,yt]),Qt=C.useCallback(ee=>{y(ee)},[y]),_s=C.useCallback((ee,he,be)=>{me({connectionId:ee,x:he,y:be})},[]),Xn=C.useCallback(ee=>{const he=ee.target,be=he.closest?.("[data-node-id]"),Le=he.closest?.("[data-connection-id]"),Ie=he instanceof SVGElement,lt=he.closest?.("svg")!==null;if(be||Le||Ie||lt)return;const zt=t.filter(Zt=>Zt.selected);zt.length>0&&(ee.preventDefault(),ee.stopPropagation(),ve({nodeId:zt[0].id,x:ee.clientX,y:ee.clientY}))},[t]),Pn=C.useCallback(()=>{pe&&(o(pe.connectionId),me(null))},[pe,o]),hs=C.useMemo(()=>t.map(ee=>ee.id).join(","),[t]),Jt=C.useMemo(()=>{const ee=new Map;return t.forEach(he=>{const be=he.id;ee.set(be,{onConnectionStart:Le=>xt(be,Le),onConnectionEnd:Le=>Xt(be,Le),onContextMenu:(Le,Ie)=>ve({nodeId:be,x:Le,y:Ie})})}),ee},[hs,xt,Xt,t]),Kt=C.useMemo(()=>e.map(ee=>ee.id).join(","),[e]),Lt=C.useMemo(()=>{const ee=new Map;return e.forEach(he=>{const be=he.id;ee.set(be,{onClick:()=>Qt(be),onContextMenu:Le=>_s(be,Le.clientX,Le.clientY)})}),ee},[Kt,Qt,_s,e]),Fi=ee=>{if(ee.ctrlKey&&r.current){ee.preventDefault();const{left:he,top:be,width:Le,height:Ie}=r.current.getBoundingClientRect(),lt=ee.clientX-he,zt=ee.clientY-be,Zt=(lt-u.x)/c,At=(zt-u.y)/c,un=1+Math.min(Math.max(-ee.deltaY/500,-.5),.5);let St=c*un;St=Math.min(Math.max(St,.3),2.5);const ot=lt-Zt*St,vt=zt-At*St;f(St),h({x:ot,y:vt})}},Nn=20,Jr=ue?24:0,Ps=2e3,Vi=c<.5,ci=Ee(ee=>ee.viewportWidth),Jn=Ee(ee=>ee.viewportHeight),Ns=C.useMemo(()=>{if(ci===0||Jn===0)return t;const ee=-u.x/c,he=-u.y/c,be=(ci-u.x)/c,Le=(Jn-u.y)/c,Ie=200,lt=ee-Ie,zt=he-Ie,Zt=be+Ie,At=Le+Ie;return t.filter(un=>{const St=un.position.x,ot=un.position.y;return St+140>=lt&&St<=Zt&&ot+100>=zt&&ot<=At})},[t,c,u,ci,Jn]),js=C.useMemo(()=>new Set(Ns.map(ee=>ee.id)),[Ns]),Lu=C.useMemo(()=>e.filter(ee=>js.has(ee.source)&&js.has(ee.target)),[e,js]);return g.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[g.jsx($5,{isVisible:ue,canvasRef:r}),g.jsx("div",{ref:r,className:"absolute overflow-hidden",style:{top:`${Jr}px`,left:`${Jr}px`,right:0,bottom:0,cursor:N?"grabbing":j?"crosshair":"default",backgroundColor:"hsl(var(--muted) / 0.1)"},onDrop:bt,onDragOver:mt,onMouseDown:$t,onMouseMove:Ze,onMouseUp:jt,onMouseLeave:jt,onWheel:Fi,onContextMenu:Xn,children:g.jsxs("div",{style:{transform:`translate(${u.x}px, ${u.y}px) scale(${c})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[Z.map(ee=>{const he=ee.x*Ps,be=ee.y*Ps,Le=Z.some(ot=>ot.x===ee.x+1&&ot.y===ee.y),Ie=Z.some(ot=>ot.x===ee.x&&ot.y===ee.y+1),lt=u.x/c,zt=u.y/c,Zt=(-lt%Nn+Nn)%Nn,At=(-zt%Nn+Nn)%Nn,un=he%Nn,St=be%Nn;return g.jsxs("div",{className:"absolute pointer-events-none",style:{left:`${he}px`,top:`${be}px`,width:`${Ps}px`,height:`${Ps}px`,backgroundColor:"hsl(var(--canvas-bg))",backgroundImage:`
                  linear-gradient(hsl(var(--canvas-grid)) 1px, transparent 1px),
                  linear-gradient(90deg, hsl(var(--canvas-grid)) 1px, transparent 1px)
                `,backgroundSize:`${Nn}px ${Nn}px`,backgroundPosition:`${Zt+un}px ${At+St}px`,border:Vi?"2px dashed hsl(var(--border) / 0.6)":"none",boxShadow:Vi?"inset 0 0 0 1px hsl(var(--border) / 0.3)":"none"},children:[Le&&g.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none z-10",style:{right:0,width:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}}),Ie&&g.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{bottom:0,height:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}})]},`chunk-${ee.x}-${ee.y}`)}),at&&g.jsx("div",{className:"absolute border-2 border-primary/60 bg-primary/10 pointer-events-none",style:{left:at.x,top:at.y,width:at.width,height:at.height}}),g.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"visible"},children:[g.jsxs("defs",{children:[g.jsx("marker",{id:"arrowhead-default",markerWidth:"8",markerHeight:"8",refX:"7",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,8 L8,4 z",fill:"hsl(var(--border))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-selected",markerWidth:"10",markerHeight:"10",refX:"8",refY:"5",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,10 L10,5 z",fill:"hsl(var(--primary))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-bottleneck",markerWidth:"12",markerHeight:"12",refX:"10",refY:"6",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,12 L12,6 z",fill:"hsl(0 84% 60%)",stroke:"none"})})]}),n&&n.length>0&&g.jsx("g",{style:{pointerEvents:"auto"},children:n.map(ee=>g.jsx(q5,{group:ee,zoom:c},ee.id))}),g.jsxs("g",{style:{pointerEvents:"auto"},children:[Lu.map(ee=>{const he=t.find(Ie=>Ie.id===ee.source),be=t.find(Ie=>Ie.id===ee.target);if(!he||!be)return null;const Le=Lt.get(ee.id);return Le?g.jsx(x5,{connection:ee,sourceNode:he,targetNode:be,zoom:c,pan:u,isSelected:S===ee.id,onClick:Le.onClick,onContextMenu:Le.onContextMenu},ee.id):null}),j&&Y&&B&&(()=>{const ee=t.find(Ie=>Ie.id===Y);if(!ee)return null;const he=yt(Y);let be,Le;if(U!==void 0){const lt=So(ee.position.x,ee.position.y,he.width,he.height,16)[U];be=lt.x,Le=lt.y}else be=ee.position.x+he.width/2,Le=ee.position.y+he.height/2;return g.jsx("line",{x1:be,y1:Le,x2:B.x,y2:B.y,stroke:"hsl(var(--primary))",strokeWidth:2/c,strokeDasharray:"5,5",style:{pointerEvents:"none"}})})()]})]}),Ns.map(ee=>{const he=Jt.get(ee.id);return he?g.jsx(g5,{node:ee,onConnectionStart:he.onConnectionStart,onConnectionEnd:he.onConnectionEnd,isConnecting:j,onContextMenu:he.onContextMenu},ee.id):null}),J&&Ns.map(ee=>g.jsx(M5,{nodeId:ee.id,position:ee.position},`metrics-${ee.id}`))]})}),g.jsx(R5,{isVisible:le}),g.jsx(E5,{isVisible:te}),g.jsx(m5,{selectedNodeId:R,highlightPath:!0}),pe&&g.jsx(V5,{x:pe.x,y:pe.y,onDelete:Pn,onClose:()=>me(null)}),ye&&(()=>{const ee=t.find(Fe=>Fe.id===ye.nodeId);if(!ee)return null;const he=t.filter(Fe=>Fe.selected),be=he.length>1,Le=()=>{be?(he.forEach(Fe=>{T(Fe.id)}),Ye.success(`${he.length} elements deleted`)):(T(ee.id),Ye.success("Element deleted")),ve(null)},Ie=()=>{if(be)he.forEach((Fe,jn)=>{const Gi={...Cl(Fe),id:`${Fe.type}_${Date.now()}_${jn}`,position:{x:Fe.position.x+20+jn*10,y:Fe.position.y+20+jn*10},selected:!1};Gi.data?.config&&(Gi.data.config=Cl(Gi.data.config)),s(Gi)}),Ye.success(`${he.length} elements duplicated`);else{const Fe={...Cl(ee),id:`${ee.type}_${Date.now()}`,position:{x:ee.position.x+20,y:ee.position.y+20},selected:!1};Fe.data?.config&&(Fe.data.config=Cl(Fe.data.config)),s(Fe),Ye.success("Element duplicated")}ve(null)},lt=()=>{if(be){const Fe=he.map(jn=>jn.id).join(", ");navigator.clipboard.writeText(Fe),Ye.success(`${he.length} IDs copied to clipboard`)}else navigator.clipboard.writeText(ee.id),Ye.success("ID copied to clipboard");ve(null)},zt=()=>{be?(he.forEach(Fe=>{A(Fe.id)}),Ye.success(`${he.length} elements brought to front`)):(A(ee.id),Ye.success("Brought to front")),ve(null)},Zt=()=>{be?(he.forEach(Fe=>{_(Fe.id)}),Ye.success(`${he.length} elements sent to back`)):(_(ee.id),Ye.success("Sent to back")),ve(null)},At=()=>{be?(he.forEach(Fe=>{P(Fe.id)}),Ye.success(`${he.length} elements brought forward`)):(P(ee.id),Ye.success("Brought forward")),ve(null)},un=()=>{be?(he.forEach(Fe=>{z(Fe.id)}),Ye.success(`${he.length} elements sent backward`)):(z(ee.id),Ye.success("Sent backward")),ve(null)},St=()=>{de(be?{nodeId:he[0].id,x:ye.x,y:ye.y}:{nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)},ot=be?n.filter(Fe=>he.some(jn=>Fe.nodeIds.includes(jn.id))):n.filter(Fe=>Fe.nodeIds.includes(ee.id)),vt=ot.length>=1,Bt=ot.length>=2,fs=()=>{if(be){let Fe=0;he.forEach(jn=>{n.filter(Ra=>Ra.nodeIds.includes(jn.id)).forEach(Ra=>{ce(Ra.id,jn.id),Fe++})}),Fe>0&&Ye.success(`Removed ${he.length} elements from groups`),ve(null)}else Bt?(Ue({nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)):ot.length===1&&(ce(ot[0].id,ee.id),Ye.success(`Removed from "${ot[0].name}"`),ve(null))};return g.jsx(B5,{x:ye.x,y:ye.y,onDelete:Le,onDuplicate:Ie,onCopyId:lt,onBringToFront:zt,onSendToBack:Zt,onBringForward:At,onSendBackward:un,onAddToGroup:St,onRemoveFromGroup:vt?fs:void 0,onClose:()=>ve(null)})})(),Nt&&g.jsx(U5,{nodeId:Nt.nodeId,x:Nt.x,y:Nt.y,onClose:()=>de(null)}),$e&&g.jsx(F5,{nodeId:$e.nodeId,x:$e.x,y:$e.y,onClose:()=>Ue(null)})]})}const G5="modulepreload",Q5=function(r){return"/"+r},Wv={},we=function(t,e,n){let s=Promise.resolve();if(e&&e.length>0){let u=function(h){return Promise.all(h.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");s=u(e.map(h=>{if(h=Q5(h),h in Wv)return;Wv[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":G5,f||(y.as="script"),y.crossOrigin="",y.href=h,c&&y.setAttribute("nonce",c),document.head.appendChild(y),f)return new Promise((v,x)=>{y.addEventListener("load",v),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return s.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})},K5=C.lazy(()=>we(()=>import("./KafkaConfigAdvanced-BOpLuO4v.js"),__vite__mapDeps([0,1,2,3,4,5])).then(r=>({default:r.KafkaConfigAdvanced}))),Y5=C.lazy(()=>we(()=>import("./RabbitMQConfigAdvanced-BKyqI78e.js"),__vite__mapDeps([6,1,7,8,9,10,11,12,5,3])).then(r=>({default:r.RabbitMQConfigAdvanced}))),W5=C.lazy(()=>we(()=>import("./PostgreSQLConfigAdvanced-CspIMofc.js"),__vite__mapDeps([13,2,7,9,8,3,14,15,4,12])).then(r=>({default:r.PostgreSQLConfigAdvanced}))),X5=C.lazy(()=>we(()=>import("./MongoDBConfigAdvanced-C-Hqgfzs.js"),__vite__mapDeps([16,2,7,9,8,3])).then(r=>({default:r.MongoDBConfigAdvanced}))),J5=C.lazy(()=>we(()=>import("./RedisConfigAdvanced-BFqlXSUc.js"),__vite__mapDeps([17,2,9,8,3,12])).then(r=>({default:r.RedisConfigAdvanced}))),Z5=C.lazy(()=>we(()=>import("./ElasticsearchConfigAdvanced-CnMLUKTg.js"),__vite__mapDeps([18,2,9,19,20,3,5])).then(r=>({default:r.ElasticsearchConfigAdvanced}))),eO=C.lazy(()=>we(()=>import("./CassandraConfigAdvanced-CM08hDrT.js"),__vite__mapDeps([21,1,2,3,15,20])).then(r=>({default:r.CassandraConfigAdvanced}))),tO=C.lazy(()=>we(()=>import("./ClickHouseConfigAdvanced-DanDkouU.js"),__vite__mapDeps([22,2,1,7,8,9,23,3,20])).then(r=>({default:r.ClickHouseConfigAdvanced}))),nO=C.lazy(()=>we(()=>import("./SnowflakeConfigAdvanced-CGE2ZzCE.js"),__vite__mapDeps([24,2,19,3,12])).then(r=>({default:r.SnowflakeConfigAdvanced}))),sO=C.lazy(()=>we(()=>import("./S3DataLakeConfigAdvanced-L23Mecc5.js"),__vite__mapDeps([25,19,12,26])).then(r=>({default:r.S3DataLakeConfigAdvanced}))),iO=C.lazy(()=>we(()=>import("./NginxConfigAdvanced-C6zYnjBC.js"),__vite__mapDeps([27,2,1,28,29,30,11,5])).then(r=>({default:r.NginxConfigAdvanced}))),aO=C.lazy(()=>we(()=>import("./RestApiConfigAdvanced-CIKrNFRq.js"),__vite__mapDeps([31,2,1,9,29,32,33,20])).then(r=>({default:r.RestApiConfigAdvanced}))),oO=C.lazy(()=>we(()=>import("./GRPCConfigAdvanced-_YUzikrp.js"),__vite__mapDeps([34,2,19,30,35])).then(r=>({default:r.GRPCConfigAdvanced}))),rO=C.lazy(()=>we(()=>import("./WebSocketConfigAdvanced-BaWMN2Uo.js"),__vite__mapDeps([36,2,19,10,37,35])).then(r=>({default:r.WebSocketConfigAdvanced}))),cO=C.lazy(()=>we(()=>import("./GraphQLConfigAdvanced-zmOr5Mey.js"),__vite__mapDeps([38,2,19,3,20,35])).then(r=>({default:r.GraphQLConfigAdvanced}))),lO=C.lazy(()=>we(()=>import("./SOAPConfigAdvanced-ujYovjf0.js"),__vite__mapDeps([39,2,19,30,35])).then(r=>({default:r.SOAPConfigAdvanced}))),uO=C.lazy(()=>we(()=>import("./WebhookConfigAdvanced-DWyUnFu8.js"),__vite__mapDeps([40,19,41,37,35,33])).then(r=>({default:r.WebhookConfigAdvanced}))),dO=C.lazy(()=>we(()=>import("./DockerK8sConfigAdvanced-D_Ag5pRt.js"),__vite__mapDeps([42,2,1,43,9,44,45])).then(r=>({default:r.DockerK8sConfigAdvanced})));C.lazy(()=>we(()=>import("./InfrastructureConfig-D5F0Ftn6.js"),__vite__mapDeps([46,2])).then(r=>({default:r.InfrastructureConfig})));const hO=C.lazy(()=>we(()=>import("./KubernetesConfigAdvanced-NzIZO296.js"),__vite__mapDeps([47,2,9,1,5,3,30,45])).then(r=>({default:r.KubernetesConfigAdvanced}))),fO=C.lazy(()=>we(()=>import("./HAProxyConfigAdvanced-Ccoq-zAH.js"),__vite__mapDeps([48,9,19,32,35,30,5])).then(r=>({default:r.HAProxyConfigAdvanced}))),pO=C.lazy(()=>we(()=>import("./TraefikConfigAdvanced-BvvhanC1.js"),__vite__mapDeps([49,9,19,50,35,5])).then(r=>({default:r.TraefikConfigAdvanced}))),gO=C.lazy(()=>we(()=>import("./EnvoyConfigAdvanced-DzC8MQIF.js"),__vite__mapDeps([51,9,19,30,29,35])).then(r=>({default:r.EnvoyConfigAdvanced}))),mO=C.lazy(()=>we(()=>import("./ActiveMQConfigAdvanced-BAYprIRP.js"),__vite__mapDeps([52,1,43,19,10,3,4,5,53])).then(r=>({default:r.ActiveMQConfigAdvanced}))),yO=C.lazy(()=>we(()=>import("./AWSSQSConfigAdvanced-Bvtq4x1o.js"),__vite__mapDeps([54,1,19,55,10,12,5,37])).then(r=>({default:r.AWSSQSConfigAdvanced}))),vO=C.lazy(()=>we(()=>import("./AzureServiceBusConfigAdvanced-D4TaTUmC.js"),__vite__mapDeps([56,2,10,12])).then(r=>({default:r.AzureServiceBusConfigAdvanced}))),bO=C.lazy(()=>we(()=>import("./GCPPubSubConfigAdvanced-Ku9OF4Wc.js"),__vite__mapDeps([57,2,10,4,12])).then(r=>({default:r.GCPPubSubConfigAdvanced}))),xO=C.lazy(()=>we(()=>import("./KongConfigAdvanced-B28bi_BW.js"),__vite__mapDeps([58,2,9,30,50,4])).then(r=>({default:r.KongConfigAdvanced}))),wO=C.lazy(()=>we(()=>import("./ApigeeConfigAdvanced-De4QCBK5.js"),__vite__mapDeps([59,1,5])).then(r=>({default:r.ApigeeConfigAdvanced}))),CO=C.lazy(()=>we(()=>import("./MuleSoftConfigAdvanced-DdBs05Ay.js"),__vite__mapDeps([60,1,3,35])).then(r=>({default:r.MuleSoftConfigAdvanced}))),SO=C.lazy(()=>we(()=>import("./GraphQLGatewayConfigAdvanced-BPeF2DCb.js"),__vite__mapDeps([61,35,29])).then(r=>({default:r.GraphQLGatewayConfigAdvanced}))),MO=C.lazy(()=>we(()=>import("./BFFServiceConfigAdvanced-BFcLcXqV.js"),__vite__mapDeps([62,19])).then(r=>({default:r.BFFServiceConfigAdvanced}))),RO=C.lazy(()=>we(()=>import("./WebhookRelayConfigAdvanced-d1yGnTp_.js"),__vite__mapDeps([63,2,43,19,41,37,35,33])).then(r=>({default:r.WebhookRelayConfigAdvanced}))),EO=C.lazy(()=>we(()=>import("./PrometheusConfigAdvanced-zAUu-tUo.js"),__vite__mapDeps([64,2,9,45])).then(r=>({default:r.PrometheusConfigAdvanced}))),kO=C.lazy(()=>we(()=>import("./GrafanaConfigAdvanced-DN3Z04FU.js"),__vite__mapDeps([65,23,66,2,3])).then(r=>({default:r.GrafanaConfigAdvanced}))),TO=C.lazy(()=>we(()=>import("./LokiConfigAdvanced-CoLMpNn0.js"),__vite__mapDeps([67,2,53])).then(r=>({default:r.LokiConfigAdvanced}))),AO=C.lazy(()=>we(()=>import("./JaegerConfigAdvanced-D_N2u7LK.js"),__vite__mapDeps([68,1,69])).then(r=>({default:r.JaegerConfigAdvanced}))),DO=C.lazy(()=>we(()=>import("./OpenTelemetryCollectorConfigAdvanced-DiHapVBi.js"),__vite__mapDeps([70,1,19,11])).then(r=>({default:r.OpenTelemetryCollectorConfigAdvanced}))),_O=C.lazy(()=>we(()=>import("./PagerDutyConfigAdvanced-BmUWcBWi.js"),__vite__mapDeps([71,19,4,72,33])).then(r=>({default:r.PagerDutyConfigAdvanced}))),PO=C.lazy(()=>we(()=>import("./KeycloakConfigAdvanced-CaHBxvOM.js"),__vite__mapDeps([73,2,28,5,29,12,4,33,74,75,76])).then(r=>({default:r.KeycloakConfigAdvanced}))),NO=C.lazy(()=>we(()=>import("./WAFConfigAdvanced-CBEjZe3A.js"),__vite__mapDeps([77,28,19,5,29,35])).then(r=>({default:r.WAFConfigAdvanced}))),jO=C.lazy(()=>we(()=>import("./SecretsVaultConfigAdvanced-SylSt_f_.js"),__vite__mapDeps([78,28,2,19,12,3,5,74,76,35])).then(r=>({default:r.SecretsVaultConfigAdvanced}))),LO=C.lazy(()=>we(()=>import("./IDSIPSConfigAdvanced-BNBx0WFX.js"),__vite__mapDeps([79,28,19,5,35])).then(r=>({default:r.IDSIPSConfigAdvanced}))),zO=C.lazy(()=>we(()=>import("./FirewallConfigAdvanced-3R0tnc3I.js"),__vite__mapDeps([80,43,28,19,5,35,32])).then(r=>({default:r.FirewallConfigAdvanced}))),IO=C.lazy(()=>we(()=>import("./JenkinsConfigAdvanced-DLkAGaFA.js"),__vite__mapDeps([81,1,2,28,69,82,30,4,23,32,66,33,44])).then(r=>({default:r.JenkinsConfigAdvanced}))),OO=C.lazy(()=>we(()=>import("./GitLabCIConfigAdvanced-Bh8W3K-9.js"),__vite__mapDeps([83,1,28,69,20,30,3,29,84,33])).then(r=>({default:r.GitLabCIConfigAdvanced}))),HO=C.lazy(()=>we(()=>import("./ArgoCDConfigAdvanced-C5nejwfS.js"),__vite__mapDeps([85,1,2,28,3,86,5,72,69,33])).then(r=>({default:r.ArgoCDConfigAdvanced}))),qO=C.lazy(()=>we(()=>import("./HarborConfigAdvanced-iTnuo3Jo.js"),__vite__mapDeps([87,9,82,26,4,5])).then(r=>({default:r.HarborConfigAdvanced}))),$O=C.lazy(()=>we(()=>import("./TerraformConfigAdvanced-B7V61Mm5.js"),__vite__mapDeps([88,28,2,19,35,55,33])).then(r=>({default:r.TerraformConfigAdvanced}))),BO=C.lazy(()=>we(()=>import("./AnsibleConfigAdvanced-BakoglzQ.js"),__vite__mapDeps([89,28,2,19,30,35,86,12,84,33])).then(r=>({default:r.AnsibleConfigAdvanced}))),UO=C.lazy(()=>we(()=>import("./IstioConfigAdvanced-gy8urxWV.js"),__vite__mapDeps([90,43,2,19,50,29,5])).then(r=>({default:r.IstioConfigAdvanced}))),FO=C.lazy(()=>we(()=>import("./ServiceMeshConfigAdvanced-C_WaQE0n.js"),__vite__mapDeps([91,43,2,9,19,50,29,5])).then(r=>({default:r.ServiceMeshConfigAdvanced}))),VO=C.lazy(()=>we(()=>import("./APIGatewayConfigAdvanced-Cptc_PSF.js"),__vite__mapDeps([92,2,9,19,55,29,5,32,82,12,30,14,4,50])).then(r=>({default:r.APIGatewayConfigAdvanced}))),GO=C.lazy(()=>we(()=>import("./VPNConfigAdvanced-CNTIBq4f.js"),__vite__mapDeps([93,9,19,4,74,33])).then(r=>({default:r.VPNConfigAdvanced}))),QO=C.lazy(()=>we(()=>import("./CDNConfigAdvanced-Dp4pGf1S.js"),__vite__mapDeps([94,28,19,29,32])).then(r=>({default:r.CDNConfigAdvanced}))),KO=C.lazy(()=>we(()=>import("./SparkConfigAdvanced-DlW8Twnm.js"),__vite__mapDeps([95,19,3,35,33])).then(r=>({default:r.SparkConfigAdvanced}))),YO=C.lazy(()=>we(()=>import("./TensorFlowServingConfigAdvanced-CWmbUarE.js"),__vite__mapDeps([96,2,19,3,35])).then(r=>({default:r.TensorFlowServingConfigAdvanced}))),WO=C.lazy(()=>we(()=>import("./PyTorchServeConfigAdvanced-BWSKFirq.js"),__vite__mapDeps([97,2,19,3,35])).then(r=>({default:r.PyTorchServeConfigAdvanced}))),XO=C.lazy(()=>we(()=>import("./FeatureStoreConfigAdvanced-B14DLIpZ.js"),__vite__mapDeps([98,19,82,3,32])).then(r=>({default:r.FeatureStoreConfigAdvanced}))),JO=C.lazy(()=>we(()=>import("./MLflowConfigAdvanced-BPQzbDy3.js"),__vite__mapDeps([99,82,32])).then(r=>({default:r.MLflowConfigAdvanced}))),ZO=C.lazy(()=>we(()=>import("./CRMConfigAdvanced-B-XRbt_R.js"),__vite__mapDeps([100,19,4,101,32,102,75])).then(r=>({default:r.CRMConfigAdvanced}))),e3=C.lazy(()=>we(()=>import("./ERPConfigAdvanced-C7q7y6Ri.js"),__vite__mapDeps([103,19,82,101,32,102])).then(r=>({default:r.ERPConfigAdvanced}))),t3=C.lazy(()=>we(()=>import("./RPABotConfigAdvanced-EU2eUQ7a.js"),__vite__mapDeps([104,19,32,35,33])).then(r=>({default:r.RPABotConfigAdvanced}))),n3=C.lazy(()=>we(()=>import("./BPMNEngineConfigAdvanced-blwOYJ24.js"),__vite__mapDeps([105,19,35,33,4])).then(r=>({default:r.BPMNEngineConfigAdvanced}))),s3=C.lazy(()=>we(()=>import("./PaymentGatewayConfigAdvanced-wYkVqHol.js"),__vite__mapDeps([106,19,101,32,5,35,33])).then(r=>({default:r.PaymentGatewayConfigAdvanced}))),i3=()=>g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsx("div",{className:"text-muted-foreground",children:"Loading configuration..."})});function a3({componentId:r,componentType:t}){const e=()=>{switch(t){case"kafka":return g.jsx(K5,{componentId:r});case"rabbitmq":return g.jsx(Y5,{componentId:r});case"postgres":return g.jsx(W5,{componentId:r});case"mongodb":return g.jsx(X5,{componentId:r});case"redis":return g.jsx(J5,{componentId:r});case"elasticsearch":return g.jsx(Z5,{componentId:r});case"cassandra":return g.jsx(eO,{componentId:r});case"clickhouse":return g.jsx(tO,{componentId:r});case"snowflake":return g.jsx(nO,{componentId:r});case"s3-datalake":return g.jsx(sO,{componentId:r});case"nginx":return g.jsx(iO,{componentId:r});case"rest":return g.jsx(aO,{componentId:r});case"grpc":return g.jsx(oO,{componentId:r});case"websocket":return g.jsx(rO,{componentId:r});case"graphql":return g.jsx(cO,{componentId:r});case"soap":return g.jsx(lO,{componentId:r});case"webhook":return g.jsx(uO,{componentId:r});case"docker":return g.jsx(dO,{componentId:r});case"kubernetes":return g.jsx(hO,{componentId:r});case"haproxy":return g.jsx(fO,{componentId:r});case"traefik":return g.jsx(pO,{componentId:r});case"envoy":return g.jsx(gO,{componentId:r});case"activemq":return g.jsx(mO,{componentId:r});case"aws-sqs":return g.jsx(yO,{componentId:r});case"azure-service-bus":return g.jsx(vO,{componentId:r});case"gcp-pubsub":return g.jsx(bO,{componentId:r});case"kong":return g.jsx(xO,{componentId:r});case"apigee":return g.jsx(wO,{componentId:r});case"mulesoft":return g.jsx(CO,{componentId:r});case"graphql-gateway":return g.jsx(SO,{componentId:r});case"bff-service":return g.jsx(MO,{componentId:r});case"webhook-relay":return g.jsx(RO,{componentId:r});case"prometheus":return g.jsx(EO,{componentId:r});case"grafana":return g.jsx(kO,{componentId:r});case"loki":return g.jsx(TO,{componentId:r});case"jaeger":return g.jsx(AO,{componentId:r});case"otel-collector":return g.jsx(DO,{componentId:r});case"pagerduty":return g.jsx(_O,{componentId:r});case"keycloak":return g.jsx(PO,{componentId:r});case"waf":return g.jsx(NO,{componentId:r});case"firewall":return g.jsx(zO,{componentId:r});case"secrets-vault":return g.jsx(jO,{componentId:r});case"ids-ips":return g.jsx(LO,{componentId:r});case"jenkins":return g.jsx(IO,{componentId:r});case"gitlab-ci":return g.jsx(OO,{componentId:r});case"argo-cd":return g.jsx(HO,{componentId:r});case"terraform":return g.jsx($O,{componentId:r});case"ansible":return g.jsx(BO,{componentId:r});case"harbor":return g.jsx(qO,{componentId:r});case"istio":return g.jsx(UO,{componentId:r});case"service-mesh":return g.jsx(FO,{componentId:r});case"api-gateway":return g.jsx(VO,{componentId:r});case"vpn":return g.jsx(GO,{componentId:r});case"cdn":return g.jsx(QO,{componentId:r});case"spark":return g.jsx(KO,{componentId:r});case"tensorflow-serving":return g.jsx(YO,{componentId:r});case"pytorch-serve":return g.jsx(WO,{componentId:r});case"feature-store":return g.jsx(XO,{componentId:r});case"mlflow":return g.jsx(JO,{componentId:r});case"crm":return g.jsx(ZO,{componentId:r});case"erp":return g.jsx(e3,{componentId:r});case"rpa-bot":return g.jsx(t3,{componentId:r});case"bpmn-engine":return g.jsx(n3,{componentId:r});case"payment-gateway":return g.jsx(s3,{componentId:r});default:return g.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"Configuration panel not available for this component type"})}};return g.jsx(C.Suspense,{fallback:g.jsx(i3,{}),children:e()})}function o3(){const{undo:r,redo:t,zoom:e,setZoom:n,pan:s,setPan:i,resetCanvas:o,saveDiagram:c,selectedConnectionId:u,selectedNodeId:h,selectedGroupId:f,nodes:m,deleteConnection:y,deleteNode:v,deleteGroup:x,selectConnection:S,selectNode:R,selectGroup:M}=Ee(),{canUndo:T,canRedo:k}=Ar(),{isRunning:A,start:_,stop:P}=Pt(),{showMinimap:z,toggleMinimap:q,showHeatMapLegend:Z,toggleHeatMapLegend:se}=Br();C.useEffect(()=>{const ce=J=>{const te=J.ctrlKey||J.metaKey;if(te&&J.key==="z"&&!J.shiftKey&&T){J.preventDefault(),r();return}if(te&&(J.key==="z"&&J.shiftKey||J.key==="y")&&k){J.preventDefault(),t();return}if(te&&(J.key==="="||J.key==="+")){J.preventDefault(),n(Math.min(e+.1,2));return}if(te&&J.key==="-"){J.preventDefault(),n(Math.max(e-.1,.5));return}if(te&&J.key==="0"){J.preventDefault(),n(1),i({x:0,y:0});return}const le=50;if(!te){if(J.key==="ArrowLeft"){J.preventDefault(),i({x:s.x+le,y:s.y});return}if(J.key==="ArrowRight"){J.preventDefault(),i({x:s.x-le,y:s.y});return}if(J.key==="ArrowUp"){J.preventDefault(),i({x:s.x,y:s.y+le});return}if(J.key==="ArrowDown"){J.preventDefault(),i({x:s.x,y:s.y-le});return}}if(!te&&J.key===" "){const ue=J.target;if(!ue){if(J.preventDefault(),A)P();else{const{nodes:W,connections:fe}=Ee.getState();Pt.getState().initialize(W,fe),_()}return}const L=ue.tagName;if(L==="INPUT"||L==="TEXTAREA"||L==="SELECT"||ue.isContentEditable||ue.closest('input, textarea, select, [contenteditable="true"]'))return;const O=ue.getAttribute("role");if(O==="textbox"||O==="combobox"||O==="searchbox"||O==="spinbutton"||ue.closest("[data-radix-select-trigger], [data-radix-select-content], [data-radix-select-viewport]"))return;if(J.preventDefault(),A)P();else{const{nodes:W,connections:fe}=Ee.getState();Pt.getState().initialize(W,fe),_()}return}if(te&&(J.key==="s"||J.key==="")){J.preventDefault(),c();return}if(te&&(J.key==="m"||J.key==="")){J.preventDefault(),q();return}if(te&&(J.key==="h"||J.key==="")){J.preventDefault(),se();return}if((J.key==="Delete"||J.key==="Backspace")&&!te){const ue=document.activeElement;if(ue){const N=ue.tagName;if(N==="INPUT"||N==="TEXTAREA"||N==="SELECT"||ue.isContentEditable)return;const O=ue.getAttribute("role");if(O==="textbox"||O==="combobox"||O==="searchbox"||O==="spinbutton")return;const W=ue.closest("form")!==null,fe=ue.closest('[role="textbox"], [role="combobox"], [contenteditable="true"]')!==null,j=ue.closest("[data-radix-select-trigger], [data-radix-select-content]")!==null,F=ue.closest('[role="dialog"]')!==null;if(W||fe||j||F)return}if(J.preventDefault(),u){y(u),S(null);return}if(f){x(f),M(null);return}const L=m.filter(N=>N.selected);if(L.length>0){L.forEach(N=>v(N.id)),R(null);return}if(h){v(h),R(null);return}}};return window.addEventListener("keydown",ce),()=>{window.removeEventListener("keydown",ce)}},[r,t,T,k,e,n,s,i,o,c,A,_,P,z,q,Z,se,u,h,f,m,y,v,x,S,R,M])}class Ml extends C.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,e){ii("ErrorBoundary caught an error",t,{componentStack:e.componentStack}),this.setState({error:t,errorInfo:e}),this.props.onError&&this.props.onError(t,e)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:g.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:g.jsxs(wn,{className:"w-full max-w-2xl",children:[g.jsxs(Ss,{children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(as,{className:"h-5 w-5 text-destructive"}),g.jsx(Ms,{children:"-   "})]}),g.jsx(ga,{children:"    "})]}),g.jsxs(Rs,{className:"space-y-4",children:[this.state.error&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("p",{className:"text-sm font-semibold text-foreground",children:":"}),g.jsx("pre",{className:"text-xs bg-muted p-3 rounded-md overflow-auto max-h-48",children:this.state.error.toString()})]}),!1,g.jsxs("div",{className:"flex gap-2",children:[g.jsxs(Te,{onClick:this.handleReset,variant:"default",children:[g.jsx(CD,{className:"h-4 w-4 mr-2"})," "]}),g.jsx(Te,{onClick:()=>window.location.reload(),variant:"outline",children:" "})]})]})]})}):this.props.children}}function r3(){o3();const{tabs:r}=Ru(),t=r.find(e=>e.active);return g.jsx(Ml,{children:g.jsx(v5,{children:g.jsx(f5,{children:g.jsxs("div",{className:"h-screen flex flex-col bg-background",children:[g.jsx(xP,{}),g.jsx(l5,{}),g.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[g.jsx(Ml,{children:g.jsx(RL,{})}),g.jsx(Ml,{children:t?.type==="diagram"?g.jsx(Yv,{}):t?.type==="component"&&t.componentId&&t.componentType?g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsx(a3,{componentId:t.componentId,componentType:t.componentType})}):g.jsx(Yv,{})}),g.jsx(Ml,{children:g.jsx(c5,{})})]})]})})})})}NR.createRoot(document.getElementById("root")).render(g.jsxs(kt.StrictMode,{children:[g.jsx(wE,{position:"top-right"}),g.jsx(r3,{})]}));export{rs as $,ya as A,ft as B,wn as C,mp as D,_e as E,dv as F,c3 as G,jz as H,Tt as I,zz as J,$r as K,it as L,WA as M,gD as N,_b as O,Hl as P,Db as Q,dD as R,xn as S,bp as T,LD as U,Re as V,Nb as W,Pt as X,Es as Y,zb as Z,Cn as _,gu as a,De as a0,ge as a1,ln as a2,Ne as a3,rn as a4,os as a5,Qx as a6,d3 as a7,dp as a8,Yx as a9,ii as aA,h3 as aB,jA as aC,jb as aD,Of as aE,Ao as aF,Tp as aG,wu as aH,Vr as aI,Ur as aJ,Ap as aK,p3 as aL,Dp as aM,hp as aa,fp as ab,Wx as ac,gp as ad,pp as ae,Jl as af,Xf as ag,pa as ah,Jf as ai,as as aj,fD as ak,CD as al,FD as am,KA as an,kD as ao,Pb as ap,tM as aq,ma as ar,Uf as as,ke as at,l3 as au,Ff as av,rb as aw,kt as ax,Hf as ay,an as az,ss as b,_D as c,ni as d,Ss as e,Ms as f,u3 as g,ga as h,Te as i,g as j,Rs as k,va as l,Zl as m,Pl as n,Dr as o,Nl as p,_r as q,C as r,Vt as s,fa as t,Ee as u,ru as v,cu as w,uu as x,du as y,lu as z};
