const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KafkaConfigAdvanced-Cr7E7vKV.js","assets/progress-BMCXj7M_.js","assets/textarea-CQrKFoSw.js","assets/database-BMZtxvm4.js","assets/users-DAdT0zWM.js","assets/shield-BftIbCZn.js","assets/RabbitMQConfigAdvanced-CSkp2ZMJ.js","assets/usePortValidation-DvRP7hf2.js","assets/requiredFields-BLgUUVkB.js","assets/toast-r4e7zpK5.js","assets/message-square-CQneHf9h.js","assets/arrow-right-left-D9dFHqu3.js","assets/key-D5Wrg0TS.js","assets/PostgreSQLConfigAdvanced-Co8m_x8w.js","assets/table-CzV2oCmM.js","assets/MongoDBConfigAdvanced-CuAcsG0g.js","assets/RedisConfigAdvanced-DF2XTf6o.js","assets/ElasticsearchConfigAdvanced-C1o84tPW.js","assets/refresh-ccw-CPtECfG6.js","assets/code-Cch53T4x.js","assets/CassandraConfigAdvanced-CTZfRUNo.js","assets/ClickHouseConfigAdvanced-Cm4CQmB9.js","assets/chart-column-DL07tJbI.js","assets/SnowflakeConfigAdvanced-DgAeUGbw.js","assets/S3DataLakeConfigAdvanced-B-BVzza4.js","assets/folder-BhJsR_7b.js","assets/NginxConfigAdvanced-DU3M4ETf.js","assets/use-toast-DAGgpSQ2.js","assets/globe-F3YW7kIq.js","assets/server-PO-yO29x.js","assets/RestApiConfigAdvanced-CJZ0X9U8.js","assets/GRPCConfigAdvanced-D6tcZWKE.js","assets/circle-check-big-CGrIUnZL.js","assets/WebSocketConfigAdvanced-Nz0ErIuG.js","assets/send-C-fKTX6s.js","assets/GraphQLConfigAdvanced-Ce_IXMC_.js","assets/SOAPConfigAdvanced-DR_vLBqo.js","assets/WebhookConfigAdvanced-DHZsc45h.js","assets/webhook-CwaaATRz.js","assets/clock-tFsF4rnv.js","assets/DockerK8sConfigAdvanced-C2g8glx_.js","assets/alert-dtpMMjNw.js","assets/loader-circle-C4pHz0iz.js","assets/hard-drive-CcAQgXUW.js","assets/HAProxyConfigAdvanced-Dnaf3BkO.js","assets/trending-up-JUd5yW1R.js","assets/TraefikConfigAdvanced-CaVt-yIo.js","assets/route-ormKaZMB.js","assets/EnvoyConfigAdvanced-CKWMfFpm.js","assets/ActiveMQConfigAdvanced-RKH0o6bS.js","assets/pen-BCCOm_Bd.js","assets/AWSSQSConfigAdvanced-DtThsIr4.js","assets/cloud-DEddvGFW.js","assets/AzureServiceBusConfigAdvanced-BcWbB_KA.js","assets/GCPPubSubConfigAdvanced-CiCMJkdj.js","assets/KongConfigAdvanced-BPRc7c7D.js","assets/ApigeeConfigAdvanced-D_mBxBeO.js","assets/MuleSoftConfigAdvanced-c4uovMtG.js","assets/GraphQLGatewayConfigAdvanced-Cm85Z1ae.js","assets/BFFServiceConfigAdvanced-D3vgsm4p.js","assets/WebhookRelayConfigAdvanced-hpBfBYEn.js","assets/PrometheusConfigAdvanced-DPEIdGNK.js","assets/GrafanaConfigAdvanced-DpkLcWst.js","assets/BarChart-C9r8309a.js","assets/LokiConfigAdvanced-C36CBxWo.js","assets/JaegerConfigAdvanced-CFh2PzWZ.js","assets/git-branch-DURyfIVt.js","assets/OpenTelemetryCollectorConfigAdvanced-BKKHZzp7.js","assets/PagerDutyConfigAdvanced-DQQ2e8H1.js","assets/bell-Cg7wSp56.js","assets/KeycloakConfigAdvanced-DROHQ29I.js","assets/lock-BUplvRah.js","assets/mail-BtYRYSl3.js","assets/eye-off-DrJDAGhZ.js","assets/WAFConfigAdvanced-Df5nUXl6.js","assets/SecretsVaultConfigAdvanced-pty3OTSw.js","assets/IDSIPSConfigAdvanced-C0wscmYj.js","assets/FirewallConfigAdvanced-C4XT26WW.js","assets/JenkinsConfigAdvanced-Gmb_VqTb.js","assets/package-B-QQOg_A.js","assets/GitLabCIConfigAdvanced-CBm42Ygc.js","assets/calendar-DCCzpbJE.js","assets/ArgoCDConfigAdvanced-CDnYvwQr.js","assets/folder-git-2-BZTvtOcl.js","assets/HarborConfigAdvanced-LLgl5KZD.js","assets/TerraformConfigAdvanced-D4LmSuPL.js","assets/AnsibleConfigAdvanced-DOXZzuZp.js","assets/IstioConfigAdvanced-BjShQ8EG.js","assets/ServiceMeshConfigAdvanced-CuNGT_iZ.js","assets/APIGatewayConfigAdvanced-BR_aRjnQ.js","assets/VPNConfigAdvanced-BjKrePHn.js","assets/CDNConfigAdvanced-yO8mA0f1.js","assets/SparkConfigAdvanced-B8ntaZ2h.js","assets/TensorFlowServingConfigAdvanced-D3BmAoTs.js","assets/PyTorchServeConfigAdvanced-C0csIefi.js","assets/FeatureStoreConfigAdvanced-DVy1W_VM.js","assets/MLflowConfigAdvanced-BADFzOY6.js","assets/CRMConfigAdvanced-yv4r419g.js","assets/dollar-sign-CsRG8PWH.js","assets/building-CHlIw8nu.js","assets/ERPConfigAdvanced-BCtRANT1.js","assets/RPABotConfigAdvanced-D4Hvd_BM.js","assets/BPMNEngineConfigAdvanced-BD8L0dX6.js","assets/PaymentGatewayConfigAdvanced-pAnqrTAK.js"])))=>i.map(i=>d[i]);
function mR(r,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in r)){const i=Object.getOwnPropertyDescriptor(s,n);i&&Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();var WO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Fh={exports:{}},wr={};var j0;function yR(){if(j0)return wr;j0=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,n,i){var o=null;if(i!==void 0&&(o=""+i),n.key!==void 0&&(o=""+n.key),"key"in n){i={};for(var l in n)l!=="key"&&(i[l]=n[l])}else i=n;return n=i.ref,{$$typeof:r,type:s,key:o,ref:n!==void 0?n:null,props:i}}return wr.Fragment=t,wr.jsx=e,wr.jsxs=e,wr}var P0;function vR(){return P0||(P0=1,Fh.exports=yR()),Fh.exports}var g=vR(),Vh={exports:{}},ze={};var L0;function bR(){if(L0)return ze;L0=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function b(P){return P===null||typeof P!="object"?null:(P=y&&P[y]||P["@@iterator"],typeof P=="function"?P:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,R={};function M(P,F,Y){this.props=P,this.context=F,this.refs=R,this.updater=Y||C}M.prototype.isReactComponent={},M.prototype.setState=function(P,F){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,F,"setState")},M.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function T(){}T.prototype=M.prototype;function E(P,F,Y){this.props=P,this.context=F,this.refs=R,this.updater=Y||C}var A=E.prototype=new T;A.constructor=E,S(A,M.prototype),A.isPureReactComponent=!0;var _=Array.isArray;function N(){}var z={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function Z(P,F,Y){var ie=Y.ref;return{$$typeof:r,type:P,key:F,ref:ie!==void 0?ie:null,props:Y}}function ne(P,F){return Z(P.type,F,P.props)}function ce(P){return typeof P=="object"&&P!==null&&P.$$typeof===r}function J(P){var F={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(Y){return F[Y]})}var te=/\/+/g;function le(P,F){return typeof P=="object"&&P!==null&&P.key!=null?J(""+P.key):F.toString(36)}function ue(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(N,N):(P.status="pending",P.then(function(F){P.status==="pending"&&(P.status="fulfilled",P.value=F)},function(F){P.status==="pending"&&(P.status="rejected",P.reason=F)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function L(P,F,Y,ie,U){var ae=typeof P;(ae==="undefined"||ae==="boolean")&&(P=null);var B=!1;if(P===null)B=!0;else switch(ae){case"bigint":case"string":case"number":B=!0;break;case"object":switch(P.$$typeof){case r:case t:B=!0;break;case f:return B=P._init,L(B(P._payload),F,Y,ie,U)}}if(B)return U=U(P),B=ie===""?"."+le(P,0):ie,_(U)?(Y="",B!=null&&(Y=B.replace(te,"$&/")+"/"),L(U,F,Y,"",function(me){return me})):U!=null&&(ce(U)&&(U=ne(U,Y+(U.key==null||P&&P.key===U.key?"":(""+U.key).replace(te,"$&/")+"/")+B)),F.push(U)),1;B=0;var G=ie===""?".":ie+":";if(_(P))for(var pe=0;pe<P.length;pe++)ie=P[pe],ae=G+le(ie,pe),B+=L(ie,F,Y,ae,U);else if(pe=b(P),typeof pe=="function")for(P=pe.call(P),pe=0;!(ie=P.next()).done;)ie=ie.value,ae=G+le(ie,pe++),B+=L(ie,F,Y,ae,U);else if(ae==="object"){if(typeof P.then=="function")return L(ue(P),F,Y,ie,U);throw F=String(P),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return B}function j(P,F,Y){if(P==null)return P;var ie=[],U=0;return L(P,ie,"","",function(ae){return F.call(Y,ae,U++)}),ie}function O(P){if(P._status===-1){var F=P._result;F=F(),F.then(function(Y){(P._status===0||P._status===-1)&&(P._status=1,P._result=Y)},function(Y){(P._status===0||P._status===-1)&&(P._status=2,P._result=Y)}),P._status===-1&&(P._status=0,P._result=F)}if(P._status===1)return P._result.default;throw P._result}var W=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},fe={map:j,forEach:function(P,F,Y){j(P,function(){F.apply(this,arguments)},Y)},count:function(P){var F=0;return j(P,function(){F++}),F},toArray:function(P){return j(P,function(F){return F})||[]},only:function(P){if(!ce(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return ze.Activity=m,ze.Children=fe,ze.Component=M,ze.Fragment=e,ze.Profiler=n,ze.PureComponent=E,ze.StrictMode=s,ze.Suspense=d,ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,ze.__COMPILER_RUNTIME={__proto__:null,c:function(P){return z.H.useMemoCache(P)}},ze.cache=function(P){return function(){return P.apply(null,arguments)}},ze.cacheSignal=function(){return null},ze.cloneElement=function(P,F,Y){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var ie=S({},P.props),U=P.key;if(F!=null)for(ae in F.key!==void 0&&(U=""+F.key),F)!q.call(F,ae)||ae==="key"||ae==="__self"||ae==="__source"||ae==="ref"&&F.ref===void 0||(ie[ae]=F[ae]);var ae=arguments.length-2;if(ae===1)ie.children=Y;else if(1<ae){for(var B=Array(ae),G=0;G<ae;G++)B[G]=arguments[G+2];ie.children=B}return Z(P.type,U,ie)},ze.createContext=function(P){return P={$$typeof:o,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:i,_context:P},P},ze.createElement=function(P,F,Y){var ie,U={},ae=null;if(F!=null)for(ie in F.key!==void 0&&(ae=""+F.key),F)q.call(F,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(U[ie]=F[ie]);var B=arguments.length-2;if(B===1)U.children=Y;else if(1<B){for(var G=Array(B),pe=0;pe<B;pe++)G[pe]=arguments[pe+2];U.children=G}if(P&&P.defaultProps)for(ie in B=P.defaultProps,B)U[ie]===void 0&&(U[ie]=B[ie]);return Z(P,ae,U)},ze.createRef=function(){return{current:null}},ze.forwardRef=function(P){return{$$typeof:l,render:P}},ze.isValidElement=ce,ze.lazy=function(P){return{$$typeof:f,_payload:{_status:-1,_result:P},_init:O}},ze.memo=function(P,F){return{$$typeof:h,type:P,compare:F===void 0?null:F}},ze.startTransition=function(P){var F=z.T,Y={};z.T=Y;try{var ie=P(),U=z.S;U!==null&&U(Y,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(N,W)}catch(ae){W(ae)}finally{F!==null&&Y.types!==null&&(F.types=Y.types),z.T=F}},ze.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},ze.use=function(P){return z.H.use(P)},ze.useActionState=function(P,F,Y){return z.H.useActionState(P,F,Y)},ze.useCallback=function(P,F){return z.H.useCallback(P,F)},ze.useContext=function(P){return z.H.useContext(P)},ze.useDebugValue=function(){},ze.useDeferredValue=function(P,F){return z.H.useDeferredValue(P,F)},ze.useEffect=function(P,F){return z.H.useEffect(P,F)},ze.useEffectEvent=function(P){return z.H.useEffectEvent(P)},ze.useId=function(){return z.H.useId()},ze.useImperativeHandle=function(P,F,Y){return z.H.useImperativeHandle(P,F,Y)},ze.useInsertionEffect=function(P,F){return z.H.useInsertionEffect(P,F)},ze.useLayoutEffect=function(P,F){return z.H.useLayoutEffect(P,F)},ze.useMemo=function(P,F){return z.H.useMemo(P,F)},ze.useOptimistic=function(P,F){return z.H.useOptimistic(P,F)},ze.useReducer=function(P,F,Y){return z.H.useReducer(P,F,Y)},ze.useRef=function(P){return z.H.useRef(P)},ze.useState=function(P){return z.H.useState(P)},ze.useSyncExternalStore=function(P,F,Y){return z.H.useSyncExternalStore(P,F,Y)},ze.useTransition=function(){return z.H.useTransition()},ze.version="19.2.0",ze}var z0;function qf(){return z0||(z0=1,Vh.exports=bR()),Vh.exports}var w=qf();const Et=Hf(w),$f=mR({__proto__:null,default:Et},[w]);var Qh={exports:{}},Cr={},Gh={exports:{}},Kh={};var I0;function xR(){return I0||(I0=1,(function(r){function t(L,j){var O=L.length;L.push(j);e:for(;0<O;){var W=O-1>>>1,fe=L[W];if(0<n(fe,j))L[W]=j,L[O]=fe,O=W;else break e}}function e(L){return L.length===0?null:L[0]}function s(L){if(L.length===0)return null;var j=L[0],O=L.pop();if(O!==j){L[0]=O;e:for(var W=0,fe=L.length,P=fe>>>1;W<P;){var F=2*(W+1)-1,Y=L[F],ie=F+1,U=L[ie];if(0>n(Y,O))ie<fe&&0>n(U,Y)?(L[W]=U,L[ie]=O,W=ie):(L[W]=Y,L[F]=O,W=F);else if(ie<fe&&0>n(U,O))L[W]=U,L[ie]=O,W=ie;else break e}}return j}function n(L,j){var O=L.sortIndex-j.sortIndex;return O!==0?O:L.id-j.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();r.unstable_now=function(){return o.now()-l}}var d=[],h=[],f=1,m=null,y=3,b=!1,C=!1,S=!1,R=!1,M=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function A(L){for(var j=e(h);j!==null;){if(j.callback===null)s(h);else if(j.startTime<=L)s(h),j.sortIndex=j.expirationTime,t(d,j);else break;j=e(h)}}function _(L){if(S=!1,A(L),!C)if(e(d)!==null)C=!0,N||(N=!0,J());else{var j=e(h);j!==null&&ue(_,j.startTime-L)}}var N=!1,z=-1,q=5,Z=-1;function ne(){return R?!0:!(r.unstable_now()-Z<q)}function ce(){if(R=!1,N){var L=r.unstable_now();Z=L;var j=!0;try{e:{C=!1,S&&(S=!1,T(z),z=-1),b=!0;var O=y;try{t:{for(A(L),m=e(d);m!==null&&!(m.expirationTime>L&&ne());){var W=m.callback;if(typeof W=="function"){m.callback=null,y=m.priorityLevel;var fe=W(m.expirationTime<=L);if(L=r.unstable_now(),typeof fe=="function"){m.callback=fe,A(L),j=!0;break t}m===e(d)&&s(d),A(L)}else s(d);m=e(d)}if(m!==null)j=!0;else{var P=e(h);P!==null&&ue(_,P.startTime-L),j=!1}}break e}finally{m=null,y=O,b=!1}j=void 0}}finally{j?J():N=!1}}}var J;if(typeof E=="function")J=function(){E(ce)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,le=te.port2;te.port1.onmessage=ce,J=function(){le.postMessage(null)}}else J=function(){M(ce,0)};function ue(L,j){z=M(function(){L(r.unstable_now())},j)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(L){L.callback=null},r.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<L?Math.floor(1e3/L):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(L){switch(y){case 1:case 2:case 3:var j=3;break;default:j=y}var O=y;y=j;try{return L()}finally{y=O}},r.unstable_requestPaint=function(){R=!0},r.unstable_runWithPriority=function(L,j){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var O=y;y=L;try{return j()}finally{y=O}},r.unstable_scheduleCallback=function(L,j,O){var W=r.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?W+O:W):O=W,L){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=O+fe,L={id:f++,callback:j,priorityLevel:L,startTime:O,expirationTime:fe,sortIndex:-1},O>W?(L.sortIndex=O,t(h,L),e(d)===null&&L===e(h)&&(S?(T(z),z=-1):S=!0,ue(_,O-W))):(L.sortIndex=fe,t(d,L),C||b||(C=!0,N||(N=!0,J()))),L},r.unstable_shouldYield=ne,r.unstable_wrapCallback=function(L){var j=y;return function(){var O=y;y=j;try{return L.apply(this,arguments)}finally{y=O}}}})(Kh)),Kh}var O0;function wR(){return O0||(O0=1,Gh.exports=xR()),Gh.exports}var Yh={exports:{}},rs={};var H0;function CR(){if(H0)return rs;H0=1;var r=qf();function t(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},n=Symbol.for("react.portal");function i(d,h,f){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:m==null?null:""+m,children:d,containerInfo:h,implementation:f}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(d,h){if(d==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return rs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,rs.createPortal=function(d,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return i(d,h,null,f)},rs.flushSync=function(d){var h=o.T,f=s.p;try{if(o.T=null,s.p=2,d)return d()}finally{o.T=h,s.p=f,s.d.f()}},rs.preconnect=function(d,h){typeof d=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(d,h))},rs.prefetchDNS=function(d){typeof d=="string"&&s.d.D(d)},rs.preinit=function(d,h){if(typeof d=="string"&&h&&typeof h.as=="string"){var f=h.as,m=l(f,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,b=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;f==="style"?s.d.S(d,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:b}):f==="script"&&s.d.X(d,{crossOrigin:m,integrity:y,fetchPriority:b,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},rs.preinitModule=function(d,h){if(typeof d=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var f=l(h.as,h.crossOrigin);s.d.M(d,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(d)},rs.preload=function(d,h){if(typeof d=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var f=h.as,m=l(f,h.crossOrigin);s.d.L(d,f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},rs.preloadModule=function(d,h){if(typeof d=="string")if(h){var f=l(h.as,h.crossOrigin);s.d.m(d,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(d)},rs.requestFormReset=function(d){s.d.r(d)},rs.unstable_batchedUpdates=function(d,h){return d(h)},rs.useFormState=function(d,h,f){return o.H.useFormState(d,h,f)},rs.useFormStatus=function(){return o.H.useHostTransitionStatus()},rs.version="19.2.0",rs}var q0;function Gv(){if(q0)return Yh.exports;q0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Yh.exports=CR(),Yh.exports}var $0;function SR(){if($0)return Cr;$0=1;var r=wR(),t=qf(),e=Gv();function s(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)c+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function i(a){var c=a,u=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(u=c.return),a=c.return;while(a)}return c.tag===3?u:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(a.tag===31){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function d(a){if(i(a)!==a)throw Error(s(188))}function h(a){var c=a.alternate;if(!c){if(c=i(a),c===null)throw Error(s(188));return c!==a?null:a}for(var u=a,p=c;;){var v=u.return;if(v===null)break;var x=v.alternate;if(x===null){if(p=v.return,p!==null){u=p;continue}break}if(v.child===x.child){for(x=v.child;x;){if(x===u)return d(v),a;if(x===p)return d(v),c;x=x.sibling}throw Error(s(188))}if(u.return!==p.return)u=v,p=x;else{for(var k=!1,D=v.child;D;){if(D===u){k=!0,u=v,p=x;break}if(D===p){k=!0,p=v,u=x;break}D=D.sibling}if(!k){for(D=x.child;D;){if(D===u){k=!0,u=x,p=v;break}if(D===p){k=!0,p=x,u=v;break}D=D.sibling}if(!k)throw Error(s(189))}}if(u.alternate!==p)throw Error(s(190))}if(u.tag!==3)throw Error(s(188));return u.stateNode.current===u?a:c}function f(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=f(a),c!==null)return c;a=a.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),E=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),ne=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function J(a){return a===null||typeof a!="object"?null:(a=ce&&a[ce]||a["@@iterator"],typeof a=="function"?a:null)}var te=Symbol.for("react.client.reference");function le(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===te?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case S:return"Fragment";case M:return"Profiler";case R:return"StrictMode";case _:return"Suspense";case N:return"SuspenseList";case Z:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case C:return"Portal";case E:return a.displayName||"Context";case T:return(a._context.displayName||"Context")+".Consumer";case A:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case z:return c=a.displayName||null,c!==null?c:le(a.type)||"Memo";case q:c=a._payload,a=a._init;try{return le(a(c))}catch{}}return null}var ue=Array.isArray,L=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},W=[],fe=-1;function P(a){return{current:a}}function F(a){0>fe||(a.current=W[fe],W[fe]=null,fe--)}function Y(a,c){fe++,W[fe]=a.current,a.current=c}var ie=P(null),U=P(null),ae=P(null),B=P(null);function G(a,c){switch(Y(ae,c),Y(U,a),Y(ie,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?s0(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=s0(c),a=n0(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}F(ie),Y(ie,a)}function pe(){F(ie),F(U),F(ae)}function me(a){a.memoizedState!==null&&Y(B,a);var c=ie.current,u=n0(c,a.type);c!==u&&(Y(U,a),Y(ie,u))}function ye(a){U.current===a&&(F(ie),F(U)),B.current===a&&(F(B),yr._currentValue=O)}var ve,Pe;function Be(a){if(ve===void 0)try{throw Error()}catch(u){var c=u.stack.trim().match(/\n( *(at )?)/);ve=c&&c[1]||"",Pe=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ve+a+Pe}var at=!1;function Je(a,c){if(!a||at)return"";at=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(X){var K=X}Reflect.construct(a,[],re)}else{try{re.call()}catch(X){K=X}a.call(re.prototype)}}else{try{throw Error()}catch(X){K=X}(re=a())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(X){if(X&&K&&typeof X.stack=="string")return[X.stack,K.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=p.DetermineComponentFrameRoot(),k=x[0],D=x[1];if(k&&D){var I=k.split(`
`),Q=D.split(`
`);for(v=p=0;p<I.length&&!I[p].includes("DetermineComponentFrameRoot");)p++;for(;v<Q.length&&!Q[v].includes("DetermineComponentFrameRoot");)v++;if(p===I.length||v===Q.length)for(p=I.length-1,v=Q.length-1;1<=p&&0<=v&&I[p]!==Q[v];)v--;for(;1<=p&&0<=v;p--,v--)if(I[p]!==Q[v]){if(p!==1||v!==1)do if(p--,v--,0>v||I[p]!==Q[v]){var se=`
`+I[p].replace(" at new "," at ");return a.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",a.displayName)),se}while(1<=p&&0<=v);break}}}finally{at=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Be(u):""}function jt(a,c){switch(a.tag){case 26:case 27:case 5:return Be(a.type);case 16:return Be("Lazy");case 13:return a.child!==c&&c!==null?Be("Suspense Fallback"):Be("Suspense");case 19:return Be("SuspenseList");case 0:case 15:return Je(a.type,!1);case 11:return Je(a.type.render,!1);case 1:return Je(a.type,!0);case 31:return Be("Activity");default:return""}}function de(a){try{var c="",u=null;do c+=jt(a,u),u=a,a=a.return;while(a);return c}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var $e=Object.prototype.hasOwnProperty,Ue=r.unstable_scheduleCallback,bt=r.unstable_cancelCallback,mt=r.unstable_shouldYield,$t=r.unstable_requestPaint,Ze=r.unstable_now,Pt=r.unstable_getCurrentPriorityLevel,xt=r.unstable_ImmediatePriority,yt=r.unstable_UserBlockingPriority,Xt=r.unstable_NormalPriority,Gt=r.unstable_LowPriority,_n=r.unstable_IdlePriority,Ws=r.log,_s=r.unstable_setDisableYieldValue,hn=null,Jt=null;function Kt(a){if(typeof Ws=="function"&&_s(a),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(hn,a)}catch{}}var Lt=Math.clz32?Math.clz32:Jr,Fi=Math.log,Ns=Math.LN2;function Jr(a){return a>>>=0,a===0?32:31-(Fi(a)/Ns|0)|0}var Nn=256,Vi=262144,ci=4194304;function Xs(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function jn(a,c,u){var p=a.pendingLanes;if(p===0)return 0;var v=0,x=a.suspendedLanes,k=a.pingedLanes;a=a.warmLanes;var D=p&134217727;return D!==0?(p=D&~x,p!==0?v=Xs(p):(k&=D,k!==0?v=Xs(k):u||(u=D&~a,u!==0&&(v=Xs(u))))):(D=p&~x,D!==0?v=Xs(D):k!==0?v=Xs(k):u||(u=p&~a,u!==0&&(v=Xs(u)))),v===0?0:c!==0&&c!==v&&(c&x)===0&&(x=v&-v,u=c&-c,x>=u||x===32&&(u&4194048)!==0)?c:v}function Pn(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function Lu(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ee(){var a=ci;return ci<<=1,(ci&62914560)===0&&(ci=4194304),a}function he(a){for(var c=[],u=0;31>u;u++)c.push(a);return c}function be(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Le(a,c,u,p,v,x){var k=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var D=a.entanglements,I=a.expirationTimes,Q=a.hiddenUpdates;for(u=k&~u;0<u;){var se=31-Lt(u),re=1<<se;D[se]=0,I[se]=-1;var K=Q[se];if(K!==null)for(Q[se]=null,se=0;se<K.length;se++){var X=K[se];X!==null&&(X.lane&=-536870913)}u&=~re}p!==0&&Ie(a,p,0),x!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=x&~(k&~c))}function Ie(a,c,u){a.pendingLanes|=c,a.suspendedLanes&=~c;var p=31-Lt(c);a.entangledLanes|=c,a.entanglements[p]=a.entanglements[p]|1073741824|u&261930}function lt(a,c){var u=a.entangledLanes|=c;for(a=a.entanglements;u;){var p=31-Lt(u),v=1<<p;v&c|a[p]&c&&(a[p]|=c),u&=~v}}function zt(a,c){var u=c&-c;return u=(u&42)!==0?1:Zt(u),(u&(a.suspendedLanes|c))!==0?0:u}function Zt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function At(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function ls(){var a=j.p;return a!==0?a:(a=window.event,a===void 0?32:k0(a.type))}function St(a,c){var u=j.p;try{return j.p=a,c()}finally{j.p=u}}var ot=Math.random().toString(36).slice(2),vt="__reactFiber$"+ot,Bt="__reactProps$"+ot,fn="__reactContainer$"+ot,Fe="__reactEvents$"+ot,js="__reactListeners$"+ot,Qi="__reactHandles$"+ot,Ra="__reactResources$"+ot,No="__reactMarker$"+ot;function zu(a){delete a[vt],delete a[Bt],delete a[Fe],delete a[js],delete a[Qi]}function ka(a){var c=a[vt];if(c)return c;for(var u=a.parentNode;u;){if(c=u[fn]||u[vt]){if(u=c.alternate,c.child!==null||u!==null&&u.child!==null)for(a=u0(a);a!==null;){if(u=a[vt])return u;a=u0(a)}return c}a=u,u=a.parentNode}return null}function Ea(a){if(a=a[vt]||a[fn]){var c=a.tag;if(c===5||c===6||c===13||c===31||c===26||c===27||c===3)return a}return null}function jo(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(s(33))}function Ta(a){var c=a[Ra];return c||(c=a[Ra]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Yt(a){a[No]=!0}var Fp=new Set,Vp={};function Gi(a,c){Aa(a,c),Aa(a+"Capture",c)}function Aa(a,c){for(Vp[a]=c,a=0;a<c.length;a++)Fp.add(c[a])}var rM=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qp={},Gp={};function cM(a){return $e.call(Gp,a)?!0:$e.call(Qp,a)?!1:rM.test(a)?Gp[a]=!0:(Qp[a]=!0,!1)}function Zr(a,c,u){if(cM(c))if(u===null)a.removeAttribute(c);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+u)}}function ec(a,c,u){if(u===null)a.removeAttribute(c);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+u)}}function Ln(a,c,u,p){if(p===null)a.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(c,u,""+p)}}function Ps(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Kp(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function lM(a,c,u){var p=Object.getOwnPropertyDescriptor(a.constructor.prototype,c);if(!a.hasOwnProperty(c)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var v=p.get,x=p.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return v.call(this)},set:function(k){u=""+k,x.call(this,k)}}),Object.defineProperty(a,c,{enumerable:p.enumerable}),{getValue:function(){return u},setValue:function(k){u=""+k},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Iu(a){if(!a._valueTracker){var c=Kp(a)?"checked":"value";a._valueTracker=lM(a,c,""+a[c])}}function Yp(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var u=c.getValue(),p="";return a&&(p=Kp(a)?a.checked?"true":"false":a.value),a=p,a!==u?(c.setValue(a),!0):!1}function tc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var uM=/[\n"\\]/g;function Ls(a){return a.replace(uM,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Ou(a,c,u,p,v,x,k,D){a.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?a.type=k:a.removeAttribute("type"),c!=null?k==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Ps(c)):a.value!==""+Ps(c)&&(a.value=""+Ps(c)):k!=="submit"&&k!=="reset"||a.removeAttribute("value"),c!=null?Hu(a,k,Ps(c)):u!=null?Hu(a,k,Ps(u)):p!=null&&a.removeAttribute("value"),v==null&&x!=null&&(a.defaultChecked=!!x),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?a.name=""+Ps(D):a.removeAttribute("name")}function Wp(a,c,u,p,v,x,k,D){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(a.type=x),c!=null||u!=null){if(!(x!=="submit"&&x!=="reset"||c!=null)){Iu(a);return}u=u!=null?""+Ps(u):"",c=c!=null?""+Ps(c):u,D||c===a.value||(a.value=c),a.defaultValue=c}p=p??v,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=D?a.checked:!!p,a.defaultChecked=!!p,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(a.name=k),Iu(a)}function Hu(a,c,u){c==="number"&&tc(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function Da(a,c,u,p){if(a=a.options,c){c={};for(var v=0;v<u.length;v++)c["$"+u[v]]=!0;for(u=0;u<a.length;u++)v=c.hasOwnProperty("$"+a[u].value),a[u].selected!==v&&(a[u].selected=v),v&&p&&(a[u].defaultSelected=!0)}else{for(u=""+Ps(u),c=null,v=0;v<a.length;v++){if(a[v].value===u){a[v].selected=!0,p&&(a[v].defaultSelected=!0);return}c!==null||a[v].disabled||(c=a[v])}c!==null&&(c.selected=!0)}}function Xp(a,c,u){if(c!=null&&(c=""+Ps(c),c!==a.value&&(a.value=c),u==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=u!=null?""+Ps(u):""}function Jp(a,c,u,p){if(c==null){if(p!=null){if(u!=null)throw Error(s(92));if(ue(p)){if(1<p.length)throw Error(s(93));p=p[0]}u=p}u==null&&(u=""),c=u}u=Ps(c),a.defaultValue=u,p=a.textContent,p===u&&p!==""&&p!==null&&(a.value=p),Iu(a)}function _a(a,c){if(c){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=c;return}}a.textContent=c}var dM=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zp(a,c,u){var p=c.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":p?a.setProperty(c,u):typeof u!="number"||u===0||dM.has(c)?c==="float"?a.cssFloat=u:a[c]=(""+u).trim():a[c]=u+"px"}function eg(a,c,u){if(c!=null&&typeof c!="object")throw Error(s(62));if(a=a.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var v in c)p=c[v],c.hasOwnProperty(v)&&u[v]!==p&&Zp(a,v,p)}else for(var x in c)c.hasOwnProperty(x)&&Zp(a,x,c[x])}function qu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hM=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),fM=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function sc(a){return fM.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function zn(){}var $u=null;function Bu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Na=null,ja=null;function tg(a){var c=Ea(a);if(c&&(a=c.stateNode)){var u=a[Bt]||null;e:switch(a=c.stateNode,c.type){case"input":if(Ou(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),c=u.name,u.type==="radio"&&c!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Ls(""+c)+'"][type="radio"]'),c=0;c<u.length;c++){var p=u[c];if(p!==a&&p.form===a.form){var v=p[Bt]||null;if(!v)throw Error(s(90));Ou(p,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<u.length;c++)p=u[c],p.form===a.form&&Yp(p)}break e;case"textarea":Xp(a,u.value,u.defaultValue);break e;case"select":c=u.value,c!=null&&Da(a,!!u.multiple,c,!1)}}}var Uu=!1;function sg(a,c,u){if(Uu)return a(c,u);Uu=!0;try{var p=a(c);return p}finally{if(Uu=!1,(Na!==null||ja!==null)&&(Uc(),Na&&(c=Na,a=ja,ja=Na=null,tg(c),a)))for(c=0;c<a.length;c++)tg(a[c])}}function Po(a,c){var u=a.stateNode;if(u===null)return null;var p=u[Bt]||null;if(p===null)return null;u=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(s(231,c,typeof u));return u}var In=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fu=!1;if(In)try{var Lo={};Object.defineProperty(Lo,"passive",{get:function(){Fu=!0}}),window.addEventListener("test",Lo,Lo),window.removeEventListener("test",Lo,Lo)}catch{Fu=!1}var li=null,Vu=null,nc=null;function ng(){if(nc)return nc;var a,c=Vu,u=c.length,p,v="value"in li?li.value:li.textContent,x=v.length;for(a=0;a<u&&c[a]===v[a];a++);var k=u-a;for(p=1;p<=k&&c[u-p]===v[x-p];p++);return nc=v.slice(a,1<p?1-p:void 0)}function ic(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function ac(){return!0}function ig(){return!1}function fs(a){function c(u,p,v,x,k){this._reactName=u,this._targetInst=v,this.type=p,this.nativeEvent=x,this.target=k,this.currentTarget=null;for(var D in a)a.hasOwnProperty(D)&&(u=a[D],this[D]=u?u(x):x[D]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?ac:ig,this.isPropagationStopped=ig,this}return m(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ac)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ac)},persist:function(){},isPersistent:ac}),c}var Ki={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oc=fs(Ki),zo=m({},Ki,{view:0,detail:0}),pM=fs(zo),Qu,Gu,Io,rc=m({},zo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Io&&(Io&&a.type==="mousemove"?(Qu=a.screenX-Io.screenX,Gu=a.screenY-Io.screenY):Gu=Qu=0,Io=a),Qu)},movementY:function(a){return"movementY"in a?a.movementY:Gu}}),ag=fs(rc),gM=m({},rc,{dataTransfer:0}),mM=fs(gM),yM=m({},zo,{relatedTarget:0}),Ku=fs(yM),vM=m({},Ki,{animationName:0,elapsedTime:0,pseudoElement:0}),bM=fs(vM),xM=m({},Ki,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),wM=fs(xM),CM=m({},Ki,{data:0}),og=fs(CM),SM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},MM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kM(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=RM[a])?!!c[a]:!1}function Yu(){return kM}var EM=m({},zo,{key:function(a){if(a.key){var c=SM[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=ic(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?MM[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yu,charCode:function(a){return a.type==="keypress"?ic(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ic(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),TM=fs(EM),AM=m({},rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rg=fs(AM),DM=m({},zo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yu}),_M=fs(DM),NM=m({},Ki,{propertyName:0,elapsedTime:0,pseudoElement:0}),jM=fs(NM),PM=m({},rc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),LM=fs(PM),zM=m({},Ki,{newState:0,oldState:0}),IM=fs(zM),OM=[9,13,27,32],Wu=In&&"CompositionEvent"in window,Oo=null;In&&"documentMode"in document&&(Oo=document.documentMode);var HM=In&&"TextEvent"in window&&!Oo,cg=In&&(!Wu||Oo&&8<Oo&&11>=Oo),lg=" ",ug=!1;function dg(a,c){switch(a){case"keyup":return OM.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hg(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Pa=!1;function qM(a,c){switch(a){case"compositionend":return hg(c);case"keypress":return c.which!==32?null:(ug=!0,lg);case"textInput":return a=c.data,a===lg&&ug?null:a;default:return null}}function $M(a,c){if(Pa)return a==="compositionend"||!Wu&&dg(a,c)?(a=ng(),nc=Vu=li=null,Pa=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return cg&&c.locale!=="ko"?null:c.data;default:return null}}var BM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fg(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!BM[a.type]:c==="textarea"}function pg(a,c,u,p){Na?ja?ja.push(p):ja=[p]:Na=p,c=Wc(c,"onChange"),0<c.length&&(u=new oc("onChange","change",null,u,p),a.push({event:u,listeners:c}))}var Ho=null,qo=null;function UM(a){Wy(a,0)}function cc(a){var c=jo(a);if(Yp(c))return a}function gg(a,c){if(a==="change")return c}var mg=!1;if(In){var Xu;if(In){var Ju="oninput"in document;if(!Ju){var yg=document.createElement("div");yg.setAttribute("oninput","return;"),Ju=typeof yg.oninput=="function"}Xu=Ju}else Xu=!1;mg=Xu&&(!document.documentMode||9<document.documentMode)}function vg(){Ho&&(Ho.detachEvent("onpropertychange",bg),qo=Ho=null)}function bg(a){if(a.propertyName==="value"&&cc(qo)){var c=[];pg(c,qo,a,Bu(a)),sg(UM,c)}}function FM(a,c,u){a==="focusin"?(vg(),Ho=c,qo=u,Ho.attachEvent("onpropertychange",bg)):a==="focusout"&&vg()}function VM(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return cc(qo)}function QM(a,c){if(a==="click")return cc(c)}function GM(a,c){if(a==="input"||a==="change")return cc(c)}function KM(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Cs=typeof Object.is=="function"?Object.is:KM;function $o(a,c){if(Cs(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var u=Object.keys(a),p=Object.keys(c);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var v=u[p];if(!$e.call(c,v)||!Cs(a[v],c[v]))return!1}return!0}function xg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function wg(a,c){var u=xg(a);a=0;for(var p;u;){if(u.nodeType===3){if(p=a+u.textContent.length,a<=c&&p>=c)return{node:u,offset:c-a};a=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=xg(u)}}function Cg(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?Cg(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function Sg(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=tc(a.document);c instanceof a.HTMLIFrameElement;){try{var u=typeof c.contentWindow.location.href=="string"}catch{u=!1}if(u)a=c.contentWindow;else break;c=tc(a.document)}return c}function Zu(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var YM=In&&"documentMode"in document&&11>=document.documentMode,La=null,ed=null,Bo=null,td=!1;function Mg(a,c,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;td||La==null||La!==tc(p)||(p=La,"selectionStart"in p&&Zu(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Bo&&$o(Bo,p)||(Bo=p,p=Wc(ed,"onSelect"),0<p.length&&(c=new oc("onSelect","select",null,c,u),a.push({event:c,listeners:p}),c.target=La)))}function Yi(a,c){var u={};return u[a.toLowerCase()]=c.toLowerCase(),u["Webkit"+a]="webkit"+c,u["Moz"+a]="moz"+c,u}var za={animationend:Yi("Animation","AnimationEnd"),animationiteration:Yi("Animation","AnimationIteration"),animationstart:Yi("Animation","AnimationStart"),transitionrun:Yi("Transition","TransitionRun"),transitionstart:Yi("Transition","TransitionStart"),transitioncancel:Yi("Transition","TransitionCancel"),transitionend:Yi("Transition","TransitionEnd")},sd={},Rg={};In&&(Rg=document.createElement("div").style,"AnimationEvent"in window||(delete za.animationend.animation,delete za.animationiteration.animation,delete za.animationstart.animation),"TransitionEvent"in window||delete za.transitionend.transition);function Wi(a){if(sd[a])return sd[a];if(!za[a])return a;var c=za[a],u;for(u in c)if(c.hasOwnProperty(u)&&u in Rg)return sd[a]=c[u];return a}var kg=Wi("animationend"),Eg=Wi("animationiteration"),Tg=Wi("animationstart"),WM=Wi("transitionrun"),XM=Wi("transitionstart"),JM=Wi("transitioncancel"),Ag=Wi("transitionend"),Dg=new Map,nd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nd.push("scrollEnd");function Js(a,c){Dg.set(a,c),Gi(c,[a])}var lc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},zs=[],Ia=0,id=0;function uc(){for(var a=Ia,c=id=Ia=0;c<a;){var u=zs[c];zs[c++]=null;var p=zs[c];zs[c++]=null;var v=zs[c];zs[c++]=null;var x=zs[c];if(zs[c++]=null,p!==null&&v!==null){var k=p.pending;k===null?v.next=v:(v.next=k.next,k.next=v),p.pending=v}x!==0&&_g(u,v,x)}}function dc(a,c,u,p){zs[Ia++]=a,zs[Ia++]=c,zs[Ia++]=u,zs[Ia++]=p,id|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function ad(a,c,u,p){return dc(a,c,u,p),hc(a)}function Xi(a,c){return dc(a,null,null,c),hc(a)}function _g(a,c,u){a.lanes|=u;var p=a.alternate;p!==null&&(p.lanes|=u);for(var v=!1,x=a.return;x!==null;)x.childLanes|=u,p=x.alternate,p!==null&&(p.childLanes|=u),x.tag===22&&(a=x.stateNode,a===null||a._visibility&1||(v=!0)),a=x,x=x.return;return a.tag===3?(x=a.stateNode,v&&c!==null&&(v=31-Lt(u),a=x.hiddenUpdates,p=a[v],p===null?a[v]=[c]:p.push(c),c.lane=u|536870912),x):null}function hc(a){if(50<ur)throw ur=0,ph=null,Error(s(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var Oa={};function ZM(a,c,u,p){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ss(a,c,u,p){return new ZM(a,c,u,p)}function od(a){return a=a.prototype,!(!a||!a.isReactComponent)}function On(a,c){var u=a.alternate;return u===null?(u=Ss(a.tag,c,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=c,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,c=a.dependencies,u.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function Ng(a,c){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,c=u.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function fc(a,c,u,p,v,x){var k=0;if(p=a,typeof a=="function")od(a)&&(k=1);else if(typeof a=="string")k=iR(a,u,ie.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Z:return a=Ss(31,u,c,v),a.elementType=Z,a.lanes=x,a;case S:return Ji(u.children,v,x,c);case R:k=8,v|=24;break;case M:return a=Ss(12,u,c,v|2),a.elementType=M,a.lanes=x,a;case _:return a=Ss(13,u,c,v),a.elementType=_,a.lanes=x,a;case N:return a=Ss(19,u,c,v),a.elementType=N,a.lanes=x,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case E:k=10;break e;case T:k=9;break e;case A:k=11;break e;case z:k=14;break e;case q:k=16,p=null;break e}k=29,u=Error(s(130,a===null?"null":typeof a,"")),p=null}return c=Ss(k,u,c,v),c.elementType=a,c.type=p,c.lanes=x,c}function Ji(a,c,u,p){return a=Ss(7,a,p,c),a.lanes=u,a}function rd(a,c,u){return a=Ss(6,a,null,c),a.lanes=u,a}function jg(a){var c=Ss(18,null,null,0);return c.stateNode=a,c}function cd(a,c,u){return c=Ss(4,a.children!==null?a.children:[],a.key,c),c.lanes=u,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var Pg=new WeakMap;function Is(a,c){if(typeof a=="object"&&a!==null){var u=Pg.get(a);return u!==void 0?u:(c={value:a,source:c,stack:de(c)},Pg.set(a,c),c)}return{value:a,source:c,stack:de(c)}}var Ha=[],qa=0,pc=null,Uo=0,Os=[],Hs=0,ui=null,pn=1,gn="";function Hn(a,c){Ha[qa++]=Uo,Ha[qa++]=pc,pc=a,Uo=c}function Lg(a,c,u){Os[Hs++]=pn,Os[Hs++]=gn,Os[Hs++]=ui,ui=a;var p=pn;a=gn;var v=32-Lt(p)-1;p&=~(1<<v),u+=1;var x=32-Lt(c)+v;if(30<x){var k=v-v%5;x=(p&(1<<k)-1).toString(32),p>>=k,v-=k,pn=1<<32-Lt(c)+v|u<<v|p,gn=x+a}else pn=1<<x|u<<v|p,gn=a}function ld(a){a.return!==null&&(Hn(a,1),Lg(a,1,0))}function ud(a){for(;a===pc;)pc=Ha[--qa],Ha[qa]=null,Uo=Ha[--qa],Ha[qa]=null;for(;a===ui;)ui=Os[--Hs],Os[Hs]=null,gn=Os[--Hs],Os[Hs]=null,pn=Os[--Hs],Os[Hs]=null}function zg(a,c){Os[Hs++]=pn,Os[Hs++]=gn,Os[Hs++]=ui,pn=c.id,gn=c.overflow,ui=a}var es=null,wt=null,Xe=!1,di=null,qs=!1,dd=Error(s(519));function hi(a){var c=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fo(Is(c,a)),dd}function Ig(a){var c=a.stateNode,u=a.type,p=a.memoizedProps;switch(c[vt]=a,c[Bt]=p,u){case"dialog":Qe("cancel",c),Qe("close",c);break;case"iframe":case"object":case"embed":Qe("load",c);break;case"video":case"audio":for(u=0;u<hr.length;u++)Qe(hr[u],c);break;case"source":Qe("error",c);break;case"img":case"image":case"link":Qe("error",c),Qe("load",c);break;case"details":Qe("toggle",c);break;case"input":Qe("invalid",c),Wp(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":Qe("invalid",c);break;case"textarea":Qe("invalid",c),Jp(c,p.value,p.defaultValue,p.children)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||c.textContent===""+u||p.suppressHydrationWarning===!0||e0(c.textContent,u)?(p.popover!=null&&(Qe("beforetoggle",c),Qe("toggle",c)),p.onScroll!=null&&Qe("scroll",c),p.onScrollEnd!=null&&Qe("scrollend",c),p.onClick!=null&&(c.onclick=zn),c=!0):c=!1,c||hi(a,!0)}function Og(a){for(es=a.return;es;)switch(es.tag){case 5:case 31:case 13:qs=!1;return;case 27:case 3:qs=!0;return;default:es=es.return}}function $a(a){if(a!==es)return!1;if(!Xe)return Og(a),Xe=!0,!1;var c=a.tag,u;if((u=c!==3&&c!==27)&&((u=c===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||Ah(a.type,a.memoizedProps)),u=!u),u&&wt&&hi(a),Og(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));wt=l0(a)}else if(c===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));wt=l0(a)}else c===27?(c=wt,ki(a.type)?(a=Ph,Ph=null,wt=a):wt=c):wt=es?Bs(a.stateNode.nextSibling):null;return!0}function Zi(){wt=es=null,Xe=!1}function hd(){var a=di;return a!==null&&(ys===null?ys=a:ys.push.apply(ys,a),di=null),a}function Fo(a){di===null?di=[a]:di.push(a)}var fd=P(null),ea=null,qn=null;function fi(a,c,u){Y(fd,c._currentValue),c._currentValue=u}function $n(a){a._currentValue=fd.current,F(fd)}function pd(a,c,u){for(;a!==null;){var p=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),a===u)break;a=a.return}}function gd(a,c,u,p){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var x=v.dependencies;if(x!==null){var k=v.child;x=x.firstContext;e:for(;x!==null;){var D=x;x=v;for(var I=0;I<c.length;I++)if(D.context===c[I]){x.lanes|=u,D=x.alternate,D!==null&&(D.lanes|=u),pd(x.return,u,a),p||(k=null);break e}x=D.next}}else if(v.tag===18){if(k=v.return,k===null)throw Error(s(341));k.lanes|=u,x=k.alternate,x!==null&&(x.lanes|=u),pd(k,u,a),k=null}else k=v.child;if(k!==null)k.return=v;else for(k=v;k!==null;){if(k===a){k=null;break}if(v=k.sibling,v!==null){v.return=k.return,k=v;break}k=k.return}v=k}}function Ba(a,c,u,p){a=null;for(var v=c,x=!1;v!==null;){if(!x){if((v.flags&524288)!==0)x=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var k=v.alternate;if(k===null)throw Error(s(387));if(k=k.memoizedProps,k!==null){var D=v.type;Cs(v.pendingProps.value,k.value)||(a!==null?a.push(D):a=[D])}}else if(v===B.current){if(k=v.alternate,k===null)throw Error(s(387));k.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(yr):a=[yr])}v=v.return}a!==null&&gd(c,a,u,p),c.flags|=262144}function gc(a){for(a=a.firstContext;a!==null;){if(!Cs(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ta(a){ea=a,qn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function ts(a){return Hg(ea,a)}function mc(a,c){return ea===null&&ta(a),Hg(a,c)}function Hg(a,c){var u=c._currentValue;if(c={context:c,memoizedValue:u,next:null},qn===null){if(a===null)throw Error(s(308));qn=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else qn=qn.next=c;return u}var e1=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(u,p){a.push(p)}};this.abort=function(){c.aborted=!0,a.forEach(function(u){return u()})}},t1=r.unstable_scheduleCallback,s1=r.unstable_NormalPriority,It={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function md(){return{controller:new e1,data:new Map,refCount:0}}function Vo(a){a.refCount--,a.refCount===0&&t1(s1,function(){a.controller.abort()})}var Qo=null,yd=0,Ua=0,Fa=null;function n1(a,c){if(Qo===null){var u=Qo=[];yd=0,Ua=xh(),Fa={status:"pending",value:void 0,then:function(p){u.push(p)}}}return yd++,c.then(qg,qg),c}function qg(){if(--yd===0&&Qo!==null){Fa!==null&&(Fa.status="fulfilled");var a=Qo;Qo=null,Ua=0,Fa=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function i1(a,c){var u=[],p={status:"pending",value:null,reason:null,then:function(v){u.push(v)}};return a.then(function(){p.status="fulfilled",p.value=c;for(var v=0;v<u.length;v++)(0,u[v])(c)},function(v){for(p.status="rejected",p.reason=v,v=0;v<u.length;v++)(0,u[v])(void 0)}),p}var $g=L.S;L.S=function(a,c){My=Ze(),typeof c=="object"&&c!==null&&typeof c.then=="function"&&n1(a,c),$g!==null&&$g(a,c)};var sa=P(null);function vd(){var a=sa.current;return a!==null?a:pt.pooledCache}function yc(a,c){c===null?Y(sa,sa.current):Y(sa,c.pool)}function Bg(){var a=vd();return a===null?null:{parent:It._currentValue,pool:a}}var Va=Error(s(460)),bd=Error(s(474)),vc=Error(s(542)),bc={then:function(){}};function Ug(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Fg(a,c,u){switch(u=a[u],u===void 0?a.push(c):u!==c&&(c.then(zn,zn),c=u),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Qg(a),a;default:if(typeof c.status=="string")c.then(zn,zn);else{if(a=pt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=c,a.status="pending",a.then(function(p){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=p}},function(p){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Qg(a),a}throw ia=c,Va}}function na(a){try{var c=a._init;return c(a._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(ia=u,Va):u}}var ia=null;function Vg(){if(ia===null)throw Error(s(459));var a=ia;return ia=null,a}function Qg(a){if(a===Va||a===vc)throw Error(s(483))}var Qa=null,Go=0;function xc(a){var c=Go;return Go+=1,Qa===null&&(Qa=[]),Fg(Qa,a,c)}function Ko(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function wc(a,c){throw c.$$typeof===y?Error(s(525)):(a=Object.prototype.toString.call(c),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function Gg(a){function c($,H){if(a){var V=$.deletions;V===null?($.deletions=[H],$.flags|=16):V.push(H)}}function u($,H){if(!a)return null;for(;H!==null;)c($,H),H=H.sibling;return null}function p($){for(var H=new Map;$!==null;)$.key!==null?H.set($.key,$):H.set($.index,$),$=$.sibling;return H}function v($,H){return $=On($,H),$.index=0,$.sibling=null,$}function x($,H,V){return $.index=V,a?(V=$.alternate,V!==null?(V=V.index,V<H?($.flags|=67108866,H):V):($.flags|=67108866,H)):($.flags|=1048576,H)}function k($){return a&&$.alternate===null&&($.flags|=67108866),$}function D($,H,V,oe){return H===null||H.tag!==6?(H=rd(V,$.mode,oe),H.return=$,H):(H=v(H,V),H.return=$,H)}function I($,H,V,oe){var Te=V.type;return Te===S?se($,H,V.props.children,oe,V.key):H!==null&&(H.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===q&&na(Te)===H.type)?(H=v(H,V.props),Ko(H,V),H.return=$,H):(H=fc(V.type,V.key,V.props,null,$.mode,oe),Ko(H,V),H.return=$,H)}function Q($,H,V,oe){return H===null||H.tag!==4||H.stateNode.containerInfo!==V.containerInfo||H.stateNode.implementation!==V.implementation?(H=cd(V,$.mode,oe),H.return=$,H):(H=v(H,V.children||[]),H.return=$,H)}function se($,H,V,oe,Te){return H===null||H.tag!==7?(H=Ji(V,$.mode,oe,Te),H.return=$,H):(H=v(H,V),H.return=$,H)}function re($,H,V){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return H=rd(""+H,$.mode,V),H.return=$,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case b:return V=fc(H.type,H.key,H.props,null,$.mode,V),Ko(V,H),V.return=$,V;case C:return H=cd(H,$.mode,V),H.return=$,H;case q:return H=na(H),re($,H,V)}if(ue(H)||J(H))return H=Ji(H,$.mode,V,null),H.return=$,H;if(typeof H.then=="function")return re($,xc(H),V);if(H.$$typeof===E)return re($,mc($,H),V);wc($,H)}return null}function K($,H,V,oe){var Te=H!==null?H.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return Te!==null?null:D($,H,""+V,oe);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case b:return V.key===Te?I($,H,V,oe):null;case C:return V.key===Te?Q($,H,V,oe):null;case q:return V=na(V),K($,H,V,oe)}if(ue(V)||J(V))return Te!==null?null:se($,H,V,oe,null);if(typeof V.then=="function")return K($,H,xc(V),oe);if(V.$$typeof===E)return K($,H,mc($,V),oe);wc($,V)}return null}function X($,H,V,oe,Te){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return $=$.get(V)||null,D(H,$,""+oe,Te);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case b:return $=$.get(oe.key===null?V:oe.key)||null,I(H,$,oe,Te);case C:return $=$.get(oe.key===null?V:oe.key)||null,Q(H,$,oe,Te);case q:return oe=na(oe),X($,H,V,oe,Te)}if(ue(oe)||J(oe))return $=$.get(V)||null,se(H,$,oe,Te,null);if(typeof oe.then=="function")return X($,H,V,xc(oe),Te);if(oe.$$typeof===E)return X($,H,V,mc(H,oe),Te);wc(H,oe)}return null}function xe($,H,V,oe){for(var Te=null,et=null,Me=H,He=H=0,Ke=null;Me!==null&&He<V.length;He++){Me.index>He?(Ke=Me,Me=null):Ke=Me.sibling;var tt=K($,Me,V[He],oe);if(tt===null){Me===null&&(Me=Ke);break}a&&Me&&tt.alternate===null&&c($,Me),H=x(tt,H,He),et===null?Te=tt:et.sibling=tt,et=tt,Me=Ke}if(He===V.length)return u($,Me),Xe&&Hn($,He),Te;if(Me===null){for(;He<V.length;He++)Me=re($,V[He],oe),Me!==null&&(H=x(Me,H,He),et===null?Te=Me:et.sibling=Me,et=Me);return Xe&&Hn($,He),Te}for(Me=p(Me);He<V.length;He++)Ke=X(Me,$,He,V[He],oe),Ke!==null&&(a&&Ke.alternate!==null&&Me.delete(Ke.key===null?He:Ke.key),H=x(Ke,H,He),et===null?Te=Ke:et.sibling=Ke,et=Ke);return a&&Me.forEach(function(_i){return c($,_i)}),Xe&&Hn($,He),Te}function Ne($,H,V,oe){if(V==null)throw Error(s(151));for(var Te=null,et=null,Me=H,He=H=0,Ke=null,tt=V.next();Me!==null&&!tt.done;He++,tt=V.next()){Me.index>He?(Ke=Me,Me=null):Ke=Me.sibling;var _i=K($,Me,tt.value,oe);if(_i===null){Me===null&&(Me=Ke);break}a&&Me&&_i.alternate===null&&c($,Me),H=x(_i,H,He),et===null?Te=_i:et.sibling=_i,et=_i,Me=Ke}if(tt.done)return u($,Me),Xe&&Hn($,He),Te;if(Me===null){for(;!tt.done;He++,tt=V.next())tt=re($,tt.value,oe),tt!==null&&(H=x(tt,H,He),et===null?Te=tt:et.sibling=tt,et=tt);return Xe&&Hn($,He),Te}for(Me=p(Me);!tt.done;He++,tt=V.next())tt=X(Me,$,He,tt.value,oe),tt!==null&&(a&&tt.alternate!==null&&Me.delete(tt.key===null?He:tt.key),H=x(tt,H,He),et===null?Te=tt:et.sibling=tt,et=tt);return a&&Me.forEach(function(gR){return c($,gR)}),Xe&&Hn($,He),Te}function ht($,H,V,oe){if(typeof V=="object"&&V!==null&&V.type===S&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case b:e:{for(var Te=V.key;H!==null;){if(H.key===Te){if(Te=V.type,Te===S){if(H.tag===7){u($,H.sibling),oe=v(H,V.props.children),oe.return=$,$=oe;break e}}else if(H.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===q&&na(Te)===H.type){u($,H.sibling),oe=v(H,V.props),Ko(oe,V),oe.return=$,$=oe;break e}u($,H);break}else c($,H);H=H.sibling}V.type===S?(oe=Ji(V.props.children,$.mode,oe,V.key),oe.return=$,$=oe):(oe=fc(V.type,V.key,V.props,null,$.mode,oe),Ko(oe,V),oe.return=$,$=oe)}return k($);case C:e:{for(Te=V.key;H!==null;){if(H.key===Te)if(H.tag===4&&H.stateNode.containerInfo===V.containerInfo&&H.stateNode.implementation===V.implementation){u($,H.sibling),oe=v(H,V.children||[]),oe.return=$,$=oe;break e}else{u($,H);break}else c($,H);H=H.sibling}oe=cd(V,$.mode,oe),oe.return=$,$=oe}return k($);case q:return V=na(V),ht($,H,V,oe)}if(ue(V))return xe($,H,V,oe);if(J(V)){if(Te=J(V),typeof Te!="function")throw Error(s(150));return V=Te.call(V),Ne($,H,V,oe)}if(typeof V.then=="function")return ht($,H,xc(V),oe);if(V.$$typeof===E)return ht($,H,mc($,V),oe);wc($,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,H!==null&&H.tag===6?(u($,H.sibling),oe=v(H,V),oe.return=$,$=oe):(u($,H),oe=rd(V,$.mode,oe),oe.return=$,$=oe),k($)):u($,H)}return function($,H,V,oe){try{Go=0;var Te=ht($,H,V,oe);return Qa=null,Te}catch(Me){if(Me===Va||Me===vc)throw Me;var et=Ss(29,Me,null,$.mode);return et.lanes=oe,et.return=$,et}finally{}}}var aa=Gg(!0),Kg=Gg(!1),pi=!1;function xd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wd(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function gi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function mi(a,c,u){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(st&2)!==0){var v=p.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),p.pending=c,c=hc(a),_g(a,null,u),c}return dc(a,p,c,u),hc(a)}function Yo(a,c,u){if(c=c.updateQueue,c!==null&&(c=c.shared,(u&4194048)!==0)){var p=c.lanes;p&=a.pendingLanes,u|=p,c.lanes=u,lt(a,u)}}function Cd(a,c){var u=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var v=null,x=null;if(u=u.firstBaseUpdate,u!==null){do{var k={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};x===null?v=x=k:x=x.next=k,u=u.next}while(u!==null);x===null?v=x=c:x=x.next=c}else v=x=c;u={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:x,shared:p.shared,callbacks:p.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=c}var Sd=!1;function Wo(){if(Sd){var a=Fa;if(a!==null)throw a}}function Xo(a,c,u,p){Sd=!1;var v=a.updateQueue;pi=!1;var x=v.firstBaseUpdate,k=v.lastBaseUpdate,D=v.shared.pending;if(D!==null){v.shared.pending=null;var I=D,Q=I.next;I.next=null,k===null?x=Q:k.next=Q,k=I;var se=a.alternate;se!==null&&(se=se.updateQueue,D=se.lastBaseUpdate,D!==k&&(D===null?se.firstBaseUpdate=Q:D.next=Q,se.lastBaseUpdate=I))}if(x!==null){var re=v.baseState;k=0,se=Q=I=null,D=x;do{var K=D.lane&-536870913,X=K!==D.lane;if(X?(Ge&K)===K:(p&K)===K){K!==0&&K===Ua&&(Sd=!0),se!==null&&(se=se.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var xe=a,Ne=D;K=c;var ht=u;switch(Ne.tag){case 1:if(xe=Ne.payload,typeof xe=="function"){re=xe.call(ht,re,K);break e}re=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=Ne.payload,K=typeof xe=="function"?xe.call(ht,re,K):xe,K==null)break e;re=m({},re,K);break e;case 2:pi=!0}}K=D.callback,K!==null&&(a.flags|=64,X&&(a.flags|=8192),X=v.callbacks,X===null?v.callbacks=[K]:X.push(K))}else X={lane:K,tag:D.tag,payload:D.payload,callback:D.callback,next:null},se===null?(Q=se=X,I=re):se=se.next=X,k|=K;if(D=D.next,D===null){if(D=v.shared.pending,D===null)break;X=D,D=X.next,X.next=null,v.lastBaseUpdate=X,v.shared.pending=null}}while(!0);se===null&&(I=re),v.baseState=I,v.firstBaseUpdate=Q,v.lastBaseUpdate=se,x===null&&(v.shared.lanes=0),wi|=k,a.lanes=k,a.memoizedState=re}}function Yg(a,c){if(typeof a!="function")throw Error(s(191,a));a.call(c)}function Wg(a,c){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)Yg(u[a],c)}var Ga=P(null),Cc=P(0);function Xg(a,c){a=Wn,Y(Cc,a),Y(Ga,c),Wn=a|c.baseLanes}function Md(){Y(Cc,Wn),Y(Ga,Ga.current)}function Rd(){Wn=Cc.current,F(Ga),F(Cc)}var Ms=P(null),$s=null;function yi(a){var c=a.alternate;Y(Dt,Dt.current&1),Y(Ms,a),$s===null&&(c===null||Ga.current!==null||c.memoizedState!==null)&&($s=a)}function kd(a){Y(Dt,Dt.current),Y(Ms,a),$s===null&&($s=a)}function Jg(a){a.tag===22?(Y(Dt,Dt.current),Y(Ms,a),$s===null&&($s=a)):vi()}function vi(){Y(Dt,Dt.current),Y(Ms,Ms.current)}function Rs(a){F(Ms),$s===a&&($s=null),F(Dt)}var Dt=P(0);function Sc(a){for(var c=a;c!==null;){if(c.tag===13){var u=c.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Nh(u)||jh(u)))return c}else if(c.tag===19&&(c.memoizedProps.revealOrder==="forwards"||c.memoizedProps.revealOrder==="backwards"||c.memoizedProps.revealOrder==="unstable_legacy-backwards"||c.memoizedProps.revealOrder==="together")){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Bn=0,Oe=null,ut=null,Ot=null,Mc=!1,Ka=!1,oa=!1,Rc=0,Jo=0,Ya=null,a1=0;function Rt(){throw Error(s(321))}function Ed(a,c){if(c===null)return!1;for(var u=0;u<c.length&&u<a.length;u++)if(!Cs(a[u],c[u]))return!1;return!0}function Td(a,c,u,p,v,x){return Bn=x,Oe=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,L.H=a===null||a.memoizedState===null?Lm:Ud,oa=!1,x=u(p,v),oa=!1,Ka&&(x=em(c,u,p,v)),Zg(a),x}function Zg(a){L.H=tr;var c=ut!==null&&ut.next!==null;if(Bn=0,Ot=ut=Oe=null,Mc=!1,Jo=0,Ya=null,c)throw Error(s(300));a===null||Ht||(a=a.dependencies,a!==null&&gc(a)&&(Ht=!0))}function em(a,c,u,p){Oe=a;var v=0;do{if(Ka&&(Ya=null),Jo=0,Ka=!1,25<=v)throw Error(s(301));if(v+=1,Ot=ut=null,a.updateQueue!=null){var x=a.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}L.H=zm,x=c(u,p)}while(Ka);return x}function o1(){var a=L.H,c=a.useState()[0];return c=typeof c.then=="function"?Zo(c):c,a=a.useState()[0],(ut!==null?ut.memoizedState:null)!==a&&(Oe.flags|=1024),c}function Ad(){var a=Rc!==0;return Rc=0,a}function Dd(a,c,u){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~u}function _d(a){if(Mc){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}Mc=!1}Bn=0,Ot=ut=Oe=null,Ka=!1,Jo=Rc=0,Ya=null}function us(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?Oe.memoizedState=Ot=a:Ot=Ot.next=a,Ot}function _t(){if(ut===null){var a=Oe.alternate;a=a!==null?a.memoizedState:null}else a=ut.next;var c=Ot===null?Oe.memoizedState:Ot.next;if(c!==null)Ot=c,ut=a;else{if(a===null)throw Oe.alternate===null?Error(s(467)):Error(s(310));ut=a,a={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},Ot===null?Oe.memoizedState=Ot=a:Ot=Ot.next=a}return Ot}function kc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Zo(a){var c=Jo;return Jo+=1,Ya===null&&(Ya=[]),a=Fg(Ya,a,c),c=Oe,(Ot===null?c.memoizedState:Ot.next)===null&&(c=c.alternate,L.H=c===null||c.memoizedState===null?Lm:Ud),a}function Ec(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Zo(a);if(a.$$typeof===E)return ts(a)}throw Error(s(438,String(a)))}function Nd(a){var c=null,u=Oe.updateQueue;if(u!==null&&(c=u.memoCache),c==null){var p=Oe.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),u===null&&(u=kc(),Oe.updateQueue=u),u.memoCache=c,u=c.data[c.index],u===void 0)for(u=c.data[c.index]=Array(a),p=0;p<a;p++)u[p]=ne;return c.index++,u}function Un(a,c){return typeof c=="function"?c(a):c}function Tc(a){var c=_t();return jd(c,ut,a)}function jd(a,c,u){var p=a.queue;if(p===null)throw Error(s(311));p.lastRenderedReducer=u;var v=a.baseQueue,x=p.pending;if(x!==null){if(v!==null){var k=v.next;v.next=x.next,x.next=k}c.baseQueue=v=x,p.pending=null}if(x=a.baseState,v===null)a.memoizedState=x;else{c=v.next;var D=k=null,I=null,Q=c,se=!1;do{var re=Q.lane&-536870913;if(re!==Q.lane?(Ge&re)===re:(Bn&re)===re){var K=Q.revertLane;if(K===0)I!==null&&(I=I.next={lane:0,revertLane:0,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),re===Ua&&(se=!0);else if((Bn&K)===K){Q=Q.next,K===Ua&&(se=!0);continue}else re={lane:0,revertLane:Q.revertLane,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},I===null?(D=I=re,k=x):I=I.next=re,Oe.lanes|=K,wi|=K;re=Q.action,oa&&u(x,re),x=Q.hasEagerState?Q.eagerState:u(x,re)}else K={lane:re,revertLane:Q.revertLane,gesture:Q.gesture,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},I===null?(D=I=K,k=x):I=I.next=K,Oe.lanes|=re,wi|=re;Q=Q.next}while(Q!==null&&Q!==c);if(I===null?k=x:I.next=D,!Cs(x,a.memoizedState)&&(Ht=!0,se&&(u=Fa,u!==null)))throw u;a.memoizedState=x,a.baseState=k,a.baseQueue=I,p.lastRenderedState=x}return v===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function Pd(a){var c=_t(),u=c.queue;if(u===null)throw Error(s(311));u.lastRenderedReducer=a;var p=u.dispatch,v=u.pending,x=c.memoizedState;if(v!==null){u.pending=null;var k=v=v.next;do x=a(x,k.action),k=k.next;while(k!==v);Cs(x,c.memoizedState)||(Ht=!0),c.memoizedState=x,c.baseQueue===null&&(c.baseState=x),u.lastRenderedState=x}return[x,p]}function tm(a,c,u){var p=Oe,v=_t(),x=Xe;if(x){if(u===void 0)throw Error(s(407));u=u()}else u=c();var k=!Cs((ut||v).memoizedState,u);if(k&&(v.memoizedState=u,Ht=!0),v=v.queue,Id(im.bind(null,p,v,a),[a]),v.getSnapshot!==c||k||Ot!==null&&Ot.memoizedState.tag&1){if(p.flags|=2048,Wa(9,{destroy:void 0},nm.bind(null,p,v,u,c),null),pt===null)throw Error(s(349));x||(Bn&127)!==0||sm(p,c,u)}return u}function sm(a,c,u){a.flags|=16384,a={getSnapshot:c,value:u},c=Oe.updateQueue,c===null?(c=kc(),Oe.updateQueue=c,c.stores=[a]):(u=c.stores,u===null?c.stores=[a]:u.push(a))}function nm(a,c,u,p){c.value=u,c.getSnapshot=p,am(c)&&om(a)}function im(a,c,u){return u(function(){am(c)&&om(a)})}function am(a){var c=a.getSnapshot;a=a.value;try{var u=c();return!Cs(a,u)}catch{return!0}}function om(a){var c=Xi(a,2);c!==null&&vs(c,a,2)}function Ld(a){var c=us();if(typeof a=="function"){var u=a;if(a=u(),oa){Kt(!0);try{u()}finally{Kt(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Un,lastRenderedState:a},c}function rm(a,c,u,p){return a.baseState=u,jd(a,ut,typeof p=="function"?p:Un)}function r1(a,c,u,p,v){if(_c(a))throw Error(s(485));if(a=c.action,a!==null){var x={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){x.listeners.push(k)}};L.T!==null?u(!0):x.isTransition=!1,p(x),u=c.pending,u===null?(x.next=c.pending=x,cm(c,x)):(x.next=u.next,c.pending=u.next=x)}}function cm(a,c){var u=c.action,p=c.payload,v=a.state;if(c.isTransition){var x=L.T,k={};L.T=k;try{var D=u(v,p),I=L.S;I!==null&&I(k,D),lm(a,c,D)}catch(Q){zd(a,c,Q)}finally{x!==null&&k.types!==null&&(x.types=k.types),L.T=x}}else try{x=u(v,p),lm(a,c,x)}catch(Q){zd(a,c,Q)}}function lm(a,c,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){um(a,c,p)},function(p){return zd(a,c,p)}):um(a,c,u)}function um(a,c,u){c.status="fulfilled",c.value=u,dm(c),a.state=u,c=a.pending,c!==null&&(u=c.next,u===c?a.pending=null:(u=u.next,c.next=u,cm(a,u)))}function zd(a,c,u){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=u,dm(c),c=c.next;while(c!==p)}a.action=null}function dm(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function hm(a,c){return c}function fm(a,c){if(Xe){var u=pt.formState;if(u!==null){e:{var p=Oe;if(Xe){if(wt){t:{for(var v=wt,x=qs;v.nodeType!==8;){if(!x){v=null;break t}if(v=Bs(v.nextSibling),v===null){v=null;break t}}x=v.data,v=x==="F!"||x==="F"?v:null}if(v){wt=Bs(v.nextSibling),p=v.data==="F!";break e}}hi(p)}p=!1}p&&(c=u[0])}}return u=us(),u.memoizedState=u.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hm,lastRenderedState:c},u.queue=p,u=Nm.bind(null,Oe,p),p.dispatch=u,p=Ld(!1),x=Bd.bind(null,Oe,!1,p.queue),p=us(),v={state:c,dispatch:null,action:a,pending:null},p.queue=v,u=r1.bind(null,Oe,v,x,u),v.dispatch=u,p.memoizedState=a,[c,u,!1]}function pm(a){var c=_t();return gm(c,ut,a)}function gm(a,c,u){if(c=jd(a,c,hm)[0],a=Tc(Un)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=Zo(c)}catch(k){throw k===Va?vc:k}else p=c;c=_t();var v=c.queue,x=v.dispatch;return u!==c.memoizedState&&(Oe.flags|=2048,Wa(9,{destroy:void 0},c1.bind(null,v,u),null)),[p,x,a]}function c1(a,c){a.action=c}function mm(a){var c=_t(),u=ut;if(u!==null)return gm(c,u,a);_t(),c=c.memoizedState,u=_t();var p=u.queue.dispatch;return u.memoizedState=a,[c,p,!1]}function Wa(a,c,u,p){return a={tag:a,create:u,deps:p,inst:c,next:null},c=Oe.updateQueue,c===null&&(c=kc(),Oe.updateQueue=c),u=c.lastEffect,u===null?c.lastEffect=a.next=a:(p=u.next,u.next=a,a.next=p,c.lastEffect=a),a}function ym(){return _t().memoizedState}function Ac(a,c,u,p){var v=us();Oe.flags|=a,v.memoizedState=Wa(1|c,{destroy:void 0},u,p===void 0?null:p)}function Dc(a,c,u,p){var v=_t();p=p===void 0?null:p;var x=v.memoizedState.inst;ut!==null&&p!==null&&Ed(p,ut.memoizedState.deps)?v.memoizedState=Wa(c,x,u,p):(Oe.flags|=a,v.memoizedState=Wa(1|c,x,u,p))}function vm(a,c){Ac(8390656,8,a,c)}function Id(a,c){Dc(2048,8,a,c)}function l1(a){Oe.flags|=4;var c=Oe.updateQueue;if(c===null)c=kc(),Oe.updateQueue=c,c.events=[a];else{var u=c.events;u===null?c.events=[a]:u.push(a)}}function bm(a){var c=_t().memoizedState;return l1({ref:c,nextImpl:a}),function(){if((st&2)!==0)throw Error(s(440));return c.impl.apply(void 0,arguments)}}function xm(a,c){return Dc(4,2,a,c)}function wm(a,c){return Dc(4,4,a,c)}function Cm(a,c){if(typeof c=="function"){a=a();var u=c(a);return function(){typeof u=="function"?u():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function Sm(a,c,u){u=u!=null?u.concat([a]):null,Dc(4,4,Cm.bind(null,c,a),u)}function Od(){}function Mm(a,c){var u=_t();c=c===void 0?null:c;var p=u.memoizedState;return c!==null&&Ed(c,p[1])?p[0]:(u.memoizedState=[a,c],a)}function Rm(a,c){var u=_t();c=c===void 0?null:c;var p=u.memoizedState;if(c!==null&&Ed(c,p[1]))return p[0];if(p=a(),oa){Kt(!0);try{a()}finally{Kt(!1)}}return u.memoizedState=[p,c],p}function Hd(a,c,u){return u===void 0||(Bn&1073741824)!==0&&(Ge&261930)===0?a.memoizedState=c:(a.memoizedState=u,a=ky(),Oe.lanes|=a,wi|=a,u)}function km(a,c,u,p){return Cs(u,c)?u:Ga.current!==null?(a=Hd(a,u,p),Cs(a,c)||(Ht=!0),a):(Bn&42)===0||(Bn&1073741824)!==0&&(Ge&261930)===0?(Ht=!0,a.memoizedState=u):(a=ky(),Oe.lanes|=a,wi|=a,c)}function Em(a,c,u,p,v){var x=j.p;j.p=x!==0&&8>x?x:8;var k=L.T,D={};L.T=D,Bd(a,!1,c,u);try{var I=v(),Q=L.S;if(Q!==null&&Q(D,I),I!==null&&typeof I=="object"&&typeof I.then=="function"){var se=i1(I,p);er(a,c,se,Ts(a))}else er(a,c,p,Ts(a))}catch(re){er(a,c,{then:function(){},status:"rejected",reason:re},Ts())}finally{j.p=x,k!==null&&D.types!==null&&(k.types=D.types),L.T=k}}function u1(){}function qd(a,c,u,p){if(a.tag!==5)throw Error(s(476));var v=Tm(a).queue;Em(a,v,c,O,u===null?u1:function(){return Am(a),u(p)})}function Tm(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Un,lastRenderedState:O},next:null};var u={};return c.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Un,lastRenderedState:u},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function Am(a){var c=Tm(a);c.next===null&&(c=a.alternate.memoizedState),er(a,c.next.queue,{},Ts())}function $d(){return ts(yr)}function Dm(){return _t().memoizedState}function _m(){return _t().memoizedState}function d1(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var u=Ts();a=gi(u);var p=mi(c,a,u);p!==null&&(vs(p,c,u),Yo(p,c,u)),c={cache:md()},a.payload=c;return}c=c.return}}function h1(a,c,u){var p=Ts();u={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},_c(a)?jm(c,u):(u=ad(a,c,u,p),u!==null&&(vs(u,a,p),Pm(u,c,p)))}function Nm(a,c,u){var p=Ts();er(a,c,u,p)}function er(a,c,u,p){var v={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(_c(a))jm(c,v);else{var x=a.alternate;if(a.lanes===0&&(x===null||x.lanes===0)&&(x=c.lastRenderedReducer,x!==null))try{var k=c.lastRenderedState,D=x(k,u);if(v.hasEagerState=!0,v.eagerState=D,Cs(D,k))return dc(a,c,v,0),pt===null&&uc(),!1}catch{}finally{}if(u=ad(a,c,v,p),u!==null)return vs(u,a,p),Pm(u,c,p),!0}return!1}function Bd(a,c,u,p){if(p={lane:2,revertLane:xh(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},_c(a)){if(c)throw Error(s(479))}else c=ad(a,u,p,2),c!==null&&vs(c,a,2)}function _c(a){var c=a.alternate;return a===Oe||c!==null&&c===Oe}function jm(a,c){Ka=Mc=!0;var u=a.pending;u===null?c.next=c:(c.next=u.next,u.next=c),a.pending=c}function Pm(a,c,u){if((u&4194048)!==0){var p=c.lanes;p&=a.pendingLanes,u|=p,c.lanes=u,lt(a,u)}}var tr={readContext:ts,use:Ec,useCallback:Rt,useContext:Rt,useEffect:Rt,useImperativeHandle:Rt,useLayoutEffect:Rt,useInsertionEffect:Rt,useMemo:Rt,useReducer:Rt,useRef:Rt,useState:Rt,useDebugValue:Rt,useDeferredValue:Rt,useTransition:Rt,useSyncExternalStore:Rt,useId:Rt,useHostTransitionStatus:Rt,useFormState:Rt,useActionState:Rt,useOptimistic:Rt,useMemoCache:Rt,useCacheRefresh:Rt};tr.useEffectEvent=Rt;var Lm={readContext:ts,use:Ec,useCallback:function(a,c){return us().memoizedState=[a,c===void 0?null:c],a},useContext:ts,useEffect:vm,useImperativeHandle:function(a,c,u){u=u!=null?u.concat([a]):null,Ac(4194308,4,Cm.bind(null,c,a),u)},useLayoutEffect:function(a,c){return Ac(4194308,4,a,c)},useInsertionEffect:function(a,c){Ac(4,2,a,c)},useMemo:function(a,c){var u=us();c=c===void 0?null:c;var p=a();if(oa){Kt(!0);try{a()}finally{Kt(!1)}}return u.memoizedState=[p,c],p},useReducer:function(a,c,u){var p=us();if(u!==void 0){var v=u(c);if(oa){Kt(!0);try{u(c)}finally{Kt(!1)}}}else v=c;return p.memoizedState=p.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},p.queue=a,a=a.dispatch=h1.bind(null,Oe,a),[p.memoizedState,a]},useRef:function(a){var c=us();return a={current:a},c.memoizedState=a},useState:function(a){a=Ld(a);var c=a.queue,u=Nm.bind(null,Oe,c);return c.dispatch=u,[a.memoizedState,u]},useDebugValue:Od,useDeferredValue:function(a,c){var u=us();return Hd(u,a,c)},useTransition:function(){var a=Ld(!1);return a=Em.bind(null,Oe,a.queue,!0,!1),us().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,u){var p=Oe,v=us();if(Xe){if(u===void 0)throw Error(s(407));u=u()}else{if(u=c(),pt===null)throw Error(s(349));(Ge&127)!==0||sm(p,c,u)}v.memoizedState=u;var x={value:u,getSnapshot:c};return v.queue=x,vm(im.bind(null,p,x,a),[a]),p.flags|=2048,Wa(9,{destroy:void 0},nm.bind(null,p,x,u,c),null),u},useId:function(){var a=us(),c=pt.identifierPrefix;if(Xe){var u=gn,p=pn;u=(p&~(1<<32-Lt(p)-1)).toString(32)+u,c="_"+c+"R_"+u,u=Rc++,0<u&&(c+="H"+u.toString(32)),c+="_"}else u=a1++,c="_"+c+"r_"+u.toString(32)+"_";return a.memoizedState=c},useHostTransitionStatus:$d,useFormState:fm,useActionState:fm,useOptimistic:function(a){var c=us();c.memoizedState=c.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=u,c=Bd.bind(null,Oe,!0,u),u.dispatch=c,[a,c]},useMemoCache:Nd,useCacheRefresh:function(){return us().memoizedState=d1.bind(null,Oe)},useEffectEvent:function(a){var c=us(),u={impl:a};return c.memoizedState=u,function(){if((st&2)!==0)throw Error(s(440));return u.impl.apply(void 0,arguments)}}},Ud={readContext:ts,use:Ec,useCallback:Mm,useContext:ts,useEffect:Id,useImperativeHandle:Sm,useInsertionEffect:xm,useLayoutEffect:wm,useMemo:Rm,useReducer:Tc,useRef:ym,useState:function(){return Tc(Un)},useDebugValue:Od,useDeferredValue:function(a,c){var u=_t();return km(u,ut.memoizedState,a,c)},useTransition:function(){var a=Tc(Un)[0],c=_t().memoizedState;return[typeof a=="boolean"?a:Zo(a),c]},useSyncExternalStore:tm,useId:Dm,useHostTransitionStatus:$d,useFormState:pm,useActionState:pm,useOptimistic:function(a,c){var u=_t();return rm(u,ut,a,c)},useMemoCache:Nd,useCacheRefresh:_m};Ud.useEffectEvent=bm;var zm={readContext:ts,use:Ec,useCallback:Mm,useContext:ts,useEffect:Id,useImperativeHandle:Sm,useInsertionEffect:xm,useLayoutEffect:wm,useMemo:Rm,useReducer:Pd,useRef:ym,useState:function(){return Pd(Un)},useDebugValue:Od,useDeferredValue:function(a,c){var u=_t();return ut===null?Hd(u,a,c):km(u,ut.memoizedState,a,c)},useTransition:function(){var a=Pd(Un)[0],c=_t().memoizedState;return[typeof a=="boolean"?a:Zo(a),c]},useSyncExternalStore:tm,useId:Dm,useHostTransitionStatus:$d,useFormState:mm,useActionState:mm,useOptimistic:function(a,c){var u=_t();return ut!==null?rm(u,ut,a,c):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:Nd,useCacheRefresh:_m};zm.useEffectEvent=bm;function Fd(a,c,u,p){c=a.memoizedState,u=u(p,c),u=u==null?c:m({},c,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Vd={enqueueSetState:function(a,c,u){a=a._reactInternals;var p=Ts(),v=gi(p);v.payload=c,u!=null&&(v.callback=u),c=mi(a,v,p),c!==null&&(vs(c,a,p),Yo(c,a,p))},enqueueReplaceState:function(a,c,u){a=a._reactInternals;var p=Ts(),v=gi(p);v.tag=1,v.payload=c,u!=null&&(v.callback=u),c=mi(a,v,p),c!==null&&(vs(c,a,p),Yo(c,a,p))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var u=Ts(),p=gi(u);p.tag=2,c!=null&&(p.callback=c),c=mi(a,p,u),c!==null&&(vs(c,a,u),Yo(c,a,u))}};function Im(a,c,u,p,v,x,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,x,k):c.prototype&&c.prototype.isPureReactComponent?!$o(u,p)||!$o(v,x):!0}function Om(a,c,u,p){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(u,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(u,p),c.state!==a&&Vd.enqueueReplaceState(c,c.state,null)}function ra(a,c){var u=c;if("ref"in c){u={};for(var p in c)p!=="ref"&&(u[p]=c[p])}if(a=a.defaultProps){u===c&&(u=m({},u));for(var v in a)u[v]===void 0&&(u[v]=a[v])}return u}function Hm(a){lc(a)}function qm(a){console.error(a)}function $m(a){lc(a)}function Nc(a,c){try{var u=a.onUncaughtError;u(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function Bm(a,c,u){try{var p=a.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Qd(a,c,u){return u=gi(u),u.tag=3,u.payload={element:null},u.callback=function(){Nc(a,c)},u}function Um(a){return a=gi(a),a.tag=3,a}function Fm(a,c,u,p){var v=u.type.getDerivedStateFromError;if(typeof v=="function"){var x=p.value;a.payload=function(){return v(x)},a.callback=function(){Bm(c,u,p)}}var k=u.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(a.callback=function(){Bm(c,u,p),typeof v!="function"&&(Ci===null?Ci=new Set([this]):Ci.add(this));var D=p.stack;this.componentDidCatch(p.value,{componentStack:D!==null?D:""})})}function f1(a,c,u,p,v){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=u.alternate,c!==null&&Ba(c,u,v,!0),u=Ms.current,u!==null){switch(u.tag){case 31:case 13:return $s===null?Fc():u.alternate===null&&kt===0&&(kt=3),u.flags&=-257,u.flags|=65536,u.lanes=v,p===bc?u.flags|=16384:(c=u.updateQueue,c===null?u.updateQueue=new Set([p]):c.add(p),yh(a,p,v)),!1;case 22:return u.flags|=65536,p===bc?u.flags|=16384:(c=u.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=c):(u=c.retryQueue,u===null?c.retryQueue=new Set([p]):u.add(p)),yh(a,p,v)),!1}throw Error(s(435,u.tag))}return yh(a,p,v),Fc(),!1}if(Xe)return c=Ms.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=v,p!==dd&&(a=Error(s(422),{cause:p}),Fo(Is(a,u)))):(p!==dd&&(c=Error(s(423),{cause:p}),Fo(Is(c,u))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,p=Is(p,u),v=Qd(a.stateNode,p,v),Cd(a,v),kt!==4&&(kt=2)),!1;var x=Error(s(520),{cause:p});if(x=Is(x,u),lr===null?lr=[x]:lr.push(x),kt!==4&&(kt=2),c===null)return!0;p=Is(p,u),u=c;do{switch(u.tag){case 3:return u.flags|=65536,a=v&-v,u.lanes|=a,a=Qd(u.stateNode,p,a),Cd(u,a),!1;case 1:if(c=u.type,x=u.stateNode,(u.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Ci===null||!Ci.has(x))))return u.flags|=65536,v&=-v,u.lanes|=v,v=Um(v),Fm(v,a,u,p),Cd(u,v),!1}u=u.return}while(u!==null);return!1}var Gd=Error(s(461)),Ht=!1;function ss(a,c,u,p){c.child=a===null?Kg(c,null,u,p):aa(c,a.child,u,p)}function Vm(a,c,u,p,v){u=u.render;var x=c.ref;if("ref"in p){var k={};for(var D in p)D!=="ref"&&(k[D]=p[D])}else k=p;return ta(c),p=Td(a,c,u,k,x,v),D=Ad(),a!==null&&!Ht?(Dd(a,c,v),Fn(a,c,v)):(Xe&&D&&ld(c),c.flags|=1,ss(a,c,p,v),c.child)}function Qm(a,c,u,p,v){if(a===null){var x=u.type;return typeof x=="function"&&!od(x)&&x.defaultProps===void 0&&u.compare===null?(c.tag=15,c.type=x,Gm(a,c,x,p,v)):(a=fc(u.type,null,p,c,c.mode,v),a.ref=c.ref,a.return=c,c.child=a)}if(x=a.child,!th(a,v)){var k=x.memoizedProps;if(u=u.compare,u=u!==null?u:$o,u(k,p)&&a.ref===c.ref)return Fn(a,c,v)}return c.flags|=1,a=On(x,p),a.ref=c.ref,a.return=c,c.child=a}function Gm(a,c,u,p,v){if(a!==null){var x=a.memoizedProps;if($o(x,p)&&a.ref===c.ref)if(Ht=!1,c.pendingProps=p=x,th(a,v))(a.flags&131072)!==0&&(Ht=!0);else return c.lanes=a.lanes,Fn(a,c,v)}return Kd(a,c,u,p,v)}function Km(a,c,u,p){var v=p.children,x=a!==null?a.memoizedState:null;if(a===null&&c.stateNode===null&&(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((c.flags&128)!==0){if(x=x!==null?x.baseLanes|u:u,a!==null){for(p=c.child=a.child,v=0;p!==null;)v=v|p.lanes|p.childLanes,p=p.sibling;p=v&~x}else p=0,c.child=null;return Ym(a,c,x,u,p)}if((u&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&yc(c,x!==null?x.cachePool:null),x!==null?Xg(c,x):Md(),Jg(c);else return p=c.lanes=536870912,Ym(a,c,x!==null?x.baseLanes|u:u,u,p)}else x!==null?(yc(c,x.cachePool),Xg(c,x),vi(),c.memoizedState=null):(a!==null&&yc(c,null),Md(),vi());return ss(a,c,v,u),c.child}function sr(a,c){return a!==null&&a.tag===22||c.stateNode!==null||(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.sibling}function Ym(a,c,u,p,v){var x=vd();return x=x===null?null:{parent:It._currentValue,pool:x},c.memoizedState={baseLanes:u,cachePool:x},a!==null&&yc(c,null),Md(),Jg(c),a!==null&&Ba(a,c,p,!0),c.childLanes=v,null}function jc(a,c){return c=Lc({mode:c.mode,children:c.children},a.mode),c.ref=a.ref,a.child=c,c.return=a,c}function Wm(a,c,u){return aa(c,a.child,null,u),a=jc(c,c.pendingProps),a.flags|=2,Rs(c),c.memoizedState=null,a}function p1(a,c,u){var p=c.pendingProps,v=(c.flags&128)!==0;if(c.flags&=-129,a===null){if(Xe){if(p.mode==="hidden")return a=jc(c,p),c.lanes=536870912,sr(null,a);if(kd(c),(a=wt)?(a=c0(a,qs),a=a!==null&&a.data==="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:ui!==null?{id:pn,overflow:gn}:null,retryLane:536870912,hydrationErrors:null},u=jg(a),u.return=c,c.child=u,es=c,wt=null)):a=null,a===null)throw hi(c);return c.lanes=536870912,null}return jc(c,p)}var x=a.memoizedState;if(x!==null){var k=x.dehydrated;if(kd(c),v)if(c.flags&256)c.flags&=-257,c=Wm(a,c,u);else if(c.memoizedState!==null)c.child=a.child,c.flags|=128,c=null;else throw Error(s(558));else if(Ht||Ba(a,c,u,!1),v=(u&a.childLanes)!==0,Ht||v){if(p=pt,p!==null&&(k=zt(p,u),k!==0&&k!==x.retryLane))throw x.retryLane=k,Xi(a,k),vs(p,a,k),Gd;Fc(),c=Wm(a,c,u)}else a=x.treeContext,wt=Bs(k.nextSibling),es=c,Xe=!0,di=null,qs=!1,a!==null&&zg(c,a),c=jc(c,p),c.flags|=4096;return c}return a=On(a.child,{mode:p.mode,children:p.children}),a.ref=c.ref,c.child=a,a.return=c,a}function Pc(a,c){var u=c.ref;if(u===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(s(284));(a===null||a.ref!==u)&&(c.flags|=4194816)}}function Kd(a,c,u,p,v){return ta(c),u=Td(a,c,u,p,void 0,v),p=Ad(),a!==null&&!Ht?(Dd(a,c,v),Fn(a,c,v)):(Xe&&p&&ld(c),c.flags|=1,ss(a,c,u,v),c.child)}function Xm(a,c,u,p,v,x){return ta(c),c.updateQueue=null,u=em(c,p,u,v),Zg(a),p=Ad(),a!==null&&!Ht?(Dd(a,c,x),Fn(a,c,x)):(Xe&&p&&ld(c),c.flags|=1,ss(a,c,u,x),c.child)}function Jm(a,c,u,p,v){if(ta(c),c.stateNode===null){var x=Oa,k=u.contextType;typeof k=="object"&&k!==null&&(x=ts(k)),x=new u(p,x),c.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Vd,c.stateNode=x,x._reactInternals=c,x=c.stateNode,x.props=p,x.state=c.memoizedState,x.refs={},xd(c),k=u.contextType,x.context=typeof k=="object"&&k!==null?ts(k):Oa,x.state=c.memoizedState,k=u.getDerivedStateFromProps,typeof k=="function"&&(Fd(c,u,k,p),x.state=c.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(k=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),k!==x.state&&Vd.enqueueReplaceState(x,x.state,null),Xo(c,p,x,v),Wo(),x.state=c.memoizedState),typeof x.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(a===null){x=c.stateNode;var D=c.memoizedProps,I=ra(u,D);x.props=I;var Q=x.context,se=u.contextType;k=Oa,typeof se=="object"&&se!==null&&(k=ts(se));var re=u.getDerivedStateFromProps;se=typeof re=="function"||typeof x.getSnapshotBeforeUpdate=="function",D=c.pendingProps!==D,se||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(D||Q!==k)&&Om(c,x,p,k),pi=!1;var K=c.memoizedState;x.state=K,Xo(c,p,x,v),Wo(),Q=c.memoizedState,D||K!==Q||pi?(typeof re=="function"&&(Fd(c,u,re,p),Q=c.memoizedState),(I=pi||Im(c,u,I,p,K,Q,k))?(se||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(c.flags|=4194308)):(typeof x.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=Q),x.props=p,x.state=Q,x.context=k,p=I):(typeof x.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{x=c.stateNode,wd(a,c),k=c.memoizedProps,se=ra(u,k),x.props=se,re=c.pendingProps,K=x.context,Q=u.contextType,I=Oa,typeof Q=="object"&&Q!==null&&(I=ts(Q)),D=u.getDerivedStateFromProps,(Q=typeof D=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(k!==re||K!==I)&&Om(c,x,p,I),pi=!1,K=c.memoizedState,x.state=K,Xo(c,p,x,v),Wo();var X=c.memoizedState;k!==re||K!==X||pi||a!==null&&a.dependencies!==null&&gc(a.dependencies)?(typeof D=="function"&&(Fd(c,u,D,p),X=c.memoizedState),(se=pi||Im(c,u,se,p,K,X,I)||a!==null&&a.dependencies!==null&&gc(a.dependencies))?(Q||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(p,X,I),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(p,X,I)),typeof x.componentDidUpdate=="function"&&(c.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof x.componentDidUpdate!="function"||k===a.memoizedProps&&K===a.memoizedState||(c.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&K===a.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=X),x.props=p,x.state=X,x.context=I,p=se):(typeof x.componentDidUpdate!="function"||k===a.memoizedProps&&K===a.memoizedState||(c.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&K===a.memoizedState||(c.flags|=1024),p=!1)}return x=p,Pc(a,c),p=(c.flags&128)!==0,x||p?(x=c.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:x.render(),c.flags|=1,a!==null&&p?(c.child=aa(c,a.child,null,v),c.child=aa(c,null,u,v)):ss(a,c,u,v),c.memoizedState=x.state,a=c.child):a=Fn(a,c,v),a}function Zm(a,c,u,p){return Zi(),c.flags|=256,ss(a,c,u,p),c.child}var Yd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wd(a){return{baseLanes:a,cachePool:Bg()}}function Xd(a,c,u){return a=a!==null?a.childLanes&~u:0,c&&(a|=Es),a}function ey(a,c,u){var p=c.pendingProps,v=!1,x=(c.flags&128)!==0,k;if((k=x)||(k=a!==null&&a.memoizedState===null?!1:(Dt.current&2)!==0),k&&(v=!0,c.flags&=-129),k=(c.flags&32)!==0,c.flags&=-33,a===null){if(Xe){if(v?yi(c):vi(),(a=wt)?(a=c0(a,qs),a=a!==null&&a.data!=="&"?a:null,a!==null&&(c.memoizedState={dehydrated:a,treeContext:ui!==null?{id:pn,overflow:gn}:null,retryLane:536870912,hydrationErrors:null},u=jg(a),u.return=c,c.child=u,es=c,wt=null)):a=null,a===null)throw hi(c);return jh(a)?c.lanes=32:c.lanes=536870912,null}var D=p.children;return p=p.fallback,v?(vi(),v=c.mode,D=Lc({mode:"hidden",children:D},v),p=Ji(p,v,u,null),D.return=c,p.return=c,D.sibling=p,c.child=D,p=c.child,p.memoizedState=Wd(u),p.childLanes=Xd(a,k,u),c.memoizedState=Yd,sr(null,p)):(yi(c),Jd(c,D))}var I=a.memoizedState;if(I!==null&&(D=I.dehydrated,D!==null)){if(x)c.flags&256?(yi(c),c.flags&=-257,c=Zd(a,c,u)):c.memoizedState!==null?(vi(),c.child=a.child,c.flags|=128,c=null):(vi(),D=p.fallback,v=c.mode,p=Lc({mode:"visible",children:p.children},v),D=Ji(D,v,u,null),D.flags|=2,p.return=c,D.return=c,p.sibling=D,c.child=p,aa(c,a.child,null,u),p=c.child,p.memoizedState=Wd(u),p.childLanes=Xd(a,k,u),c.memoizedState=Yd,c=sr(null,p));else if(yi(c),jh(D)){if(k=D.nextSibling&&D.nextSibling.dataset,k)var Q=k.dgst;k=Q,p=Error(s(419)),p.stack="",p.digest=k,Fo({value:p,source:null,stack:null}),c=Zd(a,c,u)}else if(Ht||Ba(a,c,u,!1),k=(u&a.childLanes)!==0,Ht||k){if(k=pt,k!==null&&(p=zt(k,u),p!==0&&p!==I.retryLane))throw I.retryLane=p,Xi(a,p),vs(k,a,p),Gd;Nh(D)||Fc(),c=Zd(a,c,u)}else Nh(D)?(c.flags|=192,c.child=a.child,c=null):(a=I.treeContext,wt=Bs(D.nextSibling),es=c,Xe=!0,di=null,qs=!1,a!==null&&zg(c,a),c=Jd(c,p.children),c.flags|=4096);return c}return v?(vi(),D=p.fallback,v=c.mode,I=a.child,Q=I.sibling,p=On(I,{mode:"hidden",children:p.children}),p.subtreeFlags=I.subtreeFlags&65011712,Q!==null?D=On(Q,D):(D=Ji(D,v,u,null),D.flags|=2),D.return=c,p.return=c,p.sibling=D,c.child=p,sr(null,p),p=c.child,D=a.child.memoizedState,D===null?D=Wd(u):(v=D.cachePool,v!==null?(I=It._currentValue,v=v.parent!==I?{parent:I,pool:I}:v):v=Bg(),D={baseLanes:D.baseLanes|u,cachePool:v}),p.memoizedState=D,p.childLanes=Xd(a,k,u),c.memoizedState=Yd,sr(a.child,p)):(yi(c),u=a.child,a=u.sibling,u=On(u,{mode:"visible",children:p.children}),u.return=c,u.sibling=null,a!==null&&(k=c.deletions,k===null?(c.deletions=[a],c.flags|=16):k.push(a)),c.child=u,c.memoizedState=null,u)}function Jd(a,c){return c=Lc({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function Lc(a,c){return a=Ss(22,a,null,c),a.lanes=0,a}function Zd(a,c,u){return aa(c,a.child,null,u),a=Jd(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function ty(a,c,u){a.lanes|=c;var p=a.alternate;p!==null&&(p.lanes|=c),pd(a.return,c,u)}function eh(a,c,u,p,v,x){var k=a.memoizedState;k===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:v,treeForkCount:x}:(k.isBackwards=c,k.rendering=null,k.renderingStartTime=0,k.last=p,k.tail=u,k.tailMode=v,k.treeForkCount=x)}function sy(a,c,u){var p=c.pendingProps,v=p.revealOrder,x=p.tail;p=p.children;var k=Dt.current,D=(k&2)!==0;if(D?(k=k&1|2,c.flags|=128):k&=1,Y(Dt,k),ss(a,c,p,u),p=Xe?Uo:0,!D&&a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ty(a,u,c);else if(a.tag===19)ty(a,u,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(v){case"forwards":for(u=c.child,v=null;u!==null;)a=u.alternate,a!==null&&Sc(a)===null&&(v=u),u=u.sibling;u=v,u===null?(v=c.child,c.child=null):(v=u.sibling,u.sibling=null),eh(c,!1,v,u,x,p);break;case"backwards":case"unstable_legacy-backwards":for(u=null,v=c.child,c.child=null;v!==null;){if(a=v.alternate,a!==null&&Sc(a)===null){c.child=v;break}a=v.sibling,v.sibling=u,u=v,v=a}eh(c,!0,u,null,x,p);break;case"together":eh(c,!1,null,null,void 0,p);break;default:c.memoizedState=null}return c.child}function Fn(a,c,u){if(a!==null&&(c.dependencies=a.dependencies),wi|=c.lanes,(u&c.childLanes)===0)if(a!==null){if(Ba(a,c,u,!1),(u&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(s(153));if(c.child!==null){for(a=c.child,u=On(a,a.pendingProps),c.child=u,u.return=c;a.sibling!==null;)a=a.sibling,u=u.sibling=On(a,a.pendingProps),u.return=c;u.sibling=null}return c.child}function th(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&gc(a)))}function g1(a,c,u){switch(c.tag){case 3:G(c,c.stateNode.containerInfo),fi(c,It,a.memoizedState.cache),Zi();break;case 27:case 5:me(c);break;case 4:G(c,c.stateNode.containerInfo);break;case 10:fi(c,c.type,c.memoizedProps.value);break;case 31:if(c.memoizedState!==null)return c.flags|=128,kd(c),null;break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(yi(c),c.flags|=128,null):(u&c.child.childLanes)!==0?ey(a,c,u):(yi(c),a=Fn(a,c,u),a!==null?a.sibling:null);yi(c);break;case 19:var v=(a.flags&128)!==0;if(p=(u&c.childLanes)!==0,p||(Ba(a,c,u,!1),p=(u&c.childLanes)!==0),v){if(p)return sy(a,c,u);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),Y(Dt,Dt.current),p)break;return null;case 22:return c.lanes=0,Km(a,c,u,c.pendingProps);case 24:fi(c,It,a.memoizedState.cache)}return Fn(a,c,u)}function ny(a,c,u){if(a!==null)if(a.memoizedProps!==c.pendingProps)Ht=!0;else{if(!th(a,u)&&(c.flags&128)===0)return Ht=!1,g1(a,c,u);Ht=(a.flags&131072)!==0}else Ht=!1,Xe&&(c.flags&1048576)!==0&&Lg(c,Uo,c.index);switch(c.lanes=0,c.tag){case 16:e:{var p=c.pendingProps;if(a=na(c.elementType),c.type=a,typeof a=="function")od(a)?(p=ra(a,p),c.tag=1,c=Jm(null,c,a,p,u)):(c.tag=0,c=Kd(null,c,a,p,u));else{if(a!=null){var v=a.$$typeof;if(v===A){c.tag=11,c=Vm(null,c,a,p,u);break e}else if(v===z){c.tag=14,c=Qm(null,c,a,p,u);break e}}throw c=le(a)||a,Error(s(306,c,""))}}return c;case 0:return Kd(a,c,c.type,c.pendingProps,u);case 1:return p=c.type,v=ra(p,c.pendingProps),Jm(a,c,p,v,u);case 3:e:{if(G(c,c.stateNode.containerInfo),a===null)throw Error(s(387));p=c.pendingProps;var x=c.memoizedState;v=x.element,wd(a,c),Xo(c,p,null,u);var k=c.memoizedState;if(p=k.cache,fi(c,It,p),p!==x.cache&&gd(c,[It],u,!0),Wo(),p=k.element,x.isDehydrated)if(x={element:p,isDehydrated:!1,cache:k.cache},c.updateQueue.baseState=x,c.memoizedState=x,c.flags&256){c=Zm(a,c,p,u);break e}else if(p!==v){v=Is(Error(s(424)),c),Fo(v),c=Zm(a,c,p,u);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(wt=Bs(a.firstChild),es=c,Xe=!0,di=null,qs=!0,u=Kg(c,null,p,u),c.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Zi(),p===v){c=Fn(a,c,u);break e}ss(a,c,p,u)}c=c.child}return c;case 26:return Pc(a,c),a===null?(u=p0(c.type,null,c.pendingProps,null))?c.memoizedState=u:Xe||(u=c.type,a=c.pendingProps,p=Xc(ae.current).createElement(u),p[vt]=c,p[Bt]=a,ns(p,u,a),Yt(p),c.stateNode=p):c.memoizedState=p0(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return me(c),a===null&&Xe&&(p=c.stateNode=d0(c.type,c.pendingProps,ae.current),es=c,qs=!0,v=wt,ki(c.type)?(Ph=v,wt=Bs(p.firstChild)):wt=v),ss(a,c,c.pendingProps.children,u),Pc(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Xe&&((v=p=wt)&&(p=V1(p,c.type,c.pendingProps,qs),p!==null?(c.stateNode=p,es=c,wt=Bs(p.firstChild),qs=!1,v=!0):v=!1),v||hi(c)),me(c),v=c.type,x=c.pendingProps,k=a!==null?a.memoizedProps:null,p=x.children,Ah(v,x)?p=null:k!==null&&Ah(v,k)&&(c.flags|=32),c.memoizedState!==null&&(v=Td(a,c,o1,null,null,u),yr._currentValue=v),Pc(a,c),ss(a,c,p,u),c.child;case 6:return a===null&&Xe&&((a=u=wt)&&(u=Q1(u,c.pendingProps,qs),u!==null?(c.stateNode=u,es=c,wt=null,a=!0):a=!1),a||hi(c)),null;case 13:return ey(a,c,u);case 4:return G(c,c.stateNode.containerInfo),p=c.pendingProps,a===null?c.child=aa(c,null,p,u):ss(a,c,p,u),c.child;case 11:return Vm(a,c,c.type,c.pendingProps,u);case 7:return ss(a,c,c.pendingProps,u),c.child;case 8:return ss(a,c,c.pendingProps.children,u),c.child;case 12:return ss(a,c,c.pendingProps.children,u),c.child;case 10:return p=c.pendingProps,fi(c,c.type,p.value),ss(a,c,p.children,u),c.child;case 9:return v=c.type._context,p=c.pendingProps.children,ta(c),v=ts(v),p=p(v),c.flags|=1,ss(a,c,p,u),c.child;case 14:return Qm(a,c,c.type,c.pendingProps,u);case 15:return Gm(a,c,c.type,c.pendingProps,u);case 19:return sy(a,c,u);case 31:return p1(a,c,u);case 22:return Km(a,c,u,c.pendingProps);case 24:return ta(c),p=ts(It),a===null?(v=vd(),v===null&&(v=pt,x=md(),v.pooledCache=x,x.refCount++,x!==null&&(v.pooledCacheLanes|=u),v=x),c.memoizedState={parent:p,cache:v},xd(c),fi(c,It,v)):((a.lanes&u)!==0&&(wd(a,c),Xo(c,null,null,u),Wo()),v=a.memoizedState,x=c.memoizedState,v.parent!==p?(v={parent:p,cache:p},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),fi(c,It,p)):(p=x.cache,fi(c,It,p),p!==v.cache&&gd(c,[It],u,!0))),ss(a,c,c.pendingProps.children,u),c.child;case 29:throw c.pendingProps}throw Error(s(156,c.tag))}function Vn(a){a.flags|=4}function sh(a,c,u,p,v){if((c=(a.mode&32)!==0)&&(c=!1),c){if(a.flags|=16777216,(v&335544128)===v)if(a.stateNode.complete)a.flags|=8192;else if(Dy())a.flags|=8192;else throw ia=bc,bd}else a.flags&=-16777217}function iy(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!b0(c))if(Dy())a.flags|=8192;else throw ia=bc,bd}function zc(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?ee():536870912,a.lanes|=c,eo|=c)}function nr(a,c){if(!Xe)switch(a.tailMode){case"hidden":c=a.tail;for(var u=null;c!==null;)c.alternate!==null&&(u=c),c=c.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Ct(a){var c=a.alternate!==null&&a.alternate.child===a.child,u=0,p=0;if(c)for(var v=a.child;v!==null;)u|=v.lanes|v.childLanes,p|=v.subtreeFlags&65011712,p|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)u|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=p,a.childLanes=u,c}function m1(a,c,u){var p=c.pendingProps;switch(ud(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ct(c),null;case 1:return Ct(c),null;case 3:return u=c.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),$n(It),pe(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&($a(c)?Vn(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,hd())),Ct(c),null;case 26:var v=c.type,x=c.memoizedState;return a===null?(Vn(c),x!==null?(Ct(c),iy(c,x)):(Ct(c),sh(c,v,null,p,u))):x?x!==a.memoizedState?(Vn(c),Ct(c),iy(c,x)):(Ct(c),c.flags&=-16777217):(a=a.memoizedProps,a!==p&&Vn(c),Ct(c),sh(c,v,a,p,u)),null;case 27:if(ye(c),u=ae.current,v=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&Vn(c);else{if(!p){if(c.stateNode===null)throw Error(s(166));return Ct(c),null}a=ie.current,$a(c)?Ig(c):(a=d0(v,p,u),c.stateNode=a,Vn(c))}return Ct(c),null;case 5:if(ye(c),v=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&Vn(c);else{if(!p){if(c.stateNode===null)throw Error(s(166));return Ct(c),null}if(x=ie.current,$a(c))Ig(c);else{var k=Xc(ae.current);switch(x){case 1:x=k.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:x=k.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":x=k.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":x=k.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":x=k.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof p.is=="string"?k.createElement("select",{is:p.is}):k.createElement("select"),p.multiple?x.multiple=!0:p.size&&(x.size=p.size);break;default:x=typeof p.is=="string"?k.createElement(v,{is:p.is}):k.createElement(v)}}x[vt]=c,x[Bt]=p;e:for(k=c.child;k!==null;){if(k.tag===5||k.tag===6)x.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===c)break e;for(;k.sibling===null;){if(k.return===null||k.return===c)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}c.stateNode=x;e:switch(ns(x,v,p),v){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Vn(c)}}return Ct(c),sh(c,c.type,a===null?null:a.memoizedProps,c.pendingProps,u),null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==p&&Vn(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(s(166));if(a=ae.current,$a(c)){if(a=c.stateNode,u=c.memoizedProps,p=null,v=es,v!==null)switch(v.tag){case 27:case 5:p=v.memoizedProps}a[vt]=c,a=!!(a.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||e0(a.nodeValue,u)),a||hi(c,!0)}else a=Xc(a).createTextNode(p),a[vt]=c,c.stateNode=a}return Ct(c),null;case 31:if(u=c.memoizedState,a===null||a.memoizedState!==null){if(p=$a(c),u!==null){if(a===null){if(!p)throw Error(s(318));if(a=c.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[vt]=c}else Zi(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Ct(c),a=!1}else u=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=u),a=!0;if(!a)return c.flags&256?(Rs(c),c):(Rs(c),null);if((c.flags&128)!==0)throw Error(s(558))}return Ct(c),null;case 13:if(p=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=$a(c),p!==null&&p.dehydrated!==null){if(a===null){if(!v)throw Error(s(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(s(317));v[vt]=c}else Zi(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Ct(c),v=!1}else v=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return c.flags&256?(Rs(c),c):(Rs(c),null)}return Rs(c),(c.flags&128)!==0?(c.lanes=u,c):(u=p!==null,a=a!==null&&a.memoizedState!==null,u&&(p=c.child,v=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(v=p.alternate.memoizedState.cachePool.pool),x=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(x=p.memoizedState.cachePool.pool),x!==v&&(p.flags|=2048)),u!==a&&u&&(c.child.flags|=8192),zc(c,c.updateQueue),Ct(c),null);case 4:return pe(),a===null&&Mh(c.stateNode.containerInfo),Ct(c),null;case 10:return $n(c.type),Ct(c),null;case 19:if(F(Dt),p=c.memoizedState,p===null)return Ct(c),null;if(v=(c.flags&128)!==0,x=p.rendering,x===null)if(v)nr(p,!1);else{if(kt!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(x=Sc(a),x!==null){for(c.flags|=128,nr(p,!1),a=x.updateQueue,c.updateQueue=a,zc(c,a),c.subtreeFlags=0,a=u,u=c.child;u!==null;)Ng(u,a),u=u.sibling;return Y(Dt,Dt.current&1|2),Xe&&Hn(c,p.treeForkCount),c.child}a=a.sibling}p.tail!==null&&Ze()>$c&&(c.flags|=128,v=!0,nr(p,!1),c.lanes=4194304)}else{if(!v)if(a=Sc(x),a!==null){if(c.flags|=128,v=!0,a=a.updateQueue,c.updateQueue=a,zc(c,a),nr(p,!0),p.tail===null&&p.tailMode==="hidden"&&!x.alternate&&!Xe)return Ct(c),null}else 2*Ze()-p.renderingStartTime>$c&&u!==536870912&&(c.flags|=128,v=!0,nr(p,!1),c.lanes=4194304);p.isBackwards?(x.sibling=c.child,c.child=x):(a=p.last,a!==null?a.sibling=x:c.child=x,p.last=x)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=Ze(),a.sibling=null,u=Dt.current,Y(Dt,v?u&1|2:u&1),Xe&&Hn(c,p.treeForkCount),a):(Ct(c),null);case 22:case 23:return Rs(c),Rd(),p=c.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(u&536870912)!==0&&(c.flags&128)===0&&(Ct(c),c.subtreeFlags&6&&(c.flags|=8192)):Ct(c),u=c.updateQueue,u!==null&&zc(c,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==u&&(c.flags|=2048),a!==null&&F(sa),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),c.memoizedState.cache!==u&&(c.flags|=2048),$n(It),Ct(c),null;case 25:return null;case 30:return null}throw Error(s(156,c.tag))}function y1(a,c){switch(ud(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return $n(It),pe(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return ye(c),null;case 31:if(c.memoizedState!==null){if(Rs(c),c.alternate===null)throw Error(s(340));Zi()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 13:if(Rs(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(s(340));Zi()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return F(Dt),null;case 4:return pe(),null;case 10:return $n(c.type),null;case 22:case 23:return Rs(c),Rd(),a!==null&&F(sa),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return $n(It),null;case 25:return null;default:return null}}function ay(a,c){switch(ud(c),c.tag){case 3:$n(It),pe();break;case 26:case 27:case 5:ye(c);break;case 4:pe();break;case 31:c.memoizedState!==null&&Rs(c);break;case 13:Rs(c);break;case 19:F(Dt);break;case 10:$n(c.type);break;case 22:case 23:Rs(c),Rd(),a!==null&&F(sa);break;case 24:$n(It)}}function ir(a,c){try{var u=c.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var v=p.next;u=v;do{if((u.tag&a)===a){p=void 0;var x=u.create,k=u.inst;p=x(),k.destroy=p}u=u.next}while(u!==v)}}catch(D){ct(c,c.return,D)}}function bi(a,c,u){try{var p=c.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var x=v.next;p=x;do{if((p.tag&a)===a){var k=p.inst,D=k.destroy;if(D!==void 0){k.destroy=void 0,v=c;var I=u,Q=D;try{Q()}catch(se){ct(v,I,se)}}}p=p.next}while(p!==x)}}catch(se){ct(c,c.return,se)}}function oy(a){var c=a.updateQueue;if(c!==null){var u=a.stateNode;try{Wg(c,u)}catch(p){ct(a,a.return,p)}}}function ry(a,c,u){u.props=ra(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(p){ct(a,c,p)}}function ar(a,c){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof u=="function"?a.refCleanup=u(p):u.current=p}}catch(v){ct(a,c,v)}}function mn(a,c){var u=a.ref,p=a.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(v){ct(a,c,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(v){ct(a,c,v)}else u.current=null}function cy(a){var c=a.type,u=a.memoizedProps,p=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(v){ct(a,a.return,v)}}function nh(a,c,u){try{var p=a.stateNode;H1(p,a.type,u,c),p[Bt]=c}catch(v){ct(a,a.return,v)}}function ly(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&ki(a.type)||a.tag===4}function ih(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||ly(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&ki(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ah(a,c,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,c):(c=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,c.appendChild(a),u=u._reactRootContainer,u!=null||c.onclick!==null||(c.onclick=zn));else if(p!==4&&(p===27&&ki(a.type)&&(u=a.stateNode,c=null),a=a.child,a!==null))for(ah(a,c,u),a=a.sibling;a!==null;)ah(a,c,u),a=a.sibling}function Ic(a,c,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?u.insertBefore(a,c):u.appendChild(a);else if(p!==4&&(p===27&&ki(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(Ic(a,c,u),a=a.sibling;a!==null;)Ic(a,c,u),a=a.sibling}function uy(a){var c=a.stateNode,u=a.memoizedProps;try{for(var p=a.type,v=c.attributes;v.length;)c.removeAttributeNode(v[0]);ns(c,p,u),c[vt]=a,c[Bt]=u}catch(x){ct(a,a.return,x)}}var Qn=!1,qt=!1,oh=!1,dy=typeof WeakSet=="function"?WeakSet:Set,Wt=null;function v1(a,c){if(a=a.containerInfo,Eh=il,a=Sg(a),Zu(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var v=p.anchorOffset,x=p.focusNode;p=p.focusOffset;try{u.nodeType,x.nodeType}catch{u=null;break e}var k=0,D=-1,I=-1,Q=0,se=0,re=a,K=null;t:for(;;){for(var X;re!==u||v!==0&&re.nodeType!==3||(D=k+v),re!==x||p!==0&&re.nodeType!==3||(I=k+p),re.nodeType===3&&(k+=re.nodeValue.length),(X=re.firstChild)!==null;)K=re,re=X;for(;;){if(re===a)break t;if(K===u&&++Q===v&&(D=k),K===x&&++se===p&&(I=k),(X=re.nextSibling)!==null)break;re=K,K=re.parentNode}re=X}u=D===-1||I===-1?null:{start:D,end:I}}else u=null}u=u||{start:0,end:0}}else u=null;for(Th={focusedElem:a,selectionRange:u},il=!1,Wt=c;Wt!==null;)if(c=Wt,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,Wt=a;else for(;Wt!==null;){switch(c=Wt,x=c.alternate,a=c.flags,c.tag){case 0:if((a&4)!==0&&(a=c.updateQueue,a=a!==null?a.events:null,a!==null))for(u=0;u<a.length;u++)v=a[u],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&x!==null){a=void 0,u=c,v=x.memoizedProps,x=x.memoizedState,p=u.stateNode;try{var xe=ra(u.type,v);a=p.getSnapshotBeforeUpdate(xe,x),p.__reactInternalSnapshotBeforeUpdate=a}catch(Ne){ct(u,u.return,Ne)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,u=a.nodeType,u===9)_h(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":_h(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=c.sibling,a!==null){a.return=c.return,Wt=a;break}Wt=c.return}}function hy(a,c,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:Kn(a,u),p&4&&ir(5,u);break;case 1:if(Kn(a,u),p&4)if(a=u.stateNode,c===null)try{a.componentDidMount()}catch(k){ct(u,u.return,k)}else{var v=ra(u.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(v,c,a.__reactInternalSnapshotBeforeUpdate)}catch(k){ct(u,u.return,k)}}p&64&&oy(u),p&512&&ar(u,u.return);break;case 3:if(Kn(a,u),p&64&&(a=u.updateQueue,a!==null)){if(c=null,u.child!==null)switch(u.child.tag){case 27:case 5:c=u.child.stateNode;break;case 1:c=u.child.stateNode}try{Wg(a,c)}catch(k){ct(u,u.return,k)}}break;case 27:c===null&&p&4&&uy(u);case 26:case 5:Kn(a,u),c===null&&p&4&&cy(u),p&512&&ar(u,u.return);break;case 12:Kn(a,u);break;case 31:Kn(a,u),p&4&&gy(a,u);break;case 13:Kn(a,u),p&4&&my(a,u),p&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=E1.bind(null,u),G1(a,u))));break;case 22:if(p=u.memoizedState!==null||Qn,!p){c=c!==null&&c.memoizedState!==null||qt,v=Qn;var x=qt;Qn=p,(qt=c)&&!x?Yn(a,u,(u.subtreeFlags&8772)!==0):Kn(a,u),Qn=v,qt=x}break;case 30:break;default:Kn(a,u)}}function fy(a){var c=a.alternate;c!==null&&(a.alternate=null,fy(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&zu(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Mt=null,ps=!1;function Gn(a,c,u){for(u=u.child;u!==null;)py(a,c,u),u=u.sibling}function py(a,c,u){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(hn,u)}catch{}switch(u.tag){case 26:qt||mn(u,c),Gn(a,c,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:qt||mn(u,c);var p=Mt,v=ps;ki(u.type)&&(Mt=u.stateNode,ps=!1),Gn(a,c,u),pr(u.stateNode),Mt=p,ps=v;break;case 5:qt||mn(u,c);case 6:if(p=Mt,v=ps,Mt=null,Gn(a,c,u),Mt=p,ps=v,Mt!==null)if(ps)try{(Mt.nodeType===9?Mt.body:Mt.nodeName==="HTML"?Mt.ownerDocument.body:Mt).removeChild(u.stateNode)}catch(x){ct(u,c,x)}else try{Mt.removeChild(u.stateNode)}catch(x){ct(u,c,x)}break;case 18:Mt!==null&&(ps?(a=Mt,o0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),co(a)):o0(Mt,u.stateNode));break;case 4:p=Mt,v=ps,Mt=u.stateNode.containerInfo,ps=!0,Gn(a,c,u),Mt=p,ps=v;break;case 0:case 11:case 14:case 15:bi(2,u,c),qt||bi(4,u,c),Gn(a,c,u);break;case 1:qt||(mn(u,c),p=u.stateNode,typeof p.componentWillUnmount=="function"&&ry(u,c,p)),Gn(a,c,u);break;case 21:Gn(a,c,u);break;case 22:qt=(p=qt)||u.memoizedState!==null,Gn(a,c,u),qt=p;break;default:Gn(a,c,u)}}function gy(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{co(a)}catch(u){ct(c,c.return,u)}}}function my(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{co(a)}catch(u){ct(c,c.return,u)}}function b1(a){switch(a.tag){case 31:case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new dy),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new dy),c;default:throw Error(s(435,a.tag))}}function Oc(a,c){var u=b1(a);c.forEach(function(p){if(!u.has(p)){u.add(p);var v=T1.bind(null,a,p);p.then(v,v)}})}function gs(a,c){var u=c.deletions;if(u!==null)for(var p=0;p<u.length;p++){var v=u[p],x=a,k=c,D=k;e:for(;D!==null;){switch(D.tag){case 27:if(ki(D.type)){Mt=D.stateNode,ps=!1;break e}break;case 5:Mt=D.stateNode,ps=!1;break e;case 3:case 4:Mt=D.stateNode.containerInfo,ps=!0;break e}D=D.return}if(Mt===null)throw Error(s(160));py(x,k,v),Mt=null,ps=!1,x=v.alternate,x!==null&&(x.return=null),v.return=null}if(c.subtreeFlags&13886)for(c=c.child;c!==null;)yy(c,a),c=c.sibling}var Zs=null;function yy(a,c){var u=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:gs(c,a),ms(a),p&4&&(bi(3,a,a.return),ir(3,a),bi(5,a,a.return));break;case 1:gs(c,a),ms(a),p&512&&(qt||u===null||mn(u,u.return)),p&64&&Qn&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var v=Zs;if(gs(c,a),ms(a),p&512&&(qt||u===null||mn(u,u.return)),p&4){var x=u!==null?u.memoizedState:null;if(p=a.memoizedState,u===null)if(p===null)if(a.stateNode===null){e:{p=a.type,u=a.memoizedProps,v=v.ownerDocument||v;t:switch(p){case"title":x=v.getElementsByTagName("title")[0],(!x||x[No]||x[vt]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=v.createElement(p),v.head.insertBefore(x,v.querySelector("head > title"))),ns(x,p,u),x[vt]=a,Yt(x),p=x;break e;case"link":var k=y0("link","href",v).get(p+(u.href||""));if(k){for(var D=0;D<k.length;D++)if(x=k[D],x.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&x.getAttribute("rel")===(u.rel==null?null:u.rel)&&x.getAttribute("title")===(u.title==null?null:u.title)&&x.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){k.splice(D,1);break t}}x=v.createElement(p),ns(x,p,u),v.head.appendChild(x);break;case"meta":if(k=y0("meta","content",v).get(p+(u.content||""))){for(D=0;D<k.length;D++)if(x=k[D],x.getAttribute("content")===(u.content==null?null:""+u.content)&&x.getAttribute("name")===(u.name==null?null:u.name)&&x.getAttribute("property")===(u.property==null?null:u.property)&&x.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&x.getAttribute("charset")===(u.charSet==null?null:u.charSet)){k.splice(D,1);break t}}x=v.createElement(p),ns(x,p,u),v.head.appendChild(x);break;default:throw Error(s(468,p))}x[vt]=a,Yt(x),p=x}a.stateNode=p}else v0(v,a.type,a.stateNode);else a.stateNode=m0(v,p,a.memoizedProps);else x!==p?(x===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):x.count--,p===null?v0(v,a.type,a.stateNode):m0(v,p,a.memoizedProps)):p===null&&a.stateNode!==null&&nh(a,a.memoizedProps,u.memoizedProps)}break;case 27:gs(c,a),ms(a),p&512&&(qt||u===null||mn(u,u.return)),u!==null&&p&4&&nh(a,a.memoizedProps,u.memoizedProps);break;case 5:if(gs(c,a),ms(a),p&512&&(qt||u===null||mn(u,u.return)),a.flags&32){v=a.stateNode;try{_a(v,"")}catch(xe){ct(a,a.return,xe)}}p&4&&a.stateNode!=null&&(v=a.memoizedProps,nh(a,v,u!==null?u.memoizedProps:v)),p&1024&&(oh=!0);break;case 6:if(gs(c,a),ms(a),p&4){if(a.stateNode===null)throw Error(s(162));p=a.memoizedProps,u=a.stateNode;try{u.nodeValue=p}catch(xe){ct(a,a.return,xe)}}break;case 3:if(el=null,v=Zs,Zs=Jc(c.containerInfo),gs(c,a),Zs=v,ms(a),p&4&&u!==null&&u.memoizedState.isDehydrated)try{co(c.containerInfo)}catch(xe){ct(a,a.return,xe)}oh&&(oh=!1,vy(a));break;case 4:p=Zs,Zs=Jc(a.stateNode.containerInfo),gs(c,a),ms(a),Zs=p;break;case 12:gs(c,a),ms(a);break;case 31:gs(c,a),ms(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Oc(a,p)));break;case 13:gs(c,a),ms(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(qc=Ze()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Oc(a,p)));break;case 22:v=a.memoizedState!==null;var I=u!==null&&u.memoizedState!==null,Q=Qn,se=qt;if(Qn=Q||v,qt=se||I,gs(c,a),qt=se,Qn=Q,ms(a),p&8192)e:for(c=a.stateNode,c._visibility=v?c._visibility&-2:c._visibility|1,v&&(u===null||I||Qn||qt||ca(a)),u=null,c=a;;){if(c.tag===5||c.tag===26){if(u===null){I=u=c;try{if(x=I.stateNode,v)k=x.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{D=I.stateNode;var re=I.memoizedProps.style,K=re!=null&&re.hasOwnProperty("display")?re.display:null;D.style.display=K==null||typeof K=="boolean"?"":(""+K).trim()}}catch(xe){ct(I,I.return,xe)}}}else if(c.tag===6){if(u===null){I=c;try{I.stateNode.nodeValue=v?"":I.memoizedProps}catch(xe){ct(I,I.return,xe)}}}else if(c.tag===18){if(u===null){I=c;try{var X=I.stateNode;v?r0(X,!0):r0(I.stateNode,!1)}catch(xe){ct(I,I.return,xe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;u===c&&(u=null),c=c.return}u===c&&(u=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=a.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,Oc(a,u))));break;case 19:gs(c,a),ms(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Oc(a,p)));break;case 30:break;case 21:break;default:gs(c,a),ms(a)}}function ms(a){var c=a.flags;if(c&2){try{for(var u,p=a.return;p!==null;){if(ly(p)){u=p;break}p=p.return}if(u==null)throw Error(s(160));switch(u.tag){case 27:var v=u.stateNode,x=ih(a);Ic(a,x,v);break;case 5:var k=u.stateNode;u.flags&32&&(_a(k,""),u.flags&=-33);var D=ih(a);Ic(a,D,k);break;case 3:case 4:var I=u.stateNode.containerInfo,Q=ih(a);ah(a,Q,I);break;default:throw Error(s(161))}}catch(se){ct(a,a.return,se)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function vy(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;vy(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Kn(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)hy(a,c.alternate,c),c=c.sibling}function ca(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:bi(4,c,c.return),ca(c);break;case 1:mn(c,c.return);var u=c.stateNode;typeof u.componentWillUnmount=="function"&&ry(c,c.return,u),ca(c);break;case 27:pr(c.stateNode);case 26:case 5:mn(c,c.return),ca(c);break;case 22:c.memoizedState===null&&ca(c);break;case 30:ca(c);break;default:ca(c)}a=a.sibling}}function Yn(a,c,u){for(u=u&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,v=a,x=c,k=x.flags;switch(x.tag){case 0:case 11:case 15:Yn(v,x,u),ir(4,x);break;case 1:if(Yn(v,x,u),p=x,v=p.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(Q){ct(p,p.return,Q)}if(p=x,v=p.updateQueue,v!==null){var D=p.stateNode;try{var I=v.shared.hiddenCallbacks;if(I!==null)for(v.shared.hiddenCallbacks=null,v=0;v<I.length;v++)Yg(I[v],D)}catch(Q){ct(p,p.return,Q)}}u&&k&64&&oy(x),ar(x,x.return);break;case 27:uy(x);case 26:case 5:Yn(v,x,u),u&&p===null&&k&4&&cy(x),ar(x,x.return);break;case 12:Yn(v,x,u);break;case 31:Yn(v,x,u),u&&k&4&&gy(v,x);break;case 13:Yn(v,x,u),u&&k&4&&my(v,x);break;case 22:x.memoizedState===null&&Yn(v,x,u),ar(x,x.return);break;case 30:break;default:Yn(v,x,u)}c=c.sibling}}function rh(a,c){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&Vo(u))}function ch(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Vo(a))}function en(a,c,u,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)by(a,c,u,p),c=c.sibling}function by(a,c,u,p){var v=c.flags;switch(c.tag){case 0:case 11:case 15:en(a,c,u,p),v&2048&&ir(9,c);break;case 1:en(a,c,u,p);break;case 3:en(a,c,u,p),v&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Vo(a)));break;case 12:if(v&2048){en(a,c,u,p),a=c.stateNode;try{var x=c.memoizedProps,k=x.id,D=x.onPostCommit;typeof D=="function"&&D(k,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(I){ct(c,c.return,I)}}else en(a,c,u,p);break;case 31:en(a,c,u,p);break;case 13:en(a,c,u,p);break;case 23:break;case 22:x=c.stateNode,k=c.alternate,c.memoizedState!==null?x._visibility&2?en(a,c,u,p):or(a,c):x._visibility&2?en(a,c,u,p):(x._visibility|=2,Xa(a,c,u,p,(c.subtreeFlags&10256)!==0||!1)),v&2048&&rh(k,c);break;case 24:en(a,c,u,p),v&2048&&ch(c.alternate,c);break;default:en(a,c,u,p)}}function Xa(a,c,u,p,v){for(v=v&&((c.subtreeFlags&10256)!==0||!1),c=c.child;c!==null;){var x=a,k=c,D=u,I=p,Q=k.flags;switch(k.tag){case 0:case 11:case 15:Xa(x,k,D,I,v),ir(8,k);break;case 23:break;case 22:var se=k.stateNode;k.memoizedState!==null?se._visibility&2?Xa(x,k,D,I,v):or(x,k):(se._visibility|=2,Xa(x,k,D,I,v)),v&&Q&2048&&rh(k.alternate,k);break;case 24:Xa(x,k,D,I,v),v&&Q&2048&&ch(k.alternate,k);break;default:Xa(x,k,D,I,v)}c=c.sibling}}function or(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var u=a,p=c,v=p.flags;switch(p.tag){case 22:or(u,p),v&2048&&rh(p.alternate,p);break;case 24:or(u,p),v&2048&&ch(p.alternate,p);break;default:or(u,p)}c=c.sibling}}var rr=8192;function Ja(a,c,u){if(a.subtreeFlags&rr)for(a=a.child;a!==null;)xy(a,c,u),a=a.sibling}function xy(a,c,u){switch(a.tag){case 26:Ja(a,c,u),a.flags&rr&&a.memoizedState!==null&&aR(u,Zs,a.memoizedState,a.memoizedProps);break;case 5:Ja(a,c,u);break;case 3:case 4:var p=Zs;Zs=Jc(a.stateNode.containerInfo),Ja(a,c,u),Zs=p;break;case 22:a.memoizedState===null&&(p=a.alternate,p!==null&&p.memoizedState!==null?(p=rr,rr=16777216,Ja(a,c,u),rr=p):Ja(a,c,u));break;default:Ja(a,c,u)}}function wy(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function cr(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var u=0;u<c.length;u++){var p=c[u];Wt=p,Sy(p,a)}wy(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Cy(a),a=a.sibling}function Cy(a){switch(a.tag){case 0:case 11:case 15:cr(a),a.flags&2048&&bi(9,a,a.return);break;case 3:cr(a);break;case 12:cr(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Hc(a)):cr(a);break;default:cr(a)}}function Hc(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var u=0;u<c.length;u++){var p=c[u];Wt=p,Sy(p,a)}wy(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:bi(8,c,c.return),Hc(c);break;case 22:u=c.stateNode,u._visibility&2&&(u._visibility&=-3,Hc(c));break;default:Hc(c)}a=a.sibling}}function Sy(a,c){for(;Wt!==null;){var u=Wt;switch(u.tag){case 0:case 11:case 15:bi(8,u,c);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Vo(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,Wt=p;else e:for(u=a;Wt!==null;){p=Wt;var v=p.sibling,x=p.return;if(fy(p),p===u){Wt=null;break e}if(v!==null){v.return=x,Wt=v;break e}Wt=x}}}var x1={getCacheForType:function(a){var c=ts(It),u=c.data.get(a);return u===void 0&&(u=a(),c.data.set(a,u)),u},cacheSignal:function(){return ts(It).controller.signal}},w1=typeof WeakMap=="function"?WeakMap:Map,st=0,pt=null,Ve=null,Ge=0,rt=0,ks=null,xi=!1,Za=!1,lh=!1,Wn=0,kt=0,wi=0,la=0,uh=0,Es=0,eo=0,lr=null,ys=null,dh=!1,qc=0,My=0,$c=1/0,Bc=null,Ci=null,Ut=0,Si=null,to=null,Xn=0,hh=0,fh=null,Ry=null,ur=0,ph=null;function Ts(){return(st&2)!==0&&Ge!==0?Ge&-Ge:L.T!==null?xh():ls()}function ky(){if(Es===0)if((Ge&536870912)===0||Xe){var a=Vi;Vi<<=1,(Vi&3932160)===0&&(Vi=262144),Es=a}else Es=536870912;return a=Ms.current,a!==null&&(a.flags|=32),Es}function vs(a,c,u){(a===pt&&(rt===2||rt===9)||a.cancelPendingCommit!==null)&&(so(a,0),Mi(a,Ge,Es,!1)),be(a,u),((st&2)===0||a!==pt)&&(a===pt&&((st&2)===0&&(la|=u),kt===4&&Mi(a,Ge,Es,!1)),yn(a))}function Ey(a,c,u){if((st&6)!==0)throw Error(s(327));var p=!u&&(c&127)===0&&(c&a.expiredLanes)===0||Pn(a,c),v=p?M1(a,c):mh(a,c,!0),x=p;do{if(v===0){Za&&!p&&Mi(a,c,0,!1);break}else{if(u=a.current.alternate,x&&!C1(u)){v=mh(a,c,!1),x=!1;continue}if(v===2){if(x=c,a.errorRecoveryDisabledLanes&x)var k=0;else k=a.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){c=k;e:{var D=a;v=lr;var I=D.current.memoizedState.isDehydrated;if(I&&(so(D,k).flags|=256),k=mh(D,k,!1),k!==2){if(lh&&!I){D.errorRecoveryDisabledLanes|=x,la|=x,v=4;break e}x=ys,ys=v,x!==null&&(ys===null?ys=x:ys.push.apply(ys,x))}v=k}if(x=!1,v!==2)continue}}if(v===1){so(a,0),Mi(a,c,0,!0);break}e:{switch(p=a,x=v,x){case 0:case 1:throw Error(s(345));case 4:if((c&4194048)!==c)break;case 6:Mi(p,c,Es,!xi);break e;case 2:ys=null;break;case 3:case 5:break;default:throw Error(s(329))}if((c&62914560)===c&&(v=qc+300-Ze(),10<v)){if(Mi(p,c,Es,!xi),jn(p,0,!0)!==0)break e;Xn=c,p.timeoutHandle=i0(Ty.bind(null,p,u,ys,Bc,dh,c,Es,la,eo,xi,x,"Throttled",-0,0),v);break e}Ty(p,u,ys,Bc,dh,c,Es,la,eo,xi,x,null,-0,0)}}break}while(!0);yn(a)}function Ty(a,c,u,p,v,x,k,D,I,Q,se,re,K,X){if(a.timeoutHandle=-1,re=c.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zn},xy(c,x,re);var xe=(x&62914560)===x?qc-Ze():(x&4194048)===x?My-Ze():0;if(xe=oR(re,xe),xe!==null){Xn=x,a.cancelPendingCommit=xe(zy.bind(null,a,c,x,u,p,v,k,D,I,se,re,null,K,X)),Mi(a,x,k,!Q);return}}zy(a,c,x,u,p,v,k,D,I)}function C1(a){for(var c=a;;){var u=c.tag;if((u===0||u===11||u===15)&&c.flags&16384&&(u=c.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var v=u[p],x=v.getSnapshot;v=v.value;try{if(!Cs(x(),v))return!1}catch{return!1}}if(u=c.child,c.subtreeFlags&16384&&u!==null)u.return=c,c=u;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Mi(a,c,u,p){c&=~uh,c&=~la,a.suspendedLanes|=c,a.pingedLanes&=~c,p&&(a.warmLanes|=c),p=a.expirationTimes;for(var v=c;0<v;){var x=31-Lt(v),k=1<<x;p[x]=-1,v&=~k}u!==0&&Ie(a,u,c)}function Uc(){return(st&6)===0?(dr(0),!1):!0}function gh(){if(Ve!==null){if(rt===0)var a=Ve.return;else a=Ve,qn=ea=null,_d(a),Qa=null,Go=0,a=Ve;for(;a!==null;)ay(a.alternate,a),a=a.return;Ve=null}}function so(a,c){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,B1(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Xn=0,gh(),pt=a,Ve=u=On(a.current,null),Ge=c,rt=0,ks=null,xi=!1,Za=Pn(a,c),lh=!1,eo=Es=uh=la=wi=kt=0,ys=lr=null,dh=!1,(c&8)!==0&&(c|=c&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=c;0<p;){var v=31-Lt(p),x=1<<v;c|=a[v],p&=~x}return Wn=c,uc(),u}function Ay(a,c){Oe=null,L.H=tr,c===Va||c===vc?(c=Vg(),rt=3):c===bd?(c=Vg(),rt=4):rt=c===Gd?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,ks=c,Ve===null&&(kt=1,Nc(a,Is(c,a.current)))}function Dy(){var a=Ms.current;return a===null?!0:(Ge&4194048)===Ge?$s===null:(Ge&62914560)===Ge||(Ge&536870912)!==0?a===$s:!1}function _y(){var a=L.H;return L.H=tr,a===null?tr:a}function Ny(){var a=L.A;return L.A=x1,a}function Fc(){kt=4,xi||(Ge&4194048)!==Ge&&Ms.current!==null||(Za=!0),(wi&134217727)===0&&(la&134217727)===0||pt===null||Mi(pt,Ge,Es,!1)}function mh(a,c,u){var p=st;st|=2;var v=_y(),x=Ny();(pt!==a||Ge!==c)&&(Bc=null,so(a,c)),c=!1;var k=kt;e:do try{if(rt!==0&&Ve!==null){var D=Ve,I=ks;switch(rt){case 8:gh(),k=6;break e;case 3:case 2:case 9:case 6:Ms.current===null&&(c=!0);var Q=rt;if(rt=0,ks=null,no(a,D,I,Q),u&&Za){k=0;break e}break;default:Q=rt,rt=0,ks=null,no(a,D,I,Q)}}S1(),k=kt;break}catch(se){Ay(a,se)}while(!0);return c&&a.shellSuspendCounter++,qn=ea=null,st=p,L.H=v,L.A=x,Ve===null&&(pt=null,Ge=0,uc()),k}function S1(){for(;Ve!==null;)jy(Ve)}function M1(a,c){var u=st;st|=2;var p=_y(),v=Ny();pt!==a||Ge!==c?(Bc=null,$c=Ze()+500,so(a,c)):Za=Pn(a,c);e:do try{if(rt!==0&&Ve!==null){c=Ve;var x=ks;t:switch(rt){case 1:rt=0,ks=null,no(a,c,x,1);break;case 2:case 9:if(Ug(x)){rt=0,ks=null,Py(c);break}c=function(){rt!==2&&rt!==9||pt!==a||(rt=7),yn(a)},x.then(c,c);break e;case 3:rt=7;break e;case 4:rt=5;break e;case 7:Ug(x)?(rt=0,ks=null,Py(c)):(rt=0,ks=null,no(a,c,x,7));break;case 5:var k=null;switch(Ve.tag){case 26:k=Ve.memoizedState;case 5:case 27:var D=Ve;if(k?b0(k):D.stateNode.complete){rt=0,ks=null;var I=D.sibling;if(I!==null)Ve=I;else{var Q=D.return;Q!==null?(Ve=Q,Vc(Q)):Ve=null}break t}}rt=0,ks=null,no(a,c,x,5);break;case 6:rt=0,ks=null,no(a,c,x,6);break;case 8:gh(),kt=6;break e;default:throw Error(s(462))}}R1();break}catch(se){Ay(a,se)}while(!0);return qn=ea=null,L.H=p,L.A=v,st=u,Ve!==null?0:(pt=null,Ge=0,uc(),kt)}function R1(){for(;Ve!==null&&!mt();)jy(Ve)}function jy(a){var c=ny(a.alternate,a,Wn);a.memoizedProps=a.pendingProps,c===null?Vc(a):Ve=c}function Py(a){var c=a,u=c.alternate;switch(c.tag){case 15:case 0:c=Xm(u,c,c.pendingProps,c.type,void 0,Ge);break;case 11:c=Xm(u,c,c.pendingProps,c.type.render,c.ref,Ge);break;case 5:_d(c);default:ay(u,c),c=Ve=Ng(c,Wn),c=ny(u,c,Wn)}a.memoizedProps=a.pendingProps,c===null?Vc(a):Ve=c}function no(a,c,u,p){qn=ea=null,_d(c),Qa=null,Go=0;var v=c.return;try{if(f1(a,v,c,u,Ge)){kt=1,Nc(a,Is(u,a.current)),Ve=null;return}}catch(x){if(v!==null)throw Ve=v,x;kt=1,Nc(a,Is(u,a.current)),Ve=null;return}c.flags&32768?(Xe||p===1?a=!0:Za||(Ge&536870912)!==0?a=!1:(xi=a=!0,(p===2||p===9||p===3||p===6)&&(p=Ms.current,p!==null&&p.tag===13&&(p.flags|=16384))),Ly(c,a)):Vc(c)}function Vc(a){var c=a;do{if((c.flags&32768)!==0){Ly(c,xi);return}a=c.return;var u=m1(c.alternate,c,Wn);if(u!==null){Ve=u;return}if(c=c.sibling,c!==null){Ve=c;return}Ve=c=a}while(c!==null);kt===0&&(kt=5)}function Ly(a,c){do{var u=y1(a.alternate,a);if(u!==null){u.flags&=32767,Ve=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!c&&(a=a.sibling,a!==null)){Ve=a;return}Ve=a=u}while(a!==null);kt=6,Ve=null}function zy(a,c,u,p,v,x,k,D,I){a.cancelPendingCommit=null;do Qc();while(Ut!==0);if((st&6)!==0)throw Error(s(327));if(c!==null){if(c===a.current)throw Error(s(177));if(x=c.lanes|c.childLanes,x|=id,Le(a,u,x,k,D,I),a===pt&&(Ve=pt=null,Ge=0),to=c,Si=a,Xn=u,hh=x,fh=v,Ry=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,A1(Xt,function(){return $y(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=L.T,L.T=null,v=j.p,j.p=2,k=st,st|=4;try{v1(a,c,u)}finally{st=k,j.p=v,L.T=p}}Ut=1,Iy(),Oy(),Hy()}}function Iy(){if(Ut===1){Ut=0;var a=Si,c=to,u=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||u){u=L.T,L.T=null;var p=j.p;j.p=2;var v=st;st|=4;try{yy(c,a);var x=Th,k=Sg(a.containerInfo),D=x.focusedElem,I=x.selectionRange;if(k!==D&&D&&D.ownerDocument&&Cg(D.ownerDocument.documentElement,D)){if(I!==null&&Zu(D)){var Q=I.start,se=I.end;if(se===void 0&&(se=Q),"selectionStart"in D)D.selectionStart=Q,D.selectionEnd=Math.min(se,D.value.length);else{var re=D.ownerDocument||document,K=re&&re.defaultView||window;if(K.getSelection){var X=K.getSelection(),xe=D.textContent.length,Ne=Math.min(I.start,xe),ht=I.end===void 0?Ne:Math.min(I.end,xe);!X.extend&&Ne>ht&&(k=ht,ht=Ne,Ne=k);var $=wg(D,Ne),H=wg(D,ht);if($&&H&&(X.rangeCount!==1||X.anchorNode!==$.node||X.anchorOffset!==$.offset||X.focusNode!==H.node||X.focusOffset!==H.offset)){var V=re.createRange();V.setStart($.node,$.offset),X.removeAllRanges(),Ne>ht?(X.addRange(V),X.extend(H.node,H.offset)):(V.setEnd(H.node,H.offset),X.addRange(V))}}}}for(re=[],X=D;X=X.parentNode;)X.nodeType===1&&re.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<re.length;D++){var oe=re[D];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}il=!!Eh,Th=Eh=null}finally{st=v,j.p=p,L.T=u}}a.current=c,Ut=2}}function Oy(){if(Ut===2){Ut=0;var a=Si,c=to,u=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||u){u=L.T,L.T=null;var p=j.p;j.p=2;var v=st;st|=4;try{hy(a,c.alternate,c)}finally{st=v,j.p=p,L.T=u}}Ut=3}}function Hy(){if(Ut===4||Ut===3){Ut=0,$t();var a=Si,c=to,u=Xn,p=Ry;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Ut=5:(Ut=0,to=Si=null,qy(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(Ci=null),At(u),c=c.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(hn,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=L.T,v=j.p,j.p=2,L.T=null;try{for(var x=a.onRecoverableError,k=0;k<p.length;k++){var D=p[k];x(D.value,{componentStack:D.stack})}}finally{L.T=c,j.p=v}}(Xn&3)!==0&&Qc(),yn(a),v=a.pendingLanes,(u&261930)!==0&&(v&42)!==0?a===ph?ur++:(ur=0,ph=a):ur=0,dr(0)}}function qy(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,Vo(c)))}function Qc(){return Iy(),Oy(),Hy(),$y()}function $y(){if(Ut!==5)return!1;var a=Si,c=hh;hh=0;var u=At(Xn),p=L.T,v=j.p;try{j.p=32>u?32:u,L.T=null,u=fh,fh=null;var x=Si,k=Xn;if(Ut=0,to=Si=null,Xn=0,(st&6)!==0)throw Error(s(331));var D=st;if(st|=4,Cy(x.current),by(x,x.current,k,u),st=D,dr(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(hn,x)}catch{}return!0}finally{j.p=v,L.T=p,qy(a,c)}}function By(a,c,u){c=Is(u,c),c=Qd(a.stateNode,c,2),a=mi(a,c,2),a!==null&&(be(a,2),yn(a))}function ct(a,c,u){if(a.tag===3)By(a,a,u);else for(;c!==null;){if(c.tag===3){By(c,a,u);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Ci===null||!Ci.has(p))){a=Is(u,a),u=Um(2),p=mi(c,u,2),p!==null&&(Fm(u,p,c,a),be(p,2),yn(p));break}}c=c.return}}function yh(a,c,u){var p=a.pingCache;if(p===null){p=a.pingCache=new w1;var v=new Set;p.set(c,v)}else v=p.get(c),v===void 0&&(v=new Set,p.set(c,v));v.has(u)||(lh=!0,v.add(u),a=k1.bind(null,a,c,u),c.then(a,a))}function k1(a,c,u){var p=a.pingCache;p!==null&&p.delete(c),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,pt===a&&(Ge&u)===u&&(kt===4||kt===3&&(Ge&62914560)===Ge&&300>Ze()-qc?(st&2)===0&&so(a,0):uh|=u,eo===Ge&&(eo=0)),yn(a)}function Uy(a,c){c===0&&(c=ee()),a=Xi(a,c),a!==null&&(be(a,c),yn(a))}function E1(a){var c=a.memoizedState,u=0;c!==null&&(u=c.retryLane),Uy(a,u)}function T1(a,c){var u=0;switch(a.tag){case 31:case 13:var p=a.stateNode,v=a.memoizedState;v!==null&&(u=v.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(s(314))}p!==null&&p.delete(c),Uy(a,u)}function A1(a,c){return Ue(a,c)}var Gc=null,io=null,vh=!1,Kc=!1,bh=!1,Ri=0;function yn(a){a!==io&&a.next===null&&(io===null?Gc=io=a:io=io.next=a),Kc=!0,vh||(vh=!0,_1())}function dr(a,c){if(!bh&&Kc){bh=!0;do for(var u=!1,p=Gc;p!==null;){if(a!==0){var v=p.pendingLanes;if(v===0)var x=0;else{var k=p.suspendedLanes,D=p.pingedLanes;x=(1<<31-Lt(42|a)+1)-1,x&=v&~(k&~D),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(u=!0,Gy(p,x))}else x=Ge,x=jn(p,p===pt?x:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(x&3)===0||Pn(p,x)||(u=!0,Gy(p,x));p=p.next}while(u);bh=!1}}function D1(){Fy()}function Fy(){Kc=vh=!1;var a=0;Ri!==0&&$1()&&(a=Ri);for(var c=Ze(),u=null,p=Gc;p!==null;){var v=p.next,x=Vy(p,c);x===0?(p.next=null,u===null?Gc=v:u.next=v,v===null&&(io=u)):(u=p,(a!==0||(x&3)!==0)&&(Kc=!0)),p=v}Ut!==0&&Ut!==5||dr(a),Ri!==0&&(Ri=0)}function Vy(a,c){for(var u=a.suspendedLanes,p=a.pingedLanes,v=a.expirationTimes,x=a.pendingLanes&-62914561;0<x;){var k=31-Lt(x),D=1<<k,I=v[k];I===-1?((D&u)===0||(D&p)!==0)&&(v[k]=Lu(D,c)):I<=c&&(a.expiredLanes|=D),x&=~D}if(c=pt,u=Ge,u=jn(a,a===c?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,u===0||a===c&&(rt===2||rt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&bt(p),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||Pn(a,u)){if(c=u&-u,c===a.callbackPriority)return c;switch(p!==null&&bt(p),At(u)){case 2:case 8:u=yt;break;case 32:u=Xt;break;case 268435456:u=_n;break;default:u=Xt}return p=Qy.bind(null,a),u=Ue(u,p),a.callbackPriority=c,a.callbackNode=u,c}return p!==null&&p!==null&&bt(p),a.callbackPriority=2,a.callbackNode=null,2}function Qy(a,c){if(Ut!==0&&Ut!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Qc()&&a.callbackNode!==u)return null;var p=Ge;return p=jn(a,a===pt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(Ey(a,p,c),Vy(a,Ze()),a.callbackNode!=null&&a.callbackNode===u?Qy.bind(null,a):null)}function Gy(a,c){if(Qc())return null;Ey(a,c,!0)}function _1(){U1(function(){(st&6)!==0?Ue(xt,D1):Fy()})}function xh(){if(Ri===0){var a=Ua;a===0&&(a=Nn,Nn<<=1,(Nn&261888)===0&&(Nn=256)),Ri=a}return Ri}function Ky(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:sc(""+a)}function Yy(a,c){var u=c.ownerDocument.createElement("input");return u.name=c.name,u.value=c.value,a.id&&u.setAttribute("form",a.id),c.parentNode.insertBefore(u,c),a=new FormData(a),u.parentNode.removeChild(u),a}function N1(a,c,u,p,v){if(c==="submit"&&u&&u.stateNode===v){var x=Ky((v[Bt]||null).action),k=p.submitter;k&&(c=(c=k[Bt]||null)?Ky(c.formAction):k.getAttribute("formAction"),c!==null&&(x=c,k=null));var D=new oc("action","action",null,p,v);a.push({event:D,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ri!==0){var I=k?Yy(v,k):new FormData(v);qd(u,{pending:!0,data:I,method:v.method,action:x},null,I)}}else typeof x=="function"&&(D.preventDefault(),I=k?Yy(v,k):new FormData(v),qd(u,{pending:!0,data:I,method:v.method,action:x},x,I))},currentTarget:v}]})}}for(var wh=0;wh<nd.length;wh++){var Ch=nd[wh],j1=Ch.toLowerCase(),P1=Ch[0].toUpperCase()+Ch.slice(1);Js(j1,"on"+P1)}Js(kg,"onAnimationEnd"),Js(Eg,"onAnimationIteration"),Js(Tg,"onAnimationStart"),Js("dblclick","onDoubleClick"),Js("focusin","onFocus"),Js("focusout","onBlur"),Js(WM,"onTransitionRun"),Js(XM,"onTransitionStart"),Js(JM,"onTransitionCancel"),Js(Ag,"onTransitionEnd"),Aa("onMouseEnter",["mouseout","mouseover"]),Aa("onMouseLeave",["mouseout","mouseover"]),Aa("onPointerEnter",["pointerout","pointerover"]),Aa("onPointerLeave",["pointerout","pointerover"]),Gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),L1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hr));function Wy(a,c){c=(c&4)!==0;for(var u=0;u<a.length;u++){var p=a[u],v=p.event;p=p.listeners;e:{var x=void 0;if(c)for(var k=p.length-1;0<=k;k--){var D=p[k],I=D.instance,Q=D.currentTarget;if(D=D.listener,I!==x&&v.isPropagationStopped())break e;x=D,v.currentTarget=Q;try{x(v)}catch(se){lc(se)}v.currentTarget=null,x=I}else for(k=0;k<p.length;k++){if(D=p[k],I=D.instance,Q=D.currentTarget,D=D.listener,I!==x&&v.isPropagationStopped())break e;x=D,v.currentTarget=Q;try{x(v)}catch(se){lc(se)}v.currentTarget=null,x=I}}}}function Qe(a,c){var u=c[Fe];u===void 0&&(u=c[Fe]=new Set);var p=a+"__bubble";u.has(p)||(Xy(c,a,2,!1),u.add(p))}function Sh(a,c,u){var p=0;c&&(p|=4),Xy(u,a,p,c)}var Yc="_reactListening"+Math.random().toString(36).slice(2);function Mh(a){if(!a[Yc]){a[Yc]=!0,Fp.forEach(function(u){u!=="selectionchange"&&(L1.has(u)||Sh(u,!1,a),Sh(u,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Yc]||(c[Yc]=!0,Sh("selectionchange",!1,c))}}function Xy(a,c,u,p){switch(k0(c)){case 2:var v=lR;break;case 8:v=uR;break;default:v=Hh}u=v.bind(null,c,u,a),v=void 0,!Fu||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),p?v!==void 0?a.addEventListener(c,u,{capture:!0,passive:v}):a.addEventListener(c,u,!0):v!==void 0?a.addEventListener(c,u,{passive:v}):a.addEventListener(c,u,!1)}function Rh(a,c,u,p,v){var x=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var k=p.tag;if(k===3||k===4){var D=p.stateNode.containerInfo;if(D===v)break;if(k===4)for(k=p.return;k!==null;){var I=k.tag;if((I===3||I===4)&&k.stateNode.containerInfo===v)return;k=k.return}for(;D!==null;){if(k=ka(D),k===null)return;if(I=k.tag,I===5||I===6||I===26||I===27){p=x=k;continue e}D=D.parentNode}}p=p.return}sg(function(){var Q=x,se=Bu(u),re=[];e:{var K=Dg.get(a);if(K!==void 0){var X=oc,xe=a;switch(a){case"keypress":if(ic(u)===0)break e;case"keydown":case"keyup":X=TM;break;case"focusin":xe="focus",X=Ku;break;case"focusout":xe="blur",X=Ku;break;case"beforeblur":case"afterblur":X=Ku;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=ag;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=mM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=_M;break;case kg:case Eg:case Tg:X=bM;break;case Ag:X=jM;break;case"scroll":case"scrollend":X=pM;break;case"wheel":X=LM;break;case"copy":case"cut":case"paste":X=wM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=rg;break;case"toggle":case"beforetoggle":X=IM}var Ne=(c&4)!==0,ht=!Ne&&(a==="scroll"||a==="scrollend"),$=Ne?K!==null?K+"Capture":null:K;Ne=[];for(var H=Q,V;H!==null;){var oe=H;if(V=oe.stateNode,oe=oe.tag,oe!==5&&oe!==26&&oe!==27||V===null||$===null||(oe=Po(H,$),oe!=null&&Ne.push(fr(H,oe,V))),ht)break;H=H.return}0<Ne.length&&(K=new X(K,xe,null,u,se),re.push({event:K,listeners:Ne}))}}if((c&7)===0){e:{if(K=a==="mouseover"||a==="pointerover",X=a==="mouseout"||a==="pointerout",K&&u!==$u&&(xe=u.relatedTarget||u.fromElement)&&(ka(xe)||xe[fn]))break e;if((X||K)&&(K=se.window===se?se:(K=se.ownerDocument)?K.defaultView||K.parentWindow:window,X?(xe=u.relatedTarget||u.toElement,X=Q,xe=xe?ka(xe):null,xe!==null&&(ht=i(xe),Ne=xe.tag,xe!==ht||Ne!==5&&Ne!==27&&Ne!==6)&&(xe=null)):(X=null,xe=Q),X!==xe)){if(Ne=ag,oe="onMouseLeave",$="onMouseEnter",H="mouse",(a==="pointerout"||a==="pointerover")&&(Ne=rg,oe="onPointerLeave",$="onPointerEnter",H="pointer"),ht=X==null?K:jo(X),V=xe==null?K:jo(xe),K=new Ne(oe,H+"leave",X,u,se),K.target=ht,K.relatedTarget=V,oe=null,ka(se)===Q&&(Ne=new Ne($,H+"enter",xe,u,se),Ne.target=V,Ne.relatedTarget=ht,oe=Ne),ht=oe,X&&xe)t:{for(Ne=z1,$=X,H=xe,V=0,oe=$;oe;oe=Ne(oe))V++;oe=0;for(var Te=H;Te;Te=Ne(Te))oe++;for(;0<V-oe;)$=Ne($),V--;for(;0<oe-V;)H=Ne(H),oe--;for(;V--;){if($===H||H!==null&&$===H.alternate){Ne=$;break t}$=Ne($),H=Ne(H)}Ne=null}else Ne=null;X!==null&&Jy(re,K,X,Ne,!1),xe!==null&&ht!==null&&Jy(re,ht,xe,Ne,!0)}}e:{if(K=Q?jo(Q):window,X=K.nodeName&&K.nodeName.toLowerCase(),X==="select"||X==="input"&&K.type==="file")var et=gg;else if(fg(K))if(mg)et=GM;else{et=VM;var Me=FM}else X=K.nodeName,!X||X.toLowerCase()!=="input"||K.type!=="checkbox"&&K.type!=="radio"?Q&&qu(Q.elementType)&&(et=gg):et=QM;if(et&&(et=et(a,Q))){pg(re,et,u,se);break e}Me&&Me(a,K,Q),a==="focusout"&&Q&&K.type==="number"&&Q.memoizedProps.value!=null&&Hu(K,"number",K.value)}switch(Me=Q?jo(Q):window,a){case"focusin":(fg(Me)||Me.contentEditable==="true")&&(La=Me,ed=Q,Bo=null);break;case"focusout":Bo=ed=La=null;break;case"mousedown":td=!0;break;case"contextmenu":case"mouseup":case"dragend":td=!1,Mg(re,u,se);break;case"selectionchange":if(YM)break;case"keydown":case"keyup":Mg(re,u,se)}var He;if(Wu)e:{switch(a){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else Pa?dg(a,u)&&(Ke="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(Ke="onCompositionStart");Ke&&(cg&&u.locale!=="ko"&&(Pa||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&Pa&&(He=ng()):(li=se,Vu="value"in li?li.value:li.textContent,Pa=!0)),Me=Wc(Q,Ke),0<Me.length&&(Ke=new og(Ke,a,null,u,se),re.push({event:Ke,listeners:Me}),He?Ke.data=He:(He=hg(u),He!==null&&(Ke.data=He)))),(He=HM?qM(a,u):$M(a,u))&&(Ke=Wc(Q,"onBeforeInput"),0<Ke.length&&(Me=new og("onBeforeInput","beforeinput",null,u,se),re.push({event:Me,listeners:Ke}),Me.data=He)),N1(re,a,Q,u,se)}Wy(re,c)})}function fr(a,c,u){return{instance:a,listener:c,currentTarget:u}}function Wc(a,c){for(var u=c+"Capture",p=[];a!==null;){var v=a,x=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||x===null||(v=Po(a,u),v!=null&&p.unshift(fr(a,v,x)),v=Po(a,c),v!=null&&p.push(fr(a,v,x))),a.tag===3)return p;a=a.return}return[]}function z1(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Jy(a,c,u,p,v){for(var x=c._reactName,k=[];u!==null&&u!==p;){var D=u,I=D.alternate,Q=D.stateNode;if(D=D.tag,I!==null&&I===p)break;D!==5&&D!==26&&D!==27||Q===null||(I=Q,v?(Q=Po(u,x),Q!=null&&k.unshift(fr(u,Q,I))):v||(Q=Po(u,x),Q!=null&&k.push(fr(u,Q,I)))),u=u.return}k.length!==0&&a.push({event:c,listeners:k})}var I1=/\r\n?/g,O1=/\u0000|\uFFFD/g;function Zy(a){return(typeof a=="string"?a:""+a).replace(I1,`
`).replace(O1,"")}function e0(a,c){return c=Zy(c),Zy(a)===c}function dt(a,c,u,p,v,x){switch(u){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||_a(a,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&_a(a,""+p);break;case"className":ec(a,"class",p);break;case"tabIndex":ec(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":ec(a,u,p);break;case"style":eg(a,p,x);break;case"data":if(c!=="object"){ec(a,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||u!=="href")){a.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=sc(""+p),a.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(u==="formAction"?(c!=="input"&&dt(a,c,"name",v.name,v,null),dt(a,c,"formEncType",v.formEncType,v,null),dt(a,c,"formMethod",v.formMethod,v,null),dt(a,c,"formTarget",v.formTarget,v,null)):(dt(a,c,"encType",v.encType,v,null),dt(a,c,"method",v.method,v,null),dt(a,c,"target",v.target,v,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=sc(""+p),a.setAttribute(u,p);break;case"onClick":p!=null&&(a.onclick=zn);break;case"onScroll":p!=null&&Qe("scroll",a);break;case"onScrollEnd":p!=null&&Qe("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(u=p.__html,u!=null){if(v.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}u=sc(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""+p):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":p===!0?a.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,p):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(u,p):a.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(u):a.setAttribute(u,p);break;case"popover":Qe("beforetoggle",a),Qe("toggle",a),Zr(a,"popover",p);break;case"xlinkActuate":Ln(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Ln(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Ln(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Ln(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Ln(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Ln(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Ln(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Ln(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Ln(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Zr(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=hM.get(u)||u,Zr(a,u,p))}}function kh(a,c,u,p,v,x){switch(u){case"style":eg(a,p,x);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(u=p.__html,u!=null){if(v.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"children":typeof p=="string"?_a(a,p):(typeof p=="number"||typeof p=="bigint")&&_a(a,""+p);break;case"onScroll":p!=null&&Qe("scroll",a);break;case"onScrollEnd":p!=null&&Qe("scrollend",a);break;case"onClick":p!=null&&(a.onclick=zn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Vp.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(v=u.endsWith("Capture"),c=u.slice(2,v?u.length-7:void 0),x=a[Bt]||null,x=x!=null?x[u]:null,typeof x=="function"&&a.removeEventListener(c,x,v),typeof p=="function")){typeof x!="function"&&x!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(c,p,v);break e}u in a?a[u]=p:p===!0?a.setAttribute(u,""):Zr(a,u,p)}}}function ns(a,c,u){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qe("error",a),Qe("load",a);var p=!1,v=!1,x;for(x in u)if(u.hasOwnProperty(x)){var k=u[x];if(k!=null)switch(x){case"src":p=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:dt(a,c,x,k,u,null)}}v&&dt(a,c,"srcSet",u.srcSet,u,null),p&&dt(a,c,"src",u.src,u,null);return;case"input":Qe("invalid",a);var D=x=k=v=null,I=null,Q=null;for(p in u)if(u.hasOwnProperty(p)){var se=u[p];if(se!=null)switch(p){case"name":v=se;break;case"type":k=se;break;case"checked":I=se;break;case"defaultChecked":Q=se;break;case"value":x=se;break;case"defaultValue":D=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(s(137,c));break;default:dt(a,c,p,se,u,null)}}Wp(a,x,D,I,Q,k,v,!1);return;case"select":Qe("invalid",a),p=k=x=null;for(v in u)if(u.hasOwnProperty(v)&&(D=u[v],D!=null))switch(v){case"value":x=D;break;case"defaultValue":k=D;break;case"multiple":p=D;default:dt(a,c,v,D,u,null)}c=x,u=k,a.multiple=!!p,c!=null?Da(a,!!p,c,!1):u!=null&&Da(a,!!p,u,!0);return;case"textarea":Qe("invalid",a),x=v=p=null;for(k in u)if(u.hasOwnProperty(k)&&(D=u[k],D!=null))switch(k){case"value":p=D;break;case"defaultValue":v=D;break;case"children":x=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(s(91));break;default:dt(a,c,k,D,u,null)}Jp(a,p,v,x);return;case"option":for(I in u)if(u.hasOwnProperty(I)&&(p=u[I],p!=null))switch(I){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:dt(a,c,I,p,u,null)}return;case"dialog":Qe("beforetoggle",a),Qe("toggle",a),Qe("cancel",a),Qe("close",a);break;case"iframe":case"object":Qe("load",a);break;case"video":case"audio":for(p=0;p<hr.length;p++)Qe(hr[p],a);break;case"image":Qe("error",a),Qe("load",a);break;case"details":Qe("toggle",a);break;case"embed":case"source":case"link":Qe("error",a),Qe("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in u)if(u.hasOwnProperty(Q)&&(p=u[Q],p!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:dt(a,c,Q,p,u,null)}return;default:if(qu(c)){for(se in u)u.hasOwnProperty(se)&&(p=u[se],p!==void 0&&kh(a,c,se,p,u,void 0));return}}for(D in u)u.hasOwnProperty(D)&&(p=u[D],p!=null&&dt(a,c,D,p,u,null))}function H1(a,c,u,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,x=null,k=null,D=null,I=null,Q=null,se=null;for(X in u){var re=u[X];if(u.hasOwnProperty(X)&&re!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":I=re;default:p.hasOwnProperty(X)||dt(a,c,X,null,p,re)}}for(var K in p){var X=p[K];if(re=u[K],p.hasOwnProperty(K)&&(X!=null||re!=null))switch(K){case"type":x=X;break;case"name":v=X;break;case"checked":Q=X;break;case"defaultChecked":se=X;break;case"value":k=X;break;case"defaultValue":D=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(s(137,c));break;default:X!==re&&dt(a,c,K,X,p,re)}}Ou(a,k,D,I,Q,se,x,v);return;case"select":X=k=D=K=null;for(x in u)if(I=u[x],u.hasOwnProperty(x)&&I!=null)switch(x){case"value":break;case"multiple":X=I;default:p.hasOwnProperty(x)||dt(a,c,x,null,p,I)}for(v in p)if(x=p[v],I=u[v],p.hasOwnProperty(v)&&(x!=null||I!=null))switch(v){case"value":K=x;break;case"defaultValue":D=x;break;case"multiple":k=x;default:x!==I&&dt(a,c,v,x,p,I)}c=D,u=k,p=X,K!=null?Da(a,!!u,K,!1):!!p!=!!u&&(c!=null?Da(a,!!u,c,!0):Da(a,!!u,u?[]:"",!1));return;case"textarea":X=K=null;for(D in u)if(v=u[D],u.hasOwnProperty(D)&&v!=null&&!p.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:dt(a,c,D,null,p,v)}for(k in p)if(v=p[k],x=u[k],p.hasOwnProperty(k)&&(v!=null||x!=null))switch(k){case"value":K=v;break;case"defaultValue":X=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(s(91));break;default:v!==x&&dt(a,c,k,v,p,x)}Xp(a,K,X);return;case"option":for(var xe in u)if(K=u[xe],u.hasOwnProperty(xe)&&K!=null&&!p.hasOwnProperty(xe))switch(xe){case"selected":a.selected=!1;break;default:dt(a,c,xe,null,p,K)}for(I in p)if(K=p[I],X=u[I],p.hasOwnProperty(I)&&K!==X&&(K!=null||X!=null))switch(I){case"selected":a.selected=K&&typeof K!="function"&&typeof K!="symbol";break;default:dt(a,c,I,K,p,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ne in u)K=u[Ne],u.hasOwnProperty(Ne)&&K!=null&&!p.hasOwnProperty(Ne)&&dt(a,c,Ne,null,p,K);for(Q in p)if(K=p[Q],X=u[Q],p.hasOwnProperty(Q)&&K!==X&&(K!=null||X!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(s(137,c));break;default:dt(a,c,Q,K,p,X)}return;default:if(qu(c)){for(var ht in u)K=u[ht],u.hasOwnProperty(ht)&&K!==void 0&&!p.hasOwnProperty(ht)&&kh(a,c,ht,void 0,p,K);for(se in p)K=p[se],X=u[se],!p.hasOwnProperty(se)||K===X||K===void 0&&X===void 0||kh(a,c,se,K,p,X);return}}for(var $ in u)K=u[$],u.hasOwnProperty($)&&K!=null&&!p.hasOwnProperty($)&&dt(a,c,$,null,p,K);for(re in p)K=p[re],X=u[re],!p.hasOwnProperty(re)||K===X||K==null&&X==null||dt(a,c,re,K,p,X)}function t0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function q1(){if(typeof performance.getEntriesByType=="function"){for(var a=0,c=0,u=performance.getEntriesByType("resource"),p=0;p<u.length;p++){var v=u[p],x=v.transferSize,k=v.initiatorType,D=v.duration;if(x&&D&&t0(k)){for(k=0,D=v.responseEnd,p+=1;p<u.length;p++){var I=u[p],Q=I.startTime;if(Q>D)break;var se=I.transferSize,re=I.initiatorType;se&&t0(re)&&(I=I.responseEnd,k+=se*(I<D?1:(D-Q)/(I-Q)))}if(--p,c+=8*(x+k)/(v.duration/1e3),a++,10<a)break}}if(0<a)return c/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Eh=null,Th=null;function Xc(a){return a.nodeType===9?a:a.ownerDocument}function s0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function n0(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function Ah(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Dh=null;function $1(){var a=window.event;return a&&a.type==="popstate"?a===Dh?!1:(Dh=a,!0):(Dh=null,!1)}var i0=typeof setTimeout=="function"?setTimeout:void 0,B1=typeof clearTimeout=="function"?clearTimeout:void 0,a0=typeof Promise=="function"?Promise:void 0,U1=typeof queueMicrotask=="function"?queueMicrotask:typeof a0<"u"?function(a){return a0.resolve(null).then(a).catch(F1)}:i0;function F1(a){setTimeout(function(){throw a})}function ki(a){return a==="head"}function o0(a,c){var u=c,p=0;do{var v=u.nextSibling;if(a.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"||u==="/&"){if(p===0){a.removeChild(v),co(c);return}p--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")p++;else if(u==="html")pr(a.ownerDocument.documentElement);else if(u==="head"){u=a.ownerDocument.head,pr(u);for(var x=u.firstChild;x;){var k=x.nextSibling,D=x.nodeName;x[No]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=k}}else u==="body"&&pr(a.ownerDocument.body);u=v}while(u);co(c)}function r0(a,c){var u=a;a=0;do{var p=u.nextSibling;if(u.nodeType===1?c?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(c?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),p&&p.nodeType===8)if(u=p.data,u==="/$"){if(a===0)break;a--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||a++;u=p}while(u)}function _h(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var u=c;switch(c=c.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":_h(u),zu(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function V1(a,c,u,p){for(;a.nodeType===1;){var v=u;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[No])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(x=a.getAttribute("rel"),x==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(x!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(x=a.getAttribute("src"),(x!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&x&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var x=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===x)return a}else return a;if(a=Bs(a.nextSibling),a===null)break}return null}function Q1(a,c,u){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Bs(a.nextSibling),a===null))return null;return a}function c0(a,c){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=Bs(a.nextSibling),a===null))return null;return a}function Nh(a){return a.data==="$?"||a.data==="$~"}function jh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function G1(a,c){var u=a.ownerDocument;if(a.data==="$~")a._reactRetry=c;else if(a.data!=="$?"||u.readyState!=="loading")c();else{var p=function(){c(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function Bs(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"||c==="F!"||c==="F")break;if(c==="/$"||c==="/&")return null}}return a}var Ph=null;function l0(a){a=a.nextSibling;for(var c=0;a;){if(a.nodeType===8){var u=a.data;if(u==="/$"||u==="/&"){if(c===0)return Bs(a.nextSibling);c--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||c++}a=a.nextSibling}return null}function u0(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(c===0)return a;c--}else u!=="/$"&&u!=="/&"||c++}a=a.previousSibling}return null}function d0(a,c,u){switch(c=Xc(u),a){case"html":if(a=c.documentElement,!a)throw Error(s(452));return a;case"head":if(a=c.head,!a)throw Error(s(453));return a;case"body":if(a=c.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function pr(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);zu(a)}var Us=new Map,h0=new Set;function Jc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Jn=j.d;j.d={f:K1,r:Y1,D:W1,C:X1,L:J1,m:Z1,X:tR,S:eR,M:sR};function K1(){var a=Jn.f(),c=Uc();return a||c}function Y1(a){var c=Ea(a);c!==null&&c.tag===5&&c.type==="form"?Am(c):Jn.r(a)}var ao=typeof document>"u"?null:document;function f0(a,c,u){var p=ao;if(p&&typeof c=="string"&&c){var v=Ls(c);v='link[rel="'+a+'"][href="'+v+'"]',typeof u=="string"&&(v+='[crossorigin="'+u+'"]'),h0.has(v)||(h0.add(v),a={rel:a,crossOrigin:u,href:c},p.querySelector(v)===null&&(c=p.createElement("link"),ns(c,"link",a),Yt(c),p.head.appendChild(c)))}}function W1(a){Jn.D(a),f0("dns-prefetch",a,null)}function X1(a,c){Jn.C(a,c),f0("preconnect",a,c)}function J1(a,c,u){Jn.L(a,c,u);var p=ao;if(p&&a&&c){var v='link[rel="preload"][as="'+Ls(c)+'"]';c==="image"&&u&&u.imageSrcSet?(v+='[imagesrcset="'+Ls(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(v+='[imagesizes="'+Ls(u.imageSizes)+'"]')):v+='[href="'+Ls(a)+'"]';var x=v;switch(c){case"style":x=oo(a);break;case"script":x=ro(a)}Us.has(x)||(a=m({rel:"preload",href:c==="image"&&u&&u.imageSrcSet?void 0:a,as:c},u),Us.set(x,a),p.querySelector(v)!==null||c==="style"&&p.querySelector(gr(x))||c==="script"&&p.querySelector(mr(x))||(c=p.createElement("link"),ns(c,"link",a),Yt(c),p.head.appendChild(c)))}}function Z1(a,c){Jn.m(a,c);var u=ao;if(u&&a){var p=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+Ls(p)+'"][href="'+Ls(a)+'"]',x=v;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=ro(a)}if(!Us.has(x)&&(a=m({rel:"modulepreload",href:a},c),Us.set(x,a),u.querySelector(v)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(mr(x)))return}p=u.createElement("link"),ns(p,"link",a),Yt(p),u.head.appendChild(p)}}}function eR(a,c,u){Jn.S(a,c,u);var p=ao;if(p&&a){var v=Ta(p).hoistableStyles,x=oo(a);c=c||"default";var k=v.get(x);if(!k){var D={loading:0,preload:null};if(k=p.querySelector(gr(x)))D.loading=5;else{a=m({rel:"stylesheet",href:a,"data-precedence":c},u),(u=Us.get(x))&&Lh(a,u);var I=k=p.createElement("link");Yt(I),ns(I,"link",a),I._p=new Promise(function(Q,se){I.onload=Q,I.onerror=se}),I.addEventListener("load",function(){D.loading|=1}),I.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Zc(k,c,p)}k={type:"stylesheet",instance:k,count:1,state:D},v.set(x,k)}}}function tR(a,c){Jn.X(a,c);var u=ao;if(u&&a){var p=Ta(u).hoistableScripts,v=ro(a),x=p.get(v);x||(x=u.querySelector(mr(v)),x||(a=m({src:a,async:!0},c),(c=Us.get(v))&&zh(a,c),x=u.createElement("script"),Yt(x),ns(x,"link",a),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},p.set(v,x))}}function sR(a,c){Jn.M(a,c);var u=ao;if(u&&a){var p=Ta(u).hoistableScripts,v=ro(a),x=p.get(v);x||(x=u.querySelector(mr(v)),x||(a=m({src:a,async:!0,type:"module"},c),(c=Us.get(v))&&zh(a,c),x=u.createElement("script"),Yt(x),ns(x,"link",a),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},p.set(v,x))}}function p0(a,c,u,p){var v=(v=ae.current)?Jc(v):null;if(!v)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(c=oo(u.href),u=Ta(v).hoistableStyles,p=u.get(c),p||(p={type:"style",instance:null,count:0,state:null},u.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=oo(u.href);var x=Ta(v).hoistableStyles,k=x.get(a);if(k||(v=v.ownerDocument||v,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(a,k),(x=v.querySelector(gr(a)))&&!x._p&&(k.instance=x,k.state.loading=5),Us.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Us.set(a,u),x||nR(v,a,u,k.state))),c&&p===null)throw Error(s(528,""));return k}if(c&&p!==null)throw Error(s(529,""));return null;case"script":return c=u.async,u=u.src,typeof u=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=ro(u),u=Ta(v).hoistableScripts,p=u.get(c),p||(p={type:"script",instance:null,count:0,state:null},u.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function oo(a){return'href="'+Ls(a)+'"'}function gr(a){return'link[rel="stylesheet"]['+a+"]"}function g0(a){return m({},a,{"data-precedence":a.precedence,precedence:null})}function nR(a,c,u,p){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=a.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),ns(c,"link",u),Yt(c),a.head.appendChild(c))}function ro(a){return'[src="'+Ls(a)+'"]'}function mr(a){return"script[async]"+a}function m0(a,c,u){if(c.count++,c.instance===null)switch(c.type){case"style":var p=a.querySelector('style[data-href~="'+Ls(u.href)+'"]');if(p)return c.instance=p,Yt(p),p;var v=m({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Yt(p),ns(p,"style",v),Zc(p,u.precedence,a),c.instance=p;case"stylesheet":v=oo(u.href);var x=a.querySelector(gr(v));if(x)return c.state.loading|=4,c.instance=x,Yt(x),x;p=g0(u),(v=Us.get(v))&&Lh(p,v),x=(a.ownerDocument||a).createElement("link"),Yt(x);var k=x;return k._p=new Promise(function(D,I){k.onload=D,k.onerror=I}),ns(x,"link",p),c.state.loading|=4,Zc(x,u.precedence,a),c.instance=x;case"script":return x=ro(u.src),(v=a.querySelector(mr(x)))?(c.instance=v,Yt(v),v):(p=u,(v=Us.get(x))&&(p=m({},u),zh(p,v)),a=a.ownerDocument||a,v=a.createElement("script"),Yt(v),ns(v,"link",p),a.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(s(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,Zc(p,u.precedence,a));return c.instance}function Zc(a,c,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=p.length?p[p.length-1]:null,x=v,k=0;k<p.length;k++){var D=p[k];if(D.dataset.precedence===c)x=D;else if(x!==v)break}x?x.parentNode.insertBefore(a,x.nextSibling):(c=u.nodeType===9?u.head:u,c.insertBefore(a,c.firstChild))}function Lh(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function zh(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var el=null;function y0(a,c,u){if(el===null){var p=new Map,v=el=new Map;v.set(u,p)}else v=el,p=v.get(u),p||(p=new Map,v.set(u,p));if(p.has(a))return p;for(p.set(a,null),u=u.getElementsByTagName(a),v=0;v<u.length;v++){var x=u[v];if(!(x[No]||x[vt]||a==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var k=x.getAttribute(c)||"";k=a+k;var D=p.get(k);D?D.push(x):p.set(k,[x])}}return p}function v0(a,c,u){a=a.ownerDocument||a,a.head.insertBefore(u,c==="title"?a.querySelector("head > title"):null)}function iR(a,c,u){if(u===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function b0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function aR(a,c,u,p){if(u.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var v=oo(p.href),x=c.querySelector(gr(v));if(x){c=x._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(a.count++,a=tl.bind(a),c.then(a,a)),u.state.loading|=4,u.instance=x,Yt(x);return}x=c.ownerDocument||c,p=g0(p),(v=Us.get(v))&&Lh(p,v),x=x.createElement("link"),Yt(x);var k=x;k._p=new Promise(function(D,I){k.onload=D,k.onerror=I}),ns(x,"link",p),u.instance=x}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(u,c),(c=u.state.preload)&&(u.state.loading&3)===0&&(a.count++,u=tl.bind(a),c.addEventListener("load",u),c.addEventListener("error",u))}}var Ih=0;function oR(a,c){return a.stylesheets&&a.count===0&&nl(a,a.stylesheets),0<a.count||0<a.imgCount?function(u){var p=setTimeout(function(){if(a.stylesheets&&nl(a,a.stylesheets),a.unsuspend){var x=a.unsuspend;a.unsuspend=null,x()}},6e4+c);0<a.imgBytes&&Ih===0&&(Ih=62500*q1());var v=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&nl(a,a.stylesheets),a.unsuspend)){var x=a.unsuspend;a.unsuspend=null,x()}},(a.imgBytes>Ih?50:800)+c);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(p),clearTimeout(v)}}:null}function tl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nl(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var sl=null;function nl(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,sl=new Map,c.forEach(rR,a),sl=null,tl.call(a))}function rR(a,c){if(!(c.state.loading&4)){var u=sl.get(a);if(u)var p=u.get(null);else{u=new Map,sl.set(a,u);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<v.length;x++){var k=v[x];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(u.set(k.dataset.precedence,k),p=k)}p&&u.set(null,p)}v=c.instance,k=v.getAttribute("data-precedence"),x=u.get(k)||p,x===p&&u.set(null,v),u.set(k,v),this.count++,p=tl.bind(this),v.addEventListener("load",p),v.addEventListener("error",p),x?x.parentNode.insertBefore(v,x.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),c.state.loading|=4}}var yr={$$typeof:E,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function cR(a,c,u,p,v,x,k,D,I){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=he(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=he(0),this.hiddenUpdates=he(null),this.identifierPrefix=p,this.onUncaughtError=v,this.onCaughtError=x,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=I,this.incompleteTransitions=new Map}function x0(a,c,u,p,v,x,k,D,I,Q,se,re){return a=new cR(a,c,u,k,I,Q,se,re,D),c=1,x===!0&&(c|=24),x=Ss(3,null,null,c),a.current=x,x.stateNode=a,c=md(),c.refCount++,a.pooledCache=c,c.refCount++,x.memoizedState={element:p,isDehydrated:u,cache:c},xd(x),a}function w0(a){return a?(a=Oa,a):Oa}function C0(a,c,u,p,v,x){v=w0(v),p.context===null?p.context=v:p.pendingContext=v,p=gi(c),p.payload={element:u},x=x===void 0?null:x,x!==null&&(p.callback=x),u=mi(a,p,c),u!==null&&(vs(u,a,c),Yo(u,a,c))}function S0(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<c?u:c}}function Oh(a,c){S0(a,c),(a=a.alternate)&&S0(a,c)}function M0(a){if(a.tag===13||a.tag===31){var c=Xi(a,67108864);c!==null&&vs(c,a,67108864),Oh(a,67108864)}}function R0(a){if(a.tag===13||a.tag===31){var c=Ts();c=Zt(c);var u=Xi(a,c);u!==null&&vs(u,a,c),Oh(a,c)}}var il=!0;function lR(a,c,u,p){var v=L.T;L.T=null;var x=j.p;try{j.p=2,Hh(a,c,u,p)}finally{j.p=x,L.T=v}}function uR(a,c,u,p){var v=L.T;L.T=null;var x=j.p;try{j.p=8,Hh(a,c,u,p)}finally{j.p=x,L.T=v}}function Hh(a,c,u,p){if(il){var v=qh(p);if(v===null)Rh(a,c,p,al,u),E0(a,p);else if(hR(v,a,c,u,p))p.stopPropagation();else if(E0(a,p),c&4&&-1<dR.indexOf(a)){for(;v!==null;){var x=Ea(v);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var k=Xs(x.pendingLanes);if(k!==0){var D=x;for(D.pendingLanes|=2,D.entangledLanes|=2;k;){var I=1<<31-Lt(k);D.entanglements[1]|=I,k&=~I}yn(x),(st&6)===0&&($c=Ze()+500,dr(0))}}break;case 31:case 13:D=Xi(x,2),D!==null&&vs(D,x,2),Uc(),Oh(x,2)}if(x=qh(p),x===null&&Rh(a,c,p,al,u),x===v)break;v=x}v!==null&&p.stopPropagation()}else Rh(a,c,p,null,u)}}function qh(a){return a=Bu(a),$h(a)}var al=null;function $h(a){if(al=null,a=ka(a),a!==null){var c=i(a);if(c===null)a=null;else{var u=c.tag;if(u===13){if(a=o(c),a!==null)return a;a=null}else if(u===31){if(a=l(c),a!==null)return a;a=null}else if(u===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return al=a,null}function k0(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Pt()){case xt:return 2;case yt:return 8;case Xt:case Gt:return 32;case _n:return 268435456;default:return 32}default:return 32}}var Bh=!1,Ei=null,Ti=null,Ai=null,vr=new Map,br=new Map,Di=[],dR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function E0(a,c){switch(a){case"focusin":case"focusout":Ei=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Ai=null;break;case"pointerover":case"pointerout":vr.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":br.delete(c.pointerId)}}function xr(a,c,u,p,v,x){return a===null||a.nativeEvent!==x?(a={blockedOn:c,domEventName:u,eventSystemFlags:p,nativeEvent:x,targetContainers:[v]},c!==null&&(c=Ea(c),c!==null&&M0(c)),a):(a.eventSystemFlags|=p,c=a.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),a)}function hR(a,c,u,p,v){switch(c){case"focusin":return Ei=xr(Ei,a,c,u,p,v),!0;case"dragenter":return Ti=xr(Ti,a,c,u,p,v),!0;case"mouseover":return Ai=xr(Ai,a,c,u,p,v),!0;case"pointerover":var x=v.pointerId;return vr.set(x,xr(vr.get(x)||null,a,c,u,p,v)),!0;case"gotpointercapture":return x=v.pointerId,br.set(x,xr(br.get(x)||null,a,c,u,p,v)),!0}return!1}function T0(a){var c=ka(a.target);if(c!==null){var u=i(c);if(u!==null){if(c=u.tag,c===13){if(c=o(u),c!==null){a.blockedOn=c,St(a.priority,function(){R0(u)});return}}else if(c===31){if(c=l(u),c!==null){a.blockedOn=c,St(a.priority,function(){R0(u)});return}}else if(c===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ol(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var u=qh(a.nativeEvent);if(u===null){u=a.nativeEvent;var p=new u.constructor(u.type,u);$u=p,u.target.dispatchEvent(p),$u=null}else return c=Ea(u),c!==null&&M0(c),a.blockedOn=u,!1;c.shift()}return!0}function A0(a,c,u){ol(a)&&u.delete(c)}function fR(){Bh=!1,Ei!==null&&ol(Ei)&&(Ei=null),Ti!==null&&ol(Ti)&&(Ti=null),Ai!==null&&ol(Ai)&&(Ai=null),vr.forEach(A0),br.forEach(A0)}function rl(a,c){a.blockedOn===c&&(a.blockedOn=null,Bh||(Bh=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,fR)))}var cl=null;function D0(a){cl!==a&&(cl=a,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){cl===a&&(cl=null);for(var c=0;c<a.length;c+=3){var u=a[c],p=a[c+1],v=a[c+2];if(typeof p!="function"){if($h(p||u)===null)continue;break}var x=Ea(u);x!==null&&(a.splice(c,3),c-=3,qd(x,{pending:!0,data:v,method:u.method,action:p},p,v))}}))}function co(a){function c(I){return rl(I,a)}Ei!==null&&rl(Ei,a),Ti!==null&&rl(Ti,a),Ai!==null&&rl(Ai,a),vr.forEach(c),br.forEach(c);for(var u=0;u<Di.length;u++){var p=Di[u];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Di.length&&(u=Di[0],u.blockedOn===null);)T0(u),u.blockedOn===null&&Di.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var v=u[p],x=u[p+1],k=v[Bt]||null;if(typeof x=="function")k||D0(u);else if(k){var D=null;if(x&&x.hasAttribute("formAction")){if(v=x,k=x[Bt]||null)D=k.formAction;else if($h(v)!==null)continue}else D=k.action;typeof D=="function"?u[p+1]=D:(u.splice(p,3),p-=3),D0(u)}}}function _0(){function a(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(k){return v=k})},focusReset:"manual",scroll:"manual"})}function c(){v!==null&&(v(),v=null),p||setTimeout(u,20)}function u(){if(!p&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,v=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",c),navigation.addEventListener("navigateerror",c),setTimeout(u,100),function(){p=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",c),navigation.removeEventListener("navigateerror",c),v!==null&&(v(),v=null)}}}function Uh(a){this._internalRoot=a}ll.prototype.render=Uh.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(s(409));var u=c.current,p=Ts();C0(u,p,a,c,null,null)},ll.prototype.unmount=Uh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;C0(a.current,2,null,a,null,null),Uc(),c[fn]=null}};function ll(a){this._internalRoot=a}ll.prototype.unstable_scheduleHydration=function(a){if(a){var c=ls();a={blockedOn:null,target:a,priority:c};for(var u=0;u<Di.length&&c!==0&&c<Di[u].priority;u++);Di.splice(u,0,a),u===0&&T0(a)}};var N0=t.version;if(N0!=="19.2.0")throw Error(s(527,N0,"19.2.0"));j.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=h(c),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var pR={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ul.isDisabled&&ul.supportsFiber)try{hn=ul.inject(pR),Jt=ul}catch{}}return Cr.createRoot=function(a,c){if(!n(a))throw Error(s(299));var u=!1,p="",v=Hm,x=qm,k=$m;return c!=null&&(c.unstable_strictMode===!0&&(u=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(x=c.onCaughtError),c.onRecoverableError!==void 0&&(k=c.onRecoverableError)),c=x0(a,1,!1,null,null,u,p,null,v,x,k,_0),a[fn]=c.current,Mh(a),new Uh(c)},Cr.hydrateRoot=function(a,c,u){if(!n(a))throw Error(s(299));var p=!1,v="",x=Hm,k=qm,D=$m,I=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(v=u.identifierPrefix),u.onUncaughtError!==void 0&&(x=u.onUncaughtError),u.onCaughtError!==void 0&&(k=u.onCaughtError),u.onRecoverableError!==void 0&&(D=u.onRecoverableError),u.formState!==void 0&&(I=u.formState)),c=x0(a,1,!0,c,u??null,p,v,I,x,k,D,_0),c.context=w0(null),u=c.current,p=Ts(),p=Zt(p),v=gi(p),v.callback=null,mi(u,v,p),u=p,c.current.lanes=u,be(c,u),yn(c),a[fn]=c.current,Mh(a),new ll(c)},Cr.version="19.2.0",Cr}var B0;function MR(){if(B0)return Qh.exports;B0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Qh.exports=SR(),Qh.exports}var RR=MR();const kR=Hf(RR);let ER={data:""},TR=r=>{if(typeof window=="object"){let t=(r?r.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return t.nonce=window.__nonce__,t.parentNode||(r||document.head).appendChild(t),t.firstChild}return r||ER},AR=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,DR=/\/\*[^]*?\*\/|  +/g,U0=/\n+/g,Pi=(r,t)=>{let e="",s="",n="";for(let i in r){let o=r[i];i[0]=="@"?i[1]=="i"?e=i+" "+o+";":s+=i[1]=="f"?Pi(o,i):i+"{"+Pi(o,i[1]=="k"?"":t)+"}":typeof o=="object"?s+=Pi(o,t?t.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,l):l?l+" "+d:d)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=Pi.p?Pi.p(i,o):i+":"+o+";")}return e+(t&&n?t+"{"+n+"}":n)+s},Zn={},Kv=r=>{if(typeof r=="object"){let t="";for(let e in r)t+=e+Kv(r[e]);return t}return r},_R=(r,t,e,s,n)=>{let i=Kv(r),o=Zn[i]||(Zn[i]=(d=>{let h=0,f=11;for(;h<d.length;)f=101*f+d.charCodeAt(h++)>>>0;return"go"+f})(i));if(!Zn[o]){let d=i!==r?r:(h=>{let f,m,y=[{}];for(;f=AR.exec(h.replace(DR,""));)f[4]?y.shift():f[3]?(m=f[3].replace(U0," ").trim(),y.unshift(y[0][m]=y[0][m]||{})):y[0][f[1]]=f[2].replace(U0," ").trim();return y[0]})(r);Zn[o]=Pi(n?{["@keyframes "+o]:d}:d,e?"":"."+o)}let l=e&&Zn.g?Zn.g:null;return e&&(Zn.g=Zn[o]),((d,h,f,m)=>{m?h.data=h.data.replace(m,d):h.data.indexOf(d)===-1&&(h.data=f?d+h.data:h.data+d)})(Zn[o],t,s,l),o},NR=(r,t,e)=>r.reduce((s,n,i)=>{let o=t[i];if(o&&o.call){let l=o(e),d=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=d?"."+d:l&&typeof l=="object"?l.props?"":Pi(l,""):l===!1?"":l}return s+n+(o??"")},"");function Wl(r){let t=this||{},e=r.call?r(t.p):r;return _R(e.unshift?e.raw?NR(e,[].slice.call(arguments,1),t.p):e.reduce((s,n)=>Object.assign(s,n&&n.call?n(t.p):n),{}):e,TR(t.target),t.g,t.o,t.k)}let Yv,yf,vf;Wl.bind({g:1});let ni=Wl.bind({k:1});function jR(r,t,e,s){Pi.p=t,Yv=r,yf=e,vf=s}function qi(r,t){let e=this||{};return function(){let s=arguments;function n(i,o){let l=Object.assign({},i),d=l.className||n.className;e.p=Object.assign({theme:yf&&yf()},l),e.o=/ *go\d+/.test(d),l.className=Wl.apply(e,s)+(d?" "+d:"");let h=r;return r[0]&&(h=l.as||r,delete l.as),vf&&h[0]&&vf(l),Yv(h,l)}return n}}var PR=r=>typeof r=="function",Ll=(r,t)=>PR(r)?r(t):r,LR=(()=>{let r=0;return()=>(++r).toString()})(),Wv=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");r=!t||t.matches}return r}})(),zR=20,Bf="default",Xv=(r,t)=>{let{toastLimit:e}=r.settings;switch(t.type){case 0:return{...r,toasts:[t.toast,...r.toasts].slice(0,e)};case 1:return{...r,toasts:r.toasts.map(o=>o.id===t.toast.id?{...o,...t.toast}:o)};case 2:let{toast:s}=t;return Xv(r,{type:r.toasts.find(o=>o.id===s.id)?1:0,toast:s});case 3:let{toastId:n}=t;return{...r,toasts:r.toasts.map(o=>o.id===n||n===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(o=>o.id!==t.toastId)};case 5:return{...r,pausedAt:t.time};case 6:let i=t.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},Rl=[],Jv={toasts:[],pausedAt:void 0,settings:{toastLimit:zR}},bn={},Zv=(r,t=Bf)=>{bn[t]=Xv(bn[t]||Jv,r),Rl.forEach(([e,s])=>{e===t&&s(bn[t])})},eb=r=>Object.keys(bn).forEach(t=>Zv(r,t)),IR=r=>Object.keys(bn).find(t=>bn[t].toasts.some(e=>e.id===r)),Xl=(r=Bf)=>t=>{Zv(t,r)},OR={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},HR=(r={},t=Bf)=>{let[e,s]=w.useState(bn[t]||Jv),n=w.useRef(bn[t]);w.useEffect(()=>(n.current!==bn[t]&&s(bn[t]),Rl.push([t,s]),()=>{let o=Rl.findIndex(([l])=>l===t);o>-1&&Rl.splice(o,1)}),[t]);let i=e.toasts.map(o=>{var l,d,h;return{...r,...r[o.type],...o,removeDelay:o.removeDelay||((l=r[o.type])==null?void 0:l.removeDelay)||r?.removeDelay,duration:o.duration||((d=r[o.type])==null?void 0:d.duration)||r?.duration||OR[o.type],style:{...r.style,...(h=r[o.type])==null?void 0:h.style,...o.style}}});return{...e,toasts:i}},qR=(r,t="blank",e)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...e,id:e?.id||LR()}),Hr=r=>(t,e)=>{let s=qR(t,r,e);return Xl(s.toasterId||IR(s.id))({type:2,toast:s}),s.id},Qt=(r,t)=>Hr("blank")(r,t);Qt.error=Hr("error");Qt.success=Hr("success");Qt.loading=Hr("loading");Qt.custom=Hr("custom");Qt.dismiss=(r,t)=>{let e={type:3,toastId:r};t?Xl(t)(e):eb(e)};Qt.dismissAll=r=>Qt.dismiss(void 0,r);Qt.remove=(r,t)=>{let e={type:4,toastId:r};t?Xl(t)(e):eb(e)};Qt.removeAll=r=>Qt.remove(void 0,r);Qt.promise=(r,t,e)=>{let s=Qt.loading(t.loading,{...e,...e?.loading});return typeof r=="function"&&(r=r()),r.then(n=>{let i=t.success?Ll(t.success,n):void 0;return i?Qt.success(i,{id:s,...e,...e?.success}):Qt.dismiss(s),n}).catch(n=>{let i=t.error?Ll(t.error,n):void 0;i?Qt.error(i,{id:s,...e,...e?.error}):Qt.dismiss(s)}),r};var $R=1e3,BR=(r,t="default")=>{let{toasts:e,pausedAt:s}=HR(r,t),n=w.useRef(new Map).current,i=w.useCallback((m,y=$R)=>{if(n.has(m))return;let b=setTimeout(()=>{n.delete(m),o({type:4,toastId:m})},y);n.set(m,b)},[]);w.useEffect(()=>{if(s)return;let m=Date.now(),y=e.map(b=>{if(b.duration===1/0)return;let C=(b.duration||0)+b.pauseDuration-(m-b.createdAt);if(C<0){b.visible&&Qt.dismiss(b.id);return}return setTimeout(()=>Qt.dismiss(b.id,t),C)});return()=>{y.forEach(b=>b&&clearTimeout(b))}},[e,s,t]);let o=w.useCallback(Xl(t),[t]),l=w.useCallback(()=>{o({type:5,time:Date.now()})},[o]),d=w.useCallback((m,y)=>{o({type:1,toast:{id:m,height:y}})},[o]),h=w.useCallback(()=>{s&&o({type:6,time:Date.now()})},[s,o]),f=w.useCallback((m,y)=>{let{reverseOrder:b=!1,gutter:C=8,defaultPosition:S}=y||{},R=e.filter(E=>(E.position||S)===(m.position||S)&&E.height),M=R.findIndex(E=>E.id===m.id),T=R.filter((E,A)=>A<M&&E.visible).length;return R.filter(E=>E.visible).slice(...b?[T+1]:[0,T]).reduce((E,A)=>E+(A.height||0)+C,0)},[e]);return w.useEffect(()=>{e.forEach(m=>{if(m.dismissed)i(m.id,m.removeDelay);else{let y=n.get(m.id);y&&(clearTimeout(y),n.delete(m.id))}})},[e,i]),{toasts:e,handlers:{updateHeight:d,startPause:l,endPause:h,calculateOffset:f}}},UR=ni`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,FR=ni`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,VR=ni`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,QR=qi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${UR} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${FR} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${VR} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,GR=ni`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,KR=qi("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${GR} 1s linear infinite;
`,YR=ni`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,WR=ni`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,XR=qi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${YR} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${WR} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,JR=qi("div")`
  position: absolute;
`,ZR=qi("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,ek=ni`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,tk=qi("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${ek} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,sk=({toast:r})=>{let{icon:t,type:e,iconTheme:s}=r;return t!==void 0?typeof t=="string"?w.createElement(tk,null,t):t:e==="blank"?null:w.createElement(ZR,null,w.createElement(KR,{...s}),e!=="loading"&&w.createElement(JR,null,e==="error"?w.createElement(QR,{...s}):w.createElement(XR,{...s})))},nk=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,ik=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,ak="0%{opacity:0;} 100%{opacity:1;}",ok="0%{opacity:1;} 100%{opacity:0;}",rk=qi("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,ck=qi("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,lk=(r,t)=>{let e=r.includes("top")?1:-1,[s,n]=Wv()?[ak,ok]:[nk(e),ik(e)];return{animation:t?`${ni(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ni(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},uk=w.memo(({toast:r,position:t,style:e,children:s})=>{let n=r.height?lk(r.position||t||"top-center",r.visible):{opacity:0},i=w.createElement(sk,{toast:r}),o=w.createElement(ck,{...r.ariaProps},Ll(r.message,r));return w.createElement(rk,{className:r.className,style:{...n,...e,...r.style}},typeof s=="function"?s({icon:i,message:o}):w.createElement(w.Fragment,null,i,o))});jR(w.createElement);var dk=({id:r,className:t,style:e,onHeightUpdate:s,children:n})=>{let i=w.useCallback(o=>{if(o){let l=()=>{let d=o.getBoundingClientRect().height;s(r,d)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[r,s]);return w.createElement("div",{ref:i,className:t,style:e},n)},hk=(r,t)=>{let e=r.includes("top"),s=e?{top:0}:{bottom:0},n=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Wv()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(e?1:-1)}px)`,...s,...n}},fk=Wl`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dl=16,pk=({reverseOrder:r,position:t="top-center",toastOptions:e,gutter:s,children:n,toasterId:i,containerStyle:o,containerClassName:l})=>{let{toasts:d,handlers:h}=BR(e,i);return w.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:dl,left:dl,right:dl,bottom:dl,pointerEvents:"none",...o},className:l,onMouseEnter:h.startPause,onMouseLeave:h.endPause},d.map(f=>{let m=f.position||t,y=h.calculateOffset(f,{reverseOrder:r,gutter:s,defaultPosition:t}),b=hk(m,y);return w.createElement(dk,{id:f.id,key:f.id,onHeightUpdate:h.updateHeight,className:f.visible?fk:"",style:b},f.type==="custom"?Ll(f.message,f):n?n(f):w.createElement(uk,{toast:f,position:m}))}))},XO=Qt;function F0(r,t){if(typeof r=="function")return r(t);r!=null&&(r.current=t)}function Tn(...r){return t=>{let e=!1;const s=r.map(n=>{const i=F0(n,t);return!e&&typeof i=="function"&&(e=!0),i});if(e)return()=>{for(let n=0;n<s.length;n++){const i=s[n];typeof i=="function"?i():F0(r[n],null)}}}}function je(...r){return w.useCallback(Tn(...r),r)}var gk=Symbol.for("react.lazy"),zl=$f[" use ".trim().toString()];function mk(r){return typeof r=="object"&&r!==null&&"then"in r}function tb(r){return r!=null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===gk&&"_payload"in r&&mk(r._payload)}function Uf(r){const t=vk(r),e=w.forwardRef((s,n)=>{let{children:i,...o}=s;tb(i)&&typeof zl=="function"&&(i=zl(i._payload));const l=w.Children.toArray(i),d=l.find(xk);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}var yk=Uf("Slot");function vk(r){const t=w.forwardRef((e,s)=>{let{children:n,...i}=e;if(tb(n)&&typeof zl=="function"&&(n=zl(n._payload)),w.isValidElement(n)){const o=Ck(n),l=wk(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var bk=Symbol("radix.slottable");function xk(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===bk}function wk(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function Ck(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function sb(r){var t,e,s="";if(typeof r=="string"||typeof r=="number")s+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(t=0;t<n;t++)r[t]&&(e=sb(r[t]))&&(s&&(s+=" "),s+=e)}else for(e in r)r[e]&&(s&&(s+=" "),s+=e);return s}function nb(){for(var r,t,e=0,s="",n=arguments.length;e<n;e++)(r=arguments[e])&&(t=sb(r))&&(s&&(s+=" "),s+=t);return s}const V0=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,Q0=nb,Ff=(r,t)=>e=>{var s;if(t?.variants==null)return Q0(r,e?.class,e?.className);const{variants:n,defaultVariants:i}=t,o=Object.keys(n).map(h=>{const f=e?.[h],m=i?.[h];if(f===null)return null;const y=V0(f)||V0(m);return n[h][y]}),l=e&&Object.entries(e).reduce((h,f)=>{let[m,y]=f;return y===void 0||(h[m]=y),h},{}),d=t==null||(s=t.compoundVariants)===null||s===void 0?void 0:s.reduce((h,f)=>{let{class:m,className:y,...b}=f;return Object.entries(b).every(C=>{let[S,R]=C;return Array.isArray(R)?R.includes({...i,...l}[S]):{...i,...l}[S]===R})?[...h,m,y]:h},[]);return Q0(r,o,d,e?.class,e?.className)},Sk=(r,t)=>{const e=new Array(r.length+t.length);for(let s=0;s<r.length;s++)e[s]=r[s];for(let s=0;s<t.length;s++)e[r.length+s]=t[s];return e},Mk=(r,t)=>({classGroupId:r,validator:t}),ib=(r=new Map,t=null,e)=>({nextPart:r,validators:t,classGroupId:e}),Il="-",G0=[],Rk="arbitrary..",kk=r=>{const t=Tk(r),{conflictingClassGroups:e,conflictingClassGroupModifiers:s}=r;return{getClassGroupId:o=>{if(o.startsWith("[")&&o.endsWith("]"))return Ek(o);const l=o.split(Il),d=l[0]===""&&l.length>1?1:0;return ab(l,d,t)},getConflictingClassGroupIds:(o,l)=>{if(l){const d=s[o],h=e[o];return d?h?Sk(h,d):d:h||G0}return e[o]||G0}}},ab=(r,t,e)=>{if(r.length-t===0)return e.classGroupId;const n=r[t],i=e.nextPart.get(n);if(i){const h=ab(r,t+1,i);if(h)return h}const o=e.validators;if(o===null)return;const l=t===0?r.join(Il):r.slice(t).join(Il),d=o.length;for(let h=0;h<d;h++){const f=o[h];if(f.validator(l))return f.classGroupId}},Ek=r=>r.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=r.slice(1,-1),e=t.indexOf(":"),s=t.slice(0,e);return s?Rk+s:void 0})(),Tk=r=>{const{theme:t,classGroups:e}=r;return Ak(e,t)},Ak=(r,t)=>{const e=ib();for(const s in r){const n=r[s];Vf(n,e,s,t)}return e},Vf=(r,t,e,s)=>{const n=r.length;for(let i=0;i<n;i++){const o=r[i];Dk(o,t,e,s)}},Dk=(r,t,e,s)=>{if(typeof r=="string"){_k(r,t,e);return}if(typeof r=="function"){Nk(r,t,e,s);return}jk(r,t,e,s)},_k=(r,t,e)=>{const s=r===""?t:ob(t,r);s.classGroupId=e},Nk=(r,t,e,s)=>{if(Pk(r)){Vf(r(s),t,e,s);return}t.validators===null&&(t.validators=[]),t.validators.push(Mk(e,r))},jk=(r,t,e,s)=>{const n=Object.entries(r),i=n.length;for(let o=0;o<i;o++){const[l,d]=n[o];Vf(d,ob(t,l),e,s)}},ob=(r,t)=>{let e=r;const s=t.split(Il),n=s.length;for(let i=0;i<n;i++){const o=s[i];let l=e.nextPart.get(o);l||(l=ib(),e.nextPart.set(o,l)),e=l}return e},Pk=r=>"isThemeGetter"in r&&r.isThemeGetter===!0,Lk=r=>{if(r<1)return{get:()=>{},set:()=>{}};let t=0,e=Object.create(null),s=Object.create(null);const n=(i,o)=>{e[i]=o,t++,t>r&&(t=0,s=e,e=Object.create(null))};return{get(i){let o=e[i];if(o!==void 0)return o;if((o=s[i])!==void 0)return n(i,o),o},set(i,o){i in e?e[i]=o:n(i,o)}}},bf="!",K0=":",zk=[],Y0=(r,t,e,s,n)=>({modifiers:r,hasImportantModifier:t,baseClassName:e,maybePostfixModifierPosition:s,isExternal:n}),Ik=r=>{const{prefix:t,experimentalParseClassName:e}=r;let s=n=>{const i=[];let o=0,l=0,d=0,h;const f=n.length;for(let S=0;S<f;S++){const R=n[S];if(o===0&&l===0){if(R===K0){i.push(n.slice(d,S)),d=S+1;continue}if(R==="/"){h=S;continue}}R==="["?o++:R==="]"?o--:R==="("?l++:R===")"&&l--}const m=i.length===0?n:n.slice(d);let y=m,b=!1;m.endsWith(bf)?(y=m.slice(0,-1),b=!0):m.startsWith(bf)&&(y=m.slice(1),b=!0);const C=h&&h>d?h-d:void 0;return Y0(i,b,y,C)};if(t){const n=t+K0,i=s;s=o=>o.startsWith(n)?i(o.slice(n.length)):Y0(zk,!1,o,void 0,!0)}if(e){const n=s;s=i=>e({className:i,parseClassName:n})}return s},Ok=r=>{const t=new Map;return r.orderSensitiveModifiers.forEach((e,s)=>{t.set(e,1e6+s)}),e=>{const s=[];let n=[];for(let i=0;i<e.length;i++){const o=e[i],l=o[0]==="[",d=t.has(o);l||d?(n.length>0&&(n.sort(),s.push(...n),n=[]),s.push(o)):n.push(o)}return n.length>0&&(n.sort(),s.push(...n)),s}},Hk=r=>({cache:Lk(r.cacheSize),parseClassName:Ik(r),sortModifiers:Ok(r),...kk(r)}),qk=/\s+/,$k=(r,t)=>{const{parseClassName:e,getClassGroupId:s,getConflictingClassGroupIds:n,sortModifiers:i}=t,o=[],l=r.trim().split(qk);let d="";for(let h=l.length-1;h>=0;h-=1){const f=l[h],{isExternal:m,modifiers:y,hasImportantModifier:b,baseClassName:C,maybePostfixModifierPosition:S}=e(f);if(m){d=f+(d.length>0?" "+d:d);continue}let R=!!S,M=s(R?C.substring(0,S):C);if(!M){if(!R){d=f+(d.length>0?" "+d:d);continue}if(M=s(C),!M){d=f+(d.length>0?" "+d:d);continue}R=!1}const T=y.length===0?"":y.length===1?y[0]:i(y).join(":"),E=b?T+bf:T,A=E+M;if(o.indexOf(A)>-1)continue;o.push(A);const _=n(M,R);for(let N=0;N<_.length;++N){const z=_[N];o.push(E+z)}d=f+(d.length>0?" "+d:d)}return d},Bk=(...r)=>{let t=0,e,s,n="";for(;t<r.length;)(e=r[t++])&&(s=rb(e))&&(n&&(n+=" "),n+=s);return n},rb=r=>{if(typeof r=="string")return r;let t,e="";for(let s=0;s<r.length;s++)r[s]&&(t=rb(r[s]))&&(e&&(e+=" "),e+=t);return e},Uk=(r,...t)=>{let e,s,n,i;const o=d=>{const h=t.reduce((f,m)=>m(f),r());return e=Hk(h),s=e.cache.get,n=e.cache.set,i=l,l(d)},l=d=>{const h=s(d);if(h)return h;const f=$k(d,e);return n(d,f),f};return i=o,(...d)=>i(Bk(...d))},Fk=[],Ft=r=>{const t=e=>e[r]||Fk;return t.isThemeGetter=!0,t},cb=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,lb=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Vk=/^\d+\/\d+$/,Qk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Gk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Kk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Yk=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Wk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,lo=r=>Vk.test(r),qe=r=>!!r&&!Number.isNaN(Number(r)),Ni=r=>!!r&&Number.isInteger(Number(r)),Wh=r=>r.endsWith("%")&&qe(r.slice(0,-1)),ei=r=>Qk.test(r),Xk=()=>!0,Jk=r=>Gk.test(r)&&!Kk.test(r),ub=()=>!1,Zk=r=>Yk.test(r),eE=r=>Wk.test(r),tE=r=>!we(r)&&!Ce(r),sE=r=>Mo(r,fb,ub),we=r=>cb.test(r),ua=r=>Mo(r,pb,Jk),Xh=r=>Mo(r,rE,qe),W0=r=>Mo(r,db,ub),nE=r=>Mo(r,hb,eE),hl=r=>Mo(r,gb,Zk),Ce=r=>lb.test(r),Sr=r=>Ro(r,pb),iE=r=>Ro(r,cE),X0=r=>Ro(r,db),aE=r=>Ro(r,fb),oE=r=>Ro(r,hb),fl=r=>Ro(r,gb,!0),Mo=(r,t,e)=>{const s=cb.exec(r);return s?s[1]?t(s[1]):e(s[2]):!1},Ro=(r,t,e=!1)=>{const s=lb.exec(r);return s?s[1]?t(s[1]):e:!1},db=r=>r==="position"||r==="percentage",hb=r=>r==="image"||r==="url",fb=r=>r==="length"||r==="size"||r==="bg-size",pb=r=>r==="length",rE=r=>r==="number",cE=r=>r==="family-name",gb=r=>r==="shadow",lE=()=>{const r=Ft("color"),t=Ft("font"),e=Ft("text"),s=Ft("font-weight"),n=Ft("tracking"),i=Ft("leading"),o=Ft("breakpoint"),l=Ft("container"),d=Ft("spacing"),h=Ft("radius"),f=Ft("shadow"),m=Ft("inset-shadow"),y=Ft("text-shadow"),b=Ft("drop-shadow"),C=Ft("blur"),S=Ft("perspective"),R=Ft("aspect"),M=Ft("ease"),T=Ft("animate"),E=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],_=()=>[...A(),Ce,we],N=()=>["auto","hidden","clip","visible","scroll"],z=()=>["auto","contain","none"],q=()=>[Ce,we,d],Z=()=>[lo,"full","auto",...q()],ne=()=>[Ni,"none","subgrid",Ce,we],ce=()=>["auto",{span:["full",Ni,Ce,we]},Ni,Ce,we],J=()=>[Ni,"auto",Ce,we],te=()=>["auto","min","max","fr",Ce,we],le=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],ue=()=>["start","end","center","stretch","center-safe","end-safe"],L=()=>["auto",...q()],j=()=>[lo,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...q()],O=()=>[r,Ce,we],W=()=>[...A(),X0,W0,{position:[Ce,we]}],fe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],P=()=>["auto","cover","contain",aE,sE,{size:[Ce,we]}],F=()=>[Wh,Sr,ua],Y=()=>["","none","full",h,Ce,we],ie=()=>["",qe,Sr,ua],U=()=>["solid","dashed","dotted","double"],ae=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],B=()=>[qe,Wh,X0,W0],G=()=>["","none",C,Ce,we],pe=()=>["none",qe,Ce,we],me=()=>["none",qe,Ce,we],ye=()=>[qe,Ce,we],ve=()=>[lo,"full",...q()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ei],breakpoint:[ei],color:[Xk],container:[ei],"drop-shadow":[ei],ease:["in","out","in-out"],font:[tE],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ei],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ei],shadow:[ei],spacing:["px",qe],text:[ei],"text-shadow":[ei],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",lo,we,Ce,R]}],container:["container"],columns:[{columns:[qe,we,Ce,l]}],"break-after":[{"break-after":E()}],"break-before":[{"break-before":E()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:_()}],overflow:[{overflow:N()}],"overflow-x":[{"overflow-x":N()}],"overflow-y":[{"overflow-y":N()}],overscroll:[{overscroll:z()}],"overscroll-x":[{"overscroll-x":z()}],"overscroll-y":[{"overscroll-y":z()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Z()}],"inset-x":[{"inset-x":Z()}],"inset-y":[{"inset-y":Z()}],start:[{start:Z()}],end:[{end:Z()}],top:[{top:Z()}],right:[{right:Z()}],bottom:[{bottom:Z()}],left:[{left:Z()}],visibility:["visible","invisible","collapse"],z:[{z:[Ni,"auto",Ce,we]}],basis:[{basis:[lo,"full","auto",l,...q()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[qe,lo,"auto","initial","none",we]}],grow:[{grow:["",qe,Ce,we]}],shrink:[{shrink:["",qe,Ce,we]}],order:[{order:[Ni,"first","last","none",Ce,we]}],"grid-cols":[{"grid-cols":ne()}],"col-start-end":[{col:ce()}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":ne()}],"row-start-end":[{row:ce()}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":te()}],"auto-rows":[{"auto-rows":te()}],gap:[{gap:q()}],"gap-x":[{"gap-x":q()}],"gap-y":[{"gap-y":q()}],"justify-content":[{justify:[...le(),"normal"]}],"justify-items":[{"justify-items":[...ue(),"normal"]}],"justify-self":[{"justify-self":["auto",...ue()]}],"align-content":[{content:["normal",...le()]}],"align-items":[{items:[...ue(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...ue(),{baseline:["","last"]}]}],"place-content":[{"place-content":le()}],"place-items":[{"place-items":[...ue(),"baseline"]}],"place-self":[{"place-self":["auto",...ue()]}],p:[{p:q()}],px:[{px:q()}],py:[{py:q()}],ps:[{ps:q()}],pe:[{pe:q()}],pt:[{pt:q()}],pr:[{pr:q()}],pb:[{pb:q()}],pl:[{pl:q()}],m:[{m:L()}],mx:[{mx:L()}],my:[{my:L()}],ms:[{ms:L()}],me:[{me:L()}],mt:[{mt:L()}],mr:[{mr:L()}],mb:[{mb:L()}],ml:[{ml:L()}],"space-x":[{"space-x":q()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":q()}],"space-y-reverse":["space-y-reverse"],size:[{size:j()}],w:[{w:[l,"screen",...j()]}],"min-w":[{"min-w":[l,"screen","none",...j()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[o]},...j()]}],h:[{h:["screen","lh",...j()]}],"min-h":[{"min-h":["screen","lh","none",...j()]}],"max-h":[{"max-h":["screen","lh",...j()]}],"font-size":[{text:["base",e,Sr,ua]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,Ce,Xh]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Wh,we]}],"font-family":[{font:[iE,we,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,Ce,we]}],"line-clamp":[{"line-clamp":[qe,"none",Ce,Xh]}],leading:[{leading:[i,...q()]}],"list-image":[{"list-image":["none",Ce,we]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ce,we]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[qe,"from-font","auto",Ce,ua]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[qe,"auto",Ce,we]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:q()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ce,we]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ce,we]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:W()}],"bg-repeat":[{bg:fe()}],"bg-size":[{bg:P()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Ni,Ce,we],radial:["",Ce,we],conic:[Ni,Ce,we]},oE,nE]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:F()}],"gradient-via-pos":[{via:F()}],"gradient-to-pos":[{to:F()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:ie()}],"border-w-x":[{"border-x":ie()}],"border-w-y":[{"border-y":ie()}],"border-w-s":[{"border-s":ie()}],"border-w-e":[{"border-e":ie()}],"border-w-t":[{"border-t":ie()}],"border-w-r":[{"border-r":ie()}],"border-w-b":[{"border-b":ie()}],"border-w-l":[{"border-l":ie()}],"divide-x":[{"divide-x":ie()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ie()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[qe,Ce,we]}],"outline-w":[{outline:["",qe,Sr,ua]}],"outline-color":[{outline:O()}],shadow:[{shadow:["","none",f,fl,hl]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",m,fl,hl]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[qe,ua]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":ie()}],"inset-ring-color":[{"inset-ring":O()}],"text-shadow":[{"text-shadow":["none",y,fl,hl]}],"text-shadow-color":[{"text-shadow":O()}],opacity:[{opacity:[qe,Ce,we]}],"mix-blend":[{"mix-blend":[...ae(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ae()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[qe]}],"mask-image-linear-from-pos":[{"mask-linear-from":B()}],"mask-image-linear-to-pos":[{"mask-linear-to":B()}],"mask-image-linear-from-color":[{"mask-linear-from":O()}],"mask-image-linear-to-color":[{"mask-linear-to":O()}],"mask-image-t-from-pos":[{"mask-t-from":B()}],"mask-image-t-to-pos":[{"mask-t-to":B()}],"mask-image-t-from-color":[{"mask-t-from":O()}],"mask-image-t-to-color":[{"mask-t-to":O()}],"mask-image-r-from-pos":[{"mask-r-from":B()}],"mask-image-r-to-pos":[{"mask-r-to":B()}],"mask-image-r-from-color":[{"mask-r-from":O()}],"mask-image-r-to-color":[{"mask-r-to":O()}],"mask-image-b-from-pos":[{"mask-b-from":B()}],"mask-image-b-to-pos":[{"mask-b-to":B()}],"mask-image-b-from-color":[{"mask-b-from":O()}],"mask-image-b-to-color":[{"mask-b-to":O()}],"mask-image-l-from-pos":[{"mask-l-from":B()}],"mask-image-l-to-pos":[{"mask-l-to":B()}],"mask-image-l-from-color":[{"mask-l-from":O()}],"mask-image-l-to-color":[{"mask-l-to":O()}],"mask-image-x-from-pos":[{"mask-x-from":B()}],"mask-image-x-to-pos":[{"mask-x-to":B()}],"mask-image-x-from-color":[{"mask-x-from":O()}],"mask-image-x-to-color":[{"mask-x-to":O()}],"mask-image-y-from-pos":[{"mask-y-from":B()}],"mask-image-y-to-pos":[{"mask-y-to":B()}],"mask-image-y-from-color":[{"mask-y-from":O()}],"mask-image-y-to-color":[{"mask-y-to":O()}],"mask-image-radial":[{"mask-radial":[Ce,we]}],"mask-image-radial-from-pos":[{"mask-radial-from":B()}],"mask-image-radial-to-pos":[{"mask-radial-to":B()}],"mask-image-radial-from-color":[{"mask-radial-from":O()}],"mask-image-radial-to-color":[{"mask-radial-to":O()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":A()}],"mask-image-conic-pos":[{"mask-conic":[qe]}],"mask-image-conic-from-pos":[{"mask-conic-from":B()}],"mask-image-conic-to-pos":[{"mask-conic-to":B()}],"mask-image-conic-from-color":[{"mask-conic-from":O()}],"mask-image-conic-to-color":[{"mask-conic-to":O()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:W()}],"mask-repeat":[{mask:fe()}],"mask-size":[{mask:P()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ce,we]}],filter:[{filter:["","none",Ce,we]}],blur:[{blur:G()}],brightness:[{brightness:[qe,Ce,we]}],contrast:[{contrast:[qe,Ce,we]}],"drop-shadow":[{"drop-shadow":["","none",b,fl,hl]}],"drop-shadow-color":[{"drop-shadow":O()}],grayscale:[{grayscale:["",qe,Ce,we]}],"hue-rotate":[{"hue-rotate":[qe,Ce,we]}],invert:[{invert:["",qe,Ce,we]}],saturate:[{saturate:[qe,Ce,we]}],sepia:[{sepia:["",qe,Ce,we]}],"backdrop-filter":[{"backdrop-filter":["","none",Ce,we]}],"backdrop-blur":[{"backdrop-blur":G()}],"backdrop-brightness":[{"backdrop-brightness":[qe,Ce,we]}],"backdrop-contrast":[{"backdrop-contrast":[qe,Ce,we]}],"backdrop-grayscale":[{"backdrop-grayscale":["",qe,Ce,we]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[qe,Ce,we]}],"backdrop-invert":[{"backdrop-invert":["",qe,Ce,we]}],"backdrop-opacity":[{"backdrop-opacity":[qe,Ce,we]}],"backdrop-saturate":[{"backdrop-saturate":[qe,Ce,we]}],"backdrop-sepia":[{"backdrop-sepia":["",qe,Ce,we]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":q()}],"border-spacing-x":[{"border-spacing-x":q()}],"border-spacing-y":[{"border-spacing-y":q()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ce,we]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[qe,"initial",Ce,we]}],ease:[{ease:["linear","initial",M,Ce,we]}],delay:[{delay:[qe,Ce,we]}],animate:[{animate:["none",T,Ce,we]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[S,Ce,we]}],"perspective-origin":[{"perspective-origin":_()}],rotate:[{rotate:pe()}],"rotate-x":[{"rotate-x":pe()}],"rotate-y":[{"rotate-y":pe()}],"rotate-z":[{"rotate-z":pe()}],scale:[{scale:me()}],"scale-x":[{"scale-x":me()}],"scale-y":[{"scale-y":me()}],"scale-z":[{"scale-z":me()}],"scale-3d":["scale-3d"],skew:[{skew:ye()}],"skew-x":[{"skew-x":ye()}],"skew-y":[{"skew-y":ye()}],transform:[{transform:[Ce,we,"","none","gpu","cpu"]}],"transform-origin":[{origin:_()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ve()}],"translate-x":[{"translate-x":ve()}],"translate-y":[{"translate-y":ve()}],"translate-z":[{"translate-z":ve()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ce,we]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":q()}],"scroll-mx":[{"scroll-mx":q()}],"scroll-my":[{"scroll-my":q()}],"scroll-ms":[{"scroll-ms":q()}],"scroll-me":[{"scroll-me":q()}],"scroll-mt":[{"scroll-mt":q()}],"scroll-mr":[{"scroll-mr":q()}],"scroll-mb":[{"scroll-mb":q()}],"scroll-ml":[{"scroll-ml":q()}],"scroll-p":[{"scroll-p":q()}],"scroll-px":[{"scroll-px":q()}],"scroll-py":[{"scroll-py":q()}],"scroll-ps":[{"scroll-ps":q()}],"scroll-pe":[{"scroll-pe":q()}],"scroll-pt":[{"scroll-pt":q()}],"scroll-pr":[{"scroll-pr":q()}],"scroll-pb":[{"scroll-pb":q()}],"scroll-pl":[{"scroll-pl":q()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ce,we]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[qe,Sr,ua,Xh]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},uE=Uk(lE);function ke(...r){return uE(nb(r))}function JO(r,t){return r?{...t,...r}:t}const Qf=Ff("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ee=w.forwardRef(({className:r,variant:t,size:e,asChild:s=!1,...n},i)=>{const o=s?yk:"button";return g.jsx(o,{className:ke(Qf({variant:t,size:e,className:r})),ref:i,...n})});Ee.displayName="Button";var qr=Gv();const dE=Hf(qr);var hE=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],fE=hE.reduce((r,t)=>{const e=Uf(`Primitive.${t}`),s=w.forwardRef((n,i)=>{const{asChild:o,...l}=n,d=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:i})});return s.displayName=`Primitive.${t}`,{...r,[t]:s}},{}),pE="Separator",J0="horizontal",gE=["horizontal","vertical"],mb=w.forwardRef((r,t)=>{const{decorative:e,orientation:s=J0,...n}=r,i=mE(s)?s:J0,l=e?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return g.jsx(fE.div,{"data-orientation":i,...l,...n,ref:t})});mb.displayName=pE;function mE(r){return gE.includes(r)}var yb=mb;const bs=w.forwardRef(({className:r,orientation:t="horizontal",decorative:e=!0,...s},n)=>g.jsx(yb,{ref:n,decorative:e,orientation:t,className:ke("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...s}));bs.displayName=yb.displayName;const Z0=r=>{let t;const e=new Set,s=(h,f)=>{const m=typeof h=="function"?h(t):h;if(!Object.is(m,t)){const y=t;t=f??(typeof m!="object"||m===null)?m:Object.assign({},t,m),e.forEach(b=>b(t,y))}},n=()=>t,l={setState:s,getState:n,getInitialState:()=>d,subscribe:h=>(e.add(h),()=>e.delete(h))},d=t=r(s,n,l);return l},yE=(r=>r?Z0(r):Z0),vE=r=>r;function bE(r,t=vE){const e=Et.useSyncExternalStore(r.subscribe,Et.useCallback(()=>t(r.getState()),[r,t]),Et.useCallback(()=>t(r.getInitialState()),[r,t]));return Et.useDebugValue(e),e}const ev=r=>{const t=yE(r),e=s=>bE(t,s);return Object.assign(e,t),e},un=(r=>r?ev(r):ev);class xE{nodes=[];connections=[];handlers=new Map;postgresQueryEngine=null;messageQueue=new Map;messageHistory=[];isRunning=!1;updateInterval=200;intervalId=null;messageIdCounter=0;MAX_HISTORY=1e3;traceContexts=new Map;traceIdCounter=0;constructor(){this.registerDefaultHandlers()}registerDefaultHandlers(){this.registerHandler("crm",this.createBusinessDataHandler("crm")),this.registerHandler("erp",this.createBusinessDataHandler("erp")),this.registerHandler("payment-gateway",this.createBusinessDataHandler("payment")),this.registerHandler("postgres",this.createDatabaseHandler("postgres")),this.registerHandler("mongodb",this.createDatabaseHandler("mongodb")),this.registerHandler("redis",this.createDatabaseHandler("redis")),this.registerHandler("cassandra",this.createDatabaseHandler("cassandra")),this.registerHandler("clickhouse",this.createDatabaseHandler("clickhouse")),this.registerHandler("snowflake",this.createDatabaseHandler("snowflake")),this.registerHandler("elasticsearch",this.createDatabaseHandler("elasticsearch")),this.registerHandler("s3-datalake",this.createStorageHandler("s3-datalake")),this.registerHandler("kafka",this.createMessageBrokerHandler("kafka")),this.registerHandler("rabbitmq",this.createMessageBrokerHandler("rabbitmq")),this.registerHandler("activemq",this.createMessageBrokerHandler("activemq")),this.registerHandler("aws-sqs",this.createMessageBrokerHandler("aws-sqs")),this.registerHandler("gcp-pubsub",this.createMessageBrokerHandler("gcp-pubsub")),this.registerHandler("rest",this.createAPIHandler("rest")),this.registerHandler("grpc",this.createAPIHandler("grpc")),this.registerHandler("graphql",this.createAPIHandler("graphql")),this.registerHandler("websocket",this.createAPIHandler("websocket")),this.registerHandler("kong",this.createIntegrationHandler("kong")),this.registerHandler("nginx",this.createIntegrationHandler("nginx")),this.registerHandler("haproxy",this.createIntegrationHandler("haproxy")),this.registerHandler("traefik",this.createIntegrationHandler("traefik")),this.registerHandler("envoy",this.createIntegrationHandler("envoy")),this.registerHandler("apigee",this.createIntegrationHandler("apigee")),this.registerHandler("mulesoft",this.createIntegrationHandler("mulesoft")),this.registerHandler("graphql-gateway",this.createIntegrationHandler("graphql-gateway")),this.registerHandler("bff-service",this.createIntegrationHandler("bff-service")),this.registerHandler("webhook-relay",this.createIntegrationHandler("webhook-relay")),this.registerHandler("loki",this.createLokiHandler()),this.registerHandler("otel-collector",this.createOpenTelemetryCollectorHandler()),this.registerHandler("keycloak",this.createKeycloakHandler()),this.registerHandler("secrets-vault",this.createVaultHandler()),this.registerHandler("waf",this.createWAFHandler()),this.registerHandler("firewall",this.createFirewallHandler()),this.registerHandler("ids-ips",this.createIDSIPSHandler()),this.registerHandler("jenkins",this.createJenkinsHandler()),this.registerHandler("gitlab-ci",this.createGitLabCIHandler()),this.registerHandler("argo-cd",this.createArgoCDHandler()),this.registerHandler("terraform",this.createTerraformHandler()),this.registerHandler("harbor",this.createHarborHandler()),this.registerHandler("docker",this.createDockerHandler())}registerHandler(t,e){this.handlers.set(t,e)}initialize(t,e){this.nodes=t,this.connections=e,this.messageQueue.clear(),this.messageHistory=[];for(const s of e)this.messageQueue.set(s.id,[])}updateNodesAndConnections(t,e){this.nodes=t,this.connections=e;const s=new Set(e.map(n=>n.id));for(const[n]of this.messageQueue.entries())s.has(n)||this.messageQueue.delete(n);for(const n of e)this.messageQueue.has(n.id)||this.messageQueue.set(n.id,[])}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.processDataFlow()},this.updateInterval))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}processDataFlow(){this.generateSourceData(),this.processInTransitMessages(),this.deliverMessages()}generateSourceData(){for(const t of this.connections){const e=this.nodes.find(o=>o.id===t.source);if(!e)continue;const s=this.handlers.get(e.type);if(!s?.generateData)continue;const n=e.data.config||{},i=s.generateData(e,n);if(i&&i.length>0){const o=this.messageQueue.get(t.id)||[];for(const l of i)l.connectionId=t.id,l.target=t.target,l.status="pending",l.id=`msg-${++this.messageIdCounter}`,l.timestamp=Date.now(),o.push(l);this.messageQueue.set(t.id,o)}}}processInTransitMessages(){for(const[t,e]of this.messageQueue.entries()){const s=this.connections.find(o=>o.id===t);if(!s)continue;const n=this.nodes.find(o=>o.id===s.source),i=this.nodes.find(o=>o.id===s.target);if(!(!n||!i)){for(const o of e)if(o.status==="pending")this.transformMessageIfNeeded(o,n,i,s)&&(o.status="in-transit",o.latency=this.calculateTransitTime(s));else if(o.status==="in-transit"){const l=Date.now()-o.timestamp;o.latency&&l>=o.latency&&(o.status="delivered")}}}}deliverMessages(){for(const[t,e]of this.messageQueue.entries()){const s=this.connections.find(d=>d.id===t);if(!s)continue;const n=this.nodes.find(d=>d.id===s.target);if(!n)continue;const i=this.handlers.get(n.type);if(!i?.processData)continue;const o=n.data.config||{},l=e.filter(d=>d.status==="delivered");for(const d of l)try{const h=this.nodes.find(m=>m.id===s.source),f=i.processData(n,d,o);f&&(h&&this.generateTraceForMessage(d,h,n,s,f),this.addToHistory(d),e.splice(e.indexOf(d),1))}catch(h){d.status="failed",d.error=h instanceof Error?h.message:"Unknown error";const f=this.nodes.find(m=>m.id===s.source);f&&this.generateTraceForMessage(d,f,n,s,d),this.addToHistory(d),e.splice(e.indexOf(d),1)}this.messageQueue.set(t,e)}}transformMessageIfNeeded(t,e,s,n){const i=this.handlers.get(e.type),o=this.handlers.get(s.type),l=i?.getSupportedFormats?.(e)||[t.format],d=o?.getSupportedFormats?.(s)||[t.format];if(d.includes(t.format))return t;const h=d.find(m=>l.includes(m));if(h)return t.format=h,t.status="transformed",t;const f=this.findIntegrationHandler(n);if(f?.transformData){const m=f.transformData(e,t,s.type,e.data.config||{});if(m)return m}if(i?.transformData){const m=i.transformData(e,t,s.type,e.data.config||{});if(m)return m}return t.status="failed",t.error=`Format ${t.format} not supported by target ${s.type}`,null}findIntegrationHandler(t){const e=this.nodes.find(s=>s.id===t.source);return e&&["kong","apigee","mulesoft","bff-service"].includes(e.type)&&this.handlers.get(e.type)||null}calculateTransitTime(t){const e=t.data||{},s=e.latencyMs||10,n=(e.jitterMs||0)*(Math.random()-.5);return Math.max(1,s+n)}generateTraceForMessage(t,e,s,n,i){const o=Ae.getAllJaegerEngines();if(o.size===0)return;let l=t.metadata?.traceContext;if(!l){const b=this.generateTraceId(),C=this.generateSpanId();l={traceId:b,spanId:C,sampled:!0},this.traceContexts.set(b,l)}const d=t.timestamp*1e3,h=(t.timestamp+(t.latency||0))*1e3,f=h-d,m=this.getOperationName(t,e,s),y={traceId:l.traceId,spanId:l.spanId,parentSpanId:l.parentSpanId,operationName:m,serviceName:e.data.label||e.type,startTime:d,duration:f,tags:[{key:"component.type",value:e.type},{key:"target.component",value:s.data.label||s.type},{key:"target.type",value:s.type},{key:"message.format",value:t.format},{key:"message.size",value:t.size},{key:"connection.id",value:n.id},{key:"status",value:i.status}],logs:[]};if((i.status==="failed"||i.error)&&(y.tags.push({key:"error",value:!0}),y.logs.push({timestamp:h,fields:[{key:"event",value:"error"},{key:"error.message",value:i.error||"Unknown error"}]})),t.metadata)for(const[b,C]of Object.entries(t.metadata))b!=="traceContext"&&C!==void 0&&C!==null&&y.tags.push({key:`metadata.${b}`,value:String(C)});for(const[,b]of o)b.receiveSpan(y);if(i.status==="delivered"&&s){const b=this.generateSpanId(),C={traceId:l.traceId,spanId:b,parentSpanId:l.spanId,sampled:l.sampled};i.metadata||(i.metadata={}),i.metadata.traceContext=C}}generateTraceId(){return`trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getOperationName(t,e,s){return t.metadata?.operation?String(t.metadata.operation):e.type==="api-gateway"||e.type==="kong"||e.type==="apigee"?`HTTP ${t.metadata?.method||"REQUEST"}`:e.type.includes("database")||e.type==="postgres"||e.type==="mongodb"?`DB ${t.metadata?.queryType||"QUERY"}`:e.type.includes("queue")||e.type==="rabbitmq"||e.type==="kafka"?`MQ ${t.metadata?.queue||"SEND"}`:`${e.type} -> ${s.type}`}addToHistory(t){this.messageHistory.push(t),this.messageHistory.length>this.MAX_HISTORY&&this.messageHistory.shift()}getConnectionMessages(t){return this.messageQueue.get(t)||[]}getMessageHistory(t){const e=[...this.messageHistory].reverse();return t?e.slice(0,t):e}getComponentMessages(t){const e=[];for(const s of this.messageQueue.values())for(const n of s)(n.source===t||n.target===t)&&e.push(n);return e}createBusinessDataHandler(t){return{generateData:(e,s)=>{const n=[],i=s.generateInterval||2e3,o=e._lastGenerate||0,l=Date.now();if(l-o<i)return null;switch(e._lastGenerate=l,t){case"crm":n.push(this.createCRMDataMessage(e));break;case"erp":n.push(this.createERPDataMessage(e));break;case"payment":n.push(this.createPaymentDataMessage(e));break}return n},getSupportedFormats:()=>["json","xml"]}}validateMongoDBSchema(t,e){if(!e||!e.$jsonSchema)return{valid:!0};const s=e.$jsonSchema;if(s.required&&Array.isArray(s.required)){for(const n of s.required)if(!(n in t)||t[n]===void 0||t[n]===null)return{valid:!1,error:`Required field "${n}" is missing`}}if(s.properties){for(const[n,i]of Object.entries(s.properties))if(n in t){const o=t[n],l=i;if(l.type){const d=l.type,h=Array.isArray(o)?"array":typeof o;if(d==="string"&&h!=="string")return{valid:!1,error:`Field "${n}" must be of type string`};if(d==="number"&&h!=="number")return{valid:!1,error:`Field "${n}" must be of type number`};if(d==="boolean"&&h!=="boolean")return{valid:!1,error:`Field "${n}" must be of type boolean`};if(d==="array"&&h!=="array")return{valid:!1,error:`Field "${n}" must be of type array`};if(d==="object"&&(h!=="object"||Array.isArray(o)))return{valid:!1,error:`Field "${n}" must be of type object`}}}}return{valid:!0}}createDatabaseHandler(t){return{processData:(e,s,n)=>{if(t==="postgres"&&s.payload?.sql)return this.processPostgreSQLQuery(e,s,n);if(t==="redis")return this.processRedisCommand(e,s,n);if(t==="cassandra")return this.processCQLQuery(e,s,n);if(t==="clickhouse")return this.processClickHouseQuery(e,s,n);if(t==="snowflake")return this.processSnowflakeQuery(e,s,n);if(t==="elasticsearch")return this.processElasticsearchOperation(e,s,n);const i=s.payload?.operation||"insert";switch(i){case"insert":case"update":{const l=n.queryLatency||10;if(s.latency=l,t==="mongodb"){const h=e.data.config?.collections||[],f=s.payload;let m=f?.collection;if(!m&&h.length>0&&(f?.type?m=h.find(b=>b.name.toLowerCase().includes(f.type.toLowerCase()))?.name||h[0].name:m=h[0].name),m){const y=h.find(b=>b.name===m);if(y){if(y.validation){const b=y.validation;if(b.validationLevel!=="off"){const S={...f?.document||f?.data||f};delete S._id;const R=this.validateMongoDBSchema(S,b.validator);if(!R.valid){if(b.validationAction==="error")return s.status="failed",s.error=`Schema validation failed for collection "${m}": ${R.error}`,s;b.validationAction==="warn"&&(s.metadata={...s.metadata,validationWarning:R.error,collection:m})}}}i==="insert"?s.metadata={...s.metadata,collection:m,documentStored:!0}:i==="update"&&(s.metadata={...s.metadata,collection:m,documentUpdated:!0})}else return s.status="failed",s.error=`Collection "${m}" not found`,s}}return s.status="delivered",s}case"delete":const o=n.queryLatency||10;return s.latency=o,s.status="delivered",s;case"query":{let l=[];if(t==="mongodb"){const h=e.data.config?.collections||[],f=s.payload,m=f?.collection||h[0]?.name;if(m){const y=h.find(b=>b.name===m);if(y?.documents&&y.documents.length>0){if(l=y.documents.map(C=>({...C})),f?.filter)try{const C=typeof f.filter=="string"?JSON.parse(f.filter):f.filter;l=l.filter(S=>{for(const[R,M]of Object.entries(C))if(S[R]!==M)return!1;return!0})}catch{}const b=f?.limit||100;l=l.slice(0,b)}else l=this.generateQueryResults(t,f?.query)}else l=this.generateQueryResults(t,f?.query)}else l=this.generateQueryResults(t,s.payload?.query);return s.payload={...s.payload,results:l},s.status="delivered",s}default:return s.status="failed",s.error=`Unknown operation: ${i}`,s}},getSupportedFormats:()=>["json","binary"]}}processClickHouseQuery(t,e,s){const n=e.payload,i=Ae.getClickHouseRoutingEngine(t.id);if(!i)return e.status="failed",e.error="ClickHouse Routing Engine not initialized",e;let o;if(n?.sql)o=n.sql;else if(n?.query)o=n.query;else if(typeof n=="string")o=n;else{const d=n?.operation||"select",h=t.data.config,f=n?.database||h?.database||"default",m=n?.table||"default_table";switch(d.toLowerCase()){case"select":case"read":case"query":o=`SELECT * FROM ${f}.${m}`,n?.where&&(o+=` WHERE ${n.where}`),n?.limit&&(o+=` LIMIT ${n.limit}`);break;case"insert":case"write":const y=n?.columns?Object.keys(n.columns).join(", "):"id, data",b=n?.columns?Object.values(n.columns).map(C=>`'${C}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${f}.${m} (${y}) VALUES (${b})`;break;default:return e.status="failed",e.error=`Unknown ClickHouse operation: ${d}`,e}}const l=i.executeQuery(o);return l.success?(e.status="delivered",e.latency=l.latency||45,e.payload={...e.payload,sql:o,rows:l.rows||[],rowCount:l.rowCount||0,columns:l.columns||[],dataRead:l.dataRead,dataWritten:l.dataWritten,clickHouseResult:l.rows},e.metadata={...e.metadata,clickHouseQuery:o,rowsRead:l.dataRead,rowsWritten:l.dataWritten}):(e.status="failed",e.error=l.error||"ClickHouse query execution failed",e.latency=l.latency||0),e}processSnowflakeQuery(t,e,s){const n=e.payload,i=Ae.getSnowflakeRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Snowflake Routing Engine not initialized",e;let o,l,d,h;if(n?.sql)o=n.sql,l=n.warehouse,d=n.database,h=n.schema;else if(n?.query)o=n.query,l=n.warehouse,d=n.database,h=n.schema;else if(typeof n=="string")o=n;else{const m=n?.operation||"select",y=t.data.config;d=n?.database||y?.database||"PUBLIC",h=n?.schema||y?.schema||"PUBLIC",l=n?.warehouse||y?.warehouse;const b=n?.table||"default_table";switch(m.toLowerCase()){case"select":case"read":case"query":o=`SELECT * FROM ${d}.${h}.${b}`,n?.where&&(o+=` WHERE ${n.where}`),n?.limit&&(o+=` LIMIT ${n.limit}`);break;case"insert":case"write":const C=n?.columns?Object.keys(n.columns).join(", "):"id, data",S=n?.columns?Object.values(n.columns).map(R=>`'${R}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${d}.${h}.${b} (${C}) VALUES (${S})`;break;default:return e.status="failed",e.error=`Unknown Snowflake operation: ${m}`,e}}const f=i.executeQuery(o,l,d,h);return f.success?(e.status="delivered",e.latency=f.latency||50,e.payload={...e.payload,sql:o,rows:f.rows||[],rowCount:f.rowCount||0,columns:f.columns||[],dataRead:f.dataRead,dataWritten:f.dataWritten,snowflakeResult:f.rows,queryId:f.queryId,warehouse:f.warehouse,resultCacheUsed:f.resultCacheUsed},e.metadata={...e.metadata,snowflakeQuery:o,rowsRead:f.dataRead,rowsWritten:f.dataWritten,warehouse:f.warehouse,queryId:f.queryId,cacheHit:f.resultCacheUsed||!1}):(e.status="failed",e.error=f.error||"Snowflake query execution failed",e.latency=f.latency||0),e}processElasticsearchOperation(t,e,s){const n=e.payload,i=Ae.getElasticsearchRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Elasticsearch Routing Engine not initialized",e;const o=n?.operation||n?.method||"index",l=n?.index||n?._index||t.data.config?.index||"archiphoenix-index",d=n?.id||n?._id,h=n?.document||n?._source||n?.body||n,f=n?.query,m=n?.routing||n?._routing;let y;switch(o.toLowerCase()){case"index":case"create":case"update":if(!d||!h)return e.status="failed",e.error="Index operation requires id and document",e;y=i.indexDocument(l,d,h,m);break;case"get":case"read":if(!d)return e.status="failed",e.error="Get operation requires id",e;y=i.getDocument(l,d,m);break;case"search":case"query":f?y=i.search(l,f):n?.queryString?y=i.executeQuery(n.queryString):y=i.search(l,{query:{match_all:{}}});break;case"delete":if(!d)return e.status="failed",e.error="Delete operation requires id",e;y=i.deleteDocument(l,d,m);break;default:if(typeof n=="string"||n?.queryString){const b=typeof n=="string"?n:n.queryString;y=i.executeQuery(b)}else return e.status="failed",e.error=`Unsupported Elasticsearch operation: ${o}`,e}return y.success?(e.status="delivered",e.latency=y.latency||y.took||10,e.payload={...e.payload,operation:y.operation,index:y.index,id:y.id,document:y.document,hits:y.hits,took:y.took,elasticsearchResult:y},e.metadata={...e.metadata,elasticsearchOperation:y.operation,index:y.index,hits:y.hits,took:y.took}):(e.status="failed",e.error=y.error||"Elasticsearch operation failed",e.latency=y.latency||y.took||0),e}createStorageHandler(t){return t==="s3-datalake"?{processData:(e,s,n)=>this.processS3Operation(e,s,n),getSupportedFormats:()=>["json","binary","text","xml"]}:{processData:(e,s,n)=>(s.status="delivered",s.latency=50,s),getSupportedFormats:()=>["json","binary","text"]}}processS3Operation(t,e,s){const n=e.payload,i=Ae.getS3RoutingEngine(t.id);if(!i)return e.status="failed",e.error="S3 Routing Engine not initialized",e;const o=n?.operation||n?.method||"PUT",l=n?.bucket||n?.bucketName||t.data.config?.buckets?.[0]?.name||"default-bucket",d=n?.key||n?.objectKey||e.metadata?.key,h=n?.versionId||e.metadata?.versionId;let f;switch(o.toUpperCase()){case"PUT":case"UPLOAD":if(!d||!e.payload)return e.status="failed",e.error="PUT operation requires key and payload",e;const m=n?.data||n?.body||e.payload,y=n?.contentType||e.metadata?.contentType,b=n?.metadata||e.metadata;f=i.putObject(l,d,m,e.size,b,y);break;case"GET":case"DOWNLOAD":if(!d)return e.status="failed",e.error="GET operation requires key",e;f=i.getObject(l,d,h);break;case"DELETE":if(!d)return e.status="failed",e.error="DELETE operation requires key",e;f=i.deleteObject(l,d,h);break;case"LIST":const C=n?.prefix||e.metadata?.prefix,S=n?.maxKeys||n?.maxKeys||1e3;f=i.listObjects(l,C,S);break;case"HEAD":if(!d)return e.status="failed",e.error="HEAD operation requires key",e;f=i.headObject(l,d);break;default:return e.status="failed",e.error=`Unsupported S3 operation: ${o}`,e}return f.success?(e.status="delivered",e.latency=f.latency||50,f.object?e.payload={...e.payload,operation:o.toUpperCase(),bucket:l,key:d,object:f.object,etag:f.object.etag,versionId:f.versionId||f.object.versionId,size:f.object.size,storageClass:f.object.storageClass}:f.objects?e.payload={...e.payload,operation:"LIST",bucket:l,objects:f.objects,count:f.objects.length}:e.payload={...e.payload,operation:o.toUpperCase(),bucket:l,key:d,success:!0,versionId:f.versionId,deleteMarker:f.deleteMarker},e.metadata={...e.metadata,s3Operation:o.toUpperCase(),bucket:l,key:d,latency:f.latency}):(e.status="failed",e.error=f.error||`S3 ${o} operation failed`,e.latency=f.latency||0),e}processPostgreSQLQuery(t,e,s){if(!this.postgresQueryEngine)return e.status="failed",e.error="PostgreSQL Query Engine not initialized",e;const n=e.payload?.sql;if(!n||typeof n!="string")return e.status="failed",e.error="No SQL query provided",e;const i=t.data.config,o=i.tables||[],l=this.extractIndexesFromConfig(i,o),d=i.views||[],h=this.postgresQueryEngine.execute(n,o,l,d);return h.success?(e.status="delivered",e.latency=h.executionTime||s.queryLatency||10,e.payload={...e.payload,results:h.rows||[],rowCount:h.rowCount||0,queryPlan:h.queryPlan,indexesUsed:h.indexesUsed||[]}):(e.status="failed",e.error=h.error||"Query execution failed",e.latency=h.executionTime||0),e}processRedisCommand(t,e,s){const n=e.payload,i=Ae.getRedisRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Redis Routing Engine not initialized",e;let o,l;if(n?.command)o=n.command,l=n.args||[];else if(n?.redisCommand){const h=String(n.redisCommand).trim().split(/\s+/);o=h[0],l=h.slice(1)}else if(typeof n=="string"){const h=n.trim().split(/\s+/);o=h[0],l=h.slice(1)}else{const h=n?.operation||"get";switch(h.toLowerCase()){case"get":o="GET",l=[n?.key||"default:key"];break;case"set":o="SET",l=[n?.key||"default:key",typeof n?.value=="string"?n.value:JSON.stringify(n?.value||"")],n?.ttl&&l.push("EX",String(n.ttl));break;case"delete":case"del":o="DEL",l=Array.isArray(n?.keys)?n.keys:[n?.key||"default:key"];break;case"exists":o="EXISTS",l=Array.isArray(n?.keys)?n.keys:[n?.key||"default:key"];break;default:return e.status="failed",e.error=`Unknown Redis operation: ${h}`,e}}const d=i.executeCommand(o,l);return d.success?(e.status="delivered",e.latency=d.latency||1,e.payload={...e.payload,command:o,args:l,result:d.value,redisResult:d.value}):(e.status="failed",e.error=d.error||"Redis command execution failed",e.latency=d.latency||0),e}processCQLQuery(t,e,s){const n=e.payload,i=Ae.getCassandraRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Cassandra Routing Engine not initialized",e;let o,l;if(n?.cql)o=n.cql,l=n.consistency;else if(n?.query)o=n.query,l=n.consistency;else if(typeof n=="string")o=n;else{const h=n?.operation||"select",f=t.data.config,m=n?.keyspace||f?.keyspace||"system",y=n?.table||"default_table";switch(h.toLowerCase()){case"select":case"read":o=`SELECT * FROM ${m}.${y}`,n?.limit&&(o+=` LIMIT ${n.limit}`);break;case"insert":case"write":const b=n?.columns?Object.keys(n.columns).join(", "):"id, data",C=n?.columns?Object.values(n.columns).map(M=>`'${M}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${m}.${y} (${b}) VALUES (${C})`;break;case"update":const S=n?.columns||{},R=Object.entries(S).map(([M,T])=>`${M} = '${T}'`).join(", ");o=`UPDATE ${m}.${y} SET ${R}`,n?.where&&(o+=` WHERE ${n.where}`);break;case"delete":o=`DELETE FROM ${m}.${y}`,n?.where&&(o+=` WHERE ${n.where}`);break;default:return e.status="failed",e.error=`Unknown CQL operation: ${h}`,e}}l||(l=t.data.config?.consistencyLevel||"QUORUM");const d=i.executeCQL(o,l);return d.success?(e.status="delivered",e.latency=d.latency||5,e.payload={...e.payload,cql:o,consistency:d.consistency,rows:d.rows||[],rowCount:d.rowCount||0,replicasQueried:d.replicasQueried,cqlResult:d.rows},e.metadata={...e.metadata,cassandraConsistency:d.consistency,cassandraReplicasQueried:d.replicasQueried}):(e.status="failed",e.error=d.error||"CQL query execution failed",e.latency=d.latency||0),e}extractIndexesFromConfig(t,e){const s=[];for(const n of e)for(const i of n.indexes||[]){const o=i.match(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+(\w+)\s+ON\s+\w+\s*\(([^)]+)\)/i);o?s.push({name:o[1],table:n.name,schema:n.schema,columns:o[2].split(",").map(l=>l.trim()),unique:i.toUpperCase().includes("UNIQUE")}):s.push({name:i,table:n.name,schema:n.schema,columns:[i.replace(/^idx_|^index_/i,"")]})}return s}createMessageBrokerHandler(t){return t==="rabbitmq"?{processData:(e,s,n)=>{const i=Ae.getRabbitMQRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},l=o.exchange||"amq.topic",d=o.routingKey||s.metadata?.routingKey||"default",h=s.metadata?.headers,f=s.metadata?.priority,m=i.routeMessage(l,d,s.payload,s.size,h,f);return m.length>0?(s.status="delivered",s.metadata={...s.metadata,routedQueues:m,exchange:l,routingKey:d}):(s.status="failed",s.error=`No queues bound to exchange '${l}' with routing key '${d}'`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="activemq"?{processData:(e,s,n)=>{const i=Ae.getActiveMQRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},l=o.queue,d=o.topic,h=s.metadata?.headers,f=s.metadata?.priority;let m=!1,y="";const b=e.data.config||{},C=b.acls||[],R=this.nodes.find(T=>T.id===s.source)?.data.config,M=s.metadata?.principal||R?.username||R?.clientId||b.username||`user-${s.source.slice(0,8)}`;if(l){if(!(Ae.checkActiveMQACLPermissionPublic?.(C,M,`queue://${l}`,"write")??!0))return s.status="failed",s.error=`Access denied: principal '${M}' does not have write permission for queue '${l}'`,s;i.routeToQueue(l,s.payload,s.size,h,f)&&(m=!0,y=l)}if(d){if(!(Ae.checkActiveMQACLPermissionPublic?.(C,M,`topic://${d}`,"write")??!0))return s.status="failed",s.error=`Access denied: principal '${M}' does not have write permission for topic '${d}'`,s;i.publishToTopic(d,s.payload,s.size,h,f).length>0&&(m=!0,y=d)}return m?(s.status="delivered",s.metadata={...s.metadata,destination:y,queue:l||void 0,topic:d||void 0}):(s.status="failed",s.error=`No queue or topic found. Queue: '${l||"none"}', Topic: '${d||"none"}'`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="aws-sqs"?{processData:(e,s,n)=>{const i=Ae.getSQSRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},l=o.queueUrl,d=o.queueName||(l?l.split("/").pop():null)||s.metadata?.queueName||"default-queue",h=e.data.config||{},f=h.iamPolicies||[],y=this.nodes.find(E=>E.id===s.source)?.data.config,b=s.metadata?.principal||y?.accessKeyId||y?.clientId||h.accessKeyId||`arn:aws:iam::123456789012:user/${s.source.slice(0,8)}`;if(!(Ae.checkSQSIAMPolicy?.(f,b,d,"sqs:SendMessage")??!0))return s.status="failed",s.error=`Access denied: principal '${b}' does not have sqs:SendMessage permission for queue '${d}'`,s;const S=s.metadata?.messageGroupId,R=s.metadata?.messageDeduplicationId,M=s.metadata?.attributes,T=i.sendMessage(d,s.payload,s.size,M,S,R);return T?(s.status="delivered",s.metadata={...s.metadata,queueName:d,messageId:T,queueUrl:l||`https://sqs.${h.defaultRegion||"us-east-1"}.amazonaws.com/.../${d}`}):(s.status="failed",s.error=`Queue '${d}' not found`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="azure-service-bus"?{processData:(e,s,n)=>{const i=Ae.getAzureServiceBusRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},l=o.queue,d=o.topic,h=s.metadata?.properties||s.metadata?.headers,f=s.metadata?.sessionId,m=s.metadata?.scheduledEnqueueTime;let y=!1,b="",C=[];if(l){const S=i.sendToQueue(l,s.payload,s.size,h,f,m);S&&(y=!0,b=l,C.push(S))}if(d){const S=i.publishToTopic(d,s.payload,s.size,h,m);S.length>0&&(y=!0,b=d,C=S)}return y?(s.status="delivered",s.metadata={...s.metadata,destination:b,queue:l||void 0,topic:d||void 0,messageIds:C,sessionId:f||void 0}):(s.status="failed",s.error=`No queue or topic found. Queue: '${l||"none"}', Topic: '${d||"none"}'`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="gcp-pubsub"?{processData:(e,s,n)=>{const i=Ae.getPubSubRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},l=o.topic||s.metadata?.topic,d=o.orderingKey||s.metadata?.orderingKey,h=s.metadata?.attributes||s.metadata?.headers,f=e.data.config||{},m=l||f.topics&&f.topics[0]?.name||null;if(!m)return s.status="failed",s.error="No topic specified for Pub/Sub message",s;const y=i.publishToTopic(m,s.payload,s.size,h,d);return y?(s.status="delivered",s.metadata={...s.metadata,topic:m,messageId:y,orderingKey:d||void 0}):(s.status="failed",s.error=`Topic '${m}' not found`),s},getSupportedFormats:()=>["json","binary","text"]}:{processData:(e,s,n)=>(s.status="delivered",s),getSupportedFormats:()=>["json","binary","text"]}}createAPIHandler(t){return{processData:(e,s,n)=>{const i={status:"success",data:s.payload,timestamp:Date.now()};return s.payload=i,s.status="delivered",s},transformData:(e,s,n,i)=>(t==="rest"&&s.format!=="json"?(s.format="json",s.status="transformed"):t==="grpc"&&s.format!=="protobuf"&&(s.format="protobuf",s.status="transformed"),s),getSupportedFormats:()=>{switch(t){case"rest":return["json","xml"];case"grpc":return["protobuf","binary"];case"graphql":return["json"];case"websocket":return["json","text","binary"];default:return["json"]}}}}createIntegrationHandler(t){return t==="kong"?{processData:(e,s,n)=>{const i=Ae.getKongRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=h.apikey||h["X-API-Key"]||f.apikey,y=s.metadata?.consumerId,b=i.routeRequest({path:l,method:d,headers:h,query:f,body:o?.body,consumerId:y,apiKey:m});return b.response.status>=200&&b.response.status<300?(s.status="delivered",s.latency=b.response.latency,s.metadata={...s.metadata,kongRoute:b.match?.route.id,kongService:b.match?.service.id,kongTarget:b.target,kongResponseStatus:b.response.status}):(s.status="failed",s.error=b.response.error||`HTTP ${b.response.status}`,s.latency=b.response.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}:t==="nginx"?{processData:(e,s,n)=>{const i=Ae.getNginxRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||s.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",b=i.routeRequest({path:l,method:d,headers:h,query:f,body:o?.body,clientIP:m,protocol:y});return b.response.status>=200&&b.response.status<300?(s.status="delivered",s.latency=b.response.latency,s.metadata={...s.metadata,nginxLocation:b.match?.location.path,nginxUpstream:b.upstreamTarget,nginxResponseStatus:b.response.status,nginxCacheHit:b.response.cacheHit},b.response.body&&(s.payload=b.response.body)):(s.status="failed",s.error=b.response.error||`HTTP ${b.response.status}`,s.latency=b.response.latency),s},transformData:(e,s,n,i)=>{(e.data.config||{}).enableGzip&&s.metadata?.nginxCacheHit&&(s.metadata={...s.metadata,contentEncoding:"gzip"});const l=this.getTargetFormats(n);return l.length>0&&!l.includes(s.format)&&(s.format=l[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="envoy"?{processData:(e,s,n)=>{const i=Ae.getEnvoyRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||s.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",b=h.Host||s.metadata?.host,C=i.routeRequest({path:l,method:d,headers:h,query:f,body:o?.body,clientIP:m,protocol:y,host:b});return C.response.status>=200&&C.response.status<300?(s.status="delivered",s.latency=(s.latency||0)+(C.response.latency||0),s.metadata={...s.metadata,envoyListener:C.listener?.name,envoyRoute:C.route?.name,envoyCluster:C.cluster?.name,envoyEndpoint:C.endpointTarget,envoyResponseStatus:C.response.status},C.response.body&&(s.payload=C.response.body)):(s.status="failed",s.error=C.response.error||`HTTP ${C.response.status}`,s.latency=(s.latency||0)+(C.response.latency||0)),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text","grpc"]}:t==="haproxy"?{processData:(e,s,n)=>{const i=Ae.getHAProxyRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||s.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",b=h.Host||s.metadata?.host,C=i.routeRequest({path:l,method:d,headers:h,query:f,body:o?.body,clientIP:m,protocol:y,host:b});return C.response.status>=200&&C.response.status<300?(s.status="delivered",s.latency=C.response.latency,s.metadata={...s.metadata,haproxyFrontend:C.frontend?.name,haproxyBackend:C.backendTarget,haproxyServer:C.serverTarget,haproxyResponseStatus:C.response.status},C.response.body&&(s.payload=C.response.body)):(s.status="failed",s.error=C.response.error||`HTTP ${C.response.status}`,s.latency=C.response.latency),s},transformData:(e,s,n,i)=>{e.data.config;const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="traefik"?{processData:(e,s,n)=>{const i=Ae.getTraefikEmulationEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=h["X-Real-IP"]||h["X-Forwarded-For"]||s.metadata?.clientIP,y=h["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",b=h.Host||s.metadata?.host,C=s.metadata?.entryPoint||(y==="https"?"websecure":"web"),S=i.processRequest({path:l,method:d,headers:h,query:f,body:o?.body,clientIP:m,protocol:y,host:b,entryPoint:C});return S.success?(s.status="delivered",s.latency=S.latency,s.metadata={...s.metadata,traefikRouter:S.routerMatched,traefikService:S.serviceTarget,traefikServer:S.serverTarget,traefikResponseStatus:S.status},o?.body&&(s.payload=o.body)):(s.status="failed",s.error=S.error||`HTTP ${S.status}`,s.latency=S.latency),s},transformData:(e,s,n,i)=>{e.data.config;const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="apigee"?{processData:(e,s,n)=>{const i=Ae.getApigeeRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=h.apikey||h["X-API-Key"]||f.apikey,y=h.Authorization||"",b=y.startsWith("OAuth ")?y.replace("OAuth ",""):void 0,C=y.startsWith("Bearer ")?y.replace("Bearer ",""):h["X-JWT-Token"],S=i.routeRequest({path:l,method:d,headers:h,query:f,body:o?.body,apiKey:m,oauthToken:b,jwtToken:C});return S.response.status>=200&&S.response.status<300?(s.status="delivered",s.latency=S.response.latency,s.metadata={...s.metadata,apigeeProxy:S.match?.proxy.name,apigeeTarget:S.target,apigeeResponseStatus:S.response.status,apigeeEnvironment:S.match?.proxy.environment}):(s.status="failed",s.error=S.response.error||`HTTP ${S.response.status}`,s.latency=S.response.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}:t==="graphql-gateway"?{processData:(e,s,n)=>{const i=Ae.getGraphQLGatewayRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.query||o?.body||s.metadata?.query,d=o?.variables||s.metadata?.variables,h=o?.operationName||s.metadata?.operationName,f=o?.headers||s.metadata?.headers||{},m=i.routeRequest({query:l||"",variables:d,headers:f,operationName:h});if(s.latency=m.latency,m.status>=200&&m.status<300){s.status="delivered";const C=i.getServiceRegistry().getConnectedServices().map(S=>S.endpoint);s.metadata={...s.metadata,graphqlGatewayStatus:m.status,graphqlGatewayEndpoints:C}}else s.status="failed",s.error=m.error||`HTTP ${m.status}`;return s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json"]}:t==="mulesoft"?{processData:(e,s,n)=>{const i=Ae.getMuleSoftRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=this.nodes.find(f=>f.id===s.source),d=this.nodes.find(f=>f.id===s.target),h=i.processData({path:o?.path||s.metadata?.path,method:o?.method||s.metadata?.method||"POST",headers:o?.headers||s.metadata?.headers||{},query:o?.query||s.metadata?.query||{},body:o?.body||o||s.payload,format:s.format,sourceComponentType:l?.type,sourceComponentId:l?.id,targetComponentType:d?.type,targetComponentId:d?.id});return h.response.status==="success"?(s.status="delivered",s.latency=h.response.latency,s.payload=h.response.data,h.response.format&&(s.format=h.response.format),s.metadata={...s.metadata,mulesoftApplication:h.response.application,mulesoftFlow:h.response.flow,mulesoftConnector:h.response.connector}):(s.status="failed",s.error=h.response.error||"MuleSoft processing failed",s.latency=h.response.latency||0),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="bff-service"?{processData:(e,s,n)=>{const i=Ae.getBFFRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.path||s.metadata?.path||"/",d=o?.method||s.metadata?.method||"GET",h=o?.headers||s.metadata?.headers||{},f=o?.query||s.metadata?.query||{},m=o?.body||o||s.payload,y=i.routeRequest({path:l,method:d,headers:h,query:f,body:m});return y.status>=200&&y.status<300?(s.status="delivered",s.latency=y.latency,s.payload=y.data,s.metadata={...s.metadata,bffCacheHit:y.cacheHit,bffBackendResponses:y.backendResponses.length,bffStatus:y.status}):(s.status="failed",s.error=y.error||`HTTP ${y.status}`,s.latency=y.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json"]}:t==="webhook-relay"?{processData:(e,s,n)=>{const i=Ae.getWebhookRelayRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,l=o?.url||s.metadata?.url||o?.path||"/",d=o?.method||s.metadata?.method||"POST",h=o?.headers||s.metadata?.headers||{},f=o?.body||o||s.payload,m=o?.ip||s.metadata?.ip||h["x-forwarded-for"]?.split(",")[0]?.trim(),y=o?.event||s.metadata?.event||h["x-event"]||h["x-github-event"]||"",b=i.relayWebhook({url:l,method:d,headers:h,body:f,ip:m,event:y});return b.success?(s.status="delivered",s.latency=b.latency,s.metadata={...s.metadata,webhookRelayId:b.relayId,webhookDeliveryId:b.deliveryId,webhookAttempts:b.attempts,webhookStatus:b.status}):(s.status="failed",s.error=b.error||`Webhook relay failed (HTTP ${b.status})`,s.latency=b.latency,s.metadata={...s.metadata,webhookRelayId:b.relayId,webhookDeliveryId:b.deliveryId,webhookAttempts:b.attempts,webhookStatus:b.status}),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","text","binary"]}:{transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}}getTargetFormats(t){return this.handlers.get(t)?.getSupportedFormats?.({type:t})||["json"]}createLokiHandler(){return{processData:(t,e,s)=>{const n=Ae.getLokiEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload;if(i?.query||i?.logql){const o=i.query||i.logql,l=i.startTime||i.start,d=i.endTime||i.end,h=i.limit||100,f=n.executeQuery(o,l,d,h);f.success?(e.status="delivered",e.latency=f.latency,e.payload={...e.payload,query:o,results:f.result||[],resultsCount:f.resultsCount}):(e.status="failed",e.error=f.error||"LogQL query execution failed",e.latency=f.latency||0)}else{const o=[],l=i?.stream||i?.labels||e.metadata?.labels||{app:t.data.label?.toLowerCase().replace(/\s+/g,"-")||"unknown",source:e.source.slice(0,8)};let d=[];if(i?.values&&Array.isArray(i.values))d=i.values;else if(i?.logs&&Array.isArray(i.logs)){const h=Date.now()*1e6;d=i.logs.map((f,m)=>[(h+m).toString(),String(f)])}else if(i?.log)d=[[(Date.now()*1e6).toString(),String(i.log)]];else if(typeof i=="string")d=[[(Date.now()*1e6).toString(),i]];else{const h=JSON.stringify(i);d=[[(Date.now()*1e6).toString(),h]]}if(d.length>0){o.push({stream:l,values:d});const h=n.processIngestion(o,e.source);h.success?(e.status="delivered",e.latency=10,e.payload={...e.payload,ingestedLines:h.ingestedLines,ingestedBytes:h.ingestedBytes}):(e.status="failed",e.error=h.error||"Log ingestion failed")}else e.status="failed",e.error="No log entries found in payload"}return e},getSupportedFormats:()=>["json","text"]}}createKeycloakHandler(){return{processData:(t,e,s)=>{const n=Ae.getKeycloakEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Keycloak engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||i.grant_type;let l="login";if(typeof o=="string"){const y=o.toLowerCase();y.includes("refresh")||y==="refresh_token"?l="refresh":y.includes("introspect")?l="introspect":y.includes("userinfo")||y.includes("user_info")?l="userinfo":l="login"}const d=i.clientId||i.client_id||e.metadata?.clientId,h=i.username||i.user||e.metadata?.username,f=i.sub||i.subject||e.metadata?.subject||h,m=n.processAuthRequest(l,{clientId:d,username:h,subject:f,grantType:typeof o=="string"?o:void 0});return e.latency=m.latency,m.success?(e.status="delivered",e.payload={...i||{},keycloak:{realm:m.realm,clientId:m.clientId,subject:m.subject,tokenType:m.tokenType,expiresIn:m.expiresIn}},e.metadata={...e.metadata,authRealm:m.realm,authClientId:m.clientId,authSubject:m.subject,authResult:"success"}):(e.status="failed",e.error=m.error||"Keycloak auth failed"),e},getSupportedFormats:()=>["json","text"]}}createJenkinsHandler(){return{processData:(t,e,s)=>{const n=Ae.getJenkinsEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Jenkins engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit){const l=i.pipelineId||i.pipeline||i.job,d=i.branch||i.ref?.replace("refs/heads/","")||"main",h=i.commit||i.sha||void 0;if(l){const f=n.triggerWebhook(l,d,h);f.success?(e.status="delivered",e.latency=50,e.payload={...i||{},jenkins:{webhookReceived:!0,pipelineId:l,branch:d,commit:h,triggered:!0}}):(e.status="failed",e.error=f.reason||"Failed to trigger build",e.latency=50)}else e.status="delivered",e.latency=50,e.payload={...i||{},jenkins:{webhookReceived:!0,branch:d,commit:h,triggered:!1,reason:"No pipeline ID specified"}}}else if(o==="getBuildStatus"||i.buildId||i.buildNumber){const l=i.buildId||i.buildNumber,d=i.pipelineId||i.pipeline,h=n.getBuildById(l||`${d}-${i.buildNumber}`),f=h?.status||"unknown";e.status="delivered",e.latency=20,e.payload={...i||{},jenkins:{buildId:l,pipelineId:d,status:f,progress:h?.progress,duration:h?.duration}}}else e.status="delivered",e.latency=30,e.payload={...i||{},jenkins:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createGitLabCIHandler(){return{processData:(t,e,s)=>{const n=Ae.getGitLabCIEmulationEngine(t.id);if(!n)return e.status="failed",e.error="GitLab CI engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit){const l=i.ref||i.branch?.replace("refs/heads/","")||"main",d=i.variables||{},h=n.triggerWebhook(l,d);h.success?(e.status="delivered",e.latency=50,e.payload={...i||{},gitlab:{webhookReceived:!0,pipelineId:h.pipelineId,ref:l,variables:d,triggered:!0}}):(e.status="failed",e.error=h.reason||"Failed to trigger pipeline",e.latency=50)}else if(o==="getPipelineStatus"||i.pipelineId||i.pipelineIid){const l=i.pipelineId||i.pipelineIid?.toString(),d=n.getPipeline(l||"");e.status="delivered",e.latency=20,e.payload={...i||{},gitlab:{pipelineId:l,status:d?.status||"unknown",duration:d?.duration,stages:d?.stages.map(h=>({name:h.name,status:h.status,duration:h.duration}))}}}else if(o==="getJobStatus"||i.jobId){const l=i.jobId,d=n.getJob(l||"");e.status="delivered",e.latency=20,e.payload={...i||{},gitlab:{jobId:l,status:d?.status||"unknown",progress:d?.progress,duration:d?.duration,logs:d?.logs?.slice(-10)}}}else if(o==="cancelPipeline"||i.cancel){const l=i.pipelineId,d=n.cancelPipeline(l||"");e.status=d.success?"delivered":"failed",e.error=d.reason,e.latency=30,e.payload={...i||{},gitlab:{pipelineId:l,canceled:d.success}}}else e.status="delivered",e.latency=30,e.payload={...i||{},gitlab:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createArgoCDHandler(){return{processData:(t,e,s)=>{const n=Ae.getArgoCDEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Argo CD engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit||i.repository){const l=i.repository||i.repo||"",d=i.ref||i.branch||i.commit||"main",h=i.application||i.app||"";h?n.startSync(h)?(e.status="delivered",e.latency=50,e.payload={...i||{},argocd:{webhookReceived:!0,application:h,repository:l,ref:d,syncTriggered:!0}}):(e.status="failed",e.error="Failed to trigger sync or application already syncing",e.latency=50):(e.status="delivered",e.latency=30,e.payload={...i||{},argocd:{webhookReceived:!0,repository:l,ref:d,syncTriggered:!1,reason:"No application specified"}})}else if(o==="sync"||o==="startSync"){const l=i.application||i.app||e.metadata?.application;if(!l)return e.status="failed",e.error="Application name is required for sync operation",e;n.startSync(l)?(e.status="delivered",e.latency=50,e.payload={...i||{},argocd:{operation:"sync",application:l,syncStarted:!0}}):(e.status="failed",e.error="Failed to start sync or application already syncing",e.latency=50)}else if(o==="getApplicationStatus"||o==="getAppStatus"||i.application){const l=i.application||i.app||"",d=n.getApplication(l);e.status="delivered",e.latency=20,e.payload={...i||{},argocd:{application:l,status:d?.status||"unknown",health:d?.health||"unknown",lastSync:d?.lastSync,lastSyncDuration:d?.lastSyncDuration,revision:d?.revision,sourceRevision:d?.sourceRevision}}}else if(o==="getSyncStatus"||i.syncOperationId){const l=i.syncOperationId||i.operationId,h=n.getSyncOperations().find(f=>f.id===l);e.status="delivered",e.latency=20,e.payload={...i||{},argocd:{syncOperationId:l,status:h?.status||"unknown",phase:h?.phase,startedAt:h?.startedAt,finishedAt:h?.finishedAt,error:h?.error}}}else if(o==="getMetrics"||o==="getStats"){const l=n.getMetrics(),d=n.getStats();e.status="delivered",e.latency=15,e.payload={...i||{},argocd:{metrics:l,stats:d}}}else e.status="delivered",e.latency=30,e.payload={...i||{},argocd:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createTerraformHandler(){return{processData:(t,e,s)=>{const n=Ae.getTerraformEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Terraform engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit||i.repository){const l=i.workspace||i.workspaceId||"",d=i.workspaceId||i.workspace,h=i.ref?.replace("refs/heads/","")||i.branch||"main",f=i.commit||i.sha||void 0;if(l||d){const m=n.getWorkspaces(),y=d?m.find(b=>b.id===d):m.find(b=>b.name===l);if(y){const b=n.triggerRun(y.id,{planOnly:i.planOnly??!1,source:"vcs",triggeredBy:"vcs-webhook"});b.success?(e.status="delivered",e.latency=50,e.payload={...i||{},terraform:{webhookReceived:!0,workspaceId:y.id,workspaceName:y.name,branch:h,commit:f,runTriggered:!0,runId:b.runId}}):(e.status="failed",e.error=b.reason||"Failed to trigger run",e.latency=50)}else e.status="failed",e.error="Workspace not found",e.latency=50}else e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{webhookReceived:!0,branch:h,commit:f,runTriggered:!1,reason:"No workspace specified"}}}else if(o==="triggerRun"||o==="createRun"||o==="run"){const l=i.workspaceId||i.workspace||e.metadata?.workspaceId,d=i.planOnly??!1;if(!l)return e.status="failed",e.error="Workspace ID is required for run operation",e;const h=n.triggerRun(l,{planOnly:d,source:"api",triggeredBy:i.triggeredBy||"user"});h.success?(e.status="delivered",e.latency=50,e.payload={...i||{},terraform:{operation:"triggerRun",workspaceId:l,planOnly:d,runId:h.runId,runTriggered:!0}}):(e.status="failed",e.error=h.reason||"Failed to trigger run",e.latency=50)}else if(o==="cancelRun"||o==="cancel"){const l=i.runId||i.run||e.metadata?.runId;if(!l)return e.status="failed",e.error="Run ID is required for cancel operation",e;const d=n.cancelRun(l);d.success?(e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{operation:"cancelRun",runId:l,canceled:!0}}):(e.status="failed",e.error=d.reason||"Failed to cancel run",e.latency=30)}else if(o==="getRunStatus"||o==="getRun"||i.runId){const l=i.runId||i.run||"",d=n.getRun(l);e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{runId:l,status:d?.status||"unknown",workspaceId:d?.workspaceId,workspaceName:d?.workspaceName,createdAt:d?.createdAt,startedAt:d?.startedAt,finishedAt:d?.finishedAt,duration:d?.duration,planOnly:d?.planOnly,message:d?.message,error:d?.error,hasChanges:d?.hasChanges,resourceAdditions:d?.resourceAdditions,resourceChanges:d?.resourceChanges,resourceDestructions:d?.resourceDestructions}}}else if(o==="getWorkspaceStatus"||o==="getWorkspace"||i.workspaceId){const l=i.workspaceId||i.workspace||"",d=n.getWorkspace(l),h=d?n.getStateForWorkspace(l):void 0;e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{workspaceId:l,workspace:d?{id:d.id,name:d.name,description:d.description,terraformVersion:d.terraformVersion,autoApply:d.autoApply,lastRun:d.lastRun}:null,state:h?{version:h.version,serial:h.serial,resources:h.resources,updatedAt:h.updatedAt}:null}}}else if(o==="getMetrics"||o==="getStats"){const l=n.getMetrics();e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{metrics:{workspacesTotal:l.workspacesTotal,runsTotal:l.runsTotal,runsSuccess:l.runsSuccess,runsFailed:l.runsFailed,runsRunning:l.runsRunning,runsPending:l.runsPending,runsPerHour:l.runsPerHour,averageRunDuration:l.averageRunDuration,statesTotal:l.statesTotal,resourcesManaged:l.resourcesManaged}}}}else e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createHarborHandler(){return{processData:(t,e,s)=>{if(!Ae.getHarborEmulationEngine(t.id))return e.status="failed",e.error="Harbor engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"pull";return o==="push"?(e.status="delivered",e.latency=500+Math.random()*1500,e.payload={...i||{},harbor:{operation:"push",repository:i.repository||"unknown",tag:i.tag||"latest",size:i.size||0,status:"completed"}}):o==="pull"?(e.status="delivered",e.latency=200+Math.random()*800,e.payload={...i||{},harbor:{operation:"pull",repository:i.repository||"unknown",tag:i.tag||"latest",status:"completed"}}):o==="scan"?(e.status="delivered",e.latency=5e3+Math.random()*15e3,e.payload={...i||{},harbor:{operation:"scan",repository:i.repository||"unknown",tag:i.tag||"latest",status:"completed"}}):(e.status="delivered",e.latency=100+Math.random()*200,e.payload={...i||{},harbor:{operation:o,status:"completed"}}),e},getSupportedFormats:()=>["json","binary"]}}createDockerHandler(){return{processData:(t,e,s)=>{if(!Ae.getDockerEmulationEngine(t.id))return e.status="failed",e.error="Docker engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"container-operation";if(o.startsWith("container-")){const l=o.replace("container-","");switch(e.status="delivered",l){case"create":e.latency=500+Math.random()*1e3;break;case"start":e.latency=200+Math.random()*500;break;case"stop":e.latency=100+Math.random()*300;break;case"restart":e.latency=300+Math.random()*700;break;default:e.latency=100+Math.random()*200}e.payload={...i||{},docker:{operation:l,containerId:i.containerId||"unknown",status:"completed"}}}else if(o.startsWith("image-")){const l=o.replace("image-","");switch(e.status="delivered",l){case"pull":e.latency=2e3+Math.random()*8e3;break;case"push":e.latency=3e3+Math.random()*1e4;break;case"build":e.latency=5e3+Math.random()*15e3;break;default:e.latency=1e3+Math.random()*2e3}e.payload={...i||{},docker:{operation:l,imageId:i.imageId||"unknown",status:"completed"}}}else e.status="delivered",e.latency=100+Math.random()*200,e.payload={...i||{},docker:{operation:o,status:"completed"}};return e},getSupportedFormats:()=>["json","text"]}}createVaultHandler(){return{processData:(t,e,s)=>{const n=Ae.getVaultEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Vault engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"read",l=i?.path||e.metadata?.path||"secret/default",d=i?.token||e.metadata?.token;let h;if(typeof o=="string"){const f=o.toLowerCase();if(f.includes("write")||f==="create"||f==="update"){const m=i?.data||i?.value||{};h=n.processWriteRequest(l,m,d)}else if(f.includes("delete")||f==="remove")h=n.processDeleteRequest(l,d);else if(f.includes("encrypt")){const m=i?.plaintext||i?.data||"",y=i?.key||i?.keyName||"default";h=n.processEncryptRequest(m,y,d)}else if(f.includes("decrypt")){const m=i?.ciphertext||i?.data||"",y=i?.key||i?.keyName||"default";h=n.processDecryptRequest(m,y,d)}else if(f.includes("auth")||f==="login"||f==="authenticate"){const m=i?.method||i?.authMethod||"token";h=n.processAuthRequest(m,i)}else{const m=i?.key;h=n.processReadRequest(l,m,d)}}else{const f=i?.key;h=n.processReadRequest(l,f,d)}return e.latency=(e.latency||0)+h.latency,h.success?(e.status="delivered",e.payload={...i||{},vault:{path:l,data:h.data,token:h.token,policies:h.policies}},h.token&&(e.metadata={...e.metadata,vaultToken:h.token,vaultPolicies:h.policies})):(e.status="failed",e.error=h.error||"Vault operation failed"),e},getSupportedFormats:()=>["json","text"]}}createWAFHandler(){return{processData:(t,e,s)=>{const n=Ae.getWAFEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload||{},o=i?.path||e.metadata?.path||"/",l=i?.method||e.metadata?.method||"GET",d=i?.headers||e.metadata?.headers||{},h=i?.query||e.metadata?.query||{},f=i?.body||i,m=i?.sourceIP||e.metadata?.sourceIP||d["x-forwarded-for"]||d["x-real-ip"],y=i?.country||e.metadata?.country||d["cf-ipcountry"],b=i?.userAgent||e.metadata?.userAgent||d["user-agent"],C=n.processRequest({path:o,method:l,headers:d,query:h,body:f,sourceIP:m,country:y,userAgent:b});return e.latency=(e.latency||0)+C.latency,C.blocked?(e.status="failed",e.error=C.error||`Request blocked by WAF: ${C.threatDetected?"Threat detected":"Rule matched"}`,C.threatDetected&&(e.metadata={...e.metadata,wafBlocked:!0,wafThreatDetected:!0,wafAction:"block"})):!C.success&&C.action==="challenge"?(e.status="pending",e.metadata={...e.metadata,wafChallenge:!0,wafAction:"challenge"}):(e.status="delivered",e.metadata={...e.metadata,wafChecked:!0,wafAllowed:!0,wafLatency:C.latency},C.threatDetected&&(e.metadata.wafThreatDetected=!0,e.metadata.wafAction="log")),e},getSupportedFormats:()=>["json","text","xml"]}}createFirewallHandler(){return{processData:(t,e,s)=>{const n=Ae.getFirewallEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload||{},o=i?.source||e.metadata?.sourceIP||i?.sourceIP||"0.0.0.0",l=i?.destination||e.metadata?.destinationIP||i?.destinationIP||"10.0.0.1",d=i?.protocol||e.metadata?.protocol||"tcp",h=i?.port||e.metadata?.port||i?.destinationPort,f=i?.sourcePort||e.metadata?.sourcePort,m=n.processPacket({source:o,destination:l,protocol:d,port:h,sourcePort:f});return e.latency=(e.latency||0)+m.latency,m.blocked?(e.status="failed",e.error=m.error||`Packet ${m.action} by Firewall: ${m.matchedRule?.name||"Default policy"}`,e.metadata={...e.metadata,firewallBlocked:!0,firewallAction:m.action,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}):(e.status="delivered",e.metadata={...e.metadata,firewallChecked:!0,firewallAllowed:!0,firewallLatency:m.latency,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}),e},getSupportedFormats:()=>["json","text","binary"]}}createIDSIPSHandler(){return{processData:(t,e,s)=>{const n=Ae.getIDSIPSEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload||{},o=i?.source||e.metadata?.sourceIP||i?.sourceIP||"0.0.0.0",l=i?.destination||e.metadata?.destinationIP||i?.destinationIP||"10.0.0.1",d=i?.protocol||e.metadata?.protocol||"tcp",h=i?.port||e.metadata?.port||i?.destinationPort,f=i?.sourcePort||e.metadata?.sourcePort,m=i?.payload||i?.body||(typeof i=="string"?i:JSON.stringify(i)),y=n.processPacket({source:o,destination:l,protocol:d,port:h,sourcePort:f,payload:m});return e.latency=(e.latency||0)+y.latency,y.blocked?(e.status="failed",e.error=y.error||"Packet blocked by IDS/IPS: Intrusion detected",e.metadata={...e.metadata,idsipsBlocked:!0,idsipsAlertGenerated:y.alertGenerated,idsipsAction:"block"},y.alertGenerated&&(e.metadata.idsipsAlertType="intrusion")):(e.status="delivered",e.metadata={...e.metadata,idsipsChecked:!0,idsipsAllowed:!0,idsipsLatency:y.latency,idsipsAlertGenerated:y.alertGenerated},y.alertGenerated&&(e.metadata.idsipsAction="alert",e.metadata.idsipsAlertType="intrusion")),e},getSupportedFormats:()=>["json","text","binary"]}}createOpenTelemetryCollectorHandler(){return{processData:(t,e,s)=>{const n=Ae.getOpenTelemetryCollectorRoutingEngine(t.id);if(!n)return e.status="delivered",e;const i=this.nodes.find(l=>l.id===e.source),o=n.processMessage(e,i||void 0);return o.success?(e.status="delivered",e.latency=o.latency):(e.status="failed",e.error=o.error||"OpenTelemetry Collector processing failed",e.latency=o.latency),e},getSupportedFormats:()=>["json","protobuf","binary","text"]}}createCRMDataMessage(t){const e=t.data.config||{},s=e.contacts||[],n=e.deals||[],i=Math.random()>.5?"contact":"deal";let o;if(i==="contact"&&s.length>0){const d=s[Math.floor(Math.random()*s.length)];o={operation:"create",type:"contact",data:{name:d.name,email:d.email,company:d.company,status:d.status}}}else if(n.length>0){const d=n[Math.floor(Math.random()*n.length)];o={operation:"update",type:"deal",data:{id:d.id,name:d.name,value:d.value,stage:d.stage}}}else o={operation:"create",type:"contact",data:{name:`Contact ${Date.now()}`,email:`contact${Date.now()}@example.com`}};const l=JSON.stringify(o);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:o,size:new Blob([l]).size,metadata:{contentType:"application/json",operation:o.operation},status:"pending"}}createERPDataMessage(t){const e=t.data.config||{},s=e.orders||[],n=e.inventory||[],i=Math.random()>.5?"order":"inventory";let o;if(i==="order"&&s.length>0){const d=s[Math.floor(Math.random()*s.length)];o={operation:"create",type:"order",data:{orderNumber:d.orderNumber,customer:d.customer,total:d.total,items:d.items}}}else if(n.length>0){const d=n[Math.floor(Math.random()*n.length)];o={operation:"update",type:"inventory",data:{sku:d.sku,quantity:d.quantity,status:d.status}}}else o={operation:"create",type:"order",data:{orderNumber:`ORD-${Date.now()}`,total:Math.random()*1e3}};const l=JSON.stringify(o);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:o,size:new Blob([l]).size,metadata:{contentType:"application/json",operation:o.operation},status:"pending"}}createPaymentDataMessage(t){const s=(t.data.config||{}).transactions||[];let n;if(s.length>0){const o=s[Math.floor(Math.random()*s.length)];n={operation:"process",type:"transaction",data:{id:o.id,amount:o.amount,currency:o.currency,status:o.status}}}else n={operation:"process",type:"transaction",data:{amount:Math.random()*1e3,currency:"USD"}};const i=JSON.stringify(n);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:n,size:new Blob([i]).size,metadata:{contentType:"application/json",operation:n.operation},status:"pending"}}generateQueryResults(t,e){const s=Math.floor(Math.random()*10)+1,n=[];for(let i=0;i<s;i++)n.push({id:i+1,name:`Record ${i+1}`,value:Math.random()*100,timestamp:new Date().toISOString()});return n}}const ds=new xE;class wE{componentStates=new Map;setComponentState(t,e,s){const n={nodeId:t,state:e,degradedLevel:s?.degradedLevel||.5,failureRate:s?.failureRate||.1,latencyMultiplier:s?.latencyMultiplier||2,throughputMultiplier:s?.throughputMultiplier||.5};this.componentStates.set(t,n)}getComponentState(t){return this.componentStates.get(t)}isEnabled(t){const e=this.componentStates.get(t);return!e||e.state==="enabled"}applyStateEffects(t,e){const s=this.componentStates.get(t);if(!s||s.state==="enabled")return{...e};if(s.state==="disabled"||s.state==="failed")return{throughput:0,latency:1/0,errorRate:1,utilization:0};if(s.state==="degraded"){const n=s.degradedLevel||.5;return{throughput:e.throughput*(s.throughputMultiplier||.5)*(1-n*.5),latency:e.latency*(s.latencyMultiplier||2)*(1+n),errorRate:Math.min(1,e.errorRate+(s.failureRate||.1)*n),utilization:Math.min(1,e.utilization*(1+n*.3))}}return{...e}}reset(){this.componentStates.clear()}resetComponent(t){this.componentStates.delete(t)}getAllStates(){return Array.from(this.componentStates.values())}}const mo=new wE;class CE{queues=new Map;exchanges=new Map;bindings=new Map;queueMessages=new Map;unackedMessages=new Map;queueState=new Map;initialize(t){if(this.queues.clear(),this.exchanges.clear(),this.bindings.clear(),this.queueMessages.clear(),this.unackedMessages.clear(),this.queueState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.unackedMessages.set(e.name,[]),this.queueState.set(e.name,{ready:e.ready||0,unacked:e.unacked||0,total:e.messages||0,lastUpdate:Date.now()});if(t.exchanges)for(const e of t.exchanges)this.exchanges.set(e.name,{...e}),this.bindings.set(e.name,[]);if(t.bindings)for(const e of t.bindings){const s=this.bindings.get(e.source)||[];s.push(e),this.bindings.set(e.source,s)}}routeMessage(t,e,s,n,i,o){const l=this.exchanges.get(t);if(!l)return[];const d=this.bindings.get(t)||[],h=[];for(const y of d)this.shouldRouteToQueue(l,y,e,i)&&h.push(y.destination);const f=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,m=Date.now();for(const y of h){const b=this.queues.get(y);if(!b)continue;if(b.maxLength&&(this.queueMessages.get(y)||[]).length>=b.maxLength){b.deadLetterExchange&&this.routeToDeadLetterExchange(b.deadLetterExchange,b.deadLetterRoutingKey||e,s,n,i,o);continue}const C={id:f,timestamp:m,routingKey:e,exchange:t,payload:s,size:n,priority:o||b.maxPriority?o||0:void 0,headers:i,ttl:b.messageTtl?m+b.messageTtl:void 0},S=this.queueMessages.get(y)||[];S.push(C),b.maxPriority&&C.priority!==void 0&&S.sort((R,M)=>(M.priority||0)-(R.priority||0)),this.queueMessages.set(y,S)}return h}shouldRouteToQueue(t,e,s,n){switch(t.type){case"direct":return e.routingKey===s;case"topic":return this.matchTopicPattern(e.routingKey,s);case"fanout":return!0;case"headers":if(!n||!e.arguments)return!1;for(const[i,o]of Object.entries(e.arguments))if(!i.startsWith("x-")&&n[i]!==o)return!1;return!0;default:return!1}}matchTopicPattern(t,e){const s=t.replace(/\./g,"\\.").replace(/\*/g,"[^.]+").replace(/#/g,".*");return new RegExp(`^${s}$`).test(e)}routeToDeadLetterExchange(t,e,s,n,i,o){this.routeMessage(t,e,s,n,i,o)}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){let i=this.queueMessages.get(s)||[],o=this.unackedMessages.get(s)||[];const l=this.queueState.get(s)||{ready:0,unacked:0,total:0,lastUpdate:e};i=i.filter(R=>R.ttl&&e>R.ttl?(n.deadLetterExchange&&this.routeToDeadLetterExchange(n.deadLetterExchange,n.deadLetterRoutingKey||R.routingKey,R.payload,R.size,R.headers,R.priority),!1):!0),this.queueMessages.set(s,i);const f=(n.consumers||0)*10*t/1e3,m=Math.min(f,i.length),y=i.splice(0,m);o.push(...y),this.unackedMessages.set(s,o);const C=t/100*o.length,S=Math.min(C,o.length);o.splice(0,Math.floor(S)),this.unackedMessages.set(s,o),l.ready=i.length,l.unacked=o.length,l.total=i.length+o.length,l.lastUpdate=e,this.queueState.set(s,l)}}getQueueMetrics(t){const e=this.queues.get(t);if(!e)return null;const s=this.queueMessages.get(t)||[],n=this.unackedMessages.get(t)||[];this.queueState.get(t);const i=s.length,o=n.length;return{messages:i+o,ready:i,unacked:o,consumers:e.consumers||0}}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;for(const e of this.unackedMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queues.values())e.consumers&&(t+=e.consumers);return t+=this.exchanges.size,Math.max(1,t)}updateQueue(t,e){const s=this.queues.get(t);s&&(Object.assign(s,e),this.queues.set(t,s))}}class SE{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;queueState=new Map;topicState=new Map;initialize(t){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.queueState.clear(),this.topicState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.queueState.set(e.name,{queueSize:e.queueSize||0,consumerCount:e.consumerCount||0,enqueueCount:e.enqueueCount||0,dequeueCount:e.dequeueCount||0,lastUpdate:Date.now()});if(t.topics)for(const e of t.topics)this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.subscriptions.set(e.name,[]),this.topicState.set(e.name,{subscriberCount:e.subscriberCount||0,enqueueCount:e.enqueueCount||0,dequeueCount:e.dequeueCount||0,lastUpdate:Date.now()});if(t.subscriptions)for(const e of t.subscriptions){const s=this.subscriptions.get(e.destination)||[];s.push(e),this.subscriptions.set(e.destination,s),this.subscriptionMessages.set(e.id,[])}}routeToQueue(t,e,s,n,i){if(!this.queues.get(t))return!1;const l=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=Date.now(),h={id:l,timestamp:d,destination:t,payload:e,size:s,headers:n,priority:i},f=this.queueMessages.get(t)||[];f.push(h),i!==void 0&&f.sort((y,b)=>(b.priority||0)-(y.priority||0)),this.queueMessages.set(t,f);const m=this.queueState.get(t)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:d};return m.queueSize=f.length,m.enqueueCount=(m.enqueueCount||0)+1,m.lastUpdate=d,this.queueState.set(t,m),!0}publishToTopic(t,e,s,n,i){if(!this.topics.get(t))return[];const l=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=Date.now(),h=this.subscriptions.get(t)||[],f=[],m={id:l,timestamp:d,destination:t,payload:e,size:s,headers:n,priority:i};for(const b of h){if(b.selector&&!this.matchesSelector(b.selector,n))continue;const C=this.subscriptionMessages.get(b.id)||[];C.push(m),this.subscriptionMessages.set(b.id,C),f.push(b.id),b.pendingQueueSize=(b.pendingQueueSize||0)+1,b.enqueueCounter=(b.enqueueCounter||0)+1}if(h.length===0){const b=this.topicMessages.get(t)||[];b.push(m),this.topicMessages.set(t,b)}const y=this.topicState.get(t)||{subscriberCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:d};return y.enqueueCount=(y.enqueueCount||0)+1,y.lastUpdate=d,this.topicState.set(t,y),f}matchesSelector(t,e){if(!e||!t)return!0;try{const s=t.trim(),n=s.match(/^(\w+)\s*=\s*['"]([^'"]+)['"]$/);if(n){const o=n[1],l=n[2];return e[o]===l}const i=s.match(/^(\w+)\s*([><=]+)\s*(\d+)$/);if(i){const o=i[1],l=i[2],d=Number(i[3]),h=Number(e[o]);if(isNaN(h))return!1;switch(l){case">":return h>d;case"<":return h<d;case">=":return h>=d;case"<=":return h<=d;case"=":return h===d;default:return!1}}for(const o in e)if(s.includes(o))return!0;return!1}catch{return!0}}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){let i=this.queueMessages.get(s)||[];const o=this.queueState.get(s)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:e};i=i.filter(y=>!(y.ttl&&e>y.ttl)),this.queueMessages.set(s,i);const h=(n.consumerCount||o.consumerCount||0)*10*t/1e3,f=Math.min(h,i.length),m=i.splice(0,Math.floor(f));this.queueMessages.set(s,i),o.queueSize=i.length,o.dequeueCount=(o.dequeueCount||0)+m.length,o.lastUpdate=e,this.queueState.set(s,o)}for(const[s,n]of this.subscriptions.entries()){for(const o of n){let l=this.subscriptionMessages.get(o.id)||[];l=l.filter(y=>!(y.ttl&&e>y.ttl));const h=10*t/1e3,f=Math.min(h,l.length),m=l.splice(0,Math.floor(f));o.pendingQueueSize=l.length,o.dispatchedQueueSize=(o.dispatchedQueueSize||0)+m.length,o.dequeueCounter=(o.dequeueCounter||0)+m.length,this.subscriptionMessages.set(o.id,l)}const i=this.topicState.get(s);i&&(i.dequeueCount=n.reduce((o,l)=>o+(l.dequeueCounter||0),0),i.lastUpdate=e)}}getQueueMetrics(t){if(!this.queues.get(t))return null;const s=this.queueState.get(t);return s?{queueSize:s.queueSize,consumerCount:s.consumerCount,enqueueCount:s.enqueueCount,dequeueCount:s.dequeueCount}:null}getTopicMetrics(t){if(!this.topics.get(t))return null;const s=this.topicState.get(t);return s?{subscriberCount:s.subscriberCount,enqueueCount:s.enqueueCount,dequeueCount:s.dequeueCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getAllTopicMetrics(){const t=new Map;for(const e of this.topics.keys()){const s=this.getTopicMetrics(e);s&&t.set(e,s)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;return t}getTotalTopicMessages(){let t=0;for(const e of this.subscriptionMessages.values())t+=e.length;for(const e of this.topicMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queues.values())e.consumerCount&&(t+=e.consumerCount);for(const e of this.subscriptions.values())t+=e.length;return Math.max(1,t+1)}updateQueue(t,e){const s=this.queues.get(t);if(s){Object.assign(s,e),this.queues.set(t,s);const n=this.queueState.get(t);n&&e.consumerCount!==void 0&&(n.consumerCount=e.consumerCount)}}updateTopic(t,e){const s=this.topics.get(t);if(s){Object.assign(s,e),this.topics.set(t,s);const n=this.topicState.get(t);n&&e.subscriberCount!==void 0&&(n.subscriberCount=e.subscriberCount)}}}class ME{queues=new Map;queueMessages=new Map;inFlightMessages=new Map;dlqMessages=new Map;queueState=new Map;messageGroups=new Map;deduplicationIds=new Map;initialize(t){if(this.queues.clear(),this.queueMessages.clear(),this.inFlightMessages.clear(),this.dlqMessages.clear(),this.queueState.clear(),this.messageGroups.clear(),this.deduplicationIds.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.inFlightMessages.set(e.name,[]),this.queueState.set(e.name,{approximateMessages:0,approximateMessagesNotVisible:0,approximateMessagesDelayed:0,sentCount:0,receivedCount:0,deletedCount:0,dlqCount:0,lastUpdate:Date.now()}),e.type==="fifo"&&(this.messageGroups.set(e.name,new Map),this.deduplicationIds.set(e.name,new Set))}sendMessage(t,e,s,n,i,o){const l=this.queues.get(t);if(!l)return null;const d=Date.now(),h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f=`${t}-${h}`;if(l.type==="fifo"){if(l.contentBasedDedup&&!o){const T=JSON.stringify(e);o=this.hashString(T)}if(o){const T=this.deduplicationIds.get(t);if(T&&T.has(o))return f;T?.add(o)}i||(i="default-group")}const m=l.messageRetention*24*60*60*1e3,y=d+m,b=l.delaySeconds*1e3,C=b>0?d+b:void 0,S={id:h,messageId:f,timestamp:d,queueName:t,payload:e,size:s,attributes:n,messageGroupId:i,messageDeduplicationId:o,receiveCount:0,retentionExpiresAt:y,delayUntil:C},R=this.queueMessages.get(t)||[];if(l.type==="fifo"&&i){const T=this.messageGroups.get(t);if(T){const E=T.get(i)||[];E.push(S),T.set(i,E)}}R.push(S),this.queueMessages.set(t,R);const M=this.queueState.get(t);if(M){const T=this.queueMessages.get(t)||[],E=this.inFlightMessages.get(t)||[],A=T.filter(_=>_.delayUntil&&d<_.delayUntil);M.approximateMessages=T.length,M.approximateMessagesNotVisible=E.length,M.approximateMessagesDelayed=A.length,M.sentCount=(M.sentCount||0)+1,M.lastUpdate=d}return f}receiveMessage(t,e=1,s){const n=this.queues.get(t);if(!n)return[];const i=Date.now(),l=(s!==void 0?s:n.visibilityTimeout)*1e3;let d=(this.queueMessages.get(t)||[]).filter(y=>!(y.delayUntil&&i<y.delayUntil||i>=y.retentionExpiresAt));if(n.type==="fifo"){const y=this.messageGroups.get(t);if(y){d=[];let b=0;for(const[C,S]of y.entries()){if(b>=e)break;if(S.length>0){const R=S[0];(!R.delayUntil||i>=R.delayUntil)&&i<R.retentionExpiresAt&&(d.push(R),b++)}}}}const h=Math.min(e,d.length),f=[];for(let y=0;y<h;y++){const b=d[y],C=`receipt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;b.receiptHandle=C,b.receiveCount=(b.receiveCount||0)+1,b.firstReceivedAt||(b.firstReceivedAt=i);const S={message:b,receivedAt:i,visibilityTimeoutExpiresAt:i+l},R=this.inFlightMessages.get(t)||[];R.push(S),this.inFlightMessages.set(t,R);const M=this.queueMessages.get(t)||[],T=M.indexOf(b);if(T>-1&&M.splice(T,1),this.queueMessages.set(t,M),n.type==="fifo"&&b.messageGroupId){const E=this.messageGroups.get(t);if(E){const A=E.get(b.messageGroupId)||[],_=A.indexOf(b);_>-1&&A.splice(_,1),A.length===0?E.delete(b.messageGroupId):E.set(b.messageGroupId,A)}}f.push(b)}const m=this.queueState.get(t);return m&&(m.receivedCount=(m.receivedCount||0)+f.length,m.lastUpdate=i),f}deleteMessage(t,e){if(!this.queues.get(t))return!1;const n=this.inFlightMessages.get(t)||[],i=n.findIndex(l=>l.message.receiptHandle===e);if(i===-1)return!1;n[i],n.splice(i,1),this.inFlightMessages.set(t,n);const o=this.queueState.get(t);return o&&(o.deletedCount=(o.deletedCount||0)+1,o.lastUpdate=Date.now()),!0}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){const i=this.inFlightMessages.get(s)||[],o=[],l=[];for(const m of i)if(e>=m.visibilityTimeoutExpiresAt){const y=m.message;y.receiptHandle=void 0,n.maxReceiveCount&&y.receiveCount>=n.maxReceiveCount?this.sendToDLQ(n,y):o.push(y)}else l.push(m);if(this.inFlightMessages.set(s,l),o.length>0){const m=this.queueMessages.get(s)||[];if(n.type==="fifo"){const y=this.messageGroups.get(s);if(y)for(const b of o){const C=b.messageGroupId||"default-group",S=y.get(C)||[];S.push(b),y.set(C,S)}}m.push(...o),this.queueMessages.set(s,m)}const h=(this.queueMessages.get(s)||[]).filter(m=>e>=m.retentionExpiresAt?(n.deadLetterQueue&&this.sendToDLQ(n,m),!1):!0);if(this.queueMessages.set(s,h),n.type==="fifo"){const m=this.messageGroups.get(s);if(m)for(const[y,b]of m.entries()){const C=b.filter(S=>e>=S.retentionExpiresAt?(n.deadLetterQueue&&this.sendToDLQ(n,S),!1):!0);C.length===0?m.delete(y):m.set(y,C)}}const f=this.queueState.get(s);if(f){const m=this.queueMessages.get(s)||[],y=this.inFlightMessages.get(s)||[],b=m.filter(C=>C.delayUntil&&e<C.delayUntil);f.approximateMessages=m.length,f.approximateMessagesNotVisible=y.length,f.approximateMessagesDelayed=b.length,f.lastUpdate=e}}}sendToDLQ(t,e){if(!t.deadLetterQueue||!this.queues.get(t.deadLetterQueue))return;const n=this.dlqMessages.get(t.deadLetterQueue)||[];n.push(e),this.dlqMessages.set(t.deadLetterQueue,n);const i=this.queueState.get(t.deadLetterQueue);i&&(i.dlqCount=(i.dlqCount||0)+1,i.approximateMessages=n.length);const o=this.queueState.get(t.name);o&&(o.dlqCount=(o.dlqCount||0)+1)}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e).toString(36)}getQueueMetrics(t){if(!this.queues.get(t))return null;const s=this.queueState.get(t);return s?{approximateMessages:s.approximateMessages,approximateMessagesNotVisible:s.approximateMessagesNotVisible,approximateMessagesDelayed:s.approximateMessagesDelayed,sentCount:s.sentCount,receivedCount:s.receivedCount,deletedCount:s.deletedCount,dlqCount:s.dlqCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;for(const e of this.inFlightMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queueState.values())(e.sentCount>0||e.receivedCount>0)&&(t+=1);return Math.max(1,t)}updateQueue(t,e){const s=this.queues.get(t);s&&(Object.assign(s,e),this.queues.set(t,s))}}class RE{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;lockedMessages=new Map;deadLetterMessages=new Map;scheduledMessages=new Map;sessionMessages=new Map;queueState=new Map;subscriptionState=new Map;initialize(t){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.lockedMessages.clear(),this.deadLetterMessages.clear(),this.scheduledMessages.clear(),this.sessionMessages.clear(),this.queueState.clear(),this.subscriptionState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.lockedMessages.set(e.name,[]),this.deadLetterMessages.set(e.name,[]),this.scheduledMessages.set(e.name,[]),this.queueState.set(e.name,{activeMessageCount:e.activeMessageCount||0,deadLetterMessageCount:e.deadLetterMessageCount||0,scheduledMessageCount:e.scheduledMessageCount||0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),e.enableSessions&&this.sessionMessages.set(e.name,new Map);if(t.topics){for(const e of t.topics)if(this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.scheduledMessages.set(e.name,[]),this.subscriptions.set(e.name,[]),e.subscriptions)for(const s of e.subscriptions){const n=this.subscriptions.get(e.name)||[];n.push(s),this.subscriptions.set(e.name,n);const i=`${e.name}/subscriptions/${s.name}`;this.subscriptionMessages.set(i,[]),this.lockedMessages.set(i,[]),this.deadLetterMessages.set(i,[]),this.subscriptionState.set(i,{activeMessageCount:s.activeMessageCount||0,deadLetterMessageCount:0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),this.sessionMessages.set(i,new Map)}}}sendToQueue(t,e,s,n,i,o){const l=this.queues.get(t);if(!l)return null;const d=Date.now(),h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f=`${t}-${h}`,m=l.defaultMessageTimeToLive*1e3,y=d+m,b={id:h,messageId:f,timestamp:d,destination:t,payload:e,size:s,properties:n,sessionId:i,scheduledEnqueueTime:o,expirationTime:y,deliveryCount:0,enqueuedTime:o||d};if(o&&o>d){const S=this.scheduledMessages.get(t)||[];S.push(b),this.scheduledMessages.set(t,S);const R=this.queueState.get(t);return R&&(R.scheduledMessageCount=S.length),f}if(l.enableSessions&&i){const S=this.sessionMessages.get(t);if(S){const R=S.get(i)||[];R.push(b),S.set(i,R)}}else{const S=this.queueMessages.get(t)||[];S.push(b),this.queueMessages.set(t,S)}const C=this.queueState.get(t);if(C){const S=this.getAvailableMessages(t);C.activeMessageCount=S.length,C.sentCount=(C.sentCount||0)+1,C.lastUpdate=d}return f}publishToTopic(t,e,s,n,i){const o=this.topics.get(t);if(!o)return[];const l=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=`${t}-${d}`,f=o.defaultMessageTimeToLive*1e3,m=l+f,y={id:d,messageId:h,timestamp:l,destination:t,payload:e,size:s,properties:n,scheduledEnqueueTime:i,expirationTime:m,deliveryCount:0,enqueuedTime:i||l},b=[];if(i&&i>l){const S=this.scheduledMessages.get(t)||[];return S.push(y),this.scheduledMessages.set(t,S),[h]}const C=this.subscriptions.get(t)||[];if(C.length===0)return[];for(const S of C){const R=`${t}/subscriptions/${S.name}`,M=this.subscriptionMessages.get(R)||[],T={...y,id:`${d}-${S.name}`,messageId:`${h}-${S.name}`,subscriptionName:S.name};M.push(T),this.subscriptionMessages.set(R,M),b.push(T.messageId);const E=this.subscriptionState.get(R);if(E){const A=this.getAvailableSubscriptionMessages(R);E.activeMessageCount=A.length,E.sentCount=(E.sentCount||0)+1,E.lastUpdate=l}}return b}receiveFromQueue(t,e,s){const n=this.queues.get(t);if(!n)return null;const i=Date.now(),o=(e||n.lockDuration)*1e3,l=i+o;let d;if(n.enableSessions&&s){const y=this.sessionMessages.get(t);if(!y)return null;d=y.get(s)||[]}else d=this.getAvailableMessages(t);if(d.length===0)return null;const h=d.shift();h.deliveryCount=(h.deliveryCount||0)+1,h.lockedUntil=l,h.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const f=this.lockedMessages.get(t)||[];if(f.push({message:h,lockedAt:i,lockExpiresAt:l}),this.lockedMessages.set(t,f),n.enableSessions&&s){const y=this.sessionMessages.get(t);if(y){const b=y.get(s)||[],C=b.findIndex(S=>S.id===h.id);C>=0&&(b.splice(C,1),y.set(s,b))}}const m=this.queueState.get(t);if(m){const y=this.getAvailableMessages(t);m.activeMessageCount=y.length,m.receivedCount=(m.receivedCount||0)+1,m.lastUpdate=i}return h}receiveFromSubscription(t,e,s){const n=`${t}/subscriptions/${e}`,i=this.getAvailableSubscriptionMessages(n);if(i.length===0)return null;const o=this.subscriptions.get(t)?.find(b=>b.name===e);if(!o)return null;const l=Date.now(),d=(s||o.lockDuration)*1e3,h=l+d,f=i.shift();f.deliveryCount=(f.deliveryCount||0)+1,f.lockedUntil=h,f.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const m=this.lockedMessages.get(n)||[];m.push({message:f,lockedAt:l,lockExpiresAt:h}),this.lockedMessages.set(n,m);const y=this.subscriptionState.get(n);if(y){const b=this.getAvailableSubscriptionMessages(n);y.activeMessageCount=b.length,y.receivedCount=(y.receivedCount||0)+1,y.lastUpdate=l}return f}completeMessage(t,e){const s=this.lockedMessages.get(t)||[],n=s.findIndex(o=>o.message.lockToken===e);if(n<0)return!1;if(s.splice(n,1),this.lockedMessages.set(t,s),this.queues.has(t)){const o=this.queueState.get(t);o&&(o.completedCount=(o.completedCount||0)+1,o.lastUpdate=Date.now())}else{const o=this.subscriptionState.get(t);o&&(o.completedCount=(o.completedCount||0)+1,o.lastUpdate=Date.now())}return!0}abandonMessage(t,e){const s=this.lockedMessages.get(t)||[],n=s.findIndex(h=>h.message.lockToken===e);if(n<0)return!1;const i=s[n];s.splice(n,1),this.lockedMessages.set(t,s);const o=i.message;o.lockToken=void 0,o.lockedUntil=void 0;const l=this.queues.has(t),d=l?this.queues.get(t)?.maxDeliveryCount||10:this.subscriptions.get(o.destination)?.find(h=>h.name===o.subscriptionName)?.maxDeliveryCount||10;if(o.deliveryCount>=d){const h=this.deadLetterMessages.get(t)||[];if(h.push(o),this.deadLetterMessages.set(t,h),l){const f=this.queueState.get(t);f&&(f.deadLetterMessageCount=h.length,f.abandonedCount=(f.abandonedCount||0)+1,f.lastUpdate=Date.now())}else{const f=this.subscriptionState.get(t);f&&(f.deadLetterMessageCount=h.length,f.abandonedCount=(f.abandonedCount||0)+1,f.lastUpdate=Date.now())}}else{if(l){const h=this.queues.get(t);if(h)if(h.enableSessions&&o.sessionId){const f=this.sessionMessages.get(t);if(f){const m=f.get(o.sessionId)||[];m.push(o),f.set(o.sessionId,m)}}else{const f=this.queueMessages.get(t)||[];f.push(o),this.queueMessages.set(t,f)}}else{const h=this.subscriptionMessages.get(t)||[];h.push(o),this.subscriptionMessages.set(t,h)}if(l){const h=this.queueState.get(t);if(h){const f=this.getAvailableMessages(t);h.activeMessageCount=f.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now()}}else{const h=this.subscriptionState.get(t);if(h){const f=this.getAvailableSubscriptionMessages(t);h.activeMessageCount=f.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now()}}}return!0}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){const i=this.scheduledMessages.get(s)||[],o=this.queueMessages.get(s)||[],l=this.sessionMessages.get(s);for(let m=i.length-1;m>=0;m--){const y=i[m];if(y.scheduledEnqueueTime&&y.scheduledEnqueueTime<=e)if(i.splice(m,1),n.enableSessions&&y.sessionId&&l){const b=l.get(y.sessionId)||[];b.push(y),l.set(y.sessionId,b)}else o.push(y)}this.scheduledMessages.set(s,i),this.queueMessages.set(s,o);const d=this.lockedMessages.get(s)||[];for(let m=d.length-1;m>=0;m--){const y=d[m];y.lockExpiresAt<=e&&(d.splice(m,1),this.abandonMessage(s,y.message.lockToken))}this.lockedMessages.set(s,d);const h=this.getAvailableMessages(s);for(let m=h.length-1;m>=0;m--){const y=h[m];if(y.expirationTime<=e&&(h.splice(m,1),n.enableDeadLetteringOnMessageExpiration)){const b=this.deadLetterMessages.get(s)||[];b.push(y),this.deadLetterMessages.set(s,b)}}this.queueMessages.set(s,h);const f=this.queueState.get(s);f&&(f.activeMessageCount=this.getAvailableMessages(s).length,f.deadLetterMessageCount=(this.deadLetterMessages.get(s)||[]).length,f.scheduledMessageCount=i.length,f.lastUpdate=e)}for(const[s,n]of this.topics.entries()){const i=this.scheduledMessages.get(s)||[];for(let l=i.length-1;l>=0;l--){const d=i[l];d.scheduledEnqueueTime&&d.scheduledEnqueueTime<=e&&(i.splice(l,1),this.publishToTopic(s,d.payload,d.size,d.properties))}this.scheduledMessages.set(s,i);const o=this.subscriptions.get(s)||[];for(const l of o){const d=`${s}/subscriptions/${l.name}`,h=this.lockedMessages.get(d)||[];for(let y=h.length-1;y>=0;y--){const b=h[y];b.lockExpiresAt<=e&&(h.splice(y,1),this.abandonMessage(d,b.message.lockToken))}this.lockedMessages.set(d,h);const f=this.getAvailableSubscriptionMessages(d);for(let y=f.length-1;y>=0;y--){const b=f[y];if(b.expirationTime<=e&&(f.splice(y,1),l.enableDeadLetteringOnMessageExpiration)){const C=this.deadLetterMessages.get(d)||[];C.push(b),this.deadLetterMessages.set(d,C)}}this.subscriptionMessages.set(d,f);const m=this.subscriptionState.get(d);m&&(m.activeMessageCount=this.getAvailableSubscriptionMessages(d).length,m.deadLetterMessageCount=(this.deadLetterMessages.get(d)||[]).length,m.lastUpdate=e)}}}getAvailableMessages(t){if(!this.queues.get(t))return[];const s=Date.now();return(this.queueMessages.get(t)||[]).filter(i=>i.expirationTime>s)}getAvailableSubscriptionMessages(t){const e=Date.now();return(this.subscriptionMessages.get(t)||[]).filter(n=>n.expirationTime>e)}getTotalQueueDepth(){let t=0;for(const e of this.queues.keys())t+=this.getAvailableMessages(e).length;return t}getTotalSubscriptionMessages(){let t=0;for(const e of this.subscriptionMessages.keys())t+=this.getAvailableSubscriptionMessages(e).length;return t}getQueueMetrics(t){const e=this.queueState.get(t);return e?{activeMessageCount:e.activeMessageCount,deadLetterMessageCount:e.deadLetterMessageCount,scheduledMessageCount:e.scheduledMessageCount,sentCount:e.sentCount,receivedCount:e.receivedCount,completedCount:e.completedCount,abandonedCount:e.abandonedCount}:null}getSubscriptionMetrics(t,e){const s=`${t}/subscriptions/${e}`,n=this.subscriptionState.get(s);return n?{activeMessageCount:n.activeMessageCount,deadLetterMessageCount:n.deadLetterMessageCount,sentCount:n.sentCount,receivedCount:n.receivedCount,completedCount:n.completedCount,abandonedCount:n.abandonedCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getAllSubscriptionMetrics(){const t=new Map;for(const[e,s]of this.subscriptionState.entries())t.set(e,{activeMessageCount:s.activeMessageCount,deadLetterMessageCount:s.deadLetterMessageCount,sentCount:s.sentCount,receivedCount:s.receivedCount,completedCount:s.completedCount,abandonedCount:s.abandonedCount});return t}getActiveConnections(){return this.queues.size+this.topics.size}}class kE{topics=new Map;subscriptions=new Map;topicSubscriptions=new Map;topicMessages=new Map;subscriptionMessages=new Map;unackedMessages=new Map;orderingKeyQueues=new Map;topicState=new Map;subscriptionState=new Map;initialize(t){if(this.topics.clear(),this.subscriptions.clear(),this.topicSubscriptions.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.unackedMessages.clear(),this.orderingKeyQueues.clear(),this.topicState.clear(),this.subscriptionState.clear(),t.topics)for(const e of t.topics)this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.topicSubscriptions.set(e.name,[]),this.orderingKeyQueues.set(e.name,new Map),this.topicState.set(e.name,{messageCount:e.messageCount||0,byteCount:e.byteCount||0,publishedCount:0,lastUpdate:Date.now()});if(t.subscriptions)for(const e of t.subscriptions){this.subscriptions.set(e.name,{...e}),this.subscriptionMessages.set(e.name,[]),this.unackedMessages.set(e.name,[]);const s=this.topicSubscriptions.get(e.topic)||[];s.includes(e.name)||s.push(e.name),this.topicSubscriptions.set(e.topic,s),this.subscriptionState.set(e.name,{messageCount:e.messageCount||0,unackedMessageCount:e.unackedMessageCount||0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:Date.now()})}}publishToTopic(t,e,s,n,i){if(!this.topics.get(t))return null;const l=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=l,f={id:`pubsub_${d}`,messageId:d,publishTime:h,data:e,attributes:n,orderingKey:i,size:s},m=this.topicMessages.get(t)||[];if(i){const C=this.orderingKeyQueues.get(t)||new Map,S=C.get(i)||[];S.push(f),C.set(i,S),this.orderingKeyQueues.set(t,C)}else m.push(f),this.topicMessages.set(t,m);const y=this.topicSubscriptions.get(t)||[];for(const C of y){const S=this.subscriptions.get(C);if(!S)continue;const R={...f,id:`${f.id}_${C}`},M=this.subscriptionMessages.get(C)||[];S.enableMessageOrdering,M.push(R),this.subscriptionMessages.set(C,M)}const b=this.topicState.get(t)||{messageCount:0,byteCount:0,publishedCount:0,lastUpdate:l};return b.messageCount=m.length+(i&&this.orderingKeyQueues.get(t)?.get(i)?.length||0),b.byteCount=(b.byteCount||0)+s,b.publishedCount=(b.publishedCount||0)+1,b.lastUpdate=l,this.topicState.set(t,b),d}pullFromSubscription(t,e=100){const s=this.subscriptions.get(t);if(!s)return[];const n=this.subscriptionMessages.get(t)||[];if(n.length===0)return[];const i=Date.now(),o=s.ackDeadlineSeconds*1e3,l=[],d=[];if(s.enableMessageOrdering){const m=new Map;for(const y of n){const b=y.orderingKey||"__no_key__";m.has(b)||m.set(b,[]),m.get(b).push(y)}for(const[y,b]of m.entries()){if(l.length>=e)break;const C=Math.min(b.length,e-l.length),S=b.splice(0,C);l.push(...S),d.push(...b)}for(const[y,b]of m.entries())b.length>0&&d.find(C=>(C.orderingKey||"__no_key__")===y)===void 0&&d.push(...b)}else{const m=Math.min(n.length,e);l.push(...n.splice(0,m)),d.push(...n)}this.subscriptionMessages.set(t,d);const h=this.unackedMessages.get(t)||[];for(const m of l){const y=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;m.ackId=y,h.push({message:m,subscriptionName:t,ackDeadlineExpiresAt:i+o,deliveryAttempt:1,orderingKey:m.orderingKey})}this.unackedMessages.set(t,h);const f=this.subscriptionState.get(t)||{messageCount:0,unackedMessageCount:0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:i};return f.messageCount=d.length,f.unackedMessageCount=h.length,f.deliveredCount=(f.deliveredCount||0)+l.length,f.lastUpdate=i,this.subscriptionState.set(t,f),l}ackMessage(t,e){if(!this.subscriptions.get(t))return!1;const n=this.unackedMessages.get(t)||[],i=n.length,o=n.filter(l=>l.message.ackId!==e);if(this.unackedMessages.set(t,o),o.length<i){const l=this.subscriptionState.get(t);return l&&(l.unackedMessageCount=o.length,l.acknowledgedCount=(l.acknowledgedCount||0)+1,l.lastUpdate=Date.now()),!0}return!1}nackMessage(t,e){if(!this.subscriptions.get(t))return!1;const n=this.unackedMessages.get(t)||[],i=n.findIndex(f=>f.message.ackId===e);if(i===-1)return!1;const l=n[i].message;n.splice(i,1),this.unackedMessages.set(t,n);const d=this.subscriptionMessages.get(t)||[];l.ackId=void 0,d.push(l),this.subscriptionMessages.set(t,d);const h=this.subscriptionState.get(t);return h&&(h.unackedMessageCount=n.length,h.messageCount=d.length,h.nackedCount=(h.nackedCount||0)+1,h.lastUpdate=Date.now()),!0}processConsumption(t){const e=Date.now();for(const[s,n]of this.unackedMessages.entries()){if(!this.subscriptions.get(s))continue;const o=[],l=[];for(const d of n)e>=d.ackDeadlineExpiresAt?o.push(d):l.push(d);if(o.length>0){const d=this.subscriptionMessages.get(s)||[];for(const f of o){const m=f.message;m.ackId=void 0,d.push(m)}this.subscriptionMessages.set(s,d);const h=this.subscriptionState.get(s);h&&(h.unackedMessageCount=l.length,h.messageCount=d.length)}this.unackedMessages.set(s,l)}for(const[s,n]of this.subscriptions.entries())if(n.pushEndpoint){const i=this.subscriptionMessages.get(s)||[];if(i.length>0){const l=Math.min(i.length,10),d=i.splice(0,l),h=this.unackedMessages.get(s)||[],f=Date.now(),m=n.ackDeadlineSeconds*1e3;for(const b of d){const C=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;b.ackId=C,h.push({message:b,subscriptionName:s,ackDeadlineExpiresAt:f+m,deliveryAttempt:1,orderingKey:b.orderingKey})}this.subscriptionMessages.set(s,i),this.unackedMessages.set(s,h);const y=this.subscriptionState.get(s);y&&(y.messageCount=i.length,y.unackedMessageCount=h.length,y.deliveredCount=(y.deliveredCount||0)+d.length)}}for(const[s,n]of this.topics.entries()){const o=(n.messageRetentionDuration||604800)*1e3,l=this.topicMessages.get(s)||[],d=Date.now(),h=l.filter(f=>d-f.publishTime<o);if(h.length<l.length){l.length-h.length,this.topicMessages.set(s,h);const f=this.topicState.get(s);f&&(f.messageCount=h.length)}}}getTopicMetrics(t){if(!this.topics.get(t))return null;const s=this.topicState.get(t);return s?{messageCount:s.messageCount,byteCount:s.byteCount,publishedCount:s.publishedCount}:null}getSubscriptionMetrics(t){if(!this.subscriptions.get(t))return null;const s=this.subscriptionState.get(t);return s?{messageCount:s.messageCount,unackedMessageCount:s.unackedMessageCount,deliveredCount:s.deliveredCount,acknowledgedCount:s.acknowledgedCount,nackedCount:s.nackedCount}:null}getAllTopicMetrics(){const t=new Map;for(const e of this.topics.keys()){const s=this.getTopicMetrics(e);s&&t.set(e,s)}return t}getAllSubscriptionMetrics(){const t=new Map;for(const e of this.subscriptions.keys()){const s=this.getSubscriptionMetrics(e);s&&t.set(e,s)}return t}getTotalTopicMessages(){let t=0;for(const e of this.topicMessages.values())t+=e.length;for(const e of this.orderingKeyQueues.values())for(const s of e.values())t+=s.length;return t}getTotalUnackedMessages(){let t=0;for(const e of this.unackedMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.subscriptions.values())e.pushEndpoint,t+=1;return Math.max(1,t+1)}updateTopic(t,e){const s=this.topics.get(t);s&&(Object.assign(s,e),this.topics.set(t,s))}updateSubscription(t,e){const s=this.subscriptions.get(t);s&&(Object.assign(s,e),this.subscriptions.set(t,s))}}class EE{services=new Map;routes=new Map;upstreams=new Map;consumers=new Map;plugins=[];roundRobinCounters=new Map;connectionCounts=new Map;consistentHashRing=new Map;rateLimitCounters=new Map;initialize(t){if(this.services.clear(),this.routes.clear(),this.upstreams.clear(),this.consumers.clear(),this.plugins=[],this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.consistentHashRing.clear(),this.rateLimitCounters.clear(),t.services)for(const e of t.services)this.services.set(e.id,{...e});if(t.routes)for(const e of t.routes)this.routes.set(e.id,{...e});if(t.upstreams){for(const e of t.upstreams)if(this.upstreams.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),e.algorithm==="consistent-hashing"&&e.targets){const s=[...e.targets].filter(n=>n.health==="healthy").sort((n,i)=>n.target.localeCompare(i.target));this.consistentHashRing.set(e.name,s.map(n=>n.target))}}if(t.consumers)for(const e of t.consumers)this.consumers.set(e.id,{...e});t.plugins&&(this.plugins=t.plugins.filter(e=>e.enabled))}routeRequest(t){const e=Date.now(),s=this.matchRoute(t);if(!s)return{match:null,response:{status:404,error:"No route matched",latency:Date.now()-e}};const n=this.executePlugins(t,s,"access");if(n.blocked)return{match:s,response:{status:n.status||403,error:n.error||"Request blocked by plugin",latency:Date.now()-e}};const i=this.selectUpstreamTarget(s.service);if(!i)return{match:s,response:{status:503,error:"No healthy upstream target available",latency:Date.now()-e}};this.transformPath(t.path,s);const o={status:200,latency:Date.now()-e};return o.latency=(o.latency||0)+this.simulateUpstreamLatency(i),{match:s,response:o,target:i}}matchRoute(t){const e=Array.from(this.routes.values()).sort((s,n)=>(n.priority||0)-(s.priority||0));for(const s of e){if(s.method&&s.method.toUpperCase()!==t.method.toUpperCase())continue;const n=this.matchPath(s.path,t.path);if(n){const i=this.services.get(s.service);if(!i||!i.enabled)continue;return{route:s,service:i,matchedPath:n.matched,remainingPath:n.remaining}}}return null}matchPath(t,e){if(e.startsWith(t))return{matched:t,remaining:e.substring(t.length)};try{if(new RegExp(`^${t}$`).test(e))return{matched:e,remaining:""}}catch{}return null}selectUpstreamTarget(t){const e=t.upstream||t.name,s=this.upstreams.get(e);if(!s||!s.targets||s.targets.length===0)return t.url;const n=s.targets.filter(o=>o.health==="healthy");if(n.length===0)return null;switch(s.algorithm||"round-robin"){case"round-robin":return this.selectRoundRobin(e,n);case"consistent-hashing":return this.selectConsistentHash(e,n,t.name);case"least-connections":return this.selectLeastConnections(n);default:return n[0].target}}selectRoundRobin(t,e){const s=this.roundRobinCounters.get(t)||0,n=e[s%e.length];return this.roundRobinCounters.set(t,(s+1)%e.length),n.target}selectConsistentHash(t,e,s){const i=this.simpleHash(s)%e.length;return e[i].target}selectLeastConnections(t){let e=1/0,s=t[0].target;for(const i of t){const o=this.connectionCounts.get(i.target)||0;o<e&&(e=o,s=i.target)}const n=this.connectionCounts.get(s)||0;return this.connectionCounts.set(s,n+1),s}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}transformPath(t,e){return e.route.stripPath?e.remainingPath||"/":t}executePlugins(t,e,s){const n=this.plugins.filter(i=>!(i.route&&i.route!==e.route.id||i.service&&i.service!==e.service.id));for(const i of n){const o=this.executePlugin(i,t,e,s);if(o.blocked)return o}return{blocked:!1}}executePlugin(t,e,s,n){const i=t.config||{};switch(t.name){case"rate-limiting":return this.executeRateLimiting(t,e,s,i);case"key-auth":return this.executeKeyAuth(t,e,s,i);case"jwt":return this.executeJWT(t,e,s,i);case"cors":return{blocked:!1};case"ip-restriction":return this.executeIPRestriction(t,e,s,i);default:return{blocked:!1}}}executeRateLimiting(t,e,s,n){const i=e.consumerId||s.service.id||s.route.id,o=Date.now();let l=this.rateLimitCounters.get(t.id);l||(l=new Map,this.rateLimitCounters.set(t.id,l));let d=l.get(i);(!d||d.resetAt<o)&&(d={count:0,resetAt:o+6e4},l.set(i,d));const h=n.minute||1e3;return n.hour,d.count++,d.count>h?{blocked:!0,status:429,error:"Rate limit exceeded (per minute)"}:{blocked:!1}}executeKeyAuth(t,e,s,n){const i=n.key_names||["apikey"],o=e.apiKey||e.headers?.[i[0]]||e.query?.[i[0]];return o?Array.from(this.consumers.values()).find(d=>d.credentials?.some(h=>h.type==="key-auth"&&h.key===o))?{blocked:!1}:{blocked:!0,status:401,error:"Invalid API key"}:{blocked:!0,status:401,error:"API key required"}}executeJWT(t,e,s,n){const i=e.headers?.Authorization;return!i||!i.startsWith("Bearer ")?{blocked:!0,status:401,error:"JWT token required"}:{blocked:!1}}executeIPRestriction(t,e,s,n){const i=e.headers?.["X-Forwarded-For"]||e.headers?.["X-Real-IP"]||"unknown",o=n.whitelist||[];return(n.blacklist||[]).includes(i)?{blocked:!0,status:403,error:"IP address blocked"}:o.length>0&&!o.includes(i)?{blocked:!0,status:403,error:"IP address not whitelisted"}:{blocked:!1}}simulateUpstreamLatency(t){return 10+Math.random()*40}getStats(){return{services:this.services.size,routes:this.routes.size,upstreams:this.upstreams.size,consumers:this.consumers.size,plugins:this.plugins.length}}}class TE{proxies=new Map;policies=[];organization;environment;quotaCounters=new Map;spikeArrestBuckets=new Map;apiKeyCache=new Map;oauthTokenCache=new Map;jwtTokenCache=new Map;proxyMetrics=new Map;initialize(t){if(this.proxies.clear(),this.policies=[],this.quotaCounters.clear(),this.spikeArrestBuckets.clear(),this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear(),this.proxyMetrics.clear(),this.organization=t.organization||"archiphoenix-org",this.environment=t.environment||"prod",t.proxies)for(const e of t.proxies)this.proxies.set(e.name,{...e}),this.proxyMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),e.spikeArrest&&e.spikeArrest>0&&this.spikeArrestBuckets.set(e.name,{tokens:e.spikeArrest,lastRefill:Date.now(),rate:e.spikeArrest});t.policies&&(this.policies=t.policies.filter(e=>e.enabled))}routeRequest(t){const e=Date.now(),s=this.matchProxy(t);if(!s)return{match:null,response:{status:404,error:"No API proxy matched for path",latency:Date.now()-e}};if(s.proxy.status==="undeployed")return this.updateProxyMetrics(s.proxy.name,!1,Date.now()-e),{match:s,response:{status:503,error:`Proxy '${s.proxy.name}' is not deployed`,latency:Date.now()-e}};const n=this.policies.filter(b=>b.enabled&&(b.executionFlow==="PreFlow"||!b.executionFlow&&this.isPreFlowPolicy(b.type))),i=this.executePolicies(n,t,s,"PreFlow");if(i.blocked)return this.updateProxyMetrics(s.proxy.name,!0,Date.now()-e),{match:s,response:{status:i.status||401,error:i.error||"Authentication failed",latency:Date.now()-e}};const o=this.policies.filter(b=>b.enabled&&(b.executionFlow==="RequestFlow"||!b.executionFlow&&this.isRequestFlowPolicy(b.type))),l=this.executePolicies(o,t,s,"RequestFlow");if(l.blocked)return this.updateProxyMetrics(s.proxy.name,!0,Date.now()-e),{match:s,response:{status:l.status||429,error:l.error||"Request policy violation",latency:Date.now()-e}};const d=this.buildTargetUrl(s.proxy,s.remainingPath),h=this.simulateUpstreamLatency(d),f=Date.now()-e+h,m=this.policies.filter(b=>b.enabled&&(b.executionFlow==="PostFlow"||!b.executionFlow&&this.isPostFlowPolicy(b.type))),y={status:200,latency:f};return this.executePolicies(m,t,s,"PostFlow",y),this.updateProxyMetrics(s.proxy.name,!1,f),{match:s,response:y,target:d}}matchProxy(t){const e=Array.from(this.proxies.values()).filter(s=>s.status==="deployed"||s.status===void 0).sort((s,n)=>n.basePath.length-s.basePath.length);for(const s of e)if(t.path.startsWith(s.basePath)){const n=t.path.slice(s.basePath.length)||"/";return{proxy:s,matchedPath:s.basePath,remainingPath:n}}return null}isPreFlowPolicy(t){return["verify-api-key","oauth","jwt"].includes(t)}isRequestFlowPolicy(t){return["quota","spike-arrest"].includes(t)}isPostFlowPolicy(t){return["cors","xml-to-json"].includes(t)}evaluateCondition(t,e,s){if(!t)return!0;try{if(t.includes("request.path")){const n=t.match(/request\.path\s*[=!]=\s*['"]([^'"]+)['"]/);if(n)return e.path===n[1]}return t.length>0}catch{return!0}}executePolicies(t,e,s,n,i){for(const o of t)if(this.evaluateCondition(o.condition,e,s))if(n==="PreFlow"){const l=this.executePreFlowPolicy(o,e,s);if(l.blocked)return l}else if(n==="RequestFlow"){const l=this.executeRequestFlowPolicy(o,e,s);if(l.blocked)return l}else n==="PostFlow"&&i&&this.executePostFlowPolicy(o,e,s,i);return{blocked:!1}}executePreFlowPolicy(t,e,s){if(s.proxy,t.type==="verify-api-key"){const n=e.apiKey||e.headers?.["X-API-Key"]||e.headers?.apikey||e.query?.apikey;if(!n)return{blocked:!0,status:401,error:"API key is required"};if(!this.validateApiKey(n))return{blocked:!0,status:401,error:"Invalid API key"}}if(t.type==="oauth"&&s.proxy.enableOAuth){const i=e.oauthToken||e.headers?.Authorization?.replace("Bearer ","")||e.headers?.Authorization?.replace("OAuth ","");if(!i)return{blocked:!0,status:401,error:"OAuth token is required"};if(!this.validateOAuthToken(i))return{blocked:!0,status:401,error:"Invalid or expired OAuth token"}}if(t.type==="jwt"){const n=s.proxy;if(n.jwtIssuer){const i=e.jwtToken||e.headers?.Authorization?.replace("Bearer ","")||e.headers?.["X-JWT-Token"];if(!i)return{blocked:!0,status:401,error:"JWT token is required"};if(!this.validateJWTToken(i,n.jwtIssuer))return{blocked:!0,status:401,error:"Invalid or expired JWT token"}}}return{blocked:!1}}executeRequestFlowPolicy(t,e,s){const n=s.proxy,i=e.headers?.["X-Consumer-ID"]||"default";if(t.type==="quota"){const o=t.config?.quota||n.quota,l=t.config?.interval||n.quotaInterval;if(o&&l&&!this.checkQuota(n.name,i,o,l))return{blocked:!0,status:429,error:`Quota exceeded: ${o} requests per ${l} seconds`}}if(t.type==="spike-arrest"){const o=t.config?.rate||n.spikeArrest;if(o&&o>0&&!this.checkSpikeArrest(n.name,o))return{blocked:!0,status:429,error:`Spike arrest limit exceeded: ${o} requests per second`}}return{blocked:!1}}executePostFlowPolicy(t,e,s,n){t.type==="cors"&&(n.headers||(n.headers={}),n.headers["Access-Control-Allow-Origin"]=t.config?.origins?.[0]||"*",n.headers["Access-Control-Allow-Methods"]=t.config?.methods?.join(", ")||"GET, POST, PUT, DELETE",n.headers["Access-Control-Allow-Headers"]=t.config?.headers?.join(", ")||"Content-Type, Authorization"),t.type==="xml-to-json"&&(n.headers||(n.headers={}),n.headers["Content-Type"]="application/json")}checkQuota(t,e,s,n){const i=Date.now(),o=n*1e3;let l=this.quotaCounters.get(t);l||(l=new Map,this.quotaCounters.set(t,l));let d=l.get(e);return(!d||d.resetAt<i)&&(d={count:0,resetAt:i+o,identifier:e},l.set(e,d)),d.count>=s?!1:(d.count++,!0)}checkSpikeArrest(t,e){const s=Date.now();let n=this.spikeArrestBuckets.get(t);n||(n={tokens:e,lastRefill:s,rate:e},this.spikeArrestBuckets.set(t,n));const o=(s-n.lastRefill)/1e3*n.rate;return n.tokens=Math.min(n.rate,n.tokens+o),n.lastRefill=s,n.tokens<1?!1:(n.tokens-=1,!0)}validateApiKey(t){const e=this.apiKeyCache.get(t);if(e&&e.expiresAt>Date.now())return e.valid;const s=t.length>=10;return this.apiKeyCache.set(t,{valid:s,expiresAt:Date.now()+300*1e3}),s}validateOAuthToken(t){const e=this.oauthTokenCache.get(t);if(e&&e.expiresAt>Date.now())return e.valid;const s=t.length>=20;return this.oauthTokenCache.set(t,{valid:s,expiresAt:Date.now()+3600*1e3}),s}validateJWTToken(t,e){const s=this.jwtTokenCache.get(t);if(s&&s.expiresAt>Date.now())return s.valid&&s.issuer===e;const n=t.length>=20;return this.jwtTokenCache.set(t,{valid:n,issuer:e,expiresAt:Date.now()+3600*1e3}),n}buildTargetUrl(t,e){const s=t.targetEndpoint.replace(/\/$/,""),n=e.startsWith("/")?e:`/${e}`;return`${s}${n}`}simulateUpstreamLatency(t){const e=10+Math.random()*40,s=(Math.random()-.5)*10;return Math.max(1,e+s)}updateProxyMetrics(t,e,s){const n=this.proxyMetrics.get(t);n&&(n.requestCount++,e&&n.errorCount++,n.totalLatency+=s,n.lastRequestTime=Date.now())}getStats(){let t=0,e=0,s=0;for(const i of this.proxyMetrics.values())t+=i.requestCount,e+=i.errorCount,s+=i.totalLatency;const n=t>0?s/t:0;return{proxies:this.proxies.size,policies:this.policies.length,totalRequests:t,totalErrors:e,avgLatency:n}}getProxyMetrics(t){const e=this.proxyMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgResponseTime:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}clearCaches(){this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear()}}class AE{applications=new Map;connectors=new Map;organization;environment;applicationMetrics=new Map;connectorMetrics=new Map;reconnectionState=new Map;initialize(t){if(this.applications.clear(),this.connectors.clear(),this.applicationMetrics.clear(),this.connectorMetrics.clear(),this.reconnectionState.clear(),this.organization=t.organization||"archiphoenix-org",this.environment=t.environment||"production",t.applications)for(const e of t.applications)this.applications.set(e.name,{...e}),this.applicationMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0});if(t.connectors)for(const e of t.connectors)this.connectors.set(e.name,{...e}),this.connectorMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),this.reconnectionState.set(e.name,{attempts:0,lastAttempt:0,nextAttempt:0})}processData(t){const e=Date.now(),s=this.matchApplication(t);if(!s)return{match:null,response:{status:"error",error:"No Mule application matched for request",latency:Date.now()-e}};if(s.application.status!=="running")return this.updateApplicationMetrics(s.application.name,!1,Date.now()-e),{match:s,response:{status:"error",error:`Application '${s.application.name}' is not running (status: ${s.application.status})`,latency:Date.now()-e}};let n=0,i;try{n=this.processFlow(s,t)}catch(l){i=l instanceof Error?l.message:"Unknown error"}if(i&&!this.handleError(s.application,i))return this.updateApplicationMetrics(s.application.name,!0,Date.now()-e),{match:s,response:{status:"error",error:i,latency:Date.now()-e,application:s.application.name,flow:s.flow?.name}};const o=this.transformData(t,s);return this.updateApplicationMetrics(s.application.name,!1,Date.now()-e),s.matchedConnector&&this.updateConnectorMetrics(s.matchedConnector.name,!1,Date.now()-e),{match:s,response:{status:"success",data:o.data,format:o.format||t.format,latency:Date.now()-e,application:s.application.name,flow:s.flow?.name,connector:s.matchedConnector?.name}}}matchApplication(t){if(t.sourceComponentType||t.targetComponentType)for(const[e,s]of this.applications.entries()){if(s.status!=="running")continue;const n=this.findMatchingConnector(s,t.sourceComponentType,t.targetComponentType);if(n){const i=s.flows?.find(o=>o.source===n.name||o.target===n.name)||s.flows?.[0];return{application:s,flow:i,matchedConnector:n}}}for(const[e,s]of this.applications.entries())if(s.status==="running")return{application:s,flow:s.flows?.[0]};return null}findMatchingConnector(t,e,s){const n=t.connectors||[];for(const i of n){const o=this.connectors.get(i);if(!(!o||!o.enabled)&&(e&&this.connectorMatchesComponentType(o,e)||s&&this.connectorMatchesComponentType(o,s)))return o}return null}connectorMatchesComponentType(t,e){const s={database:["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],api:["rest","grpc","graphql","soap","websocket","webhook"],messaging:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],file:["s3-datalake"],business:["crm","erp","payment-gateway"]};for(const[n,i]of Object.entries(s))if(t.type===n&&i.includes(e))return!0;return t.targetComponentType===e}processFlow(t,e){if(!t.flow)return this.calculateBaseProcessingTime(t.application);let s=this.calculateBaseProcessingTime(t.application);if(t.flow.processors)for(const n of t.flow.processors)s+=this.processProcessor(n,e);return t.matchedConnector&&(s+=this.calculateConnectorLatency(t.matchedConnector)),s}calculateBaseProcessingTime(t){const e=5+Math.random()*10,s=parseFloat(t.runtimeVersion)>=4.5?.9:1;return e*s}processProcessor(t,e){switch(t.type){case"transform":return 2+Math.random()*6;case"validate":return 1+Math.random()*2;case"filter":return .5+Math.random()*1.5;case"enrich":return 3+Math.random()*7;case"route":return .5+Math.random()*.5;default:return 1}}calculateConnectorLatency(t){const s={database:10,api:20,messaging:5,file:50,custom:15}[t.type]||15,n=s*.5*Math.random();return s+n}transformData(t,e){if(t.targetComponentType){const s=this.getTargetFormat(t.targetComponentType);if(s&&s!==t.format)return{data:t.body,format:s}}return{data:t.body,format:t.format}}getTargetFormat(t){return{postgres:"json",mongodb:"json",redis:"json",rest:"json",graphql:"json",soap:"xml",grpc:"binary",kafka:"json",rabbitmq:"json"}[t]}handleError(t,e){switch(t.errorStrategy||"continue"){case"continue":return!0;case"rollback":return!1;case"propagate":return!1;default:return!1}}updateApplicationMetrics(t,e,s){const n=this.applicationMetrics.get(t);n&&(n.requestCount++,e&&n.errorCount++,n.totalLatency+=s,n.lastRequestTime=Date.now())}updateConnectorMetrics(t,e,s){const n=this.connectorMetrics.get(t);n&&(n.requestCount++,e&&n.errorCount++,n.totalLatency+=s,n.lastRequestTime=Date.now())}getStats(){let t=0,e=0,s=0;for(const o of this.applicationMetrics.values())t+=o.requestCount,e+=o.errorCount,s+=o.totalLatency;const n=Array.from(this.applications.values()).filter(o=>o.status==="running").length,i=Array.from(this.connectors.values()).filter(o=>o.enabled).length;return{applications:this.applications.size,runningApplications:n,connectors:this.connectors.size,enabledConnectors:i,totalRequests:t,totalErrors:e,avgLatency:t>0?s/t:0}}getApplicationMetrics(t){const e=this.applicationMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgLatency:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}getConnectorMetrics(t){const e=this.connectorMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgLatency:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}}class DE{locations=[];upstreams=new Map;rateLimitZones=new Map;sslCertificates=new Map;roundRobinCounters=new Map;connectionCounts=new Map;ipHashMap=new Map;hashRing=new Map;rateLimitCounters=new Map;cache=new Map;enableSSL=!1;sslPort=443;enableGzip=!0;enableCache=!0;maxWorkers=4;requestCount=0;cacheHits=0;cacheMisses=0;rateLimitBlocks=0;initialize(t){if(this.locations=[],this.upstreams.clear(),this.rateLimitZones.clear(),this.sslCertificates.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.ipHashMap.clear(),this.hashRing.clear(),this.rateLimitCounters.clear(),this.cache.clear(),t.locations&&(this.locations=[...t.locations].sort((e,s)=>s.path.length!==e.path.length?s.path.length-e.path.length:e.path.localeCompare(s.path))),t.upstreams){for(const e of t.upstreams)if(this.upstreams.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),e.method==="hash"&&e.servers){const s=[...e.servers].filter(n=>!n.down&&n.health!=="unhealthy").sort((n,i)=>n.address.localeCompare(i.address));this.hashRing.set(e.name,s.map(n=>n.address))}}if(t.rateLimitZones)for(const e of t.rateLimitZones)this.rateLimitZones.set(e.name,{...e});if(t.sslCertificates)for(const e of t.sslCertificates)this.sslCertificates.set(e.name,{...e});this.enableSSL=t.enableSSL??!1,this.sslPort=t.sslPort||443,this.enableGzip=t.enableGzip??!0,this.enableCache=t.enableCache??!0,this.maxWorkers=t.maxWorkers||4}routeRequest(t){const e=Date.now();if(this.requestCount++,!this.enableSSL&&t.protocol==="https")return{match:null,response:{status:400,error:"HTTPS not enabled",latency:Date.now()-e}};const s=this.matchLocation(t);if(!s)return{match:null,response:{status:404,error:"No location matched",latency:Date.now()-e}};if(s.location.rateLimit){const o=this.checkRateLimit(s.location.rateLimit,t);if(o.blocked)return this.rateLimitBlocks++,{match:s,response:{status:429,error:o.error||"Rate limit exceeded",latency:Date.now()-e}}}if(this.enableCache&&s.location.cache?.enabled&&t.method==="GET"){const o=this.getCacheKey(t,s),l=this.cache.get(o);if(l&&l.expiresAt>Date.now())return this.cacheHits++,{match:s,response:{status:200,body:l.data,latency:Date.now()-e,cacheHit:!0}};this.cacheMisses++}let n,i;switch(s.location.method){case"proxy":case"grpc":if(n=this.selectUpstreamTarget(s.location,t),!n)return{match:s,response:{status:503,error:"No healthy upstream server available",latency:Date.now()-e}};i=this.proxyRequest(t,s,n);break;case"static":i=this.serveStatic(t,s);break;case"fastcgi":case"uwsgi":case"scgi":if(n=this.selectUpstreamTarget(s.location,t),!n)return{match:s,response:{status:503,error:"No upstream server available",latency:Date.now()-e}};i=this.processFastCGI(t,s,n);break;default:i={status:501,error:"Method not implemented",latency:Date.now()-e}}if(this.enableGzip&&this.shouldCompress(i)&&(i.headers={...i.headers,"Content-Encoding":"gzip"}),this.enableCache&&s.location.cache?.enabled&&t.method==="GET"&&i.status===200){const o=this.getCacheKey(t,s),l=this.parseCacheValid(s.location.cache.valid||"1h");this.cache.set(o,{data:i.body,expiresAt:Date.now()+l})}return i.latency=Date.now()-e,i.upstreamTarget=n,{match:s,response:i,upstreamTarget:n}}matchLocation(t){for(const e of this.locations){const s=this.matchPath(e.path,t.path);if(s)return{location:e,matchedPath:s.matched,remainingPath:s.remaining,priority:this.getLocationPriority(e.path)}}return null}matchPath(t,e){const s=t.replace(/^[=~*^]/,""),n=t[0];switch(n){case"=":if(e===s)return{matched:e,remaining:""};break;case"~":case"~*":try{if(new RegExp(s,n==="~*"?"i":"").test(e))return{matched:e,remaining:""}}catch{}break;case"^~":case"*":default:if(e.startsWith(s))return{matched:s,remaining:e.substring(s.length)}}return null}getLocationPriority(t){return t.startsWith("=")?4:t.startsWith("^~")?3:t.startsWith("~")||t.startsWith("~*")?2:1}selectUpstreamTarget(t,e){const s=t.upstream||this.extractUpstreamFromProxyPass(t.proxyPass);if(!s)return t.proxyPass||null;const n=this.upstreams.get(s);if(!n||!n.servers||n.servers.length===0)return null;const i=n.servers.filter(l=>!l.down&&l.health!=="unhealthy");if(i.length===0)return null;switch(n.method||"round-robin"){case"round-robin":return this.selectRoundRobin(s,i);case"least_conn":return this.selectLeastConnections(i);case"ip_hash":return this.selectIPHash(s,i,e);case"hash":return this.selectHash(s,i,e);default:return i[0].address}}selectRoundRobin(t,e){const s=e.reduce((o,l)=>o+(l.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),o.address;return this.roundRobinCounters.set(t,(n+1)%s),e[0].address}selectLeastConnections(t){let e=1/0,s=t[0].address;for(const i of t){const l=(this.connectionCounts.get(i.address)||0)/(i.weight||1);l<e&&(e=l,s=i.address)}const n=this.connectionCounts.get(s)||0;return this.connectionCounts.set(s,n+1),s}selectIPHash(t,e,s){const n=s.clientIP||s.headers?.["X-Real-IP"]||s.headers?.["X-Forwarded-For"]||"0.0.0.0",i=this.ipHashMap.get(n);if(i&&e.some(h=>h.address===i))return i;const l=this.simpleHash(n)%e.length,d=e[l].address;return this.ipHashMap.set(n,d),d}selectHash(t,e,s){const n=this.hashRing.get(t);if(!n||n.length===0)return e[0].address;const i=s.path,l=this.simpleHash(i)%n.length;return n[l]}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}extractUpstreamFromProxyPass(t){if(!t)return null;const e=t.match(/^https?:\/\/([^\/:]+)/);return e&&this.upstreams.has(e[1])?e[1]:null}checkRateLimit(t,e){const s=this.rateLimitZones.get(t.zone);if(!s)return{blocked:!1};const n=s.rate.match(/^(\d+)r\/([smhd])$/);if(!n)return{blocked:!1};const i=parseInt(n[1],10),o=n[2],l=this.getPeriodMs(o),d=e.clientIP||e.headers?.["X-Real-IP"]||"default";let h=this.rateLimitCounters.get(t.zone);h||(h=new Map,this.rateLimitCounters.set(t.zone,h));let f=h.get(d);const m=Date.now();(!f||f.resetAt<m)&&(f={count:0,resetAt:m+l,burst:t.burst||0},h.set(d,f));const y=t.burst||0,b=i+y;return f.count>=b?{blocked:!0,error:`Rate limit exceeded: ${i} requests per ${o}`}:(f.count++,{blocked:!1})}getPeriodMs(t){switch(t){case"s":return 1e3;case"m":return 6e4;case"h":return 36e5;case"d":return 864e5;default:return 1e3}}proxyRequest(t,e,s){const n=10+Math.random()*90;return{status:200,body:{proxied:!0,upstream:s},latency:n}}serveStatic(t,e){const s=1+Math.random()*4;return{status:200,body:{static:!0,path:e.matchedPath},latency:s}}processFastCGI(t,e,s){const n=20+Math.random()*180;return{status:200,body:{processed:!0,upstream:s},latency:n}}getCacheKey(t,e){return e.location.cache?.key?e.location.cache.key.replace(/\$(\w+)/g,(s,n)=>{switch(n){case"uri":return t.path;case"args":return JSON.stringify(t.query);default:return""}}):`${t.method}:${t.path}:${JSON.stringify(t.query)}`}parseCacheValid(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 36e5;const s=parseInt(e[1],10),n=e[2];return s*this.getPeriodMs(n)}shouldCompress(t){if(!t.body)return!1;const e=t.headers?.["Content-Type"]||"";return["text/","application/json","application/javascript","application/xml"].some(n=>e.includes(n))}getStats(){const t=this.cacheHits+this.cacheMisses,e=t>0?this.cacheHits/t:0;return{locations:this.locations.length,upstreams:this.upstreams.size,rateLimitZones:this.rateLimitZones.size,sslCertificates:this.sslCertificates.size,requests:this.requestCount,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses,rateLimitBlocks:this.rateLimitBlocks,cacheHitRate:e}}updateServerHealth(t,e,s){const n=this.upstreams.get(t);if(!n)return;const i=n.servers.find(o=>o.address===e);i&&(i.health=s)}clearCache(){this.cache.clear(),this.cacheHits=0,this.cacheMisses=0}}class _E{frontends=new Map;backends=new Map;globalConfig={};roundRobinCounters=new Map;connectionCounts=new Map;sourceHashMap=new Map;uriHashMap=new Map;stickTable=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;rateLimitBlocks=0;timeoutErrors=0;connectionRejects=0;healthCheckTimers=new Map;serverCheckFailures=new Map;serverCheckSuccesses=new Map;rateLimitTracker=new Map;initialize(t){this.frontends.clear(),this.backends.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.sourceHashMap.clear(),this.uriHashMap.clear(),this.stickTable.clear(),this.serverCheckFailures.clear(),this.serverCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.frontends)for(const e of t.frontends)this.frontends.set(e.name,{...e,acls:e.acls||[]});if(t.backends){for(const e of t.backends)if(this.backends.set(e.name,{...e,acls:e.acls||[]}),this.roundRobinCounters.set(e.name,0),e.healthCheck?.enabled&&e.servers)for(const s of e.servers)s.check&&this.startHealthCheck(e.name,s,e.healthCheck)}this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.rateLimitBlocks=0,this.timeoutErrors=0,this.connectionRejects=0}routeRequest(t,e){const s=Date.now();this.requestCount++;const n=this.globalConfig.maxConnections||4096;if(this.activeConnections>=n)return this.connectionRejects++,this.errorCount++,{frontend:null,backend:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-s}};if(this.activeConnections++,this.globalConfig.rateLimit?.enabled&&!this.checkRateLimit(t).allowed)return this.activeConnections--,this.rateLimitBlocks++,this.errorCount++,{frontend:null,backend:null,response:{status:429,error:"Rate limit exceeded",latency:Date.now()-s}};let i=null;if(e)i=this.frontends.get(e)||null;else{for(const[T,E]of this.frontends.entries()){const A=this.extractPort(E.bind);if(t.protocol==="https"&&A===443){i=E;break}else if(t.protocol==="http"&&A===80){i=E;break}}!i&&this.frontends.size>0&&(i=Array.from(this.frontends.values())[0])}if(!i)return this.activeConnections--,{frontend:null,backend:null,response:{status:503,error:"No frontend available",latency:Date.now()-s}};if(i.acls&&i.acls.length>0){const T=this.evaluateACLs(i.acls,t);if(!T.matched)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:403,error:T.error||"ACL rule denied",latency:Date.now()-s}}}const o=i.defaultBackend||(i.backends&&i.backends.length>0?i.backends[0]:null);if(!o)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:503,error:"No backend configured",latency:Date.now()-s}};const l=this.backends.get(o);if(!l)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:503,error:`Backend ${o} not found`,latency:Date.now()-s}};if(l.acls&&l.acls.length>0){const T=this.evaluateACLs(l.acls,t);if(!T.matched)return this.activeConnections--,this.errorCount++,{frontend:i,backend:l,response:{status:403,error:T.error||"Backend ACL rule denied",latency:Date.now()-s}}}const d=this.selectServer(l,t);if(!d)return this.activeConnections--,this.errorCount++,{frontend:i,backend:l,response:{status:503,error:"No healthy server available",latency:Date.now()-s}};const h=l.servers.find(T=>`${T.address}:${T.port}`===d);if(h){h.sessions=(h.sessions||0)+1;const T=this.connectionCounts.get(d)||0;this.connectionCounts.set(d,T+1)}const f=10+Math.random()*90,m=i.ssl?5+Math.random()*15:0,y=this.globalConfig.timeoutServer||5e4,b=this.globalConfig.timeoutConnect||5e3,C=this.globalConfig.timeoutHttpRequest||1e4,S=Math.min(50+Math.random()*100,b);if(S>=b*.9)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,h&&(h.errors=(h.errors||0)+1),{frontend:i,backend:l,response:{status:504,error:"Connection timeout",latency:b,backendTarget:o,serverTarget:d}};const R=S+f+m;if(R>y)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,h&&(h.errors=(h.errors||0)+1),{frontend:i,backend:l,response:{status:504,error:"Server timeout",latency:y,backendTarget:o,serverTarget:d}};if(R>C)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,h&&(h.errors=(h.errors||0)+1),{frontend:i,backend:l,response:{status:408,error:"Request timeout",latency:C,backendTarget:o,serverTarget:d}};const M={status:200,body:{proxied:!0,backend:o,server:d},latency:R,backendTarget:o,serverTarget:d};return h&&(h.bytesIn=(h.bytesIn||0)+1024,h.bytesOut=(h.bytesOut||0)+2048,h.responseTime=R,this.totalBytesIn+=1024,this.totalBytesOut+=2048),this.responseCount++,this.activeConnections--,{frontend:i,backend:l,response:M,backendTarget:o,serverTarget:d}}selectServer(t,e){const s=t.servers.filter(o=>o.status==="up"&&o.check!==!1);if(s.length===0)return null;if(t.stickTable?.enabled){const o=this.getStickTableKey(e,t.stickTable.type),l=this.stickTable.get(o);if(l&&l.expiresAt>Date.now()&&s.find(h=>`${h.address}:${h.port}`===l.server))return l.server}const n=t.balance||"roundrobin";let i;switch(n){case"roundrobin":i=this.selectRoundRobin(t.name,s);break;case"leastconn":i=this.selectLeastConnections(s);break;case"source":i=this.selectSourceIP(t.name,s,e);break;case"uri":i=this.selectURIHash(t.name,s,e);break;case"hdr":i=this.selectHeaderHash(t.name,s,e);break;default:i=`${s[0].address}:${s[0].port}`}if(t.stickTable?.enabled&&i){const o=this.getStickTableKey(e,t.stickTable.type),l=(t.stickTable.expire||3600)*1e3;this.stickTable.set(o,{server:i,expiresAt:Date.now()+l})}return i}selectRoundRobin(t,e){const s=e.reduce((o,l)=>o+(l.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),`${o.address}:${o.port}`;return this.roundRobinCounters.set(t,(n+1)%s),`${e[0].address}:${e[0].port}`}selectLeastConnections(t){let e=1/0,s=t[0];for(const n of t){const i=`${n.address}:${n.port}`,l=(this.connectionCounts.get(i)||n.sessions||0)/(n.weight||1);l<e&&(e=l,s=n)}return`${s.address}:${s.port}`}selectSourceIP(t,e,s){const n=s.clientIP||s.headers?.["X-Real-IP"]||s.headers?.["X-Forwarded-For"]||"0.0.0.0",i=this.sourceHashMap.get(`${t}:${n}`);if(i&&e.some(h=>`${h.address}:${h.port}`===i))return i;const l=this.simpleHash(n)%e.length,d=`${e[l].address}:${e[l].port}`;return this.sourceHashMap.set(`${t}:${n}`,d),d}selectURIHash(t,e,s){const n=s.path,i=`${t}:${n}`,o=this.uriHashMap.get(i);if(o&&e.some(f=>`${f.address}:${f.port}`===o))return o;const d=this.simpleHash(n)%e.length,h=`${e[d].address}:${e[d].port}`;return this.uriHashMap.set(i,h),h}selectHeaderHash(t,e,s){const n=s.host||s.headers?.Host||s.path,o=this.simpleHash(n)%e.length;return`${e[o].address}:${e[o].port}`}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}getStickTableKey(t,e){switch(e){case"ip":return t.clientIP||t.headers?.["X-Real-IP"]||"0.0.0.0";case"string":return t.host||t.headers?.Host||"";case"integer":return t.headers?.["X-Forwarded-Port"]||"0";default:return t.clientIP||"0.0.0.0"}}evaluateACLs(t,e){for(const s of t)if(!this.evaluateACL(s,e).matched)return{matched:!1,error:`ACL ${s.name} failed`};return{matched:!0}}evaluateACL(t,e){const s=t.operator||"eq",n=t.value||"";if(t.criterion.startsWith("hdr(")){const i=t.criterion.match(/hdr\(([^)]+)\)/)?.[1];if(i){const o=(e.headers?.[i.toLowerCase()]||"").toLowerCase(),l=n.toLowerCase();return{matched:this.compareValues(o,l,s)}}}else{if(t.criterion==="path_beg")return{matched:e.path.toLowerCase().startsWith(n.toLowerCase())};if(t.criterion==="path_end")return{matched:e.path.toLowerCase().endsWith(n.toLowerCase())};if(t.criterion==="path")return{matched:this.compareValues(e.path.toLowerCase(),n.toLowerCase(),s)};if(t.criterion==="src"){const i=e.clientIP||e.headers?.["X-Real-IP"]||e.headers?.["X-Forwarded-For"]||"0.0.0.0";if(n.includes("/")){const[o,l]=n.split("/");return{matched:this.isIPInCIDR(i,o,parseInt(l||"32",10))}}else return{matched:this.compareValues(i,n,s)}}else{if(t.criterion==="method")return{matched:this.compareValues(e.method.toUpperCase(),n.toUpperCase(),s)};if(t.criterion==="url_param"){const i=n.split("=")[0],o=n.split("=")[1]||"",l=e.query?.[i]||"";return o?{matched:this.compareValues(l,o,s)}:{matched:!!l}}}}return{matched:!0}}compareValues(t,e,s){switch(s){case"eq":return t===e;case"ne":return t!==e;case"beg":return t.startsWith(e);case"end":return t.endsWith(e);case"sub":return t.includes(e);case"gt":return parseFloat(t)>parseFloat(e);case"lt":return parseFloat(t)<parseFloat(e);case"gte":return parseFloat(t)>=parseFloat(e);case"lte":return parseFloat(t)<=parseFloat(e);default:return t===e}}isIPInCIDR(t,e,s){if(s===32)return t===e;const n=t.split("."),i=e.split(".");if(n.length!==4||i.length!==4)return!1;const o=Math.floor(s/8);for(let l=0;l<o;l++)if(n[l]!==i[l])return!1;return!0}checkRateLimit(t){if(!this.globalConfig.rateLimit?.enabled)return{allowed:!0};const e=this.globalConfig.rateLimit,s=e.rate||"10r/s",n=e.burst||5,i=s.match(/(\d+)r\/([smh])/);if(!i)return{allowed:!0};const o=parseInt(i[1],10),l=i[2];let d=1e3;switch(l){case"s":d=1e3;break;case"m":d=6e4;break;case"h":d=36e5;break}const h=t.clientIP||t.headers?.["X-Real-IP"]||t.headers?.["X-Forwarded-For"]||"0.0.0.0",f=Date.now(),m=h;let y=this.rateLimitTracker.get(m);return(!y||f>=y.resetAt)&&(y={count:0,resetAt:f+d}),y.count>=o+n?{allowed:!1}:(y.count++,this.rateLimitTracker.set(m,y),{allowed:!0})}startHealthCheck(t,e,s){const n=`${t}:${e.address}:${e.port}`,i=this.healthCheckTimers.get(n);i&&clearInterval(i);const o=s.interval||2e3,l=s.timeout||1e3,d=s.fall||3,h=s.rise||2,f=setInterval(()=>{e.lastCheck=Date.now(),e.checkStatus="checking";const m=Math.random()>.1;setTimeout(()=>{if(m){const y=(this.serverCheckSuccesses.get(n)||0)+1;this.serverCheckSuccesses.set(n,y),this.serverCheckFailures.set(n,0),e.status==="down"&&y>=h?(e.status="up",e.checkStatus="passed"):e.status==="up"&&(e.checkStatus="passed")}else{const y=(this.serverCheckFailures.get(n)||0)+1;this.serverCheckFailures.set(n,y),this.serverCheckSuccesses.set(n,0),e.status==="up"&&y>=d?(e.status="down",e.checkStatus="failed"):e.status==="down"&&(e.checkStatus="failed")}},l)},o);this.healthCheckTimers.set(n,f)}extractPort(t){const e=t.match(/:(\d+)$/);return e?parseInt(e[1],10):80}getStats(){let t=0,e=0,s=0;for(const i of this.backends.values()){t+=i.servers.length;for(const o of i.servers)o.status==="up"?e++:s++}const n=this.requestCount>0?this.errorCount/this.requestCount:0;return{frontends:this.frontends.size,backends:this.backends.size,totalServers:t,upServers:e,downServers:s,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:n,rateLimitBlocks:this.rateLimitBlocks,timeoutErrors:this.timeoutErrors,connectionRejects:this.connectionRejects}}getFrontendStats(t){const e=this.frontends.get(t);return e?{requests:e.requests||0,responses:e.responses||0,bytesIn:e.bytesIn||0,bytesOut:e.bytesOut||0}:null}getBackendStats(t){const e=this.backends.get(t);if(!e)return null;let s=0,n=0,i=0,o=0,l=0,d=0;for(const h of e.servers)h.status==="up"?s++:n++,i+=h.sessions||0,o+=h.bytesIn||0,l+=h.bytesOut||0,d+=h.errors||0;return{servers:e.servers.length,upServers:s,downServers:n,totalSessions:i,totalBytesIn:o,totalBytesOut:l,totalErrors:d}}updateServerStatus(t,e,s){const n=this.backends.get(t);if(!n)return;const i=n.servers.find(o=>o.id===e);i&&(i.status=s)}destroy(){for(const t of this.healthCheckTimers.values())clearInterval(t);this.healthCheckTimers.clear()}}class NE{clusters=new Map;listeners=new Map;routes=new Map;globalConfig={};roundRobinCounters=new Map;leastRequestCounts=new Map;connectionCounts=new Map;ringHashMapping=new Map;maglevTable=new Map;circuitBreakerState=new Map;outlierDetectionState=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;rateLimitBlocks=0;timeoutErrors=0;circuitBreakerTrips=0;healthCheckTimers=new Map;endpointCheckFailures=new Map;endpointCheckSuccesses=new Map;rateLimitTracker=new Map;initialize(t){this.clusters.clear(),this.listeners.clear(),this.routes.clear(),this.roundRobinCounters.clear(),this.leastRequestCounts.clear(),this.connectionCounts.clear(),this.ringHashMapping.clear(),this.maglevTable.clear(),this.circuitBreakerState.clear(),this.outlierDetectionState.clear(),this.endpointCheckFailures.clear(),this.endpointCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.clusters)for(const e of t.clusters){if(this.clusters.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),this.leastRequestCounts.set(e.name,new Map),this.circuitBreakerState.set(e.name,{isOpen:!1,consecutiveErrors:0}),this.outlierDetectionState.set(e.name,new Map),e.healthCheck?.enabled&&e.endpoints)for(const s of e.endpoints){const n=`${s.address}:${s.port}`;this.leastRequestCounts.get(e.name).set(n,0),this.startHealthCheck(e.name,s,e.healthCheck)}else for(const s of e.endpoints){const n=`${s.address}:${s.port}`;this.leastRequestCounts.get(e.name).set(n,0)}(e.loadBalancingPolicy==="RING_HASH"||e.loadBalancingPolicy==="MAGLEV")&&this.buildHashTable(e.name,e)}if(t.listeners)for(const e of t.listeners)this.listeners.set(e.name,{...e});if(t.routes){const e=[...t.routes].sort((s,n)=>(n.priority||0)-(s.priority||0));for(const s of e)this.routes.set(s.name,{...s})}this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.rateLimitBlocks=0,this.timeoutErrors=0,this.circuitBreakerTrips=0}routeRequest(t,e){const s=Date.now();this.requestCount++;const n=this.globalConfig.maxConnections||1024;if(this.activeConnections>=n)return this.errorCount++,{listener:null,route:null,cluster:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-s}};if(this.activeConnections++,this.globalConfig.rateLimit?.enabled&&!this.checkRateLimit(t).allowed)return this.activeConnections--,this.rateLimitBlocks++,this.errorCount++,{listener:null,route:null,cluster:null,response:{status:429,error:"Rate limit exceeded",latency:Date.now()-s}};let i=null;if(e)i=this.listeners.get(e)||null;else{for(const[_,N]of this.listeners.entries()){const z=N.protocol||"HTTP";if(t.protocol==="https"&&(z==="HTTPS"||N.port===443)){i=N;break}else if(t.protocol==="http"&&(z==="HTTP"||N.port===80)){i=N;break}}!i&&this.listeners.size>0&&(i=Array.from(this.listeners.values())[0])}if(!i)return this.activeConnections--,this.errorCount++,{listener:null,route:null,cluster:null,response:{status:503,error:"No listener available",latency:Date.now()-s}};i.requests=(i.requests||0)+1,i.activeConnections=(i.activeConnections||0)+1;for(const _ of i.filters){const N=this.processFilter(_,t);if(!N.allowed)return this.activeConnections--,this.errorCount++,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:null,cluster:null,response:{status:N.status||403,error:N.error||"Filter denied",latency:Date.now()-s}};N.modifiedRequest&&(t=N.modifiedRequest)}let o=null;for(const _ of this.routes.values())if(this.matchRoute(_,t)){o=_;break}if(!o)return this.activeConnections--,this.errorCount++,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:null,cluster:null,response:{status:404,error:"No route matched",latency:Date.now()-s}};o.requests=(o.requests||0)+1;const l=this.clusters.get(o.cluster);if(!l)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:null,response:{status:503,error:`Cluster ${o.cluster} not found`,latency:Date.now()-s}};const d=this.circuitBreakerState.get(l.name);if(d&&l.circuitBreaker?.enabled&&d.isOpen){if(d.openUntil&&Date.now()<d.openUntil)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,l.errors=(l.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:l,response:{status:503,error:"Circuit breaker is open",latency:Date.now()-s,clusterTarget:l.name}};d.isOpen=!1,d.consecutiveErrors=0}const h=this.selectEndpoint(l,t);if(!h)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,l.errors=(l.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:l,response:{status:503,error:"No healthy endpoint available",latency:Date.now()-s,clusterTarget:l.name}};l.requests=(l.requests||0)+1,l.activeConnections=(l.activeConnections||0)+1;const f=l.endpoints.find(_=>`${_.address}:${_.port}`===h);f&&(f.requests=(f.requests||0)+1);const m=l.connectTimeout||this.globalConfig.connectTimeout||5e3,y=o.timeout||this.globalConfig.requestTimeout||15e3,b=Math.min(50+Math.random()*100,m);if(b>=m*.9)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,o.errors=(o.errors||0)+1,l.errors=(l.errors||0)+1,l.activeConnections=(l.activeConnections||1)-1,i.activeConnections=(i.activeConnections||1)-1,f&&(f.errors=(f.errors||0)+1,this.updateOutlierDetection(l.name,h,!0)),{listener:i,route:o,cluster:l,response:{status:504,error:"Connection timeout",latency:m,clusterTarget:l.name,endpointTarget:h}};const C=10+Math.random()*90,S=b+C;if(S>y)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,o.errors=(o.errors||0)+1,l.errors=(l.errors||0)+1,l.activeConnections=(l.activeConnections||1)-1,i.activeConnections=(i.activeConnections||1)-1,f&&(f.errors=(f.errors||0)+1,this.updateOutlierDetection(l.name,h,!0)),{listener:i,route:o,cluster:l,response:{status:504,error:"Request timeout",latency:y,clusterTarget:l.name,endpointTarget:h}};const R=Math.random()>.1,M=R?200:500+Math.floor(Math.random()*3);R?(this.updateCircuitBreaker(l.name,!1),this.responseCount++,o.responses=(o.responses||0)+1):(this.errorCount++,o.errors=(o.errors||0)+1,l.errors=(l.errors||0)+1,f&&(f.errors=(f.errors||0)+1,this.updateOutlierDetection(l.name,h,!0)),this.updateCircuitBreaker(l.name,!0));const T=1024,E=2048;this.totalBytesIn+=T,this.totalBytesOut+=E,f&&(f.responseTime=S),this.activeConnections--,i.activeConnections=(i.activeConnections||1)-1,l.activeConnections=(l.activeConnections||1)-1;const A={status:M,body:{proxied:!0,cluster:l.name,endpoint:h},latency:S,clusterTarget:l.name,endpointTarget:h};return{listener:i,route:o,cluster:l,response:A,clusterTarget:l.name,endpointTarget:h}}matchRoute(t,e){const s=t.match;if(s.prefix&&!e.path.startsWith(s.prefix)||s.path&&e.path!==s.path||s.regex&&!new RegExp(s.regex).test(e.path))return!1;if(s.headers)for(const n of s.headers){const i=e.headers?.[jE(n.name)]||"";if(n.exact&&i!==n.exact||n.prefix&&!i.startsWith(n.prefix)||n.suffix&&!i.endsWith(n.suffix)||n.regex&&!new RegExp(n.regex).test(i))return!1}if(s.queryParameters)for(const n of s.queryParameters){const i=e.query?.[n.name]||"";if(n.exact&&i!==n.exact||n.regex&&!new RegExp(n.regex).test(i))return!1}return!0}processFilter(t,e){switch(t.type){case"http_connection_manager":return{allowed:!0};case"tls_inspector":return e.protocol==="https"?{allowed:!0}:{allowed:!0};case"router":return{allowed:!0};case"cors":return{allowed:!0,modifiedRequest:e};case"ratelimit":return{allowed:!0};case"fault":const s=t.config?.faultRate||0;return Math.random()<s?{allowed:!1,status:t.config?.faultStatusCode||503,error:"Fault injected"}:{allowed:!0};case"ext_authz":return{allowed:!0};default:return{allowed:!0}}}selectEndpoint(t,e){const s=t.endpoints.filter(o=>{const l=`${o.address}:${o.port}`,d=this.outlierDetectionState.get(t.name)?.get(l);return d?.ejectedUntil&&Date.now()<d.ejectedUntil?!1:o.healthStatus!=="unhealthy"&&o.healthStatus!=="timeout"});if(s.length===0)return null;const n=t.loadBalancingPolicy||"ROUND_ROBIN";let i;switch(n){case"ROUND_ROBIN":i=this.selectRoundRobin(t.name,s);break;case"LEAST_REQUEST":i=this.selectLeastRequest(t.name,s);break;case"RING_HASH":case"MAGLEV":i=this.selectHashBased(t.name,s,e);break;case"RANDOM":i=s[Math.floor(Math.random()*s.length)];break;default:i=s[0]}return`${i.address}:${i.port}`}selectRoundRobin(t,e){const s=e.reduce((o,l)=>o+(l.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),o;return this.roundRobinCounters.set(t,(n+1)%s),e[0]}selectLeastRequest(t,e){const s=this.leastRequestCounts.get(t)||new Map;let n=1/0,i=e[0];for(const d of e){const h=`${d.address}:${d.port}`,m=(s.get(h)||0)/(d.weight||1);m<n&&(n=m,i=d)}const o=`${i.address}:${i.port}`,l=s.get(o)||0;return s.set(o,l+1),i}selectHashBased(t,e,s){const n=s.host||s.path||s.clientIP||"default",o=this.simpleHash(n)%e.length;return e[o]}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}buildHashTable(t,e){const s=e.endpoints.map(n=>`${n.address}:${n.port}`);this.ringHashMapping.set(t,s)}checkRateLimit(t){if(!this.globalConfig.rateLimit?.enabled)return{allowed:!0};const e=this.globalConfig.rateLimit.rate||100,s=this.globalConfig.rateLimit.burst||10,n=t.clientIP||t.headers?.["X-Real-IP"]||t.headers?.["X-Forwarded-For"]||"0.0.0.0",i=Date.now(),o=n;let l=this.rateLimitTracker.get(o);return(!l||i>=l.resetAt)&&(l={count:0,resetAt:i+1e3}),l.count>=e+s?{allowed:!1}:(l.count++,this.rateLimitTracker.set(o,l),{allowed:!0})}updateCircuitBreaker(t,e){const s=this.clusters.get(t);if(!s||!s.circuitBreaker?.enabled)return;const n=this.circuitBreakerState.get(t);if(n)if(e){n.consecutiveErrors++;const i=s.circuitBreaker.consecutiveErrors||5;n.consecutiveErrors>=i&&!n.isOpen&&(n.isOpen=!0,n.openUntil=Date.now()+3e4,this.circuitBreakerTrips++)}else n.consecutiveErrors=0,n.isOpen&&(n.isOpen=!1,n.openUntil=void 0)}updateOutlierDetection(t,e,s){const n=this.clusters.get(t);if(!n||!n.outlierDetection?.enabled)return;let i=this.outlierDetectionState.get(t);i||(i=new Map,this.outlierDetectionState.set(t,i));let o=i.get(e);if(o||(o={consecutiveErrors:0},i.set(e,o)),s){o.consecutiveErrors++;const l=n.outlierDetection.consecutiveErrors||5,d=n.outlierDetection.baseEjectionTime||3e4;if(o.consecutiveErrors>=l){o.ejectedUntil=Date.now()+d;const h=n.endpoints.find(f=>`${f.address}:${f.port}`===e);h&&(h.healthStatus="unhealthy")}}else if(o.consecutiveErrors=0,o.ejectedUntil&&Date.now()>=o.ejectedUntil){o.ejectedUntil=void 0;const l=n.endpoints.find(d=>`${d.address}:${d.port}`===e);l&&(l.healthStatus="healthy")}}startHealthCheck(t,e,s){const n=`${t}:${e.address}:${e.port}`,i=this.healthCheckTimers.get(n);i&&clearInterval(i);const o=s.interval||1e4,l=s.timeout||5e3,d=s.healthyThreshold||1,h=s.unhealthyThreshold||2,f=setInterval(()=>{e.lastCheck=Date.now();const m=Math.random()>.1;setTimeout(()=>{if(m){const y=(this.endpointCheckSuccesses.get(n)||0)+1;this.endpointCheckSuccesses.set(n,y),this.endpointCheckFailures.set(n,0),(e.healthStatus==="unhealthy"&&y>=d||!e.healthStatus||e.healthStatus==="unknown")&&(e.healthStatus="healthy")}else{const y=(this.endpointCheckFailures.get(n)||0)+1;this.endpointCheckFailures.set(n,y),this.endpointCheckSuccesses.set(n,0),(e.healthStatus==="healthy"&&y>=h||!e.healthStatus||e.healthStatus==="unknown")&&(e.healthStatus="unhealthy")}},l)},o);this.healthCheckTimers.set(n,f)}getStats(){let t=0,e=0,s=0;for(const i of this.clusters.values()){t+=i.endpoints.length;for(const o of i.endpoints)o.healthStatus==="healthy"?e++:o.healthStatus==="unhealthy"&&s++}const n=this.requestCount>0?this.errorCount/this.requestCount:0;return{clusters:this.clusters.size,listeners:this.listeners.size,routes:this.routes.size,totalEndpoints:t,healthyEndpoints:e,unhealthyEndpoints:s,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:n,rateLimitBlocks:this.rateLimitBlocks,timeoutErrors:this.timeoutErrors,circuitBreakerTrips:this.circuitBreakerTrips}}getClusterStats(t){const e=this.clusters.get(t);if(!e)return null;let s=0,n=0;for(const i of e.endpoints)i.healthStatus==="healthy"?s++:i.healthStatus==="unhealthy"&&n++;return{requests:e.requests||0,errors:e.errors||0,activeConnections:e.activeConnections||0,healthyEndpoints:s,unhealthyEndpoints:n}}getListenerStats(t){const e=this.listeners.get(t);return e?{activeConnections:e.activeConnections||0,requests:e.requests||0,responses:e.responses||0}:null}getRouteStats(t){const e=this.routes.get(t);return e?{requests:e.requests||0,responses:e.responses||0,errors:e.errors||0}:null}destroy(){for(const t of this.healthCheckTimers.values())clearInterval(t);this.healthCheckTimers.clear()}}function jE(r){return r.toLowerCase()}class PE{parseQuery(t){const e=t.query.trim(),s=this.extractOperationType(e),n=t.operationName||this.extractOperationName(e),i=this.extractFields(e),o=this.calculateDepth(e),l=this.estimateComplexity(e,n);return{operationName:n,operationType:s,fields:i,depth:o,complexity:l,rawQuery:e}}extractOperationType(t){const e=t.trim();return e.startsWith("mutation")?"mutation":e.startsWith("subscription")?"subscription":"query"}extractOperationName(t){const e=t.match(/(?:query|mutation|subscription)\s+([a-zA-Z0-9_]+)/);return e?e[1]:void 0}extractFields(t){const e=[],s=/([a-zA-Z0-9_]+)\s*(?:\(|\{)/g;let n;for(;(n=s.exec(t))!==null;)e.push(n[1]);return e.length>0?e:["unknown"]}calculateDepth(t){let e=0,s=0;for(const n of t)n==="{"?(e+=1,s=Math.max(s,e)):n==="}"&&(e=Math.max(0,e-1));return s}estimateComplexity(t,e){const s=t.match(/[a-zA-Z0-9_]+(\s*[({])/g),n=s?s.length:5,i=this.calculateDepth(t),o=e?Math.max(1,e.length%5):1;return Math.round(n*(1+i*.5)*o*10)}}class LE{federationConfig;constructor(t){this.federationConfig=t}planQuery(t,e){if(e.length===0)return{subqueries:[],requiresFederation:!1,estimatedLatency:0};const s=this.federationConfig?.enabled??!1,i=this.selectServices(t,e).map(d=>({serviceId:d.id,serviceName:d.name,endpoint:d.endpoint,query:t.rawQuery,fields:t.fields,estimatedLatency:this.estimateServiceLatency(d,t)})),o=i.reduce((d,h)=>d+h.estimatedLatency,0),l=s?3+Math.random()*5:0;return{subqueries:i,requiresFederation:s,estimatedLatency:o+l}}selectServices(t,e){if(this.federationConfig?.enabled&&this.federationConfig.services?.length){const i=e.filter(o=>this.federationConfig.services.includes(o.name));return i.length>0?i:e.slice(0,Math.min(2,e.length))}const s=this.hashString(t.operationName||t.rawQuery),n=Math.abs(s)%e.length;return[e[n]]}estimateServiceLatency(t,e){const s=t.avgLatencyMs,n=Math.sqrt(e.complexity)*.8,i=e.depth*1.5,o=Math.random()*5;return s+n+i+o}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e|=0}return e}updateFederationConfig(t){this.federationConfig=t}}class zE{serviceRegistry;constructor(t){this.serviceRegistry=t}executePlan(t){if(t.subqueries.length===0)return{success:!1,totalLatency:0,error:"No services available",executedEndpoints:[]};let e=0;const s=[];for(const n of t.subqueries){const i=this.serviceRegistry.getService(n.serviceId);if(!i)return{success:!1,totalLatency:e,error:`Service ${n.serviceId} not found`,failedService:n.serviceId,executedEndpoints:s};const o=n.endpoint||i.endpoint;s.push(o);const d=this.getEndpointLatency(o,i.avgLatencyMs)+(n.estimatedLatency-i.avgLatencyMs);if(e+=d,Math.random()<i.errorRate)return this.serviceRegistry.recordRequest(i.id,d,!1),{success:!1,totalLatency:e,error:`Upstream error at ${i.name} (${o})`,failedService:i.id,executedEndpoints:s};this.serviceRegistry.recordRequest(i.id,d,!0)}return{success:!0,totalLatency:e,executedEndpoints:s}}getEndpointLatency(t,e){return t.includes("localhost")||t.includes("127.0.0.1")?e*.8:t.includes("https://")?e*1.1:e}}class IE{services=new Map;registerService(t){const e=this.services.get(t.id);this.services.set(t.id,{id:t.id,name:t.name,endpoint:t.endpoint,avgLatencyMs:t.avgLatencyMs??20,errorRate:t.errorRate??.01,status:t.status??"connected",rollingLatency:e?.rollingLatency||[],rollingErrors:e?.rollingErrors||[]})}unregisterService(t){this.services.delete(t)}getConnectedServices(){return Array.from(this.services.values()).filter(t=>t.status==="connected")}getService(t){return this.services.get(t)}getServiceByName(t){return Array.from(this.services.values()).find(e=>e.name===t)}recordRequest(t,e,s){const n=this.services.get(t);if(!n)return;n.rollingLatency.push(e),n.rollingLatency.length>50&&n.rollingLatency.shift(),s||(n.rollingErrors.push(e),n.rollingErrors.length>50&&n.rollingErrors.shift());const i=n.rollingLatency.reduce((l,d)=>l+d,0)/n.rollingLatency.length;n.avgLatencyMs=i;const o=n.rollingErrors.length/Math.max(n.rollingLatency.length,1);n.errorRate=o}initialize(t){this.services.clear();for(const e of t)this.registerService(e)}getAllServices(){return Array.from(this.services.values())}}class OE{cache=new Map;ttl;persistQueries;constructor(t=0,e=!1){this.ttl=t,this.persistQueries=e}generateCacheKey(t,e){const s=e?JSON.stringify(e):"";return this.hashString(t+s)}getCached(t,e){if(this.ttl<=0||!this.persistQueries)return{hit:!1,latencyReduction:0};const s=this.generateCacheKey(t,e),n=this.cache.get(s);return n?Date.now()-n.timestamp>n.ttl*1e3?(this.cache.delete(s),{hit:!1,latencyReduction:0}):{hit:!0,latencyReduction:.7}:{hit:!1,latencyReduction:0}}setCached(t,e,s){if(this.ttl<=0||!this.persistQueries)return;const n=this.generateCacheKey(t,s);if(this.cache.set(n,{query:t,response:e,timestamp:Date.now(),ttl:this.ttl}),this.cache.size>1e3){const i=this.cache.keys().next().value;this.cache.delete(i)}}getCacheHitProbability(t){if(this.ttl<=0||!this.persistQueries)return 0;const e=.2,s=Math.min(t.complexity/2e3,.4);return Math.min(e+s,.6)}updateConfig(t,e){t!==void 0&&(this.ttl=t),e!==void 0&&(this.persistQueries=e)}clearCache(){this.cache.clear()}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e|=0}return Math.abs(e).toString(16)}}class HE{enabled;limits=new Map;defaultLimit=100;windowMs=6e4;constructor(t=!1,e=100){this.enabled=t,this.defaultLimit=e}checkLimit(t,e){if(!this.enabled)return{allowed:!0,remaining:1/0,resetAt:Date.now()+this.windowMs};const s=e||this.defaultLimit,n=Date.now(),i=this.limits.get(t);if(!i||n>=i.resetAt){const o={count:1,resetAt:n+this.windowMs,windowStart:n};return this.limits.set(t,o),{allowed:!0,remaining:s-1,resetAt:o.resetAt}}return i.count>=s?{allowed:!1,remaining:0,resetAt:i.resetAt}:(i.count+=1,{allowed:!0,remaining:s-i.count,resetAt:i.resetAt})}getIdentifier(t){if(!t)return"default";const e=t["x-api-key"]||t.apikey;if(e)return`key:${e}`;const s=t["x-client-id"];return s?`client:${s}`:"default"}setEnabled(t){this.enabled=t}updateDefaultLimit(t){this.defaultLimit=t}clearLimits(){this.limits.clear()}}class qE{maxQueryDepth;maxQueryComplexity;enabled;constructor(t=15,e=1e3,s=!0){this.maxQueryDepth=t,this.maxQueryComplexity=e,this.enabled=s}validateQuery(t){return this.enabled?t.depth>this.maxQueryDepth?{valid:!1,error:`Query depth ${t.depth} exceeds limit ${this.maxQueryDepth}`}:t.complexity>this.maxQueryComplexity?{valid:!1,error:`Query complexity ${t.complexity} exceeds limit ${this.maxQueryComplexity}`}:{valid:!0}:{valid:!0}}updateLimits(t,e){t!==void 0&&(this.maxQueryDepth=t),e!==void 0&&(this.maxQueryComplexity=e)}setEnabled(t){this.enabled=t}}class $E{config;constructor(t){this.config=t}isEnabled(){return this.config?.enabled??!1}getVersion(){return this.config?.version}getFederatedServices(){return this.config?.services||[]}getPlanningOverhead(){return this.isEnabled()?(this.config?.version==="2"?2:4)+Math.random()*3:0}isFederatedService(t){return this.isEnabled()?this.config?.services?.includes(t.name)??!1:!1}getSupergraphSchema(){return this.config?.supergraph}updateConfig(t){this.config=t}}class BE{queryParser;queryPlanner;queryExecutor;serviceRegistry;cacheManager;rateLimiter;complexityAnalyzer;federationComposer;constructor(){this.serviceRegistry=new IE,this.queryParser=new PE,this.queryPlanner=new LE,this.queryExecutor=new zE(this.serviceRegistry),this.cacheManager=new OE,this.rateLimiter=new HE,this.complexityAnalyzer=new qE,this.federationComposer=new $E}initialize(t){t.services&&this.serviceRegistry.initialize(t.services),this.federationComposer.updateConfig(t.federation),this.queryPlanner.updateFederationConfig(t.federation),this.cacheManager.updateConfig(t.cacheTtl??0,t.persistQueries??!1),this.rateLimiter.setEnabled(t.enableRateLimiting??!1),this.complexityAnalyzer.updateLimits(t.maxQueryDepth??15,t.maxQueryComplexity??1e3),this.complexityAnalyzer.setEnabled(t.enableQueryComplexityAnalysis??!0)}routeRequest(t){const e=Date.now();if(!t.query||t.query.trim().length===0)return{status:400,latency:Date.now()-e,error:"Empty query"};const s=this.rateLimiter.getIdentifier(t.headers);if(!this.rateLimiter.checkLimit(s).allowed)return{status:429,latency:Date.now()-e,error:"Rate limit exceeded"};const i=this.queryParser.parseQuery(t),o=this.cacheManager.getCached(t.query,t.variables);if(o.hit)return{status:200,latency:(Date.now()-e)*(1-o.latencyReduction)};const l=this.complexityAnalyzer.validateQuery(i);if(!l.valid)return{status:413,latency:Date.now()-e,error:l.error};const d=this.serviceRegistry.getConnectedServices();if(d.length===0)return{status:503,latency:Date.now()-e,error:"No connected services"};const h=this.queryPlanner.planQuery(i,d),f=this.queryExecutor.executePlan(h);return f.success?(this.cacheManager.setCached(t.query,{success:!0},t.variables),{status:200,latency:f.totalLatency+(Date.now()-e)}):{status:502,latency:f.totalLatency+(Date.now()-e),error:f.error}}getServiceRegistry(){return this.serviceRegistry}getCacheManager(){return this.cacheManager}getRateLimiter(){return this.rateLimiter}}class UE{backends=new Map;endpoints=new Map;config={};circuitBreakers=new Map;cache=new Map;cacheMode="memory";defaultCacheTtl=5;redisEngine=null;redisNodeId="";backendMetrics=new Map;batchQueue=new Map;batchTimer=null;batchSize=10;batchTimeout=50;initialize(t){if(this.config=t,this.backends.clear(),this.endpoints.clear(),this.circuitBreakers.clear(),this.cache.clear(),this.backendMetrics.clear(),this.cacheMode=t.cacheMode||"memory",this.defaultCacheTtl=t.cacheTtl||5,this.redisEngine=t.redisEngine||null,this.redisNodeId=t.redisNodeId||"",t.backends)for(const e of t.backends)this.backends.set(e.id,{...e}),this.initializeCircuitBreaker(e.id,e.circuitBreaker),this.initializeBackendMetrics(e.id);if(t.endpoints)for(const e of t.endpoints)this.endpoints.set(e.id,{...e})}initializeCircuitBreaker(t,e){e?.enabled&&this.circuitBreakers.set(t,{failures:0,successes:0,state:"closed",lastFailureTime:0,nextAttemptTime:0})}initializeBackendMetrics(t){this.backendMetrics.set(t,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,cacheHits:0,cacheMisses:0})}routeRequest(t){const e=Date.now(),s=this.matchEndpoint(t);if(!s)return{status:404,error:"Endpoint not found",latency:Date.now()-e,backendResponses:[],cacheHit:!1};if(this.config.enableCaching&&this.cacheMode!=="off"){const o=this.getCacheKey(s,t),l=this.getCached(o);if(l){const d=this.backendMetrics.get(s.backends[0])||this.initializeBackendMetrics(s.backends[0]);return d&&d.cacheHits++,{status:200,data:l.data,latency:Date.now()-e,backendResponses:[],cacheHit:!0}}}const n=this.aggregateBackends(s,t),i=this.aggregateResponses(s,n);if(this.config.enableCaching&&this.cacheMode!=="off"&&i.status===200){const o=this.getCacheKey(s,t),l=s.cacheTtl||this.defaultCacheTtl;this.setCached(o,i.data,l)}for(const o of n){const l=this.backendMetrics.get(o.backendId);l&&(l.requestCount++,o.status>=400&&l.errorCount++,l.totalLatency+=o.latency,l.averageLatency=l.totalLatency/l.requestCount,l.lastRequestTime=Date.now(),o.cached||l.cacheMisses++)}return{...i,latency:Date.now()-e,backendResponses:n,cacheHit:!1}}matchEndpoint(t){for(const e of this.endpoints.values())if(e.path===t.path&&e.method===t.method)return e;return null}aggregateBackends(t,e){const s=t.backends;switch(t.aggregator){case"parallel":return this.executeBackendsParallel(s,e,t);case"sequential":return this.executeBackendsSequential(s,e,t);case"merge":default:return this.executeBackendsParallel(s,e,t)}}executeBackendsParallel(t,e,s){const n=[];for(const i of t){const o=this.executeBackend(i,e,s);n.push(o)}return n}executeBackendsSequential(t,e,s){const n=[];let i={};for(const o of t){const l={...e,body:{...typeof e.body=="object"?e.body:{},...i}},d=this.executeBackend(o,l,s);if(n.push(d),d.status>=200&&d.status<300&&d.data)typeof d.data=="object"&&(i={...i,...d.data});else break}return n}executeBackend(t,e,s){const n=this.backends.get(t);if(!n)return{backendId:t,status:503,error:"Backend not found",latency:0,cached:!1};const i=this.circuitBreakers.get(t);if(i){const f=Date.now();if(i.state==="open"){if(f<i.nextAttemptTime)return{backendId:t,status:503,error:"Circuit breaker is open",latency:0,cached:!1};i.state="half-open"}}if(this.config.enableCaching&&this.cacheMode!=="off"){const f=`${t}:${s.path}:${JSON.stringify(e.query||{})}`,m=this.getCached(f);if(m)return{backendId:t,status:200,data:m.data,latency:1,cached:!0}}s.timeout||n.timeout||this.config.defaultTimeout;const o=n.retries||0,l=n.retryBackoff||"exponential";let d,h=0;for(let f=0;f<=o;f++){if(f>0){const R=this.calculateBackoff(f,l);h+=R}const m=50+Math.random()*150,y=(Math.random()-.5)*20,b=m+y;h+=b;const C=n.status==="connected"?.95:.5;if(Math.random()<C){i&&(i.state==="half-open"?(i.successes++,i.successes>=(n.circuitBreaker?.successThreshold||2)&&(i.state="closed",i.failures=0,i.successes=0)):i.failures=Math.max(0,i.failures-1));const R=this.generateMockResponse(n,e);return{backendId:t,status:200,data:R,latency:h,cached:!1}}else d=`Backend error (attempt ${f+1}/${o+1})`,i&&(i.failures++,i.lastFailureTime=Date.now(),i.failures>=(n.circuitBreaker?.failureThreshold||5)&&(i.state="open",i.nextAttemptTime=Date.now()+(n.circuitBreaker?.timeout||6e4)))}return{backendId:t,status:503,error:d||"Backend request failed",latency:h,cached:!1}}calculateBackoff(t,e){switch(e){case"exponential":return Math.min(1e3*Math.pow(2,t-1),1e4);case"linear":return 100*t;case"constant":default:return 100}}generateMockResponse(t,e){const s=t.name.toLowerCase();return s.includes("user")||s.includes("profile")?{id:Math.floor(Math.random()*1e3),name:"John Doe",email:"john.doe@example.com",avatar:"https://example.com/avatar.jpg"}:s.includes("order")||s.includes("cart")?{id:Math.floor(Math.random()*1e3),items:[{id:1,name:"Product 1",price:29.99,quantity:2},{id:2,name:"Product 2",price:49.99,quantity:1}],total:109.97}:s.includes("product")||s.includes("catalog")?{products:[{id:1,name:"Product 1",price:29.99,inStock:!0},{id:2,name:"Product 2",price:49.99,inStock:!0}],total:2}:{data:"Mock response",timestamp:Date.now()}}aggregateResponses(t,e){if(e.length===0)return{status:503,error:"No backends configured for endpoint"};if(e.every(i=>i.status>=400))return{status:503,error:"All backends failed"};const n=e.some(i=>i.status>=400);if(t.aggregator==="merge"||t.aggregator==="parallel"){const i={};for(const o of e)if(o.status>=200&&o.status<300&&o.data){const d=this.backends.get(o.backendId)?.name||o.backendId;typeof o.data=="object"&&o.data,i[d]=o.data}return{status:n?207:200,data:i}}else{const i=e[e.length-1];return i.status>=200&&i.status<300?{status:200,data:i.data}:{status:i.status,error:i.error}}}getCacheKey(t,e){return t.cacheKey?t.cacheKey:`${t.path}:${t.method}:${JSON.stringify(e.query||{})}`}getCached(t){if(this.cacheMode==="off")return null;if(this.cacheMode==="redis"&&this.redisEngine){const s=this.getRedisCacheKey(t),n=this.redisEngine.executeCommand("GET",[s]);if(n.success&&n.value!==null)try{const i=typeof n.value=="string"?JSON.parse(n.value):n.value;return{key:t,data:i,expiresAt:Date.now()+this.defaultCacheTtl*1e3,hitCount:1}}catch{return null}return null}const e=this.cache.get(t);return e?Date.now()>e.expiresAt?(this.cache.delete(t),null):(e.hitCount++,e):null}setCached(t,e,s){if(this.cacheMode!=="off"){if(this.cacheMode==="redis"&&this.redisEngine){const n=this.getRedisCacheKey(t),i=typeof e=="string"?e:JSON.stringify(e),o=[n,i];s>0&&o.push("EX",String(s)),this.redisEngine.executeCommand("SET",o);return}this.cache.set(t,{key:t,data:e,expiresAt:Date.now()+s*1e3,hitCount:0}),this.cache.size>1e3&&this.cleanupCache()}}getRedisCacheKey(t){return`${this.redisNodeId?`bff:${this.redisNodeId}:`:"bff:"}${t}`}cleanupCache(){const t=Date.now();for(const[e,s]of this.cache.entries())t>s.expiresAt&&this.cache.delete(e)}getStats(){let t=0,e=0,s=0,n=0,i=0;const o={};for(const[l,d]of this.backendMetrics.entries())t+=d.requestCount,e+=d.errorCount,s+=d.totalLatency,n+=d.cacheHits,i+=d.cacheMisses,o[l]={...d};return{totalRequests:t,totalErrors:e,averageLatency:t>0?s/t:0,cacheHitRate:n+i>0?n/(n+i):0,backendStats:o}}getBackendMetrics(t){return this.backendMetrics.get(t)}getBackends(){return Array.from(this.backends.values())}getEndpoints(){return Array.from(this.endpoints.values())}updateBackendStatus(t,e){const s=this.backends.get(t);s&&(s.status=e)}}class FE{relays=new Map;config={};deliveries=new Map;pendingDeliveries=new Map;relayMetrics=new Map;initialize(t){if(this.config=t,this.relays.clear(),this.deliveries.clear(),this.pendingDeliveries.clear(),this.relayMetrics.clear(),t.relays)for(const e of t.relays)e.enabled&&(this.relays.set(e.id,{...e}),this.initializeRelayMetrics(e.id))}initializeRelayMetrics(t){this.relayMetrics.set(t,{totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0})}relayWebhook(t){const e=Date.now(),s=this.findMatchingRelay(t);if(!s)return{success:!1,status:404,latency:Date.now()-e,attempts:0,error:"No matching relay found"};if(s.allowedIps&&s.allowedIps.length>0&&t.ip&&!this.isIpAllowed(t.ip,s.allowedIps))return this.updateRelayMetrics(s.id,!1,Date.now()-e),{success:!1,status:403,latency:Date.now()-e,attempts:0,error:"IP address not allowed",relayId:s.id};if(this.config.enableSignatureVerification&&s.signatureSecret&&!this.verifySignature(t,s.signatureSecret,s.signatureHeader||"X-Signature"))return this.updateRelayMetrics(s.id,!1,Date.now()-e),{success:!1,status:401,latency:Date.now()-e,attempts:0,error:"Invalid signature",relayId:s.id};let n=t.body;s.transformTemplate&&(n=this.transformPayload(t.body,s.transformTemplate));const i=this.deliverWebhook(s,{...t,body:n});return this.updateRelayMetrics(s.id,i.success,i.latency),{...i,relayId:s.id}}findMatchingRelay(t){for(const e of this.relays.values())if(t.url.startsWith(e.sourceUrl)||e.sourceUrl==="*"||t.url.includes(e.sourceUrl)){if(e.events&&e.events.length>0){const s=t.event||t.headers["x-event"]||t.headers["x-github-event"]||"";if(!e.events.includes(s)&&s!=="")continue}return e}return null}isIpAllowed(t,e){for(const s of e)if(this.matchesCidr(t,s))return!0;return!1}matchesCidr(t,e){if(e==="*"||e===t)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10),o=s.split("."),l=t.split(".");if(o.length!==4||l.length!==4)return!1;const d=Math.floor(i/8);for(let h=0;h<d;h++)if(o[h]!==l[h])return!1;return!0}return t===e}verifySignature(t,e,s){const n=t.headers[s.toLowerCase()]||t.headers[s]||t.headers["x-signature"]||t.headers["x-hub-signature-256"];return n?(typeof t.body=="string"?t.body:JSON.stringify(t.body),n.length>0&&e.length>0):!1}transformPayload(t,e){try{let s=e;if(s.includes("{{raw}}")){const n=typeof t=="string"?t:JSON.stringify(t);s=s.replace(/\{\{raw\}\}/g,n)}if(s.includes("{{json}}")){const n=typeof t=="string"?JSON.parse(t):t;s=s.replace(/\{\{json\}\}/g,JSON.stringify(n))}try{return JSON.parse(s)}catch{return s}}catch{return t}}deliverWebhook(t,e){const s=t.maxRetryAttempts||this.config.maxRetryAttempts||3,n=t.retryDelay||this.config.retryDelay||5,i=t.timeout||this.config.timeout||30,o=this.config.enableRetryOnFailure!==!1,l=t.retryBackoff||"exponential";let d=0,h,f;const m=Date.now();for(;d<s;){d++;const C=this.simulateHttpRequest(t.targetUrl,e,i);if(C.success){const S=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,R={id:S,relayId:t.id,event:e.event||"unknown",payload:typeof e.body=="string"?e.body:JSON.stringify(e.body),status:"success",timestamp:new Date().toISOString(),attempts:d,responseCode:C.statusCode};return this.deliveries.set(S,R),{success:!0,status:C.statusCode||200,latency:Date.now()-m,deliveryId:S,attempts:d}}if(h=C.error,f=C.statusCode,!o||d>=s)break;this.calculateRetryDelay(d,n,l)}const y=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,b={id:y,relayId:t.id,event:e.event||"unknown",payload:typeof e.body=="string"?e.body:JSON.stringify(e.body),status:"failed",timestamp:new Date().toISOString(),attempts:d,responseCode:f,error:h};return this.deliveries.set(y,b),{success:!1,status:f||500,latency:Date.now()-m,deliveryId:y,attempts:d,error:h||"Delivery failed after all retry attempts"}}simulateHttpRequest(t,e,s){const n=10+Math.random()*40,i=5+Math.random()*95,o=Math.random()<.05;if(Math.random()<.02)return{success:!1,statusCode:504,error:"Request timeout",latency:s*1e3};if(o){const d=[500,502,503,429],h=d[Math.floor(Math.random()*d.length)];return{success:!1,statusCode:h,error:`HTTP ${h} error`,latency:n+i}}return{success:!0,statusCode:200,latency:n+i}}calculateRetryDelay(t,e,s){switch(s){case"exponential":return e*Math.pow(2,t-1);case"linear":return e*t;case"constant":default:return e}}updateRelayMetrics(t,e,s){let n=this.relayMetrics.get(t);n||(n={totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0},this.relayMetrics.set(t,n)),n.totalRequests++,n.totalLatency+=s,n.averageLatency=n.totalLatency/n.totalRequests,n.lastRequestTime=Date.now(),e?n.successfulDeliveries++:n.failedDeliveries++}getDeliveries(t){const e=Array.from(this.deliveries.values());return t?e.filter(s=>s.relayId===t):e}getRelayMetrics(t){return this.relayMetrics.get(t)}getAllRelayMetrics(){return new Map(this.relayMetrics)}getRelay(t){return this.relays.get(t)}getAllRelays(){return Array.from(this.relays.values())}}class VE{keys=new Map;config={};maxMemoryBytes=256*1024*1024;currentMemoryUsage=0;metrics={totalKeys:0,keysByType:{string:0,hash:0,list:0,set:0,zset:0,stream:0},memoryUsage:0,memoryUsagePercent:0,operationsPerSecond:0,hitCount:0,missCount:0,hitRate:0,expiredKeys:0,evictedKeys:0,connectedClients:0};operationCount=0;lastMetricsUpdate=Date.now();operationHistory=[];clusterSlots=new Map;clusterNodes=[];initialize(t){if(this.config={...t},this.keys.clear(),this.currentMemoryUsage=0,this.operationCount=0,this.lastMetricsUpdate=Date.now(),this.operationHistory=[],t.maxMemory&&(this.maxMemoryBytes=this.parseMemorySize(t.maxMemory)),t.enableCluster&&t.clusterNodes&&(this.clusterNodes=[...t.clusterNodes],this.initializeClusterSlots()),t.keys)for(const e of t.keys)this.setKey(e.key,e.type,e.value,e.ttl);this.updateMetrics()}parseMemorySize(t){const e=t.match(/^(\d+)([kmg]?b?)$/i);if(!e)return 256*1024*1024;const s=parseInt(e[1]);switch(e[2].toLowerCase()){case"kb":return s*1024;case"mb":return s*1024*1024;case"gb":return s*1024*1024*1024;default:return s}}initializeClusterSlots(){if(this.clusterNodes.length===0)return;const t=Math.floor(16384/this.clusterNodes.length);let e=0;for(let s=0;s<this.clusterNodes.length;s++){const n=s===this.clusterNodes.length-1?16383:e+t-1;for(let i=e;i<=n;i++)this.clusterSlots.set(i,this.clusterNodes[s]);e=n+1}}getClusterSlot(t){const e=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935];let s=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);s=(s<<8^e[(s>>8^i)&255])&65535}return s%16384}isKeyForThisNode(t){if(!this.config.enableCluster||this.clusterNodes.length===0)return!0;const e=this.getClusterSlot(t);return this.clusterSlots.get(e),!0}executeCommand(t,e){const s=Date.now(),n=t.toUpperCase();try{let i;switch(n){case"GET":i=this.get(e[0]);break;case"SET":i=this.set(e[0],e[1],e[2]?parseInt(e[2]):void 0);break;case"DEL":i=this.del(e);break;case"EXISTS":i=this.exists(e);break;case"EXPIRE":i=this.expire(e[0],parseInt(e[1]));break;case"TTL":i=this.ttl(e[0]);break;case"KEYS":i=this.keys(e[0]||"*");break;case"HGET":i=this.hget(e[0],e[1]);break;case"HSET":i=this.hset(e[0],e.slice(1));break;case"HGETALL":i=this.hgetall(e[0]);break;case"HDEL":i=this.hdel(e[0],e.slice(1));break;case"HKEYS":i=this.hkeys(e[0]);break;case"HVALS":i=this.hvals(e[0]);break;case"LPUSH":i=this.lpush(e[0],e.slice(1));break;case"RPUSH":i=this.rpush(e[0],e.slice(1));break;case"LPOP":i=this.lpop(e[0]);break;case"RPOP":i=this.rpop(e[0]);break;case"LLEN":i=this.llen(e[0]);break;case"LRANGE":i=this.lrange(e[0],parseInt(e[1]),parseInt(e[2]));break;case"SADD":i=this.sadd(e[0],e.slice(1));break;case"SREM":i=this.srem(e[0],e.slice(1));break;case"SMEMBERS":i=this.smembers(e[0]);break;case"SISMEMBER":i=this.sismember(e[0],e[1]);break;case"SCARD":i=this.scard(e[0]);break;case"ZADD":i=this.zadd(e[0],e.slice(1));break;case"ZREM":i=this.zrem(e[0],e.slice(1));break;case"ZRANGE":i=this.zrange(e[0],parseInt(e[1]),parseInt(e[2]));break;case"ZSCORE":i=this.zscore(e[0],e[1]);break;case"ZCARD":i=this.zcard(e[0]);break;case"PING":i="PONG";break;case"INFO":i=this.info(e[0]);break;case"DBSIZE":i=this.dbsize();break;default:return{success:!1,error:`Unknown command: ${t}`,latency:Date.now()-s}}const o=Date.now()-s;return this.recordOperation(),{success:!0,value:i,latency:o}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",latency:Date.now()-s}}}recordOperation(){this.operationCount++,this.operationHistory.push({timestamp:Date.now()}),this.operationHistory.length>1e3&&this.operationHistory.shift()}get(t){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");const e=this.keys.get(t);return e?this.isExpired(e)?(this.deleteKey(t),this.metrics.missCount++,null):(this.metrics.hitCount++,typeof e.value=="string"?e.value:JSON.stringify(e.value)):(this.metrics.missCount++,null)}set(t,e,s){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();const n=this.keys.get(t);n&&(this.currentMemoryUsage-=this.calculateKeySize(n));const i={key:t,type:"string",value:e,ttl:s!==void 0?s:n?.ttl,expiresAt:s!==void 0&&s>0?Date.now()+s*1e3:n?.expiresAt,size:this.estimateSize(e)};return this.keys.set(t,i),this.currentMemoryUsage+=this.calculateKeySize(i),"OK"}del(t){let e=0;for(const s of t)this.deleteKey(s)&&e++;return e}exists(t){let e=0;for(const s of t){const n=this.keys.get(s);n&&!this.isExpired(n)&&e++}return e}expire(t,e){const s=this.keys.get(t);return s?this.isExpired(s)?(this.deleteKey(t),0):(s.ttl=e,s.expiresAt=e>0?Date.now()+e*1e3:void 0,1):0}ttl(t){const e=this.keys.get(t);if(!e)return-2;if(this.isExpired(e))return this.deleteKey(t),-2;if(!e.expiresAt)return-1;const s=Math.floor((e.expiresAt-Date.now())/1e3);return s>0?s:-2}keys(t){const e=this.patternToRegex(t),s=[];for(const[n,i]of this.keys.entries()){if(this.isExpired(i)){this.deleteKey(n);continue}e.test(n)&&s.push(n)}return s}hget(t,e){const s=this.keys.get(t);return!s||s.type!=="hash"?null:this.isExpired(s)?(this.deleteKey(t),null):s.value[e]||null}hset(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="hash")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"hash",value:{},size:0});const n=s.value;let i=0;for(let o=0;o<e.length;o+=2){const l=e[o],d=e[o+1];n[l]||i++,n[l]=d}return s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),i}hgetall(t){const e=this.keys.get(t);return!e||e.type!=="hash"?{}:this.isExpired(e)?(this.deleteKey(t),{}):{...e.value}}hdel(t,e){const s=this.keys.get(t);if(!s||s.type!=="hash")return 0;if(this.isExpired(s))return this.deleteKey(t),0;const n=s.value;let i=0;for(const o of e)n[o]&&(delete n[o],i++);return i>0&&(s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s)),i}hkeys(t){const e=this.keys.get(t);return!e||e.type!=="hash"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Object.keys(e.value)}hvals(t){const e=this.keys.get(t);return!e||e.type!=="hash"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Object.values(e.value)}lpush(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="list")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"list",value:[],size:0});const n=s.value;return n.unshift(...e),s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),n.length}rpush(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="list")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"list",value:[],size:0});const n=s.value;return n.push(...e),s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),n.length}lpop(t){const e=this.keys.get(t);if(!e||e.type!=="list")return null;if(this.isExpired(e))return this.deleteKey(t),null;const s=e.value;if(s.length===0)return null;const n=s.shift();return e.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,e),n}rpop(t){const e=this.keys.get(t);if(!e||e.type!=="list")return null;if(this.isExpired(e))return this.deleteKey(t),null;const s=e.value;if(s.length===0)return null;const n=s.pop();return e.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,e),n}llen(t){const e=this.keys.get(t);return!e||e.type!=="list"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.length}lrange(t,e,s){const n=this.keys.get(t);if(!n||n.type!=="list")return[];if(this.isExpired(n))return this.deleteKey(t),[];const i=n.value,o=i.length,l=e<0?Math.max(0,o+e):Math.min(e,o),d=s<0?Math.max(0,o+s):Math.min(s,o-1);return i.slice(l,d+1)}sadd(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="set")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"set",value:new Set,size:0});const n=s.value;let i=0;for(const o of e)n.has(o)||(n.add(o),i++);return s.size=this.estimateSize(JSON.stringify(Array.from(n))),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),i}srem(t,e){const s=this.keys.get(t);if(!s||s.type!=="set")return 0;if(this.isExpired(s))return this.deleteKey(t),0;const n=s.value;let i=0;for(const o of e)n.has(o)&&(n.delete(o),i++);return i>0&&(s.size=this.estimateSize(JSON.stringify(Array.from(n))),this.keys.set(t,s)),i}smembers(t){const e=this.keys.get(t);return!e||e.type!=="set"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Array.from(e.value)}sismember(t,e){const s=this.keys.get(t);return!s||s.type!=="set"?0:this.isExpired(s)?(this.deleteKey(t),0):s.value.has(e)?1:0}scard(t){const e=this.keys.get(t);return!e||e.type!=="set"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.size}zadd(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="zset")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"zset",value:new Map,size:0});const n=s.value;let i=0;for(let o=0;o<e.length;o+=2){const l=parseFloat(e[o]),d=e[o+1];n.has(d)||i++,n.set(d,l)}return s.size=this.estimateSize(JSON.stringify(Array.from(n.entries()))),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),i}zrem(t,e){const s=this.keys.get(t);if(!s||s.type!=="zset")return 0;if(this.isExpired(s))return this.deleteKey(t),0;const n=s.value;let i=0;for(const o of e)n.has(o)&&(n.delete(o),i++);return i>0&&(s.size=this.estimateSize(JSON.stringify(Array.from(n.entries()))),this.keys.set(t,s)),i}zrange(t,e,s){const n=this.keys.get(t);if(!n||n.type!=="zset")return[];if(this.isExpired(n))return this.deleteKey(t),[];const i=n.value,o=Array.from(i.entries()).sort((f,m)=>f[1]-m[1]),l=o.length,d=e<0?Math.max(0,l+e):Math.min(e,l),h=s<0?Math.max(0,l+s):Math.min(s,l-1);return o.slice(d,h+1).map(f=>f[0])}zscore(t,e){const s=this.keys.get(t);return!s||s.type!=="zset"?null:this.isExpired(s)?(this.deleteKey(t),null):s.value.get(e)??null}zcard(t){const e=this.keys.get(t);return!e||e.type!=="zset"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.size}info(t){const e=this.getMetrics();return`# Server
redis_version:7.2.0
redis_mode:${this.config.enableCluster?"cluster":"standalone"}

# Memory
used_memory:${e.memoryUsage}
used_memory_human:${this.formatBytes(e.memoryUsage)}
maxmemory:${this.maxMemoryBytes}
maxmemory_human:${this.formatBytes(this.maxMemoryBytes)}
maxmemory_policy:${this.config.maxMemoryPolicy||"noeviction"}
mem_fragmentation_ratio:1.0

# Stats
total_keys:${e.totalKeys}
expired_keys:${e.expiredKeys}
evicted_keys:${e.evictedKeys}
keyspace_hits:${e.hitCount}
keyspace_misses:${e.missCount}

# Cluster
cluster_enabled:${this.config.enableCluster?1:0}
`}dbsize(){return this.cleanupExpiredKeys(),this.keys.size}setKey(t,e,s,n){const i={key:t,type:e,value:s,ttl:n!==void 0?n:-1,expiresAt:n!==void 0&&n>0?Date.now()+n*1e3:void 0,size:this.estimateSize(typeof s=="string"?s:JSON.stringify(s))};this.keys.set(t,i),this.currentMemoryUsage+=this.calculateKeySize(i)}deleteKey(t){const e=this.keys.get(t);return e?(this.currentMemoryUsage-=this.calculateKeySize(e),this.keys.delete(t),!0):!1}isExpired(t){return t.expiresAt?Date.now()>=t.expiresAt:!1}cleanupExpiredKeys(){let t=0;for(const[e,s]of this.keys.entries())this.isExpired(s)&&(this.deleteKey(e),t++);t>0&&(this.metrics.expiredKeys+=t)}checkMemoryAndEvict(){if(this.currentMemoryUsage<=this.maxMemoryBytes)return;const t=this.config.maxMemoryPolicy||"noeviction";if(t==="noeviction")return;const e=this.selectKeysToEvict(t);let s=0;for(const n of e)if(this.deleteKey(n),s++,this.currentMemoryUsage<=this.maxMemoryBytes*.9)break;s>0&&(this.metrics.evictedKeys+=s)}selectKeysToEvict(t){const e=Array.from(this.keys.keys());switch(t){case"allkeys-lru":case"allkeys-lfu":case"allkeys-random":return e;case"volatile-lru":case"volatile-lfu":case"volatile-ttl":case"volatile-random":return e.filter(s=>{const n=this.keys.get(s);return n&&n.expiresAt!==void 0});default:return[]}}calculateKeySize(t){if(t.size)return t.size;let e=0;return typeof t.value=="string"?e=Buffer.byteLength(t.value,"utf8"):e=Buffer.byteLength(JSON.stringify(t.value),"utf8"),Buffer.byteLength(t.key,"utf8")+e+100}estimateSize(t){return Buffer.byteLength(t,"utf8")}patternToRegex(t){const e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${e}$`)}formatBytes(t){if(t===0)return"0B";const e=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,n)*100)/100+s[n]}getMetrics(){return this.cleanupExpiredKeys(),this.updateMetrics(),{...this.metrics}}updateMetrics(){const t=Date.now();(t-this.lastMetricsUpdate)/1e3;const e={string:0,hash:0,list:0,set:0,zset:0,stream:0};for(const o of this.keys.values())e[o.type]++;const s=this.operationHistory.filter(o=>o.timestamp>t-1e3).length,n=this.metrics.hitCount+this.metrics.missCount,i=n>0?this.metrics.hitCount/n:0;this.metrics={totalKeys:this.keys.size,keysByType:e,memoryUsage:this.currentMemoryUsage,memoryUsagePercent:this.maxMemoryBytes>0?this.currentMemoryUsage/this.maxMemoryBytes*100:0,operationsPerSecond:s,hitCount:this.metrics.hitCount,missCount:this.metrics.missCount,hitRate:i,expiredKeys:this.metrics.expiredKeys,evictedKeys:this.metrics.evictedKeys,connectedClients:1},this.lastMetricsUpdate=t}getAllKeys(){return this.cleanupExpiredKeys(),Array.from(this.keys.values())}getKey(t){const e=this.keys.get(t);if(e&&this.isExpired(e)){this.deleteKey(t);return}return e}syncKeysFromConfig(t){const e=new Map;for(const s of t)e.set(s.key,s);for(const[s,n]of this.keys.entries());for(const s of t){const n=this.keys.get(s.key);if(!n)this.setKey(s.key,s.type,s.value,s.ttl);else if(n.type!==s.type||JSON.stringify(n.value)!==JSON.stringify(s.value)||n.ttl!==s.ttl){this.currentMemoryUsage-=this.calculateKeySize(n);const i={...s,expiresAt:s.ttl!==void 0&&s.ttl>0?Date.now()+s.ttl*1e3:void 0,size:this.estimateSize(typeof s.value=="string"?s.value:JSON.stringify(s.value))};this.keys.set(s.key,i),this.currentMemoryUsage+=this.calculateKeySize(i)}}this.updateMetrics()}}class QE{clusterName="archiphoenix-cluster";nodes=new Map;keyspaces=new Map;tables=new Map;tableData=new Map;defaultConsistencyLevel="QUORUM";defaultReplicationFactor=3;enableCompaction=!0;compactionStrategy="SizeTieredCompactionStrategy";datacenter="dc1";metrics={readLatency:5,writeLatency:10,totalNodes:0,healthyNodes:0,totalKeyspaces:0,totalTables:0,totalRows:0,totalSize:0,readOperationsPerSecond:0,writeOperationsPerSecond:0,readConsistencyViolations:0,writeConsistencyViolations:0,pendingCompactions:0,hintedHandoffs:0};readOperations=[];writeOperations=[];lastMetricsUpdate=Date.now();initialize(t){if(this.clusterName=t.clusterName||"archiphoenix-cluster",this.defaultConsistencyLevel=t.defaultConsistencyLevel||"QUORUM",this.defaultReplicationFactor=t.defaultReplicationFactor||3,this.enableCompaction=t.enableCompaction??!0,this.compactionStrategy=t.compactionStrategy||"SizeTieredCompactionStrategy",this.datacenter=t.datacenter||"dc1",this.nodes.clear(),t.nodes)for(const e of t.nodes)this.nodes.set(e.address,{...e});else this.nodes.set("localhost:9042",{address:"localhost:9042",status:"up",load:.5,tokens:256});if(this.keyspaces.clear(),t.keyspaces)for(const e of t.keyspaces)this.keyspaces.set(e.name,{...e});else this.keyspaces.set("system",{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0});if(this.tables.clear(),this.tableData.clear(),t.tables)for(const e of t.tables){const s=`${e.keyspace}.${e.name}`;this.tables.set(s,{...e}),this.tableData.set(s,[])}this.updateMetrics()}syncFromConfig(t){if(t.clusterName&&(this.clusterName=t.clusterName),t.defaultConsistencyLevel&&(this.defaultConsistencyLevel=t.defaultConsistencyLevel),t.defaultReplicationFactor!==void 0&&(this.defaultReplicationFactor=t.defaultReplicationFactor),t.nodes)for(const e of t.nodes)this.nodes.set(e.address,{...e});if(t.keyspaces){new Set(this.keyspaces.keys());for(const e of t.keyspaces)this.keyspaces.set(e.name,{...e,tables:this.countTablesInKeyspace(e.name)})}if(t.tables)for(const e of t.tables){const s=`${e.keyspace}.${e.name}`,n=this.tables.get(s);if(n){const i=this.tableData.get(s)||[];this.tables.set(s,{...e,rows:n.rows||i.length||0,size:n.size||i.length*1024||0})}else this.tables.set(s,{...e,rows:0,size:0}),this.tableData.has(s)||this.tableData.set(s,[])}this.updateMetrics()}executeCQL(t,e){const s=Date.now(),n=e||this.defaultConsistencyLevel;try{const i=t.trim().replace(/\s+/g," "),o=i.toUpperCase();return o.startsWith("SELECT")?this.executeSelect(i,n,s):o.startsWith("INSERT")?this.executeInsert(i,n,s):o.startsWith("UPDATE")?this.executeUpdate(i,n,s):o.startsWith("DELETE")?this.executeDelete(i,n,s):o.startsWith("CREATE KEYSPACE")?this.executeCreateKeyspace(i,s):o.startsWith("CREATE TABLE")?this.executeCreateTable(i,s):o.startsWith("DROP TABLE")?this.executeDropTable(i,s):o.startsWith("DROP KEYSPACE")?this.executeDropKeyspace(i,s):{success:!1,error:`Unsupported CQL statement: ${i}`,latency:Date.now()-s}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",latency:Date.now()-s}}}executeSelect(t,e,s){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i),l=this.tables.get(o);if(!l)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const d=this.tableData.get(o)||[],h=t.match(/LIMIT\s+(\d+)/i),f=h?parseInt(h[1],10):void 0;let m=[...d];const y=t.match(/WHERE\s+(.+?)(?:\s+LIMIT|$)/i);if(y){const M=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(M){const T=M[1],E=M[2];m=d.filter(A=>String(A[T])===E)}}f!==void 0&&f>0&&(m=m.slice(0,f));const b=this.calculateReadLatency(e),C=this.checkConsistencyViolation(e,l.keyspace);this.recordReadOperation(b,C);const S=this.getRequiredReplicas(e,l.keyspace);return{success:!0,latency:b,consistency:e,rows:m,rowCount:m.length,replicasQueried:S}}executeInsert(t,e,s){const n=t.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i);let l=this.tables.get(o);if(!l)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const d=t.match(/\(([^)]+)\)\s*VALUES/i),h=t.match(/VALUES\s*\(([^)]+)\)/i);if(!d||!h)return{success:!1,error:"Invalid INSERT query: missing columns or values",latency:Date.now()-s};const f=d[1].split(",").map(T=>T.trim()),m=h[1],y=this.parseValueList(m);if(f.length!==y.length)return{success:!1,error:"Column count does not match value count",latency:Date.now()-s};const b={};for(let T=0;T<f.length;T++)b[f[T]]=y[T];const C=this.tableData.get(o)||[];C.push(b),this.tableData.set(o,C),l.rows=C.length,l.size=C.length*1024,this.tables.set(o,l);const S=this.calculateWriteLatency(e,l.keyspace),R=this.checkConsistencyViolation(e,l.keyspace);this.recordWriteOperation(S,R);const M=this.getRequiredReplicas(e,l.keyspace);return this.updateMetrics(),{success:!0,latency:S,consistency:e,rowCount:1,replicasQueried:M}}executeUpdate(t,e,s){const n=t.match(/UPDATE\s+([\w.]+)\s+SET/i);if(!n)return{success:!1,error:"Invalid UPDATE query",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i),l=this.tables.get(o);if(!l)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const d=t.match(/SET\s+(.+?)(?:\s+WHERE|$)/i);if(!d)return{success:!1,error:"Invalid UPDATE query: missing SET clause",latency:Date.now()-s};const h=d[1].trim(),f={},m=h.split(",").map(N=>N.trim());for(const N of m){const z=N.match(/(\w+)\s*=\s*(.+)/);if(z){const q=z[1].trim(),Z=this.parseValue(z[2].trim());f[q]=Z}}const y=t.match(/WHERE\s+(.+)/i);if(!y)return{success:!1,error:"UPDATE requires WHERE clause",latency:Date.now()-s};const C=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!C)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-s};const S=C[1],R=C[2],M=this.tableData.get(o)||[];let T=0;for(const N of M)String(N[S])===R&&(Object.assign(N,f),T++);l.rows=M.length,l.size=M.length*1024,this.tables.set(o,l);const E=this.calculateWriteLatency(e,l.keyspace),A=this.checkConsistencyViolation(e,l.keyspace);this.recordWriteOperation(E,A);const _=this.getRequiredReplicas(e,l.keyspace);return this.updateMetrics(),{success:!0,latency:E,consistency:e,rowCount:T,replicasQueried:_}}executeDelete(t,e,s){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DELETE query: missing FROM clause",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i),l=this.tables.get(o);if(!l)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const d=t.match(/WHERE\s+(.+)/i);if(!d)return{success:!1,error:"DELETE requires WHERE clause",latency:Date.now()-s};const f=d[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!f)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-s};const m=f[1],y=f[2],b=this.tableData.get(o)||[],C=b.length,S=b.filter(A=>String(A[m])!==y);this.tableData.set(o,S),l.rows=S.length,l.size=S.length*1024,this.tables.set(o,l);const R=C-S.length,M=this.calculateWriteLatency(e,l.keyspace),T=this.checkConsistencyViolation(e,l.keyspace);this.recordWriteOperation(M,T);const E=this.getRequiredReplicas(e,l.keyspace);return this.updateMetrics(),{success:!0,latency:M,consistency:e,rowCount:R,replicasQueried:E}}executeCreateKeyspace(t,e){const s=t.match(/KEYSPACE\s+(\w+)/i);if(!s)return{success:!1,error:"Invalid CREATE KEYSPACE query",latency:Date.now()-e};const n=s[1].trim();if(this.keyspaces.has(n))return{success:!1,error:`Keyspace ${n} already exists`,latency:Date.now()-e};let i=this.defaultReplicationFactor;const o=t.match(/replication.*?(\d+)/i);return o&&(i=parseInt(o[1],10)),this.keyspaces.set(n,{name:n,replication:i,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeCreateTable(t,e){const s=t.match(/TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);if(this.tables.has(i))return{success:!1,error:`Table ${n} already exists`,latency:Date.now()-e};let o=t;const l=t.toUpperCase().indexOf(" WITH ");l>0&&(o=t.substring(0,l));const d=o.match(/\(([^)]+)\)/);if(!d)return{success:!1,error:"Invalid CREATE TABLE query: missing column definitions",latency:Date.now()-e};const h=d[1],f=[],m=h.split(",").map(M=>M.trim());for(const M of m){if(M.toUpperCase().includes("PRIMARY KEY"))continue;const T=M.match(/(\w+)\s+(\w+)/);T&&f.push({name:T[1],type:T[2]})}const y=n.split("."),b=y.length>1?y[0]:"system",C=y.length>1?y[1]:y[0];if(!this.keyspaces.has(b))return{success:!1,error:`Keyspace ${b} does not exist`,latency:Date.now()-e};const S={name:C,keyspace:b,columns:f,rows:0,size:0};this.tables.set(i,S),this.tableData.set(i,[]);const R=this.keyspaces.get(b);return R&&(R.tables=this.countTablesInKeyspace(b),this.keyspaces.set(b,R)),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeDropTable(t,e){const s=t.match(/TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);if(!this.tables.has(i))return{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e};const o=this.tables.get(i);this.tables.delete(i),this.tableData.delete(i);const l=this.keyspaces.get(o.keyspace);return l&&(l.tables=this.countTablesInKeyspace(o.keyspace),this.keyspaces.set(o.keyspace,l)),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeDropKeyspace(t,e){const s=t.match(/KEYSPACE\s+(\w+)/i);if(!s)return{success:!1,error:"Invalid DROP KEYSPACE query",latency:Date.now()-e};const n=s[1].trim();if(!this.keyspaces.has(n))return{success:!1,error:`Keyspace ${n} does not exist`,latency:Date.now()-e};const i=[];for(const[o,l]of this.tables.entries())l.keyspace===n&&i.push(o);for(const o of i)this.tables.delete(o),this.tableData.delete(o);return this.keyspaces.delete(n),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}getNodes(){return Array.from(this.nodes.values())}getKeyspaces(){return Array.from(this.keyspaces.values())}getTables(){return Array.from(this.tables.values())}getMetrics(){return this.updateMetrics(),{...this.metrics}}calculateReadLatency(t){const s=this.getRequiredReplicas(t,"system"),n=Math.log(s+1)*3,i=Math.random()*2;return Math.round(2+n+i)}calculateWriteLatency(t,e){const i=this.getRequiredReplicas(t,e)*2,o=Math.random()*3;return Math.round(5+i+o)}getRequiredReplicas(t,e){const n=this.keyspaces.get(e)?.replication||this.defaultReplicationFactor;switch(t){case"ONE":case"LOCAL_ONE":return 1;case"TWO":return 2;case"THREE":return 3;case"QUORUM":case"LOCAL_QUORUM":return Math.floor(n/2)+1;case"ALL":case"EACH_QUORUM":return n;case"SERIAL":case"LOCAL_SERIAL":return Math.floor(n/2)+1;default:return Math.floor(n/2)+1}}checkConsistencyViolation(t,e){const s=this.metrics.healthyNodes,n=this.getRequiredReplicas(t,e),i=s<n?.8:.05;return Math.random()<i}recordReadOperation(t,e){const s=Date.now();this.readOperations.push({timestamp:s,latency:t,violated:e}),this.readOperations.length>1e3&&this.readOperations.shift(),e&&this.metrics.readConsistencyViolations++}recordWriteOperation(t,e){const s=Date.now();this.writeOperations.push({timestamp:s,latency:t,violated:e}),this.writeOperations.length>1e3&&this.writeOperations.shift(),e&&this.metrics.writeConsistencyViolations++}updateMetrics(){const t=Date.now();(t-this.lastMetricsUpdate)/1e3,this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(h=>h.status==="up").length,this.metrics.totalKeyspaces=this.keyspaces.size,this.metrics.totalTables=this.tables.size;let e=0,s=0;for(const[h,f]of this.tableData.entries())e+=f.length,s+=f.length*1024;this.metrics.totalRows=e,this.metrics.totalSize=s;const n=t-1e3,i=this.readOperations.filter(h=>h.timestamp>n),o=this.writeOperations.filter(h=>h.timestamp>n);if(this.metrics.readOperationsPerSecond=i.length,this.metrics.writeOperationsPerSecond=o.length,i.length>0){const h=i.reduce((f,m)=>f+m.latency,0)/i.length;this.metrics.readLatency=Math.round(h*10)/10}if(o.length>0){const h=o.reduce((f,m)=>f+m.latency,0)/o.length;this.metrics.writeLatency=Math.round(h*10)/10}this.metrics.pendingCompactions=Math.floor(this.metrics.totalSize/(10*1024*1024));const l=this.metrics.totalNodes-this.metrics.healthyNodes;this.metrics.hintedHandoffs=l>0?l*5:0;const d=this.metrics.readOperationsPerSecond+this.metrics.writeOperationsPerSecond;for(const h of this.nodes.values())if(h.status==="up"){const f=Math.min(.95,.3+d/100*.3);h.load=h.load*.9+f*.1,h.load+=(Math.random()-.5)*.05,h.load=Math.max(.1,Math.min(.95,h.load))}this.lastMetricsUpdate=t}countTablesInKeyspace(t){let e=0;for(const s of this.tables.values())s.keyspace===t&&e++;return e}normalizeTableKey(t){return t.includes(".")?t:`system.${t}`}parseValueList(t){const e=[];let s="",n=!1,i="";for(let o=0;o<t.length;o++){const l=t[o];if((l==='"'||l==="'")&&!n){n=!0,i=l;continue}else if(l===i&&n){n=!1,i="";continue}l===","&&!n?(e.push(this.parseValue(s.trim())),s=""):s+=l}return s.trim()&&e.push(this.parseValue(s.trim())),e}parseValue(t){return t=t.trim(),t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):t.toUpperCase()==="TRUE"?!0:t.toUpperCase()==="FALSE"?!1:t.toUpperCase()==="NULL"?null:t}}class GE{cluster="archiphoenix-cluster";replication=!1;tables=new Map;tableData=new Map;tableParts=new Map;maxMemoryUsage=10*1024*1024*1024;compression="LZ4";metrics={queryThroughput:0,avgQueryTime:45,queriesPerSecond:0,readRowsPerSecond:0,writtenRowsPerSecond:0,totalRows:0,totalSize:0,compressionRatio:5,activeQueries:0,memoryUsage:0,memoryUsagePercent:0,partsCount:0,pendingMerges:0,totalTables:0,clusterNodes:1,healthyNodes:1};queryOperations=[];lastMetricsUpdate=Date.now();activeQueriesSet=new Set;initialize(t){if(this.cluster=t.cluster||"archiphoenix-cluster",this.replication=t.replication||!1,this.maxMemoryUsage=t.maxMemoryUsage||10*1024*1024*1024,this.compression=t.compression||"LZ4",this.tables.clear(),this.tableData.clear(),this.tableParts.clear(),t.tables)for(const e of t.tables){const s=`${e.database||"default"}.${e.name}`;this.tables.set(s,{...e}),this.tableData.set(s,[]),this.tableParts.set(s,[])}this.updateMetrics()}syncFromConfig(t){if(t.cluster&&(this.cluster=t.cluster),t.replication!==void 0&&(this.replication=t.replication),t.maxMemoryUsage&&(this.maxMemoryUsage=t.maxMemoryUsage),t.compression&&(this.compression=t.compression),t.tables)for(const e of t.tables){const s=`${e.database||"default"}.${e.name}`,n=this.tables.get(s),i=this.tableData.get(s)||[];n?this.tables.set(s,{...e,rows:n.rows||i.length||0,size:n.size||i.length*512||0}):(this.tables.set(s,{...e,rows:0,size:0}),this.tableData.has(s)||(this.tableData.set(s,[]),this.tableParts.set(s,[])))}this.updateMetrics()}executeQuery(t){const e=Date.now(),s=`query-${Date.now()}-${Math.random()}`;try{const n=t.trim().replace(/\s+/g," "),i=n.toUpperCase();this.activeQueriesSet.add(s),this.metrics.activeQueries=this.activeQueriesSet.size;let o;i.startsWith("SELECT")?o=this.executeSelect(n,e):i.startsWith("INSERT")?o=this.executeInsert(n,e):i.startsWith("ALTER")?o=this.executeAlter(n,e):i.startsWith("CREATE TABLE")?o=this.executeCreateTable(n,e):i.startsWith("DROP TABLE")?o=this.executeDropTable(n,e):o={success:!1,error:`Unsupported SQL statement: ${n}`,latency:Date.now()-e};const l=o.latency||Date.now()-e;return this.queryOperations.push({timestamp:Date.now(),latency:l,rowsRead:o.dataRead||0,rowsWritten:o.dataWritten||0}),this.activeQueriesSet.delete(s),this.metrics.activeQueries=this.activeQueriesSet.size,o}catch(n){return this.activeQueriesSet.delete(s),this.metrics.activeQueries=this.activeQueriesSet.size,{success:!1,error:n instanceof Error?n.message:"Unknown error",latency:Date.now()-e}}}executeSelect(t,e){const s=t.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n),o=this.tables.get(i);if(!o)return{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e};const l=this.tableData.get(i)||[],d=t.match(/SELECT\s+(.+?)\s+FROM/i),h=d?d[1].trim().split(",").map(T=>T.trim()):["*"];let f=[...l];const m=t.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(m){const E=m[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(E){const A=E[1],_=E[2];f=l.filter(N=>String(N[A])===_)}}const y=t.match(/GROUP\s+BY\s+(\w+)/i);if(y){const T=y[1],E=new Map;f.forEach(A=>{const _=String(A[T]||"null");E.set(_,(E.get(_)||0)+1)}),f=Array.from(E.entries()).map(([A,_])=>({[T]:A,count:_}))}const b=t.match(/ORDER\s+BY\s+(\w+)(?:\s+(ASC|DESC))?/i);if(b){const T=b[1],E=(b[2]||"ASC").toUpperCase();f.sort((A,_)=>{const N=A[T],z=_[T];return E==="DESC"?N>z?-1:N<z?1:0:N<z?-1:N>z?1:0})}const C=t.match(/LIMIT\s+(\d+)/i),S=C?parseInt(C[1],10):void 0;S!==void 0&&S>0&&(f=f.slice(0,S));const R=this.calculateQueryLatency(t,o,f.length);let M=f;return!h.includes("*")&&h.length>0&&(M=f.map(T=>{const E={};return h.forEach(A=>{T.hasOwnProperty(A)&&(E[A]=T[A])}),E})),{success:!0,latency:R,rows:M,rowCount:M.length,columns:h.includes("*")?Object.keys(l[0]||{}):h,dataRead:l.length}}executeInsert(t,e){const s=t.match(/INTO\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);let o=this.tables.get(i);if(!o)return{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e};const l=t.match(/VALUES\s+(.+)/i);if(!l)return{success:!1,error:"Invalid INSERT query: missing VALUES clause",latency:Date.now()-e};const d=l[1].trim(),h=this.parseValues(d),f=this.tableData.get(i)||[],m={},y=t.match(/\(([^)]+)\)\s+VALUES/i),b=y?y[1].split(",").map(S=>S.trim()):[];b.length>0&&b.length===h.length?b.forEach((S,R)=>{m[S]=h[R]}):h.forEach((S,R)=>{m[`column_${R}`]=S}),f.push(m),this.tableData.set(i,f),o.rows=f.length,o.size=f.length*512,this.tables.set(i,o);const C=10+Math.random()*5;return this.simulatePartCreation(i),this.updateMetrics(),{success:!0,latency:C,rowCount:1,dataWritten:1}}executeCreateTable(t,e){const s=t.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);if(this.tables.has(i))return{success:!1,error:`Table ${n} already exists`,latency:Date.now()-e};const o=t.match(/ENGINE\s*=\s*(\w+)/i),l=o?o[1]:"MergeTree",[d,h]=i.split("."),f={name:h,database:d||"default",engine:l,rows:0,size:0,partitions:0};return this.tables.set(i,f),this.tableData.set(i,[]),this.tableParts.set(i,[]),this.updateMetrics(),{success:!0,latency:Date.now()-e}}executeDropTable(t,e){const s=t.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);return this.tables.has(i)?(this.tables.delete(i),this.tableData.delete(i),this.tableParts.delete(i),this.updateMetrics(),{success:!0,latency:Date.now()-e}):{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e}}executeAlter(t,e){const s=t.match(/ALTER\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid ALTER TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);return this.tables.get(i)?{success:!0,latency:Date.now()-e}:{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e}}calculateQueryLatency(t,e,s){const i=s/1e6*5;let o=1;const l=t.toUpperCase();l.includes("JOIN")&&(o*=2),l.includes("GROUP BY")&&(o*=1.5),l.includes("ORDER BY")&&(o*=1.3),l.includes("COUNT")&&(o*=.8),(l.includes("SUM")||l.includes("AVG"))&&(o*=.9);const d=this.tableParts.get(`${e.database}.${e.name}`)||[],h=Math.min(1.5,1+d.length/100);return 10+i*o*h}parseValues(t){let e=t.trim();e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,-1));const s=[];let n="",i=!1,o="";for(let l=0;l<e.length;l++){const d=e[l];(d==='"'||d==="'")&&!i?(i=!0,o=d):d===o&&i?(i=!1,o=""):d===","&&!i?(s.push(this.parseValue(n.trim())),n=""):n+=d}return n.trim()&&s.push(this.parseValue(n.trim())),s}parseValue(t){const e=t.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):/^-?\d+$/.test(e)?parseInt(e,10):/^-?\d*\.\d+$/.test(e)?parseFloat(e):e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e.toLowerCase()==="null"?null:e}normalizeTableKey(t){return t.includes(".")?t:`default.${t}`}simulatePartCreation(t){const e=this.tableParts.get(t)||[],s=new Date().toISOString().split("T")[0],n={name:`${s}_${e.length+1}`,minDate:s,maxDate:s,rows:1e3,size:512*1e3,level:0};if(e.push(n),this.tableParts.set(t,e),e.length>10){const i=e.splice(0,5),o={name:`merged_${Date.now()}`,minDate:i[0].minDate,maxDate:i[i.length-1].maxDate,rows:i.reduce((l,d)=>l+d.rows,0),size:i.reduce((l,d)=>l+d.size,0),level:Math.max(...i.map(l=>l.level))+1};e.unshift(o),this.tableParts.set(t,e)}}updateMetrics(){const t=Date.now(),e=(t-this.lastMetricsUpdate)/1e3;this.metrics.totalTables=this.tables.size;let s=0,n=0,i=0;for(const[h,f]of this.tables.entries()){s+=f.rows,n+=f.size;const m=this.tableParts.get(h)||[];i+=m.length}this.metrics.totalRows=s,this.metrics.totalSize=n,this.metrics.partsCount=i;const o=t-1e3,l=this.queryOperations.filter(h=>h.timestamp>o);if(this.metrics.queriesPerSecond=l.length,this.metrics.queryThroughput=l.length,l.length>0){const h=l.reduce((y,b)=>y+b.latency,0)/l.length;this.metrics.avgQueryTime=Math.round(h*10)/10;const f=l.reduce((y,b)=>y+b.rowsRead,0),m=l.reduce((y,b)=>y+b.rowsWritten,0);this.metrics.readRowsPerSecond=Math.round(f/e),this.metrics.writtenRowsPerSecond=Math.round(m/e)}const d=n/this.metrics.compressionRatio;this.metrics.memoryUsage=d,this.metrics.memoryUsagePercent=d/this.maxMemoryUsage*100,this.metrics.pendingMerges=Math.floor(i/10),this.metrics.clusterNodes=this.replication?3:1,this.metrics.healthyNodes=this.metrics.clusterNodes,this.lastMetricsUpdate=t}getMetrics(){return this.updateMetrics(),{...this.metrics}}insertData(t,e){const s=this.normalizeTableKey(t),n=this.tables.get(s);if(!n)return{success:!1,rowsInserted:0,error:`Table ${t} does not exist`};const i=this.tableData.get(s)||[];return i.push(...e),this.tableData.set(s,i),n.rows=i.length,n.size=i.length*512,this.tables.set(s,n),this.simulatePartCreation(s),this.updateMetrics(),{success:!0,rowsInserted:e.length}}}const uo={"X-Small":{servers:1,creditsPerHour:1},Small:{servers:2,creditsPerHour:2},Medium:{servers:4,creditsPerHour:4},Large:{servers:8,creditsPerHour:8},"X-Large":{servers:16,creditsPerHour:16},"2X-Large":{servers:32,creditsPerHour:32},"3X-Large":{servers:64,creditsPerHour:64},"4X-Large":{servers:128,creditsPerHour:128}};class KE{account="archiphoenix";region="us-east-1";warehouses=new Map;databases=new Map;tables=new Map;tableData=new Map;queries=new Map;queryQueue=[];activeQueries=new Map;resultCache=new Map;cacheHits=0;cacheMisses=0;metrics={totalWarehouses:0,runningWarehouses:0,suspendedWarehouses:0,totalQueries:0,runningQueries:0,queuedQueries:0,queriesPerSecond:0,avgQueryTime:0,totalComputeTime:0,totalDataRead:0,totalDataWritten:0,cacheHitRate:0,warehouseUtilization:0,totalCost:0};queryOperations=[];lastMetricsUpdate=Date.now();warehouseLastUpdate=new Map;suspendTimers=new Map;initialize(t){if(this.account=t.account||"archiphoenix",this.region=t.region||"us-east-1",this.warehouses.clear(),t.warehouses&&t.warehouses.length>0)for(const e of t.warehouses)this.warehouses.set(e.name,{...e,status:e.status||"suspended",currentClusterCount:e.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});else this.warehouses.set("COMPUTE_WH",{name:"COMPUTE_WH",size:"Small",status:"suspended",autoSuspend:60,autoResume:!0,minClusterCount:1,maxClusterCount:1,currentClusterCount:1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});if(this.databases.clear(),this.tables.clear(),this.tableData.clear(),t.databases){for(const e of t.databases)if(this.databases.set(e.name,{...e}),e.schemas){for(const s of e.schemas)if(s.tables)for(const n of s.tables){const i=`${e.name}.${s.name}.${n.name}`;this.tables.set(i,{...n}),this.tableData.set(i,[])}}}this.databases.has("SNOWFLAKE")||this.databases.set("SNOWFLAKE",{name:"SNOWFLAKE",comment:"System database",retentionTime:1,size:0,schemas:[{name:"INFORMATION_SCHEMA",tables:[],views:0,functions:0}]}),this.updateMetrics()}syncFromConfig(t){if(t.account&&(this.account=t.account),t.region&&(this.region=t.region),t.warehouses){for(const s of t.warehouses){const n=this.warehouses.get(s.name);n?(this.warehouses.set(s.name,{...s,status:n.status,currentClusterCount:n.currentClusterCount,runningQueries:n.runningQueries,queuedQueries:n.queuedQueries,totalQueriesExecuted:n.totalQueriesExecuted,totalComputeTime:n.totalComputeTime,lastUsed:n.lastUsed}),this.updateWarehouseAutoSuspend(s.name,s)):this.warehouses.set(s.name,{...s,status:"suspended",currentClusterCount:s.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0})}const e=new Set(t.warehouses.map(s=>s.name));for(const[s]of this.warehouses.entries())if(!e.has(s)){this.warehouses.delete(s);const n=this.suspendTimers.get(s);n&&(clearTimeout(n),this.suspendTimers.delete(s))}}if(t.databases){for(const e of t.databases)if(this.databases.get(e.name),this.databases.set(e.name,{...e}),e.schemas){for(const s of e.schemas)if(s.tables)for(const n of s.tables){const i=`${e.name}.${s.name}.${n.name}`,o=this.tables.get(i),l=this.tableData.get(i)||[];o?this.tables.set(i,{...n,rows:o.rows||l.length||0,size:o.size||l.length*512||0}):(this.tables.set(i,{...n,rows:0,size:0}),this.tableData.set(i,[]))}}}this.updateMetrics()}executeQuery(t,e,s,n){const i=Date.now(),o=`query-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l=this.getCacheKey(t,s,n),d=this.resultCache.get(l);if(d&&Date.now()-d.timestamp<d.ttl)return this.cacheHits++,this.updateMetrics(),{success:!0,latency:10,rows:d.data,rowCount:d.data.length,queryId:o,resultCacheUsed:!0};this.cacheMisses++;let h;if(e?h=this.warehouses.get(e):h=Array.from(this.warehouses.values()).find(m=>m.status==="running")||Array.from(this.warehouses.values())[0],!h)return{success:!1,error:"No warehouse available",latency:Date.now()-i,queryId:o};const f={id:o,queryText:t,status:"queued",warehouse:h.name,database:s,schema:n,startedAt:i};return this.queries.set(o,f),h.status==="suspended"&&h.autoResume&&this.resumeWarehouse(h.name),h.status==="running"?this.executeQueryOnWarehouse(f,h,i):(h.queuedQueries++,this.queryQueue.push(f),f.status="queued",h.autoResume&&this.resumeWarehouse(h.name),h.status==="running"&&this.processQueryQueue(h),{success:!0,latency:50,queryId:o,warehouse:h.name})}executeQueryOnWarehouse(t,e,s){t.status="running",t.startedAt=Date.now(),e.runningQueries++,this.activeQueries.set(t.id,t),1/(uo[e.size]||uo.Small).servers,this.estimateQueryComplexity(t.queryText);const i=this.executeSQL(t.queryText,t.database,t.schema),o=Date.now();if(t.completedAt=o,t.duration=o-(t.startedAt||s),t.status=i.success?"success":"failed",t.rowsReturned=i.rowCount,t.error=i.error,e.runningQueries--,e.totalQueriesExecuted++,e.totalComputeTime+=t.duration/1e3,e.lastUsed=o,this.activeQueries.delete(t.id),i.success&&i.rows){const l=this.getCacheKey(t.queryText,t.database,t.schema);this.resultCache.set(l,{data:i.rows,timestamp:o,ttl:3e5})}return this.queryOperations.push({timestamp:o,latency:t.duration,rowsRead:i.dataRead||0,rowsWritten:i.dataWritten||0}),e.autoSuspend&&e.runningQueries===0&&e.queuedQueries===0&&this.scheduleWarehouseSuspend(e.name,e.autoSuspend),this.updateMetrics(),{...i,queryId:t.id,warehouse:e.name,latency:t.duration}}executeSQL(t,e,s){const n=t.trim().replace(/\s+/g," "),i=n.toUpperCase();try{return i.startsWith("SELECT")?this.executeSelect(n,e,s):i.startsWith("INSERT")?this.executeInsert(n,e,s):i.startsWith("UPDATE")?this.executeUpdate(n,e,s):i.startsWith("DELETE")?this.executeDelete(n,e,s):i.startsWith("CREATE TABLE")?this.executeCreateTable(n,e,s):i.startsWith("DROP TABLE")?this.executeDropTable(n,e,s):{success:!1,error:`Unsupported SQL statement: ${n}`}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}executeSelect(t,e,s){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s),l=this.tables.get(o);if(!l)return{success:!1,error:`Table ${i} does not exist`};const d=this.tableData.get(o)||[],h=t.match(/SELECT\s+(.+?)\s+FROM/i),f=h?h[1].trim().split(",").map(C=>C.trim()):["*"];let m=[...d];const y=t.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(y){const S=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(S){const R=S[1],M=S[2];m=d.filter(T=>String(T[R])===M)}}const b=t.match(/LIMIT\s+(\d+)/i);if(b){const C=parseInt(b[1],10);m=m.slice(0,C)}return{success:!0,rows:m,rowCount:m.length,columns:f.includes("*")?l.columns?.map(C=>C.name)||[]:f,dataRead:d.length}}executeInsert(t,e,s){const n=t.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s),l=this.tables.get(o);if(!l)return{success:!1,error:`Table ${i} does not exist`};const d=t.match(/VALUES\s*\((.+?)\)/i);if(!d)return{success:!1,error:"Invalid INSERT query: missing VALUES clause"};const h=d[1].split(",").map(b=>b.trim().replace(/^['"]|['"]$/g,"")),f=l.columns||[];if(h.length!==f.length)return{success:!1,error:`Column count mismatch: expected ${f.length}, got ${h.length}`};const m={};f.forEach((b,C)=>{m[b.name]=h[C]});const y=this.tableData.get(o)||[];return y.push(m),this.tableData.set(o,y),l.rows=y.length,l.size=y.length*512,{success:!0,rowCount:1,dataWritten:1}}executeUpdate(t,e,s){return{success:!0,rowCount:0,dataWritten:0}}executeDelete(t,e,s){return{success:!0,rowCount:0,dataWritten:0}}executeCreateTable(t,e,s){const n=t.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s);if(this.tables.has(o))return{success:!1,error:`Table ${i} already exists`};const l=t.match(/\((.+?)\)/),d=[];if(l){const b=l[1].split(",").map(C=>C.trim());for(const C of b){const S=C.split(/\s+/);S.length>=2&&d.push({name:S[0],type:S[1],nullable:!C.toUpperCase().includes("NOT NULL")})}}const[h,f,m]=this.parseTableName(i,e,s),y={name:m,schema:f,database:h,columns:d,rows:0,size:0,created:Date.now()};return this.tables.set(o,y),this.tableData.set(o,[]),{success:!0,rowCount:0}}executeDropTable(t,e,s){const n=t.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s);return this.tables.has(o)?(this.tables.delete(o),this.tableData.delete(o),{success:!0,rowCount:0}):{success:!1,error:`Table ${i} does not exist`}}resumeWarehouse(t){const e=this.warehouses.get(t);if(!e)return!1;if(e.status==="running")return!0;const s=this.suspendTimers.get(t);return s&&(clearTimeout(s),this.suspendTimers.delete(t)),e.status="running",e.currentClusterCount=e.minClusterCount,this.processQueryQueue(e),this.updateMetrics(),!0}suspendWarehouse(t){const e=this.warehouses.get(t);return e?e.status==="suspended"?!0:e.runningQueries>0?!1:(e.status="suspended",e.currentClusterCount=0,this.updateMetrics(),!0):!1}scheduleWarehouseSuspend(t,e){const s=this.suspendTimers.get(t);s&&clearTimeout(s);const n=setTimeout(()=>{const i=this.warehouses.get(t);i&&i.runningQueries===0&&i.queuedQueries===0&&this.suspendWarehouse(t),this.suspendTimers.delete(t)},e*1e3);this.suspendTimers.set(t,n)}updateWarehouseAutoSuspend(t,e){const s=this.warehouses.get(t);if(s){if(e.autoSuspend!==void 0||e.autoResume!==void 0){const n=this.suspendTimers.get(t);n&&(clearTimeout(n),this.suspendTimers.delete(t))}s.status==="running"&&s.autoSuspend&&s.runningQueries===0&&s.queuedQueries===0&&this.scheduleWarehouseSuspend(t,s.autoSuspend)}}processQueryQueue(t){if(t.status!=="running")return;const e=this.queryQueue.filter(s=>s.warehouse===t.name&&s.status==="queued");for(const s of e)t.runningQueries<this.getMaxConcurrentQueries(t)&&(t.queuedQueries--,this.queryQueue=this.queryQueue.filter(n=>n.id!==s.id),this.executeQueryOnWarehouse(s,t,s.startedAt||Date.now()))}getMaxConcurrentQueries(t){return(uo[t.size]||uo.Small).servers*t.currentClusterCount*8}estimateQueryComplexity(t){let e=1;const s=(t.match(/\bJOIN\b/gi)||[]).length;e+=s*.5,t.match(/\bGROUP\s+BY\b/i)&&(e+=.3),t.match(/\bORDER\s+BY\b/i)&&(e+=.2);const n=(t.match(/\b(COUNT|SUM|AVG|MAX|MIN)\s*\(/gi)||[]).length;return e+=n*.2,Math.max(1,e)}normalizeTableKey(t,e,s){const n=t.split(".");return n.length===3?n.join("."):n.length===2?`${e||"PUBLIC"}.${n.join(".")}`:`${e||"PUBLIC"}.${s||"PUBLIC"}.${n[0]}`}parseTableName(t,e,s){const n=t.split(".");return n.length===3?[n[0],n[1],n[2]]:n.length===2?[e||"PUBLIC",n[0],n[1]]:[e||"PUBLIC",s||"PUBLIC",n[0]]}getCacheKey(t,e,s){return`${t}|${e||""}|${s||""}`}updateMetrics(){const t=Date.now(),e=(t-this.lastMetricsUpdate)/1e3;if(this.metrics.totalWarehouses=this.warehouses.size,this.metrics.runningWarehouses=Array.from(this.warehouses.values()).filter(l=>l.status==="running").length,this.metrics.suspendedWarehouses=Array.from(this.warehouses.values()).filter(l=>l.status==="suspended").length,this.metrics.totalQueries=this.queries.size,this.metrics.runningQueries=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.runningQueries,0),this.metrics.queuedQueries=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.queuedQueries,0),e>0){const l=this.queryOperations.filter(d=>d.timestamp>t-1e3);this.metrics.queriesPerSecond=l.length}if(this.queryOperations.length>0){const l=this.queryOperations.slice(-100),d=l.reduce((h,f)=>h+f.latency,0)/l.length;this.metrics.avgQueryTime=d}this.metrics.totalComputeTime=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.totalComputeTime,0);const s=this.queryOperations.slice(-1e3);this.metrics.totalDataRead=s.reduce((l,d)=>l+d.rowsRead,0),this.metrics.totalDataWritten=s.reduce((l,d)=>l+d.rowsWritten,0);const n=this.cacheHits+this.cacheMisses;this.metrics.cacheHitRate=n>0?this.cacheHits/n:0;let i=0;for(const l of this.warehouses.values())if(l.status==="running"){const d=this.getMaxConcurrentQueries(l),h=d>0?l.runningQueries/d:0;i+=h}this.metrics.warehouseUtilization=this.metrics.runningWarehouses>0?i/this.metrics.runningWarehouses:0;let o=0;for(const l of this.warehouses.values())if(l.status==="running"&&l.totalComputeTime>0){const d=uo[l.size]||uo.Small,h=l.totalComputeTime/3600;o+=d.creditsPerHour*h*l.currentClusterCount}this.metrics.totalCost=o,this.lastMetricsUpdate=t}getMetrics(){return this.updateMetrics(),{...this.metrics}}getWarehouse(t){return this.warehouses.get(t)}getWarehouses(){return Array.from(this.warehouses.values())}getQuery(t){return this.queries.get(t)}getRecentQueries(t=100){return Array.from(this.queries.values()).sort((e,s)=>(s.startedAt||0)-(e.startedAt||0)).slice(0,t)}getTables(t,e){return!t&&!e?Array.from(this.tables.values()):Array.from(this.tables.values()).filter(s=>!(t&&s.database!==t||e&&s.schema!==e))}}class YE{clusterName="archiphoenix-cluster";nodes=new Map;indices=new Map;shards=new Map;documents=new Map;defaultShards=5;defaultReplicas=1;refreshInterval="1s";metrics={clusterHealth:"green",totalNodes:0,healthyNodes:0,totalIndices:0,totalDocs:0,totalSize:0,activeShards:0,relocatingShards:0,initializingShards:0,unassignedShards:0,indexOperationsPerSecond:0,searchOperationsPerSecond:0,averageIndexLatency:5,averageSearchLatency:10,averageGetLatency:2};indexOperations=[];searchOperations=[];getOperations=[];lastMetricsUpdate=Date.now();recentQueries=[];initialize(t){if(this.clusterName=t.clusterName||"archiphoenix-cluster",this.defaultShards=t.defaultShards||5,this.defaultReplicas=t.defaultReplicas||1,this.refreshInterval=t.refreshInterval||"1s",this.nodes.clear(),t.nodes&&t.nodes.length>0)for(const e of t.nodes)this.nodes.set(e,{address:e,status:"up",load:.3+Math.random()*.4,shards:0});else this.nodes.set("localhost:9200",{address:"localhost:9200",status:"up",load:.5,shards:0});if(this.indices.clear(),this.shards.clear(),this.documents.clear(),t.indices&&t.indices.length>0)for(const e of t.indices)this.createIndex(e.name,e.shards||this.defaultShards,e.replicas||this.defaultReplicas,e);else this.createIndex("archiphoenix-index",this.defaultShards,this.defaultReplicas);this.updateMetrics()}syncFromConfig(t){if(t.clusterName&&(this.clusterName=t.clusterName),t.defaultShards!==void 0&&(this.defaultShards=t.defaultShards),t.defaultReplicas!==void 0&&(this.defaultReplicas=t.defaultReplicas),t.refreshInterval&&(this.refreshInterval=t.refreshInterval),t.nodes){new Set(this.nodes.keys());for(const e of t.nodes)this.nodes.has(e)||this.nodes.set(e,{address:e,status:"up",load:.3+Math.random()*.4,shards:0})}if(t.indices){new Set(this.indices.keys());for(const e of t.indices)if(!this.indices.has(e.name))this.createIndex(e.name,e.shards||this.defaultShards,e.replicas||this.defaultReplicas,e);else{const s=this.indices.get(e.name),n=this.getTotalDocsForIndex(e.name),i=this.getTotalSizeForIndex(e.name);this.indices.set(e.name,{...e,docs:s.docs||n,size:s.size||i,health:this.calculateIndexHealth(e.name)})}}this.updateMetrics()}createIndex(t,e=5,s=1,n){const i={name:t,docs:n?.docs||0,size:n?.size||0,shards:e,replicas:s,health:"yellow",mappings:n?.mappings,settings:n?.settings};this.indices.set(t,i);const o=[],l=Array.from(this.nodes.keys());for(let d=0;d<e;d++){const h=l[d%l.length];o.push({index:t,shard:d,primary:!0,node:h,state:"STARTED",docs:0,size:0});for(let f=0;f<s;f++){const m=l[(d+f+1)%l.length];o.push({index:t,shard:d,primary:!1,node:m,state:"STARTED",docs:0,size:0})}}if(this.shards.set(t,o),!this.documents.has(t)){const d=new Map;for(let h=0;h<e;h++)d.set(h,[]);this.documents.set(t,d)}i.health=this.calculateIndexHealth(t),this.updateMetrics()}routeToShard(t,e){const s=this.indices.get(t);if(!s)return 0;let n=0;for(let i=0;i<e.length;i++){const o=e.charCodeAt(i);n=(n<<5)-n+o,n=n&n}return Math.abs(n)%s.shards}indexDocument(t,e,s,n){const i=Date.now(),o=this.indices.get(t);if(!o)return{operation:"index",index:t,id:e,document:s,routing:n,latency:Date.now()-i,success:!1,error:`Index ${t} does not exist`};const l=n||e,d=this.routeToShard(t,l),h={_id:e,_index:t,_source:s,_routing:n},f=this.documents.get(t),m=f.get(d)||[],y=m.findIndex(S=>S._id===e);y>=0?m[y]=h:m.push(h),f.set(d,m),this.documents.set(t,f),o.docs=this.getTotalDocsForIndex(t),o.size=this.getTotalSizeForIndex(t),o.health=this.calculateIndexHealth(t);const b=this.shards.get(t);for(const S of b)S.index===t&&S.shard===d&&S.primary&&(S.docs=m.length,S.size=m.length*1024);const C=this.calculateIndexLatency();return this.recordIndexOperation(C),this.updateMetrics(),{operation:"index",index:t,id:e,document:s,routing:n,latency:C,success:!0,took:C}}getDocument(t,e,s){const n=Date.now();if(!this.indices.get(t))return{operation:"get",index:t,id:e,routing:s,latency:Date.now()-n,success:!1,error:`Index ${t} does not exist`};const o=s||e,l=this.routeToShard(t,o),f=(this.documents.get(t).get(l)||[]).find(y=>y._id===e),m=this.calculateGetLatency();return this.recordGetOperation(m),this.updateMetrics(),f?{operation:"get",index:t,id:e,document:f._source,routing:s,latency:m,success:!0,took:m}:{operation:"get",index:t,id:e,routing:s,latency:m,success:!1,error:`Document ${e} not found`,took:m}}search(t,e){const s=Date.now(),n=this.indices.get(t);if(!n)return{operation:"search",index:t,query:e,latency:Date.now()-s,success:!1,error:`Index ${t} does not exist`};const i=this.documents.get(t);let o=[];for(let m=0;m<n.shards;m++){const y=i.get(m)||[];o=o.concat(y)}let l=o;if(e&&e.query){if(e.query.match_all)l=o;else if(e.query.match){const m=Object.keys(e.query.match)[0],y=e.query.match[m];y&&typeof y=="string"&&(l=o.filter(b=>{const C=b._source[m];return C&&String(C).toLowerCase().includes(y.toLowerCase())}))}}const d=e?.size||10;l=l.slice(0,d);const h=this.calculateSearchLatency(n.shards,l.length);this.recordSearchOperation(h,l.length),this.updateMetrics();const f={operation:"search",index:t,query:e,latency:h,success:!0,hits:l.length,took:h};return this.recentQueries.unshift(f),this.recentQueries.length>100&&(this.recentQueries=this.recentQueries.slice(0,100)),f}deleteDocument(t,e,s){const n=Date.now(),i=this.indices.get(t);if(!i)return{operation:"delete",index:t,id:e,routing:s,latency:Date.now()-n,success:!1,error:`Index ${t} does not exist`};const o=s||e,l=this.routeToShard(t,o),d=this.documents.get(t),h=d.get(l)||[],f=h.length,m=h.filter(C=>C._id!==e);d.set(l,m),this.documents.set(t,d),i.docs=this.getTotalDocsForIndex(t),i.size=this.getTotalSizeForIndex(t),i.health=this.calculateIndexHealth(t);const y=this.shards.get(t);for(const C of y)C.index===t&&C.shard===l&&C.primary&&(C.docs=m.length,C.size=m.length*1024);const b=this.calculateIndexLatency();return this.updateMetrics(),m.length===f?{operation:"delete",index:t,id:e,routing:s,latency:b,success:!1,error:`Document ${e} not found`,took:b}:{operation:"delete",index:t,id:e,routing:s,latency:b,success:!0,took:b}}executeQuery(t){const e=Date.now();try{let s;try{s=JSON.parse(t)}catch{const n=t.split(`
`);if(n.length>=2){const i=n[0].match(/^(GET|POST|PUT|DELETE)\s+(.+)/);if(i){const o=i[1],l=i[2].trim();if(o==="GET"&&l.includes("/_search")){s=n.length>1?JSON.parse(n.slice(1).join(`
`)):{query:{match_all:{}}};const d=l.match(/^\/([^\/]+)\/_search/),h=d?d[1]:"_all";return this.search(h,s)}else if(o==="GET"&&l.match(/\/[^\/]+\/_doc\/[^\/]+/)){const d=l.match(/\/([^\/]+)\/_doc\/([^\/]+)/);if(d)return this.getDocument(d[1],d[2])}}}return{operation:"search",query:t,latency:Date.now()-e,success:!1,error:"Invalid query format"}}return s.query||s.match_all?this.search("_all",s):{operation:"search",query:t,latency:Date.now()-e,success:!1,error:"Unsupported query format"}}catch(s){return{operation:"search",query:t,latency:Date.now()-e,success:!1,error:s instanceof Error?s.message:"Unknown error"}}}getMetrics(){return this.updateMetrics(),{...this.metrics}}getIndices(){return Array.from(this.indices.values())}getShards(t){return this.shards.get(t)||[]}getRecentQueries(t=10){return this.recentQueries.slice(0,t)}calculateIndexHealth(t){const e=this.shards.get(t)||[],s=e.filter(o=>o.state==="UNASSIGNED").length,n=e.filter(o=>o.state==="INITIALIZING").length,i=e.filter(o=>o.state==="RELOCATING").length;return s>0?"red":n>0||i>0?"yellow":"green"}calculateClusterHealth(){let t=!1,e=!1;for(const i of this.indices.values())i.health==="red"?t=!0:i.health==="yellow"&&(e=!0);const s=Array.from(this.nodes.values()).filter(i=>i.status==="up").length,n=this.nodes.size;return s===0||t?"red":s<n||e?"yellow":"green"}getTotalDocsForIndex(t){const e=this.documents.get(t);if(!e)return 0;let s=0;for(const n of e.values())s+=n.length;return s}getTotalSizeForIndex(t){const e=this.documents.get(t);if(!e)return 0;let s=0;for(const n of e.values())s+=n.length*1024;return s}calculateIndexLatency(){const e=this.metrics.totalDocs;return 5+Math.min(20,e/1e4)+Math.random()*5}calculateSearchLatency(t,e){const n=t*2,i=Math.min(50,e/100);return 10+n+i+Math.random()*10}calculateGetLatency(){return 2+Math.random()*3}recordIndexOperation(t){this.indexOperations.push({timestamp:Date.now(),latency:t}),this.indexOperations.length>500&&(this.indexOperations=this.indexOperations.slice(-500))}recordSearchOperation(t,e){this.searchOperations.push({timestamp:Date.now(),latency:t,hits:e}),this.searchOperations.length>500&&(this.searchOperations=this.searchOperations.slice(-500))}recordGetOperation(t){this.getOperations.push({timestamp:Date.now(),latency:t}),this.getOperations.length>500&&(this.getOperations=this.getOperations.slice(-500))}updateMetrics(){const t=Date.now(),e=1e3,s=this.indexOperations.filter(f=>t-f.timestamp<e),n=this.searchOperations.filter(f=>t-f.timestamp<e),i=this.getOperations.filter(f=>t-f.timestamp<e);this.metrics.indexOperationsPerSecond=s.length,this.metrics.searchOperationsPerSecond=n.length,s.length>0&&(this.metrics.averageIndexLatency=s.reduce((f,m)=>f+m.latency,0)/s.length),n.length>0&&(this.metrics.averageSearchLatency=n.reduce((f,m)=>f+m.latency,0)/n.length),i.length>0&&(this.metrics.averageGetLatency=i.reduce((f,m)=>f+m.latency,0)/i.length),this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(f=>f.status==="up").length,this.metrics.totalIndices=this.indices.size,this.metrics.totalDocs=Array.from(this.indices.values()).reduce((f,m)=>f+m.docs,0),this.metrics.totalSize=Array.from(this.indices.values()).reduce((f,m)=>f+m.size,0);let o=0,l=0,d=0,h=0;for(const f of this.shards.values())for(const m of f)if(m.primary)switch(m.state){case"STARTED":o++;break;case"RELOCATING":l++;break;case"INITIALIZING":d++;break;case"UNASSIGNED":h++;break}this.metrics.activeShards=o,this.metrics.relocatingShards=l,this.metrics.initializingShards=d,this.metrics.unassignedShards=h,this.metrics.clusterHealth=this.calculateClusterHealth();for(const f of this.indices.values())f.health=this.calculateIndexHealth(f.name);this.lastMetricsUpdate=t}}class WE{buckets=new Map;objects=new Map;versions=new Map;operations=[];metrics=new Map;lifecycleTransitions=new Map;initialize(t){if(this.buckets.clear(),this.objects.clear(),this.versions.clear(),this.operations=[],this.metrics.clear(),this.lifecycleTransitions.clear(),t.buckets)for(const e of t.buckets)this.buckets.set(e.name,{...e}),this.objects.set(e.name,new Map),e.versioning&&this.versions.set(e.name,new Map),this.metrics.set(e.name,{bucket:e.name,objectCount:0,totalSize:0,versionsCount:0,putCount:0,getCount:0,deleteCount:0,listCount:0,errorCount:0,averageLatency:0}),this.lifecycleTransitions.set(e.name,new Map)}putObject(t,e,s,n,i,o){const l=Date.now(),d=this.buckets.get(t);if(!d)return{success:!1,etag:"",latency:Date.now()-l,error:`Bucket '${t}' does not exist`};const h=this.generateETag(e,n),f=d.versioning?`${Date.now()}-${Math.random().toString(36).substr(2,9)}`:void 0,m={key:e,bucket:t,size:n,lastModified:Date.now(),storageClass:"STANDARD",etag:h,contentType:o||"application/octet-stream",metadata:i||{},versionId:f,encryption:d.encryption},y=this.objects.get(t);if(d.versioning&&f){const M=this.versions.get(t),T=M.get(e)||[];T.push({versionId:f,object:m,isDeleteMarker:!1}),M.set(e,T),this.versions.set(t,M);const E=this.metrics.get(t);E.versionsCount=this.getTotalVersionsCount(t)}y.set(e,m),this.objects.set(t,y);const b=this.findMatchingLifecycleRule(d,e);if(b&&b.transitions&&b.transitions.length>0){const M=this.lifecycleTransitions.get(t),T=b.transitions[0],E=Date.now()+T.days*24*60*60*1e3;M.set(e,{currentClass:"STANDARD",transitionScheduled:E,targetClass:T.storageClass,ruleId:b.id,transitionIndex:0,allTransitions:b.transitions}),this.lifecycleTransitions.set(t,M)}else if(d.lifecycleEnabled&&d.lifecycleDays){const M=this.lifecycleTransitions.get(t),T=Date.now()+d.lifecycleDays*24*60*60*1e3;M.set(e,{currentClass:"STANDARD",transitionScheduled:T,targetClass:d.glacierEnabled?"GLACIER":"STANDARD_IA"}),this.lifecycleTransitions.set(t,M)}const C=this.metrics.get(t),S=y.get(e);S?C.totalSize-=S.size:C.objectCount++,C.totalSize+=n,C.putCount++;const R=this.calculatePutLatency(n);return this.recordOperation("PUT",t,e,!0,R),this.updateMetrics(t,R,!0),{success:!0,versionId:f,etag:h,latency:R}}getObject(t,e,s){const n=Date.now(),i=this.buckets.get(t);if(!i)return{success:!1,latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t);if(i.versioning&&s){const m=(this.versions.get(t).get(e)||[]).find(b=>b.versionId===s);if(!m||m.isDeleteMarker){const b=this.calculateGetLatency(0);return this.recordOperation("GET",t,e,!1,b),this.updateMetrics(t,b,!1),{success:!1,latency:b,error:m?.isDeleteMarker?"Object version is a delete marker":`Object version '${s}' not found`}}if(m.object.storageClass==="GLACIER"||m.object.storageClass==="DEEP_ARCHIVE"){const b=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",t,e,!1,b),this.updateMetrics(t,b,!1),{success:!1,latency:b,error:`Object is archived in ${m.object.storageClass}. Restore operation required.`}}const y=this.calculateGetLatency(m.object.size);return this.recordOperation("GET",t,e,!0,y),this.updateMetrics(t,y,!0),{success:!0,object:m.object,latency:y}}const l=o.get(e);if(!l){const h=this.calculateGetLatency(0);return this.recordOperation("GET",t,e,!1,h),this.updateMetrics(t,h,!1),{success:!1,latency:h,error:`Object '${e}' not found`}}if(l.storageClass==="GLACIER"||l.storageClass==="DEEP_ARCHIVE"){const h=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",t,e,!1,h),this.updateMetrics(t,h,!1),{success:!1,latency:h,error:`Object is archived in ${l.storageClass}. Restore operation required.`}}const d=this.calculateGetLatency(l.size);return this.recordOperation("GET",t,e,!0,d),this.updateMetrics(t,d,!0),{success:!0,object:l,latency:d}}deleteObject(t,e,s){const n=Date.now(),i=this.buckets.get(t);if(!i)return{success:!1,latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t),l=o.get(e);if(!l){const m=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!1,m),this.updateMetrics(t,m,!1),{success:!1,latency:m,error:`Object '${e}' not found`}}if(i.versioning){const m=this.versions.get(t),y=m.get(e)||[],b=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;y.push({versionId:b,object:{...l},isDeleteMarker:!0}),m.set(e,y),this.versions.set(t,m),o.delete(e),this.objects.set(t,o);const C=this.metrics.get(t);C.versionsCount=this.getTotalVersionsCount(t),C.deleteCount++;const S=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!0,S),this.updateMetrics(t,S,!0),{success:!0,deleteMarker:!0,latency:S}}const d=l.size;o.delete(e),this.objects.set(t,o);const h=this.metrics.get(t);h.objectCount--,h.totalSize-=d,h.deleteCount++;const f=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!0,f),this.updateMetrics(t,f,!0),{success:!0,latency:f}}listObjects(t,e,s){const n=Date.now();if(!this.buckets.get(t))return{success:!1,objects:[],latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t);let l=Array.from(o.values());e&&(l=l.filter(f=>f.key.startsWith(e))),l.sort((f,m)=>f.key.localeCompare(m.key)),s&&(l=l.slice(0,s));const d=this.calculateListLatency(l.length);this.recordOperation("LIST",t,void 0,!0,d);const h=this.metrics.get(t);return h.listCount++,this.updateMetrics(t,d,!0),{success:!0,objects:l,latency:d}}headObject(t,e){const s=Date.now();if(!this.buckets.get(t))return{success:!1,latency:Date.now()-s,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t).get(e);if(!o){const d=this.calculateHeadLatency();return this.recordOperation("HEAD",t,e,!1,d),this.updateMetrics(t,d,!1),{success:!1,latency:d,error:`Object '${e}' not found`}}const l=this.calculateHeadLatency();return this.recordOperation("HEAD",t,e,!0,l),this.updateMetrics(t,l,!0),{success:!0,object:o,latency:l}}processLifecycleTransitions(t=Date.now()){for(const[e,s]of this.lifecycleTransitions.entries()){const n=this.buckets.get(e);if(!(n&&(n.lifecycleEnabled||n.lifecycleRules&&n.lifecycleRules.some(l=>l.status==="Enabled"))))continue;const o=this.objects.get(e);for(const[l,d]of s.entries())if(t>=d.transitionScheduled){const h=o.get(l);if(h&&h.storageClass===d.currentClass)if(h.storageClass=d.targetClass,o.set(l,h),this.objects.set(e,o),d.ruleId&&d.allTransitions&&d.transitionIndex!==void 0){const f=d.transitionIndex+1;if(f<d.allTransitions.length){const m=d.allTransitions[f],y=t+m.days*24*60*60*1e3;s.set(l,{currentClass:d.targetClass,transitionScheduled:y,targetClass:m.storageClass,ruleId:d.ruleId,transitionIndex:f,allTransitions:d.allTransitions})}else{const m=this.findLifecycleRuleById(n,d.ruleId);if(m?.expiration?.days){const y=t+m.expiration.days*24*60*60*1e3;s.set(l,{currentClass:d.targetClass,transitionScheduled:y,targetClass:d.targetClass,ruleId:d.ruleId,expiration:!0})}else s.delete(l)}}else if(n.glacierEnabled&&n.glacierDays&&d.targetClass==="STANDARD_IA"){const f=t+n.glacierDays*24*60*60*1e3;s.set(l,{currentClass:"STANDARD_IA",transitionScheduled:f,targetClass:"GLACIER"})}else s.delete(l);else h||s.delete(l)}this.lifecycleTransitions.set(e,s)}this.processExpirations(t)}processExpirations(t){for(const[e,s]of this.lifecycleTransitions.entries()){if(!this.buckets.get(e))continue;const i=this.objects.get(e),o=[];for(const[l,d]of s.entries())d.expiration&&t>=d.transitionScheduled&&i.has(l)&&o.push(l);for(const l of o){const d=i.get(l);if(d){const h=this.metrics.get(e);h&&(h.objectCount=Math.max(0,h.objectCount-1),h.totalSize=Math.max(0,h.totalSize-d.size))}i.delete(l),s.delete(l)}this.objects.set(e,i),this.lifecycleTransitions.set(e,s)}}findMatchingLifecycleRule(t,e){return!t.lifecycleRules||t.lifecycleRules.length===0?void 0:t.lifecycleRules.filter(n=>n.status==="Enabled").filter(n=>!n.prefix||e.startsWith(n.prefix)).sort((n,i)=>{const o=n.prefix||"";return(i.prefix||"").length-o.length})[0]}findLifecycleRuleById(t,e){if(t.lifecycleRules)return t.lifecycleRules.find(s=>s.id===e)}findLifecycleRuleById(t,e){if(t.lifecycleRules)return t.lifecycleRules.find(s=>s.id===e)}getBucketMetrics(t){return this.metrics.get(t)}getAllBucketMetrics(){return new Map(this.metrics)}getTotalStorageSize(){let t=0;for(const e of this.metrics.values())t+=e.totalSize;return t}getTotalObjectCount(){let t=0;for(const e of this.metrics.values())t+=e.objectCount;return t}generateETag(t,e){const s=`${t}_${e}_${Date.now()}`;let n=0;for(let i=0;i<s.length;i++){const o=s.charCodeAt(i);n=(n<<5)-n+o,n=n&n}return Math.abs(n).toString(16)}calculatePutLatency(t){const s=t/1024*.1,n=(Math.random()-.5)*10;return Math.max(10,50+s+n)}calculateGetLatency(t){const s=t/1024*.15,n=(Math.random()-.5)*10;return Math.max(10,30+s+n)}calculateDeleteLatency(){const e=(Math.random()-.5)*5;return Math.max(5,20+e)}calculateListLatency(t){const s=t*.01,n=(Math.random()-.5)*10;return Math.max(20,40+s+n)}calculateHeadLatency(){const e=(Math.random()-.5)*5;return Math.max(5,15+e)}calculateGlacierRestoreLatency(){return 5e3}recordOperation(t,e,s,n,i){this.operations.push({operation:t,bucket:e,key:s,success:n,latency:i,timestamp:Date.now()}),this.operations.length>1e3&&this.operations.shift()}updateMetrics(t,e,s){const n=this.metrics.get(t);if(!n)return;const i=n.putCount+n.getCount+n.deleteCount+n.listCount;i>0?n.averageLatency=(n.averageLatency*(i-1)+e)/i:n.averageLatency=e,s||n.errorCount++,n.lastOperation=Date.now()}getTotalVersionsCount(t){const e=this.versions.get(t);if(!e)return 0;let s=0;for(const n of e.values())s+=n.length;return s}}class XE{connections=new Map;config;connectionCounter=0;queryHistory=[];MAX_HISTORY=1e3;constructor(t){this.config={maxConnections:t.maxConnections||100,minConnections:t.minConnections||0,idleTimeout:t.idleTimeout||3e5,maxLifetime:t.maxLifetime||36e5,connectionTimeout:t.connectionTimeout||5e3}}acquireConnection(t){const e=Date.now();this.cleanupIdleConnections(e);for(const[s,n]of this.connections.entries())if(n.status==="idle")return n.status="active",n.lastActivity=e,n.currentQuery=t,n.queryCount++,s;return this.connections.size<this.config.maxConnections?this.createConnection(t,e):null}releaseConnection(t,e){const s=this.connections.get(t);s&&(s.status="idle",s.lastActivity=Date.now(),s.currentQuery=void 0,e!==void 0&&this.recordQuery(e))}terminateConnection(t){const e=this.connections.get(t);e&&(e.status="terminated",this.connections.delete(t))}createConnection(t,e){const s=`conn_${++this.connectionCounter}_${e}`,n={id:s,status:"active",createdAt:e,lastActivity:e,queryCount:1,currentQuery:t};return this.connections.set(s,n),s}cleanupIdleConnections(t){const e=[];for(const[s,n]of this.connections.entries())n.status==="idle"&&(t-n.lastActivity>this.config.idleTimeout||t-n.createdAt>this.config.maxLifetime)&&e.push(s);for(const s of e)this.connections.delete(s)}recordQuery(t){const e=Date.now();this.queryHistory.push({timestamp:e,duration:t}),this.queryHistory.length>this.MAX_HISTORY&&this.queryHistory.shift()}getMetrics(){const t=Date.now();let e=0,s=0,n=0;for(const y of this.connections.values())switch(y.status){case"active":e++;break;case"idle":s++;break;case"waiting":n++;break}const i=this.connections.size,o=i>0?e/this.config.maxConnections:0,l=this.queryHistory.filter(y=>t-y.timestamp<6e4),d=l.length>0?l.reduce((y,b)=>y+b.duration,0)/l.length:0,f=this.queryHistory.filter(y=>t-y.timestamp<1e3).length,m=i>=this.config.maxConnections?this.config.connectionTimeout/2:0;return{totalConnections:i,activeConnections:e,idleConnections:s,waitingConnections:n,utilization:o,averageQueryTime:d,queriesPerSecond:f,connectionWaitTime:m}}getConnection(t){return this.connections.get(t)}getAllConnections(){return Array.from(this.connections.values())}updateConfig(t){if(this.config={...this.config,...t},t.maxConnections!==void 0&&t.maxConnections<this.connections.size){const e=this.connections.size-t.maxConnections,s=Array.from(this.connections.entries()).filter(([n,i])=>i.status==="idle").slice(0,e);for(const[n]of s)this.terminateConnection(n)}}reset(){this.connections.clear(),this.connectionCounter=0,this.queryHistory=[]}}class JE{static exportMetrics(t,e){const s=[],n=this.buildLabels(t,e),i=e.timestamp||Date.now();if(s.push("# HELP component_throughput_total Component throughput in operations per second"),s.push("# TYPE component_throughput_total gauge"),s.push(`component_throughput_total{${n}} ${e.throughput||0} ${i}`),s.push("# HELP component_latency_ms Component latency in milliseconds"),s.push("# TYPE component_latency_ms gauge"),s.push(`component_latency_ms{${n}} ${e.latency||0} ${i}`),e.latencyP50!==void 0&&(s.push("# HELP component_latency_p50_ms Component 50th percentile latency in milliseconds"),s.push("# TYPE component_latency_p50_ms gauge"),s.push(`component_latency_p50_ms{${n}} ${e.latencyP50} ${i}`)),e.latencyP99!==void 0&&(s.push("# HELP component_latency_p99_ms Component 99th percentile latency in milliseconds"),s.push("# TYPE component_latency_p99_ms gauge"),s.push(`component_latency_p99_ms{${n}} ${e.latencyP99} ${i}`)),s.push("# HELP component_error_rate Component error rate (0-1)"),s.push("# TYPE component_error_rate gauge"),s.push(`component_error_rate{${n}} ${e.errorRate||0} ${i}`),s.push("# HELP component_utilization Component utilization (0-1)"),s.push("# TYPE component_utilization gauge"),s.push(`component_utilization{${n}} ${e.utilization||0} ${i}`),e.customMetrics)for(const[o,l]of Object.entries(e.customMetrics)){const d=this.sanitizeMetricName(o);s.push(`# HELP component_${d} Component custom metric: ${o}`),s.push(`# TYPE component_${d} gauge`),s.push(`component_${d}{${n}} ${l} ${i}`)}return s.join(`
`)+`
`}static buildLabels(t,e){const s=[];s.push(`component_id="${this.escapeLabelValue(t.id)}"`),s.push(`component_type="${this.escapeLabelValue(t.type)}"`),t.data.label&&s.push(`component_name="${this.escapeLabelValue(t.data.label)}"`);const n=t.data.config||{};return n.environment&&s.push(`environment="${this.escapeLabelValue(String(n.environment))}"`),n.namespace&&s.push(`namespace="${this.escapeLabelValue(String(n.namespace))}"`),s.join(",")}static escapeLabelValue(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}static sanitizeMetricName(t){return t.replace(/[^a-zA-Z0-9_:]/g,"_").replace(/^[^a-zA-Z]/,"_")}static exportAllMetrics(t,e){const s=[];for(const n of t){const i=e.get(n.id);i&&s.push(this.exportMetrics(n,i))}return s.join(`
`)}static exportEndpointMetrics(t,e){return e?this.exportMetrics(t,e):""}}class ZE{config=null;targetStatuses=new Map;scrapedMetrics=new Map;lastScrapeTimes=new Map;prometheusMetrics={scrapeRequestsTotal:0,scrapeErrorsTotal:0,scrapeDurationTotal:0,targetsUp:0,targetsDown:0,samplesScraped:0};initializeConfig(t){const e=t.data.config||{},s=typeof e.scrapeInterval=="number"?`${e.scrapeInterval/1e3}s`:e.scrapeInterval||"15s",n=typeof e.evaluationInterval=="number"?`${e.evaluationInterval/1e3}s`:e.evaluationInterval||"15s";this.config={global:{scrape_interval:s,evaluation_interval:n,external_labels:{prometheus:"archiphoenix"}},scrape_configs:this.buildScrapeConfigs(e),alerting:e.enableAlertmanager?{alertmanagers:[{static_configs:[{targets:[e.alertmanagerUrl||"http://alertmanager:9093"].map(i=>{const o=i.match(/^https?:\/\/([^\/]+)/);return o?o[1]:i})}]}]}:void 0,remote_write:e.enableRemoteWrite&&e.remoteWrite?e.remoteWrite.map(i=>({url:i.url})):void 0},this.initializeTargetStatuses()}buildScrapeConfigs(t){if(t.scrape_configs&&Array.isArray(t.scrape_configs))return t.scrape_configs.map(n=>({job_name:n.job_name,scrape_interval:n.scrape_interval,scrape_timeout:n.scrape_timeout,metrics_path:n.metrics_path,static_configs:n.static_configs||[]}));const e=[],s=t.scrapeInterval||"15s";if(t.targets&&Array.isArray(t.targets)){const n=new Map;for(const i of t.targets){const o=i.job||"default";n.has(o)||n.set(o,[]),n.get(o).push(i)}for(const[i,o]of n.entries()){const l=o[0],d=l.interval||s,h=l.metricsPath||"/metrics",f=o.map(m=>{try{const y=new URL(m.endpoint);return`${y.hostname}${y.port?":"+y.port:""}`}catch{const y=m.endpoint.match(/^https?:\/\/([^\/]+)/);return y?y[1]:m.endpoint}});e.push({job_name:i,scrape_interval:d,metrics_path:h,static_configs:[{targets:f,labels:l.labels||{}}]})}}return e}initializeTargetStatuses(){if(this.targetStatuses.clear(),!!this.config){for(const t of this.config.scrape_configs)if(t.static_configs)for(const e of t.static_configs)for(const s of e.targets){const n=t.metrics_path?`http://${s}${t.metrics_path}`:`http://${s}/metrics`,i=`${t.job_name}:${s}`;this.targetStatuses.set(i,{job:t.job_name,endpoint:n,lastScrape:0,lastSuccess:null,lastError:null,scrapeDuration:null,up:!1,labels:e.labels})}}}performScraping(t,e,s){if(this.config){this.parseDuration(this.config.global.scrape_interval||"15s"),this.prometheusMetrics.targetsUp=0,this.prometheusMetrics.targetsDown=0;for(const[n,i]of this.targetStatuses.entries()){const o=this.lastScrapeTimes.get(n)||0,l=this.getScrapeIntervalForTarget(i.job),d=this.parseDuration(l);t-o>=d&&(this.scrapeTarget(n,i,t,e,s),this.lastScrapeTimes.set(n,t)),i.up?this.prometheusMetrics.targetsUp++:this.prometheusMetrics.targetsDown++}}}scrapeTarget(t,e,s,n,i){const o=performance.now();this.prometheusMetrics.scrapeRequestsTotal++;try{const l=this.findNodeByEndpoint(e.endpoint,n);if(!l)throw new Error(`Target not found: ${e.endpoint}`);const d=i.get(l.id);if(!d)throw new Error(`Metrics not available for component: ${l.id}`);const h=JE.exportMetrics(l,d);e.lastScrape=s,e.lastSuccess=s,e.lastError=null,e.up=!0;const f=performance.now()-o;e.scrapeDuration=f,this.prometheusMetrics.scrapeDurationTotal+=f,this.prometheusMetrics.samplesScraped+=this.countSamples(h),this.scrapedMetrics.set(t,d)}catch(l){const d=performance.now()-o;e.lastScrape=s,e.lastSuccess=null,e.lastError=l instanceof Error?l.message:String(l),e.up=!1,e.scrapeDuration=d,this.prometheusMetrics.scrapeErrorsTotal++}}findNodeByEndpoint(t,e){try{const s=new URL(t),n=s.hostname,i=s.port?parseInt(s.port):null;for(const o of e){const l=o.data.config||{},d=l.port||l.metricsPort||l.metrics?.port;if(o.data.label?.toLowerCase().replace(/\s+/g,"-")===n||i&&d===i)return o}}catch{}return null}getScrapeIntervalForTarget(t){return this.config&&(this.config.scrape_configs.find(s=>s.job_name===t)?.scrape_interval||this.config.global.scrape_interval)||"15s"}parseDuration(t){if(typeof t=="number")return t;if(typeof t!="string")return 15e3;const e=t.match(/^(\d+)([smhd])$/);if(!e)return 15e3;const s=parseInt(e[1]);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;case"d":return s*24*60*60*1e3;default:return 15e3}}countSamples(t){return t.split(`
`).filter(e=>e.trim()&&!e.startsWith("#")).length}getTargetStatuses(){return Array.from(this.targetStatuses.values())}getPrometheusMetrics(){return{...this.prometheusMetrics}}calculateLoad(){const t=this.prometheusMetrics.scrapeRequestsTotal,e=this.prometheusMetrics.scrapeErrorsTotal,s=this.prometheusMetrics.scrapeDurationTotal,n=this.prometheusMetrics.samplesScraped,i=this.targetStatuses.size,o=this.parseDuration(this.config?.global.scrape_interval||"15s"),l=i>0?1e3/o*i:0,d=t>0?s/t:0,h=t>0?e/t:0,f=l*(n/t||0);return{scrapeRequestsPerSecond:l,averageScrapeDuration:d,errorRate:h,samplesPerSecond:f}}}class eT{config=null;lastRefreshTimes=new Map;lastAlertEvaluationTimes=new Map;grafanaMetrics={queriesPerSecond:0,dashboardRefreshesPerSecond:0,alertEvaluationsPerSecond:0,datasourceErrors:0,activeDashboards:0,activePanels:0,totalQueries:0,cachedQueries:0,queryLatency:0,renderingLatency:0};queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(t){const e=t.data.config||{};this.config=e,this.initializeRefreshTimes(),this.initializeAlertEvaluationTimes()}initializeRefreshTimes(){if(this.lastRefreshTimes.clear(),!this.config?.dashboards)return;const t=this.normalizeDashboards(this.config.dashboards);for(const e of t)this.lastRefreshTimes.set(e.id,0)}initializeAlertEvaluationTimes(){if(this.lastAlertEvaluationTimes.clear(),!(!this.config?.alerts||!this.config.enableAlerting))for(const t of this.config.alerts)this.lastAlertEvaluationTimes.set(t.id,0)}normalizeDashboards(t){return!t||!Array.isArray(t)?[]:t.map(e=>{if(e&&typeof e=="object"){if(typeof e.panels=="number")return{id:e.id||String(Date.now()),name:e.name||"Dashboard",panels:[],tags:Array.isArray(e.tags)?e.tags:[],refresh:e.refresh||"30s"};if(Array.isArray(e.panels))return{id:e.id||String(Date.now()),name:e.name||"Dashboard",panels:e.panels.map(s=>({id:s.id||`panel-${Date.now()}`,title:s.title||"Panel",type:s.type||"graph",datasource:s.datasource||"Prometheus",queries:Array.isArray(s.queries)?s.queries:[{refId:"A",expr:"up"}],gridPos:s.gridPos||{x:0,y:0,w:12,h:8}})),tags:Array.isArray(e.tags)?e.tags:[],variables:e.variables,refresh:e.refresh||"30s",timeRange:e.timeRange}}return e}).filter(e=>e&&typeof e=="object"&&e.id)}performUpdate(t,e=!0,s){this.config&&(this.updateDashboards(t,e,s),this.config.enableAlerting&&this.evaluateAlerts(t,e),this.updateMetrics())}updateDashboards(t,e,s){if(!this.config?.dashboards)return;const n=this.normalizeDashboards(this.config.dashboards);let i=0,o=0;for(const l of n){const d=this.parseDuration(l.refresh||"30s"),h=this.lastRefreshTimes.get(l.id)||0;if(t-h>=d){this.lastRefreshTimes.set(l.id,t);for(const f of l.panels){const m=f.datasource,y=m&&this.isLokiDatasource(m);for(const S of f.queries){i++;const R=this.simulateQueryExecution(S,e,y,s);o+=R,this.queryLatencyHistory.push(R),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift()}const b=this.simulatePanelRendering(f),C=this.grafanaMetrics.renderingLatency;this.grafanaMetrics.renderingLatency=C*.9+b*.1}}}this.grafanaMetrics.totalQueries+=i,i>0&&(this.grafanaMetrics.queryLatency=o/i)}isLokiDatasource(t){if(!this.config?.datasources)return!1;const s=(Array.isArray(this.config.datasources)?this.config.datasources:[]).find(n=>typeof n=="string"?n===t:n.name===t);return typeof s=="object"&&s.type?s.type==="loki":!1}evaluateAlerts(t,e){if(this.config?.alerts)for(const s of this.config.alerts){const n=this.parseDuration(s.for||"1m"),i=this.lastAlertEvaluationTimes.get(s.id)||0;t-i>=n&&(this.lastAlertEvaluationTimes.set(s.id,t),this.simulateQueryExecution({refId:"A",expr:s.condition.query},e),e||this.grafanaMetrics.datasourceErrors++)}}simulateQueryExecution(t,e,s=!1,n){if(s&&n)try{const d=Date.now()-36e5,h=Date.now(),f=n(t.expr,d,h,100);return f.success||this.grafanaMetrics.datasourceErrors++,f.latency}catch{return this.grafanaMetrics.datasourceErrors++,1e3}if(!e)return this.grafanaMetrics.datasourceErrors++,1e3;let i=50;const o=this.estimateQueryComplexity(t.expr);i+=o*10;const l=(Math.random()-.5)*20;return Math.max(10,i+l)}estimateQueryComplexity(t){if(!t)return 0;let e=1;t.includes("[")&&(e+=2);const s=["sum","avg","max","min","count","rate","irate","increase"];for(const i of s)t.toLowerCase().includes(i)&&(e+=1);const n=(t.match(/\|/g)||[]).length;return e+=n,e}simulatePanelRendering(t){const s={stat:5,gauge:10,piechart:15,bargraph:20,table:25,graph:30}[t.type]||20,n=Math.sqrt(t.queries.length);return s*n}updateMetrics(){if(!this.config)return;const t=this.normalizeDashboards(this.config.dashboards);this.grafanaMetrics.activeDashboards=t.length,this.grafanaMetrics.activePanels=t.reduce((n,i)=>n+i.panels.length,0);let e=0,s=0;for(const n of t){const o=1e3/this.parseDuration(n.refresh||"30s");s+=o;const l=n.panels.reduce((d,h)=>d+h.queries.length,0);e+=o*l}if(this.grafanaMetrics.queriesPerSecond=e,this.grafanaMetrics.dashboardRefreshesPerSecond=s,this.config.enableAlerting&&this.config.alerts){let n=0;for(const i of this.config.alerts){const l=1e3/this.parseDuration(i.for||"1m");n+=l}this.grafanaMetrics.alertEvaluationsPerSecond=n}else this.grafanaMetrics.alertEvaluationsPerSecond=0;if(this.queryLatencyHistory.length>0){const n=this.queryLatencyHistory.reduce((i,o)=>i+o,0)/this.queryLatencyHistory.length;this.grafanaMetrics.queryLatency=n}}parseDuration(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 3e4;const s=parseInt(e[1]);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;case"d":return s*24*60*60*1e3;default:return 3e4}}getGrafanaMetrics(){return{...this.grafanaMetrics}}calculateLoad(){const t=this.grafanaMetrics,e=.1,s=Math.min(.7,t.queriesPerSecond/100),n=Math.min(.1,t.alertEvaluationsPerSecond/10),i=Math.min(.1,t.activePanels/100),o=Math.min(.95,e+s+n+i),l=.2,d=Math.min(.4,t.activeDashboards/50),h=Math.min(.3,t.cachedQueries/1e3),f=Math.min(.95,l+d+h),m=t.totalQueries+t.alertEvaluationsPerSecond,y=m>0?t.datasourceErrors/m:0;return{queriesPerSecond:t.queriesPerSecond,dashboardRefreshesPerSecond:t.dashboardRefreshesPerSecond,alertEvaluationsPerSecond:t.alertEvaluationsPerSecond,averageQueryLatency:t.queryLatency,averageRenderingLatency:t.renderingLatency,errorRate:y,cpuUtilization:o,memoryUtilization:f}}getActiveDatasources(){return this.config?.datasources?this.config.datasources.length>0&&typeof this.config.datasources[0]=="string"?this.config.datasources.map(t=>({name:t,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:t===this.config.datasources[0]})):this.config.datasources.filter(t=>t&&typeof t=="object"&&t.name):[]}isPrometheusAvailable(t){return!(!t||!this.getActiveDatasources().find(n=>n.type==="prometheus"))}}class tT{config=null;streams=new Map;queryStatuses=new Map;lastIngestionTimes=new Map;lokiMetrics={ingestionRequestsTotal:0,ingestionErrorsTotal:0,ingestionLinesTotal:0,ingestionBytesTotal:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,activeStreams:0,totalStorageSize:0,retentionDeletions:0};ingestionLatencyHistory=[];queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||"http://loki:3100",retentionPeriod:e.retentionPeriod||"168h",maxStreams:e.maxStreams||1e4,maxLineSize:e.maxLineSize||256e3,enableCompression:e.enableCompression??!0,compressionType:e.compressionType||"gzip",enableAuth:e.enableAuth??!1,enableMultiTenancy:e.enableMultiTenancy??!1,tenants:e.tenants||[],ingestionRateLimit:e.ingestionRateLimit,queryRateLimit:e.queryRateLimit},this.initializeStreamsFromConfig(e),this.initializeQueriesFromConfig(e)}initializeStreamsFromConfig(t){if(t.streams&&Array.isArray(t.streams))for(const e of t.streams){const s=this.getStreamKey(e.labels||{}),n=[];if(e.entries&&Array.isArray(e.entries))for(const o of e.entries)n.push({timestamp:o.timestamp||Date.now().toString()+"000000",line:o.line||""});const i=e.size?e.size*1024*1024*1024:0;this.streams.set(s,{labels:e.labels||{},entries:n,size:i,lastEntryTime:Date.now()})}}initializeQueriesFromConfig(t){if(t.queries&&Array.isArray(t.queries))for(const e of t.queries){const s=e.id||`query-${Date.now()}-${Math.random()}`;this.queryStatuses.set(s,{id:s,query:e.query||"",lastExecution:0,lastSuccess:null,lastError:null,executionDuration:null,resultsCount:e.results||0,success:!0})}}processIngestion(t,e){if(!this.config)return{success:!1,error:"Loki not configured",ingestedLines:0,ingestedBytes:0};const s=performance.now();this.lokiMetrics.ingestionRequestsTotal++;try{if(this.config.ingestionRateLimit){const l=e||"default",d=this.lastIngestionTimes.get(l)||0,h=Date.now();h-d<1e3,this.lastIngestionTimes.set(l,h)}let n=0,i=0;for(const l of t){const d=this.getStreamKey(l.stream);if(!this.streams.has(d)&&this.streams.size>=(this.config.maxStreams||1e4)){this.lokiMetrics.ingestionErrorsTotal++;continue}let h=this.streams.get(d);h||(h={labels:l.stream,entries:[],size:0,lastEntryTime:Date.now()},this.streams.set(d,h));for(const[f,m]of l.values){const y=new Blob([m]).size;if(y>(this.config.maxLineSize||256e3)){this.lokiMetrics.ingestionErrorsTotal++;continue}h.entries.push({timestamp:f,line:m}),h.size+=y,h.lastEntryTime=Math.max(h.lastEntryTime,this.parseTimestamp(f)),n++,i+=y}if(this.config.enableCompression){const f=this.getCompressionRatio(this.config.compressionType||"gzip");h.size=Math.floor(h.size*f)}}this.lokiMetrics.ingestionLinesTotal+=n,this.lokiMetrics.ingestionBytesTotal+=i,this.lokiMetrics.totalStorageSize+=i,this.lokiMetrics.activeStreams=this.streams.size;const o=performance.now()-s;return this.ingestionLatencyHistory.push(o),this.ingestionLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.ingestionLatencyHistory.shift(),{success:!0,ingestedLines:n,ingestedBytes:i}}catch(n){return performance.now()-s,this.lokiMetrics.ingestionErrorsTotal++,{success:!1,error:n instanceof Error?n.message:String(n),ingestedLines:0,ingestedBytes:0}}}executeQuery(t,e,s,n){if(!this.config)return{success:!1,error:"Loki not configured",latency:0,resultsCount:0};const i=performance.now();this.lokiMetrics.queryRequestsTotal++;try{this.config.queryRateLimit;const o=this.parseLogQL(t),l=this.executeLogQLQuery(o,e,s,n),d=performance.now()-i;return this.lokiMetrics.queryDurationTotal+=d,this.queryLatencyHistory.push(d),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift(),{success:!0,result:l,latency:d,resultsCount:l.reduce((h,f)=>h+f.values.length,0)}}catch(o){const l=performance.now()-i;return this.lokiMetrics.queryErrorsTotal++,{success:!1,error:o instanceof Error?o.message:String(o),latency:l,resultsCount:0}}}parseLogQL(t){const e={},s=[],n=[],i=t.match(/^\{([^}]+)\}/);if(i){const b=i[1].matchAll(/(\w+)=["']([^"']+)["']/g);for(const C of b)e[C[1]]=C[2]}const o=t.match(/\|\s*=\s*["']([^"']+)["']/);o&&s.push({type:"contains",pattern:o[1]});const l=t.match(/!\s*=\s*["']([^"']+)["']/);l&&s.push({type:"not_contains",pattern:l[1]});const d=t.match(/\|\s*~\s*["']([^"']+)["']/);d&&s.push({type:"regex",pattern:d[1]});const h=t.matchAll(/\|\s*(\w+)\s*(=|=~|!=|!~)\s*["']([^"']+)["']/g);for(const y of h)n.push({label:y[1],operator:y[2],value:y[3]});let f;const m=t.match(/\|\s*(\w+)\(([^)]*)\)/);return m&&(f={function:m[1],params:m[2]?m[2].split(",").map(y=>y.trim()):[]}),{streamSelector:e,lineFilters:s,labelFilters:n,aggregation:f}}executeLogQLQuery(t,e,s,n){const i=[],o=Date.now(),l=e||o-36e5,d=s||o;for(const[h,f]of this.streams.entries()){let m=!0;for(const[C,S]of Object.entries(t.streamSelector))if(f.labels[C]!==S){m=!1;break}if(!m)continue;let b=f.entries.filter(C=>{const S=this.parseTimestamp(C.timestamp);return S>=l&&S<=d});for(const C of t.lineFilters)b=b.filter(S=>{switch(C.type){case"contains":return S.line.includes(C.pattern);case"not_contains":return!S.line.includes(C.pattern);case"regex":try{return new RegExp(C.pattern).test(S.line)}catch{return!1}}});for(const C of t.labelFilters){const S=f.labels[C.label];if(S===void 0){b=[];break}switch(C.operator){case"=":S!==C.value&&(b=[]);break;case"!=":S===C.value&&(b=[]);break;case"=~":try{new RegExp(C.value).test(S)||(b=[])}catch{b=[]}break;case"!~":try{new RegExp(C.value).test(S)&&(b=[])}catch{}break}}if(n&&b.length>n&&(b=b.slice(0,n)),t.aggregation){const C=this.applyAggregation(t.aggregation,b);i.push({stream:f.labels,values:[[Date.now().toString()+"000000",C.toString()]]})}else b.length>0&&i.push({stream:f.labels,values:b.map(C=>[C.timestamp,C.line])})}return i}applyAggregation(t,e){switch(t.function.toLowerCase()){case"rate":if(e.length<2)return 0;const s=this.parseTimestamp(e[0].timestamp),i=(this.parseTimestamp(e[e.length-1].timestamp)-s)/1e3;return i>0?e.length/i:0;case"count_over_time":return e.length;case"sum":return e.reduce((l,d)=>{const h=parseFloat(d.line);return l+(isNaN(h)?0:h)},0);case"avg":case"average":const o=e.map(l=>parseFloat(l.line)).filter(l=>!isNaN(l));return o.length>0?o.reduce((l,d)=>l+d,0)/o.length:0;default:return e.length}}performRetention(t){if(!this.config)return;const e=this.parseDuration(this.config.retentionPeriod||"168h"),s=t-e;let n=0,i=0;for(const[o,l]of this.streams.entries()){const d=l.entries.length;l.entries=l.entries.filter(h=>this.parseTimestamp(h.timestamp)>s),l.entries.length<d&&(n+=d-l.entries.length,l.size=l.entries.reduce((h,f)=>h+new Blob([f.line]).size,0),i+=l.size),l.entries.length===0&&this.streams.delete(o)}this.lokiMetrics.retentionDeletions+=n,this.lokiMetrics.totalStorageSize=Math.max(0,this.lokiMetrics.totalStorageSize-i),this.lokiMetrics.activeStreams=this.streams.size}getStreams(){return Array.from(this.streams.values())}getLokiMetrics(){return{...this.lokiMetrics}}calculateLoad(){const t=this.lokiMetrics.ingestionRequestsTotal,e=this.lokiMetrics.ingestionErrorsTotal,s=this.lokiMetrics.ingestionLinesTotal,n=this.lokiMetrics.ingestionBytesTotal,i=this.lokiMetrics.queryRequestsTotal,o=this.lokiMetrics.queryErrorsTotal,l=this.lokiMetrics.queryDurationTotal,d=this.ingestionLatencyHistory.length>0?this.ingestionLatencyHistory.reduce((M,T)=>M+T,0)/this.ingestionLatencyHistory.length:0,h=this.queryLatencyHistory.length>0?this.queryLatencyHistory.reduce((M,T)=>M+T,0)/this.queryLatencyHistory.length:i>0?l/i:0,f=t>0?e/t:0,m=i>0?o/i:0,y=s>0?s/100:0,b=n>0?n/100:0,C=i>0?i/100:0,S=(this.config?.maxStreams||1e4)*100*1024*1024,R=Math.min(1,this.lokiMetrics.totalStorageSize/S);return{ingestionLinesPerSecond:y,ingestionBytesPerSecond:b,averageIngestionLatency:d,ingestionErrorRate:f,queriesPerSecond:C,averageQueryLatency:h,queryErrorRate:m,storageUtilization:R,streamCount:this.streams.size}}getStreamKey(t){return Object.keys(t).sort().map(s=>`${s}=${t[s]}`).join(",")}parseTimestamp(t){const e=BigInt(t);return Number(e/BigInt(1e6))}parseDuration(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 10080*60*1e3;const s=parseInt(e[1]);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;case"d":return s*24*60*60*1e3;default:return 10080*60*1e3}}getCompressionRatio(t){switch(t){case"gzip":return .3;case"snappy":return .5;case"lz4":return .4;default:return .3}}}class sT{config=null;traces=new Map;serviceStats=new Map;jaegerMetrics={spansReceivedTotal:0,spansDroppedTotal:0,spansProcessedTotal:0,samplingDecisionsTotal:0,samplingErrorsTotal:0,tracesStoredTotal:0,tracesDroppedTotal:0,storageSizeBytes:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,spansSentTotal:0,spansFailedTotal:0};samplingState={};queryHistory=[];MAX_QUERY_HISTORY=100;lastCleanupTime=0;CLEANUP_INTERVAL=6e4;initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||"http://jaeger:16686",agentEndpoint:e.agentEndpoint||"http://jaeger-agent:6831",collectorEndpoint:e.collectorEndpoint||"http://jaeger-collector:14268",queryEndpoint:e.queryEndpoint||"http://jaeger-query:16686",samplingType:e.samplingType||"probabilistic",samplingParam:e.samplingParam??.001,storageBackend:e.storageBackend||"elasticsearch",storageUrl:e.storageUrl||"http://elasticsearch:9200",enableUIGraphQL:e.enableUIGraphQL??!0,enableMetrics:e.enableMetrics??!0,metricsBackend:e.metricsBackend||"prometheus",metricsUrl:e.metricsUrl||"http://prometheus:9090",maxTraces:e.maxTraces||1e4,traceTTL:e.traceTTL||864e5},this.initializeSampling()}initializeSampling(){if(!this.config)return;const{samplingType:t,samplingParam:e}=this.config;switch(t){case"probabilistic":this.samplingState.probabilistic={probability:Math.max(0,Math.min(1,e||.001))};break;case"ratelimiting":this.samplingState.rateLimiting={maxTracesPerSecond:Math.max(1,e||10),bucket:{tokens:e||10,lastRefill:Date.now()}};break;case"peroperation":this.samplingState.perOperation=new Map;break}}receiveSpan(t){if(!this.config)return{sample:!1};this.jaegerMetrics.spansReceivedTotal++;const e=this.makeSamplingDecision(t);return this.jaegerMetrics.samplingDecisionsTotal++,e.sample?(this.processSpan(t),e):(this.jaegerMetrics.spansDroppedTotal++,e)}receiveSpansFromDataFlow(t){for(const e of t)this.receiveSpan(e)}makeSamplingDecision(t){if(!this.config)return{sample:!1};const{samplingType:e}=this.config;try{switch(e){case"probabilistic":return this.probabilisticSampling(t);case"ratelimiting":return this.rateLimitingSampling(t);case"peroperation":return this.perOperationSampling(t);default:return{sample:!0}}}catch{return this.jaegerMetrics.samplingErrorsTotal++,{sample:!1}}}probabilisticSampling(t){const e=this.samplingState.probabilistic;if(!e)return{sample:!0};const s=Math.random()<e.probability;return{sample:s,tags:s?[{key:"sampler.type",value:"probabilistic"},{key:"sampler.param",value:e.probability.toString()}]:void 0}}rateLimitingSampling(t){const e=this.samplingState.rateLimiting;if(!e)return{sample:!0};const s=Date.now(),n=s-e.bucket.lastRefill,i=1e3/e.maxTracesPerSecond,o=Math.floor(n/i);return o>0&&(e.bucket.tokens=Math.min(e.maxTracesPerSecond,e.bucket.tokens+o),e.bucket.lastRefill=s),e.bucket.tokens>0?(e.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"ratelimiting"},{key:"sampler.param",value:e.maxTracesPerSecond.toString()}]}):{sample:!1}}perOperationSampling(t){this.samplingState.perOperation||(this.samplingState.perOperation=new Map);const e=`${t.serviceName}:${t.operationName}`;let s=this.samplingState.perOperation.get(e);if(!s){const d=this.config?.samplingParam||10;s={maxTracesPerSecond:d,bucket:{tokens:d,lastRefill:Date.now()}},this.samplingState.perOperation.set(e,s)}const n=Date.now(),i=n-s.bucket.lastRefill,o=1e3/s.maxTracesPerSecond,l=Math.floor(i/o);return l>0&&(s.bucket.tokens=Math.min(s.maxTracesPerSecond,s.bucket.tokens+l),s.bucket.lastRefill=n),s.bucket.tokens>0?(s.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"peroperation"},{key:"sampler.param",value:s.maxTracesPerSecond.toString()}]}):{sample:!1}}processSpan(t){this.jaegerMetrics.spansProcessedTotal++;let e=this.traces.get(t.traceId);e||(e={traceId:t.traceId,spans:[],startTime:t.startTime,duration:t.duration,serviceCount:0,spanCount:0,hasErrors:!1},this.traces.set(t.traceId,e),this.jaegerMetrics.tracesStoredTotal++),e.spans.push(t),e.spanCount=e.spans.length,t.startTime<e.startTime&&(e.startTime=t.startTime);const s=Math.max(...e.spans.map(i=>i.startTime+i.duration));e.duration=s-e.startTime,!t.parentSpanId&&!e.rootService&&(e.rootService=t.serviceName,e.rootOperation=t.operationName),(t.tags.some(i=>i.key==="error"&&i.value===!0)||t.logs.some(i=>i.fields.some(o=>o.key==="error")))&&(e.hasErrors=!0),this.updateServiceStats(t,e),this.config&&this.traces.size>this.config.maxTraces&&this.evictOldestTraces()}updateServiceStats(t,e){let s=this.serviceStats.get(t.serviceName);s||(s={name:t.serviceName,tracesTotal:0,errorsTotal:0,avgDuration:0,spansTotal:0,lastTraceTime:0},this.serviceStats.set(t.serviceName,s)),s.spansTotal++,s.lastTraceTime=Math.max(s.lastTraceTime,t.startTime/1e3);const n=s.avgDuration*(s.spansTotal-1)+t.duration;s.avgDuration=n/s.spansTotal,(e.spans.length===1||e.spans[0].serviceName===t.serviceName)&&(s.tracesTotal++,e.hasErrors&&s.errorsTotal++)}evictOldestTraces(){if(!this.config)return;const t=Date.now()*1e3,e=this.config.traceTTL*1e3,s=this.config.maxTraces,n=[];for(const[i,o]of this.traces.entries())t-o.startTime>e&&n.push(i);if(this.traces.size-n.length>s){const o=Array.from(this.traces.entries()).filter(([l])=>!n.includes(l)).sort(([,l],[,d])=>l.startTime-d.startTime).slice(0,this.traces.size-n.length-s);n.push(...o.map(([l])=>l))}for(const i of n){const o=this.traces.get(i);if(o){for(const d of o.spans){const h=this.serviceStats.get(d.serviceName);h&&(h.tracesTotal=Math.max(0,h.tracesTotal-1),o.hasErrors&&(h.errorsTotal=Math.max(0,h.errorsTotal-1)))}const l=this.calculateTraceSize(o);this.jaegerMetrics.storageSizeBytes=Math.max(0,this.jaegerMetrics.storageSizeBytes-l),this.jaegerMetrics.tracesDroppedTotal++,this.traces.delete(i)}}}performCleanup(t){t-this.lastCleanupTime<this.CLEANUP_INTERVAL||(this.lastCleanupTime=t,this.evictOldestTraces())}queryTraces(t){const e=performance.now();this.jaegerMetrics.queryRequestsTotal++;try{let s=Array.from(this.traces.values());if(t.service&&(s=s.filter(l=>l.spans.some(d=>d.serviceName===t.service))),t.operation&&(s=s.filter(l=>l.spans.some(d=>d.operationName===t.operation))),t.tags&&(s=s.filter(l=>l.spans.some(d=>Object.entries(t.tags).every(([h,f])=>d.tags.some(m=>m.key===h&&String(m.value)===String(f)))))),t.startTime){const l=t.startTime*1e3;s=s.filter(d=>d.startTime>=l)}if(t.endTime){const l=t.endTime*1e3;s=s.filter(d=>d.startTime+d.duration<=l)}s.sort((l,d)=>d.startTime-l.startTime);const n=t.limit||20,i=s.length;s=s.slice(0,n);const o=performance.now()-e;return this.jaegerMetrics.queryDurationTotal+=o,this.queryHistory.push({params:t,timestamp:Date.now(),duration:o,resultsCount:s.length}),this.queryHistory.length>this.MAX_QUERY_HISTORY&&this.queryHistory.shift(),{traces:s,total:i,limit:n}}catch(s){return this.jaegerMetrics.queryErrorsTotal++,{traces:[],total:0,limit:t.limit||20,errors:[s instanceof Error?s.message:String(s)]}}}getServiceStats(){return Array.from(this.serviceStats.values())}getRecentTraces(t=20){const e=Array.from(this.traces.values());return e.sort((s,n)=>n.startTime-s.startTime),e.slice(0,t)}getTraceById(t){return this.traces.get(t)}getJaegerMetrics(){return{...this.jaegerMetrics}}calculateTraceSize(t){let e=0;for(const s of t.spans)e+=100,e+=s.operationName.length,e+=s.serviceName.length,e+=s.tags.length*50,e+=s.logs.length*100;return e}calculateLoad(){const t=this.jaegerMetrics.spansReceivedTotal,e=this.jaegerMetrics.tracesStoredTotal,s=this.jaegerMetrics.spansDroppedTotal,n=this.jaegerMetrics.queryRequestsTotal,i=this.jaegerMetrics.queryDurationTotal,o=this.jaegerMetrics.queryErrorsTotal,l=t>0?1-s/t:0,d=n>0?i/n:0,h=n>0?o/n:0,f=this.config?.maxTraces||1e4,m=this.traces.size/f,y=t/60,b=e/60;return{spansPerSecond:y,tracesPerSecond:b,samplingRate:l,storageUtilization:m,queryLatency:d,errorRate:h}}getConfig(){return this.config?{...this.config}:null}}class nT{config=null;receivers=new Map;processors=new Map;exporters=new Map;pipelines=new Map;metricsReceived=0;tracesReceived=0;logsReceived=0;metricsExported=0;tracesExported=0;logsExported=0;initializeConfig(t){const e=t.data.config||{};if(this.config={receivers:Array.isArray(e.receivers)?e.receivers:[],processors:Array.isArray(e.processors)?e.processors:[],exporters:Array.isArray(e.exporters)?e.exporters:[],pipelines:Array.isArray(e.pipelines)?e.pipelines:[]},this.receivers.clear(),this.config.receivers)for(const s of this.config.receivers)s.id&&this.receivers.set(s.id,s);if(this.processors.clear(),this.config.processors)for(const s of this.config.processors)s.id&&this.processors.set(s.id,s);if(this.exporters.clear(),this.config.exporters)for(const s of this.config.exporters)s.id&&this.exporters.set(s.id,s);if(this.pipelines.clear(),this.config.pipelines)for(const s of this.config.pipelines)s.id&&this.pipelines.set(s.id,s)}processMessage(t,e){const s=Date.now();try{const n=this.determineDataType(t,e),i=Array.from(this.pipelines.values()).filter(o=>o.type===n&&o.enabled!==!1);if(i.length===0)return{success:!0,latency:Date.now()-s};for(const o of i){if(o.receivers.map(m=>this.receivers.get(m)).filter(m=>m&&m.enabled).length===0)continue;let d=t.payload;const h=o.processors.map(m=>this.processors.get(m)).filter(m=>m&&m.enabled);for(const m of h)d=this.applyProcessor(m,d);const f=o.exporters.map(m=>this.exporters.get(m)).filter(m=>m&&m.enabled);for(const m of f)this.applyExporter(m,d,n);n==="metrics"?(this.metricsReceived++,this.metricsExported+=f.length):n==="traces"?(this.tracesReceived++,this.tracesExported+=f.length):n==="logs"&&(this.logsReceived++,this.logsExported+=f.length)}return{success:!0,latency:Date.now()-s}}catch(n){return{success:!1,latency:Date.now()-s,error:n instanceof Error?n.message:"Unknown error"}}}determineDataType(t,e){if(e){const s=e.type?.toLowerCase()||"";if(s.includes("prometheus")||s.includes("metric"))return"metrics";if(s.includes("jaeger")||s.includes("trace"))return"traces";if(s.includes("loki")||s.includes("log"))return"logs"}if(t.format){const s=t.format.toLowerCase();if(s.includes("prometheus")||s.includes("metric"))return"metrics";if(s.includes("jaeger")||s.includes("trace")||s.includes("zipkin"))return"traces";if(s.includes("log"))return"logs"}return"traces"}applyProcessor(t,e){switch(t.type){case"batch":return e;case"memory_limiter":return e;case"filter":return e;case"transform":return e;case"resource":return e;case"attributes":return e;default:return e}}applyExporter(t,e,s){t.type}getMetrics(){return{metricsReceived:this.metricsReceived,tracesReceived:this.tracesReceived,logsReceived:this.logsReceived,metricsExported:this.metricsExported,tracesExported:this.tracesExported,logsExported:this.logsExported,receiversCount:this.receivers.size,processorsCount:this.processors.size,exportersCount:this.exporters.size,pipelinesCount:this.pipelines.size}}resetMetrics(){this.metricsReceived=0,this.tracesReceived=0,this.logsReceived=0,this.metricsExported=0,this.tracesExported=0,this.logsExported=0}}class iT{config=null;incidents=new Map;incidentState=new Map;metrics={notificationsSent:0,escalationsTriggered:0,acknowledgements:0,totalAckLatency:0,totalAckCount:0,totalResolveLatency:0,totalResolveCount:0,apiRequests:0,webhookCalls:0,errors:0};initializeFromNode(t){const e=t.data.config||{},s=(e.services||[]).map(o=>({id:String(o.id??o.name??"service"),name:String(o.name??"service"),integrationKey:o.integrationKey,status:o.status??"active",escalationPolicy:o.escalationPolicy??e.escalationPolicy??"default-policy",autoResolve:o.autoResolve??e.enableAutoResolve??!0,resolveTimeout:o.resolveTimeout??e.resolveTimeout??300})),n=(e.escalationPolicies||[]).map(o=>({id:String(o.id??o.name??"policy"),name:String(o.name??"policy"),levels:Array.isArray(o.levels)?o.levels.map((l,d)=>({level:typeof l.level=="number"?l.level:d+1,timeout:typeof l.timeout=="number"?l.timeout:5,targets:Array.isArray(l.targets)?l.targets.map(h=>String(h)):[]})):[]})),i=(e.onCallUsers||[]).map(o=>({id:String(o.id??o.email??o.name??"user"),name:String(o.name??"On-Call User"),email:String(o.email??"user@example.com"),status:o.status==="off-call"?"off-call":"on-call"}));this.config={services:s,escalationPolicies:n,onCallUsers:i,severityMapping:e.severityMapping??"standard",enableAutoResolve:e.enableAutoResolve??!0,resolveTimeout:e.resolveTimeout??300}}processAlerts(t,e){if(!(!this.config||e.length===0))for(const s of e){const n=this.findServiceForAlert(s);if(!n||n.status==="disabled")continue;const i=this.mapSeverity(s),o=this.findExistingIncident(s,n);if(o)o.lastSignalAt=t,o.alertIds=Array.from(new Set([...o.alertIds||[],s.id])),this.incidents.set(o.id,o),this.metrics.apiRequests++;else{const l=`inc-${Date.now()}-${Math.floor(Math.random()*1e3)}`,d={id:l,title:s.title,serviceId:n.id,status:"triggered",severity:i,createdAt:t,lastSignalAt:t,alertIds:[s.id]};this.incidents.set(l,d),this.incidentState.set(l,{escalationLevelIndex:0,lastEscalationAt:t}),this.metrics.apiRequests++,this.triggerEscalation(t,d,n)}}}advanceTime(t){if(this.config)for(const[e,s]of this.incidents.entries()){if(s.status==="resolved")continue;const n=this.config.services.find(y=>y.id===s.serviceId);if(!n)continue;const i=n.autoResolve??this.config.enableAutoResolve,o=(n.resolveTimeout??this.config.resolveTimeout)*1e3;if(i&&s.status!=="resolved"&&s.lastSignalAt&&t-s.lastSignalAt>=o){this.resolveIncident(t,s),this.incidents.set(e,s);continue}const l=this.findEscalationPolicy(n);if(!l||l.levels.length===0)continue;const d=this.incidentState.get(e);if(!d)continue;const h=l.levels[d.escalationLevelIndex];if(!h)continue;const f=h.timeout*60*1e3;s.status==="triggered"&&t-d.lastEscalationAt>=f&&d.escalationLevelIndex<l.levels.length-1&&(d.escalationLevelIndex+=1,d.lastEscalationAt=t,this.incidentState.set(e,d),this.triggerEscalation(t,s,n,d.escalationLevelIndex))}}acknowledgeIncident(t,e){const s=this.incidents.get(e);!s||s.status!=="triggered"||(s.status="acknowledged",s.acknowledgedAt=t,this.incidents.set(e,s),this.metrics.acknowledgements++,this.metrics.totalAckCount++,this.metrics.totalAckLatency+=t-s.createdAt)}resolveIncidentManually(t,e){const s=this.incidents.get(e);!s||s.status==="resolved"||(this.resolveIncident(t,s),this.incidents.set(e,s))}getIncidents(){return Array.from(this.incidents.values())}getMetrics(){const t=Array.from(this.incidents.values()),e=t.length,s=t.filter(S=>S.status!=="resolved").length,n=t.filter(S=>S.status==="resolved").length,i=this.metrics.totalAckCount>0?this.metrics.totalAckLatency/this.metrics.totalAckCount:0,o=this.metrics.totalResolveCount>0?this.metrics.totalResolveLatency/this.metrics.totalResolveCount:0,l=300,d=this.metrics.apiRequests/l,h=this.metrics.webhookCalls/l,f=d+h+s*.1+this.metrics.notificationsSent/l,m=Math.min(.95,.1+f/200),y=Math.min(.95,.2+e/1e3),b=this.metrics.apiRequests+this.metrics.webhookCalls+1,C=this.metrics.errors/b;return{incidentsTotal:e,incidentsActive:s,incidentsResolved:n,notificationsSent:this.metrics.notificationsSent,escalationsTriggered:this.metrics.escalationsTriggered,acknowledgements:this.metrics.acknowledgements,averageAckLatency:i,averageResolveLatency:o,apiRequestsPerSecond:d,webhooksPerSecond:h,errorRate:C,cpuUtilization:m,memoryUtilization:y}}calculateLoad(){const t=this.getMetrics(),e=t.apiRequestsPerSecond+t.webhooksPerSecond+t.incidentsActive/60+t.notificationsSent/300,n=100+(t.averageAckLatency||0)*.01+(t.averageResolveLatency||0)*.005,i=(t.cpuUtilization+t.memoryUtilization)/2;return{throughput:e,latency:n,errorRate:t.errorRate,utilization:i}}findServiceForAlert(t){if(this.config){if(t.nodeLabel){const e=t.nodeLabel.toLowerCase(),s=this.config.services.find(n=>n.name.toLowerCase()===e||e.includes(n.name.toLowerCase()));if(s)return s}if(t.nodeId){const e=this.config.services.find(s=>s.id===t.nodeId);if(e)return e}return this.config.services[0]}}mapSeverity(t){if(!this.config)return"warning";const e=t.type==="critical"?"critical":t.type==="warning"?"warning":"info";switch(this.config.severityMapping){case"error-focused":return e==="warning"?"error":e;case"warning-demoted":return e==="warning"?"info":e;default:return e}}findExistingIncident(t,e){for(const s of this.incidents.values())if(s.serviceId===e.id&&s.status!=="resolved"&&s.title===t.title)return s}findEscalationPolicy(t){if(this.config)return t.escalationPolicy?this.config.escalationPolicies.find(e=>e.id===t.escalationPolicy||e.name===t.escalationPolicy)??this.config.escalationPolicies[0]:this.config.escalationPolicies[0]}resolveIncident(t,e){e.status!=="resolved"&&(e.status="resolved",e.resolvedAt=t,this.metrics.totalResolveCount++,this.metrics.totalResolveLatency+=t-e.createdAt)}triggerEscalation(t,e,s,n=0){if(!this.config)return;const i=this.findEscalationPolicy(s);if(!i)return;const o=i.levels[n];if(!o)return;const l=this.config.onCallUsers.filter(f=>f.status==="on-call"&&o.targets.includes(f.id)),d=l.length>0?l:this.config.onCallUsers,h=Math.max(1,d.length);this.metrics.notificationsSent+=h,this.metrics.escalationsTriggered++,this.metrics.webhookCalls+=1}}class aT{alerts=new Map;alertCallbacks=[];isAnalyzing=!1;onAlert(t){this.alertCallbacks.push(t)}analyze(t,e,s,n){if(this.isAnalyzing)return[];this.isAnalyzing=!0;const i=[];try{for(const o of t){const l=e.get(o.id),d=n.find(h=>h.nodeId===o.id);if(!(!l||!d)){if(d.health==="down"){const h=`down-${o.id}`;if(!this.alerts.has(h)){const f={id:h,type:"critical",title:"Component Down",message:`${o.data.label} is down and not responding`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:1};this.addAlert(f),i.push(f)}}if(l.errorRate>.1){const h=`error-${o.id}`,f=this.alerts.get(h);if(!f||f.acknowledged){const m={id:h,type:"critical",title:"High Error Rate",message:`${o.data.label} has ${(l.errorRate*100).toFixed(1)}% error rate`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.9};this.addAlert(m),i.push(m)}}if(l.latency>2e3){const h=`latency-${o.id}`,f=this.alerts.get(h);if(!f||f.acknowledged){const m={id:h,type:"warning",title:"High Latency",message:`${o.data.label} has latency of ${l.latency.toFixed(0)}ms`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.7};this.addAlert(m),i.push(m)}}if(l.utilization>.9){const h=`utilization-${o.id}`,f=this.alerts.get(h);if(!f||f.acknowledged){const m={id:h,type:"warning",title:"High Utilization",message:`${o.data.label} is at ${(l.utilization*100).toFixed(0)}% capacity`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.6};this.addAlert(m),i.push(m)}}}}for(const[o,l]of s.entries())if(l.bottleneck){const d=`bottleneck-${o}`,h=this.alerts.get(d);if(!h||h.acknowledged){const f={id:d,type:"critical",title:"Connection Bottleneck",message:"Bottleneck detected in connection",timestamp:Date.now(),acknowledged:!1,severity:.85};this.addAlert(f),i.push(f)}}this.cleanupResolvedAlerts(t,e,s,n)}finally{this.isAnalyzing=!1}return i}addAlert(t){this.alerts.set(t.id,t),this.alertCallbacks.forEach(e=>e(t))}cleanupResolvedAlerts(t,e,s,n){new Set(t.map(i=>i.id)),new Set(s.keys());for(const[i,o]of this.alerts.entries()){if(o.acknowledged)continue;let l=!1;if(o.nodeId)if(!t.find(h=>h.id===o.nodeId))l=!0;else{const h=e.get(o.nodeId),f=n.find(m=>m.nodeId===o.nodeId);(i.startsWith("down-")&&f&&f.health!=="down"||i.startsWith("error-")&&h&&h.errorRate<=.1||i.startsWith("latency-")&&h&&h.latency<=2e3||i.startsWith("utilization-")&&h&&h.utilization<=.9)&&(l=!0)}else if(i.startsWith("bottleneck-")){const d=i.replace("bottleneck-",""),h=s.get(d);(!h||!h.bottleneck)&&(l=!0)}l&&this.alerts.delete(i)}}acknowledge(t){const e=this.alerts.get(t);e&&(e.acknowledged=!0,this.alerts.set(t,e))}getAlerts(){return Array.from(this.alerts.values()).filter(t=>!t.acknowledged).sort((t,e)=>e.severity-t.severity)}getAlertsByType(t){return this.getAlerts().filter(e=>e.type===t)}clear(){this.alerts.clear()}}const ha=new aT;class oT{config=null;metrics={loginRequestsTotal:0,loginErrorsTotal:0,tokenRefreshTotal:0,introspectionRequestsTotal:0,userInfoRequestsTotal:0,sessionsCreatedTotal:0,sessionsExpiredTotal:0,activeSessions:0};sessions=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(t){const e=t.data.config||{},s=Array.isArray(e.clients)?e.clients.map(i=>({id:String(i.id??i.clientId??"client"),name:String(i.name??i.id??"Client"),type:i.type??"public",enabled:i.enabled??!0,protocol:i.protocol??"openid-connect"})):[{id:"archiphoenix-app",name:"ArchiPhoenix App",type:"public",enabled:!0,protocol:"openid-connect"}],n=Array.isArray(e.users)?e.users.map(i=>({id:String(i.id??i.username??"user"),username:String(i.username??`user-${i.id??"1"}`),email:i.email?String(i.email):void 0,enabled:i.enabled??!0,roles:Array.isArray(i.roles)?i.roles.map(o=>String(o)):[]})):[{id:"1",username:"admin",email:"admin@archiphoenix.com",enabled:!0,roles:["admin","user"]}];this.config={realm:String(e.realm||"archiphoenix"),adminUrl:String(e.adminUrl||"http://keycloak:8080"),enableSSL:e.enableSSL??!1,sslRequired:e.sslRequired||"external",accessTokenLifespan:Number(e.accessTokenLifespan||300),ssoSessionIdle:Number(e.ssoSessionIdle||1800),ssoSessionMax:Number(e.ssoSessionMax||36e3),enableOAuth2:e.enableOAuth2??!0,enableSAML:e.enableSAML??!1,enableLDAP:e.enableLDAP??!1,passwordPolicy:String(e.passwordPolicy||"length(8)"),clients:s,users:n}}processAuthRequest(t,e){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredSessions(s);const n=this.config;if(!n)return this.recordLatency(50),this.metrics.loginErrorsTotal++,{success:!1,latency:50,error:"Keycloak not configured"};const i=e.clientId||this.inferDefaultClientId(),o=n.clients.find(m=>m.id===i&&m.enabled);let l=t==="login"?80:t==="refresh"?40:t==="introspect"?60:40;t==="login"&&(l+=this.estimatePasswordPolicyCost(n.passwordPolicy)),n.enableLDAP&&(l*=1.3);const d=(Math.random()-.5)*20,h=Math.max(10,l+d);if(this.recordLatency(h),!o)return this.metrics.loginErrorsTotal++,this.bumpCounter(t),{success:!1,latency:h,error:`Client ${i} not found or disabled`,clientId:i,realm:n.realm};let f;if(t==="login"||t==="userinfo"){const m=e.username||e.subject;if(m&&(f=n.users.find(y=>y.username===m)),!f||!f.enabled)return this.metrics.loginErrorsTotal++,this.bumpCounter(t),{success:!1,latency:h,error:`User ${m||"unknown"} not found or disabled`,clientId:i,realm:n.realm}}switch(t){case"login":return this.metrics.loginRequestsTotal++,this.createOrUpdateSession(s,n,i,f),{success:!0,latency:h,tokenType:"access",expiresIn:n.accessTokenLifespan,subject:f.username,clientId:i,realm:n.realm};case"refresh":return this.metrics.tokenRefreshTotal++,e.subject&&this.touchUserSessions(s,e.subject),{success:!0,latency:h,tokenType:"access",expiresIn:n.accessTokenLifespan,subject:e.subject,clientId:i,realm:n.realm};case"introspect":return this.metrics.introspectionRequestsTotal++,{success:!0,latency:h,tokenType:"access",expiresIn:n.accessTokenLifespan,subject:e.subject,clientId:i,realm:n.realm};case"userinfo":return this.metrics.userInfoRequestsTotal++,{success:!0,latency:h,tokenType:"id",expiresIn:n.accessTokenLifespan,subject:f?.username??e.subject,clientId:i,realm:n.realm}}}calculateLoad(){const t=this.metrics,e=t.loginRequestsTotal+t.tokenRefreshTotal+t.introspectionRequestsTotal+t.userInfoRequestsTotal,s=e>0?Math.min(1,t.loginErrorsTotal/e):0,n=this.latencyHistory.length>0?this.latencyHistory.reduce((l,d)=>l+d,0)/this.latencyHistory.length:0;let i=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const l=(this.lastRequestTime-this.firstRequestTime)/1e3;i=e/Math.max(l,1)}const o=t.loginRequestsTotal>0?1-t.loginErrorsTotal/t.loginRequestsTotal:1;return{requestsPerSecond:i,averageLatency:n,errorRate:s,activeSessions:this.metrics.activeSessions,authSuccessRate:o}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}inferDefaultClientId(){return this.config?.clients.length?(this.config.clients.filter(e=>e.enabled)[0]||this.config.clients[0]).id:"default-client"}estimatePasswordPolicyCost(t){if(!t)return 0;let e=0;const s=t.toLowerCase();s.includes("length(")&&(e+=10),s.includes("digits(")&&(e+=15),s.includes("special(")&&(e+=20),s.includes("uppercase(")&&(e+=10),s.includes("lowercase(")&&(e+=5);const n=(t.match(/\)/g)||[]).length;return e+=n*5,e}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}bumpCounter(t){switch(t){case"login":this.metrics.loginRequestsTotal++;break;case"refresh":this.metrics.tokenRefreshTotal++;break;case"introspect":this.metrics.introspectionRequestsTotal++;break;case"userinfo":this.metrics.userInfoRequestsTotal++;break}}createOrUpdateSession(t,e,s,n){for(const h of this.sessions.values())if(h.userId===n.id&&h.clientId===s)return h.lastAccess=t,h.sessionId;const i=`sess-${t}-${Math.random().toString(36).slice(2,8)}`,o=e.ssoSessionIdle*1e3,l=e.ssoSessionMax*1e3,d={sessionId:i,userId:n.id,clientId:s,realm:e.realm,createdAt:t,lastAccess:t,idleTimeoutMs:o,maxLifespanMs:l};return this.sessions.set(i,d),this.metrics.sessionsCreatedTotal++,this.metrics.activeSessions=this.sessions.size,i}touchUserSessions(t,e){if(!this.config)return;const s=this.config.users.find(n=>n.username===e);if(s)for(const n of this.sessions.values())n.userId===s.id&&(n.lastAccess=t)}cleanupExpiredSessions(t){let e=0;for(const[s,n]of this.sessions.entries()){const i=t-n.lastAccess>n.idleTimeoutMs,o=t-n.createdAt>n.maxLifespanMs;(i||o)&&(this.sessions.delete(s),e++)}e>0&&(this.metrics.sessionsExpiredTotal+=e,this.metrics.activeSessions=this.sessions.size)}}class rT{config=null;rules=new Map;threats=[];stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0};rateLimitTracker=new Map;RATE_LIMIT_WINDOW_MS=6e4;ddosTracker=new Map;DDOS_WINDOW_MS=1e3;MAX_THREATS=1e3;initializeConfig(t){const e=t.data.config||{};if(this.config={mode:e.mode||"detection",enableOWASP:e.enableOWASP??!0,owaspRuleset:e.owaspRuleset||"3.3",enableRateLimiting:e.enableRateLimiting??!0,rateLimitPerMinute:e.rateLimitPerMinute||100,enableGeoBlocking:e.enableGeoBlocking??!1,blockedCountries:Array.isArray(e.blockedCountries)?e.blockedCountries:[],enableIPWhitelist:e.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(e.whitelistedIPs)?e.whitelistedIPs:[],enableDDoSProtection:e.enableDDoSProtection??!0,ddosThreshold:e.ddosThreshold||1e3,rules:Array.isArray(e.rules)?e.rules:[]},this.rules.clear(),this.config.rules)for(const s of this.config.rules)s.id&&this.rules.set(s.id,s);this.stats.activeRules=Array.from(this.rules.values()).filter(s=>s.enabled).length}processRequest(t){const e=performance.now(),s=t.timestamp||Date.now(),n=t.sourceIP||"0.0.0.0";if(this.stats.totalRequests++,this.config?.enableIPWhitelist&&this.config.whitelistedIPs?.includes(n))return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e};if(this.config?.enableGeoBlocking&&t.country&&this.config.blockedCountries?.includes(t.country)){const o={id:`threat-${Date.now()}-${Math.random()}`,type:"geo-block",sourceIP:n,target:t.path,timestamp:s,severity:"medium",blocked:!0,details:{country:t.country}};if(this.addThreat(o),this.stats.geoBlockHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:o}}if(this.config?.enableDDoSProtection){const o=this.checkDDoS(n,s);if(o.blocked){const l={id:`threat-${Date.now()}-${Math.random()}`,type:"ddos",sourceIP:n,target:t.path,timestamp:s,severity:"critical",blocked:!0,details:{requestCount:o.count}};if(this.addThreat(l),this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:l}}}if(this.config?.enableRateLimiting){const o=this.checkRateLimit(n,s);if(o.blocked){const l={id:`threat-${Date.now()}-${Math.random()}`,type:"rate-limit",sourceIP:n,target:t.path,timestamp:s,severity:"medium",blocked:!0,details:{requestCount:o.count}};if(this.addThreat(l),this.stats.rateLimitHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:l}}}if(this.config?.enableOWASP){const o=this.checkOWASPRules(t);if(o.detected){const l={id:`threat-${Date.now()}-${Math.random()}`,type:o.threatType||"custom",sourceIP:n,target:t.path,timestamp:s,severity:o.severity||"high",blocked:!0,details:o.details};if(this.addThreat(l),this.stats.owaspHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:l}}}const i=Array.from(this.rules.values()).filter(o=>o.enabled).sort((o,l)=>o.priority-l.priority);for(const o of i){const l=this.matchRule(o,t);if(l.matched){const d={id:`threat-${Date.now()}-${Math.random()}`,type:"custom",sourceIP:n,target:t.path,timestamp:s,severity:l.severity||"medium",blocked:o.action==="block",ruleId:o.id,ruleName:o.name,details:l.details};if(this.addThreat(d),this.stats.threatsDetected++,o.action==="block"&&this.config?.mode==="prevention")return this.stats.blockedRequests++,{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:d,matchedRule:o};if(o.action==="log")continue;if(o.action==="challenge")return{allowed:!1,blocked:!1,action:"challenge",latency:performance.now()-e,threatDetected:d,matchedRule:o}}}return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e}}matchRule(t,e){if(!t.conditions||t.conditions.length===0)return{matched:!1};for(const s of t.conditions){let n,i=!1;switch(s.type){case"ip":n=e.sourceIP;break;case"uri":n=e.path;break;case"method":n=e.method;break;case"header":n=e.headers?.[s.value]||"";break;case"body":n=typeof e.body=="string"?e.body:JSON.stringify(e.body||"");break;case"country":n=e.country;break;case"user-agent":n=e.userAgent;break}if(n===void 0)return{matched:!1};switch(s.operator){case"equals":i=n===s.value;break;case"contains":i=n.toLowerCase().includes(s.value.toLowerCase());break;case"startsWith":i=n.toLowerCase().startsWith(s.value.toLowerCase());break;case"endsWith":i=n.toLowerCase().endsWith(s.value.toLowerCase());break;case"regex":try{i=new RegExp(s.value,"i").test(n)}catch{i=!1}break;case"in":i=s.value.split(",").map(d=>d.trim()).includes(n);break;case"not-in":i=!s.value.split(",").map(d=>d.trim()).includes(n);break}if(!i)return{matched:!1}}return{matched:!0,severity:"medium",details:{matchedConditions:t.conditions.length}}}checkOWASPRules(t){const e=typeof t.body=="string"?t.body:JSON.stringify(t.body||""),s=t.path||"",n=JSON.stringify(t.query||""),i=`${e} ${s} ${n}`.toLowerCase(),o=[/(\bunion\b.*\bselect\b)/i,/(\bselect\b.*\bfrom\b)/i,/(\bdrop\b.*\btable\b)/i,/(\binsert\b.*\binto\b)/i,/(\bdelete\b.*\bfrom\b)/i,/('.*--)/,/(\bor\b.*=.*)/i,/(\band\b.*=.*)/i];for(const f of o)if(f.test(i))return{detected:!0,threatType:"sql-injection",severity:"critical",details:{pattern:f.toString()}};const l=[/<script[^>]*>/i,/javascript:/i,/on\w+\s*=/i,/<iframe[^>]*>/i,/eval\s*\(/i,/expression\s*\(/i];for(const f of l)if(f.test(i))return{detected:!0,threatType:"xss",severity:"high",details:{pattern:f.toString()}};const d=[/\.\.\//,/\.\.\\/,/\.\.%2f/i,/\.\.%5c/i];for(const f of d)if(f.test(i))return{detected:!0,threatType:"path-traversal",severity:"high",details:{pattern:f.toString()}};const h=[/\$\{[^}]*\}/,/\$\([^)]*\)/,/`[^`]*`/,/\|\s*\w+.*\s*\|/];for(const f of h)if(f.test(i))return{detected:!0,threatType:"rce",severity:"critical",details:{pattern:f.toString()}};return{detected:!1}}checkRateLimit(t,e){if(!this.config?.enableRateLimiting||!this.config.rateLimitPerMinute)return{blocked:!1,count:0};const s=e-this.RATE_LIMIT_WINDOW_MS,n=this.rateLimitTracker.get(t)||[],i=n.filter(o=>o>s);return i.length>=this.config.rateLimitPerMinute?{blocked:!0,count:i.length}:(i.push(e),this.rateLimitTracker.set(t,i),n.length>this.config.rateLimitPerMinute*2&&this.rateLimitTracker.set(t,i),{blocked:!1,count:i.length})}checkDDoS(t,e){if(!this.config?.enableDDoSProtection||!this.config.ddosThreshold)return{blocked:!1,count:0};const s=this.ddosTracker.get(t),n=e-this.DDOS_WINDOW_MS;return!s||s.windowStart<n?(this.ddosTracker.set(t,{count:1,windowStart:e}),{blocked:!1,count:1}):(s.count++,this.ddosTracker.set(t,s),s.count>=this.config.ddosThreshold?{blocked:!0,count:s.count}:{blocked:!1,count:s.count})}addThreat(t){this.threats.push(t),this.threats.length>this.MAX_THREATS&&this.threats.shift()}getThreats(t=100){return this.threats.slice(-t).reverse()}getStats(){return{...this.stats}}resetStats(){this.stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:this.stats.activeRules,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0},this.threats=[],this.rateLimitTracker.clear(),this.ddosTracker.clear()}}class cT{config=null;routingEngine;metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:0,averageLatency:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new rT}initializeConfig(t){const e=t.data.config||{};this.config={mode:e.mode||"detection",enableOWASP:e.enableOWASP??!0,owaspRuleset:e.owaspRuleset||"3.3",enableRateLimiting:e.enableRateLimiting??!0,rateLimitPerMinute:e.rateLimitPerMinute||100,enableGeoBlocking:e.enableGeoBlocking??!1,blockedCountries:Array.isArray(e.blockedCountries)?e.blockedCountries:[],enableIPWhitelist:e.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(e.whitelistedIPs)?e.whitelistedIPs:[],enableDDoSProtection:e.enableDDoSProtection??!0,ddosThreshold:e.ddosThreshold||1e3,rules:Array.isArray(e.rules)?e.rules:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),s={path:t.path||"/",method:t.method||"GET",headers:t.headers,query:t.query,body:t.body,sourceIP:t.sourceIP||this.generateRandomIP(),country:t.country||this.generateRandomCountry(),userAgent:t.userAgent||"Mozilla/5.0",timestamp:Date.now()},n=this.routingEngine.processRequest(s),i=performance.now()-e+n.latency;if(this.recordLatency(i),this.metrics.requestsTotal++,n.allowed?this.metrics.requestsAllowed++:(this.metrics.requestsBlocked++,n.blocked&&this.metrics.threatsBlocked++),n.threatDetected){this.metrics.threatsDetected++;const l=this.routingEngine.getStats();this.metrics.rateLimitHits=l.rateLimitHits,this.metrics.geoBlockHits=l.geoBlockHits,this.metrics.ipBlockHits=l.ipBlockHits,this.metrics.owaspHits=l.owaspHits,this.metrics.customRuleHits=l.threatsDetected-l.owaspHits-l.rateLimitHits-l.geoBlockHits-l.ipBlockHits}const o=Date.now();return this.firstRequestTime||(this.firstRequestTime=o),this.lastRequestTime=o,{success:n.allowed,blocked:n.blocked,latency:i,threatDetected:!!n.threatDetected,error:n.error}}simulateRequests(t){const e=Date.now(),s=e-this.lastSimulationTime;if(this.lastSimulationTime=e,s<=0||t<=0)return;const n=Math.floor(t*s/1e3);if(n!==0){for(let i=0;i<n;i++){const o=this.generateRandomRequest();this.processRequest(o)}this.updateMetricsFromStats()}}generateRandomRequest(){const t=["GET","POST","PUT","DELETE","PATCH"],e=["/api/users","/api/products","/api/orders","/api/auth","/api/data"],s=["US","GB","DE","FR","CN","RU","JP"],n=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"],i=Math.random()<.05;let o=e[Math.floor(Math.random()*e.length)],l=null;return i?Math.random()<.5?(o+="?id=1' OR '1'='1",l={query:"SELECT * FROM users WHERE id = '1' OR '1'='1'"}):l={content:'<script>alert("XSS")<\/script>'}:Math.random()<.3&&(l={data:Math.random().toString(36).substring(7)}),{path:o,method:t[Math.floor(Math.random()*t.length)],headers:{"Content-Type":"application/json","User-Agent":n[Math.floor(Math.random()*n.length)]},body:l,sourceIP:this.generateRandomIP(),country:s[Math.floor(Math.random()*s.length)],userAgent:n[Math.floor(Math.random()*n.length)]}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomCountry(){const t=["US","GB","DE","FR","CN","RU","JP","BR","IN","AU"];return t[Math.floor(Math.random()*t.length)]}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.metrics.averageLatency=e/this.latencyHistory.length}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.requestsTotal=t.totalRequests,this.metrics.requestsAllowed=t.allowedRequests,this.metrics.requestsBlocked=t.blockedRequests,this.metrics.threatsDetected=t.threatsDetected,this.metrics.rateLimitHits=t.rateLimitHits,this.metrics.geoBlockHits=t.geoBlockHits,this.metrics.ipBlockHits=t.ipBlockHits,this.metrics.owaspHits=t.owaspHits,this.metrics.activeRules=t.activeRules,this.metrics.customRuleHits=t.threatsDetected-t.owaspHits-t.rateLimitHits-t.geoBlockHits-t.ipBlockHits}calculateLoad(){let t=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const o=(this.lastRequestTime-this.firstRequestTime)/1e3;o>0&&(t=this.metrics.requestsTotal/o)}t===0&&this.simulatedRequestRate>0&&(t=this.simulatedRequestRate);const e=this.metrics.averageLatency||5,s=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,n=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,i=this.metrics.requestsTotal>0?this.metrics.threatsDetected/this.metrics.requestsTotal:0;return{requestsPerSecond:t,averageLatency:e,errorRate:s,blockRate:n,threatDetectionRate:i}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getThreats(t=100){return this.routingEngine.getThreats(t)}getStats(){return this.routingEngine.getStats()}setSimulatedRequestRate(t){this.simulatedRequestRate=t}resetMetrics(){this.metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:this.metrics.activeRules,averageLatency:0},this.latencyHistory=[],this.firstRequestTime=null,this.lastRequestTime=null,this.routingEngine.resetStats()}}class lT{config=null;rules=new Map;logs=[];stats={totalPackets:0,allowedPackets:0,blockedPackets:0,rejectedPackets:0,activeRules:0,totalConnections:0,activeConnections:0};connections=new Map;MAX_CONNECTIONS=1e4;CONNECTION_TIMEOUT_MS=3e5;MAX_LOGS=1e4;initializeConfig(t){const e=t.data.config||{};if(this.config={enableFirewall:e.enableFirewall??!0,enableLogging:e.enableLogging??!0,enableIntrusionDetection:e.enableIntrusionDetection??!1,enableStatefulInspection:e.enableStatefulInspection??!0,defaultPolicy:e.defaultPolicy||"deny",logRetention:e.logRetention||30,rules:Array.isArray(e.rules)?e.rules:[]},this.rules.clear(),this.config.rules)for(const s of this.config.rules)s.id&&s.enabled&&this.rules.set(s.id,s);this.stats.activeRules=Array.from(this.rules.values()).filter(s=>s.enabled).length,this.cleanOldLogs()}processPacket(t){const e=performance.now(),s=t.timestamp||Date.now();if(!this.config?.enableFirewall)return{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e};if(this.stats.totalPackets++,this.config?.enableStatefulInspection){const l=this.getConnectionKey(t),d=this.connections.get(l);if(d){if(d.lastSeen=s,d.packets++,d.state="established",d.state==="established")return this.stats.allowedPackets++,this.logPacket(t,"allowed",void 0,"Established connection"),{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e}}else this.connections.size<this.MAX_CONNECTIONS&&(this.connections.set(l,{source:t.source,destination:t.destination,sourcePort:t.sourcePort||0,destinationPort:t.port||0,protocol:t.protocol,state:"new",firstSeen:s,lastSeen:s,packets:1}),this.stats.totalConnections++)}const n=Array.from(this.rules.values()).filter(l=>l.enabled).sort((l,d)=>d.priority-l.priority);for(const l of n){const d=this.matchRule(l,t);if(d.matched){if(l.hits=(l.hits||0)+1,this.config?.enableLogging&&this.logPacket(t,l.action==="allow"?"allowed":l.action==="deny"?"blocked":"rejected",l,d.reason),l.action==="allow"?this.stats.allowedPackets++:l.action==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,l.action==="allow"&&this.config?.enableStatefulInspection){const h=this.getConnectionKey(t),f=this.connections.get(h);f&&(f.state="established")}return{allowed:l.action==="allow",blocked:l.action==="deny"||l.action==="reject",action:l.action,latency:performance.now()-e,matchedRule:l}}}const i=this.config?.defaultPolicy||"deny",o=i==="allow"?"allowed":i==="deny"?"blocked":"rejected";return this.config?.enableLogging&&this.logPacket(t,o,void 0,`Default policy: ${i}`),i==="allow"?this.stats.allowedPackets++:i==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,{allowed:i==="allow",blocked:i==="deny"||i==="reject",action:i,latency:performance.now()-e}}matchRule(t,e){return t.protocol!=="all"&&t.protocol!==e.protocol?{matched:!1}:t.source&&!this.matchIP(e.source,t.source)?{matched:!1}:t.destination&&!this.matchIP(e.destination,t.destination)?{matched:!1}:(e.protocol==="tcp"||e.protocol==="udp")&&t.port!==void 0&&e.port!==t.port?{matched:!1}:(e.protocol==="tcp"||e.protocol==="udp")&&t.sourcePort!==void 0&&e.sourcePort!==t.sourcePort?{matched:!1}:{matched:!0,reason:`Matched rule: ${t.name}`}}matchIP(t,e){if(t===e)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10);if(isNaN(i)||i<0||i>32)return!1;const o=this.ipToNumber(t),l=this.ipToNumber(s),d=4294967295<<32-i>>>0;return(o&d)===(l&d)}return!1}ipToNumber(t){const e=t.split(".");return e.length!==4?0:(parseInt(e[0],10)<<24)+(parseInt(e[1],10)<<16)+(parseInt(e[2],10)<<8)+parseInt(e[3],10)}getConnectionKey(t){return`${t.source}:${t.sourcePort||0}-${t.destination}:${t.port||0}-${t.protocol}`}logPacket(t,e,s,n){if(!this.config?.enableLogging)return;const i={id:`log-${Date.now()}-${Math.random()}`,timestamp:t.timestamp||Date.now(),action:e,source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,ruleId:s?.id,ruleName:s?.name,reason:n||s?.name};this.logs.push(i),this.logs.length>this.MAX_LOGS&&this.logs.shift()}cleanOldLogs(){if(!this.config?.logRetention)return;const t=this.config.logRetention*24*60*60*1e3,e=Date.now()-t;this.logs=this.logs.filter(s=>s.timestamp>=e)}cleanupConnections(){const t=Date.now(),e=this.CONNECTION_TIMEOUT_MS;for(const[s,n]of this.connections.entries())t-n.lastSeen>e&&this.connections.delete(s);this.stats.activeConnections=this.connections.size}getStats(){return this.stats.activeConnections=this.connections.size,{...this.stats}}getLogs(t){const e=[...this.logs].reverse();return t?e.slice(0,t):e}getRules(){return Array.from(this.rules.values())}getConfig(){return this.config}}class uT{config=null;routingEngine;metrics={packetsTotal:0,packetsAllowed:0,packetsBlocked:0,packetsRejected:0,activeRules:0,totalConnections:0,activeConnections:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new lT}initializeConfig(t){const e=t.data.config||{};this.config={enableFirewall:e.enableFirewall??!0,enableLogging:e.enableLogging??!0,enableIntrusionDetection:e.enableIntrusionDetection??!1,enableStatefulInspection:e.enableStatefulInspection??!0,defaultPolicy:e.defaultPolicy||"deny",logRetention:e.logRetention||30,rules:Array.isArray(e.rules)?e.rules:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){const e=performance.now(),s={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,timestamp:Date.now()},n=this.routingEngine.processPacket(s),i=performance.now()-e;return this.recordLatency(i),this.updateMetricsFromStats(),{success:n.allowed,blocked:n.blocked,latency:i,error:n.blocked?n.matchedRule?.name||`Packet ${n.action}`:void 0}}simulatePackets(t){const e=Date.now(),s=e-this.lastSimulationTime;if(this.lastSimulationTime=e,s<=0||t<=0)return;const n=Math.floor(t*s/1e3);if(n!==0){for(let i=0;i<n;i++){const o=this.generateRandomPacket();this.processPacket(o)}this.updateMetricsFromStats()}}generateRandomPacket(){const t=["tcp","udp","icmp"],e=t[Math.floor(Math.random()*t.length)],s=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,n=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i=e==="icmp"?void 0:Math.floor(Math.random()*65535),o=e==="icmp"?void 0:Math.floor(Math.random()*65535);return{source:s,destination:n,protocol:e,port:i,sourcePort:o}}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}updateMetricsFromStats(){const t=this.routingEngine.getStats();if(this.routingEngine.getRules(),this.metrics.packetsTotal=t.totalPackets,this.metrics.packetsAllowed=t.allowedPackets,this.metrics.packetsBlocked=t.blockedPackets,this.metrics.packetsRejected=t.rejectedPackets,this.metrics.activeRules=t.activeRules,this.metrics.totalConnections=t.totalConnections,this.metrics.activeConnections=t.activeConnections,this.latencyHistory.length>0){const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.metrics.averageLatency=e/this.latencyHistory.length}}setSimulatedPacketRate(t){this.simulatedPacketRate=t}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLogs(t){return this.routingEngine.getLogs(t)}getRules(){return this.routingEngine.getRules()}getConfig(){return this.config}calculateLoad(){let t=0;if(this.firstPacketTime&&this.lastPacketTime){const n=(this.lastPacketTime-this.firstPacketTime)/1e3;n>0&&(t=this.metrics.packetsTotal/n)}t===0&&this.simulatedPacketRate>0&&(t=this.simulatedPacketRate);const e=this.metrics.packetsTotal>0?this.metrics.packetsBlocked/this.metrics.packetsTotal:0,s=this.metrics.packetsTotal>0?this.metrics.packetsRejected/this.metrics.packetsTotal:0;return{packetsPerSecond:t,averageLatency:this.metrics.averageLatency,blockRate:e,rejectionRate:s}}cleanup(){this.routingEngine.cleanupConnections(),this.updateMetricsFromStats()}}class dT{config=null;signatures=new Map;alerts=[];stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0};blockedIPs=new Map;behavioralPatterns=new Map;MAX_BEHAVIORAL_PATTERNS=1e4;BEHAVIORAL_WINDOW_MS=3e5;MAX_ALERTS=1e4;initializeConfig(t){const e=t.data.config||{};if(this.config={mode:e.mode||"ids",enableSignatureDetection:e.enableSignatureDetection??!0,enableAnomalyDetection:e.enableAnomalyDetection??!0,enableBehavioralAnalysis:e.enableBehavioralAnalysis??!1,alertThreshold:e.alertThreshold||"medium",enableAutoBlock:e.enableAutoBlock??!1,blockDuration:e.blockDuration||3600,enableLogging:e.enableLogging??!0,logRetention:e.logRetention||30,signatures:Array.isArray(e.signatures)?e.signatures:[]},this.signatures.clear(),this.config.signatures)for(const s of this.config.signatures)s.id&&s.enabled&&this.signatures.set(s.id,s);if(Array.isArray(e.blockedIPs)){this.blockedIPs.clear();for(const s of e.blockedIPs)if(s.ip){const n=s.expiresAt?new Date(s.expiresAt).getTime():Date.now()+(this.config.blockDuration||3600)*1e3;this.blockedIPs.set(s.ip,{ip:s.ip,reason:s.reason||"Intrusion detected",blockedAt:s.blockedAt?new Date(s.blockedAt).getTime():Date.now(),expiresAt:n})}}this.stats.activeSignatures=Array.from(this.signatures.values()).filter(s=>s.enabled).length,this.stats.blockedIPs=this.blockedIPs.size,this.cleanExpiredBlocks()}processPacket(t){const e=performance.now();if(this.stats.totalPackets++,this.isIPBlocked(t.source))return this.stats.alertsBlocked++,{allowed:!1,blocked:!0,alertGenerated:!1,latency:performance.now()-e,error:`IP ${t.source} is blocked`};this.stats.packetsAnalyzed++;let s,n=!1;if(this.config?.enableSignatureDetection){const o=this.detectSignature(t);if(o&&(s=o,this.stats.signatureMatches++,this.stats.alertsGenerated++,o.signatureId)){const l=this.signatures.get(o.signatureId);l&&l.action==="block"&&this.config.mode==="ips"&&(n=!0)}}if(!s&&this.config?.enableAnomalyDetection){const o=this.detectAnomaly(t);o&&(s=o,this.stats.anomalyDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&o.anomalyScore&&o.anomalyScore>.8&&(n=!0))}if(!s&&this.config?.enableBehavioralAnalysis){const o=this.detectBehavioral(t);o&&(s=o,this.stats.behavioralDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&o.behavioralPattern==="suspicious"&&(n=!0))}n&&this.config?.mode==="ips"&&(this.blockIP(t.source,s?.description||"Intrusion detected",s?.signatureId),this.stats.alertsBlocked++,s=s?{...s,blocked:!0}:void 0),s&&this.shouldGenerateAlert(s.severity)&&this.addAlert(s);const i=performance.now()-e;return{allowed:!n,blocked:n,alertGenerated:!!s,latency:i,alert:s}}detectSignature(t){const e=Array.from(this.signatures.values()).filter(s=>s.enabled).sort((s,n)=>{const i={critical:4,high:3,medium:2,low:1};return i[n.severity]-i[s.severity]});for(const s of e)if(!(s.protocol&&s.protocol!=="all"&&s.protocol!==t.protocol)&&!(s.sourceIP&&!this.matchIP(t.source,s.sourceIP))&&!(s.destinationIP&&!this.matchIP(t.destination,s.destinationIP))&&!(s.port!==void 0&&t.port!==void 0&&s.port!==t.port)&&!(s.sourcePort!==void 0&&t.sourcePort!==void 0&&s.sourcePort!==t.sourcePort)){if(s.pattern&&t.payload)try{if(new RegExp(s.pattern,"i").test(t.payload))return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:s.severity,timestamp:t.timestamp||Date.now(),description:s.description||`Signature match: ${s.name}`,blocked:!1,signature:s.name,signatureId:s.id}}catch{}else if(!s.pattern)return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:s.severity,timestamp:t.timestamp||Date.now(),description:s.description||`Signature match: ${s.name}`,blocked:!1,signature:s.name,signatureId:s.id}}return null}detectAnomaly(t){let e=0;const s=[22,23,80,443,3306,5432,27017,6379,8080];if(t.port&&s.includes(t.port)&&(e+=.2),t.protocol==="icmp"&&(e+=.1),t.payload){const i=t.payload.length;(i>1e4||i<10)&&(e+=.3)}if(t.payload){const i=["SELECT","UNION","DROP","DELETE","INSERT","UPDATE","<script","eval(","base64"];for(const o of i)if(t.payload.toLowerCase().includes(o.toLowerCase())){e+=.4;break}}const n=this.getAnomalyThreshold();if(e>=n){const i=e>=.8?"critical":e>=.6?"high":"medium";return{id:`alert-${Date.now()}-${Math.random()}`,type:"anomaly",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:i,timestamp:t.timestamp||Date.now(),description:`Anomaly detected: unusual network activity (score: ${e.toFixed(2)})`,blocked:!1,anomalyScore:e}}return null}detectBehavioral(t){const e=`${t.source}-${t.destination}-${t.protocol}-${t.port||"any"}`,s=Date.now();let n=this.behavioralPatterns.get(e);n||(n={sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,requestCount:0,firstSeen:s,lastSeen:s,suspiciousScore:0},this.behavioralPatterns.set(e,n)),n.requestCount++,n.lastSeen=s,this.behavioralPatterns.size>this.MAX_BEHAVIORAL_PATTERNS&&this.cleanOldBehavioralPatterns();const i=(s-n.firstSeen)/1e3,o=i>0?n.requestCount/i:n.requestCount;return o>10&&(n.suspiciousScore=Math.min(1,o/100)),n.suspiciousScore>.7?{id:`alert-${Date.now()}-${Math.random()}`,type:"behavioral",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:n.suspiciousScore>.9?"critical":"high",timestamp:s,description:`Behavioral pattern detected: high request rate (${o.toFixed(2)} req/s)`,blocked:!1,behavioralPattern:"suspicious"}:null}isIPBlocked(t){return this.cleanExpiredBlocks(),this.blockedIPs.has(t)}blockIP(t,e,s){const n=Date.now()+(this.config?.blockDuration||3600)*1e3;this.blockedIPs.set(t,{ip:t,reason:e,blockedAt:Date.now(),expiresAt:n}),this.stats.blockedIPs=this.blockedIPs.size}cleanExpiredBlocks(){const t=Date.now();for(const[e,s]of this.blockedIPs.entries())s.expiresAt<t&&this.blockedIPs.delete(e);this.stats.blockedIPs=this.blockedIPs.size}cleanOldBehavioralPatterns(){const t=Date.now();for(const[e,s]of this.behavioralPatterns.entries())t-s.lastSeen>this.BEHAVIORAL_WINDOW_MS&&this.behavioralPatterns.delete(e)}shouldGenerateAlert(t){const e=this.config?.alertThreshold||"medium",s={critical:4,high:3,medium:2,low:1},n={critical:4,high:3,medium:2,low:1};return s[t]>=n[e]}getAnomalyThreshold(){const t=this.config?.alertThreshold||"medium";return{low:.9,medium:.7,high:.5,critical:.3}[t]}matchIP(t,e){if(t===e)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10);return t.startsWith(s.split(".").slice(0,Math.floor(i/8)).join("."))}return!1}addAlert(t){this.alerts.push(t),this.alerts.length>this.MAX_ALERTS&&this.alerts.shift()}getAlerts(t=100){return this.alerts.slice(-t).reverse()}getBlockedIPs(){return this.cleanExpiredBlocks(),Array.from(this.blockedIPs.values())}unblockIP(t){this.blockedIPs.delete(t),this.stats.blockedIPs=this.blockedIPs.size}getStats(){return{...this.stats}}getSignatures(){return Array.from(this.signatures.values())}resetStats(){this.stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.stats.activeSignatures,blockedIPs:this.blockedIPs.size}}}class hT{config=null;routingEngine;metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new dT}initializeConfig(t){const e=t.data.config||{};this.config={mode:e.mode||"ids",enableSignatureDetection:e.enableSignatureDetection??!0,enableAnomalyDetection:e.enableAnomalyDetection??!0,enableBehavioralAnalysis:e.enableBehavioralAnalysis??!1,alertThreshold:e.alertThreshold||"medium",enableAutoBlock:e.enableAutoBlock??!1,blockDuration:e.blockDuration||3600,enableLogging:e.enableLogging??!0,logRetention:e.logRetention||30,signatures:Array.isArray(e.signatures)?e.signatures:[],blockedIPs:Array.isArray(e.blockedIPs)?e.blockedIPs:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){const e=performance.now(),s={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,payload:t.payload,timestamp:Date.now()},n=this.routingEngine.processPacket(s),i=performance.now()-e+n.latency;this.recordLatency(i),this.metrics.packetsTotal++,n.alertGenerated&&this.metrics.alertsGenerated++,n.blocked&&this.metrics.alertsBlocked++;const o=Date.now();return this.firstPacketTime||(this.firstPacketTime=o),this.lastPacketTime=o,this.updateMetricsFromStats(),{success:n.allowed,blocked:n.blocked,latency:i,alertGenerated:n.alertGenerated,error:n.error}}simulatePackets(t){const e=Date.now(),s=e-this.lastSimulationTime;if(this.lastSimulationTime=e,s<=0||t<=0)return;const n=Math.floor(t*s/1e3);if(n!==0){for(let i=0;i<n;i++){const o=this.generateRandomPacket();this.processPacket(o)}this.updateMetricsFromStats()}}generateRandomPacket(){const t=["tcp","udp","icmp"],e=t[Math.floor(Math.random()*t.length)],s=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,n=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i=e==="icmp"?void 0:Math.floor(Math.random()*65535),o=e==="icmp"?void 0:Math.floor(Math.random()*65535),l=Math.random()<.05;let d;if(l){const h=["SELECT * FROM users WHERE id = 1 OR 1=1",'<script>alert("XSS")<\/script>',"DROP TABLE users","UNION SELECT password FROM users","../../../etc/passwd","eval(base64_decode("];d=h[Math.floor(Math.random()*h.length)]}else Math.random()<.3&&(d=`GET /api/data HTTP/1.1\r
Host: example.com\r
User-Agent: Mozilla/5.0`);return{source:s,destination:n,protocol:e,port:i,sourcePort:o,payload:d}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.metrics.averageLatency=e/this.latencyHistory.length}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.packetsTotal=t.totalPackets,this.metrics.packetsAnalyzed=t.packetsAnalyzed,this.metrics.alertsGenerated=t.alertsGenerated,this.metrics.alertsBlocked=t.alertsBlocked,this.metrics.signatureMatches=t.signatureMatches,this.metrics.anomalyDetections=t.anomalyDetections,this.metrics.behavioralDetections=t.behavioralDetections,this.metrics.activeSignatures=t.activeSignatures,this.metrics.blockedIPs=t.blockedIPs}calculateLoad(){let t=0;if(this.firstPacketTime&&this.lastPacketTime&&this.lastPacketTime>this.firstPacketTime){const o=(this.lastPacketTime-this.firstPacketTime)/1e3;o>0&&(t=this.metrics.packetsTotal/o)}t===0&&this.simulatedPacketRate>0&&(t=this.simulatedPacketRate);const e=this.metrics.averageLatency||5,s=this.config?.mode==="ips"&&this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,n=this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,i=this.metrics.packetsTotal>0?this.metrics.alertsGenerated/this.metrics.packetsTotal:0;return{packetsPerSecond:t,averageLatency:e,errorRate:s,blockRate:n,alertRate:i}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getAlerts(t=100){return this.routingEngine.getAlerts(t)}getStats(){return this.routingEngine.getStats()}getBlockedIPs(){return this.routingEngine.getBlockedIPs()}unblockIP(t){this.routingEngine.unblockIP(t),this.updateMetricsFromStats()}setSimulatedPacketRate(t){this.simulatedPacketRate=t}resetMetrics(){this.metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.metrics.activeSignatures,blockedIPs:this.metrics.blockedIPs,averageLatency:0},this.latencyHistory=[],this.firstPacketTime=null,this.lastPacketTime=null,this.routingEngine.resetStats()}}class fT{config=null;metrics={readRequestsTotal:0,writeRequestsTotal:0,deleteRequestsTotal:0,listRequestsTotal:0,authRequestsTotal:0,authErrorsTotal:0,tokenIssuedTotal:0,tokenRenewedTotal:0,tokenRevokedTotal:0,encryptionOperationsTotal:0,decryptionOperationsTotal:0,activeTokens:0,secretsTotal:0};tokens=new Map;secrets=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(t){const e=t.data.config||{},s=Array.isArray(e.secrets)?e.secrets.map(l=>({id:String(l.id??`secret-${Date.now()}`),path:String(l.path??"secret/default"),key:String(l.key??"key"),value:String(l.value??""),version:Number(l.version??1),created:l.created?String(l.created):new Date().toISOString(),updated:l.updated?String(l.updated):new Date().toISOString(),visible:l.visible??!1})):[],n=Array.isArray(e.engines)?e.engines.map(l=>({id:String(l.id??`engine-${Date.now()}`),name:String(l.name??"secret/"),type:l.type??"kv",enabled:l.enabled??!0,version:l.version?Number(l.version):void 0,description:l.description?String(l.description):void 0})):[{id:"1",name:"secret/",type:"kv",enabled:e.enableKV??!0,version:e.kvVersion==="1"?1:2,description:"Key-Value secrets"}],i=Array.isArray(e.policies)?e.policies.map(l=>({id:String(l.id??`policy-${Date.now()}`),name:String(l.name??"default"),rules:String(l.rules??'path "*" { capabilities = ["read"] }'),enabled:l.enabled??!0})):[{id:"1",name:"default",rules:'path "*" { capabilities = ["read", "list"] }',enabled:!0}],o=String(e.tokenTTL||"24h");this.parseTTL(o),this.config={vaultType:e.vaultType||"hashicorp",address:String(e.address||"http://vault:8200"),enableTLS:e.enableTLS??!1,enableTransit:e.enableTransit??!0,enableKV:e.enableKV??!0,kvVersion:String(e.kvVersion||"2"),enablePKI:e.enablePKI??!1,enableAuth:e.enableAuth??!0,authMethod:e.authMethod||"token",tokenTTL:o,secrets:s,engines:n,policies:i},this.secrets.clear(),s.forEach(l=>{this.secrets.set(l.id,l)}),this.metrics.secretsTotal=s.length,this.cleanupExpiredTokens(Date.now())}processReadRequest(t,e,s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.readRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.readRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=Array.from(this.secrets.values()).find(f=>f.path===t&&(!e||f.key===e)),l=15,d=(Math.random()-.5)*10,h=Math.max(5,l+d);return this.recordLatency(h),this.metrics.readRequestsTotal++,o?{success:!0,latency:h,data:{[o.key]:o.value,version:o.version}}:{success:!1,latency:h,error:`Secret not found at path: ${t}`}}processWriteRequest(t,e,s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(60),this.metrics.writeRequestsTotal++,{success:!1,latency:60,error:"Vault not configured"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.writeRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};if(!i.enableKV)return this.recordLatency(20),this.metrics.writeRequestsTotal++,{success:!1,latency:20,error:"KV engine is not enabled"};const o=25,l=(Math.random()-.5)*15,d=Math.max(10,o+l);this.recordLatency(d),this.metrics.writeRequestsTotal++;const h=Array.from(this.secrets.values()).find(f=>f.path===t&&f.key===Object.keys(e)[0]);if(h)h.value=Object.values(e)[0],h.version=(h.version||1)+1,h.updated=new Date().toISOString(),this.secrets.set(h.id,h);else{const f={id:`secret-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,path:t,key:Object.keys(e)[0],value:Object.values(e)[0],version:1,created:new Date().toISOString(),updated:new Date().toISOString(),visible:!1};this.secrets.set(f.id,f),this.metrics.secretsTotal=this.secrets.size}return{success:!0,latency:d,data:{path:t,version:h?.version||1}}}processDeleteRequest(t,e){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const n=this.config;if(!n)return this.recordLatency(50),this.metrics.deleteRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(n.enableAuth&&e&&!this.validateToken(e,s))return this.recordLatency(30),this.metrics.deleteRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const i=20,o=(Math.random()-.5)*10,l=Math.max(8,i+o);this.recordLatency(l),this.metrics.deleteRequestsTotal++;const d=Array.from(this.secrets.values()).find(h=>h.path===t);return d?(this.secrets.delete(d.id),this.metrics.secretsTotal=this.secrets.size,{success:!0,latency:l}):{success:!1,latency:l,error:`Secret not found at path: ${t}`}}processAuthRequest(t,e){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const n=this.config;if(!n)return this.recordLatency(50),this.metrics.authRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!n.enableAuth)return this.recordLatency(20),this.metrics.authRequestsTotal++,{success:!1,latency:20,error:"Authentication is not enabled"};let i=40;t==="ldap"?i=80:t==="approle"?i=50:t==="aws"&&(i=60);const o=(Math.random()-.5)*20,l=Math.max(15,i+o);this.recordLatency(l),this.metrics.authRequestsTotal++;const d=this.parseTTL(n.tokenTTL),h=`vault-token-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,f={id:h,token:h,policies:n.policies.filter(m=>m.enabled).map(m=>m.name),ttl:d,renewable:!0,createdAt:s,expiresAt:s+d*1e3};return this.tokens.set(h,f),this.metrics.tokenIssuedTotal++,this.metrics.activeTokens=this.tokens.size,{success:!0,latency:l,token:h,policies:f.policies}}processEncryptRequest(t,e="default",s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.encryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!i.enableTransit)return this.recordLatency(20),this.metrics.encryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.encryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=t.length,l=30+Math.min(100,o/100),d=(Math.random()-.5)*15,h=Math.max(15,l+d);this.recordLatency(h),this.metrics.encryptionOperationsTotal++;const f=Buffer.from(t).toString("base64");return{success:!0,latency:h,data:{ciphertext:`vault:v1:${f}`,key:e}}}processDecryptRequest(t,e="default",s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.decryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!i.enableTransit)return this.recordLatency(20),this.metrics.decryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.decryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=25+Math.min(80,t.length/150),l=(Math.random()-.5)*12,d=Math.max(12,o+l);this.recordLatency(d),this.metrics.decryptionOperationsTotal++;const h=t.replace(/^vault:v1:/,"");let f;try{f=Buffer.from(h,"base64").toString("utf-8")}catch{return{success:!1,latency:d,error:"Invalid ciphertext format"}}return{success:!0,latency:d,data:{plaintext:f,key:e}}}calculateLoad(){const t=this.metrics,e=t.readRequestsTotal+t.writeRequestsTotal+t.deleteRequestsTotal+t.listRequestsTotal+t.authRequestsTotal+t.encryptionOperationsTotal+t.decryptionOperationsTotal,s=e>0?Math.min(1,t.authErrorsTotal/e):0,n=this.latencyHistory.length>0?this.latencyHistory.reduce((l,d)=>l+d,0)/this.latencyHistory.length:0;let i=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const l=(this.lastRequestTime-this.firstRequestTime)/1e3;i=e/Math.max(l,1)}const o=this.config?.engines.filter(l=>l.enabled).length||0;return{requestsPerSecond:i,averageLatency:n,errorRate:s,activeTokens:this.metrics.activeTokens,secretsCount:this.metrics.secretsTotal,enginesEnabled:o}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}getSecrets(){return Array.from(this.secrets.values())}getActiveTokens(){const t=Date.now();return this.cleanupExpiredTokens(t),Array.from(this.tokens.values())}parseTTL(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 86400;const s=parseInt(e[1],10);switch(e[2]){case"s":return s;case"m":return s*60;case"h":return s*3600;case"d":return s*86400;default:return 86400}}validateToken(t,e){const s=this.tokens.get(t);return s?e>s.expiresAt?(this.tokens.delete(t),this.metrics.activeTokens=this.tokens.size,!1):!0:!1}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}cleanupExpiredTokens(t){let e=0;for(const[s,n]of this.tokens.entries())t>n.expiresAt&&(this.tokens.delete(s),e++);e>0&&(this.metrics.tokenRevokedTotal+=e,this.metrics.activeTokens=this.tokens.size)}}class pT{config=null;pipelines=new Map;activeBuilds=new Map;nodes=new Map;plugins=new Map;jenkinsMetrics={buildsTotal:0,buildsSuccess:0,buildsFailed:0,buildsRunning:0,buildsPending:0,buildsPerMinute:0,averageBuildDuration:0,executorUtilization:0,executorIdle:0,executorBusy:0,pipelinesTotal:0,pipelinesEnabled:0,nodesTotal:0,nodesOnline:0,pluginsTotal:0,pluginsActive:0,artifactStorageBytes:0,requestsTotal:0,requestsErrors:0};processRequest(t=!0){this.jenkinsMetrics.requestsTotal++,t||this.jenkinsMetrics.requestsErrors++}buildHistory=[];MAX_BUILD_HISTORY=1e3;lastBuildTrigger=new Map;buildTriggerCounter=0;artifacts=new Map;initializeConfig(t){const e=t.data.config||{};this.config={jenkinsUrl:e.jenkinsUrl||"http://jenkins:8080",enableCSRF:e.enableCSRF??!0,executorCount:e.executorCount||2,enablePlugins:e.enablePlugins??!0,plugins:e.plugins||["git","docker","kubernetes"],enablePipeline:e.enablePipeline??!0,enableBlueOcean:e.enableBlueOcean??!1,enableArtifactArchiving:e.enableArtifactArchiving??!0,retentionDays:e.retentionDays||30,pipelines:e.pipelines||[],nodes:e.nodes||[],buildTriggerRate:e.buildTriggerRate||.5,averageBuildDuration:e.averageBuildDuration||12e4,failureRate:e.failureRate||.1},this.initializePipelines(),this.initializeNodes(),this.initializePlugins()}initializePipelines(){if(this.pipelines.clear(),!this.config||!this.config.enablePipeline)return;const t=this.config.pipelines||[];for(const e of t){const s=e.lastBuild||0,n={id:e.id,name:e.name,status:"pending",lastBuild:s,lastSuccessfulBuild:void 0,lastFailedBuild:void 0,duration:void 0,branch:e.branch||"main",enabled:e.enabled!==!1,builds:[],nextBuildNumber:s+1};n.config={triggers:e.triggers||[],parameters:e.parameters||[],environmentVariables:e.environmentVariables||{},postBuildActions:e.postBuildActions||[]},this.pipelines.set(n.id,n)}}calculatePipelineStatus(t){return t.builds.length===0?Array.from(this.activeBuilds.values()).find(n=>n.pipelineId===t.id&&n.status==="running")?"running":"pending":t.builds[t.builds.length-1].status}initializeNodes(){this.nodes.clear();const t={id:"master",name:"master",status:"online",numExecutors:this.config?.executorCount||2,busyExecutors:0,idleExecutors:this.config?.executorCount||2,labels:["master"]};this.nodes.set("master",t);const e=this.config?.nodes||[];for(const s of e){const n={id:s.id,name:s.name,status:"online",numExecutors:s.numExecutors||1,busyExecutors:0,idleExecutors:s.numExecutors||1,labels:s.labels||[]};this.nodes.set(n.id,n)}}initializePlugins(){if(this.plugins.clear(),!this.config||!this.config.enablePlugins)return;const t={git:{version:"4.11.0",description:"Git integration plugin"},docker:{version:"1.2.9",description:"Docker pipeline plugin",dependencies:["workflow-aggregator"]},kubernetes:{version:"1.31.1",description:"Kubernetes plugin for dynamic agent provisioning"},"workflow-aggregator":{version:"2.6",description:"Pipeline plugin aggregator"},"blue-ocean":{version:"1.25.3",description:"Blue Ocean UI for Jenkins",dependencies:["workflow-aggregator"]},credentials:{version:"2.6.1",description:"Credentials management plugin"},"ssh-slaves":{version:"1.32.0",description:"SSH agent plugin"},junit:{version:"1.53",description:"JUnit test result publisher"},"maven-plugin":{version:"3.20",description:"Maven integration plugin"},gradle:{version:"1.36.1",description:"Gradle plugin"}},e=this.config.plugins||[];for(const s of e){let n,i=!0;typeof s=="string"?n=s:(n=s.name||s,i=s.enabled!==!1);const o=t[n]||{version:"1.0.0",description:`${n} plugin`},l={name:n,version:o.version,description:o.description,enabled:i,active:i,dependencies:o.dependencies};this.plugins.set(n,l)}this.updatePluginActiveStatus()}updatePluginActiveStatus(){for(const t of this.plugins.values()){if(!t.enabled){t.active=!1;continue}if(t.dependencies&&t.dependencies.length>0){const e=t.dependencies.every(s=>{const n=this.plugins.get(s);return n&&n.enabled&&n.active});t.active=e}else t.active=t.enabled}}addPlugin(t,e,s){if(this.plugins.has(t))return!1;const n={name:t,version:e||"1.0.0",description:s||`${t} plugin`,enabled:!0,active:!0};return this.plugins.set(t,n),this.updatePluginActiveStatus(),!0}removePlugin(t){if(!this.plugins.get(t))return{success:!1,reason:"Plugin not found"};const s=Array.from(this.plugins.values()).filter(n=>n.dependencies?.includes(t));return s.length>0?{success:!1,reason:`Cannot remove plugin. It is required by: ${s.map(n=>n.name).join(", ")}`}:(this.plugins.delete(t),this.updatePluginActiveStatus(),{success:!0})}setPluginEnabled(t,e){const s=this.plugins.get(t);return s?(s.enabled=e,this.updatePluginActiveStatus(),!0):!1}performUpdate(t){this.config&&(this.updateActiveBuilds(t),this.config.enablePipeline&&this.triggerBuilds(t),this.config.enableArtifactArchiving&&this.cleanupArtifacts(t),this.updateMetrics())}updateActiveBuilds(t){const e=Array.from(this.activeBuilds.entries());for(const[s,n]of e)if(n.status==="running")try{n.startTime&&(t-n.startTime)%5e3<100&&this.updateBuildLogs(n,t);const i=t-n.startTime,o=n.estimatedDuration||this.config?.averageBuildDuration||12e4;if(i<0)continue;if(n.progress=Math.min(100,Math.max(0,Math.floor(i/o*100))),i>=o){const l=Math.random()<(this.config?.failureRate||.1);if(n.status=l?"failed":"success",n.duration=i,n.progress=100,n.logs&&(l?(n.logs.push("[Pipeline] FAILED"),n.logs.push(`Build failed after ${(i/1e3).toFixed(1)}s`)):(n.logs.push("[Pipeline] SUCCESS"),n.logs.push(`Build completed successfully in ${(i/1e3).toFixed(1)}s`)),n.logs.push(`Finished: ${n.status}`)),n.stages)for(const h of n.stages)(h.status==="running"||h.status==="pending")&&(h.status=n.status,h.startTime&&(h.duration=t-h.startTime));this.executePostBuildActions(n,n.status==="success");const d=this.pipelines.get(n.pipelineId);d&&(d.lastBuild=n.number,n.status==="success"?d.lastSuccessfulBuild=n.number:n.status==="failed"&&(d.lastFailedBuild=n.number),d.duration=n.duration,d.builds.push(n),d.builds.length>50&&d.builds.shift(),d.status=this.calculatePipelineStatus(d)),this.freeExecutor(s),this.addBuildToHistory(n),this.activeBuilds.delete(s)}}catch(i){console.error(`Error updating build ${s}:`,i),n.status="failed",this.activeBuilds.delete(s),this.freeExecutor(s)}}triggerBuilds(t){if(!(!this.config||!this.config.enablePipeline))for(const[e,s]of this.pipelines.entries()){if(!s.enabled)continue;const i=(s.config||{}).triggers||[];let o=!1;if(i.length===0){const l=this.config.buildTriggerRate||0;if(l>0){const d=6e4/l,h=this.lastBuildTrigger.get(e)||0;t-h>=d&&(o=!0)}}else for(const l of i)if(l.enabled){if(l.type==="cron"&&l.config?.schedule)o=this.shouldTriggerCron(l.config.schedule,e,t);else if(l.type==="scm"&&l.config?.pollInterval){const d=l.config.pollInterval*60*1e3,h=this.lastBuildTrigger.get(`${e}-scm`)||0;t-h>=d&&(o=!0,this.lastBuildTrigger.set(`${e}-scm`,t))}}o&&this.hasAvailableExecutor()&&(this.startBuild(e,t),this.lastBuildTrigger.set(e,t))}}shouldTriggerCron(t,e,s){const n=this.lastBuildTrigger.get(`${e}-cron`)||0,i=60*1e3;return s-n>=i?(this.lastBuildTrigger.set(`${e}-cron`,s),!0):!1}triggerWebhook(t,e,s){const n=this.pipelines.get(t);if(!n)return{success:!1,reason:"Pipeline not found"};if(!n.enabled)return{success:!1,reason:"Pipeline is disabled"};const o=(n.config||{}).triggers||[],l=o.find(h=>h.type==="webhook"&&h.enabled);if(!l&&o.length>0)return{success:!1,reason:"Webhook trigger not configured or disabled"};if(l?.config?.branches&&e&&!l.config.branches.includes(e))return{success:!1,reason:`Branch ${e} not in allowed branches`};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const d=Date.now();return this.startBuild(t,d,{branch:e,commit:s,triggeredBy:"webhook"}),{success:!0}}triggerBuildManually(t){const e=this.pipelines.get(t);if(!e)return{success:!1,reason:"Pipeline not found"};if(!e.enabled)return{success:!1,reason:"Pipeline is disabled"};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const s=Date.now();return this.startBuild(t,s),{success:!0,buildId:`${t}-${e.nextBuildNumber-1}`}}startBuild(t,e,s){const n=this.pipelines.get(t);if(!n)return;const i=n.nextBuildNumber++,o=`${t}-${i}`,l=this.config?.averageBuildDuration||12e4,d=l*.3,h=l+(Math.random()*2-1)*d,f=this.generateBuildLogs(i,n.name,n.branch||"main"),m=this.generateArtifacts(n.name,i),y=n.config||{},b=s?.parameters||{},C=y.parameters||[],S={};for(const T of C)T.defaultValue!==void 0&&(S[T.name]=T.defaultValue);Object.assign(S,b);const R={...y.environmentVariables||{},...S},M={id:o,number:i,pipelineId:t,status:"running",startTime:e,estimatedDuration:h,progress:0,branch:s?.branch||n.branch,commit:s?.commit,logs:f,artifacts:m.map(T=>T.name),triggeredBy:s?.triggeredBy||"system",stages:[{name:"Checkout",status:"running",startTime:e},{name:"Build",status:"pending"},{name:"Test",status:"pending"},{name:"Deploy",status:"pending"}]};M.parameters=S,M.environmentVariables=R,M.postBuildActions=y.postBuildActions||[];for(const T of m)this.artifacts.set(`${o}-${T.name}`,{size:T.size,created:e});this.activeBuilds.set(o,M),n.status=this.calculatePipelineStatus(n),this.allocateExecutor(o),this.jenkinsMetrics.buildsTotal++,this.jenkinsMetrics.buildsRunning++}generateBuildLogs(t,e,s){const n=[];return n.push("Started by system"),n.push(`Building on master in workspace /var/jenkins_home/workspace/${e}`),n.push(`[${e}] $ /usr/bin/git rev-parse --is-inside-work-tree`),n.push("true"),n.push(`[${e}] $ /usr/bin/git config remote.origin.url https://github.com/example/${e}.git`),n.push(`[${e}] $ /usr/bin/git --version`),n.push("git version 2.39.0"),n.push(`[${e}] $ /usr/bin/git fetch --tags --force --progress -- https://github.com/example/${e}.git +refs/heads/${s}:refs/remotes/origin/${s}`),n.push(`From https://github.com/example/${e}`),n.push(` * [new branch]      ${s}       -> origin/${s}`),n.push(`[${e}] $ /usr/bin/git rev-parse "refs/remotes/origin/${s}^{commit}"`),n.push("abc123def456789"),n.push(`[${e}] $ /usr/bin/git checkout -f abc123def456789`),n.push(`HEAD is now at abc123def456789 Commit message for build #${t}`),n.push(`[${e}] $ /usr/bin/git clean -fdx`),n.push("Removing .gradle/"),n.push("Removing build/"),n.push("[Pipeline] Start of Pipeline"),n.push("[Pipeline] node"),n.push(`Running on Jenkins in /var/jenkins_home/workspace/${e}`),n.push("[Pipeline] {"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Checkout)"),n.push("[Pipeline] checkout"),n.push(`Checking out abc123def456789 from ${s}`),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Build)"),n.push("[Pipeline] sh"),n.push('+ echo "Building application..."'),n.push("Building application..."),n.push("[Pipeline] sh"),n.push("+ ./gradlew build -x test"),n.push("> Task :compileJava"),n.push("> Task :processResources"),n.push("> Task :classes"),n.push("> Task :jar"),n.push("BUILD SUCCESSFUL in 45s"),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Test)"),n.push("[Pipeline] sh"),n.push('+ echo "Running tests..."'),n.push("Running tests..."),n.push("[Pipeline] sh"),n.push("+ ./gradlew test"),n.push("> Task :test"),n.push("Test results: 127 passed, 0 failed"),n.push("BUILD SUCCESSFUL in 30s"),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Deploy)"),n.push("[Pipeline] sh"),n.push('+ echo "Deploying to staging..."'),n.push("Deploying to staging..."),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] }"),n.push("[Pipeline] // node"),n.push("[Pipeline] End of Pipeline"),n}generateArtifacts(t,e){const s=[];return s.push({name:`app-${e}.jar`,size:15*1024*1024}),s.push({name:`app-${e}-sources.jar`,size:3*1024*1024}),s.push({name:`test-results-${e}.xml`,size:512*1024}),s.push({name:`coverage-report-${e}.html`,size:2*1024*1024}),s}cancelBuild(t){const e=this.activeBuilds.get(t);if(!e)return{success:!1,reason:"Build not found or already completed"};if(e.status!=="running"&&e.status!=="pending")return{success:!1,reason:"Build is not running"};if(e.status="aborted",e.duration=Date.now()-e.startTime,e.progress=0,e.logs&&(e.logs.push("[Pipeline] Aborted by user"),e.logs.push("[Pipeline] Terminated")),e.stages)for(const n of e.stages)(n.status==="running"||n.status==="pending")&&(n.status="aborted");this.freeExecutor(t);const s=this.pipelines.get(e.pipelineId);return s&&(s.builds.push(e),s.builds.length>50&&s.builds.shift(),s.status=this.calculatePipelineStatus(s),!s.builds.some(i=>i.status==="success")&&s.builds.every(i=>i.status==="aborted"||i.status==="failed")&&(s.status="pending")),this.activeBuilds.delete(t),this.jenkinsMetrics.buildsRunning--,{success:!0}}updateBuildLogs(t,e){if(!t.logs||t.status!=="running")return;const s=e-t.startTime,n=t.estimatedDuration||12e4,i=Math.min(100,Math.floor(s/n*100)),o=[10,30,50,70,90];for(const l of o)i>=l&&!t.logs.some(d=>d.includes(`Progress: ${l}%`))&&t.logs.push(`[Pipeline] Progress: ${l}% completed`);if(t.stages){const l=Math.floor(i/(100/t.stages.length));for(let d=0;d<t.stages.length;d++)(d<l&&t.stages[d].status==="pending"||d===l&&t.stages[d].status==="pending")&&(t.stages[d].status="running",t.stages[d].startTime=e)}}getBuildLogs(t){return this.getBuildById(t)?.logs}getBuildArtifacts(t){const e=this.getBuildById(t);if(!e||!e.artifacts)return[];const s=[];for(const n of e.artifacts){const i=`${t}-${n}`,o=this.artifacts.get(i);o&&s.push({name:n,size:o.size})}return s}executePostBuildActions(t,e){const s=t.postBuildActions||[];for(const n of s)if(n.enabled)switch(n.type){case"email":if(t.logs){const i=n.config?.recipients||["default@example.com"];t.logs.push(`[Post-Build] Sending email notification to: ${i.join(", ")}`),t.logs.push(`[Post-Build] Email subject: Build ${t.status==="success"?"SUCCESS":"FAILED"} - ${t.pipelineId} #${t.number}`)}break;case"archive":if(t.logs){const i=n.config?.archivePattern||"**/*";t.logs.push(`[Post-Build] Archiving artifacts matching pattern: ${i}`),t.artifacts&&t.artifacts.length>0&&t.logs.push(`[Post-Build] Archived ${t.artifacts.length} artifact(s)`)}break;case"publish":if(t.logs){const i=n.config?.publishTarget||"default";t.logs.push(`[Post-Build] Publishing test results to: ${i}`),t.logs.push("[Post-Build] Published build metrics and artifacts")}break;case"deploy":if(e&&n.config?.deployEnv){if(t.logs){const i=n.config.deployEnv;t.logs.push(`[Post-Build] Deploying to environment: ${i}`),t.logs.push(`[Post-Build] Deployment initiated for build #${t.number}`),t.logs.push(`[Post-Build] Deployment to ${i} completed successfully`)}}else e||t.logs&&t.logs.push("[Post-Build] Skipping deployment - build failed");break}}getPipelineConfig(t){const e=this.pipelines.get(t);return e?e.config||{}:null}updatePipelineConfig(t,e){const s=this.pipelines.get(t);return s?(s.config={...s.config||{},...e},!0):!1}hasAvailableExecutor(){for(const t of this.nodes.values())if(t.idleExecutors>0)return!0;return!1}allocateExecutor(t){for(const e of this.nodes.values())if(e.idleExecutors>0){e.idleExecutors--,e.busyExecutors++;return}}freeExecutor(t){for(const e of this.nodes.values())if(e.busyExecutors>0){e.busyExecutors--,e.idleExecutors++;return}}addBuildToHistory(t){t.duration&&(this.buildHistory.push({timestamp:t.startTime,duration:t.duration,status:t.status}),this.buildHistory.length>this.MAX_BUILD_HISTORY&&this.buildHistory.shift(),t.status==="success"?this.jenkinsMetrics.buildsSuccess++:t.status==="failed"&&this.jenkinsMetrics.buildsFailed++,this.jenkinsMetrics.buildsRunning--)}cleanupArtifacts(t){if(!this.config)return;const e=(this.config.retentionDays||30)*24*60*60*1e3;for(const[s,n]of this.artifacts.entries())t-n.created>e&&this.artifacts.delete(s)}updateMetrics(){this.jenkinsMetrics.buildsRunning=this.activeBuilds.size,this.jenkinsMetrics.buildsPending=Array.from(this.activeBuilds.values()).filter(d=>d.status==="pending").length;const t=this.buildHistory.length;this.jenkinsMetrics.buildsTotal=t+this.activeBuilds.size;const e=Date.now()-6e4,s=this.buildHistory.filter(d=>d.timestamp>e);if(this.jenkinsMetrics.buildsPerMinute=s.length,this.buildHistory.length>0){const d=this.buildHistory.slice(-100),h=d.reduce((f,m)=>f+m.duration,0)/d.length;this.jenkinsMetrics.averageBuildDuration=h}let n=0,i=0,o=0;for(const d of this.nodes.values())n+=d.numExecutors,i+=d.busyExecutors,o+=d.idleExecutors;this.jenkinsMetrics.executorBusy=i,this.jenkinsMetrics.executorIdle=o,this.jenkinsMetrics.executorUtilization=n>0?i/n*100:0,this.jenkinsMetrics.pipelinesTotal=this.pipelines.size,this.jenkinsMetrics.pipelinesEnabled=Array.from(this.pipelines.values()).filter(d=>d.enabled).length,this.jenkinsMetrics.nodesTotal=this.nodes.size,this.jenkinsMetrics.nodesOnline=Array.from(this.nodes.values()).filter(d=>d.status==="online").length,this.jenkinsMetrics.pluginsTotal=this.plugins.size,this.jenkinsMetrics.pluginsActive=Array.from(this.plugins.values()).filter(d=>d.active).length;let l=0;for(const d of this.artifacts.values())l+=d.size;this.jenkinsMetrics.artifactStorageBytes=l}getJenkinsMetrics(){return{...this.jenkinsMetrics}}getPipelines(){for(const t of this.pipelines.values())t.status=this.calculatePipelineStatus(t);return Array.from(this.pipelines.values())}getActiveBuilds(){return Array.from(this.activeBuilds.values())}getNodes(){return Array.from(this.nodes.values())}getPlugins(){return Array.from(this.plugins.values())}getPipelineBuilds(t){const e=this.pipelines.get(t);return e?e.builds:[]}getAllBuilds(){const t=[];t.push(...Array.from(this.activeBuilds.values()));for(const e of this.pipelines.values()){const s=e.builds.slice(-50);t.push(...s)}return t.sort((e,s)=>{const n=e.startTime||0;return(s.startTime||0)-n})}getBuildById(t){if(this.activeBuilds.has(t))return this.activeBuilds.get(t);for(const e of this.pipelines.values()){const s=e.builds.find(n=>n.id===t);if(s)return s}}updateConfig(t){const e=this.config,s=new Set(this.pipelines.keys());this.initializeConfig(t);const n=this.config?.executorCount||2;e&&e.executorCount!==n&&this.updateExecutorCount(n);const i=new Set(this.pipelines.keys());for(const h of s)if(!i.has(h)){for(const[f,m]of this.activeBuilds.entries())m.pipelineId===h&&(m.status="aborted",this.freeExecutor(f),this.activeBuilds.delete(f));this.pipelines.delete(h)}const o=this.config?.pipelines||[];for(const h of o){const f=this.pipelines.get(h.id);f&&(f.name=h.name,f.branch=h.branch||"main",f.enabled=h.enabled!==!1,f.config={triggers:h.triggers||[],parameters:h.parameters||[],environmentVariables:h.environmentVariables||{},postBuildActions:h.postBuildActions||[]})}const l=this.config?.nodes||[],d=new Set(this.nodes.keys());for(const h of d)h!=="master"&&!l.find(f=>f.id===h)&&this.nodes.delete(h);for(const h of l){const f=this.nodes.get(h.id);if(f)f.name=h.name,f.numExecutors=h.numExecutors||1,f.labels=h.labels||[],f.idleExecutors=f.numExecutors-f.busyExecutors;else{const m={id:h.id,name:h.name,status:"online",numExecutors:h.numExecutors||1,busyExecutors:0,idleExecutors:h.numExecutors||1,labels:h.labels||[]};this.nodes.set(h.id,m)}}}setPipelineEnabled(t,e){const s=this.pipelines.get(t);return s?(s.enabled=e,!0):!1}updateExecutorCount(t){const e=this.nodes.get("master");return!e||t<e.busyExecutors?!1:(e.numExecutors,e.numExecutors=t,e.idleExecutors=t-e.busyExecutors,!0)}canUpdateExecutorCount(t){const e=this.nodes.get("master");return e?t<1||t>100?{can:!1,reason:"Executor count must be between 1 and 100"}:t<e.busyExecutors?{can:!1,reason:`Cannot reduce executors to ${t}. Currently ${e.busyExecutors} executors are busy.`}:{can:!0}:{can:!1,reason:"Master node not found"}}setPipelineEnabled(t,e){const s=this.pipelines.get(t);return s?(s.enabled=e,!0):!1}calculateComponentMetrics(){const t=this.getJenkinsMetrics(),e=t.buildsPerMinute/60,s=t.averageBuildDuration,n=t.executorUtilization,i=t.buildsSuccess+t.buildsFailed,o=i>0?t.buildsFailed/i*100:0;return{throughput:e,latency:s,utilization:n,errorRate:o}}}class gT{config=null;pipelines=new Map;activeJobs=new Map;runners=new Map;variables=new Map;environments=new Map;schedules=new Map;artifacts=new Map;cacheEntries=new Map;gitlabMetrics={pipelinesTotal:0,pipelinesSuccess:0,pipelinesFailed:0,pipelinesRunning:0,pipelinesPending:0,pipelinesPerHour:0,averagePipelineDuration:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,averageJobDuration:0,runnersTotal:0,runnersOnline:0,runnersBusy:0,runnersIdle:0,runnerUtilization:0,cacheHits:0,cacheMisses:0,cacheHitRate:0,artifactsTotal:0,artifactsSizeBytes:0,requestsTotal:0,requestsErrors:0};pipelineHistory=[];MAX_PIPELINE_HISTORY=1e3;jobHistory=[];MAX_JOB_HISTORY=5e3;lastPipelineTrigger=new Map;pipelineIidCounter=0;scheduleLastRun=new Map;processRequest(t=!0){this.gitlabMetrics.requestsTotal++,t||this.gitlabMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={gitlabUrl:e.gitlabUrl||"https://gitlab.com",projectId:e.projectId||"1",projectUrl:e.projectUrl||"https://gitlab.com/archiphoenix/project",enableRunners:e.enableRunners??!0,runnerType:e.runnerType||"docker",concurrentJobs:e.concurrentJobs||4,enableCache:e.enableCache??!0,cacheType:e.cacheType||"s3",enableArtifacts:e.enableArtifacts??!0,artifactsExpiry:e.artifactsExpiry||"7d",enableKubernetes:e.enableKubernetes??!1,k8sNamespace:e.k8sNamespace||"gitlab-runner",pipelines:e.pipelines||[],runners:e.runners||[],variables:e.variables||[],environments:e.environments||[],schedules:e.schedules||[],pipelineTriggerRate:e.pipelineTriggerRate||2,averagePipelineDuration:e.averagePipelineDuration||3e5,averageJobDuration:e.averageJobDuration||6e4,failureRate:e.failureRate||.1,cacheHitRate:e.cacheHitRate||.7},this.initializePipelines(),this.initializeRunners(),this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}initializePipelines(){this.pipelines.clear();const t=this.config?.pipelines||[];for(const e of t){const s=e.id,i=(e.stages||[{name:"build",jobs:[{name:"build",stage:"build"}]},{name:"test",jobs:[{name:"test",stage:"test"}]},{name:"deploy",jobs:[{name:"deploy",stage:"deploy"}]}]).map(l=>({name:l.name,status:"pending",jobs:(l.jobs||[]).map(d=>({id:`${s}-${l.name}-${d.name}`,name:d.name,stage:l.name,status:"created",pipelineId:s,when:d.when||"on_success",allowFailure:d.allowFailure||!1,tags:d.tags||[],image:d.image,script:d.script||[`echo "Running ${d.name}"`]}))})),o={id:s,iid:++this.pipelineIidCounter,status:"created",ref:e.ref||"main",source:e.source||"push",stages:i,createdAt:Date.now(),updatedAt:Date.now(),variables:{}};this.pipelines.set(s,o)}}initializeRunners(){this.runners.clear();const t=this.config?.runners||[];if(t.length===0&&this.config?.enableRunners){const e={id:"default-runner-1",name:"docker-runner-1",status:"online",runnerType:"project_type",executor:this.config.runnerType||"docker",active:!0,isShared:!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",currentJobs:0,maxJobs:this.config.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(e.id,e);return}for(const e of t){const s={id:e.id,name:e.name,status:"online",runnerType:"project_type",executor:e.executor||this.config?.runnerType||"docker",active:!0,isShared:e.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:e.tags||[],currentJobs:0,maxJobs:e.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(s.id,s)}}initializeVariables(){this.variables.clear();const t=this.config?.variables||[];for(const e of t){const s={key:e.key,value:e.value,variableType:"env_var",protected:e.protected??!1,masked:e.masked??!1,raw:!1,environmentScope:e.environmentScope||"*"};this.variables.set(e.key,s)}}initializeEnvironments(){this.environments.clear();const t=this.config?.environments||[];for(const e of t){const s={id:e.id,name:e.name,slug:e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),externalUrl:e.externalUrl,state:"available",deployments:[]};this.environments.set(e.id,s)}}initializeSchedules(){this.schedules.clear();const t=this.config?.schedules||[];for(const e of t){const s={id:e.id,description:e.description,ref:e.ref,cron:e.cron,active:e.active!==!1,variables:e.variables||{}};s.nextRunAt=this.calculateNextRunTime(s.cron),this.schedules.set(e.id,s)}}calculateNextRunTime(t){const e=Date.now(),s=3600*1e3;return e+s}performUpdate(t){this.config&&(this.updateActiveJobs(t),this.updateActivePipelines(t),this.triggerPipelines(t),this.checkSchedules(t),this.config.enableArtifacts&&this.cleanupArtifacts(t),this.updateMetrics())}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[s,n]of e)if(n.status==="running")try{if(!n.startTime){n.startTime=t;continue}const i=t-n.startTime,o=n.estimatedDuration||this.config?.averageJobDuration||6e4;if(i<0)continue;if(n.progress=Math.min(100,Math.max(0,Math.floor(i/o*100))),i%5e3<100&&n.logs&&this.updateJobLogs(n,i,o),i>=o){const l=Math.random()<(this.config?.failureRate||.1);n.status=l?"failed":"success",n.duration=i,n.progress=100,n.logs&&(l?n.logs.push(`Job ${n.name} failed after ${(i/1e3).toFixed(1)}s`):n.logs.push(`Job ${n.name} succeeded in ${(i/1e3).toFixed(1)}s`)),n.status==="success"&&this.config?.enableArtifacts&&this.generateJobArtifacts(n,t),this.freeRunner(n.runnerId),n.runnerId=void 0,this.updatePipelineStage(n),this.addJobToHistory(n),this.activeJobs.delete(s)}}catch(i){console.error(`Error updating job ${s}:`,i),n.status="failed",this.activeJobs.delete(s),this.freeRunner(n.runnerId)}}updateActivePipelines(t){for(const e of this.pipelines.values()){if(e.status!=="running"&&e.status!=="pending")continue;const s=e.stages.every(n=>n.status==="success"||n.status==="failed"||n.status==="canceled");if(s&&e.status==="running"){const n=e.stages.some(i=>i.status==="failed");e.status=n?"failed":"success",e.finishedAt=t,e.startedAt&&(e.duration=t-e.startedAt),e.status==="success"&&(e.coverage=75+Math.random()*20),this.addPipelineToHistory(e),e.status==="success"?this.gitlabMetrics.pipelinesSuccess++:this.gitlabMetrics.pipelinesFailed++,this.gitlabMetrics.pipelinesRunning--}else if(e.status==="pending"&&!s){const n=e.stages.find(i=>i.status==="pending");n&&this.hasAvailableRunner(n.jobs[0]?.tags)&&(e.status="running",e.startedAt=t,this.startStage(n,e.id,t))}else if(e.status==="running")for(let n=0;n<e.stages.length;n++){const i=e.stages[n],o=n>0?e.stages[n-1]:null;if(i.status==="pending"&&(!o||o.status==="success")){this.startStage(i,e.id,t);break}}e.updatedAt=t}}startStage(t,e,s){t.status="running",t.startTime=s;for(const n of t.jobs)if(n.status==="created"||n.status==="pending"){const i=this.findAvailableRunner(n.tags);i?(n.status="running",n.startTime=s,n.runnerId=i.id,n.estimatedDuration=this.config?.averageJobDuration||6e4,n.progress=0,n.logs=this.generateJobLogs(n),i.currentJobs++,i.busy=i.currentJobs>=i.maxJobs,this.activeJobs.set(n.id,n),this.gitlabMetrics.jobsRunning++):(n.status="pending",this.gitlabMetrics.jobsPending++)}}updateJobLogs(t,e,s){if(!t.logs)return;const n=Math.floor(e/s*100),i=[10,30,50,70,90];for(const o of i)n>=o&&!t.logs.some(l=>l.includes(`Progress: ${o}%`))&&t.logs.push(`[${t.name}] Progress: ${o}% completed`)}generateJobLogs(t){const e=[];if(e.push(`Running with ${t.image||"default"} image`),e.push(`$ ${t.script?.[0]||`echo "Running ${t.name}"`}`),t.script)for(const s of t.script)s.startsWith("echo")?e.push(s.replace("echo ","")):(e.push(`$ ${s}`),e.push(`[output from ${s}]`));return e}generateJobArtifacts(t,e){if(!this.config?.enableArtifacts)return;const s=[{name:`${t.name}-output.log`,size:1024*10,fileType:"text/plain"},{name:`${t.name}-results.json`,size:1024*5,fileType:"application/json"}];for(const n of s){const i=`${t.id}-${n.name}`,o={id:i,jobId:t.id,pipelineId:t.pipelineId,name:n.name,size:n.size,fileType:n.fileType,filename:n.name,createdAt:e},l=parseInt(this.config.artifactsExpiry?.replace("d","")||"7");o.expiresAt=e+l*24*60*60*1e3,this.artifacts.set(i,o),t.artifacts||(t.artifacts=[]),t.artifacts.push(n.name)}}updatePipelineStage(t){const e=this.pipelines.get(t.pipelineId);if(!e)return;const s=e.stages.find(o=>o.name===t.stage);if(!s)return;const n=s.jobs.find(o=>o.id===t.id);if(n&&(n.status=t.status,n.duration=t.duration),s.jobs.every(o=>o.status==="success"||o.status==="failed"||o.status==="canceled"||o.status==="skipped")){const o=s.jobs.some(l=>l.status==="failed"&&!l.allowFailure);s.status=o?"failed":"success",s.startTime&&(s.duration=Date.now()-s.startTime)}}triggerPipelines(t){if(!this.config)return;const e=this.config.pipelineTriggerRate||2,s=3600*1e3/e;for(const[n,i]of this.pipelines.entries()){if(i.status==="running"||i.status==="pending")continue;const o=this.lastPipelineTrigger.get(n)||0;t-o>=s&&(this.startPipeline(n,t),this.lastPipelineTrigger.set(n,t))}}checkSchedules(t){for(const[e,s]of this.schedules.entries())if(s.active&&s.nextRunAt&&t>=s.nextRunAt){const n=Array.from(this.pipelines.values()).find(i=>i.ref===s.ref&&(i.status==="created"||i.status==="success"||i.status==="failed"));n&&(this.startPipeline(n.id,t,"schedule",s.variables),s.lastRunPipelineId=n.id),s.nextRunAt=this.calculateNextRunTime(s.cron),this.scheduleLastRun.set(e,t)}}startPipeline(t,e,s="push",n){const i=this.pipelines.get(t);if(!i)return{success:!1,reason:"Pipeline not found"};if(i.status==="running"||i.status==="pending")return{success:!1,reason:"Pipeline already running"};i.status="pending",i.source=s,i.createdAt=e,i.updatedAt=e,i.startedAt=void 0,i.finishedAt=void 0,i.duration=void 0,i.coverage=void 0,n&&(i.variables={...i.variables,...n});for(const o of i.stages){o.status="pending",o.startTime=void 0,o.duration=void 0;for(const l of o.jobs)l.status="created",l.startTime=void 0,l.duration=void 0,l.progress=0,l.logs=void 0,l.artifacts=void 0,l.runnerId=void 0}return this.gitlabMetrics.pipelinesTotal++,this.gitlabMetrics.pipelinesPending++,{success:!0}}triggerWebhook(t,e){const s=Array.from(this.pipelines.values()).find(i=>i.ref===t&&(i.status==="created"||i.status==="success"||i.status==="failed"));if(!s)return{success:!1,reason:`No pipeline found for ref: ${t}`};const n=this.startPipeline(s.id,Date.now(),"trigger",e);return n.success?{success:!0,pipelineId:s.id}:n}cancelPipeline(t){const e=this.pipelines.get(t);if(!e)return{success:!1,reason:"Pipeline not found"};if(e.status!=="running"&&e.status!=="pending")return{success:!1,reason:"Pipeline is not running"};e.status="canceled",e.finishedAt=Date.now(),e.startedAt&&(e.duration=Date.now()-e.startedAt);for(const s of e.stages){s.status="canceled";for(const n of s.jobs)(n.status==="running"||n.status==="pending")&&(n.status="canceled",this.freeRunner(n.runnerId),this.activeJobs.delete(n.id),this.gitlabMetrics.jobsRunning--)}return this.gitlabMetrics.pipelinesRunning--,{success:!0}}hasAvailableRunner(t){for(const e of this.runners.values())if(!(e.status!=="online"||!e.active)&&!(e.currentJobs>=e.maxJobs)&&!(t&&t.length>0&&(!e.runUntagged&&(!e.tagList||e.tagList.length===0)||e.tagList&&e.tagList.length>0&&!t.some(n=>e.tagList?.includes(n))&&!e.runUntagged)))return!0;return!1}findAvailableRunner(t){for(const e of this.runners.values())if(!(e.status!=="online"||!e.active)&&!(e.currentJobs>=e.maxJobs)&&!(t&&t.length>0&&(!e.runUntagged&&(!e.tagList||e.tagList.length===0)||e.tagList&&e.tagList.length>0&&!t.some(n=>e.tagList?.includes(n))&&!e.runUntagged)))return e}freeRunner(t){if(!t)return;const e=this.runners.get(t);e&&e.currentJobs>0&&(e.currentJobs--,e.busy=e.currentJobs>=e.maxJobs)}addPipelineToHistory(t){t.duration&&(this.pipelineHistory.push({timestamp:t.startedAt||t.createdAt,duration:t.duration,status:t.status}),this.pipelineHistory.length>this.MAX_PIPELINE_HISTORY&&this.pipelineHistory.shift())}addJobToHistory(t){t.duration&&(this.jobHistory.push({timestamp:t.startTime||Date.now(),duration:t.duration,status:t.status}),this.jobHistory.length>this.MAX_JOB_HISTORY&&this.jobHistory.shift(),t.status==="success"?this.gitlabMetrics.jobsSuccess++:t.status==="failed"&&this.gitlabMetrics.jobsFailed++,this.gitlabMetrics.jobsRunning--)}cleanupArtifacts(t){if(!this.config)return;const s=parseInt(this.config.artifactsExpiry?.replace("d","")||"7")*24*60*60*1e3;for(const[n,i]of this.artifacts.entries())i.expiresAt&&t>i.expiresAt?this.artifacts.delete(n):t-i.createdAt>s&&this.artifacts.delete(n)}updateMetrics(){this.gitlabMetrics.pipelinesRunning=Array.from(this.pipelines.values()).filter(h=>h.status==="running").length,this.gitlabMetrics.pipelinesPending=Array.from(this.pipelines.values()).filter(h=>h.status==="pending").length;const t=Date.now()-3600*1e3,e=this.pipelineHistory.filter(h=>h.timestamp>t);if(this.gitlabMetrics.pipelinesPerHour=e.length,this.pipelineHistory.length>0){const h=this.pipelineHistory.slice(-100),f=h.reduce((m,y)=>m+y.duration,0)/h.length;this.gitlabMetrics.averagePipelineDuration=f}if(this.gitlabMetrics.jobsRunning=this.activeJobs.size,this.gitlabMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(h=>h.status==="pending").length,this.jobHistory.length>0){const h=this.jobHistory.slice(-500),f=h.reduce((m,y)=>m+y.duration,0)/h.length;this.gitlabMetrics.averageJobDuration=f}this.gitlabMetrics.runnersTotal=this.runners.size,this.gitlabMetrics.runnersOnline=Array.from(this.runners.values()).filter(h=>h.status==="online").length;let s=0,n=0,i=0;for(const h of this.runners.values())h.status==="online"&&(s+=h.currentJobs,n+=h.maxJobs-h.currentJobs,i+=h.maxJobs);this.gitlabMetrics.runnersBusy=s,this.gitlabMetrics.runnersIdle=n,this.gitlabMetrics.runnerUtilization=i>0?s/i*100:0;const o=this.gitlabMetrics.cacheHits+this.gitlabMetrics.cacheMisses;o>0?this.gitlabMetrics.cacheHitRate=this.gitlabMetrics.cacheHits/o:(this.gitlabMetrics.cacheHits=Math.floor(Math.random()*100),this.gitlabMetrics.cacheMisses=Math.floor(this.gitlabMetrics.cacheHits*.3),this.gitlabMetrics.cacheHitRate=this.config?.cacheHitRate||.7),this.gitlabMetrics.artifactsTotal=this.artifacts.size;let l=0;for(const h of this.artifacts.values())l+=h.size;this.gitlabMetrics.artifactsSizeBytes=l;const d=Array.from(this.pipelines.values()).filter(h=>h.status==="success"&&h.coverage!==void 0);if(d.length>0){const h=d.reduce((f,m)=>f+(m.coverage||0),0)/d.length;this.gitlabMetrics.coverage=h}}getGitLabCIMetrics(){return{...this.gitlabMetrics}}getMetrics(){return this.getGitLabCIMetrics()}getPipelines(){return Array.from(this.pipelines.values())}getPipeline(t){return this.pipelines.get(t)}getActiveJobs(){return Array.from(this.activeJobs.values())}getJob(t){if(this.activeJobs.has(t))return this.activeJobs.get(t);for(const e of this.pipelines.values())for(const s of e.stages){const n=s.jobs.find(i=>i.id===t);if(n)return n}}getRunners(){return Array.from(this.runners.values())}getVariables(){return Array.from(this.variables.values())}getEnvironments(){return Array.from(this.environments.values())}getSchedules(){return Array.from(this.schedules.values())}getArtifacts(){return Array.from(this.artifacts.values())}getJobLogs(t){return this.getJob(t)?.logs}updateConfig(t){this.config;const e=new Set(this.pipelines.keys());this.initializeConfig(t);const s=new Set(this.pipelines.keys());for(const l of e)if(!s.has(l)){for(const[d,h]of this.activeJobs.entries())h.pipelineId===l&&(h.status="canceled",this.freeRunner(h.runnerId),this.activeJobs.delete(d));this.pipelines.delete(l)}const n=this.config?.pipelines||[];for(const l of n){const d=this.pipelines.get(l.id);d&&(d.ref=l.ref||d.ref,d.source=l.source||d.source,d.status!=="running"&&d.status)}const i=this.config?.runners||[],o=new Set(this.runners.keys());for(const l of o)if(!i.find(d=>d.id===l)){for(const[d,h]of this.activeJobs.entries())h.runnerId===l&&(h.status="canceled",this.activeJobs.delete(d));this.runners.delete(l)}for(const l of i){const d=this.runners.get(l.id);if(d)d.name=l.name,d.executor=l.executor||d.executor,d.maxJobs=l.maxJobs||d.maxJobs,d.tagList=l.tags||d.tagList,d.isShared=l.isShared??d.isShared;else{const h={id:l.id,name:l.name,status:"online",runnerType:"project_type",executor:l.executor||this.config?.runnerType||"docker",active:!0,isShared:l.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:l.tags||[],currentJobs:0,maxJobs:l.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(l.id,h)}}this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}calculateComponentMetrics(){const t=this.getGitLabCIMetrics(),e=t.pipelinesPerHour/3600,s=t.averagePipelineDuration,n=t.runnerUtilization/100,i=t.pipelinesSuccess+t.pipelinesFailed,o=i>0?t.pipelinesFailed/i:0;return{throughput:e,latency:s,utilization:n,errorRate:o}}}class mT{config=null;applications=new Map;repositories=new Map;projects=new Map;syncOperations=new Map;argoMetrics={applicationsTotal:0,applicationsSynced:0,applicationsOutOfSync:0,applicationsProgressing:0,applicationsDegraded:0,applicationsHealthy:0,syncOperationsTotal:0,syncOperationsSuccess:0,syncOperationsFailed:0,syncOperationsRunning:0,syncRate:0,averageSyncDuration:0,repositoriesTotal:0,repositoriesConnected:0,repositoriesFailed:0,projectsTotal:0,requestsTotal:0,requestsErrors:0};syncHistory=[];MAX_SYNC_HISTORY=1e3;lastSyncTime=new Map;lastHealthCheck=new Map;processRequest(t=!0){this.argoMetrics.requestsTotal++,t||this.argoMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||e.argoUrl||"https://argocd.example.com",enableSSO:e.enableSSO??!1,ssoProvider:e.ssoProvider||"oidc",enableRBAC:e.enableRBAC??!0,enableSyncPolicy:e.enableSyncPolicy??!0,autoSync:e.autoSync??!1,syncPolicy:e.syncPolicy||"manual",enableHealthChecks:e.enableHealthChecks??!0,enableNotifications:e.enableNotifications??!0,notificationChannels:e.notificationChannels||["slack"],applications:e.applications||[],repositories:e.repositories||[],projects:e.projects||[],syncRate:e.syncRate||1,averageSyncDuration:e.averageSyncDuration||3e4,failureRate:e.failureRate||.05,healthCheckInterval:e.healthCheckInterval||3e5},this.initializeApplications(),this.initializeRepositories(),this.initializeProjects()}initializeApplications(){this.applications.clear();const t=this.config?.applications||[];if(t.length===0){const e={name:"web-app",namespace:"production",project:"default",repository:"https://github.com/example/web-app",path:"k8s",targetRevision:"main",destination:{server:"https://kubernetes.default.svc",namespace:"production"},syncPolicy:this.config?.syncPolicy||"manual",status:"synced",health:"healthy",lastSync:Date.now()-12e4,revision:"abc123",sourceRevision:"abc123"};this.applications.set(e.name,e);return}for(const e of t){const s={name:e.name,namespace:e.namespace,project:e.project||"default",repository:e.repository,path:e.path||".",targetRevision:e.targetRevision||"main",destination:e.destination||{server:"https://kubernetes.default.svc",namespace:e.namespace||"default"},syncPolicy:e.syncPolicy||this.config?.syncPolicy||"manual",status:e.status||"synced",health:e.health||"healthy",lastSync:Date.now()-Math.random()*36e5,revision:this.generateRevision(),sourceRevision:this.generateRevision()};this.applications.set(s.name,s)}}initializeRepositories(){this.repositories.clear();const t=this.config?.repositories||[],e=new Set;for(const s of this.applications.values())e.add(s.repository);for(const s of t){const n={name:s.name||s.url,url:s.url,type:s.type||"git",username:s.username,password:s.password,insecure:s.insecure??!1,project:s.project,connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(n.name,n)}for(const s of e)if(!this.repositories.has(s)){const n={name:s,url:s,type:"git",connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(s,n)}}initializeProjects(){this.projects.clear();const t=this.config?.projects||[];if(t.length===0){const e={name:"default",description:"Default project",sourceRepos:["*"],destinations:[{server:"*",namespace:"*"}]};this.projects.set("default",e);return}for(const e of t){const s={name:e.name,description:e.description,sourceRepos:e.sourceRepos||["*"],destinations:e.destinations||[{server:"*",namespace:"*"}]};this.projects.set(s.name,s)}}generateRevision(){return Math.random().toString(36).substring(2,8)}performUpdate(t){this.config&&(this.updateSyncOperations(t),(this.config.autoSync||this.config.syncPolicy==="automated")&&this.triggerAutoSyncs(t),this.config.enableHealthChecks&&this.performHealthChecks(t),this.checkRepositoryConnections(t),this.updateMetrics())}updateSyncOperations(t){const e=Array.from(this.syncOperations.entries());for(const[s,n]of e){if(n.status!=="running")continue;if(!n.startedAt){n.startedAt=t;continue}const i=t-n.startedAt,o=this.config?.averageSyncDuration||3e4;if(i>=o){const l=Math.random()<(this.config?.failureRate||.05);n.status=l?"failed":"success",n.finishedAt=t,l&&(n.error="Sync failed: resource conflict or validation error");const d=this.applications.get(n.application);d&&(n.status==="success"?(d.status="synced",d.health="healthy",d.lastSync=t,d.lastSyncDuration=i,d.revision=d.sourceRevision=this.generateRevision(),d.history||(d.history=[]),d.history.unshift({id:s,revision:d.revision,deployedAt:t}),d.history.length>10&&d.history.pop()):(d.status="degraded",d.health="degraded")),this.addSyncToHistory(n),n.status==="success"?this.argoMetrics.syncOperationsSuccess++:this.argoMetrics.syncOperationsFailed++,this.argoMetrics.syncOperationsRunning--,this.syncOperations.delete(s)}}}triggerAutoSyncs(t){const s=36e5/(this.config?.syncRate||1);for(const n of this.applications.values()){if(n.syncPolicy!=="automated"&&n.syncPolicy!=="auto")continue;const i=this.lastSyncTime.get(n.name)||n.lastSync||0;t-i>=s&&(n.status==="outofsync"||n.status==="synced")&&(this.startSync(n.name,t),this.lastSyncTime.set(n.name,t))}}performHealthChecks(t){const e=this.config?.healthCheckInterval||3e5;for(const s of this.applications.values()){const n=this.lastHealthCheck.get(s.name)||0;t-n>=e&&(Math.random()<.05&&s.health==="healthy"?(s.health="degraded",s.status="degraded"):s.health==="degraded"&&Math.random()<.3&&(s.health="healthy",s.status==="degraded"&&(s.status="synced")),this.lastHealthCheck.set(s.name,t))}}checkRepositoryConnections(t){for(const s of this.repositories.values()){const n=s.lastVerifiedAt||0;t-n>=6e5&&(Math.random()<.95?(s.connectionStatus="successful",s.lastVerifiedAt=t,s.lastConnectionError=void 0):(s.connectionStatus="failed",s.lastConnectionError="Connection timeout or authentication failed",s.lastVerifiedAt=t))}}startSync(t,e=Date.now()){const s=this.applications.get(t);if(!s||Array.from(this.syncOperations.values()).find(l=>l.application===t&&l.status==="running"))return!1;const i=`sync-${t}-${e}`,o={id:i,application:t,startedAt:e,status:"running",phase:"sync"};return this.syncOperations.set(i,o),this.argoMetrics.syncOperationsRunning++,this.argoMetrics.syncOperationsTotal++,s.status="progressing",s.syncStartedAt=e,!0}updateMetrics(){if(this.argoMetrics.applicationsTotal=this.applications.size,this.argoMetrics.applicationsSynced=Array.from(this.applications.values()).filter(t=>t.status==="synced").length,this.argoMetrics.applicationsOutOfSync=Array.from(this.applications.values()).filter(t=>t.status==="outofsync").length,this.argoMetrics.applicationsProgressing=Array.from(this.applications.values()).filter(t=>t.status==="progressing").length,this.argoMetrics.applicationsDegraded=Array.from(this.applications.values()).filter(t=>t.status==="degraded").length,this.argoMetrics.applicationsHealthy=Array.from(this.applications.values()).filter(t=>t.health==="healthy").length,this.argoMetrics.repositoriesTotal=this.repositories.size,this.argoMetrics.repositoriesConnected=Array.from(this.repositories.values()).filter(t=>t.connectionStatus==="successful").length,this.argoMetrics.repositoriesFailed=Array.from(this.repositories.values()).filter(t=>t.connectionStatus==="failed").length,this.argoMetrics.projectsTotal=this.projects.size,this.syncHistory.length>0){const t=Date.now()-36e5,e=this.syncHistory.filter(n=>n.timestamp>=t).length;this.argoMetrics.syncRate=e;const s=this.syncHistory.filter(n=>n.status==="success");if(s.length>0){const n=s.reduce((i,o)=>i+o.duration,0);this.argoMetrics.averageSyncDuration=n/s.length}}}addSyncToHistory(t){if(!t.finishedAt||!t.startedAt)return;const e=t.finishedAt-t.startedAt,s=t.status==="success"?"success":"failed";this.syncHistory.push({timestamp:t.finishedAt,duration:e,status:s}),this.syncHistory.length>this.MAX_SYNC_HISTORY&&this.syncHistory.shift()}getMetrics(){return{...this.argoMetrics}}getApplications(){return Array.from(this.applications.values())}getApplication(t){return this.applications.get(t)}addApplication(t){this.applications.set(t.name,t)}removeApplication(t){return this.applications.delete(t)}updateApplication(t,e){const s=this.applications.get(t);return s?(this.applications.set(t,{...s,...e}),!0):!1}getRepositories(){return Array.from(this.repositories.values())}getRepository(t){return this.repositories.get(t)}addRepository(t){this.repositories.set(t.name,t)}removeRepository(t){return this.repositories.delete(t)}updateRepository(t,e){const s=this.repositories.get(t);return s?(this.repositories.set(t,{...s,...e}),!0):!1}getProjects(){return Array.from(this.projects.values())}getProject(t){return this.projects.get(t)}addProject(t){this.projects.set(t.name,t)}updateProject(t,e){const s=this.projects.get(t);return s?(this.projects.set(t,{...s,...e}),!0):!1}removeProject(t){return this.projects.delete(t)}getSyncOperations(){return Array.from(this.syncOperations.values())}getStats(){return{metrics:this.getMetrics(),applications:this.getApplications(),repositories:this.getRepositories(),projects:this.getProjects(),activeSyncs:this.getSyncOperations()}}}class yT{config=null;workspaces=new Map;activeRuns=new Map;runHistory=new Map;MAX_RUN_HISTORY=1e3;states=new Map;terraformMetrics={workspacesTotal:0,runsTotal:0,runsSuccess:0,runsFailed:0,runsRunning:0,runsPending:0,runsPerHour:0,averageRunDuration:0,statesTotal:0,resourcesManaged:0,requestsTotal:0,requestsErrors:0};runHistoryList=[];MAX_RUN_HISTORY_LIST=1e3;lastRunTime=new Map;lastVCSWebhook=new Map;processRequest(t=!0){this.terraformMetrics.requestsTotal++,t||this.terraformMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={organizationName:e.organizationName||"archiphoenix",enableVCS:e.enableVCS??!0,enableStateLocking:e.enableStateLocking??!0,enableRemoteState:e.enableRemoteState??!0,defaultTerraformVersion:e.defaultTerraformVersion||"1.5.0",workspaces:e.workspaces||[],runs:e.runs||[],states:e.states||[],runTriggerRate:e.runTriggerRate||.5,averagePlanDuration:e.averagePlanDuration||3e4,averageApplyDuration:e.averageApplyDuration||12e4,failureRate:e.failureRate??.05,changeProbability:e.changeProbability??.7,maxResourceAdditions:e.maxResourceAdditions||10,maxResourceChanges:e.maxResourceChanges||5,maxResourceDestructions:e.maxResourceDestructions||3,vcsWebhookProbability:e.vcsWebhookProbability??.3,defaultStateResources:e.defaultStateResources||10,durationVariation:e.durationVariation??.3,resourceTimeMultiplier:e.resourceTimeMultiplier||500},this.initializeWorkspaces(),this.initializeRuns(),this.initializeStates()}updateConfig(t){this.initializeConfig(t)}initializeWorkspaces(){this.workspaces.clear();const t=this.config?.workspaces||[];if(t.length===0){const e={id:"default",name:"production",description:"Production infrastructure",terraformVersion:this.config?.defaultTerraformVersion||"1.5.0",autoApply:!1,queueAllRuns:!0,workingDirectory:"/terraform"};this.workspaces.set("default",e);return}for(const e of t){const s={id:e.id,name:e.name,description:e.description,terraformVersion:e.terraformVersion||this.config?.defaultTerraformVersion||"1.5.0",autoApply:e.autoApply??!1,queueAllRuns:e.queueAllRuns??!0,workingDirectory:e.workingDirectory,vcsRepo:e.vcsRepo,variables:e.variables||[]};this.workspaces.set(s.id,s)}}initializeRuns(){const t=new Set(Array.from(this.activeRuns.keys())),e=new Set((this.config?.runs||[]).map(n=>n.id));for(const[n,i]of this.runHistory.entries())!t.has(n)&&!e.has(n)&&this.runHistory.delete(n);const s=this.config?.runs||[];for(const n of s){const i=this.workspaces.values().next().value;if(!i)continue;const o={id:n.id,workspaceId:i.id,workspaceName:n.workspace||i.name,status:n.status||"applied",createdAt:n.createdAt?new Date(n.createdAt).getTime():Date.now()-36e5,finishedAt:n.createdAt?new Date(n.createdAt).getTime()+(n.duration||12e4):Date.now()-348e4,duration:n.duration||12e4,planOnly:n.planOnly??!1,message:n.message,hasChanges:n.status==="applied"};["pending","planning","applying"].includes(o.status)?this.activeRuns.set(o.id,o):this.runHistory.set(o.id,o)}}initializeStates(){this.states.clear();const t=this.config?.states||[];if(t.length===0){const e=this.config?.defaultStateResources||10;for(const s of this.workspaces.values()){const n={id:`state-${s.id}`,workspaceId:s.id,workspaceName:s.name,version:1,serial:1,resources:e,updatedAt:Date.now()-(36e5+Math.random()*36e5),createdAt:Date.now()-(864e5+Math.random()*864e5)};this.states.set(n.id,n)}return}for(const e of t){const s=Array.from(this.workspaces.values()).find(i=>i.name===e.workspace);if(!s)continue;const n={id:e.id,workspaceId:s.id,workspaceName:e.workspace,version:e.version||1,serial:e.serial||1,resources:e.resources,updatedAt:e.updatedAt?new Date(e.updatedAt).getTime():Date.now(),createdAt:e.updatedAt?new Date(e.updatedAt).getTime()-864e5:Date.now()-864e5};this.states.set(n.id,n)}}performUpdate(t){this.config&&(this.updateActiveRuns(t),this.config.enableVCS&&this.triggerVCSWebhooks(t),this.triggerAutoRuns(t),this.updateMetrics())}updateActiveRuns(t){const e=Array.from(this.activeRuns.entries());for(const[s,n]of e){if(!["pending","planning","applying"].includes(n.status)){if(this.runHistory.set(s,n),this.runHistory.size>this.MAX_RUN_HISTORY){const R=this.runHistory.keys().next().value;R&&this.runHistory.delete(R)}this.activeRuns.delete(s);continue}if(!n.startedAt){n.startedAt=t;continue}const i=t-n.startedAt;let o;const d=this.getStateForWorkspace(n.workspaceId)?.resources||this.config?.defaultStateResources||10,h=this.config?.resourceTimeMultiplier||500,f=this.config?.averagePlanDuration||3e4,m=this.config?.averageApplyDuration||12e4,y=this.config?.durationVariation||.3,b=Math.log10(Math.max(1,d))*h,C=f+b,S=m+b*2;if(n.status==="pending"){n.status="planning";const M=n.estimatedPlanDuration||C,T=M*y*(Math.random()*2-1);o=M+T}else if(n.status==="planning"){const R=C*y*(Math.random()*2-1);if(o=C+R,i>=o){const M=this.config?.changeProbability??.7,T=Math.random()<M;if(n.hasChanges=T,T){const E=this.config?.maxResourceAdditions||10,A=this.config?.maxResourceChanges||5,_=this.config?.maxResourceDestructions||3,N=Math.min(1.5,1+d/100);n.resourceAdditions=Math.floor(Math.random()*E*N)+1,n.resourceChanges=Math.floor(Math.random()*A*N),n.resourceDestructions=Math.floor(Math.random()*_*N)}else n.resourceAdditions=0,n.resourceChanges=0,n.resourceDestructions=0;if(n.planOnly)n.status="planned",n.finishedAt=t,n.duration=i,n.message=T?`Plan completed with ${n.resourceAdditions+n.resourceChanges+n.resourceDestructions} changes`:"No changes detected";else if(this.workspaces.get(n.workspaceId)?.autoApply&&T){n.status="applying";const A=S*y*(Math.random()*2-1);o=S+A}else T?(n.status="planned",n.message=`Plan completed. ${n.resourceAdditions+n.resourceChanges+n.resourceDestructions} changes detected.`):(n.status="applied",n.finishedAt=t,n.duration=i,n.message="No changes detected")}}else if(n.status==="applying"){const R=S*y*(Math.random()*2-1);if(o=S+R,i>=o){const M=this.config?.failureRate??.05,T=Math.random()<M;n.status=T?"errored":"applied",n.finishedAt=t,n.duration=i,T?(n.error="Apply failed: resource provisioning error or validation failure",n.message=n.error):(n.message="Apply completed successfully",this.updateStateAfterApply(n))}}}}updateStateAfterApply(t){const e=Array.from(this.states.values()).find(n=>n.workspaceId===t.workspaceId);if(!e)return;e.version++,e.serial++,e.updatedAt=Date.now(),t.resourceAdditions!==void 0&&(e.resources=(e.resources||0)+t.resourceAdditions,t.resourceDestructions!==void 0&&(e.resources=Math.max(0,e.resources-t.resourceDestructions)));const s=this.workspaces.get(t.workspaceId);s&&(s.lastRun={id:t.id,status:t.status,createdAt:t.finishedAt||Date.now()})}triggerVCSWebhooks(t){for(const s of this.workspaces.values()){if(!s.vcsRepo)continue;const n=this.lastVCSWebhook.get(s.id)||0;if(t-n<36e5)continue;const i=this.config?.vcsWebhookProbability??.3;Math.random()<i&&(this.lastVCSWebhook.set(s.id,t),this.triggerRun(s.id,{source:"vcs"}))}}triggerAutoRuns(t){const s=36e5/(this.config?.runTriggerRate||.5);for(const n of this.workspaces.values()){const i=this.lastRunTime.get(n.id)||0;t-i>=s&&!Array.from(this.activeRuns.values()).some(d=>d.workspaceId===n.id&&["pending","planning","applying"].includes(d.status))&&n.queueAllRuns&&(this.lastRunTime.set(n.id,t),this.triggerRun(n.id,{source:"scheduled"}))}}triggerRun(t,e){const s=this.workspaces.get(t);if(!s)return{success:!1,reason:"Workspace not found"};if(Array.from(this.activeRuns.values()).some(b=>b.workspaceId===t&&["pending","planning","applying"].includes(b.status))&&!s.queueAllRuns)return{success:!1,reason:"Workspace already has an active run"};const i=Date.now(),o=`run-${t}-${i}`,d=this.getStateForWorkspace(t)?.resources||this.config?.defaultStateResources||10,h=this.config?.resourceTimeMultiplier||500,f=this.config?.averagePlanDuration||3e4,m=Math.log10(Math.max(1,d))*h,y={id:o,workspaceId:s.id,workspaceName:s.name,status:"pending",createdAt:i,planOnly:e?.planOnly??!1,source:e?.source||"api",triggeredBy:e?.triggeredBy||"user"};return y.estimatedPlanDuration=f+m,this.activeRuns.set(o,y),this.terraformMetrics.runsTotal++,this.terraformMetrics.runsPending++,s.lastRun={id:o,status:"pending",createdAt:i},{success:!0,runId:o}}cancelRun(t){const e=this.activeRuns.get(t);if(!e)return{success:!1,reason:"Run not found or not active"};if(!["pending","planning","applying"].includes(e.status))return{success:!1,reason:"Run is not in a cancelable state"};if(e.status="canceled",e.finishedAt=Date.now(),e.duration=e.startedAt?Date.now()-e.startedAt:0,e.message="Run canceled by user",this.runHistory.set(t,e),this.runHistory.size>this.MAX_RUN_HISTORY){const s=this.runHistory.keys().next().value;s&&this.runHistory.delete(s)}return this.activeRuns.delete(t),{success:!0}}updateMetrics(){const t=Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values()));this.terraformMetrics.workspacesTotal=this.workspaces.size,this.terraformMetrics.statesTotal=this.states.size,this.terraformMetrics.runsRunning=Array.from(this.activeRuns.values()).filter(i=>["planning","applying"].includes(i.status)).length,this.terraformMetrics.runsPending=Array.from(this.activeRuns.values()).filter(i=>i.status==="pending").length,this.terraformMetrics.runsSuccess=t.filter(i=>i.status==="applied").length,this.terraformMetrics.runsFailed=t.filter(i=>i.status==="errored").length,this.terraformMetrics.resourcesManaged=Array.from(this.states.values()).reduce((i,o)=>i+(o.resources||0),0);const e=t.filter(i=>i.duration!==void 0);if(e.length>0){const i=e.reduce((o,l)=>o+(l.duration||0),0);this.terraformMetrics.averageRunDuration=i/e.length}const s=Date.now()-36e5,n=this.runHistoryList.filter(i=>i.timestamp>=s);this.terraformMetrics.runsPerHour=n.length}addRunToHistory(t){t.duration!==void 0&&(this.runHistoryList.push({timestamp:t.finishedAt||Date.now(),duration:t.duration,status:t.status}),this.runHistoryList.length>this.MAX_RUN_HISTORY_LIST&&this.runHistoryList.shift())}getMetrics(){return{...this.terraformMetrics}}getWorkspace(t){return this.workspaces.get(t)}getWorkspaces(){return Array.from(this.workspaces.values())}getRun(t){return this.activeRuns.get(t)||this.runHistory.get(t)}getActiveRuns(){return Array.from(this.activeRuns.values())}getRunsForWorkspace(t,e=100){return Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values())).filter(n=>n.workspaceId===t).sort((n,i)=>(i.createdAt||0)-(n.createdAt||0)).slice(0,e)}getStateForWorkspace(t){return Array.from(this.states.values()).find(e=>e.workspaceId===t)}getStates(){return Array.from(this.states.values())}getConfig(){return this.config}}class vT{config=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;pushLatencyHistory=[];pullLatencyHistory=[];scanLatencyHistory=[];MAX_LATENCY_HISTORY=500;harborMetrics={pushOperationsPerSecond:0,pullOperationsPerSecond:0,scanOperationsPerSecond:0,replicationOperationsPerSecond:0,averagePushLatency:0,averagePullLatency:0,averageScanLatency:0,storageUsed:0,storageTotal:100,totalProjects:0,totalRepositories:0,totalTags:0,totalVulnerabilities:0,scansCompleted:0,scansRunning:0,scansFailed:0,replicationPoliciesEnabled:0,activeReplications:0,gcOperationsTotal:0,gcStorageFreed:0};lastGCRun=0;initializeConfig(t){const e=t.data.config||{};this.config=e,this.updateMetricsFromConfig()}updateConfig(t){const e=t.data.config||{};this.config=e,this.updateMetricsFromConfig()}updateMetricsFromConfig(){if(!this.config)return;this.harborMetrics.totalProjects=this.config.projects?.length||0,this.harborMetrics.totalRepositories=this.config.repositories?.length||0,this.harborMetrics.totalTags=this.config.tags?.length||0;let t=0;this.config.projects&&(t=this.config.projects.reduce((s,n)=>s+(n.storageUsed||0),0)),this.harborMetrics.storageUsed=t;let e=0;this.config.tags&&this.config.tags.forEach(s=>{s.vulnerabilityScan?.totalVulnerabilities&&(e+=s.vulnerabilityScan.totalVulnerabilities)}),this.harborMetrics.totalVulnerabilities=e,this.harborMetrics.replicationPoliciesEnabled=(this.config.replicationPolicies||[]).filter(s=>s.enabled).length,this.harborMetrics.scansRunning=(this.config.tags||[]).filter(s=>s.vulnerabilityScan?.status==="running").length}performUpdate(t,e=!1){this.config&&(e&&this.simulatePushPullOperations(t),(this.config.enableVulnerabilityScanning||this.config.enableImageScanning)&&this.simulateVulnerabilityScans(t),this.config.replicationPolicies&&this.config.replicationPolicies.length>0&&this.simulateReplication(t),this.config.enableGarbageCollection&&this.simulateGarbageCollection(t),this.updateActiveOperations(t),this.updateMetrics(t))}simulatePushPullOperations(t){if(!this.config?.repositories||this.config.repositories.length===0)return;const e=Math.min(2,.1+this.config.repositories.length/10);if(Math.random()<e/10){const s=this.config.repositories[Math.floor(Math.random()*this.config.repositories.length)];Math.random()<.3?this.simulatePush(s,t):this.simulatePull(s,t)}}simulatePush(t,e){const s=`push-${e}-${Math.random()}`,n=50+Math.random()*500,i=500+Math.random()*1500,o=e+i,l={id:s,type:"push",repository:t.name,project:t.project,startTime:e,status:"running",size:n,completionTime:o};this.activeOperations.set(s,l)}simulatePull(t,e){const s=`pull-${e}-${Math.random()}`,n=200+Math.random()*800,i=e+n,o={id:s,type:"pull",repository:t.name,project:t.project,startTime:e,status:"running",completionTime:i};this.activeOperations.set(s,o)}simulateVulnerabilityScans(t){if(!this.config?.tags)return;const e=this.config.tags.filter(s=>{const n=s.vulnerabilityScan;return!n||n.status==="pending"||n.status==="completed"&&this.shouldRescan(s)});if(e.length!==0){if(this.harborMetrics.scansRunning<3&&Math.random()<.1){const s=e[Math.floor(Math.random()*e.length)];this.startVulnerabilityScan(s.id,t)}this.completeVulnerabilityScans(t)}}startVulnerabilityScan(t,e){if(!this.config?.tags)return;const s=this.config.tags.find(h=>h.id===t);if(!s)return;const n=`scan-${t}-${e}`,i=5e3+Math.random()*15e3,o=e+i,l={id:n,type:"scan",repository:s.repository,tag:s.name,startTime:e,status:"running",completionTime:o};this.activeOperations.set(n,l),this.harborMetrics.scansRunning++;const d=this.config.tags.map(h=>h.id===t?{...h,vulnerabilityScan:{status:"running",severity:"none",scannedAt:new Date(e).toISOString()}}:h);this.config.tags=d}completeVulnerabilityScans(t){}shouldRescan(t){if(!t.vulnerabilityScan?.scannedAt)return!0;const e=new Date(t.vulnerabilityScan.scannedAt).getTime(),s=Date.now()-e,n=10080*60*1e3;return s>n}simulateReplication(t){if(!this.config?.replicationPolicies)return;const e=this.config.replicationPolicies.filter(s=>s.enabled);e.length!==0&&e.forEach(s=>{if(s.trigger==="event-based"&&Math.random()<.05)this.simulateReplicationOperation(s,t);else if(s.trigger==="scheduled"){const n=this.getLastReplicationRun(s.id);t-n>36e5&&(this.simulateReplicationOperation(s,t),this.setLastReplicationRun(s.id,t))}})}lastReplicationRuns=new Map;getLastReplicationRun(t){return this.lastReplicationRuns.get(t)||0}setLastReplicationRun(t,e){this.lastReplicationRuns.set(t,e)}simulateReplicationOperation(t,e){const s=`replication-${t.id}-${e}`,n=2e3+Math.random()*5e3,i=e+n,o={id:s,type:"replication",startTime:e,status:"running",completionTime:i};this.activeOperations.set(s,o),this.harborMetrics.activeReplications++}simulateGarbageCollection(t){this.config?.gcSchedule&&t-this.lastGCRun>1440*60*1e3&&(this.runGarbageCollection(t),this.lastGCRun=t)}runGarbageCollection(t){const e=`gc-${t}`,s=3e4+Math.random()*6e4,n=t+s,i=Math.random()*5,o={id:e,type:"gc",startTime:t,status:"running",completionTime:n,size:i*1024};this.activeOperations.set(e,o)}updateActiveOperations(t){const e=[];for(const[n,i]of this.activeOperations.entries())i.completionTime&&t>=i.completionTime&&i.status==="running"&&e.push(i);for(const n of e)this.completeOperation(n,t);const s=t-6e4;for(const[n,i]of this.activeOperations.entries())i.startTime<s&&i.status==="completed"&&this.activeOperations.delete(n)}completeOperation(t,e){const s=t.completionTime?t.completionTime-t.startTime:0;switch(t.status="completed",t.duration=s,this.activeOperations.delete(t.id),this.addOperationToHistory(t),t.type){case"push":this.config&&t.size&&(this.harborMetrics.storageUsed+=t.size/1024),s>0&&(this.pushLatencyHistory.push(s),this.pushLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pushLatencyHistory.shift());break;case"pull":s>0&&(this.pullLatencyHistory.push(s),this.pullLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pullLatencyHistory.shift());break;case"scan":if(this.config?.tags&&t.id){const n=t.id.match(/^scan-(.+?)-/);if(n){const i=n[1];if(this.config.tags.find(l=>l.id===i)){const l=Math.floor(Math.random()*3),d=Math.floor(Math.random()*5),h=Math.floor(Math.random()*10),f=Math.floor(Math.random()*15),m=l+d+h+f,y=l>0?"critical":d>0?"high":h>0?"medium":f>0?"low":"none",b=this.config.tags.map(C=>C.id===i?{...C,vulnerabilityScan:{status:"completed",severity:y,totalVulnerabilities:m,critical:l,high:d,medium:h,low:f,scannedAt:new Date(e).toISOString(),scanDuration:s}}:C);this.config.tags=b,this.harborMetrics.scansRunning=Math.max(0,this.harborMetrics.scansRunning-1),this.harborMetrics.scansCompleted++,this.scanLatencyHistory.push(s),this.scanLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.scanLatencyHistory.shift()}}}break;case"replication":this.harborMetrics.activeReplications=Math.max(0,this.harborMetrics.activeReplications-1);break;case"gc":if(t.size){const n=t.size/1024;this.harborMetrics.gcOperationsTotal++,this.harborMetrics.gcStorageFreed+=n,this.harborMetrics.storageUsed=Math.max(0,this.harborMetrics.storageUsed-n)}break}}addOperationToHistory(t){this.operationHistory.push(t),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(t){const e=t-1e4,s=this.operationHistory.filter(n=>n.startTime>e);this.harborMetrics.pushOperationsPerSecond=s.filter(n=>n.type==="push").length/10,this.harborMetrics.pullOperationsPerSecond=s.filter(n=>n.type==="pull").length/10,this.harborMetrics.scanOperationsPerSecond=s.filter(n=>n.type==="scan").length/10,this.harborMetrics.replicationOperationsPerSecond=s.filter(n=>n.type==="replication").length/10,this.pushLatencyHistory.length>0&&(this.harborMetrics.averagePushLatency=this.pushLatencyHistory.reduce((n,i)=>n+i,0)/this.pushLatencyHistory.length),this.pullLatencyHistory.length>0&&(this.harborMetrics.averagePullLatency=this.pullLatencyHistory.reduce((n,i)=>n+i,0)/this.pullLatencyHistory.length),this.scanLatencyHistory.length>0&&(this.harborMetrics.averageScanLatency=this.scanLatencyHistory.reduce((n,i)=>n+i,0)/this.scanLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const t=this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond+this.harborMetrics.replicationOperationsPerSecond,e=(this.harborMetrics.averagePushLatency*this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.averagePullLatency*this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.averageScanLatency*this.harborMetrics.scanOperationsPerSecond)/Math.max(1,this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond),s=this.operationHistory.filter(h=>h.status==="failed").length,n=Math.min(1,s/Math.max(1,this.operationHistory.length)),i=Math.min(.95,.1+t/10*.4),o=Math.min(.95,.2+this.harborMetrics.storageUsed/this.harborMetrics.storageTotal*.5),l=this.harborMetrics.storageUsed/this.harborMetrics.storageTotal,d=Math.min(.95,t/20*.6);return{throughput:t,averageLatency:e||0,errorRate:n,cpuUtilization:i,memoryUtilization:o,storageUtilization:l,networkUtilization:d}}getMetrics(){return{...this.harborMetrics}}getConfig(){return this.config?{...this.config}:null}}class bT{config;connected=!1;eventSubscribers=new Set;eventStream=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;reconnectTimeout=3e3;constructor(t){this.config=t}getBaseUrl(){if(this.config.type==="local")return"/api/docker";{const t=this.config.useTLS?"https":"http",e=this.config.host||"localhost",s=this.config.port||2376;return`${t}://${e}:${s}`}}async request(t,e,s,n){const i=`${this.getBaseUrl()}${e}`,o=n?.timeout||this.config.timeout||3e4,l=new AbortController,d=setTimeout(()=>l.abort(),o);try{const h={"Content-Type":"application/json"};this.config.useTLS&&this.config.clientCert&&this.config.clientKey&&(h["X-Client-Cert"]=this.config.clientCert,h["X-Client-Key"]=this.config.clientKey);const f=await fetch(i,{method:t,headers:h,body:s?JSON.stringify(s):void 0,signal:l.signal});if(clearTimeout(d),!f.ok){const y=await f.text();throw new Error(`Docker API error: ${f.status} ${f.statusText} - ${y}`)}const m=f.headers.get("content-type");return m&&m.includes("application/json")?await f.json():{}}catch(h){throw clearTimeout(d),h.name==="AbortError"?new Error(`Request timeout after ${o}ms`):h}}async connect(){try{return await this.getSystemInfo()?(this.connected=!0,this.reconnectAttempts=0,this.startEventStream(),!0):!1}catch(t){return this.connected=!1,console.error("Failed to connect to Docker daemon:",t),!1}}async disconnect(){this.connected=!1,this.stopEventStream(),this.eventSubscribers.clear()}isConnected(){return this.connected}async testConnection(){try{return{success:!!await this.getSystemInfo()}}catch(t){return{success:!1,error:t.message}}}startEventStream(){if(this.eventSubscribers.size!==0)try{const t=`${this.getBaseUrl()}/events`;this.pollEvents()}catch(t){console.error("Failed to start event stream:",t)}}stopEventStream(){this.eventStream&&(this.eventStream.close(),this.eventStream=null)}async pollEvents(){}async listContainers(){return(await this.request("GET","/containers/json?all=true")).map(this.mapContainerFromAPI)}async getContainer(t){try{const e=await this.request("GET",`/containers/${t}/json`);return this.mapContainerFromAPI(e)}catch(e){if(e.message.includes("404"))return null;throw e}}async createContainer(t){const e=this.mapContainerConfigToAPI(t),s=await this.request("POST","/containers/create",e);return await this.getContainer(s.Id)||this.createContainerFromConfig(t,s.Id)}async startContainer(t){await this.request("POST",`/containers/${t}/start`)}async stopContainer(t){await this.request("POST",`/containers/${t}/stop`)}async pauseContainer(t){await this.request("POST",`/containers/${t}/pause`)}async unpauseContainer(t){await this.request("POST",`/containers/${t}/unpause`)}async restartContainer(t){await this.request("POST",`/containers/${t}/restart`)}async removeContainer(t,e=!1){await this.request("DELETE",`/containers/${t}?force=${e}`)}async listImages(){return(await this.request("GET","/images/json")).map(this.mapImageFromAPI)}async pullImage(t,e="latest"){await this.request("POST",`/images/create?fromImage=${t}&tag=${e}`);const n=(await this.listImages()).find(i=>i.repository===t&&i.tag===e);if(!n)throw new Error(`Failed to find pulled image ${t}:${e}`);return n}async buildImage(t){throw new Error("Build image not fully implemented - requires streaming support")}async removeImage(t,e=!1){await this.request("DELETE",`/images/${t}?force=${e}`)}async listNetworks(){return(await this.request("GET","/networks")).map(this.mapNetworkFromAPI)}async createNetwork(t){const e=this.mapNetworkConfigToAPI(t),s=await this.request("POST","/networks/create",e),i=(await this.listNetworks()).find(o=>o.id===s.Id);if(!i)throw new Error(`Failed to find created network ${s.Id}`);return i}async removeNetwork(t){await this.request("DELETE",`/networks/${t}`)}async listVolumes(){return(await this.request("GET","/volumes")).Volumes.map(this.mapVolumeFromAPI)}async createVolume(t){const e=this.mapVolumeConfigToAPI(t),s=await this.request("POST","/volumes/create",e),i=(await this.listVolumes()).find(o=>o.name===s.Name);if(!i)throw new Error(`Failed to find created volume ${s.Name}`);return i}async removeVolume(t){await this.request("DELETE",`/volumes/${t}`)}async getContainerStats(t){try{const e=await this.request("GET",`/containers/${t}/stats?stream=false`);return this.mapStatsFromAPI(e,t)}catch(e){if(e.message.includes("404"))return null;throw e}}async getSystemInfo(){try{const t=await this.request("GET","/info"),e=await this.request("GET","/version");return this.mapSystemInfoFromAPI(t,e)}catch(t){return console.error("Failed to get system info:",t),null}}subscribeToEvents(t){return this.eventSubscribers.add(t),this.connected&&!this.eventStream&&this.startEventStream(),()=>{this.eventSubscribers.delete(t),this.eventSubscribers.size===0&&this.stopEventStream()}}mapContainerFromAPI(t){const s=(t.Names||[])[0]?.replace(/^\//,"")||t.Id?.substring(0,12)||"unknown";return{id:t.Id||t.ID||"",name:s,image:t.Image||"",imageId:t.ImageID||"",status:this.mapContainerStatus(t.Status||t.State||"unknown"),createdAt:t.Created?new Date(t.Created).getTime():Date.now(),startedAt:t.StartedAt?new Date(t.StartedAt).getTime():void 0,finishedAt:t.FinishedAt?new Date(t.FinishedAt).getTime():void 0,restartCount:t.RestartCount||0,ports:this.mapPortsFromAPI(t.Ports),environment:t.Env?this.parseEnvVars(t.Env):void 0,volumes:t.Mounts?t.Mounts.map(n=>n.Name||n.Source):void 0,networks:t.NetworkSettings?Object.keys(t.NetworkSettings.Networks||{}):void 0,health:this.mapHealthStatus(t.Health)}}mapContainerStatus(t){const e=t.toLowerCase();return e.includes("running")?"running":e.includes("paused")?"paused":e.includes("restarting")?"restarting":e.includes("removing")?"removing":e.includes("exited")||e.includes("stopped")?"exited":e.includes("dead")?"dead":"created"}mapPortsFromAPI(t){if(t)return t.map(e=>({containerPort:e.PrivatePort||e.ContainerPort||0,hostPort:e.PublicPort||e.HostPort,protocol:(e.Type||"tcp").toLowerCase()}))}parseEnvVars(t){const e={};for(const s of t){const[n,...i]=s.split("=");n&&(e[n]=i.join("="))}return e}mapHealthStatus(t){if(!t)return"none";const e=t.Status||t.status||"";return e==="healthy"?"healthy":e==="unhealthy"?"unhealthy":e==="starting"?"starting":"none"}mapImageFromAPI(t){const e=t.RepoTags&&t.RepoTags[0]||"<none>:<none>",[s,n]=e.split(":");return{id:t.Id||t.ID||"",repository:s||"<none>",tag:n||"latest",digest:t.RepoDigests?.[0]?.split("@")[1],size:t.Size||0,createdAt:t.Created?new Date(t.Created*1e3).getTime():Date.now(),layers:t.Layers?.length}}mapNetworkFromAPI(t){return{id:t.Id||t.ID||"",name:t.Name||"",driver:t.Driver||"bridge",scope:t.Scope||"local",subnet:t.IPAM?.Config?.[0]?.Subnet,gateway:t.IPAM?.Config?.[0]?.Gateway,containers:t.Containers?Object.keys(t.Containers):void 0,created:t.Created?new Date(t.Created).getTime():Date.now(),internal:t.Internal||!1,enableIPv6:t.EnableIPv6||!1}}mapVolumeFromAPI(t){return{id:t.Name||t.Driver||"",name:t.Name||"",driver:t.Driver||"local",mountpoint:t.Mountpoint,size:t.UsageData?.Size,usedBy:t.UsageData?.RefCount?[t.UsageData.RefCount]:void 0,created:t.CreatedAt?new Date(t.CreatedAt).getTime():Date.now(),labels:t.Labels}}mapStatsFromAPI(t,e){const s=t.cpu_stats?.cpu_usage?.total_usage-(t.precpu_stats?.cpu_usage?.total_usage||0),n=t.cpu_stats?.system_cpu_usage-(t.precpu_stats?.system_cpu_usage||0),i=t.cpu_stats?.online_cpus||1,o=n>0?s/n*i*100:0,l=t.memory_stats?.usage||0,d=t.memory_stats?.limit||0,h=t.networks?Object.values(t.networks).reduce((m,y)=>m+(y.rx_bytes||0),0):0,f=t.networks?Object.values(t.networks).reduce((m,y)=>m+(y.tx_bytes||0),0):0;return{id:e,name:t.name||"",cpuUsage:Math.min(100,Math.max(0,o)),memoryUsage:l,memoryLimit:d,networkRx:h,networkTx:f,timestamp:Date.now()}}mapSystemInfoFromAPI(t,e){return{version:e.Version||"unknown",apiVersion:e.ApiVersion||"unknown",os:t.OperatingSystem||"unknown",arch:t.Architecture||"unknown",kernelVersion:t.KernelVersion||"unknown",totalMemory:t.MemTotal||0,totalCpus:t.NCPU||0,containers:t.Containers||0,containersRunning:t.ContainersRunning||0,containersPaused:t.ContainersPaused||0,containersStopped:t.ContainersStopped||0,images:t.Images||0,imagesSize:0}}mapContainerConfigToAPI(t){const e={Image:t.image,Cmd:t.command,Env:t.env?Object.entries(t.env).map(([s,n])=>`${s}=${n}`):void 0,HostConfig:{}};if(t.ports){e.ExposedPorts={},e.HostConfig.PortBindings={};for(const s of t.ports){const n=`${s.containerPort}/${s.protocol||"tcp"}`;e.ExposedPorts[n]={},s.hostPort&&(e.HostConfig.PortBindings[n]=[{HostPort:s.hostPort.toString()}])}}if(t.volumes&&(e.Volumes={},e.HostConfig.Binds=t.volumes),t.memoryLimit&&(e.HostConfig.Memory=t.memoryLimit),t.cpuLimit){const s=parseFloat(t.cpuLimit);isNaN(s)||(e.HostConfig.CpuQuota=Math.floor(s*1e5),e.HostConfig.CpuPeriod=1e5)}return t.restartPolicy&&(e.HostConfig.RestartPolicy={Name:t.restartPolicy}),t.healthCheck&&(e.Healthcheck={Test:t.healthCheck.test,Interval:t.healthCheck.interval||3e10,Timeout:t.healthCheck.timeout||5e9,Retries:t.healthCheck.retries||3,StartPeriod:t.healthCheck.startPeriod||0}),e}createContainerFromConfig(t,e){return{id:e,name:t.name||e.substring(0,12),image:t.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:t.ports,environment:t.env,volumes:t.volumes,networks:t.networks,health:"none"}}mapNetworkConfigToAPI(t){return{Name:t.name,Driver:t.driver||"bridge",IPAM:t.subnet||t.gateway?{Config:[{Subnet:t.subnet,Gateway:t.gateway}]}:void 0,Internal:t.internal||!1,EnableIPv6:t.enableIPv6||!1,Labels:t.labels}}mapVolumeConfigToAPI(t){return{Name:t.name,Driver:t.driver||"local",Labels:t.labels,DriverOpts:t.options}}}class xT{containers=new Map;images=new Map;networks=new Map;volumes=new Map;eventSubscribers=new Set;statsCache=new Map;systemInfo=null;constructor(t,e,s,n){if(t)for(const i of t)this.containers.set(i.id,{...i});if(e)for(const i of e)this.images.set(i.id,{...i});if(s)for(const i of s)this.networks.set(i.id,{...i});if(n)for(const i of n)this.volumes.set(i.id,{...i});this.systemInfo={version:"24.0.0",apiVersion:"1.43",os:"linux",arch:"amd64",kernelVersion:"5.15.0",totalMemory:16*1024*1024*1024,totalCpus:8,containers:this.containers.size,containersRunning:Array.from(this.containers.values()).filter(i=>i.status==="running").length,containersPaused:Array.from(this.containers.values()).filter(i=>i.status==="paused").length,containersStopped:Array.from(this.containers.values()).filter(i=>i.status==="exited"||i.status==="dead").length,images:this.images.size,imagesSize:Array.from(this.images.values()).reduce((i,o)=>i+o.size,0)}}async connect(){return!0}async disconnect(){this.eventSubscribers.clear()}isConnected(){return!0}async testConnection(){return{success:!0}}async listContainers(){return Array.from(this.containers.values())}async getContainer(t){return this.containers.get(t)||null}async createContainer(t){const e=`sim-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,name:t.name||e.substring(0,12),image:t.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:t.ports,environment:t.env,volumes:t.volumes,networks:t.networks,health:"none",memoryLimit:t.memoryLimit};return this.containers.set(e,s),this.emitEvent("container","create",e,{}),s}async startContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",e.startedAt=Date.now(),this.emitEvent("container","start",t,{})}async stopContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="exited",e.finishedAt=Date.now(),e.cpuUsage=0,e.memoryUsage=0,this.emitEvent("container","stop",t,{})}async pauseContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="paused",this.emitEvent("container","pause",t,{})}async unpauseContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",this.emitEvent("container","unpause",t,{})}async restartContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",e.startedAt=Date.now(),e.restartCount=(e.restartCount||0)+1,this.emitEvent("container","restart",t,{})}async removeContainer(t,e=!1){const s=this.containers.get(t);if(!s)throw new Error(`Container ${t} not found`);if(s.status==="running"&&!e)throw new Error("Cannot remove running container without force");this.containers.delete(t),this.statsCache.delete(t),this.emitEvent("container","destroy",t,{})}async listImages(){return Array.from(this.images.values())}async pullImage(t,e="latest"){await new Promise(i=>setTimeout(i,1e3));const s=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:s,repository:t,tag:e,size:100*1024*1024+Math.random()*500*1024*1024,createdAt:Date.now(),pulledAt:Date.now()};return this.images.set(s,n),this.emitEvent("image","pull",s,{repository:t,tag:e}),n}async buildImage(t){await new Promise(o=>setTimeout(o,2e3));const e=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[s,n]=t.tag.split(":"),i={id:e,repository:s||t.tag,tag:n||"latest",size:200*1024*1024+Math.random()*800*1024*1024,createdAt:Date.now(),builtAt:Date.now()};return this.images.set(e,i),this.emitEvent("image","build",e,{tag:t.tag}),i}async removeImage(t,e=!1){if(!this.images.get(t))throw new Error(`Image ${t} not found`);this.images.delete(t),this.emitEvent("image","delete",t,{})}async listNetworks(){return Array.from(this.networks.values())}async createNetwork(t){const e=`net-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,name:t.name,driver:t.driver||"bridge",scope:"local",subnet:t.subnet,gateway:t.gateway,created:Date.now(),internal:t.internal||!1,enableIPv6:t.enableIPv6||!1};return this.networks.set(e,s),this.emitEvent("network","create",e,{name:t.name}),s}async removeNetwork(t){if(!this.networks.get(t))throw new Error(`Network ${t} not found`);this.networks.delete(t),this.emitEvent("network","destroy",t,{})}async listVolumes(){return Array.from(this.volumes.values())}async createVolume(t){const e=`vol-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,name:t.name,driver:t.driver||"local",created:Date.now(),labels:t.labels};return this.volumes.set(e,s),this.emitEvent("volume","create",e,{name:t.name}),s}async removeVolume(t){if(!this.volumes.get(t))throw new Error(`Volume ${t} not found`);this.volumes.delete(t),this.emitEvent("volume","destroy",t,{})}async getContainerStats(t){const e=this.containers.get(t);if(!e||e.status!=="running")return null;let s=this.statsCache.get(t);return s||(s={id:t,name:e.name,cpuUsage:e.cpuUsage||10+Math.random()*70,memoryUsage:e.memoryUsage||(e.memoryLimit||512*1024*1024)*.3,memoryLimit:e.memoryLimit||512*1024*1024,networkRx:e.networkRx||0,networkTx:e.networkTx||0,timestamp:Date.now()},this.statsCache.set(t,s)),s.cpuUsage=e.cpuUsage||s.cpuUsage,s.memoryUsage=e.memoryUsage||s.memoryUsage,s.networkRx=e.networkRx||s.networkRx,s.networkTx=e.networkTx||s.networkTx,s.timestamp=Date.now(),s}async getSystemInfo(){return this.systemInfo?(this.systemInfo.containers=this.containers.size,this.systemInfo.containersRunning=Array.from(this.containers.values()).filter(t=>t.status==="running").length,this.systemInfo.containersPaused=Array.from(this.containers.values()).filter(t=>t.status==="paused").length,this.systemInfo.containersStopped=Array.from(this.containers.values()).filter(t=>t.status==="exited"||t.status==="dead").length,this.systemInfo.images=this.images.size,this.systemInfo.imagesSize=Array.from(this.images.values()).reduce((t,e)=>t+e.size,0),{...this.systemInfo}):null}subscribeToEvents(t){return this.eventSubscribers.add(t),()=>{this.eventSubscribers.delete(t)}}emitEvent(t,e,s,n){const i={id:`evt-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,action:e,actor:{id:s,attributes:n},time:Math.floor(Date.now()/1e3),timeNano:Date.now()*1e6};for(const o of this.eventSubscribers)try{o(i)}catch(l){console.error("Error in event callback:",l)}}updateContainerStats(t,e){const s=this.containers.get(t);s&&(e.cpuUsage!==void 0&&(s.cpuUsage=e.cpuUsage),e.memoryUsage!==void 0&&(s.memoryUsage=e.memoryUsage),e.memoryLimit!==void 0&&(s.memoryLimit=e.memoryLimit),e.networkRx!==void 0&&(s.networkRx=e.networkRx),e.networkTx!==void 0&&(s.networkTx=e.networkTx))}}class wT{config=null;mode="simulation";simulationProvider=null;realProvider=null;currentProvider=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;operationLatencyHistory=[];MAX_LATENCY_HISTORY=500;containers=new Map;syncInterval=null;syncEnabled=!1;lastSyncTime=0;dockerMetrics={containersTotal:0,containersRunning:0,containersStopped:0,containersPaused:0,imagesTotal:0,imagesSize:0,networksTotal:0,volumesTotal:0,volumesSize:0,operationsPerSecond:0,averageOperationLatency:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryLimit:0,totalNetworkRx:0,totalNetworkTx:0,buildOperationsPerSecond:0,pullOperationsPerSecond:0,pushOperationsPerSecond:0};lastUpdateTime=Date.now();initializeConfig(t){const e=t.data.config||{};if(this.config=e,this.mode=e.mode||"simulation",this.initializeProviders(),e.containers)for(const s of e.containers)this.containers.set(s.id,{...s});this.updateMetricsFromConfig(),this.mode!=="simulation"&&e.syncSettings?.enabled&&this.startSync()}initializeProviders(){if(this.simulationProvider=new xT(this.config?.containers,this.config?.images,this.config?.networks,this.config?.volumes),(this.mode==="real"||this.mode==="hybrid")&&this.config?.dockerConnection){const t={type:this.config.dockerConnection.type,url:this.config.dockerConnection.url,host:this.config.dockerConnection.host,port:this.config.dockerConnection.port,useTLS:this.config.dockerConnection.useTLS,caCert:this.config.dockerConnection.caCert,clientCert:this.config.dockerConnection.clientCert,clientKey:this.config.dockerConnection.clientKey};this.realProvider=new bT(t)}this.currentProvider=this.mode==="simulation"?this.simulationProvider:this.realProvider||this.simulationProvider}setMode(t){this.mode!==t&&(this.mode=t,this.stopSync(),this.initializeProviders(),this.mode!=="simulation"&&this.config?.syncSettings?.enabled&&this.startSync())}getMode(){return this.mode}startSync(){if(this.syncInterval)return;const t=this.config?.syncSettings?.interval||2e3;this.syncEnabled=!0,this.syncFromProvider(),this.syncInterval=setInterval(()=>{this.syncFromProvider()},t),this.config?.syncSettings?.useEvents&&this.currentProvider&&this.currentProvider.subscribeToEvents(e=>{this.handleDockerEvent(e)})}stopSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.syncEnabled=!1}async syncFromProvider(){if(!(!this.currentProvider||!this.currentProvider.isConnected()))try{const t=await this.currentProvider.listContainers();this.syncContainers(t);const e=await this.currentProvider.listImages();this.config&&(this.config.images=e);const s=await this.currentProvider.listNetworks();this.config&&(this.config.networks=s);const n=await this.currentProvider.listVolumes();this.config&&(this.config.volumes=n),this.lastSyncTime=Date.now(),this.updateMetricsFromConfig()}catch(t){console.error("Failed to sync from Docker provider:",t)}}syncContainers(t){for(const s of t){const n=this.containers.get(s.id);n?Object.assign(n,s):this.containers.set(s.id,{...s})}const e=new Set(t.map(s=>s.id));for(const[s]of this.containers.entries())e.has(s)||this.containers.delete(s);this.config&&(this.config.containers=Array.from(this.containers.values()))}handleDockerEvent(t){switch(t.type){case"container":this.handleContainerEvent(t);break;case"image":this.handleImageEvent(t);break;case"network":this.handleNetworkEvent(t);break;case"volume":this.handleVolumeEvent(t);break}}handleContainerEvent(t){const e=t.actor.id;t.action==="destroy"||t.action==="die"?this.containers.delete(e):this.currentProvider&&this.currentProvider.getContainer(e).then(s=>{s&&this.containers.set(e,s)})}handleImageEvent(t){}handleNetworkEvent(t){}handleVolumeEvent(t){}updateConfig(t){const e=t.data.config||{};this.config;const s=this.mode;this.config=e;const n=e.mode||"simulation";if(n!==s&&this.setMode(n),e.containers){const i=new Set(e.containers.map(o=>o.id));for(const[o,l]of this.containers.entries())i.has(o)||this.containers.delete(o);for(const o of e.containers){const l=this.containers.get(o.id);if(l){const d={...l,name:o.name,image:o.image,imageId:o.imageId,ports:o.ports,environment:o.environment,volumes:o.volumes,networks:o.networks,health:o.health,cpuUsage:l.status==="running"?l.cpuUsage:o.cpuUsage,memoryUsage:l.status==="running"?l.memoryUsage:o.memoryUsage,memoryLimit:o.memoryLimit||l.memoryLimit,networkRx:l.status==="running"?l.networkRx:o.networkRx,networkTx:l.status==="running"?l.networkTx:o.networkTx,status:o.status||l.status,createdAt:o.createdAt||l.createdAt,startedAt:o.startedAt||l.startedAt,finishedAt:o.finishedAt||l.finishedAt,restartCount:o.restartCount!==void 0?o.restartCount:l.restartCount,exitCode:o.exitCode!==void 0?o.exitCode:l.exitCode};this.containers.set(o.id,d)}else{const d={id:o.id,name:o.name,image:o.image,imageId:o.imageId,status:o.status||"created",createdAt:o.createdAt||Date.now(),startedAt:o.startedAt,finishedAt:o.finishedAt,restartCount:o.restartCount||0,cpuUsage:o.cpuUsage,memoryUsage:o.memoryUsage,memoryLimit:o.memoryLimit,networkRx:o.networkRx,networkTx:o.networkTx,ports:o.ports,environment:o.environment,volumes:o.volumes,networks:o.networks,health:o.health,exitCode:o.exitCode};this.containers.set(o.id,d)}}}this.updateMetricsFromConfig()}updateMetricsFromConfig(){this.config&&(this.dockerMetrics.containersTotal=this.containers.size,this.dockerMetrics.containersRunning=Array.from(this.containers.values()).filter(t=>t.status==="running").length,this.dockerMetrics.containersStopped=Array.from(this.containers.values()).filter(t=>t.status==="exited"||t.status==="dead").length,this.dockerMetrics.containersPaused=Array.from(this.containers.values()).filter(t=>t.status==="paused").length,this.dockerMetrics.imagesTotal=this.config.images?.length||0,this.dockerMetrics.imagesSize=(this.config.images||[]).reduce((t,e)=>t+e.size,0),this.dockerMetrics.networksTotal=this.config.networks?.length||0,this.dockerMetrics.volumesTotal=this.config.volumes?.length||0,this.dockerMetrics.volumesSize=(this.config.volumes||[]).reduce((t,e)=>t+(e.size||0),0))}performUpdate(t,e=!1){if(!this.config)return;const s=t-this.lastUpdateTime;this.lastUpdateTime=t,this.mode!=="simulation"&&this.currentProvider?.isConnected()&&this.updateContainerStatsFromProvider(),this.mode==="simulation"&&e&&this.simulateContainerOperations(t),this.mode==="simulation"&&this.simulateImageOperations(t,e),this.mode==="simulation"&&this.updateContainerResources(s),this.updateActiveOperations(t),this.updateMetrics(t)}async updateContainerStatsFromProvider(){if(!this.currentProvider)return;const t=Array.from(this.containers.values()).filter(e=>e.status==="running");for(const e of t)try{const s=await this.currentProvider.getContainerStats(e.id);s&&(e.cpuUsage=s.cpuUsage,e.memoryUsage=s.memoryUsage,e.memoryLimit=s.memoryLimit,e.networkRx=s.networkRx,e.networkTx=s.networkTx,this.mode==="hybrid"&&this.simulationProvider&&this.simulationProvider.updateContainerStats(e.id,s))}catch(s){console.error(`Failed to get stats for container ${e.id}:`,s)}}simulateContainerOperations(t){if(this.containers.size===0)return;const e=Math.min(1,.1+this.containers.size/20);if(Math.random()<e/10){const s=Array.from(this.containers.values()),n=s[Math.floor(Math.random()*s.length)];let i;n.status==="running"?i=Math.random()<.1?"stop":Math.random()<.2?"pause":Math.random()<.3?"restart":"create":n.status==="exited"||n.status==="dead"?i=Math.random()<.5?"start":"create":n.status==="paused"?i=Math.random()<.5?"unpause":"stop":i="create",this.simulateContainerOperation(n.id,i,t)}}simulateContainerOperation(t,e,s){if(!this.containers.get(t))return;const i=`${e}-${t}-${s}-${Math.random()}`;let o=100;switch(e){case"create":o=500+Math.random()*1e3;break;case"start":o=200+Math.random()*500;break;case"stop":o=100+Math.random()*300;break;case"pause":o=50+Math.random()*100;break;case"unpause":o=50+Math.random()*100;break;case"restart":o=300+Math.random()*700;break;case"remove":o=200+Math.random()*400;break}const l=s+o,d={id:i,type:e,containerId:t,startTime:s,status:"running",completionTime:l};this.activeOperations.set(i,d)}simulateImageOperations(t,e){if(!this.config?.images||this.config.images.length===0)return;const s=Math.min(.5,.05+this.config.images.length/50);if(e&&Math.random()<s/10){const n=this.config.images[Math.floor(Math.random()*this.config.images.length)],i=Math.random()<.7?"pull":Math.random()<.9?"build":"push";this.simulateImageOperation(n.id,i,t)}}simulateImageOperation(t,e,s){const n=`${e}-${t}-${s}-${Math.random()}`;let i=1e3;switch(e){case"pull":i=2e3+Math.random()*8e3;break;case"push":i=3e3+Math.random()*1e4;break;case"build":i=5e3+Math.random()*15e3;break}const o=s+i,l={id:n,type:e,imageId:t,startTime:s,status:"running",completionTime:o};this.activeOperations.set(n,l)}updateContainerResources(t){const e=Array.from(this.containers.values()).filter(d=>d.status==="running");let s=0,n=0,i=0,o=0,l=0;for(const d of e){const h=10+Math.random()*70,f=(Math.random()-.5)*10;d.cpuUsage=Math.max(0,Math.min(100,h+f));const m=d.memoryLimit||512*1024*1024;if(d.memoryLimit=m,!d.memoryUsage)d.memoryUsage=m*.3;else{const C=1+(Math.random()-.4)*.1;d.memoryUsage=Math.min(m*.95,d.memoryUsage*C)}const b=(1e3+Math.random()*9e3)*t/1e3;d.networkRx=(d.networkRx||0)+b,d.networkTx=(d.networkTx||0)+b*.8,s+=d.cpuUsage,n+=d.memoryUsage,i+=m,o+=d.networkRx||0,l+=d.networkTx||0}this.dockerMetrics.totalCpuUsage=e.length>0?s/e.length:0,this.dockerMetrics.totalMemoryUsage=n,this.dockerMetrics.totalMemoryLimit=i,this.dockerMetrics.totalNetworkRx=o,this.dockerMetrics.totalNetworkTx=l}updateActiveOperations(t){const e=[];for(const[n,i]of this.activeOperations.entries())i.completionTime&&t>=i.completionTime&&i.status==="running"&&e.push(i);for(const n of e)this.completeOperation(n,t);const s=t-6e4;for(const[n,i]of this.activeOperations.entries())i.startTime<s&&i.status==="completed"&&this.activeOperations.delete(n)}completeOperation(t,e){const s=t.completionTime?t.completionTime-t.startTime:0;switch(t.status="completed",t.duration=s,this.activeOperations.delete(t.id),this.addOperationToHistory(t),t.type){case"create":case"start":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="running",n.startedAt=e,n.restartCount=n.restartCount||0)}break;case"stop":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="exited",n.finishedAt=e,n.cpuUsage=0,n.memoryUsage=0)}break;case"pause":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="paused")}break;case"unpause":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="running")}break;case"restart":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="running",n.startedAt=e,n.restartCount=(n.restartCount||0)+1)}break;case"remove":t.containerId&&this.containers.delete(t.containerId);break}s>0&&(this.operationLatencyHistory.push(s),this.operationLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.operationLatencyHistory.shift())}addOperationToHistory(t){this.operationHistory.push(t),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(t){const e=t-1e4,s=this.operationHistory.filter(n=>n.startTime>e);this.dockerMetrics.operationsPerSecond=s.length/10,this.dockerMetrics.buildOperationsPerSecond=s.filter(n=>n.type==="build").length/10,this.dockerMetrics.pullOperationsPerSecond=s.filter(n=>n.type==="pull").length/10,this.dockerMetrics.pushOperationsPerSecond=s.filter(n=>n.type==="push").length/10,this.operationLatencyHistory.length>0&&(this.dockerMetrics.averageOperationLatency=this.operationLatencyHistory.reduce((n,i)=>n+i,0)/this.operationLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const t=this.dockerMetrics.operationsPerSecond,e=this.dockerMetrics.averageOperationLatency,s=this.operationHistory.filter(y=>y.status==="failed").length,n=Math.min(1,s/Math.max(1,this.operationHistory.length)),i=Math.min(.95,this.dockerMetrics.totalCpuUsage/100),o=this.dockerMetrics.totalMemoryLimit>0?Math.min(.95,this.dockerMetrics.totalMemoryUsage/this.dockerMetrics.totalMemoryLimit):.1,l=1e3*1024*1024,d=Math.min(.95,(this.dockerMetrics.totalNetworkRx+this.dockerMetrics.totalNetworkTx)/l*8),h=100*1024*1024*1024,f=this.dockerMetrics.imagesSize+this.dockerMetrics.volumesSize,m=Math.min(.95,f/h);return{throughput:t,averageLatency:e||0,errorRate:n,cpuUtilization:i,memoryUtilization:o,networkUtilization:d,diskUtilization:m}}getMetrics(){return{...this.dockerMetrics}}getConfig(){return this.config?{...this.config}:null}getContainers(){return Array.from(this.containers.values())}getContainer(t){return this.containers.get(t)}getImages(){return this.config?.images||[]}getNetworks(){return this.config?.networks||[]}getVolumes(){return this.config?.volumes||[]}getProvider(){return this.currentProvider}async testConnection(){return this.currentProvider?await this.currentProvider.testConnection():{success:!1,error:"No provider available"}}async connect(){if(!this.currentProvider)return!1;const t=await this.currentProvider.connect();return t&&this.config?.syncSettings?.enabled&&this.startSync(),t}async disconnect(){this.stopSync(),this.currentProvider&&await this.currentProvider.disconnect()}isConnected(){return this.currentProvider?.isConnected()||!1}async createContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");const e={name:t.name,image:t.image,command:t.command,env:t.env,ports:t.ports,volumes:t.volumes,networks:t.networks,memoryLimit:t.memoryLimit,cpuLimit:t.cpuLimit},s=await this.currentProvider.createContainer(e);return this.containers.set(s.id,s),this.config&&(this.config.containers=Array.from(this.containers.values())),s}async startContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.startContainer(t);const e=this.containers.get(t);e&&(e.status="running",e.startedAt=Date.now())}async stopContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.stopContainer(t);const e=this.containers.get(t);e&&(e.status="exited",e.finishedAt=Date.now())}async removeContainerViaProvider(t,e=!1){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.removeContainer(t,e),this.containers.delete(t),this.config&&(this.config.containers=Array.from(this.containers.values()))}async pullImageViaProvider(t,e="latest"){if(!this.currentProvider)throw new Error("No provider available");const s=await this.currentProvider.pullImage(t,e);if(this.config){this.config.images||(this.config.images=[]);const n=this.config.images.findIndex(i=>i.id===s.id);n>=0?this.config.images[n]=s:this.config.images.push(s)}return s}async getSystemInfo(){return this.currentProvider?await this.currentProvider.getSystemInfo():null}}class CT{config=null;pods=new Map;deployments=new Map;services=new Map;configMaps=new Map;secrets=new Map;namespaces=new Map;nodes=new Map;events=[];persistentVolumeClaims=new Map;kubernetesMetrics={podsTotal:0,podsRunning:0,podsPending:0,podsFailed:0,podsSucceeded:0,deploymentsTotal:0,deploymentsReady:0,deploymentsNotReady:0,servicesTotal:0,servicesClusterIP:0,servicesNodePort:0,servicesLoadBalancer:0,nodesTotal:0,nodesReady:0,nodesNotReady:0,totalCpuRequests:0,totalCpuLimits:0,totalMemoryRequests:0,totalMemoryLimits:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryCapacity:0,namespacesTotal:0,configMapsTotal:0,secretsTotal:0};lastUpdateTime=Date.now();updateInterval=1e3;initializeConfig(t){const e=t.data.config||{};this.config=e,this.config.defaultNamespace||(this.config.defaultNamespace="default"),this.config.namespaces||(this.config.namespaces=[]),this.config.namespaces.some(n=>n.name===(this.config?.defaultNamespace||"default"))||this.config.namespaces.push({id:this.generateId(),name:this.config.defaultNamespace,phase:"Active",createdAt:Date.now()}),(!this.config.nodes||this.config.nodes.length===0)&&(this.config.nodes=[{id:this.generateId(),name:"node-1",roles:["worker"],conditions:[{type:"Ready",status:"True",lastTransitionTime:Date.now()}],allocatable:{cpu:"4",memory:"8Gi",pods:"110"},capacity:{cpu:"4",memory:"8Gi",pods:"110"},createdAt:Date.now(),unschedulable:!1,podCount:0}]),this.initializeResources(),this.updateMetricsFromResources()}initializeResources(){if(this.config){if(this.pods.clear(),this.config.pods)for(const t of this.config.pods)this.pods.set(t.id,{...t});if(this.deployments.clear(),this.config.deployments)for(const t of this.config.deployments)this.deployments.set(t.id,{...t});if(this.services.clear(),this.config.services)for(const t of this.config.services)this.services.set(t.id,{...t});if(this.configMaps.clear(),this.config.configMaps)for(const t of this.config.configMaps)this.configMaps.set(t.id,{...t});if(this.secrets.clear(),this.config.secrets)for(const t of this.config.secrets)this.secrets.set(t.id,{...t});if(this.namespaces.clear(),this.config.namespaces)for(const t of this.config.namespaces)this.namespaces.set(t.id,{...t});if(this.nodes.clear(),this.config.nodes)for(const t of this.config.nodes)this.nodes.set(t.id,{...t});if(this.persistentVolumeClaims.clear(),this.config.persistentVolumeClaims)for(const t of this.config.persistentVolumeClaims)this.persistentVolumeClaims.set(t.id,{...t});this.events=this.config.events||[]}}updateConfig(t){const e=t.data.config||{};this.config,this.config=e,this.syncResources(),this.updateMetricsFromResources()}syncResources(){if(this.config){if(this.config.pods){const t=new Set(this.config.pods.map(e=>e.id));for(const[e]of this.pods.entries())t.has(e)||this.pods.delete(e);for(const e of this.config.pods){const s=this.pods.get(e.id);s?this.pods.set(e.id,{...s,...e,totalCpuUsage:s.phase==="Running"?s.totalCpuUsage:e.totalCpuUsage,totalMemoryUsage:s.phase==="Running"?s.totalMemoryUsage:e.totalMemoryUsage,startedAt:e.startedAt||s.startedAt}):this.pods.set(e.id,{...e})}}this.initializeResources()}}updateMetricsFromResources(){this.kubernetesMetrics.podsTotal=this.pods.size,this.kubernetesMetrics.podsRunning=Array.from(this.pods.values()).filter(n=>n.phase==="Running").length,this.kubernetesMetrics.podsPending=Array.from(this.pods.values()).filter(n=>n.phase==="Pending").length,this.kubernetesMetrics.podsFailed=Array.from(this.pods.values()).filter(n=>n.phase==="Failed").length,this.kubernetesMetrics.podsSucceeded=Array.from(this.pods.values()).filter(n=>n.phase==="Succeeded").length,this.kubernetesMetrics.deploymentsTotal=this.deployments.size,this.kubernetesMetrics.deploymentsReady=Array.from(this.deployments.values()).filter(n=>n.readyReplicas===n.replicas&&n.replicas>0).length,this.kubernetesMetrics.deploymentsNotReady=Array.from(this.deployments.values()).filter(n=>n.readyReplicas!==n.replicas||n.replicas===0).length,this.kubernetesMetrics.servicesTotal=this.services.size,this.kubernetesMetrics.servicesClusterIP=Array.from(this.services.values()).filter(n=>n.type==="ClusterIP").length,this.kubernetesMetrics.servicesNodePort=Array.from(this.services.values()).filter(n=>n.type==="NodePort").length,this.kubernetesMetrics.servicesLoadBalancer=Array.from(this.services.values()).filter(n=>n.type==="LoadBalancer").length,this.kubernetesMetrics.nodesTotal=this.nodes.size,this.kubernetesMetrics.nodesReady=Array.from(this.nodes.values()).filter(n=>n.conditions?.some(i=>i.type==="Ready"&&i.status==="True")).length,this.kubernetesMetrics.nodesNotReady=this.kubernetesMetrics.nodesTotal-this.kubernetesMetrics.nodesReady;let t=0,e=0,s=0;for(const n of this.pods.values())n.totalCpuUsage&&(t+=n.totalCpuUsage),n.totalMemoryUsage&&(e+=n.totalMemoryUsage);for(const n of this.nodes.values())n.memoryCapacity&&(s+=n.memoryCapacity);this.kubernetesMetrics.totalCpuUsage=t,this.kubernetesMetrics.totalMemoryUsage=e,this.kubernetesMetrics.totalMemoryCapacity=s,this.kubernetesMetrics.namespacesTotal=this.namespaces.size,this.kubernetesMetrics.configMapsTotal=this.configMaps.size,this.kubernetesMetrics.secretsTotal=this.secrets.size}simulateStep(){const t=Date.now(),e=t-this.lastUpdateTime;this.lastUpdateTime=t,this.simulatePodLifecycle(e),this.simulateDeploymentReconciliation(e),this.simulateNodeMetrics(e),this.updateMetricsFromResources()}simulatePodLifecycle(t){for(const e of this.pods.values())e.phase==="Running"&&(e.totalCpuUsage?e.totalCpuUsage=Math.max(0,Math.min(100,e.totalCpuUsage+(Math.random()-.5)*5)):e.totalCpuUsage=20+Math.random()*60,e.totalMemoryUsage?e.totalMemoryUsage=Math.max(0,e.totalMemoryUsage+(Math.random()-.5)*100*1024*1024):e.totalMemoryUsage=512*1024*1024+Math.random()*(2*1024*1024*1024),e.totalMemoryLimit||(e.totalMemoryLimit=e.totalMemoryUsage*1.5))}simulateDeploymentReconciliation(t){for(const e of this.deployments.values()){const s=Array.from(this.pods.values()).filter(o=>o.namespace!==e.namespace?!1:e.selector?Object.entries(e.selector).every(([l,d])=>o.labels?.[l]===d):!1),n=s.filter(o=>o.phase==="Running"),i=n.filter(o=>o.conditions?.find(d=>d.type==="Ready")?.status==="True");e.readyReplicas=i.length,e.availableReplicas=n.length,e.updatedReplicas=n.length,e.unavailableReplicas=Math.max(0,e.replicas-e.availableReplicas),s.length<e.replicas&&!e.paused&&e.replicas-s.length>0&&Math.random()>.7&&this.createPodForDeployment(e)}}createPodForDeployment(t){const e=`${t.name}-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,s=this.generateId(),n={id:s,name:e,namespace:t.namespace||this.config?.defaultNamespace||"default",labels:t.template?.labels||t.selector,phase:"Pending",status:"Pending",createdAt:Date.now(),restartPolicy:"Always",restartCount:0};this.pods.set(s,n),this.config&&this.config.pods?this.config.pods.push(n):this.config&&(this.config.pods=[n]),setTimeout(()=>{const i=this.pods.get(s);i&&(i.phase="Running",i.status="Running",i.startedAt=Date.now(),i.podIP=`10.244.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i.conditions=[{type:"Ready",status:"True",lastTransitionTime:Date.now()},{type:"PodScheduled",status:"True",lastTransitionTime:Date.now()}])},1e3+Math.random()*2e3)}simulateNodeMetrics(t){for(const e of this.nodes.values()){const s=Array.from(this.pods.values()).filter(o=>o.nodeName===e.name);e.podCount=s.length;let n=0,i=0;for(const o of s)o.totalCpuUsage&&(n+=o.totalCpuUsage),o.totalMemoryUsage&&(i+=o.totalMemoryUsage);e.cpuUsage=Math.min(100,n),e.capacity?.memory&&!e.memoryCapacity&&(e.memoryCapacity=this.parseMemoryString(e.capacity.memory)),e.memoryCapacity&&(e.memoryUsage=Math.min(e.memoryCapacity,i))}}parseMemoryString(t){const e=t.match(/^(\d+)([KMGT]?i?)$/);if(!e)return 0;const s=parseInt(e[1],10),n=e[2].toLowerCase(),i={"":1,k:1024,ki:1024,m:1024*1024,mi:1024*1024,g:1024*1024*1024,gi:1024*1024*1024,t:1024*1024*1024*1024,ti:1024*1024*1024*1024};return s*(i[n]||1)}createEvent(t,e,s,n){const i={id:this.generateId(),name:`${n.name}.${Date.now()}`,namespace:n.namespace||this.config?.defaultNamespace||"default",type:t,reason:e,message:s,involvedObject:n,firstTimestamp:Date.now(),lastTimestamp:Date.now(),count:1};this.events.push(i),this.events.length>1e3&&(this.events=this.events.slice(-1e3)),this.config&&(this.config.events=[...this.events])}syncResourcesToConfig(){this.config&&(this.config.pods=Array.from(this.pods.values()),this.config.deployments=Array.from(this.deployments.values()),this.config.services=Array.from(this.services.values()),this.config.configMaps=Array.from(this.configMaps.values()),this.config.secrets=Array.from(this.secrets.values()),this.config.namespaces=Array.from(this.namespaces.values()),this.config.nodes=Array.from(this.nodes.values()),this.config.events=this.events,this.config.persistentVolumeClaims=Array.from(this.persistentVolumeClaims.values()))}createPod(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),phase:t.phase||"Pending",status:t.status||"Pending"};return this.pods.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Pod ${s.name} created`,{kind:"Pod",name:s.name,namespace:s.namespace,uid:s.id}),s}updatePod(t,e){const s=this.pods.get(t);if(!s)throw new Error(`Pod with id "${t}" not found`);const n={...s,...e,id:s.id};return this.pods.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Pod ${s.name} updated`,{kind:"Pod",name:s.name,namespace:s.namespace,uid:s.id}),n}deletePod(t){const e=this.pods.get(t);if(!e)throw new Error(`Pod with id "${t}" not found`);this.pods.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Pod ${e.name} deleted`,{kind:"Pod",name:e.name,namespace:e.namespace,uid:e.id})}createDeployment(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),readyReplicas:0,availableReplicas:0,updatedReplicas:0,unavailableReplicas:t.replicas,paused:!1};if(this.deployments.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),s.replicas>0)for(let n=0;n<s.replicas;n++)this.createPodForDeployment(s);return this.createEvent("Normal","Created",`Deployment ${s.name} created`,{kind:"Deployment",name:s.name,namespace:s.namespace,uid:s.id}),s}updateDeployment(t,e){const s=this.deployments.get(t);if(!s)throw new Error(`Deployment with id "${t}" not found`);const n=s.replicas,i={...s,...e,id:s.id};if(e.replicas!==void 0&&e.replicas!==n){const o=e.replicas-n;if(o>0)for(let l=0;l<o;l++)this.createPodForDeployment(i);else if(o<0){const d=Array.from(this.pods.values()).filter(h=>h.namespace!==s.namespace?!1:s.selector?Object.entries(s.selector).every(([f,m])=>h.labels?.[f]===m):!1).slice(0,Math.abs(o));for(const h of d)this.deletePod(h.id)}}return this.deployments.set(t,i),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Deployment ${s.name} updated`,{kind:"Deployment",name:s.name,namespace:s.namespace,uid:s.id}),i}deleteDeployment(t){const e=this.deployments.get(t);if(!e)throw new Error(`Deployment with id "${t}" not found`);const s=Array.from(this.pods.values()).filter(n=>n.namespace!==e.namespace?!1:e.selector?Object.entries(e.selector).every(([i,o])=>n.labels?.[i]===o):!1);for(const n of s)this.deletePod(n.id);this.deployments.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Deployment ${e.name} deleted`,{kind:"Deployment",name:e.name,namespace:e.namespace,uid:e.id})}createService(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),type:t.type||"ClusterIP",clusterIP:t.clusterIP||`10.96.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`};if(s.selector){const n=Array.from(this.pods.values()).filter(i=>i.namespace!==s.namespace?!1:Object.entries(s.selector).every(([o,l])=>i.labels?.[o]===l));s.endpoints=[{addresses:n.filter(i=>i.podIP).map(i=>i.podIP),ports:s.ports?.map(i=>({port:typeof i.targetPort=="number"?i.targetPort:parseInt(i.targetPort,10),protocol:i.protocol||"TCP"}))}]}return this.services.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Service ${s.name} created`,{kind:"Service",name:s.name,namespace:s.namespace,uid:s.id}),s}updateService(t,e){const s=this.services.get(t);if(!s)throw new Error(`Service with id "${t}" not found`);const n={...s,...e,id:s.id};if(e.selector&&n.selector){const i=Array.from(this.pods.values()).filter(o=>o.namespace!==s.namespace?!1:Object.entries(n.selector).every(([l,d])=>o.labels?.[l]===d));n.endpoints=[{addresses:i.filter(o=>o.podIP).map(o=>o.podIP),ports:n.ports?.map(o=>({port:typeof o.targetPort=="number"?o.targetPort:parseInt(o.targetPort,10),protocol:o.protocol||"TCP"}))}]}return this.services.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Service ${s.name} updated`,{kind:"Service",name:s.name,namespace:s.namespace,uid:s.id}),n}deleteService(t){const e=this.services.get(t);if(!e)throw new Error(`Service with id "${t}" not found`);this.services.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Service ${e.name} deleted`,{kind:"Service",name:e.name,namespace:e.namespace,uid:e.id})}createConfigMap(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),data:t.data||{}};return this.configMaps.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`ConfigMap ${s.name} created`,{kind:"ConfigMap",name:s.name,namespace:s.namespace,uid:s.id}),s}updateConfigMap(t,e){const s=this.configMaps.get(t);if(!s)throw new Error(`ConfigMap with id "${t}" not found`);if(s.immutable)throw new Error(`ConfigMap "${s.name}" is immutable`);const n={...s,...e,id:s.id};return this.configMaps.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`ConfigMap ${s.name} updated`,{kind:"ConfigMap",name:s.name,namespace:s.namespace,uid:s.id}),n}deleteConfigMap(t){const e=this.configMaps.get(t);if(!e)throw new Error(`ConfigMap with id "${t}" not found`);this.configMaps.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`ConfigMap ${e.name} deleted`,{kind:"ConfigMap",name:e.name,namespace:e.namespace,uid:e.id})}createSecret(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s=t.data||{};if(t.stringData)for(const[i,o]of Object.entries(t.stringData))s[i]=btoa(o);const n={...t,id:this.generateId(),createdAt:Date.now(),type:t.type||"Opaque",data:s};return this.secrets.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Secret ${n.name} created`,{kind:"Secret",name:n.name,namespace:n.namespace,uid:n.id}),n}updateSecret(t,e){const s=this.secrets.get(t);if(!s)throw new Error(`Secret with id "${t}" not found`);if(s.immutable)throw new Error(`Secret "${s.name}" is immutable`);const n={...s,...e,id:s.id};if(e.stringData){n.data={...n.data};for(const[i,o]of Object.entries(e.stringData))n.data[i]=btoa(o)}return this.secrets.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Secret ${s.name} updated`,{kind:"Secret",name:s.name,namespace:s.namespace,uid:s.id}),n}deleteSecret(t){const e=this.secrets.get(t);if(!e)throw new Error(`Secret with id "${t}" not found`);this.secrets.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Secret ${e.name} deleted`,{kind:"Secret",name:e.name,namespace:e.namespace,uid:e.id})}createNamespace(t){if(!this.config)throw new Error("Engine not initialized");if(Array.from(this.namespaces.values()).find(n=>n.name===t.name))throw new Error(`Namespace "${t.name}" already exists`);const s={...t,id:this.generateId(),createdAt:Date.now(),phase:"Active"};return this.namespaces.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Namespace ${s.name} created`,{kind:"Namespace",name:s.name,uid:s.id}),s}deleteNamespace(t){const e=this.namespaces.get(t);if(!e)throw new Error(`Namespace with id "${t}" not found`);if(e.name==="default"||e.name===this.config?.defaultNamespace)throw new Error("Cannot delete default namespace");const s=Array.from(this.pods.values()).some(o=>o.namespace===e.name),n=Array.from(this.deployments.values()).some(o=>o.namespace===e.name),i=Array.from(this.services.values()).some(o=>o.namespace===e.name);if(s||n||i)throw new Error(`Namespace "${e.name}" contains resources and cannot be deleted`);this.namespaces.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Namespace ${e.name} deleted`,{kind:"Namespace",name:e.name,uid:e.id})}getPods(){return Array.from(this.pods.values())}getPodsByNamespace(t){return Array.from(this.pods.values()).filter(e=>e.namespace===t)}getDeployments(){return Array.from(this.deployments.values())}getDeploymentsByNamespace(t){return Array.from(this.deployments.values()).filter(e=>e.namespace===t)}getServices(){return Array.from(this.services.values())}getServicesByNamespace(t){return Array.from(this.services.values()).filter(e=>e.namespace===t)}getConfigMaps(){return Array.from(this.configMaps.values())}getConfigMapsByNamespace(t){return Array.from(this.configMaps.values()).filter(e=>e.namespace===t)}getSecrets(){return Array.from(this.secrets.values())}getSecretsByNamespace(t){return Array.from(this.secrets.values()).filter(e=>e.namespace===t)}getNamespaces(){return Array.from(this.namespaces.values())}getNodes(){return Array.from(this.nodes.values())}getEvents(){return[...this.events]}getEventsByNamespace(t){return this.events.filter(e=>e.namespace===t)}getPersistentVolumeClaims(){return Array.from(this.persistentVolumeClaims.values())}getMetrics(){return{...this.kubernetesMetrics}}getLoad(){const t=Array.from(this.nodes.values()).reduce((d,h)=>{if(h.capacity?.cpu){const f=parseFloat(h.capacity.cpu);return d+f*1e3}return d},0),e=this.kubernetesMetrics.totalCpuUsage,s=t>0?e/t:0,n=this.kubernetesMetrics.totalMemoryCapacity>0?this.kubernetesMetrics.totalMemoryUsage/this.kubernetesMetrics.totalMemoryCapacity:0,i=Array.from(this.nodes.values()).reduce((d,h)=>h.capacity?.pods?d+parseInt(h.capacity.pods,10):d,0),o=i>0?this.kubernetesMetrics.podsTotal/i:0,l=this.kubernetesMetrics.podsTotal>0?this.kubernetesMetrics.podsFailed/this.kubernetesMetrics.podsTotal:0;return{throughput:this.kubernetesMetrics.podsRunning*10,averageLatency:100+Math.random()*200,errorRate:l,cpuUtilization:Math.min(1,s),memoryUtilization:Math.min(1,n),podUtilization:Math.min(1,o),networkUtilization:.1+Math.random()*.3,diskUtilization:.2+Math.random()*.2}}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getConfig(){return this.config?(this.syncResourcesToConfig(),{...this.config}):null}}class ST{config=null;inventories=new Map;projects=new Map;credentials=new Map;jobTemplates=new Map;activeJobs=new Map;jobHistory=new Map;MAX_JOB_HISTORY=1e3;schedules=new Map;ansibleMetrics={inventoriesTotal:0,projectsTotal:0,credentialsTotal:0,jobTemplatesTotal:0,jobTemplatesEnabled:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,jobsPerHour:0,averageJobDuration:0,hostsTotal:0,hostsOk:0,hostsChanged:0,hostsFailed:0,hostsUnreachable:0,schedulesTotal:0,schedulesEnabled:0,requestsTotal:0,requestsErrors:0};jobHistoryList=[];MAX_JOB_HISTORY_LIST=1e3;lastJobTime=new Map;scheduleNextRuns=new Map;processRequest(t=!0){this.ansibleMetrics.requestsTotal++,t||this.ansibleMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={towerUrl:e.towerUrl||"https://tower.example.com",organizationName:e.organizationName||"Default",defaultExecutionEnvironment:e.defaultExecutionEnvironment||"default",inventories:e.inventories||[],projects:e.projects||[],credentials:e.credentials||[],jobTemplates:e.jobTemplates||[],jobs:e.jobs||[],schedules:e.schedules||[],jobTriggerRate:e.jobTriggerRate||.5,averageJobDuration:e.averageJobDuration||12e4,failureRate:e.failureRate??.05,hostFailureRate:e.hostFailureRate??.02,playbookComplexity:e.playbookComplexity??.5,maxForks:e.maxForks||5,defaultTimeout:e.defaultTimeout||3600},this.initializeInventories(),this.initializeProjects(),this.initializeCredentials(),this.initializeJobTemplates(),this.initializeJobs(),this.initializeSchedules()}updateConfig(t){this.initializeConfig(t)}initializeInventories(){this.inventories.clear();const t=this.config?.inventories||[];if(t.length===0){const e={id:"default",name:"Default",description:"Default inventory",type:"static",organization:this.config?.organizationName||"Default",hosts:[],groups:[]};this.inventories.set("default",e);return}for(const e of t){const s={id:e.id,name:e.name,description:e.description,type:e.type||"static",organization:this.config?.organizationName||"Default",hosts:(e.hosts||[]).map((n,i)=>({id:n.id||`host-${e.id}-${i}`,name:n.name,enabled:!0,groups:n.groups||[],variables:n.variables||{}})),groups:(e.groups||[]).map((n,i)=>({id:n.id||`group-${e.id}-${i}`,name:n.name,hosts:n.hosts||[],variables:n.variables||{},children:n.children||[]}))};this.inventories.set(s.id,s)}}initializeProjects(){this.projects.clear();const t=this.config?.projects||[];if(t.length===0){const e={id:"default",name:"Default",description:"Default project",organization:this.config?.organizationName||"Default",scmType:"manual",playbooks:["playbook.yml"]};this.projects.set("default",e);return}for(const e of t){const s={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",scmType:e.scmType||"manual",scmUrl:e.scmUrl,scmBranch:e.scmBranch||"main",playbooks:e.playbooks||["playbook.yml"],status:"successful",lastUpdateTime:Date.now()-Math.random()*864e5};this.projects.set(s.id,s)}}initializeCredentials(){this.credentials.clear();const t=this.config?.credentials||[];for(const e of t){const s={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",credentialType:e.credentialType||"machine",username:e.username,password:e.password,sshKey:e.sshKey,becomeMethod:e.becomeMethod,becomeUsername:e.becomeUsername};this.credentials.set(s.id,s)}}initializeJobTemplates(){this.jobTemplates.clear();const t=this.config?.jobTemplates||[];for(const e of t){const s={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",inventory:e.inventory,project:e.project,playbook:e.playbook,credential:e.credential,enabled:e.enabled!==!1,jobType:e.jobType||"run",becomeEnabled:e.becomeEnabled,becomeUser:e.becomeUser,forks:e.forks||this.config?.maxForks||5,timeout:e.timeout||this.config?.defaultTimeout||3600,verbosity:e.verbosity||0};this.jobTemplates.set(s.id,s)}}initializeJobs(){const t=new Set(Array.from(this.activeJobs.keys())),e=new Set((this.config?.jobs||[]).map(n=>n.id));for(const[n,i]of this.jobHistory.entries())!t.has(n)&&!e.has(n)&&this.jobHistory.delete(n);const s=this.config?.jobs||[];for(const n of s){const i={id:n.id,name:n.name||`Job ${n.id}`,type:n.type||"job",status:n.status||"successful",jobTemplate:n.jobTemplate,created:n.startedAt?new Date(n.startedAt).getTime():Date.now()-36e5,started:n.startedAt?new Date(n.startedAt).getTime():void 0,finished:n.finishedAt?new Date(n.finishedAt).getTime():void 0,elapsed:n.duration,hosts:n.hosts?.map((o,l)=>({id:`host-${n.id}-${l}`,name:o.name,status:o.status,failed:o.status==="failed"||o.status==="unreachable",changed:o.status==="changed",unreachable:o.status==="unreachable",skipped:o.status==="skipped"}))};["new","pending","waiting","running"].includes(i.status)?this.activeJobs.set(i.id,i):this.jobHistory.set(i.id,i)}}initializeSchedules(){this.schedules.clear();const t=this.config?.schedules||[];for(const e of t){const s={id:e.id,name:e.name,unifiedJobTemplate:e.unifiedJobTemplate,enabled:e.enabled!==!1,rrule:e.rrule||`DTSTART:20240101T000000Z
RRULE:FREQ=HOURLY;INTERVAL=1`,nextRun:Date.now()+36e5};this.schedules.set(s.id,s),this.scheduleNextRuns.set(s.id,s.nextRun||Date.now()+36e5)}}performUpdate(t){this.config&&(this.updateActiveJobs(t),this.triggerScheduledJobs(t),this.triggerAutomaticJobs(t),this.updateMetrics())}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[s,n]of e){if(!["new","pending","waiting","running"].includes(n.status)){if(this.jobHistory.set(s,n),this.jobHistory.size>this.MAX_JOB_HISTORY){const m=this.jobHistory.keys().next().value;m&&this.jobHistory.delete(m)}this.activeJobs.delete(s);continue}if(!n.started){n.started=t,n.status="running";continue}const i=(t-n.started)/1e3,o=this.config?.averageJobDuration||12e4,l=this.config?.playbookComplexity||.5,f=o*(1+l*.5)*(1+(Math.random()-.5)*.3)/1e3;if(i>=f){if(Math.random()<(this.config?.failureRate||.05)?n.status="failed":n.status="successful",n.finished=t,n.elapsed=i,n.hosts&&n.hosts.length>0){const y=this.config?.hostFailureRate||.02;for(const b of n.hosts)n.status==="failed"?Math.random()<y*2?(b.status=Math.random()<.5?"failed":"unreachable",b.failed=!0):Math.random()<.3?(b.status="changed",b.changed=!0):b.status="ok":Math.random()<y?(b.status="unreachable",b.unreachable=!0):Math.random()<.4?(b.status="changed",b.changed=!0):b.status="ok"}n.hosts&&(n.resultSummary={ok:n.hosts.filter(y=>y.status==="ok").length,changed:n.hosts.filter(y=>y.status==="changed").length,unreachable:n.hosts.filter(y=>y.status==="unreachable").length,failed:n.hosts.filter(y=>y.status==="failed").length,skipped:n.hosts.filter(y=>y.status==="skipped").length}),this.jobHistoryList.push({timestamp:t,duration:i,status:n.status}),this.jobHistoryList.length>this.MAX_JOB_HISTORY_LIST&&this.jobHistoryList.shift()}else if(n.elapsed=i,n.hosts){const m=i/f;for(let y=0;y<n.hosts.length;y++)m+(Math.random()-.5)*.2>=.9&&n.hosts[y].status==="ok"&&Math.random()<.3&&(n.hosts[y].status="changed",n.hosts[y].changed=!0)}}}triggerScheduledJobs(t){for(const[e,s]of this.schedules.entries()){if(!s.enabled)continue;const n=this.scheduleNextRuns.get(e);if(!n||t<n)continue;const i=this.jobTemplates.get(s.unifiedJobTemplate);if(!i||!i.enabled)continue;this.launchJobFromTemplate(i.id,s.extraData||{});const o=t+36e5;this.scheduleNextRuns.set(e,o),s.nextRun=o,s.lastRun=t}}triggerAutomaticJobs(t){if(!this.config)return;const s=36e5/(this.config.jobTriggerRate||.5);for(const[n,i]of this.jobTemplates.entries()){if(!i.enabled)continue;const o=this.lastJobTime.get(n)||0;t-o>=s&&Math.random()<.1&&(this.launchJobFromTemplate(n),this.lastJobTime.set(n,t))}}launchJobFromTemplate(t,e){const s=this.jobTemplates.get(t);if(!s||!s.enabled)return null;const n=this.inventories.get(s.inventory);if(!n)return null;const i=this.projects.get(s.project);if(!i)return null;const o=`job-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l=n.hosts||[],d={id:o,name:`${s.name} - ${new Date().toISOString()}`,type:"job",status:"pending",jobTemplate:t,jobTemplateName:s.name,inventory:s.inventory,inventoryName:n.name,project:s.project,projectName:i.name,playbook:s.playbook,credential:s.credential,vaultCredential:s.vaultCredential,organization:s.organization,created:Date.now(),jobType:s.jobType,becomeEnabled:s.becomeEnabled,forks:s.forks||this.config?.maxForks||5,limit:s.limit||e?.limit,verbosity:s.verbosity||0,extraVars:s.extraVars||e?.extraVars,jobTags:s.jobTags||e?.jobTags,skipTags:s.skipTags||e?.skipTags,timeout:s.timeout||this.config?.defaultTimeout||3600,hosts:l.map((h,f)=>({id:h.id,name:h.name,status:"ok",failed:!1,changed:!1,unreachable:!1,skipped:!1}))};return this.activeJobs.set(o,d),s.lastJobRun=o,s.lastJobStatus="running",s.lastJobStarted=Date.now(),d}updateMetrics(){this.ansibleMetrics.inventoriesTotal=this.inventories.size,this.ansibleMetrics.projectsTotal=this.projects.size,this.ansibleMetrics.credentialsTotal=this.credentials.size,this.ansibleMetrics.jobTemplatesTotal=this.jobTemplates.size,this.ansibleMetrics.jobTemplatesEnabled=Array.from(this.jobTemplates.values()).filter(h=>h.enabled).length;const t=[...this.activeJobs.values(),...this.jobHistory.values()];this.ansibleMetrics.jobsTotal=t.length,this.ansibleMetrics.jobsSuccess=t.filter(h=>h.status==="successful").length,this.ansibleMetrics.jobsFailed=t.filter(h=>h.status==="failed"||h.status==="error").length,this.ansibleMetrics.jobsRunning=this.activeJobs.size,this.ansibleMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(h=>h.status==="pending"||h.status==="waiting").length;const e=Date.now()-36e5,s=this.jobHistoryList.filter(h=>h.timestamp>=e);if(this.ansibleMetrics.jobsPerHour=s.length,this.jobHistoryList.length>0){const h=this.jobHistoryList.reduce((f,m)=>f+m.duration,0);this.ansibleMetrics.averageJobDuration=h/this.jobHistoryList.length}else this.ansibleMetrics.averageJobDuration=0;let n=0,i=0,o=0,l=0,d=0;for(const h of this.inventories.values())n+=h.hosts?.length||0;for(const h of this.activeJobs.values())if(h.hosts)for(const f of h.hosts)f.status==="ok"&&i++,f.status==="changed"&&o++,f.status==="failed"&&l++,f.status==="unreachable"&&d++;this.ansibleMetrics.hostsTotal=n,this.ansibleMetrics.hostsOk=i,this.ansibleMetrics.hostsChanged=o,this.ansibleMetrics.hostsFailed=l,this.ansibleMetrics.hostsUnreachable=d,this.ansibleMetrics.schedulesTotal=this.schedules.size,this.ansibleMetrics.schedulesEnabled=Array.from(this.schedules.values()).filter(h=>h.enabled).length}getMetrics(){return{...this.ansibleMetrics}}getInventories(){return Array.from(this.inventories.values())}getProjects(){return Array.from(this.projects.values())}getCredentials(){return Array.from(this.credentials.values())}getJobTemplates(){return Array.from(this.jobTemplates.values())}getActiveJobs(){return Array.from(this.activeJobs.values())}getAllJobs(){return[...Array.from(this.activeJobs.values()),...Array.from(this.jobHistory.values())]}getJob(t){return this.activeJobs.get(t)||this.jobHistory.get(t)}getSchedules(){return Array.from(this.schedules.values())}getJobLogs(t){const e=this.getJob(t);if(!e)return[];const s=[];if(s.push(`Starting job ${e.name} (ID: ${e.id})`),s.push(`Job Template: ${e.jobTemplateName||"N/A"}`),s.push(`Inventory: ${e.inventoryName||"N/A"}`),s.push(`Playbook: ${e.playbook||"N/A"}`),e.hosts){s.push(`
Running on ${e.hosts.length} host(s)...`);for(const n of e.hosts)s.push(`
${n.name}:`),n.status==="ok"?s.push("  OK - Task completed successfully"):n.status==="changed"?s.push("  CHANGED - Task made changes to the system"):n.status==="failed"?s.push("  FAILED - Task failed to execute"):n.status==="unreachable"?s.push("  UNREACHABLE - Host is unreachable"):n.status==="skipped"&&s.push("  SKIPPED - Task was skipped")}return e.resultSummary&&(s.push(`
PLAY RECAP`),s.push(`ok: ${e.resultSummary.ok}, changed: ${e.resultSummary.changed}, unreachable: ${e.resultSummary.unreachable}, failed: ${e.resultSummary.failed}, skipped: ${e.resultSummary.skipped}`)),e.status==="successful"?s.push(`
Job completed successfully in ${e.elapsed?.toFixed(2)}s`):e.status==="failed"&&s.push(`
Job failed after ${e.elapsed?.toFixed(2)}s`),s}cancelJob(t){const e=this.activeJobs.get(t);return!e||!["pending","waiting","running"].includes(e.status)?!1:(e.status="canceled",e.canceled=!0,e.canceledBy="user",e.finished=Date.now(),e.started&&(e.elapsed=(Date.now()-e.started)/1e3),this.jobHistory.set(t,e),this.activeJobs.delete(t),!0)}}class MT{routers=new Map;services=new Map;middlewares=new Map;entryPoints=new Map;globalConfig={};roundRobinCounters=new Map;connectionCounts=new Map;serverHealthStatus=new Map;serverCheckFailures=new Map;serverCheckSuccesses=new Map;healthCheckTimers=new Map;rateLimitTracker=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;totalLatency=0;latencyCount=0;initialize(t){this.routers.clear(),this.services.clear(),this.middlewares.clear(),this.entryPoints.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.serverHealthStatus.clear(),this.serverCheckFailures.clear(),this.serverCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.entryPoints)for(const e of t.entryPoints)this.entryPoints.set(e.name,e);else this.entryPoints.set("web",{name:"web",address:":80"}),this.entryPoints.set("websecure",{name:"websecure",address:":443"});if(t.routers)for(const e of t.routers)this.routers.set(e.name,{...e,priority:e.priority||0,requests:e.requests||0,responses:e.responses||0,errors:e.errors||0,bytesIn:e.bytesIn||0,bytesOut:e.bytesOut||0});if(t.services){for(const e of t.services)if(this.services.set(e.name,e),this.roundRobinCounters.set(e.name,0),e.loadBalancer?.healthCheck?.enabled&&e.loadBalancer.servers)for(const s of e.loadBalancer.servers)this.startHealthCheck(e.name,s.url,e.loadBalancer.healthCheck)}if(t.middlewares)for(const e of t.middlewares)this.middlewares.set(e.name,e);this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.latencyCount=0}routeRequest(t){const e=Date.now();this.requestCount++;const s=this.globalConfig.maxConnections||1e4;if(this.activeConnections>=s)return this.connectionRejects++,this.errorCount++,{router:null,service:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-e}};this.activeConnections++;const n=this.findMatchingRouter(t);if(!n)return this.activeConnections--,this.errorCount++,{router:null,service:null,response:{status:404,error:"No matching router found",latency:Date.now()-e}};n.requests=(n.requests||0)+1;let i={...t};const o=[];if(n.middlewares&&n.middlewares.length>0)for(const M of n.middlewares){const T=this.middlewares.get(M);if(T){const E=this.applyMiddleware(T,i);if(E.block)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:null,response:{status:E.status||403,error:E.error||"Middleware blocked request",latency:Date.now()-e,routerMatched:n.name},middlewaresApplied:o};E.request&&(i=E.request),o.push(M)}}const l=this.services.get(n.service);if(!l)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:null,response:{status:503,error:`Service ${n.service} not found`,latency:Date.now()-e,routerMatched:n.name},middlewaresApplied:o};const d=this.selectServer(l,i);if(!d)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:l,response:{status:503,error:"No healthy server available",latency:Date.now()-e,routerMatched:n.name},middlewaresApplied:o};const h=5+Math.random()*95,f=n.tls?.enabled?5+Math.random()*15:0,m=this.globalConfig.responseTimeout||3e4,y=h+f;if(y>m)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:l,response:{status:504,error:"Response timeout",latency:m,serviceTarget:l.name,serverTarget:d,routerMatched:n.name},middlewaresApplied:o};const b={status:200,body:{proxied:!0,service:l.name,server:d},latency:y,serviceTarget:l.name,serverTarget:d,routerMatched:n.name},C=1024,S=2048;n.bytesIn=(n.bytesIn||0)+C,n.bytesOut=(n.bytesOut||0)+S,n.responses=(n.responses||0)+1,n.averageLatency=((n.averageLatency||0)*(n.responses-1)+y)/n.responses,l.totalRequests=(l.totalRequests||0)+1,l.totalResponses=(l.totalResponses||0)+1,this.totalBytesIn+=C,this.totalBytesOut+=S,this.responseCount++,this.activeConnections--,this.totalLatency+=y,this.latencyCount++;const R=this.connectionCounts.get(d)||0;return this.connectionCounts.set(d,R+1),{router:n,service:l,response:b,middlewaresApplied:o}}findMatchingRouter(t){let e=[];for(const s of this.routers.values())t.entryPoint&&!s.entryPoints.includes(t.entryPoint)||this.evaluateRule(s.rule,t)&&e.push(s);return e.sort((s,n)=>(n.priority||0)-(s.priority||0)),e.length>0?e[0]:null}evaluateRule(t,e){try{const s=t.split("&&").map(n=>n.trim());for(const n of s){if(n.startsWith("Host(")){const i=n.match(/Host\(`([^`]+)`\)/);if(i){const o=i[1],l=e.host||e.headers?.Host||"";if(l!==o&&!l.endsWith(`.${o}`))return!1}}if(n.startsWith("PathPrefix(")){const i=n.match(/PathPrefix\(`([^`]+)`\)/);if(i){const o=i[1];if(!e.path.startsWith(o))return!1}}if(n.startsWith("Path(")&&!n.startsWith("PathPrefix(")){const i=n.match(/Path\(`([^`]+)`\)/);if(i){const o=i[1];if(e.path!==o)return!1}}if(n.startsWith("Method(")){const i=n.match(/Method\(`([^`]+)`\)/);if(i){const o=i[1];if(e.method.toUpperCase()!==o.toUpperCase())return!1}}}return!0}catch(s){return console.warn("Failed to parse Traefik rule:",t,s),!0}}applyMiddleware(t,e){switch(t.type){case"rateLimit":return this.applyRateLimit(t,e);case"ipAllowList":case"ipWhiteList":return this.applyIPAllowList(t,e);case"auth":case"basicAuth":case"digestAuth":return this.applyAuth(t,e);case"headers":return this.applyHeaders(t,e);case"redirect":return this.applyRedirect(t,e);case"stripPrefix":return this.applyStripPrefix(t,e);case"addPrefix":return this.applyAddPrefix(t,e);default:return{block:!1,request:e}}}applyRateLimit(t,e){if(!t.config)return{block:!1};const s=t.config.average||100,n=t.config.burst||50,i=this.parsePeriod(t.config.period||"1s"),o=e.clientIP||"0.0.0.0",l=`${t.name}:${o}`,d=Date.now();let h=this.rateLimitTracker.get(l);return(!h||h.resetAt<d)&&(h={count:0,resetAt:d+i,burst:n},this.rateLimitTracker.set(l,h)),h.count>=s+n?{block:!0,status:429,error:"Rate limit exceeded"}:(h.count++,{block:!1})}applyIPAllowList(t,e){if(!t.config?.sourceRange)return{block:!1};const s=e.clientIP||"0.0.0.0";return t.config.sourceRange.some(i=>i.includes("/")?s.startsWith(i.split("/")[0]):s===i)?{block:!1}:{block:!0,status:403,error:"IP not allowed"}}applyAuth(t,e){return t.config?.headerField&&!e.headers?.[t.config.headerField]?{block:!0,status:401,error:"Authentication required"}:{block:!1}}applyHeaders(t,e){const s={...e};return s.headers||(s.headers={}),t.config?.customRequestHeaders&&Object.assign(s.headers,t.config.customRequestHeaders),{block:!1,request:s}}applyRedirect(t,e){return{block:!1}}applyStripPrefix(t,e){if(!t.config?.prefix)return{block:!1,request:e};const s={...e};return s.path.startsWith(t.config.prefix)&&(s.path=s.path.substring(t.config.prefix.length)),{block:!1,request:s}}applyAddPrefix(t,e){if(!t.config?.prefix)return{block:!1,request:e};const s={...e};return s.path=t.config.prefix+s.path,{block:!1,request:s}}selectServer(t,e){const n=(t.loadBalancer?.servers||[]).filter(o=>{const l=this.serverHealthStatus.get(o.url);return l==="healthy"||l===void 0});if(n.length===0)return null;switch(t.loadBalancer?.strategy||"roundRobin"){case"roundRobin":return this.selectRoundRobin(t.name,n);case"wrr":return this.selectWeightedRoundRobin(t.name,n);case"drr":return this.selectDynamicRoundRobin(t.name,n);default:return n[0]?.url||null}}selectRoundRobin(t,e){const s=this.roundRobinCounters.get(t)||0,n=e[s%e.length];return this.roundRobinCounters.set(t,(s+1)%e.length),n.url}selectWeightedRoundRobin(t,e){const s=e.reduce((o,l)=>o+(l.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),o.url;return this.roundRobinCounters.set(t,(n+1)%s),e[0]?.url||""}selectDynamicRoundRobin(t,e){let s=1/0,n=e[0];for(const i of e){const l=(this.connectionCounts.get(i.url)||0)/(i.weight||1);l<s&&(s=l,n=i)}return n.url}startHealthCheck(t,e,s){const n=(s.interval||10)*1e3,i=`${t}:${e}`;this.serverHealthStatus.set(e,"checking");const o=async()=>{try{if(Math.random()>.1){this.serverHealthStatus.set(e,"healthy");const f=this.serverCheckSuccesses.get(e)||0;this.serverCheckSuccesses.set(e,f+1),this.serverCheckFailures.set(e,0)}else{const f=(this.serverCheckFailures.get(e)||0)+1;this.serverCheckFailures.set(e,f),f>=3&&this.serverHealthStatus.set(e,"unhealthy")}}catch{const h=(this.serverCheckFailures.get(e)||0)+1;this.serverCheckFailures.set(e,h),h>=3&&this.serverHealthStatus.set(e,"unhealthy")}};o();const l=setInterval(o,n);this.healthCheckTimers.set(i,l)}parsePeriod(t){const e=t.match(/^(\d+)([smh])$/);if(!e)return 1e3;const s=parseInt(e[1],10);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;default:return 1e3}}getStats(){let t=0,e=0;for(const o of this.services.values()){const l=o.loadBalancer?.servers||[];t+=l.length;for(const d of l){const h=this.serverHealthStatus.get(d.url);(h==="healthy"||h===void 0)&&e++}}const s=Array.from(this.routers.values()).filter(o=>(o.requests||0)>0).length,n=this.latencyCount>0?this.totalLatency/this.latencyCount:0,i=this.requestCount>0?this.errorCount/this.requestCount:0;return{routers:this.routers.size,activeRouters:s,services:this.services.size,middlewares:this.middlewares.size,entryPoints:this.entryPoints.size,totalServers:t,healthyServers:e,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:i,averageLatency:n}}getRouter(t){return this.routers.get(t)}getService(t){return this.services.get(t)}getMiddleware(t){return this.middlewares.get(t)}resetStats(){this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.latencyCount=0;for(const t of this.routers.values())t.requests=0,t.responses=0,t.errors=0,t.bytesIn=0,t.bytesOut=0,t.averageLatency=0;for(const t of this.services.values())t.totalRequests=0,t.totalResponses=0,t.activeConnections=0}connectionRejects=0}class RT{config=null;routingEngine;metrics={requestsTotal:0,responsesTotal:0,errorsTotal:0,activeRouters:0,totalRouters:0,totalServices:0,totalMiddlewares:0,totalServers:0,healthyServers:0,activeConnections:0,totalBytesIn:0,totalBytesOut:0,averageLatency:0,errorRate:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new MT}initializeConfig(t){const e=t.data.config||{},s=Array.isArray(e.routers)?e.routers.map(l=>({id:l.id||l.name,name:l.name,rule:l.rule||`Host(\`${l.name||"example.com"}\`)`,service:l.service,entryPoints:Array.isArray(l.entryPoints)?l.entryPoints:["web"],middlewares:Array.isArray(l.middlewares)?l.middlewares:[],tls:l.tls?{enabled:l.tls===!0||l.tls.enabled===!0}:void 0,priority:l.priority||0,requests:l.requests||0,responses:l.responses||0,errors:l.errors||0})):[],n=Array.isArray(e.services)?e.services.map(l=>({id:l.id||l.name,name:l.name,loadBalancer:{servers:Array.isArray(l.servers)?l.servers.map(d=>({url:d.url||d.address||"http://localhost:8080",weight:d.weight||1})):l.url?[{url:l.url,weight:1}]:[],strategy:l.loadBalancer||"roundRobin",healthCheck:l.healthCheck?.enabled?{enabled:!0,path:l.healthCheck.path||"/health",interval:l.healthCheck.interval||10,timeout:l.healthCheck.timeout||5}:void 0},totalRequests:l.totalRequests||0,totalResponses:l.totalResponses||0})):[],i=Array.isArray(e.middlewares)?e.middlewares.map(l=>({id:l.id||l.name,name:l.name,type:l.type||"headers",config:l.config||{}})):[],o=Array.isArray(e.entryPoints)?e.entryPoints.map(l=>typeof l=="string"?{name:l,address:l.includes(":")?l:`:${l==="web"?"80":l==="websecure"?"443":"80"}`}:l):[{name:"web",address:":80"},{name:"websecure",address:":443"}];this.config={routers:s,services:n,middlewares:i,entryPoints:o,enableDashboard:e.enableDashboard??!0,enableAPI:e.enableAPI??!0,autoDiscoverServices:e.autoDiscoverServices??!0,maxConnections:e.maxConnections||1e4,idleTimeout:e.idleTimeout||18e4,responseTimeout:e.responseTimeout||3e4},this.routingEngine.initialize({routers:s,services:n,middlewares:i,entryPoints:o,globalConfig:{maxConnections:this.config.maxConnections,idleTimeout:this.config.idleTimeout,responseTimeout:this.config.responseTimeout}}),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),s={path:t.path||"/",method:t.method||"GET",headers:t.headers,query:t.query,body:t.body,clientIP:t.clientIP||this.generateRandomIP(),protocol:t.protocol||"http",host:t.host||t.headers?.Host||"localhost",entryPoint:t.entryPoint||"web"},n=this.routingEngine.routeRequest(s),i=performance.now()-e+(n.response.latency||0);this.recordLatency(i);const o=Date.now();return this.firstRequestTime||(this.firstRequestTime=o),this.lastRequestTime=o,this.updateMetricsFromStats(),{success:n.response.status>=200&&n.response.status<400,latency:i,status:n.response.status,serviceTarget:n.response.serviceTarget,serverTarget:n.response.serverTarget,routerMatched:n.response.routerMatched,error:n.response.error}}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.requestsTotal=t.totalRequests,this.metrics.responsesTotal=t.totalResponses,this.metrics.activeRouters=t.activeRouters,this.metrics.totalRouters=t.routers,this.metrics.totalServices=t.services,this.metrics.totalMiddlewares=t.middlewares,this.metrics.totalServers=t.totalServers,this.metrics.healthyServers=t.healthyServers,this.metrics.activeConnections=t.activeConnections,this.metrics.totalBytesIn=t.totalBytesIn,this.metrics.totalBytesOut=t.totalBytesOut,this.metrics.averageLatency=t.averageLatency,this.metrics.errorRate=t.errorRate,this.metrics.errorsTotal=Math.floor(t.totalRequests*t.errorRate)}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLoad(){const t=this.getStats(),e=this.config?.maxConnections||1e4;let s=this.simulatedRequestRate;if(this.firstRequestTime&&this.lastRequestTime){const i=(this.lastRequestTime-this.firstRequestTime)/1e3;i>0&&(s=t.totalRequests/i)}s===0&&this.simulatedRequestRate>0&&(s=this.simulatedRequestRate);const n=e>0?Math.min(1,t.activeConnections/e):0;return{requestsPerSecond:s,averageLatency:t.averageLatency||0,errorRate:t.errorRate||0,utilization:n}}simulateRequests(t){this.simulatedRequestRate=t;const e=Date.now(),s=(e-this.lastSimulationTime)/1e3;if(this.lastSimulationTime=e,t<=0||s<=0)return;const n=Math.floor(t*s);for(let i=0;i<n;i++){const o=this.generateRandomPath(),l=["GET","POST","PUT","DELETE"][Math.floor(Math.random()*4)];this.processRequest({path:o,method:l,headers:{Host:"example.com","User-Agent":"Mozilla/5.0"},clientIP:this.generateRandomIP(),protocol:Math.random()>.5?"https":"http",host:"example.com",entryPoint:Math.random()>.5?"websecure":"web"})}}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomPath(){const t=["/","/api","/api/users","/api/products","/health","/status","/docs"];return t[Math.floor(Math.random()*t.length)]}updateConfig(t){this.initializeConfig(t)}resetStats(){this.routingEngine.resetStats(),this.firstRequestTime=null,this.lastRequestTime=null,this.latencyHistory=[],this.updateMetricsFromStats()}}class kT{errors=[];maxErrors=200;errorCounts=new Map;listeners=[];addError(t,e={}){const s=this.generateErrorId(t,e),n=this.errorCounts.get(s)||0;this.errorCounts.set(s,n+1);const i=this.errors.find(l=>l.id===s);if(i&&i.count!==void 0)return i.count=n+1,i.timestamp=Date.now(),this.notifyListeners(i),s;const o={id:s,timestamp:Date.now(),severity:e.severity||this.determineSeverity(t),source:e.source||"unknown",componentId:e.componentId,componentLabel:e.componentLabel,componentType:e.componentType,message:t instanceof Error?t.message:String(t),errorType:t instanceof Error?t.constructor.name:void 0,stack:t instanceof Error?t.stack:void 0,context:e.context,count:n+1};if(this.errors.unshift(o),this.errors.length>this.maxErrors){const l=this.errors.pop();l&&this.errorCounts.delete(l.id)}return this.notifyListeners(o),s}generateErrorId(t,e){const s=t instanceof Error?t.message:String(t),n=`${e.source||"unknown"}-${e.componentType||"unknown"}-${e.componentId||"global"}-${s}`;let i=0;for(let o=0;o<n.length;o++){const l=n.charCodeAt(o);i=(i<<5)-i+l,i=i&i}return`error-${Math.abs(i)}`}determineSeverity(t){if(t instanceof Error){const e=t.constructor.name,s=t.message.toLowerCase();if(e==="RangeError"||e==="ReferenceError"||s.includes("maximum call stack")||s.includes("cannot read property")||s.includes("is not a function"))return"critical";if(e==="TypeError"||s.includes("undefined")||s.includes("null"))return"warning"}return"info"}getErrors(){return[...this.errors]}getErrorsBySeverity(t){return this.errors.filter(e=>e.severity===t)}getErrorsBySource(t){return this.errors.filter(e=>e.source===t)}getErrorsByComponent(t){return this.errors.filter(e=>e.componentId===t)}getCriticalErrors(){return this.getErrorsBySeverity("critical")}getErrorCount(t){return t?this.getErrorsBySeverity(t).length:this.errors.length}clear(){this.errors=[],this.errorCounts.clear()}clearByFilter(t){this.errors=this.errors.filter(e=>{const s=!t(e);return s||this.errorCounts.delete(e.id),s})}removeError(t){this.errors=this.errors.filter(e=>e.id!==t),this.errorCounts.delete(t)}onError(t){return this.listeners.push(t),()=>{const e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}}notifyListeners(t){this.listeners.forEach(e=>{try{e(t)}catch(s){console.error("Error in error listener:",s)}})}getStats(){const t={total:this.errors.length,critical:this.getErrorCount("critical"),warning:this.getErrorCount("warning"),info:this.getErrorCount("info"),bySource:{}};return["emulation-engine","component-engine","alert-system","data-flow","routing-engine","initialization","configuration","unknown"].forEach(s=>{t.bySource[s]=this.getErrorsBySource(s).length}),t}}const it=new kT;class ET{nodes=[];connections=[];metrics=new Map;connectionMetrics=new Map;isRunning=!1;simulationTime=0;baseTime=Date.now();pausedTime=0;updateInterval=100;intervalId=null;latencyHistory=new Map;connectionLatencyHistory=new Map;HISTORY_SIZE=500;rabbitMQRoutingEngines=new Map;lastRabbitMQUpdate=new Map;activeMQRoutingEngines=new Map;lastActiveMQUpdate=new Map;sqsRoutingEngines=new Map;lastSQSUpdate=new Map;azureServiceBusRoutingEngines=new Map;lastAzureServiceBusUpdate=new Map;pubSubRoutingEngines=new Map;lastPubSubUpdate=new Map;kongRoutingEngines=new Map;nginxRoutingEngines=new Map;haproxyRoutingEngines=new Map;envoyRoutingEngines=new Map;apigeeRoutingEngines=new Map;mulesoftRoutingEngines=new Map;graphQLGatewayRoutingEngines=new Map;lastGraphQLGatewayUpdate=new Map;bffRoutingEngines=new Map;webhookRelayRoutingEngines=new Map;redisRoutingEngines=new Map;cassandraRoutingEngines=new Map;clickHouseRoutingEngines=new Map;snowflakeRoutingEngines=new Map;elasticsearchRoutingEngines=new Map;s3RoutingEngines=new Map;postgresConnectionPools=new Map;prometheusEngines=new Map;grafanaEngines=new Map;lokiEngines=new Map;jaegerEngines=new Map;otelCollectorEngines=new Map;pagerDutyEngines=new Map;keycloakEngines=new Map;vaultEngines=new Map;wafEngines=new Map;firewallEngines=new Map;idsIpsEngines=new Map;jenkinsEngines=new Map;gitlabCIEngines=new Map;argoCDEngines=new Map;terraformEngines=new Map;harborEngines=new Map;dockerEngines=new Map;kubernetesEngines=new Map;ansibleEngines=new Map;traefikEngines=new Map;constructor(){this.initializeMetrics()}calculatePercentile(t,e){if(t.length===0)return 0;const s=e/100*(t.length-1),n=Math.floor(s),i=Math.ceil(s),o=s-n;return n===i?t[n]:t[n]*(1-o)+t[i]*o}updateLatencyPercentiles(t,e,s){let n=this.latencyHistory.get(t);if(n||(n=[],this.latencyHistory.set(t,n)),n.push(e),n.length>this.HISTORY_SIZE&&n.shift(),n.length>0){const i=[...n].sort((o,l)=>o-l);s.latencyP50=this.calculatePercentile(i,50),s.latencyP99=this.calculatePercentile(i,99)}}updateConnectionLatencyPercentiles(t,e,s){let n=this.connectionLatencyHistory.get(t);if(n||(n=[],this.connectionLatencyHistory.set(t,n)),n.push(e),n.length>this.HISTORY_SIZE&&n.shift(),n.length>0){const i=[...n].sort((o,l)=>o-l);s.latencyP50=this.calculatePercentile(i,50),s.latencyP99=this.calculatePercentile(i,99)}}initialize(t,e){this.nodes=t,this.connections=e,this.initializeMetrics();for(const s of t){if(s.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(s),s.type==="activemq"&&this.initializeActiveMQRoutingEngine(s),s.type==="aws-sqs"&&this.initializeSQSRoutingEngine(s),s.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(s),s.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(s),s.type==="kong"&&this.initializeKongRoutingEngine(s),s.type==="nginx"&&this.initializeNginxRoutingEngine(s),s.type==="haproxy"&&this.initializeHAProxyRoutingEngine(s),s.type==="envoy"&&this.initializeEnvoyRoutingEngine(s),s.type==="apigee"&&this.initializeApigeeRoutingEngine(s),s.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(s),s.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(s),s.type==="bff-service"&&this.initializeBFFRoutingEngine(s),s.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(s),s.type==="postgres"&&this.initializePostgreSQLConnectionPool(s),s.type==="redis"&&this.initializeRedisRoutingEngine(s),s.type==="cassandra"&&this.initializeCassandraRoutingEngine(s),s.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(s),s.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(s),s.type==="elasticsearch"&&this.initializeElasticsearchRoutingEngine(s),s.type==="s3-datalake"&&this.initializeS3RoutingEngine(s),s.type==="prometheus"&&this.initializePrometheusEngine(s),s.type==="grafana"&&this.initializeGrafanaEngine(s),s.type==="jaeger"&&this.initializeJaegerEngine(s),s.type==="otel-collector"&&this.initializeOpenTelemetryCollectorEngine(s),s.type==="pagerduty"&&this.initializePagerDutyEngine(s),s.type==="keycloak")try{this.initializeKeycloakEngine(s)}catch(n){it.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeKeycloakEngine"}})}if(s.type==="secrets-vault")try{this.initializeVaultEngine(s)}catch(n){it.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeVaultEngine"}})}if(s.type==="waf")try{this.initializeWAFEngine(s)}catch(n){it.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeWAFEngine"}})}if(s.type==="firewall")try{this.initializeFirewallEngine(s)}catch(n){it.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeFirewallEngine"}})}if(s.type==="ids-ips")try{this.initializeIDSIPSEngine(s)}catch(n){it.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeIDSIPSEngine"}})}s.type==="jenkins"&&this.initializeJenkinsEngine(s),s.type==="gitlab-ci"&&this.initializeGitLabCIEngine(s),s.type==="argo-cd"&&this.initializeArgoCDEngine(s),s.type==="terraform"&&this.initializeTerraformEngine(s),s.type==="ansible"&&(this.ansibleEngines.has(s.id)?this.ansibleEngines.get(s.id).updateConfig(s):this.initializeAnsibleEngine(s)),s.type==="harbor"&&(this.harborEngines.has(s.id)?this.harborEngines.get(s.id).updateConfig(s):this.initializeHarborEngine(s)),s.type==="docker"&&(this.dockerEngines.has(s.id)?this.dockerEngines.get(s.id).updateConfig(s):this.initializeDockerEngine(s)),s.type==="kubernetes"&&(this.kubernetesEngines.has(s.id)?this.kubernetesEngines.get(s.id).updateConfig(s):this.initializeKubernetesEngine(s))}for(const s of t)if(s.type==="postgres"){const n=this.postgresConnectionPools.get(s.id);if(n){const i=s.data.config;n.updateConfig({maxConnections:i.maxConnections||100,minConnections:i.minConnections||0,idleTimeout:i.idleTimeout||3e5,maxLifetime:i.maxLifetime||36e5,connectionTimeout:i.connectionTimeout||5e3})}}ds.initialize(t,e)}updateNodesAndConnections(t,e){this.nodes=t,this.connections=e;for(const i of t){if(this.metrics.has(i.id)||this.metrics.set(i.id,this.createDefaultMetrics(i.id,i.type)),i.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(i),i.type==="activemq"&&this.initializeActiveMQRoutingEngine(i),i.type==="aws-sqs"&&this.initializeSQSRoutingEngine(i),i.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(i),i.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(i),i.type==="kong"&&this.initializeKongRoutingEngine(i),i.type==="nginx"&&this.initializeNginxRoutingEngine(i),i.type==="haproxy"&&this.initializeHAProxyRoutingEngine(i),i.type==="envoy"&&this.initializeEnvoyRoutingEngine(i),i.type==="apigee"&&this.initializeApigeeRoutingEngine(i),i.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(i),i.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(i),i.type==="bff-service"&&this.initializeBFFRoutingEngine(i),i.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(i),i.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(i),i.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(i),i.type==="waf")try{this.wafEngines.has(i.id)?this.wafEngines.get(i.id).updateConfig(i):this.initializeWAFEngine(i)}catch(o){it.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeWAFEngine"}})}if(i.type==="firewall")try{this.firewallEngines.has(i.id)?this.firewallEngines.get(i.id).initializeConfig(i):this.initializeFirewallEngine(i)}catch(o){it.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeFirewallEngine"}})}if(i.type==="ids-ips")try{this.idsIpsEngines.has(i.id)?this.idsIpsEngines.get(i.id).updateConfig(i):this.initializeIDSIPSEngine(i)}catch(o){it.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeIDSIPSEngine"}})}i.type==="jenkins"&&(this.jenkinsEngines.has(i.id)?this.jenkinsEngines.get(i.id).updateConfig(i):this.initializeJenkinsEngine(i)),i.type==="gitlab-ci"&&(this.gitlabCIEngines.has(i.id)?this.gitlabCIEngines.get(i.id).updateConfig(i):this.initializeGitLabCIEngine(i)),i.type==="argo-cd"&&(this.argoCDEngines.has(i.id)?this.argoCDEngines.get(i.id).initializeConfig(i):this.initializeArgoCDEngine(i)),i.type==="terraform"&&(this.terraformEngines.has(i.id)?this.terraformEngines.get(i.id).updateConfig(i):this.initializeTerraformEngine(i)),i.type==="ansible"&&(this.ansibleEngines.has(i.id)?this.ansibleEngines.get(i.id).updateConfig(i):this.initializeAnsibleEngine(i)),i.type==="traefik"&&(this.traefikEngines.has(i.id)?this.traefikEngines.get(i.id).updateConfig(i):this.initializeTraefikEngine(i))}const s=new Set(t.map(i=>i.id));for(const[i]of this.metrics.entries())s.has(i)||(this.metrics.delete(i),this.rabbitMQRoutingEngines.delete(i),this.activeMQRoutingEngines.delete(i),this.sqsRoutingEngines.delete(i),this.azureServiceBusRoutingEngines.delete(i),this.pubSubRoutingEngines.delete(i),this.kongRoutingEngines.delete(i),this.nginxRoutingEngines.delete(i),this.haproxyRoutingEngines.delete(i),this.envoyRoutingEngines.delete(i),this.apigeeRoutingEngines.delete(i),this.mulesoftRoutingEngines.delete(i),this.graphQLGatewayRoutingEngines.delete(i),this.bffRoutingEngines.delete(i),this.webhookRelayRoutingEngines.delete(i),this.redisRoutingEngines.delete(i),this.cassandraRoutingEngines.delete(i),this.clickHouseRoutingEngines.delete(i),this.snowflakeRoutingEngines.delete(i),this.elasticsearchRoutingEngines.delete(i),this.s3RoutingEngines.delete(i),this.graphQLGatewayRoutingEngines.delete(i),this.keycloakEngines.delete(i),this.vaultEngines.delete(i),this.wafEngines.delete(i),this.firewallEngines.delete(i),this.idsIpsEngines.delete(i),this.jenkinsEngines.delete(i),this.gitlabCIEngines.delete(i),this.argoCDEngines.delete(i),this.terraformEngines.delete(i),this.ansibleEngines.delete(i),this.traefikEngines.delete(i),this.harborEngines.delete(i),this.lastRabbitMQUpdate.delete(i),this.lastActiveMQUpdate.delete(i),this.lastSQSUpdate.delete(i),this.lastAzureServiceBusUpdate.delete(i),this.lastPubSubUpdate.delete(i),this.lastGraphQLGatewayUpdate.delete(i));for(const i of e)this.connectionMetrics.has(i.id)||this.connectionMetrics.set(i.id,this.createDefaultConnectionMetrics(i));const n=new Set(e.map(i=>i.id));for(const[i]of this.connectionMetrics.entries())n.has(i)||this.connectionMetrics.delete(i);ds.updateNodesAndConnections(t,e)}start(){if(console.log("EmulationEngine.start() called",{isRunning:this.isRunning,hasInterval:!!this.intervalId}),this.isRunning&&!this.intervalId&&(console.log("Inconsistent state detected: isRunning=true but no interval, stopping first..."),this.stop()),this.isRunning){console.log("Already running, returning early");return}console.log("Setting isRunning to true and creating interval..."),this.isRunning=!0,this.baseTime=Date.now()-this.pausedTime,console.log("Starting data flow engine..."),ds.start(),console.log("Creating simulation interval..."),this.intervalId=setInterval(()=>{try{this.simulate()}catch(t){console.error("Error in simulation step:",t),it.addError(t,{severity:"critical",source:"emulation-engine",context:{simulationTime:this.simulationTime}})}},this.updateInterval),console.log("EmulationEngine.start() complete",{intervalId:!!this.intervalId})}stop(){this.isRunning&&(this.isRunning=!1,this.pausedTime=this.simulationTime,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),ds.stop())}resetSimulation(){this.stop(),this.simulationTime=0,this.pausedTime=0,this.baseTime=Date.now(),this.initializeMetrics()}simulate(){this.simulationTime=Date.now()-this.baseTime;const t=Date.now();for(const[s,n]of this.rabbitMQRoutingEngines.entries()){const i=this.lastRabbitMQUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastRabbitMQUpdate.set(s,t))}for(const[s,n]of this.activeMQRoutingEngines.entries()){const i=this.lastActiveMQUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastActiveMQUpdate.set(s,t))}for(const[s,n]of this.sqsRoutingEngines.entries()){const i=this.lastSQSUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastSQSUpdate.set(s,t))}for(const[s,n]of this.azureServiceBusRoutingEngines.entries()){const i=this.lastAzureServiceBusUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastAzureServiceBusUpdate.set(s,t))}for(const[s,n]of this.pubSubRoutingEngines.entries()){const i=this.lastPubSubUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastPubSubUpdate.set(s,t))}for(const s of this.nodes)this.updateComponentMetrics(s);try{ha.analyze(this.nodes,this.metrics,this.connectionMetrics,[])}catch(s){it.addError(s,{severity:"critical",source:"alert-system",context:{operation:"analyze"}})}const e=ha.getAlerts();for(const[s,n]of this.pagerDutyEngines.entries())n.processAlerts(t,e),n.advanceTime(t);for(const[s,n]of this.prometheusEngines.entries())n.performScraping(t,this.nodes,this.metrics);for(const[s,n]of this.grafanaEngines.entries()){const i=this.nodes.find(o=>o.id===s);if(i){const o=this.isPrometheusAvailableForGrafana(i),l=this.createLokiQueryExecutor(i);n.performUpdate(t,o,l)}}for(const[s,n]of this.lokiEngines.entries())n.performRetention(t);for(const[s,n]of this.jaegerEngines.entries())n.performCleanup(t);for(const[s,n]of this.jenkinsEngines.entries())try{const i=this.nodes.find(d=>d.id===s);n.performUpdate(t);const o=n.calculateComponentMetrics(),l=this.metrics.get(s);l&&o&&(l.throughput=o.throughput||l.throughput,l.latency=o.latency||l.latency,l.utilization=(o.utilization||0)/100,l.errorRate=(o.errorRate||0)/100,l.timestamp=t)}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"jenkins",operation:"performUpdate"}})}for(const[s,n]of this.gitlabCIEngines.entries())try{const i=this.nodes.find(d=>d.id===s);n.performUpdate(t);const o=n.getMetrics(),l=this.metrics.get(s);if(l&&o){l.throughput=o.pipelinesPerHour/3600,l.latency=o.averagePipelineDuration||0;const d=o.pipelinesSuccess+o.pipelinesFailed;l.errorRate=d>0?o.pipelinesFailed/d:0,l.utilization=o.pipelinesTotal>0?o.pipelinesRunning/o.pipelinesTotal:0,l.customMetrics={pipelinesTotal:o.pipelinesTotal,pipelinesRunning:o.pipelinesRunning,jobsRunning:o.jobsRunning,runnersOnline:o.runnersOnline}}}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"gitlab-ci",operation:"performUpdate"}})}for(const[s,n]of this.argoCDEngines.entries())try{const i=this.nodes.find(d=>d.id===s);n.performUpdate(t);const o=n.getMetrics(),l=this.metrics.get(s);if(l&&o){l.throughput=o.syncRate/3600,l.latency=o.averageSyncDuration||0;const d=o.syncOperationsSuccess+o.syncOperationsFailed;l.errorRate=d>0?o.syncOperationsFailed/d:0,l.utilization=o.applicationsTotal>0?o.syncOperationsRunning/o.applicationsTotal:0,l.customMetrics={applicationsTotal:o.applicationsTotal,applicationsSynced:o.applicationsSynced,applicationsOutOfSync:o.applicationsOutOfSync,syncOperationsRunning:o.syncOperationsRunning,repositoriesConnected:o.repositoriesConnected}}}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"argo-cd",operation:"performUpdate"}})}for(const[s,n]of this.harborEngines.entries())try{if(!this.nodes.find(l=>l.id===s))continue;const o=this.connections.some(l=>l.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"harbor",operation:"performUpdate"}})}for(const[s,n]of this.dockerEngines.entries())try{if(!this.nodes.find(l=>l.id===s))continue;const o=this.connections.some(l=>l.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"docker",operation:"performUpdate"}})}for(const[s,n]of this.kubernetesEngines.entries())try{if(!this.nodes.find(o=>o.id===s))continue;n.simulateStep()}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"kubernetes",operation:"simulateStep"}})}for(const[s,n]of this.ansibleEngines.entries())try{if(!this.nodes.find(d=>d.id===s))continue;n.performUpdate(t);const o=n.getMetrics(),l=this.metrics.get(s);l&&o&&(l.throughput=o.jobsPerHour/3600,l.latency=o.averageJobDuration*1e3)}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"ansible",operation:"performUpdate"}})}for(const[s,n]of this.otelCollectorEngines.entries())try{const i=this.nodes.find(o=>o.id===s);n.processBatchFlush()}catch(i){const o=this.nodes.find(l=>l.id===s);it.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"opentelemetry",operation:"processBatchFlush"}})}for(const s of this.connections)try{this.updateConnectionMetrics(s)}catch(n){it.addError(n,{severity:"warning",source:"emulation-engine",context:{operation:"updateConnectionMetrics",connectionId:s.id}})}}updateComponentMetrics(t){const e=t.data.config||{},s=this.metrics.get(t.id)||this.createDefaultMetrics(t.id,t.type),n=this.connections.some(d=>d.target===t.id),i=this.connections.some(d=>d.source===t.id);if(!(n||i))s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,s.customMetrics={};else switch(t.type){case"kafka":this.simulateKafka(t,e,s,n);break;case"rabbitmq":this.simulateRabbitMQ(t,e,s,n);break;case"activemq":this.simulateActiveMQ(t,e,s,n);break;case"aws-sqs":this.simulateSQS(t,e,s,n);break;case"azure-service-bus":this.simulateAzureServiceBus(t,e,s,n);break;case"gcp-pubsub":this.simulatePubSub(t,e,s,n);break;case"postgres":case"mongodb":case"redis":case"cassandra":this.simulateDatabase(t,e,s,n);break;case"nginx":this.simulateNginx(t,e,s,n);break;case"haproxy":this.simulateHAProxy(t,e,s,n);break;case"traefik":this.simulateTraefik(t,e,s,n);break;case"envoy":this.simulateEnvoy(t,e,s,n);break;case"docker":this.simulateDocker(t,e,s,n);break;case"kubernetes":this.simulateKubernetes(t,e,s,n);break;case"rest":case"grpc":case"websocket":this.simulateAPI(t,e,s,n);break;case"kong":this.simulateKong(t,e,s,n);break;case"apigee":this.simulateApigee(t,e,s,n);break;case"mulesoft":this.simulateMuleSoft(t,e,s,n);break;case"bff-service":this.simulateBFF(t,e,s,n);break;case"prometheus":this.simulatePrometheus(t,e,s,n);break;case"grafana":this.simulateGrafana(t,e,s,n);break;case"loki":this.simulateLoki(t,e,s,n);break;case"keycloak":this.simulateKeycloak(t,e,s,n);break;case"secrets-vault":this.simulateVault(t,e,s,n);break;case"pagerduty":this.simulatePagerDuty(t,e,s,n);break;case"waf":this.simulateWAF(t,e,s,n);break;case"firewall":this.simulateFirewall(t,e,s,n);break;case"ids-ips":this.simulateIDSIPS(t,e,s,n);break;case"argo-cd":this.simulateArgoCD(t,e,s,n);break;case"terraform":this.simulateTerraform(t,e,s,n);break;case"ansible":this.simulateAnsible(t,e,s,n);break;case"harbor":this.simulateHarbor(t,e,s,n);break;case"docker":this.simulateDocker(t,e,s,n);break}this.applyCascadeEffects(t,s);const l=mo.applyStateEffects(t.id,{throughput:s.throughput,latency:s.latency,errorRate:s.errorRate,utilization:s.utilization});s.throughput=l.throughput,s.latency=l.latency,s.errorRate=l.errorRate,s.utilization=l.utilization,this.updateLatencyPercentiles(t.id,s.latency,s),s.timestamp=Date.now(),this.metrics.set(t.id,s)}applyCascadeEffects(t,e){const s=this.connections.filter(f=>f.target===t.id);if(s.length===0)return;let n=0,i=0,o=0;const l=e.latency;for(const f of s){const m=this.metrics.get(f.source),y=this.connectionMetrics.get(f.id);if(!m||!y)continue;const b=y.throughputDependency||.5;o+=b;const C=m.errorRate*b*.3;n+=C*b;const R=Math.min(m.latency,500)*b*.2;i+=R*b,(m.errorRate>.5||m.utilization>.95)&&(n+=.1*b,i+=100*b)}o>0&&(n/=o,i/=o),i=Math.min(i,500),e.errorRate=Math.min(1,e.errorRate+n),e.latency=l+i;const h=1e4;e.latency=Math.min(e.latency,h),i>50&&(e.utilization=Math.min(1,e.utilization+.1)),n>.1&&(e.throughput=e.throughput*(1-n*.5))}updateConnectionMetrics(t){const e=this.metrics.get(t.source),s=this.metrics.get(t.target);if(!e||!s)return;const n=this.connectionMetrics.get(t.id)||{id:t.id,source:t.source,target:t.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0},i=this.nodes.find(d=>d.id===t.source),o=this.nodes.find(d=>d.id===t.target),l=i?.data.config?.avgPayloadSize||1024;n.traffic=e.throughput*l/1024,n.latency=this.calculateConnectionLatency(t,e,s),n.errorRate=e.errorRate*.1,this.calculateInteractionMetrics(t,n,e,s,i,o),this.updateConnectionLatencyPercentiles(t.id,n.latency,n),n.timestamp=Date.now(),this.connectionMetrics.set(t.id,n)}calculateInteractionMetrics(t,e,s,n,i,o){const l=t.data||{},h=(l.bandwidthMbps||1e3)*1024*1024/8;this.getComponentCapacity(i);const f=this.getComponentCapacity(o),m=s.throughput,y=i?.data.config?.avgPayloadSize||1024,b=m*y,C=Math.min(b,h),S=f*y,R=Math.min(C,S);e.effectiveThroughput=R/y;const T=this.connections.filter(J=>J.target===t.target).reduce((J,te)=>{const le=this.metrics.get(te.source);return J+(le?.throughput||0)},0);e.throughputDependency=T>0?m/T:0;const E=n.utilization,A=b/h,_=m/f,N=(l.packetLossPercent||0)/100;e.backpressure=Math.min(1,E*.4+A*.3+_*.2+N*.1);const z=b>h*.8,q=m>f*.8,Z=e.backpressure>.7;e.bottleneck=z||q||Z;const ne=this.getBaseLatency(t.type),ce=Math.max(0,e.latency-ne)/ne;e.congestion=Math.min(1,A*.4+ce*.3+N*.3),e.utilization=Math.min(1,e.effectiveThroughput/f)}getComponentCapacity(t){if(!t)return 1e3;const e=t.data.config||{};switch(t.type){case"kafka":case"rabbitmq":case"activemq":return e.throughputMsgs||1e3;case"postgres":case"mongodb":case"redis":return e.maxConnections?e.maxConnections*10:1e3;case"nginx":case"haproxy":case"rest":case"grpc":case"websocket":return e.requestsPerSecond||1e3;case"docker":case"kubernetes":return(e.workerThreads||1)*500;default:return 1e3}}getBaseLatency(t){return{sync:5,async:2,http:10,grpc:5,websocket:3}[t]||10}simulateKafka(t,e,s,n){const i=t.data.config,o=i?.brokers||["localhost:9092"],l=i?.topics||[],d=i?.consumerGroups||[],h=l.length||e.topicCount||5,f=l.reduce((j,O)=>j+(O.partitions||3),0)||e.partitions||3,m=l.length>0?l.reduce((j,O)=>j+(O.replication||1),0)/l.length:e.replicationFactor||1,y=this.connections.filter(j=>j.target===t.id);let b=0;for(const j of y){const O=this.metrics.get(j.source);O&&(b+=O.throughput||0)}const C=e.throughputMsgs||Math.max(1e3,b);if(!n&&C<=0){if(s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,l.length>0)for(const j of l)j.messages=j.messages||0,j.size=j.size||0;for(const j of d)j.lag=0;s.customMetrics={topics:h,partitions:f,replication:Math.round(m*10)/10,brokers:o.length,consumer_groups:d.length,total_lag:0};return}const S=.2*Math.sin(this.simulationTime/1e3);s.throughput=C*(1+S);const R=3,M=Math.min(f/10,10),T=Math.max(1,(m-1)*2),E=Math.max(0,(m-1)*1),A=this.calculateCompressionOverhead(l);if(s.latency=R+M+T+E+A,o.length>1){const j=Math.min(5,o.length*.5);s.latency+=j}const _=this.calculateUnderReplicatedPartitions(l,o.length),N=m>1?(m-1)*5e-4:0,z=_>0?_*.001:0,q=i?.acls||[];let Z=0,ne=0;for(const j of y){const O=this.nodes.find(Y=>Y.id===j.source);if(!O)continue;const W=O.data.config||{},fe=W.messaging?.producerId||W.clientId||`User:${O.id.slice(0,8)}`,P=W.messaging?.topic||l[0]?.name||"default-topic";if(!this.checkACLPermission(q,fe,"Topic",P,"Write")){const Y=this.metrics.get(j.source);Y&&(ne+=Y.throughput*.9,Z+=.45)}}ne>0&&(s.throughput=Math.max(0,s.throughput-ne)),s.errorRate=Math.max(0,Math.min(.1,N+z+Z+1e-4));const J=Math.min(1,s.throughput/1e4),te=Math.min(1,f/200);s.utilization=Math.min(1,J*.7+te*.3);const le=e.avgPayloadSize||1024,ue=this.updateInterval/1e3;for(const j of l){const O=s.throughput/h,W=O*ue;j.messages=(j.messages||0)+W;const fe=this.getCompressionRatio(j.config?.compressionType),P=W*le*fe;if(j.size=(j.size||0)+P,j.config?.retentionMs&&j.config.retentionMs>0){const F=j.config.retentionMs/1e3,ie=O*F;if(j.messages>ie){const U=j.messages-ie;j.messages=ie,j.size=Math.max(0,j.size-U*le*fe)}}if(j.config?.retentionBytes&&j.config.retentionBytes>0&&j.size>j.config.retentionBytes){const F=1-j.config.retentionBytes/j.size;j.size=j.config.retentionBytes,j.messages=Math.max(0,j.messages*(1-F))}if((j.config?.cleanupPolicy==="compact"||j.config?.cleanupPolicy==="delete,compact")&&this.simulationTime%3e5<this.updateInterval){const ie=Math.round(j.messages*.85),U=j.messages-ie;j.messages=ie,j.size=Math.max(0,j.size-U*le*fe)}if(j.config?.minInsyncReplicas){const F=j.config.minInsyncReplicas,Y=this.getAverageISRCount(j,o.length);if(Y<F){const ie=F-Y;s.errorRate+=ie*.01}}if(j.config?.maxMessageBytes&&le>j.config.maxMessageBytes){const F=Math.min(.1,(le-j.config.maxMessageBytes)/j.config.maxMessageBytes);s.errorRate+=F*.5}}let L=0;for(const j of d){const O=l.find(at=>at.name===j.topic);if(!O)continue;const W=j.members||1,fe=O.partitions||1,P=this.assignPartitionsToConsumers(W,fe),F=300;let Y=0;for(const at of P){const Je=at.partitions.length;Y+=Je*F}const ie=Math.min(Y,W*F),U=s.throughput/h||0,ae=j.id||`Group:${j.id}`,B=this.checkACLPermission(q,ae,"Topic",j.topic,"Read"),G=this.checkACLPermission(q,ae,"Group",j.id,"Read");let pe=ie;(!B||!G)&&(pe=0);const me=U,ye=pe,ve=Math.max(0,(me-ye)*ue),Pe=j.lag||0,Be=Math.max(0,Pe+ve-ye*ue);j.lag=Be,L+=Be,this.isRebalancing(t.id,j.id)&&(j.lag=Math.min(Be*1.2,Be+me*ue*.3),L+=Be*.2)}s.customMetrics={topics:h,partitions:f,replication:Math.round(m*10)/10,brokers:o.length,consumer_groups:d.length,total_lag:Math.round(L),avg_topic_messages:h>0?Math.round(l.reduce((j,O)=>j+(O.messages||0),0)/h):0,total_topic_size_mb:Math.round(l.reduce((j,O)=>j+(O.size||0),0)/1024/1024*100)/100,under_replicated_partitions:_}}calculateCompressionOverhead(t){if(t.length===0)return 0;const e={uncompressed:0,gzip:2,snappy:.5,lz4:.3,zstd:1};let s=0,n=0;for(const i of t){const o=i.config?.compressionType||"gzip",l=e[o]||0;l>0&&(s+=l,n++)}return n>0?s/n:0}getCompressionRatio(t){return{uncompressed:1,gzip:.3,snappy:.5,lz4:.4,zstd:.25}[t||"gzip"]||.3}calculateUnderReplicatedPartitions(t,e){let s=0;for(const n of t){const i=n.replication||1,o=n.partitions||1;if(n.partitionInfo&&Array.isArray(n.partitionInfo))for(const l of n.partitionInfo){const d=i;(l.isr?.length||l.replicas?.length||1)<d&&s++}else i>e&&(s+=o*Math.max(0,1-e/i)),Math.random()<.05&&i>1&&(s+=o*.1)}return Math.round(s)}assignPartitionsToConsumers(t,e){if(t===0||e===0)return[];const s=[],n=Math.floor(e/t),i=e%t;let o=0;for(let l=0;l<t;l++){const d=[],h=n+(l<i?1:0);for(let f=0;f<h;f++)o<e&&(d.push(o),o++);s.push({consumerId:l,partitions:d})}return s}consumerGroupMemberCounts=new Map;rebalancingGroups=new Map;isRebalancing(t,e){const s=`${t}:${e}`,n=this.rebalancingGroups.get(s);if(n&&Date.now()<n)return!0;const i=this.getCurrentGroupMembers(t,e),o=this.consumerGroupMemberCounts.get(s);return o!==void 0&&i!==o?(this.rebalancingGroups.set(s,Date.now()+2e3),this.consumerGroupMemberCounts.set(s,i),!0):((o===void 0||i!==o)&&this.consumerGroupMemberCounts.set(s,i),!1)}getCurrentGroupMembers(t,e){const s=this.nodes.find(l=>l.id===t);return s&&(s.data.config?.consumerGroups||[]).find(l=>l.id===e)?.members||0}getAverageISRCount(t,e){if(!t.partitionInfo||!Array.isArray(t.partitionInfo)||t.partitionInfo.length===0){const i=t.replication||1;return Math.min(i,e)*.95}let s=0,n=0;for(const i of t.partitionInfo){const o=i.isr?.length||i.replicas?.length||1;s+=o,n++}return n>0?s/n:1}checkACLPermission(t,e,s,n,i,o){if(!t||t.length===0)return!0;const l=e.includes(":")?e:`User:${e}`,d=t.filter(m=>{const y=m.principal||"";if(y!==l&&y!=="*"&&!l.includes(y)||m.resourceType!==s)return!1;const b=m.resourcePatternType||"Literal",C=m.resourceName||"";let S=!1;switch(b){case"Literal":S=C===n||C==="*";break;case"Prefixed":if(C==="*")S=!0;else if(C.endsWith("*")){const R=C.slice(0,-1);S=n.startsWith(R)}else S=n.startsWith(C);break;case"Match":if(C==="*")S=!0;else{const R=C.replace(/\./g,"\\.").replace(/\*/g,".*");S=new RegExp(`^${R}$`).test(n)}break;default:S=C===n||C==="*"}return!(!S||m.operation!==i&&m.operation!=="All"||m.host&&m.host!=="*"&&o&&m.host!==o)});return d.length===0||d.filter(m=>m.permission==="Deny").length>0?!1:d.filter(m=>m.permission==="Allow").length>0}simulateRabbitMQ(t,e,s,n){this.rabbitMQRoutingEngines.has(t.id)||this.initializeRabbitMQRoutingEngine(t);const i=this.rabbitMQRoutingEngines.get(t.id);if(t.data.config,!n){s.throughput=0,s.latency=2,s.errorRate=0;const E=i.getTotalQueueDepth();s.utilization=Math.min(1,E/1e5);const A=i.getAllQueueMetrics(),_=i.getActiveConnections();s.customMetrics={queue_depth:E,connections:_,replication:e.replicationFactor||1},this.updateQueueMetricsInConfig(t,A);return}const o=this.connections.filter(E=>E.target===t.id);let l=0;for(const E of o){const A=this.connectionMetrics.get(E.id);if(A){const N=A.traffic/1024;l+=N}}const d=e.throughputMsgs||l||1e3,h=e.replicationFactor||1,f=(Math.random()-.5)*.1;s.throughput=d*(1+f);const m=i.getTotalQueueDepth(),y=2,b=Math.min(50,m/1e3);s.latency=y+h*5+b+Math.random()*5;const C=5e-4,S=Math.min(.01,m/1e6);s.errorRate=C+S,s.utilization=Math.min(1,m/1e5);const R=i.getAllQueueMetrics(),M=i.getActiveConnections();let T=0;for(const E of R.values())T+=E.consumers;s.customMetrics={queue_depth:m,connections:M,replication:h,queues:R.size,consumers:T},this.updateQueueMetricsInConfig(t,R)}initializeRabbitMQRoutingEngine(t){const e=t.data.config||{},s=new CE;s.initialize({queues:e.queues||[],exchanges:e.exchanges||[{name:"amq.direct",type:"direct",durable:!0,autoDelete:!1,internal:!1},{name:"amq.topic",type:"topic",durable:!0,autoDelete:!1,internal:!1},{name:"amq.fanout",type:"fanout",durable:!0,autoDelete:!1,internal:!1}],bindings:e.bindings||[]}),this.rabbitMQRoutingEngines.set(t.id,s),this.lastRabbitMQUpdate.set(t.id,Date.now())}updateQueueMetricsInConfig(t,e){const s=t.data.config||{},n=s.queues||[];for(let i=0;i<n.length;i++){const o=n[i],l=e.get(o.name);l&&(n[i]={...o,messages:l.messages,ready:l.ready,unacked:l.unacked,consumers:l.consumers})}s.queues=n}simulateActiveMQ(t,e,s,n){this.activeMQRoutingEngines.has(t.id)||this.initializeActiveMQRoutingEngine(t);const i=this.activeMQRoutingEngines.get(t.id),o=t.data.config||{},l=o.protocol||"openwire",d=o.persistenceEnabled??!0,h=o.maxConnections||1e3,f=o.memoryLimit||1024,m=o.storeUsage||0,y=o.tempUsage||0,b=o.connections||[];if(!n){s.throughput=0,s.latency=this.getProtocolBaseLatency(l),s.errorRate=0;const U=i.getTotalQueueDepth(),ae=i.getTotalTopicMessages(),B=U+ae;s.utilization=Math.min(1,B/1e5);const G=i.getAllQueueMetrics(),pe=i.getAllTopicMetrics(),me=i.getActiveConnections();let ye=0;for(const Pe of G.values())ye+=Pe.consumerCount;let ve=0;for(const Pe of pe.values())ve+=Pe.subscriberCount;s.customMetrics={queue_depth:U,topic_messages:ae,connections:me,queues:G.size,topics:pe.size,consumers:ye,subscribers:ve,memory_usage:m+y,memory_percent:f>0?(m+y)/f*100:0},this.updateActiveMQMetricsInConfig(t,G,pe);return}const C=this.connections.filter(U=>U.target===t.id);let S=0;for(const U of C){const ae=this.connectionMetrics.get(U.id);if(ae){const G=ae.traffic/1024;S+=G}}const R=e.throughputMsgs||S||1e3,M=(Math.random()-.5)*.1;s.throughput=R*(1+M);const T=i.getTotalQueueDepth(),E=i.getTotalTopicMessages(),A=T+E,_=this.getProtocolBaseLatency(l),N=d?5:0,z=Math.min(50,A/1e3),q=f>0&&m+y>f*.8?10:0;s.latency=_+N+z+q+Math.random()*5;const Z=o.acls||[];let ne=0,ce=0;for(const U of C){const ae=this.nodes.find(me=>me.id===U.source);if(!ae)continue;const B=ae.data.config,G=B?.messaging||{},pe=B?.username||B?.clientId||o.username||`user-${U.source.slice(0,8)}`;if(G.queue&&!this.checkActiveMQACLPermission(Z,pe,`queue://${G.queue}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,ne+=.45)}if(G.topic&&!this.checkActiveMQACLPermission(Z,pe,`topic://${G.topic}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,ne+=.45)}}const J=o.queues||[];for(const U of J)U.consumerCount&&U.consumerCount>0&&(this.checkActiveMQACLPermission(Z,o.username||"admin",`queue://${U.name}`,"read")||(ne+=.1));const te=5e-4,le=Math.min(.01,A/1e6),ue=f>0&&m+y>f?.01:0,L=b.length>=h?.005:0;ce>0&&(s.throughput=Math.max(0,s.throughput-ce)),s.errorRate=Math.min(1,te+le+ue+L+ne);const j=Math.min(1,A/1e5),O=f>0?Math.min(1,(m+y)/f):0,W=Math.min(1,b.length/h);s.utilization=Math.max(j,O,W);const fe=i.getAllQueueMetrics(),P=i.getAllTopicMetrics(),F=i.getActiveConnections();let Y=0;for(const U of fe.values())Y+=U.consumerCount;let ie=0;for(const U of P.values())ie+=U.subscriberCount;s.customMetrics={queue_depth:T,topic_messages:E,connections:F,queues:fe.size,topics:P.size,consumers:Y,subscribers:ie,memory_usage:m+y,memory_percent:f>0?(m+y)/f*100:0,protocol:l},this.updateActiveMQMetricsInConfig(t,fe,P)}checkActiveMQACLPermission(t,e,s,n){if(!t||t.length===0)return!0;const i=t.filter(d=>{const h=d.principal||"";if(h!==e&&h!=="*"&&!e.includes(h))return!1;const f=d.resource||"";let m=!1;if(f==="*"||f===s)m=!0;else if(f.endsWith("*")){const C=f.slice(0,-1);m=s.startsWith(C)}else f.includes("://")?m=f===s:m=s.includes(f);if(!m)return!1;const y=(d.operation||"").toLowerCase(),b=n.toLowerCase();return!(y!==b&&y!=="all"&&y!=="*")});return i.length===0?!0:i.filter(d=>d.permission==="deny").length>0?!1:(i.filter(d=>d.permission==="allow").length>0,!0)}getProtocolBaseLatency(t){return{openwire:2,amqp:5,mqtt:8,stomp:10,ws:12}[t]||5}initializeActiveMQRoutingEngine(t){const e=t.data.config||{},s=new SE;s.initialize({queues:e.queues||[],topics:e.topics||[],subscriptions:e.subscriptions||[]}),this.activeMQRoutingEngines.set(t.id,s),this.lastActiveMQUpdate.set(t.id,Date.now())}updateActiveMQMetricsInConfig(t,e,s){const n=t.data.config||{},i=n,o=n.queues||[];for(let m=0;m<o.length;m++){const y=o[m],b=e.get(y.name);b&&(o[m]={...y,queueSize:b.queueSize,consumerCount:b.consumerCount,enqueueCount:b.enqueueCount,dequeueCount:b.dequeueCount})}n.queues=o;const l=n.topics||[];for(let m=0;m<l.length;m++){const y=l[m],b=s.get(y.name);b&&(l[m]={...y,subscriberCount:b.subscriberCount,enqueueCount:b.enqueueCount,dequeueCount:b.dequeueCount})}n.topics=l;const d=this.connections.filter(m=>m.target===t.id),h=[];for(const m of d){const y=this.nodes.find(M=>M.id===m.source);if(!y)continue;y.data.config?.messaging;const C=i.protocol||"openwire",S=this.connectionMetrics.get(m.id),R=S?Math.floor(S.traffic/1024):0;h.push({id:m.id,remoteAddress:`${y.data.label||y.id}`,clientId:`client-${m.source.slice(0,8)}`,userName:i.username||"admin",connectedSince:new Date().toISOString(),messageCount:R,protocol:C==="openwire"?"OpenWire":C==="amqp"?"AMQP":C==="mqtt"?"MQTT":C==="stomp"?"STOMP":C==="ws"?"WebSocket":"OpenWire"})}n.connections=h;const f=[];for(const m of l)for(const y of d){const b=this.nodes.find(R=>R.id===y.source);if(!b)continue;const S=b.data.config?.messaging||{};if(S.topic===m.name||!S.queue){const R=s.get(m.name);f.push({id:`sub-${y.id}-${m.name}`,destination:m.name,clientId:`client-${y.source.slice(0,8)}`,pendingQueueSize:0,dispatchedQueueSize:0,dispatchedCounter:R?.enqueueCount||0,enqueueCounter:R?.enqueueCount||0,dequeueCounter:R?.dequeueCount||0})}}n.subscriptions=f}simulateAzureServiceBus(t,e,s,n){this.azureServiceBusRoutingEngines.has(t.id)||this.initializeAzureServiceBusRoutingEngine(t);const i=this.azureServiceBusRoutingEngines.get(t.id),o=t.data.config||{};if(!n){s.throughput=0,s.latency=5,s.errorRate=0;const ne=i.getTotalQueueDepth(),ce=i.getTotalSubscriptionMessages(),J=ne+ce;s.utilization=Math.min(1,J/1e5);const te=i.getAllQueueMetrics(),le=i.getAllSubscriptionMetrics(),ue=i.getActiveConnections();s.customMetrics={queue_depth:ne,subscription_messages:ce,connections:ue,queues:o.queues?.length||0,topics:o.topics?.length||0},this.updateAzureServiceBusMetricsInConfig(t,te,le);return}const l=this.connections.filter(ne=>ne.target===t.id);let d=0;for(const ne of l){const ce=this.connectionMetrics.get(ne.id);if(ce){const te=ce.traffic/1024;d+=te}}const h=e.throughputMsgs||d||1e3,f=(Math.random()-.5)*.1;s.throughput=h*(1+f);const m=i.getTotalQueueDepth(),y=i.getTotalSubscriptionMessages(),b=m+y,C=5,S=Math.min(50,b/1e3),R=2;s.latency=C+S+R+Math.random()*5;const M=i.getAllQueueMetrics(),T=i.getAllSubscriptionMetrics(),E=i.getActiveConnections(),A=5e-4,_=Math.min(.01,b/1e6);let N=0;for(const ne of M.values())N+=ne.deadLetterMessageCount||0;for(const ne of T.values())N+=ne.deadLetterMessageCount||0;const z=N>0?Math.min(.05,N/1e4):0;s.errorRate=Math.min(1,A+_+z),s.utilization=Math.min(1,b/1e5);let q=0;const Z=o.topics||[];for(const ne of Z)q+=(ne.subscriptions||[]).length;s.customMetrics={queue_depth:m,subscription_messages:y,dead_letter_messages:N,connections:E,queues:o.queues?.length||0,topics:o.topics?.length||0,subscriptions:q},this.updateAzureServiceBusMetricsInConfig(t,M,T)}initializeAzureServiceBusRoutingEngine(t){const e=t.data.config||{},s=new RE,n=(e.queues||[]).map(o=>({name:o.name,namespace:o.namespace||e.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:o.maxSizeInMegabytes||1024,defaultMessageTimeToLive:o.defaultMessageTimeToLive||2592e3,lockDuration:o.lockDuration||30,maxDeliveryCount:o.maxDeliveryCount||10,enablePartitioning:o.enablePartitioning||!1,enableDeadLetteringOnMessageExpiration:o.enableDeadLetteringOnMessageExpiration!==void 0?o.enableDeadLetteringOnMessageExpiration:!0,enableSessions:o.enableSessions||!1,activeMessageCount:o.activeMessageCount||0,deadLetterMessageCount:o.deadLetterMessageCount||0,scheduledMessageCount:o.scheduledMessageCount||0})),i=(e.topics||[]).map(o=>({name:o.name,namespace:o.namespace||e.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:o.maxSizeInMegabytes||1024,defaultMessageTimeToLive:o.defaultMessageTimeToLive||2592e3,enablePartitioning:o.enablePartitioning||!1,subscriptions:(o.subscriptions||[]).map(l=>({name:l.name,maxDeliveryCount:l.maxDeliveryCount||10,lockDuration:l.lockDuration||30,enableDeadLetteringOnMessageExpiration:l.enableDeadLetteringOnMessageExpiration!==void 0?l.enableDeadLetteringOnMessageExpiration:!0,activeMessageCount:l.activeMessageCount||0}))}));s.initialize({queues:n,topics:i}),this.azureServiceBusRoutingEngines.set(t.id,s),this.lastAzureServiceBusUpdate.set(t.id,Date.now())}updateAzureServiceBusMetricsInConfig(t,e,s){const n=t.data.config||{},i=n.queues||[];for(let l=0;l<i.length;l++){const d=i[l],h=e.get(d.name);h&&(i[l]={...d,activeMessageCount:h.activeMessageCount,deadLetterMessageCount:h.deadLetterMessageCount,scheduledMessageCount:h.scheduledMessageCount})}n.queues=i;const o=n.topics||[];for(let l=0;l<o.length;l++){const d=o[l],h=d.subscriptions||[];for(let f=0;f<h.length;f++){const m=h[f],y=`${d.name}/subscriptions/${m.name}`,b=s.get(y);b&&(h[f]={...m,activeMessageCount:b.activeMessageCount})}o[l]={...d,subscriptions:h}}n.topics=o}simulatePubSub(t,e,s,n){this.pubSubRoutingEngines.has(t.id)||this.initializePubSubRoutingEngine(t);const i=this.pubSubRoutingEngines.get(t.id),o=t.data.config||{},l=o.topics||[],d=o.subscriptions||[];if(!n){s.throughput=0,s.latency=3,s.errorRate=0;const L=i.getTotalTopicMessages(),j=i.getTotalUnackedMessages(),O=L+j;s.utilization=Math.min(1,O/1e5);const W=i.getAllTopicMetrics(),fe=i.getAllSubscriptionMetrics(),P=i.getActiveConnections();s.customMetrics={topic_messages:L,unacked_messages:j,connections:P,topics:l.length,subscriptions:d.length},this.updatePubSubMetricsInConfig(t,W,fe);return}const h=this.connections.filter(L=>L.target===t.id);let f=0;for(const L of h){const j=this.connectionMetrics.get(L.id);if(j){const W=j.traffic/1024;f+=W}}const m=e.throughputMsgs||f||1e3,y=(Math.random()-.5)*.1;s.throughput=m*(1+y);const b=i.getTotalTopicMessages(),C=i.getTotalUnackedMessages(),S=b+C,R=3,M=Math.min(15,S/1e4),T=d.filter(L=>L.pushEndpoint).length,E=T>0?2:0,A=C>0?.5:0;s.latency=R+M+E+A+Math.random()*2;const _=i.getAllTopicMetrics(),N=i.getAllSubscriptionMetrics(),z=i.getActiveConnections(),q=1e-4,Z=Math.min(.001,S/5e6),ne=T>0&&C>0?Math.min(.002,C/1e5):0,ce=d.length>0?d.reduce((L,j)=>L+(j.ackDeadlineSeconds||10),0)/d.length:10,J=C>0&&ce<60?Math.min(.005,C/1e5):0;s.errorRate=Math.min(1,q+Z+ne+J);const te=Math.min(1,s.throughput/1e5),le=Math.min(.3,S/5e5);s.utilization=Math.min(1,te*.7+le*.3);const ue=d.length-T;s.customMetrics={topic_messages:b,unacked_messages:C,connections:z,topics:l.length,subscriptions:d.length,push_subscriptions:T,pull_subscriptions:ue,total_bytes:Array.from(_.values()).reduce((L,j)=>L+j.byteCount,0)},this.updatePubSubMetricsInConfig(t,_,N)}initializePubSubRoutingEngine(t){const e=t.data.config||{},s=new kE,n=(e.topics||[]).map(o=>({name:o.name,projectId:o.projectId||e.projectId||"archiphoenix-lab",messageRetentionDuration:o.messageRetentionDuration||604800,labels:o.labels||{},messageCount:o.messageCount||0,byteCount:o.byteCount||0})),i=(e.subscriptions||[]).map(o=>({name:o.name,topic:o.topic,projectId:o.projectId||e.projectId||"archiphoenix-lab",ackDeadlineSeconds:o.ackDeadlineSeconds||10,messageRetentionDuration:o.messageRetentionDuration,enableMessageOrdering:o.enableMessageOrdering||!1,pushEndpoint:o.pushEndpoint,pushAttributes:o.pushAttributes||{},messageCount:o.messageCount||0,unackedMessageCount:o.unackedMessageCount||0}));s.initialize({topics:n,subscriptions:i}),this.pubSubRoutingEngines.set(t.id,s),this.lastPubSubUpdate.set(t.id,Date.now())}updatePubSubMetricsInConfig(t,e,s){const n=t.data.config||{},i=n.topics||[];for(let l=0;l<i.length;l++){const d=i[l],h=e.get(d.name);h&&(i[l]={...d,messageCount:h.messageCount,byteCount:h.byteCount})}n.topics=i;const o=n.subscriptions||[];for(let l=0;l<o.length;l++){const d=o[l],h=s.get(d.name);h&&(o[l]={...d,messageCount:h.messageCount,unackedMessageCount:h.unackedMessageCount})}n.subscriptions=o}simulateSQS(t,e,s,n){this.sqsRoutingEngines.has(t.id)||this.initializeSQSRoutingEngine(t);const i=this.sqsRoutingEngines.get(t.id);if(t.data.config,!n){s.throughput=0,s.latency=5,s.errorRate=0;const M=i.getTotalQueueDepth();s.utilization=Math.min(1,M/1e5);const T=i.getAllQueueMetrics(),E=i.getActiveConnections();s.customMetrics={queue_depth:M,connections:E,queues:T.size},this.updateSQSQueueMetricsInConfig(t,T);return}const o=this.connections.filter(M=>M.target===t.id);let l=0;for(const M of o){const T=this.connectionMetrics.get(M.id);if(T){const A=T.traffic/1024;l+=A}}const d=e.throughputMsgs||l||1e3,h=(Math.random()-.5)*.1;s.throughput=d*(1+h);const f=i.getTotalQueueDepth(),m=5,y=Math.min(50,f/1e3);s.latency=m+y+Math.random()*5;const b=5e-4,C=Math.min(.01,f/1e6);s.errorRate=b+C,s.utilization=Math.min(1,f/1e5);const S=i.getAllQueueMetrics(),R=i.getActiveConnections();s.customMetrics={queue_depth:f,connections:R,queues:S.size},this.updateSQSQueueMetricsInConfig(t,S)}initializeSQSRoutingEngine(t){const e=t.data.config||{},s=new ME,n=(e.queues||[]).map(i=>({name:i.name,type:i.type||"standard",region:i.region||e.defaultRegion||"us-east-1",visibilityTimeout:i.visibilityTimeout||30,messageRetention:i.messageRetention||4,delaySeconds:i.delaySeconds||0,maxReceiveCount:i.maxReceiveCount,deadLetterQueue:i.deadLetterQueue,contentBasedDedup:i.contentBasedDedup,fifoThroughputLimit:i.fifoThroughputLimit||"perQueue"}));s.initialize({queues:n}),this.sqsRoutingEngines.set(t.id,s),this.lastSQSUpdate.set(t.id,Date.now())}updateSQSQueueMetricsInConfig(t,e){const s=t.data.config||{},n=s.queues||[];for(let i=0;i<n.length;i++){const o=n[i],l=e.get(o.name);l&&(n[i]={...o,approximateMessages:l.approximateMessages,approximateMessagesNotVisible:l.approximateMessagesNotVisible,approximateMessagesDelayed:l.approximateMessagesDelayed})}s.queues=n}simulateDatabase(t,e,s,n){if(!n){if(s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,s.customMetrics={},t.type==="postgres"){const y=this.postgresConnectionPools.get(t.id);y&&y.reset()}return}const i=e.maxConnections||100,o=e.queryLatency||10;if(t.type==="postgres"){const y=this.postgresConnectionPools.get(t.id);if(y){const C=this.connections.filter(N=>N.target===t.id).reduce((N,z)=>{const q=this.metrics.get(z.source);return N+(q?.throughput||0)},0),R=Math.min(C,i*10)*this.updateInterval/1e3;for(let N=0;N<Math.floor(R);N++){const z=y.acquireConnection("SELECT");if(z){const q=o+Math.random()*20;setTimeout(()=>{y.releaseConnection(z,q)},q)}}const M=y.getMetrics();s.throughput=M.queriesPerSecond,s.latency=M.averageQueryTime||o,s.utilization=M.utilization,s.errorRate=M.waitingConnections>0?.01:.001;const E=t.data.config.tables||[];let A=0;for(const N of E)A+=(N.indexes||[]).length;A===0&&(A=5);const _=this.calculateCacheHitRatio(t,M.queriesPerSecond);s.customMetrics={active_connections:M.activeConnections,idle_connections:M.idleConnections,waiting_connections:M.waitingConnections,total_connections:M.totalConnections,max_connections:i,indexes:A,cache_hit_ratio:_,connection_wait_time:M.connectionWaitTime};return}}if(t.type==="redis"){this.redisRoutingEngines.has(t.id)||this.initializeRedisRoutingEngine(t);const y=this.redisRoutingEngines.get(t.id),b=t.data.config;b?.keys&&y.syncKeysFromConfig(b.keys);const C=y.getMetrics(),R=this.connections.filter(A=>A.target===t.id).reduce((A,_)=>{const N=this.metrics.get(_.source);return A+(N?.throughput||0)},0);s.throughput=Math.max(C.operationsPerSecond,R);const M=.5,T=C.memoryUsagePercent/100,E=Math.min(1,C.totalKeys/1e5);s.latency=M+T*2+E*1,s.errorRate=T>.95?.01:.001,s.utilization=C.memoryUsagePercent/100,s.customMetrics={total_keys:C.totalKeys,keys_string:C.keysByType.string,keys_hash:C.keysByType.hash,keys_list:C.keysByType.list,keys_set:C.keysByType.set,keys_zset:C.keysByType.zset,keys_stream:C.keysByType.stream,memory_usage:C.memoryUsage,memory_usage_percent:C.memoryUsagePercent,operations_per_second:C.operationsPerSecond,hit_count:C.hitCount,miss_count:C.missCount,hit_rate:C.hitRate,expired_keys:C.expiredKeys,evicted_keys:C.evictedKeys,connected_clients:C.connectedClients};return}if(t.type==="cassandra"){this.cassandraRoutingEngines.has(t.id)||this.initializeCassandraRoutingEngine(t);const y=this.cassandraRoutingEngines.get(t.id),b=t.data.config;b&&y.syncFromConfig({clusterName:b.clusterName,nodes:b.nodes,keyspaces:b.keyspaces,tables:b.tables,defaultConsistencyLevel:b.consistencyLevel,defaultReplicationFactor:b.replicationFactor});const C=y.getMetrics(),R=this.connections.filter(_=>_.target===t.id).reduce((_,N)=>{const z=this.metrics.get(N.source);return _+(z?.throughput||0)},0);s.throughput=Math.max(C.readOperationsPerSecond+C.writeOperationsPerSecond,R);const M=C.readOperationsPerSecond+C.writeOperationsPerSecond;if(M>0){const _=C.readOperationsPerSecond/M,N=C.writeOperationsPerSecond/M;s.latency=C.readLatency*_+C.writeLatency*N}else s.latency=(C.readLatency+C.writeLatency)/2;const T=C.readConsistencyViolations+C.writeConsistencyViolations;s.errorRate=Math.min(.1,T/Math.max(1,M))||.001;const E=C.totalNodes>0?(C.totalNodes-C.healthyNodes)/C.totalNodes:0,A=Math.min(1,C.pendingCompactions/100);s.utilization=Math.min(1,E*.7+A*.3),s.customMetrics={total_nodes:C.totalNodes,healthy_nodes:C.healthyNodes,total_keyspaces:C.totalKeyspaces,total_tables:C.totalTables,total_rows:C.totalRows,total_size_gb:C.totalSize/(1024*1024*1024),read_latency_ms:C.readLatency,write_latency_ms:C.writeLatency,read_ops_per_sec:C.readOperationsPerSecond,write_ops_per_sec:C.writeOperationsPerSecond,pending_compactions:C.pendingCompactions,read_consistency_violations:C.readConsistencyViolations,write_consistency_violations:C.writeConsistencyViolations,hinted_handoffs:C.hintedHandoffs};return}if(t.type==="clickhouse"){this.clickHouseRoutingEngines.has(t.id)||this.initializeClickHouseRoutingEngine(t);const y=this.clickHouseRoutingEngines.get(t.id),b=t.data.config;b&&y.syncFromConfig({cluster:b.cluster,replication:b.replication,tables:b.tables?.map(A=>({name:A.name,database:b.database||"default",engine:A.engine||"MergeTree",rows:A.rows||0,size:A.size||0,partitions:A.partitions||0,columns:A.columns||[]})),maxMemoryUsage:b.maxMemoryUsage,compression:b.compression});const C=y.getMetrics(),R=this.connections.filter(A=>A.target===t.id).reduce((A,_)=>{const N=this.metrics.get(_.source);return A+(N?.throughput||0)},0);s.throughput=Math.max(C.queriesPerSecond,R),s.latency=C.avgQueryTime;const M=C.memoryUsagePercent/100;s.errorRate=M>.95?.01:.001;const T=Math.min(1,C.activeQueries/10),E=M;s.utilization=Math.max(T,E),s.customMetrics={total_tables:C.totalTables,total_rows:C.totalRows,total_size_gb:C.totalSize/(1024*1024*1024),queries_per_sec:C.queriesPerSecond,read_rows_per_sec:C.readRowsPerSecond,written_rows_per_sec:C.writtenRowsPerSecond,avg_query_time_ms:C.avgQueryTime,active_queries:C.activeQueries,memory_usage_bytes:C.memoryUsage,memory_usage_percent:C.memoryUsagePercent,parts_count:C.partsCount,pending_merges:C.pendingMerges,compression_ratio:C.compressionRatio,cluster_nodes:C.clusterNodes,healthy_nodes:C.healthyNodes};return}if(t.type==="snowflake"){this.snowflakeRoutingEngines.has(t.id)||this.initializeSnowflakeRoutingEngine(t);const y=this.snowflakeRoutingEngines.get(t.id),b=t.data.config;b&&y.syncFromConfig({account:b.account,region:b.region,warehouses:b.warehouses,databases:b.databases,role:b.role,enableAutoSuspend:b.enableAutoSuspend,autoSuspendSeconds:b.autoSuspendSeconds,enableAutoResume:b.enableAutoResume});const C=y.getMetrics(),R=this.connections.filter(M=>M.target===t.id).reduce((M,T)=>{const E=this.metrics.get(T.source);return M+(E?.throughput||0)},0);s.throughput=Math.max(C.queriesPerSecond,R),s.latency=C.avgQueryTime,s.errorRate=.001,s.utilization=C.warehouseUtilization,s.customMetrics={total_warehouses:C.totalWarehouses,running_warehouses:C.runningWarehouses,suspended_warehouses:C.suspendedWarehouses,total_queries:C.totalQueries,running_queries:C.runningQueries,queued_queries:C.queuedQueries,queries_per_sec:C.queriesPerSecond,avg_query_time_ms:C.avgQueryTime,total_compute_time_sec:C.totalComputeTime,total_data_read:C.totalDataRead,total_data_written:C.totalDataWritten,cache_hit_rate:C.cacheHitRate,warehouse_utilization:C.warehouseUtilization,total_cost_credits:C.totalCost};return}if(t.type==="elasticsearch"){this.elasticsearchRoutingEngines.has(t.id)||this.initializeElasticsearchRoutingEngine(t);const y=this.elasticsearchRoutingEngines.get(t.id),b=t.data.config;b&&y.syncFromConfig({clusterName:b.clusterName,nodes:b.nodes,indices:b.indices,defaultShards:b.shards,defaultReplicas:b.replicas,refreshInterval:b.refreshInterval});const C=y.getMetrics(),R=this.connections.filter(_=>_.target===t.id).reduce((_,N)=>{const z=this.metrics.get(N.source);return _+(z?.throughput||0)},0);s.throughput=Math.max(C.indexOperationsPerSecond+C.searchOperationsPerSecond,R);const M=C.indexOperationsPerSecond+C.searchOperationsPerSecond;if(M>0){const _=C.indexOperationsPerSecond/M,N=C.searchOperationsPerSecond/M;s.latency=C.averageIndexLatency*_+C.averageSearchLatency*N}else s.latency=C.averageSearchLatency||10;const T=C.clusterHealth==="red"?.01:C.clusterHealth==="yellow"?.002:.001;s.errorRate=T;const E=C.unassignedShards>0?1:C.relocatingShards>0?.7:C.initializingShards>0?.5:.3,A=C.healthyNodes/C.totalNodes;s.utilization=Math.max(E,1-A),this.updateElasticsearchMetricsInConfig(t,C),s.customMetrics={cluster_health:C.clusterHealth==="green"?1:C.clusterHealth==="yellow"?.5:0,total_nodes:C.totalNodes,healthy_nodes:C.healthyNodes,total_indices:C.totalIndices,total_docs:C.totalDocs,total_size_gb:C.totalSize/(1024*1024*1024),active_shards:C.activeShards,relocating_shards:C.relocatingShards,initializing_shards:C.initializingShards,unassigned_shards:C.unassignedShards,index_ops_per_sec:C.indexOperationsPerSecond,search_ops_per_sec:C.searchOperationsPerSecond,avg_index_latency_ms:C.averageIndexLatency,avg_search_latency_ms:C.averageSearchLatency,avg_get_latency_ms:C.averageGetLatency};return}if(t.type==="s3-datalake"){this.s3RoutingEngines.has(t.id)||this.initializeS3RoutingEngine(t);const y=this.s3RoutingEngines.get(t.id);if(y.processLifecycleTransitions(),!n){s.throughput=0,s.latency=50,s.errorRate=0;const J=y.getAllBucketMetrics(),te=y.getTotalStorageSize(),le=y.getTotalObjectCount(),ue=1024*1024*1024*1024,L=J.size,j=ue*L;s.utilization=j>0?Math.min(1,te/j):0,s.customMetrics={buckets:L,total_objects:le,total_size:te,total_size_mb:Math.round(te/(1024*1024)*100)/100},this.updateS3BucketMetricsInConfig(t,J);return}const b=this.connections.filter(J=>J.target===t.id);let C=0,S=0;for(const J of b){const te=this.connectionMetrics.get(J.id);te&&(C+=te.traffic/1024,S+=te.traffic)}const R=1024*1024,M=S>0?S/R:0;s.throughput=Math.max(0,M),s.latency=50+(M>100?(M-100)*.1:0),s.errorRate=.001;const T=y.getAllBucketMetrics(),E=y.getTotalStorageSize(),A=y.getTotalObjectCount(),_=T.size,z=1024*1024*1024*1024*_,q=z>0?Math.min(1,E/z):0,ne=3500*_,ce=ne>0?Math.min(1,M/ne):0;s.utilization=Math.max(q,ce),s.customMetrics={buckets:_,total_objects:A,total_size:E,total_size_mb:Math.round(E/(1024*1024)*100)/100,total_size_gb:Math.round(E/(1024*1024*1024)*100)/100,estimated_ops_per_sec:Math.round(M*100)/100,storage_utilization:Math.round(q*1e3)/10,ops_utilization:Math.round(ce*1e3)/10},this.updateS3BucketMetricsInConfig(t,T);return}let l=e.indexCount||5;t.type==="mongodb"&&(l=(t.data.config?.collections||[]).reduce((C,S)=>C+(S.indexes?.length||0),0),l===0&&(l=1));const h=this.connections.filter(y=>y.target===t.id).reduce((y,b)=>{const C=this.metrics.get(b.source);return y+(C?.throughput||0)},0),f=Math.min(i,Math.floor(h/10)||Math.floor(i*.3));s.throughput=f*(1e3/(o+Math.random()*20));const m=Math.min(.3,l*.02);if(s.latency=o+f/i*50*(1-m),s.errorRate=.001,s.utilization=f/i,s.customMetrics={active_connections:f,max_connections:i,indexes:l,cache_hit_ratio:Math.random()*.8+.2},t.type==="mongodb"){const y=t.data.config,b=y?.collections||[],C=b.filter(E=>E.validation&&E.validation.validationLevel!=="off").length;if(C>0){const E=Math.min(.05,C*.01);s.errorRate=Math.max(s.errorRate,E)}const S=y?.enableReplicaSet||!1,R=y?.replicaSetMembers||[];if(S&&R.length>1){const E=R.length,A=Math.min(.3,(E-1)*.1);s.errorRate=Math.max(0,s.errorRate*(1-A)),s.latency=s.latency*(1+.05*(E-1))}const M=y?.enableSharding||!1,T=y?.shardConfig;if(M&&T?.shards){const E=T.shards.length,A=1+(E-1)*.3;s.throughput=s.throughput*A,s.latency=s.latency*(1+.02*(E-1))}s.customMetrics={...s.customMetrics,collections:b.length,collections_with_validation:C,total_documents:b.reduce((E,A)=>E+(A.documentCount||0),0),replica_set_enabled:S,replica_members:S?R.length:0,sharding_enabled:M,shard_count:M&&T?.shards?.length||0}}}simulateNginx(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.nginxRoutingEngines.get(t.id);if(!i){const M=e.workerThreads||e.maxWorkers||4,T=e.requestsPerSecond||1e4,E=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=T*E,s.latency=1+(1-E)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/T*(M/4)),s.customMetrics={worker_threads:M,active_connections:Math.floor(s.throughput*.1)};return}const o=e||{},l=o.maxWorkers||4,d=o.requestsPerSecond||1e4;o.enableCache;const h=o.enableGzip??!0,f=i.getStats(),m=.5*Math.sin(this.simulationTime/2e3)+.5;let y=d*m;if(f.rateLimitBlocks>0){const M=Math.min(.1,f.rateLimitBlocks/Math.max(1,f.requests));y=y*(1-M)}s.throughput=y;const b=1+(1-m)*4,C=10+Math.random()*90;s.latency=b+C*.3;const S=f.rateLimitBlocks>0?Math.min(.05,f.rateLimitBlocks/Math.max(1,f.requests)):0;s.errorRate=1e-5+S;const R=Math.min(1,s.throughput/d*(l/4));s.utilization=R,s.customMetrics={worker_threads:l,active_connections:Math.floor(s.throughput*.1),cache_hits:f.cacheHits,cache_misses:f.cacheMisses,cache_hit_rate:Math.round(f.cacheHitRate*100)/100,rate_limit_blocks:f.rateLimitBlocks,locations:f.locations,upstreams:f.upstreams,ssl_enabled:o.enableSSL?1:0,gzip_enabled:h?1:0}}simulateHAProxy(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.haproxyRoutingEngines.get(t.id);if(!i){const R=e.maxConnections||4096,M=e.requestsPerSecond||1e4,T=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=M*T,s.latency=1+(1-T)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/M*(R/4096)),s.customMetrics={max_connections:R,active_connections:Math.floor(s.throughput*.1)};return}const o=e||{},l=o.maxConnections||4096,d=o.requestsPerSecond||1e4,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=d*f;const y=h.totalServers>0?h.upServers/h.totalServers:1;m=m*y,s.throughput=m;const b=1+(1-f)*4,C=10+Math.random()*90;s.latency=b+C*.3,s.errorRate=h.errorRate||1e-5;const S=Math.min(1,h.activeConnections/l);s.utilization=S,s.customMetrics={max_connections:l,active_connections:h.activeConnections,frontends:h.frontends,backends:h.backends,total_servers:h.totalServers,up_servers:h.upServers,down_servers:h.downServers,total_requests:h.totalRequests,total_responses:h.totalResponses,total_bytes_in:h.totalBytesIn,total_bytes_out:h.totalBytesOut}}simulateEnvoy(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.envoyRoutingEngines.get(t.id);if(!i){const R=e.maxConnections||1024,M=e.requestsPerSecond||1e4,T=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=M*T,s.latency=1+(1-T)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/M*(R/1024)),s.customMetrics={max_connections:R,active_connections:Math.floor(s.throughput*.1)};return}const o=e||{},l=o.maxConnections||1024,d=o.requestsPerSecond||1e4,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=d*f;const y=h.totalEndpoints>0?h.healthyEndpoints/h.totalEndpoints:1;m=m*y,s.throughput=m;const b=1+(1-f)*4,C=10+Math.random()*90;s.latency=b+C*.2,s.errorRate=h.errorRate||1e-5;const S=Math.min(1,h.activeConnections/l);s.utilization=S,s.customMetrics={max_connections:l,active_connections:h.activeConnections,clusters:h.clusters,listeners:h.listeners,routes:h.routes,total_endpoints:h.totalEndpoints,healthy_endpoints:h.healthyEndpoints,unhealthy_endpoints:h.unhealthyEndpoints,total_requests:h.totalRequests,total_responses:h.totalResponses,total_bytes_in:h.totalBytesIn,total_bytes_out:h.totalBytesOut,rate_limit_blocks:h.rateLimitBlocks||0,timeout_errors:h.timeoutErrors||0,circuit_breaker_trips:h.circuitBreakerTrips||0}}simulateInfrastructure(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=e.workerThreads||1;s.throughput=100*i+Math.random()*50,s.latency=50+Math.random()*100,s.errorRate=1e-4,s.utilization=Math.random()*.8,s.customMetrics={replicas:i,cpu_percent:Math.random()*80,memory_percent:Math.random()*70}}simulateAPI(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=e.requestsPerSecond||100,o=e.responseLatency||50,l=Math.sin(this.simulationTime/1500)*.1+1;s.throughput=i*l,s.latency=o+Math.random()*30,s.errorRate=.005,s.utilization=s.throughput/i*Math.random(),s.customMetrics={rps:i,p50_latency:Math.round(o*.5),p99_latency:Math.round(o*2),errors:Math.round(s.throughput*s.errorRate)}}simulateKong(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.kongRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=e||{},l=o.requestsPerSecond||e.requestsPerSecond||450,d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let f=l*h;const m=(o.plugins||[]).filter(M=>M.name==="rate-limiting"&&M.enabled);if(m.length>0){const M=Math.min(...m.map(T=>T.config?.minute||1e3));f=Math.min(f,M*h)}s.throughput=f;const y=2+Math.random()*3,b=d.plugins*.5,C=10+Math.random()*40;s.latency=y+b+C;const S=.001,R=d.consumers>0?.02:0;s.errorRate=Math.min(1,S+R),s.utilization=Math.min(1,s.throughput/l),s.customMetrics={services:d.services,routes:d.routes,upstreams:d.upstreams,consumers:d.consumers,plugins:d.plugins,requests_per_second:l,gateway_latency:y+b,upstream_latency:C}}simulateApigee(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.apigeeRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=e||{},l=o.proxies||[],d=o.requestsPerSecond||e.requestsPerSecond||500,h=i.getStats(),f=.5*Math.sin(this.simulationTime/2e3)+.5;let m=d*f;const y=l.filter(E=>E.status!=="undeployed");if(y.length>0){const E=y.filter(_=>_.quota&&_.quotaInterval).map(_=>_.quota/_.quotaInterval*f);if(E.length>0){const _=Math.min(...E);m=Math.min(m,_)}const A=y.filter(_=>_.spikeArrest&&_.spikeArrest>0).map(_=>_.spikeArrest);if(A.length>0){const _=Math.min(...A);m=Math.min(m,_*f)}}s.throughput=m;const b=3+Math.random()*2,C=h.policies*.8,S=15+Math.random()*35;s.latency=b+C+S;const R=.001,M=h.policies>0?.015:0,T=h.totalErrors>0?h.totalErrors/Math.max(h.totalRequests,1)*.1:0;s.errorRate=Math.min(1,R+M+T),s.utilization=Math.min(1,s.throughput/d),s.customMetrics={proxies:h.proxies,policies:h.policies,total_requests:h.totalRequests,total_errors:h.totalErrors,avg_latency:Math.round(h.avgLatency),requests_per_second:d,gateway_latency:b+C,upstream_latency:S}}simulateMuleSoft(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.mulesoftRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const l=(e||{}).applications||[],d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let f=0,m=0;for(const _ of l)if(_.status==="running"){const N=_.workerCount||2;m+=N,f+=N*75}f===0&&(f=100);let y=f*h;s.throughput=y;const b=5+Math.random()*10,C=d.enabledConnectors*2,S=3+Math.random()*5,R=15+Math.random()*25;s.latency=b+C+S+R;const M=.002,T=d.totalErrors>0?d.totalErrors/Math.max(d.totalRequests,1)*.15:0,E=d.runningApplications>0?.005:.01;s.errorRate=Math.min(1,M+T+E);const A=m>0?Math.min(1,s.throughput/(m*75)):.5;s.utilization=Math.min(1,A),s.customMetrics={applications:d.applications,running_applications:d.runningApplications,connectors:d.connectors,enabled_connectors:d.enabledConnectors,total_requests:d.totalRequests,total_errors:d.totalErrors,avg_latency:Math.round(d.avgLatency),total_workers:m,runtime_latency:b,connector_latency:R,transformation_latency:S}}simulateGrafana(t,e,s,n){const i=this.grafanaEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.getGrafanaMetrics(),l=i.calculateLoad();s.throughput=l.queriesPerSecond+l.alertEvaluationsPerSecond,s.latency=l.averageQueryLatency+l.averageRenderingLatency,s.errorRate=l.errorRate,s.utilization=(l.cpuUtilization+l.memoryUtilization)/2,s.customMetrics={queries_per_second:l.queriesPerSecond,dashboard_refreshes_per_second:l.dashboardRefreshesPerSecond,alert_evaluations_per_second:l.alertEvaluationsPerSecond,average_query_latency:l.averageQueryLatency,average_rendering_latency:l.averageRenderingLatency,datasource_errors:o.datasourceErrors,active_dashboards:o.activeDashboards,active_panels:o.activePanels,total_queries:o.totalQueries,cpu_utilization:l.cpuUtilization,memory_utilization:l.memoryUtilization}}simulateKeycloak(t,e,s,n){const i=this.keycloakEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics(),d=i.getConfig();s.throughput=o.requestsPerSecond,s.latency=o.averageLatency,s.errorRate=o.errorRate;const h=Math.min(.6,(o.activeSessions||0)/500),f=Math.min(.3,o.requestsPerSecond/200),m=d?.passwordPolicy?this.estimateKeycloakPolicyComplexity(d.passwordPolicy):0,y=Math.min(.2,m/100);s.utilization=Math.min(.95,.1+h+f+y),s.customMetrics={...s.customMetrics||{},keycloak_login_requests_total:l.loginRequestsTotal,keycloak_login_errors_total:l.loginErrorsTotal,keycloak_token_refresh_total:l.tokenRefreshTotal,keycloak_introspection_requests_total:l.introspectionRequestsTotal,keycloak_userinfo_requests_total:l.userInfoRequestsTotal,keycloak_sessions_active:l.activeSessions,keycloak_sessions_created_total:l.sessionsCreatedTotal,keycloak_sessions_expired_total:l.sessionsExpiredTotal,keycloak_auth_success_rate:o.authSuccessRate,keycloak_clients_configured:d?.clients.length??0,keycloak_users_configured:d?.users.length??0}}simulateVault(t,e,s,n){const i=this.vaultEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();i.getConfig(),s.throughput=o.requestsPerSecond,s.latency=o.averageLatency,s.errorRate=o.errorRate;const d=Math.min(.4,(o.secretsCount||0)/1e3),h=Math.min(.3,(o.activeTokens||0)/500),f=Math.min(.2,o.requestsPerSecond/300),m=Math.min(.1,(o.enginesEnabled||0)/10);s.utilization=Math.min(.95,.1+d+h+f+m),s.customMetrics={...s.customMetrics||{},vault_read_requests_total:l.readRequestsTotal,vault_write_requests_total:l.writeRequestsTotal,vault_delete_requests_total:l.deleteRequestsTotal,vault_list_requests_total:l.listRequestsTotal,vault_auth_requests_total:l.authRequestsTotal,vault_auth_errors_total:l.authErrorsTotal,vault_token_issued_total:l.tokenIssuedTotal,vault_token_renewed_total:l.tokenRenewedTotal,vault_token_revoked_total:l.tokenRevokedTotal,vault_tokens_active:l.activeTokens,vault_secrets_total:l.secretsTotal,vault_encryption_operations_total:l.encryptionOperationsTotal,vault_decryption_operations_total:l.decryptionOperationsTotal,vault_engines_enabled:o.enginesEnabled}}estimateKeycloakPolicyComplexity(t){if(!t)return 0;let e=0;const s=t.toLowerCase();s.includes("length(")&&(e+=20),s.includes("digits(")&&(e+=25),s.includes("special(")&&(e+=30),s.includes("uppercase(")&&(e+=15),s.includes("lowercase(")&&(e+=10);const n=(t.match(/\)/g)||[]).length;return e+=n*5,e}simulatePrometheus(t,e,s,n){const i=this.prometheusEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.getPrometheusMetrics(),l=i.calculateLoad();s.throughput=l.scrapeRequestsPerSecond,s.latency=l.averageScrapeDuration,s.errorRate=l.errorRate;const d=i.getTargetStatuses().length,h=Math.min(.95,.1+d/100*.5+l.scrapeRequestsPerSecond/10*.2);s.utilization=h,s.customMetrics={scrape_requests_total:o.scrapeRequestsTotal,scrape_errors_total:o.scrapeErrorsTotal,targets_up:o.targetsUp,targets_down:o.targetsDown,samples_scraped:o.samplesScraped,scrape_requests_per_second:l.scrapeRequestsPerSecond,samples_per_second:l.samplesPerSecond}}simulateWAF(t,e,s,n){const i=this.wafEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();i.getStats(),s.throughput=o.requestsPerSecond,s.latency=o.averageLatency;const d=i.getConfig();d?.mode==="prevention"?s.errorRate=o.blockRate:s.errorRate=0;const h=Math.min(.4,(l.activeRules||0)/50),f=Math.min(.3,o.requestsPerSecond/1e3),m=d?.enableOWASP?.15:0,y=d?.enableRateLimiting?.1:0,b=d?.enableGeoBlocking?.05:0;if(s.utilization=Math.min(.95,.1+h+f+m+y+b),s.customMetrics={...s.customMetrics||{},waf_requests_total:l.requestsTotal,waf_requests_allowed:l.requestsAllowed,waf_requests_blocked:l.requestsBlocked,waf_threats_detected:l.threatsDetected,waf_threats_blocked:l.threatsBlocked,waf_rate_limit_hits:l.rateLimitHits,waf_geo_block_hits:l.geoBlockHits,waf_ip_block_hits:l.ipBlockHits,waf_owasp_hits:l.owaspHits,waf_custom_rule_hits:l.customRuleHits,waf_active_rules:l.activeRules,waf_block_rate:o.blockRate,waf_threat_detection_rate:o.threatDetectionRate,waf_average_latency:o.averageLatency},n){const C=this.connections.filter(R=>R.target===t.id);let S=0;for(const R of C){const M=this.metrics.get(R.source);M&&(S+=M.throughput||0)}S>0&&(i.setSimulatedRequestRate(S),i.simulateRequests(S))}}simulateFirewall(t,e,s,n){const i=this.firewallEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();i.getStats(),s.throughput=o.packetsPerSecond,s.latency=o.averageLatency,s.errorRate=o.blockRate+o.rejectionRate;const d=Math.min(.3,(l.activeRules||0)/100),h=Math.min(.3,o.packetsPerSecond/1e4),f=i.getConfig()?.enableStatefulInspection?.2:0,m=i.getConfig()?.enableIntrusionDetection?.2:0;if(s.utilization=Math.min(.95,.1+d+h+f+m),s.customMetrics={...s.customMetrics||{},firewall_packets_total:l.packetsTotal,firewall_packets_allowed:l.packetsAllowed,firewall_packets_blocked:l.packetsBlocked,firewall_packets_rejected:l.packetsRejected,firewall_active_rules:l.activeRules,firewall_total_connections:l.totalConnections,firewall_active_connections:l.activeConnections,firewall_block_rate:o.blockRate,firewall_rejection_rate:o.rejectionRate,firewall_average_latency:o.averageLatency},n){const y=this.connections.filter(C=>C.target===t.id);let b=0;for(const C of y){const S=this.metrics.get(C.source);S&&(b+=S.throughput||0)}b>0&&(i.setSimulatedPacketRate(b),i.simulatePackets(b))}i.cleanup()}simulateArgoCD(t,e,s,n){const i=this.argoCDEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.syncRate/3600,s.latency=o.averageSyncDuration||0;const l=o.syncOperationsSuccess+o.syncOperationsFailed;s.errorRate=l>0?o.syncOperationsFailed/l:0,s.utilization=o.applicationsTotal>0?o.syncOperationsRunning/o.applicationsTotal:0,s.customMetrics={applicationsTotal:o.applicationsTotal,applicationsSynced:o.applicationsSynced,applicationsOutOfSync:o.applicationsOutOfSync,syncOperationsRunning:o.syncOperationsRunning,repositoriesConnected:o.repositoriesConnected}}simulateTerraform(t,e,s,n){const i=this.terraformEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.runsPerHour/3600,s.latency=o.averageRunDuration||0;const l=o.runsSuccess+o.runsFailed;s.errorRate=l>0?o.runsFailed/l:0,s.utilization=o.workspacesTotal>0?Math.min(1,o.runsRunning/o.workspacesTotal):0,s.customMetrics={workspacesTotal:o.workspacesTotal,runsTotal:o.runsTotal,runsRunning:o.runsRunning,runsPending:o.runsPending,runsSuccess:o.runsSuccess,runsFailed:o.runsFailed,statesTotal:o.statesTotal,resourcesManaged:o.resourcesManaged,runsPerHour:o.runsPerHour,averageRunDuration:o.averageRunDuration}}simulateTraefik(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.traefikEngines.get(t.id);if(!i){const d=e.maxConnections||1e4,h=e.requestsPerSecond||1e4,f=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=h*f,s.latency=1+(1-f)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/h*(d/1e4)),s.customMetrics={max_connections:d,active_connections:Math.floor(s.throughput*.1)};return}const o=i.getStats(),l=i.getLoad();if(n&&o.totalRequests===0){const h=(e||{}).requestsPerSecond||100;i.simulateRequests(h)}s.throughput=l.requestsPerSecond,s.latency=l.averageLatency,s.errorRate=l.errorRate,s.utilization=l.utilization,s.customMetrics={routers:o.routers,active_routers:o.activeRouters,services:o.services,middlewares:o.middlewares,entry_points:o.entryPoints,total_servers:o.totalServers,healthy_servers:o.healthyServers,total_requests:o.totalRequests,total_responses:o.totalResponses,active_connections:o.activeConnections,total_bytes_in:o.totalBytesIn,total_bytes_out:o.totalBytesOut,error_rate:o.errorRate,average_latency:o.averageLatency}}simulateAnsible(t,e,s,n){const i=this.ansibleEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.jobsPerHour/3600,s.latency=o.averageJobDuration*1e3;const l=o.jobsSuccess+o.jobsFailed;s.errorRate=l>0?o.jobsFailed/l:0;const d=o.jobTemplatesEnabled||o.jobTemplatesTotal||1;s.utilization=Math.min(1,o.jobsRunning/d),s.customMetrics={inventoriesTotal:o.inventoriesTotal,projectsTotal:o.projectsTotal,credentialsTotal:o.credentialsTotal,jobTemplatesTotal:o.jobTemplatesTotal,jobTemplatesEnabled:o.jobTemplatesEnabled,jobsTotal:o.jobsTotal,jobsSuccess:o.jobsSuccess,jobsFailed:o.jobsFailed,jobsRunning:o.jobsRunning,jobsPending:o.jobsPending,jobsPerHour:o.jobsPerHour,averageJobDuration:o.averageJobDuration,hostsTotal:o.hostsTotal,hostsOk:o.hostsOk,hostsChanged:o.hostsChanged,hostsFailed:o.hostsFailed,hostsUnreachable:o.hostsUnreachable,schedulesTotal:o.schedulesTotal,schedulesEnabled:o.schedulesEnabled,requestsTotal:o.requestsTotal,requestsErrors:o.requestsErrors}}simulateHarbor(t,e,s,n){const i=this.harborEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate,s.utilization=(o.cpuUtilization+o.memoryUtilization+o.storageUtilization+o.networkUtilization)/4,s.customMetrics={...s.customMetrics||{},harbor_push_ops_per_sec:l.pushOperationsPerSecond,harbor_pull_ops_per_sec:l.pullOperationsPerSecond,harbor_scan_ops_per_sec:l.scanOperationsPerSecond,harbor_replication_ops_per_sec:l.replicationOperationsPerSecond,harbor_avg_push_latency:l.averagePushLatency,harbor_avg_pull_latency:l.averagePullLatency,harbor_avg_scan_latency:l.averageScanLatency,harbor_storage_used:l.storageUsed,harbor_storage_total:l.storageTotal,harbor_projects_total:l.totalProjects,harbor_repositories_total:l.totalRepositories,harbor_tags_total:l.totalTags,harbor_vulnerabilities_total:l.totalVulnerabilities,harbor_scans_completed:l.scansCompleted,harbor_scans_running:l.scansRunning,harbor_scans_failed:l.scansFailed,harbor_replication_policies_enabled:l.replicationPoliciesEnabled,harbor_active_replications:l.activeReplications,harbor_gc_operations_total:l.gcOperationsTotal,harbor_gc_storage_freed:l.gcStorageFreed,harbor_cpu_utilization:o.cpuUtilization,harbor_memory_utilization:o.memoryUtilization,harbor_storage_utilization:o.storageUtilization,harbor_network_utilization:o.networkUtilization}}simulateDocker(t,e,s,n){const i=this.dockerEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate,s.utilization=(o.cpuUtilization+o.memoryUtilization+o.networkUtilization+o.diskUtilization)/4,s.customMetrics={...s.customMetrics||{},docker_containers_total:l.containersTotal,docker_containers_running:l.containersRunning,docker_containers_stopped:l.containersStopped,docker_containers_paused:l.containersPaused,docker_images_total:l.imagesTotal,docker_images_size:l.imagesSize,docker_networks_total:l.networksTotal,docker_volumes_total:l.volumesTotal,docker_volumes_size:l.volumesSize,docker_ops_per_sec:l.operationsPerSecond,docker_avg_operation_latency:l.averageOperationLatency,docker_total_cpu_usage:l.totalCpuUsage,docker_total_memory_usage:l.totalMemoryUsage,docker_total_memory_limit:l.totalMemoryLimit,docker_total_network_rx:l.totalNetworkRx,docker_total_network_tx:l.totalNetworkTx,docker_build_ops_per_sec:l.buildOperationsPerSecond,docker_pull_ops_per_sec:l.pullOperationsPerSecond,docker_push_ops_per_sec:l.pushOperationsPerSecond,docker_cpu_utilization:o.cpuUtilization,docker_memory_utilization:o.memoryUtilization,docker_network_utilization:o.networkUtilization,docker_disk_utilization:o.diskUtilization}}simulateKubernetes(t,e,s,n){const i=this.kubernetesEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.getLoad(),l=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate,s.utilization=(o.cpuUtilization+o.memoryUtilization+o.podUtilization+o.networkUtilization+o.diskUtilization)/5,s.customMetrics={...s.customMetrics||{},k8s_pods_total:l.podsTotal,k8s_pods_running:l.podsRunning,k8s_pods_pending:l.podsPending,k8s_pods_failed:l.podsFailed,k8s_pods_succeeded:l.podsSucceeded,k8s_deployments_total:l.deploymentsTotal,k8s_deployments_ready:l.deploymentsReady,k8s_deployments_not_ready:l.deploymentsNotReady,k8s_services_total:l.servicesTotal,k8s_services_clusterip:l.servicesClusterIP,k8s_services_nodeport:l.servicesNodePort,k8s_services_loadbalancer:l.servicesLoadBalancer,k8s_nodes_total:l.nodesTotal,k8s_nodes_ready:l.nodesReady,k8s_nodes_not_ready:l.nodesNotReady,k8s_namespaces_total:l.namespacesTotal,k8s_configmaps_total:l.configMapsTotal,k8s_secrets_total:l.secretsTotal,k8s_total_cpu_usage:l.totalCpuUsage,k8s_total_memory_usage:l.totalMemoryUsage,k8s_total_memory_capacity:l.totalMemoryCapacity,k8s_cpu_utilization:o.cpuUtilization,k8s_memory_utilization:o.memoryUtilization,k8s_pod_utilization:o.podUtilization,k8s_network_utilization:o.networkUtilization,k8s_disk_utilization:o.diskUtilization}}simulateIDSIPS(t,e,s,n){const i=this.idsIpsEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();i.getStats(),s.throughput=o.packetsPerSecond,s.latency=o.averageLatency;const d=i.getConfig();d?.mode==="ips"?s.errorRate=o.blockRate:s.errorRate=0;const h=Math.min(.3,(l.activeSignatures||0)/100),f=Math.min(.3,o.packetsPerSecond/1e4),m=d?.enableSignatureDetection?.15:0,y=d?.enableAnomalyDetection?.15:0,b=d?.enableBehavioralAnalysis?.1:0;if(s.utilization=Math.min(.95,.1+h+f+m+y+b),s.customMetrics={...s.customMetrics||{},idsips_packets_total:l.packetsTotal,idsips_packets_analyzed:l.packetsAnalyzed,idsips_alerts_generated:l.alertsGenerated,idsips_alerts_blocked:l.alertsBlocked,idsips_signature_matches:l.signatureMatches,idsips_anomaly_detections:l.anomalyDetections,idsips_behavioral_detections:l.behavioralDetections,idsips_active_signatures:l.activeSignatures,idsips_blocked_ips:l.blockedIPs,idsips_alert_rate:o.alertRate,idsips_block_rate:o.blockRate},this.updateLatencyPercentiles(t.id,s.latency,s),!n){const C=this.connections.filter(R=>R.target===t.id);let S=0;for(const R of C){const M=this.metrics.get(R.source);M&&(S+=M.throughput||0)}S>0&&(i.setSimulatedPacketRate(S),i.simulatePackets(S))}}simulatePagerDuty(t,e,s,n){const i=this.pagerDutyEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),l=i.getMetrics();s.throughput=o.throughput,s.latency=o.latency,s.errorRate=o.errorRate,s.utilization=o.utilization,s.customMetrics={incidents_total:l.incidentsTotal,incidents_active:l.incidentsActive,incidents_resolved:l.incidentsResolved,notifications_sent:l.notificationsSent,escalations_triggered:l.escalationsTriggered,acknowledgements:l.acknowledgements,average_ack_latency_ms:l.averageAckLatency,average_resolve_latency_ms:l.averageResolveLatency,api_requests_per_second:l.apiRequestsPerSecond,webhooks_per_second:l.webhooksPerSecond,cpu_utilization:l.cpuUtilization,memory_utilization:l.memoryUtilization}}simulateLoki(t,e,s,n){if(!this.lokiEngines.has(t.id)){const m=new tT;m.initializeConfig(t),this.lokiEngines.set(t.id,m)}const i=this.lokiEngines.get(t.id);n&&this.processLokiIngestion(t,i);const o=i.getLokiMetrics(),l=i.calculateLoad();s.throughput=l.ingestionLinesPerSecond+l.queriesPerSecond;const d=l.ingestionLinesPerSecond/(l.ingestionLinesPerSecond+l.queriesPerSecond||1),h=1-d;s.latency=l.averageIngestionLatency*d+l.averageQueryLatency*h,s.errorRate=l.ingestionErrorRate*d+l.queryErrorRate*h;const f=Math.min(1,l.streamCount/(e.maxStreams||1e4));s.utilization=Math.max(l.storageUtilization,f),s.customMetrics={ingestion_lines_per_second:l.ingestionLinesPerSecond,ingestion_bytes_per_second:l.ingestionBytesPerSecond,ingestion_requests_total:o.ingestionRequestsTotal,ingestion_errors_total:o.ingestionErrorsTotal,ingestion_lines_total:o.ingestionLinesTotal,ingestion_bytes_total:o.ingestionBytesTotal,queries_per_second:l.queriesPerSecond,query_requests_total:o.queryRequestsTotal,query_errors_total:o.queryErrorsTotal,average_query_latency:l.averageQueryLatency,average_ingestion_latency:l.averageIngestionLatency,active_streams:l.streamCount,total_storage_size:o.totalStorageSize,storage_utilization:l.storageUtilization,retention_deletions:o.retentionDeletions}}processLokiIngestion(t,e){const s=this.connections.filter(n=>n.target===t.id);for(const n of s){const i=this.nodes.find(f=>f.id===n.source);if(!i)continue;const o=this.connectionMetrics.get(n.id);if(!o||o.traffic===0)continue;const d=o.traffic/200,h=this.generateLogsFromComponent(i,d);h.length>0&&e.processIngestion(h,i.id)}}generateLogsFromComponent(t,e){const s=[],n=t.type,i=t.data.label||t.id,o={app:i.toLowerCase().replace(/\s+/g,"-"),component:n,source:t.id.slice(0,8)},l=this.metrics.get(t.id),d=Math.ceil(e/100),h=Math.floor(e/d)||1;for(let f=0;f<d&&f<10;f++){const m=[];for(let y=0;y<h;y++){const b=Date.now()*1e6+y,C=this.getLogLevel(l),S=this.generateLogMessage(n,i,C,l);m.push([b.toString(),S])}m.length>0&&s.push({stream:{...o,level:this.getLogLevel(l)},values:m})}return s}getLogLevel(t){return t?t.errorRate>.1?"error":t.errorRate>.05||t.utilization>.9?"warn":"info":"info"}generateLogMessage(t,e,s,n){const i=new Date().toISOString();return s==="error"&&n?`[${i}] ERROR ${t}: Request failed, error rate: ${(n.errorRate*100).toFixed(2)}%`:s==="warn"&&n?`[${i}] WARN ${t}: High utilization: ${(n.utilization*100).toFixed(2)}%`:`[${i}] INFO ${t}: ${e} processing requests, throughput: ${n?.throughput.toFixed(2)||0}/s`}simulateBFF(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.bffRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=e||{},l=o.endpoints||[],d=o.backends||[],h=this.connections.filter(Z=>Z.target===t.id);let f=0;for(const Z of h){const ne=this.connectionMetrics.get(Z.id);if(ne){const J=ne.traffic/2048;f+=J}}const m=e.requestsPerSecond||f||100,y=i.getStats(),b=.3*Math.sin(this.simulationTime/2e3)+.7;s.throughput=m*b;let C=y.averageLatency||100;const S=5+Math.random()*10,R=y.cacheHitRate||0,M=R*.8,T=C*(1-M)+S;s.latency=T+Math.random()*20;const E=y.totalRequests>0?y.totalErrors/y.totalRequests:.005,A=.001;s.errorRate=Math.min(1,E+A);const _=o.maxConcurrentRequests||100,N=s.throughput*(s.latency/1e3);s.utilization=Math.min(1,N/_);const z=l.reduce((Z,ne)=>Z+(ne.requests||0),0),q=d.filter(Z=>Z.status==="connected").length;s.customMetrics={endpoints:l.length,backends:d.length,connected_backends:q,total_requests:y.totalRequests,total_errors:y.totalErrors,avg_latency:Math.round(y.averageLatency),cache_hit_rate:Math.round(R*100)/100,endpoint_requests:z,aggregation_overhead:Math.round(S),concurrent_requests:Math.round(N)}}initializeKongRoutingEngine(t){const e=t.data.config||{},s=new EE;s.initialize({services:e.services||[],routes:e.routes||[],upstreams:e.upstreams||[],consumers:e.consumers||[],plugins:e.plugins||[]}),this.kongRoutingEngines.set(t.id,s)}initializeNginxRoutingEngine(t){const e=t.data.config||{},s=new DE;s.initialize({locations:e.locations||[],upstreams:e.upstreams||[],rateLimitZones:e.rateLimitZones||[],sslCertificates:e.sslCertificates||[],enableSSL:e.enableSSL,sslPort:e.sslPort,enableGzip:e.enableGzip,enableCache:e.enableCache,maxWorkers:e.maxWorkers}),this.nginxRoutingEngines.set(t.id,s)}initializeHAProxyRoutingEngine(t){const e=t.data.config||{},s=new _E,n=(e.frontends||[]).map(o=>({id:o.id,name:o.name,bind:o.bind,mode:o.mode,defaultBackend:o.backends&&o.backends.length>0?o.backends[0]:void 0,backends:o.backends,ssl:o.ssl,requests:o.requests||0,responses:o.responses||0,bytesIn:o.bytesIn||0,bytesOut:o.bytesOut||0})),i=(e.backends||[]).map(o=>({id:o.id,name:o.name,mode:o.mode,balance:o.balance,servers:o.servers||[],healthCheck:o.healthCheck,stickTable:o.stickTable}));s.initialize({frontends:n,backends:i}),this.haproxyRoutingEngines.set(t.id,s)}initializeEnvoyRoutingEngine(t){const e=t.data.config||{},s=new NE,n=(e.clusters||[]).map(l=>({name:l.name,type:l.type||"STRICT_DNS",endpoints:(l.hosts||[]).map(d=>({address:d.address,port:d.port,weight:d.weight||1,healthStatus:d.healthStatus||"unknown"})),connectTimeout:l.connectTimeout||5e3,healthCheck:l.healthChecks?{enabled:!0,interval:l.healthCheckInterval||1e4,timeout:l.healthCheckTimeout||5e3,path:l.healthCheckPath||"/health",healthyThreshold:l.healthCheckHealthyThreshold||1,unhealthyThreshold:l.healthCheckUnhealthyThreshold||2}:void 0,circuitBreaker:l.circuitBreaker?{enabled:!0,maxConnections:l.circuitBreakerMaxConnections,maxRequests:l.circuitBreakerMaxRequests,maxRetries:l.circuitBreakerMaxRetries,consecutiveErrors:l.circuitBreakerConsecutiveErrors||5}:void 0,loadBalancingPolicy:l.loadBalancingPolicy||"ROUND_ROBIN",outlierDetection:l.outlierDetection?{enabled:!0,consecutiveErrors:l.outlierDetectionConsecutiveErrors||5,interval:l.outlierDetectionInterval||1e4,baseEjectionTime:l.outlierDetectionBaseEjectionTime||3e4,maxEjectionPercent:l.outlierDetectionMaxEjectionPercent||50}:void 0})),i=(e.listeners||[]).map(l=>({name:l.name,address:l.address||"0.0.0.0",port:l.port,protocol:l.protocol||"HTTP",filters:(l.filters||[]).map(d=>typeof d=="string"?{name:d,type:d}:d)})),o=(e.routes||[]).map(l=>({name:l.name,match:{prefix:l.match?.startsWith("/")?l.match:void 0,path:l.match&&!l.match.includes("*")&&!l.match.startsWith("/")?l.match:void 0,regex:l.match?.includes("*")?l.match.replace(/\*/g,".*"):void 0},cluster:l.cluster,priority:l.priority||0,timeout:l.timeout,retryPolicy:l.retryPolicy}));s.initialize({clusters:n,listeners:i,routes:o,globalConfig:{maxConnections:e.maxConnections||1024,connectTimeout:e.connectTimeout||5e3,requestTimeout:e.requestTimeout||15e3,drainTime:e.drainTime||600,rateLimit:e.enableRateLimiting?{enabled:!0,rate:e.rateLimitPerSecond||100,burst:e.rateLimitBurst||10}:void 0,tracing:e.enableTracing?{enabled:!0,provider:e.tracingProvider||"jaeger"}:void 0}}),this.envoyRoutingEngines.set(t.id,s)}initializeApigeeRoutingEngine(t){const e=t.data.config||{},s=new TE;s.initialize({organization:e.organization,environment:e.environment,proxies:e.proxies||[],policies:e.policies||[]}),this.apigeeRoutingEngines.set(t.id,s)}initializeMuleSoftRoutingEngine(t){const e=t.data.config||{},s=new AE,n=(e.applications||[]).map(o=>({name:o.name,runtimeVersion:o.runtimeVersion||"4.6.0",workerCount:o.workerCount||2,status:o.status||"stopped",connectors:o.connectors||[],errorStrategy:o.errorStrategy||"continue",reconnectionStrategy:o.reconnectionStrategy||"exponential",auditLogging:o.auditLogging||!1,flows:o.flows||[]})),i=(e.connectors||[]).map(o=>({name:o.name,type:o.type||"api",enabled:o.enabled!==!1,config:o.config||{},targetComponentType:o.targetComponentType,targetComponentId:o.targetComponentId}));s.initialize({organization:e.organization,environment:e.environment,applications:n,connectors:i}),this.mulesoftRoutingEngines.set(t.id,s)}initializeGraphQLGatewayRoutingEngine(t){const e=t.data.config||{},s=new BE;s.initialize({services:e.services||[],federation:e.federation,cacheTtl:e.cacheTtl,persistQueries:e.persistQueries,subscriptions:e.subscriptions,enableIntrospection:e.enableIntrospection,enableQueryComplexityAnalysis:e.enableQueryComplexityAnalysis,enableRateLimiting:e.enableRateLimiting,maxQueryDepth:e.maxQueryDepth,maxQueryComplexity:e.maxQueryComplexity,endpoint:e.endpoint}),this.graphQLGatewayRoutingEngines.set(t.id,s),this.lastGraphQLGatewayUpdate.set(t.id,Date.now())}initializeBFFRoutingEngine(t){const e=t.data.config||{},s=new UE;let n=null,i="";if(e.cacheMode==="redis"){const o=this.connections.find(l=>(l.source===t.id||l.target===t.id)&&this.nodes.find(d=>d.id===(l.source===t.id?l.target:l.source))?.type==="redis");if(o){const l=this.nodes.find(d=>d.id===(o.source===t.id?o.target:o.source));l&&l.type==="redis"&&(this.redisRoutingEngines.has(l.id)||this.initializeRedisRoutingEngine(l),n=this.redisRoutingEngines.get(l.id),i=l.id)}}s.initialize({backends:e.backends||[],endpoints:e.endpoints||[],enableCaching:e.enableCaching??!0,enableRequestBatching:e.enableRequestBatching??!1,enableResponseCompression:e.enableResponseCompression??!0,defaultTimeout:e.defaultTimeout||5e3,maxConcurrentRequests:e.maxConcurrentRequests||100,cacheMode:e.cacheMode||"memory",cacheTtl:e.cacheTtl||5,fallbackEnabled:e.fallbackEnabled??!0,fallbackComponent:e.fallbackComponent,redisEngine:n||void 0,redisNodeId:i||void 0}),this.bffRoutingEngines.set(t.id,s)}initializeWebhookRelayRoutingEngine(t){const e=t.data.config||{},s=new FE;s.initialize({relays:e.relays||[],enableRetryOnFailure:e.enableRetryOnFailure??!0,enableSignatureVerification:e.enableSignatureVerification??!0,enableRequestLogging:e.enableRequestLogging??!0,maxRetryAttempts:e.maxRetryAttempts||3,retryDelay:e.retryDelay||5,timeout:e.timeout||30}),this.webhookRelayRoutingEngines.set(t.id,s)}initializeRedisRoutingEngine(t){const e=t.data.config||{},s=new VE;s.initialize({host:e.host||"localhost",port:e.port||6379,password:e.password||"",database:e.database||0,maxMemory:e.maxMemory||"256mb",maxMemoryPolicy:e.maxMemoryPolicy||"noeviction",enablePersistence:e.enablePersistence??!0,persistenceType:e.persistenceType||"rdb",enableCluster:e.enableCluster??!1,clusterNodes:e.clusterNodes||[],keys:e.keys||[]}),this.redisRoutingEngines.set(t.id,s)}initializeCassandraRoutingEngine(t){const e=t.data.config||{},s=new QE;s.initialize({clusterName:e.clusterName||"archiphoenix-cluster",nodes:e.nodes||[],keyspaces:e.keyspaces||[],tables:e.tables||[],defaultConsistencyLevel:e.consistencyLevel||"QUORUM",defaultReplicationFactor:e.replicationFactor||3,datacenter:e.datacenter||"dc1"}),this.cassandraRoutingEngines.set(t.id,s)}initializeClickHouseRoutingEngine(t){const e=t.data.config||{},s=new GE;s.initialize({cluster:e.cluster||"archiphoenix-cluster",replication:e.replication||!1,tables:e.tables?.map(n=>({name:n.name,database:e.database||"default",engine:n.engine||"MergeTree",rows:n.rows||0,size:n.size||0,partitions:n.partitions||0,columns:n.columns||[]}))||[],maxMemoryUsage:e.maxMemoryUsage||10*1024*1024*1024,compression:e.compression||"LZ4"}),this.clickHouseRoutingEngines.set(t.id,s)}initializeSnowflakeRoutingEngine(t){const e=t.data.config||{},s=new KE;s.initialize({account:e.account||"archiphoenix",region:e.region||"us-east-1",warehouses:e.warehouses?.map(n=>({name:n.name,size:n.size||"Small",status:n.status||"suspended",autoSuspend:n.autoSuspend||(e.enableAutoSuspend?e.autoSuspendSeconds:void 0),autoResume:n.autoResume!==void 0?n.autoResume:e.enableAutoResume!==!1,minClusterCount:n.minClusterCount||1,maxClusterCount:n.maxClusterCount||1,currentClusterCount:n.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0}))||[],databases:e.databases?.map(n=>({name:n.name,comment:n.comment,retentionTime:n.retentionTime,size:n.size,schemas:n.schemas?.map(i=>({name:i.name,tables:i.tables||[],views:i.views||0,functions:i.functions||0}))||[]}))||[],role:e.role||"ACCOUNTADMIN",enableAutoSuspend:e.enableAutoSuspend,autoSuspendSeconds:e.autoSuspendSeconds,enableAutoResume:e.enableAutoResume}),this.snowflakeRoutingEngines.set(t.id,s)}initializeElasticsearchRoutingEngine(t){const e=t.data.config||{},s=new YE;s.initialize({clusterName:e.clusterName||"archiphoenix-cluster",nodes:e.nodes||["localhost:9200"],indices:e.indices||[],defaultShards:e.shards||5,defaultReplicas:e.replicas||1,refreshInterval:e.refreshInterval||"1s",enableSSL:e.enableSSL??!1,enableAuth:e.enableAuth??!1,username:e.username||"elastic",password:e.password||""}),this.elasticsearchRoutingEngines.set(t.id,s)}initializeS3RoutingEngine(t){const e=t.data.config||{},s=new WE,n=(e.buckets||[]).map(i=>({name:i.name,region:i.region||e.defaultRegion||"us-east-1",versioning:i.versioning||!1,encryption:i.encryption||"AES256",lifecycleEnabled:i.lifecycleEnabled||!1,lifecycleDays:i.lifecycleDays,glacierEnabled:i.glacierEnabled||!1,glacierDays:i.glacierDays,publicAccess:i.publicAccess||!1,lifecycleRules:e.lifecycleRules||[]}));s.initialize({buckets:n,defaultRegion:e.defaultRegion||"us-east-1"}),this.s3RoutingEngines.set(t.id,s)}initializePrometheusEngine(t){const e=new ZE;e.initializeConfig(t),this.prometheusEngines.set(t.id,e)}initializeGrafanaEngine(t){const e=new eT;e.initializeConfig(t),this.grafanaEngines.set(t.id,e)}initializeJaegerEngine(t){const e=new sT;e.initializeConfig(t),this.jaegerEngines.set(t.id,e)}initializeOpenTelemetryCollectorEngine(t){if(this.otelCollectorEngines.has(t.id))this.otelCollectorEngines.get(t.id).initializeConfig(t);else{const e=new nT;e.initializeConfig(t),this.otelCollectorEngines.set(t.id,e)}}initializePagerDutyEngine(t){const e=new iT;e.initializeFromNode(t),this.pagerDutyEngines.set(t.id,e)}initializeKeycloakEngine(t){const e=new oT;e.initializeConfig(t),this.keycloakEngines.set(t.id,e)}initializeVaultEngine(t){const e=new fT;e.initializeConfig(t),this.vaultEngines.set(t.id,e)}initializeWAFEngine(t){const e=new cT;e.initializeConfig(t),this.wafEngines.set(t.id,e)}initializeFirewallEngine(t){const e=new uT;e.initializeConfig(t),this.firewallEngines.set(t.id,e)}initializeIDSIPSEngine(t){const e=new hT;e.initializeConfig(t),this.idsIpsEngines.set(t.id,e)}initializeJenkinsEngine(t){const e=new pT;e.initializeConfig(t),this.jenkinsEngines.set(t.id,e)}initializeGitLabCIEngine(t){const e=new gT;e.initializeConfig(t),this.gitlabCIEngines.set(t.id,e)}initializeArgoCDEngine(t){const e=new mT;e.initializeConfig(t),this.argoCDEngines.set(t.id,e)}initializeTerraformEngine(t){const e=new yT;e.initializeConfig(t),this.terraformEngines.set(t.id,e)}initializeAnsibleEngine(t){const e=new ST;e.initializeConfig(t),this.ansibleEngines.set(t.id,e)}initializeTraefikEngine(t){const e=new RT;e.initializeConfig(t),this.traefikEngines.set(t.id,e)}initializeHarborEngine(t){const e=new vT;e.initializeConfig(t),this.harborEngines.set(t.id,e)}initializeDockerEngine(t){const e=new wT;e.initializeConfig(t),this.dockerEngines.set(t.id,e)}initializeKubernetesEngine(t){const e=new CT;e.initializeConfig(t),this.kubernetesEngines.set(t.id,e)}createLokiQueryExecutor(t){const n=((t.data.config||{}).datasources||[]).find(d=>typeof d=="string"?!1:d.type==="loki");if(!n||typeof n=="string")return;const i=n.url||"",o=this.nodes.find(d=>d.type!=="loki"?!1:((d.data.config||{}).serverUrl||"http://loki:3100")===i||i.includes(d.id)||i.includes(d.data.label||""));if(!o)return;const l=this.lokiEngines.get(o.id);if(l)return(d,h,f,m)=>{const y=l.executeQuery(d,h,f,m);return{success:y.success,latency:y.latency,resultsCount:y.resultsCount,error:y.error}}}isPrometheusAvailableForGrafana(t){const e=this.connections.find(o=>o.source===t.id&&this.nodes.find(l=>l.id===o.target)?.type==="prometheus");if(!e)return!1;const s=this.nodes.find(o=>o.id===e.target);if(!s||!this.prometheusEngines.get(s.id))return!1;const i=this.metrics.get(s.id);return!(i&&i.errorRate>.5)}initializePostgreSQLConnectionPool(t){const e=t.data.config||{},s={maxConnections:e.maxConnections||100,minConnections:e.minConnections||0,idleTimeout:e.idleTimeout||3e5,maxLifetime:e.maxLifetime||36e5,connectionTimeout:e.connectionTimeout||5e3},n=new XE(s);this.postgresConnectionPools.set(t.id,n)}updateElasticsearchMetricsInConfig(t,e){const s=t.data.config||{};s.clusterHealth=e.clusterHealth,s.activeShards=e.activeShards,s.relocatingShards=e.relocatingShards,s.initializingShards=e.initializingShards;const n=s.indices||[],i=this.elasticsearchRoutingEngines.get(t.id)?.getIndices()||[];for(let o=0;o<n.length;o++){const l=n[o],d=i.find(h=>h.name===l.name);d&&(n[o]={...l,docs:d.docs,size:d.size,health:d.health})}s.indices=n,s.totalDocs=e.totalDocs,s.totalSize=e.totalSize}updateS3BucketMetricsInConfig(t,e){const s=t.data.config||{},n=s.buckets||[];for(let i=0;i<n.length;i++){const o=n[i],l=e.get(o.name);l&&(n[i]={...o,objectCount:l.objectCount,totalSize:l.totalSize})}s.buckets=n}calculateConnectionLatency(t,e,s){const i={sync:5,async:2,http:10,grpc:5,websocket:3}[t.type]||10,o=e.latency||0,l=s.latency||0,d=t.data||{},h=d.latencyMs||0,f=(d.jitterMs||0)*(Math.random()-.5),m=2+Math.random()*8+h+f;return i+(o+l)/2+m}calculateCacheHitRatio(t,e){let s=.95;e>0&&e<100?s=.9+Math.random()*.05:e>=100&&e<1e3?s=.95+Math.random()*.04:e>=1e3&&(s=.92+Math.random()*.05);const n=Math.sin(this.simulationTime/1e4)*.02;return Math.max(.85,Math.min(.99,s+n))}createDefaultMetrics(t,e){return{id:t,type:e,throughput:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now()}}createDefaultConnectionMetrics(t){return{id:t.id,source:t.source,target:t.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0}}initializeMetrics(){this.metrics.clear(),this.connectionMetrics.clear(),this.latencyHistory.clear(),this.connectionLatencyHistory.clear();for(const t of this.nodes)this.metrics.set(t.id,this.createDefaultMetrics(t.id,t.type))}getComponentMetrics(t){return this.metrics.get(t)}getRabbitMQRoutingEngine(t){return this.rabbitMQRoutingEngines.get(t)}getActiveMQRoutingEngine(t){return this.activeMQRoutingEngines.get(t)}getSQSRoutingEngine(t){return this.sqsRoutingEngines.get(t)}getAzureServiceBusRoutingEngine(t){return this.azureServiceBusRoutingEngines.get(t)}getPubSubRoutingEngine(t){return this.pubSubRoutingEngines.get(t)}getRedisRoutingEngine(t){return this.redisRoutingEngines.get(t)}getCassandraRoutingEngine(t){return this.cassandraRoutingEngines.get(t)}getClickHouseRoutingEngine(t){return this.clickHouseRoutingEngines.get(t)}getSnowflakeRoutingEngine(t){return this.snowflakeRoutingEngines.get(t)}getElasticsearchRoutingEngine(t){return this.elasticsearchRoutingEngines.get(t)}getKongRoutingEngine(t){return this.kongRoutingEngines.get(t)}getNginxRoutingEngine(t){return this.nginxRoutingEngines.get(t)}getHAProxyRoutingEngine(t){return this.haproxyRoutingEngines.get(t)}getTraefikEmulationEngine(t){return this.traefikEngines.get(t)}getEnvoyRoutingEngine(t){return this.envoyRoutingEngines.get(t)}getApigeeRoutingEngine(t){return this.apigeeRoutingEngines.get(t)}getMuleSoftRoutingEngine(t){return this.mulesoftRoutingEngines.get(t)}getGraphQLGatewayRoutingEngine(t){return this.graphQLGatewayRoutingEngines.get(t)}getBFFRoutingEngine(t){return this.bffRoutingEngines.get(t)}getWebhookRelayRoutingEngine(t){return this.webhookRelayRoutingEngines.get(t)}getLokiEmulationEngine(t){return this.lokiEngines.get(t)}getKeycloakEmulationEngine(t){return this.keycloakEngines.get(t)}getJenkinsEmulationEngine(t){return this.jenkinsEngines.get(t)}getGitLabCIEmulationEngine(t){return this.gitlabCIEngines.get(t)}getArgoCDEmulationEngine(t){return this.argoCDEngines.get(t)}getTerraformEmulationEngine(t){return this.terraformEngines.get(t)}getAnsibleEmulationEngine(t){return this.ansibleEngines.get(t)}getHarborEmulationEngine(t){return this.harborEngines.get(t)}getDockerEmulationEngine(t){return this.dockerEngines.get(t)}getKubernetesEmulationEngine(t){return this.kubernetesEngines.get(t)}getVaultEmulationEngine(t){return this.vaultEngines.get(t)}getWAFEmulationEngine(t){return this.wafEngines.get(t)}getFirewallEmulationEngine(t){return this.firewallEngines.get(t)}getIDSIPSEmulationEngine(t){return this.idsIpsEngines.get(t)}getJaegerEmulationEngine(t){return this.jaegerEngines.get(t)}getAllJaegerEngines(){return new Map(this.jaegerEngines)}getOpenTelemetryCollectorRoutingEngine(t){return this.otelCollectorEngines.get(t)}checkSQSIAMPolicy(t,e,s,n){if(!t||t.length===0)return!0;const i=t.filter(d=>{const h=d.principal||"";if(h!==e&&h!=="*"&&!e.includes(h))return!1;const f=d.resource||"";let m=!1;if(f==="*"||f===s)m=!0;else if(f.endsWith("*")){const b=f.slice(0,-1);m=s.startsWith(b.replace(/.*:/,""))}else if(f.includes("sqs:")||f.includes("arn:aws:sqs")){const b=f.split(":").pop()||f.split("/").pop()||"";m=b===s||b==="*"||s.includes(b)}else m=s.includes(f)||f==="*";if(!m)return!1;const y=d.action||"";return!(y!==n&&y!=="*"&&!y.includes(n))});return i.length===0?!0:i.filter(d=>d.effect==="Deny").length>0?!1:(i.filter(d=>d.effect==="Allow").length>0,!0)}checkActiveMQACLPermissionPublic(t,e,s,n){return this.checkActiveMQACLPermission(t,e,s,n)}getConnectionMetrics(t){return this.connectionMetrics.get(t)}getAllComponentMetrics(){return Array.from(this.metrics.values())}getAllConnectionMetrics(){return Array.from(this.connectionMetrics.values())}getPagerDutyIncidents(t){const e=this.pagerDutyEngines.get(t);return e?e.getIncidents():[]}getPagerDutyMetrics(t){const e=this.pagerDutyEngines.get(t);return e?e.getMetrics():null}acknowledgePagerDutyIncident(t,e){const s=this.pagerDutyEngines.get(t);s&&s.acknowledgeIncident(Date.now(),e)}resolvePagerDutyIncident(t,e){const s=this.pagerDutyEngines.get(t);s&&s.resolveIncidentManually(Date.now(),e)}getIsRunning(){return this.isRunning}getSimulationTime(){return this.simulationTime}}const Ae=new ET;function TT(r,t){let e=null;return function(...n){const i=()=>{e=null,r(...n)};e!==null&&clearTimeout(e),e=setTimeout(i,t)}}class AT{logLevel;logs=[];maxLogs=100;constructor(){this.logLevel=2}debug(t,e){this.log(0,t,void 0,e)}info(t,e){this.log(1,t,void 0,e)}warn(t,e,s){this.log(2,t,e,s)}error(t,e,s){this.log(3,t,e,s)}log(t,e,s,n){if(t<this.logLevel)return;const i={level:t,message:e,error:s,timestamp:Date.now(),context:n};this.logs.push(i),this.logs.length>this.maxLogs&&this.logs.shift();const o=`[${this.getLevelName(t)}] ${e}`,l=n?{...n,error:s}:s;switch(t){case 0:console.debug(o,l||"");break;case 1:console.info(o,l||"");break;case 2:console.warn(o,l||"");break;case 3:console.error(o,l||"");break}}getLevelName(t){switch(t){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARN";case 3:return"ERROR";default:return"UNKNOWN"}}getRecentLogs(t,e=50){let s=this.logs;return t!==void 0&&(s=this.logs.filter(n=>n.level>=t)),s.slice(-e)}clearLogs(){this.logs=[]}setLogLevel(t){this.logLevel=t}}const vb=new AT,bb=(r,t,e)=>vb.warn(r,t,e),ii=(r,t,e)=>vb.error(r,t,e),kl="archiphoenix_diagram",Gf=1,DT=500,_T=()=>{try{const r=localStorage.getItem(kl);if(!r)return null;const t=JSON.parse(r);return t.version!==Gf?(bb("Diagram version mismatch, using defaults"),null):t}catch(r){return ii("Failed to load diagram from storage",r instanceof Error?r:new Error(String(r))),null}},NT=(r,t="My Diagram")=>{try{const e={...r,version:Gf,name:t,createdAt:localStorage.getItem(`${kl}_createdAt`)||new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem(kl,JSON.stringify(e)),localStorage.setItem(`${kl}_createdAt`,e.createdAt)}catch(e){ii("Failed to save diagram to storage",e instanceof Error?e:new Error(String(e)))}},gt=TT(NT,DT),jT=(r,t="diagram.json")=>{try{const e={...r,version:Gf,name:t.replace(".json",""),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},s=JSON.stringify(e,null,2),n=new Blob([s],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(e){ii("Failed to export diagram",e instanceof Error?e:new Error(String(e)))}},PT=r=>new Promise(t=>{try{const e=new FileReader;e.onload=s=>{try{const n=s.target?.result,i=JSON.parse(n);if(!i.nodes||!i.connections||typeof i.zoom!="number"||!i.pan)throw new Error("Invalid diagram format");i.groups||(i.groups=[]),t(i)}catch(n){ii("Failed to parse diagram file",n instanceof Error?n:new Error(String(n))),t(null)}},e.readAsText(r)}catch(e){ii("Failed to import diagram",e instanceof Error?e:new Error(String(e))),t(null)}}),LT=50,Ar=un((r,t)=>({past:[],future:[],canUndo:!1,canRedo:!1,pushState:e=>{r(s=>{const n=[...s.past,e];return n.length>LT&&n.shift(),{past:n,future:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{past:e,future:s}=t();if(e.length===0)return null;const n=e[e.length-1],i=e.slice(0,-1);return r({past:i,future:[n,...s],canUndo:i.length>0,canRedo:!0}),n},redo:()=>{const{past:e,future:s}=t();if(s.length===0)return null;const n=s[0],i=s.slice(1);return r({past:[...e,n],future:i,canUndo:!0,canRedo:i.length>0}),n},clearHistory:()=>{r({past:[],future:[],canUndo:!1,canRedo:!1})}}));class zT{rules=new Map;allRules=[];register(t){const e=t.sourceType;this.rules.has(e)||this.rules.set(e,[]);const s=this.rules.get(e);s&&(s.push(t),this.allRules.push(t),s.sort((n,i)=>(i.priority||0)-(n.priority||0)))}registerMany(t){t.forEach(e=>this.register(e))}findRules(t,e){const s=[],n=this.rules.get(t)||[];for(const o of n)(o.targetTypes==="*"||Array.isArray(o.targetTypes)&&o.targetTypes.includes(e))&&s.push(o);const i=this.rules.get("*")||[];for(const o of i)(o.targetTypes==="*"||Array.isArray(o.targetTypes)&&o.targetTypes.includes(e))&&s.push(o);return s.sort((o,l)=>(l.priority||0)-(o.priority||0))}getAllRules(){return[...this.allRules]}getRulesForSource(t){return this.rules.get(t)||[]}clear(){this.rules.clear(),this.allRules=[]}}const IT={postgres:5432,mongodb:27017,redis:6379,cassandra:9042,clickhouse:8123,elasticsearch:9200,rest:8080,grpc:50051,graphql:4e3,websocket:8080,webhook:8080,soap:8080,nginx:80,envoy:80,haproxy:80,traefik:80,docker:2375,kubernetes:6443,kafka:9092,rabbitmq:5672,activemq:61616,"aws-sqs":9324,prometheus:9090,grafana:3e3,loki:3100,jaeger:16686,keycloak:8080,"secrets-vault":8200,crm:8080,erp:8080,"payment-gateway":443},OT={"api-gateway":9100,postgres:9187,redis:9121,"service-mesh":15014,istio:15014,envoy:9901,cdn:9101,"aws-sqs":9102};class xb{getHost(t){return t.data.label?t.data.label.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):t.id.slice(0,8)}getPort(t,e){const s=t.data.config||{};switch(e){case"main":return s.port||s.host?.split(":")[1]||IT[t.type];case"metrics":return s.metricsPort||s.metrics?.port||OT[t.type];case"admin":return s.adminPort||s.admin?.port}}getEndpoint(t,e="main"){const s=this.getHost(t),n=this.getPort(t,e);if(!n)throw new Error(`Port not found for ${t.type}:${e}`);return`${s}:${n}`}getURL(t,e="main",s="http"){const n=this.getEndpoint(t,e);return`${s}://${n}`}getConnectionMetadata(t,e,s){const n=this.getHost(t),i=this.getHost(e),o=this.getPort(t,"main"),l=this.getPort(e,"main");let d="http";return s.type==="grpc"?d="grpc":s.type==="websocket"?d="websocket":e.type==="kafka"?d="kafka":e.type==="rabbitmq"||e.type==="activemq"?d="rabbitmq":s.type==="async"?d="async":s.type==="sync"&&(d="sync"),{protocol:d,sourceHost:n,targetHost:i,sourcePort:o,targetPort:l,endpoint:l?`${i}:${l}`:void 0}}getCapabilities(t){return{defaultPort:this.getPort(t,"main"),metricsPort:this.getPort(t,"metrics"),adminPort:this.getPort(t,"admin"),getHost:e=>this.getHost(e),getPort:(e,s)=>this.getPort(e,s)}}}class HT{registry;discovery;constructor(){this.registry=new zT,this.discovery=new xb}initialize(t){this.registry.registerMany(t)}handleConnectionCreated(t,e,s,n){const i=this.registry.findRules(t.type,e.type);if(i.length===0)return{sourceUpdated:!1,targetUpdated:!1};let o=!1,l=!1;const d=this.discovery.getConnectionMetadata(t,e,s);for(const h of i)try{const f=h.updateSourceConfig(t,e,s,d);if(f&&Object.keys(f).length>0&&(n(t.id,{data:{...t.data,config:{...t.data.config,...f}}}),o=!0),h.updateTargetConfig){const m=h.updateTargetConfig(t,e,s,d);m&&Object.keys(m).length>0&&(n(e.id,{data:{...e.data,config:{...e.data.config,...m}}}),l=!0)}}catch(f){ii(`Error applying rule for ${t.type} -> ${e.type}`,f instanceof Error?f:new Error(String(f)),{sourceType:t.type,targetType:e.type})}return{sourceUpdated:o,targetUpdated:l}}handleConnectionDeleted(t,e,s,n){const i=this.registry.findRules(t.type,e.type);if(i.length===0)return{sourceUpdated:!1,targetUpdated:!1};let o=!1,l=!1;const d=this.discovery.getConnectionMetadata(t,e,s);for(const h of i)try{if(h.cleanupSourceConfig){const f=h.cleanupSourceConfig(t,e,s,d);f&&Object.keys(f).length>0&&(n(t.id,{data:{...t.data,config:{...t.data.config,...f}}}),o=!0)}if(h.cleanupTargetConfig){const f=h.cleanupTargetConfig(t,e,s,d);f&&Object.keys(f).length>0&&(n(e.id,{data:{...e.data,config:{...e.data.config,...f}}}),l=!0)}}catch(f){ii(`Error cleaning up rule for ${t.type} -> ${e.type}`,f instanceof Error?f:new Error(String(f)),{sourceType:t.type,targetType:e.type})}return{sourceUpdated:o,targetUpdated:l}}getDiscovery(){return this.discovery}getRegistry(){return this.registry}}function qT(r){return{sourceType:"envoy",targetTypes:["rest","grpc","graphql","websocket","soap","webhook","postgres","mongodb","redis","cassandra","clickhouse","crm","erp","payment-gateway","bpmn-engine"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).clusters||[],l=o.find(m=>!m.hosts||!Array.isArray(m.hosts)?!1:m.hosts.some(y=>y.address===n.targetHost&&y.port===n.targetPort));if(l)return l.hosts.some(y=>y.address===n.targetHost&&y.port===n.targetPort)?null:{clusters:o.map(y=>y===l?{...y,hosts:[...y.hosts||[],{address:n.targetHost,port:n.targetPort}]}:y)};e.data.label||e.type;const d=`${e.type}-${e.id.slice(0,8)}-cluster`;let h="STRICT_DNS";n.protocol==="grpc"?h="STRICT_DNS":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(h="STATIC_DNS");const f={name:d,type:h,hosts:[{address:n.targetHost,port:n.targetPort}],healthChecks:!0,connectTimeout:5e3,requests:0,errors:0};return{clusters:[...o,f],totalClusters:o.length+1}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function $T(r){return{sourceType:"api-gateway",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).apis||[];if(o.find(S=>S.backendUrl===`http://${n.targetHost}:${n.targetPort}`||S.backendUrl===`https://${n.targetHost}:${n.targetPort}`))return null;const h=`${e.data.label||e.type}-api`,f=`/api/${e.type}`;let m="GET";e.type==="grpc"?m="POST":e.type==="websocket"&&(m="GET");const b=`${n.protocol==="grpc","http"}://${n.targetHost}:${n.targetPort}`,C={name:h,path:f,method:m,backendUrl:b,enabled:!0,requests:0,errors:0};return{apis:[...o,C]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function BT(r){return{sourceType:"kong",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=i.services||[],l=i.routes||[],h=`${n.protocol==="grpc","http"}://${n.targetHost}:${n.targetPort}`,m=`${e.data.label||e.type}-service`;let y=o.find(M=>M.name===m||M.url===h);y||(y={id:String(o.length+1),name:m,url:h,routes:0,enabled:!0},o.push(y));const b=`/api/${e.type}`;if(l.find(M=>M.service===y.name&&M.path===b))return null;let S="GET";e.type==="grpc"?S="POST":(e.type==="websocket"||e.type==="rest"||e.type==="graphql")&&(S="GET");const R={id:String(l.length+1),path:b,method:S,service:y.name,stripPath:!0,protocols:["http","https"]};return y.routes=(y.routes||0)+1,{services:o,routes:[...l,R]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function UT(r){return{sourceType:"service-mesh",targetTypes:"*",priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).services||[];if(o.find(y=>y.host===n.targetHost&&y.port===n.targetPort))return null;const h=(e.data.label||e.type).toLowerCase().replace(/\s+/g,"-");let f="http";n.protocol==="grpc"?f="grpc":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(f="tcp");const m={name:h,namespace:"default",host:n.targetHost,port:n.targetPort,protocol:f,enabled:!0};return{services:[...o,m]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function FT(r){return{sourceType:"istio",targetTypes:"*",priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).services||[];if(o.find(y=>y.host===n.targetHost&&y.port===n.targetPort))return null;const h=(e.data.label||e.type).toLowerCase().replace(/\s+/g,"-");let f="http";n.protocol==="grpc"?f="grpc":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(f="tcp");const m={name:h,namespace:"default",host:n.targetHost,port:n.targetPort,protocol:f,enabled:!0};return{services:[...o,m]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function VT(r){return{sourceType:"nginx",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).upstreams||[],l=`${e.type}-upstream`;let d=o.find(f=>f.name===l);if(d)return d.servers?.some(m=>(m.host===n.targetHost||m.address===`${n.targetHost}:${n.targetPort}`)&&(m.port===n.targetPort||m.address?.includes(`:${n.targetPort}`)))?null:{upstreams:o.map(m=>m.name===l?{...m,servers:[...m.servers||[],{host:n.targetHost,port:n.targetPort}]}:m)};const h={name:l,servers:[{host:n.targetHost,port:n.targetPort}],loadBalancing:"round-robin"};return{upstreams:[...o,h]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function QT(r){return{sourceType:"haproxy",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).backends||[],l=`${e.type}-backend`;let d=o.find(f=>f.name===l);if(d)return d.servers?.some(m=>(m.host===n.targetHost||m.address===`${n.targetHost}:${n.targetPort}`)&&(m.port===n.targetPort||m.address?.includes(`:${n.targetPort}`)))?null:{backends:o.map(m=>m.name===l?{...m,servers:[...m.servers||[],{host:n.targetHost,port:n.targetPort}]}:m)};const h={name:l,servers:[{host:n.targetHost,port:n.targetPort}],balance:"roundrobin"};return{backends:[...o,h]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function GT(r){return{sourceType:"traefik",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=i.services||{},l=i.routers||{},d=`${e.type}-service`,h=`${e.type}-router`;if(o[d])return o[d].servers?.some(b=>b.url===`http://${n.targetHost}:${n.targetPort}`)?null:{services:{...o,[d]:{...o[d],servers:[...o[d].servers||[],{url:`http://${n.targetHost}:${n.targetPort}`}]}}};const m=`Host(\`${(e.data.label||e.type).toLowerCase()}.local\`)`;return{services:{...o,[d]:{loadBalancer:{servers:[{url:`http://${n.targetHost}:${n.targetPort}`}]}}},routers:{...l,[h]:{rule:m,service:d}}}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function KT(r){return{sourceType:"*",targetTypes:["postgres","mongodb","redis","cassandra","clickhouse","elasticsearch"],priority:5,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=e.type;let l={};switch(o){case"postgres":l={database:{host:n.targetHost,port:n.targetPort,database:i.database?.database||"postgres",username:i.database?.username||"postgres",password:i.database?.password||""}};break;case"mongodb":l={database:{connectionString:`mongodb://${n.targetHost}:${n.targetPort}`,database:i.database?.database||"admin"}};break;case"redis":l={database:{host:n.targetHost,port:n.targetPort,password:i.database?.password||""}};break;case"cassandra":l={database:{hosts:[`${n.targetHost}:${n.targetPort}`],keyspace:i.database?.keyspace||"system"}};break;case"clickhouse":l={database:{host:n.targetHost,port:n.targetPort,database:i.database?.database||"default"}};break;case"elasticsearch":l={database:{hosts:[`http://${n.targetHost}:${n.targetPort}`]}};break;default:return null}return l},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function YT(r){return{sourceType:"*",targetTypes:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],priority:5,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=e.type;let l={};switch(o){case"kafka":l={messaging:{broker:`${n.targetHost}:${n.targetPort}`,topic:i.messaging?.topic||e.data.config?.defaultTopic||"default-topic",producerId:i.messaging?.producerId||t.id.slice(0,8)}};break;case"rabbitmq":l={messaging:{broker:`${n.targetHost}:${n.targetPort}`,exchange:i.messaging?.exchange||e.data.config?.defaultExchange||"amq.topic",routingKey:i.messaging?.routingKey||"default"}};break;case"activemq":const d=e.data.config?.queues||[],h=d.length>0&&typeof d[0]=="object"?d[0].name:d.length>0?d[0]:null;l={messaging:{broker:`${n.targetHost}:${n.targetPort}`,queue:i.messaging?.queue||h||"default-queue"}};break;case"aws-sqs":{const f=e.data.config?.queues||[],m=f.length>0&&typeof f[0]=="object"?f[0].name:f.length>0?f[0]:null,y=f.length>0&&typeof f[0]=="object"?f[0].region:e.data.config?.defaultRegion||"us-east-1";l={messaging:{queueUrl:`https://sqs.${y}.amazonaws.com/account/${m||"default-queue"}`,queueName:m||"default-queue",region:i.messaging?.region||y}};break}case"azure-service-bus":{const f=e.data.config||{},m=f.namespace||"archiphoenix.servicebus.windows.net";f.connectionString||`${m}`;const y=i.messaging?.entityType||f.entityType||"queue",b=i.messaging?.entityName||i.messaging?.queue||i.messaging?.topic||f.entityName||(y==="queue"?"events":"events-topic"),C=i.messaging?.subscriptionName||f.subscriptionName;l={messaging:{connectionString:f.connectionString||`Endpoint=sb://${m}/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=...`,namespace:m,entityType:y,queue:y==="queue"?b:void 0,topic:y==="topic"?b:void 0,subscriptionName:y==="topic"&&C?C:void 0}};break}case"gcp-pubsub":l={messaging:{projectId:i.messaging?.projectId||"default-project",topic:i.messaging?.topic||e.data.config?.defaultTopic||"default-topic"}};break;default:return null}return l},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function WT(r,t){const e=r.data.config||{};return e.metrics?.port?e.metrics.port:e.metricsPort?e.metricsPort:(r.type==="service-mesh"||r.type==="istio")&&e.metrics?.controlPlanePort?e.metrics.controlPlanePort:t.getPort(r,"metrics")}function XT(r){const t=r.data.config||{};return t.metrics?.path?t.metrics.path:t.metricsPath?t.metricsPath:r.type==="envoy"?t.metrics?.prometheusPath||"/stats/prometheus":"/metrics"}function tv(r){return r.data.label?r.data.label.toLowerCase().replace(/\s+/g,"-"):`${r.type}-${r.id.slice(0,8)}`}function sv(r,t){const e=t.getHost(r),s=WT(r,t);if(!s){const n=t.getPort(r,"main");return n?`${e}:${n}`:null}return`${e}:${s}`}function JT(r){return{sourceType:"*",targetTypes:["prometheus"],priority:5,updateTargetConfig:(t,e,s,n)=>{const i=e.data.config||{},o=i.scrape_configs||[],l=i.scrapeInterval||"15s",d=XT(t),h=sv(t,r);if(!h)return null;const f=tv(t),m={component:t.type,componentId:t.id},y=o.findIndex(C=>C.job_name===f);if(y>=0){const C=o[y];let S=!1;for(const R of C.static_configs||[]){if(R.targets&&R.targets.includes(h)){S=!0;break}if(R.labels?.componentId===t.id){R.targets.includes(h)||R.targets.push(h),S=!0;break}}if(!S){const R=[...o],M=[...C.static_configs||[]];return M.push({targets:[h],labels:m}),R[y]={...C,static_configs:M},{scrape_configs:R}}return null}const b={job_name:f,scrape_interval:l!=="15s"?l:void 0,metrics_path:d!=="/metrics"?d:void 0,static_configs:[{targets:[h],labels:m}]};return{scrape_configs:[...o,b]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s),cleanupTargetConfig:(t,e,s,n)=>{const o=(e.data.config||{}).scrape_configs||[];if(!o||o.length===0)return null;const l=sv(t,r),d=tv(t),h=t.id;let f=!1;const m=o.map(y=>{if(y.job_name!==d)return y;const b=(y.static_configs||[]).map(C=>{if(C.labels?.componentId===h)return f=!0,null;if(l&&C.targets&&C.targets.includes(l)){const S=C.targets.filter(R=>R!==l);return S.length===0?(f=!0,null):(f=!0,{...C,targets:S})}return C}).filter(C=>C!==null);return b.length===0?(f=!0,null):{...y,static_configs:b}}).filter(y=>y!==null);return f?{scrape_configs:m}:null}}}function ZT(r){return{sourceType:"grafana",targetTypes:["prometheus"],priority:10,updateSourceConfig:(t,e,s,n)=>{let o=(t.data.config||{}).datasources||[];o.length>0&&typeof o[0]=="string"&&(o=o.map(y=>({name:y,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:y===o[0]})));const l=r.getURL(e,"main"),d=n.targetHost||r.getHost(e),h=n.targetPort||r.getPort(e,"main")||9090,f=h===9090?`http://${d}:${h}`:l,m=o.findIndex(y=>y&&typeof y=="object"&&(y.type==="prometheus"||y.name?.toLowerCase().includes("prometheus")));if(m>=0){const y=[...o];return y[m]={...y[m],url:f,type:"prometheus",isDefault:y[m].isDefault??!0},{datasources:y}}else{const y={name:"Prometheus",type:"prometheus",url:f,access:"proxy",isDefault:o.length===0};return{datasources:[...o,y]}}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s),cleanupSourceConfig:(t,e,s,n)=>{let o=(t.data.config||{}).datasources||[];if(o.length>0&&typeof o[0]=="string")return null;const l=r.getURL(e,"main"),d=n.targetHost||r.getHost(e),h=n.targetPort||r.getPort(e,"main")||9090,f=h===9090?`http://${d}:${h}`:l,m=o.filter(y=>!(y&&typeof y=="object"&&y.url===f&&y.type==="prometheus"));return m.length!==o.length?{datasources:m}:null}}}function wb(r){const t=["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],e=["rest","grpc","graphql","soap","websocket","webhook"],s=["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],n=["s3-datalake"],i=["crm","erp","payment-gateway"];return t.includes(r)?"database":e.includes(r)?"api":s.includes(r)?"messaging":n.includes(r)?"file":i.includes(r)?"api":"custom"}function Ol(r,t,e){const s=e?r.label||r.type:t.label||t.type,n=e?r.id.slice(0,8):t.id.slice(0,8);return`${s}-${n}`.toLowerCase().replace(/\s+/g,"-")}function eA(r){return{sourceType:"*",targetTypes:["mulesoft"],priority:5,updateTargetConfig:(t,e,s,n)=>{const o=(e.data.config||{}).connectors||[];if(o.find(m=>m.targetComponentId===t.id||m.name===Ol(t,e,!0)))return null;const d=wb(t.type),f={name:Ol(t,e,!0),type:d,enabled:!0,config:{},targetComponentType:t.type,targetComponentId:t.id};return d==="database"&&n.targetHost&&n.targetPort?f.config={host:n.targetHost,port:n.targetPort}:d==="api"&&n.targetHost&&n.targetPort?f.config={baseUrl:`http://${n.targetHost}:${n.targetPort}`}:d==="messaging"&&(f.config={broker:n.targetHost&&n.targetPort?`${n.targetHost}:${n.targetPort}`:void 0}),{connectors:[...o,f]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function tA(r){return{sourceType:"mulesoft",targetTypes:"*",priority:5,updateSourceConfig:(t,e,s,n)=>{const o=(t.data.config||{}).connectors||[];if(o.find(m=>m.targetComponentId===e.id||m.name===Ol(t,e,!1)))return null;const d=wb(e.type),f={name:Ol(t,e,!1),type:d,enabled:!0,config:{},targetComponentType:e.type,targetComponentId:e.id};return d==="database"&&n.targetHost&&n.targetPort?f.config={host:n.targetHost,port:n.targetPort}:d==="api"&&n.targetHost&&n.targetPort?f.config={baseUrl:`http://${n.targetHost}:${n.targetPort}`}:d==="messaging"&&n.targetHost&&n.targetPort&&(f.config={broker:`${n.targetHost}:${n.targetPort}`}),{connectors:[...o,f]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function sA(r){return{sourceType:"graphql-gateway",targetTypes:["graphql"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).services||[],l=`http://${n.targetHost}:${n.targetPort}/graphql`;if(o.find(m=>m.endpoint===l||m.name===e.data.label))return null;const h=e.data.label||e.type,f={id:`svc-${o.length+1}`,name:h,endpoint:l,status:"connected",requests:0,errors:0};return{services:[...o,f]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function nA(r){return{sourceType:"bff-service",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).backends||[],l=e.data.label||e.type;if(o.find(m=>m.name===l||m.endpoint===`http://${n.targetHost}:${n.targetPort}`||m.id===e.id))return null;let h="http";e.type==="grpc"?h="grpc":e.type==="graphql"&&(h="graphql");const f={id:e.id||`backend-${Date.now()}`,name:l,endpoint:`http://${n.targetHost}:${n.targetPort}`,protocol:h,status:"connected",timeout:5e3,retries:3,retryBackoff:"exponential",circuitBreaker:{enabled:!0,failureThreshold:5,successThreshold:2,timeout:6e4}};return{backends:[...o,f]}},extractMetadata:(t,e,s)=>r.getConnectionMetadata(t,e,s)}}function iA(r){return[qT(r),VT(r),QT(r),GT(r),$T(r),BT(r),sA(r),nA(r),UT(r),FT(r),KT(r),YT(r),JT(r),ZT(r),eA(r),tA(r)]}let Jh=null;function nv(){if(!Jh){const r=new xb,t=new HT,e=iA(r);t.initialize(e),Jh=t}return Jh}const Gs=2e3,iv=140,av=200,pl=(r,t)=>({x:Math.floor(r/Gs),y:Math.floor(t/Gs)}),aA=(r,t,e,s,n,i)=>{const o=n*Gs,l=(n+1)*Gs,d=i*Gs,h=(i+1)*Gs,f=r,m=r+e,y=t,b=t+s;return!(m<o||f>l||b<d||y>h)},Zh=r=>{const t=new Set,e=iv+av,s=iv+av,n=r.position.x,i=n+e,o=r.position.y,l=o+s,d=pl(n,o).x,h=pl(i,l).x,f=pl(n,o).y,m=pl(i,l).y;for(let y=d;y<=h;y++)for(let b=f;b<=m;b++)aA(n,o,e,s,y,b)&&t.add(`${y},${b}`);return t},Fs=(r,t=[])=>{if(r.length===0)return[];const e=new Set,s=new Map(r.map(n=>[n.id,n]));return r.forEach(n=>{Zh(n).forEach(o=>e.add(o))}),t.forEach(n=>{const i=s.get(n.source),o=s.get(n.target);i&&Zh(i).forEach(d=>e.add(d)),o&&Zh(o).forEach(d=>e.add(d))}),Array.from(e).map(n=>{const[i,o]=n.split(",").map(Number);return{x:i,y:o}})},Vs=r=>{if(r.length===0)return{minX:0,minY:0,maxX:Gs,maxY:Gs};const t=r.map(l=>l.x),e=r.map(l=>l.y),s=Math.min(...t),n=Math.min(...e),i=Math.max(...t),o=Math.max(...e);return{minX:s*Gs,minY:n*Gs,maxX:(i+1)*Gs,maxY:(o+1)*Gs}},ef={nodes:[],connections:[],groups:[],zoom:1,pan:{x:0,y:0}},Re=un((r,t)=>{const e=_T(),s=e?{...ef,...e,groups:e.groups||[]}:ef;let n=!1,i=!1;const o=()=>{const f=t();return{nodes:f.nodes,connections:f.connections,groups:f.groups||[],zoom:f.zoom,pan:f.pan}},l=()=>{Ar.getState().pushState(o())},d=Fs(s.nodes,s.connections||[]),h=Vs(d);return{...s,selectedNodeId:null,selectedConnectionId:null,diagramName:e?.name||"Untitled Diagram",viewportWidth:0,viewportHeight:0,canvasBounds:h,canvasChunks:d,getDiagramState:o,updateCanvasBounds:()=>r(f=>{const m=Fs(f.nodes,f.connections);return{canvasChunks:m,canvasBounds:Vs(m)}}),addNode:f=>r(m=>{l();const y=[...m.nodes,f],b=Fs(y,m.connections),C={nodes:y,canvasChunks:b,canvasBounds:Vs(b)};return gt({...m,...C},m.diagramName),C}),updateNode:(f,m,y=!1)=>r(b=>{!y&&!n&&l();const C=b.nodes.map(M=>M.id===f?{...M,...m}:M),S=Fs(C,b.connections),R={nodes:C,canvasChunks:S,canvasBounds:Vs(S)};return(!n||!y)&&gt({...b,...R},b.diagramName),R}),updateNodes:(f,m=!1)=>r(y=>{!m&&!n&&!i&&l();const b=new Map(f.map(M=>[M.id,M.updates])),C=y.nodes.map(M=>{const T=b.get(M.id);return T?{...M,...T}:M}),S=Fs(C,y.connections),R={nodes:C,canvasChunks:S,canvasBounds:Vs(S)};return(!i||!m)&&gt({...y,...R},y.diagramName),R}),deleteNode:f=>r(m=>{l();const y=m.nodes.filter(R=>R.id!==f),b=m.connections.filter(R=>R.source!==f&&R.target!==f),C=Fs(y,b),S={nodes:y,connections:b,selectedNodeId:m.selectedNodeId===f?null:m.selectedNodeId,canvasChunks:C,canvasBounds:Vs(C)};return gt({...m,...S},m.diagramName),S}),selectNode:(f,m=!1)=>r(y=>m&&f&&y.nodes.find(C=>C.id===f)?{selectedNodeId:f,nodes:y.nodes.map(C=>({...C,selected:C.id===f?!C.selected:C.selected||!1}))}:{selectedNodeId:f,nodes:y.nodes.map(b=>({...b,selected:b.id===f}))}),selectNodesByIds:f=>r(m=>({selectedNodeId:f.length>0?f[0]:null,nodes:m.nodes.map(y=>({...y,selected:f.includes(y.id)}))})),addConnection:f=>r(m=>{l();const y={...f,type:f.type||"async"},b=m.nodes.find(E=>E.id===y.source),C=m.nodes.find(E=>E.id===y.target);let S=[...m.nodes];if(b&&C){const E=nv(),A=(_,N)=>{const z=S.findIndex(q=>q.id===_);z!==-1&&(S[z]={...S[z],...N})};E.handleConnectionCreated(b,C,y,A)}const R=[...m.connections,y],M=Fs(S,R),T={nodes:S,connections:R,canvasChunks:M,canvasBounds:Vs(M)};return gt({...m,...T},m.diagramName),T}),updateConnection:(f,m)=>r(y=>{l();const b={connections:y.connections.map(C=>C.id===f?{...C,...m}:C)};return gt({...y,...b},y.diagramName),b}),deleteConnection:f=>r(m=>{l();const y=m.connections.find(M=>M.id===f);let b=[...m.nodes];if(y){const M=m.nodes.find(E=>E.id===y.source),T=m.nodes.find(E=>E.id===y.target);if(M&&T){const E=nv(),A=(_,N)=>{const z=b.findIndex(q=>q.id===_);z!==-1&&(b[z]={...b[z],...N})};E.handleConnectionDeleted(M,T,y,A)}}const C=m.connections.filter(M=>M.id!==f),S=Fs(b,C),R={nodes:b,connections:C,selectedConnectionId:m.selectedConnectionId===f?null:m.selectedConnectionId,canvasChunks:S,canvasBounds:Vs(S)};return gt({...m,...R},m.diagramName),R}),selectConnection:f=>r(m=>({selectedConnectionId:f,selectedNodeId:null,selectedGroupId:null,connections:m.connections.map(y=>({...y,selected:y.id===f}))})),addGroup:f=>r(m=>{l();const y={groups:[...m.groups,f]};return gt({...m,...y},m.diagramName),y}),updateGroup:(f,m)=>r(y=>{l();const b={groups:y.groups.map(C=>C.id===f?{...C,...m}:C)};return gt({...y,...b},y.diagramName),b}),deleteGroup:f=>r(m=>{l();const y={groups:m.groups.filter(b=>b.id!==f)};return gt({...m,...y},m.diagramName),y}),addNodeToGroup:(f,m)=>r(y=>{l();const b={groups:y.groups.map(C=>C.id===f&&!C.nodeIds.includes(m)?{...C,nodeIds:[...C.nodeIds,m]}:C)};return gt({...y,...b},y.diagramName),b}),removeNodeFromGroup:(f,m)=>r(y=>{l();const b={groups:y.groups.map(C=>C.id===f?{...C,nodeIds:C.nodeIds.filter(S=>S!==m)}:C)};return gt({...y,...b},y.diagramName),b}),selectGroup:f=>r(m=>({selectedGroupId:f,selectedNodeId:null,selectedConnectionId:null})),createGroupFromSelection:f=>r(m=>{l();const y=m.nodes.filter(S=>S.selected||S.id===m.selectedNodeId).map(S=>S.id);if(y.length===0)return m;const b={id:`group-${Date.now()}`,name:f,nodeIds:y,color:`hsl(${Math.random()*360}, 70%, 50%)`},C={groups:[...m.groups,b],nodes:m.nodes.map(S=>({...S,selected:!1})),selectedNodeId:null};return gt({...m,...C},m.diagramName),C}),autoGroupByConnections:()=>r(f=>{l();const m=new Set;f.groups.forEach(E=>{E.nodeIds.forEach(A=>m.add(A))});const y=new Map,b=E=>{y.has(E)||y.set(E,E);const A=y.get(E);if(A!==void 0&&A!==E){const _=b(A);return y.set(E,_),_}return A??E},C=(E,A)=>{const _=b(E),N=b(A);_!==N&&y.set(_,N)};f.connections.forEach(E=>{!m.has(E.source)&&!m.has(E.target)&&C(E.source,E.target)});const S=new Map;f.nodes.forEach(E=>{if(!m.has(E.id)){const A=b(E.id);S.has(A)||S.set(A,[]);const _=S.get(A);_&&_.push(E.id)}});const R=[];let M=f.groups.length+1;S.forEach((E,A)=>{E.length>=2&&R.push({id:`group-${Date.now()}-${R.length}`,name:`Group ${M++}`,nodeIds:E,color:`hsl(${Math.random()*360}, 70%, 50%)`})});const T={groups:[...f.groups,...R]};return gt({...f,...T},f.diagramName),T}),setZoom:f=>r(m=>(gt({...m,zoom:f},m.diagramName),{zoom:f})),setPan:f=>r(m=>(gt({...m,pan:f},m.diagramName),{pan:f})),setViewportSize:f=>r(()=>({viewportWidth:f.width,viewportHeight:f.height})),setDiagramName:f=>r(m=>(gt(m,f),{diagramName:f})),loadDiagramState:(f,m=!1)=>r(()=>{m||l();const y=Fs(f.nodes||[],f.connections||[]),b={...f,canvasChunks:y,canvasBounds:Vs(y)};return gt(b,t().diagramName),b}),saveDiagram:()=>{const f=t();gt(f,f.diagramName)},resetCanvas:()=>{l();const f=Fs([],[]);r({...ef,canvasChunks:f,canvasBounds:Vs(f)})},undo:()=>{const f=Ar.getState().undo();f&&r(()=>{const m=Fs(f.nodes||[],f.connections||[]),y={...f,canvasChunks:m,canvasBounds:Vs(m)};return gt(y,t().diagramName),y})},redo:()=>{const f=Ar.getState().redo();f&&r(()=>{const m=Fs(f.nodes||[],f.connections||[]),y={...f,canvasChunks:m,canvasBounds:Vs(m)};return gt(y,t().diagramName),y})},startDragOperation:f=>{const m=t();n=!0,m.nodes.find(y=>y.id===f),l()},endDragOperation:()=>{n=!1;const f=t();gt(f,f.diagramName)},setGroupDragging:f=>{i=f},getIsGroupDragging:()=>i,bringToFront:f=>r(m=>{l();const y=m.nodes.findIndex(R=>R.id===f);if(y===-1)return m;const b=[...m.nodes],[C]=b.splice(y,1);b.push(C);const S={nodes:b};return gt({...m,...S},m.diagramName),S}),sendToBack:f=>r(m=>{l();const y=m.nodes.findIndex(R=>R.id===f);if(y===-1)return m;const b=[...m.nodes],[C]=b.splice(y,1);b.unshift(C);const S={nodes:b};return gt({...m,...S},m.diagramName),S}),bringForward:f=>r(m=>{l();const y=m.nodes.findIndex(S=>S.id===f);if(y===-1||y===m.nodes.length-1)return m;const b=[...m.nodes];[b[y],b[y+1]]=[b[y+1],b[y]];const C={nodes:b};return gt({...m,...C},m.diagramName),C}),sendBackward:f=>r(m=>{l();const y=m.nodes.findIndex(S=>S.id===f);if(y===-1||y===0)return m;const b=[...m.nodes];[b[y],b[y-1]]=[b[y-1],b[y]];const C={nodes:b};return gt({...m,...C},m.diagramName),C})}}),Li=un((r,t)=>({isRunning:!1,messages:new Map,messageHistory:[],initialize:(e,s)=>{ds.initialize(e,s),t().updateMessages(e,s)},start:()=>{ds.start(),r({isRunning:!0});const e=setInterval(()=>{const{nodes:s,connections:n}=Re.getState();t().updateMessages(s,n)},200);ds._pollInterval=e},stop:()=>{ds.stop();const e=ds._pollInterval;e&&clearInterval(e),r({isRunning:!1})},updateMessages:(e,s)=>{ds.updateNodesAndConnections(e,s);const n=new Map;for(const o of s)n.set(o.id,ds.getConnectionMessages(o.id));const i=ds.getMessageHistory(100);r({messages:n,messageHistory:i})},getConnectionMessages:e=>ds.getConnectionMessages(e),getComponentMessages:e=>ds.getComponentMessages(e),getMessageHistory:e=>ds.getMessageHistory(e)}));class oA{nodes=[];connections=[];componentMetrics=new Map;connectionMetrics=new Map;dependencyGraph=new Map;componentStatuses=new Map;update(t,e,s,n){this.nodes=t,this.connections=e,this.componentMetrics=s,this.connectionMetrics=n,this.buildDependencyGraph(),this.analyzeComponentHealth(),this.identifyCriticalPaths(),this.calculateImpactScores()}buildDependencyGraph(){this.dependencyGraph.clear();for(const t of this.nodes){const e=[],s=this.connections.filter(n=>n.target===t.id);for(const n of s){const i=this.connectionMetrics.get(n.id),o=this.componentMetrics.get(n.source);if(!i||!o)continue;const l=Math.max(i.throughputDependency,i.utilization,i.backpressure);let d="direct";i.bottleneck?d="critical":l>.7&&(d="indirect"),e.push({sourceId:n.source,targetId:t.id,connectionId:n.id,type:d,strength:l,impact:this.calculateDependencyImpact(n,o)})}this.dependencyGraph.set(t.id,e)}}calculateDependencyImpact(t,e){const s=this.connectionMetrics.get(t.id);if(!s)return 0;const n=e.errorRate,i=Math.min(1,s.latency/1e3),o=s.backpressure,l=e.utilization>.8?.5:0;return Math.min(1,n*.4+i*.2+o*.3+l*.1)}analyzeComponentHealth(){this.componentStatuses.clear();for(const t of this.nodes){const e=this.componentMetrics.get(t.id),s=this.dependencyGraph.get(t.id)||[];if(!e){this.componentStatuses.set(t.id,{nodeId:t.id,health:"down",dependencies:s,dependents:[],criticalPath:!1,impactScore:0,failureRisk:1});continue}let n="healthy",i=0;e.errorRate>.1?(n="critical",i+=.4):e.errorRate>.05&&(n="degraded",i+=.2),e.utilization>.9?(n==="healthy"&&(n="degraded"),i+=.3):e.utilization>.8&&(i+=.15),e.latency>1e3?(n==="healthy"&&(n="degraded"),i+=.2):e.latency>500&&(i+=.1);for(const l of s){const d=this.componentStatuses.get(l.sourceId);d&&(d.health==="critical"||d.health==="down"?(n==="healthy"&&(n="degraded"),i+=l.impact*.3):d.health==="degraded"&&(i+=l.impact*.15))}i=Math.min(1,i);const o=[];for(const l of this.connections)if(l.source===t.id){const d=this.connectionMetrics.get(l.id);d&&o.push({sourceId:t.id,targetId:l.target,connectionId:l.id,type:d.bottleneck?"critical":"direct",strength:d.throughputDependency,impact:this.calculateDependencyImpact(l,e)})}this.componentStatuses.set(t.id,{nodeId:t.id,health:n,dependencies:s,dependents:o,criticalPath:!1,impactScore:0,failureRisk:i})}}identifyCriticalPaths(){const t=this.nodes.filter(s=>!this.connections.some(n=>n.target===s.id)),e=this.nodes.filter(s=>!this.connections.some(n=>n.source===s.id));for(const s of t)for(const n of e){const i=this.findPath(s.id,n.id);i&&i.length>1&&i.some(l=>{const d=this.componentStatuses.get(l),h=this.connections.find(f=>i.includes(f.source)&&i.includes(f.target)&&i.indexOf(f.source)<i.indexOf(f.target));if(h){const f=this.connectionMetrics.get(h.id);return f?.bottleneck||(f?.backpressure||0)>.7}return d?.health==="critical"||d?.health==="down"})&&i.forEach(l=>{const d=this.componentStatuses.get(l);d&&(d.criticalPath=!0)})}}findPath(t,e){if(t===e)return[t];const s=[{nodeId:t,path:[t]}],n=new Set([t]);for(;s.length>0;){const{nodeId:i,path:o}=s.shift(),l=this.connections.filter(d=>d.source===i);for(const d of l){if(d.target===e)return[...o,e];n.has(d.target)||(n.add(d.target),s.push({nodeId:d.target,path:[...o,d.target]}))}}return null}calculateImpactScores(){for(const[t,e]of this.componentStatuses.entries()){let s=0;s+=Math.min(1,e.dependents.length/5)*.3,e.health==="critical"||e.health==="down"?s+=.4:e.health==="degraded"&&(s+=.2),e.criticalPath&&(s+=.2),s+=e.failureRisk*.1,e.impactScore=Math.min(1,s),this.componentStatuses.set(t,e)}}analyzeSystem(){const t=[],e=[],s=[],n=[];for(const[d,h]of this.componentStatuses.entries())if(h.criticalPath){const f=this.findPathToSink(d);f&&!t.some(m=>JSON.stringify(m)===JSON.stringify(f))&&t.push(f)}for(const[d,h]of this.connectionMetrics.entries())if(h.bottleneck){const f=this.connections.find(m=>m.id===d);f&&(e.includes(f.source)||e.push(f.source),e.includes(f.target)||e.push(f.target))}for(const[d,h]of this.componentStatuses.entries())(h.failureRisk>.6||h.health==="critical"||h.health==="down")&&s.push(d);this.generateRecommendations(n);const i=Array.from(this.componentStatuses.values()).map(d=>{switch(d.health){case"down":return 0;case"critical":return .25;case"degraded":return .5;case"healthy":return 1}}),o=i.length>0?i.reduce((d,h)=>d+h,0)/i.length:1;let l="healthy";return o<.25?l="down":o<.5?l="critical":o<.75&&(l="degraded"),{criticalPaths:t,bottlenecks:e,riskComponents:s,recommendations:n,overallHealth:l}}findPathToSink(t){const e=this.nodes.filter(s=>!this.connections.some(n=>n.source===s.id));for(const s of e){const n=this.findPath(t,s.id);if(n)return n}return null}generateRecommendations(t){for(const[s,n]of this.componentStatuses.entries()){const i=this.nodes.find(l=>l.id===s),o=this.componentMetrics.get(s);!i||!o||(o.utilization>.85&&t.push({type:"scaling",priority:o.utilization>.95?"critical":"high",componentId:s,message:`${i.data.label} is highly utilized (${(o.utilization*100).toFixed(0)}%)`,impact:"May cause performance degradation and increased latency",suggestion:`Consider scaling ${i.data.label} horizontally or vertically`}),o.errorRate>.05&&t.push({type:"monitoring",priority:o.errorRate>.1?"critical":"high",componentId:s,message:`${i.data.label} has high error rate (${(o.errorRate*100).toFixed(1)}%)`,impact:"Affects system reliability and user experience",suggestion:`Investigate error logs and implement error handling for ${i.data.label}`}),o.latency>500&&t.push({type:"optimization",priority:o.latency>1e3?"high":"medium",componentId:s,message:`${i.data.label} has high latency (${o.latency.toFixed(0)}ms)`,impact:"Affects end-to-end response time",suggestion:`Optimize ${i.data.label} performance or add caching`}),n.criticalPath&&n.failureRisk>.5&&t.push({type:"redundancy",priority:"high",componentId:s,message:`${i.data.label} is on a critical path and at risk`,impact:"Failure would significantly impact system",suggestion:`Add redundancy or failover for ${i.data.label}`}))}for(const[s,n]of this.connectionMetrics.entries()){const i=this.connections.find(d=>d.id===s);if(!i)continue;const o=this.nodes.find(d=>d.id===i.source),l=this.nodes.find(d=>d.id===i.target);n.bottleneck&&t.push({type:"optimization",priority:"critical",connectionId:s,message:`Connection between ${o?.data.label||"source"} and ${l?.data.label||"target"} is a bottleneck`,impact:"Limiting overall system throughput",suggestion:"Increase bandwidth or optimize data transfer between these components"}),n.backpressure>.7&&t.push({type:"optimization",priority:"high",connectionId:s,message:`High backpressure (${(n.backpressure*100).toFixed(0)}%) on connection`,impact:"Target component cannot process data fast enough",suggestion:"Scale target component or implement buffering/queuing"})}const e={critical:0,high:1,medium:2,low:3};t.sort((s,n)=>e[s.priority]-e[n.priority])}getComponentStatus(t){return this.componentStatuses.get(t)}getAllComponentStatuses(){return Array.from(this.componentStatuses.values())}getDependencies(t){return this.dependencyGraph.get(t)||[]}}const tf=new oA,ma=un((r,t)=>({componentStatuses:new Map,systemAnalysis:null,updateAnalysis:()=>{const{nodes:e,connections:s}=Re.getState(),{componentMetrics:n,connectionMetrics:i}=Nt.getState();tf.update(e,s,n,i);const o=tf.analyzeSystem(),l=new Map(tf.getAllComponentStatuses().map(d=>[d.nodeId,d]));r({componentStatuses:l,systemAnalysis:o})},getComponentStatus:e=>t().componentStatuses.get(e),getAllComponentStatuses:()=>Array.from(t().componentStatuses.values()),getSystemAnalysis:()=>t().systemAnalysis})),Kf=un((r,t)=>({alerts:[],updateAlerts:()=>{try{const{nodes:e,connections:s}=Re.getState(),{componentMetrics:n,connectionMetrics:i}=Nt.getState(),o=ma.getState().getAllComponentStatuses();ha.analyze(e,n,i,o);const l=ha.getAlerts();r({alerts:l})}catch(e){console.error("Error in updateAlerts:",e)}},acknowledgeAlert:e=>{ha.acknowledge(e);const s=ha.getAlerts();r({alerts:s})},clearAlerts:()=>{ha.clear(),r({alerts:[]})},getCriticalAlerts:()=>t().alerts.filter(e=>e.type==="critical"),getWarningAlerts:()=>t().alerts.filter(e=>e.type==="warning")})),Cb=un((r,t)=>(it.onError(()=>{t().updateErrors()}),{errors:[],updateErrors:()=>{const e=it.getErrors();r({errors:e})},clearErrors:()=>{it.clear(),r({errors:[]})},clearErrorsByFilter:e=>{it.clearByFilter(e),t().updateErrors()},removeError:e=>{it.removeError(e),t().updateErrors()},getErrorsBySeverity:e=>it.getErrorsBySeverity(e),getErrorsBySource:e=>it.getErrorsBySource(e),getErrorsByComponent:e=>it.getErrorsByComponent(e),getCriticalErrors:()=>it.getCriticalErrors(),getErrorCount:e=>it.getErrorCount(e),getStats:()=>it.getStats()})),Nt=un((r,t)=>({isRunning:!1,simulationTime:0,updateInterval:100,componentMetrics:new Map,connectionMetrics:new Map,initialize:(e,s)=>{Ae.initialize(e,s),r({componentMetrics:new Map(Ae.getAllComponentMetrics().map(n=>[n.id,n])),connectionMetrics:new Map(Ae.getAllConnectionMetrics().map(n=>[n.id,n]))}),Li.getState().initialize(e,s)},start:()=>{console.log("useEmulationStore.start() called");try{const e=Ae.getIsRunning();console.log("Engine running state:",e),e&&(console.log("Stopping engine first..."),Ae.stop()),console.log("Calling emulationEngine.start()..."),Ae.start(),console.log("Engine started, setting store isRunning to true"),r({isRunning:!0}),console.log("Starting data flow..."),Li.getState().start(),console.log("Setting up polling interval...");const s=setInterval(()=>{t().updateMetrics()},t().updateInterval);Ae._pollInterval=s,console.log("Start complete, polling interval set")}catch(e){throw console.error("Error in useEmulationStore.start():",e),e}},stop:()=>{Ae.stop();const e=Ae._pollInterval;e&&clearInterval(e),Li.getState().stop(),r({isRunning:!1})},reset:()=>{Ae.resetSimulation();const e=Ae._pollInterval;e&&clearInterval(e),Li.getState().stop(),r({isRunning:!1,simulationTime:0,componentMetrics:new Map,connectionMetrics:new Map})},setUpdateInterval:e=>{r({updateInterval:e})},updateMetrics:()=>{const{nodes:e,connections:s}=Re.getState();Ae.updateNodesAndConnections(e,s),r(n=>({simulationTime:Ae.getSimulationTime(),componentMetrics:new Map(Ae.getAllComponentMetrics().map(i=>[i.id,i])),connectionMetrics:new Map(Ae.getAllConnectionMetrics().map(i=>[i.id,i]))})),Li.getState().updateMessages(e,s),ma.getState().updateAnalysis(),Kf.getState().updateAlerts(),Cb.getState().updateErrors()},getComponentMetrics:e=>t().componentMetrics.get(e),getConnectionMetrics:e=>t().connectionMetrics.get(e)}));const rA=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cA=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,s)=>s?s.toUpperCase():e.toLowerCase()),ov=r=>{const t=cA(r);return t.charAt(0).toUpperCase()+t.slice(1)},Sb=(...r)=>r.filter((t,e,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===e).join(" ").trim(),lA=r=>{for(const t in r)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var uA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const dA=w.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:s,className:n="",children:i,iconNode:o,...l},d)=>w.createElement("svg",{ref:d,...uA,width:t,height:t,stroke:r,strokeWidth:s?Number(e)*24/Number(t):e,className:Sb("lucide",n),...!i&&!lA(l)&&{"aria-hidden":"true"},...l},[...o.map(([h,f])=>w.createElement(h,f)),...Array.isArray(i)?i:[i]]));const _e=(r,t)=>{const e=w.forwardRef(({className:s,...n},i)=>w.createElement(dA,{ref:i,iconNode:t,className:Sb(`lucide-${rA(ov(r))}`,`lucide-${r}`,s),...n}));return e.displayName=ov(r),e};const hA=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ya=_e("activity",hA);const fA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],pA=_e("arrow-down",fA);const gA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],mA=_e("arrow-right",gA);const yA=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],vA=_e("arrow-up",yA);const bA=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xA=_e("ban",bA);const wA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Yf=_e("check",wA);const CA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Jl=_e("chevron-down",CA);const SA=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Wf=_e("chevron-right",SA);const MA=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Mb=_e("chevron-up",MA);const RA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],va=_e("circle-alert",RA);const kA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Xf=_e("circle-check",kA);const EA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],TA=_e("circle-question-mark",EA);const AA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pa=_e("circle-x",AA);const DA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],_A=_e("circle",DA);const NA=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Rb=_e("copy",NA);const jA=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],PA=_e("download",jA);const LA=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],zA=_e("eye",LA);const IA=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],rv=_e("file-text",IA);const OA=[["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],HA=_e("folder-minus",OA);const qA=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],xf=_e("folder-plus",qA);const $A=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],kb=_e("funnel",$A);const BA=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],UA=_e("grip-vertical",BA);const FA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Eb=_e("info",FA);const VA=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Tb=_e("layers",VA);const QA=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],GA=_e("map",QA);const KA=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],YA=_e("maximize-2",KA);const WA=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],XA=_e("network",WA);const JA=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ZA=_e("pause",JA);const eD=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],tD=_e("play",eD);const sD=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Hl=_e("plus",sD);const nD=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],El=_e("power-off",nD);const iD=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],sf=_e("power",iD);const aD=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],oD=_e("redo-2",aD);const rD=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],cD=_e("refresh-cw",rD);const lD=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ab=_e("rotate-ccw",lD);const uD=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],dD=_e("ruler",uD);const hD=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],fD=_e("save",hD);const pD=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$r=_e("search",pD);const gD=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],nf=_e("settings-2",gD);const mD=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],yD=_e("settings",mD);const vD=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],bD=_e("sparkles",vD);const xD=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],wD=_e("square-pen",xD);const CD=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],SD=_e("star",CD);const MD=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Zl=_e("trash-2",MD);const RD=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Db=_e("trending-down",RD);const kD=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],an=_e("triangle-alert",kD);const ED=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],TD=_e("undo-2",ED);const AD=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],DD=_e("upload",AD);const _D=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],on=_e("x",_D);const ND=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],_b=_e("zap",ND);const jD=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],PD=_e("zoom-in",jD);const LD=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],zD=_e("zoom-out",LD);function ID(){const{isRunning:r,simulationTime:t,initialize:e,start:s,stop:n,reset:i}=Nt(),{nodes:o,connections:l}=Re();w.useEffect(()=>{const y=Ae.getIsRunning();console.log("EmulationPanel mounted/updated",{storeIsRunning:r,engineIsRunning:y,simulationTime:t,nodesCount:o.length,connectionsCount:l.length}),r!==y&&(console.warn("State mismatch detected!",{storeIsRunning:r,engineIsRunning:y}),r&&!y?(console.log("Fixing: stopping store"),n()):!r&&y&&(console.log("Fixing: stopping engine"),Ae.stop()))},[r,t,o.length,l.length,n]);const d=()=>{console.log("handleStart called",{isRunning:r,simulationTime:t,nodesCount:o.length,connectionsCount:l.length});try{t===0&&(console.log("Initializing emulation..."),e(o,l),console.log("Initialization complete")),console.log("Starting emulation..."),s(),console.log("Start called, isRunning should be true now")}catch(y){console.error("Error starting emulation:",y)}},h=()=>{n()},f=()=>{i()},m=y=>{const b=Math.floor(y/1e3),C=Math.floor(b/60),S=b%60;return`${C}:${S.toString().padStart(2,"0")}`};return g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-sm text-muted-foreground w-12",children:m(t)}),g.jsx(Ee,{size:"sm",variant:r?"default":"outline",onClick:y=>{console.log("Button clicked!",{isRunning:r,simulationTime:t,disabled:r}),y.preventDefault(),y.stopPropagation(),r?console.warn("Button clicked but isRunning is true, button should be disabled"):d()},disabled:r,title:"Start emulation",style:{pointerEvents:r?"none":"auto"},children:g.jsx(tD,{className:"w-4 h-4"})}),g.jsx(Ee,{size:"sm",variant:r?"default":"outline",onClick:h,disabled:!r,title:"Stop emulation",children:g.jsx(ZA,{className:"w-4 h-4"})}),g.jsx(Ee,{size:"sm",variant:"outline",onClick:f,title:"Reset simulation",children:g.jsx(Ab,{className:"w-4 h-4"})})]})}const Tt=w.forwardRef(({className:r,type:t,...e},s)=>g.jsx("input",{type:t,className:ke("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...e}));Tt.displayName="Input";function OD(r){const t=HD(r),e=w.forwardRef((s,n)=>{const{children:i,...o}=s,l=w.Children.toArray(i),d=l.find($D);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}function HD(r){const t=w.forwardRef((e,s)=>{const{children:n,...i}=e;if(w.isValidElement(n)){const o=UD(n),l=BD(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var qD=Symbol("radix.slottable");function $D(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===qD}function BD(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function UD(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var FD=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],De=FD.reduce((r,t)=>{const e=OD(`Primitive.${t}`),s=w.forwardRef((n,i)=>{const{asChild:o,...l}=n,d=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:i})});return s.displayName=`Primitive.${t}`,{...r,[t]:s}},{});function Nb(r,t){r&&qr.flushSync(()=>r.dispatchEvent(t))}var os=globalThis?.document?w.useLayoutEffect:()=>{};function VD(r,t){return w.useReducer((e,s)=>t[e][s]??e,r)}var cs=r=>{const{present:t,children:e}=r,s=QD(t),n=typeof e=="function"?e({present:s.isPresent}):w.Children.only(e),i=je(s.ref,GD(n));return typeof e=="function"||s.isPresent?w.cloneElement(n,{ref:i}):null};cs.displayName="Presence";function QD(r){const[t,e]=w.useState(),s=w.useRef(null),n=w.useRef(r),i=w.useRef("none"),o=r?"mounted":"unmounted",[l,d]=VD(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return w.useEffect(()=>{const h=gl(s.current);i.current=l==="mounted"?h:"none"},[l]),os(()=>{const h=s.current,f=n.current;if(f!==r){const y=i.current,b=gl(h);r?d("MOUNT"):b==="none"||h?.display==="none"?d("UNMOUNT"):d(f&&y!==b?"ANIMATION_OUT":"UNMOUNT"),n.current=r}},[r,d]),os(()=>{if(t){let h;const f=t.ownerDocument.defaultView??window,m=b=>{const S=gl(s.current).includes(CSS.escape(b.animationName));if(b.target===t&&S&&(d("ANIMATION_END"),!n.current)){const R=t.style.animationFillMode;t.style.animationFillMode="forwards",h=f.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=R)})}},y=b=>{b.target===t&&(i.current=gl(s.current))};return t.addEventListener("animationstart",y),t.addEventListener("animationcancel",m),t.addEventListener("animationend",m),()=>{f.clearTimeout(h),t.removeEventListener("animationstart",y),t.removeEventListener("animationcancel",m),t.removeEventListener("animationend",m)}}else d("ANIMATION_END")},[t,d]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:w.useCallback(h=>{s.current=h?getComputedStyle(h):null,e(h)},[])}}function gl(r){return r?.animationName||"none"}function GD(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function KD(r,t){const e=w.createContext(t),s=i=>{const{children:o,...l}=i,d=w.useMemo(()=>l,Object.values(l));return g.jsx(e.Provider,{value:d,children:o})};s.displayName=r+"Provider";function n(i){const o=w.useContext(e);if(o)return o;if(t!==void 0)return t;throw new Error(`\`${i}\` must be used within \`${r}\``)}return[s,n]}function ws(r,t=[]){let e=[];function s(i,o){const l=w.createContext(o),d=e.length;e=[...e,o];const h=m=>{const{scope:y,children:b,...C}=m,S=y?.[r]?.[d]||l,R=w.useMemo(()=>C,Object.values(C));return g.jsx(S.Provider,{value:R,children:b})};h.displayName=i+"Provider";function f(m,y){const b=y?.[r]?.[d]||l,C=w.useContext(b);if(C)return C;if(o!==void 0)return o;throw new Error(`\`${m}\` must be used within \`${i}\``)}return[h,f]}const n=()=>{const i=e.map(o=>w.createContext(o));return function(l){const d=l?.[r]||i;return w.useMemo(()=>({[`__scope${r}`]:{...l,[r]:d}}),[l,d])}};return n.scopeName=r,[s,YD(n,...t)]}function YD(...r){const t=r[0];if(r.length===1)return t;const e=()=>{const s=r.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=s.reduce((l,{useScope:d,scopeName:h})=>{const m=d(i)[`__scope${h}`];return{...l,...m}},{});return w.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return e.scopeName=t.scopeName,e}function as(r){const t=w.useRef(r);return w.useEffect(()=>{t.current=r}),w.useMemo(()=>(...e)=>t.current?.(...e),[])}var WD=w.createContext(void 0);function ko(r){const t=w.useContext(WD);return r||t||"ltr"}function jr(r,[t,e]){return Math.min(e,Math.max(t,r))}function ge(r,t,{checkForDefaultPrevented:e=!0}={}){return function(n){if(r?.(n),e===!1||!n.defaultPrevented)return t?.(n)}}function XD(r,t){return w.useReducer((e,s)=>t[e][s]??e,r)}var Jf="ScrollArea",[jb]=ws(Jf),[JD,Ys]=jb(Jf),Pb=w.forwardRef((r,t)=>{const{__scopeScrollArea:e,type:s="hover",dir:n,scrollHideDelay:i=600,...o}=r,[l,d]=w.useState(null),[h,f]=w.useState(null),[m,y]=w.useState(null),[b,C]=w.useState(null),[S,R]=w.useState(null),[M,T]=w.useState(0),[E,A]=w.useState(0),[_,N]=w.useState(!1),[z,q]=w.useState(!1),Z=je(t,ce=>d(ce)),ne=ko(n);return g.jsx(JD,{scope:e,type:s,dir:ne,scrollHideDelay:i,scrollArea:l,viewport:h,onViewportChange:f,content:m,onContentChange:y,scrollbarX:b,onScrollbarXChange:C,scrollbarXEnabled:_,onScrollbarXEnabledChange:N,scrollbarY:S,onScrollbarYChange:R,scrollbarYEnabled:z,onScrollbarYEnabledChange:q,onCornerWidthChange:T,onCornerHeightChange:A,children:g.jsx(De.div,{dir:ne,...o,ref:Z,style:{position:"relative","--radix-scroll-area-corner-width":M+"px","--radix-scroll-area-corner-height":E+"px",...r.style}})})});Pb.displayName=Jf;var Lb="ScrollAreaViewport",zb=w.forwardRef((r,t)=>{const{__scopeScrollArea:e,children:s,nonce:n,...i}=r,o=Ys(Lb,e),l=w.useRef(null),d=je(t,l,o.onViewportChange);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),g.jsx(De.div,{"data-radix-scroll-area-viewport":"",...i,ref:d,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...r.style},children:g.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});zb.displayName=Lb;var An="ScrollAreaScrollbar",Zf=w.forwardRef((r,t)=>{const{forceMount:e,...s}=r,n=Ys(An,r.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=n,l=r.orientation==="horizontal";return w.useEffect(()=>(l?i(!0):o(!0),()=>{l?i(!1):o(!1)}),[l,i,o]),n.type==="hover"?g.jsx(ZD,{...s,ref:t,forceMount:e}):n.type==="scroll"?g.jsx(e2,{...s,ref:t,forceMount:e}):n.type==="auto"?g.jsx(Ib,{...s,ref:t,forceMount:e}):n.type==="always"?g.jsx(ep,{...s,ref:t}):null});Zf.displayName=An;var ZD=w.forwardRef((r,t)=>{const{forceMount:e,...s}=r,n=Ys(An,r.__scopeScrollArea),[i,o]=w.useState(!1);return w.useEffect(()=>{const l=n.scrollArea;let d=0;if(l){const h=()=>{window.clearTimeout(d),o(!0)},f=()=>{d=window.setTimeout(()=>o(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",h),l.addEventListener("pointerleave",f),()=>{window.clearTimeout(d),l.removeEventListener("pointerenter",h),l.removeEventListener("pointerleave",f)}}},[n.scrollArea,n.scrollHideDelay]),g.jsx(cs,{present:e||i,children:g.jsx(Ib,{"data-state":i?"visible":"hidden",...s,ref:t})})}),e2=w.forwardRef((r,t)=>{const{forceMount:e,...s}=r,n=Ys(An,r.__scopeScrollArea),i=r.orientation==="horizontal",o=tu(()=>d("SCROLL_END"),100),[l,d]=XD("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return w.useEffect(()=>{if(l==="idle"){const h=window.setTimeout(()=>d("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(h)}},[l,n.scrollHideDelay,d]),w.useEffect(()=>{const h=n.viewport,f=i?"scrollLeft":"scrollTop";if(h){let m=h[f];const y=()=>{const b=h[f];m!==b&&(d("SCROLL"),o()),m=b};return h.addEventListener("scroll",y),()=>h.removeEventListener("scroll",y)}},[n.viewport,i,d,o]),g.jsx(cs,{present:e||l!=="hidden",children:g.jsx(ep,{"data-state":l==="hidden"?"hidden":"visible",...s,ref:t,onPointerEnter:ge(r.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:ge(r.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),Ib=w.forwardRef((r,t)=>{const e=Ys(An,r.__scopeScrollArea),{forceMount:s,...n}=r,[i,o]=w.useState(!1),l=r.orientation==="horizontal",d=tu(()=>{if(e.viewport){const h=e.viewport.offsetWidth<e.viewport.scrollWidth,f=e.viewport.offsetHeight<e.viewport.scrollHeight;o(l?h:f)}},10);return xo(e.viewport,d),xo(e.content,d),g.jsx(cs,{present:s||i,children:g.jsx(ep,{"data-state":i?"visible":"hidden",...n,ref:t})})}),ep=w.forwardRef((r,t)=>{const{orientation:e="vertical",...s}=r,n=Ys(An,r.__scopeScrollArea),i=w.useRef(null),o=w.useRef(0),[l,d]=w.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),h=Bb(l.viewport,l.content),f={...s,sizes:l,onSizesChange:d,hasThumb:h>0&&h<1,onThumbChange:y=>i.current=y,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:y=>o.current=y};function m(y,b){return o2(y,o.current,l,b)}return e==="horizontal"?g.jsx(t2,{...f,ref:t,onThumbPositionChange:()=>{if(n.viewport&&i.current){const y=n.viewport.scrollLeft,b=cv(y,l,n.dir);i.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:y=>{n.viewport&&(n.viewport.scrollLeft=y)},onDragScroll:y=>{n.viewport&&(n.viewport.scrollLeft=m(y,n.dir))}}):e==="vertical"?g.jsx(s2,{...f,ref:t,onThumbPositionChange:()=>{if(n.viewport&&i.current){const y=n.viewport.scrollTop,b=cv(y,l);i.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:y=>{n.viewport&&(n.viewport.scrollTop=y)},onDragScroll:y=>{n.viewport&&(n.viewport.scrollTop=m(y))}}):null}),t2=w.forwardRef((r,t)=>{const{sizes:e,onSizesChange:s,...n}=r,i=Ys(An,r.__scopeScrollArea),[o,l]=w.useState(),d=w.useRef(null),h=je(t,d,i.onScrollbarXChange);return w.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),g.jsx(Hb,{"data-orientation":"horizontal",...n,ref:h,sizes:e,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":eu(e)+"px",...r.style},onThumbPointerDown:f=>r.onThumbPointerDown(f.x),onDragScroll:f=>r.onDragScroll(f.x),onWheelScroll:(f,m)=>{if(i.viewport){const y=i.viewport.scrollLeft+f.deltaX;r.onWheelScroll(y),Fb(y,m)&&f.preventDefault()}},onResize:()=>{d.current&&i.viewport&&o&&s({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:$l(o.paddingLeft),paddingEnd:$l(o.paddingRight)}})}})}),s2=w.forwardRef((r,t)=>{const{sizes:e,onSizesChange:s,...n}=r,i=Ys(An,r.__scopeScrollArea),[o,l]=w.useState(),d=w.useRef(null),h=je(t,d,i.onScrollbarYChange);return w.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),g.jsx(Hb,{"data-orientation":"vertical",...n,ref:h,sizes:e,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":eu(e)+"px",...r.style},onThumbPointerDown:f=>r.onThumbPointerDown(f.y),onDragScroll:f=>r.onDragScroll(f.y),onWheelScroll:(f,m)=>{if(i.viewport){const y=i.viewport.scrollTop+f.deltaY;r.onWheelScroll(y),Fb(y,m)&&f.preventDefault()}},onResize:()=>{d.current&&i.viewport&&o&&s({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:$l(o.paddingTop),paddingEnd:$l(o.paddingBottom)}})}})}),[n2,Ob]=jb(An),Hb=w.forwardRef((r,t)=>{const{__scopeScrollArea:e,sizes:s,hasThumb:n,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:l,onThumbPositionChange:d,onDragScroll:h,onWheelScroll:f,onResize:m,...y}=r,b=Ys(An,e),[C,S]=w.useState(null),R=je(t,Z=>S(Z)),M=w.useRef(null),T=w.useRef(""),E=b.viewport,A=s.content-s.viewport,_=as(f),N=as(d),z=tu(m,10);function q(Z){if(M.current){const ne=Z.clientX-M.current.left,ce=Z.clientY-M.current.top;h({x:ne,y:ce})}}return w.useEffect(()=>{const Z=ne=>{const ce=ne.target;C?.contains(ce)&&_(ne,A)};return document.addEventListener("wheel",Z,{passive:!1}),()=>document.removeEventListener("wheel",Z,{passive:!1})},[E,C,A,_]),w.useEffect(N,[s,N]),xo(C,z),xo(b.content,z),g.jsx(n2,{scope:e,scrollbar:C,hasThumb:n,onThumbChange:as(i),onThumbPointerUp:as(o),onThumbPositionChange:N,onThumbPointerDown:as(l),children:g.jsx(De.div,{...y,ref:R,style:{position:"absolute",...y.style},onPointerDown:ge(r.onPointerDown,Z=>{Z.button===0&&(Z.target.setPointerCapture(Z.pointerId),M.current=C.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),q(Z))}),onPointerMove:ge(r.onPointerMove,q),onPointerUp:ge(r.onPointerUp,Z=>{const ne=Z.target;ne.hasPointerCapture(Z.pointerId)&&ne.releasePointerCapture(Z.pointerId),document.body.style.webkitUserSelect=T.current,b.viewport&&(b.viewport.style.scrollBehavior=""),M.current=null})})})}),ql="ScrollAreaThumb",qb=w.forwardRef((r,t)=>{const{forceMount:e,...s}=r,n=Ob(ql,r.__scopeScrollArea);return g.jsx(cs,{present:e||n.hasThumb,children:g.jsx(i2,{ref:t,...s})})}),i2=w.forwardRef((r,t)=>{const{__scopeScrollArea:e,style:s,...n}=r,i=Ys(ql,e),o=Ob(ql,e),{onThumbPositionChange:l}=o,d=je(t,m=>o.onThumbChange(m)),h=w.useRef(void 0),f=tu(()=>{h.current&&(h.current(),h.current=void 0)},100);return w.useEffect(()=>{const m=i.viewport;if(m){const y=()=>{if(f(),!h.current){const b=r2(m,l);h.current=b,l()}};return l(),m.addEventListener("scroll",y),()=>m.removeEventListener("scroll",y)}},[i.viewport,f,l]),g.jsx(De.div,{"data-state":o.hasThumb?"visible":"hidden",...n,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:ge(r.onPointerDownCapture,m=>{const b=m.target.getBoundingClientRect(),C=m.clientX-b.left,S=m.clientY-b.top;o.onThumbPointerDown({x:C,y:S})}),onPointerUp:ge(r.onPointerUp,o.onThumbPointerUp)})});qb.displayName=ql;var tp="ScrollAreaCorner",$b=w.forwardRef((r,t)=>{const e=Ys(tp,r.__scopeScrollArea),s=!!(e.scrollbarX&&e.scrollbarY);return e.type!=="scroll"&&s?g.jsx(a2,{...r,ref:t}):null});$b.displayName=tp;var a2=w.forwardRef((r,t)=>{const{__scopeScrollArea:e,...s}=r,n=Ys(tp,e),[i,o]=w.useState(0),[l,d]=w.useState(0),h=!!(i&&l);return xo(n.scrollbarX,()=>{const f=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(f),d(f)}),xo(n.scrollbarY,()=>{const f=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(f),o(f)}),h?g.jsx(De.div,{...s,ref:t,style:{width:i,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function $l(r){return r?parseInt(r,10):0}function Bb(r,t){const e=r/t;return isNaN(e)?0:e}function eu(r){const t=Bb(r.viewport,r.content),e=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,s=(r.scrollbar.size-e)*t;return Math.max(s,18)}function o2(r,t,e,s="ltr"){const n=eu(e),i=n/2,o=t||i,l=n-o,d=e.scrollbar.paddingStart+o,h=e.scrollbar.size-e.scrollbar.paddingEnd-l,f=e.content-e.viewport,m=s==="ltr"?[0,f]:[f*-1,0];return Ub([d,h],m)(r)}function cv(r,t,e="ltr"){const s=eu(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=t.scrollbar.size-n,o=t.content-t.viewport,l=i-s,d=e==="ltr"?[0,o]:[o*-1,0],h=jr(r,d);return Ub([0,o],[0,l])(h)}function Ub(r,t){return e=>{if(r[0]===r[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(r[1]-r[0]);return t[0]+s*(e-r[0])}}function Fb(r,t){return r>0&&r<t}var r2=(r,t=()=>{})=>{let e={left:r.scrollLeft,top:r.scrollTop},s=0;return(function n(){const i={left:r.scrollLeft,top:r.scrollTop},o=e.left!==i.left,l=e.top!==i.top;(o||l)&&t(),e=i,s=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(s)};function tu(r,t){const e=as(r),s=w.useRef(0);return w.useEffect(()=>()=>window.clearTimeout(s.current),[]),w.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(e,t)},[e,t])}function xo(r,t){const e=as(t);os(()=>{let s=0;if(r){const n=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(e)});return n.observe(r),()=>{window.cancelAnimationFrame(s),n.unobserve(r)}}},[r,e])}var Vb=Pb,c2=zb,l2=$b;const is=w.forwardRef(({className:r,children:t,...e},s)=>g.jsxs(Vb,{ref:s,className:ke("relative overflow-hidden",r),scrollHideDelay:0,...e,children:[g.jsx(c2,{className:"h-full w-full rounded-[inherit]",children:t}),g.jsx(su,{}),g.jsx(l2,{})]}));is.displayName=Vb.displayName;const su=w.forwardRef(({className:r,orientation:t="vertical",...e},s)=>g.jsx(Zf,{ref:s,orientation:t,className:ke("flex touch-none select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]","data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30","[&[data-state=hidden]]:opacity-0 [&[data-state=visible]]:opacity-100",r),style:{transition:"none !important",transitionDelay:"0ms !important",transitionDuration:"0ms !important"},...e,children:g.jsx(qb,{className:"relative flex-1 rounded-full bg-accent/80 hover:bg-accent",style:{transition:"none !important"}})}));su.displayName=Zf.displayName;const Br=un(r=>({showMinimap:!0,setShowMinimap:t=>r({showMinimap:t}),toggleMinimap:()=>r(t=>({showMinimap:!t.showMinimap})),showHeatMapLegend:!0,setShowHeatMapLegend:t=>r({showHeatMapLegend:t}),toggleHeatMapLegend:()=>r(t=>({showHeatMapLegend:!t.showHeatMapLegend})),showRuler:!1,setShowRuler:t=>r({showRuler:t}),toggleRuler:()=>r(t=>({showRuler:!t.showRuler})),autoCenterOnSelect:!0,setAutoCenterOnSelect:t=>r({autoCenterOnSelect:t}),searchQuery:"",setSearchQuery:t=>r({searchQuery:t}),highlightedNodeId:null,setHighlightedNodeId:t=>r({highlightedNodeId:t})})),Pr=[{id:"kafka",type:"kafka",label:"Apache Kafka",icon:"",color:"#000000",category:"messaging"},{id:"rabbitmq",type:"rabbitmq",label:"RabbitMQ",icon:"",color:"#FF6600",category:"messaging"},{id:"activemq",type:"activemq",label:"ActiveMQ",icon:"",color:"#A1005A",category:"messaging"},{id:"aws-sqs",type:"aws-sqs",label:"AWS SQS",icon:"",color:"#FF9900",category:"messaging"},{id:"azure-service-bus",type:"azure-service-bus",label:"Azure Service Bus",icon:"",color:"#0078D7",category:"messaging"},{id:"gcp-pubsub",type:"gcp-pubsub",label:"Google Pub/Sub",icon:"",color:"#4285F4",category:"messaging"},{id:"kong",type:"kong",label:"Kong Gateway",icon:"",color:"#003459",category:"integration"},{id:"apigee",type:"apigee",label:"Apigee",icon:"",color:"#F26522",category:"integration"},{id:"mulesoft",type:"mulesoft",label:"MuleSoft",icon:"",color:"#00A0DF",category:"integration"},{id:"graphql-gateway",type:"graphql-gateway",label:"GraphQL Gateway",icon:"",color:"#E10098",category:"integration"},{id:"bff-service",type:"bff-service",label:"BFF Service",icon:"",color:"#6C5CE7",category:"integration"},{id:"webhook-relay",type:"webhook-relay",label:"Webhook Relay",icon:"",color:"#1ABC9C",category:"integration"},{id:"postgres",type:"postgres",label:"PostgreSQL",icon:"",color:"#336791",category:"data"},{id:"mongodb",type:"mongodb",label:"MongoDB",icon:"",color:"#47A248",category:"data"},{id:"redis",type:"redis",label:"Redis",icon:"",color:"#DC382D",category:"data"},{id:"cassandra",type:"cassandra",label:"Apache Cassandra",icon:"",color:"#1287B1",category:"data"},{id:"clickhouse",type:"clickhouse",label:"ClickHouse",icon:"",color:"#FFCC00",category:"data"},{id:"snowflake",type:"snowflake",label:"Snowflake",icon:"",color:"#29B5E8",category:"data"},{id:"elasticsearch",type:"elasticsearch",label:"Elasticsearch",icon:"",color:"#00A79D",category:"data"},{id:"s3-datalake",type:"s3-datalake",label:"S3 Data Lake",icon:"",color:"#FF9900",category:"data"},{id:"prometheus",type:"prometheus",label:"Prometheus",icon:"",color:"#E6522C",category:"observability"},{id:"grafana",type:"grafana",label:"Grafana",icon:"",color:"#F56815",category:"observability"},{id:"loki",type:"loki",label:"Loki",icon:"",color:"#7CBA3C",category:"observability"},{id:"jaeger",type:"jaeger",label:"Jaeger",icon:"",color:"#65D6AD",category:"observability"},{id:"otel-collector",type:"otel-collector",label:"OpenTelemetry Collector",icon:"",color:"#6E56CF",category:"observability"},{id:"pagerduty",type:"pagerduty",label:"PagerDuty",icon:"",color:"#06AC38",category:"observability"},{id:"keycloak",type:"keycloak",label:"Keycloak",icon:"",color:"#5C6BC0",category:"security"},{id:"waf",type:"waf",label:"WAF / API Shield",icon:"",color:"#F44336",category:"security"},{id:"firewall",type:"firewall",label:"Firewall",icon:"",color:"#FF7043",category:"security"},{id:"secrets-vault",type:"secrets-vault",label:"Secrets Vault",icon:"",color:"#009688",category:"security"},{id:"ids-ips",type:"ids-ips",label:"IDS / IPS",icon:"",color:"#512DA8",category:"security"},{id:"jenkins",type:"jenkins",label:"Jenkins",icon:"",color:"#D24939",category:"devops"},{id:"gitlab-ci",type:"gitlab-ci",label:"GitLab CI",icon:"",color:"#FC6D26",category:"devops"},{id:"argo-cd",type:"argo-cd",label:"Argo CD",icon:"",color:"#EF7B45",category:"devops"},{id:"terraform",type:"terraform",label:"Terraform",icon:"",color:"#7B42BC",category:"devops"},{id:"ansible",type:"ansible",label:"Ansible",icon:"",color:"#000000",category:"devops"},{id:"harbor",type:"harbor",label:"Harbor Registry",icon:"",color:"#3BC1C4",category:"devops"},{id:"nginx",type:"nginx",label:"NGINX",icon:"",color:"#009639",category:"infrastructure"},{id:"docker",type:"docker",label:"Docker",icon:"",color:"#2496ED",category:"infrastructure"},{id:"kubernetes",type:"kubernetes",label:"Kubernetes",icon:"",color:"#326CE5",category:"infrastructure"},{id:"haproxy",type:"haproxy",label:"HAProxy",icon:"",color:"#009FDF",category:"infrastructure"},{id:"envoy",type:"envoy",label:"Envoy Proxy",icon:"",color:"#D63384",category:"infrastructure"},{id:"traefik",type:"traefik",label:"Traefik",icon:"",color:"#24A1DE",category:"infrastructure"},{id:"istio",type:"istio",label:"Istio Mesh",icon:"",color:"#466BB0",category:"edge"},{id:"service-mesh",type:"service-mesh",label:"Service Mesh",icon:"",color:"#5E81AC",category:"edge"},{id:"api-gateway",type:"api-gateway",label:"Cloud API Gateway",icon:"",color:"#FFB300",category:"edge"},{id:"vpn",type:"vpn",label:"VPN Concentrator",icon:"",color:"#2D9CDB",category:"edge"},{id:"cdn",type:"cdn",label:"CDN Edge",icon:"",color:"#FF5A5F",category:"edge"},{id:"rest",type:"rest",label:"REST API",icon:"",color:"#61DAFB",category:"api"},{id:"grpc",type:"grpc",label:"gRPC",icon:"",color:"#244C5A",category:"api"},{id:"graphql",type:"graphql",label:"GraphQL",icon:"",color:"#DE33A6",category:"api"},{id:"soap",type:"soap",label:"SOAP",icon:"",color:"#2196F3",category:"api"},{id:"websocket",type:"websocket",label:"WebSocket",icon:"",color:"#010101",category:"api"},{id:"webhook",type:"webhook",label:"Webhook Endpoint",icon:"",color:"#0FA3B1",category:"api"},{id:"spark",type:"spark",label:"Apache Spark",icon:"",color:"#E25A1C",category:"ml"},{id:"tensorflow-serving",type:"tensorflow-serving",label:"TensorFlow Serving",icon:"",color:"#FF6F00",category:"ml"},{id:"pytorch-serve",type:"pytorch-serve",label:"PyTorch Serve",icon:"",color:"#EE4C2C",category:"ml"},{id:"mlflow",type:"mlflow",label:"MLflow",icon:"",color:"#4285F4",category:"ml"},{id:"feature-store",type:"feature-store",label:"Feature Store",icon:"",color:"#8E44AD",category:"ml"},{id:"crm",type:"crm",label:"CRM System",icon:"",color:"#F39C12",category:"business"},{id:"erp",type:"erp",label:"ERP / SAP",icon:"",color:"#1B75BC",category:"business"},{id:"payment-gateway",type:"payment-gateway",label:"Payment Gateway",icon:"",color:"#4CAF50",category:"business"},{id:"bpmn-engine",type:"bpmn-engine",label:"BPMN Engine",icon:"",color:"#34495E",category:"business"},{id:"rpa-bot",type:"rpa-bot",label:"RPA Bot",icon:"",color:"#9B59B6",category:"business"}],Mr=[{id:"messaging",label:"Messaging & Event Bus",icon:""},{id:"integration",label:"Integration & API",icon:""},{id:"data",label:"Data & Storage",icon:""},{id:"observability",label:"Observability",icon:""},{id:"security",label:"Security & IAM",icon:""},{id:"devops",label:"DevOps & Platform",icon:""},{id:"infrastructure",label:"Runtime & Infra",icon:""},{id:"edge",label:"Edge & Networking",icon:""},{id:"api",label:"Protocols & APIs",icon:""},{id:"ml",label:"ML & Analytics",icon:""},{id:"business",label:"Business Systems",icon:""}];function u2(){const{nodes:r,selectNode:t,zoom:e,pan:s,setPan:n,setZoom:i}=Re(),{searchQuery:o,setSearchQuery:l,highlightedNodeId:d,setHighlightedNodeId:h}=Br(),[f,m]=w.useState(!1),y=w.useRef(null);w.useEffect(()=>{const S=R=>{y.current&&!y.current.contains(R.target)&&m(!1)};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[]);const b=w.useMemo(()=>{if(!o.trim())return[];const S=o.toLowerCase();return r.filter(R=>{const M=Pr.find(_=>_.type===R.type),T=R.data?.label||"",E=R.type||"",A=M?.category||"";return T.toLowerCase().includes(S)||E.toLowerCase().includes(S)||A.toLowerCase().includes(S)})},[r,o]),C=S=>{t(S),h(S);const R=r.find(M=>M.id===S);if(R&&f){const M=window.innerWidth/2,T=window.innerHeight/2,E=R.position.x+70,A=R.position.y+70,_=M-E*e,N=T-A*e;n({x:_,y:N}),e<.8&&i(1)}setTimeout(()=>h(null),2e3)};return g.jsxs("div",{className:"relative",ref:y,children:[g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),g.jsx(Tt,{type:"text",placeholder:"Search components...",value:o,onChange:S=>{l(S.target.value),m(!0)},onFocus:()=>m(!0),className:"pl-8 pr-8 w-64"}),o&&g.jsx(Ee,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>{l(""),m(!1),h(null)},children:g.jsx(on,{className:"h-3 w-3"})})]}),f&&o&&g.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-card border border-border rounded-md shadow-lg z-50 max-h-80 overflow-hidden",children:b.length>0?g.jsx(is,{className:"max-h-80",children:g.jsx("div",{className:"p-1",children:b.map(S=>{const R=Pr.find(T=>T.type===S.type),M=d===S.id;return g.jsxs("button",{onClick:()=>C(S.id),className:ke("w-full text-left px-3 py-2 rounded-sm hover:bg-accent transition-colors flex items-center justify-between",M&&"bg-accent"),children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:S.data?.label||S.type}),g.jsxs("div",{className:"text-xs text-muted-foreground truncate",children:[R?.category||"Unknown","  ",S.type]})]}),g.jsx(Wf,{className:"h-4 w-4 text-muted-foreground flex-shrink-0 ml-2"})]},S.id)})})}):g.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No components found"})})]})}function d2(r){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",t.appendChild(e),e.styleSheet?e.styleSheet.cssText=r:e.appendChild(document.createTextNode(r))}Array(12).fill(0);let wf=1;class h2{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;const{message:s,...n}=t,i=typeof t?.id=="number"||((e=t.id)==null?void 0:e.length)>0?t.id:wf++,o=this.toasts.find(d=>d.id===i),l=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(d=>d.id===i?(this.publish({...d,...t,id:i,title:s}),{...d,...t,id:i,dismissible:l,title:s}):d):this.addToast({title:s,...n,dismissible:l,id:i}),i},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(e=>e({id:t,dismiss:!0})))):this.toasts.forEach(e=>{this.subscribers.forEach(s=>s({id:e.id,dismiss:!0}))}),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let s;e.loading!==void 0&&(s=this.create({...e,promise:t,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));const n=Promise.resolve(t instanceof Function?t():t);let i=s!==void 0,o;const l=n.then(async h=>{if(o=["resolve",h],Et.isValidElement(h))i=!1,this.create({id:s,type:"default",message:h});else if(p2(h)&&!h.ok){i=!1;const m=typeof e.error=="function"?await e.error(`HTTP error! status: ${h.status}`):e.error,y=typeof e.description=="function"?await e.description(`HTTP error! status: ${h.status}`):e.description,C=typeof m=="object"&&!Et.isValidElement(m)?m:{message:m};this.create({id:s,type:"error",description:y,...C})}else if(h instanceof Error){i=!1;const m=typeof e.error=="function"?await e.error(h):e.error,y=typeof e.description=="function"?await e.description(h):e.description,C=typeof m=="object"&&!Et.isValidElement(m)?m:{message:m};this.create({id:s,type:"error",description:y,...C})}else if(e.success!==void 0){i=!1;const m=typeof e.success=="function"?await e.success(h):e.success,y=typeof e.description=="function"?await e.description(h):e.description,C=typeof m=="object"&&!Et.isValidElement(m)?m:{message:m};this.create({id:s,type:"success",description:y,...C})}}).catch(async h=>{if(o=["reject",h],e.error!==void 0){i=!1;const f=typeof e.error=="function"?await e.error(h):e.error,m=typeof e.description=="function"?await e.description(h):e.description,b=typeof f=="object"&&!Et.isValidElement(f)?f:{message:f};this.create({id:s,type:"error",description:m,...b})}}).finally(()=>{i&&(this.dismiss(s),s=void 0),e.finally==null||e.finally.call(e)}),d=()=>new Promise((h,f)=>l.then(()=>o[0]==="reject"?f(o[1]):h(o[1])).catch(f));return typeof s!="string"&&typeof s!="number"?{unwrap:d}:Object.assign(s,{unwrap:d})},this.custom=(t,e)=>{const s=e?.id||wf++;return this.create({jsx:t(s),id:s,...e}),s},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Qs=new h2,f2=(r,t)=>{const e=t?.id||wf++;return Qs.addToast({title:r,...t,id:e}),e},p2=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",g2=f2,m2=()=>Qs.toasts,y2=()=>Qs.getActiveToasts(),Ye=Object.assign(g2,{success:Qs.success,info:Qs.info,warning:Qs.warning,error:Qs.error,custom:Qs.custom,message:Qs.message,promise:Qs.promise,dismiss:Qs.dismiss,loading:Qs.loading},{getHistory:m2,getToasts:y2});d2("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");var v2=$f[" useId ".trim().toString()]||(()=>{}),b2=0;function rn(r){const[t,e]=w.useState(v2());return os(()=>{e(s=>s??String(b2++))},[r]),t?`radix-${t}`:""}var x2=$f[" useInsertionEffect ".trim().toString()]||os;function kn({prop:r,defaultProp:t,onChange:e=()=>{},caller:s}){const[n,i,o]=w2({defaultProp:t,onChange:e}),l=r!==void 0,d=l?r:n;{const f=w.useRef(r!==void 0);w.useEffect(()=>{const m=f.current;m!==l&&console.warn(`${s} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=l},[l,s])}const h=w.useCallback(f=>{if(l){const m=C2(f)?f(r):f;m!==r&&o.current?.(m)}else i(f)},[l,r,i,o]);return[d,h]}function w2({defaultProp:r,onChange:t}){const[e,s]=w.useState(r),n=w.useRef(e),i=w.useRef(t);return x2(()=>{i.current=t},[t]),w.useEffect(()=>{n.current!==e&&(i.current?.(e),n.current=e)},[e,n]),[e,s,i]}function C2(r){return typeof r=="function"}function S2(r,t=globalThis?.document){const e=as(r);w.useEffect(()=>{const s=n=>{n.key==="Escape"&&e(n)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[e,t])}var M2="DismissableLayer",Cf="dismissableLayer.update",R2="dismissableLayer.pointerDownOutside",k2="dismissableLayer.focusOutside",lv,Qb=w.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ur=w.forwardRef((r,t)=>{const{disableOutsidePointerEvents:e=!1,onEscapeKeyDown:s,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...d}=r,h=w.useContext(Qb),[f,m]=w.useState(null),y=f?.ownerDocument??globalThis?.document,[,b]=w.useState({}),C=je(t,z=>m(z)),S=Array.from(h.layers),[R]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),M=S.indexOf(R),T=f?S.indexOf(f):-1,E=h.layersWithOutsidePointerEventsDisabled.size>0,A=T>=M,_=A2(z=>{const q=z.target,Z=[...h.branches].some(ne=>ne.contains(q));!A||Z||(n?.(z),o?.(z),z.defaultPrevented||l?.())},y),N=D2(z=>{const q=z.target;[...h.branches].some(ne=>ne.contains(q))||(i?.(z),o?.(z),z.defaultPrevented||l?.())},y);return S2(z=>{T===h.layers.size-1&&(s?.(z),!z.defaultPrevented&&l&&(z.preventDefault(),l()))},y),w.useEffect(()=>{if(f)return e&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(lv=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(f)),h.layers.add(f),uv(),()=>{e&&h.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=lv)}},[f,y,e,h]),w.useEffect(()=>()=>{f&&(h.layers.delete(f),h.layersWithOutsidePointerEventsDisabled.delete(f),uv())},[f,h]),w.useEffect(()=>{const z=()=>b({});return document.addEventListener(Cf,z),()=>document.removeEventListener(Cf,z)},[]),g.jsx(De.div,{...d,ref:C,style:{pointerEvents:E?A?"auto":"none":void 0,...r.style},onFocusCapture:ge(r.onFocusCapture,N.onFocusCapture),onBlurCapture:ge(r.onBlurCapture,N.onBlurCapture),onPointerDownCapture:ge(r.onPointerDownCapture,_.onPointerDownCapture)})});Ur.displayName=M2;var E2="DismissableLayerBranch",T2=w.forwardRef((r,t)=>{const e=w.useContext(Qb),s=w.useRef(null),n=je(t,s);return w.useEffect(()=>{const i=s.current;if(i)return e.branches.add(i),()=>{e.branches.delete(i)}},[e.branches]),g.jsx(De.div,{...r,ref:n})});T2.displayName=E2;function A2(r,t=globalThis?.document){const e=as(r),s=w.useRef(!1),n=w.useRef(()=>{});return w.useEffect(()=>{const i=l=>{if(l.target&&!s.current){let d=function(){Gb(R2,e,h,{discrete:!0})};const h={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",n.current),n.current=d,t.addEventListener("click",n.current,{once:!0})):d()}else t.removeEventListener("click",n.current);s.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",i),t.removeEventListener("click",n.current)}},[t,e]),{onPointerDownCapture:()=>s.current=!0}}function D2(r,t=globalThis?.document){const e=as(r),s=w.useRef(!1);return w.useEffect(()=>{const n=i=>{i.target&&!s.current&&Gb(k2,e,{originalEvent:i},{discrete:!1})};return t.addEventListener("focusin",n),()=>t.removeEventListener("focusin",n)},[t,e]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function uv(){const r=new CustomEvent(Cf);document.dispatchEvent(r)}function Gb(r,t,e,{discrete:s}){const n=e.originalEvent.target,i=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:e});t&&n.addEventListener(r,t,{once:!0}),s?Nb(n,i):n.dispatchEvent(i)}var af="focusScope.autoFocusOnMount",of="focusScope.autoFocusOnUnmount",dv={bubbles:!1,cancelable:!0},_2="FocusScope",Fr=w.forwardRef((r,t)=>{const{loop:e=!1,trapped:s=!1,onMountAutoFocus:n,onUnmountAutoFocus:i,...o}=r,[l,d]=w.useState(null),h=as(n),f=as(i),m=w.useRef(null),y=je(t,S=>d(S)),b=w.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;w.useEffect(()=>{if(s){let S=function(E){if(b.paused||!l)return;const A=E.target;l.contains(A)?m.current=A:ji(m.current,{select:!0})},R=function(E){if(b.paused||!l)return;const A=E.relatedTarget;A!==null&&(l.contains(A)||ji(m.current,{select:!0}))},M=function(E){if(document.activeElement===document.body)for(const _ of E)_.removedNodes.length>0&&ji(l)};document.addEventListener("focusin",S),document.addEventListener("focusout",R);const T=new MutationObserver(M);return l&&T.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",S),document.removeEventListener("focusout",R),T.disconnect()}}},[s,l,b.paused]),w.useEffect(()=>{if(l){fv.add(b);const S=document.activeElement;if(!l.contains(S)){const M=new CustomEvent(af,dv);l.addEventListener(af,h),l.dispatchEvent(M),M.defaultPrevented||(N2(I2(Kb(l)),{select:!0}),document.activeElement===S&&ji(l))}return()=>{l.removeEventListener(af,h),setTimeout(()=>{const M=new CustomEvent(of,dv);l.addEventListener(of,f),l.dispatchEvent(M),M.defaultPrevented||ji(S??document.body,{select:!0}),l.removeEventListener(of,f),fv.remove(b)},0)}}},[l,h,f,b]);const C=w.useCallback(S=>{if(!e&&!s||b.paused)return;const R=S.key==="Tab"&&!S.altKey&&!S.ctrlKey&&!S.metaKey,M=document.activeElement;if(R&&M){const T=S.currentTarget,[E,A]=j2(T);E&&A?!S.shiftKey&&M===A?(S.preventDefault(),e&&ji(E,{select:!0})):S.shiftKey&&M===E&&(S.preventDefault(),e&&ji(A,{select:!0})):M===T&&S.preventDefault()}},[e,s,b.paused]);return g.jsx(De.div,{tabIndex:-1,...o,ref:y,onKeyDown:C})});Fr.displayName=_2;function N2(r,{select:t=!1}={}){const e=document.activeElement;for(const s of r)if(ji(s,{select:t}),document.activeElement!==e)return}function j2(r){const t=Kb(r),e=hv(t,r),s=hv(t.reverse(),r);return[e,s]}function Kb(r){const t=[],e=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const n=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||n?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();)t.push(e.currentNode);return t}function hv(r,t){for(const e of r)if(!P2(e,{upTo:t}))return e}function P2(r,{upTo:t}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(t!==void 0&&r===t)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function L2(r){return r instanceof HTMLInputElement&&"select"in r}function ji(r,{select:t=!1}={}){if(r&&r.focus){const e=document.activeElement;r.focus({preventScroll:!0}),r!==e&&L2(r)&&t&&r.select()}}var fv=z2();function z2(){let r=[];return{add(t){const e=r[0];t!==e&&e?.pause(),r=pv(r,t),r.unshift(t)},remove(t){r=pv(r,t),r[0]?.resume()}}}function pv(r,t){const e=[...r],s=e.indexOf(t);return s!==-1&&e.splice(s,1),e}function I2(r){return r.filter(t=>t.tagName!=="A")}var O2="Portal",Vr=w.forwardRef((r,t)=>{const{container:e,...s}=r,[n,i]=w.useState(!1);os(()=>i(!0),[]);const o=e||n&&globalThis?.document?.body;return o?dE.createPortal(g.jsx(De.div,{...s,ref:t}),o):null});Vr.displayName=O2;var rf=0;function nu(){w.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??gv()),document.body.insertAdjacentElement("beforeend",r[1]??gv()),rf++,()=>{rf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),rf--}},[])}function gv(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var vn=function(){return vn=Object.assign||function(t){for(var e,s=1,n=arguments.length;s<n;s++){e=arguments[s];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},vn.apply(this,arguments)};function Yb(r,t){var e={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&t.indexOf(s)<0&&(e[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(e[s[n]]=r[s[n]]);return e}function H2(r,t,e){if(e||arguments.length===2)for(var s=0,n=t.length,i;s<n;s++)(i||!(s in t))&&(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return r.concat(i||Array.prototype.slice.call(t))}var Tl="right-scroll-bar-position",Al="width-before-scroll-bar",q2="with-scroll-bars-hidden",$2="--removed-body-scroll-bar-size";function cf(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function B2(r,t){var e=w.useState(function(){return{value:r,callback:t,facade:{get current(){return e.value},set current(s){var n=e.value;n!==s&&(e.value=s,e.callback(s,n))}}}})[0];return e.callback=t,e.facade}var U2=typeof window<"u"?w.useLayoutEffect:w.useEffect,mv=new WeakMap;function F2(r,t){var e=B2(null,function(s){return r.forEach(function(n){return cf(n,s)})});return U2(function(){var s=mv.get(e);if(s){var n=new Set(s),i=new Set(r),o=e.current;n.forEach(function(l){i.has(l)||cf(l,null)}),i.forEach(function(l){n.has(l)||cf(l,o)})}mv.set(e,r)},[r]),e}function V2(r){return r}function Q2(r,t){t===void 0&&(t=V2);var e=[],s=!1,n={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return e.length?e[e.length-1]:r},useMedium:function(i){var o=t(i,s);return e.push(o),function(){e=e.filter(function(l){return l!==o})}},assignSyncMedium:function(i){for(s=!0;e.length;){var o=e;e=[],o.forEach(i)}e={push:function(l){return i(l)},filter:function(){return e}}},assignMedium:function(i){s=!0;var o=[];if(e.length){var l=e;e=[],l.forEach(i),o=e}var d=function(){var f=o;o=[],f.forEach(i)},h=function(){return Promise.resolve().then(d)};h(),e={push:function(f){o.push(f),h()},filter:function(f){return o=o.filter(f),e}}}};return n}function G2(r){r===void 0&&(r={});var t=Q2(null);return t.options=vn({async:!0,ssr:!1},r),t}var Wb=function(r){var t=r.sideCar,e=Yb(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return w.createElement(s,vn({},e))};Wb.isSideCarExport=!0;function K2(r,t){return r.useMedium(t),Wb}var Xb=G2(),lf=function(){},iu=w.forwardRef(function(r,t){var e=w.useRef(null),s=w.useState({onScrollCapture:lf,onWheelCapture:lf,onTouchMoveCapture:lf}),n=s[0],i=s[1],o=r.forwardProps,l=r.children,d=r.className,h=r.removeScrollBar,f=r.enabled,m=r.shards,y=r.sideCar,b=r.noRelative,C=r.noIsolation,S=r.inert,R=r.allowPinchZoom,M=r.as,T=M===void 0?"div":M,E=r.gapMode,A=Yb(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=y,N=F2([e,t]),z=vn(vn({},A),n);return w.createElement(w.Fragment,null,f&&w.createElement(_,{sideCar:Xb,removeScrollBar:h,shards:m,noRelative:b,noIsolation:C,inert:S,setCallbacks:i,allowPinchZoom:!!R,lockRef:e,gapMode:E}),o?w.cloneElement(w.Children.only(l),vn(vn({},z),{ref:N})):w.createElement(T,vn({},z,{className:d,ref:N}),l))});iu.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};iu.classNames={fullWidth:Al,zeroRight:Tl};var Y2=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function W2(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=Y2();return t&&r.setAttribute("nonce",t),r}function X2(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function J2(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var Z2=function(){var r=0,t=null;return{add:function(e){r==0&&(t=W2())&&(X2(t,e),J2(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},e_=function(){var r=Z2();return function(t,e){w.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&e])}},Jb=function(){var r=e_(),t=function(e){var s=e.styles,n=e.dynamic;return r(s,n),null};return t},t_={left:0,top:0,right:0,gap:0},uf=function(r){return parseInt(r||"",10)||0},s_=function(r){var t=window.getComputedStyle(document.body),e=t[r==="padding"?"paddingLeft":"marginLeft"],s=t[r==="padding"?"paddingTop":"marginTop"],n=t[r==="padding"?"paddingRight":"marginRight"];return[uf(e),uf(s),uf(n)]},n_=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return t_;var t=s_(r),e=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-e+t[2]-t[0])}},i_=Jb(),yo="data-scroll-locked",a_=function(r,t,e,s){var n=r.left,i=r.top,o=r.right,l=r.gap;return e===void 0&&(e="margin"),`
  .`.concat(q2,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(yo,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),e==="margin"&&`
    padding-left: `.concat(n,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),e==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Tl,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(Al,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(Tl," .").concat(Tl,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(Al," .").concat(Al,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(yo,`] {
    `).concat($2,": ").concat(l,`px;
  }
`)},yv=function(){var r=parseInt(document.body.getAttribute(yo)||"0",10);return isFinite(r)?r:0},o_=function(){w.useEffect(function(){return document.body.setAttribute(yo,(yv()+1).toString()),function(){var r=yv()-1;r<=0?document.body.removeAttribute(yo):document.body.setAttribute(yo,r.toString())}},[])},r_=function(r){var t=r.noRelative,e=r.noImportant,s=r.gapMode,n=s===void 0?"margin":s;o_();var i=w.useMemo(function(){return n_(n)},[n]);return w.createElement(i_,{styles:a_(i,!t,n,e?"":"!important")})},Sf=!1;if(typeof window<"u")try{var ml=Object.defineProperty({},"passive",{get:function(){return Sf=!0,!0}});window.addEventListener("test",ml,ml),window.removeEventListener("test",ml,ml)}catch{Sf=!1}var ho=Sf?{passive:!1}:!1,c_=function(r){return r.tagName==="TEXTAREA"},Zb=function(r,t){if(!(r instanceof Element))return!1;var e=window.getComputedStyle(r);return e[t]!=="hidden"&&!(e.overflowY===e.overflowX&&!c_(r)&&e[t]==="visible")},l_=function(r){return Zb(r,"overflowY")},u_=function(r){return Zb(r,"overflowX")},vv=function(r,t){var e=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var n=ex(r,s);if(n){var i=tx(r,s),o=i[1],l=i[2];if(o>l)return!0}s=s.parentNode}while(s&&s!==e.body);return!1},d_=function(r){var t=r.scrollTop,e=r.scrollHeight,s=r.clientHeight;return[t,e,s]},h_=function(r){var t=r.scrollLeft,e=r.scrollWidth,s=r.clientWidth;return[t,e,s]},ex=function(r,t){return r==="v"?l_(t):u_(t)},tx=function(r,t){return r==="v"?d_(t):h_(t)},f_=function(r,t){return r==="h"&&t==="rtl"?-1:1},p_=function(r,t,e,s,n){var i=f_(r,window.getComputedStyle(t).direction),o=i*s,l=e.target,d=t.contains(l),h=!1,f=o>0,m=0,y=0;do{if(!l)break;var b=tx(r,l),C=b[0],S=b[1],R=b[2],M=S-R-i*C;(C||M)&&ex(r,l)&&(m+=M,y+=C);var T=l.parentNode;l=T&&T.nodeType===Node.DOCUMENT_FRAGMENT_NODE?T.host:T}while(!d&&l!==document.body||d&&(t.contains(l)||t===l));return(f&&Math.abs(m)<1||!f&&Math.abs(y)<1)&&(h=!0),h},yl=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},bv=function(r){return[r.deltaX,r.deltaY]},xv=function(r){return r&&"current"in r?r.current:r},g_=function(r,t){return r[0]===t[0]&&r[1]===t[1]},m_=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},y_=0,fo=[];function v_(r){var t=w.useRef([]),e=w.useRef([0,0]),s=w.useRef(),n=w.useState(y_++)[0],i=w.useState(Jb)[0],o=w.useRef(r);w.useEffect(function(){o.current=r},[r]),w.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(n));var S=H2([r.lockRef.current],(r.shards||[]).map(xv),!0).filter(Boolean);return S.forEach(function(R){return R.classList.add("allow-interactivity-".concat(n))}),function(){document.body.classList.remove("block-interactivity-".concat(n)),S.forEach(function(R){return R.classList.remove("allow-interactivity-".concat(n))})}}},[r.inert,r.lockRef.current,r.shards]);var l=w.useCallback(function(S,R){if("touches"in S&&S.touches.length===2||S.type==="wheel"&&S.ctrlKey)return!o.current.allowPinchZoom;var M=yl(S),T=e.current,E="deltaX"in S?S.deltaX:T[0]-M[0],A="deltaY"in S?S.deltaY:T[1]-M[1],_,N=S.target,z=Math.abs(E)>Math.abs(A)?"h":"v";if("touches"in S&&z==="h"&&N.type==="range")return!1;var q=vv(z,N);if(!q)return!0;if(q?_=z:(_=z==="v"?"h":"v",q=vv(z,N)),!q)return!1;if(!s.current&&"changedTouches"in S&&(E||A)&&(s.current=_),!_)return!0;var Z=s.current||_;return p_(Z,R,S,Z==="h"?E:A)},[]),d=w.useCallback(function(S){var R=S;if(!(!fo.length||fo[fo.length-1]!==i)){var M="deltaY"in R?bv(R):yl(R),T=t.current.filter(function(_){return _.name===R.type&&(_.target===R.target||R.target===_.shadowParent)&&g_(_.delta,M)})[0];if(T&&T.should){R.cancelable&&R.preventDefault();return}if(!T){var E=(o.current.shards||[]).map(xv).filter(Boolean).filter(function(_){return _.contains(R.target)}),A=E.length>0?l(R,E[0]):!o.current.noIsolation;A&&R.cancelable&&R.preventDefault()}}},[]),h=w.useCallback(function(S,R,M,T){var E={name:S,delta:R,target:M,should:T,shadowParent:b_(M)};t.current.push(E),setTimeout(function(){t.current=t.current.filter(function(A){return A!==E})},1)},[]),f=w.useCallback(function(S){e.current=yl(S),s.current=void 0},[]),m=w.useCallback(function(S){h(S.type,bv(S),S.target,l(S,r.lockRef.current))},[]),y=w.useCallback(function(S){h(S.type,yl(S),S.target,l(S,r.lockRef.current))},[]);w.useEffect(function(){return fo.push(i),r.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:y}),document.addEventListener("wheel",d,ho),document.addEventListener("touchmove",d,ho),document.addEventListener("touchstart",f,ho),function(){fo=fo.filter(function(S){return S!==i}),document.removeEventListener("wheel",d,ho),document.removeEventListener("touchmove",d,ho),document.removeEventListener("touchstart",f,ho)}},[]);var b=r.removeScrollBar,C=r.inert;return w.createElement(w.Fragment,null,C?w.createElement(i,{styles:m_(n)}):null,b?w.createElement(r_,{noRelative:r.noRelative,gapMode:r.gapMode}):null)}function b_(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const x_=K2(Xb,v_);var Qr=w.forwardRef(function(r,t){return w.createElement(iu,vn({},r,{ref:t,sideCar:x_}))});Qr.classNames=iu.classNames;var w_=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},po=new WeakMap,vl=new WeakMap,bl={},df=0,sx=function(r){return r&&(r.host||sx(r.parentNode))},C_=function(r,t){return t.map(function(e){if(r.contains(e))return e;var s=sx(e);return s&&r.contains(s)?s:(console.error("aria-hidden",e,"in not contained inside",r,". Doing nothing"),null)}).filter(function(e){return!!e})},S_=function(r,t,e,s){var n=C_(t,Array.isArray(r)?r:[r]);bl[e]||(bl[e]=new WeakMap);var i=bl[e],o=[],l=new Set,d=new Set(n),h=function(m){!m||l.has(m)||(l.add(m),h(m.parentNode))};n.forEach(h);var f=function(m){!m||d.has(m)||Array.prototype.forEach.call(m.children,function(y){if(l.has(y))f(y);else try{var b=y.getAttribute(s),C=b!==null&&b!=="false",S=(po.get(y)||0)+1,R=(i.get(y)||0)+1;po.set(y,S),i.set(y,R),o.push(y),S===1&&C&&vl.set(y,!0),R===1&&y.setAttribute(e,"true"),C||y.setAttribute(s,"true")}catch(M){console.error("aria-hidden: cannot operate on ",y,M)}})};return f(t),l.clear(),df++,function(){o.forEach(function(m){var y=po.get(m)-1,b=i.get(m)-1;po.set(m,y),i.set(m,b),y||(vl.has(m)||m.removeAttribute(s),vl.delete(m)),b||m.removeAttribute(e)}),df--,df||(po=new WeakMap,po=new WeakMap,vl=new WeakMap,bl={})}},au=function(r,t,e){e===void 0&&(e="data-aria-hidden");var s=Array.from(Array.isArray(r)?r:[r]),n=w_(r);return n?(s.push.apply(s,Array.from(n.querySelectorAll("[aria-live], script"))),S_(s,n,e,"aria-hidden")):function(){return null}};function M_(r){const t=R_(r),e=w.forwardRef((s,n)=>{const{children:i,...o}=s,l=w.Children.toArray(i),d=l.find(E_);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}function R_(r){const t=w.forwardRef((e,s)=>{const{children:n,...i}=e;if(w.isValidElement(n)){const o=A_(n),l=T_(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var k_=Symbol("radix.slottable");function E_(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===k_}function T_(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function A_(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var ou="Dialog",[nx,ix]=ws(ou),[D_,dn]=nx(ou),ax=r=>{const{__scopeDialog:t,children:e,open:s,defaultOpen:n,onOpenChange:i,modal:o=!0}=r,l=w.useRef(null),d=w.useRef(null),[h,f]=kn({prop:s,defaultProp:n??!1,onChange:i,caller:ou});return g.jsx(D_,{scope:t,triggerRef:l,contentRef:d,contentId:rn(),titleId:rn(),descriptionId:rn(),open:h,onOpenChange:f,onOpenToggle:w.useCallback(()=>f(m=>!m),[f]),modal:o,children:e})};ax.displayName=ou;var ox="DialogTrigger",rx=w.forwardRef((r,t)=>{const{__scopeDialog:e,...s}=r,n=dn(ox,e),i=je(t,n.triggerRef);return g.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":ip(n.open),...s,ref:i,onClick:ge(r.onClick,n.onOpenToggle)})});rx.displayName=ox;var sp="DialogPortal",[__,cx]=nx(sp,{forceMount:void 0}),lx=r=>{const{__scopeDialog:t,forceMount:e,children:s,container:n}=r,i=dn(sp,t);return g.jsx(__,{scope:t,forceMount:e,children:w.Children.map(s,o=>g.jsx(cs,{present:e||i.open,children:g.jsx(Vr,{asChild:!0,container:n,children:o})}))})};lx.displayName=sp;var Bl="DialogOverlay",ux=w.forwardRef((r,t)=>{const e=cx(Bl,r.__scopeDialog),{forceMount:s=e.forceMount,...n}=r,i=dn(Bl,r.__scopeDialog);return i.modal?g.jsx(cs,{present:s||i.open,children:g.jsx(j_,{...n,ref:t})}):null});ux.displayName=Bl;var N_=M_("DialogOverlay.RemoveScroll"),j_=w.forwardRef((r,t)=>{const{__scopeDialog:e,...s}=r,n=dn(Bl,e);return g.jsx(Qr,{as:N_,allowPinchZoom:!0,shards:[n.contentRef],children:g.jsx(De.div,{"data-state":ip(n.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),ba="DialogContent",dx=w.forwardRef((r,t)=>{const e=cx(ba,r.__scopeDialog),{forceMount:s=e.forceMount,...n}=r,i=dn(ba,r.__scopeDialog);return g.jsx(cs,{present:s||i.open,children:i.modal?g.jsx(P_,{...n,ref:t}):g.jsx(L_,{...n,ref:t})})});dx.displayName=ba;var P_=w.forwardRef((r,t)=>{const e=dn(ba,r.__scopeDialog),s=w.useRef(null),n=je(t,e.contentRef,s);return w.useEffect(()=>{const i=s.current;if(i)return au(i)},[]),g.jsx(hx,{...r,ref:n,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(r.onCloseAutoFocus,i=>{i.preventDefault(),e.triggerRef.current?.focus()}),onPointerDownOutside:ge(r.onPointerDownOutside,i=>{const o=i.detail.originalEvent,l=o.button===0&&o.ctrlKey===!0;(o.button===2||l)&&i.preventDefault()}),onFocusOutside:ge(r.onFocusOutside,i=>i.preventDefault())})}),L_=w.forwardRef((r,t)=>{const e=dn(ba,r.__scopeDialog),s=w.useRef(!1),n=w.useRef(!1);return g.jsx(hx,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{r.onCloseAutoFocus?.(i),i.defaultPrevented||(s.current||e.triggerRef.current?.focus(),i.preventDefault()),s.current=!1,n.current=!1},onInteractOutside:i=>{r.onInteractOutside?.(i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;e.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),hx=w.forwardRef((r,t)=>{const{__scopeDialog:e,trapFocus:s,onOpenAutoFocus:n,onCloseAutoFocus:i,...o}=r,l=dn(ba,e),d=w.useRef(null),h=je(t,d);return nu(),g.jsxs(g.Fragment,{children:[g.jsx(Fr,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:n,onUnmountAutoFocus:i,children:g.jsx(Ur,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":ip(l.open),...o,ref:h,onDismiss:()=>l.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(I_,{titleId:l.titleId}),g.jsx(H_,{contentRef:d,descriptionId:l.descriptionId})]})]})}),np="DialogTitle",fx=w.forwardRef((r,t)=>{const{__scopeDialog:e,...s}=r,n=dn(np,e);return g.jsx(De.h2,{id:n.titleId,...s,ref:t})});fx.displayName=np;var px="DialogDescription",gx=w.forwardRef((r,t)=>{const{__scopeDialog:e,...s}=r,n=dn(px,e);return g.jsx(De.p,{id:n.descriptionId,...s,ref:t})});gx.displayName=px;var mx="DialogClose",yx=w.forwardRef((r,t)=>{const{__scopeDialog:e,...s}=r,n=dn(mx,e);return g.jsx(De.button,{type:"button",...s,ref:t,onClick:ge(r.onClick,()=>n.onOpenChange(!1))})});yx.displayName=mx;function ip(r){return r?"open":"closed"}var vx="DialogTitleWarning",[z_,bx]=KD(vx,{contentName:ba,titleName:np,docsSlug:"dialog"}),I_=({titleId:r})=>{const t=bx(vx),e=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return w.useEffect(()=>{r&&(document.getElementById(r)||console.error(e))},[e,r]),null},O_="DialogDescriptionWarning",H_=({contentRef:r,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bx(O_).contentName}}.`;return w.useEffect(()=>{const n=r.current?.getAttribute("aria-describedby");t&&n&&(document.getElementById(t)||console.warn(s))},[s,r,t]),null},xx=ax,wx=rx,Cx=lx,ap=ux,op=dx,rp=fx,cp=gx,lp=yx,q_=Symbol("radix.slottable");function $_(r){const t=({children:e})=>g.jsx(g.Fragment,{children:e});return t.displayName=`${r}.Slottable`,t.__radixId=q_,t}var Sx="AlertDialog",[B_]=ws(Sx,[ix]),ri=ix(),Mx=r=>{const{__scopeAlertDialog:t,...e}=r,s=ri(t);return g.jsx(xx,{...s,...e,modal:!0})};Mx.displayName=Sx;var U_="AlertDialogTrigger",F_=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,n=ri(e);return g.jsx(wx,{...n,...s,ref:t})});F_.displayName=U_;var V_="AlertDialogPortal",Rx=r=>{const{__scopeAlertDialog:t,...e}=r,s=ri(t);return g.jsx(Cx,{...s,...e})};Rx.displayName=V_;var Q_="AlertDialogOverlay",kx=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,n=ri(e);return g.jsx(ap,{...n,...s,ref:t})});kx.displayName=Q_;var vo="AlertDialogContent",[G_,K_]=B_(vo),Y_=$_("AlertDialogContent"),Ex=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,children:s,...n}=r,i=ri(e),o=w.useRef(null),l=je(t,o),d=w.useRef(null);return g.jsx(z_,{contentName:vo,titleName:Tx,docsSlug:"alert-dialog",children:g.jsx(G_,{scope:e,cancelRef:d,children:g.jsxs(op,{role:"alertdialog",...i,...n,ref:l,onOpenAutoFocus:ge(n.onOpenAutoFocus,h=>{h.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[g.jsx(Y_,{children:s}),g.jsx(X_,{contentRef:o})]})})})});Ex.displayName=vo;var Tx="AlertDialogTitle",Ax=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,n=ri(e);return g.jsx(rp,{...n,...s,ref:t})});Ax.displayName=Tx;var Dx="AlertDialogDescription",_x=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,n=ri(e);return g.jsx(cp,{...n,...s,ref:t})});_x.displayName=Dx;var W_="AlertDialogAction",Nx=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,n=ri(e);return g.jsx(lp,{...n,...s,ref:t})});Nx.displayName=W_;var jx="AlertDialogCancel",Px=w.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,{cancelRef:n}=K_(jx,e),i=ri(e),o=je(t,n);return g.jsx(lp,{...i,...s,ref:o})});Px.displayName=jx;var X_=({contentRef:r})=>{const t=`\`${vo}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${vo}\` by passing a \`${Dx}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${vo}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return w.useEffect(()=>{document.getElementById(r.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,r]),null},J_=Mx,Z_=Rx,Lx=kx,zx=Ex,Ix=Nx,Ox=Px,Hx=Ax,qx=_x;const $x=J_,eN=Z_,Bx=w.forwardRef(({className:r,...t},e)=>g.jsx(Lx,{className:ke("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:e}));Bx.displayName=Lx.displayName;const up=w.forwardRef(({className:r,...t},e)=>g.jsxs(eN,{children:[g.jsx(Bx,{}),g.jsx(zx,{ref:e,className:ke("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t})]}));up.displayName=zx.displayName;const Ux=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col space-y-2 text-center sm:text-left",r),...t});Ux.displayName="AlertDialogHeader";const Fx=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});Fx.displayName="AlertDialogFooter";const dp=w.forwardRef(({className:r,...t},e)=>g.jsx(Hx,{ref:e,className:ke("text-lg font-semibold",r),...t}));dp.displayName=Hx.displayName;const hp=w.forwardRef(({className:r,...t},e)=>g.jsx(qx,{ref:e,className:ke("text-sm text-muted-foreground",r),...t}));hp.displayName=qx.displayName;const fp=w.forwardRef(({className:r,...t},e)=>g.jsx(Ix,{ref:e,className:ke(Qf(),r),...t}));fp.displayName=Ix.displayName;const pp=w.forwardRef(({className:r,...t},e)=>g.jsx(Ox,{ref:e,className:ke(Qf({variant:"outline"}),"mt-2 sm:mt-0",r),...t}));pp.displayName=Ox.displayName;const gp=xx,ZO=wx,tN=Cx,Vx=w.forwardRef(({className:r,...t},e)=>g.jsx(ap,{ref:e,className:ke("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));Vx.displayName=ap.displayName;const ru=w.forwardRef(({className:r,children:t,...e},s)=>g.jsxs(tN,{children:[g.jsx(Vx,{}),g.jsxs(op,{ref:s,className:ke("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...e,children:[t,g.jsxs(lp,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[g.jsx(on,{className:"h-4 w-4"}),g.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ru.displayName=op.displayName;const cu=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});cu.displayName="DialogHeader";const lu=({className:r,...t})=>g.jsx("div",{className:ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});lu.displayName="DialogFooter";const uu=w.forwardRef(({className:r,...t},e)=>g.jsx(rp,{ref:e,className:ke("text-lg font-semibold leading-none tracking-tight",r),...t}));uu.displayName=rp.displayName;const du=w.forwardRef(({className:r,...t},e)=>g.jsx(cp,{ref:e,className:ke("text-sm text-muted-foreground",r),...t}));du.displayName=cp.displayName;var sN=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nN=sN.reduce((r,t)=>{const e=Uf(`Primitive.${t}`),s=w.forwardRef((n,i)=>{const{asChild:o,...l}=n,d=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:i})});return s.displayName=`Primitive.${t}`,{...r,[t]:s}},{}),iN="Label",Qx=w.forwardRef((r,t)=>g.jsx(nN.label,{...r,ref:t,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(r.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));Qx.displayName=iN;var Gx=Qx;const aN=Ff("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),nt=w.forwardRef(({className:r,...t},e)=>g.jsx(Gx,{ref:e,className:ke(aN(),r),...t}));nt.displayName=Gx.displayName;function mp({open:r,initialName:t="",onConfirm:e,onCancel:s}){const[n,i]=w.useState(t);w.useEffect(()=>{r&&i(t)},[r,t]);const o=()=>{n.trim()&&e(n.trim())};return g.jsx(gp,{open:r,onOpenChange:l=>!l&&s(),children:g.jsxs(ru,{children:[g.jsxs(cu,{children:[g.jsx(uu,{children:t?"Rename Group":"Create Group"}),g.jsx(du,{children:t?"Enter a new name for the group":"Enter a name for the new group"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(nt,{htmlFor:"group-name",children:"Group Name"}),g.jsx(Tt,{id:"group-name",value:n,onChange:l=>i(l.target.value),onKeyDown:l=>{l.key==="Enter"&&o()},className:"mt-2",autoFocus:!0})]}),g.jsxs(lu,{children:[g.jsx(Ee,{variant:"outline",onClick:s,children:"Cancel"}),g.jsx(Ee,{onClick:o,disabled:!n.trim(),children:t?"Save":"Create"})]})]})})}function oN(){const{zoom:r,setZoom:t,diagramName:e,setDiagramName:s,saveDiagram:n,loadDiagramState:i,undo:o,redo:l,selectedNodeId:d,createGroupFromSelection:h,autoGroupByConnections:f,nodes:m,pan:y,setPan:b,viewportWidth:C,viewportHeight:S}=Re(),{canUndo:R,canRedo:M}=Ar(),T=w.useRef(null),[E,A]=w.useState(!1),[_,N]=w.useState(e),[z,q]=w.useState(!1),{showMinimap:Z,toggleMinimap:ne,showHeatMapLegend:ce,toggleHeatMapLegend:J,showRuler:te,toggleRuler:le}=Br(),ue=()=>t(Math.min(r+.1,2)),L=()=>t(r-.1),j=()=>{const ae=m;if(!ae.length){t(1),b({x:0,y:0});return}const B=100,G=ae.map(Gt=>Gt.position.x),pe=ae.map(Gt=>Gt.position.y),me=ae.map(Gt=>Gt.position.x+140),ye=ae.map(Gt=>Gt.position.y+140),ve=Math.min(...G)-B,Pe=Math.min(...pe)-B,Be=Math.max(...me)+B,at=Math.max(...ye)+B,Je=Be-ve,jt=at-Pe,de=C||window.innerWidth,$e=S||window.innerHeight-56,Ue=de/Je,bt=$e/jt;let mt=Math.min(Ue,bt);mt=Math.min(Math.max(mt,.2),2.5);const $t=ve+Je/2,Ze=Pe+jt/2,Pt=de/2,xt=$e/2,yt=Pt-$t*mt,Xt=xt-Ze*mt;t(mt),b({x:yt,y:Xt})},O=()=>{n(),Ye.success("Diagram saved to browser storage")},W=()=>{const ae=`${e.replace(/\s+/g,"_")}_${Date.now()}.json`;jT(Re.getState(),ae),Ye.success("Diagram exported as JSON")},fe=()=>{T.current?.click()},P=async ae=>{const B=ae.target.files?.[0];if(B){try{const G=await PT(B);if(!G){Ye.error("Failed to import diagram: Invalid file format");return}i({nodes:G.nodes||[],connections:G.connections||[],groups:G.groups||[],zoom:G.zoom||1,pan:G.pan||{x:0,y:0}}),s(G.name),Ye.success(`Diagram "${G.name}" imported successfully`)}catch(G){Ye.error("Failed to import diagram"),ii("Failed to import diagram",G instanceof Error?G:new Error(String(G)))}T.current&&(T.current.value="")}},F=()=>{_.trim()&&(s(_.trim()),Ye.success("Diagram renamed")),A(!1)},Y=()=>{const{nodes:ae}=Re.getState();if(ae.filter(G=>G.selected||G.id===d).length===0){Ye.error("Select at least one component to create a group");return}q(!0)},ie=ae=>{h(ae),Ye.success(`Group "${ae}" created`),q(!1)},U=()=>{f(),Ye.success("Groups created automatically from connections")};return g.jsxs(g.Fragment,{children:[g.jsx(mp,{open:z,onConfirm:ie,onCancel:()=>q(!1)}),g.jsxs("div",{className:"h-14 bg-toolbar-bg border-b border-border flex items-center justify-between px-4",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("button",{onClick:()=>A(!0),className:"text-lg font-semibold text-foreground hover:text-primary transition-colors cursor-pointer",title:"Click to rename diagram",children:[g.jsx("span",{className:"text-primary",children:"Archi"}),"Phoenix",g.jsxs("span",{className:"text-xs text-secondary-foreground ml-2",children:[" ",e]})]}),g.jsx(bs,{orientation:"vertical",className:"h-6 mx-2"}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:o,disabled:!R,title:"Undo (Ctrl/Cmd+Z)",children:g.jsx(TD,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:l,disabled:!M,title:"Redo (Ctrl/Cmd+Shift+Z or Ctrl/Cmd+Y)",children:g.jsx(oD,{className:"h-4 w-4"})})]}),g.jsx(bs,{orientation:"vertical",className:"h-6 mx-2"}),g.jsx(u2,{})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 rounded-md p-1",children:[g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ue,title:"Zoom In",children:g.jsx(PD,{className:"h-4 w-4"})}),g.jsxs("span",{className:"text-sm font-mono px-2 min-w-[60px] text-center",children:[Math.round(r*100),"%"]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:L,title:"Zoom Out",children:g.jsx(zD,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:j,title:"Fit to View",children:g.jsx(YA,{className:"h-4 w-4"})})]}),g.jsx(bs,{orientation:"vertical",className:"h-6"}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:O,title:"Save diagram to browser storage (auto-saves on changes)",children:g.jsx(fD,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:W,title:"Export diagram as JSON file",children:g.jsx(PA,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:fe,title:"Import diagram from JSON file",children:g.jsx(DD,{className:"h-4 w-4"})}),g.jsx(bs,{orientation:"vertical",className:"h-6"}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Create group from selection",onClick:Y,disabled:!d,children:g.jsx(Tb,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Auto-group by connections",onClick:U,children:g.jsx(bD,{className:"h-4 w-4"})}),g.jsx(bs,{orientation:"vertical",className:"h-6"}),g.jsx(ID,{}),g.jsx(Ee,{variant:Z?"default":"ghost",size:"icon",className:"h-9 w-9",title:Z?"Hide minimap":"Show minimap",onClick:ne,children:g.jsx(GA,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:ce?"default":"ghost",size:"icon",className:"h-9 w-9",title:ce?"Hide heat map legend":"Show heat map legend",onClick:J,children:g.jsx(ya,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:te?"default":"ghost",size:"icon",className:"h-9 w-9",title:te?"Hide ruler":"Show ruler",onClick:le,children:g.jsx(dD,{className:"h-4 w-4"})}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Settings",children:g.jsx(yD,{className:"h-4 w-4"})})]})]}),g.jsx("input",{ref:T,type:"file",accept:".json",onChange:P,className:"hidden","aria-label":"Import diagram from file"}),g.jsx($x,{open:E,onOpenChange:A,children:g.jsxs(up,{children:[g.jsx(dp,{children:"Rename Diagram"}),g.jsx(hp,{children:"Enter a new name for your diagram"}),g.jsx("div",{className:"py-4",children:g.jsx(Tt,{value:_,onChange:ae=>N(ae.target.value),placeholder:"Diagram name",onKeyDown:ae=>{ae.key==="Enter"&&F()},autoFocus:!0})}),g.jsxs("div",{className:"flex gap-2 justify-end",children:[g.jsx(pp,{children:"Cancel"}),g.jsx(fp,{onClick:F,children:"Save"})]})]})})]})}function wv(r){const t=rN(r),e=w.forwardRef((s,n)=>{const{children:i,...o}=s,l=w.Children.toArray(i),d=l.find(lN);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}function rN(r){const t=w.forwardRef((e,s)=>{const{children:n,...i}=e;if(w.isValidElement(n)){const o=dN(n),l=uN(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var cN=Symbol("radix.slottable");function lN(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===cN}function uN(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function dN(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function hu(r){const t=r+"CollectionProvider",[e,s]=ws(t),[n,i]=e(t,{collectionRef:{current:null},itemMap:new Map}),o=S=>{const{scope:R,children:M}=S,T=Et.useRef(null),E=Et.useRef(new Map).current;return g.jsx(n,{scope:R,itemMap:E,collectionRef:T,children:M})};o.displayName=t;const l=r+"CollectionSlot",d=wv(l),h=Et.forwardRef((S,R)=>{const{scope:M,children:T}=S,E=i(l,M),A=je(R,E.collectionRef);return g.jsx(d,{ref:A,children:T})});h.displayName=l;const f=r+"CollectionItemSlot",m="data-radix-collection-item",y=wv(f),b=Et.forwardRef((S,R)=>{const{scope:M,children:T,...E}=S,A=Et.useRef(null),_=je(R,A),N=i(f,M);return Et.useEffect(()=>(N.itemMap.set(A,{ref:A,...E}),()=>void N.itemMap.delete(A))),g.jsx(y,{[m]:"",ref:_,children:T})});b.displayName=f;function C(S){const R=i(r+"CollectionConsumer",S);return Et.useCallback(()=>{const T=R.collectionRef.current;if(!T)return[];const E=Array.from(T.querySelectorAll(`[${m}]`));return Array.from(R.itemMap.values()).sort((N,z)=>E.indexOf(N.ref.current)-E.indexOf(z.ref.current))},[R.collectionRef,R.itemMap])}return[{Provider:o,Slot:h,ItemSlot:b},C,s]}var hf="rovingFocusGroup.onEntryFocus",hN={bubbles:!1,cancelable:!0},Gr="RovingFocusGroup",[Mf,Kx,fN]=hu(Gr),[pN,fu]=ws(Gr,[fN]),[gN,mN]=pN(Gr),Yx=w.forwardRef((r,t)=>g.jsx(Mf.Provider,{scope:r.__scopeRovingFocusGroup,children:g.jsx(Mf.Slot,{scope:r.__scopeRovingFocusGroup,children:g.jsx(yN,{...r,ref:t})})}));Yx.displayName=Gr;var yN=w.forwardRef((r,t)=>{const{__scopeRovingFocusGroup:e,orientation:s,loop:n=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:d,onEntryFocus:h,preventScrollOnEntryFocus:f=!1,...m}=r,y=w.useRef(null),b=je(t,y),C=ko(i),[S,R]=kn({prop:o,defaultProp:l??null,onChange:d,caller:Gr}),[M,T]=w.useState(!1),E=as(h),A=Kx(e),_=w.useRef(!1),[N,z]=w.useState(0);return w.useEffect(()=>{const q=y.current;if(q)return q.addEventListener(hf,E),()=>q.removeEventListener(hf,E)},[E]),g.jsx(gN,{scope:e,orientation:s,dir:C,loop:n,currentTabStopId:S,onItemFocus:w.useCallback(q=>R(q),[R]),onItemShiftTab:w.useCallback(()=>T(!0),[]),onFocusableItemAdd:w.useCallback(()=>z(q=>q+1),[]),onFocusableItemRemove:w.useCallback(()=>z(q=>q-1),[]),children:g.jsx(De.div,{tabIndex:M||N===0?-1:0,"data-orientation":s,...m,ref:b,style:{outline:"none",...r.style},onMouseDown:ge(r.onMouseDown,()=>{_.current=!0}),onFocus:ge(r.onFocus,q=>{const Z=!_.current;if(q.target===q.currentTarget&&Z&&!M){const ne=new CustomEvent(hf,hN);if(q.currentTarget.dispatchEvent(ne),!ne.defaultPrevented){const ce=A().filter(L=>L.focusable),J=ce.find(L=>L.active),te=ce.find(L=>L.id===S),ue=[J,te,...ce].filter(Boolean).map(L=>L.ref.current);Jx(ue,f)}}_.current=!1}),onBlur:ge(r.onBlur,()=>T(!1))})})}),Wx="RovingFocusGroupItem",Xx=w.forwardRef((r,t)=>{const{__scopeRovingFocusGroup:e,focusable:s=!0,active:n=!1,tabStopId:i,children:o,...l}=r,d=rn(),h=i||d,f=mN(Wx,e),m=f.currentTabStopId===h,y=Kx(e),{onFocusableItemAdd:b,onFocusableItemRemove:C,currentTabStopId:S}=f;return w.useEffect(()=>{if(s)return b(),()=>C()},[s,b,C]),g.jsx(Mf.ItemSlot,{scope:e,id:h,focusable:s,active:n,children:g.jsx(De.span,{tabIndex:m?0:-1,"data-orientation":f.orientation,...l,ref:t,onMouseDown:ge(r.onMouseDown,R=>{s?f.onItemFocus(h):R.preventDefault()}),onFocus:ge(r.onFocus,()=>f.onItemFocus(h)),onKeyDown:ge(r.onKeyDown,R=>{if(R.key==="Tab"&&R.shiftKey){f.onItemShiftTab();return}if(R.target!==R.currentTarget)return;const M=xN(R,f.orientation,f.dir);if(M!==void 0){if(R.metaKey||R.ctrlKey||R.altKey||R.shiftKey)return;R.preventDefault();let E=y().filter(A=>A.focusable).map(A=>A.ref.current);if(M==="last")E.reverse();else if(M==="prev"||M==="next"){M==="prev"&&E.reverse();const A=E.indexOf(R.currentTarget);E=f.loop?wN(E,A+1):E.slice(A+1)}setTimeout(()=>Jx(E))}}),children:typeof o=="function"?o({isCurrentTabStop:m,hasTabStop:S!=null}):o})})});Xx.displayName=Wx;var vN={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function bN(r,t){return t!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function xN(r,t,e){const s=bN(r.key,e);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return vN[s]}function Jx(r,t=!1){const e=document.activeElement;for(const s of r)if(s===e||(s.focus({preventScroll:t}),document.activeElement!==e))return}function wN(r,t){return r.map((e,s)=>r[(t+s)%r.length])}var Zx=Yx,ew=Xx,pu="Tabs",[CN]=ws(pu,[fu]),tw=fu(),[SN,yp]=CN(pu),sw=w.forwardRef((r,t)=>{const{__scopeTabs:e,value:s,onValueChange:n,defaultValue:i,orientation:o="horizontal",dir:l,activationMode:d="automatic",...h}=r,f=ko(l),[m,y]=kn({prop:s,onChange:n,defaultProp:i??"",caller:pu});return g.jsx(SN,{scope:e,baseId:rn(),value:m,onValueChange:y,orientation:o,dir:f,activationMode:d,children:g.jsx(De.div,{dir:f,"data-orientation":o,...h,ref:t})})});sw.displayName=pu;var nw="TabsList",iw=w.forwardRef((r,t)=>{const{__scopeTabs:e,loop:s=!0,...n}=r,i=yp(nw,e),o=tw(e);return g.jsx(Zx,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:s,children:g.jsx(De.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:t})})});iw.displayName=nw;var aw="TabsTrigger",ow=w.forwardRef((r,t)=>{const{__scopeTabs:e,value:s,disabled:n=!1,...i}=r,o=yp(aw,e),l=tw(e),d=lw(o.baseId,s),h=uw(o.baseId,s),f=s===o.value;return g.jsx(ew,{asChild:!0,...l,focusable:!n,active:f,children:g.jsx(De.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":h,"data-state":f?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:d,...i,ref:t,onMouseDown:ge(r.onMouseDown,m=>{!n&&m.button===0&&m.ctrlKey===!1?o.onValueChange(s):m.preventDefault()}),onKeyDown:ge(r.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&o.onValueChange(s)}),onFocus:ge(r.onFocus,()=>{const m=o.activationMode!=="manual";!f&&!n&&m&&o.onValueChange(s)})})})});ow.displayName=aw;var rw="TabsContent",cw=w.forwardRef((r,t)=>{const{__scopeTabs:e,value:s,forceMount:n,children:i,...o}=r,l=yp(rw,e),d=lw(l.baseId,s),h=uw(l.baseId,s),f=s===l.value,m=w.useRef(f);return w.useEffect(()=>{const y=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(y)},[]),g.jsx(cs,{present:n||f,children:({present:y})=>g.jsx(De.div,{"data-state":f?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":d,hidden:!y,id:h,tabIndex:0,...o,ref:t,style:{...r.style,animationDuration:m.current?"0s":void 0},children:y&&i})})});cw.displayName=rw;function lw(r,t){return`${r}-trigger-${t}`}function uw(r,t){return`${r}-content-${t}`}var MN=sw,dw=iw,hw=ow,fw=cw;const vp=MN,gu=w.forwardRef(({className:r,...t},e)=>g.jsx(dw,{ref:e,className:ke("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",r),...t}));gu.displayName=dw.displayName;const sn=w.forwardRef(({className:r,...t},e)=>g.jsx(hw,{ref:e,className:ke("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...t}));sn.displayName=hw.displayName;const si=w.forwardRef(({className:r,...t},e)=>g.jsx(fw,{ref:e,className:ke("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));si.displayName=fw.displayName;const RN=["top","right","bottom","left"],Ii=Math.min,As=Math.max,Ul=Math.round,xl=Math.floor,Cn=r=>({x:r,y:r}),kN={left:"right",right:"left",bottom:"top",top:"bottom"},EN={start:"end",end:"start"};function Rf(r,t,e){return As(r,Ii(t,e))}function ai(r,t){return typeof r=="function"?r(t):r}function oi(r){return r.split("-")[0]}function Eo(r){return r.split("-")[1]}function bp(r){return r==="x"?"y":"x"}function xp(r){return r==="y"?"height":"width"}const TN=new Set(["top","bottom"]);function xn(r){return TN.has(oi(r))?"y":"x"}function wp(r){return bp(xn(r))}function AN(r,t,e){e===void 0&&(e=!1);const s=Eo(r),n=wp(r),i=xp(n);let o=n==="x"?s===(e?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(o=Fl(o)),[o,Fl(o)]}function DN(r){const t=Fl(r);return[kf(r),t,kf(t)]}function kf(r){return r.replace(/start|end/g,t=>EN[t])}const Cv=["left","right"],Sv=["right","left"],_N=["top","bottom"],NN=["bottom","top"];function jN(r,t,e){switch(r){case"top":case"bottom":return e?t?Sv:Cv:t?Cv:Sv;case"left":case"right":return t?_N:NN;default:return[]}}function PN(r,t,e,s){const n=Eo(r);let i=jN(oi(r),e==="start",s);return n&&(i=i.map(o=>o+"-"+n),t&&(i=i.concat(i.map(kf)))),i}function Fl(r){return r.replace(/left|right|bottom|top/g,t=>kN[t])}function LN(r){return{top:0,right:0,bottom:0,left:0,...r}}function pw(r){return typeof r!="number"?LN(r):{top:r,right:r,bottom:r,left:r}}function Vl(r){const{x:t,y:e,width:s,height:n}=r;return{width:s,height:n,top:e,left:t,right:t+s,bottom:e+n,x:t,y:e}}function Mv(r,t,e){let{reference:s,floating:n}=r;const i=xn(t),o=wp(t),l=xp(o),d=oi(t),h=i==="y",f=s.x+s.width/2-n.width/2,m=s.y+s.height/2-n.height/2,y=s[l]/2-n[l]/2;let b;switch(d){case"top":b={x:f,y:s.y-n.height};break;case"bottom":b={x:f,y:s.y+s.height};break;case"right":b={x:s.x+s.width,y:m};break;case"left":b={x:s.x-n.width,y:m};break;default:b={x:s.x,y:s.y}}switch(Eo(t)){case"start":b[o]-=y*(e&&h?-1:1);break;case"end":b[o]+=y*(e&&h?-1:1);break}return b}const zN=async(r,t,e)=>{const{placement:s="bottom",strategy:n="absolute",middleware:i=[],platform:o}=e,l=i.filter(Boolean),d=await(o.isRTL==null?void 0:o.isRTL(t));let h=await o.getElementRects({reference:r,floating:t,strategy:n}),{x:f,y:m}=Mv(h,s,d),y=s,b={},C=0;for(let S=0;S<l.length;S++){const{name:R,fn:M}=l[S],{x:T,y:E,data:A,reset:_}=await M({x:f,y:m,initialPlacement:s,placement:y,strategy:n,middlewareData:b,rects:h,platform:o,elements:{reference:r,floating:t}});f=T??f,m=E??m,b={...b,[R]:{...b[R],...A}},_&&C<=50&&(C++,typeof _=="object"&&(_.placement&&(y=_.placement),_.rects&&(h=_.rects===!0?await o.getElementRects({reference:r,floating:t,strategy:n}):_.rects),{x:f,y:m}=Mv(h,y,d)),S=-1)}return{x:f,y:m,placement:y,strategy:n,middlewareData:b}};async function Lr(r,t){var e;t===void 0&&(t={});const{x:s,y:n,platform:i,rects:o,elements:l,strategy:d}=r,{boundary:h="clippingAncestors",rootBoundary:f="viewport",elementContext:m="floating",altBoundary:y=!1,padding:b=0}=ai(t,r),C=pw(b),R=l[y?m==="floating"?"reference":"floating":m],M=Vl(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(R)))==null||e?R:R.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(l.floating)),boundary:h,rootBoundary:f,strategy:d})),T=m==="floating"?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(l.floating)),A=await(i.isElement==null?void 0:i.isElement(E))?await(i.getScale==null?void 0:i.getScale(E))||{x:1,y:1}:{x:1,y:1},_=Vl(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:T,offsetParent:E,strategy:d}):T);return{top:(M.top-_.top+C.top)/A.y,bottom:(_.bottom-M.bottom+C.bottom)/A.y,left:(M.left-_.left+C.left)/A.x,right:(_.right-M.right+C.right)/A.x}}const IN=r=>({name:"arrow",options:r,async fn(t){const{x:e,y:s,placement:n,rects:i,platform:o,elements:l,middlewareData:d}=t,{element:h,padding:f=0}=ai(r,t)||{};if(h==null)return{};const m=pw(f),y={x:e,y:s},b=wp(n),C=xp(b),S=await o.getDimensions(h),R=b==="y",M=R?"top":"left",T=R?"bottom":"right",E=R?"clientHeight":"clientWidth",A=i.reference[C]+i.reference[b]-y[b]-i.floating[C],_=y[b]-i.reference[b],N=await(o.getOffsetParent==null?void 0:o.getOffsetParent(h));let z=N?N[E]:0;(!z||!await(o.isElement==null?void 0:o.isElement(N)))&&(z=l.floating[E]||i.floating[C]);const q=A/2-_/2,Z=z/2-S[C]/2-1,ne=Ii(m[M],Z),ce=Ii(m[T],Z),J=ne,te=z-S[C]-ce,le=z/2-S[C]/2+q,ue=Rf(J,le,te),L=!d.arrow&&Eo(n)!=null&&le!==ue&&i.reference[C]/2-(le<J?ne:ce)-S[C]/2<0,j=L?le<J?le-J:le-te:0;return{[b]:y[b]+j,data:{[b]:ue,centerOffset:le-ue-j,...L&&{alignmentOffset:j}},reset:L}}}),ON=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,s;const{placement:n,middlewareData:i,rects:o,initialPlacement:l,platform:d,elements:h}=t,{mainAxis:f=!0,crossAxis:m=!0,fallbackPlacements:y,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:C="none",flipAlignment:S=!0,...R}=ai(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const M=oi(n),T=xn(l),E=oi(l)===l,A=await(d.isRTL==null?void 0:d.isRTL(h.floating)),_=y||(E||!S?[Fl(l)]:DN(l)),N=C!=="none";!y&&N&&_.push(...PN(l,S,C,A));const z=[l,..._],q=await Lr(t,R),Z=[];let ne=((s=i.flip)==null?void 0:s.overflows)||[];if(f&&Z.push(q[M]),m){const le=AN(n,o,A);Z.push(q[le[0]],q[le[1]])}if(ne=[...ne,{placement:n,overflows:Z}],!Z.every(le=>le<=0)){var ce,J;const le=(((ce=i.flip)==null?void 0:ce.index)||0)+1,ue=z[le];if(ue&&(!(m==="alignment"?T!==xn(ue):!1)||ne.every(O=>xn(O.placement)===T?O.overflows[0]>0:!0)))return{data:{index:le,overflows:ne},reset:{placement:ue}};let L=(J=ne.filter(j=>j.overflows[0]<=0).sort((j,O)=>j.overflows[1]-O.overflows[1])[0])==null?void 0:J.placement;if(!L)switch(b){case"bestFit":{var te;const j=(te=ne.filter(O=>{if(N){const W=xn(O.placement);return W===T||W==="y"}return!0}).map(O=>[O.placement,O.overflows.filter(W=>W>0).reduce((W,fe)=>W+fe,0)]).sort((O,W)=>O[1]-W[1])[0])==null?void 0:te[0];j&&(L=j);break}case"initialPlacement":L=l;break}if(n!==L)return{reset:{placement:L}}}return{}}}};function Rv(r,t){return{top:r.top-t.height,right:r.right-t.width,bottom:r.bottom-t.height,left:r.left-t.width}}function kv(r){return RN.some(t=>r[t]>=0)}const HN=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(t){const{rects:e}=t,{strategy:s="referenceHidden",...n}=ai(r,t);switch(s){case"referenceHidden":{const i=await Lr(t,{...n,elementContext:"reference"}),o=Rv(i,e.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:kv(o)}}}case"escaped":{const i=await Lr(t,{...n,altBoundary:!0}),o=Rv(i,e.floating);return{data:{escapedOffsets:o,escaped:kv(o)}}}default:return{}}}}},gw=new Set(["left","top"]);async function qN(r,t){const{placement:e,platform:s,elements:n}=r,i=await(s.isRTL==null?void 0:s.isRTL(n.floating)),o=oi(e),l=Eo(e),d=xn(e)==="y",h=gw.has(o)?-1:1,f=i&&d?-1:1,m=ai(t,r);let{mainAxis:y,crossAxis:b,alignmentAxis:C}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return l&&typeof C=="number"&&(b=l==="end"?C*-1:C),d?{x:b*f,y:y*h}:{x:y*h,y:b*f}}const $N=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,s;const{x:n,y:i,placement:o,middlewareData:l}=t,d=await qN(t,r);return o===((e=l.offset)==null?void 0:e.placement)&&(s=l.arrow)!=null&&s.alignmentOffset?{}:{x:n+d.x,y:i+d.y,data:{...d,placement:o}}}}},BN=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:s,placement:n}=t,{mainAxis:i=!0,crossAxis:o=!1,limiter:l={fn:R=>{let{x:M,y:T}=R;return{x:M,y:T}}},...d}=ai(r,t),h={x:e,y:s},f=await Lr(t,d),m=xn(oi(n)),y=bp(m);let b=h[y],C=h[m];if(i){const R=y==="y"?"top":"left",M=y==="y"?"bottom":"right",T=b+f[R],E=b-f[M];b=Rf(T,b,E)}if(o){const R=m==="y"?"top":"left",M=m==="y"?"bottom":"right",T=C+f[R],E=C-f[M];C=Rf(T,C,E)}const S=l.fn({...t,[y]:b,[m]:C});return{...S,data:{x:S.x-e,y:S.y-s,enabled:{[y]:i,[m]:o}}}}}},UN=function(r){return r===void 0&&(r={}),{options:r,fn(t){const{x:e,y:s,placement:n,rects:i,middlewareData:o}=t,{offset:l=0,mainAxis:d=!0,crossAxis:h=!0}=ai(r,t),f={x:e,y:s},m=xn(n),y=bp(m);let b=f[y],C=f[m];const S=ai(l,t),R=typeof S=="number"?{mainAxis:S,crossAxis:0}:{mainAxis:0,crossAxis:0,...S};if(d){const E=y==="y"?"height":"width",A=i.reference[y]-i.floating[E]+R.mainAxis,_=i.reference[y]+i.reference[E]-R.mainAxis;b<A?b=A:b>_&&(b=_)}if(h){var M,T;const E=y==="y"?"width":"height",A=gw.has(oi(n)),_=i.reference[m]-i.floating[E]+(A&&((M=o.offset)==null?void 0:M[m])||0)+(A?0:R.crossAxis),N=i.reference[m]+i.reference[E]+(A?0:((T=o.offset)==null?void 0:T[m])||0)-(A?R.crossAxis:0);C<_?C=_:C>N&&(C=N)}return{[y]:b,[m]:C}}}},FN=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,s;const{placement:n,rects:i,platform:o,elements:l}=t,{apply:d=()=>{},...h}=ai(r,t),f=await Lr(t,h),m=oi(n),y=Eo(n),b=xn(n)==="y",{width:C,height:S}=i.floating;let R,M;m==="top"||m==="bottom"?(R=m,M=y===(await(o.isRTL==null?void 0:o.isRTL(l.floating))?"start":"end")?"left":"right"):(M=m,R=y==="end"?"top":"bottom");const T=S-f.top-f.bottom,E=C-f.left-f.right,A=Ii(S-f[R],T),_=Ii(C-f[M],E),N=!t.middlewareData.shift;let z=A,q=_;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(q=E),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(z=T),N&&!y){const ne=As(f.left,0),ce=As(f.right,0),J=As(f.top,0),te=As(f.bottom,0);b?q=C-2*(ne!==0||ce!==0?ne+ce:As(f.left,f.right)):z=S-2*(J!==0||te!==0?J+te:As(f.top,f.bottom))}await d({...t,availableWidth:q,availableHeight:z});const Z=await o.getDimensions(l.floating);return C!==Z.width||S!==Z.height?{reset:{rects:!0}}:{}}}};function mu(){return typeof window<"u"}function To(r){return mw(r)?(r.nodeName||"").toLowerCase():"#document"}function Ds(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function Dn(r){var t;return(t=(mw(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function mw(r){return mu()?r instanceof Node||r instanceof Ds(r).Node:!1}function cn(r){return mu()?r instanceof Element||r instanceof Ds(r).Element:!1}function En(r){return mu()?r instanceof HTMLElement||r instanceof Ds(r).HTMLElement:!1}function Ev(r){return!mu()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Ds(r).ShadowRoot}const VN=new Set(["inline","contents"]);function Kr(r){const{overflow:t,overflowX:e,overflowY:s,display:n}=ln(r);return/auto|scroll|overlay|hidden|clip/.test(t+s+e)&&!VN.has(n)}const QN=new Set(["table","td","th"]);function GN(r){return QN.has(To(r))}const KN=[":popover-open",":modal"];function yu(r){return KN.some(t=>{try{return r.matches(t)}catch{return!1}})}const YN=["transform","translate","scale","rotate","perspective"],WN=["transform","translate","scale","rotate","perspective","filter"],XN=["paint","layout","strict","content"];function Cp(r){const t=Sp(),e=cn(r)?ln(r):r;return YN.some(s=>e[s]?e[s]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||WN.some(s=>(e.willChange||"").includes(s))||XN.some(s=>(e.contain||"").includes(s))}function JN(r){let t=Oi(r);for(;En(t)&&!wo(t);){if(Cp(t))return t;if(yu(t))return null;t=Oi(t)}return null}function Sp(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ZN=new Set(["html","body","#document"]);function wo(r){return ZN.has(To(r))}function ln(r){return Ds(r).getComputedStyle(r)}function vu(r){return cn(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Oi(r){if(To(r)==="html")return r;const t=r.assignedSlot||r.parentNode||Ev(r)&&r.host||Dn(r);return Ev(t)?t.host:t}function yw(r){const t=Oi(r);return wo(t)?r.ownerDocument?r.ownerDocument.body:r.body:En(t)&&Kr(t)?t:yw(t)}function zr(r,t,e){var s;t===void 0&&(t=[]),e===void 0&&(e=!0);const n=yw(r),i=n===((s=r.ownerDocument)==null?void 0:s.body),o=Ds(n);if(i){const l=Ef(o);return t.concat(o,o.visualViewport||[],Kr(n)?n:[],l&&e?zr(l):[])}return t.concat(n,zr(n,[],e))}function Ef(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function vw(r){const t=ln(r);let e=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const n=En(r),i=n?r.offsetWidth:e,o=n?r.offsetHeight:s,l=Ul(e)!==i||Ul(s)!==o;return l&&(e=i,s=o),{width:e,height:s,$:l}}function Mp(r){return cn(r)?r:r.contextElement}function bo(r){const t=Mp(r);if(!En(t))return Cn(1);const e=t.getBoundingClientRect(),{width:s,height:n,$:i}=vw(t);let o=(i?Ul(e.width):e.width)/s,l=(i?Ul(e.height):e.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const ej=Cn(0);function bw(r){const t=Ds(r);return!Sp()||!t.visualViewport?ej:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function tj(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==Ds(r)?!1:t}function xa(r,t,e,s){t===void 0&&(t=!1),e===void 0&&(e=!1);const n=r.getBoundingClientRect(),i=Mp(r);let o=Cn(1);t&&(s?cn(s)&&(o=bo(s)):o=bo(r));const l=tj(i,e,s)?bw(i):Cn(0);let d=(n.left+l.x)/o.x,h=(n.top+l.y)/o.y,f=n.width/o.x,m=n.height/o.y;if(i){const y=Ds(i),b=s&&cn(s)?Ds(s):s;let C=y,S=Ef(C);for(;S&&s&&b!==C;){const R=bo(S),M=S.getBoundingClientRect(),T=ln(S),E=M.left+(S.clientLeft+parseFloat(T.paddingLeft))*R.x,A=M.top+(S.clientTop+parseFloat(T.paddingTop))*R.y;d*=R.x,h*=R.y,f*=R.x,m*=R.y,d+=E,h+=A,C=Ds(S),S=Ef(C)}}return Vl({width:f,height:m,x:d,y:h})}function bu(r,t){const e=vu(r).scrollLeft;return t?t.left+e:xa(Dn(r)).left+e}function xw(r,t){const e=r.getBoundingClientRect(),s=e.left+t.scrollLeft-bu(r,e),n=e.top+t.scrollTop;return{x:s,y:n}}function sj(r){let{elements:t,rect:e,offsetParent:s,strategy:n}=r;const i=n==="fixed",o=Dn(s),l=t?yu(t.floating):!1;if(s===o||l&&i)return e;let d={scrollLeft:0,scrollTop:0},h=Cn(1);const f=Cn(0),m=En(s);if((m||!m&&!i)&&((To(s)!=="body"||Kr(o))&&(d=vu(s)),En(s))){const b=xa(s);h=bo(s),f.x=b.x+s.clientLeft,f.y=b.y+s.clientTop}const y=o&&!m&&!i?xw(o,d):Cn(0);return{width:e.width*h.x,height:e.height*h.y,x:e.x*h.x-d.scrollLeft*h.x+f.x+y.x,y:e.y*h.y-d.scrollTop*h.y+f.y+y.y}}function nj(r){return Array.from(r.getClientRects())}function ij(r){const t=Dn(r),e=vu(r),s=r.ownerDocument.body,n=As(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),i=As(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-e.scrollLeft+bu(r);const l=-e.scrollTop;return ln(s).direction==="rtl"&&(o+=As(t.clientWidth,s.clientWidth)-n),{width:n,height:i,x:o,y:l}}const Tv=25;function aj(r,t){const e=Ds(r),s=Dn(r),n=e.visualViewport;let i=s.clientWidth,o=s.clientHeight,l=0,d=0;if(n){i=n.width,o=n.height;const f=Sp();(!f||f&&t==="fixed")&&(l=n.offsetLeft,d=n.offsetTop)}const h=bu(s);if(h<=0){const f=s.ownerDocument,m=f.body,y=getComputedStyle(m),b=f.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,C=Math.abs(s.clientWidth-m.clientWidth-b);C<=Tv&&(i-=C)}else h<=Tv&&(i+=h);return{width:i,height:o,x:l,y:d}}const oj=new Set(["absolute","fixed"]);function rj(r,t){const e=xa(r,!0,t==="fixed"),s=e.top+r.clientTop,n=e.left+r.clientLeft,i=En(r)?bo(r):Cn(1),o=r.clientWidth*i.x,l=r.clientHeight*i.y,d=n*i.x,h=s*i.y;return{width:o,height:l,x:d,y:h}}function Av(r,t,e){let s;if(t==="viewport")s=aj(r,e);else if(t==="document")s=ij(Dn(r));else if(cn(t))s=rj(t,e);else{const n=bw(r);s={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return Vl(s)}function ww(r,t){const e=Oi(r);return e===t||!cn(e)||wo(e)?!1:ln(e).position==="fixed"||ww(e,t)}function cj(r,t){const e=t.get(r);if(e)return e;let s=zr(r,[],!1).filter(l=>cn(l)&&To(l)!=="body"),n=null;const i=ln(r).position==="fixed";let o=i?Oi(r):r;for(;cn(o)&&!wo(o);){const l=ln(o),d=Cp(o);!d&&l.position==="fixed"&&(n=null),(i?!d&&!n:!d&&l.position==="static"&&!!n&&oj.has(n.position)||Kr(o)&&!d&&ww(r,o))?s=s.filter(f=>f!==o):n=l,o=Oi(o)}return t.set(r,s),s}function lj(r){let{element:t,boundary:e,rootBoundary:s,strategy:n}=r;const o=[...e==="clippingAncestors"?yu(t)?[]:cj(t,this._c):[].concat(e),s],l=o[0],d=o.reduce((h,f)=>{const m=Av(t,f,n);return h.top=As(m.top,h.top),h.right=Ii(m.right,h.right),h.bottom=Ii(m.bottom,h.bottom),h.left=As(m.left,h.left),h},Av(t,l,n));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function uj(r){const{width:t,height:e}=vw(r);return{width:t,height:e}}function dj(r,t,e){const s=En(t),n=Dn(t),i=e==="fixed",o=xa(r,!0,i,t);let l={scrollLeft:0,scrollTop:0};const d=Cn(0);function h(){d.x=bu(n)}if(s||!s&&!i)if((To(t)!=="body"||Kr(n))&&(l=vu(t)),s){const b=xa(t,!0,i,t);d.x=b.x+t.clientLeft,d.y=b.y+t.clientTop}else n&&h();i&&!s&&n&&h();const f=n&&!s&&!i?xw(n,l):Cn(0),m=o.left+l.scrollLeft-d.x-f.x,y=o.top+l.scrollTop-d.y-f.y;return{x:m,y,width:o.width,height:o.height}}function ff(r){return ln(r).position==="static"}function Dv(r,t){if(!En(r)||ln(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return Dn(r)===e&&(e=e.ownerDocument.body),e}function Cw(r,t){const e=Ds(r);if(yu(r))return e;if(!En(r)){let n=Oi(r);for(;n&&!wo(n);){if(cn(n)&&!ff(n))return n;n=Oi(n)}return e}let s=Dv(r,t);for(;s&&GN(s)&&ff(s);)s=Dv(s,t);return s&&wo(s)&&ff(s)&&!Cp(s)?e:s||JN(r)||e}const hj=async function(r){const t=this.getOffsetParent||Cw,e=this.getDimensions,s=await e(r.floating);return{reference:dj(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function fj(r){return ln(r).direction==="rtl"}const pj={convertOffsetParentRelativeRectToViewportRelativeRect:sj,getDocumentElement:Dn,getClippingRect:lj,getOffsetParent:Cw,getElementRects:hj,getClientRects:nj,getDimensions:uj,getScale:bo,isElement:cn,isRTL:fj};function Sw(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function gj(r,t){let e=null,s;const n=Dn(r);function i(){var l;clearTimeout(s),(l=e)==null||l.disconnect(),e=null}function o(l,d){l===void 0&&(l=!1),d===void 0&&(d=1),i();const h=r.getBoundingClientRect(),{left:f,top:m,width:y,height:b}=h;if(l||t(),!y||!b)return;const C=xl(m),S=xl(n.clientWidth-(f+y)),R=xl(n.clientHeight-(m+b)),M=xl(f),E={rootMargin:-C+"px "+-S+"px "+-R+"px "+-M+"px",threshold:As(0,Ii(1,d))||1};let A=!0;function _(N){const z=N[0].intersectionRatio;if(z!==d){if(!A)return o();z?o(!1,z):s=setTimeout(()=>{o(!1,1e-7)},1e3)}z===1&&!Sw(h,r.getBoundingClientRect())&&o(),A=!1}try{e=new IntersectionObserver(_,{...E,root:n.ownerDocument})}catch{e=new IntersectionObserver(_,E)}e.observe(r)}return o(!0),i}function mj(r,t,e,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:d=!1}=s,h=Mp(r),f=n||i?[...h?zr(h):[],...zr(t)]:[];f.forEach(M=>{n&&M.addEventListener("scroll",e,{passive:!0}),i&&M.addEventListener("resize",e)});const m=h&&l?gj(h,e):null;let y=-1,b=null;o&&(b=new ResizeObserver(M=>{let[T]=M;T&&T.target===h&&b&&(b.unobserve(t),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var E;(E=b)==null||E.observe(t)})),e()}),h&&!d&&b.observe(h),b.observe(t));let C,S=d?xa(r):null;d&&R();function R(){const M=xa(r);S&&!Sw(S,M)&&e(),S=M,C=requestAnimationFrame(R)}return e(),()=>{var M;f.forEach(T=>{n&&T.removeEventListener("scroll",e),i&&T.removeEventListener("resize",e)}),m?.(),(M=b)==null||M.disconnect(),b=null,d&&cancelAnimationFrame(C)}}const yj=$N,vj=BN,bj=ON,xj=FN,wj=HN,_v=IN,Cj=UN,Sj=(r,t,e)=>{const s=new Map,n={platform:pj,...e},i={...n.platform,_c:s};return zN(r,t,{...n,platform:i})};var Mj=typeof document<"u",Rj=function(){},Dl=Mj?w.useLayoutEffect:Rj;function Ql(r,t){if(r===t)return!0;if(typeof r!=typeof t)return!1;if(typeof r=="function"&&r.toString()===t.toString())return!0;let e,s,n;if(r&&t&&typeof r=="object"){if(Array.isArray(r)){if(e=r.length,e!==t.length)return!1;for(s=e;s--!==0;)if(!Ql(r[s],t[s]))return!1;return!0}if(n=Object.keys(r),e=n.length,e!==Object.keys(t).length)return!1;for(s=e;s--!==0;)if(!{}.hasOwnProperty.call(t,n[s]))return!1;for(s=e;s--!==0;){const i=n[s];if(!(i==="_owner"&&r.$$typeof)&&!Ql(r[i],t[i]))return!1}return!0}return r!==r&&t!==t}function Mw(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function Nv(r,t){const e=Mw(r);return Math.round(t*e)/e}function pf(r){const t=w.useRef(r);return Dl(()=>{t.current=r}),t}function kj(r){r===void 0&&(r={});const{placement:t="bottom",strategy:e="absolute",middleware:s=[],platform:n,elements:{reference:i,floating:o}={},transform:l=!0,whileElementsMounted:d,open:h}=r,[f,m]=w.useState({x:0,y:0,strategy:e,placement:t,middlewareData:{},isPositioned:!1}),[y,b]=w.useState(s);Ql(y,s)||b(s);const[C,S]=w.useState(null),[R,M]=w.useState(null),T=w.useCallback(O=>{O!==N.current&&(N.current=O,S(O))},[]),E=w.useCallback(O=>{O!==z.current&&(z.current=O,M(O))},[]),A=i||C,_=o||R,N=w.useRef(null),z=w.useRef(null),q=w.useRef(f),Z=d!=null,ne=pf(d),ce=pf(n),J=pf(h),te=w.useCallback(()=>{if(!N.current||!z.current)return;const O={placement:t,strategy:e,middleware:y};ce.current&&(O.platform=ce.current),Sj(N.current,z.current,O).then(W=>{const fe={...W,isPositioned:J.current!==!1};le.current&&!Ql(q.current,fe)&&(q.current=fe,qr.flushSync(()=>{m(fe)}))})},[y,t,e,ce,J]);Dl(()=>{h===!1&&q.current.isPositioned&&(q.current.isPositioned=!1,m(O=>({...O,isPositioned:!1})))},[h]);const le=w.useRef(!1);Dl(()=>(le.current=!0,()=>{le.current=!1}),[]),Dl(()=>{if(A&&(N.current=A),_&&(z.current=_),A&&_){if(ne.current)return ne.current(A,_,te);te()}},[A,_,te,ne,Z]);const ue=w.useMemo(()=>({reference:N,floating:z,setReference:T,setFloating:E}),[T,E]),L=w.useMemo(()=>({reference:A,floating:_}),[A,_]),j=w.useMemo(()=>{const O={position:e,left:0,top:0};if(!L.floating)return O;const W=Nv(L.floating,f.x),fe=Nv(L.floating,f.y);return l?{...O,transform:"translate("+W+"px, "+fe+"px)",...Mw(L.floating)>=1.5&&{willChange:"transform"}}:{position:e,left:W,top:fe}},[e,l,L.floating,f.x,f.y]);return w.useMemo(()=>({...f,update:te,refs:ue,elements:L,floatingStyles:j}),[f,te,ue,L,j])}const Ej=r=>{function t(e){return{}.hasOwnProperty.call(e,"current")}return{name:"arrow",options:r,fn(e){const{element:s,padding:n}=typeof r=="function"?r(e):r;return s&&t(s)?s.current!=null?_v({element:s.current,padding:n}).fn(e):{}:s?_v({element:s,padding:n}).fn(e):{}}}},Tj=(r,t)=>({...yj(r),options:[r,t]}),Aj=(r,t)=>({...vj(r),options:[r,t]}),Dj=(r,t)=>({...Cj(r),options:[r,t]}),_j=(r,t)=>({...bj(r),options:[r,t]}),Nj=(r,t)=>({...xj(r),options:[r,t]}),jj=(r,t)=>({...wj(r),options:[r,t]}),Pj=(r,t)=>({...Ej(r),options:[r,t]});var Lj="Arrow",Rw=w.forwardRef((r,t)=>{const{children:e,width:s=10,height:n=5,...i}=r;return g.jsx(De.svg,{...i,ref:t,width:s,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?e:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});Rw.displayName=Lj;var zj=Rw;function xu(r){const[t,e]=w.useState(void 0);return os(()=>{if(r){e({width:r.offsetWidth,height:r.offsetHeight});const s=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const i=n[0];let o,l;if("borderBoxSize"in i){const d=i.borderBoxSize,h=Array.isArray(d)?d[0]:d;o=h.inlineSize,l=h.blockSize}else o=r.offsetWidth,l=r.offsetHeight;e({width:o,height:l})});return s.observe(r,{box:"border-box"}),()=>s.unobserve(r)}else e(void 0)},[r]),t}var Rp="Popper",[kw,Ao]=ws(Rp),[Ij,Ew]=kw(Rp),Tw=r=>{const{__scopePopper:t,children:e}=r,[s,n]=w.useState(null);return g.jsx(Ij,{scope:t,anchor:s,onAnchorChange:n,children:e})};Tw.displayName=Rp;var Aw="PopperAnchor",Dw=w.forwardRef((r,t)=>{const{__scopePopper:e,virtualRef:s,...n}=r,i=Ew(Aw,e),o=w.useRef(null),l=je(t,o),d=w.useRef(null);return w.useEffect(()=>{const h=d.current;d.current=s?.current||o.current,h!==d.current&&i.onAnchorChange(d.current)}),s?null:g.jsx(De.div,{...n,ref:l})});Dw.displayName=Aw;var kp="PopperContent",[Oj,Hj]=kw(kp),_w=w.forwardRef((r,t)=>{const{__scopePopper:e,side:s="bottom",sideOffset:n=0,align:i="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:d=!0,collisionBoundary:h=[],collisionPadding:f=0,sticky:m="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:C,...S}=r,R=Ew(kp,e),[M,T]=w.useState(null),E=je(t,B=>T(B)),[A,_]=w.useState(null),N=xu(A),z=N?.width??0,q=N?.height??0,Z=s+(i!=="center"?"-"+i:""),ne=typeof f=="number"?f:{top:0,right:0,bottom:0,left:0,...f},ce=Array.isArray(h)?h:[h],J=ce.length>0,te={padding:ne,boundary:ce.filter($j),altBoundary:J},{refs:le,floatingStyles:ue,placement:L,isPositioned:j,middlewareData:O}=kj({strategy:"fixed",placement:Z,whileElementsMounted:(...B)=>mj(...B,{animationFrame:b==="always"}),elements:{reference:R.anchor},middleware:[Tj({mainAxis:n+q,alignmentAxis:o}),d&&Aj({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?Dj():void 0,...te}),d&&_j({...te}),Nj({...te,apply:({elements:B,rects:G,availableWidth:pe,availableHeight:me})=>{const{width:ye,height:ve}=G.reference,Pe=B.floating.style;Pe.setProperty("--radix-popper-available-width",`${pe}px`),Pe.setProperty("--radix-popper-available-height",`${me}px`),Pe.setProperty("--radix-popper-anchor-width",`${ye}px`),Pe.setProperty("--radix-popper-anchor-height",`${ve}px`)}}),A&&Pj({element:A,padding:l}),Bj({arrowWidth:z,arrowHeight:q}),y&&jj({strategy:"referenceHidden",...te})]}),[W,fe]=Pw(L),P=as(C);os(()=>{j&&P?.()},[j,P]);const F=O.arrow?.x,Y=O.arrow?.y,ie=O.arrow?.centerOffset!==0,[U,ae]=w.useState();return os(()=>{M&&ae(window.getComputedStyle(M).zIndex)},[M]),g.jsx("div",{ref:le.setFloating,"data-radix-popper-content-wrapper":"",style:{...ue,transform:j?ue.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:U,"--radix-popper-transform-origin":[O.transformOrigin?.x,O.transformOrigin?.y].join(" "),...O.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:g.jsx(Oj,{scope:e,placedSide:W,onArrowChange:_,arrowX:F,arrowY:Y,shouldHideArrow:ie,children:g.jsx(De.div,{"data-side":W,"data-align":fe,...S,ref:E,style:{...S.style,animation:j?void 0:"none"}})})})});_w.displayName=kp;var Nw="PopperArrow",qj={top:"bottom",right:"left",bottom:"top",left:"right"},jw=w.forwardRef(function(t,e){const{__scopePopper:s,...n}=t,i=Hj(Nw,s),o=qj[i.placedSide];return g.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:g.jsx(zj,{...n,ref:e,style:{...n.style,display:"block"}})})});jw.displayName=Nw;function $j(r){return r!==null}var Bj=r=>({name:"transformOrigin",options:r,fn(t){const{placement:e,rects:s,middlewareData:n}=t,o=n.arrow?.centerOffset!==0,l=o?0:r.arrowWidth,d=o?0:r.arrowHeight,[h,f]=Pw(e),m={start:"0%",center:"50%",end:"100%"}[f],y=(n.arrow?.x??0)+l/2,b=(n.arrow?.y??0)+d/2;let C="",S="";return h==="bottom"?(C=o?m:`${y}px`,S=`${-d}px`):h==="top"?(C=o?m:`${y}px`,S=`${s.floating.height+d}px`):h==="right"?(C=`${-d}px`,S=o?m:`${b}px`):h==="left"&&(C=`${s.floating.width+d}px`,S=o?m:`${b}px`),{data:{x:C,y:S}}}});function Pw(r){const[t,e="center"]=r.split("-");return[t,e]}var Ep=Tw,wu=Dw,Tp=_w,Ap=jw;function Uj(r){const t=Fj(r),e=w.forwardRef((s,n)=>{const{children:i,...o}=s,l=w.Children.toArray(i),d=l.find(Qj);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}function Fj(r){const t=w.forwardRef((e,s)=>{const{children:n,...i}=e;if(w.isValidElement(n)){const o=Kj(n),l=Gj(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var Vj=Symbol("radix.slottable");function Qj(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Vj}function Gj(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function Kj(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var Tf=["Enter"," "],Yj=["ArrowDown","PageUp","Home"],Lw=["ArrowUp","PageDown","End"],Wj=[...Yj,...Lw],Xj={ltr:[...Tf,"ArrowRight"],rtl:[...Tf,"ArrowLeft"]},Jj={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Yr="Menu",[Ir,Zj,eP]=hu(Yr),[Sa,zw]=ws(Yr,[eP,Ao,fu]),Cu=Ao(),Iw=fu(),[tP,Ma]=Sa(Yr),[sP,Wr]=Sa(Yr),Ow=r=>{const{__scopeMenu:t,open:e=!1,children:s,dir:n,onOpenChange:i,modal:o=!0}=r,l=Cu(t),[d,h]=w.useState(null),f=w.useRef(!1),m=as(i),y=ko(n);return w.useEffect(()=>{const b=()=>{f.current=!0,document.addEventListener("pointerdown",C,{capture:!0,once:!0}),document.addEventListener("pointermove",C,{capture:!0,once:!0})},C=()=>f.current=!1;return document.addEventListener("keydown",b,{capture:!0}),()=>{document.removeEventListener("keydown",b,{capture:!0}),document.removeEventListener("pointerdown",C,{capture:!0}),document.removeEventListener("pointermove",C,{capture:!0})}},[]),g.jsx(Ep,{...l,children:g.jsx(tP,{scope:t,open:e,onOpenChange:m,content:d,onContentChange:h,children:g.jsx(sP,{scope:t,onClose:w.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:f,dir:y,modal:o,children:s})})})};Ow.displayName=Yr;var nP="MenuAnchor",Dp=w.forwardRef((r,t)=>{const{__scopeMenu:e,...s}=r,n=Cu(e);return g.jsx(wu,{...n,...s,ref:t})});Dp.displayName=nP;var _p="MenuPortal",[iP,Hw]=Sa(_p,{forceMount:void 0}),qw=r=>{const{__scopeMenu:t,forceMount:e,children:s,container:n}=r,i=Ma(_p,t);return g.jsx(iP,{scope:t,forceMount:e,children:g.jsx(cs,{present:e||i.open,children:g.jsx(Vr,{asChild:!0,container:n,children:s})})})};qw.displayName=_p;var Ks="MenuContent",[aP,Np]=Sa(Ks),$w=w.forwardRef((r,t)=>{const e=Hw(Ks,r.__scopeMenu),{forceMount:s=e.forceMount,...n}=r,i=Ma(Ks,r.__scopeMenu),o=Wr(Ks,r.__scopeMenu);return g.jsx(Ir.Provider,{scope:r.__scopeMenu,children:g.jsx(cs,{present:s||i.open,children:g.jsx(Ir.Slot,{scope:r.__scopeMenu,children:o.modal?g.jsx(oP,{...n,ref:t}):g.jsx(rP,{...n,ref:t})})})})}),oP=w.forwardRef((r,t)=>{const e=Ma(Ks,r.__scopeMenu),s=w.useRef(null),n=je(t,s);return w.useEffect(()=>{const i=s.current;if(i)return au(i)},[]),g.jsx(jp,{...r,ref:n,trapFocus:e.open,disableOutsidePointerEvents:e.open,disableOutsideScroll:!0,onFocusOutside:ge(r.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>e.onOpenChange(!1)})}),rP=w.forwardRef((r,t)=>{const e=Ma(Ks,r.__scopeMenu);return g.jsx(jp,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>e.onOpenChange(!1)})}),cP=Uj("MenuContent.ScrollLock"),jp=w.forwardRef((r,t)=>{const{__scopeMenu:e,loop:s=!1,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:d,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:m,onInteractOutside:y,onDismiss:b,disableOutsideScroll:C,...S}=r,R=Ma(Ks,e),M=Wr(Ks,e),T=Cu(e),E=Iw(e),A=Zj(e),[_,N]=w.useState(null),z=w.useRef(null),q=je(t,z,R.onContentChange),Z=w.useRef(0),ne=w.useRef(""),ce=w.useRef(0),J=w.useRef(null),te=w.useRef("right"),le=w.useRef(0),ue=C?Qr:w.Fragment,L=C?{as:cP,allowPinchZoom:!0}:void 0,j=W=>{const fe=ne.current+W,P=A().filter(B=>!B.disabled),F=document.activeElement,Y=P.find(B=>B.ref.current===F)?.textValue,ie=P.map(B=>B.textValue),U=xP(ie,fe,Y),ae=P.find(B=>B.textValue===U)?.ref.current;(function B(G){ne.current=G,window.clearTimeout(Z.current),G!==""&&(Z.current=window.setTimeout(()=>B(""),1e3))})(fe),ae&&setTimeout(()=>ae.focus())};w.useEffect(()=>()=>window.clearTimeout(Z.current),[]),nu();const O=w.useCallback(W=>te.current===J.current?.side&&CP(W,J.current?.area),[]);return g.jsx(aP,{scope:e,searchRef:ne,onItemEnter:w.useCallback(W=>{O(W)&&W.preventDefault()},[O]),onItemLeave:w.useCallback(W=>{O(W)||(z.current?.focus(),N(null))},[O]),onTriggerLeave:w.useCallback(W=>{O(W)&&W.preventDefault()},[O]),pointerGraceTimerRef:ce,onPointerGraceIntentChange:w.useCallback(W=>{J.current=W},[]),children:g.jsx(ue,{...L,children:g.jsx(Fr,{asChild:!0,trapped:n,onMountAutoFocus:ge(i,W=>{W.preventDefault(),z.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:g.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:m,onInteractOutside:y,onDismiss:b,children:g.jsx(Zx,{asChild:!0,...E,dir:M.dir,orientation:"vertical",loop:s,currentTabStopId:_,onCurrentTabStopIdChange:N,onEntryFocus:ge(d,W=>{M.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(Tp,{role:"menu","aria-orientation":"vertical","data-state":nC(R.open),"data-radix-menu-content":"",dir:M.dir,...T,...S,ref:q,style:{outline:"none",...S.style},onKeyDown:ge(S.onKeyDown,W=>{const P=W.target.closest("[data-radix-menu-content]")===W.currentTarget,F=W.ctrlKey||W.altKey||W.metaKey,Y=W.key.length===1;P&&(W.key==="Tab"&&W.preventDefault(),!F&&Y&&j(W.key));const ie=z.current;if(W.target!==ie||!Wj.includes(W.key))return;W.preventDefault();const ae=A().filter(B=>!B.disabled).map(B=>B.ref.current);Lw.includes(W.key)&&ae.reverse(),vP(ae)}),onBlur:ge(r.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(Z.current),ne.current="")}),onPointerMove:ge(r.onPointerMove,Or(W=>{const fe=W.target,P=le.current!==W.clientX;if(W.currentTarget.contains(fe)&&P){const F=W.clientX>le.current?"right":"left";te.current=F,le.current=W.clientX}}))})})})})})})});$w.displayName=Ks;var lP="MenuGroup",Pp=w.forwardRef((r,t)=>{const{__scopeMenu:e,...s}=r;return g.jsx(De.div,{role:"group",...s,ref:t})});Pp.displayName=lP;var uP="MenuLabel",Bw=w.forwardRef((r,t)=>{const{__scopeMenu:e,...s}=r;return g.jsx(De.div,{...s,ref:t})});Bw.displayName=uP;var Gl="MenuItem",jv="menu.itemSelect",Su=w.forwardRef((r,t)=>{const{disabled:e=!1,onSelect:s,...n}=r,i=w.useRef(null),o=Wr(Gl,r.__scopeMenu),l=Np(Gl,r.__scopeMenu),d=je(t,i),h=w.useRef(!1),f=()=>{const m=i.current;if(!e&&m){const y=new CustomEvent(jv,{bubbles:!0,cancelable:!0});m.addEventListener(jv,b=>s?.(b),{once:!0}),Nb(m,y),y.defaultPrevented?h.current=!1:o.onClose()}};return g.jsx(Uw,{...n,ref:d,disabled:e,onClick:ge(r.onClick,f),onPointerDown:m=>{r.onPointerDown?.(m),h.current=!0},onPointerUp:ge(r.onPointerUp,m=>{h.current||m.currentTarget?.click()}),onKeyDown:ge(r.onKeyDown,m=>{const y=l.searchRef.current!=="";e||y&&m.key===" "||Tf.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Su.displayName=Gl;var Uw=w.forwardRef((r,t)=>{const{__scopeMenu:e,disabled:s=!1,textValue:n,...i}=r,o=Np(Gl,e),l=Iw(e),d=w.useRef(null),h=je(t,d),[f,m]=w.useState(!1),[y,b]=w.useState("");return w.useEffect(()=>{const C=d.current;C&&b((C.textContent??"").trim())},[i.children]),g.jsx(Ir.ItemSlot,{scope:e,disabled:s,textValue:n??y,children:g.jsx(ew,{asChild:!0,...l,focusable:!s,children:g.jsx(De.div,{role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:h,onPointerMove:ge(r.onPointerMove,Or(C=>{s?o.onItemLeave(C):(o.onItemEnter(C),C.defaultPrevented||C.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ge(r.onPointerLeave,Or(C=>o.onItemLeave(C))),onFocus:ge(r.onFocus,()=>m(!0)),onBlur:ge(r.onBlur,()=>m(!1))})})})}),dP="MenuCheckboxItem",Fw=w.forwardRef((r,t)=>{const{checked:e=!1,onCheckedChange:s,...n}=r;return g.jsx(Yw,{scope:r.__scopeMenu,checked:e,children:g.jsx(Su,{role:"menuitemcheckbox","aria-checked":Kl(e)?"mixed":e,...n,ref:t,"data-state":zp(e),onSelect:ge(n.onSelect,()=>s?.(Kl(e)?!0:!e),{checkForDefaultPrevented:!1})})})});Fw.displayName=dP;var Vw="MenuRadioGroup",[hP,fP]=Sa(Vw,{value:void 0,onValueChange:()=>{}}),Qw=w.forwardRef((r,t)=>{const{value:e,onValueChange:s,...n}=r,i=as(s);return g.jsx(hP,{scope:r.__scopeMenu,value:e,onValueChange:i,children:g.jsx(Pp,{...n,ref:t})})});Qw.displayName=Vw;var Gw="MenuRadioItem",Kw=w.forwardRef((r,t)=>{const{value:e,...s}=r,n=fP(Gw,r.__scopeMenu),i=e===n.value;return g.jsx(Yw,{scope:r.__scopeMenu,checked:i,children:g.jsx(Su,{role:"menuitemradio","aria-checked":i,...s,ref:t,"data-state":zp(i),onSelect:ge(s.onSelect,()=>n.onValueChange?.(e),{checkForDefaultPrevented:!1})})})});Kw.displayName=Gw;var Lp="MenuItemIndicator",[Yw,pP]=Sa(Lp,{checked:!1}),Ww=w.forwardRef((r,t)=>{const{__scopeMenu:e,forceMount:s,...n}=r,i=pP(Lp,e);return g.jsx(cs,{present:s||Kl(i.checked)||i.checked===!0,children:g.jsx(De.span,{...n,ref:t,"data-state":zp(i.checked)})})});Ww.displayName=Lp;var gP="MenuSeparator",Xw=w.forwardRef((r,t)=>{const{__scopeMenu:e,...s}=r;return g.jsx(De.div,{role:"separator","aria-orientation":"horizontal",...s,ref:t})});Xw.displayName=gP;var mP="MenuArrow",Jw=w.forwardRef((r,t)=>{const{__scopeMenu:e,...s}=r,n=Cu(e);return g.jsx(Ap,{...n,...s,ref:t})});Jw.displayName=mP;var yP="MenuSub",[e3,Zw]=Sa(yP),Er="MenuSubTrigger",eC=w.forwardRef((r,t)=>{const e=Ma(Er,r.__scopeMenu),s=Wr(Er,r.__scopeMenu),n=Zw(Er,r.__scopeMenu),i=Np(Er,r.__scopeMenu),o=w.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:d}=i,h={__scopeMenu:r.__scopeMenu},f=w.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return w.useEffect(()=>f,[f]),w.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),d(null)}},[l,d]),g.jsx(Dp,{asChild:!0,...h,children:g.jsx(Uw,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":e.open,"aria-controls":n.contentId,"data-state":nC(e.open),...r,ref:Tn(t,n.onTriggerChange),onClick:m=>{r.onClick?.(m),!(r.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),e.open||e.onOpenChange(!0))},onPointerMove:ge(r.onPointerMove,Or(m=>{i.onItemEnter(m),!m.defaultPrevented&&!r.disabled&&!e.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{e.onOpenChange(!0),f()},100))})),onPointerLeave:ge(r.onPointerLeave,Or(m=>{f();const y=e.content?.getBoundingClientRect();if(y){const b=e.content?.dataset.side,C=b==="right",S=C?-5:5,R=y[C?"left":"right"],M=y[C?"right":"left"];i.onPointerGraceIntentChange({area:[{x:m.clientX+S,y:m.clientY},{x:R,y:y.top},{x:M,y:y.top},{x:M,y:y.bottom},{x:R,y:y.bottom}],side:b}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(m),m.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:ge(r.onKeyDown,m=>{const y=i.searchRef.current!=="";r.disabled||y&&m.key===" "||Xj[s.dir].includes(m.key)&&(e.onOpenChange(!0),e.content?.focus(),m.preventDefault())})})})});eC.displayName=Er;var tC="MenuSubContent",sC=w.forwardRef((r,t)=>{const e=Hw(Ks,r.__scopeMenu),{forceMount:s=e.forceMount,...n}=r,i=Ma(Ks,r.__scopeMenu),o=Wr(Ks,r.__scopeMenu),l=Zw(tC,r.__scopeMenu),d=w.useRef(null),h=je(t,d);return g.jsx(Ir.Provider,{scope:r.__scopeMenu,children:g.jsx(cs,{present:s||i.open,children:g.jsx(Ir.Slot,{scope:r.__scopeMenu,children:g.jsx(jp,{id:l.contentId,"aria-labelledby":l.triggerId,...n,ref:h,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:f=>{o.isUsingKeyboardRef.current&&d.current?.focus(),f.preventDefault()},onCloseAutoFocus:f=>f.preventDefault(),onFocusOutside:ge(r.onFocusOutside,f=>{f.target!==l.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:ge(r.onEscapeKeyDown,f=>{o.onClose(),f.preventDefault()}),onKeyDown:ge(r.onKeyDown,f=>{const m=f.currentTarget.contains(f.target),y=Jj[o.dir].includes(f.key);m&&y&&(i.onOpenChange(!1),l.trigger?.focus(),f.preventDefault())})})})})})});sC.displayName=tC;function nC(r){return r?"open":"closed"}function Kl(r){return r==="indeterminate"}function zp(r){return Kl(r)?"indeterminate":r?"checked":"unchecked"}function vP(r){const t=document.activeElement;for(const e of r)if(e===t||(e.focus(),document.activeElement!==t))return}function bP(r,t){return r.map((e,s)=>r[(t+s)%r.length])}function xP(r,t,e){const n=t.length>1&&Array.from(t).every(h=>h===t[0])?t[0]:t,i=e?r.indexOf(e):-1;let o=bP(r,Math.max(i,0));n.length===1&&(o=o.filter(h=>h!==e));const d=o.find(h=>h.toLowerCase().startsWith(n.toLowerCase()));return d!==e?d:void 0}function wP(r,t){const{x:e,y:s}=r;let n=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const l=t[i],d=t[o],h=l.x,f=l.y,m=d.x,y=d.y;f>s!=y>s&&e<(m-h)*(s-f)/(y-f)+h&&(n=!n)}return n}function CP(r,t){if(!t)return!1;const e={x:r.clientX,y:r.clientY};return wP(e,t)}function Or(r){return t=>t.pointerType==="mouse"?r(t):void 0}var SP=Ow,MP=Dp,RP=qw,kP=$w,EP=Pp,TP=Bw,AP=Su,DP=Fw,_P=Qw,NP=Kw,jP=Ww,PP=Xw,LP=Jw,zP=eC,IP=sC,Mu="DropdownMenu",[OP]=ws(Mu,[zw]),hs=zw(),[HP,iC]=OP(Mu),aC=r=>{const{__scopeDropdownMenu:t,children:e,dir:s,open:n,defaultOpen:i,onOpenChange:o,modal:l=!0}=r,d=hs(t),h=w.useRef(null),[f,m]=kn({prop:n,defaultProp:i??!1,onChange:o,caller:Mu});return g.jsx(HP,{scope:t,triggerId:rn(),triggerRef:h,contentId:rn(),open:f,onOpenChange:m,onOpenToggle:w.useCallback(()=>m(y=>!y),[m]),modal:l,children:g.jsx(SP,{...d,open:f,onOpenChange:m,dir:s,modal:l,children:e})})};aC.displayName=Mu;var oC="DropdownMenuTrigger",rC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,disabled:s=!1,...n}=r,i=iC(oC,e),o=hs(e);return g.jsx(MP,{asChild:!0,...o,children:g.jsx(De.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...n,ref:Tn(t,i.triggerRef),onPointerDown:ge(r.onPointerDown,l=>{!s&&l.button===0&&l.ctrlKey===!1&&(i.onOpenToggle(),i.open||l.preventDefault())}),onKeyDown:ge(r.onKeyDown,l=>{s||(["Enter"," "].includes(l.key)&&i.onOpenToggle(),l.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});rC.displayName=oC;var qP="DropdownMenuPortal",cC=r=>{const{__scopeDropdownMenu:t,...e}=r,s=hs(t);return g.jsx(RP,{...s,...e})};cC.displayName=qP;var lC="DropdownMenuContent",uC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=iC(lC,e),i=hs(e),o=w.useRef(!1);return g.jsx(kP,{id:n.contentId,"aria-labelledby":n.triggerId,...i,...s,ref:t,onCloseAutoFocus:ge(r.onCloseAutoFocus,l=>{o.current||n.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:ge(r.onInteractOutside,l=>{const d=l.detail.originalEvent,h=d.button===0&&d.ctrlKey===!0,f=d.button===2||h;(!n.modal||f)&&(o.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});uC.displayName=lC;var $P="DropdownMenuGroup",BP=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(EP,{...n,...s,ref:t})});BP.displayName=$P;var UP="DropdownMenuLabel",dC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(TP,{...n,...s,ref:t})});dC.displayName=UP;var FP="DropdownMenuItem",hC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(AP,{...n,...s,ref:t})});hC.displayName=FP;var VP="DropdownMenuCheckboxItem",fC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(DP,{...n,...s,ref:t})});fC.displayName=VP;var QP="DropdownMenuRadioGroup",GP=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(_P,{...n,...s,ref:t})});GP.displayName=QP;var KP="DropdownMenuRadioItem",pC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(NP,{...n,...s,ref:t})});pC.displayName=KP;var YP="DropdownMenuItemIndicator",gC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(jP,{...n,...s,ref:t})});gC.displayName=YP;var WP="DropdownMenuSeparator",mC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(PP,{...n,...s,ref:t})});mC.displayName=WP;var XP="DropdownMenuArrow",JP=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(LP,{...n,...s,ref:t})});JP.displayName=XP;var ZP="DropdownMenuSubTrigger",yC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(zP,{...n,...s,ref:t})});yC.displayName=ZP;var eL="DropdownMenuSubContent",vC=w.forwardRef((r,t)=>{const{__scopeDropdownMenu:e,...s}=r,n=hs(e);return g.jsx(IP,{...n,...s,ref:t,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});vC.displayName=eL;var tL=aC,sL=rC,nL=cC,bC=uC,xC=dC,wC=hC,CC=fC,SC=pC,MC=gC,RC=mC,kC=yC,EC=vC;const iL=tL,aL=sL,oL=w.forwardRef(({className:r,inset:t,children:e,...s},n)=>g.jsxs(kC,{ref:n,className:ke("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",r),...s,children:[e,g.jsx(Wf,{className:"ml-auto"})]}));oL.displayName=kC.displayName;const rL=w.forwardRef(({className:r,...t},e)=>g.jsx(EC,{ref:e,className:ke("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",r),...t}));rL.displayName=EC.displayName;const TC=w.forwardRef(({className:r,sideOffset:t=4,...e},s)=>g.jsx(nL,{children:g.jsx(bC,{ref:s,sideOffset:t,className:ke("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",r),...e})}));TC.displayName=bC.displayName;const _l=w.forwardRef(({className:r,inset:t,...e},s)=>g.jsx(wC,{ref:s,className:ke("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",r),...e}));_l.displayName=wC.displayName;const cL=w.forwardRef(({className:r,children:t,checked:e,...s},n)=>g.jsxs(CC,{ref:n,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:e,...s,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(MC,{children:g.jsx(Yf,{className:"h-4 w-4"})})}),t]}));cL.displayName=CC.displayName;const lL=w.forwardRef(({className:r,children:t,...e},s)=>g.jsxs(SC,{ref:s,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...e,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(MC,{children:g.jsx(_A,{className:"h-2 w-2 fill-current"})})}),t]}));lL.displayName=SC.displayName;const Af=w.forwardRef(({className:r,inset:t,...e},s)=>g.jsx(xC,{ref:s,className:ke("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",r),...e}));Af.displayName=xC.displayName;const AC=w.forwardRef(({className:r,...t},e)=>g.jsx(RC,{ref:e,className:ke("-mx-1 my-1 h-px bg-muted",r),...t}));AC.displayName=RC.displayName;const DC="archiphoenix_component_library",Pv=()=>{if(typeof window>"u")return{favorites:[],collections:[]};try{const r=window.localStorage.getItem(DC);if(!r)return{favorites:[],collections:[]};const t=JSON.parse(r);return{favorites:Array.isArray(t.favorites)?t.favorites:[],collections:Array.isArray(t.collections)?t.collections:[]}}catch(r){return bb("Failed to load component library state",r instanceof Error?r:new Error(String(r))),{favorites:[],collections:[]}}},go=r=>{typeof window>"u"||window.localStorage.setItem(DC,JSON.stringify(r))},uL=un((r,t)=>({favorites:Pv().favorites,collections:Pv().collections,toggleFavorite:e=>{r(s=>{const i=s.favorites.includes(e)?s.favorites.filter(o=>o!==e):[...s.favorites,e];return go({favorites:i,collections:s.collections}),{favorites:i}})},createCollection:e=>{const s=e.trim();if(!s)return null;const n={id:`collection-${Date.now()}`,name:s,componentIds:[]};return r(i=>{const o=[...i.collections,n];return go({favorites:i.favorites,collections:o}),{collections:o}}),n.id},renameCollection:(e,s)=>{r(n=>{const i=n.collections.map(o=>o.id===e?{...o,name:s}:o);return go({favorites:n.favorites,collections:i}),{collections:i}})},deleteCollection:e=>{r(s=>{const n=s.collections.filter(i=>i.id!==e);return go({favorites:s.favorites,collections:n}),{collections:n}})},addComponentToCollection:(e,s)=>{r(n=>{const i=n.collections.map(o=>o.id!==e||o.componentIds.includes(s)?o:{...o,componentIds:[...o.componentIds,s]});return go({favorites:n.favorites,collections:i}),{collections:i}})},removeComponentFromCollection:(e,s)=>{r(n=>{const i=n.collections.map(o=>o.id!==e?o:{...o,componentIds:o.componentIds.filter(l=>l!==s)});return go({favorites:n.favorites,collections:i}),{collections:i}})}}));function Lv({open:r,initialName:t="",onConfirm:e,onCancel:s}){const[n,i]=w.useState(t);w.useEffect(()=>{r&&i(t)},[r,t]);const o=()=>{n.trim()&&e(n.trim())};return g.jsx(gp,{open:r,onOpenChange:l=>!l&&s(),children:g.jsxs(ru,{children:[g.jsxs(cu,{children:[g.jsx(uu,{children:t?"Rename Collection":"Create Collection"}),g.jsx(du,{children:t?"Enter a new name for the collection":"Enter a name for the new collection"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(nt,{htmlFor:"collection-name",children:"Collection Name"}),g.jsx(Tt,{id:"collection-name",value:n,onChange:l=>i(l.target.value),onKeyDown:l=>{l.key==="Enter"&&o()},className:"mt-2",autoFocus:!0})]}),g.jsxs(lu,{children:[g.jsx(Ee,{variant:"outline",onClick:s,children:"Cancel"}),g.jsx(Ee,{onClick:o,disabled:!n.trim(),children:t?"Save":"Create"})]})]})})}function dL(){const[r,t]=w.useState(""),[e,s]=w.useState("all"),[n,i]=w.useState(!1),[o,l]=w.useState(!1),[d,h]=w.useState(null),[f,m]=w.useState(null),[y,b]=w.useState(180),[C,S]=w.useState(!1),R=w.useRef(null),[M,T]=w.useState(()=>{const U=localStorage.getItem("sidebar-expanded-categories");if(U)try{const ae=JSON.parse(U);return Mr.reduce((B,G)=>(B[G.id]=ae[G.id]!==void 0?ae[G.id]:!0,B),{})}catch{}return Mr.reduce((ae,B)=>(ae[B.id]=!0,ae),{})}),{favorites:E,collections:A,toggleFavorite:_,createCollection:N,renameCollection:z,deleteCollection:q,addComponentToCollection:Z,removeComponentFromCollection:ne}=uL(),ce=U=>{T(ae=>({...ae,[U]:!ae[U]}))},J=r.toLowerCase(),te=w.useMemo(()=>Pr.filter(U=>U.label.toLowerCase().includes(J)),[J]),le=w.useMemo(()=>te.filter(U=>E.includes(U.id)),[E,te]),ue=(U,ae)=>{U.dataTransfer.setData("application/json",JSON.stringify(ae)),U.dataTransfer.effectAllowed="copy"},L=()=>{h(null),i(!0)},j=U=>{if(d)z(d.id,U),h(null);else{if(A.some(G=>G.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}N(U)||alert("Failed to create collection")}i(!1)},O=()=>{i(!1),h(null)},W=U=>{m(U),h(null),l(!0)},fe=U=>{if(!f)return;if(A.some(G=>G.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}const B=N(U);B?Z(B,f):alert("Failed to create collection"),l(!1),m(null)},P=()=>{l(!1),m(null)},F=U=>{h(U),i(!0)};w.useEffect(()=>{localStorage.setItem("sidebar-expanded-categories",JSON.stringify(M))},[M]),w.useEffect(()=>{if(!C)return;const U=B=>{if(!R.current)return;const G=R.current.closest(".h-full");if(!G)return;const pe=G.getBoundingClientRect();R.current.getBoundingClientRect();const me=pe.bottom-B.clientY,ye=70,ve=pe.height*.8;b(Math.max(ye,Math.min(ve,me)))},ae=()=>{S(!1)};return document.addEventListener("mousemove",U),document.addEventListener("mouseup",ae),()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",ae)}},[C]);const Y=(U,ae)=>{const B=E.includes(U.id);return g.jsxs("div",{draggable:!0,onDragStart:G=>ue(G,U),className:`flex items-center gap-1 px-1 ${ae?.compact?"py-0.5 text-[10px]":"py-1 text-xs"} rounded-md bg-secondary/50 hover:bg-secondary cursor-move transition-colors border border-border/50`,children:[g.jsxs("div",{className:"flex items-center gap-0.5 flex-1 min-w-0",children:[g.jsx("span",{className:"text-sm flex-shrink-0",children:U.icon}),g.jsx("span",{className:"text-foreground truncate min-w-0",children:U.label})]}),g.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[g.jsx("button",{type:"button",onClick:G=>{G.preventDefault(),G.stopPropagation(),_(U.id)},onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:B?"Remove from favorites":"Add to favorites",children:g.jsx(SD,{className:`h-4 w-4 ${B?"text-yellow-400":"text-muted-foreground"}`,fill:B?"currentColor":"none"})}),g.jsxs(iL,{children:[g.jsx(aL,{asChild:!0,children:g.jsx("button",{type:"button",onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Add to collection",children:g.jsx(Hl,{className:"h-4 w-4 text-muted-foreground"})})}),g.jsxs(TC,{align:"end",className:"w-48",children:[A.length===0&&g.jsxs(g.Fragment,{children:[g.jsx(Af,{children:"No collections"}),g.jsxs(_l,{onSelect:G=>{G.preventDefault(),W(U.id)},children:[g.jsx(xf,{className:"h-4 w-4 mr-2"}),"Create and add"]})]}),A.length>0&&g.jsxs(g.Fragment,{children:[g.jsx(Af,{children:"Add to collection"}),A.map(G=>g.jsx(_l,{onSelect:pe=>{pe.preventDefault(),Z(G.id,U.id)},children:G.name},G.id)),g.jsx(AC,{}),g.jsxs(_l,{onSelect:G=>{G.preventDefault(),W(U.id)},children:[g.jsx(xf,{className:"h-4 w-4 mr-2"}),"New collection"]})]})]})]}),ae?.onRemove&&g.jsx("button",{type:"button",onClick:G=>{G.preventDefault(),G.stopPropagation(),ae.onRemove?.()},onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Remove from collection",children:g.jsx(on,{className:"h-4 w-4 text-muted-foreground"})})]})]},`${U.id}-${ae?.compact?"compact":"default"}`)},ie=e==="all"?Mr:Mr.filter(U=>U.id===e);return g.jsxs("div",{className:"w-60 h-full bg-sidebar-bg border-r border-border flex flex-col",children:[g.jsxs("div",{className:"p-3 border-b border-border",children:[g.jsx("h2",{className:"text-xs font-semibold text-foreground mb-2",children:"Components"}),g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),g.jsx(Tt,{type:"text",placeholder:"Search...",value:r,onChange:U=>t(U.target.value),className:"pl-7 h-8 text-xs"})]})]}),g.jsx("div",{className:"px-3 py-1.5 border-b border-border pb-2",children:g.jsx(vp,{value:e,onValueChange:s,children:g.jsxs(is,{orientation:"horizontal",className:"w-full",children:[g.jsxs(gu,{className:"flex w-max gap-0.5",children:[g.jsx(sn,{value:"all",className:"text-xs px-2 py-1",children:"All"}),Mr.map(U=>g.jsx(sn,{value:U.id,className:"text-xs px-2 py-1",children:U.icon},U.id))]}),g.jsx(su,{orientation:"horizontal",className:"data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30 [&>[data-radix-scroll-area-thumb]]:bg-accent/80 hover:[&>[data-radix-scroll-area-thumb]]:bg-accent rounded-full",style:{transition:"none"}})]})})}),le.length>0&&g.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsx("span",{className:"text-[10px] font-semibold uppercase text-muted-foreground",children:"Favorites"}),g.jsx("span",{className:"text-[10px] text-muted-foreground",children:le.length})]}),g.jsx("div",{className:"space-y-1",children:le.map(U=>Y(U,{compact:!0}))})]}),g.jsx(is,{className:"flex-1",children:g.jsx("div",{className:"pl-3 pr-6 py-2",children:ie.map(U=>{const ae=te.filter(B=>B.category===U.id);return ae.length===0&&r?null:g.jsxs("div",{className:"mb-1.5",children:[g.jsxs(Ee,{variant:"ghost",className:"w-full justify-start px-1 h-7 text-xs",onClick:()=>ce(U.id),children:[M[U.id]?g.jsx(Jl,{className:"h-3.5 w-3.5 mr-0.5"}):g.jsx(Wf,{className:"h-3.5 w-3.5 mr-0.5"}),g.jsx("span",{className:"mr-1",children:U.icon}),g.jsx("span",{className:"flex-1 text-left truncate min-w-0 mr-1",children:U.label}),g.jsx("span",{className:"text-[10px] text-muted-foreground flex-shrink-0",children:ae.length})]}),M[U.id]&&g.jsx("div",{className:"ml-1.5 mt-1 space-y-1",children:ae.map(B=>Y(B,{compact:!0}))})]},U.id)})})}),g.jsx("div",{ref:R,className:"h-2 border-t border-border cursor-row-resize hover:bg-accent/50 transition-colors relative group flex items-center justify-center",onMouseDown:U=>{U.preventDefault(),S(!0)},style:{userSelect:"none"},children:g.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:g.jsx(UA,{className:"h-3 w-3 text-muted-foreground"})})}),g.jsxs("div",{className:"border-t border-border overflow-hidden flex flex-col",style:{height:`${y}px`},children:[g.jsx("div",{className:"p-2 pb-1.5 flex-shrink-0",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-[10px] uppercase font-semibold text-muted-foreground",children:"Collections"}),g.jsxs(Ee,{size:"xs",variant:"outline",className:"h-6 text-[10px] px-2",onClick:U=>{U.preventDefault(),U.stopPropagation(),L()},type:"button",children:[g.jsx(Hl,{className:"h-3 w-3 mr-0.5"}),"New"]})]})}),g.jsx(is,{className:"flex-1",children:g.jsx("div",{className:"pl-1.5 pr-4 pb-2 space-y-1.5",children:A.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground px-0.5",children:"Create collections to quickly build typical architectures."}):A.map(U=>{const ae=U.componentIds.map(B=>Pr.find(G=>G.id===B)).filter(B=>!!B).filter(B=>B.label.toLowerCase().includes(J));return g.jsxs("div",{className:"rounded-md border border-border/60 p-1.5",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:U.name}),g.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[ae.length," items"]})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Ee,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Rename",onClick:()=>F(U),children:""}),g.jsx(Ee,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Delete collection",onClick:()=>q(U.id),children:g.jsx(on,{className:"h-4 w-4"})})]})]}),ae.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground",children:'Add components via "+" menu.'}):g.jsx("div",{className:"space-y-1",children:ae.map(B=>Y(B,{compact:!0,onRemove:()=>ne(U.id,B.id)}))})]},U.id)})})})]}),g.jsx(Lv,{open:n,initialName:d?.name||"",onConfirm:j,onCancel:O}),g.jsx(Lv,{open:o,initialName:"",onConfirm:fe,onCancel:P})]})}const Ru=un(r=>({tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}],addTab:t=>r(e=>{if(t.componentId){const n=e.tabs.find(i=>i.componentId===t.componentId);if(n)return{tabs:e.tabs.map(i=>({...i,active:i.id===n.id}))}}const s={...t,id:`${t.type}-${Date.now()}`,active:!0};return{tabs:[...e.tabs.map(n=>({...n,active:!1})),s]}}),closeTab:t=>r(e=>{const s=e.tabs.filter(o=>o.id!==t);if(s.length===0)return{tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}]};const n=e.tabs.findIndex(o=>o.id===t);if(e.tabs[n]?.active&&s.length>0){const o=Math.min(n,s.length-1);s[o].active=!0}return{tabs:s}}),setActiveTab:t=>r(e=>({tabs:e.tabs.map(s=>({...s,active:s.id===t}))})),updateTab:(t,e)=>r(s=>({tabs:s.tabs.map(n=>n.id===t?{...n,...e}:n)}))}));function hL(r){const t=fL(r),e=w.forwardRef((s,n)=>{const{children:i,...o}=s,l=w.Children.toArray(i),d=l.find(gL);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}function fL(r){const t=w.forwardRef((e,s)=>{const{children:n,...i}=e;if(w.isValidElement(n)){const o=yL(n),l=mL(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var pL=Symbol("radix.slottable");function gL(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===pL}function mL(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function yL(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}function ku(r){const t=w.useRef({value:r,previous:r});return w.useMemo(()=>(t.current.value!==r&&(t.current.previous=t.current.value,t.current.value=r),t.current.previous),[r])}var _C=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),vL="VisuallyHidden",bL=w.forwardRef((r,t)=>g.jsx(De.span,{...r,ref:t,style:{..._C,...r.style}}));bL.displayName=vL;var xL=[" ","Enter","ArrowUp","ArrowDown"],wL=[" ","Enter"],wa="Select",[Eu,Tu,CL]=hu(wa),[Do]=ws(wa,[CL,Ao]),Au=Ao(),[SL,$i]=Do(wa),[ML,RL]=Do(wa),NC=r=>{const{__scopeSelect:t,children:e,open:s,defaultOpen:n,onOpenChange:i,value:o,defaultValue:l,onValueChange:d,dir:h,name:f,autoComplete:m,disabled:y,required:b,form:C}=r,S=Au(t),[R,M]=w.useState(null),[T,E]=w.useState(null),[A,_]=w.useState(!1),N=ko(h),[z,q]=kn({prop:s,defaultProp:n??!1,onChange:i,caller:wa}),[Z,ne]=kn({prop:o,defaultProp:l,onChange:d,caller:wa}),ce=w.useRef(null),J=R?C||!!R.closest("form"):!0,[te,le]=w.useState(new Set),ue=Array.from(te).map(L=>L.props.value).join(";");return g.jsx(Ep,{...S,children:g.jsxs(SL,{required:b,scope:t,trigger:R,onTriggerChange:M,valueNode:T,onValueNodeChange:E,valueNodeHasChildren:A,onValueNodeHasChildrenChange:_,contentId:rn(),value:Z,onValueChange:ne,open:z,onOpenChange:q,dir:N,triggerPointerDownPosRef:ce,disabled:y,children:[g.jsx(Eu.Provider,{scope:t,children:g.jsx(ML,{scope:r.__scopeSelect,onNativeOptionAdd:w.useCallback(L=>{le(j=>new Set(j).add(L))},[]),onNativeOptionRemove:w.useCallback(L=>{le(j=>{const O=new Set(j);return O.delete(L),O})},[]),children:e})}),J?g.jsxs(sS,{"aria-hidden":!0,required:b,tabIndex:-1,name:f,autoComplete:m,value:Z,onChange:L=>ne(L.target.value),disabled:y,form:C,children:[Z===void 0?g.jsx("option",{value:""}):null,Array.from(te)]},ue):null]})})};NC.displayName=wa;var jC="SelectTrigger",PC=w.forwardRef((r,t)=>{const{__scopeSelect:e,disabled:s=!1,...n}=r,i=Au(e),o=$i(jC,e),l=o.disabled||s,d=je(t,o.onTriggerChange),h=Tu(e),f=w.useRef("touch"),[m,y,b]=iS(S=>{const R=h().filter(E=>!E.disabled),M=R.find(E=>E.value===o.value),T=aS(R,S,M);T!==void 0&&o.onValueChange(T.value)}),C=S=>{l||(o.onOpenChange(!0),b()),S&&(o.triggerPointerDownPosRef.current={x:Math.round(S.pageX),y:Math.round(S.pageY)})};return g.jsx(wu,{asChild:!0,...i,children:g.jsx(De.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":nS(o.value)?"":void 0,...n,ref:d,onClick:ge(n.onClick,S=>{S.currentTarget.focus(),f.current!=="mouse"&&C(S)}),onPointerDown:ge(n.onPointerDown,S=>{f.current=S.pointerType;const R=S.target;R.hasPointerCapture(S.pointerId)&&R.releasePointerCapture(S.pointerId),S.button===0&&S.ctrlKey===!1&&S.pointerType==="mouse"&&(C(S),S.preventDefault())}),onKeyDown:ge(n.onKeyDown,S=>{const R=m.current!=="";!(S.ctrlKey||S.altKey||S.metaKey)&&S.key.length===1&&y(S.key),!(R&&S.key===" ")&&xL.includes(S.key)&&(C(),S.preventDefault())})})})});PC.displayName=jC;var LC="SelectValue",zC=w.forwardRef((r,t)=>{const{__scopeSelect:e,className:s,style:n,children:i,placeholder:o="",...l}=r,d=$i(LC,e),{onValueNodeHasChildrenChange:h}=d,f=i!==void 0,m=je(t,d.onValueNodeChange);return os(()=>{h(f)},[h,f]),g.jsx(De.span,{...l,ref:m,style:{pointerEvents:"none"},children:nS(d.value)?g.jsx(g.Fragment,{children:o}):i})});zC.displayName=LC;var kL="SelectIcon",IC=w.forwardRef((r,t)=>{const{__scopeSelect:e,children:s,...n}=r;return g.jsx(De.span,{"aria-hidden":!0,...n,ref:t,children:s||""})});IC.displayName=kL;var EL="SelectPortal",OC=r=>g.jsx(Vr,{asChild:!0,...r});OC.displayName=EL;var Ca="SelectContent",HC=w.forwardRef((r,t)=>{const e=$i(Ca,r.__scopeSelect),[s,n]=w.useState();if(os(()=>{n(new DocumentFragment)},[]),!e.open){const i=s;return i?qr.createPortal(g.jsx(qC,{scope:r.__scopeSelect,children:g.jsx(Eu.Slot,{scope:r.__scopeSelect,children:g.jsx("div",{children:r.children})})}),i):null}return g.jsx($C,{...r,ref:t})});HC.displayName=Ca;var tn=10,[qC,Bi]=Do(Ca),TL="SelectContentImpl",AL=hL("SelectContent.RemoveScroll"),$C=w.forwardRef((r,t)=>{const{__scopeSelect:e,position:s="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:i,onPointerDownOutside:o,side:l,sideOffset:d,align:h,alignOffset:f,arrowPadding:m,collisionBoundary:y,collisionPadding:b,sticky:C,hideWhenDetached:S,avoidCollisions:R,...M}=r,T=$i(Ca,e),[E,A]=w.useState(null),[_,N]=w.useState(null),z=je(t,B=>A(B)),[q,Z]=w.useState(null),[ne,ce]=w.useState(null),J=Tu(e),[te,le]=w.useState(!1),ue=w.useRef(!1);w.useEffect(()=>{if(E)return au(E)},[E]),nu();const L=w.useCallback(B=>{const[G,...pe]=J().map(ve=>ve.ref.current),[me]=pe.slice(-1),ye=document.activeElement;for(const ve of B)if(ve===ye||(ve?.scrollIntoView({block:"nearest"}),ve===G&&_&&(_.scrollTop=0),ve===me&&_&&(_.scrollTop=_.scrollHeight),ve?.focus(),document.activeElement!==ye))return},[J,_]),j=w.useCallback(()=>L([q,E]),[L,q,E]);w.useEffect(()=>{te&&j()},[te,j]);const{onOpenChange:O,triggerPointerDownPosRef:W}=T;w.useEffect(()=>{if(E){let B={x:0,y:0};const G=me=>{B={x:Math.abs(Math.round(me.pageX)-(W.current?.x??0)),y:Math.abs(Math.round(me.pageY)-(W.current?.y??0))}},pe=me=>{B.x<=10&&B.y<=10?me.preventDefault():E.contains(me.target)||O(!1),document.removeEventListener("pointermove",G),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",G),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",G),document.removeEventListener("pointerup",pe,{capture:!0})}}},[E,O,W]),w.useEffect(()=>{const B=()=>O(!1);return window.addEventListener("blur",B),window.addEventListener("resize",B),()=>{window.removeEventListener("blur",B),window.removeEventListener("resize",B)}},[O]);const[fe,P]=iS(B=>{const G=J().filter(ye=>!ye.disabled),pe=G.find(ye=>ye.ref.current===document.activeElement),me=aS(G,B,pe);me&&setTimeout(()=>me.ref.current.focus())}),F=w.useCallback((B,G,pe)=>{const me=!ue.current&&!pe;(T.value!==void 0&&T.value===G||me)&&(Z(B),me&&(ue.current=!0))},[T.value]),Y=w.useCallback(()=>E?.focus(),[E]),ie=w.useCallback((B,G,pe)=>{const me=!ue.current&&!pe;(T.value!==void 0&&T.value===G||me)&&ce(B)},[T.value]),U=s==="popper"?Df:BC,ae=U===Df?{side:l,sideOffset:d,align:h,alignOffset:f,arrowPadding:m,collisionBoundary:y,collisionPadding:b,sticky:C,hideWhenDetached:S,avoidCollisions:R}:{};return g.jsx(qC,{scope:e,content:E,viewport:_,onViewportChange:N,itemRefCallback:F,selectedItem:q,onItemLeave:Y,itemTextRefCallback:ie,focusSelectedItem:j,selectedItemText:ne,position:s,isPositioned:te,searchRef:fe,children:g.jsx(Qr,{as:AL,allowPinchZoom:!0,children:g.jsx(Fr,{asChild:!0,trapped:T.open,onMountAutoFocus:B=>{B.preventDefault()},onUnmountAutoFocus:ge(n,B=>{T.trigger?.focus({preventScroll:!0}),B.preventDefault()}),children:g.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:B=>B.preventDefault(),onDismiss:()=>T.onOpenChange(!1),children:g.jsx(U,{role:"listbox",id:T.contentId,"data-state":T.open?"open":"closed",dir:T.dir,onContextMenu:B=>B.preventDefault(),...M,...ae,onPlaced:()=>le(!0),ref:z,style:{display:"flex",flexDirection:"column",outline:"none",...M.style},onKeyDown:ge(M.onKeyDown,B=>{const G=B.ctrlKey||B.altKey||B.metaKey;if(B.key==="Tab"&&B.preventDefault(),!G&&B.key.length===1&&P(B.key),["ArrowUp","ArrowDown","Home","End"].includes(B.key)){let me=J().filter(ye=>!ye.disabled).map(ye=>ye.ref.current);if(["ArrowUp","End"].includes(B.key)&&(me=me.slice().reverse()),["ArrowUp","ArrowDown"].includes(B.key)){const ye=B.target,ve=me.indexOf(ye);me=me.slice(ve+1)}setTimeout(()=>L(me)),B.preventDefault()}})})})})})})});$C.displayName=TL;var DL="SelectItemAlignedPosition",BC=w.forwardRef((r,t)=>{const{__scopeSelect:e,onPlaced:s,...n}=r,i=$i(Ca,e),o=Bi(Ca,e),[l,d]=w.useState(null),[h,f]=w.useState(null),m=je(t,z=>f(z)),y=Tu(e),b=w.useRef(!1),C=w.useRef(!0),{viewport:S,selectedItem:R,selectedItemText:M,focusSelectedItem:T}=o,E=w.useCallback(()=>{if(i.trigger&&i.valueNode&&l&&h&&S&&R&&M){const z=i.trigger.getBoundingClientRect(),q=h.getBoundingClientRect(),Z=i.valueNode.getBoundingClientRect(),ne=M.getBoundingClientRect();if(i.dir!=="rtl"){const ye=ne.left-q.left,ve=Z.left-ye,Pe=z.left-ve,Be=z.width+Pe,at=Math.max(Be,q.width),Je=window.innerWidth-tn,jt=jr(ve,[tn,Math.max(tn,Je-at)]);l.style.minWidth=Be+"px",l.style.left=jt+"px"}else{const ye=q.right-ne.right,ve=window.innerWidth-Z.right-ye,Pe=window.innerWidth-z.right-ve,Be=z.width+Pe,at=Math.max(Be,q.width),Je=window.innerWidth-tn,jt=jr(ve,[tn,Math.max(tn,Je-at)]);l.style.minWidth=Be+"px",l.style.right=jt+"px"}const ce=y(),J=window.innerHeight-tn*2,te=S.scrollHeight,le=window.getComputedStyle(h),ue=parseInt(le.borderTopWidth,10),L=parseInt(le.paddingTop,10),j=parseInt(le.borderBottomWidth,10),O=parseInt(le.paddingBottom,10),W=ue+L+te+O+j,fe=Math.min(R.offsetHeight*5,W),P=window.getComputedStyle(S),F=parseInt(P.paddingTop,10),Y=parseInt(P.paddingBottom,10),ie=z.top+z.height/2-tn,U=J-ie,ae=R.offsetHeight/2,B=R.offsetTop+ae,G=ue+L+B,pe=W-G;if(G<=ie){const ye=ce.length>0&&R===ce[ce.length-1].ref.current;l.style.bottom="0px";const ve=h.clientHeight-S.offsetTop-S.offsetHeight,Pe=Math.max(U,ae+(ye?Y:0)+ve+j),Be=G+Pe;l.style.height=Be+"px"}else{const ye=ce.length>0&&R===ce[0].ref.current;l.style.top="0px";const Pe=Math.max(ie,ue+S.offsetTop+(ye?F:0)+ae)+pe;l.style.height=Pe+"px",S.scrollTop=G-ie+S.offsetTop}l.style.margin=`${tn}px 0`,l.style.minHeight=fe+"px",l.style.maxHeight=J+"px",s?.(),requestAnimationFrame(()=>b.current=!0)}},[y,i.trigger,i.valueNode,l,h,S,R,M,i.dir,s]);os(()=>E(),[E]);const[A,_]=w.useState();os(()=>{h&&_(window.getComputedStyle(h).zIndex)},[h]);const N=w.useCallback(z=>{z&&C.current===!0&&(E(),T?.(),C.current=!1)},[E,T]);return g.jsx(NL,{scope:e,contentWrapper:l,shouldExpandOnScrollRef:b,onScrollButtonChange:N,children:g.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:g.jsx(De.div,{...n,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});BC.displayName=DL;var _L="SelectPopperPosition",Df=w.forwardRef((r,t)=>{const{__scopeSelect:e,align:s="start",collisionPadding:n=tn,...i}=r,o=Au(e);return g.jsx(Tp,{...o,...i,ref:t,align:s,collisionPadding:n,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Df.displayName=_L;var[NL,Ip]=Do(Ca,{}),_f="SelectViewport",UC=w.forwardRef((r,t)=>{const{__scopeSelect:e,nonce:s,...n}=r,i=Bi(_f,e),o=Ip(_f,e),l=je(t,i.onViewportChange),d=w.useRef(0);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),g.jsx(Eu.Slot,{scope:e,children:g.jsx(De.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:ge(n.onScroll,h=>{const f=h.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:y}=o;if(y?.current&&m){const b=Math.abs(d.current-f.scrollTop);if(b>0){const C=window.innerHeight-tn*2,S=parseFloat(m.style.minHeight),R=parseFloat(m.style.height),M=Math.max(S,R);if(M<C){const T=M+b,E=Math.min(C,T),A=T-E;m.style.height=E+"px",m.style.bottom==="0px"&&(f.scrollTop=A>0?A:0,m.style.justifyContent="flex-end")}}}d.current=f.scrollTop})})})]})});UC.displayName=_f;var FC="SelectGroup",[jL,PL]=Do(FC),LL=w.forwardRef((r,t)=>{const{__scopeSelect:e,...s}=r,n=rn();return g.jsx(jL,{scope:e,id:n,children:g.jsx(De.div,{role:"group","aria-labelledby":n,...s,ref:t})})});LL.displayName=FC;var VC="SelectLabel",QC=w.forwardRef((r,t)=>{const{__scopeSelect:e,...s}=r,n=PL(VC,e);return g.jsx(De.div,{id:n.id,...s,ref:t})});QC.displayName=VC;var Yl="SelectItem",[zL,GC]=Do(Yl),KC=w.forwardRef((r,t)=>{const{__scopeSelect:e,value:s,disabled:n=!1,textValue:i,...o}=r,l=$i(Yl,e),d=Bi(Yl,e),h=l.value===s,[f,m]=w.useState(i??""),[y,b]=w.useState(!1),C=je(t,T=>d.itemRefCallback?.(T,s,n)),S=rn(),R=w.useRef("touch"),M=()=>{n||(l.onValueChange(s),l.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return g.jsx(zL,{scope:e,value:s,disabled:n,textId:S,isSelected:h,onItemTextChange:w.useCallback(T=>{m(E=>E||(T?.textContent??"").trim())},[]),children:g.jsx(Eu.ItemSlot,{scope:e,value:s,disabled:n,textValue:f,children:g.jsx(De.div,{role:"option","aria-labelledby":S,"data-highlighted":y?"":void 0,"aria-selected":h&&y,"data-state":h?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...o,ref:C,onFocus:ge(o.onFocus,()=>b(!0)),onBlur:ge(o.onBlur,()=>b(!1)),onClick:ge(o.onClick,()=>{R.current!=="mouse"&&M()}),onPointerUp:ge(o.onPointerUp,()=>{R.current==="mouse"&&M()}),onPointerDown:ge(o.onPointerDown,T=>{R.current=T.pointerType}),onPointerMove:ge(o.onPointerMove,T=>{R.current=T.pointerType,n?d.onItemLeave?.():R.current==="mouse"&&T.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ge(o.onPointerLeave,T=>{T.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:ge(o.onKeyDown,T=>{d.searchRef?.current!==""&&T.key===" "||(wL.includes(T.key)&&M(),T.key===" "&&T.preventDefault())})})})})});KC.displayName=Yl;var Tr="SelectItemText",YC=w.forwardRef((r,t)=>{const{__scopeSelect:e,className:s,style:n,...i}=r,o=$i(Tr,e),l=Bi(Tr,e),d=GC(Tr,e),h=RL(Tr,e),[f,m]=w.useState(null),y=je(t,M=>m(M),d.onItemTextChange,M=>l.itemTextRefCallback?.(M,d.value,d.disabled)),b=f?.textContent,C=w.useMemo(()=>g.jsx("option",{value:d.value,disabled:d.disabled,children:b},d.value),[d.disabled,d.value,b]),{onNativeOptionAdd:S,onNativeOptionRemove:R}=h;return os(()=>(S(C),()=>R(C)),[S,R,C]),g.jsxs(g.Fragment,{children:[g.jsx(De.span,{id:d.textId,...i,ref:y}),d.isSelected&&o.valueNode&&!o.valueNodeHasChildren?qr.createPortal(i.children,o.valueNode):null]})});YC.displayName=Tr;var WC="SelectItemIndicator",XC=w.forwardRef((r,t)=>{const{__scopeSelect:e,...s}=r;return GC(WC,e).isSelected?g.jsx(De.span,{"aria-hidden":!0,...s,ref:t}):null});XC.displayName=WC;var Nf="SelectScrollUpButton",JC=w.forwardRef((r,t)=>{const e=Bi(Nf,r.__scopeSelect),s=Ip(Nf,r.__scopeSelect),[n,i]=w.useState(!1),o=je(t,s.onScrollButtonChange);return os(()=>{if(e.viewport&&e.isPositioned){let l=function(){const h=d.scrollTop>0;i(h)};const d=e.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[e.viewport,e.isPositioned]),n?g.jsx(eS,{...r,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=e;l&&d&&(l.scrollTop=l.scrollTop-d.offsetHeight)}}):null});JC.displayName=Nf;var jf="SelectScrollDownButton",ZC=w.forwardRef((r,t)=>{const e=Bi(jf,r.__scopeSelect),s=Ip(jf,r.__scopeSelect),[n,i]=w.useState(!1),o=je(t,s.onScrollButtonChange);return os(()=>{if(e.viewport&&e.isPositioned){let l=function(){const h=d.scrollHeight-d.clientHeight,f=Math.ceil(d.scrollTop)<h;i(f)};const d=e.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[e.viewport,e.isPositioned]),n?g.jsx(eS,{...r,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=e;l&&d&&(l.scrollTop=l.scrollTop+d.offsetHeight)}}):null});ZC.displayName=jf;var eS=w.forwardRef((r,t)=>{const{__scopeSelect:e,onAutoScroll:s,...n}=r,i=Bi("SelectScrollButton",e),o=w.useRef(null),l=Tu(e),d=w.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return w.useEffect(()=>()=>d(),[d]),os(()=>{l().find(f=>f.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),g.jsx(De.div,{"aria-hidden":!0,...n,ref:t,style:{flexShrink:0,...n.style},onPointerDown:ge(n.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(s,50))}),onPointerMove:ge(n.onPointerMove,()=>{i.onItemLeave?.(),o.current===null&&(o.current=window.setInterval(s,50))}),onPointerLeave:ge(n.onPointerLeave,()=>{d()})})}),IL="SelectSeparator",tS=w.forwardRef((r,t)=>{const{__scopeSelect:e,...s}=r;return g.jsx(De.div,{"aria-hidden":!0,...s,ref:t})});tS.displayName=IL;var Pf="SelectArrow",OL=w.forwardRef((r,t)=>{const{__scopeSelect:e,...s}=r,n=Au(e),i=$i(Pf,e),o=Bi(Pf,e);return i.open&&o.position==="popper"?g.jsx(Ap,{...n,...s,ref:t}):null});OL.displayName=Pf;var HL="SelectBubbleInput",sS=w.forwardRef(({__scopeSelect:r,value:t,...e},s)=>{const n=w.useRef(null),i=je(s,n),o=ku(t);return w.useEffect(()=>{const l=n.current;if(!l)return;const d=window.HTMLSelectElement.prototype,f=Object.getOwnPropertyDescriptor(d,"value").set;if(o!==t&&f){const m=new Event("change",{bubbles:!0});f.call(l,t),l.dispatchEvent(m)}},[o,t]),g.jsx(De.select,{...e,style:{..._C,...e.style},ref:i,defaultValue:t})});sS.displayName=HL;function nS(r){return r===""||r===void 0}function iS(r){const t=as(r),e=w.useRef(""),s=w.useRef(0),n=w.useCallback(o=>{const l=e.current+o;t(l),(function d(h){e.current=h,window.clearTimeout(s.current),h!==""&&(s.current=window.setTimeout(()=>d(""),1e3))})(l)},[t]),i=w.useCallback(()=>{e.current="",window.clearTimeout(s.current)},[]);return w.useEffect(()=>()=>window.clearTimeout(s.current),[]),[e,n,i]}function aS(r,t,e){const n=t.length>1&&Array.from(t).every(h=>h===t[0])?t[0]:t,i=e?r.indexOf(e):-1;let o=qL(r,Math.max(i,0));n.length===1&&(o=o.filter(h=>h!==e));const d=o.find(h=>h.textValue.toLowerCase().startsWith(n.toLowerCase()));return d!==e?d:void 0}function qL(r,t){return r.map((e,s)=>r[(t+s)%r.length])}var $L=NC,oS=PC,BL=zC,UL=IC,FL=OC,rS=HC,VL=UC,cS=QC,lS=KC,QL=YC,GL=XC,uS=JC,dS=ZC,hS=tS;const Nl=$L,jl=BL,Dr=w.forwardRef(({className:r,children:t,...e},s)=>g.jsxs(oS,{ref:s,className:ke("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...e,children:[t,g.jsx(UL,{asChild:!0,children:g.jsx(Jl,{className:"h-4 w-4 opacity-50"})})]}));Dr.displayName=oS.displayName;const fS=w.forwardRef(({className:r,...t},e)=>g.jsx(uS,{ref:e,className:ke("flex cursor-default items-center justify-center py-1",r),...t,children:g.jsx(Mb,{className:"h-4 w-4"})}));fS.displayName=uS.displayName;const pS=w.forwardRef(({className:r,...t},e)=>g.jsx(dS,{ref:e,className:ke("flex cursor-default items-center justify-center py-1",r),...t,children:g.jsx(Jl,{className:"h-4 w-4"})}));pS.displayName=dS.displayName;const _r=w.forwardRef(({className:r,children:t,position:e="popper",...s},n)=>g.jsx(FL,{children:g.jsxs(rS,{ref:n,className:ke("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",e==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:e,...s,children:[g.jsx(fS,{}),g.jsx(VL,{className:ke("p-1",e==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),g.jsx(pS,{})]})}));_r.displayName=rS.displayName;const KL=w.forwardRef(({className:r,...t},e)=>g.jsx(cS,{ref:e,className:ke("px-2 py-1.5 text-sm font-semibold",r),...t}));KL.displayName=cS.displayName;const Vt=w.forwardRef(({className:r,children:t,...e},s)=>g.jsxs(lS,{ref:s,className:ke("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...e,children:[g.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(GL,{children:g.jsx(Yf,{className:"h-4 w-4"})})}),g.jsx(QL,{children:t})]}));Vt.displayName=lS.displayName;const YL=w.forwardRef(({className:r,...t},e)=>g.jsx(hS,{ref:e,className:ke("-mx-1 my-1 h-px bg-muted",r),...t}));YL.displayName=hS.displayName;var gS=["PageUp","PageDown"],mS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],yS={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},_o="Slider",[Lf,WL,XL]=hu(_o),[vS]=ws(_o,[XL]),[JL,Du]=vS(_o),bS=w.forwardRef((r,t)=>{const{name:e,min:s=0,max:n=100,step:i=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:h=[s],value:f,onValueChange:m=()=>{},onValueCommit:y=()=>{},inverted:b=!1,form:C,...S}=r,R=w.useRef(new Set),M=w.useRef(0),E=o==="horizontal"?ZL:ez,[A=[],_]=kn({prop:f,defaultProp:h,onChange:ce=>{[...R.current][M.current]?.focus(),m(ce)}}),N=w.useRef(A);function z(ce){const J=az(A,ce);ne(ce,J)}function q(ce){ne(ce,M.current)}function Z(){const ce=N.current[M.current];A[M.current]!==ce&&y(A)}function ne(ce,J,{commit:te}={commit:!1}){const le=lz(i),ue=uz(Math.round((ce-s)/i)*i+s,le),L=jr(ue,[s,n]);_((j=[])=>{const O=nz(j,L,J);if(cz(O,d*i)){M.current=O.indexOf(L);const W=String(O)!==String(j);return W&&te&&y(O),W?O:j}else return j})}return g.jsx(JL,{scope:r.__scopeSlider,name:e,disabled:l,min:s,max:n,valueIndexToChangeRef:M,thumbs:R.current,values:A,orientation:o,form:C,children:g.jsx(Lf.Provider,{scope:r.__scopeSlider,children:g.jsx(Lf.Slot,{scope:r.__scopeSlider,children:g.jsx(E,{"aria-disabled":l,"data-disabled":l?"":void 0,...S,ref:t,onPointerDown:ge(S.onPointerDown,()=>{l||(N.current=A)}),min:s,max:n,inverted:b,onSlideStart:l?void 0:z,onSlideMove:l?void 0:q,onSlideEnd:l?void 0:Z,onHomeKeyDown:()=>!l&&ne(s,0,{commit:!0}),onEndKeyDown:()=>!l&&ne(n,A.length-1,{commit:!0}),onStepKeyDown:({event:ce,direction:J})=>{if(!l){const ue=gS.includes(ce.key)||ce.shiftKey&&mS.includes(ce.key)?10:1,L=M.current,j=A[L],O=i*ue*J;ne(j+O,L,{commit:!0})}}})})})})});bS.displayName=_o;var[xS,wS]=vS(_o,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ZL=w.forwardRef((r,t)=>{const{min:e,max:s,dir:n,inverted:i,onSlideStart:o,onSlideMove:l,onSlideEnd:d,onStepKeyDown:h,...f}=r,[m,y]=w.useState(null),b=je(t,E=>y(E)),C=w.useRef(void 0),S=ko(n),R=S==="ltr",M=R&&!i||!R&&i;function T(E){const A=C.current||m.getBoundingClientRect(),_=[0,A.width],z=Op(_,M?[e,s]:[s,e]);return C.current=A,z(E-A.left)}return g.jsx(xS,{scope:r.__scopeSlider,startEdge:M?"left":"right",endEdge:M?"right":"left",direction:M?1:-1,size:"width",children:g.jsx(CS,{dir:S,"data-orientation":"horizontal",...f,ref:b,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:E=>{const A=T(E.clientX);o?.(A)},onSlideMove:E=>{const A=T(E.clientX);l?.(A)},onSlideEnd:()=>{C.current=void 0,d?.()},onStepKeyDown:E=>{const _=yS[M?"from-left":"from-right"].includes(E.key);h?.({event:E,direction:_?-1:1})}})})}),ez=w.forwardRef((r,t)=>{const{min:e,max:s,inverted:n,onSlideStart:i,onSlideMove:o,onSlideEnd:l,onStepKeyDown:d,...h}=r,f=w.useRef(null),m=je(t,f),y=w.useRef(void 0),b=!n;function C(S){const R=y.current||f.current.getBoundingClientRect(),M=[0,R.height],E=Op(M,b?[s,e]:[e,s]);return y.current=R,E(S-R.top)}return g.jsx(xS,{scope:r.__scopeSlider,startEdge:b?"bottom":"top",endEdge:b?"top":"bottom",size:"height",direction:b?1:-1,children:g.jsx(CS,{"data-orientation":"vertical",...h,ref:m,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:S=>{const R=C(S.clientY);i?.(R)},onSlideMove:S=>{const R=C(S.clientY);o?.(R)},onSlideEnd:()=>{y.current=void 0,l?.()},onStepKeyDown:S=>{const M=yS[b?"from-bottom":"from-top"].includes(S.key);d?.({event:S,direction:M?-1:1})}})})}),CS=w.forwardRef((r,t)=>{const{__scopeSlider:e,onSlideStart:s,onSlideMove:n,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:d,...h}=r,f=Du(_o,e);return g.jsx(De.span,{...h,ref:t,onKeyDown:ge(r.onKeyDown,m=>{m.key==="Home"?(o(m),m.preventDefault()):m.key==="End"?(l(m),m.preventDefault()):gS.concat(mS).includes(m.key)&&(d(m),m.preventDefault())}),onPointerDown:ge(r.onPointerDown,m=>{const y=m.target;y.setPointerCapture(m.pointerId),m.preventDefault(),f.thumbs.has(y)?y.focus():s(m)}),onPointerMove:ge(r.onPointerMove,m=>{m.target.hasPointerCapture(m.pointerId)&&n(m)}),onPointerUp:ge(r.onPointerUp,m=>{const y=m.target;y.hasPointerCapture(m.pointerId)&&(y.releasePointerCapture(m.pointerId),i(m))})})}),SS="SliderTrack",MS=w.forwardRef((r,t)=>{const{__scopeSlider:e,...s}=r,n=Du(SS,e);return g.jsx(De.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...s,ref:t})});MS.displayName=SS;var zf="SliderRange",RS=w.forwardRef((r,t)=>{const{__scopeSlider:e,...s}=r,n=Du(zf,e),i=wS(zf,e),o=w.useRef(null),l=je(t,o),d=n.values.length,h=n.values.map(y=>TS(y,n.min,n.max)),f=d>1?Math.min(...h):0,m=100-Math.max(...h);return g.jsx(De.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...s,ref:l,style:{...r.style,[i.startEdge]:f+"%",[i.endEdge]:m+"%"}})});RS.displayName=zf;var If="SliderThumb",kS=w.forwardRef((r,t)=>{const e=WL(r.__scopeSlider),[s,n]=w.useState(null),i=je(t,l=>n(l)),o=w.useMemo(()=>s?e().findIndex(l=>l.ref.current===s):-1,[e,s]);return g.jsx(tz,{...r,ref:i,index:o})}),tz=w.forwardRef((r,t)=>{const{__scopeSlider:e,index:s,name:n,...i}=r,o=Du(If,e),l=wS(If,e),[d,h]=w.useState(null),f=je(t,T=>h(T)),m=d?o.form||!!d.closest("form"):!0,y=xu(d),b=o.values[s],C=b===void 0?0:TS(b,o.min,o.max),S=iz(s,o.values.length),R=y?.[l.size],M=R?oz(R,C,l.direction):0;return w.useEffect(()=>{if(d)return o.thumbs.add(d),()=>{o.thumbs.delete(d)}},[d,o.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${C}% + ${M}px)`},children:[g.jsx(Lf.ItemSlot,{scope:r.__scopeSlider,children:g.jsx(De.span,{role:"slider","aria-label":r["aria-label"]||S,"aria-valuemin":o.min,"aria-valuenow":b,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:f,style:b===void 0?{display:"none"}:r.style,onFocus:ge(r.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),m&&g.jsx(ES,{name:n??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:b},s)]})});kS.displayName=If;var sz="RadioBubbleInput",ES=w.forwardRef(({__scopeSlider:r,value:t,...e},s)=>{const n=w.useRef(null),i=je(n,s),o=ku(t);return w.useEffect(()=>{const l=n.current;if(!l)return;const d=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(d,"value").set;if(o!==t&&f){const m=new Event("input",{bubbles:!0});f.call(l,t),l.dispatchEvent(m)}},[o,t]),g.jsx(De.input,{style:{display:"none"},...e,ref:i,defaultValue:t})});ES.displayName=sz;function nz(r=[],t,e){const s=[...r];return s[e]=t,s.sort((n,i)=>n-i)}function TS(r,t,e){const i=100/(e-t)*(r-t);return jr(i,[0,100])}function iz(r,t){return t>2?`Value ${r+1} of ${t}`:t===2?["Minimum","Maximum"][r]:void 0}function az(r,t){if(r.length===1)return 0;const e=r.map(n=>Math.abs(n-t)),s=Math.min(...e);return e.indexOf(s)}function oz(r,t,e){const s=r/2,i=Op([0,50],[0,s]);return(s-i(t)*e)*e}function rz(r){return r.slice(0,-1).map((t,e)=>r[e+1]-t)}function cz(r,t){if(t>0){const e=rz(r);return Math.min(...e)>=t}return!0}function Op(r,t){return e=>{if(r[0]===r[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(r[1]-r[0]);return t[0]+s*(e-r[0])}}function lz(r){return(String(r).split(".")[1]||"").length}function uz(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}var AS=bS,dz=MS,hz=RS,fz=kS;const nn=w.forwardRef(({className:r,...t},e)=>g.jsxs(AS,{ref:e,className:ke("relative flex w-full touch-none select-none items-center",r),...t,children:[g.jsx(dz,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:g.jsx(hz,{className:"absolute h-full bg-primary"})}),g.jsx(fz,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));nn.displayName=AS.displayName;var _u="Switch",[pz]=ws(_u),[gz,mz]=pz(_u),DS=w.forwardRef((r,t)=>{const{__scopeSwitch:e,name:s,checked:n,defaultChecked:i,required:o,disabled:l,value:d="on",onCheckedChange:h,form:f,...m}=r,[y,b]=w.useState(null),C=je(t,E=>b(E)),S=w.useRef(!1),R=y?f||!!y.closest("form"):!0,[M,T]=kn({prop:n,defaultProp:i??!1,onChange:h,caller:_u});return g.jsxs(gz,{scope:e,checked:M,disabled:l,children:[g.jsx(De.button,{type:"button",role:"switch","aria-checked":M,"aria-required":o,"data-state":PS(M),"data-disabled":l?"":void 0,disabled:l,value:d,...m,ref:C,onClick:ge(r.onClick,E=>{T(A=>!A),R&&(S.current=E.isPropagationStopped(),S.current||E.stopPropagation())})}),R&&g.jsx(jS,{control:y,bubbles:!S.current,name:s,value:d,checked:M,required:o,disabled:l,form:f,style:{transform:"translateX(-100%)"}})]})});DS.displayName=_u;var _S="SwitchThumb",NS=w.forwardRef((r,t)=>{const{__scopeSwitch:e,...s}=r,n=mz(_S,e);return g.jsx(De.span,{"data-state":PS(n.checked),"data-disabled":n.disabled?"":void 0,...s,ref:t})});NS.displayName=_S;var yz="SwitchBubbleInput",jS=w.forwardRef(({__scopeSwitch:r,control:t,checked:e,bubbles:s=!0,...n},i)=>{const o=w.useRef(null),l=je(o,i),d=ku(e),h=xu(t);return w.useEffect(()=>{const f=o.current;if(!f)return;const m=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(m,"checked").set;if(d!==e&&b){const C=new Event("click",{bubbles:s});b.call(f,e),f.dispatchEvent(C)}},[d,e,s]),g.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...n,tabIndex:-1,ref:l,style:{...n.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});jS.displayName=yz;function PS(r){return r?"checked":"unchecked"}var LS=DS,vz=NS;const fa=w.forwardRef(({className:r,...t},e)=>g.jsx(LS,{className:ke("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...t,ref:e,children:g.jsx(vz,{className:ke("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));fa.displayName=LS.displayName;const xs=w.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("rounded-xl border bg-card text-card-foreground shadow",r),...t}));xs.displayName="Card";const Sn=w.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("flex flex-col space-y-1.5 p-6",r),...t}));Sn.displayName="CardHeader";const Mn=w.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("font-semibold leading-none tracking-tight",r),...t}));Mn.displayName="CardTitle";const ga=w.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("text-sm text-muted-foreground",r),...t}));ga.displayName="CardDescription";const Rn=w.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("p-6 pt-0",r),...t}));Rn.displayName="CardContent";const bz=w.forwardRef(({className:r,...t},e)=>g.jsx("div",{ref:e,className:ke("flex items-center p-6 pt-0",r),...t}));bz.displayName="CardFooter";const xz=Ff("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ft({className:r,variant:t,...e}){return g.jsx("div",{className:ke(xz({variant:t}),r),...e})}const Nr={heading:{h1:"text-2xl font-bold text-foreground",h2:"text-lg font-semibold text-foreground",h3:"text-sm font-semibold text-foreground",h4:"text-xs font-semibold text-foreground",h5:"text-[10px] font-semibold text-muted-foreground uppercase"},body:{base:"text-sm text-foreground",small:"text-xs text-foreground",micro:"text-[10px] text-foreground"},muted:{base:"text-sm text-muted-foreground",small:"text-xs text-muted-foreground",micro:"text-[10px] text-muted-foreground"},mono:{base:"font-mono text-sm text-foreground",small:"font-mono text-xs text-foreground",micro:"font-mono text-[10px] text-foreground"},status:{success:"text-success",warning:"text-warning",error:"text-destructive",info:"text-primary"}},wn=w.forwardRef(({level:r,as:t,className:e,children:s,...n},i)=>{const o=t||`h${r}`,l=`h${r}`;return g.jsx(o,{ref:i,className:ke(Nr.heading[l],e),...n,children:s})});wn.displayName="Heading";const We=w.forwardRef(({size:r="base",muted:t=!1,mono:e=!1,as:s="p",className:n,children:i,...o},l)=>{const d=s;let h;return e?h=Nr.mono[r]:t?h=Nr.muted[r]:h=Nr.body[r],g.jsx(d,{ref:l,className:ke(h,n),...o,children:i})});We.displayName="Text";const da=w.forwardRef(({status:r,size:t="base",weight:e="normal",as:s="span",className:n,children:i,...o},l)=>{const d=s,h={base:"text-sm",small:"text-xs",micro:"text-[10px]"},f={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};return g.jsx(d,{ref:l,className:ke(h[t],f[e],Nr.status[r],n),...o,children:i})});da.displayName="StatusText";const wz=w.forwardRef(({as:r="h2",className:t,children:e,...s},n)=>g.jsx(wn,{ref:n,level:1,as:r,className:t,...s,children:e}));wz.displayName="PageTitle";const Cz=w.forwardRef(({as:r="h3",className:t,children:e,...s},n)=>g.jsx(wn,{ref:n,level:2,as:r,className:t,...s,children:e}));Cz.displayName="SectionTitle";const ti=w.forwardRef(({as:r="h3",className:t,children:e,...s},n)=>g.jsx(wn,{ref:n,level:3,as:r,className:t,...s,children:e}));ti.displayName="PanelTitle";const Sz=w.forwardRef(({as:r="p",className:t,children:e,...s},n)=>g.jsx(We,{ref:n,size:"base",muted:!0,as:r,className:ke("mt-1",t),...s,children:e}));Sz.displayName="Description";function Mz({connection:r,onUpdate:t}){const e=r.data||{},{isRunning:s}=Nt(),{getConnectionMessages:n,getMessageHistory:i}=Li(),[o,l]=w.useState([]),[d,h]=w.useState([]);w.useEffect(()=>{if(!s){l([]),h([]);return}const M=setInterval(()=>{const T=n(r.id),E=i(50).filter(A=>A.connectionId===r.id);l(T),h(E)},200);return()=>clearInterval(M)},[s,r.id,n,i]);const f=M=>{const T={...e,...M};t(r.id,{data:T})},m=M=>{f({latencyMs:Math.max(0,M)})},y=M=>{f({bandwidthMbps:Math.max(1,M)})},b=M=>{f({packetLossPercent:Math.max(0,Math.min(100,M))})},C=M=>{f({jitterMs:Math.max(0,M)})},S=M=>{f({retryCount:Math.max(0,M)})},R=M=>{f({timeoutMs:Math.max(1e3,M)})};return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx(ti,{children:"Connection"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs(We,{size:"micro",muted:!0,children:["From: ",r.source]}),g.jsxs(We,{size:"micro",muted:!0,children:["To: ",r.target]}),g.jsxs(We,{size:"micro",muted:!0,children:["Type: ",r.type]})]})]}),g.jsxs("div",{className:"border-t border-border pt-2 space-y-2",children:[g.jsxs("div",{children:[g.jsx(wn,{level:5,className:"mb-1.5 opacity-70",children:"Network Parameters"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(nt,{className:"text-xs",children:"Latency (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.latencyMs??0})]}),g.jsx(nn,{value:[e.latencyMs??0],onValueChange:M=>m(M[0]),min:0,max:5e3,step:10,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.latencyMs??0,onChange:M=>m(parseInt(M.target.value)||0),placeholder:"0-5000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(nt,{className:"text-xs",children:"Bandwidth (Mbps)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.bandwidthMbps??1e3})]}),g.jsx(nn,{value:[e.bandwidthMbps??1e3],onValueChange:M=>y(M[0]),min:1,max:1e5,step:10,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.bandwidthMbps??1e3,onChange:M=>y(parseInt(M.target.value)||1e3),placeholder:"1-100000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(nt,{className:"text-xs",children:"Packet Loss (%)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.packetLossPercent??0})]}),g.jsx(nn,{value:[e.packetLossPercent??0],onValueChange:M=>b(M[0]),min:0,max:100,step:.1,className:"w-full"}),g.jsx(Tt,{type:"number",step:"0.1",value:e.packetLossPercent??0,onChange:M=>b(parseFloat(M.target.value)||0),placeholder:"0-100",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(nt,{className:"text-xs",children:"Jitter (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.jitterMs??0})]}),g.jsx(nn,{value:[e.jitterMs??0],onValueChange:M=>C(M[0]),min:0,max:1e3,step:5,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.jitterMs??0,onChange:M=>C(parseInt(M.target.value)||0),placeholder:"0-1000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx("h4",{className:"text-[9px] font-semibold text-foreground mb-1.5 uppercase opacity-70",children:"Traffic Characteristics"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsx(nt,{className:"text-xs",children:"Priority Level"}),g.jsxs(Nl,{value:e.priorityLevel||"medium",onValueChange:M=>f({priorityLevel:M}),children:[g.jsx(Dr,{className:"h-7 text-[11px]",children:g.jsx(jl,{})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"low",children:"Low"}),g.jsx(Vt,{value:"medium",children:"Medium"}),g.jsx(Vt,{value:"high",children:"High"}),g.jsx(Vt,{value:"critical",children:"Critical"})]})]})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(nt,{className:"text-xs",children:"Retry Count"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.retryCount??3})]}),g.jsx(nn,{value:[e.retryCount??3],onValueChange:M=>S(M[0]),min:0,max:10,step:1,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.retryCount??3,onChange:M=>S(parseInt(M.target.value)||0),placeholder:"0-10",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(nt,{className:"text-xs",children:"Timeout (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:e.timeoutMs??3e4})]}),g.jsx(nn,{value:[e.timeoutMs??3e4],onValueChange:M=>R(M[0]),min:1e3,max:12e4,step:1e3,className:"w-full"}),g.jsx(Tt,{type:"number",value:e.timeoutMs??3e4,onChange:M=>R(parseInt(M.target.value)||3e4),placeholder:"1000-120000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx(wn,{level:5,className:"mb-1.5 opacity-70",children:"Monitoring"}),g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-accent/20 rounded-md",children:[g.jsx(nt,{className:"text-xs cursor-pointer",children:"Enable Monitoring"}),g.jsx(fa,{checked:e.enableMonitoring??!1,onCheckedChange:M=>f({enableMonitoring:M})})]})]}),g.jsx(xs,{className:"bg-card/50 border-border/50 p-1.5 mt-2",children:g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Bandwidth:"}),g.jsxs(We,{mono:!0,size:"micro",children:[Math.max(1,(e.bandwidthMbps??1e3)*(1-(e.packetLossPercent??0)/100)).toFixed(2)," Mbps"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Latency:"}),g.jsxs(We,{mono:!0,size:"micro",children:[((e.latencyMs??0)+(e.jitterMs??0)/2).toFixed(0)," ms"]})]})]})}),s&&g.jsx("div",{className:"border-t border-border pt-2 mt-2",children:g.jsxs(vp,{defaultValue:"active",className:"w-full",children:[g.jsxs(gu,{className:"grid w-full grid-cols-2 h-7",children:[g.jsxs(sn,{value:"active",className:"text-xs px-2",children:[g.jsx(ya,{className:"h-3 w-3 mr-1"}),"Active (",o.length,")"]}),g.jsxs(sn,{value:"history",className:"text-xs px-2",children:[g.jsx(rv,{className:"h-3 w-3 mr-1"}),"History (",d.length,")"]})]}),g.jsx(si,{value:"active",className:"mt-1.5 space-y-1",children:o.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(ya,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"No active messages"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:o.map((M,T)=>g.jsxs(xs,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(ft,{variant:"outline",className:"text-xs px-0.5 py-0",children:M.format}),g.jsx(ft,{variant:M.status==="delivered"?"default":M.status==="failed"?"destructive":M.status==="transformed"?"secondary":"outline",className:"text-xs px-0.5 py-0",children:M.status})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(M.size/1024).toFixed(2)," KB"]}),M.latency&&g.jsxs("div",{children:["Latency: ",M.latency.toFixed(0)," ms"]})]}),M.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(va,{className:"h-2.5 w-2.5"}),M.error]})]})}),M.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(M.payload,null,2)})]})]},M.id||T))})}),g.jsx(si,{value:"history",className:"mt-1.5 space-y-1",children:d.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(rv,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"History is empty"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:d.map((M,T)=>g.jsxs(xs,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(ft,{variant:"outline",className:"text-xs px-0.5 py-0",children:M.format}),g.jsx(ft,{variant:M.status==="delivered"?"default":M.status==="failed"?"destructive":"outline",className:"text-xs px-0.5 py-0",children:M.status}),g.jsx("span",{className:"text-[9px] text-muted-foreground",children:new Date(M.timestamp).toLocaleTimeString()})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(M.size/1024).toFixed(2)," KB"]}),M.latency&&g.jsxs("div",{children:["Latency: ",M.latency.toFixed(0)," ms"]})]}),M.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(va,{className:"h-2.5 w-2.5"}),M.error]})]})}),M.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(M.payload,null,2)})]})]},M.id||T))})})]})})]})]})}function Rz(r){const t=kz(r),e=w.forwardRef((s,n)=>{const{children:i,...o}=s,l=w.Children.toArray(i),d=l.find(Tz);if(d){const h=d.props.children,f=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(t,{...o,ref:n,children:w.isValidElement(h)?w.cloneElement(h,void 0,f):null})}return g.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${r}.Slot`,e}function kz(r){const t=w.forwardRef((e,s)=>{const{children:n,...i}=e;if(w.isValidElement(n)){const o=Dz(n),l=Az(i,n.props);return n.type!==w.Fragment&&(l.ref=s?Tn(s,o):o),w.cloneElement(n,l)}return w.Children.count(n)>1?w.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var Ez=Symbol("radix.slottable");function Tz(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Ez}function Az(r,t){const e={...t};for(const s in t){const n=r[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...l)=>{const d=i(...l);return n(...l),d}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...r,...e}}function Dz(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?r.props.ref:r.props.ref||r.ref)}var Nu="Popover",[zS]=ws(Nu,[Ao]),Xr=Ao(),[_z,Ui]=zS(Nu),IS=r=>{const{__scopePopover:t,children:e,open:s,defaultOpen:n,onOpenChange:i,modal:o=!1}=r,l=Xr(t),d=w.useRef(null),[h,f]=w.useState(!1),[m,y]=kn({prop:s,defaultProp:n??!1,onChange:i,caller:Nu});return g.jsx(Ep,{...l,children:g.jsx(_z,{scope:t,contentId:rn(),triggerRef:d,open:m,onOpenChange:y,onOpenToggle:w.useCallback(()=>y(b=>!b),[y]),hasCustomAnchor:h,onCustomAnchorAdd:w.useCallback(()=>f(!0),[]),onCustomAnchorRemove:w.useCallback(()=>f(!1),[]),modal:o,children:e})})};IS.displayName=Nu;var OS="PopoverAnchor",Nz=w.forwardRef((r,t)=>{const{__scopePopover:e,...s}=r,n=Ui(OS,e),i=Xr(e),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=n;return w.useEffect(()=>(o(),()=>l()),[o,l]),g.jsx(wu,{...i,...s,ref:t})});Nz.displayName=OS;var HS="PopoverTrigger",qS=w.forwardRef((r,t)=>{const{__scopePopover:e,...s}=r,n=Ui(HS,e),i=Xr(e),o=je(t,n.triggerRef),l=g.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":VS(n.open),...s,ref:o,onClick:ge(r.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:g.jsx(wu,{asChild:!0,...i,children:l})});qS.displayName=HS;var Hp="PopoverPortal",[jz,Pz]=zS(Hp,{forceMount:void 0}),$S=r=>{const{__scopePopover:t,forceMount:e,children:s,container:n}=r,i=Ui(Hp,t);return g.jsx(jz,{scope:t,forceMount:e,children:g.jsx(cs,{present:e||i.open,children:g.jsx(Vr,{asChild:!0,container:n,children:s})})})};$S.displayName=Hp;var Co="PopoverContent",BS=w.forwardRef((r,t)=>{const e=Pz(Co,r.__scopePopover),{forceMount:s=e.forceMount,...n}=r,i=Ui(Co,r.__scopePopover);return g.jsx(cs,{present:s||i.open,children:i.modal?g.jsx(zz,{...n,ref:t}):g.jsx(Iz,{...n,ref:t})})});BS.displayName=Co;var Lz=Rz("PopoverContent.RemoveScroll"),zz=w.forwardRef((r,t)=>{const e=Ui(Co,r.__scopePopover),s=w.useRef(null),n=je(t,s),i=w.useRef(!1);return w.useEffect(()=>{const o=s.current;if(o)return au(o)},[]),g.jsx(Qr,{as:Lz,allowPinchZoom:!0,children:g.jsx(US,{...r,ref:n,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(r.onCloseAutoFocus,o=>{o.preventDefault(),i.current||e.triggerRef.current?.focus()}),onPointerDownOutside:ge(r.onPointerDownOutside,o=>{const l=o.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0,h=l.button===2||d;i.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:ge(r.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),Iz=w.forwardRef((r,t)=>{const e=Ui(Co,r.__scopePopover),s=w.useRef(!1),n=w.useRef(!1);return g.jsx(US,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{r.onCloseAutoFocus?.(i),i.defaultPrevented||(s.current||e.triggerRef.current?.focus(),i.preventDefault()),s.current=!1,n.current=!1},onInteractOutside:i=>{r.onInteractOutside?.(i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;e.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),US=w.forwardRef((r,t)=>{const{__scopePopover:e,trapFocus:s,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,...m}=r,y=Ui(Co,e),b=Xr(e);return nu(),g.jsx(Fr,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:n,onUnmountAutoFocus:i,children:g.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:f,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onDismiss:()=>y.onOpenChange(!1),children:g.jsx(Tp,{"data-state":VS(y.open),role:"dialog",id:y.contentId,...b,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),FS="PopoverClose",Oz=w.forwardRef((r,t)=>{const{__scopePopover:e,...s}=r,n=Ui(FS,e);return g.jsx(De.button,{type:"button",...s,ref:t,onClick:ge(r.onClick,()=>n.onOpenChange(!1))})});Oz.displayName=FS;var Hz="PopoverArrow",qz=w.forwardRef((r,t)=>{const{__scopePopover:e,...s}=r,n=Xr(e);return g.jsx(Ap,{...n,...s,ref:t})});qz.displayName=Hz;function VS(r){return r?"open":"closed"}var $z=IS,Bz=qS,Uz=$S,QS=BS;const Fz=$z,Vz=Bz,GS=w.forwardRef(({className:r,align:t="center",sideOffset:e=4,...s},n)=>g.jsx(Uz,{children:g.jsx(QS,{ref:n,align:t,sideOffset:e,className:ke("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",r),...s})}));GS.displayName=QS.displayName;const KS=un((r,t)=>({componentStates:new Map,setComponentState:(e,s,n)=>{mo.setComponentState(e,s,n);const i=mo.getComponentState(e);i&&r(o=>({componentStates:new Map(o.componentStates).set(e,i)}))},resetComponent:e=>{mo.resetComponent(e),r(s=>{const n=new Map(s.componentStates);return n.delete(e),{componentStates:n}})},resetAll:()=>{mo.reset(),r({componentStates:new Map})},getComponentState:e=>t().componentStates.get(e),isEnabled:e=>mo.isEnabled(e),getAllStates:()=>Array.from(t().componentStates.values())}));function Qz({componentId:r,componentLabel:t}){const{isRunning:e}=Nt(),{getComponentState:s,setComponentState:n,resetComponent:i}=KS(),o=s(r),l=o?.state||"enabled",[d,h]=w.useState(o?.degradedLevel||.5),[f,m]=w.useState(o?.failureRate||.1),[y,b]=w.useState(o?.latencyMultiplier||2),[C,S]=w.useState(o?.throughputMultiplier||.5),R=A=>{A==="degraded"?n(r,A,{degradedLevel:d,failureRate:f,latencyMultiplier:y,throughputMultiplier:C}):n(r,A)},M=()=>{i(r),h(.5),m(.1),b(2),S(.5)},T=A=>{switch(A){case"enabled":return"bg-green-500/20 text-green-500 border-green-500/50";case"disabled":return"bg-gray-500/20 text-gray-500 border-gray-500/50";case"degraded":return"bg-yellow-500/20 text-yellow-500 border-yellow-500/50";case"failed":return"bg-red-500/20 text-red-500 border-red-500/50"}},E=A=>{switch(A){case"enabled":return g.jsx(sf,{className:"w-4 h-4"});case"disabled":return g.jsx(El,{className:"w-4 h-4"});case"degraded":return g.jsx(an,{className:"w-4 h-4"});case"failed":return g.jsx(pa,{className:"w-4 h-4"})}};return g.jsxs(xs,{className:"border",children:[g.jsx(Sn,{className:"p-2 pb-1.5",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsxs(Mn,{className:"text-[11px] flex items-center gap-1",children:[g.jsx(ya,{className:"w-3 h-3"}),"Component State",g.jsxs(Fz,{children:[g.jsx(Vz,{asChild:!0,children:g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-3.5 w-3.5 rounded-full",children:g.jsx(TA,{className:"w-2.5 h-2.5 text-muted-foreground"})})}),g.jsx(GS,{className:"w-72 text-xs",align:"start",children:g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"font-semibold text-sm",children:"Component States"}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(sf,{className:"w-3.5 h-3.5 text-green-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-green-500",children:"Enabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  normal operation"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(El,{className:"w-3.5 h-3.5 text-gray-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-gray-500",children:"Disabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  turned off. Throughput=0, Errors=100%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(an,{className:"w-3.5 h-3.5 text-yellow-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-yellow-500",children:"Degraded"}),g.jsx("span",{className:"text-muted-foreground",children:"  partial failure. Throughput 50%, Latency 2x, Errors 10%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(pa,{className:"w-3.5 h-3.5 text-red-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-red-500",children:"Failed"}),g.jsx("span",{className:"text-muted-foreground",children:"  crashed. Same as Disabled but indicates failure"})]})]})]}),g.jsx("p",{className:"text-muted-foreground pt-1 border-t border-border",children:"Use to simulate failures and test architecture resilience."})]})})]})]}),g.jsx(ga,{className:"text-[9px] mt-0.5",children:"Control operational state"})]}),o&&g.jsxs(ft,{variant:"outline",className:`${T(l)} text-xs px-1 py-0.5`,children:[E(l),g.jsx("span",{className:"ml-0.5",children:l.toUpperCase()})]})]})}),g.jsxs(Rn,{className:"p-2 pt-1.5 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[g.jsxs(Ee,{variant:l==="enabled"?"default":"outline",size:"sm",onClick:()=>R("enabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(sf,{className:"w-3.5 h-3.5"}),"Enabled"]}),g.jsxs(Ee,{variant:l==="disabled"?"destructive":"outline",size:"sm",onClick:()=>R("disabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(El,{className:"w-3.5 h-3.5"}),"Disabled"]}),g.jsxs(Ee,{variant:l==="degraded"?"default":"outline",size:"sm",onClick:()=>R("degraded"),className:"flex items-center gap-1 h-7 text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-600 dark:text-yellow-400",disabled:!e,children:[g.jsx(an,{className:"w-3.5 h-3.5"}),"Degraded"]}),g.jsxs(Ee,{variant:l==="failed"?"destructive":"outline",size:"sm",onClick:()=>R("failed"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(pa,{className:"w-3.5 h-3.5"}),"Failed"]})]}),l==="degraded"&&g.jsxs("div",{className:"space-y-2 p-2 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[g.jsx(Db,{className:"w-3 h-3 text-yellow-600 dark:text-yellow-400"}),g.jsx(nt,{className:"text-[11px] font-semibold text-yellow-600 dark:text-yellow-400",children:"Degradation Settings"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(nt,{className:"text-[10px]",children:"Degradation Level"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(d*100).toFixed(0),"%"]})]}),g.jsx(nn,{value:[d],onValueChange:A=>{h(A[0]),R("degraded")},min:0,max:1,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(nt,{className:"text-[10px]",children:"Failure Rate"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(f*100).toFixed(0),"%"]})]}),g.jsx(nn,{value:[f],onValueChange:A=>{m(A[0]),R("degraded")},min:0,max:1,step:.05,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(nt,{className:"text-[10px]",children:"Latency Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[y.toFixed(1),"x"]})]}),g.jsx(nn,{value:[y],onValueChange:A=>{b(A[0]),R("degraded")},min:1,max:5,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(nt,{className:"text-[10px]",children:"Throughput Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(C*100).toFixed(0),"%"]})]}),g.jsx(nn,{value:[C],onValueChange:A=>{S(A[0]),R("degraded")},min:0,max:1,step:.05,className:"w-full"})]})]})]}),o&&g.jsxs(Ee,{variant:"outline",size:"sm",onClick:M,className:"w-full flex items-center gap-1 h-7 text-xs",disabled:!e,children:[g.jsx(Ab,{className:"w-3.5 h-3.5"}),"Reset to Normal"]}),!e&&g.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded text-[9px] text-muted-foreground",children:[g.jsx(va,{className:"w-3 h-3"}),"Start emulation to control component state"]})]})]})}function Gz({onFilterChange:r}){const{nodes:t,connections:e,selectNode:s}=Re(),{isRunning:n,getComponentMetrics:i}=Nt(),{getAllComponentStatuses:o}=ma(),[l,d]=w.useState(""),[h,f]=w.useState(!1),[m,y]=w.useState(!0),[b,C]=w.useState(!0),[S,R]=w.useState(!0),[M,T]=w.useState(!0),[E,A]=w.useState(100),[_,N]=w.useState(5),[z,q]=w.useState(new Set),Z=Et.useMemo(()=>n?t.filter(te=>{if(l&&!te.data.label.toLowerCase().includes(l.toLowerCase()))return!1;if(!h)return!0;const le=i(te.id),L=o().find(j=>j.nodeId===te.id);return!!(m&&e.some(O=>O.source===te.id||O.target===te.id?Nt.getState().getConnectionMetrics(O.id)?.bottleneck:!1)||b&&le&&le.errorRate*100>=_||M&&le&&le.latency>=E||S&&L?.criticalPath||L&&(L.health==="critical"||L.health==="down"))}):t,[l,h,m,b,M,S,E,_,n,t,e]);Et.useEffect(()=>{if(h){const te=new Set(Z.map(le=>le.id));q(te),r?.(Array.from(te))}else q(new Set),r?.(t.map(te=>te.id))},[h,Z,t,r]);const ne=te=>{s(te)},ce=Z.length,J=t.filter(te=>{if(!n)return!1;const le=i(te.id),L=o().find(j=>j.nodeId===te.id);return le&&(le.errorRate*100>=_||le.latency>=E)||L?.criticalPath||L&&(L.health==="critical"||L.health==="down")||e.some(j=>j.source===te.id||j.target===te.id?Nt.getState().getConnectionMetrics(j.id)?.bottleneck:!1)}).length;return g.jsxs(xs,{className:"h-full border-2",children:[g.jsx(Sn,{className:"pb-3",children:g.jsxs(Mn,{className:"text-sm flex items-center gap-2",children:[g.jsx(kb,{className:"w-4 h-4"}),"Problem Filters",ce>0&&g.jsx(ft,{variant:"destructive",className:"ml-auto",children:ce})]})}),g.jsxs(Rn,{className:"space-y-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(nt,{className:"text-xs",children:"Search Components"}),g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search by name...",value:l,onChange:te=>d(te.target.value),className:"pl-8 h-8 text-xs"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(nt,{className:"text-xs flex items-center gap-2",children:[g.jsx(zA,{className:"w-4 h-4"}),"Show Only Problems"]}),g.jsx(fa,{checked:h,onCheckedChange:f})]}),h&&g.jsxs("div",{className:"pl-6 space-y-2 border-l-2 border-border",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(nt,{className:"text-xs flex items-center gap-2",children:[g.jsx(Db,{className:"w-4 h-4 text-red-500"}),"Bottlenecks"]}),g.jsx(fa,{checked:m,onCheckedChange:y})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(nt,{className:"text-xs flex items-center gap-2",children:[g.jsx(pa,{className:"w-4 h-4 text-orange-500"}),"High Error Rate (>",_,"%)"]}),g.jsx(fa,{checked:b,onCheckedChange:C})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(nt,{className:"text-xs flex items-center gap-2",children:[g.jsx(_b,{className:"w-4 h-4 text-yellow-500"}),"High Latency (>",E,"ms)"]}),g.jsx(fa,{checked:M,onCheckedChange:T})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(nt,{className:"text-xs flex items-center gap-2",children:[g.jsx(ya,{className:"w-4 h-4 text-purple-500"}),"Critical Paths"]}),g.jsx(fa,{checked:S,onCheckedChange:R})]})]})]}),h&&g.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[g.jsxs("div",{children:[g.jsx(nt,{className:"text-xs",children:"Min Latency (ms)"}),g.jsx(Tt,{type:"number",value:E,onChange:te=>A(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0})]}),g.jsxs("div",{children:[g.jsx(nt,{className:"text-xs",children:"Min Error Rate (%)"}),g.jsx(Tt,{type:"number",value:_,onChange:te=>N(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0,max:100})]})]}),n&&g.jsx("div",{className:"pt-2 border-t border-border",children:g.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total problems detected: ",g.jsx("span",{className:"font-semibold text-foreground",children:J})]})}),h&&Z.length>0&&g.jsx(is,{className:"h-48 border border-border rounded p-2",children:g.jsx("div",{className:"space-y-1",children:Z.map(te=>{const le=i(te.id),L=o().find(j=>j.nodeId===te.id);return g.jsx(Ee,{variant:"ghost",size:"sm",className:"w-full justify-start text-xs h-auto py-1.5",onClick:()=>ne(te.id),children:g.jsxs("div",{className:"flex items-center gap-2 w-full",children:[L?.criticalPath&&g.jsx(ft,{variant:"outline",className:"bg-purple-500/20 text-purple-500 border-purple-500/50 text-xs px-1",children:"Critical"}),g.jsx("span",{className:"flex-1 text-left truncate",children:te.data.label}),le&&le.errorRate*100>=_&&g.jsxs(ft,{variant:"destructive",className:"text-xs px-1",children:[(le.errorRate*100).toFixed(0),"%"]})]})},te.id)})})}),!n&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-4",children:"Start emulation to see problems"})]})]})}function Kz(){const{nodes:r,connections:t}=Re(),{isRunning:e,getComponentMetrics:s,getConnectionMetrics:n}=Nt(),{getAllComponentStatuses:i,getSystemAnalysis:o}=ma(),[l,d]=w.useState(""),[h,f]=w.useState("all");if(!e)return g.jsx(xs,{className:"h-full",children:g.jsxs(Sn,{children:[g.jsx(Mn,{children:"Diagnostics"}),g.jsx(ga,{children:"Start emulation to see diagnostics"})]})});const m=[],y=i();o(),r.forEach(R=>{const M=s(R.id),T=y.find(_=>_.nodeId===R.id);if(!M||!T)return;const E={nodeId:R.id,nodeLabel:R.data.label,problem:"",severity:"info",metrics:{throughput:M.throughput,latency:M.latency,errorRate:M.errorRate,utilization:M.utilization},affectedConnections:[],recommendations:[]},A=t.filter(_=>_.source===R.id||_.target===R.id?n(_.id)?.bottleneck:!1);if(A.length>0){E.problem=`Bottleneck detected in ${A.length} connection(s)`,E.severity="critical",E.affectedConnections=A.map(_=>_.id),E.rootCause="High throughput dependency or backpressure",E.recommendations=["Consider scaling this component horizontally","Optimize data processing logic","Check for connection bandwidth limits"],m.push(E);return}if(M.errorRate>.05){E.problem=`High error rate: ${(M.errorRate*100).toFixed(1)}%`,E.severity=M.errorRate>.1?"critical":"warning",E.rootCause="Component is experiencing failures",E.recommendations=["Check component logs for error details","Verify input data format and validation","Review retry and error handling logic"],m.push(E);return}if(M.latency>1e3){E.problem=`High latency: ${M.latency.toFixed(0)}ms`,E.severity=M.latency>2e3?"critical":"warning",E.rootCause="Component processing is slow",E.recommendations=["Optimize database queries or data processing","Consider caching frequently accessed data","Review component configuration for performance"],m.push(E);return}if(M.utilization>.9){E.problem=`High utilization: ${(M.utilization*100).toFixed(0)}%`,E.severity="warning",E.rootCause="Component is near capacity",E.recommendations=["Consider scaling this component","Optimize resource usage","Monitor for potential failures"],m.push(E);return}(T.health==="critical"||T.health==="down")&&(E.problem=`Component health: ${T.health}`,E.severity="critical",E.rootCause="Component is in critical state or down",E.recommendations=["Immediately check component status","Review error logs and metrics","Consider failover or restart"],m.push(E))});const b=m.filter(R=>!(h!=="all"&&R.severity!==h||l&&!R.nodeLabel.toLowerCase().includes(l.toLowerCase()))),C=R=>{switch(R){case"critical":return g.jsx(pa,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(an,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(va,{className:"w-4 h-4 text-blue-500"})}},S=R=>{switch(R){case"critical":return g.jsx(ft,{variant:"destructive",className:"text-xs",children:"Critical"});case"warning":return g.jsx(ft,{variant:"outline",className:"border-yellow-500 text-yellow-600 text-xs",children:"Warning"});default:return g.jsx(ft,{variant:"outline",className:"text-xs",children:"Info"})}};return g.jsxs(xs,{className:"h-full flex flex-col",children:[g.jsxs(Sn,{className:"pb-3",children:[g.jsx(Mn,{className:"text-sm font-semibold",children:"Diagnostics"}),g.jsxs(ga,{className:"text-xs text-muted-foreground",children:[b.length," problem",b.length!==1?"s":""," detected"]})]}),g.jsxs(Rn,{className:"flex-1 flex flex-col overflow-hidden p-0",children:[g.jsxs("div",{className:"p-4 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search components...",value:l,onChange:R=>d(R.target.value),className:"pl-8 h-8 text-xs"})]}),g.jsxs("div",{className:"flex gap-1",children:[g.jsx(Ee,{variant:h==="all"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>f("all"),children:"All"}),g.jsx(Ee,{variant:h==="critical"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>f("critical"),children:"Critical"}),g.jsx(Ee,{variant:h==="warning"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>f("warning"),children:"Warning"})]})]}),g.jsx(is,{className:"flex-1",children:g.jsx("div",{className:"p-4 space-y-2",children:b.length===0?g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-6",children:[g.jsx(ya,{className:"w-6 h-6 mx-auto mb-1.5 opacity-50"}),g.jsx("p",{children:"No problems detected"})]}):b.map((R,M)=>g.jsxs(xs,{className:`border-l-4 ${R.severity==="critical"?"border-l-red-500":R.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsxs(Sn,{className:"pb-2 p-3",children:[g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[C(R.severity),g.jsx(Mn,{className:"text-xs font-semibold",children:R.nodeLabel}),S(R.severity)]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{r.find(E=>E.id===R.nodeId)&&Re.getState().selectNode(R.nodeId)},children:g.jsx(mA,{className:"w-3.5 h-3.5"})})]}),g.jsx(ga,{className:"text-xs mt-0.5",children:R.problem})]}),g.jsxs(Rn,{className:"pt-0 p-3 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[R.metrics.throughput!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Throughput: "}),g.jsxs("span",{className:"font-mono",children:[R.metrics.throughput.toFixed(0)," ops/s"]})]}),R.metrics.latency!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Latency: "}),g.jsxs("span",{className:"font-mono",children:[R.metrics.latency.toFixed(0),"ms"]})]}),R.metrics.errorRate!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Error Rate: "}),g.jsxs("span",{className:"font-mono",children:[(R.metrics.errorRate*100).toFixed(1),"%"]})]}),R.metrics.utilization!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Utilization: "}),g.jsxs("span",{className:"font-mono",children:[(R.metrics.utilization*100).toFixed(0),"%"]})]})]}),R.rootCause&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Root Cause:"}),g.jsx("div",{className:"text-xs",children:R.rootCause})]}),R.recommendations.length>0&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Recommendations:"}),g.jsx("ul",{className:"text-xs space-y-0.5 list-disc list-inside",children:R.recommendations.map((T,E)=>g.jsx("li",{className:"text-muted-foreground",children:T},E))})]})]})]},M))})})]})]})}function Yz(){const{alerts:r,acknowledgeAlert:t,clearAlerts:e,getCriticalAlerts:s,getWarningAlerts:n}=Kf(),{selectNode:i}=Re(),o=s(),l=n();r.filter(f=>f.type==="info");const d=f=>{switch(f){case"critical":return g.jsx(pa,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(an,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(Eb,{className:"w-4 h-4 text-blue-500"})}},h=f=>{i(f)};return r.length===0?g.jsxs(xs,{className:"h-full",children:[g.jsx(Sn,{children:g.jsx(Mn,{className:"text-sm",children:"Alerts"})}),g.jsx(Rn,{children:g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(Xf,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),g.jsx("p",{children:"No active alerts"})]})})]}):g.jsxs(xs,{className:"h-full flex flex-col",children:[g.jsx(Sn,{className:"pb-3",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx(Mn,{className:"text-sm",children:"Alerts"}),g.jsxs("div",{className:"flex gap-2 mt-1",children:[o.length>0&&g.jsxs(ft,{variant:"destructive",className:"text-xs",children:[o.length," Critical"]}),l.length>0&&g.jsxs(ft,{variant:"outline",className:"text-xs border-yellow-500 text-yellow-600",children:[l.length," Warning"]})]})]}),g.jsx(Ee,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:e,children:"Clear All"})]})}),g.jsx(Rn,{className:"flex-1 overflow-hidden p-0",children:g.jsx(is,{className:"h-full",children:g.jsx("div",{className:"p-4 space-y-2",children:r.map(f=>g.jsx(xs,{className:`border-l-4 ${f.type==="critical"?"border-l-red-500 bg-red-500/5":f.type==="warning"?"border-l-yellow-500 bg-yellow-500/5":"border-l-blue-500 bg-blue-500/5"}`,children:g.jsx(Rn,{className:"p-3",children:g.jsxs("div",{className:"flex items-start justify-between gap-2",children:[g.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[d(f.type),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("h4",{className:"text-xs font-semibold",children:f.title}),g.jsx(ft,{variant:f.type==="critical"?"destructive":f.type==="warning"?"outline":"secondary",className:"text-xs",children:f.type})]}),g.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:f.message}),f.nodeLabel&&g.jsxs(Ee,{variant:"ghost",size:"sm",className:"h-6 text-xs p-1",onClick:()=>f.nodeId&&h(f.nodeId),children:["View: ",f.nodeLabel]}),g.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(f.timestamp).toLocaleTimeString()})]})]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>t(f.id),children:g.jsx(on,{className:"w-3 h-3"})})]})})},f.id))})})})]})}function Wz(){const{nodes:r,connections:t}=Re(),{isRunning:e,componentMetrics:s,connectionMetrics:n}=Nt(),{getSystemAnalysis:i}=ma(),{getCriticalAlerts:o,getWarningAlerts:l}=Kf(),d=w.useMemo(()=>{if(!e)return{totalThroughput:0,averageLatency:0,totalErrorRate:0,activeComponents:0,activeConnections:0,bottlenecks:0,healthyComponents:0,degradedComponents:0,criticalComponents:0};let m=0,y=0,b=0,C=0,S=0,R=0,M=0,T=0,E=0;s.forEach(z=>{(z.throughput>.1||z.errorRate>.001)&&(C++,m+=z.throughput||0,y+=z.latency||0,b+=z.errorRate||0)}),n.forEach(z=>{(z.effectiveThroughput>0||z.traffic>0)&&(S++,z.bottleneck&&R++)});const A=ma.getState();r.forEach(z=>{const q=A.getComponentStatus(z.id);if(q)switch(q.health){case"healthy":M++;break;case"degraded":T++;break;case"critical":case"down":E++;break}});const _=C>0?y/C:0,N=C>0?b/C:0;return{totalThroughput:m,averageLatency:_,totalErrorRate:N,activeComponents:C,activeConnections:S,bottlenecks:R,healthyComponents:M,degradedComponents:T,criticalComponents:E}},[e,s,n,r]),h=o(),f=l();return e?g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(wn,{level:5,children:"Performance"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Total Throughput"}),g.jsxs(da,{status:"success",size:"base",weight:"bold",children:[d.totalThroughput.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ops/s"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Avg Latency"}),g.jsxs(da,{status:"warning",size:"base",weight:"bold",children:[d.averageLatency.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ms"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Error Rate"}),g.jsxs(da,{status:"error",size:"base",weight:"bold",children:[(d.totalErrorRate*100).toFixed(2),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"%"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Bottlenecks"}),g.jsxs(da,{status:"warning",size:"base",weight:"bold",children:[d.bottlenecks,g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"conn"})]})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(wn,{level:5,children:"Component Health"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(Xf,{className:"w-4 h-4 text-success"}),g.jsx(We,{size:"micro",children:"Healthy"})]}),g.jsx(ft,{variant:"outline",className:"bg-success/20 border-success/50 text-success text-xs px-1 py-0",children:d.healthyComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(an,{className:"w-4 h-4 text-warning"}),g.jsx(We,{size:"micro",children:"Degraded"})]}),g.jsx(ft,{variant:"outline",className:"bg-warning/20 border-warning/50 text-warning text-xs px-1 py-0",children:d.degradedComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(an,{className:"w-4 h-4 text-destructive"}),g.jsx(We,{size:"micro",children:"Critical/Down"})]}),g.jsx(ft,{variant:"outline",className:"bg-destructive/20 border-destructive/50 text-destructive text-xs px-1 py-0",children:d.criticalComponents})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(wn,{level:5,children:"Activity"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(XA,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Components"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[d.activeComponents," / ",r.length]})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(_b,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Connections"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[d.activeConnections," / ",t.length]})]})]})]}),(h.length>0||f.length>0)&&g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(wn,{level:5,children:"Alerts"}),g.jsxs("div",{className:"space-y-0.5",children:[h.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(da,{status:"error",size:"micro",children:"Critical"}),g.jsx(ft,{variant:"destructive",className:"text-xs px-1 py-0",children:h.length})]}),f.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(da,{status:"warning",size:"micro",children:"Warnings"}),g.jsx(ft,{variant:"outline",className:"border-warning text-warning text-xs px-1 py-0",children:f.length})]})]})]})]}):g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(ya,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),g.jsx("p",{children:"Start emulation to see system statistics"})]})}const wl=43200,zv=1440,Iv=Symbol.for("constructDateFrom");function qp(r,t){return typeof r=="function"?r(t):r&&typeof r=="object"&&Iv in r?r[Iv](t):r instanceof Date?new r.constructor(t):new Date(t)}function Hi(r,t){return qp(r,r)}let Xz={};function Jz(){return Xz}function Ov(r){const t=Hi(r),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+r-+e}function $p(r,...t){const e=qp.bind(null,r||t.find(s=>typeof s=="object"));return t.map(e)}function Pl(r,t){const e=+Hi(r)-+Hi(t);return e<0?-1:e>0?1:e}function Zz(r){return qp(r,Date.now())}function e5(r,t,e){const[s,n]=$p(e?.in,r,t),i=s.getFullYear()-n.getFullYear(),o=s.getMonth()-n.getMonth();return i*12+o}function t5(r){return t=>{const s=(r?Math[r]:Math.trunc)(t);return s===0?0:s}}function s5(r,t){return+Hi(r)-+Hi(t)}function n5(r,t){const e=Hi(r);return e.setHours(23,59,59,999),e}function i5(r,t){const e=Hi(r),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function a5(r,t){const e=Hi(r);return+n5(e)==+i5(e)}function o5(r,t,e){const[s,n,i]=$p(e?.in,r,r,t),o=Pl(n,i),l=Math.abs(e5(n,i));if(l<1)return 0;n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-o*l);let d=Pl(n,i)===-o;a5(s)&&l===1&&Pl(s,i)===1&&(d=!1);const h=o*(l-+d);return h===0?0:h}function r5(r,t,e){const s=s5(r,t)/1e3;return t5(e?.roundingMethod)(s)}const c5={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},l5=(r,t,e)=>{let s;const n=c5[r];return typeof n=="string"?s=n:t===1?s=n.one:s=n.other.replace("{{count}}",t.toString()),e?.addSuffix?e.comparison&&e.comparison>0?"in "+s:s+" ago":s};function gf(r){return(t={})=>{const e=t.width?String(t.width):r.defaultWidth;return r.formats[e]||r.formats[r.defaultWidth]}}const u5={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},d5={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},h5={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},f5={date:gf({formats:u5,defaultWidth:"full"}),time:gf({formats:d5,defaultWidth:"full"}),dateTime:gf({formats:h5,defaultWidth:"full"})},p5={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},g5=(r,t,e,s)=>p5[r];function Rr(r){return(t,e)=>{const s=e?.context?String(e.context):"standalone";let n;if(s==="formatting"&&r.formattingValues){const o=r.defaultFormattingWidth||r.defaultWidth,l=e?.width?String(e.width):o;n=r.formattingValues[l]||r.formattingValues[o]}else{const o=r.defaultWidth,l=e?.width?String(e.width):r.defaultWidth;n=r.values[l]||r.values[o]}const i=r.argumentCallback?r.argumentCallback(t):t;return n[i]}}const m5={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},y5={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},v5={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},b5={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},x5={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},w5={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},C5=(r,t)=>{const e=Number(r),s=e%100;if(s>20||s<10)switch(s%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"},S5={ordinalNumber:C5,era:Rr({values:m5,defaultWidth:"wide"}),quarter:Rr({values:y5,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Rr({values:v5,defaultWidth:"wide"}),day:Rr({values:b5,defaultWidth:"wide"}),dayPeriod:Rr({values:x5,defaultWidth:"wide",formattingValues:w5,defaultFormattingWidth:"wide"})};function kr(r){return(t,e={})=>{const s=e.width,n=s&&r.matchPatterns[s]||r.matchPatterns[r.defaultMatchWidth],i=t.match(n);if(!i)return null;const o=i[0],l=s&&r.parsePatterns[s]||r.parsePatterns[r.defaultParseWidth],d=Array.isArray(l)?R5(l,m=>m.test(o)):M5(l,m=>m.test(o));let h;h=r.valueCallback?r.valueCallback(d):d,h=e.valueCallback?e.valueCallback(h):h;const f=t.slice(o.length);return{value:h,rest:f}}}function M5(r,t){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)&&t(r[e]))return e}function R5(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return e}function k5(r){return(t,e={})=>{const s=t.match(r.matchPattern);if(!s)return null;const n=s[0],i=t.match(r.parsePattern);if(!i)return null;let o=r.valueCallback?r.valueCallback(i[0]):i[0];o=e.valueCallback?e.valueCallback(o):o;const l=t.slice(n.length);return{value:o,rest:l}}}const E5=/^(\d+)(th|st|nd|rd)?/i,T5=/\d+/i,A5={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},D5={any:[/^b/i,/^(a|c)/i]},_5={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},N5={any:[/1/i,/2/i,/3/i,/4/i]},j5={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},P5={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},L5={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},z5={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},I5={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},O5={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},H5={ordinalNumber:k5({matchPattern:E5,parsePattern:T5,valueCallback:r=>parseInt(r,10)}),era:kr({matchPatterns:A5,defaultMatchWidth:"wide",parsePatterns:D5,defaultParseWidth:"any"}),quarter:kr({matchPatterns:_5,defaultMatchWidth:"wide",parsePatterns:N5,defaultParseWidth:"any",valueCallback:r=>r+1}),month:kr({matchPatterns:j5,defaultMatchWidth:"wide",parsePatterns:P5,defaultParseWidth:"any"}),day:kr({matchPatterns:L5,defaultMatchWidth:"wide",parsePatterns:z5,defaultParseWidth:"any"}),dayPeriod:kr({matchPatterns:I5,defaultMatchWidth:"any",parsePatterns:O5,defaultParseWidth:"any"})},q5={code:"en-US",formatDistance:l5,formatLong:f5,formatRelative:g5,localize:S5,match:H5,options:{weekStartsOn:0,firstWeekContainsDate:1}};function $5(r,t,e){const s=Jz(),n=e?.locale??s.locale??q5,i=2520,o=Pl(r,t);if(isNaN(o))throw new RangeError("Invalid time value");const l=Object.assign({},e,{addSuffix:e?.addSuffix,comparison:o}),[d,h]=$p(e?.in,...o>0?[t,r]:[r,t]),f=r5(h,d),m=(Ov(h)-Ov(d))/1e3,y=Math.round((f-m)/60);let b;if(y<2)return e?.includeSeconds?f<5?n.formatDistance("lessThanXSeconds",5,l):f<10?n.formatDistance("lessThanXSeconds",10,l):f<20?n.formatDistance("lessThanXSeconds",20,l):f<40?n.formatDistance("halfAMinute",0,l):f<60?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",1,l):y===0?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",y,l);if(y<45)return n.formatDistance("xMinutes",y,l);if(y<90)return n.formatDistance("aboutXHours",1,l);if(y<zv){const C=Math.round(y/60);return n.formatDistance("aboutXHours",C,l)}else{if(y<i)return n.formatDistance("xDays",1,l);if(y<wl){const C=Math.round(y/zv);return n.formatDistance("xDays",C,l)}else if(y<wl*2)return b=Math.round(y/wl),n.formatDistance("aboutXMonths",b,l)}if(b=o5(h,d),b<12){const C=Math.round(y/wl);return n.formatDistance("xMonths",C,l)}else{const C=b%12,S=Math.trunc(b/12);return C<3?n.formatDistance("aboutXYears",S,l):C<9?n.formatDistance("overXYears",S,l):n.formatDistance("almostXYears",S+1,l)}}function B5(r,t){return $5(r,Zz(r),t)}function U5(){const{errors:r,updateErrors:t,clearErrors:e,removeError:s,getErrorCount:n,getStats:i}=Cb(),{nodes:o}=Re(),[l,d]=w.useState("all"),[h,f]=w.useState("all"),[m,y]=w.useState("all"),[b,C]=w.useState("");w.useEffect(()=>{t();const N=setInterval(()=>{t()},1e3);return()=>clearInterval(N)},[t]);const S=i(),R=w.useMemo(()=>{let N=r;if(l!=="all"&&(N=N.filter(z=>z.severity===l)),h!=="all"&&(N=N.filter(z=>z.source===h)),m!=="all"&&(N=N.filter(z=>z.componentId===m)),b){const z=b.toLowerCase();N=N.filter(q=>q.message.toLowerCase().includes(z)||q.componentLabel?.toLowerCase().includes(z)||q.componentType?.toLowerCase().includes(z)||q.errorType?.toLowerCase().includes(z))}return N},[r,l,h,m,b]),M=w.useMemo(()=>{const N=new Map;return r.forEach(z=>{z.componentId&&z.componentLabel&&N.set(z.componentId,{id:z.componentId,label:z.componentLabel,type:z.componentType||"unknown"})}),Array.from(N.values())},[r]),T=N=>{switch(N){case"critical":return g.jsx(xA,{className:"h-3 w-3 text-red-500"});case"warning":return g.jsx(an,{className:"h-3 w-3 text-yellow-500"});case"info":return g.jsx(Eb,{className:"h-3 w-3 text-blue-500"})}},E=N=>{switch(N){case"critical":return g.jsx(ft,{variant:"destructive",className:"text-[9px] px-1 py-0 h-4",children:"Critical"});case"warning":return g.jsx(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"Warning"});case"info":return g.jsx(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-blue-500/10 text-blue-600 border-blue-500",children:"Info"})}},A=N=>{const z={"emulation-engine":"bg-purple-500/10 text-purple-600 border-purple-500","component-engine":"bg-green-500/10 text-green-600 border-green-500","alert-system":"bg-orange-500/10 text-orange-600 border-orange-500","data-flow":"bg-cyan-500/10 text-cyan-600 border-cyan-500","routing-engine":"bg-pink-500/10 text-pink-600 border-pink-500",initialization:"bg-indigo-500/10 text-indigo-600 border-indigo-500",configuration:"bg-gray-500/10 text-gray-600 border-gray-500",unknown:"bg-gray-500/10 text-gray-600 border-gray-500"},q={"emulation-engine":"Engine","component-engine":"Component","alert-system":"Alert","data-flow":"DataFlow","routing-engine":"Routing",initialization:"Init",configuration:"Config",unknown:"Unknown"};return g.jsx(ft,{variant:"outline",className:`text-[9px] px-1 py-0 h-4 ${z[N]||z.unknown}`,children:q[N]||q.unknown})},_=N=>{try{return B5(new Date(N),{addSuffix:!0})}catch{return"unknown time"}};return g.jsxs("div",{className:"h-full flex flex-col",children:[g.jsxs("div",{className:"p-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(va,{className:"h-4 w-4 text-muted-foreground"}),g.jsx("h3",{className:"text-sm font-semibold",children:"Simulation Errors"})]}),r.length>0&&g.jsxs(Ee,{variant:"ghost",size:"sm",onClick:e,className:"h-6 text-xs",children:[g.jsx(Zl,{className:"h-3 w-3 mr-1"}),"Clear All"]})]}),g.jsxs("div",{className:"flex gap-2 text-xs",children:[g.jsxs(ft,{variant:"outline",className:"text-xs",children:["Total: ",S.total]}),S.critical>0&&g.jsxs(ft,{variant:"destructive",className:"text-xs",children:["Critical: ",S.critical]}),S.warning>0&&g.jsxs(ft,{variant:"outline",className:"text-xs bg-yellow-500/10 text-yellow-600 border-yellow-500",children:["Warning: ",S.warning]}),S.info>0&&g.jsxs(ft,{variant:"outline",className:"text-xs bg-blue-500/10 text-blue-600 border-blue-500",children:["Info: ",S.info]})]})]}),g.jsxs("div",{className:"p-2 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx($r,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-muted-foreground"}),g.jsx(Tt,{placeholder:"Search errors...",value:b,onChange:N=>C(N.target.value),className:"h-7 pl-7 text-xs"})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[g.jsxs(Nl,{value:l,onValueChange:N=>d(N),children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(jl,{placeholder:"Severity"})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"all",children:"All Severities"}),g.jsx(Vt,{value:"critical",children:"Critical"}),g.jsx(Vt,{value:"warning",children:"Warning"}),g.jsx(Vt,{value:"info",children:"Info"})]})]}),g.jsxs(Nl,{value:h,onValueChange:N=>f(N),children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(jl,{placeholder:"Source"})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"all",children:"All Sources"}),g.jsx(Vt,{value:"emulation-engine",children:"Emulation Engine"}),g.jsx(Vt,{value:"component-engine",children:"Component Engine"}),g.jsx(Vt,{value:"alert-system",children:"Alert System"}),g.jsx(Vt,{value:"data-flow",children:"Data Flow"}),g.jsx(Vt,{value:"routing-engine",children:"Routing Engine"}),g.jsx(Vt,{value:"initialization",children:"Initialization"}),g.jsx(Vt,{value:"configuration",children:"Configuration"})]})]})]}),M.length>0&&g.jsxs(Nl,{value:m,onValueChange:y,children:[g.jsx(Dr,{className:"h-7 text-xs",children:g.jsx(jl,{placeholder:"Component"})}),g.jsxs(_r,{children:[g.jsx(Vt,{value:"all",children:"All Components"}),M.map(N=>g.jsxs(Vt,{value:N.id,children:[N.label," (",N.type,")"]},N.id))]})]})]}),g.jsx(is,{className:"flex-1",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:R.length===0?g.jsx("div",{className:"text-center text-sm text-muted-foreground py-8",children:r.length===0?g.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g.jsx(va,{className:"h-8 w-8 opacity-50"}),g.jsx("p",{children:"No errors detected"})]}):g.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g.jsx(kb,{className:"h-8 w-8 opacity-50"}),g.jsx("p",{children:"No errors match the filters"})]})}):R.map(N=>g.jsxs(xs,{className:`border-l-2 ${N.severity==="critical"?"border-l-red-500":N.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsx(Sn,{className:"pb-1 p-1.5",children:g.jsxs("div",{className:"flex items-start justify-between gap-1",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5 flex-wrap",children:[g.jsx("span",{className:"flex-shrink-0",children:T(N.severity)}),g.jsx(Mn,{className:"text-[11px] font-semibold truncate",children:N.componentLabel||"System"}),g.jsx("span",{className:"flex-shrink-0",children:E(N.severity)}),g.jsx("span",{className:"flex-shrink-0",children:A(N.source)}),N.count&&N.count>1&&g.jsxs(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4",children:[N.count,"x"]})]}),g.jsx(ga,{className:"text-[10px] mt-0.5 break-words line-clamp-2",children:N.message}),g.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[9px] text-muted-foreground",children:[g.jsx("span",{children:_(N.timestamp)}),N.componentType&&g.jsxs("span",{className:"truncate",children:[" ",N.componentType]}),N.errorType&&g.jsxs("span",{className:"truncate",children:[" ",N.errorType]})]})]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-5 w-5 flex-shrink-0",onClick:()=>s(N.id),children:g.jsx(on,{className:"h-3 w-3"})})]})}),N.context&&Object.keys(N.context).length>0||N.stack?g.jsxs(Rn,{className:"pt-0 p-1.5 space-y-1",children:[N.context&&Object.keys(N.context).length>0&&g.jsxs("details",{className:"text-[9px]",children:[g.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Context"}),g.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:JSON.stringify(N.context,null,2)})]}),N.stack&&g.jsxs("details",{className:"text-[9px]",children:[g.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Stack"}),g.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:N.stack})]})]}):null]},N.id))})})]})}var ju="Checkbox",[F5]=ws(ju),[V5,Bp]=F5(ju);function Q5(r){const{__scopeCheckbox:t,checked:e,children:s,defaultChecked:n,disabled:i,form:o,name:l,onCheckedChange:d,required:h,value:f="on",internal_do_not_use_render:m}=r,[y,b]=kn({prop:e,defaultProp:n??!1,onChange:d,caller:ju}),[C,S]=w.useState(null),[R,M]=w.useState(null),T=w.useRef(!1),E=C?!!o||!!C.closest("form"):!0,A={checked:y,disabled:i,setChecked:b,control:C,setControl:S,name:l,form:o,value:f,hasConsumerStoppedPropagationRef:T,required:h,defaultChecked:zi(n)?!1:n,isFormControl:E,bubbleInput:R,setBubbleInput:M};return g.jsx(V5,{scope:t,...A,children:G5(m)?m(A):s})}var YS="CheckboxTrigger",WS=w.forwardRef(({__scopeCheckbox:r,onKeyDown:t,onClick:e,...s},n)=>{const{control:i,value:o,disabled:l,checked:d,required:h,setControl:f,setChecked:m,hasConsumerStoppedPropagationRef:y,isFormControl:b,bubbleInput:C}=Bp(YS,r),S=je(n,f),R=w.useRef(d);return w.useEffect(()=>{const M=i?.form;if(M){const T=()=>m(R.current);return M.addEventListener("reset",T),()=>M.removeEventListener("reset",T)}},[i,m]),g.jsx(De.button,{type:"button",role:"checkbox","aria-checked":zi(d)?"mixed":d,"aria-required":h,"data-state":tM(d),"data-disabled":l?"":void 0,disabled:l,value:o,...s,ref:S,onKeyDown:ge(t,M=>{M.key==="Enter"&&M.preventDefault()}),onClick:ge(e,M=>{m(T=>zi(T)?!0:!T),C&&b&&(y.current=M.isPropagationStopped(),y.current||M.stopPropagation())})})});WS.displayName=YS;var Up=w.forwardRef((r,t)=>{const{__scopeCheckbox:e,name:s,checked:n,defaultChecked:i,required:o,disabled:l,value:d,onCheckedChange:h,form:f,...m}=r;return g.jsx(Q5,{__scopeCheckbox:e,checked:n,defaultChecked:i,disabled:l,required:o,onCheckedChange:h,name:s,form:f,value:d,internal_do_not_use_render:({isFormControl:y})=>g.jsxs(g.Fragment,{children:[g.jsx(WS,{...m,ref:t,__scopeCheckbox:e}),y&&g.jsx(eM,{__scopeCheckbox:e})]})})});Up.displayName=ju;var XS="CheckboxIndicator",JS=w.forwardRef((r,t)=>{const{__scopeCheckbox:e,forceMount:s,...n}=r,i=Bp(XS,e);return g.jsx(cs,{present:s||zi(i.checked)||i.checked===!0,children:g.jsx(De.span,{"data-state":tM(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:t,style:{pointerEvents:"none",...r.style}})})});JS.displayName=XS;var ZS="CheckboxBubbleInput",eM=w.forwardRef(({__scopeCheckbox:r,...t},e)=>{const{control:s,hasConsumerStoppedPropagationRef:n,checked:i,defaultChecked:o,required:l,disabled:d,name:h,value:f,form:m,bubbleInput:y,setBubbleInput:b}=Bp(ZS,r),C=je(e,b),S=ku(i),R=xu(s);w.useEffect(()=>{const T=y;if(!T)return;const E=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(E,"checked").set,N=!n.current;if(S!==i&&_){const z=new Event("click",{bubbles:N});T.indeterminate=zi(i),_.call(T,zi(i)?!1:i),T.dispatchEvent(z)}},[y,S,i,n]);const M=w.useRef(zi(i)?!1:i);return g.jsx(De.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??M.current,required:l,disabled:d,name:h,value:f,form:m,...t,tabIndex:-1,ref:C,style:{...t.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});eM.displayName=ZS;function G5(r){return typeof r=="function"}function zi(r){return r==="indeterminate"}function tM(r){return zi(r)?"indeterminate":r?"checked":"unchecked"}const Of=w.forwardRef(({className:r,...t},e)=>g.jsx(Up,{ref:e,className:ke("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...t,children:g.jsx(JS,{className:ke("grid place-content-center text-current"),children:g.jsx(Yf,{className:"h-4 w-4"})})}));Of.displayName=Up.displayName;function sM({open:r,groupName:t,onConfirm:e,onCancel:s}){return g.jsx($x,{open:r,onOpenChange:n=>!n&&s(),children:g.jsxs(up,{children:[g.jsxs(Ux,{children:[g.jsx(dp,{children:"Delete Group?"}),g.jsxs(hp,{children:['Are you sure you want to delete the group "',t,'"? This action cannot be undone.']})]}),g.jsxs(Fx,{children:[g.jsx(pp,{onClick:s,children:"Cancel"}),g.jsx(fp,{onClick:e,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}function K5({group:r}){const{nodes:t,updateGroup:e,deleteGroup:s,removeNodeFromGroup:n,addNodeToGroup:i,selectGroup:o}=Re(),[l,d]=w.useState(!1),[h,f]=w.useState(!1),[m,y]=w.useState(!1),[b,C]=w.useState(new Set),S=A=>{e(r.id,{name:A}),Ye.success("Group renamed"),f(!1)},R=()=>{d(!0)},M=()=>{s(r.id),o(null),Ye.success("Group deleted"),d(!1)},T=A=>{n(r.id,A),Ye.success("Component removed from group")},E=t.filter(A=>r.nodeIds.includes(A.id));return g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{children:[g.jsx(nt,{htmlFor:"group-name",className:"text-xs font-medium",children:"Group Name"}),g.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[g.jsx(Tt,{id:"group-name",value:r.name,onChange:A=>e(r.id,{name:A.target.value}),className:"flex-1 h-8 text-xs"}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:R,children:g.jsx(Zl,{className:"h-3.5 w-3.5 text-destructive"})})]})]}),g.jsx(sM,{open:l,groupName:r.name,onConfirm:M,onCancel:()=>d(!1)}),g.jsx(mp,{open:h,initialName:r.name,onConfirm:S,onCancel:()=>f(!1)}),g.jsx(bs,{}),g.jsxs("div",{className:"flex items-center space-x-2",children:[g.jsx(Of,{id:"show-name",checked:r.showName!==!1,onCheckedChange:A=>e(r.id,{showName:A!==!1})}),g.jsx(nt,{htmlFor:"show-name",className:"text-xs font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show name on canvas"})]}),g.jsx(bs,{}),g.jsxs("div",{children:[g.jsx(nt,{className:"text-xs font-medium mb-1.5 block",children:"Color"}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("input",{type:"color",value:r.color||"#3b82f6",onChange:A=>e(r.id,{color:A.target.value}),className:"w-10 h-8 rounded border border-border cursor-pointer"}),g.jsx(Tt,{value:r.color||"#3b82f6",onChange:A=>e(r.id,{color:A.target.value}),className:"flex-1 font-mono text-xs h-8",placeholder:"#3b82f6"})]})]}),g.jsx(bs,{}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs(nt,{className:"text-xs font-medium",children:["Components (",r.nodeIds.length,")"]}),g.jsxs(Ee,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{if(Re.getState().nodes.filter(N=>!r.nodeIds.includes(N.id)).length===0){Ye.info("All components are already in this group");return}C(new Set),y(!0)},children:[g.jsx(Hl,{className:"h-3 w-3 mr-1"}),"Add"]})]}),g.jsxs("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[E.map(A=>g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-secondary/50 rounded border border-border",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-xs font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:A.type})]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>T(A.id),title:"Remove from group",children:g.jsx(on,{className:"h-3 w-3"})})]},A.id)),E.length===0&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-3",children:"No components in group"})]})]}),g.jsx(bs,{}),g.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[g.jsx("span",{children:"Group ID:"}),g.jsx("code",{className:"font-mono bg-secondary/50 px-1.5 py-0.5 rounded text-[10px]",children:r.id})]}),g.jsx(gp,{open:m,onOpenChange:y,children:g.jsxs(ru,{className:"max-w-md",children:[g.jsxs(cu,{children:[g.jsx(uu,{children:"Add Components to Group"}),g.jsxs(du,{children:['Select components to add to "',r.name,'"']})]}),g.jsx(is,{className:"max-h-96",children:g.jsxs("div",{className:"space-y-2 py-2",children:[t.filter(A=>!r.nodeIds.includes(A.id)).map(A=>g.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border border-border hover:bg-secondary/50 cursor-pointer",onClick:()=>{const _=new Set(b);_.has(A.id)?_.delete(A.id):_.add(A.id),C(_)},children:[g.jsx(Of,{checked:b.has(A.id),onCheckedChange:_=>{const N=new Set(b);_?N.add(A.id):N.delete(A.id),C(N)}}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-xs text-muted-foreground truncate",children:A.type})]})]},A.id)),t.filter(A=>!r.nodeIds.includes(A.id)).length===0&&g.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"All components are already in this group"})]})}),g.jsxs(lu,{children:[g.jsx(Ee,{variant:"outline",onClick:()=>{y(!1),C(new Set)},children:"Cancel"}),g.jsxs(Ee,{onClick:()=>{if(b.size===0){Ye.error("Select at least one component");return}b.forEach(A=>{i(r.id,A)}),Ye.success(`${b.size} component(s) added to group`),y(!1),C(new Set)},children:["Add Selected (",b.size,")"]})]})]})})]})}function Y5(){const{selectedNodeId:r,nodes:t,updateNode:e,selectNode:s,connections:n,updateConnection:i,selectedConnectionId:o,selectConnection:l,selectedGroupId:d,groups:h,selectGroup:f}=Re(),{addTab:m}=Ru(),y=t.find(S=>S.id===r),b=n.find(S=>S.id===o),C=h.find(S=>S.id===d);return C?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(nf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Group Properties"})]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>f(null),children:g.jsx(on,{className:"h-3 w-3"})})]}),g.jsx(is,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(K5,{group:C})})})]}):!y&&!b?g.jsx("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:g.jsxs(vp,{defaultValue:"stats",className:"h-full flex flex-col",children:[g.jsx("div",{className:"p-1 border-b border-border",children:g.jsxs(gu,{className:"grid w-full grid-cols-6 h-6 gap-0.5 p-0.5",children:[g.jsx(sn,{value:"stats",className:"text-xs px-1 py-0.5",children:"Stats"}),g.jsx(sn,{value:"diagnostics",className:"text-xs px-1 py-0.5",children:"Diag"}),g.jsx(sn,{value:"alerts",className:"text-xs px-1 py-0.5",children:"Alerts"}),g.jsx(sn,{value:"errors",className:"text-xs px-1 py-0.5",children:"Errors"}),g.jsx(sn,{value:"filters",className:"text-xs px-1 py-0.5",children:"Filter"}),g.jsx(sn,{value:"properties",className:"text-xs px-1 py-0.5",children:"Groups"})]})}),g.jsx(si,{value:"stats",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(is,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(Wz,{})})})}),g.jsx(si,{value:"diagnostics",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(Kz,{})}),g.jsx(si,{value:"alerts",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(Yz,{})}),g.jsx(si,{value:"errors",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(U5,{})}),g.jsx(si,{value:"filters",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(is,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(Gz,{})})})}),g.jsx(si,{value:"properties",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(is,{className:"h-full",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:g.jsxs("div",{children:[g.jsxs(ti,{as:"h4",className:"mb-1",children:["Groups (",h.length,")"]}),h.length>0?g.jsx("div",{className:"space-y-1",children:h.map(S=>g.jsx("div",{className:"p-1.5 bg-secondary/50 rounded border border-border cursor-pointer hover:bg-secondary transition-colors",onClick:()=>f(S.id),children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx(We,{size:"small",className:"font-medium truncate",children:S.name}),g.jsxs(We,{size:"micro",muted:!0,children:[S.nodeIds.length," component",S.nodeIds.length!==1?"s":""]})]}),g.jsx("div",{className:"w-2.5 h-2.5 rounded border-2 border-border flex-shrink-0 ml-1",style:{backgroundColor:S.color||"hsl(var(--primary))"}})]})},S.id))}):g.jsx(We,{size:"micro",muted:!0,className:"text-center py-2",children:"No groups created yet"})]})})})})]})}):b?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(nf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Connection"})]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>l(null),children:g.jsx(on,{className:"h-3 w-3"})})]}),g.jsx(is,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(Mz,{connection:b,onUpdate:(S,R)=>i(S,R)})})})]}):g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(nf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(ti,{children:"Properties"})]}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>s(null),children:g.jsx(on,{className:"h-3 w-3"})})]}),g.jsx(is,{className:"flex-1",children:g.jsxs("div",{className:"p-1.5 space-y-1.5",children:[g.jsx(Qz,{componentId:y.id,componentLabel:y.data.label}),g.jsx(bs,{}),g.jsxs("div",{children:[g.jsx(nt,{htmlFor:"label",className:"text-xs font-medium",children:"Label"}),g.jsx(Tt,{id:"label",value:y.data.label,onChange:S=>e(y.id,{data:{...y.data,label:S.target.value}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsx(bs,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Position"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{children:[g.jsx(nt,{htmlFor:"pos-x",className:"text-xs text-muted-foreground",children:"X"}),g.jsx(Tt,{id:"pos-x",type:"number",value:Math.round(y.position.x),onChange:S=>e(y.id,{position:{...y.position,x:parseInt(S.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsxs("div",{children:[g.jsx(nt,{htmlFor:"pos-y",className:"text-xs text-muted-foreground",children:"Y"}),g.jsx(Tt,{id:"pos-y",type:"number",value:Math.round(y.position.y),onChange:S=>e(y.id,{position:{...y.position,y:parseInt(S.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]})]})]}),g.jsx(bs,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Component Type"}),g.jsx("div",{className:"bg-secondary/50 rounded-md p-1.5 border border-border",children:g.jsx(We,{mono:!0,size:"small",children:y.type})})]}),g.jsx(bs,{}),g.jsxs("div",{children:[g.jsx(ti,{as:"h4",className:"mb-1",children:"Configuration"}),g.jsx(Ee,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:()=>{m({title:`${y.data.label} Config`,type:"component",componentId:y.id,componentType:y.type})},children:"Open Configuration Panel"})]})]})})]})}function W5(){const{tabs:r,setActiveTab:t,closeTab:e,addTab:s}=Ru(),n=()=>{s({title:"Untitled Diagram",type:"diagram"})};return g.jsx("div",{className:"h-10 bg-secondary/30 border-b border-border flex items-center",children:g.jsxs(is,{className:"flex-1",children:[g.jsxs("div",{className:"flex items-center",children:[r.map(i=>g.jsxs("div",{className:`
                flex items-center gap-2 px-4 h-10 border-r border-border cursor-pointer group
                transition-colors
                ${i.active?"bg-canvas-bg text-foreground":"text-muted-foreground hover:bg-secondary/50"}
              `,onClick:()=>t(i.id),children:[g.jsx("span",{className:"text-sm",children:i.title}),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:bg-destructive/10",onClick:o=>{o.stopPropagation(),e(i.id)},children:g.jsx(on,{className:"h-3 w-3"})})]},i.id)),g.jsx(Ee,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:n,children:g.jsx(Hl,{className:"h-4 w-4"})})]}),g.jsx(su,{orientation:"horizontal"})]})})}const Hv=r=>Symbol.iterator in r,qv=r=>"entries"in r,$v=(r,t)=>{const e=r instanceof Map?r:new Map(r.entries()),s=t instanceof Map?t:new Map(t.entries());if(e.size!==s.size)return!1;for(const[n,i]of e)if(!s.has(n)||!Object.is(i,s.get(n)))return!1;return!0},X5=(r,t)=>{const e=r[Symbol.iterator](),s=t[Symbol.iterator]();let n=e.next(),i=s.next();for(;!n.done&&!i.done;){if(!Object.is(n.value,i.value))return!1;n=e.next(),i=s.next()}return!!n.done&&!!i.done};function J5(r,t){return Object.is(r,t)?!0:typeof r!="object"||r===null||typeof t!="object"||t===null||Object.getPrototypeOf(r)!==Object.getPrototypeOf(t)?!1:Hv(r)&&Hv(t)?qv(r)&&qv(t)?$v(r,t):X5(r,t):$v({entries:()=>Object.entries(r)},{entries:()=>Object.entries(t)})}function nM(r){const t=Et.useRef(void 0);return e=>{const s=r(e);return J5(t.current,s)?t.current:t.current=s}}const Bv=globalThis;function Cl(r){try{if(typeof Bv.structuredClone=="function")return Bv.structuredClone(r)}catch{}return JSON.parse(JSON.stringify(r))}function So(r,t,e=140,s=100,n=16){const i=[],o=e/2,l=s/2,d=r+o,h=t+l;for(let f=0;f<n;f++){const m=f/n*2*Math.PI-Math.PI/2;let y,b;const C=(m%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(C>=0&&C<Math.PI/2){const S=C/(Math.PI/2);y=d+o,b=h-l+S*s}else if(C>=Math.PI/2&&C<Math.PI){const S=(C-Math.PI/2)/(Math.PI/2);y=d+o-S*e,b=h+l}else if(C>=Math.PI&&C<3*Math.PI/2){const S=(C-Math.PI)/(Math.PI/2);y=d-o,b=h+l-S*s}else{const S=(C-3*Math.PI/2)/(Math.PI/2);y=d-o+S*e,b=h-l}i.push({x:y,y:b,index:f})}return i}function Z5(r,t,e){let s=1/0,n=0;for(let i=0;i<r.length;i++){const o=r[i],l=Math.sqrt(Math.pow(t-o.x,2)+Math.pow(e-o.y,2));l<s&&(s=l,n=i)}return n}function Uv(r,t,e,s,n,i,o,l=140,d=100){const h=So(i,o,l,d),f=Z5(h,e,s);if(n.filter(y=>y.source===r&&y.target===t&&y.sourcePort===f||y.target===r&&y.source===t&&y.targetPort===f).length===0)return f;for(let y=1;y<h.length;y++){const b=(f+y)%h.length,C=(f-y+h.length)%h.length;if(n.filter(M=>M.source===r&&M.target===t&&M.sourcePort===b||M.target===r&&M.source===t&&M.targetPort===b).length===0)return b;if(n.filter(M=>M.source===r&&M.target===t&&M.sourcePort===C||M.target===r&&M.source===t&&M.targetPort===C).length===0)return C}return f}const iM=w.createContext(null);function eI({children:r}){const t=w.useRef(new Map),e=w.useCallback((o,l)=>{l?t.current.set(o,l):t.current.delete(o)},[]),s=w.useCallback(o=>t.current.get(o)||null,[]),n=w.useCallback(o=>{t.current.delete(o)},[]),i={registerNodeRef:e,getNodeRef:s,unregisterNodeRef:n};return g.jsx(iM.Provider,{value:i,children:r})}function Pu(){const r=w.useContext(iM);if(!r)throw new Error("useNodeRefs must be used within NodeRefsProvider");return r}function tI({node:r,onConnectionStart:t,onConnectionEnd:e,isConnecting:s=!1,onContextMenu:n}){const{registerNodeRef:i,unregisterNodeRef:o}=Pu(),l=w.useRef(null);w.useEffect(()=>(l.current&&i(r.id,l.current),()=>{o(r.id)}),[r.id,i,o]);const d=Re(de=>de.selectNode),h=Re(de=>de.updateNode),f=Re(de=>de.updateNodes),m=Re(de=>de.deleteNode);Re(de=>de.addNode);const y=Re(de=>de.startDragOperation),b=Re(de=>de.endDragOperation);Re(de=>de.bringToFront),Re(de=>de.sendToBack),Re(de=>de.bringForward),Re(de=>de.sendBackward);const{connections:C,zoom:S,pan:R,nodes:M}=Re(nM(de=>({connections:de.connections,zoom:de.zoom,pan:de.pan,nodes:de.nodes}))),{addTab:T}=Ru(),[E,A]=w.useState(!1),[_,N]=w.useState(!1),z=w.useRef({x:0,y:0}),q=w.useRef({x:0,y:0}),Z=w.useRef({x:0,y:0}),ne=w.useRef({x:0,y:0}),ce=w.useRef(null),J=w.useRef(null),te=w.useRef(!1),le=w.useRef(!1),ue=w.useRef({}),L=w.useMemo(()=>Pr.find(de=>de.type===r.type),[r.type]),{isRunning:j,getComponentMetrics:O}=Nt(),W=ma(de=>de.getComponentStatus(r.id)),fe=KS(de=>de.getComponentState(r.id)),P=j?O(r.id):void 0,Y=Br(de=>de.highlightedNodeId)===r.id,ie=w.useMemo(()=>C.some(de=>de.source===r.id||de.target===r.id),[C,r.id]),U=P&&(P.throughput&&P.throughput>.1||P.errorRate&&P.errorRate>.001||P.utilization&&P.utilization>.01),ae=()=>{if(!j||!P||!ie||!U)return"";const de=P.utilization||0,$e=P.errorRate||0,Ue=Math.min(1,de*.7+$e*.3);return Ue>.8?"border-red-500":Ue>.6?"border-orange-500":Ue>.4?"border-yellow-500":Ue>.2?"border-green-500":""},B=()=>{if(!j)return null;if(fe)switch(fe.state){case"disabled":case"failed":return g.jsx(El,{className:"text-red-500",size:16});case"degraded":return g.jsx(an,{className:"text-yellow-500",size:16})}if(!ie||!U||!W)return null;const de=W.health,$e=16;switch(de){case"healthy":return g.jsx(Xf,{className:"text-green-500",size:$e});case"degraded":return g.jsx(an,{className:"text-yellow-500",size:$e});case"critical":return g.jsx(va,{className:"text-orange-500",size:$e});case"down":return g.jsx(pa,{className:"text-red-500",size:$e});default:return null}},G=()=>{if(!j)return r.selected?"border-primary":"border-border";if(fe)switch(fe.state){case"disabled":case"failed":return"border-red-500 border-2";case"degraded":return"border-yellow-500 border-2"}if(!W)return r.selected?"border-primary":"border-border";if(W.criticalPath)return"border-purple-500 border-2";switch(W.health){case"down":return"border-red-500 border-2";case"critical":return"border-orange-500";case"degraded":return"border-yellow-500";default:return r.selected?"border-primary":"border-border"}},pe=w.useRef(S),me=w.useRef(R);w.useEffect(()=>{pe.current=S,me.current=R},[S,R]),w.useEffect(()=>{const de=Ue=>{if(!te.current)return;if(Re.getState().getIsGroupDragging()){te.current=!1,le.current=!1,A(!1);return}const mt=Ue.clientX-q.current.x,$t=Ue.clientY-q.current.y,Ze=Math.sqrt(mt*mt+$t*$t);if(!le.current&&Ze>3){le.current=!0,A(!0),y(r.id);const xt=Re.getState().nodes.filter(yt=>yt.selected);ue.current={},xt.forEach(yt=>{ue.current[yt.id]={x:yt.position.x,y:yt.position.y}})}if(le.current&&ce.current){const Pt=pe.current,xt=me.current,yt=ce.current.getBoundingClientRect(),Xt=(Ue.clientX-yt.left-xt.x)/Pt,Gt=(Ue.clientY-yt.top-xt.y)/Pt,_n=Xt-Z.current.x,Ws=Gt-Z.current.y,hn=Re.getState().nodes.filter(Kt=>Kt.selected),Jt=Object.keys(ue.current).length>0;if(hn.length>1&&Jt){const Kt=[];hn.forEach(Lt=>{const Fi=ue.current[Lt.id];Fi&&Kt.push({id:Lt.id,updates:{position:{x:Fi.x+_n,y:Fi.y+Ws}}})}),Kt.length>0&&f(Kt,!0)}else{const Kt=ne.current.x+_n,Lt=ne.current.y+Ws;h(r.id,{position:{x:Kt,y:Lt}},!0)}}},$e=()=>{te.current&&(te.current=!1,le.current&&(le.current=!1,A(!1),b()))};return document.addEventListener("mousemove",de),document.addEventListener("mouseup",$e),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",$e)}},[r.id,h,f,y,b]);const ye=de=>{if(de.button!==0)return;const Ue=Re.getState().nodes.filter(_s=>_s.selected),bt=r.selected,mt=Ue.some(_s=>_s.id!==r.id);if(!(bt&&mt&&!de.ctrlKey&&!de.metaKey)){const _s=de.ctrlKey||de.metaKey;d(r.id,_s)}const $t=document.querySelector(".flex-1.overflow-hidden.relative");if(!$t){z.current={x:0,y:0},Z.current={x:0,y:0},ne.current={x:0,y:0},ce.current=null,J.current=null;return}ce.current=$t;const Ze=pe.current,Pt=me.current,xt=$t.getBoundingClientRect();J.current=xt;const yt=(de.clientX-xt.left-Pt.x)/Ze,Xt=(de.clientY-xt.top-Pt.y)/Ze;Z.current={x:yt,y:Xt};const Ws=Re.getState().nodes.find(_s=>_s.id===r.id)?.position||r.position;ne.current={x:Ws.x,y:Ws.y},z.current={x:yt-Ws.x,y:Xt-Ws.y},q.current={x:de.clientX,y:de.clientY},te.current=!0,le.current=!1,de.stopPropagation()},ve=de=>{de.stopPropagation(),de.preventDefault(),E&&(A(!1),b()),T({title:`${r.data.label} Config`,type:"component",componentId:r.id,componentType:r.type})},Pe=de=>{de.key==="Delete"&&r.selected&&m(r.id)},Be=de=>{if(de.preventDefault(),de.stopPropagation(),!r.selected){const $e=M.some(Ue=>Ue.id!==r.id&&Ue.selected);d(r.id,$e)}n?.(de.clientX,de.clientY)},at=(de,$e)=>{de.stopPropagation(),t?.($e)},Je=w.useCallback(()=>{if(!l.current)return{width:140,height:100};const Ue=(l.current.querySelector(".bg-card")||l.current).getBoundingClientRect();return{width:Ue.width/S,height:Ue.height/S}},[S]),jt=de=>{if(s){de.stopPropagation();const $e=Je(),Ue=So(r.position.x,r.position.y,$e.width,$e.height,16),bt=document.querySelector(".flex-1.overflow-hidden.relative");if(bt){const mt=bt.getBoundingClientRect(),$t=(de.clientX-mt.left-R.x)/S,Ze=(de.clientY-mt.top-R.y)/S;let Pt=1/0,xt=0;for(let yt=0;yt<Ue.length;yt++){const Xt=Ue[yt],Gt=Math.sqrt(Math.pow($t-Xt.x,2)+Math.pow(Ze-Xt.y,2));Gt<Pt&&(Pt=Gt,xt=yt)}e?.(xt)}else e?.()}};return g.jsx(g.Fragment,{children:g.jsx("div",{ref:l,"data-node-id":r.id,className:`
          absolute cursor-move select-none
          transition-shadow
          ${r.selected?"glow-primary":""}
          ${E?"pointer-events-none":""}
        `,style:{left:`${r.position.x}px`,top:`${r.position.y}px`},onMouseDown:ye,onMouseUp:jt,onDoubleClick:ve,onContextMenu:Be,onKeyDown:Pe,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),tabIndex:0,children:g.jsxs("div",{className:ke("bg-card border-2 rounded-lg p-4 min-w-[140px] relative",G(),ae(),"hover:border-primary/50 transition-colors",W?.criticalPath&&"shadow-lg shadow-purple-500/20",Y&&"ring-4 ring-yellow-400 ring-offset-2 animate-pulse"),children:[j&&W&&g.jsx("div",{className:"absolute -top-2 -right-2 bg-card rounded-full p-0.5 border border-border",children:B()}),j&&W?.criticalPath&&g.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 bg-purple-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-semibold",children:"CRITICAL"}),g.jsxs("div",{className:"flex flex-col items-center gap-2 select-none",children:[g.jsx("div",{className:"text-3xl select-none pointer-events-none",children:L?.icon}),g.jsx("div",{className:"text-sm font-medium text-center text-foreground select-none pointer-events-none",children:r.data.label})]}),(_||s)&&(()=>{const de=l.current?(()=>{const mt=(l.current.querySelector(".bg-card")||l.current).getBoundingClientRect();return{width:mt.width/S,height:mt.height/S}})():{width:140,height:100},$e=So(r.position.x,r.position.y,de.width,de.height,16);return g.jsx(g.Fragment,{children:$e.map((Ue,bt)=>{const mt=Ue.x-r.position.x,$t=Ue.y-r.position.y;return g.jsx("div",{className:"absolute w-3 h-3 rounded-full bg-primary/80 border-2 border-card cursor-crosshair hover:scale-150 hover:bg-primary transition-all z-10",style:{left:`${mt-6}px`,top:`${$t-6}px`},onMouseDown:Ze=>{Ze.stopPropagation(),at(Ze,bt)},onMouseUp:Ze=>{Ze.stopPropagation(),s&&e?.(bt)},title:"Connection point"},bt)})})})()]})})})}const sI=w.memo(tI,(r,t)=>!(r.node.id!==t.node.id||r.node.position.x!==t.node.position.x||r.node.position.y!==t.node.position.y||r.node.selected!==t.node.selected||r.node.type!==t.node.type||r.node.data.label!==t.node.data.label||r.isConnecting!==t.isConnecting||r.onConnectionStart!==t.onConnectionStart||r.onConnectionEnd!==t.onConnectionEnd||r.onContextMenu!==t.onContextMenu));function nI({selectedNodeId:r,highlightPath:t=!0}){const{nodes:e,connections:s}=Re(),{isRunning:n}=Nt(),{getConnectionMessages:i}=Li(),[o,l]=w.useState(new Set),[d,h]=w.useState(new Map);return w.useEffect(()=>{if(!r||!t||!n){l(new Set),h(new Map);return}const f=new Set,m=new Map,y=[{nodeId:r,path:[r]}];for(;y.length>0;){const{nodeId:b,path:C}=y.shift();if(f.has(b))continue;f.add(b);const S=s.filter(R=>R.source===b);for(const R of S){const M=R.target,T=[...C,M];m.set(R.id,T),f.has(M)||y.push({nodeId:M,path:T})}}h(m),l(new Set(m.keys()))},[r,s,t,n]),w.useEffect(()=>{if(!r||!t||!n)return;const f=new Set,m=[{nodeId:r,path:[r]}];for(;m.length>0;){const{nodeId:y,path:b}=m.shift();if(f.has(y))continue;f.add(y);const C=s.filter(S=>S.target===y);for(const S of C){const R=S.source,M=[R,...b],T=d.get(S.id)||[];(T.length===0||M.length<T.length)&&(d.set(S.id,M),h(new Map(d))),f.has(R)||m.push({nodeId:R,path:M})}}l(new Set(d.keys()))},[r,s,t,n]),null}function iI(r){const{selectedNodeId:t}=Re(),{isRunning:e}=Nt(),[s,n]=w.useState(!1);return w.useEffect(()=>{if(!t||!e){n(!1);return}const{nodes:i,connections:o}=Re.getState();if(!i.find(h=>h.id===t)){n(!1);return}const d=o.find(h=>h.id===r);d&&(d.source===t||d.target===t)?n(!0):n(!1)},[t,r,e]),s}const aM=w.createContext(null);function aI({children:r}){const t=w.useRef(null),e=w.useRef(new WeakMap);w.useEffect(()=>(t.current=new ResizeObserver(i=>{i.forEach(o=>{const l=e.current.get(o.target);l&&l()})}),()=>{t.current&&(t.current.disconnect(),t.current=null)}),[]);const n={observe:w.useCallback((i,o)=>t.current?(e.current.set(i,o),t.current.observe(i),()=>{t.current&&(t.current.unobserve(i),e.current.delete(i))}):()=>{},[])};return g.jsx(aM.Provider,{value:n,children:r})}function oM(){const r=w.useContext(aM);if(!r)throw new Error("useResizeObserver must be used within ResizeObserverProvider");return r}function oI({connection:r,sourceNode:t,targetNode:e,zoom:s,pan:n,isSelected:i=!1,onClick:o,onContextMenu:l}){const[d,h]=w.useState(!1),{isRunning:f,connectionMetrics:m}=Nt(nM(G=>({isRunning:G.isRunning,connectionMetrics:G.connectionMetrics}))),y=f?m.get(r.id):void 0,{getConnectionMessages:b}=Li(),C=Re(G=>G.selectedNodeId),S=Re(G=>G.connections),R=f?b(r.id):[],M=w.useMemo(()=>R.filter(G=>G.status==="in-transit"||G.status==="pending"),[R]),T=iI(r.id);w.useMemo(()=>S.some(G=>G.source===r.target&&G.target===r.source),[S,r.target,r.source]);const{getNodeRef:E}=Pu(),{observe:A}=oM(),[_,N]=w.useState(()=>{const G=pe=>{const me=E(pe);if(!me)return{width:140,height:100};const Pe=(me.querySelector(".bg-card")||me).getBoundingClientRect();return{width:Pe.width/s,height:Pe.height/s}};return{source:G(t.id),target:G(e.id)}});w.useEffect(()=>{const G=()=>{const Je=jt=>{const de=E(jt);if(!de)return{width:140,height:100};const bt=(de.querySelector(".bg-card")||de).getBoundingClientRect();return{width:bt.width/s,height:bt.height/s}};N({source:Je(t.id),target:Je(e.id)})};G();const pe=E(t.id),me=E(e.id),ye=pe?.querySelector(".bg-card"),ve=me?.querySelector(".bg-card"),Pe=ye||pe,Be=ve||me,at=[];if(Pe){const Je=A(Pe,G);at.push(Je)}if(Be){const Je=A(Be,G);at.push(Je)}return()=>{at.forEach(Je=>Je())}},[t.id,e.id,s,E,A]);const z=_.source.width,q=_.source.height,Z=_.target.width,ne=_.target.height,ce=z/2,J=q/2,te=Z/2,le=ne/2;let ue,L,j,O;if(r.sourcePort!==void 0&&r.targetPort!==void 0){const G=So(t.position.x,t.position.y,z,q,16),pe=So(e.position.x,e.position.y,Z,ne,16),me=G[r.sourcePort],ye=pe[r.targetPort];ue=me.x,L=me.y,j=ye.x,O=ye.y}else{const G=t.position.x+ce,pe=t.position.y+J,me=e.position.x+te,ye=e.position.y+le,ve=Math.atan2(ye-pe,me-G),Pe=(Je,jt,de,$e)=>{const Ue=Math.abs(de),bt=$e?ce:te,mt=$e?J:le,$t=Math.atan2(mt,bt);let Ze,Pt;if(Ue<$t||Ue>Math.PI-$t){const xt=$e?1:-1;Ze=Je+xt*bt*Math.sign(Math.cos(de)),Pt=jt+xt*bt*Math.tan(de)*Math.sign(Math.cos(de))}else{const xt=$e?1:-1;Ze=Je+xt*mt/Math.tan(de)*Math.sign(Math.sin(de)),Pt=jt+xt*mt*Math.sign(Math.sin(de))}return{x:Ze,y:Pt}},Be=Pe(G,pe,ve,!0),at=Pe(me,ye,ve,!1);ue=Be.x,L=Be.y,j=at.x,O=at.y}const W=j-ue,fe=O-L,P=Math.min(Math.abs(W),Math.abs(fe))*.3+30,F=`
    M ${ue},${L}
    C ${ue+P*Math.sign(W)},${L}
      ${j-P*Math.sign(W)},${O}
      ${j},${O}
  `;let Y="hsl(var(--border))",ie=2;T&&C?(Y="hsl(280 100% 70%)",ie=3):i?(Y="hsl(var(--primary))",ie=2.5):d?(Y="hsl(var(--accent))",ie=2.5):y&&f&&(y.effectiveThroughput>0||y.traffic>0)&&(y.bottleneck?(Y="hsl(0 84% 60%)",ie=3):y.backpressure>.7?(Y="hsl(25 95% 53%)",ie=2.5):y.congestion>.6?(Y="hsl(45 93% 47%)",ie=2.5):y.throughputDependency>.5?(Y="hsl(142 76% 36%)",ie=2):y.effectiveThroughput>0&&(Y="hsl(var(--primary))",ie=2));const U=G=>{G.stopPropagation(),o?.()},ae=G=>{G.preventDefault(),G.stopPropagation(),l?.(G)},B=f&&y&&y.effectiveThroughput>0?y.effectiveThroughput%40/2:0;return g.jsxs("g",{children:[g.jsx("path",{d:F,fill:"none",stroke:"transparent",strokeWidth:20/s,style:{cursor:"pointer"},onClick:U,onContextMenu:ae,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)}),f&&y&&y.effectiveThroughput>0&&y.traffic>0&&g.jsx("path",{d:F,fill:"none",stroke:Y,strokeWidth:Math.max(1,ie/s),strokeLinecap:"round",strokeDasharray:`${Math.max(4,8/s)} ${Math.max(2,4/s)}`,strokeDashoffset:-B,style:{opacity:.4,pointerEvents:"none",animation:"flow 2s linear infinite"}}),f&&M.map((G,pe)=>{const me=Date.now()-G.timestamp,ve=G.latency?Math.min(1,me/G.latency):0,Pe=ue+(j-ue)*ve,Be=L+(O-L)*ve,Je={json:"hsl(142 76% 36%)",xml:"hsl(25 95% 53%)",binary:"hsl(221 83% 53%)",protobuf:"hsl(280 100% 70%)",text:"hsl(210 40% 50%)"}[G.format]||"hsl(var(--primary))";return g.jsxs("g",{children:[g.jsx("circle",{cx:Pe,cy:Be,r:4/s,fill:Je,stroke:"hsl(var(--background))",strokeWidth:1/s,style:{pointerEvents:"none",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.3))"},children:g.jsx("animate",{attributeName:"opacity",values:"0.5;1;0.5",dur:"1s",repeatCount:"indefinite"})}),G.size>1e3&&g.jsx("text",{x:Pe,y:Be-8/s,fill:Je,fontSize:8/s,textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:G.format})]},G.id||pe)}),g.jsx("path",{d:F,fill:"none",stroke:Y,strokeWidth:Math.max(1,ie/s),strokeLinecap:"round",markerEnd:f&&y&&(y.effectiveThroughput>0||y.traffic>0)?`url(#arrowhead-${i?"selected":y?.bottleneck?"bottleneck":"default"})`:i?"url(#arrowhead-selected)":"url(#arrowhead-default)",style:{transition:"stroke 0.3s, stroke-width 0.3s",pointerEvents:"none"}}),f&&y&&(y.effectiveThroughput>0||y.traffic>0)?g.jsxs("g",{children:[g.jsx("text",{x:(ue+j)/2,y:(L+O)/2-10/s,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/s),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:r.label||`${y.latency.toFixed(1)}ms`}),g.jsx("text",{x:(ue+j)/2,y:(L+O)/2+8/s,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(7,9/s),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:y.traffic>0?`${y.traffic.toFixed(1)} KB/s`:`${y.effectiveThroughput.toFixed(0)} msg/s`}),r.data?.bandwidthMbps&&y.traffic>0&&g.jsxs("text",{x:(ue+j)/2,y:(L+O)/2+20/s,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(6,8/s),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none",opacity:.7},children:["Limit: ",r.data.bandwidthMbps,"Mbps"]})]}):r.label?g.jsx("g",{children:g.jsx("text",{x:(ue+j)/2,y:(L+O)/2-10/s,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/s),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:r.label})}):null]})}const rI=w.memo(oI,(r,t)=>!(r.connection.id!==t.connection.id||r.connection.sourcePort!==t.connection.sourcePort||r.connection.targetPort!==t.connection.targetPort||r.connection.label!==t.connection.label||r.sourceNode.id!==t.sourceNode.id||r.sourceNode.position.x!==t.sourceNode.position.x||r.sourceNode.position.y!==t.sourceNode.position.y||r.targetNode.id!==t.targetNode.id||r.targetNode.position.x!==t.targetNode.position.x||r.targetNode.position.y!==t.targetNode.position.y||r.zoom!==t.zoom||r.pan.x!==t.pan.x||r.pan.y!==t.pan.y||r.isSelected!==t.isSelected||r.onClick!==t.onClick||r.onContextMenu!==t.onContextMenu)),cI=140,lI=140,uI=16;function dI({nodeId:r,position:t}){const e=Nt(f=>f.componentMetrics.get(r)),{connections:s}=Re(),{isRunning:n}=Nt(),i=s.some(f=>f.source===r||f.target===r),o=e&&(e.throughput&&e.throughput>.1||e.errorRate&&e.errorRate>.001||e.utilization&&e.utilization>.01),l=w.useMemo(()=>{if(!e)return[];const f=[{label:"Throughput",value:`${Math.round(e.throughput)}`,unit:"ops/s",color:"text-blue-400"},{label:"Latency (avg)",value:`${Math.round(e.latency)}`,unit:"ms",color:"text-yellow-400"}];return e.latencyP50!==void 0&&f.push({label:"Latency (p50)",value:`${Math.round(e.latencyP50)}`,unit:"ms",color:"text-green-400"}),e.latencyP99!==void 0&&f.push({label:"Latency (p99)",value:`${Math.round(e.latencyP99)}`,unit:"ms",color:"text-red-400"}),f.push({label:"Error Rate",value:`${(e.errorRate*100).toFixed(2)}`,unit:"%",color:"text-orange-400"},{label:"Utilization",value:`${Math.round(e.utilization*100)}`,unit:"%",color:"text-purple-400"}),f},[e]);if(!n||!e||!i||!o||l.length===0)return null;const d=t.x+cI/2,h=t.y+lI+uI;return g.jsx("div",{className:"absolute pointer-events-none",style:{left:`${d}px`,top:`${h}px`,transform:"translateX(-50%)",zIndex:10},children:g.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-2 shadow-lg min-w-max",children:g.jsx("div",{className:"text-xs space-y-1",children:l.map(f=>g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("span",{className:"text-slate-400",children:[f.label,":"]}),g.jsxs("span",{className:`font-mono font-semibold ${f.color}`,children:[f.value," ",f.unit]})]},f.label))})})})}function hI({isVisible:r=!0}){return r?g.jsx("div",{className:"absolute bottom-4 right-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-muted-foreground",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-green-500/20 border border-green-500/30"}),g.jsx("span",{children:"<20%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500/20 border border-yellow-500/30"}),g.jsx("span",{children:"20-40%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-orange-500/20 border border-orange-500/30"}),g.jsx("span",{children:"40-60%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-red-500/20 border border-red-500/30"}),g.jsx("span",{children:">60%"})]})]})}):null}function fI({isVisible:r=!0}){const{nodes:t,connections:e,zoom:s,pan:n}=Re(),{isRunning:i}=Nt(),o=Et.useMemo(()=>{if(t.length===0)return{minX:0,minY:0,maxX:2e3,maxY:2e3};const T=t.map(q=>q.position.x),E=t.map(q=>q.position.y),A=Math.min(...T)-200,_=Math.min(...E)-200,N=Math.max(...T)+200,z=Math.max(...E)+200;return{minX:A,minY:_,maxX:N,maxY:z}},[t]),l=o.maxX-o.minX,d=o.maxY-o.minY,h=120,f=80,m=h/Math.max(l,1e3),y=f/Math.max(d,1e3),b=Math.min(m,y),C=window.innerWidth/s*b,S=window.innerHeight/s*b,R=(-n.x/s-o.minX)*b,M=(-n.y/s-o.minY)*b;return r?g.jsx("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("svg",{width:h,height:f,className:"border border-border/50 rounded",style:{background:"hsl(var(--background))"},children:[e.map(T=>{const E=t.find(Z=>Z.id===T.source),A=t.find(Z=>Z.id===T.target);if(!E||!A)return null;const _=(E.position.x-o.minX)*b,N=(E.position.y-o.minY)*b,z=(A.position.x-o.minX)*b,q=(A.position.y-o.minY)*b;return g.jsx("line",{x1:_,y1:N,x2:z,y2:q,stroke:"hsl(var(--border))",strokeWidth:.3,opacity:.2},T.id)}),t.map(T=>g.jsx("circle",{cx:(T.position.x-o.minX)*b,cy:(T.position.y-o.minY)*b,r:1.5,fill:"hsl(var(--muted-foreground))",opacity:.5},T.id)),g.jsx("rect",{x:R,y:M,width:C,height:S,fill:"hsl(var(--primary))",fillOpacity:.2,stroke:"hsl(var(--primary))",strokeWidth:1.5,strokeDasharray:"2 2"})]})}):null}function pI({x:r,y:t,onDelete:e,onRename:s,onCopyId:n,onClose:i}){const o=w.useRef(null),[l,d]=w.useState({x:r,y:t});return w.useEffect(()=>{if(o.current){const h=o.current.getBoundingClientRect(),f=window.innerWidth,m=window.innerHeight;let y=r,b=t;r+h.width>f&&(y=f-h.width-10),t+h.height>m&&(b=m-h.height-10),y=Math.max(10,y),b=Math.max(10,b),d({x:y,y:b})}},[r,t]),w.useEffect(()=>{const h=m=>{o.current&&!o.current.contains(m.target)&&i()},f=m=>{m.key==="Escape"&&i()};return document.addEventListener("mousedown",h),document.addEventListener("keydown",f),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("keydown",f)}},[i]),g.jsxs("div",{ref:o,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[120px]",style:{left:`${l.x}px`,top:`${l.y}px`},children:[g.jsxs("button",{onClick:()=>{s(),i()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(wD,{className:"w-3.5 h-3.5"}),"Rename"]}),g.jsxs("button",{onClick:()=>{n(),i()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Rb,{className:"w-3.5 h-3.5"}),"Copy ID"]}),g.jsx("div",{className:"border-t border-border my-0.5"}),g.jsxs("button",{onClick:()=>{e(),i()},className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}const gI=140,mI=100;function yI(r,t,e){const s=e(r);if(!s)return{width:gI,height:mI};const o=(s.querySelector(".bg-card")||s).getBoundingClientRect();return{width:o.width/t,height:o.height/t}}function vI(r,t){const{getNodeRef:e}=Pu(),{observe:s}=oM(),[n,i]=w.useState({}),o=w.useCallback(()=>{const l={};r.forEach(d=>{const h=yI(d,t,e);h&&(l[d]=h)}),i(d=>({...d,...l}))},[r,t,e]);return w.useEffect(()=>{if(r.length===0)return;o();const l=[];return r.forEach(d=>{const h=e(d);if(h){const m=h.querySelector(".bg-card")||h;if(m){const y=s(m,o);l.push(y)}}}),()=>{l.forEach(d=>d())}},[r,t,o,e,s]),n}const mf=20,bI=140,xI=100,wI=18,CI=6,SI=wI+CI*2;function MI(r,t,e,s){return w.useMemo(()=>{const n=t.filter(y=>r.nodeIds.includes(y.id));if(n.length===0)return null;const i=mf,o=mf,l=r.showName!==!1?SI:mf;let d=1/0,h=1/0,f=-1/0,m=-1/0;return n.forEach(y=>{const b=e[y.id]||{width:bI,height:xI},C=y.position.x,S=y.position.y,R=C+b.width,M=S+b.height;d=Math.min(d,C),h=Math.min(h,S),f=Math.max(f,R),m=Math.max(m,M)}),{x:d-i,y:h-l,width:f-d+i*2,height:m-h+l+o}},[t,r.nodeIds,e,s,r.showName])}function RI(r,t){const{nodes:e,updateNodes:s}=Re(),[n,i]=w.useState(!1),o=w.useRef({x:0,y:0}),l=w.useRef({}),d=w.useCallback(h=>{if(h.button!==0||h.target.closest("[data-node-id]"))return;h.stopPropagation();const y=Re.getState();y.selectGroup(r.id),i(!0),o.current.x=h.clientX,o.current.y=h.clientY,y.setGroupDragging(!0);const b=e.filter(C=>r.nodeIds.includes(C.id));l.current={},b.forEach(C=>{l.current[C.id]={...C.position}})},[r.id,r.nodeIds,e]);return w.useEffect(()=>{if(!n)return;let h=null,f=null,m=!0;const y=C=>{if(!m)return;const S=(C.clientX-o.current.x)/t,R=(C.clientY-o.current.y)/t;f={dx:S,dy:R},h===null&&(h=requestAnimationFrame(()=>{if(!m||!f){h=null,f=null;return}const{dx:M,dy:T}=f,E=Re.getState(),A=r.nodeIds.map(_=>{const N=l.current[_];return N?{id:_,updates:{position:{x:N.x+M,y:N.y+T}}}:null}).filter(_=>_!==null);A.length>0&&E.updateNodes(A,!0),h=null,f=null}))},b=C=>{if(C&&C.button!==0)return;m=!1,h!==null&&(cancelAnimationFrame(h),h=null);const S=Re.getState();if(f){const{dx:R,dy:M}=f,T=r.nodeIds.map(E=>{const A=l.current[E];return A?{id:E,updates:{position:{x:A.x+R,y:A.y+M}}}:null}).filter(E=>E!==null);if(S.setGroupDragging(!1),T.length>0){S.updateNodes(T,!0);const E=Re.getState();gt(E,E.diagramName)}}else S.setGroupDragging(!1);f=null,i(!1)};return document.addEventListener("mousemove",y,{passive:!0}),document.addEventListener("mouseup",b,{capture:!0}),()=>{m=!1,h!==null&&cancelAnimationFrame(h),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b,{capture:!0}),Re.getState().setGroupDragging(!1)}},[n,r.nodeIds,t]),{isDragging:n,handleMouseDown:d}}const Fv=18,Sl=6;function kI({group:r,zoom:t}){const{nodes:e,selectedGroupId:s,selectGroup:n,deleteGroup:i,updateGroup:o}=Re(),[l,d]=w.useState(null),[h,f]=w.useState(!1),[m,y]=w.useState(!1),b=vI(r.nodeIds,t),C=MI(r,e,b,t),{handleMouseDown:S}=RI(r,t);if(!C)return null;const R=s===r.id,M=r.color||"hsl(var(--primary))",T=q=>{q.preventDefault(),q.stopPropagation(),n(r.id),d({x:q.clientX,y:q.clientY})},E=()=>{f(!0)},A=()=>{i(r.id),Ye.success("Group deleted"),f(!1)},_=()=>{y(!0)},N=q=>{o(r.id,{name:q}),Ye.success("Group renamed"),y(!1)},z=()=>{navigator.clipboard.writeText(r.id),Ye.success("Group ID copied to clipboard")};return g.jsxs(g.Fragment,{children:[g.jsxs("g",{children:[g.jsx("rect",{x:C.x,y:C.y,width:C.width,height:C.height,fill:M,fillOpacity:R?.1:.05,stroke:M,strokeWidth:R?3/t:2/t,strokeDasharray:R?"0":"5,5",rx:8/t,ry:8/t,style:{cursor:"pointer",transition:"all 0.2s"},onMouseDown:S,onContextMenu:T}),r.showName!==!1&&g.jsxs("g",{onClick:q=>{q.stopPropagation(),n(r.id)},onContextMenu:T,style:{cursor:"pointer"},children:[g.jsx("rect",{x:C.x+Sl,y:C.y+Sl,width:Math.max(80,r.name.length*6.5+16),height:Fv,fill:M,fillOpacity:.85,rx:3,ry:3,stroke:M,strokeWidth:.5}),g.jsx("text",{x:C.x+Sl+8,y:C.y+Sl+Fv/2,fill:"white",fontSize:11,fontWeight:"600",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:r.name})]})]}),l&&g.jsx(pI,{x:l.x,y:l.y,onDelete:E,onRename:_,onCopyId:z,onClose:()=>d(null)}),g.jsx(sM,{open:h,groupName:r.name,onConfirm:A,onCancel:()=>f(!1)}),g.jsx(mp,{open:m,initialName:r.name,onConfirm:N,onCancel:()=>y(!1)})]})}const EI=w.memo(kI,(r,t)=>!(r.group.id!==t.group.id||r.group.name!==t.group.name||r.group.color!==t.group.color||r.group.nodeIds.length!==t.group.nodeIds.length||r.group.nodeIds.some((e,s)=>e!==t.group.nodeIds[s])||r.zoom!==t.zoom));function TI({isVisible:r,canvasRef:t}){const{zoom:e,pan:s}=Re(),[n,i]=w.useState(null),o=w.useRef(null);if(w.useEffect(()=>{if(!r){i(null);return}const _=()=>{if(t?.current)i(t.current.getBoundingClientRect());else if(o.current?.parentElement){const ne=o.current.parentElement.getBoundingClientRect(),ce=24;i({...ne,width:ne.width-ce,height:ne.height-ce,left:ne.left+ce,top:ne.top+ce})}},N=setTimeout(_,10),z=requestAnimationFrame(_),q=requestAnimationFrame(()=>{requestAnimationFrame(_)});return window.addEventListener("resize",_),()=>{clearTimeout(N),cancelAnimationFrame(z),cancelAnimationFrame(q),window.removeEventListener("resize",_)}},[r,t]),w.useEffect(()=>{if(!r)return;const N=requestAnimationFrame(()=>{t?.current&&i(t.current.getBoundingClientRect())});return()=>cancelAnimationFrame(N)},[e,s,r,t]),!r)return null;if(!n)return g.jsx("div",{ref:o,className:"absolute inset-0 pointer-events-none z-20"});const l=20,d=l*e;let h=1;d<10?h=10:d<20?h=5:d<40&&(h=2);const f=l*h,m=24,y=24,b=n.width,C=n.height,S=Math.floor(-s.x/e/f)*f,R=Math.floor(-s.y/e/f)*f,M=S+b/e+f*2,T=R+C/e+f*2,E=[];for(let _=S;_<=M;_+=f)E.push(_);const A=[];for(let _=R;_<=T;_+=f)A.push(_);return g.jsxs("div",{ref:o,className:"absolute inset-0 pointer-events-none z-20",children:[g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-border pointer-events-none",style:{top:0,left:`${m}px`,right:0,height:`${y}px`,transform:`translate(${s.x}px, 0) scale(${e})`,transformOrigin:"0 0"},children:E.map(_=>g.jsx("div",{className:"absolute top-0 bottom-0 border-l border-border/60",style:{left:`${_}px`,width:"1px"},children:g.jsx("span",{className:"absolute top-0.5 left-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/e})`,transformOrigin:"0 0"},children:_})},`h-${_}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-r border-border pointer-events-none",style:{top:`${y}px`,left:0,bottom:0,width:`${m}px`,transform:`translate(0, ${s.y}px) scale(${e})`,transformOrigin:"0 0"},children:A.map(_=>g.jsx("div",{className:"absolute left-0 right-0 border-t border-border/60",style:{top:`${_}px`,height:"1px"},children:g.jsx("span",{className:"absolute left-0.5 top-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/e})`,transformOrigin:"0 0"},children:_})},`v-${_}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-r border-border pointer-events-none",style:{top:0,left:0,width:`${m}px`,height:`${y}px`}})]})}function AI({x:r,y:t,onDelete:e,onDuplicate:s,onCopyId:n,onBringToFront:i,onSendToBack:o,onBringForward:l,onSendBackward:d,onAddToGroup:h,onRemoveFromGroup:f,onClose:m}){const y=w.useRef(null);w.useEffect(()=>{const N=q=>{y.current&&!y.current.contains(q.target)&&m()},z=q=>{q.key==="Escape"&&m()};return document.addEventListener("mousedown",N),document.addEventListener("keydown",z),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("keydown",z)}},[m]);const b=()=>{e(),m()},C=()=>{s(),m()},S=()=>{n(),m()},R=()=>{i?.(),m()},M=()=>{o?.(),m()},T=()=>{l?.(),m()},E=()=>{d?.(),m()},A=()=>{h?.(),m()},_=()=>{f?.(),m()};return g.jsxs("div",{ref:y,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[140px]",style:{left:`${r}px`,top:`${t}px`},children:[g.jsxs("button",{onClick:C,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Tb,{className:"w-3.5 h-3.5"}),"Duplicate"]}),g.jsxs("button",{onClick:S,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Rb,{className:"w-3.5 h-3.5"}),"Copy ID"]}),(h||f)&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"border-t border-border my-0.5"}),f&&g.jsxs("button",{onClick:_,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(HA,{className:"w-3.5 h-3.5"}),"Remove from Group"]}),h&&g.jsxs("button",{onClick:A,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(xf,{className:"w-3.5 h-3.5"}),"Add to Group"]})]}),g.jsx("div",{className:"border-t border-border my-0.5"}),(i||o||l||d)&&g.jsxs(g.Fragment,{children:[g.jsxs("button",{onClick:R,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(vA,{className:"w-3.5 h-3.5"}),"Bring to Front"]}),g.jsxs("button",{onClick:M,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(pA,{className:"w-3.5 h-3.5"}),"Send to Back"]}),g.jsxs("button",{onClick:T,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Mb,{className:"w-3.5 h-3.5"}),"Bring Forward"]}),g.jsxs("button",{onClick:E,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Jl,{className:"w-3.5 h-3.5"}),"Send Backward"]}),g.jsx("div",{className:"border-t border-border my-0.5"})]}),g.jsxs("button",{onClick:b,className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}function DI({nodeId:r,x:t,y:e,onClose:s}){const n=w.useRef(null),{groups:i,addNodeToGroup:o}=Re();return w.useEffect(()=>{const l=h=>{n.current&&!n.current.contains(h.target)&&s()},d=h=>{h.key==="Escape"&&s()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",d)}},[s]),g.jsxs("div",{ref:n,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${t}px`,top:`${e}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Add to Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:(()=>{const l=i.filter(d=>!d.nodeIds.includes(r));return l.length>0?l.map(d=>g.jsxs("button",{onClick:()=>{o(d.id,r),Ye.success(`Added to "${d.name}"`),s()},className:"w-full px-2 py-1.5 text-xs text-left text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:d.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:d.name})]},d.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:i.length===0?"No groups available":"Already in all groups"})})()}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:s,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function _I({nodeId:r,x:t,y:e,onClose:s}){const n=w.useRef(null),{groups:i,removeNodeFromGroup:o}=Re(),l=i.filter(d=>d.nodeIds.includes(r));return w.useEffect(()=>{const d=f=>{n.current&&!n.current.contains(f.target)&&s()},h=f=>{f.key==="Escape"&&s()};return document.addEventListener("mousedown",d),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",h)}},[s]),g.jsxs("div",{ref:n,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${t}px`,top:`${e}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Remove from Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:l.length>0?l.map(d=>g.jsxs("button",{onClick:()=>{o(d.id,r),Ye.success(`Removed from "${d.name}"`),s()},className:"w-full px-2 py-1.5 text-xs text-left text-destructive hover:bg-destructive/10 hover:text-destructive flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:d.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:d.name})]},d.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:"Not in any groups"})}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:s,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function NI({x:r,y:t,onDelete:e,onClose:s}){const n=w.useRef(null),[i,o]=w.useState({x:r,y:t});return w.useEffect(()=>{if(n.current){const l=n.current.getBoundingClientRect(),d=window.innerWidth,h=window.innerHeight;let f=r,m=t;r+l.width>d&&(f=d-l.width-8),t+l.height>h&&(m=h-l.height-8),f=Math.max(8,f),m=Math.max(8,m),o({x:f,y:m})}},[r,t]),w.useEffect(()=>{const l=h=>{n.current&&!n.current.contains(h.target)&&s()},d=h=>{h.key==="Escape"&&s()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",d)}},[s]),g.jsx("div",{ref:n,className:"fixed bg-card border border-border rounded-md shadow-lg z-50",style:{left:`${i.x}px`,top:`${i.y}px`},children:g.jsx("button",{className:"w-full px-3 py-2 text-sm text-left hover:bg-accent transition-colors first:rounded-t-md last:rounded-b-md",onClick:e,children:"Delete"})})}function Vv(){const r=w.useRef(null),{nodes:t,connections:e,groups:s=[],addNode:n,addConnection:i,deleteConnection:o,zoom:l,pan:d,setPan:h,setZoom:f,selectNode:m,selectConnection:y,selectGroup:b,selectNodesByIds:C,selectedConnectionId:S,selectedNodeId:R,setViewportSize:M,deleteNode:T,updateNode:E,bringToFront:A,sendToBack:_,bringForward:N,sendBackward:z,canvasBounds:q,canvasChunks:Z,addNodeToGroup:ne,removeNodeFromGroup:ce}=Re(),{isRunning:J}=Nt(),{showMinimap:te,showHeatMapLegend:le,showRuler:ue}=Br(),{getNodeRef:L}=Pu(),[j,O]=w.useState(!1),[W,fe]=w.useState({x:0,y:0}),[P,F]=w.useState(!1),[Y,ie]=w.useState(null),[U,ae]=w.useState(void 0),[B,G]=w.useState(null),[pe,me]=w.useState(null),[ye,ve]=w.useState(null),[Pe,Be]=w.useState(null),[at,Je]=w.useState(null),[jt,de]=w.useState(null),[$e,Ue]=w.useState(null);w.useEffect(()=>{if(!r.current)return;const ee=()=>{if(!r.current)return;const be=r.current.getBoundingClientRect();M({width:be.width,height:be.height})};ee();const he=new ResizeObserver(()=>{ee()});return he.observe(r.current),window.addEventListener("resize",ee),()=>{he.disconnect(),window.removeEventListener("resize",ee)}},[M]),w.useEffect(()=>{const ee=he=>{if((he.ctrlKey||he.metaKey)&&r.current){const be=r.current.getBoundingClientRect();he.clientX>=be.left&&he.clientX<=be.right&&he.clientY>=be.top&&he.clientY<=be.bottom&&he.preventDefault()}};return document.addEventListener("wheel",ee,{passive:!1,capture:!0}),()=>{document.removeEventListener("wheel",ee,{capture:!0})}},[]);const bt=ee=>{if(ee.preventDefault(),!r.current)return;const he=ee.dataTransfer.getData("application/json");if(!he)return;const be=JSON.parse(he),Le=r.current.getBoundingClientRect(),Ie=(ee.clientX-Le.left-d.x)/l,lt=(ee.clientY-Le.top-d.y)/l,zt={id:`node-${Date.now()}`,type:be.type,position:{x:Ie,y:lt},data:{label:be.label}};n(zt)},mt=ee=>{ee.preventDefault(),ee.dataTransfer.dropEffect="copy"},$t=ee=>{const he=ee.button===0;if(ee.button===1||he&&ee.ctrlKey){O(!0),fe({x:ee.clientX-d.x,y:ee.clientY-d.y}),ee.preventDefault();return}if(he&&!P&&!ee.ctrlKey&&!ee.metaKey){if(r.current){const Le=r.current.getBoundingClientRect(),Ie=(ee.clientX-Le.left-d.x)/l,lt=(ee.clientY-Le.top-d.y)/l;Be({x:Ie,y:lt}),Je({x:Ie,y:lt,width:0,height:0})}m(null),y(null),b(null)}},Ze=ee=>{if(j)h({x:ee.clientX-W.x,y:ee.clientY-W.y});else if(P&&r.current){const he=r.current.getBoundingClientRect();G({x:(ee.clientX-he.left-d.x)/l,y:(ee.clientY-he.top-d.y)/l})}else if(Pe&&r.current){const he=r.current.getBoundingClientRect(),be=(ee.clientX-he.left-d.x)/l,Le=(ee.clientY-he.top-d.y)/l,Ie=Math.min(Pe.x,be),lt=Math.min(Pe.y,Le),zt=Math.abs(be-Pe.x),Zt=Math.abs(Le-Pe.y),At={x:Ie,y:lt,width:zt,height:Zt};Je(At);const ls=t.filter(St=>{const ot=St.position.x,vt=St.position.y,Bt=St.position.x+140,fn=St.position.y+140;return Bt>=At.x&&ot<=At.x+At.width&&fn>=At.y&&vt<=At.y+At.height}).map(St=>St.id);C(ls)}},Pt=()=>{O(!1),P&&(F(!1),ie(null),G(null)),Pe&&(Be(null),Je(null))},xt=w.useCallback((ee,he)=>{F(!0),ie(ee),ae(he)},[]),yt=w.useCallback(ee=>{const he=L(ee);if(!he)return{width:140,height:100};const Ie=(he.querySelector(".bg-card")||he).getBoundingClientRect();return{width:Ie.width/l,height:Ie.height/l}},[L,l]),Xt=w.useCallback((ee,he)=>{if(P&&Y&&Y!==ee){const be=t.find(Ie=>Ie.id===Y),Le=t.find(Ie=>Ie.id===ee);if(be&&Le){const Ie=yt(Y),lt=yt(ee),zt=B?.x??Le.position.x+lt.width/2,Zt=B?.y??Le.position.y+lt.height/2,At=be.position.x+Ie.width/2,ls=be.position.y+Ie.height/2,St=U!==void 0?U:Uv(Y,ee,zt,Zt,e,be.position.x,be.position.y,Ie.width,Ie.height),ot=he!==void 0?he:Uv(ee,Y,At,ls,e,Le.position.x,Le.position.y,lt.width,lt.height),vt={id:`conn-${Date.now()}`,source:Y,target:ee,type:"async",sourcePort:St,targetPort:ot};i(vt)}}F(!1),ie(null),ae(void 0),G(null)},[P,Y,U,t,e,i,B,yt]),Gt=w.useCallback(ee=>{y(ee)},[y]),_n=w.useCallback((ee,he,be)=>{me({connectionId:ee,x:he,y:be})},[]),Ws=w.useCallback(ee=>{const he=ee.target,be=he.closest?.("[data-node-id]"),Le=he.closest?.("[data-connection-id]"),Ie=he instanceof SVGElement,lt=he.closest?.("svg")!==null;if(be||Le||Ie||lt)return;const zt=t.filter(Zt=>Zt.selected);zt.length>0&&(ee.preventDefault(),ee.stopPropagation(),ve({nodeId:zt[0].id,x:ee.clientX,y:ee.clientY}))},[t]),_s=w.useCallback(()=>{pe&&(o(pe.connectionId),me(null))},[pe,o]),hn=w.useMemo(()=>t.map(ee=>ee.id).join(","),[t]),Jt=w.useMemo(()=>{const ee=new Map;return t.forEach(he=>{const be=he.id;ee.set(be,{onConnectionStart:Le=>xt(be,Le),onConnectionEnd:Le=>Xt(be,Le),onContextMenu:(Le,Ie)=>ve({nodeId:be,x:Le,y:Ie})})}),ee},[hn,xt,Xt,t]),Kt=w.useMemo(()=>e.map(ee=>ee.id).join(","),[e]),Lt=w.useMemo(()=>{const ee=new Map;return e.forEach(he=>{const be=he.id;ee.set(be,{onClick:()=>Gt(be),onContextMenu:Le=>_n(be,Le.clientX,Le.clientY)})}),ee},[Kt,Gt,_n,e]),Fi=ee=>{if(ee.ctrlKey&&r.current){ee.preventDefault();const{left:he,top:be,width:Le,height:Ie}=r.current.getBoundingClientRect(),lt=ee.clientX-he,zt=ee.clientY-be,Zt=(lt-d.x)/l,At=(zt-d.y)/l,ls=1+Math.min(Math.max(-ee.deltaY/500,-.5),.5);let St=l*ls;St=Math.min(Math.max(St,.3),2.5);const ot=lt-Zt*St,vt=zt-At*St;f(St),h({x:ot,y:vt})}},Ns=20,Jr=ue?24:0,Nn=2e3,Vi=l<.5,ci=Re(ee=>ee.viewportWidth),Xs=Re(ee=>ee.viewportHeight),jn=w.useMemo(()=>{if(ci===0||Xs===0)return t;const ee=-d.x/l,he=-d.y/l,be=(ci-d.x)/l,Le=(Xs-d.y)/l,Ie=200,lt=ee-Ie,zt=he-Ie,Zt=be+Ie,At=Le+Ie;return t.filter(ls=>{const St=ls.position.x,ot=ls.position.y;return St+140>=lt&&St<=Zt&&ot+100>=zt&&ot<=At})},[t,l,d,ci,Xs]),Pn=w.useMemo(()=>new Set(jn.map(ee=>ee.id)),[jn]),Lu=w.useMemo(()=>e.filter(ee=>Pn.has(ee.source)&&Pn.has(ee.target)),[e,Pn]);return g.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[g.jsx(TI,{isVisible:ue,canvasRef:r}),g.jsx("div",{ref:r,className:"absolute overflow-hidden",style:{top:`${Jr}px`,left:`${Jr}px`,right:0,bottom:0,cursor:j?"grabbing":P?"crosshair":"default",backgroundColor:"hsl(var(--muted) / 0.1)"},onDrop:bt,onDragOver:mt,onMouseDown:$t,onMouseMove:Ze,onMouseUp:Pt,onMouseLeave:Pt,onWheel:Fi,onContextMenu:Ws,children:g.jsxs("div",{style:{transform:`translate(${d.x}px, ${d.y}px) scale(${l})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[Z.map(ee=>{const he=ee.x*Nn,be=ee.y*Nn,Le=Z.some(ot=>ot.x===ee.x+1&&ot.y===ee.y),Ie=Z.some(ot=>ot.x===ee.x&&ot.y===ee.y+1),lt=d.x/l,zt=d.y/l,Zt=(-lt%Ns+Ns)%Ns,At=(-zt%Ns+Ns)%Ns,ls=he%Ns,St=be%Ns;return g.jsxs("div",{className:"absolute pointer-events-none",style:{left:`${he}px`,top:`${be}px`,width:`${Nn}px`,height:`${Nn}px`,backgroundColor:"hsl(var(--canvas-bg))",backgroundImage:`
                  linear-gradient(hsl(var(--canvas-grid)) 1px, transparent 1px),
                  linear-gradient(90deg, hsl(var(--canvas-grid)) 1px, transparent 1px)
                `,backgroundSize:`${Ns}px ${Ns}px`,backgroundPosition:`${Zt+ls}px ${At+St}px`,border:Vi?"2px dashed hsl(var(--border) / 0.6)":"none",boxShadow:Vi?"inset 0 0 0 1px hsl(var(--border) / 0.3)":"none"},children:[Le&&g.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none z-10",style:{right:0,width:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}}),Ie&&g.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{bottom:0,height:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}})]},`chunk-${ee.x}-${ee.y}`)}),at&&g.jsx("div",{className:"absolute border-2 border-primary/60 bg-primary/10 pointer-events-none",style:{left:at.x,top:at.y,width:at.width,height:at.height}}),g.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"visible"},children:[g.jsxs("defs",{children:[g.jsx("marker",{id:"arrowhead-default",markerWidth:"8",markerHeight:"8",refX:"7",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,8 L8,4 z",fill:"hsl(var(--border))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-selected",markerWidth:"10",markerHeight:"10",refX:"8",refY:"5",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,10 L10,5 z",fill:"hsl(var(--primary))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-bottleneck",markerWidth:"12",markerHeight:"12",refX:"10",refY:"6",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,12 L12,6 z",fill:"hsl(0 84% 60%)",stroke:"none"})})]}),s&&s.length>0&&g.jsx("g",{style:{pointerEvents:"auto"},children:s.map(ee=>g.jsx(EI,{group:ee,zoom:l},ee.id))}),g.jsxs("g",{style:{pointerEvents:"auto"},children:[Lu.map(ee=>{const he=t.find(Ie=>Ie.id===ee.source),be=t.find(Ie=>Ie.id===ee.target);if(!he||!be)return null;const Le=Lt.get(ee.id);return Le?g.jsx(rI,{connection:ee,sourceNode:he,targetNode:be,zoom:l,pan:d,isSelected:S===ee.id,onClick:Le.onClick,onContextMenu:Le.onContextMenu},ee.id):null}),P&&Y&&B&&(()=>{const ee=t.find(Ie=>Ie.id===Y);if(!ee)return null;const he=yt(Y);let be,Le;if(U!==void 0){const lt=So(ee.position.x,ee.position.y,he.width,he.height,16)[U];be=lt.x,Le=lt.y}else be=ee.position.x+he.width/2,Le=ee.position.y+he.height/2;return g.jsx("line",{x1:be,y1:Le,x2:B.x,y2:B.y,stroke:"hsl(var(--primary))",strokeWidth:2/l,strokeDasharray:"5,5",style:{pointerEvents:"none"}})})()]})]}),jn.map(ee=>{const he=Jt.get(ee.id);return he?g.jsx(sI,{node:ee,onConnectionStart:he.onConnectionStart,onConnectionEnd:he.onConnectionEnd,isConnecting:P,onContextMenu:he.onContextMenu},ee.id):null}),J&&jn.map(ee=>g.jsx(dI,{nodeId:ee.id,position:ee.position},`metrics-${ee.id}`))]})}),g.jsx(hI,{isVisible:le}),g.jsx(fI,{isVisible:te}),g.jsx(nI,{selectedNodeId:R,highlightPath:!0}),pe&&g.jsx(NI,{x:pe.x,y:pe.y,onDelete:_s,onClose:()=>me(null)}),ye&&(()=>{const ee=t.find(Fe=>Fe.id===ye.nodeId);if(!ee)return null;const he=t.filter(Fe=>Fe.selected),be=he.length>1,Le=()=>{be?(he.forEach(Fe=>{T(Fe.id)}),Ye.success(`${he.length} elements deleted`)):(T(ee.id),Ye.success("Element deleted")),ve(null)},Ie=()=>{if(be)he.forEach((Fe,js)=>{const Qi={...Cl(Fe),id:`${Fe.type}_${Date.now()}_${js}`,position:{x:Fe.position.x+20+js*10,y:Fe.position.y+20+js*10},selected:!1};Qi.data?.config&&(Qi.data.config=Cl(Qi.data.config)),n(Qi)}),Ye.success(`${he.length} elements duplicated`);else{const Fe={...Cl(ee),id:`${ee.type}_${Date.now()}`,position:{x:ee.position.x+20,y:ee.position.y+20},selected:!1};Fe.data?.config&&(Fe.data.config=Cl(Fe.data.config)),n(Fe),Ye.success("Element duplicated")}ve(null)},lt=()=>{if(be){const Fe=he.map(js=>js.id).join(", ");navigator.clipboard.writeText(Fe),Ye.success(`${he.length} IDs copied to clipboard`)}else navigator.clipboard.writeText(ee.id),Ye.success("ID copied to clipboard");ve(null)},zt=()=>{be?(he.forEach(Fe=>{A(Fe.id)}),Ye.success(`${he.length} elements brought to front`)):(A(ee.id),Ye.success("Brought to front")),ve(null)},Zt=()=>{be?(he.forEach(Fe=>{_(Fe.id)}),Ye.success(`${he.length} elements sent to back`)):(_(ee.id),Ye.success("Sent to back")),ve(null)},At=()=>{be?(he.forEach(Fe=>{N(Fe.id)}),Ye.success(`${he.length} elements brought forward`)):(N(ee.id),Ye.success("Brought forward")),ve(null)},ls=()=>{be?(he.forEach(Fe=>{z(Fe.id)}),Ye.success(`${he.length} elements sent backward`)):(z(ee.id),Ye.success("Sent backward")),ve(null)},St=()=>{de(be?{nodeId:he[0].id,x:ye.x,y:ye.y}:{nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)},ot=be?s.filter(Fe=>he.some(js=>Fe.nodeIds.includes(js.id))):s.filter(Fe=>Fe.nodeIds.includes(ee.id)),vt=ot.length>=1,Bt=ot.length>=2,fn=()=>{if(be){let Fe=0;he.forEach(js=>{s.filter(Ra=>Ra.nodeIds.includes(js.id)).forEach(Ra=>{ce(Ra.id,js.id),Fe++})}),Fe>0&&Ye.success(`Removed ${he.length} elements from groups`),ve(null)}else Bt?(Ue({nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)):ot.length===1&&(ce(ot[0].id,ee.id),Ye.success(`Removed from "${ot[0].name}"`),ve(null))};return g.jsx(AI,{x:ye.x,y:ye.y,onDelete:Le,onDuplicate:Ie,onCopyId:lt,onBringToFront:zt,onSendToBack:Zt,onBringForward:At,onSendBackward:ls,onAddToGroup:St,onRemoveFromGroup:vt?fn:void 0,onClose:()=>ve(null)})})(),jt&&g.jsx(DI,{nodeId:jt.nodeId,x:jt.x,y:jt.y,onClose:()=>de(null)}),$e&&g.jsx(_I,{nodeId:$e.nodeId,x:$e.x,y:$e.y,onClose:()=>Ue(null)})]})}const jI="modulepreload",PI=function(r){return"/"+r},Qv={},Se=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){let d=function(h){return Promise.all(h.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");n=d(e.map(h=>{if(h=PI(h),h in Qv)return;Qv[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":jI,f||(y.as="script"),y.crossOrigin="",y.href=h,l&&y.setAttribute("nonce",l),document.head.appendChild(y),f)return new Promise((b,C)=>{y.addEventListener("load",b),y.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},LI=w.lazy(()=>Se(()=>import("./KafkaConfigAdvanced-Cr7E7vKV.js"),__vite__mapDeps([0,1,2,3,4,5])).then(r=>({default:r.KafkaConfigAdvanced}))),zI=w.lazy(()=>Se(()=>import("./RabbitMQConfigAdvanced-CSkp2ZMJ.js"),__vite__mapDeps([6,1,7,8,9,10,11,12,5,3])).then(r=>({default:r.RabbitMQConfigAdvanced}))),II=w.lazy(()=>Se(()=>import("./PostgreSQLConfigAdvanced-Co8m_x8w.js"),__vite__mapDeps([13,2,7,9,8,3,14,4,12])).then(r=>({default:r.PostgreSQLConfigAdvanced}))),OI=w.lazy(()=>Se(()=>import("./MongoDBConfigAdvanced-CuAcsG0g.js"),__vite__mapDeps([15,2,7,9,8,3])).then(r=>({default:r.MongoDBConfigAdvanced}))),HI=w.lazy(()=>Se(()=>import("./RedisConfigAdvanced-DF2XTf6o.js"),__vite__mapDeps([16,2,9,8,3,12])).then(r=>({default:r.RedisConfigAdvanced}))),qI=w.lazy(()=>Se(()=>import("./ElasticsearchConfigAdvanced-C1o84tPW.js"),__vite__mapDeps([17,2,9,18,19,3,5])).then(r=>({default:r.ElasticsearchConfigAdvanced}))),$I=w.lazy(()=>Se(()=>import("./CassandraConfigAdvanced-CTZfRUNo.js"),__vite__mapDeps([20,1,2,3,14,19])).then(r=>({default:r.CassandraConfigAdvanced}))),BI=w.lazy(()=>Se(()=>import("./ClickHouseConfigAdvanced-Cm4CQmB9.js"),__vite__mapDeps([21,2,1,7,8,9,22,3,19])).then(r=>({default:r.ClickHouseConfigAdvanced}))),UI=w.lazy(()=>Se(()=>import("./SnowflakeConfigAdvanced-DgAeUGbw.js"),__vite__mapDeps([23,2,18,3,12])).then(r=>({default:r.SnowflakeConfigAdvanced}))),FI=w.lazy(()=>Se(()=>import("./S3DataLakeConfigAdvanced-B-BVzza4.js"),__vite__mapDeps([24,18,12,25])).then(r=>({default:r.S3DataLakeConfigAdvanced}))),VI=w.lazy(()=>Se(()=>import("./NginxConfigAdvanced-DU3M4ETf.js"),__vite__mapDeps([26,2,1,27,28,29,11,5])).then(r=>({default:r.NginxConfigAdvanced}))),QI=w.lazy(()=>Se(()=>import("./RestApiConfigAdvanced-CJZ0X9U8.js"),__vite__mapDeps([30,2,28,19])).then(r=>({default:r.RestApiConfigAdvanced}))),GI=w.lazy(()=>Se(()=>import("./GRPCConfigAdvanced-D6tcZWKE.js"),__vite__mapDeps([31,2,18,29,32])).then(r=>({default:r.GRPCConfigAdvanced}))),KI=w.lazy(()=>Se(()=>import("./WebSocketConfigAdvanced-Nz0ErIuG.js"),__vite__mapDeps([33,2,18,10,34,32])).then(r=>({default:r.WebSocketConfigAdvanced}))),YI=w.lazy(()=>Se(()=>import("./GraphQLConfigAdvanced-Ce_IXMC_.js"),__vite__mapDeps([35,2,18,3,19,32])).then(r=>({default:r.GraphQLConfigAdvanced}))),WI=w.lazy(()=>Se(()=>import("./SOAPConfigAdvanced-DR_vLBqo.js"),__vite__mapDeps([36,2,18,29,32])).then(r=>({default:r.SOAPConfigAdvanced}))),XI=w.lazy(()=>Se(()=>import("./WebhookConfigAdvanced-DHZsc45h.js"),__vite__mapDeps([37,18,38,34,32,39])).then(r=>({default:r.WebhookConfigAdvanced}))),JI=w.lazy(()=>Se(()=>import("./DockerK8sConfigAdvanced-C2g8glx_.js"),__vite__mapDeps([40,2,1,41,9,42,43])).then(r=>({default:r.DockerK8sConfigAdvanced}))),ZI=w.lazy(()=>Se(()=>Promise.resolve().then(()=>YO),void 0).then(r=>({default:r.KubernetesConfigAdvanced}))),eO=w.lazy(()=>Se(()=>import("./HAProxyConfigAdvanced-Dnaf3BkO.js"),__vite__mapDeps([44,9,18,45,32,29,5])).then(r=>({default:r.HAProxyConfigAdvanced}))),tO=w.lazy(()=>Se(()=>import("./TraefikConfigAdvanced-CaVt-yIo.js"),__vite__mapDeps([46,9,18,47,32,5])).then(r=>({default:r.TraefikConfigAdvanced}))),sO=w.lazy(()=>Se(()=>import("./EnvoyConfigAdvanced-CKWMfFpm.js"),__vite__mapDeps([48,9,18,29,28,32])).then(r=>({default:r.EnvoyConfigAdvanced}))),nO=w.lazy(()=>Se(()=>import("./ActiveMQConfigAdvanced-RKH0o6bS.js"),__vite__mapDeps([49,1,41,18,10,3,4,5,50])).then(r=>({default:r.ActiveMQConfigAdvanced}))),iO=w.lazy(()=>Se(()=>import("./AWSSQSConfigAdvanced-DtThsIr4.js"),__vite__mapDeps([51,1,18,52,10,12,5,34])).then(r=>({default:r.AWSSQSConfigAdvanced}))),aO=w.lazy(()=>Se(()=>import("./AzureServiceBusConfigAdvanced-BcWbB_KA.js"),__vite__mapDeps([53,2,10,12])).then(r=>({default:r.AzureServiceBusConfigAdvanced}))),oO=w.lazy(()=>Se(()=>import("./GCPPubSubConfigAdvanced-CiCMJkdj.js"),__vite__mapDeps([54,2,10,4,12])).then(r=>({default:r.GCPPubSubConfigAdvanced}))),rO=w.lazy(()=>Se(()=>import("./KongConfigAdvanced-BPRc7c7D.js"),__vite__mapDeps([55,2,9,29,47,4])).then(r=>({default:r.KongConfigAdvanced}))),cO=w.lazy(()=>Se(()=>import("./ApigeeConfigAdvanced-D_mBxBeO.js"),__vite__mapDeps([56,1,5])).then(r=>({default:r.ApigeeConfigAdvanced}))),lO=w.lazy(()=>Se(()=>import("./MuleSoftConfigAdvanced-c4uovMtG.js"),__vite__mapDeps([57,1,3,32])).then(r=>({default:r.MuleSoftConfigAdvanced}))),uO=w.lazy(()=>Se(()=>import("./GraphQLGatewayConfigAdvanced-Cm85Z1ae.js"),__vite__mapDeps([58,32,28])).then(r=>({default:r.GraphQLGatewayConfigAdvanced}))),dO=w.lazy(()=>Se(()=>import("./BFFServiceConfigAdvanced-D3vgsm4p.js"),__vite__mapDeps([59,18])).then(r=>({default:r.BFFServiceConfigAdvanced}))),hO=w.lazy(()=>Se(()=>import("./WebhookRelayConfigAdvanced-hpBfBYEn.js"),__vite__mapDeps([60,2,41,18,38,34,32,39])).then(r=>({default:r.WebhookRelayConfigAdvanced}))),fO=w.lazy(()=>Se(()=>import("./PrometheusConfigAdvanced-DPEIdGNK.js"),__vite__mapDeps([61,2,9,43])).then(r=>({default:r.PrometheusConfigAdvanced}))),pO=w.lazy(()=>Se(()=>import("./GrafanaConfigAdvanced-DpkLcWst.js"),__vite__mapDeps([62,22,63,2,3])).then(r=>({default:r.GrafanaConfigAdvanced}))),gO=w.lazy(()=>Se(()=>import("./LokiConfigAdvanced-C36CBxWo.js"),__vite__mapDeps([64,2,50])).then(r=>({default:r.LokiConfigAdvanced}))),mO=w.lazy(()=>Se(()=>import("./JaegerConfigAdvanced-CFh2PzWZ.js"),__vite__mapDeps([65,1,66])).then(r=>({default:r.JaegerConfigAdvanced}))),yO=w.lazy(()=>Se(()=>import("./OpenTelemetryCollectorConfigAdvanced-BKKHZzp7.js"),__vite__mapDeps([67,1,18,11])).then(r=>({default:r.OpenTelemetryCollectorConfigAdvanced}))),vO=w.lazy(()=>Se(()=>import("./PagerDutyConfigAdvanced-DQQ2e8H1.js"),__vite__mapDeps([68,18,4,69,39])).then(r=>({default:r.PagerDutyConfigAdvanced}))),bO=w.lazy(()=>Se(()=>import("./KeycloakConfigAdvanced-DROHQ29I.js"),__vite__mapDeps([70,2,27,5,28,12,4,39,71,72,73])).then(r=>({default:r.KeycloakConfigAdvanced}))),xO=w.lazy(()=>Se(()=>import("./WAFConfigAdvanced-Df5nUXl6.js"),__vite__mapDeps([74,27,18,5,28,32])).then(r=>({default:r.WAFConfigAdvanced}))),wO=w.lazy(()=>Se(()=>import("./SecretsVaultConfigAdvanced-pty3OTSw.js"),__vite__mapDeps([75,27,2,18,12,3,5,71,73,32])).then(r=>({default:r.SecretsVaultConfigAdvanced}))),CO=w.lazy(()=>Se(()=>import("./IDSIPSConfigAdvanced-C0wscmYj.js"),__vite__mapDeps([76,27,18,5,32])).then(r=>({default:r.IDSIPSConfigAdvanced}))),SO=w.lazy(()=>Se(()=>import("./FirewallConfigAdvanced-C4XT26WW.js"),__vite__mapDeps([77,41,27,18,5,32,45])).then(r=>({default:r.FirewallConfigAdvanced}))),MO=w.lazy(()=>Se(()=>import("./JenkinsConfigAdvanced-Gmb_VqTb.js"),__vite__mapDeps([78,1,2,27,66,79,29,4,22,45,63,39,42])).then(r=>({default:r.JenkinsConfigAdvanced}))),RO=w.lazy(()=>Se(()=>import("./GitLabCIConfigAdvanced-CBm42Ygc.js"),__vite__mapDeps([80,1,27,66,19,29,3,28,81,39])).then(r=>({default:r.GitLabCIConfigAdvanced}))),kO=w.lazy(()=>Se(()=>import("./ArgoCDConfigAdvanced-CDnYvwQr.js"),__vite__mapDeps([82,1,2,27,3,83,5,69,66,39])).then(r=>({default:r.ArgoCDConfigAdvanced}))),EO=w.lazy(()=>Se(()=>import("./HarborConfigAdvanced-LLgl5KZD.js"),__vite__mapDeps([84,9,79,25,4,5])).then(r=>({default:r.HarborConfigAdvanced}))),TO=w.lazy(()=>Se(()=>import("./TerraformConfigAdvanced-D4LmSuPL.js"),__vite__mapDeps([85,27,2,18,32,52,39])).then(r=>({default:r.TerraformConfigAdvanced}))),AO=w.lazy(()=>Se(()=>import("./AnsibleConfigAdvanced-DOXZzuZp.js"),__vite__mapDeps([86,27,2,18,29,32,83,12,81,39])).then(r=>({default:r.AnsibleConfigAdvanced}))),DO=w.lazy(()=>Se(()=>import("./IstioConfigAdvanced-BjShQ8EG.js"),__vite__mapDeps([87,18,28,47])).then(r=>({default:r.IstioConfigAdvanced}))),_O=w.lazy(()=>Se(()=>import("./ServiceMeshConfigAdvanced-CuNGT_iZ.js"),__vite__mapDeps([88,18,29,5])).then(r=>({default:r.ServiceMeshConfigAdvanced}))),NO=w.lazy(()=>Se(()=>import("./APIGatewayConfigAdvanced-BR_aRjnQ.js"),__vite__mapDeps([89,9,18,28,5,45,47])).then(r=>({default:r.APIGatewayConfigAdvanced}))),jO=w.lazy(()=>Se(()=>import("./VPNConfigAdvanced-BjKrePHn.js"),__vite__mapDeps([90,18,4,71,39])).then(r=>({default:r.VPNConfigAdvanced}))),PO=w.lazy(()=>Se(()=>import("./CDNConfigAdvanced-yO8mA0f1.js"),__vite__mapDeps([91,18,28,45])).then(r=>({default:r.CDNConfigAdvanced}))),LO=w.lazy(()=>Se(()=>import("./SparkConfigAdvanced-B8ntaZ2h.js"),__vite__mapDeps([92,18,3,32,39])).then(r=>({default:r.SparkConfigAdvanced}))),zO=w.lazy(()=>Se(()=>import("./TensorFlowServingConfigAdvanced-D3BmAoTs.js"),__vite__mapDeps([93,2,18,3,32])).then(r=>({default:r.TensorFlowServingConfigAdvanced}))),IO=w.lazy(()=>Se(()=>import("./PyTorchServeConfigAdvanced-C0csIefi.js"),__vite__mapDeps([94,2,18,3,32])).then(r=>({default:r.PyTorchServeConfigAdvanced}))),OO=w.lazy(()=>Se(()=>import("./FeatureStoreConfigAdvanced-DVy1W_VM.js"),__vite__mapDeps([95,18,79,3,45])).then(r=>({default:r.FeatureStoreConfigAdvanced}))),HO=w.lazy(()=>Se(()=>import("./MLflowConfigAdvanced-BADFzOY6.js"),__vite__mapDeps([96,79,45])).then(r=>({default:r.MLflowConfigAdvanced}))),qO=w.lazy(()=>Se(()=>import("./CRMConfigAdvanced-yv4r419g.js"),__vite__mapDeps([97,18,4,98,45,99,72])).then(r=>({default:r.CRMConfigAdvanced}))),$O=w.lazy(()=>Se(()=>import("./ERPConfigAdvanced-BCtRANT1.js"),__vite__mapDeps([100,18,79,98,45,99])).then(r=>({default:r.ERPConfigAdvanced}))),BO=w.lazy(()=>Se(()=>import("./RPABotConfigAdvanced-D4Hvd_BM.js"),__vite__mapDeps([101,18,45,32,39])).then(r=>({default:r.RPABotConfigAdvanced}))),UO=w.lazy(()=>Se(()=>import("./BPMNEngineConfigAdvanced-BD8L0dX6.js"),__vite__mapDeps([102,18,32,39,4])).then(r=>({default:r.BPMNEngineConfigAdvanced}))),FO=w.lazy(()=>Se(()=>import("./PaymentGatewayConfigAdvanced-pAnqrTAK.js"),__vite__mapDeps([103,18,98,45,5,32,39])).then(r=>({default:r.PaymentGatewayConfigAdvanced}))),VO=()=>g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsx("div",{className:"text-muted-foreground",children:"Loading configuration..."})});function QO({componentId:r,componentType:t}){const e=()=>{switch(t){case"kafka":return g.jsx(LI,{componentId:r});case"rabbitmq":return g.jsx(zI,{componentId:r});case"postgres":return g.jsx(II,{componentId:r});case"mongodb":return g.jsx(OI,{componentId:r});case"redis":return g.jsx(HI,{componentId:r});case"elasticsearch":return g.jsx(qI,{componentId:r});case"cassandra":return g.jsx($I,{componentId:r});case"clickhouse":return g.jsx(BI,{componentId:r});case"snowflake":return g.jsx(UI,{componentId:r});case"s3-datalake":return g.jsx(FI,{componentId:r});case"nginx":return g.jsx(VI,{componentId:r});case"rest":return g.jsx(QI,{componentId:r});case"grpc":return g.jsx(GI,{componentId:r});case"websocket":return g.jsx(KI,{componentId:r});case"graphql":return g.jsx(YI,{componentId:r});case"soap":return g.jsx(WI,{componentId:r});case"webhook":return g.jsx(XI,{componentId:r});case"docker":return g.jsx(JI,{componentId:r});case"kubernetes":return g.jsx(ZI,{componentId:r});case"haproxy":return g.jsx(eO,{componentId:r});case"traefik":return g.jsx(tO,{componentId:r});case"envoy":return g.jsx(sO,{componentId:r});case"activemq":return g.jsx(nO,{componentId:r});case"aws-sqs":return g.jsx(iO,{componentId:r});case"azure-service-bus":return g.jsx(aO,{componentId:r});case"gcp-pubsub":return g.jsx(oO,{componentId:r});case"kong":return g.jsx(rO,{componentId:r});case"apigee":return g.jsx(cO,{componentId:r});case"mulesoft":return g.jsx(lO,{componentId:r});case"graphql-gateway":return g.jsx(uO,{componentId:r});case"bff-service":return g.jsx(dO,{componentId:r});case"webhook-relay":return g.jsx(hO,{componentId:r});case"prometheus":return g.jsx(fO,{componentId:r});case"grafana":return g.jsx(pO,{componentId:r});case"loki":return g.jsx(gO,{componentId:r});case"jaeger":return g.jsx(mO,{componentId:r});case"otel-collector":return g.jsx(yO,{componentId:r});case"pagerduty":return g.jsx(vO,{componentId:r});case"keycloak":return g.jsx(bO,{componentId:r});case"waf":return g.jsx(xO,{componentId:r});case"firewall":return g.jsx(SO,{componentId:r});case"secrets-vault":return g.jsx(wO,{componentId:r});case"ids-ips":return g.jsx(CO,{componentId:r});case"jenkins":return g.jsx(MO,{componentId:r});case"gitlab-ci":return g.jsx(RO,{componentId:r});case"argo-cd":return g.jsx(kO,{componentId:r});case"terraform":return g.jsx(TO,{componentId:r});case"ansible":return g.jsx(AO,{componentId:r});case"harbor":return g.jsx(EO,{componentId:r});case"istio":return g.jsx(DO,{componentId:r});case"service-mesh":return g.jsx(_O,{componentId:r});case"api-gateway":return g.jsx(NO,{componentId:r});case"vpn":return g.jsx(jO,{componentId:r});case"cdn":return g.jsx(PO,{componentId:r});case"spark":return g.jsx(LO,{componentId:r});case"tensorflow-serving":return g.jsx(zO,{componentId:r});case"pytorch-serve":return g.jsx(IO,{componentId:r});case"feature-store":return g.jsx(OO,{componentId:r});case"mlflow":return g.jsx(HO,{componentId:r});case"crm":return g.jsx(qO,{componentId:r});case"erp":return g.jsx($O,{componentId:r});case"rpa-bot":return g.jsx(BO,{componentId:r});case"bpmn-engine":return g.jsx(UO,{componentId:r});case"payment-gateway":return g.jsx(FO,{componentId:r});default:return g.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"Configuration panel not available for this component type"})}};return g.jsx(w.Suspense,{fallback:g.jsx(VO,{}),children:e()})}function GO(){const{undo:r,redo:t,zoom:e,setZoom:s,pan:n,setPan:i,resetCanvas:o,saveDiagram:l,selectedConnectionId:d,selectedNodeId:h,selectedGroupId:f,nodes:m,deleteConnection:y,deleteNode:b,deleteGroup:C,selectConnection:S,selectNode:R,selectGroup:M}=Re(),{canUndo:T,canRedo:E}=Ar(),{isRunning:A,start:_,stop:N}=Nt(),{showMinimap:z,toggleMinimap:q,showHeatMapLegend:Z,toggleHeatMapLegend:ne}=Br();w.useEffect(()=>{const ce=J=>{const te=J.ctrlKey||J.metaKey;if(te&&J.key==="z"&&!J.shiftKey&&T){J.preventDefault(),r();return}if(te&&(J.key==="z"&&J.shiftKey||J.key==="y")&&E){J.preventDefault(),t();return}if(te&&(J.key==="="||J.key==="+")){J.preventDefault(),s(Math.min(e+.1,2));return}if(te&&J.key==="-"){J.preventDefault(),s(Math.max(e-.1,.5));return}if(te&&J.key==="0"){J.preventDefault(),s(1),i({x:0,y:0});return}const le=50;if(!te){if(J.key==="ArrowLeft"){J.preventDefault(),i({x:n.x+le,y:n.y});return}if(J.key==="ArrowRight"){J.preventDefault(),i({x:n.x-le,y:n.y});return}if(J.key==="ArrowUp"){J.preventDefault(),i({x:n.x,y:n.y+le});return}if(J.key==="ArrowDown"){J.preventDefault(),i({x:n.x,y:n.y-le});return}}if(!te&&J.key===" "){const ue=J.target;if(!ue){if(J.preventDefault(),A)N();else{const{nodes:W,connections:fe}=Re.getState();Nt.getState().initialize(W,fe),_()}return}const L=ue.tagName;if(L==="INPUT"||L==="TEXTAREA"||L==="SELECT"||ue.isContentEditable||ue.closest('input, textarea, select, [contenteditable="true"]'))return;const O=ue.getAttribute("role");if(O==="textbox"||O==="combobox"||O==="searchbox"||O==="spinbutton"||ue.closest("[data-radix-select-trigger], [data-radix-select-content], [data-radix-select-viewport]"))return;if(J.preventDefault(),A)N();else{const{nodes:W,connections:fe}=Re.getState();Nt.getState().initialize(W,fe),_()}return}if(te&&(J.key==="s"||J.key==="")){J.preventDefault(),l();return}if(te&&(J.key==="m"||J.key==="")){J.preventDefault(),q();return}if(te&&(J.key==="h"||J.key==="")){J.preventDefault(),ne();return}if((J.key==="Delete"||J.key==="Backspace")&&!te){const ue=document.activeElement;if(ue){const j=ue.tagName;if(j==="INPUT"||j==="TEXTAREA"||j==="SELECT"||ue.isContentEditable)return;const O=ue.getAttribute("role");if(O==="textbox"||O==="combobox"||O==="searchbox"||O==="spinbutton")return;const W=ue.closest("form")!==null,fe=ue.closest('[role="textbox"], [role="combobox"], [contenteditable="true"]')!==null,P=ue.closest("[data-radix-select-trigger], [data-radix-select-content]")!==null,F=ue.closest('[role="dialog"]')!==null;if(W||fe||P||F)return}if(J.preventDefault(),d){y(d),S(null);return}if(f){C(f),M(null);return}const L=m.filter(j=>j.selected);if(L.length>0){L.forEach(j=>b(j.id)),R(null);return}if(h){b(h),R(null);return}}};return window.addEventListener("keydown",ce),()=>{window.removeEventListener("keydown",ce)}},[r,t,T,E,e,s,n,i,o,l,A,_,N,z,q,Z,ne,d,h,f,m,y,b,C,S,R,M])}class Ml extends w.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,e){ii("ErrorBoundary caught an error",t,{componentStack:e.componentStack}),this.setState({error:t,errorInfo:e}),this.props.onError&&this.props.onError(t,e)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:g.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:g.jsxs(xs,{className:"w-full max-w-2xl",children:[g.jsxs(Sn,{children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(an,{className:"h-5 w-5 text-destructive"}),g.jsx(Mn,{children:"-   "})]}),g.jsx(ga,{children:"    "})]}),g.jsxs(Rn,{className:"space-y-4",children:[this.state.error&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("p",{className:"text-sm font-semibold text-foreground",children:":"}),g.jsx("pre",{className:"text-xs bg-muted p-3 rounded-md overflow-auto max-h-48",children:this.state.error.toString()})]}),!1,g.jsxs("div",{className:"flex gap-2",children:[g.jsxs(Ee,{onClick:this.handleReset,variant:"default",children:[g.jsx(cD,{className:"h-4 w-4 mr-2"})," "]}),g.jsx(Ee,{onClick:()=>window.location.reload(),variant:"outline",children:" "})]})]})]})}):this.props.children}}function KO(){GO();const{tabs:r}=Ru(),t=r.find(e=>e.active);return g.jsx(Ml,{children:g.jsx(aI,{children:g.jsx(eI,{children:g.jsxs("div",{className:"h-screen flex flex-col bg-background",children:[g.jsx(oN,{}),g.jsx(W5,{}),g.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[g.jsx(Ml,{children:g.jsx(dL,{})}),g.jsx(Ml,{children:t?.type==="diagram"?g.jsx(Vv,{}):t?.type==="component"&&t.componentId&&t.componentType?g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsx(QO,{componentId:t.componentId,componentType:t.componentType})}):g.jsx(Vv,{})}),g.jsx(Ml,{children:g.jsx(Y5,{})})]})]})})})})}kR.createRoot(document.getElementById("root")).render(g.jsxs(Et.StrictMode,{children:[g.jsx(pk,{position:"top-right"}),g.jsx(KO,{})]}));const YO=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Fx as $,ya as A,ft as B,xs as C,gp as D,kb as E,rv as F,Rb as G,wD as H,Tt as I,$r as J,Ae as K,nt as L,tD as M,XA as N,_e as O,Hl as P,pa as Q,Nt as R,bs as S,vp as T,fD as U,$x as V,up as W,Ux as X,dp as Y,_b as Z,hp as _,gu as a,pp as a0,fp as a1,on as a2,Eb as a3,an as a4,Tb as a5,ke as a6,XO as a7,Ff as a8,zA as a9,xA as aa,ZO as ab,cD as ac,Xf as ad,KS as ae,ma as af,Ab as ag,ZA as ah,Uf as ai,wz as aj,Sz as ak,PA as al,Et as am,nb as an,WO as ao,Hf as ap,is as aq,ii as ar,sn as b,yD as c,si as d,Sn as e,Mn as f,JO as g,ga as h,Ee as i,g as j,Rn as k,va as l,Zl as m,Nl as n,Dr as o,jl as p,_r as q,w as r,Vt as s,fa as t,Re as u,ru as v,cu as w,uu as x,du as y,lu as z};
