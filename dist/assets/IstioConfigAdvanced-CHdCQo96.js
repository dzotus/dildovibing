import{u as K,j as e,r as w,i as h,S as L,C as r,e as l,f as n,R as y,k as i,A as D,a3 as W,T as J,a as Q,b as j,W as q,c as X,d as u,h as v,B as c,P as B,m as E,L as N,t as S,n as Y,o as Z,p as ee,q as se,s as C}from"./index-2Qx8irw2.js";import{R as ae}from"./refresh-ccw-DHaGPCfE.js";import{G as R}from"./globe-NIN3Xt0B.js";import{R as V}from"./route-CFLAwhOO.js";function xe({componentId:k}){const{nodes:P,updateNode:M}=K(),p=P.find(s=>s.id===k);if(!p)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const t=p.data.config||{},x=t.services||[{id:"1",name:"frontend",namespace:"default",version:"v1",pods:3,healthyPods:3,requests:125e3,errors:25,latency:45},{id:"2",name:"backend",namespace:"default",version:"v1",pods:2,healthyPods:2,requests:98e3,errors:12,latency:120}],g=t.virtualServices||[{id:"1",name:"frontend-vs",hosts:["frontend.example.com"],http:[{route:[{destination:{host:"frontend",subset:"v1"},weight:90},{destination:{host:"frontend",subset:"v2"},weight:10}]}]}],f=t.destinationRules||[{id:"1",name:"frontend-dr",host:"frontend",subsets:[{name:"v1",labels:{version:"v1"}},{name:"v2",labels:{version:"v2"}}],trafficPolicy:{loadBalancer:{simple:"ROUND_ROBIN"}}}],T=t.gateways||[{id:"1",name:"istio-gateway",selector:{istio:"ingressgateway"},servers:[{port:{number:80,protocol:"HTTP",name:"http"},hosts:["*"]}]}],O=t.totalServices||x.length,I=t.totalRequests||x.reduce((s,a)=>s+(a.requests||0),0),A=t.totalErrors||x.reduce((s,a)=>s+(a.errors||0),0),z=t.averageLatency||Math.round(x.reduce((s,a)=>s+(a.latency||0),0)/x.length),[te,re]=w.useState(null),[le,G]=w.useState(!1),[ne,_]=w.useState(!1),d=s=>{M(k,{data:{...p.data,config:{...t,...s}}})},$=()=>{const s={id:`vs-${Date.now()}`,name:"new-virtual-service",hosts:["example.com"],http:[{route:[{destination:{host:"service"},weight:100}]}]};d({virtualServices:[...g,s]}),G(!1)},U=s=>{d({virtualServices:g.filter(a=>a.id!==s)})},H=()=>{const s={id:`dr-${Date.now()}`,name:"new-destination-rule",host:"service",subsets:[{name:"v1",labels:{version:"v1"}}]};d({destinationRules:[...f,s]}),_(!1)},F=s=>{d({destinationRules:f.filter(a=>a.id!==s)})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Istio Service Mesh"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Traffic Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Service mesh for microservices traffic management and security"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Kiali"]})]})]}),e.jsx(L,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(r,{className:"border-l-4 border-l-blue-500 bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"Services"}),e.jsx(y,{className:"h-4 w-4 text-blue-500"})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:O}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"registered"})]})})]}),e.jsxs(r,{className:"border-l-4 border-l-green-500 bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"Requests"}),e.jsx(D,{className:"h-4 w-4 text-green-500"})]})}),e.jsx(i,{children:e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:I.toLocaleString()})})})]}),e.jsxs(r,{className:"border-l-4 border-l-red-500 bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"Errors"}),e.jsx(W,{className:"h-4 w-4 text-red-500"})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:A}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"total"})]})})]}),e.jsxs(r,{className:"border-l-4 border-l-purple-500 bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"Avg Latency"}),e.jsx(D,{className:"h-4 w-4 text-purple-500"})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:z}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"ms"})]})})]})]}),e.jsxs(J,{defaultValue:"services",className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsxs(j,{value:"services",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Services (",x.length,")"]}),e.jsxs(j,{value:"virtual-services",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Virtual Services (",g.length,")"]}),e.jsxs(j,{value:"destination-rules",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Destination Rules (",f.length,")"]}),e.jsxs(j,{value:"gateways",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Gateways (",T.length,")"]}),e.jsxs(j,{value:"settings",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(u,{value:"services",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Services"}),e.jsx(v,{children:"Registered services in the mesh"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs(r,{className:"border-l-4 border-l-blue-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(y,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(n,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(c,{variant:"outline",children:s.namespace}),s.version&&e.jsx(c,{variant:"outline",children:s.version}),e.jsxs(c,{variant:s.healthyPods===s.pods?"default":"destructive",children:[s.healthyPods||0,"/",s.pods||0," pods"]})]})]})]})})}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Requests:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.requests?.toLocaleString()||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Errors:"}),e.jsx("span",{className:`ml-2 font-semibold ${s.errors&&s.errors>0?"text-red-500":""}`,children:s.errors||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Latency:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[s.latency||0,"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Error Rate:"}),e.jsxs("span",{className:`ml-2 font-semibold ${s.requests&&s.errors&&s.errors/s.requests>.01?"text-red-500":""}`,children:[s.requests&&s.errors?(s.errors/s.requests*100).toFixed(2):0,"%"]})]})]})})]},s.id))})})]})}),e.jsx(u,{value:"virtual-services",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Virtual Services"}),e.jsx(v,{children:"Configure traffic routing rules"})]}),e.jsxs(h,{onClick:$,size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Virtual Service"]})]})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsxs(r,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(V,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(n,{className:"text-lg font-semibold",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.hosts.map((a,m)=>e.jsx(c,{variant:"outline",className:"font-mono text-xs",children:a},m))})]})]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>U(s.id),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(E,{className:"h-4 w-4"})})]})}),e.jsx(i,{children:s.http&&s.http.length>0&&e.jsx("div",{className:"space-y-2",children:s.http.map((a,m)=>e.jsx("div",{className:"p-3 border rounded",children:a.route&&e.jsx("div",{className:"space-y-1",children:a.route.map((o,b)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"â†’"}),e.jsx("span",{className:"ml-2 font-medium",children:o.destination.host}),o.destination.subset&&e.jsx(c,{variant:"outline",className:"ml-2",children:o.destination.subset}),o.weight&&e.jsxs(c,{variant:"outline",className:"ml-2",children:[o.weight,"%"]})]},b))})},m))})})]},s.id))})})]})}),e.jsx(u,{value:"destination-rules",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Destination Rules"}),e.jsx(v,{children:"Configure traffic policies and subsets"})]}),e.jsxs(h,{onClick:H,size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Destination Rule"]})]})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsxs(r,{className:"border-l-4 border-l-purple-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx(q,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx(n,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(c,{variant:"outline",className:"font-mono text-xs",children:s.host}),s.trafficPolicy?.loadBalancer?.simple&&e.jsx(c,{variant:"outline",children:s.trafficPolicy.loadBalancer.simple})]})]})]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>F(s.id),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(E,{className:"h-4 w-4"})})]})}),e.jsx(i,{children:s.subsets&&s.subsets.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Subsets"}),s.subsets.map((a,m)=>e.jsx("div",{className:"p-2 border rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",children:a.name}),a.labels&&Object.entries(a.labels).map(([o,b])=>e.jsxs(c,{variant:"outline",className:"text-xs",children:[o,"=",b]},o))]})},m))]})})]},s.id))})})]})}),e.jsx(u,{value:"gateways",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Gateways"}),e.jsx(v,{children:"Configure ingress and egress gateways"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:T.map(s=>e.jsx(r,{className:"border-l-4 border-l-cyan-500 hover:shadow-md transition-shadow bg-card",children:e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-100 dark:bg-cyan-900/30",children:e.jsx(R,{className:"h-5 w-5 text-cyan-600 dark:text-cyan-400"})}),e.jsxs("div",{children:[e.jsx(n,{className:"text-lg font-semibold",children:s.name}),s.servers&&s.servers.length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.servers.map((a,m)=>e.jsxs(c,{variant:"outline",className:"text-xs",children:[a.port.protocol,":",a.port.number]},m))})]})]})})},s.id))})})]})}),e.jsx(u,{value:"settings",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Istio Settings"}),e.jsx(v,{children:"Service mesh configuration"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{children:"Enable mTLS"}),e.jsx(S,{checked:t.enableMTLS??!0,onCheckedChange:s=>d({enableMTLS:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{children:"Enable Tracing"}),e.jsx(S,{checked:t.enableTracing??!0,onCheckedChange:s=>d({enableTracing:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{children:"Enable Metrics"}),e.jsx(S,{checked:t.enableMetrics??!0,onCheckedChange:s=>d({enableMetrics:s})})]}),e.jsx(L,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Default Load Balancer"}),e.jsxs(Y,{value:t.defaultLoadBalancer??"ROUND_ROBIN",onValueChange:s=>d({defaultLoadBalancer:s}),children:[e.jsx(Z,{children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(C,{value:"ROUND_ROBIN",children:"Round Robin"}),e.jsx(C,{value:"LEAST_CONN",children:"Least Connections"}),e.jsx(C,{value:"RANDOM",children:"Random"})]})]})]})]})]})})]})]})})}export{xe as IstioConfigAdvanced};
