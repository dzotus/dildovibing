import{u as me,a as je,j as e,e as U,r as j,l as D,S as k,C as o,h as x,i as u,m as h,T as ge,b as pe,c as B,aA as ve,bd as fe,d as be,f as L,k as T,a5 as Ne,I as v,q as A,s as C,t as I,v as w,w as a,B as m,ax as Se,P as ye,x as f,o as ke,L as r}from"./index-Cd-JdYDo.js";import{u as Ae}from"./use-toast-CPyBeE96.js";import{R as Ce}from"./refresh-ccw--KPBcUEB.js";import{S as Ie}from"./shield-CAEKtRsh.js";import{C as we}from"./circle-check-big-Cu7gDr-H.js";function Oe({componentId:b}){const{nodes:X,updateNode:J}=me(),{getComponentMetrics:K}=je(),{toast:P}=Ae(),N=X.find(s=>s.id===b);if(!N)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const l=N.data.config||{},W=l.mode||"ids",Y=l.enableSignatureDetection??!0,Z=l.enableAnomalyDetection??!0,_=l.enableBehavioralAnalysis??!1,ee=l.alertThreshold||"medium",V=l.enableAutoBlock??!1,se=l.blockDuration||3600,z=l.enableLogging??!0,te=l.logRetention||30,ne=K(b),d=U.getIDSIPSEmulationEngine(b),[H,Q]=j.useState([]),[$,F]=j.useState([]),[R,q]=j.useState({totalAlerts:0,alertsBlocked:0,signaturesActive:0,blockedIPs:0});j.useEffect(()=>{if(d){const s=d.getAlerts(100),n=d.getBlockedIPs(),i=d.getStats();Q(s.map(t=>({id:t.id,type:t.type,sourceIP:t.sourceIP,destinationIP:t.destinationIP,protocol:t.protocol,port:t.port,severity:t.severity,timestamp:new Date(t.timestamp).toISOString(),description:t.description,blocked:t.blocked,signature:t.signature}))),F(n.map(t=>({ip:t.ip,reason:t.reason,blockedAt:new Date(t.blockedAt).toISOString(),expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString():void 0,duration:t.expiresAt?Math.floor((t.expiresAt-t.blockedAt)/1e3):void 0}))),q({totalAlerts:i.alertsGenerated,alertsBlocked:i.alertsBlocked,signaturesActive:i.activeSignatures,blockedIPs:i.blockedIPs})}},[d,ne?.timestamp]);const g=l.signatures||[{id:"1",name:"SSH Brute Force",description:"Detects multiple failed SSH login attempts",enabled:!0,severity:"high",pattern:"alert tcp any any -> any 22",action:"block"},{id:"2",name:"SQL Injection",description:"Detects SQL injection attempts",enabled:!0,severity:"critical",pattern:`content:"' OR 1=1"`,action:"block"}],S=H.length>0?H:l.alerts||[],y=$.length>0?$:l.blockedIPs||[],ie=R.totalAlerts||l.totalAlerts||S.length,ae=R.alertsBlocked||l.alertsBlocked||S.filter(s=>s.blocked).length,le=R.signaturesActive||l.signaturesActive||g.filter(s=>s.enabled).length,[Pe,De]=j.useState(null),[Be,re]=j.useState(!1),[E,ce]=j.useState(""),[M,de]=j.useState("all"),c=s=>{const n={...l,...s};J(b,{data:{...N.data,config:n}});try{const i=U.getIDSIPSEmulationEngine(b);i&&i.initializeConfig({...N,data:{...N.data,config:n}})}catch{}},oe=()=>{if(d){const s=d.getAlerts(100),n=d.getBlockedIPs(),i=d.getStats();Q(s.map(t=>({id:t.id,type:t.type,sourceIP:t.sourceIP,destinationIP:t.destinationIP,protocol:t.protocol,port:t.port,severity:t.severity,timestamp:new Date(t.timestamp).toISOString(),description:t.description,blocked:t.blocked,signature:t.signature}))),F(n.map(t=>({ip:t.ip,reason:t.reason,blockedAt:new Date(t.blockedAt).toISOString(),expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString():void 0,duration:t.expiresAt?Math.floor((t.expiresAt-t.blockedAt)/1e3):void 0}))),q({totalAlerts:i.alertsGenerated,alertsBlocked:i.alertsBlocked,signaturesActive:i.activeSignatures,blockedIPs:i.blockedIPs}),P({title:"Refreshed",description:"IDS/IPS data has been refreshed"})}},he=()=>{const s={id:`sig-${Date.now()}`,name:"New Signature",description:"",enabled:!0,severity:"medium",pattern:"",action:"alert"};c({signatures:[...g,s]}),re(!1),P({title:"Signature created",description:"New signature has been created"})},xe=s=>{const n=g.find(i=>i.id===s);c({signatures:g.filter(i=>i.id!==s)}),P({title:"Signature deleted",description:n?`Signature "${n.name}" has been deleted`:"Signature has been deleted"})},p=(s,n,i)=>{const t=g.map(O=>O.id===s?{...O,[n]:i}:O);c({signatures:t})},ue=s=>{d&&d.unblockIP(s),c({blockedIPs:y.filter(n=>n.ip!==s)}),P({title:"IP unblocked",description:`IP address ${s} has been unblocked`})},G=S.filter(s=>{if(M!=="all"&&s.type!==M)return!1;if(E){const n=E.toLowerCase();return s.sourceIP.toLowerCase().includes(n)||s.destinationIP.toLowerCase().includes(n)||s.description.toLowerCase().includes(n)||s.signature&&s.signature.toLowerCase().includes(n)}return!0});return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"IDS / IPS"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Intrusion Detection & Prevention"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Monitor and protect network from security threats"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(D,{variant:"outline",size:"sm",onClick:oe,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(k,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Total Alerts"})}),e.jsx(h,{children:e.jsx("span",{className:"text-2xl font-bold",children:ie})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Alerts Blocked"})}),e.jsx(h,{children:e.jsx("span",{className:"text-2xl font-bold text-red-500",children:ae})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Active Signatures"})}),e.jsx(h,{children:e.jsx("span",{className:"text-2xl font-bold",children:le})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Blocked IPs"})}),e.jsx(h,{children:e.jsx("span",{className:"text-2xl font-bold",children:y.length})})]})]}),e.jsxs(ge,{defaultValue:"alerts",className:"space-y-4",children:[e.jsxs(pe,{children:[e.jsxs(B,{value:"alerts",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Alerts (",S.length,")"]}),e.jsxs(B,{value:"signatures",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Signatures (",g.length,")"]}),e.jsxs(B,{value:"blocked",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Blocked IPs (",y.length,")"]}),e.jsxs(B,{value:"settings",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(L,{value:"alerts",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Security Alerts"}),e.jsx(T,{children:"Recent intrusion detection alerts"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search alerts...",value:E,onChange:s=>ce(s.target.value),className:"pl-8 w-64"})]}),e.jsxs(A,{value:M,onValueChange:s=>de(s),children:[e.jsx(C,{className:"w-40",children:e.jsx(I,{})}),e.jsxs(w,{children:[e.jsx(a,{value:"all",children:"All Types"}),e.jsx(a,{value:"signature",children:"Signature"}),e.jsx(a,{value:"anomaly",children:"Anomaly"}),e.jsx(a,{value:"behavioral",children:"Behavioral"})]})]})]})]})}),e.jsx(h,{children:G.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:S.length===0?"No alerts detected":"No alerts match the filter"}):e.jsx("div",{className:"space-y-2",children:G.map(s=>e.jsx(o,{className:`border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="high"?"border-l-orange-500":s.severity==="medium"?"border-l-yellow-500":"border-l-blue-500"}`,children:e.jsx(h,{className:"pt-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(m,{variant:s.severity==="critical"?"destructive":s.severity==="high"?"default":"outline",children:s.severity}),e.jsx(m,{variant:"outline",children:s.type}),s.blocked?e.jsxs(m,{variant:"default",className:"bg-green-500",children:[e.jsx(we,{className:"h-3 w-3 mr-1"}),"Blocked"]}):e.jsxs(m,{variant:"outline",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Not Blocked"]})]}),e.jsx("p",{className:"font-medium mb-1",children:s.description}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Source: ",s.sourceIP," â†’ Destination: ",s.destinationIP]}),e.jsxs("p",{children:["Protocol: ",s.protocol," Port: ",s.port]}),e.jsxs("p",{children:["Time: ",new Date(s.timestamp).toLocaleString()]}),s.signature&&e.jsxs("p",{children:["Signature: ",s.signature]})]})]})})})},s.id))})})]})}),e.jsx(L,{value:"signatures",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Detection Signatures"}),e.jsx(T,{children:"Configure detection rules and patterns"})]}),e.jsxs(D,{onClick:he,size:"sm",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Create Signature"]})]})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsxs(o,{className:"border-l-4 border-l-blue-500",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(m,{variant:s.enabled?"default":"outline",children:s.enabled?"Enabled":"Disabled"}),e.jsx(m,{variant:s.severity==="critical"?"destructive":s.severity==="high"?"default":"outline",children:s.severity}),e.jsx(m,{variant:"outline",children:s.action})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:s.enabled,onCheckedChange:n=>p(s.id,"enabled",n)}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>xe(s.id),children:e.jsx(ke,{className:"h-4 w-4"})})]})]})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Signature Name"}),e.jsx(v,{value:s.name,onChange:n=>p(s.id,"name",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Severity"}),e.jsxs(A,{value:s.severity,onValueChange:n=>p(s.id,"severity",n),children:[e.jsx(C,{children:e.jsx(I,{})}),e.jsxs(w,{children:[e.jsx(a,{value:"critical",children:"Critical"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Action"}),e.jsxs(A,{value:s.action,onValueChange:n=>p(s.id,"action",n),children:[e.jsx(C,{children:e.jsx(I,{})}),e.jsxs(w,{children:[e.jsx(a,{value:"block",children:"Block"}),e.jsx(a,{value:"alert",children:"Alert"}),e.jsx(a,{value:"log",children:"Log"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Description"}),e.jsx(v,{value:s.description,onChange:n=>p(s.id,"description",n.target.value),placeholder:"Signature description"})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(r,{children:"Pattern"}),e.jsx(v,{value:s.pattern,onChange:n=>p(s.id,"pattern",n.target.value),placeholder:"Detection pattern",className:"font-mono text-sm"})]})]})})]},s.id))})})]})}),e.jsx(L,{value:"blocked",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Blocked IP Addresses"}),e.jsx(T,{children:"IPs currently blocked by the system"})]}),e.jsx(h,{children:y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No IPs blocked"}):e.jsx("div",{className:"space-y-2",children:y.map((s,n)=>e.jsx(o,{className:"border-l-4 border-l-red-500",children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(m,{variant:"destructive",children:s.ip}),e.jsx(m,{variant:"outline",children:s.reason})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Blocked at: ",new Date(s.blockedAt).toLocaleString()]}),s.duration&&e.jsxs("p",{children:["Duration: ",s.duration," seconds"]}),s.expiresAt&&e.jsxs("p",{children:["Expires: ",new Date(s.expiresAt).toLocaleString()]})]})]}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>ue(s.ip),children:"Unblock"})]})})},n))})})]})}),e.jsx(L,{value:"settings",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"IDS/IPS Settings"}),e.jsx(T,{children:"Configure detection and prevention settings"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Operation Mode"}),e.jsxs(A,{value:W,onValueChange:s=>c({mode:s}),children:[e.jsx(C,{children:e.jsx(I,{})}),e.jsxs(w,{children:[e.jsx(a,{value:"ips",children:"IPS (Prevention - Active blocking)"}),e.jsx(a,{value:"ids",children:"IDS (Detection - Monitoring only)"})]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Signature Detection"}),e.jsx(f,{checked:Y,onCheckedChange:s=>c({enableSignatureDetection:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Anomaly Detection"}),e.jsx(f,{checked:Z,onCheckedChange:s=>c({enableAnomalyDetection:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Behavioral Analysis"}),e.jsx(f,{checked:_,onCheckedChange:s=>c({enableBehavioralAnalysis:s})})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Alert Threshold"}),e.jsxs(A,{value:ee,onValueChange:s=>c({alertThreshold:s}),children:[e.jsx(C,{children:e.jsx(I,{})}),e.jsxs(w,{children:[e.jsx(a,{value:"critical",children:"Critical"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"low",children:"Low"})]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Auto Block"}),e.jsx(f,{checked:V,onCheckedChange:s=>c({enableAutoBlock:s})})]}),V&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Block Duration (seconds)"}),e.jsx(v,{type:"number",value:se,onChange:s=>c({blockDuration:Number(s.target.value)}),min:60,max:86400})]}),e.jsx(k,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Logging"}),e.jsx(f,{checked:z,onCheckedChange:s=>c({enableLogging:s})})]}),z&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Log Retention (days)"}),e.jsx(v,{type:"number",value:te,onChange:s=>c({logRetention:Number(s.target.value)}),min:1,max:365})]})]})]})})]})]})})}export{Oe as IDSIPSConfigAdvanced};
