import{u as fe,a as ye,r as E,j as e,e as Ne,S as k,C as f,h as y,i as N,m as b,B as P,T as be,b as Ce,c as K,f as J,k as W,l as S,P as _,I as h,o as R,L as d,q as L,s as B,t as $,v as F,w as C,af as Z,A as we,n as ee,x as se}from"./index-HDGrDyRq.js";import{P as ke}from"./progress-DX86yUno.js";import{T as te}from"./textarea-CjQgIquO.js";import{M as Se}from"./message-square-Bx--DnvZ.js";import{U as De}from"./users-O29_gLR1.js";import{K as Ee}from"./key-CMmIYHBN.js";import{S as Pe}from"./send-CGm1BGnd.js";import{C as Te}from"./clock-3yiD5iuE.js";function ze({componentId:T}){const{nodes:ae,updateNode:z}=fe(),{isRunning:G}=ye(),w=ae.find(s=>s.id===T),M=E.useRef(w);if(E.useEffect(()=>{M.current=w},[w]),!w)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const A=w.data.config||{},O=A.projectId||"archiphoenix-lab",ne=A.credentials||"",u=A.topics||[],p=A.subscriptions||[],[le,I]=E.useState(null),[re,U]=E.useState(null),[i,g]=E.useState({}),[m,D]=E.useState(null);E.useEffect(()=>{if(!w||u.length===0&&p.length===0||!G)return;const s=setInterval(()=>{const t=Ne.getPubSubRoutingEngine(T);if(!t)return;const a=t.getAllTopicMetrics(),n=t.getAllSubscriptionMetrics(),l=M.current?.data.config||{},c=l.topics||[],j=l.subscriptions||[],X=c.map(o=>{const r=a.get(o.name);return r?{...o,messageCount:r.messageCount,byteCount:r.byteCount,validationErrorCount:r.validationErrorCount}:o}),Y=j.map(o=>{const r=n.get(o.name);return r?{...o,messageCount:r.messageCount,unackedMessageCount:r.unackedMessageCount,deliveredCount:r.deliveredCount,acknowledgedCount:r.acknowledgedCount,nackedCount:r.nackedCount,deadLetterCount:r.deadLetterCount,pushDeliverySuccessRate:r.pushDeliverySuccessRate,expiredAckDeadlines:r.expiredAckDeadlines,avgDeliveryAttempts:r.avgDeliveryAttempts}:o}),je=X.some((o,r)=>o.messageCount!==c[r]?.messageCount||o.byteCount!==c[r]?.byteCount||o.validationErrorCount!==c[r]?.validationErrorCount),ve=Y.some((o,r)=>o.messageCount!==j[r]?.messageCount||o.unackedMessageCount!==j[r]?.unackedMessageCount||o.deliveredCount!==j[r]?.deliveredCount||o.acknowledgedCount!==j[r]?.acknowledgedCount||o.nackedCount!==j[r]?.nackedCount||o.deadLetterCount!==j[r]?.deadLetterCount||o.pushDeliverySuccessRate!==j[r]?.pushDeliverySuccessRate||o.expiredAckDeadlines!==j[r]?.expiredAckDeadlines||o.avgDeliveryAttempts!==j[r]?.avgDeliveryAttempts);(je||ve)&&M.current&&z(T,{data:{...M.current.data,config:{...l,topics:X,subscriptions:Y}}})},500);return()=>clearInterval(s)},[T,u.length,p.length,w?.id,z,G]);const x=s=>{z(T,{data:{...w.data,config:{...A,...s}}})},ce=()=>{const s={name:"new-topic",projectId:O,messageRetentionDuration:604800,messageCount:0,byteCount:0};x({topics:[...u,s]})},ie=s=>{x({topics:u.filter((t,a)=>a!==s)})},H=(s,t,a)=>{const n=[...u];if(n[s]={...n[s],[t]:a},t==="name"){const l=ue(a);if(l)g({...i,[`topic-${s}-name`]:l});else{const c={...i};delete c[`topic-${s}-name`],g(c)}}else if(t==="messageRetentionDuration"){const l=Q(a);if(l)g({...i,[`topic-${s}-retention`]:l});else{const c={...i};delete c[`topic-${s}-retention`],g(c)}}x({topics:n})},q=(s,t,a)=>{const n=[...u],l=n[s],c={...l.labels||{},[t]:a};n[s]={...l,labels:c},x({topics:n})},oe=(s,t)=>{const a=[...u],n=a[s],l={...n.labels||{}};delete l[t],a[s]={...n,labels:l},x({topics:a})},V=(s,t,a)=>{!t||!a||(q(s,t,a),D(null))},de=()=>{const s={name:"new-subscription",topic:u[0]?.name||"",projectId:O,ackDeadlineSeconds:10,enableMessageOrdering:!1,messageCount:0,unackedMessageCount:0,maxDeliveryAttempts:5,retryPolicy:{minimumBackoff:10,maximumBackoff:600},enableExactlyOnceDelivery:!1,expirationPolicy:{ttl:void 0},flowControl:{maxOutstandingMessages:1e3,maxOutstandingBytes:0}};x({subscriptions:[...p,s]})},me=s=>{x({subscriptions:p.filter((t,a)=>a!==s)})},v=(s,t,a)=>{const n=[...p];if(n[s]={...n[s],[t]:a},t==="name"){const l=xe(a);if(l)g({...i,[`sub-${s}-name`]:l});else{const c={...i};delete c[`sub-${s}-name`],g(c)}}else if(t==="pushEndpoint"){const l=he(a);if(l)g({...i,[`sub-${s}-pushEndpoint`]:l});else{const c={...i};delete c[`sub-${s}-pushEndpoint`],g(c)}}else if(t==="ackDeadlineSeconds"){const l=pe(a);if(l)g({...i,[`sub-${s}-ackDeadline`]:l});else{const c={...i};delete c[`sub-${s}-ackDeadline`],g(c)}}else if(t==="messageRetentionDuration"){const l=Q(a);if(l)g({...i,[`sub-${s}-retention`]:l});else{const c={...i};delete c[`sub-${s}-retention`],g(c)}}x({subscriptions:n})},ue=s=>!s||s.length<3||s.length>255?"Topic name must be 3-255 characters":/^[a-z][a-z0-9-]*[a-z0-9]$/.test(s)?s.startsWith("goog")?'Topic name cannot start with "goog"':null:"Topic name must start with lowercase letter, contain only lowercase letters, numbers, and hyphens, and end with alphanumeric",xe=s=>!s||s.length<3||s.length>255?"Subscription name must be 3-255 characters":/^[a-z][a-z0-9-]*[a-z0-9]$/.test(s)?s.startsWith("goog")?'Subscription name cannot start with "goog"':null:"Subscription name must start with lowercase letter, contain only lowercase letters, numbers, and hyphens, and end with alphanumeric",he=s=>{if(!s)return null;try{return new URL(s).protocol!=="https:"?"Push endpoint must use HTTPS":null}catch{return"Invalid URL format"}},pe=s=>s<10||s>600?"Ack deadline must be between 10 and 600 seconds":null,Q=s=>s<600||s>2678400?"Message retention must be between 600 seconds (10 minutes) and 2678400 seconds (31 days)":null,ge=u.reduce((s,t)=>s+(t.messageCount||0),0);return p.reduce((s,t)=>s+(t.unackedMessageCount||0),0),e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Google Cloud Pub/Sub"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Pub/Sub Service"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Configure topics and subscriptions with push/pull delivery"})]})}),e.jsx(k,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(f,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Project ID"})}),e.jsx(b,{children:e.jsx(P,{variant:"outline",children:O})})]}),e.jsxs(f,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Topics"})}),e.jsx(b,{children:e.jsx("span",{className:"text-2xl font-bold",children:u.length})})]}),e.jsxs(f,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Subscriptions"})}),e.jsx(b,{children:e.jsx("span",{className:"text-2xl font-bold",children:p.length})})]}),e.jsxs(f,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Total Messages"})}),e.jsx(b,{children:e.jsx("span",{className:"text-2xl font-bold",children:ge.toLocaleString()})})]})]}),e.jsxs(be,{defaultValue:"topics",className:"space-y-4",children:[e.jsxs(Ce,{className:"flex flex-wrap gap-2 w-full",children:[e.jsxs(K,{value:"topics",className:"flex-shrink-0",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Topics (",u.length,")"]}),e.jsxs(K,{value:"subscriptions",className:"flex-shrink-0",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Subscriptions (",p.length,")"]}),e.jsxs(K,{value:"credentials",className:"flex-shrink-0",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Credentials"]})]}),e.jsx(J,{value:"topics",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Topics"}),e.jsx(W,{children:"Configure Pub/Sub topics"})]}),e.jsxs(S,{onClick:ce,size:"sm",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Create Topic"]})]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:u.map((s,t)=>e.jsxs(f,{className:"border-l-4 border-l-blue-500",children:[e.jsx(y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{className:"text-base",children:le===t?e.jsx(h,{value:s.name,onChange:a=>H(t,"name",a.target.value),onBlur:()=>I(null),onKeyDown:a=>{a.key==="Enter"&&I(null)},className:"h-7",autoFocus:!0}):e.jsx("span",{className:"cursor-pointer hover:text-primary",onClick:()=>I(t),children:s.name})}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>ie(t),disabled:u.length===1,children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Messages"}),e.jsx("p",{className:"text-lg font-semibold",children:s.messageCount||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bytes"}),e.jsx("p",{className:"text-lg font-semibold",children:(s.byteCount||0).toLocaleString()})]}),s.validationErrorCount!==void 0&&s.validationErrorCount>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Validation Errors"}),e.jsx("p",{className:"text-lg font-semibold text-red-600 dark:text-red-400",children:s.validationErrorCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Topic ID"}),e.jsxs("p",{className:"text-xs font-mono text-muted-foreground truncate",children:["projects/",O,"/topics/",s.name]})]})]}),e.jsx(k,{}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Message Retention (seconds)"}),e.jsx(h,{type:"number",value:s.messageRetentionDuration||604800,onChange:a=>H(t,"messageRetentionDuration",Number(a.target.value)),className:i[`topic-${t}-retention`]?"border-red-500":""}),i[`topic-${t}-retention`]&&e.jsx("p",{className:"text-xs text-red-500",children:i[`topic-${t}-retention`]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default: 7 days (604800), Range: 600s - 2678400s"})]})}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Schema Configuration (optional)"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Define a schema to validate messages published to this topic"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Schema Type"}),e.jsxs(L,{value:s.schema?.type||"none",onValueChange:a=>{const n=[...u];if(a==="none"){const{schema:l,...c}=n[t];n[t]=c}else n[t]={...n[t],schema:{...n[t].schema,type:a,definition:n[t].schema?.definition||""}};x({topics:n})},children:[e.jsx(B,{children:e.jsx($,{placeholder:"No schema"})}),e.jsxs(F,{children:[e.jsx(C,{value:"none",children:"No schema"}),e.jsx(C,{value:"AVRO",children:"Avro"}),e.jsx(C,{value:"PROTOCOL_BUFFER",children:"Protocol Buffer"}),e.jsx(C,{value:"JSON",children:"JSON Schema"})]})]})]})}),s.schema?.type&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Schema Definition"}),e.jsx(te,{value:s.schema?.definition||"",onChange:a=>{const n=[...u];n[t]={...n[t],schema:{...n[t].schema,type:n[t].schema.type,definition:a.target.value}},x({topics:n})},placeholder:s.schema?.type==="AVRO"?'{"type": "record", "name": "Example", "fields": [...]}':s.schema?.type==="PROTOCOL_BUFFER"?'syntax = "proto3"; message Example { ... }':'{"type": "object", "properties": {...}}',rows:6,className:"font-mono text-xs"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.schema?.type==="AVRO"&&"Avro schema in JSON format",s.schema?.type==="PROTOCOL_BUFFER"&&"Protocol Buffer .proto file content",s.schema?.type==="JSON"&&"JSON Schema definition"]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Labels"}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>D({topicIndex:t,key:"",value:""}),children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Add Label"]})]}),e.jsxs("div",{className:"space-y-2",children:[s.labels&&Object.entries(s.labels).map(([a,n])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{value:a,readOnly:!0,className:"flex-1 font-mono text-xs",disabled:!0}),e.jsx(h,{value:n,onChange:l=>q(t,a,l.target.value),className:"flex-1 font-mono text-xs",placeholder:"value"}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>oe(t,a),children:e.jsx(R,{className:"h-3 w-3"})})]},a)),m?.topicIndex===t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{value:m.key,onChange:a=>D({...m,key:a.target.value}),placeholder:"key",className:"flex-1 font-mono text-xs",onKeyDown:a=>{a.key==="Enter"&&m.key&&m.value?V(t,m.key,m.value):a.key==="Escape"&&D(null)},autoFocus:!0}),e.jsx(h,{value:m.value,onChange:a=>D({...m,value:a.target.value}),placeholder:"value",className:"flex-1 font-mono text-xs",onKeyDown:a=>{a.key==="Enter"&&m.key&&m.value?V(t,m.key,m.value):a.key==="Escape"&&D(null)}}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>{m.key&&m.value&&V(t,m.key,m.value)},children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>D(null),children:e.jsx(R,{className:"h-3 w-3"})})]}),(!s.labels||Object.keys(s.labels).length===0)&&!m&&e.jsx("p",{className:"text-xs text-muted-foreground",children:'No labels. Click "Add Label" to add one.'})]})]}),i[`topic-${t}-name`]&&e.jsx("p",{className:"text-xs text-red-500 mt-2",children:i[`topic-${t}-name`]})]})]},t))})})]})}),e.jsx(J,{value:"subscriptions",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Subscriptions"}),e.jsx(W,{children:"Configure pull and push subscriptions"})]}),e.jsxs(S,{onClick:de,size:"sm",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Create Subscription"]})]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:p.map((s,t)=>e.jsxs(f,{className:"border-l-4 border-l-green-500",children:[e.jsx(y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{className:"text-base",children:re===t?e.jsx(h,{value:s.name,onChange:a=>v(t,"name",a.target.value),onBlur:()=>U(null),onKeyDown:a=>{a.key==="Enter"&&U(null)},className:"h-7",autoFocus:!0}):e.jsx("span",{className:"cursor-pointer hover:text-primary",onClick:()=>U(t),children:s.name})}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>me(t),disabled:p.length===1,children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(P,{variant:s.pushEndpoint?"default":"secondary",children:s.pushEndpoint?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Push"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-3 w-3 mr-1"}),"Pull"]})}),s.messageCount&&s.messageCount>0?e.jsxs(P,{variant:"outline",className:"bg-green-50 dark:bg-green-950",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsxs(P,{variant:"outline",className:"bg-gray-50 dark:bg-gray-900",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Inactive"]}),s.unackedMessageCount&&s.unackedMessageCount>0&&e.jsxs(P,{variant:"outline",className:"bg-yellow-50 dark:bg-yellow-950",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),s.unackedMessageCount," Unacked"]}),s.deadLetterCount&&s.deadLetterCount>0&&e.jsxs(P,{variant:"destructive",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),s.deadLetterCount," Dead Letter"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Available"}),e.jsx("p",{className:"text-lg font-semibold",children:s.messageCount||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Unacked"}),e.jsx("p",{className:"text-lg font-semibold",children:s.unackedMessageCount||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivered"}),e.jsx("p",{className:"text-lg font-semibold",children:s.deliveredCount||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Acknowledged"}),e.jsx("p",{className:"text-lg font-semibold",children:s.acknowledgedCount||0})]})]}),(s.pushDeliverySuccessRate!==void 0||s.avgDeliveryAttempts!==void 0||s.expiredAckDeadlines!==void 0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 pt-2 border-t",children:[s.pushEndpoint&&s.pushDeliverySuccessRate!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Push Success Rate"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{value:s.pushDeliverySuccessRate*100,className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[(s.pushDeliverySuccessRate*100).toFixed(1),"%"]})]})]}),s.avgDeliveryAttempts!==void 0&&s.avgDeliveryAttempts>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Delivery Attempts"}),e.jsx("p",{className:"text-lg font-semibold",children:s.avgDeliveryAttempts.toFixed(1)})]}),s.expiredAckDeadlines!==void 0&&s.expiredAckDeadlines>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Expired Acks"}),e.jsx("p",{className:"text-lg font-semibold text-yellow-600 dark:text-yellow-400",children:s.expiredAckDeadlines})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Topic"}),e.jsxs(L,{value:s.topic,onValueChange:a=>v(t,"topic",a),children:[e.jsx(B,{children:e.jsx($,{})}),e.jsx(F,{children:u.map(a=>e.jsx(C,{value:a.name,children:a.name},a.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Ack Deadline (seconds)"}),e.jsx(h,{type:"number",value:s.ackDeadlineSeconds,onChange:a=>v(t,"ackDeadlineSeconds",Number(a.target.value)),min:10,max:600,className:i[`sub-${t}-ackDeadline`]?"border-red-500":""}),i[`sub-${t}-ackDeadline`]&&e.jsx("p",{className:"text-xs text-red-500",children:i[`sub-${t}-ackDeadline`]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Range: 10-600 seconds"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Push Endpoint URL (optional)"}),e.jsx(h,{value:s.pushEndpoint||"",onChange:a=>v(t,"pushEndpoint",a.target.value),placeholder:"https://api.service/push",className:i[`sub-${t}-pushEndpoint`]?"border-red-500":""}),i[`sub-${t}-pushEndpoint`]&&e.jsx("p",{className:"text-xs text-red-500",children:i[`sub-${t}-pushEndpoint`]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty for pull subscription. Must be HTTPS URL."})]}),s.pushEndpoint&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Payload Format"}),e.jsxs(L,{value:s.payloadFormat||"WRAPPED",onValueChange:a=>v(t,"payloadFormat",a),children:[e.jsx(B,{children:e.jsx($,{})}),e.jsxs(F,{children:[e.jsx(C,{value:"WRAPPED",children:"Wrapped (Pub/Sub format)"}),e.jsx(C,{value:"UNWRAPPED",children:"Unwrapped (message data only)"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wrapped: Full Pub/Sub message format with metadata. Unwrapped: Only message data."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Enable Message Ordering"}),e.jsx(se,{checked:s.enableMessageOrdering,onCheckedChange:a=>v(t,"enableMessageOrdering",a)})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Dead Letter Topic (optional)"}),e.jsxs(L,{value:s.deadLetterTopic||"none",onValueChange:a=>v(t,"deadLetterTopic",a==="none"?void 0:a),children:[e.jsx(B,{children:e.jsx($,{placeholder:"Select dead letter topic (optional)"})}),e.jsxs(F,{children:[e.jsx(C,{value:"none",children:"None"}),u.map(a=>e.jsx(C,{value:a.name,children:a.name},a.name))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Messages that exceed max delivery attempts will be sent to this topic"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Max Delivery Attempts"}),e.jsx(h,{type:"number",value:s.maxDeliveryAttempts||5,onChange:a=>v(t,"maxDeliveryAttempts",Number(a.target.value)),min:1,max:100}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default: 5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Min Backoff (seconds)"}),e.jsx(h,{type:"number",value:s.retryPolicy?.minimumBackoff||10,onChange:a=>{const n=[...p];n[t]={...n[t],retryPolicy:{...n[t].retryPolicy,minimumBackoff:Number(a.target.value),maximumBackoff:n[t].retryPolicy?.maximumBackoff||600}},x({subscriptions:n})},min:1,max:600}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default: 10s"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Max Backoff (seconds)"}),e.jsx(h,{type:"number",value:s.retryPolicy?.maximumBackoff||600,onChange:a=>{const n=[...p];n[t]={...n[t],retryPolicy:{...n[t].retryPolicy,minimumBackoff:n[t].retryPolicy?.minimumBackoff||10,maximumBackoff:Number(a.target.value)}},x({subscriptions:n})},min:10,max:3600}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default: 600s"})]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Enable Exactly-Once Delivery"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Prevents duplicate message delivery by tracking delivered message IDs"})]}),e.jsx(se,{checked:s.enableExactlyOnceDelivery||!1,onCheckedChange:a=>v(t,"enableExactlyOnceDelivery",a)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Expiration Policy TTL (seconds, optional)"}),e.jsx(h,{type:"number",value:s.expirationPolicy?.ttl||"",onChange:a=>{const n=[...p],l=a.target.value===""?void 0:Number(a.target.value);n[t]={...n[t],expirationPolicy:{...n[t].expirationPolicy,ttl:l}},x({subscriptions:n})},placeholder:"No expiration",min:1}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Subscription will expire if inactive for this duration. Leave empty for no expiration."})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Flow Control (Pull Subscriptions)"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Limit the number of outstanding (unacked) messages and bytes to prevent overwhelming the subscriber"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Max Outstanding Messages"}),e.jsx(h,{type:"number",value:s.flowControl?.maxOutstandingMessages??1e3,onChange:a=>{const n=[...p],l=a.target.value===""?void 0:Number(a.target.value);n[t]={...n[t],flowControl:{...n[t].flowControl,maxOutstandingMessages:l??1e3,maxOutstandingBytes:n[t].flowControl?.maxOutstandingBytes??0}},x({subscriptions:n})},min:0,placeholder:"1000"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum unacked messages (0 = unlimited). Default: 1000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Max Outstanding Bytes"}),e.jsx(h,{type:"number",value:s.flowControl?.maxOutstandingBytes??0,onChange:a=>{const n=[...p],l=a.target.value===""?void 0:Number(a.target.value);n[t]={...n[t],flowControl:{...n[t].flowControl,maxOutstandingMessages:n[t].flowControl?.maxOutstandingMessages??1e3,maxOutstandingBytes:l??0}},x({subscriptions:n})},min:0,placeholder:"0 (unlimited)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum unacked bytes (0 = unlimited). Default: 0 (unlimited)"})]})]})]}),i[`sub-${t}-name`]&&e.jsx("p",{className:"text-xs text-red-500 mt-2",children:i[`sub-${t}-name`]})]})]},t))})})]})}),e.jsx(J,{value:"credentials",className:"space-y-4",children:e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"GCP Credentials"}),e.jsx(W,{children:"Configure Google Cloud Platform credentials"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Project ID"}),e.jsx(h,{value:O,onChange:s=>x({projectId:s.target.value}),placeholder:"my-project-id"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Service Account JSON"}),e.jsx(te,{value:ne,onChange:s=>x({credentials:s.target.value}),placeholder:'{"type": "service_account", ...}',rows:8}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste your GCP service account JSON credentials"})]})]})]})})]})]})})}export{ze as GCPPubSubConfigAdvanced};
