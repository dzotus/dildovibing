import{u as ue,j as e,e as k,r as P,l as x,S as ve,C as r,h as m,i as j,m as d,A as ge,k as S,L as c,x as V,I as v,q as A,s as T,t as R,v as E,w as g,T as pe,b as fe,c as D,aA as Ne,d as ye,f as U,B as C,P as I,o as O}from"./index-DCOdhwlJ.js";import{R as be}from"./refresh-ccw-DhaFJxzK.js";import{U as Ce}from"./users-DaBnG9kx.js";import{B as we}from"./bell-Ce1dHz1r.js";import{C as Se}from"./clock-Cuo099JE.js";function Me({componentId:N}){const{nodes:$,updateNode:J}=ue(),L=$.find(s=>s.id===N);if(!L)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const u=L.data.config||{},q=u.enableAutoResolve??!0,G=u.resolveTimeout??300,B=u.enableWebhooks??!1,H=u.webhookUrl??"",_=u.severityMapping??"standard",p=u.services||[{id:"1",name:"archiphoenix-service",integrationKey:"integration-key-123",status:"active",escalationPolicy:"default-policy",autoResolve:!0,resolveTimeout:300,incidentCount:0}],w=k.getPagerDutyIncidents(N).map(s=>{const a=p.find(t=>t.id===s.serviceId);return{id:s.id,title:s.title,service:a?.name||s.serviceId,status:s.status,severity:s.severity,createdAt:new Date(s.createdAt).toISOString(),acknowledgedAt:s.acknowledgedAt?new Date(s.acknowledgedAt).toISOString():void 0,resolvedAt:s.resolvedAt?new Date(s.resolvedAt).toISOString():void 0}}),o=u.escalationPolicies||[{id:"1",name:"default-policy",levels:[{level:1,timeout:5,targets:["user1"]},{level:2,timeout:15,targets:["user2"]}]}],f=u.onCallUsers||[{id:"1",name:"John Doe",email:"john@example.com",status:"on-call"},{id:"2",name:"Jane Smith",email:"jane@example.com",status:"off-call"}],z=k.getPagerDutyMetrics(N),F=z?.incidentsTotal??w.length,K=z?.incidentsActive??w.filter(s=>s.status!=="resolved").length,Q=z?.incidentsResolved??w.filter(s=>s.status==="resolved").length,[Pe,Ae]=P.useState(null),[Te,X]=P.useState(!1),[Re,Y]=P.useState(!1),[Ee,Z]=P.useState(!1),i=s=>{J(N,{data:{...L.data,config:{...u,...s}}})},ee=()=>{const s={id:`service-${Date.now()}`,name:"new-service",integrationKey:"",status:"active",autoResolve:!0,resolveTimeout:300,incidentCount:0};i({services:[...p,s]}),X(!1)},se=s=>{i({services:p.filter(a=>a.id!==s)})},y=(s,a,t)=>{const l=p.map(n=>n.id===s?{...n,[a]:t}:n);i({services:l})},ae=s=>{k.acknowledgePagerDutyIncident(N,s)},le=s=>{k.resolvePagerDutyIncident(N,s)},te=()=>{const s={id:`policy-${Date.now()}`,name:"new-policy",levels:[{level:1,timeout:5,targets:[]}]};i({escalationPolicies:[...o,s]}),Y(!1)},ne=s=>{i({escalationPolicies:o.filter(a=>a.id!==s)})},ie=(s,a)=>{const t=o.map(l=>l.id===s?{...l,name:a}:l);i({escalationPolicies:t})},ce=s=>{const a=o.map(t=>{if(t.id!==s)return t;const l=(t.levels[t.levels.length-1]?.level||0)+1;return{...t,levels:[...t.levels,{level:l,timeout:5,targets:[]}]}});i({escalationPolicies:a})},re=(s,a)=>{const t=o.map(l=>{if(l.id!==s)return l;const n=l.levels.filter((b,h)=>h!==a);return{...l,levels:n}});i({escalationPolicies:t})},de=(s,a,t)=>{const l=o.map(n=>{if(n.id!==s)return n;const b=n.levels.map((h,W)=>W===a?{...h,timeout:t}:h);return{...n,levels:b}});i({escalationPolicies:l})},oe=(s,a,t)=>{const l=o.map(n=>{if(n.id!==s)return n;const b=n.levels.map((h,W)=>{if(W!==a)return h;const he=h.targets.includes(t)?h.targets.filter(je=>je!==t):[...h.targets,t];return{...h,targets:he}});return{...n,levels:b}});i({escalationPolicies:l})},xe=()=>{const s={id:`user-${Date.now()}`,name:"On-Call User",email:"user@example.com",status:"on-call"};i({onCallUsers:[...f,s]}),Z(!1)},me=s=>{const a=f.filter(l=>l.id!==s),t=o.map(l=>({...l,levels:l.levels.map(n=>({...n,targets:n.targets.filter(b=>b!==s)}))}));i({onCallUsers:a,escalationPolicies:t})},M=(s,a,t)=>{const l=f.map(n=>n.id===s?{...n,[a]:t}:n);i({onCallUsers:l})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"PagerDuty"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Incident Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage incidents, services, escalation policies and on-call schedules"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(x,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(ve,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium",children:"Total Incidents"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold",children:F})})]}),e.jsxs(r,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium",children:"Active"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold text-red-500",children:K})})]}),e.jsxs(r,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium",children:"Resolved"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold text-green-500",children:Q})})]}),e.jsxs(r,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium",children:"Services"})}),e.jsx(d,{children:e.jsx("span",{className:"text-2xl font-bold",children:p.length})})]})]}),e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Global Settings"]}),e.jsx(S,{children:"Control how incidents are auto-resolved, mapped by severity and propagated via webhooks"})]}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Auto Resolve"}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Enable automatic incident resolution"}),e.jsx(V,{checked:q,onCheckedChange:s=>i({enableAutoResolve:s})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Resolve Timeout (seconds)"}),e.jsx(v,{type:"number",value:G,onChange:s=>i({resolveTimeout:Number(s.target.value)||0}),min:60})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Severity Mapping"}),e.jsxs(A,{value:_,onValueChange:s=>i({severityMapping:s}),children:[e.jsx(T,{children:e.jsx(R,{})}),e.jsxs(E,{children:[e.jsx(g,{value:"standard",children:"Standard (critical / warning / info)"}),e.jsx(g,{value:"error-focused",children:"Error-focused (warnings treated as errors)"}),e.jsx(g,{value:"warning-demoted",children:"Warning demoted (warnings as info)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Enable Webhooks"}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Send outbound incident webhooks"}),e.jsx(V,{checked:B,onCheckedChange:s=>i({enableWebhooks:s})})]})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(c,{children:"Webhook URL"}),e.jsx(v,{value:H,onChange:s=>i({webhookUrl:s.target.value}),placeholder:"https://webhook.example.com/pagerduty",disabled:!B})]})]})})]}),e.jsxs(pe,{defaultValue:"incidents",className:"space-y-4",children:[e.jsxs(fe,{children:[e.jsxs(D,{value:"incidents",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Incidents (",K,")"]}),e.jsxs(D,{value:"services",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Services (",p.length,")"]}),e.jsxs(D,{value:"policies",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Escalation Policies (",o.length,")"]}),e.jsxs(D,{value:"oncall",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"On-Call"]})]}),e.jsx(U,{value:"incidents",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"Incidents"}),e.jsx(S,{children:"Manage and respond to incidents"})]}),e.jsx(d,{children:w.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No incidents"}):e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsx(r,{className:`border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="error"?"border-l-orange-500":s.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{variant:s.status==="resolved"?"default":s.status==="acknowledged"?"secondary":"destructive",children:s.status}),e.jsx(C,{variant:s.severity==="critical"?"destructive":s.severity==="error"?"default":"outline",children:s.severity}),e.jsx("span",{className:"font-medium",children:s.title})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Service: ",s.service]}),e.jsxs("p",{children:["Created: ",new Date(s.createdAt).toLocaleString()]}),s.assignedTo&&e.jsxs("p",{children:["Assigned to: ",s.assignedTo]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="triggered"&&e.jsx(x,{size:"sm",variant:"outline",onClick:()=>ae(s.id),children:"Acknowledge"}),s.status!=="resolved"&&e.jsx(x,{size:"sm",variant:"default",onClick:()=>le(s.id),children:"Resolve"})]})]})})},s.id))})})]})}),e.jsx(U,{value:"services",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Services"}),e.jsx(S,{children:"Configure monitored services"})]}),e.jsxs(x,{onClick:ee,size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Create Service"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsxs(r,{className:"border-l-4 border-l-blue-500",children:[e.jsx(m,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(C,{variant:s.status==="active"?"default":s.status==="maintenance"?"secondary":"outline",children:s.status}),e.jsxs(C,{variant:"outline",children:[s.incidentCount||0," incidents"]})]})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>se(s.id),disabled:p.length===1,children:e.jsx(O,{className:"h-4 w-4"})})]})}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Service Name"}),e.jsx(v,{value:s.name,onChange:a=>y(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Integration Key"}),e.jsx(v,{value:s.integrationKey,onChange:a=>y(s.id,"integrationKey",a.target.value),placeholder:"integration-key"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Status"}),e.jsxs(A,{value:s.status,onValueChange:a=>y(s.id,"status",a),children:[e.jsx(T,{children:e.jsx(R,{})}),e.jsxs(E,{children:[e.jsx(g,{value:"active",children:"Active"}),e.jsx(g,{value:"maintenance",children:"Maintenance"}),e.jsx(g,{value:"disabled",children:"Disabled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Escalation Policy"}),e.jsxs(A,{value:s.escalationPolicy||"",onValueChange:a=>y(s.id,"escalationPolicy",a),children:[e.jsx(T,{children:e.jsx(R,{})}),e.jsx(E,{children:o.map(a=>e.jsx(g,{value:a.name,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{children:"Auto Resolve"}),e.jsx(V,{checked:s.autoResolve??!0,onCheckedChange:a=>y(s.id,"autoResolve",a)})]}),s.autoResolve&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Resolve Timeout (seconds)"}),e.jsx(v,{type:"number",value:s.resolveTimeout||300,onChange:a=>y(s.id,"resolveTimeout",Number(a.target.value)),min:60})]})]})})]},s.id))})})]})}),e.jsx(U,{value:"policies",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Escalation Policies"}),e.jsx(S,{children:"Configure incident escalation rules"})]}),e.jsxs(x,{onClick:te,size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Create Policy"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsxs(r,{className:"border-l-4 border-l-green-500",children:[e.jsx(m,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(c,{children:"Policy Name"}),e.jsx(v,{value:s.name,onChange:a=>ie(s.id,a.target.value)})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>ne(s.id),disabled:o.length===1,children:e.jsx(O,{className:"h-4 w-4"})})]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Se,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.levels.length," levels"]})]}),e.jsxs(x,{variant:"outline",size:"xs",onClick:()=>ce(s.id),children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Add Level"]})]}),e.jsx("div",{className:"space-y-2",children:s.levels.map((a,t)=>e.jsx(r,{className:"p-3",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-medium",children:["Level ",a.level]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>re(s.id,t),disabled:s.levels.length===1,children:e.jsx(O,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Timeout (minutes)"}),e.jsx(v,{type:"number",value:a.timeout,min:1,onChange:l=>de(s.id,t,Number(l.target.value)||0)})]}),e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Targets (on-call users)"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[f.map(l=>{const n=a.targets.includes(l.id);return e.jsx(C,{variant:n?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>oe(s.id,t,l.id),children:l.name},l.id)}),f.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"No on-call users configured"})]})]})]})]})})},t))})]})]},s.id))})})]})}),e.jsx(U,{value:"oncall",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"On-Call Roster"}),e.jsx(S,{children:"Manage who participates in on-call and their status"})]}),e.jsxs(x,{size:"sm",onClick:xe,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsx(d,{children:f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No on-call users configured. Add at least one user to use escalation policies effectively."}):e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsx(r,{className:"border-l-4 border-l-purple-500",children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Name"}),e.jsx(v,{value:s.name,onChange:a=>M(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Email"}),e.jsx(v,{value:s.email,onChange:a=>M(s.id,"email",a.target.value)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Status"}),e.jsxs(A,{value:s.status,onValueChange:a=>M(s.id,"status",a),children:[e.jsx(T,{className:"h-8 w-[140px]",children:e.jsx(R,{})}),e.jsxs(E,{children:[e.jsx(g,{value:"on-call",children:"On-Call"}),e.jsx(g,{value:"off-call",children:"Off-Call"})]})]})]}),e.jsx(C,{variant:s.status==="on-call"?"default":"outline",children:s.status==="on-call"?"On-Call":"Off-Call"})]})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>me(s.id),disabled:f.length===1,children:e.jsx(O,{className:"h-4 w-4"})})]})})},s.id))})})]})})]})]})})}export{Me as PagerDutyConfigAdvanced};
