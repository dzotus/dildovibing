import{u as Je,a as $e,j as e,g as Ze,e as qe,r as g,B as C,S as Qe,T as Ye,b as Xe,c as B,A as ee,F as ue,d as es,f as O,C as y,h as A,i as I,k as L,l as h,P as U,m as P,n as _,I as m,o as $,L as c,p as se,q as T,s as w,t as k,v as S,w as i,x as ss,D as pe,y as je,z as ge,E as fe,G as ve,H as Ne}from"./index-CK7lW0SB.js";import{P as rs}from"./progress-DDUMFohz.js";import{T as as}from"./textarea-CJ0ebXZg.js";import{T as re,a as ae,b as te,c as ie}from"./tooltip-C4xa5N9E.js";import{D as ye}from"./database-BZgG__3_.js";import{U as ne}from"./users-DhJuOUKj.js";import{S as be}from"./shield-Dv5bpRoA.js";import{R as ts}from"./refresh-ccw-DMpGPr4r.js";function us({componentId:z}){const{nodes:Ce,updateNode:Te}=Je(),{componentMetrics:we,isRunning:ce}=$e(),G=Ce.find(s=>s.id===z);if(!G)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const p=Ze(G.data.config,{}),u=p.brokers||["localhost:9092"],f=p.topics||[],E=p.consumerGroups||[],ke=p.groupId||"default-group",Se=p.clientId||"default-client",F=p.schemaRegistry||{url:"http://localhost:8081",subjects:[]},H=p.acls||[],d=qe.getKafkaRoutingEngine(z);we.get(z)?.customMetrics;const[Re,le]=g.useState({}),[Z,Ae]=g.useState(null),[Ie,q]=g.useState(!1),[Le,K]=g.useState(!1),[Pe,W]=g.useState(!1),[Q,Ge]=g.useState(null),oe=g.useRef(G);oe.current=G,g.useEffect(()=>{if(!d||!ce){le({});return}const s=()=>{if(!d)return;const o=(oe.current.data.config||{}).topics||[],t={};o.forEach(n=>{if(n?.name){const N=d.getAllPartitionMetrics(n.name);N.length>0&&(t[n.name]=N)}}),le(n=>{const N=Object.keys(n).sort().join(","),X=Object.keys(t).sort().join(",");if(N===X){let he=!1;for(const xe in t)if(JSON.stringify(n[xe])!==JSON.stringify(t[xe])){he=!0;break}if(!he)return n}return t})};s();const a=setInterval(s,1e3);return()=>clearInterval(a)},[d,ce,z]),g.useEffect(()=>{if(G&&d){const s=(p.topics||[]).map(r=>({name:r.name,partitions:r.partitions||1,replication:r.replication||1,config:r.config||{},partitionInfo:r.partitionInfo||[]})),a=(p.consumerGroups||[]).map(r=>({id:r.id,topic:r.topic,members:r.members||1,offsetStrategy:r.offsetStrategy||"latest",autoCommit:r.autoCommit!==!1}));d.initialize({brokers:p.brokers||["localhost:9092"],topics:s,consumerGroups:a})}},[p.topics,p.consumerGroups,p.brokers,z,G,d]);const[j,M]=g.useState({subjectName:"",schemaType:"AVRO",schema:""}),[l,R]=g.useState({principal:"User:",resourceType:"Topic",resourceName:"",resourcePatternType:"Literal",operation:"Read",permission:"Allow",host:"*"}),x=s=>{if(Te(z,{data:{...G.data,config:{...p,...s}}}),s.brokers!==void 0){const a={...b};a.brokers&&delete a.brokers,J(a)}},[b,J]=g.useState({}),[v,de]=g.useState({}),Fe=s=>!s||s.trim().length===0?"Topic name is required":s.length>249?"Topic name must be 249 characters or less":/^[a-zA-Z0-9][a-zA-Z0-9._-]*$/.test(s)?s==="__consumer_offsets"||s.startsWith("__")?"Topic name cannot start with double underscore (reserved for internal topics)":null:"Topic name can only contain letters, numbers, dots, underscores, and hyphens. Cannot start with dot or underscore.",ze=(s,a)=>s<1?"Replication factor must be at least 1":s>u.length?`Replication factor cannot exceed number of brokers (${u.length})`:null,Me=s=>s<1?"Number of partitions must be at least 1":s>1e4?"Number of partitions cannot exceed 10000":null,me=()=>{if(!u||u.length===0)return J({...b,brokers:"Необходимо указать хотя бы один broker"}),!1;if(u.filter(r=>{if(!r||!r.trim())return!0;const o=r.trim().split(":");if(o.length!==2)return!0;const t=parseInt(o[1]);return isNaN(t)||t<=0||t>65535}).length>0)return J({...b,brokers:"Неверный формат broker. Используйте формат host:port"}),!1;const a={...b};return a.brokers&&delete a.brokers,J(a),!0},De=()=>{x({brokers:[...u,"localhost:9093"]})},Be=s=>{x({brokers:u.filter((a,r)=>r!==s)})},Oe=(s,a)=>{const r=[...u];r[s]=a,x({brokers:r})},Ee=()=>{const s={name:"new-topic",partitions:3,replication:1,messages:0,size:0,config:{retentionMs:6048e5,cleanupPolicy:"delete",compressionType:"gzip",maxMessageBytes:1e6,minInsyncReplicas:1},partitionInfo:Array.from({length:3},(a,r)=>({id:r,leader:0,replicas:[0,1],isr:[0,1]}))};x({topics:[...f,s]}),q(!1)},Ve=s=>{x({topics:f.filter((a,r)=>r!==s)})},Y=(s,a,r)=>{const o=[...f];o[s]={...o[s],[a]:r};const t={...v[s]||{}};if(a==="name"){const n=Fe(String(r));n?t.name=n:delete t.name}else if(a==="replication"){const n=ze(Number(r));n?t.replication=n:delete t.replication}else if(a==="partitions"){const n=Me(Number(r));n?t.partitions=n:delete t.partitions}if(Object.keys(t).length>0)de({...v,[s]:t});else{const n={...v};delete n[s],de(n)}x({topics:o})},D=(s,a,r)=>{const o=[...f];o[s].config||(o[s].config={}),o[s].config={...o[s].config,[a]:r},x({topics:o})},Ue=()=>{x({consumerGroups:[...E,{id:"new-group",topic:f[0]?.name||"",lag:0,members:1,offsetStrategy:"latest",autoCommit:!0}]})},_e=s=>{x({consumerGroups:E.filter((a,r)=>r!==s)})},V=(s,a,r)=>{const o=[...E];o[s]={...o[s],[a]:r},x({consumerGroups:o})},He=()=>{if(!j.subjectName.trim()||!j.schema.trim())return;const s={name:j.subjectName.trim(),version:1,schemaType:j.schemaType,schema:j.schema.trim()};x({schemaRegistry:{...F,subjects:[...F.subjects||[],s]}}),M({subjectName:"",schemaType:"AVRO",schema:""}),K(!1)},Ke=()=>{if(!l.principal.trim()||!l.resourceName.trim())return;const s={principal:l.principal.trim(),resourceType:l.resourceType,resourceName:l.resourceName.trim(),resourcePatternType:l.resourcePatternType,operation:l.operation,permission:l.permission,host:l.host||"*"};x({acls:[...H,s]}),R({principal:"User:",resourceType:"Topic",resourceName:"",resourcePatternType:"Literal",operation:"Read",permission:"Allow",host:"*"}),W(!1)},We=s=>{x({acls:H.filter((a,r)=>r!==s)})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(ye,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Kafka Cluster"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Apache Kafka Configuration & Management"})]})]})}),e.jsxs(C,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-gray-400"}),"Configured"]})]}),e.jsx(Qe,{}),e.jsxs(Ye,{defaultValue:"brokers",className:"w-full",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-6",children:[e.jsxs(B,{value:"brokers",className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Brokers"]}),e.jsxs(B,{value:"topics",className:"gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Topics"]}),e.jsxs(B,{value:"consumers",className:"gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Consumers"]}),e.jsxs(B,{value:"schemas",className:"gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Schemas"]}),e.jsxs(B,{value:"acls",className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"ACLs"]}),e.jsxs(B,{value:"settings",className:"gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(O,{value:"brokers",className:"space-y-4 mt-4",children:e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Broker Cluster"}),e.jsx(L,{children:"Kafka broker endpoints and connection details"})]}),e.jsxs(h,{size:"sm",onClick:De,variant:"outline",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Broker"]})]})}),e.jsx(P,{children:e.jsxs("div",{className:"space-y-3",children:[u.length===0&&b.brokers&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive p-2 border border-destructive rounded",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{children:b.brokers})]}),u.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border border-border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),e.jsx(m,{value:s,onChange:r=>{Oe(a,r.target.value),b.brokers&&me()},onBlur:me,placeholder:"localhost:9092",className:`flex-1 ${b.brokers?"border-destructive":""}`}),e.jsxs(C,{variant:"secondary",children:["Broker ",a+1]})]}),u.length>1&&e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>Be(a),children:e.jsx($,{className:"h-4 w-4"})})]},a)),b.brokers&&u.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(_,{className:"h-3 w-3"}),e.jsx("span",{children:b.brokers})]})]})})]})}),e.jsxs(O,{value:"topics",className:"space-y-4 mt-4",children:[Ie&&e.jsxs(y,{className:"mb-4 border-primary",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Create New Topic"}),e.jsx(L,{children:"Configure topic settings"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Topic Name"}),e.jsx(m,{placeholder:"my-topic"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Partitions"}),e.jsx(m,{type:"number",defaultValue:3,min:1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Replication Factor"}),e.jsx(m,{type:"number",defaultValue:1,min:1,max:u.length})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:Ee,children:"Create Topic"}),e.jsx(h,{variant:"outline",onClick:()=>q(!1),children:"Cancel"})]})]})]}),e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Topics"}),e.jsx(L,{children:"Kafka topic configuration and monitoring"})]}),e.jsxs(h,{size:"sm",onClick:()=>q(!0),variant:"outline",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Create Topic"]})]})}),e.jsx(P,{children:f.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No topics configured"}),e.jsx("p",{className:"text-xs mt-2",children:'Click "Create Topic" to add a new topic'})]}):e.jsx("div",{className:"space-y-4",children:f.map((s,a)=>e.jsxs(y,{className:"border-border",children:[e.jsx(A,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(ee,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(I,{className:"text-lg",children:s.name}),e.jsxs(L,{className:"text-xs mt-1",children:[s.partitions," partitions • ",s.replication," replicas"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Ae(Z===a?null:a),children:Z===a?"Hide Config":"Show Config"}),f.length>1&&e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>Ve(a),children:e.jsx($,{className:"h-4 w-4"})})]})]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{children:"Topic Name"}),e.jsx(re,{children:e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsx(se,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsx(ie,{children:e.jsx("p",{children:"Kafka topic name. Can contain letters, numbers, dots, underscores, and hyphens. Cannot start with dot or underscore. Max 249 characters."})})]})})]}),e.jsx(m,{value:s.name,onChange:r=>Y(a,"name",r.target.value),placeholder:"topic-name",className:v[a]?.name?"border-destructive":""}),v[a]?.name&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),v[a].name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{children:"Partitions"}),e.jsx(re,{children:e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsx(se,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsx(ie,{children:e.jsx("p",{children:"Number of partitions for this topic. More partitions allow higher parallelism but increase overhead. Recommended: 1-10000."})})]})})]}),e.jsx(m,{type:"number",min:"1",value:s.partitions,onChange:r=>Y(a,"partitions",parseInt(r.target.value)||1),className:v[a]?.partitions?"border-destructive":""}),v[a]?.partitions&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),v[a].partitions]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{children:"Replication Factor"}),e.jsx(re,{children:e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsx(se,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsx(ie,{children:e.jsxs("p",{children:["Number of replicas for each partition. Must be between 1 and the number of brokers (",u.length,"). Higher replication improves durability but uses more storage."]})})]})})]}),e.jsx(m,{type:"number",min:"1",max:u.length,value:s.replication,onChange:r=>Y(a,"replication",parseInt(r.target.value)||1),className:v[a]?.replication?"border-destructive":""}),v[a]?.replication&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),v[a].replication]})]}),Z===a&&s.config&&e.jsxs("div",{className:"pt-4 border-t border-border space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Topic Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Retention (ms)"}),e.jsx(m,{type:"number",value:s.config.retentionMs||6048e5,onChange:r=>D(a,"retentionMs",parseInt(r.target.value)||0),placeholder:"604800000 (7 days)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Retention (bytes)"}),e.jsx(m,{type:"number",value:s.config.retentionBytes||-1,onChange:r=>D(a,"retentionBytes",parseInt(r.target.value)||-1),placeholder:"-1 (unlimited)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Cleanup Policy"}),e.jsxs(T,{value:s.config.cleanupPolicy||"delete",onValueChange:r=>D(a,"cleanupPolicy",r),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"delete",children:"Delete"}),e.jsx(i,{value:"compact",children:"Compact"}),e.jsx(i,{value:"delete,compact",children:"Delete, Compact"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Compression Type"}),e.jsxs(T,{value:s.config.compressionType||"gzip",onValueChange:r=>D(a,"compressionType",r),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"uncompressed",children:"Uncompressed"}),e.jsx(i,{value:"gzip",children:"Gzip"}),e.jsx(i,{value:"snappy",children:"Snappy"}),e.jsx(i,{value:"lz4",children:"LZ4"}),e.jsx(i,{value:"zstd",children:"Zstd"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Max Message Bytes"}),e.jsx(m,{type:"number",value:s.config.maxMessageBytes||1e6,onChange:r=>D(a,"maxMessageBytes",parseInt(r.target.value)||1e6)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Min In-Sync Replicas"}),e.jsx(m,{type:"number",min:"1",value:s.config.minInsyncReplicas||1,onChange:r=>D(a,"minInsyncReplicas",parseInt(r.target.value)||1)})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Partition Details"}),e.jsx("div",{className:"space-y-2",children:(()=>{const r=Re[s.name]||[],o=s.partitionInfo||[];return r.length>0?r.map(t=>{const n=t.isr.length<t.replicas.length;return t.highWatermark-t.offset,e.jsxs("div",{className:"p-3 border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-mono font-semibold",children:["Partition ",t.partitionId]}),n&&e.jsx(C,{variant:"destructive",className:"text-xs",children:"Under-replicated"}),!n&&t.isr.length===t.replicas.length&&e.jsx(C,{variant:"default",className:"text-xs bg-green-500",children:"Healthy"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Leader: ",t.leader]}),e.jsxs("span",{children:["Replicas: [",t.replicas.join(", "),"]"]}),e.jsxs("span",{children:["ISR: [",t.isr.join(", "),"]"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-xs mt-2 pt-2 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Messages:"}),e.jsx("span",{className:"ml-1 font-semibold",children:t.messages.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Size:"}),e.jsxs("span",{className:"ml-1 font-semibold",children:[(t.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Offset:"}),e.jsx("span",{className:"ml-1 font-semibold",children:t.offset})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"HW:"}),e.jsx("span",{className:"ml-1 font-semibold",children:t.highWatermark})]})]})]},t.partitionId)}):o.length>0?o.map((t,n)=>e.jsx("div",{className:"p-2 border rounded text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono",children:["Partition ",t.id]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Leader: ",t.leader]}),e.jsxs("span",{children:["Replicas: [",t.replicas.join(", "),"]"]}),e.jsxs("span",{children:["ISR: [",t.isr.join(", "),"]"]})]})]})},n)):e.jsx("div",{className:"text-sm text-muted-foreground p-2",children:"No partition information available"})})()})]}),e.jsx("div",{className:"pt-3 border-t border-border",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Messages:"}),e.jsx("span",{className:"ml-2 font-semibold",children:(()=>{if(d){const r=d.getTopicMetrics(s.name);if(r)return r.messages.toLocaleString()}return(s.messages||0).toLocaleString()})()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Size:"}),e.jsx("span",{className:"ml-2 font-semibold",children:(()=>{if(d){const r=d.getTopicMetrics(s.name);if(r)return(r.size/1024/1024).toFixed(2)+" MB"}return((s.size||0)/1024/1024).toFixed(2)+" MB"})()})]})]})})]})]},a))})})]})]}),e.jsx(O,{value:"consumers",className:"space-y-4 mt-4",children:e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Consumer Groups"}),e.jsx(L,{children:"Monitor consumer group lag and activity"})]}),e.jsxs(h,{size:"sm",onClick:Ue,variant:"outline",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Group"]})]})}),e.jsx(P,{children:E.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No consumer groups configured"})]}):e.jsx("div",{className:"space-y-3",children:E.map((s,a)=>e.jsxs(y,{className:"border-border",children:[e.jsx(A,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(I,{className:"text-lg",children:s.id}),e.jsxs(L,{className:"text-xs mt-1",children:["Topic: ",s.topic," • ",s.members||0," members"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:(d?d.getConsumerGroupLag(s.id,s.topic):s.lag||0)>1e3?"destructive":"secondary",children:["Lag: ",(()=>{if(d){const r=d.getConsumerGroupLag(s.id,s.topic);return Math.round(r)}return Math.round(s.lag||0)})()]}),d&&(()=>{const r=d.getConsumptionRate(s.id,s.topic);return r>0?e.jsxs(C,{variant:"outline",children:[Math.round(r)," msg/s"]}):null})(),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Ge(Q===a?null:a),children:Q===a?"Hide":"Edit"}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>_e(a),children:e.jsx($,{className:"h-4 w-4"})})]})]})}),e.jsx(P,{className:"space-y-4",children:Q===a?e.jsxs("div",{className:"space-y-4 pt-2 border-t border-border",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Group ID"}),e.jsx(m,{value:s.id,onChange:r=>V(a,"id",r.target.value),placeholder:"consumer-group-id"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Topic"}),e.jsxs(T,{value:s.topic,onValueChange:r=>V(a,"topic",r),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsx(S,{children:f.map(r=>e.jsx(i,{value:r.name,children:r.name},r.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Members"}),e.jsx(m,{type:"number",min:"1",value:s.members||1,onChange:r=>V(a,"members",parseInt(r.target.value)||1)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Offset Strategy"}),e.jsxs(T,{value:s.offsetStrategy||"latest",onValueChange:r=>V(a,"offsetStrategy",r),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"earliest",children:"Earliest"}),e.jsx(i,{value:"latest",children:"Latest"}),e.jsx(i,{value:"none",children:"None"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:`auto-commit-${a}`,children:"Auto Commit"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically commit offsets after consuming messages"})]}),e.jsx(ss,{id:`auto-commit-${a}`,checked:s.autoCommit!==!1,onCheckedChange:r=>V(a,"autoCommit",r)})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Members:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.members||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Offset:"}),e.jsx("span",{className:"ml-2 font-semibold capitalize",children:s.offsetStrategy||"latest"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Auto Commit:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.autoCommit!==!1?"Yes":"No"})]}),d&&(()=>{const r=d.getConsumptionRate(s.id,s.topic);return r>0?e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Consumption Rate:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[Math.round(r)," msg/s"]})]}):null})()]}),(()=>{const r=d?d.getConsumerGroupLag(s.id,s.topic):s.lag||0;return e.jsx(rs,{value:Math.min(r/1e4*100,100),className:"h-2"})})(),d&&(()=>{const r=d.getConsumerGroupState(s.id),o=r?.partitionAssignment;if(o&&o.size>0){const t=[];return o.forEach((n,N)=>{t.push({memberId:N,partitions:n})}),e.jsxs("div",{className:"pt-2 border-t border-border mt-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Partition Assignment:"}),e.jsx("div",{className:"space-y-1",children:t.map(n=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-mono",children:["Member ",n.memberId,":"]}),e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["[",n.partitions.sort((N,X)=>N-X).join(", "),"]"]})]},n.memberId))}),r?.isRebalancing&&e.jsxs(C,{variant:"outline",className:"mt-2 text-xs",children:[e.jsx(ts,{className:"h-3 w-3 mr-1 animate-spin"}),"Rebalancing..."]})]})}return null})()]})})]},a))})})]})}),e.jsx(O,{value:"schemas",className:"space-y-4 mt-4",children:e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Schema Registry"}),e.jsx(L,{children:"Avro/JSON Schema management"})]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>{M({subjectName:"",schemaType:"AVRO",schema:""}),K(!0)},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Register Schema"]})]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Schema Registry URL"}),e.jsx(m,{value:F.url||"",onChange:s=>x({schemaRegistry:{...F,url:s.target.value}}),placeholder:"http://localhost:8081"})]}),F.subjects&&F.subjects.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Registered Subjects"}),F.subjects.map((s,a)=>e.jsx(y,{className:"p-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold",children:s.name}),s.schemaType&&e.jsx(C,{variant:"outline",className:"text-xs",children:s.schemaType})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Version ",s.version]}),s.schema&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 font-mono truncate max-w-md",children:[s.schema.substring(0,100),s.schema.length>100?"...":""]})]})})},a))]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ue,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No schemas registered"})]})]})]})}),e.jsx(O,{value:"acls",className:"space-y-4 mt-4",children:e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Access Control Lists"}),e.jsx(L,{children:"Manage topic and consumer group permissions"})]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>{R({principal:"User:",resourceType:"Topic",resourceName:f[0]?.name||"",resourcePatternType:"Literal",operation:"Read",permission:"Allow",host:"*"}),W(!0)},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add ACL"]})]})}),e.jsx(P,{children:H.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(be,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No ACLs configured"})]}):e.jsx("div",{className:"space-y-3",children:H.map((s,a)=>{const r=s,o=r.resourceType||"Topic",t=r.resourceName||r.resource||"unknown",n=r.resourcePatternType||"Literal",N=r.host||"*";return e.jsx(y,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"font-semibold",children:s.principal}),e.jsx(C,{variant:s.permission==="Allow"?"default":"destructive",className:"text-xs",children:s.permission})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[o,":"]})," ",t,n!=="Literal"&&e.jsx(C,{variant:"outline",className:"ml-2 text-xs",children:n})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Operation:"})," ",s.operation,N!=="*"&&e.jsxs("span",{className:"ml-2",children:["• Host: ",N]})]})]})]}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>We(a),children:e.jsx($,{className:"h-4 w-4"})})]})},a)})})})]})}),e.jsx(O,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(y,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Client Settings"}),e.jsx(L,{children:"Consumer group and client configuration"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"group-id",children:"Consumer Group ID"}),e.jsx(m,{id:"group-id",value:ke,onChange:s=>x({groupId:s.target.value}),placeholder:"default-group"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"client-id",children:"Client ID"}),e.jsx(m,{id:"client-id",value:Se,onChange:s=>x({clientId:s.target.value}),placeholder:"default-client"})]})]})]})})]}),e.jsx(pe,{open:Le,onOpenChange:K,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(ge,{children:[e.jsx(fe,{children:"Register Schema"}),e.jsx(ve,{children:"Register a new schema in Schema Registry. The subject name typically follows the pattern: topic-name-value or topic-name-key."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Select Topic (optional)"}),e.jsxs(T,{onValueChange:s=>{M({...j,subjectName:`${s}-value`})},children:[e.jsx(w,{children:e.jsx(k,{placeholder:"Choose a topic to auto-fill subject name"})}),e.jsx(S,{children:f.map(s=>e.jsx(i,{value:s.name,children:s.name},s.name))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Selecting a topic will set subject name to: topic-name-value"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"subject-name",children:"Subject Name"}),e.jsx(m,{id:"subject-name",value:j.subjectName,onChange:s=>M({...j,subjectName:s.target.value}),placeholder:"my-topic-value"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Subject name (e.g., topic-name-value, topic-name-key). In Schema Registry, subjects are typically named as topic-name-value or topic-name-key."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"schema-type",children:"Schema Type"}),e.jsxs(T,{value:j.schemaType,onValueChange:s=>M({...j,schemaType:s}),children:[e.jsx(w,{id:"schema-type",children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"AVRO",children:"AVRO"}),e.jsx(i,{value:"JSON",children:"JSON"}),e.jsx(i,{value:"PROTOBUF",children:"PROTOBUF"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"schema-content",children:"Schema Content"}),e.jsx(as,{id:"schema-content",value:j.schema,onChange:s=>M({...j,schema:s.target.value}),placeholder:'{"type": "record", "name": "Example", "fields": [{"name": "field1", "type": "string"}]}',className:"font-mono text-sm h-48"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the schema definition in JSON format"})]})]}),e.jsxs(Ne,{children:[e.jsx(h,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),e.jsx(h,{onClick:He,disabled:!j.subjectName.trim()||!j.schema.trim(),children:"Register Schema"})]})]})}),e.jsx(pe,{open:Pe,onOpenChange:W,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(ge,{children:[e.jsx(fe,{children:"Add Access Control List (ACL)"}),e.jsx(ve,{children:"Create a new ACL rule to control access to Kafka resources. Principal format: User:username or Group:groupname"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"principal",children:"Principal"}),e.jsx(m,{id:"principal",value:l.principal,onChange:s=>R({...l,principal:s.target.value}),placeholder:"User:alice or Group:developers"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: User:username or Group:groupname"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"resource-type",children:"Resource Type"}),e.jsxs(T,{value:l.resourceType,onValueChange:s=>R({...l,resourceType:s}),children:[e.jsx(w,{id:"resource-type",children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"Topic",children:"Topic"}),e.jsx(i,{value:"Group",children:"Group"}),e.jsx(i,{value:"Cluster",children:"Cluster"}),e.jsx(i,{value:"TransactionalId",children:"TransactionalId"}),e.jsx(i,{value:"DelegationToken",children:"DelegationToken"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"resource-pattern-type",children:"Pattern Type"}),e.jsxs(T,{value:l.resourcePatternType,onValueChange:s=>R({...l,resourcePatternType:s}),children:[e.jsx(w,{id:"resource-pattern-type",children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"Literal",children:"Literal"}),e.jsx(i,{value:"Prefixed",children:"Prefixed"}),e.jsx(i,{value:"Match",children:"Match"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"resource-name",children:"Resource Name"}),e.jsx(m,{id:"resource-name",value:l.resourceName,onChange:s=>R({...l,resourceName:s.target.value}),placeholder:l.resourceType==="Topic"?"my-topic":l.resourceType==="Group"?"my-group":"resource-name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"operation",children:"Operation"}),e.jsxs(T,{value:l.operation,onValueChange:s=>R({...l,operation:s}),children:[e.jsx(w,{id:"operation",children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"Read",children:"Read"}),e.jsx(i,{value:"Write",children:"Write"}),e.jsx(i,{value:"Create",children:"Create"}),e.jsx(i,{value:"Delete",children:"Delete"}),e.jsx(i,{value:"Alter",children:"Alter"}),e.jsx(i,{value:"Describe",children:"Describe"}),e.jsx(i,{value:"AlterConfigs",children:"AlterConfigs"}),e.jsx(i,{value:"DescribeConfigs",children:"DescribeConfigs"}),e.jsx(i,{value:"ClusterAction",children:"ClusterAction"}),e.jsx(i,{value:"IdempotentWrite",children:"IdempotentWrite"}),e.jsx(i,{value:"All",children:"All"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"permission",children:"Permission"}),e.jsxs(T,{value:l.permission,onValueChange:s=>R({...l,permission:s}),children:[e.jsx(w,{id:"permission",children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(i,{value:"Allow",children:"Allow"}),e.jsx(i,{value:"Deny",children:"Deny"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"host",children:"Host (optional)"}),e.jsx(m,{id:"host",value:l.host,onChange:s=>R({...l,host:s.target.value}),placeholder:"* (all hosts)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"IP address or hostname. Use * for all hosts."})]})]}),e.jsxs(Ne,{children:[e.jsx(h,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsx(h,{onClick:Ke,disabled:!l.principal.trim()||!l.resourceName.trim(),children:"Add ACL"})]})]})})]})})}export{us as KafkaConfigAdvanced};
