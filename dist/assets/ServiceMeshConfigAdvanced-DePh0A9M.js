import{u as ds,a as os,j as e,e as ms,r as w,l as c,S as le,O as hs,I as m,_ as xs,U as us,q,s as B,t as H,v as G,w as o,C as v,h as N,i as y,W as ue,m as P,A as Ie,ab as Le,T as js,b as vs,c as Y,Y as ge,d as ps,f as Q,am as gs,k as Z,B as p,X as ne,o as K,P as re,L as t,x as je,$ as fs,a1 as Ns,a2 as ys,a3 as bs,a4 as ws,a5 as Ss,a6 as Cs,a7 as Ps,D as ce,y as de,z as oe,E as me,G as he,H as xe}from"./index-0yVPR4Zl.js";import{A as Me,b as ze,a as Oe}from"./alert-CE3qCXF9.js";import{T as fe}from"./textarea-DDJx7dm7.js";import{d as V,a as h}from"./toast-Cb-VTdp0.js";import{R as Es}from"./refresh-ccw-BqidHAae.js";import{R as Ve}from"./route-TYfz1oHF.js";import{G as $e}from"./globe-D2_F5mO6.js";import{S as Ne}from"./shield-BjxQad9w.js";function zs({componentId:ve}){const{nodes:qe,updateNode:Be}=ds(),{getComponentMetrics:He}=os(),ye=qe.find(s=>s.id===ve);if(!ye)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const n=ye.data.config||{},pe=He(ve),ee=ms.getServiceMeshRoutingEngine(ve),J=n.services||[],E=n.virtualServices||[],k=n.destinationRules||[],A=n.gateways||[],T=n.peerAuthentications||[],D=n.authorizationPolicies||[],R=n.serviceEntries||[],I=n.sidecars||[],Ge=J.length,Ue=pe?.customMetrics?.total_requests||ee?.getStats().totalRequests||0,_e=pe?.customMetrics?.total_errors||ee?.getStats().totalErrors||0,Je=Math.round(pe?.customMetrics?.average_latency||ee?.getStats().averageLatency||pe?.latency||0),[b,Se]=w.useState(""),[S,We]=w.useState("all"),[x,W]=w.useState(null),[r,L]=w.useState(null),[d,z]=w.useState(null),[g,F]=w.useState(null),[f,X]=w.useState(null),[u,U]=w.useState(null),[C,se]=w.useState(null),[O,_]=w.useState(null),Fe=w.useMemo(()=>{const s=new Set;return J.forEach(a=>a.namespace&&s.add(a.namespace)),E.forEach(a=>a.namespace&&s.add(a.namespace)),k.forEach(a=>a.namespace&&s.add(a.namespace)),A.forEach(a=>a.namespace&&s.add(a.namespace)),T.forEach(a=>a.namespace&&s.add(a.namespace)),D.forEach(a=>a.namespace&&s.add(a.namespace)),R.forEach(a=>a.namespace&&s.add(a.namespace)),I.forEach(a=>a.namespace&&s.add(a.namespace)),Array.from(s).sort()},[J,E,k,A,T,D,R,I]),ae=s=>{if(!b.trim())return s;const a=b.toLowerCase();return s.filter(i=>i.name.toLowerCase().includes(a)||i.namespace&&i.namespace.toLowerCase().includes(a))},ie=s=>S==="all"?s:s.filter(a=>a.namespace===S),Ce=w.useMemo(()=>ie(ae(J)),[J,b,S]),Pe=w.useMemo(()=>ie(ae(E)),[E,b,S]),Ee=w.useMemo(()=>ie(ae(k)),[k,b,S]),ke=w.useMemo(()=>ie(ae(A)),[A,b,S]),Ae=w.useMemo(()=>ie(ae(T)),[T,b,S]),Te=w.useMemo(()=>ie(ae(D)),[D,b,S]),De=w.useMemo(()=>ie(ae(R)),[R,b,S]),Re=w.useMemo(()=>ie(ae(I)),[I,b,S]);w.useEffect(()=>{ee&&ee.updateConfig({services:J.map(s=>({id:s.id,name:s.name,namespace:s.namespace,host:`${s.name}.${s.namespace}.svc.cluster.local`,ports:[{number:80,protocol:"HTTP"}],labels:{},requests:s.requests,errors:s.errors,latency:s.latency,pods:s.pods,healthyPods:s.healthyPods})),virtualServices:E,destinationRules:k,gateways:A,peerAuthentications:T,authorizationPolicies:D,serviceEntries:R,sidecars:I,globalConfig:{enableMTLS:n.enableMTLS,mtlsMode:n.mtlsMode,enableTracing:n.enableTracing,tracingProvider:n.tracingProvider,enableMetrics:n.enableMetrics,metricsProvider:n.metricsProvider,enableAccessLog:n.enableAccessLog,maxConnections:n.maxConnections,defaultTimeout:n.defaultTimeout,defaultRetryAttempts:n.defaultRetryAttempts,defaultLoadBalancer:n.defaultLoadBalancer}})},[ee,n,J,E,k,A,T,D,R,I]);const l=s=>{Be(ve,{data:{...ye.data,config:{...n,...s}}})},Xe=()=>{const s={id:`vs-${Date.now()}`,name:"new-virtual-service",namespace:"default",hosts:["example.com"],http:[{route:[{destination:{host:"service"},weight:100}]}]};l({virtualServices:[...E,s]}),W(s),h("Virtual Service created")},Ye=s=>{const a=E.find(i=>i.id===s);l({virtualServices:E.filter(i=>i.id!==s)}),h(`Virtual Service "${a?.name||s}" deleted`)},Qe=()=>{const s={id:`dr-${Date.now()}`,name:"new-destination-rule",namespace:"default",host:"service",subsets:[{name:"v1",labels:{version:"v1"}}]};l({destinationRules:[...k,s]}),L(s),h("Destination Rule created")},Ze=s=>{const a=k.find(i=>i.id===s);l({destinationRules:k.filter(i=>i.id!==s)}),h(`Destination Rule "${a?.name||s}" deleted`)},Ke=()=>{const s={id:`gw-${Date.now()}`,name:"new-gateway",namespace:"default",selector:{"service-mesh":"ingressgateway"},servers:[{port:{number:80,protocol:"HTTP",name:"http"},hosts:["*"]}]};l({gateways:[...A,s]}),z(s),h("Gateway created")},es=s=>{const a=A.find(i=>i.id===s);l({gateways:A.filter(i=>i.id!==s)}),h(`Gateway "${a?.name||s}" deleted`)},ss=()=>{const s={id:`pa-${Date.now()}`,name:"new-peer-authentication",namespace:"default",mtls:{mode:"PERMISSIVE"}};l({peerAuthentications:[...T,s]}),F(s),h("Peer Authentication created")},as=s=>{const a=T.find(i=>i.id===s);l({peerAuthentications:T.filter(i=>i.id!==s)}),h(`Peer Authentication "${a?.name||s}" deleted`)},is=()=>{const s={id:`ap-${Date.now()}`,name:"new-authorization-policy",namespace:"default",action:"ALLOW",rules:[]};l({authorizationPolicies:[...D,s]}),X(s),h("Authorization Policy created")},ts=s=>{const a=D.find(i=>i.id===s);l({authorizationPolicies:D.filter(i=>i.id!==s)}),h(`Authorization Policy "${a?.name||s}" deleted`)},ns=()=>{const s={id:`se-${Date.now()}`,name:"new-service-entry",namespace:"default",hosts:["external.example.com"],location:"MESH_EXTERNAL",resolution:"DNS"};l({serviceEntries:[...R,s]}),U(s),h("Service Entry created")},rs=s=>{const a=R.find(i=>i.id===s);l({serviceEntries:R.filter(i=>i.id!==s)}),h(`Service Entry "${a?.name||s}" deleted`)},ls=()=>{const s={id:`sc-${Date.now()}`,name:"new-sidecar",namespace:"default",egress:[],ingress:[]};l({sidecars:[...I,s]}),se(s),h("Sidecar created")},cs=s=>{const a=I.find(i=>i.id===s);l({sidecars:I.filter(i=>i.id!==s)}),h(`Sidecar "${a?.name||s}" deleted`)};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Service Mesh"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Traffic Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Service mesh for microservices traffic management and security"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{ee&&ee.resetStats()},title:"Reset statistics",children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),"Refresh Stats"]})})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search services, policies, rules...",value:b,onChange:s=>Se(s.target.value),className:"pl-10"}),b&&e.jsx(c,{variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>Se(""),children:e.jsx(xs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(q,{value:S,onValueChange:We,children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(H,{placeholder:"All namespaces"})}),e.jsxs(G,{children:[e.jsx(o,{value:"all",children:"All namespaces"}),Fe.map(s=>e.jsx(o,{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(v,{className:"border-l-4 border-l-blue-500 bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Services"}),e.jsx(ue,{className:"h-4 w-4 text-blue-500"})]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:Ge}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"registered"})]})})]}),e.jsxs(v,{className:"border-l-4 border-l-green-500 bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Requests"}),e.jsx(Ie,{className:"h-4 w-4 text-green-500"})]})}),e.jsx(P,{children:e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:Ue.toLocaleString()})})})]}),e.jsxs(v,{className:"border-l-4 border-l-red-500 bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Errors"}),e.jsx(Le,{className:"h-4 w-4 text-red-500"})]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:_e}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"total"})]})})]}),e.jsxs(v,{className:"border-l-4 border-l-purple-500 bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Avg Latency"}),e.jsx(Ie,{className:"h-4 w-4 text-purple-500"})]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:Je}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"ms"})]})})]})]}),e.jsxs(js,{defaultValue:"services",className:"space-y-4",children:[e.jsx("div",{className:"overflow-x-auto -mx-6 px-6 pb-2",children:e.jsxs(vs,{className:"inline-flex w-auto min-w-full sm:flex-wrap sm:min-w-0 gap-1 h-auto py-1",children:[e.jsxs(Y,{value:"services",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(ue,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Services"}),e.jsxs("span",{className:"ml-1",children:["(",J.length,")"]})]}),e.jsxs(Y,{value:"virtual-services",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Virtual Services"}),e.jsxs("span",{className:"ml-1",children:["(",E.length,")"]})]}),e.jsxs(Y,{value:"destination-rules",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(ge,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Destination Rules"}),e.jsxs("span",{className:"ml-1",children:["(",k.length,")"]})]}),e.jsxs(Y,{value:"gateways",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx($e,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Gateways"}),e.jsxs("span",{className:"ml-1",children:["(",A.length,")"]})]}),e.jsxs(Y,{value:"peer-authentication",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Peer Auth"}),e.jsxs("span",{className:"ml-1",children:["(",T.length,")"]})]}),e.jsxs(Y,{value:"authorization-policy",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Auth Policy"}),e.jsxs("span",{className:"ml-1",children:["(",D.length,")"]})]}),e.jsxs(Y,{value:"service-entry",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(ue,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Service Entry"}),e.jsxs("span",{className:"ml-1",children:["(",R.length,")"]})]}),e.jsxs(Y,{value:"sidecar",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(ge,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sidecar"}),e.jsxs("span",{className:"ml-1",children:["(",I.length,")"]})]}),e.jsxs(Y,{value:"settings",className:"whitespace-nowrap flex-shrink-0",children:[e.jsx(ps,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"})]})]})}),e.jsxs(Q,{value:"services",className:"space-y-4 mt-4",children:[e.jsxs(Me,{className:"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950/30",children:[e.jsx(gs,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsx(ze,{className:"text-blue-900 dark:text-blue-100",children:"Automatic Service Discovery"}),e.jsx(Oe,{className:"text-blue-800 dark:text-blue-200",children:"Services are automatically added to the mesh when connections are created. Create a connection from Service Mesh to any service (API, Database, Queue, etc.), and the service will be automatically registered in the mesh with the correct protocol and port."})]}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Services"}),e.jsx(Z,{children:"Registered services in the mesh"})]}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:Ce.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b||S!=="all"?"No services match the filter":"No services registered yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Создайте соединение от Service Mesh к сервису, чтобы автоматически добавить его в mesh"})]}):Ce.map(s=>e.jsxs(v,{className:"border-l-4 border-l-blue-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(ue,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(p,{variant:"outline",children:s.namespace}),s.version&&e.jsx(p,{variant:"outline",children:s.version}),e.jsxs(p,{variant:s.healthyPods===s.pods?"default":"destructive",children:[s.healthyPods||0,"/",s.pods||0," pods"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{},className:"hover:bg-primary/10",disabled:!0,title:"Service editing coming soon",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"service",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})}),e.jsx(P,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Requests:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.requests?.toLocaleString()||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Errors:"}),e.jsx("span",{className:`ml-2 font-semibold ${s.errors&&s.errors>0?"text-red-500":""}`,children:s.errors||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Latency:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[s.latency||0,"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Error Rate:"}),e.jsxs("span",{className:`ml-2 font-semibold ${s.requests&&s.errors&&s.errors/s.requests>.01?"text-red-500":""}`,children:[s.requests&&s.errors?(s.errors/s.requests*100).toFixed(2):0,"%"]})]})]})})]},s.id))})})]})]}),e.jsx(Q,{value:"virtual-services",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Virtual Services"}),e.jsx(Z,{children:"Configure traffic routing rules"})]}),e.jsxs(c,{onClick:Xe,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Virtual Service"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:Pe.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No virtual services match the filter":"No virtual services configured"}):Pe.map(s=>e.jsxs(v,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(Ve,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.hosts.map((a,i)=>e.jsx(p,{variant:"outline",className:"font-mono text-xs",children:a},i))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>W(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"virtualService",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})}),e.jsx(P,{children:s.http&&s.http.length>0&&e.jsx("div",{className:"space-y-2",children:s.http.map((a,i)=>{const j=a.route?.reduce(($,be)=>$+(be.weight||0),0)||0,M=(a.route?.length||0)>1,te=j===100||M===!1&&j<=100;return e.jsxs("div",{className:"p-3 border rounded",children:[M&&!te&&e.jsxs(Me,{className:"mb-2 border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-950/30",children:[e.jsx(Le,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),e.jsx(ze,{className:"text-yellow-900 dark:text-yellow-100 text-xs",children:"Invalid Route Weights"}),e.jsxs(Oe,{className:"text-yellow-800 dark:text-yellow-200 text-xs",children:["Route weights sum to ",j,"% (should be 100%)"]})]}),a.route&&e.jsx("div",{className:"space-y-1",children:a.route.map(($,be)=>{const we=M&&j>0?Math.round(($.weight||0)/j*100):$.weight;return e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"ml-2 font-medium",children:$.destination.host}),$.destination.subset&&e.jsx(p,{variant:"outline",className:"ml-2",children:$.destination.subset}),$.weight!==void 0&&e.jsxs(p,{variant:M&&!te?"destructive":"outline",className:"ml-2",title:M&&!te?`Actual: ${$.weight}%, Normalized: ${we}%`:void 0,children:[$.weight,"%",M&&!te&&we!==$.weight&&e.jsxs("span",{className:"ml-1 text-xs opacity-75",children:["(",we,"%)"]})]})]},be)})})]},i)})})})]},s.id))})})]})}),e.jsx(Q,{value:"destination-rules",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Destination Rules"}),e.jsx(Z,{children:"Configure traffic policies and subsets"})]}),e.jsxs(c,{onClick:Qe,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Destination Rule"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:Ee.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No destination rules match the filter":"No destination rules configured"}):Ee.map(s=>e.jsxs(v,{className:"border-l-4 border-l-purple-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx(ge,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(p,{variant:"outline",className:"font-mono text-xs",children:s.host}),s.trafficPolicy?.loadBalancer?.simple&&e.jsx(p,{variant:"outline",children:s.trafficPolicy.loadBalancer.simple})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>L(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"destinationRule",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})}),e.jsx(P,{children:s.subsets&&s.subsets.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Subsets"}),s.subsets.map((a,i)=>e.jsx("div",{className:"p-2 border rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",children:a.name}),a.labels&&Object.entries(a.labels).map(([j,M])=>e.jsxs(p,{variant:"outline",className:"text-xs",children:[j,"=",M]},j))]})},i))]})})]},s.id))})})]})}),e.jsx(Q,{value:"gateways",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Gateways"}),e.jsx(Z,{children:"Configure ingress and egress gateways"})]}),e.jsxs(c,{onClick:Ke,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Gateway"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:ke.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No gateways match the filter":"No gateways configured"}):ke.map(s=>e.jsx(v,{className:"border-l-4 border-l-cyan-500 hover:shadow-md transition-shadow bg-card",children:e.jsxs(N,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-100 dark:bg-cyan-900/30",children:e.jsx($e,{className:"h-5 w-5 text-cyan-600 dark:text-cyan-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),s.servers&&s.servers.length>0&&e.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.servers.map((a,i)=>e.jsxs(p,{variant:"outline",className:"text-xs",children:[a.port.protocol,":",a.port.number]},i))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>z(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"gateway",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})},s.id))})})]})}),e.jsx(Q,{value:"peer-authentication",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Peer Authentication"}),e.jsx(Z,{children:"Configure mTLS authentication policies"})]}),e.jsxs(c,{onClick:ss,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Peer Authentication"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:Ae.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No peer authentications match the filter":"No peer authentications configured"}):Ae.map(s=>e.jsx(v,{className:"border-l-4 border-l-orange-500 hover:shadow-md transition-shadow bg-card",children:e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(Ne,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.namespace&&e.jsx(p,{variant:"outline",children:s.namespace}),s.mtls&&e.jsxs(p,{variant:s.mtls.mode==="STRICT"?"default":"outline",children:["mTLS: ",s.mtls.mode]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>F(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"peerAuthentication",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})})},s.id))})})]})}),e.jsx(Q,{value:"authorization-policy",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Authorization Policies"}),e.jsx(Z,{children:"Configure access control policies"})]}),e.jsxs(c,{onClick:is,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Authorization Policy"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:Te.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No authorization policies match the filter":"No authorization policies configured"}):Te.map(s=>e.jsx(v,{className:"border-l-4 border-l-red-500 hover:shadow-md transition-shadow bg-card",children:e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900/30",children:e.jsx(Ne,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.namespace&&e.jsx(p,{variant:"outline",children:s.namespace}),s.action&&e.jsx(p,{variant:s.action==="DENY"?"destructive":"default",children:s.action}),s.rules&&e.jsxs(p,{variant:"outline",children:[s.rules.length," rules"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>X(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"authorizationPolicy",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})})},s.id))})})]})}),e.jsx(Q,{value:"service-entry",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Service Entries"}),e.jsx(Z,{children:"Configure external services"})]}),e.jsxs(c,{onClick:ns,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Service Entry"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:De.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No service entries match the filter":"No service entries configured"}):De.map(s=>e.jsx(v,{className:"border-l-4 border-l-teal-500 hover:shadow-md transition-shadow bg-card",children:e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-teal-100 dark:bg-teal-900/30",children:e.jsx(ue,{className:"h-5 w-5 text-teal-600 dark:text-teal-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.namespace&&e.jsx(p,{variant:"outline",children:s.namespace}),s.location&&e.jsx(p,{variant:"outline",children:s.location}),s.hosts&&s.hosts.length>0&&e.jsx(p,{variant:"outline",className:"font-mono text-xs",children:s.hosts[0]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>U(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"serviceEntry",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})})},s.id))})})]})}),e.jsx(Q,{value:"sidecar",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Sidecars"}),e.jsx(Z,{children:"Configure sidecar proxy settings"})]}),e.jsxs(c,{onClick:ls,size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Sidecar"]})]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:Re.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:b||S!=="all"?"No sidecars match the filter":"No sidecars configured"}):Re.map(s=>e.jsx(v,{className:"border-l-4 border-l-indigo-500 hover:shadow-md transition-shadow bg-card",children:e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-100 dark:bg-indigo-900/30",children:e.jsx(ge,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.namespace&&e.jsx(p,{variant:"outline",children:s.namespace}),s.egress&&e.jsxs(p,{variant:"outline",children:[s.egress.length," egress"]}),s.ingress&&e.jsxs(p,{variant:"outline",children:[s.ingress.length," ingress"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>se(s),className:"hover:bg-primary/10",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_({type:"sidecar",id:s.id,name:s.name}),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]})]})})},s.id))})})]})}),e.jsx(Q,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Service Mesh Settings"}),e.jsx(Z,{children:"Service mesh configuration"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Enable mTLS"}),e.jsx(je,{checked:n.enableMTLS??!0,onCheckedChange:s=>l({enableMTLS:s})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"mTLS Mode"}),e.jsxs(q,{value:n.mtlsMode??"PERMISSIVE",onValueChange:s=>l({mtlsMode:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"STRICT",children:"STRICT - mTLS required"}),e.jsx(o,{value:"PERMISSIVE",children:"PERMISSIVE - mTLS optional"}),e.jsx(o,{value:"DISABLE",children:"DISABLE - no mTLS"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Enable Tracing"}),e.jsx(je,{checked:n.enableTracing??!0,onCheckedChange:s=>l({enableTracing:s})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Tracing Provider"}),e.jsxs(q,{value:n.tracingProvider??"jaeger",onValueChange:s=>l({tracingProvider:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"jaeger",children:"Jaeger"}),e.jsx(o,{value:"zipkin",children:"Zipkin"}),e.jsx(o,{value:"datadog",children:"Datadog"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Enable Metrics"}),e.jsx(je,{checked:n.enableMetrics??!0,onCheckedChange:s=>l({enableMetrics:s})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Metrics Provider"}),e.jsxs(q,{value:n.metricsProvider??"prometheus",onValueChange:s=>l({metricsProvider:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"prometheus",children:"Prometheus"}),e.jsx(o,{value:"statsd",children:"StatsD"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Enable Access Log"}),e.jsx(je,{checked:n.enableAccessLog??!0,onCheckedChange:s=>l({enableAccessLog:s})})]}),e.jsx(le,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Default Load Balancer"}),e.jsxs(q,{value:n.defaultLoadBalancer??"ROUND_ROBIN",onValueChange:s=>l({defaultLoadBalancer:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"ROUND_ROBIN",children:"Round Robin"}),e.jsx(o,{value:"LEAST_CONN",children:"Least Connections"}),e.jsx(o,{value:"RANDOM",children:"Random"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Max Connections"}),e.jsx(m,{type:"number",value:n.maxConnections??1e4,onChange:s=>l({maxConnections:parseInt(s.target.value)||1e4}),min:1,max:1e5})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:'Default Timeout (e.g., "30s")'}),e.jsx(m,{value:n.defaultTimeout??"30s",onChange:s=>l({defaultTimeout:s.target.value}),placeholder:"30s"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Default Retry Attempts"}),e.jsx(m,{type:"number",value:n.defaultRetryAttempts??3,onChange:s=>l({defaultRetryAttempts:parseInt(s.target.value)||3}),min:0,max:10})]}),e.jsx(le,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Enable Metrics Export"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Export Service Mesh metrics for Prometheus scraping"})]}),e.jsx(je,{checked:n.metrics?.enabled??!0,onCheckedChange:s=>l({metrics:{...n.metrics,enabled:s,controlPlanePort:n.metrics?.controlPlanePort||15014,sidecarPort:n.metrics?.sidecarPort||15090,gatewayPort:n.metrics?.gatewayPort||15020}})})]}),n.metrics?.enabled!==!1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Control Plane Metrics Port"}),e.jsx(m,{type:"number",value:n.metrics?.controlPlanePort??15014,onChange:s=>l({metrics:{...n.metrics,controlPlanePort:parseInt(s.target.value)||15014,sidecarPort:n.metrics?.sidecarPort||15090,gatewayPort:n.metrics?.gatewayPort||15020}}),min:1024,max:65535}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Control plane metrics endpoint: :15014/metrics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Sidecar Metrics Port (Envoy)"}),e.jsx(m,{type:"number",value:n.metrics?.sidecarPort??15090,onChange:s=>l({metrics:{...n.metrics,sidecarPort:parseInt(s.target.value)||15090,controlPlanePort:n.metrics?.controlPlanePort||15014,gatewayPort:n.metrics?.gatewayPort||15020}}),min:1024,max:65535}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoy sidecar metrics endpoint: :15090/stats/prometheus"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Gateway Metrics Port"}),e.jsx(m,{type:"number",value:n.metrics?.gatewayPort??15020,onChange:s=>l({metrics:{...n.metrics,gatewayPort:parseInt(s.target.value)||15020,controlPlanePort:n.metrics?.controlPlanePort||15014,sidecarPort:n.metrics?.sidecarPort||15090}}),min:1024,max:65535}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gateway metrics endpoint: :15020/stats/prometheus"})]})]})]})]})]})})]}),e.jsx(fs,{open:!!O,onOpenChange:s=>!s&&_(null),children:e.jsxs(Ns,{children:[e.jsxs(ys,{children:[e.jsx(bs,{children:"Confirm Deletion"}),e.jsxs(ws,{children:["Are you sure you want to delete ",e.jsx("strong",{children:O?.name}),"? This action cannot be undone."]})]}),e.jsxs(Ss,{children:[e.jsx(Cs,{children:"Cancel"}),e.jsx(Ps,{onClick:()=>{if(O){switch(O.type){case"service":l({services:J.filter(s=>s.id!==O.id)});break;case"virtualService":Ye(O.id);break;case"destinationRule":Ze(O.id);break;case"gateway":es(O.id);break;case"peerAuthentication":as(O.id);break;case"authorizationPolicy":ts(O.id);break;case"serviceEntry":rs(O.id);break;case"sidecar":cs(O.id);break}_(null)}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ce,{open:!!x,onOpenChange:s=>!s&&W(null),children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:E.find(s=>s.id===x?.id)?"Edit Virtual Service":"Create Virtual Service"}),e.jsx(he,{children:E.find(s=>s.id===x?.id)?"Update virtual service configuration":"Configure a new virtual service for traffic routing"})]}),x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:x.name,onChange:s=>W({...x,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:x.namespace||"default",onChange:s=>W({...x,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Hosts (comma-separated)"}),e.jsx(m,{value:x.hosts.join(", "),onChange:s=>W({...x,hosts:s.target.value.split(",").map(a=>a.trim()).filter(a=>a)}),placeholder:"example.com, *.example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Gateways (comma-separated, optional)"}),e.jsx(m,{value:x.gateways?.join(", ")||"",onChange:s=>W({...x,gateways:s.target.value?s.target.value.split(",").map(a=>a.trim()).filter(a=>a):void 0}),placeholder:"gateway-name"})]})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>W(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(x){if(!x.name||x.name.trim()===""){V("Name is required");return}if(!x.hosts||x.hosts.length===0){V("At least one host is required");return}if(x.http){for(const a of x.http)if(a.route&&a.route.length>1){const i=a.route.reduce((j,M)=>j+(M.weight||0),0);if(i!==100){V(`Route weights must sum to 100% (currently ${i}%)`);return}}}if(E.findIndex(a=>a.id===x.id)>=0){const a=E.map(i=>i.id===x.id?x:i);l({virtualServices:a}),h(`Virtual Service "${x.name}" updated`)}else l({virtualServices:[...E,x]}),h(`Virtual Service "${x.name}" created`);W(null)}},children:"Save"})]})]})}),e.jsx(ce,{open:!!r,onOpenChange:s=>!s&&L(null),children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:k.find(s=>s.id===r?.id)?"Edit Destination Rule":"Create Destination Rule"}),e.jsx(he,{children:k.find(s=>s.id===r?.id)?"Update destination rule configuration":"Configure a new destination rule for traffic policies"})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:r.name,onChange:s=>L({...r,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:r.namespace||"default",onChange:s=>L({...r,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Host"}),e.jsx(m,{value:r.host,onChange:s=>L({...r,host:s.target.value}),placeholder:"service.namespace.svc.cluster.local"})]}),e.jsx(le,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(t,{className:"text-base font-semibold",children:"Traffic Policy"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Load Balancer"}),e.jsxs(q,{value:r.trafficPolicy?.loadBalancer?.simple||"ROUND_ROBIN",onValueChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,loadBalancer:{simple:s}}}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"ROUND_ROBIN",children:"Round Robin"}),e.jsx(o,{value:"LEAST_CONN",children:"Least Connections"}),e.jsx(o,{value:"RANDOM",children:"Random"})]})]})]}),e.jsx(le,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(t,{className:"text-sm font-semibold",children:"Connection Pool"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Max Connections"}),e.jsx(m,{type:"number",value:r.trafficPolicy?.connectionPool?.tcp?.maxConnections||"",onChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,connectionPool:{...r.trafficPolicy?.connectionPool,tcp:{...r.trafficPolicy?.connectionPool?.tcp,maxConnections:s.target.value?parseInt(s.target.value):void 0}}}}),placeholder:"100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:'Connect Timeout (e.g., "30s")'}),e.jsx(m,{value:r.trafficPolicy?.connectionPool?.tcp?.connectTimeout||"",onChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,connectionPool:{...r.trafficPolicy?.connectionPool,tcp:{...r.trafficPolicy?.connectionPool?.tcp,connectTimeout:s.target.value||void 0}}}}),placeholder:"30s"})]})]})]}),e.jsx(le,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(t,{className:"text-sm font-semibold",children:"Outlier Detection (Circuit Breaker)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Consecutive Errors"}),e.jsx(m,{type:"number",value:r.trafficPolicy?.outlierDetection?.consecutiveErrors||"",onChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,outlierDetection:{...r.trafficPolicy?.outlierDetection,consecutiveErrors:s.target.value?parseInt(s.target.value):void 0}}}),placeholder:"5"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of errors before circuit breaker opens"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:'Base Ejection Time (e.g., "30s")'}),e.jsx(m,{value:r.trafficPolicy?.outlierDetection?.baseEjectionTime||"",onChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,outlierDetection:{...r.trafficPolicy?.outlierDetection,baseEjectionTime:s.target.value||void 0}}}),placeholder:"30s"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time before retrying after circuit breaker opens"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:'Interval (e.g., "10s")'}),e.jsx(m,{value:r.trafficPolicy?.outlierDetection?.interval||"",onChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,outlierDetection:{...r.trafficPolicy?.outlierDetection,interval:s.target.value||void 0}}}),placeholder:"10s"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Max Ejection Percent"}),e.jsx(m,{type:"number",min:"0",max:"100",value:r.trafficPolicy?.outlierDetection?.maxEjectionPercent||"",onChange:s=>L({...r,trafficPolicy:{...r.trafficPolicy,outlierDetection:{...r.trafficPolicy?.outlierDetection,maxEjectionPercent:s.target.value?parseInt(s.target.value):void 0}}}),placeholder:"50"})]})]})]})]})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>L(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(r){if(!r.name||r.name.trim()===""){V("Name is required");return}if(!r.host||r.host.trim()===""){V("Host is required");return}if(k.findIndex(a=>a.id===r.id)>=0){const a=k.map(i=>i.id===r.id?r:i);l({destinationRules:a}),h(`Destination Rule "${r.name}" updated`)}else l({destinationRules:[...k,r]}),h(`Destination Rule "${r.name}" created`);L(null)}},children:"Save"})]})]})}),e.jsx(ce,{open:!!d,onOpenChange:s=>!s&&z(null),children:e.jsxs(de,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:A.find(s=>s.id===d?.id)?"Edit Gateway":"Create Gateway"}),e.jsx(he,{children:A.find(s=>s.id===d?.id)?"Update gateway configuration":"Configure a new gateway for ingress or egress traffic"})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:d.name,onChange:s=>z({...d,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:d.namespace||"default",onChange:s=>z({...d,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Selector (JSON format)"}),e.jsx(fe,{value:JSON.stringify(d.selector||{},null,2),onChange:s=>{try{const a=JSON.parse(s.target.value);z({...d,selector:a})}catch{}},placeholder:'{"istio": "ingressgateway"}',className:"font-mono text-sm"})]}),e.jsx(le,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{className:"text-base font-semibold",children:"Servers"}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>{const s={port:{number:80,protocol:"HTTP",name:"http"},hosts:["*"]};z({...d,servers:[...d.servers||[],s]})},children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Server"]})]}),!d.servers||d.servers.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No servers configured. Add a server to define ports and hosts."}):e.jsx("div",{className:"space-y-4",children:d.servers.map((s,a)=>e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(t,{className:"text-sm font-semibold",children:["Server ",a+1]}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const i=d.servers?.filter((j,M)=>M!==a)||[];z({...d,servers:i})},children:e.jsx(K,{className:"h-4 w-4 text-destructive"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Port Number"}),e.jsx(m,{type:"number",value:s.port.number,onChange:i=>{const j=[...d.servers||[]];j[a]={...s,port:{...s.port,number:parseInt(i.target.value)||80}},z({...d,servers:j})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Protocol"}),e.jsxs(q,{value:s.port.protocol,onValueChange:i=>{const j=[...d.servers||[]];j[a]={...s,port:{...s.port,protocol:i}},z({...d,servers:j})},children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"HTTP",children:"HTTP"}),e.jsx(o,{value:"HTTPS",children:"HTTPS"}),e.jsx(o,{value:"TCP",children:"TCP"}),e.jsx(o,{value:"TLS",children:"TLS"}),e.jsx(o,{value:"GRPC",children:"gRPC"}),e.jsx(o,{value:"HTTP2",children:"HTTP2"}),e.jsx(o,{value:"MONGO",children:"MongoDB"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Port Name"}),e.jsx(m,{value:s.port.name||"",onChange:i=>{const j=[...d.servers||[]];j[a]={...s,port:{...s.port,name:i.target.value}},z({...d,servers:j})},placeholder:"http"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Hosts (comma-separated)"}),e.jsx(m,{value:s.hosts.join(", "),onChange:i=>{const j=i.target.value.split(",").map(te=>te.trim()).filter(te=>te),M=[...d.servers||[]];M[a]={...s,hosts:j},z({...d,servers:M})},placeholder:"*, example.com, *.example.com"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use * for all hosts, or specify domain names"})]})]})]},a))})]})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>z(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(d){if(!d.name||d.name.trim()===""){V("Name is required");return}if(!d.servers||d.servers.length===0){V("At least one server is required");return}if(A.findIndex(a=>a.id===d.id)>=0){const a=A.map(i=>i.id===d.id?d:i);l({gateways:a}),h(`Gateway "${d.name}" updated`)}else l({gateways:[...A,d]}),h(`Gateway "${d.name}" created`);z(null)}},children:"Save"})]})]})}),e.jsx(ce,{open:!!g,onOpenChange:s=>!s&&F(null),children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:T.find(s=>s.id===g?.id)?"Edit Peer Authentication":"Create Peer Authentication"}),e.jsx(he,{children:T.find(s=>s.id===g?.id)?"Update mTLS authentication policy":"Configure a new mTLS authentication policy"})]}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:g.name,onChange:s=>F({...g,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:g.namespace||"default",onChange:s=>F({...g,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"mTLS Mode"}),e.jsxs(q,{value:g.mtls?.mode||"PERMISSIVE",onValueChange:s=>F({...g,mtls:{mode:s}}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"STRICT",children:"STRICT - mTLS required"}),e.jsx(o,{value:"PERMISSIVE",children:"PERMISSIVE - mTLS optional"}),e.jsx(o,{value:"DISABLE",children:"DISABLE - no mTLS"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Selector (JSON format, optional)"}),e.jsx(fe,{value:JSON.stringify(g.selector?.matchLabels||{},null,2),onChange:s=>{try{const a=JSON.parse(s.target.value);F({...g,selector:{matchLabels:a}})}catch{}},placeholder:'{"app": "myapp"}',className:"font-mono text-sm"})]})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>F(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(g){if(!g.name||g.name.trim()===""){V("Name is required");return}if(T.findIndex(a=>a.id===g.id)>=0){const a=T.map(i=>i.id===g.id?g:i);l({peerAuthentications:a}),h(`Peer Authentication "${g.name}" updated`)}else l({peerAuthentications:[...T,g]}),h(`Peer Authentication "${g.name}" created`);F(null)}},children:"Save"})]})]})}),e.jsx(ce,{open:!!f,onOpenChange:s=>!s&&X(null),children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:D.find(s=>s.id===f?.id)?"Edit Authorization Policy":"Create Authorization Policy"}),e.jsx(he,{children:D.find(s=>s.id===f?.id)?"Update access control policy":"Configure a new access control policy"})]}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:f.name,onChange:s=>X({...f,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:f.namespace||"default",onChange:s=>X({...f,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Action"}),e.jsxs(q,{value:f.action||"ALLOW",onValueChange:s=>X({...f,action:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"ALLOW",children:"ALLOW - Allow access"}),e.jsx(o,{value:"DENY",children:"DENY - Deny access"}),e.jsx(o,{value:"AUDIT",children:"AUDIT - Audit only"}),e.jsx(o,{value:"CUSTOM",children:"CUSTOM - Custom action"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Selector (JSON format, optional)"}),e.jsx(fe,{value:JSON.stringify(f.selector?.matchLabels||{},null,2),onChange:s=>{try{const a=JSON.parse(s.target.value);X({...f,selector:{matchLabels:a}})}catch{}},placeholder:'{"app": "myapp"}',className:"font-mono text-sm"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("p",{children:"Rules can be configured in advanced mode. Basic configuration allows setting action and selector."})})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>X(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(f){if(!f.name||f.name.trim()===""){V("Name is required");return}if(D.findIndex(a=>a.id===f.id)>=0){const a=D.map(i=>i.id===f.id?f:i);l({authorizationPolicies:a}),h(`Authorization Policy "${f.name}" updated`)}else l({authorizationPolicies:[...D,f]}),h(`Authorization Policy "${f.name}" created`);X(null)}},children:"Save"})]})]})}),e.jsx(ce,{open:!!u,onOpenChange:s=>!s&&U(null),children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:R.find(s=>s.id===u?.id)?"Edit Service Entry":"Create Service Entry"}),e.jsx(he,{children:R.find(s=>s.id===u?.id)?"Update external service configuration":"Configure a new external service entry"})]}),u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:u.name,onChange:s=>U({...u,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:u.namespace||"default",onChange:s=>U({...u,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Hosts (comma-separated)"}),e.jsx(m,{value:u.hosts?.join(", ")||"",onChange:s=>U({...u,hosts:s.target.value.split(",").map(a=>a.trim()).filter(a=>a)}),placeholder:"external.example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Location"}),e.jsxs(q,{value:u.location||"MESH_EXTERNAL",onValueChange:s=>U({...u,location:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"MESH_EXTERNAL",children:"MESH_EXTERNAL - External to mesh"}),e.jsx(o,{value:"MESH_INTERNAL",children:"MESH_INTERNAL - Internal to mesh"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Resolution"}),e.jsxs(q,{value:u.resolution||"DNS",onValueChange:s=>U({...u,resolution:s}),children:[e.jsx(B,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"DNS",children:"DNS - DNS resolution"}),e.jsx(o,{value:"STATIC",children:"STATIC - Static IPs"}),e.jsx(o,{value:"NONE",children:"NONE - No resolution"})]})]})]})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>U(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(u){if(!u.name||u.name.trim()===""){V("Name is required");return}if(!u.hosts||u.hosts.length===0){V("At least one host is required");return}if(R.findIndex(a=>a.id===u.id)>=0){const a=R.map(i=>i.id===u.id?u:i);l({serviceEntries:a}),h(`Service Entry "${u.name}" updated`)}else l({serviceEntries:[...R,u]}),h(`Service Entry "${u.name}" created`);U(null)}},children:"Save"})]})]})}),e.jsx(ce,{open:!!C,onOpenChange:s=>!s&&se(null),children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(me,{children:I.find(s=>s.id===C?.id)?"Edit Sidecar":"Create Sidecar"}),e.jsx(he,{children:I.find(s=>s.id===C?.id)?"Update sidecar proxy settings":"Configure a new sidecar proxy"})]}),C&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Name"}),e.jsx(m,{value:C.name,onChange:s=>se({...C,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Namespace"}),e.jsx(m,{value:C.namespace||"default",onChange:s=>se({...C,namespace:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Selector (JSON format, optional)"}),e.jsx(fe,{value:JSON.stringify(C.workloadSelector?.labels||{},null,2),onChange:s=>{try{const a=JSON.parse(s.target.value);se({...C,workloadSelector:{labels:a}})}catch{}},placeholder:'{"app": "myapp"}',className:"font-mono text-sm"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("p",{children:"Egress and Ingress settings can be configured in advanced mode. Basic configuration allows setting selector."})})]}),e.jsxs(xe,{children:[e.jsx(c,{variant:"outline",onClick:()=>se(null),children:"Cancel"}),e.jsx(c,{onClick:()=>{if(C){if(!C.name||C.name.trim()===""){V("Name is required");return}if(I.findIndex(a=>a.id===C.id)>=0){const a=I.map(i=>i.id===C.id?C:i);l({sidecars:a}),h(`Sidecar "${C.name}" updated`)}else l({sidecars:[...I,C]}),h(`Sidecar "${C.name}" created`);se(null)}},children:"Save"})]})]})})]})})}export{zs as ServiceMeshConfigAdvanced};
