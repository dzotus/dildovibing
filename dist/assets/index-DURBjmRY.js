const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KafkaConfigAdvanced-DBBQe9qC.js","assets/progress-zic0tlUZ.js","assets/textarea-XEi4bLpn.js","assets/database-wzqVxBa7.js","assets/users-CaqlMbLn.js","assets/shield-DRkEvSf_.js","assets/RabbitMQConfigAdvanced-C1d8RQ9u.js","assets/usePortValidation-D_Qdqxzp.js","assets/requiredFields-BLgUUVkB.js","assets/toast-BAWJqUf4.js","assets/message-square-KQyAye_1.js","assets/arrow-right-left-BSMaw3bJ.js","assets/key-DF5LgBwo.js","assets/PostgreSQLConfigAdvanced-BFIVu_4k.js","assets/file-code-BLl7dTHG.js","assets/table-DZq7b-ZX.js","assets/MongoDBConfigAdvanced-CseyRXpR.js","assets/RedisConfigAdvanced-DyCm2fhT.js","assets/terminal-Rm1lGo_S.js","assets/ElasticsearchConfigAdvanced-CsPESOGm.js","assets/refresh-ccw-sggz22ww.js","assets/code-B9iCMTpj.js","assets/CassandraConfigAdvanced-DKc2wWaO.js","assets/ClickHouseConfigAdvanced-2LkaLoOJ.js","assets/chart-column-Sh-WOu50.js","assets/SnowflakeConfigAdvanced-BRaeV9yi.js","assets/S3DataLakeConfigAdvanced-D7SGWMh3.js","assets/folder-DVsNKUPF.js","assets/NginxConfigAdvanced-KGoGuud5.js","assets/use-toast-xcIxNTXl.js","assets/globe-WqZozEv_.js","assets/server-NDwJ4nd7.js","assets/RestApiConfigAdvanced-CBVhF6Kk.js","assets/index-DuDu8RdG.js","assets/trending-up-CLzJfLNb.js","assets/clock-MJIL643Q.js","assets/GRPCConfigAdvanced-BD-VIugm.js","assets/circle-check-big-B1dsCsWQ.js","assets/WebSocketConfigAdvanced-3Z-zTRfT.js","assets/send-pnnJHIo-.js","assets/bell-_4gf20Gt.js","assets/pen-D30ivbmt.js","assets/GraphQLConfigAdvanced-B1ObwlCF.js","assets/SOAPConfigAdvanced-DJ5CY4zC.js","assets/WebhookConfigAdvanced-BHLPeGkI.js","assets/tooltip-DeGf2w9v.js","assets/webhook-CvLZST_h.js","assets/LineChart-Cb1fwBEq.js","assets/AreaChart-CKB40ndo.js","assets/loader-circle-DmkE9KBo.js","assets/DockerK8sConfigAdvanced-rRwydtTR.js","assets/alert-CTSsnaKJ.js","assets/hard-drive-Dh8nNAOZ.js","assets/InfrastructureConfig-AIJd4-dd.js","assets/KubernetesConfigAdvanced-BihVehn2.js","assets/HAProxyConfigAdvanced-q3NxUU2W.js","assets/TraefikConfigAdvanced-DYqq7eoj.js","assets/route-BRpDWzWI.js","assets/EnvoyConfigAdvanced-DHK1oHPN.js","assets/ActiveMQConfigAdvanced-COQSKn1E.js","assets/AWSSQSConfigAdvanced-Dac8pxwE.js","assets/cloud-DRf5FL0P.js","assets/AzureServiceBusConfigAdvanced-CtFGwilA.js","assets/GCPPubSubConfigAdvanced-DHGc6Kg7.js","assets/KongConfigAdvanced-BqOJbMwP.js","assets/ApigeeConfigAdvanced-D1axFas0.js","assets/MuleSoftConfigAdvanced-Cr97L_eA.js","assets/GraphQLGatewayConfigAdvanced-CyZUFkIo.js","assets/BFFServiceConfigAdvanced-CWBA0KKe.js","assets/WebhookRelayConfigAdvanced-CS1B1PnY.js","assets/PrometheusConfigAdvanced-JKn_kOTV.js","assets/GrafanaConfigAdvanced-BBpv7EME.js","assets/BarChart-Cii2TxAj.js","assets/LokiConfigAdvanced-BPG1gAhu.js","assets/JaegerConfigAdvanced-Bz-BYrz6.js","assets/git-branch-CFQvykux.js","assets/OpenTelemetryCollectorConfigAdvanced-YW7GCkK3.js","assets/PagerDutyConfigAdvanced-B7up574-.js","assets/KeycloakConfigAdvanced-CjEHMAMi.js","assets/lock-1EDYZlAR.js","assets/mail-BL5je61v.js","assets/eye-off-BoqExHrY.js","assets/WAFConfigAdvanced-riPlqZN-.js","assets/SecretsVaultConfigAdvanced-FJY9L6IF.js","assets/IDSIPSConfigAdvanced-DgkNhfjH.js","assets/FirewallConfigAdvanced-2GjTzR6M.js","assets/JenkinsConfigAdvanced-BeLrkZqM.js","assets/package-BKsKmXzy.js","assets/GitLabCIConfigAdvanced-Su2RjTvi.js","assets/calendar-NNgKREBQ.js","assets/ArgoCDConfigAdvanced-DgTIZvI0.js","assets/folder-git-2-CxRfV3N6.js","assets/HarborConfigAdvanced-C8FtAHfr.js","assets/TerraformConfigAdvanced-BaXadPJn.js","assets/AnsibleConfigAdvanced-BBIgKuBq.js","assets/IstioConfigAdvanced-DAfSfxAw.js","assets/ServiceMeshConfigAdvanced-BWdWaXA6.js","assets/APIGatewayConfigAdvanced-BtGuDEiB.js","assets/VPNConfigAdvanced-DkduuzOi.js","assets/CDNConfigAdvanced-DMKWTKIJ.js","assets/SparkConfigAdvanced-B3qd8QQX.js","assets/TensorFlowServingConfigAdvanced-CgXI8caj.js","assets/PyTorchServeConfigAdvanced-NqOp9zxf.js","assets/FeatureStoreConfigAdvanced-DerSXJ50.js","assets/CRMConfigAdvanced-Bwyx7zog.js","assets/dollar-sign-D2ZjpCvj.js","assets/building-CqPIjKzX.js","assets/ERPConfigAdvanced-Dgw6tJY8.js","assets/RPABotConfigAdvanced-MsWa7WOm.js","assets/BPMNEngineConfigAdvanced-BeenqPqi.js","assets/PaymentGatewayConfigAdvanced-B4O88Bjb.js"])))=>i.map(i=>d[i]);
function SR(c,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in c)){const i=Object.getOwnPropertyDescriptor(s,n);i&&Object.defineProperty(c,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();var y3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qf(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Fh={exports:{}},xr={};var I0;function CR(){if(I0)return xr;I0=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,n,i){var o=null;if(i!==void 0&&(o=""+i),n.key!==void 0&&(o=""+n.key),"key"in n){i={};for(var r in n)r!=="key"&&(i[r]=n[r])}else i=n;return n=i.ref,{$$typeof:c,type:s,key:o,ref:n!==void 0?n:null,props:i}}return xr.Fragment=t,xr.jsx=e,xr.jsxs=e,xr}var N0;function RR(){return N0||(N0=1,Fh.exports=CR()),Fh.exports}var y=RR(),Qh={exports:{}},ze={};var z0;function ER(){if(z0)return ze;z0=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function v(N){return N===null||typeof N!="object"?null:(N=g&&N[g]||N["@@iterator"],typeof N=="function"?N:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,R={};function C(N,F,K){this.props=N,this.context=F,this.refs=R,this.updater=K||b}C.prototype.isReactComponent={},C.prototype.setState=function(N,F){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,F,"setState")},C.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function k(){}k.prototype=C.prototype;function T(N,F,K){this.props=N,this.context=F,this.refs=R,this.updater=K||b}var A=T.prototype=new k;A.constructor=T,x(A,C.prototype),A.isPureReactComponent=!0;var D=Array.isArray;function _(){}var L={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function X(N,F,K){var ie=K.ref;return{$$typeof:c,type:N,key:F,ref:ie!==void 0?ie:null,props:K}}function te(N,F){return X(N.type,F,N.props)}function ce(N){return typeof N=="object"&&N!==null&&N.$$typeof===c}function Z(N){var F={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(K){return F[K]})}var se=/\/+/g;function le(N,F){return typeof N=="object"&&N!==null&&N.key!=null?Z(""+N.key):F.toString(36)}function ue(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(_,_):(N.status="pending",N.then(function(F){N.status==="pending"&&(N.status="fulfilled",N.value=F)},function(F){N.status==="pending"&&(N.status="rejected",N.reason=F)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function z(N,F,K,ie,U){var oe=typeof N;(oe==="undefined"||oe==="boolean")&&(N=null);var B=!1;if(N===null)B=!0;else switch(oe){case"bigint":case"string":case"number":B=!0;break;case"object":switch(N.$$typeof){case c:case t:B=!0;break;case h:return B=N._init,z(B(N._payload),F,K,ie,U)}}if(B)return U=U(N),B=ie===""?"."+le(N,0):ie,D(U)?(K="",B!=null&&(K=B.replace(se,"$&/")+"/"),z(U,F,K,"",function(me){return me})):U!=null&&(ce(U)&&(U=te(U,K+(U.key==null||N&&N.key===U.key?"":(""+U.key).replace(se,"$&/")+"/")+B)),F.push(U)),1;B=0;var G=ie===""?".":ie+":";if(D(N))for(var pe=0;pe<N.length;pe++)ie=N[pe],oe=G+le(ie,pe),B+=z(ie,F,K,oe,U);else if(pe=v(N),typeof pe=="function")for(N=pe.call(N),pe=0;!(ie=N.next()).done;)ie=ie.value,oe=G+le(ie,pe++),B+=z(ie,F,K,oe,U);else if(oe==="object"){if(typeof N.then=="function")return z(ue(N),F,K,ie,U);throw F=String(N),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return B}function I(N,F,K){if(N==null)return N;var ie=[],U=0;return z(N,ie,"","",function(oe){return F.call(K,oe,U++)}),ie}function q(N){if(N._status===-1){var F=N._result;F=F(),F.then(function(K){(N._status===0||N._status===-1)&&(N._status=1,N._result=K)},function(K){(N._status===0||N._status===-1)&&(N._status=2,N._result=K)}),N._status===-1&&(N._status=0,N._result=F)}if(N._status===1)return N._result.default;throw N._result}var Y=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",N);return}console.error(N)},fe={map:I,forEach:function(N,F,K){I(N,function(){F.apply(this,arguments)},K)},count:function(N){var F=0;return I(N,function(){F++}),F},toArray:function(N){return I(N,function(F){return F})||[]},only:function(N){if(!ce(N))throw Error("React.Children.only expected to receive a single React element child.");return N}};return ze.Activity=p,ze.Children=fe,ze.Component=C,ze.Fragment=e,ze.Profiler=n,ze.PureComponent=T,ze.StrictMode=s,ze.Suspense=u,ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,ze.__COMPILER_RUNTIME={__proto__:null,c:function(N){return L.H.useMemoCache(N)}},ze.cache=function(N){return function(){return N.apply(null,arguments)}},ze.cacheSignal=function(){return null},ze.cloneElement=function(N,F,K){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var ie=x({},N.props),U=N.key;if(F!=null)for(oe in F.key!==void 0&&(U=""+F.key),F)!O.call(F,oe)||oe==="key"||oe==="__self"||oe==="__source"||oe==="ref"&&F.ref===void 0||(ie[oe]=F[oe]);var oe=arguments.length-2;if(oe===1)ie.children=K;else if(1<oe){for(var B=Array(oe),G=0;G<oe;G++)B[G]=arguments[G+2];ie.children=B}return X(N.type,U,ie)},ze.createContext=function(N){return N={$$typeof:o,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:i,_context:N},N},ze.createElement=function(N,F,K){var ie,U={},oe=null;if(F!=null)for(ie in F.key!==void 0&&(oe=""+F.key),F)O.call(F,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(U[ie]=F[ie]);var B=arguments.length-2;if(B===1)U.children=K;else if(1<B){for(var G=Array(B),pe=0;pe<B;pe++)G[pe]=arguments[pe+2];U.children=G}if(N&&N.defaultProps)for(ie in B=N.defaultProps,B)U[ie]===void 0&&(U[ie]=B[ie]);return X(N,oe,U)},ze.createRef=function(){return{current:null}},ze.forwardRef=function(N){return{$$typeof:r,render:N}},ze.isValidElement=ce,ze.lazy=function(N){return{$$typeof:h,_payload:{_status:-1,_result:N},_init:q}},ze.memo=function(N,F){return{$$typeof:d,type:N,compare:F===void 0?null:F}},ze.startTransition=function(N){var F=L.T,K={};L.T=K;try{var ie=N(),U=L.S;U!==null&&U(K,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(_,Y)}catch(oe){Y(oe)}finally{F!==null&&K.types!==null&&(F.types=K.types),L.T=F}},ze.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},ze.use=function(N){return L.H.use(N)},ze.useActionState=function(N,F,K){return L.H.useActionState(N,F,K)},ze.useCallback=function(N,F){return L.H.useCallback(N,F)},ze.useContext=function(N){return L.H.useContext(N)},ze.useDebugValue=function(){},ze.useDeferredValue=function(N,F){return L.H.useDeferredValue(N,F)},ze.useEffect=function(N,F){return L.H.useEffect(N,F)},ze.useEffectEvent=function(N){return L.H.useEffectEvent(N)},ze.useId=function(){return L.H.useId()},ze.useImperativeHandle=function(N,F,K){return L.H.useImperativeHandle(N,F,K)},ze.useInsertionEffect=function(N,F){return L.H.useInsertionEffect(N,F)},ze.useLayoutEffect=function(N,F){return L.H.useLayoutEffect(N,F)},ze.useMemo=function(N,F){return L.H.useMemo(N,F)},ze.useOptimistic=function(N,F){return L.H.useOptimistic(N,F)},ze.useReducer=function(N,F,K){return L.H.useReducer(N,F,K)},ze.useRef=function(N){return L.H.useRef(N)},ze.useState=function(N){return L.H.useState(N)},ze.useSyncExternalStore=function(N,F,K){return L.H.useSyncExternalStore(N,F,K)},ze.useTransition=function(){return L.H.useTransition()},ze.version="19.2.0",ze}var j0;function Hf(){return j0||(j0=1,Qh.exports=ER()),Qh.exports}var S=Hf();const Tt=qf(S),$f=SR({__proto__:null,default:Tt},[S]);var Vh={exports:{}},Mr={},Gh={exports:{}},Wh={};var O0;function TR(){return O0||(O0=1,(function(c){function t(z,I){var q=z.length;z.push(I);e:for(;0<q;){var Y=q-1>>>1,fe=z[Y];if(0<n(fe,I))z[Y]=I,z[q]=fe,q=Y;else break e}}function e(z){return z.length===0?null:z[0]}function s(z){if(z.length===0)return null;var I=z[0],q=z.pop();if(q!==I){z[0]=q;e:for(var Y=0,fe=z.length,N=fe>>>1;Y<N;){var F=2*(Y+1)-1,K=z[F],ie=F+1,U=z[ie];if(0>n(K,q))ie<fe&&0>n(U,K)?(z[Y]=U,z[ie]=q,Y=ie):(z[Y]=K,z[F]=q,Y=F);else if(ie<fe&&0>n(U,q))z[Y]=U,z[ie]=q,Y=ie;else break e}}return I}function n(z,I){var q=z.sortIndex-I.sortIndex;return q!==0?q:z.id-I.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;c.unstable_now=function(){return i.now()}}else{var o=Date,r=o.now();c.unstable_now=function(){return o.now()-r}}var u=[],d=[],h=1,p=null,g=3,v=!1,b=!1,x=!1,R=!1,C=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function A(z){for(var I=e(d);I!==null;){if(I.callback===null)s(d);else if(I.startTime<=z)s(d),I.sortIndex=I.expirationTime,t(u,I);else break;I=e(d)}}function D(z){if(x=!1,A(z),!b)if(e(u)!==null)b=!0,_||(_=!0,Z());else{var I=e(d);I!==null&&ue(D,I.startTime-z)}}var _=!1,L=-1,O=5,X=-1;function te(){return R?!0:!(c.unstable_now()-X<O)}function ce(){if(R=!1,_){var z=c.unstable_now();X=z;var I=!0;try{e:{b=!1,x&&(x=!1,k(L),L=-1),v=!0;var q=g;try{t:{for(A(z),p=e(u);p!==null&&!(p.expirationTime>z&&te());){var Y=p.callback;if(typeof Y=="function"){p.callback=null,g=p.priorityLevel;var fe=Y(p.expirationTime<=z);if(z=c.unstable_now(),typeof fe=="function"){p.callback=fe,A(z),I=!0;break t}p===e(u)&&s(u),A(z)}else s(u);p=e(u)}if(p!==null)I=!0;else{var N=e(d);N!==null&&ue(D,N.startTime-z),I=!1}}break e}finally{p=null,g=q,v=!1}I=void 0}}finally{I?Z():_=!1}}}var Z;if(typeof T=="function")Z=function(){T(ce)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,le=se.port2;se.port1.onmessage=ce,Z=function(){le.postMessage(null)}}else Z=function(){C(ce,0)};function ue(z,I){L=C(function(){z(c.unstable_now())},I)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(z){z.callback=null},c.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<z?Math.floor(1e3/z):5},c.unstable_getCurrentPriorityLevel=function(){return g},c.unstable_next=function(z){switch(g){case 1:case 2:case 3:var I=3;break;default:I=g}var q=g;g=I;try{return z()}finally{g=q}},c.unstable_requestPaint=function(){R=!0},c.unstable_runWithPriority=function(z,I){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var q=g;g=z;try{return I()}finally{g=q}},c.unstable_scheduleCallback=function(z,I,q){var Y=c.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?Y+q:Y):q=Y,z){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=q+fe,z={id:h++,callback:I,priorityLevel:z,startTime:q,expirationTime:fe,sortIndex:-1},q>Y?(z.sortIndex=q,t(d,z),e(u)===null&&z===e(d)&&(x?(k(L),L=-1):x=!0,ue(D,q-Y))):(z.sortIndex=fe,t(u,z),b||v||(b=!0,_||(_=!0,Z()))),z},c.unstable_shouldYield=te,c.unstable_wrapCallback=function(z){var I=g;return function(){var q=g;g=I;try{return z.apply(this,arguments)}finally{g=q}}}})(Wh)),Wh}var q0;function kR(){return q0||(q0=1,Gh.exports=TR()),Gh.exports}var Kh={exports:{}},rs={};var H0;function AR(){if(H0)return rs;H0=1;var c=Hf();function t(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},n=Symbol.for("react.portal");function i(u,d,h){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:p==null?null:""+p,children:u,containerInfo:d,implementation:h}}var o=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return rs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,rs.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(t(299));return i(u,d,null,h)},rs.flushSync=function(u){var d=o.T,h=s.p;try{if(o.T=null,s.p=2,u)return u()}finally{o.T=d,s.p=h,s.d.f()}},rs.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(u,d))},rs.prefetchDNS=function(u){typeof u=="string"&&s.d.D(u)},rs.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,p=r(h,d.crossOrigin),g=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?s.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:v}):h==="script"&&s.d.X(u,{crossOrigin:p,integrity:g,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},rs.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=r(d.as,d.crossOrigin);s.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(u)},rs.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,p=r(h,d.crossOrigin);s.d.L(u,h,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},rs.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=r(d.as,d.crossOrigin);s.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(u)},rs.requestFormReset=function(u){s.d.r(u)},rs.unstable_batchedUpdates=function(u,d){return u(d)},rs.useFormState=function(u,d,h){return o.H.useFormState(u,d,h)},rs.useFormStatus=function(){return o.H.useHostTransitionStatus()},rs.version="19.2.0",rs}var $0;function Xv(){if($0)return Kh.exports;$0=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),Kh.exports=AR(),Kh.exports}var B0;function DR(){if(B0)return Mr;B0=1;var c=kR(),t=Hf(),e=Xv();function s(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function i(a){var l=a,f=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(f=l.return),a=l.return;while(a)}return l.tag===3?f:null}function o(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function r(a){if(a.tag===31){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function u(a){if(i(a)!==a)throw Error(s(188))}function d(a){var l=a.alternate;if(!l){if(l=i(a),l===null)throw Error(s(188));return l!==a?null:a}for(var f=a,m=l;;){var w=f.return;if(w===null)break;var M=w.alternate;if(M===null){if(m=w.return,m!==null){f=m;continue}break}if(w.child===M.child){for(M=w.child;M;){if(M===f)return u(w),a;if(M===m)return u(w),l;M=M.sibling}throw Error(s(188))}if(f.return!==m.return)f=w,m=M;else{for(var E=!1,P=w.child;P;){if(P===f){E=!0,f=w,m=M;break}if(P===m){E=!0,m=w,f=M;break}P=P.sibling}if(!E){for(P=M.child;P;){if(P===f){E=!0,f=M,m=w;break}if(P===m){E=!0,m=M,f=w;break}P=P.sibling}if(!E)throw Error(s(189))}}if(f.alternate!==m)throw Error(s(190))}if(f.tag!==3)throw Error(s(188));return f.stateNode.current===f?a:l}function h(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=h(a),l!==null)return l;a=a.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),te=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function Z(a){return a===null||typeof a!="object"?null:(a=ce&&a[ce]||a["@@iterator"],typeof a=="function"?a:null)}var se=Symbol.for("react.client.reference");function le(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===se?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case x:return"Fragment";case C:return"Profiler";case R:return"StrictMode";case D:return"Suspense";case _:return"SuspenseList";case X:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case b:return"Portal";case T:return a.displayName||"Context";case k:return(a._context.displayName||"Context")+".Consumer";case A:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case L:return l=a.displayName||null,l!==null?l:le(a.type)||"Memo";case O:l=a._payload,a=a._init;try{return le(a(l))}catch{}}return null}var ue=Array.isArray,z=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},Y=[],fe=-1;function N(a){return{current:a}}function F(a){0>fe||(a.current=Y[fe],Y[fe]=null,fe--)}function K(a,l){fe++,Y[fe]=a.current,a.current=l}var ie=N(null),U=N(null),oe=N(null),B=N(null);function G(a,l){switch(K(oe,l),K(U,a),K(ie,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?n0(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=n0(l),a=i0(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}F(ie),K(ie,a)}function pe(){F(ie),F(U),F(oe)}function me(a){a.memoizedState!==null&&K(B,a);var l=ie.current,f=i0(l,a.type);l!==f&&(K(U,a),K(ie,f))}function ye(a){U.current===a&&(F(ie),F(U)),B.current===a&&(F(B),yr._currentValue=q)}var be,Ie;function Be(a){if(be===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);be=l&&l[1]||"",Ie=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+be+a+Ie}var ot=!1;function Ze(a,l){if(!a||ot)return"";ot=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(J){var W=J}Reflect.construct(a,[],re)}else{try{re.call()}catch(J){W=J}a.call(re.prototype)}}else{try{throw Error()}catch(J){W=J}(re=a())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(J){if(J&&W&&typeof J.stack=="string")return[J.stack,W.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=m.DetermineComponentFrameRoot(),E=M[0],P=M[1];if(E&&P){var j=E.split(`
`),V=P.split(`
`);for(w=m=0;m<j.length&&!j[m].includes("DetermineComponentFrameRoot");)m++;for(;w<V.length&&!V[w].includes("DetermineComponentFrameRoot");)w++;if(m===j.length||w===V.length)for(m=j.length-1,w=V.length-1;1<=m&&0<=w&&j[m]!==V[w];)w--;for(;1<=m&&0<=w;m--,w--)if(j[m]!==V[w]){if(m!==1||w!==1)do if(m--,w--,0>w||j[m]!==V[w]){var ne=`
`+j[m].replace(" at new "," at ");return a.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",a.displayName)),ne}while(1<=m&&0<=w);break}}}finally{ot=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?Be(f):""}function Lt(a,l){switch(a.tag){case 26:case 27:case 5:return Be(a.type);case 16:return Be("Lazy");case 13:return a.child!==l&&l!==null?Be("Suspense Fallback"):Be("Suspense");case 19:return Be("SuspenseList");case 0:case 15:return Ze(a.type,!1);case 11:return Ze(a.type.render,!1);case 1:return Ze(a.type,!0);case 31:return Be("Activity");default:return""}}function de(a){try{var l="",f=null;do l+=Lt(a,f),f=a,a=a.return;while(a);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var $e=Object.prototype.hasOwnProperty,Ue=c.unstable_scheduleCallback,bt=c.unstable_cancelCallback,mt=c.unstable_shouldYield,$t=c.unstable_requestPaint,et=c.unstable_now,It=c.unstable_getCurrentPriorityLevel,wt=c.unstable_ImmediatePriority,yt=c.unstable_UserBlockingPriority,Xt=c.unstable_NormalPriority,Gt=c.unstable_LowPriority,Pn=c.unstable_IdlePriority,Ys=c.log,Ps=c.unstable_setDisableYieldValue,hn=null,Jt=null;function Wt(a){if(typeof Ys=="function"&&Ps(a),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(hn,a)}catch{}}var Nt=Math.clz32?Math.clz32:Jr,Fi=Math.log,_s=Math.LN2;function Jr(a){return a>>>=0,a===0?32:31-(Fi(a)/_s|0)|0}var _n=256,Qi=262144,ci=4194304;function Xs(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ln(a,l,f){var m=a.pendingLanes;if(m===0)return 0;var w=0,M=a.suspendedLanes,E=a.pingedLanes;a=a.warmLanes;var P=m&134217727;return P!==0?(m=P&~M,m!==0?w=Xs(m):(E&=P,E!==0?w=Xs(E):f||(f=P&~a,f!==0&&(w=Xs(f))))):(P=m&~M,P!==0?w=Xs(P):E!==0?w=Xs(E):f||(f=m&~a,f!==0&&(w=Xs(f)))),w===0?0:l!==0&&l!==w&&(l&M)===0&&(M=w&-w,f=l&-l,M>=f||M===32&&(f&4194048)!==0)?l:w}function In(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function Nu(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ee(){var a=ci;return ci<<=1,(ci&62914560)===0&&(ci=4194304),a}function he(a){for(var l=[],f=0;31>f;f++)l.push(a);return l}function we(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ne(a,l,f,m,w,M){var E=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var P=a.entanglements,j=a.expirationTimes,V=a.hiddenUpdates;for(f=E&~f;0<f;){var ne=31-Nt(f),re=1<<ne;P[ne]=0,j[ne]=-1;var W=V[ne];if(W!==null)for(V[ne]=null,ne=0;ne<W.length;ne++){var J=W[ne];J!==null&&(J.lane&=-536870913)}f&=~re}m!==0&&je(a,m,0),M!==0&&w===0&&a.tag!==0&&(a.suspendedLanes|=M&~(E&~l))}function je(a,l,f){a.pendingLanes|=l,a.suspendedLanes&=~l;var m=31-Nt(l);a.entangledLanes|=l,a.entanglements[m]=a.entanglements[m]|1073741824|f&261930}function lt(a,l){var f=a.entangledLanes|=l;for(a=a.entanglements;f;){var m=31-Nt(f),w=1<<m;w&l|a[m]&l&&(a[m]|=l),f&=~w}}function zt(a,l){var f=l&-l;return f=(f&42)!==0?1:Zt(f),(f&(a.suspendedLanes|l))!==0?0:f}function Zt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function At(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function us(){var a=I.p;return a!==0?a:(a=window.event,a===void 0?32:T0(a.type))}function St(a,l){var f=I.p;try{return I.p=a,l()}finally{I.p=f}}var at=Math.random().toString(36).slice(2),vt="__reactFiber$"+at,Bt="__reactProps$"+at,fn="__reactContainer$"+at,Fe="__reactEvents$"+at,Ls="__reactListeners$"+at,Vi="__reactHandles$"+at,Eo="__reactResources$"+at,_a="__reactMarker$"+at;function zu(a){delete a[vt],delete a[Bt],delete a[Fe],delete a[Ls],delete a[Vi]}function To(a){var l=a[vt];if(l)return l;for(var f=a.parentNode;f;){if(l=f[fn]||f[vt]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(a=d0(a);a!==null;){if(f=a[vt])return f;a=d0(a)}return l}a=f,f=a.parentNode}return null}function ko(a){if(a=a[vt]||a[fn]){var l=a.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return a}return null}function La(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(s(33))}function Ao(a){var l=a[Eo];return l||(l=a[Eo]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Kt(a){a[_a]=!0}var Qp=new Set,Vp={};function Gi(a,l){Do(a,l),Do(a+"Capture",l)}function Do(a,l){for(Vp[a]=l,a=0;a<l.length;a++)Qp.add(l[a])}var pC=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Gp={},Wp={};function gC(a){return $e.call(Wp,a)?!0:$e.call(Gp,a)?!1:pC.test(a)?Wp[a]=!0:(Gp[a]=!0,!1)}function Zr(a,l,f){if(gC(l))if(f===null)a.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+f)}}function ec(a,l,f){if(f===null)a.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+f)}}function Nn(a,l,f,m){if(m===null)a.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(l,f,""+m)}}function Is(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Kp(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function mC(a,l,f){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,l);if(!a.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var w=m.get,M=m.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return w.call(this)},set:function(E){f=""+E,M.call(this,E)}}),Object.defineProperty(a,l,{enumerable:m.enumerable}),{getValue:function(){return f},setValue:function(E){f=""+E},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function ju(a){if(!a._valueTracker){var l=Kp(a)?"checked":"value";a._valueTracker=mC(a,l,""+a[l])}}function Yp(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var f=l.getValue(),m="";return a&&(m=Kp(a)?a.checked?"true":"false":a.value),a=m,a!==f?(l.setValue(a),!0):!1}function tc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var yC=/[\n"\\]/g;function Ns(a){return a.replace(yC,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Ou(a,l,f,m,w,M,E,P){a.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?a.type=E:a.removeAttribute("type"),l!=null?E==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+Is(l)):a.value!==""+Is(l)&&(a.value=""+Is(l)):E!=="submit"&&E!=="reset"||a.removeAttribute("value"),l!=null?qu(a,E,Is(l)):f!=null?qu(a,E,Is(f)):m!=null&&a.removeAttribute("value"),w==null&&M!=null&&(a.defaultChecked=!!M),w!=null&&(a.checked=w&&typeof w!="function"&&typeof w!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?a.name=""+Is(P):a.removeAttribute("name")}function Xp(a,l,f,m,w,M,E,P){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(a.type=M),l!=null||f!=null){if(!(M!=="submit"&&M!=="reset"||l!=null)){ju(a);return}f=f!=null?""+Is(f):"",l=l!=null?""+Is(l):f,P||l===a.value||(a.value=l),a.defaultValue=l}m=m??w,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=P?a.checked:!!m,a.defaultChecked=!!m,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(a.name=E),ju(a)}function qu(a,l,f){l==="number"&&tc(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function Po(a,l,f,m){if(a=a.options,l){l={};for(var w=0;w<f.length;w++)l["$"+f[w]]=!0;for(f=0;f<a.length;f++)w=l.hasOwnProperty("$"+a[f].value),a[f].selected!==w&&(a[f].selected=w),w&&m&&(a[f].defaultSelected=!0)}else{for(f=""+Is(f),l=null,w=0;w<a.length;w++){if(a[w].value===f){a[w].selected=!0,m&&(a[w].defaultSelected=!0);return}l!==null||a[w].disabled||(l=a[w])}l!==null&&(l.selected=!0)}}function Jp(a,l,f){if(l!=null&&(l=""+Is(l),l!==a.value&&(a.value=l),f==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=f!=null?""+Is(f):""}function Zp(a,l,f,m){if(l==null){if(m!=null){if(f!=null)throw Error(s(92));if(ue(m)){if(1<m.length)throw Error(s(93));m=m[0]}f=m}f==null&&(f=""),l=f}f=Is(l),a.defaultValue=f,m=a.textContent,m===f&&m!==""&&m!==null&&(a.value=m),ju(a)}function _o(a,l){if(l){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=l;return}}a.textContent=l}var vC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function eg(a,l,f){var m=l.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":m?a.setProperty(l,f):typeof f!="number"||f===0||vC.has(l)?l==="float"?a.cssFloat=f:a[l]=(""+f).trim():a[l]=f+"px"}function tg(a,l,f){if(l!=null&&typeof l!="object")throw Error(s(62));if(a=a.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var w in l)m=l[w],l.hasOwnProperty(w)&&f[w]!==m&&eg(a,w,m)}else for(var M in l)l.hasOwnProperty(M)&&eg(a,M,l[M])}function Hu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function sc(a){return wC.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function zn(){}var $u=null;function Bu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Lo=null,Io=null;function sg(a){var l=ko(a);if(l&&(a=l.stateNode)){var f=a[Bt]||null;e:switch(a=l.stateNode,l.type){case"input":if(Ou(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),l=f.name,f.type==="radio"&&l!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Ns(""+l)+'"][type="radio"]'),l=0;l<f.length;l++){var m=f[l];if(m!==a&&m.form===a.form){var w=m[Bt]||null;if(!w)throw Error(s(90));Ou(m,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(l=0;l<f.length;l++)m=f[l],m.form===a.form&&Yp(m)}break e;case"textarea":Jp(a,f.value,f.defaultValue);break e;case"select":l=f.value,l!=null&&Po(a,!!f.multiple,l,!1)}}}var Uu=!1;function ng(a,l,f){if(Uu)return a(l,f);Uu=!0;try{var m=a(l);return m}finally{if(Uu=!1,(Lo!==null||Io!==null)&&(Uc(),Lo&&(l=Lo,a=Io,Io=Lo=null,sg(l),a)))for(l=0;l<a.length;l++)sg(a[l])}}function Ia(a,l){var f=a.stateNode;if(f===null)return null;var m=f[Bt]||null;if(m===null)return null;f=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(s(231,l,typeof f));return f}var jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fu=!1;if(jn)try{var Na={};Object.defineProperty(Na,"passive",{get:function(){Fu=!0}}),window.addEventListener("test",Na,Na),window.removeEventListener("test",Na,Na)}catch{Fu=!1}var li=null,Qu=null,nc=null;function ig(){if(nc)return nc;var a,l=Qu,f=l.length,m,w="value"in li?li.value:li.textContent,M=w.length;for(a=0;a<f&&l[a]===w[a];a++);var E=f-a;for(m=1;m<=E&&l[f-m]===w[M-m];m++);return nc=w.slice(a,1<m?1-m:void 0)}function ic(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function oc(){return!0}function og(){return!1}function fs(a){function l(f,m,w,M,E){this._reactName=f,this._targetInst=w,this.type=m,this.nativeEvent=M,this.target=E,this.currentTarget=null;for(var P in a)a.hasOwnProperty(P)&&(f=a[P],this[P]=f?f(M):M[P]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?oc:og,this.isPropagationStopped=og,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=oc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=oc)},persist:function(){},isPersistent:oc}),l}var Wi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ac=fs(Wi),za=p({},Wi,{view:0,detail:0}),xC=fs(za),Vu,Gu,ja,rc=p({},za,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ku,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ja&&(ja&&a.type==="mousemove"?(Vu=a.screenX-ja.screenX,Gu=a.screenY-ja.screenY):Gu=Vu=0,ja=a),Vu)},movementY:function(a){return"movementY"in a?a.movementY:Gu}}),ag=fs(rc),MC=p({},rc,{dataTransfer:0}),SC=fs(MC),CC=p({},za,{relatedTarget:0}),Wu=fs(CC),RC=p({},Wi,{animationName:0,elapsedTime:0,pseudoElement:0}),EC=fs(RC),TC=p({},Wi,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),kC=fs(TC),AC=p({},Wi,{data:0}),rg=fs(AC),DC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_C={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function LC(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=_C[a])?!!l[a]:!1}function Ku(){return LC}var IC=p({},za,{key:function(a){if(a.key){var l=DC[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=ic(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?PC[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ku,charCode:function(a){return a.type==="keypress"?ic(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ic(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),NC=fs(IC),zC=p({},rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cg=fs(zC),jC=p({},za,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ku}),OC=fs(jC),qC=p({},Wi,{propertyName:0,elapsedTime:0,pseudoElement:0}),HC=fs(qC),$C=p({},rc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),BC=fs($C),UC=p({},Wi,{newState:0,oldState:0}),FC=fs(UC),QC=[9,13,27,32],Yu=jn&&"CompositionEvent"in window,Oa=null;jn&&"documentMode"in document&&(Oa=document.documentMode);var VC=jn&&"TextEvent"in window&&!Oa,lg=jn&&(!Yu||Oa&&8<Oa&&11>=Oa),ug=" ",dg=!1;function hg(a,l){switch(a){case"keyup":return QC.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fg(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var No=!1;function GC(a,l){switch(a){case"compositionend":return fg(l);case"keypress":return l.which!==32?null:(dg=!0,ug);case"textInput":return a=l.data,a===ug&&dg?null:a;default:return null}}function WC(a,l){if(No)return a==="compositionend"||!Yu&&hg(a,l)?(a=ig(),nc=Qu=li=null,No=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return lg&&l.locale!=="ko"?null:l.data;default:return null}}var KC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pg(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!KC[a.type]:l==="textarea"}function gg(a,l,f,m){Lo?Io?Io.push(m):Io=[m]:Lo=m,l=Yc(l,"onChange"),0<l.length&&(f=new ac("onChange","change",null,f,m),a.push({event:f,listeners:l}))}var qa=null,Ha=null;function YC(a){Xy(a,0)}function cc(a){var l=La(a);if(Yp(l))return a}function mg(a,l){if(a==="change")return l}var yg=!1;if(jn){var Xu;if(jn){var Ju="oninput"in document;if(!Ju){var vg=document.createElement("div");vg.setAttribute("oninput","return;"),Ju=typeof vg.oninput=="function"}Xu=Ju}else Xu=!1;yg=Xu&&(!document.documentMode||9<document.documentMode)}function bg(){qa&&(qa.detachEvent("onpropertychange",wg),Ha=qa=null)}function wg(a){if(a.propertyName==="value"&&cc(Ha)){var l=[];gg(l,Ha,a,Bu(a)),ng(YC,l)}}function XC(a,l,f){a==="focusin"?(bg(),qa=l,Ha=f,qa.attachEvent("onpropertychange",wg)):a==="focusout"&&bg()}function JC(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return cc(Ha)}function ZC(a,l){if(a==="click")return cc(l)}function e1(a,l){if(a==="input"||a==="change")return cc(l)}function t1(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var Ms=typeof Object.is=="function"?Object.is:t1;function $a(a,l){if(Ms(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var f=Object.keys(a),m=Object.keys(l);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var w=f[m];if(!$e.call(l,w)||!Ms(a[w],l[w]))return!1}return!0}function xg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Mg(a,l){var f=xg(a);a=0;for(var m;f;){if(f.nodeType===3){if(m=a+f.textContent.length,a<=l&&m>=l)return{node:f,offset:l-a};a=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=xg(f)}}function Sg(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?Sg(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function Cg(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=tc(a.document);l instanceof a.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)a=l.contentWindow;else break;l=tc(a.document)}return l}function Zu(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var s1=jn&&"documentMode"in document&&11>=document.documentMode,zo=null,ed=null,Ba=null,td=!1;function Rg(a,l,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;td||zo==null||zo!==tc(m)||(m=zo,"selectionStart"in m&&Zu(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Ba&&$a(Ba,m)||(Ba=m,m=Yc(ed,"onSelect"),0<m.length&&(l=new ac("onSelect","select",null,l,f),a.push({event:l,listeners:m}),l.target=zo)))}function Ki(a,l){var f={};return f[a.toLowerCase()]=l.toLowerCase(),f["Webkit"+a]="webkit"+l,f["Moz"+a]="moz"+l,f}var jo={animationend:Ki("Animation","AnimationEnd"),animationiteration:Ki("Animation","AnimationIteration"),animationstart:Ki("Animation","AnimationStart"),transitionrun:Ki("Transition","TransitionRun"),transitionstart:Ki("Transition","TransitionStart"),transitioncancel:Ki("Transition","TransitionCancel"),transitionend:Ki("Transition","TransitionEnd")},sd={},Eg={};jn&&(Eg=document.createElement("div").style,"AnimationEvent"in window||(delete jo.animationend.animation,delete jo.animationiteration.animation,delete jo.animationstart.animation),"TransitionEvent"in window||delete jo.transitionend.transition);function Yi(a){if(sd[a])return sd[a];if(!jo[a])return a;var l=jo[a],f;for(f in l)if(l.hasOwnProperty(f)&&f in Eg)return sd[a]=l[f];return a}var Tg=Yi("animationend"),kg=Yi("animationiteration"),Ag=Yi("animationstart"),n1=Yi("transitionrun"),i1=Yi("transitionstart"),o1=Yi("transitioncancel"),Dg=Yi("transitionend"),Pg=new Map,nd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nd.push("scrollEnd");function Js(a,l){Pg.set(a,l),Gi(l,[a])}var lc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},zs=[],Oo=0,id=0;function uc(){for(var a=Oo,l=id=Oo=0;l<a;){var f=zs[l];zs[l++]=null;var m=zs[l];zs[l++]=null;var w=zs[l];zs[l++]=null;var M=zs[l];if(zs[l++]=null,m!==null&&w!==null){var E=m.pending;E===null?w.next=w:(w.next=E.next,E.next=w),m.pending=w}M!==0&&_g(f,w,M)}}function dc(a,l,f,m){zs[Oo++]=a,zs[Oo++]=l,zs[Oo++]=f,zs[Oo++]=m,id|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function od(a,l,f,m){return dc(a,l,f,m),hc(a)}function Xi(a,l){return dc(a,null,null,l),hc(a)}function _g(a,l,f){a.lanes|=f;var m=a.alternate;m!==null&&(m.lanes|=f);for(var w=!1,M=a.return;M!==null;)M.childLanes|=f,m=M.alternate,m!==null&&(m.childLanes|=f),M.tag===22&&(a=M.stateNode,a===null||a._visibility&1||(w=!0)),a=M,M=M.return;return a.tag===3?(M=a.stateNode,w&&l!==null&&(w=31-Nt(f),a=M.hiddenUpdates,m=a[w],m===null?a[w]=[l]:m.push(l),l.lane=f|536870912),M):null}function hc(a){if(50<ur)throw ur=0,ph=null,Error(s(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var qo={};function a1(a,l,f,m){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ss(a,l,f,m){return new a1(a,l,f,m)}function ad(a){return a=a.prototype,!(!a||!a.isReactComponent)}function On(a,l){var f=a.alternate;return f===null?(f=Ss(a.tag,l,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=l,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,l=a.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function Lg(a,l){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,l=f.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function fc(a,l,f,m,w,M){var E=0;if(m=a,typeof a=="function")ad(a)&&(E=1);else if(typeof a=="string")E=dR(a,f,ie.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case X:return a=Ss(31,f,l,w),a.elementType=X,a.lanes=M,a;case x:return Ji(f.children,w,M,l);case R:E=8,w|=24;break;case C:return a=Ss(12,f,l,w|2),a.elementType=C,a.lanes=M,a;case D:return a=Ss(13,f,l,w),a.elementType=D,a.lanes=M,a;case _:return a=Ss(19,f,l,w),a.elementType=_,a.lanes=M,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case T:E=10;break e;case k:E=9;break e;case A:E=11;break e;case L:E=14;break e;case O:E=16,m=null;break e}E=29,f=Error(s(130,a===null?"null":typeof a,"")),m=null}return l=Ss(E,f,l,w),l.elementType=a,l.type=m,l.lanes=M,l}function Ji(a,l,f,m){return a=Ss(7,a,m,l),a.lanes=f,a}function rd(a,l,f){return a=Ss(6,a,null,l),a.lanes=f,a}function Ig(a){var l=Ss(18,null,null,0);return l.stateNode=a,l}function cd(a,l,f){return l=Ss(4,a.children!==null?a.children:[],a.key,l),l.lanes=f,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var Ng=new WeakMap;function js(a,l){if(typeof a=="object"&&a!==null){var f=Ng.get(a);return f!==void 0?f:(l={value:a,source:l,stack:de(l)},Ng.set(a,l),l)}return{value:a,source:l,stack:de(l)}}var Ho=[],$o=0,pc=null,Ua=0,Os=[],qs=0,ui=null,pn=1,gn="";function qn(a,l){Ho[$o++]=Ua,Ho[$o++]=pc,pc=a,Ua=l}function zg(a,l,f){Os[qs++]=pn,Os[qs++]=gn,Os[qs++]=ui,ui=a;var m=pn;a=gn;var w=32-Nt(m)-1;m&=~(1<<w),f+=1;var M=32-Nt(l)+w;if(30<M){var E=w-w%5;M=(m&(1<<E)-1).toString(32),m>>=E,w-=E,pn=1<<32-Nt(l)+w|f<<w|m,gn=M+a}else pn=1<<M|f<<w|m,gn=a}function ld(a){a.return!==null&&(qn(a,1),zg(a,1,0))}function ud(a){for(;a===pc;)pc=Ho[--$o],Ho[$o]=null,Ua=Ho[--$o],Ho[$o]=null;for(;a===ui;)ui=Os[--qs],Os[qs]=null,gn=Os[--qs],Os[qs]=null,pn=Os[--qs],Os[qs]=null}function jg(a,l){Os[qs++]=pn,Os[qs++]=gn,Os[qs++]=ui,pn=l.id,gn=l.overflow,ui=a}var es=null,xt=null,Je=!1,di=null,Hs=!1,dd=Error(s(519));function hi(a){var l=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fa(js(l,a)),dd}function Og(a){var l=a.stateNode,f=a.type,m=a.memoizedProps;switch(l[vt]=a,l[Bt]=m,f){case"dialog":Ve("cancel",l),Ve("close",l);break;case"iframe":case"object":case"embed":Ve("load",l);break;case"video":case"audio":for(f=0;f<hr.length;f++)Ve(hr[f],l);break;case"source":Ve("error",l);break;case"img":case"image":case"link":Ve("error",l),Ve("load",l);break;case"details":Ve("toggle",l);break;case"input":Ve("invalid",l),Xp(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":Ve("invalid",l);break;case"textarea":Ve("invalid",l),Zp(l,m.value,m.defaultValue,m.children)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||l.textContent===""+f||m.suppressHydrationWarning===!0||t0(l.textContent,f)?(m.popover!=null&&(Ve("beforetoggle",l),Ve("toggle",l)),m.onScroll!=null&&Ve("scroll",l),m.onScrollEnd!=null&&Ve("scrollend",l),m.onClick!=null&&(l.onclick=zn),l=!0):l=!1,l||hi(a,!0)}function qg(a){for(es=a.return;es;)switch(es.tag){case 5:case 31:case 13:Hs=!1;return;case 27:case 3:Hs=!0;return;default:es=es.return}}function Bo(a){if(a!==es)return!1;if(!Je)return qg(a),Je=!0,!1;var l=a.tag,f;if((f=l!==3&&l!==27)&&((f=l===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||Ah(a.type,a.memoizedProps)),f=!f),f&&xt&&hi(a),qg(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));xt=u0(a)}else if(l===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));xt=u0(a)}else l===27?(l=xt,Ei(a.type)?(a=Ih,Ih=null,xt=a):xt=l):xt=es?Bs(a.stateNode.nextSibling):null;return!0}function Zi(){xt=es=null,Je=!1}function hd(){var a=di;return a!==null&&(ys===null?ys=a:ys.push.apply(ys,a),di=null),a}function Fa(a){di===null?di=[a]:di.push(a)}var fd=N(null),eo=null,Hn=null;function fi(a,l,f){K(fd,l._currentValue),l._currentValue=f}function $n(a){a._currentValue=fd.current,F(fd)}function pd(a,l,f){for(;a!==null;){var m=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),a===f)break;a=a.return}}function gd(a,l,f,m){var w=a.child;for(w!==null&&(w.return=a);w!==null;){var M=w.dependencies;if(M!==null){var E=w.child;M=M.firstContext;e:for(;M!==null;){var P=M;M=w;for(var j=0;j<l.length;j++)if(P.context===l[j]){M.lanes|=f,P=M.alternate,P!==null&&(P.lanes|=f),pd(M.return,f,a),m||(E=null);break e}M=P.next}}else if(w.tag===18){if(E=w.return,E===null)throw Error(s(341));E.lanes|=f,M=E.alternate,M!==null&&(M.lanes|=f),pd(E,f,a),E=null}else E=w.child;if(E!==null)E.return=w;else for(E=w;E!==null;){if(E===a){E=null;break}if(w=E.sibling,w!==null){w.return=E.return,E=w;break}E=E.return}w=E}}function Uo(a,l,f,m){a=null;for(var w=l,M=!1;w!==null;){if(!M){if((w.flags&524288)!==0)M=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var E=w.alternate;if(E===null)throw Error(s(387));if(E=E.memoizedProps,E!==null){var P=w.type;Ms(w.pendingProps.value,E.value)||(a!==null?a.push(P):a=[P])}}else if(w===B.current){if(E=w.alternate,E===null)throw Error(s(387));E.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(a!==null?a.push(yr):a=[yr])}w=w.return}a!==null&&gd(l,a,f,m),l.flags|=262144}function gc(a){for(a=a.firstContext;a!==null;){if(!Ms(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function to(a){eo=a,Hn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function ts(a){return Hg(eo,a)}function mc(a,l){return eo===null&&to(a),Hg(a,l)}function Hg(a,l){var f=l._currentValue;if(l={context:l,memoizedValue:f,next:null},Hn===null){if(a===null)throw Error(s(308));Hn=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else Hn=Hn.next=l;return f}var r1=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(f,m){a.push(m)}};this.abort=function(){l.aborted=!0,a.forEach(function(f){return f()})}},c1=c.unstable_scheduleCallback,l1=c.unstable_NormalPriority,jt={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function md(){return{controller:new r1,data:new Map,refCount:0}}function Qa(a){a.refCount--,a.refCount===0&&c1(l1,function(){a.controller.abort()})}var Va=null,yd=0,Fo=0,Qo=null;function u1(a,l){if(Va===null){var f=Va=[];yd=0,Fo=wh(),Qo={status:"pending",value:void 0,then:function(m){f.push(m)}}}return yd++,l.then($g,$g),l}function $g(){if(--yd===0&&Va!==null){Qo!==null&&(Qo.status="fulfilled");var a=Va;Va=null,Fo=0,Qo=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function d1(a,l){var f=[],m={status:"pending",value:null,reason:null,then:function(w){f.push(w)}};return a.then(function(){m.status="fulfilled",m.value=l;for(var w=0;w<f.length;w++)(0,f[w])(l)},function(w){for(m.status="rejected",m.reason=w,w=0;w<f.length;w++)(0,f[w])(void 0)}),m}var Bg=z.S;z.S=function(a,l){Ry=et(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&u1(a,l),Bg!==null&&Bg(a,l)};var so=N(null);function vd(){var a=so.current;return a!==null?a:pt.pooledCache}function yc(a,l){l===null?K(so,so.current):K(so,l.pool)}function Ug(){var a=vd();return a===null?null:{parent:jt._currentValue,pool:a}}var Vo=Error(s(460)),bd=Error(s(474)),vc=Error(s(542)),bc={then:function(){}};function Fg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Qg(a,l,f){switch(f=a[f],f===void 0?a.push(l):f!==l&&(l.then(zn,zn),l=f),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Gg(a),a;default:if(typeof l.status=="string")l.then(zn,zn);else{if(a=pt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=l,a.status="pending",a.then(function(m){if(l.status==="pending"){var w=l;w.status="fulfilled",w.value=m}},function(m){if(l.status==="pending"){var w=l;w.status="rejected",w.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Gg(a),a}throw io=l,Vo}}function no(a){try{var l=a._init;return l(a._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(io=f,Vo):f}}var io=null;function Vg(){if(io===null)throw Error(s(459));var a=io;return io=null,a}function Gg(a){if(a===Vo||a===vc)throw Error(s(483))}var Go=null,Ga=0;function wc(a){var l=Ga;return Ga+=1,Go===null&&(Go=[]),Qg(Go,a,l)}function Wa(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function xc(a,l){throw l.$$typeof===g?Error(s(525)):(a=Object.prototype.toString.call(l),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function Wg(a){function l($,H){if(a){var Q=$.deletions;Q===null?($.deletions=[H],$.flags|=16):Q.push(H)}}function f($,H){if(!a)return null;for(;H!==null;)l($,H),H=H.sibling;return null}function m($){for(var H=new Map;$!==null;)$.key!==null?H.set($.key,$):H.set($.index,$),$=$.sibling;return H}function w($,H){return $=On($,H),$.index=0,$.sibling=null,$}function M($,H,Q){return $.index=Q,a?(Q=$.alternate,Q!==null?(Q=Q.index,Q<H?($.flags|=67108866,H):Q):($.flags|=67108866,H)):($.flags|=1048576,H)}function E($){return a&&$.alternate===null&&($.flags|=67108866),$}function P($,H,Q,ae){return H===null||H.tag!==6?(H=rd(Q,$.mode,ae),H.return=$,H):(H=w(H,Q),H.return=$,H)}function j($,H,Q,ae){var Ae=Q.type;return Ae===x?ne($,H,Q.props.children,ae,Q.key):H!==null&&(H.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===O&&no(Ae)===H.type)?(H=w(H,Q.props),Wa(H,Q),H.return=$,H):(H=fc(Q.type,Q.key,Q.props,null,$.mode,ae),Wa(H,Q),H.return=$,H)}function V($,H,Q,ae){return H===null||H.tag!==4||H.stateNode.containerInfo!==Q.containerInfo||H.stateNode.implementation!==Q.implementation?(H=cd(Q,$.mode,ae),H.return=$,H):(H=w(H,Q.children||[]),H.return=$,H)}function ne($,H,Q,ae,Ae){return H===null||H.tag!==7?(H=Ji(Q,$.mode,ae,Ae),H.return=$,H):(H=w(H,Q),H.return=$,H)}function re($,H,Q){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return H=rd(""+H,$.mode,Q),H.return=$,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case v:return Q=fc(H.type,H.key,H.props,null,$.mode,Q),Wa(Q,H),Q.return=$,Q;case b:return H=cd(H,$.mode,Q),H.return=$,H;case O:return H=no(H),re($,H,Q)}if(ue(H)||Z(H))return H=Ji(H,$.mode,Q,null),H.return=$,H;if(typeof H.then=="function")return re($,wc(H),Q);if(H.$$typeof===T)return re($,mc($,H),Q);xc($,H)}return null}function W($,H,Q,ae){var Ae=H!==null?H.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Ae!==null?null:P($,H,""+Q,ae);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case v:return Q.key===Ae?j($,H,Q,ae):null;case b:return Q.key===Ae?V($,H,Q,ae):null;case O:return Q=no(Q),W($,H,Q,ae)}if(ue(Q)||Z(Q))return Ae!==null?null:ne($,H,Q,ae,null);if(typeof Q.then=="function")return W($,H,wc(Q),ae);if(Q.$$typeof===T)return W($,H,mc($,Q),ae);xc($,Q)}return null}function J($,H,Q,ae,Ae){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return $=$.get(Q)||null,P(H,$,""+ae,Ae);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case v:return $=$.get(ae.key===null?Q:ae.key)||null,j(H,$,ae,Ae);case b:return $=$.get(ae.key===null?Q:ae.key)||null,V(H,$,ae,Ae);case O:return ae=no(ae),J($,H,Q,ae,Ae)}if(ue(ae)||Z(ae))return $=$.get(Q)||null,ne(H,$,ae,Ae,null);if(typeof ae.then=="function")return J($,H,Q,wc(ae),Ae);if(ae.$$typeof===T)return J($,H,Q,mc(H,ae),Ae);xc(H,ae)}return null}function xe($,H,Q,ae){for(var Ae=null,tt=null,Re=H,qe=H=0,We=null;Re!==null&&qe<Q.length;qe++){Re.index>qe?(We=Re,Re=null):We=Re.sibling;var st=W($,Re,Q[qe],ae);if(st===null){Re===null&&(Re=We);break}a&&Re&&st.alternate===null&&l($,Re),H=M(st,H,qe),tt===null?Ae=st:tt.sibling=st,tt=st,Re=We}if(qe===Q.length)return f($,Re),Je&&qn($,qe),Ae;if(Re===null){for(;qe<Q.length;qe++)Re=re($,Q[qe],ae),Re!==null&&(H=M(Re,H,qe),tt===null?Ae=Re:tt.sibling=Re,tt=Re);return Je&&qn($,qe),Ae}for(Re=m(Re);qe<Q.length;qe++)We=J(Re,$,qe,Q[qe],ae),We!==null&&(a&&We.alternate!==null&&Re.delete(We.key===null?qe:We.key),H=M(We,H,qe),tt===null?Ae=We:tt.sibling=We,tt=We);return a&&Re.forEach(function(Pi){return l($,Pi)}),Je&&qn($,qe),Ae}function _e($,H,Q,ae){if(Q==null)throw Error(s(151));for(var Ae=null,tt=null,Re=H,qe=H=0,We=null,st=Q.next();Re!==null&&!st.done;qe++,st=Q.next()){Re.index>qe?(We=Re,Re=null):We=Re.sibling;var Pi=W($,Re,st.value,ae);if(Pi===null){Re===null&&(Re=We);break}a&&Re&&Pi.alternate===null&&l($,Re),H=M(Pi,H,qe),tt===null?Ae=Pi:tt.sibling=Pi,tt=Pi,Re=We}if(st.done)return f($,Re),Je&&qn($,qe),Ae;if(Re===null){for(;!st.done;qe++,st=Q.next())st=re($,st.value,ae),st!==null&&(H=M(st,H,qe),tt===null?Ae=st:tt.sibling=st,tt=st);return Je&&qn($,qe),Ae}for(Re=m(Re);!st.done;qe++,st=Q.next())st=J(Re,$,qe,st.value,ae),st!==null&&(a&&st.alternate!==null&&Re.delete(st.key===null?qe:st.key),H=M(st,H,qe),tt===null?Ae=st:tt.sibling=st,tt=st);return a&&Re.forEach(function(MR){return l($,MR)}),Je&&qn($,qe),Ae}function ht($,H,Q,ae){if(typeof Q=="object"&&Q!==null&&Q.type===x&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case v:e:{for(var Ae=Q.key;H!==null;){if(H.key===Ae){if(Ae=Q.type,Ae===x){if(H.tag===7){f($,H.sibling),ae=w(H,Q.props.children),ae.return=$,$=ae;break e}}else if(H.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===O&&no(Ae)===H.type){f($,H.sibling),ae=w(H,Q.props),Wa(ae,Q),ae.return=$,$=ae;break e}f($,H);break}else l($,H);H=H.sibling}Q.type===x?(ae=Ji(Q.props.children,$.mode,ae,Q.key),ae.return=$,$=ae):(ae=fc(Q.type,Q.key,Q.props,null,$.mode,ae),Wa(ae,Q),ae.return=$,$=ae)}return E($);case b:e:{for(Ae=Q.key;H!==null;){if(H.key===Ae)if(H.tag===4&&H.stateNode.containerInfo===Q.containerInfo&&H.stateNode.implementation===Q.implementation){f($,H.sibling),ae=w(H,Q.children||[]),ae.return=$,$=ae;break e}else{f($,H);break}else l($,H);H=H.sibling}ae=cd(Q,$.mode,ae),ae.return=$,$=ae}return E($);case O:return Q=no(Q),ht($,H,Q,ae)}if(ue(Q))return xe($,H,Q,ae);if(Z(Q)){if(Ae=Z(Q),typeof Ae!="function")throw Error(s(150));return Q=Ae.call(Q),_e($,H,Q,ae)}if(typeof Q.then=="function")return ht($,H,wc(Q),ae);if(Q.$$typeof===T)return ht($,H,mc($,Q),ae);xc($,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint"?(Q=""+Q,H!==null&&H.tag===6?(f($,H.sibling),ae=w(H,Q),ae.return=$,$=ae):(f($,H),ae=rd(Q,$.mode,ae),ae.return=$,$=ae),E($)):f($,H)}return function($,H,Q,ae){try{Ga=0;var Ae=ht($,H,Q,ae);return Go=null,Ae}catch(Re){if(Re===Vo||Re===vc)throw Re;var tt=Ss(29,Re,null,$.mode);return tt.lanes=ae,tt.return=$,tt}finally{}}}var oo=Wg(!0),Kg=Wg(!1),pi=!1;function wd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function xd(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function gi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function mi(a,l,f){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(nt&2)!==0){var w=m.pending;return w===null?l.next=l:(l.next=w.next,w.next=l),m.pending=l,l=hc(a),_g(a,null,f),l}return dc(a,m,l,f),hc(a)}function Ka(a,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194048)!==0)){var m=l.lanes;m&=a.pendingLanes,f|=m,l.lanes=f,lt(a,f)}}function Md(a,l){var f=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var w=null,M=null;if(f=f.firstBaseUpdate,f!==null){do{var E={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};M===null?w=M=E:M=M.next=E,f=f.next}while(f!==null);M===null?w=M=l:M=M.next=l}else w=M=l;f={baseState:m.baseState,firstBaseUpdate:w,lastBaseUpdate:M,shared:m.shared,callbacks:m.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=l:a.next=l,f.lastBaseUpdate=l}var Sd=!1;function Ya(){if(Sd){var a=Qo;if(a!==null)throw a}}function Xa(a,l,f,m){Sd=!1;var w=a.updateQueue;pi=!1;var M=w.firstBaseUpdate,E=w.lastBaseUpdate,P=w.shared.pending;if(P!==null){w.shared.pending=null;var j=P,V=j.next;j.next=null,E===null?M=V:E.next=V,E=j;var ne=a.alternate;ne!==null&&(ne=ne.updateQueue,P=ne.lastBaseUpdate,P!==E&&(P===null?ne.firstBaseUpdate=V:P.next=V,ne.lastBaseUpdate=j))}if(M!==null){var re=w.baseState;E=0,ne=V=j=null,P=M;do{var W=P.lane&-536870913,J=W!==P.lane;if(J?(Ge&W)===W:(m&W)===W){W!==0&&W===Fo&&(Sd=!0),ne!==null&&(ne=ne.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});e:{var xe=a,_e=P;W=l;var ht=f;switch(_e.tag){case 1:if(xe=_e.payload,typeof xe=="function"){re=xe.call(ht,re,W);break e}re=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=_e.payload,W=typeof xe=="function"?xe.call(ht,re,W):xe,W==null)break e;re=p({},re,W);break e;case 2:pi=!0}}W=P.callback,W!==null&&(a.flags|=64,J&&(a.flags|=8192),J=w.callbacks,J===null?w.callbacks=[W]:J.push(W))}else J={lane:W,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ne===null?(V=ne=J,j=re):ne=ne.next=J,E|=W;if(P=P.next,P===null){if(P=w.shared.pending,P===null)break;J=P,P=J.next,J.next=null,w.lastBaseUpdate=J,w.shared.pending=null}}while(!0);ne===null&&(j=re),w.baseState=j,w.firstBaseUpdate=V,w.lastBaseUpdate=ne,M===null&&(w.shared.lanes=0),xi|=E,a.lanes=E,a.memoizedState=re}}function Yg(a,l){if(typeof a!="function")throw Error(s(191,a));a.call(l)}function Xg(a,l){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)Yg(f[a],l)}var Wo=N(null),Mc=N(0);function Jg(a,l){a=Yn,K(Mc,a),K(Wo,l),Yn=a|l.baseLanes}function Cd(){K(Mc,Yn),K(Wo,Wo.current)}function Rd(){Yn=Mc.current,F(Wo),F(Mc)}var Cs=N(null),$s=null;function yi(a){var l=a.alternate;K(Dt,Dt.current&1),K(Cs,a),$s===null&&(l===null||Wo.current!==null||l.memoizedState!==null)&&($s=a)}function Ed(a){K(Dt,Dt.current),K(Cs,a),$s===null&&($s=a)}function Zg(a){a.tag===22?(K(Dt,Dt.current),K(Cs,a),$s===null&&($s=a)):vi()}function vi(){K(Dt,Dt.current),K(Cs,Cs.current)}function Rs(a){F(Cs),$s===a&&($s=null),F(Dt)}var Dt=N(0);function Sc(a){for(var l=a;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||_h(f)||Lh(f)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Bn=0,Oe=null,ut=null,Ot=null,Cc=!1,Ko=!1,ao=!1,Rc=0,Ja=0,Yo=null,h1=0;function Rt(){throw Error(s(321))}function Td(a,l){if(l===null)return!1;for(var f=0;f<l.length&&f<a.length;f++)if(!Ms(a[f],l[f]))return!1;return!0}function kd(a,l,f,m,w,M){return Bn=M,Oe=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,z.H=a===null||a.memoizedState===null?zm:Ud,ao=!1,M=f(m,w),ao=!1,Ko&&(M=tm(l,f,m,w)),em(a),M}function em(a){z.H=tr;var l=ut!==null&&ut.next!==null;if(Bn=0,Ot=ut=Oe=null,Cc=!1,Ja=0,Yo=null,l)throw Error(s(300));a===null||qt||(a=a.dependencies,a!==null&&gc(a)&&(qt=!0))}function tm(a,l,f,m){Oe=a;var w=0;do{if(Ko&&(Yo=null),Ja=0,Ko=!1,25<=w)throw Error(s(301));if(w+=1,Ot=ut=null,a.updateQueue!=null){var M=a.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}z.H=jm,M=l(f,m)}while(Ko);return M}function f1(){var a=z.H,l=a.useState()[0];return l=typeof l.then=="function"?Za(l):l,a=a.useState()[0],(ut!==null?ut.memoizedState:null)!==a&&(Oe.flags|=1024),l}function Ad(){var a=Rc!==0;return Rc=0,a}function Dd(a,l,f){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~f}function Pd(a){if(Cc){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}Cc=!1}Bn=0,Ot=ut=Oe=null,Ko=!1,Ja=Rc=0,Yo=null}function ds(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?Oe.memoizedState=Ot=a:Ot=Ot.next=a,Ot}function Pt(){if(ut===null){var a=Oe.alternate;a=a!==null?a.memoizedState:null}else a=ut.next;var l=Ot===null?Oe.memoizedState:Ot.next;if(l!==null)Ot=l,ut=a;else{if(a===null)throw Oe.alternate===null?Error(s(467)):Error(s(310));ut=a,a={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},Ot===null?Oe.memoizedState=Ot=a:Ot=Ot.next=a}return Ot}function Ec(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Za(a){var l=Ja;return Ja+=1,Yo===null&&(Yo=[]),a=Qg(Yo,a,l),l=Oe,(Ot===null?l.memoizedState:Ot.next)===null&&(l=l.alternate,z.H=l===null||l.memoizedState===null?zm:Ud),a}function Tc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Za(a);if(a.$$typeof===T)return ts(a)}throw Error(s(438,String(a)))}function _d(a){var l=null,f=Oe.updateQueue;if(f!==null&&(l=f.memoCache),l==null){var m=Oe.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(w){return w.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),f===null&&(f=Ec(),Oe.updateQueue=f),f.memoCache=l,f=l.data[l.index],f===void 0)for(f=l.data[l.index]=Array(a),m=0;m<a;m++)f[m]=te;return l.index++,f}function Un(a,l){return typeof l=="function"?l(a):l}function kc(a){var l=Pt();return Ld(l,ut,a)}function Ld(a,l,f){var m=a.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=f;var w=a.baseQueue,M=m.pending;if(M!==null){if(w!==null){var E=w.next;w.next=M.next,M.next=E}l.baseQueue=w=M,m.pending=null}if(M=a.baseState,w===null)a.memoizedState=M;else{l=w.next;var P=E=null,j=null,V=l,ne=!1;do{var re=V.lane&-536870913;if(re!==V.lane?(Ge&re)===re:(Bn&re)===re){var W=V.revertLane;if(W===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),re===Fo&&(ne=!0);else if((Bn&W)===W){V=V.next,W===Fo&&(ne=!0);continue}else re={lane:0,revertLane:V.revertLane,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},j===null?(P=j=re,E=M):j=j.next=re,Oe.lanes|=W,xi|=W;re=V.action,ao&&f(M,re),M=V.hasEagerState?V.eagerState:f(M,re)}else W={lane:re,revertLane:V.revertLane,gesture:V.gesture,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},j===null?(P=j=W,E=M):j=j.next=W,Oe.lanes|=re,xi|=re;V=V.next}while(V!==null&&V!==l);if(j===null?E=M:j.next=P,!Ms(M,a.memoizedState)&&(qt=!0,ne&&(f=Qo,f!==null)))throw f;a.memoizedState=M,a.baseState=E,a.baseQueue=j,m.lastRenderedState=M}return w===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Id(a){var l=Pt(),f=l.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=a;var m=f.dispatch,w=f.pending,M=l.memoizedState;if(w!==null){f.pending=null;var E=w=w.next;do M=a(M,E.action),E=E.next;while(E!==w);Ms(M,l.memoizedState)||(qt=!0),l.memoizedState=M,l.baseQueue===null&&(l.baseState=M),f.lastRenderedState=M}return[M,m]}function sm(a,l,f){var m=Oe,w=Pt(),M=Je;if(M){if(f===void 0)throw Error(s(407));f=f()}else f=l();var E=!Ms((ut||w).memoizedState,f);if(E&&(w.memoizedState=f,qt=!0),w=w.queue,jd(om.bind(null,m,w,a),[a]),w.getSnapshot!==l||E||Ot!==null&&Ot.memoizedState.tag&1){if(m.flags|=2048,Xo(9,{destroy:void 0},im.bind(null,m,w,f,l),null),pt===null)throw Error(s(349));M||(Bn&127)!==0||nm(m,l,f)}return f}function nm(a,l,f){a.flags|=16384,a={getSnapshot:l,value:f},l=Oe.updateQueue,l===null?(l=Ec(),Oe.updateQueue=l,l.stores=[a]):(f=l.stores,f===null?l.stores=[a]:f.push(a))}function im(a,l,f,m){l.value=f,l.getSnapshot=m,am(l)&&rm(a)}function om(a,l,f){return f(function(){am(l)&&rm(a)})}function am(a){var l=a.getSnapshot;a=a.value;try{var f=l();return!Ms(a,f)}catch{return!0}}function rm(a){var l=Xi(a,2);l!==null&&vs(l,a,2)}function Nd(a){var l=ds();if(typeof a=="function"){var f=a;if(a=f(),ao){Wt(!0);try{f()}finally{Wt(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Un,lastRenderedState:a},l}function cm(a,l,f,m){return a.baseState=f,Ld(a,ut,typeof m=="function"?m:Un)}function p1(a,l,f,m,w){if(Pc(a))throw Error(s(485));if(a=l.action,a!==null){var M={payload:w,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){M.listeners.push(E)}};z.T!==null?f(!0):M.isTransition=!1,m(M),f=l.pending,f===null?(M.next=l.pending=M,lm(l,M)):(M.next=f.next,l.pending=f.next=M)}}function lm(a,l){var f=l.action,m=l.payload,w=a.state;if(l.isTransition){var M=z.T,E={};z.T=E;try{var P=f(w,m),j=z.S;j!==null&&j(E,P),um(a,l,P)}catch(V){zd(a,l,V)}finally{M!==null&&E.types!==null&&(M.types=E.types),z.T=M}}else try{M=f(w,m),um(a,l,M)}catch(V){zd(a,l,V)}}function um(a,l,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){dm(a,l,m)},function(m){return zd(a,l,m)}):dm(a,l,f)}function dm(a,l,f){l.status="fulfilled",l.value=f,hm(l),a.state=f,l=a.pending,l!==null&&(f=l.next,f===l?a.pending=null:(f=f.next,l.next=f,lm(a,f)))}function zd(a,l,f){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=f,hm(l),l=l.next;while(l!==m)}a.action=null}function hm(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function fm(a,l){return l}function pm(a,l){if(Je){var f=pt.formState;if(f!==null){e:{var m=Oe;if(Je){if(xt){t:{for(var w=xt,M=Hs;w.nodeType!==8;){if(!M){w=null;break t}if(w=Bs(w.nextSibling),w===null){w=null;break t}}M=w.data,w=M==="F!"||M==="F"?w:null}if(w){xt=Bs(w.nextSibling),m=w.data==="F!";break e}}hi(m)}m=!1}m&&(l=f[0])}}return f=ds(),f.memoizedState=f.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fm,lastRenderedState:l},f.queue=m,f=Lm.bind(null,Oe,m),m.dispatch=f,m=Nd(!1),M=Bd.bind(null,Oe,!1,m.queue),m=ds(),w={state:l,dispatch:null,action:a,pending:null},m.queue=w,f=p1.bind(null,Oe,w,M,f),w.dispatch=f,m.memoizedState=a,[l,f,!1]}function gm(a){var l=Pt();return mm(l,ut,a)}function mm(a,l,f){if(l=Ld(a,l,fm)[0],a=kc(Un)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=Za(l)}catch(E){throw E===Vo?vc:E}else m=l;l=Pt();var w=l.queue,M=w.dispatch;return f!==l.memoizedState&&(Oe.flags|=2048,Xo(9,{destroy:void 0},g1.bind(null,w,f),null)),[m,M,a]}function g1(a,l){a.action=l}function ym(a){var l=Pt(),f=ut;if(f!==null)return mm(l,f,a);Pt(),l=l.memoizedState,f=Pt();var m=f.queue.dispatch;return f.memoizedState=a,[l,m,!1]}function Xo(a,l,f,m){return a={tag:a,create:f,deps:m,inst:l,next:null},l=Oe.updateQueue,l===null&&(l=Ec(),Oe.updateQueue=l),f=l.lastEffect,f===null?l.lastEffect=a.next=a:(m=f.next,f.next=a,a.next=m,l.lastEffect=a),a}function vm(){return Pt().memoizedState}function Ac(a,l,f,m){var w=ds();Oe.flags|=a,w.memoizedState=Xo(1|l,{destroy:void 0},f,m===void 0?null:m)}function Dc(a,l,f,m){var w=Pt();m=m===void 0?null:m;var M=w.memoizedState.inst;ut!==null&&m!==null&&Td(m,ut.memoizedState.deps)?w.memoizedState=Xo(l,M,f,m):(Oe.flags|=a,w.memoizedState=Xo(1|l,M,f,m))}function bm(a,l){Ac(8390656,8,a,l)}function jd(a,l){Dc(2048,8,a,l)}function m1(a){Oe.flags|=4;var l=Oe.updateQueue;if(l===null)l=Ec(),Oe.updateQueue=l,l.events=[a];else{var f=l.events;f===null?l.events=[a]:f.push(a)}}function wm(a){var l=Pt().memoizedState;return m1({ref:l,nextImpl:a}),function(){if((nt&2)!==0)throw Error(s(440));return l.impl.apply(void 0,arguments)}}function xm(a,l){return Dc(4,2,a,l)}function Mm(a,l){return Dc(4,4,a,l)}function Sm(a,l){if(typeof l=="function"){a=a();var f=l(a);return function(){typeof f=="function"?f():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Cm(a,l,f){f=f!=null?f.concat([a]):null,Dc(4,4,Sm.bind(null,l,a),f)}function Od(){}function Rm(a,l){var f=Pt();l=l===void 0?null:l;var m=f.memoizedState;return l!==null&&Td(l,m[1])?m[0]:(f.memoizedState=[a,l],a)}function Em(a,l){var f=Pt();l=l===void 0?null:l;var m=f.memoizedState;if(l!==null&&Td(l,m[1]))return m[0];if(m=a(),ao){Wt(!0);try{a()}finally{Wt(!1)}}return f.memoizedState=[m,l],m}function qd(a,l,f){return f===void 0||(Bn&1073741824)!==0&&(Ge&261930)===0?a.memoizedState=l:(a.memoizedState=f,a=Ty(),Oe.lanes|=a,xi|=a,f)}function Tm(a,l,f,m){return Ms(f,l)?f:Wo.current!==null?(a=qd(a,f,m),Ms(a,l)||(qt=!0),a):(Bn&42)===0||(Bn&1073741824)!==0&&(Ge&261930)===0?(qt=!0,a.memoizedState=f):(a=Ty(),Oe.lanes|=a,xi|=a,l)}function km(a,l,f,m,w){var M=I.p;I.p=M!==0&&8>M?M:8;var E=z.T,P={};z.T=P,Bd(a,!1,l,f);try{var j=w(),V=z.S;if(V!==null&&V(P,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var ne=d1(j,m);er(a,l,ne,ks(a))}else er(a,l,m,ks(a))}catch(re){er(a,l,{then:function(){},status:"rejected",reason:re},ks())}finally{I.p=M,E!==null&&P.types!==null&&(E.types=P.types),z.T=E}}function y1(){}function Hd(a,l,f,m){if(a.tag!==5)throw Error(s(476));var w=Am(a).queue;km(a,w,l,q,f===null?y1:function(){return Dm(a),f(m)})}function Am(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Un,lastRenderedState:q},next:null};var f={};return l.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Un,lastRenderedState:f},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function Dm(a){var l=Am(a);l.next===null&&(l=a.alternate.memoizedState),er(a,l.next.queue,{},ks())}function $d(){return ts(yr)}function Pm(){return Pt().memoizedState}function _m(){return Pt().memoizedState}function v1(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var f=ks();a=gi(f);var m=mi(l,a,f);m!==null&&(vs(m,l,f),Ka(m,l,f)),l={cache:md()},a.payload=l;return}l=l.return}}function b1(a,l,f){var m=ks();f={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Pc(a)?Im(l,f):(f=od(a,l,f,m),f!==null&&(vs(f,a,m),Nm(f,l,m)))}function Lm(a,l,f){var m=ks();er(a,l,f,m)}function er(a,l,f,m){var w={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(Pc(a))Im(l,w);else{var M=a.alternate;if(a.lanes===0&&(M===null||M.lanes===0)&&(M=l.lastRenderedReducer,M!==null))try{var E=l.lastRenderedState,P=M(E,f);if(w.hasEagerState=!0,w.eagerState=P,Ms(P,E))return dc(a,l,w,0),pt===null&&uc(),!1}catch{}finally{}if(f=od(a,l,w,m),f!==null)return vs(f,a,m),Nm(f,l,m),!0}return!1}function Bd(a,l,f,m){if(m={lane:2,revertLane:wh(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Pc(a)){if(l)throw Error(s(479))}else l=od(a,f,m,2),l!==null&&vs(l,a,2)}function Pc(a){var l=a.alternate;return a===Oe||l!==null&&l===Oe}function Im(a,l){Ko=Cc=!0;var f=a.pending;f===null?l.next=l:(l.next=f.next,f.next=l),a.pending=l}function Nm(a,l,f){if((f&4194048)!==0){var m=l.lanes;m&=a.pendingLanes,f|=m,l.lanes=f,lt(a,f)}}var tr={readContext:ts,use:Tc,useCallback:Rt,useContext:Rt,useEffect:Rt,useImperativeHandle:Rt,useLayoutEffect:Rt,useInsertionEffect:Rt,useMemo:Rt,useReducer:Rt,useRef:Rt,useState:Rt,useDebugValue:Rt,useDeferredValue:Rt,useTransition:Rt,useSyncExternalStore:Rt,useId:Rt,useHostTransitionStatus:Rt,useFormState:Rt,useActionState:Rt,useOptimistic:Rt,useMemoCache:Rt,useCacheRefresh:Rt};tr.useEffectEvent=Rt;var zm={readContext:ts,use:Tc,useCallback:function(a,l){return ds().memoizedState=[a,l===void 0?null:l],a},useContext:ts,useEffect:bm,useImperativeHandle:function(a,l,f){f=f!=null?f.concat([a]):null,Ac(4194308,4,Sm.bind(null,l,a),f)},useLayoutEffect:function(a,l){return Ac(4194308,4,a,l)},useInsertionEffect:function(a,l){Ac(4,2,a,l)},useMemo:function(a,l){var f=ds();l=l===void 0?null:l;var m=a();if(ao){Wt(!0);try{a()}finally{Wt(!1)}}return f.memoizedState=[m,l],m},useReducer:function(a,l,f){var m=ds();if(f!==void 0){var w=f(l);if(ao){Wt(!0);try{f(l)}finally{Wt(!1)}}}else w=l;return m.memoizedState=m.baseState=w,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:w},m.queue=a,a=a.dispatch=b1.bind(null,Oe,a),[m.memoizedState,a]},useRef:function(a){var l=ds();return a={current:a},l.memoizedState=a},useState:function(a){a=Nd(a);var l=a.queue,f=Lm.bind(null,Oe,l);return l.dispatch=f,[a.memoizedState,f]},useDebugValue:Od,useDeferredValue:function(a,l){var f=ds();return qd(f,a,l)},useTransition:function(){var a=Nd(!1);return a=km.bind(null,Oe,a.queue,!0,!1),ds().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,f){var m=Oe,w=ds();if(Je){if(f===void 0)throw Error(s(407));f=f()}else{if(f=l(),pt===null)throw Error(s(349));(Ge&127)!==0||nm(m,l,f)}w.memoizedState=f;var M={value:f,getSnapshot:l};return w.queue=M,bm(om.bind(null,m,M,a),[a]),m.flags|=2048,Xo(9,{destroy:void 0},im.bind(null,m,M,f,l),null),f},useId:function(){var a=ds(),l=pt.identifierPrefix;if(Je){var f=gn,m=pn;f=(m&~(1<<32-Nt(m)-1)).toString(32)+f,l="_"+l+"R_"+f,f=Rc++,0<f&&(l+="H"+f.toString(32)),l+="_"}else f=h1++,l="_"+l+"r_"+f.toString(32)+"_";return a.memoizedState=l},useHostTransitionStatus:$d,useFormState:pm,useActionState:pm,useOptimistic:function(a){var l=ds();l.memoizedState=l.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=f,l=Bd.bind(null,Oe,!0,f),f.dispatch=l,[a,l]},useMemoCache:_d,useCacheRefresh:function(){return ds().memoizedState=v1.bind(null,Oe)},useEffectEvent:function(a){var l=ds(),f={impl:a};return l.memoizedState=f,function(){if((nt&2)!==0)throw Error(s(440));return f.impl.apply(void 0,arguments)}}},Ud={readContext:ts,use:Tc,useCallback:Rm,useContext:ts,useEffect:jd,useImperativeHandle:Cm,useInsertionEffect:xm,useLayoutEffect:Mm,useMemo:Em,useReducer:kc,useRef:vm,useState:function(){return kc(Un)},useDebugValue:Od,useDeferredValue:function(a,l){var f=Pt();return Tm(f,ut.memoizedState,a,l)},useTransition:function(){var a=kc(Un)[0],l=Pt().memoizedState;return[typeof a=="boolean"?a:Za(a),l]},useSyncExternalStore:sm,useId:Pm,useHostTransitionStatus:$d,useFormState:gm,useActionState:gm,useOptimistic:function(a,l){var f=Pt();return cm(f,ut,a,l)},useMemoCache:_d,useCacheRefresh:_m};Ud.useEffectEvent=wm;var jm={readContext:ts,use:Tc,useCallback:Rm,useContext:ts,useEffect:jd,useImperativeHandle:Cm,useInsertionEffect:xm,useLayoutEffect:Mm,useMemo:Em,useReducer:Id,useRef:vm,useState:function(){return Id(Un)},useDebugValue:Od,useDeferredValue:function(a,l){var f=Pt();return ut===null?qd(f,a,l):Tm(f,ut.memoizedState,a,l)},useTransition:function(){var a=Id(Un)[0],l=Pt().memoizedState;return[typeof a=="boolean"?a:Za(a),l]},useSyncExternalStore:sm,useId:Pm,useHostTransitionStatus:$d,useFormState:ym,useActionState:ym,useOptimistic:function(a,l){var f=Pt();return ut!==null?cm(f,ut,a,l):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:_d,useCacheRefresh:_m};jm.useEffectEvent=wm;function Fd(a,l,f,m){l=a.memoizedState,f=f(m,l),f=f==null?l:p({},l,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var Qd={enqueueSetState:function(a,l,f){a=a._reactInternals;var m=ks(),w=gi(m);w.payload=l,f!=null&&(w.callback=f),l=mi(a,w,m),l!==null&&(vs(l,a,m),Ka(l,a,m))},enqueueReplaceState:function(a,l,f){a=a._reactInternals;var m=ks(),w=gi(m);w.tag=1,w.payload=l,f!=null&&(w.callback=f),l=mi(a,w,m),l!==null&&(vs(l,a,m),Ka(l,a,m))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var f=ks(),m=gi(f);m.tag=2,l!=null&&(m.callback=l),l=mi(a,m,f),l!==null&&(vs(l,a,f),Ka(l,a,f))}};function Om(a,l,f,m,w,M,E){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,M,E):l.prototype&&l.prototype.isPureReactComponent?!$a(f,m)||!$a(w,M):!0}function qm(a,l,f,m){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,m),l.state!==a&&Qd.enqueueReplaceState(l,l.state,null)}function ro(a,l){var f=l;if("ref"in l){f={};for(var m in l)m!=="ref"&&(f[m]=l[m])}if(a=a.defaultProps){f===l&&(f=p({},f));for(var w in a)f[w]===void 0&&(f[w]=a[w])}return f}function Hm(a){lc(a)}function $m(a){console.error(a)}function Bm(a){lc(a)}function _c(a,l){try{var f=a.onUncaughtError;f(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function Um(a,l,f){try{var m=a.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Vd(a,l,f){return f=gi(f),f.tag=3,f.payload={element:null},f.callback=function(){_c(a,l)},f}function Fm(a){return a=gi(a),a.tag=3,a}function Qm(a,l,f,m){var w=f.type.getDerivedStateFromError;if(typeof w=="function"){var M=m.value;a.payload=function(){return w(M)},a.callback=function(){Um(l,f,m)}}var E=f.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(a.callback=function(){Um(l,f,m),typeof w!="function"&&(Mi===null?Mi=new Set([this]):Mi.add(this));var P=m.stack;this.componentDidCatch(m.value,{componentStack:P!==null?P:""})})}function w1(a,l,f,m,w){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=f.alternate,l!==null&&Uo(l,f,w,!0),f=Cs.current,f!==null){switch(f.tag){case 31:case 13:return $s===null?Fc():f.alternate===null&&Et===0&&(Et=3),f.flags&=-257,f.flags|=65536,f.lanes=w,m===bc?f.flags|=16384:(l=f.updateQueue,l===null?f.updateQueue=new Set([m]):l.add(m),yh(a,m,w)),!1;case 22:return f.flags|=65536,m===bc?f.flags|=16384:(l=f.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=l):(f=l.retryQueue,f===null?l.retryQueue=new Set([m]):f.add(m)),yh(a,m,w)),!1}throw Error(s(435,f.tag))}return yh(a,m,w),Fc(),!1}if(Je)return l=Cs.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=w,m!==dd&&(a=Error(s(422),{cause:m}),Fa(js(a,f)))):(m!==dd&&(l=Error(s(423),{cause:m}),Fa(js(l,f))),a=a.current.alternate,a.flags|=65536,w&=-w,a.lanes|=w,m=js(m,f),w=Vd(a.stateNode,m,w),Md(a,w),Et!==4&&(Et=2)),!1;var M=Error(s(520),{cause:m});if(M=js(M,f),lr===null?lr=[M]:lr.push(M),Et!==4&&(Et=2),l===null)return!0;m=js(m,f),f=l;do{switch(f.tag){case 3:return f.flags|=65536,a=w&-w,f.lanes|=a,a=Vd(f.stateNode,m,a),Md(f,a),!1;case 1:if(l=f.type,M=f.stateNode,(f.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Mi===null||!Mi.has(M))))return f.flags|=65536,w&=-w,f.lanes|=w,w=Fm(w),Qm(w,a,f,m),Md(f,w),!1}f=f.return}while(f!==null);return!1}var Gd=Error(s(461)),qt=!1;function ss(a,l,f,m){l.child=a===null?Kg(l,null,f,m):oo(l,a.child,f,m)}function Vm(a,l,f,m,w){f=f.render;var M=l.ref;if("ref"in m){var E={};for(var P in m)P!=="ref"&&(E[P]=m[P])}else E=m;return to(l),m=kd(a,l,f,E,M,w),P=Ad(),a!==null&&!qt?(Dd(a,l,w),Fn(a,l,w)):(Je&&P&&ld(l),l.flags|=1,ss(a,l,m,w),l.child)}function Gm(a,l,f,m,w){if(a===null){var M=f.type;return typeof M=="function"&&!ad(M)&&M.defaultProps===void 0&&f.compare===null?(l.tag=15,l.type=M,Wm(a,l,M,m,w)):(a=fc(f.type,null,m,l,l.mode,w),a.ref=l.ref,a.return=l,l.child=a)}if(M=a.child,!th(a,w)){var E=M.memoizedProps;if(f=f.compare,f=f!==null?f:$a,f(E,m)&&a.ref===l.ref)return Fn(a,l,w)}return l.flags|=1,a=On(M,m),a.ref=l.ref,a.return=l,l.child=a}function Wm(a,l,f,m,w){if(a!==null){var M=a.memoizedProps;if($a(M,m)&&a.ref===l.ref)if(qt=!1,l.pendingProps=m=M,th(a,w))(a.flags&131072)!==0&&(qt=!0);else return l.lanes=a.lanes,Fn(a,l,w)}return Wd(a,l,f,m,w)}function Km(a,l,f,m){var w=m.children,M=a!==null?a.memoizedState:null;if(a===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(M=M!==null?M.baseLanes|f:f,a!==null){for(m=l.child=a.child,w=0;m!==null;)w=w|m.lanes|m.childLanes,m=m.sibling;m=w&~M}else m=0,l.child=null;return Ym(a,l,M,f,m)}if((f&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&yc(l,M!==null?M.cachePool:null),M!==null?Jg(l,M):Cd(),Zg(l);else return m=l.lanes=536870912,Ym(a,l,M!==null?M.baseLanes|f:f,f,m)}else M!==null?(yc(l,M.cachePool),Jg(l,M),vi(),l.memoizedState=null):(a!==null&&yc(l,null),Cd(),vi());return ss(a,l,w,f),l.child}function sr(a,l){return a!==null&&a.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function Ym(a,l,f,m,w){var M=vd();return M=M===null?null:{parent:jt._currentValue,pool:M},l.memoizedState={baseLanes:f,cachePool:M},a!==null&&yc(l,null),Cd(),Zg(l),a!==null&&Uo(a,l,m,!0),l.childLanes=w,null}function Lc(a,l){return l=Nc({mode:l.mode,children:l.children},a.mode),l.ref=a.ref,a.child=l,l.return=a,l}function Xm(a,l,f){return oo(l,a.child,null,f),a=Lc(l,l.pendingProps),a.flags|=2,Rs(l),l.memoizedState=null,a}function x1(a,l,f){var m=l.pendingProps,w=(l.flags&128)!==0;if(l.flags&=-129,a===null){if(Je){if(m.mode==="hidden")return a=Lc(l,m),l.lanes=536870912,sr(null,a);if(Ed(l),(a=xt)?(a=l0(a,Hs),a=a!==null&&a.data==="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:ui!==null?{id:pn,overflow:gn}:null,retryLane:536870912,hydrationErrors:null},f=Ig(a),f.return=l,l.child=f,es=l,xt=null)):a=null,a===null)throw hi(l);return l.lanes=536870912,null}return Lc(l,m)}var M=a.memoizedState;if(M!==null){var E=M.dehydrated;if(Ed(l),w)if(l.flags&256)l.flags&=-257,l=Xm(a,l,f);else if(l.memoizedState!==null)l.child=a.child,l.flags|=128,l=null;else throw Error(s(558));else if(qt||Uo(a,l,f,!1),w=(f&a.childLanes)!==0,qt||w){if(m=pt,m!==null&&(E=zt(m,f),E!==0&&E!==M.retryLane))throw M.retryLane=E,Xi(a,E),vs(m,a,E),Gd;Fc(),l=Xm(a,l,f)}else a=M.treeContext,xt=Bs(E.nextSibling),es=l,Je=!0,di=null,Hs=!1,a!==null&&jg(l,a),l=Lc(l,m),l.flags|=4096;return l}return a=On(a.child,{mode:m.mode,children:m.children}),a.ref=l.ref,l.child=a,a.return=l,a}function Ic(a,l){var f=l.ref;if(f===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(s(284));(a===null||a.ref!==f)&&(l.flags|=4194816)}}function Wd(a,l,f,m,w){return to(l),f=kd(a,l,f,m,void 0,w),m=Ad(),a!==null&&!qt?(Dd(a,l,w),Fn(a,l,w)):(Je&&m&&ld(l),l.flags|=1,ss(a,l,f,w),l.child)}function Jm(a,l,f,m,w,M){return to(l),l.updateQueue=null,f=tm(l,m,f,w),em(a),m=Ad(),a!==null&&!qt?(Dd(a,l,M),Fn(a,l,M)):(Je&&m&&ld(l),l.flags|=1,ss(a,l,f,M),l.child)}function Zm(a,l,f,m,w){if(to(l),l.stateNode===null){var M=qo,E=f.contextType;typeof E=="object"&&E!==null&&(M=ts(E)),M=new f(m,M),l.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Qd,l.stateNode=M,M._reactInternals=l,M=l.stateNode,M.props=m,M.state=l.memoizedState,M.refs={},wd(l),E=f.contextType,M.context=typeof E=="object"&&E!==null?ts(E):qo,M.state=l.memoizedState,E=f.getDerivedStateFromProps,typeof E=="function"&&(Fd(l,f,E,m),M.state=l.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(E=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),E!==M.state&&Qd.enqueueReplaceState(M,M.state,null),Xa(l,m,M,w),Ya(),M.state=l.memoizedState),typeof M.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(a===null){M=l.stateNode;var P=l.memoizedProps,j=ro(f,P);M.props=j;var V=M.context,ne=f.contextType;E=qo,typeof ne=="object"&&ne!==null&&(E=ts(ne));var re=f.getDerivedStateFromProps;ne=typeof re=="function"||typeof M.getSnapshotBeforeUpdate=="function",P=l.pendingProps!==P,ne||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(P||V!==E)&&qm(l,M,m,E),pi=!1;var W=l.memoizedState;M.state=W,Xa(l,m,M,w),Ya(),V=l.memoizedState,P||W!==V||pi?(typeof re=="function"&&(Fd(l,f,re,m),V=l.memoizedState),(j=pi||Om(l,f,j,m,W,V,E))?(ne||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(l.flags|=4194308)):(typeof M.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=V),M.props=m,M.state=V,M.context=E,m=j):(typeof M.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{M=l.stateNode,xd(a,l),E=l.memoizedProps,ne=ro(f,E),M.props=ne,re=l.pendingProps,W=M.context,V=f.contextType,j=qo,typeof V=="object"&&V!==null&&(j=ts(V)),P=f.getDerivedStateFromProps,(V=typeof P=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(E!==re||W!==j)&&qm(l,M,m,j),pi=!1,W=l.memoizedState,M.state=W,Xa(l,m,M,w),Ya();var J=l.memoizedState;E!==re||W!==J||pi||a!==null&&a.dependencies!==null&&gc(a.dependencies)?(typeof P=="function"&&(Fd(l,f,P,m),J=l.memoizedState),(ne=pi||Om(l,f,ne,m,W,J,j)||a!==null&&a.dependencies!==null&&gc(a.dependencies))?(V||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(m,J,j),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(m,J,j)),typeof M.componentDidUpdate=="function"&&(l.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof M.componentDidUpdate!="function"||E===a.memoizedProps&&W===a.memoizedState||(l.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||E===a.memoizedProps&&W===a.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=J),M.props=m,M.state=J,M.context=j,m=ne):(typeof M.componentDidUpdate!="function"||E===a.memoizedProps&&W===a.memoizedState||(l.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||E===a.memoizedProps&&W===a.memoizedState||(l.flags|=1024),m=!1)}return M=m,Ic(a,l),m=(l.flags&128)!==0,M||m?(M=l.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:M.render(),l.flags|=1,a!==null&&m?(l.child=oo(l,a.child,null,w),l.child=oo(l,null,f,w)):ss(a,l,f,w),l.memoizedState=M.state,a=l.child):a=Fn(a,l,w),a}function ey(a,l,f,m){return Zi(),l.flags|=256,ss(a,l,f,m),l.child}var Kd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Yd(a){return{baseLanes:a,cachePool:Ug()}}function Xd(a,l,f){return a=a!==null?a.childLanes&~f:0,l&&(a|=Ts),a}function ty(a,l,f){var m=l.pendingProps,w=!1,M=(l.flags&128)!==0,E;if((E=M)||(E=a!==null&&a.memoizedState===null?!1:(Dt.current&2)!==0),E&&(w=!0,l.flags&=-129),E=(l.flags&32)!==0,l.flags&=-33,a===null){if(Je){if(w?yi(l):vi(),(a=xt)?(a=l0(a,Hs),a=a!==null&&a.data!=="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:ui!==null?{id:pn,overflow:gn}:null,retryLane:536870912,hydrationErrors:null},f=Ig(a),f.return=l,l.child=f,es=l,xt=null)):a=null,a===null)throw hi(l);return Lh(a)?l.lanes=32:l.lanes=536870912,null}var P=m.children;return m=m.fallback,w?(vi(),w=l.mode,P=Nc({mode:"hidden",children:P},w),m=Ji(m,w,f,null),P.return=l,m.return=l,P.sibling=m,l.child=P,m=l.child,m.memoizedState=Yd(f),m.childLanes=Xd(a,E,f),l.memoizedState=Kd,sr(null,m)):(yi(l),Jd(l,P))}var j=a.memoizedState;if(j!==null&&(P=j.dehydrated,P!==null)){if(M)l.flags&256?(yi(l),l.flags&=-257,l=Zd(a,l,f)):l.memoizedState!==null?(vi(),l.child=a.child,l.flags|=128,l=null):(vi(),P=m.fallback,w=l.mode,m=Nc({mode:"visible",children:m.children},w),P=Ji(P,w,f,null),P.flags|=2,m.return=l,P.return=l,m.sibling=P,l.child=m,oo(l,a.child,null,f),m=l.child,m.memoizedState=Yd(f),m.childLanes=Xd(a,E,f),l.memoizedState=Kd,l=sr(null,m));else if(yi(l),Lh(P)){if(E=P.nextSibling&&P.nextSibling.dataset,E)var V=E.dgst;E=V,m=Error(s(419)),m.stack="",m.digest=E,Fa({value:m,source:null,stack:null}),l=Zd(a,l,f)}else if(qt||Uo(a,l,f,!1),E=(f&a.childLanes)!==0,qt||E){if(E=pt,E!==null&&(m=zt(E,f),m!==0&&m!==j.retryLane))throw j.retryLane=m,Xi(a,m),vs(E,a,m),Gd;_h(P)||Fc(),l=Zd(a,l,f)}else _h(P)?(l.flags|=192,l.child=a.child,l=null):(a=j.treeContext,xt=Bs(P.nextSibling),es=l,Je=!0,di=null,Hs=!1,a!==null&&jg(l,a),l=Jd(l,m.children),l.flags|=4096);return l}return w?(vi(),P=m.fallback,w=l.mode,j=a.child,V=j.sibling,m=On(j,{mode:"hidden",children:m.children}),m.subtreeFlags=j.subtreeFlags&65011712,V!==null?P=On(V,P):(P=Ji(P,w,f,null),P.flags|=2),P.return=l,m.return=l,m.sibling=P,l.child=m,sr(null,m),m=l.child,P=a.child.memoizedState,P===null?P=Yd(f):(w=P.cachePool,w!==null?(j=jt._currentValue,w=w.parent!==j?{parent:j,pool:j}:w):w=Ug(),P={baseLanes:P.baseLanes|f,cachePool:w}),m.memoizedState=P,m.childLanes=Xd(a,E,f),l.memoizedState=Kd,sr(a.child,m)):(yi(l),f=a.child,a=f.sibling,f=On(f,{mode:"visible",children:m.children}),f.return=l,f.sibling=null,a!==null&&(E=l.deletions,E===null?(l.deletions=[a],l.flags|=16):E.push(a)),l.child=f,l.memoizedState=null,f)}function Jd(a,l){return l=Nc({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function Nc(a,l){return a=Ss(22,a,null,l),a.lanes=0,a}function Zd(a,l,f){return oo(l,a.child,null,f),a=Jd(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function sy(a,l,f){a.lanes|=l;var m=a.alternate;m!==null&&(m.lanes|=l),pd(a.return,l,f)}function eh(a,l,f,m,w,M){var E=a.memoizedState;E===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:w,treeForkCount:M}:(E.isBackwards=l,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=f,E.tailMode=w,E.treeForkCount=M)}function ny(a,l,f){var m=l.pendingProps,w=m.revealOrder,M=m.tail;m=m.children;var E=Dt.current,P=(E&2)!==0;if(P?(E=E&1|2,l.flags|=128):E&=1,K(Dt,E),ss(a,l,m,f),m=Je?Ua:0,!P&&a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&sy(a,f,l);else if(a.tag===19)sy(a,f,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(w){case"forwards":for(f=l.child,w=null;f!==null;)a=f.alternate,a!==null&&Sc(a)===null&&(w=f),f=f.sibling;f=w,f===null?(w=l.child,l.child=null):(w=f.sibling,f.sibling=null),eh(l,!1,w,f,M,m);break;case"backwards":case"unstable_legacy-backwards":for(f=null,w=l.child,l.child=null;w!==null;){if(a=w.alternate,a!==null&&Sc(a)===null){l.child=w;break}a=w.sibling,w.sibling=f,f=w,w=a}eh(l,!0,f,null,M,m);break;case"together":eh(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function Fn(a,l,f){if(a!==null&&(l.dependencies=a.dependencies),xi|=l.lanes,(f&l.childLanes)===0)if(a!==null){if(Uo(a,l,f,!1),(f&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(s(153));if(l.child!==null){for(a=l.child,f=On(a,a.pendingProps),l.child=f,f.return=l;a.sibling!==null;)a=a.sibling,f=f.sibling=On(a,a.pendingProps),f.return=l;f.sibling=null}return l.child}function th(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&gc(a)))}function M1(a,l,f){switch(l.tag){case 3:G(l,l.stateNode.containerInfo),fi(l,jt,a.memoizedState.cache),Zi();break;case 27:case 5:me(l);break;case 4:G(l,l.stateNode.containerInfo);break;case 10:fi(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Ed(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(yi(l),l.flags|=128,null):(f&l.child.childLanes)!==0?ty(a,l,f):(yi(l),a=Fn(a,l,f),a!==null?a.sibling:null);yi(l);break;case 19:var w=(a.flags&128)!==0;if(m=(f&l.childLanes)!==0,m||(Uo(a,l,f,!1),m=(f&l.childLanes)!==0),w){if(m)return ny(a,l,f);l.flags|=128}if(w=l.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),K(Dt,Dt.current),m)break;return null;case 22:return l.lanes=0,Km(a,l,f,l.pendingProps);case 24:fi(l,jt,a.memoizedState.cache)}return Fn(a,l,f)}function iy(a,l,f){if(a!==null)if(a.memoizedProps!==l.pendingProps)qt=!0;else{if(!th(a,f)&&(l.flags&128)===0)return qt=!1,M1(a,l,f);qt=(a.flags&131072)!==0}else qt=!1,Je&&(l.flags&1048576)!==0&&zg(l,Ua,l.index);switch(l.lanes=0,l.tag){case 16:e:{var m=l.pendingProps;if(a=no(l.elementType),l.type=a,typeof a=="function")ad(a)?(m=ro(a,m),l.tag=1,l=Zm(null,l,a,m,f)):(l.tag=0,l=Wd(null,l,a,m,f));else{if(a!=null){var w=a.$$typeof;if(w===A){l.tag=11,l=Vm(null,l,a,m,f);break e}else if(w===L){l.tag=14,l=Gm(null,l,a,m,f);break e}}throw l=le(a)||a,Error(s(306,l,""))}}return l;case 0:return Wd(a,l,l.type,l.pendingProps,f);case 1:return m=l.type,w=ro(m,l.pendingProps),Zm(a,l,m,w,f);case 3:e:{if(G(l,l.stateNode.containerInfo),a===null)throw Error(s(387));m=l.pendingProps;var M=l.memoizedState;w=M.element,xd(a,l),Xa(l,m,null,f);var E=l.memoizedState;if(m=E.cache,fi(l,jt,m),m!==M.cache&&gd(l,[jt],f,!0),Ya(),m=E.element,M.isDehydrated)if(M={element:m,isDehydrated:!1,cache:E.cache},l.updateQueue.baseState=M,l.memoizedState=M,l.flags&256){l=ey(a,l,m,f);break e}else if(m!==w){w=js(Error(s(424)),l),Fa(w),l=ey(a,l,m,f);break e}else{switch(a=l.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(xt=Bs(a.firstChild),es=l,Je=!0,di=null,Hs=!0,f=Kg(l,null,m,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(Zi(),m===w){l=Fn(a,l,f);break e}ss(a,l,m,f)}l=l.child}return l;case 26:return Ic(a,l),a===null?(f=g0(l.type,null,l.pendingProps,null))?l.memoizedState=f:Je||(f=l.type,a=l.pendingProps,m=Xc(oe.current).createElement(f),m[vt]=l,m[Bt]=a,ns(m,f,a),Kt(m),l.stateNode=m):l.memoizedState=g0(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return me(l),a===null&&Je&&(m=l.stateNode=h0(l.type,l.pendingProps,oe.current),es=l,Hs=!0,w=xt,Ei(l.type)?(Ih=w,xt=Bs(m.firstChild)):xt=w),ss(a,l,l.pendingProps.children,f),Ic(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&Je&&((w=m=xt)&&(m=J1(m,l.type,l.pendingProps,Hs),m!==null?(l.stateNode=m,es=l,xt=Bs(m.firstChild),Hs=!1,w=!0):w=!1),w||hi(l)),me(l),w=l.type,M=l.pendingProps,E=a!==null?a.memoizedProps:null,m=M.children,Ah(w,M)?m=null:E!==null&&Ah(w,E)&&(l.flags|=32),l.memoizedState!==null&&(w=kd(a,l,f1,null,null,f),yr._currentValue=w),Ic(a,l),ss(a,l,m,f),l.child;case 6:return a===null&&Je&&((a=f=xt)&&(f=Z1(f,l.pendingProps,Hs),f!==null?(l.stateNode=f,es=l,xt=null,a=!0):a=!1),a||hi(l)),null;case 13:return ty(a,l,f);case 4:return G(l,l.stateNode.containerInfo),m=l.pendingProps,a===null?l.child=oo(l,null,m,f):ss(a,l,m,f),l.child;case 11:return Vm(a,l,l.type,l.pendingProps,f);case 7:return ss(a,l,l.pendingProps,f),l.child;case 8:return ss(a,l,l.pendingProps.children,f),l.child;case 12:return ss(a,l,l.pendingProps.children,f),l.child;case 10:return m=l.pendingProps,fi(l,l.type,m.value),ss(a,l,m.children,f),l.child;case 9:return w=l.type._context,m=l.pendingProps.children,to(l),w=ts(w),m=m(w),l.flags|=1,ss(a,l,m,f),l.child;case 14:return Gm(a,l,l.type,l.pendingProps,f);case 15:return Wm(a,l,l.type,l.pendingProps,f);case 19:return ny(a,l,f);case 31:return x1(a,l,f);case 22:return Km(a,l,f,l.pendingProps);case 24:return to(l),m=ts(jt),a===null?(w=vd(),w===null&&(w=pt,M=md(),w.pooledCache=M,M.refCount++,M!==null&&(w.pooledCacheLanes|=f),w=M),l.memoizedState={parent:m,cache:w},wd(l),fi(l,jt,w)):((a.lanes&f)!==0&&(xd(a,l),Xa(l,null,null,f),Ya()),w=a.memoizedState,M=l.memoizedState,w.parent!==m?(w={parent:m,cache:m},l.memoizedState=w,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=w),fi(l,jt,m)):(m=M.cache,fi(l,jt,m),m!==w.cache&&gd(l,[jt],f,!0))),ss(a,l,l.pendingProps.children,f),l.child;case 29:throw l.pendingProps}throw Error(s(156,l.tag))}function Qn(a){a.flags|=4}function sh(a,l,f,m,w){if((l=(a.mode&32)!==0)&&(l=!1),l){if(a.flags|=16777216,(w&335544128)===w)if(a.stateNode.complete)a.flags|=8192;else if(Py())a.flags|=8192;else throw io=bc,bd}else a.flags&=-16777217}function oy(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!w0(l))if(Py())a.flags|=8192;else throw io=bc,bd}function zc(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?ee():536870912,a.lanes|=l,ta|=l)}function nr(a,l){if(!Je)switch(a.tailMode){case"hidden":l=a.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Mt(a){var l=a.alternate!==null&&a.alternate.child===a.child,f=0,m=0;if(l)for(var w=a.child;w!==null;)f|=w.lanes|w.childLanes,m|=w.subtreeFlags&65011712,m|=w.flags&65011712,w.return=a,w=w.sibling;else for(w=a.child;w!==null;)f|=w.lanes|w.childLanes,m|=w.subtreeFlags,m|=w.flags,w.return=a,w=w.sibling;return a.subtreeFlags|=m,a.childLanes=f,l}function S1(a,l,f){var m=l.pendingProps;switch(ud(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mt(l),null;case 1:return Mt(l),null;case 3:return f=l.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),$n(jt),pe(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Bo(l)?Qn(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,hd())),Mt(l),null;case 26:var w=l.type,M=l.memoizedState;return a===null?(Qn(l),M!==null?(Mt(l),oy(l,M)):(Mt(l),sh(l,w,null,m,f))):M?M!==a.memoizedState?(Qn(l),Mt(l),oy(l,M)):(Mt(l),l.flags&=-16777217):(a=a.memoizedProps,a!==m&&Qn(l),Mt(l),sh(l,w,a,m,f)),null;case 27:if(ye(l),f=oe.current,w=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==m&&Qn(l);else{if(!m){if(l.stateNode===null)throw Error(s(166));return Mt(l),null}a=ie.current,Bo(l)?Og(l):(a=h0(w,m,f),l.stateNode=a,Qn(l))}return Mt(l),null;case 5:if(ye(l),w=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==m&&Qn(l);else{if(!m){if(l.stateNode===null)throw Error(s(166));return Mt(l),null}if(M=ie.current,Bo(l))Og(l);else{var E=Xc(oe.current);switch(M){case 1:M=E.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:M=E.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":M=E.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":M=E.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":M=E.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof m.is=="string"?E.createElement("select",{is:m.is}):E.createElement("select"),m.multiple?M.multiple=!0:m.size&&(M.size=m.size);break;default:M=typeof m.is=="string"?E.createElement(w,{is:m.is}):E.createElement(w)}}M[vt]=l,M[Bt]=m;e:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)M.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break e;for(;E.sibling===null;){if(E.return===null||E.return===l)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=M;e:switch(ns(M,w,m),w){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Qn(l)}}return Mt(l),sh(l,l.type,a===null?null:a.memoizedProps,l.pendingProps,f),null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==m&&Qn(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(s(166));if(a=oe.current,Bo(l)){if(a=l.stateNode,f=l.memoizedProps,m=null,w=es,w!==null)switch(w.tag){case 27:case 5:m=w.memoizedProps}a[vt]=l,a=!!(a.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||t0(a.nodeValue,f)),a||hi(l,!0)}else a=Xc(a).createTextNode(m),a[vt]=l,l.stateNode=a}return Mt(l),null;case 31:if(f=l.memoizedState,a===null||a.memoizedState!==null){if(m=Bo(l),f!==null){if(a===null){if(!m)throw Error(s(318));if(a=l.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[vt]=l}else Zi(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Mt(l),a=!1}else f=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=f),a=!0;if(!a)return l.flags&256?(Rs(l),l):(Rs(l),null);if((l.flags&128)!==0)throw Error(s(558))}return Mt(l),null;case 13:if(m=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(w=Bo(l),m!==null&&m.dehydrated!==null){if(a===null){if(!w)throw Error(s(318));if(w=l.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(s(317));w[vt]=l}else Zi(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Mt(l),w=!1}else w=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=w),w=!0;if(!w)return l.flags&256?(Rs(l),l):(Rs(l),null)}return Rs(l),(l.flags&128)!==0?(l.lanes=f,l):(f=m!==null,a=a!==null&&a.memoizedState!==null,f&&(m=l.child,w=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(w=m.alternate.memoizedState.cachePool.pool),M=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(M=m.memoizedState.cachePool.pool),M!==w&&(m.flags|=2048)),f!==a&&f&&(l.child.flags|=8192),zc(l,l.updateQueue),Mt(l),null);case 4:return pe(),a===null&&Ch(l.stateNode.containerInfo),Mt(l),null;case 10:return $n(l.type),Mt(l),null;case 19:if(F(Dt),m=l.memoizedState,m===null)return Mt(l),null;if(w=(l.flags&128)!==0,M=m.rendering,M===null)if(w)nr(m,!1);else{if(Et!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(M=Sc(a),M!==null){for(l.flags|=128,nr(m,!1),a=M.updateQueue,l.updateQueue=a,zc(l,a),l.subtreeFlags=0,a=f,f=l.child;f!==null;)Lg(f,a),f=f.sibling;return K(Dt,Dt.current&1|2),Je&&qn(l,m.treeForkCount),l.child}a=a.sibling}m.tail!==null&&et()>$c&&(l.flags|=128,w=!0,nr(m,!1),l.lanes=4194304)}else{if(!w)if(a=Sc(M),a!==null){if(l.flags|=128,w=!0,a=a.updateQueue,l.updateQueue=a,zc(l,a),nr(m,!0),m.tail===null&&m.tailMode==="hidden"&&!M.alternate&&!Je)return Mt(l),null}else 2*et()-m.renderingStartTime>$c&&f!==536870912&&(l.flags|=128,w=!0,nr(m,!1),l.lanes=4194304);m.isBackwards?(M.sibling=l.child,l.child=M):(a=m.last,a!==null?a.sibling=M:l.child=M,m.last=M)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=et(),a.sibling=null,f=Dt.current,K(Dt,w?f&1|2:f&1),Je&&qn(l,m.treeForkCount),a):(Mt(l),null);case 22:case 23:return Rs(l),Rd(),m=l.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(f&536870912)!==0&&(l.flags&128)===0&&(Mt(l),l.subtreeFlags&6&&(l.flags|=8192)):Mt(l),f=l.updateQueue,f!==null&&zc(l,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==f&&(l.flags|=2048),a!==null&&F(so),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),$n(jt),Mt(l),null;case 25:return null;case 30:return null}throw Error(s(156,l.tag))}function C1(a,l){switch(ud(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return $n(jt),pe(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return ye(l),null;case 31:if(l.memoizedState!==null){if(Rs(l),l.alternate===null)throw Error(s(340));Zi()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 13:if(Rs(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(s(340));Zi()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return F(Dt),null;case 4:return pe(),null;case 10:return $n(l.type),null;case 22:case 23:return Rs(l),Rd(),a!==null&&F(so),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return $n(jt),null;case 25:return null;default:return null}}function ay(a,l){switch(ud(l),l.tag){case 3:$n(jt),pe();break;case 26:case 27:case 5:ye(l);break;case 4:pe();break;case 31:l.memoizedState!==null&&Rs(l);break;case 13:Rs(l);break;case 19:F(Dt);break;case 10:$n(l.type);break;case 22:case 23:Rs(l),Rd(),a!==null&&F(so);break;case 24:$n(jt)}}function ir(a,l){try{var f=l.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var w=m.next;f=w;do{if((f.tag&a)===a){m=void 0;var M=f.create,E=f.inst;m=M(),E.destroy=m}f=f.next}while(f!==w)}}catch(P){ct(l,l.return,P)}}function bi(a,l,f){try{var m=l.updateQueue,w=m!==null?m.lastEffect:null;if(w!==null){var M=w.next;m=M;do{if((m.tag&a)===a){var E=m.inst,P=E.destroy;if(P!==void 0){E.destroy=void 0,w=l;var j=f,V=P;try{V()}catch(ne){ct(w,j,ne)}}}m=m.next}while(m!==M)}}catch(ne){ct(l,l.return,ne)}}function ry(a){var l=a.updateQueue;if(l!==null){var f=a.stateNode;try{Xg(l,f)}catch(m){ct(a,a.return,m)}}}function cy(a,l,f){f.props=ro(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(m){ct(a,l,m)}}function or(a,l){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof f=="function"?a.refCleanup=f(m):f.current=m}}catch(w){ct(a,l,w)}}function mn(a,l){var f=a.ref,m=a.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(w){ct(a,l,w)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(w){ct(a,l,w)}else f.current=null}function ly(a){var l=a.type,f=a.memoizedProps,m=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(w){ct(a,a.return,w)}}function nh(a,l,f){try{var m=a.stateNode;V1(m,a.type,f,l),m[Bt]=l}catch(w){ct(a,a.return,w)}}function uy(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ei(a.type)||a.tag===4}function ih(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||uy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ei(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function oh(a,l,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,l):(l=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,l.appendChild(a),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=zn));else if(m!==4&&(m===27&&Ei(a.type)&&(f=a.stateNode,l=null),a=a.child,a!==null))for(oh(a,l,f),a=a.sibling;a!==null;)oh(a,l,f),a=a.sibling}function jc(a,l,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?f.insertBefore(a,l):f.appendChild(a);else if(m!==4&&(m===27&&Ei(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(jc(a,l,f),a=a.sibling;a!==null;)jc(a,l,f),a=a.sibling}function dy(a){var l=a.stateNode,f=a.memoizedProps;try{for(var m=a.type,w=l.attributes;w.length;)l.removeAttributeNode(w[0]);ns(l,m,f),l[vt]=a,l[Bt]=f}catch(M){ct(a,a.return,M)}}var Vn=!1,Ht=!1,ah=!1,hy=typeof WeakSet=="function"?WeakSet:Set,Yt=null;function R1(a,l){if(a=a.containerInfo,Th=il,a=Cg(a),Zu(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var w=m.anchorOffset,M=m.focusNode;m=m.focusOffset;try{f.nodeType,M.nodeType}catch{f=null;break e}var E=0,P=-1,j=-1,V=0,ne=0,re=a,W=null;t:for(;;){for(var J;re!==f||w!==0&&re.nodeType!==3||(P=E+w),re!==M||m!==0&&re.nodeType!==3||(j=E+m),re.nodeType===3&&(E+=re.nodeValue.length),(J=re.firstChild)!==null;)W=re,re=J;for(;;){if(re===a)break t;if(W===f&&++V===w&&(P=E),W===M&&++ne===m&&(j=E),(J=re.nextSibling)!==null)break;re=W,W=re.parentNode}re=J}f=P===-1||j===-1?null:{start:P,end:j}}else f=null}f=f||{start:0,end:0}}else f=null;for(kh={focusedElem:a,selectionRange:f},il=!1,Yt=l;Yt!==null;)if(l=Yt,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Yt=a;else for(;Yt!==null;){switch(l=Yt,M=l.alternate,a=l.flags,l.tag){case 0:if((a&4)!==0&&(a=l.updateQueue,a=a!==null?a.events:null,a!==null))for(f=0;f<a.length;f++)w=a[f],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&M!==null){a=void 0,f=l,w=M.memoizedProps,M=M.memoizedState,m=f.stateNode;try{var xe=ro(f.type,w);a=m.getSnapshotBeforeUpdate(xe,M),m.__reactInternalSnapshotBeforeUpdate=a}catch(_e){ct(f,f.return,_e)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,f=a.nodeType,f===9)Ph(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Ph(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=l.sibling,a!==null){a.return=l.return,Yt=a;break}Yt=l.return}}function fy(a,l,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:Wn(a,f),m&4&&ir(5,f);break;case 1:if(Wn(a,f),m&4)if(a=f.stateNode,l===null)try{a.componentDidMount()}catch(E){ct(f,f.return,E)}else{var w=ro(f.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(w,l,a.__reactInternalSnapshotBeforeUpdate)}catch(E){ct(f,f.return,E)}}m&64&&ry(f),m&512&&or(f,f.return);break;case 3:if(Wn(a,f),m&64&&(a=f.updateQueue,a!==null)){if(l=null,f.child!==null)switch(f.child.tag){case 27:case 5:l=f.child.stateNode;break;case 1:l=f.child.stateNode}try{Xg(a,l)}catch(E){ct(f,f.return,E)}}break;case 27:l===null&&m&4&&dy(f);case 26:case 5:Wn(a,f),l===null&&m&4&&ly(f),m&512&&or(f,f.return);break;case 12:Wn(a,f);break;case 31:Wn(a,f),m&4&&my(a,f);break;case 13:Wn(a,f),m&4&&yy(a,f),m&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=I1.bind(null,f),eR(a,f))));break;case 22:if(m=f.memoizedState!==null||Vn,!m){l=l!==null&&l.memoizedState!==null||Ht,w=Vn;var M=Ht;Vn=m,(Ht=l)&&!M?Kn(a,f,(f.subtreeFlags&8772)!==0):Wn(a,f),Vn=w,Ht=M}break;case 30:break;default:Wn(a,f)}}function py(a){var l=a.alternate;l!==null&&(a.alternate=null,py(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&zu(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Ct=null,ps=!1;function Gn(a,l,f){for(f=f.child;f!==null;)gy(a,l,f),f=f.sibling}function gy(a,l,f){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(hn,f)}catch{}switch(f.tag){case 26:Ht||mn(f,l),Gn(a,l,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Ht||mn(f,l);var m=Ct,w=ps;Ei(f.type)&&(Ct=f.stateNode,ps=!1),Gn(a,l,f),pr(f.stateNode),Ct=m,ps=w;break;case 5:Ht||mn(f,l);case 6:if(m=Ct,w=ps,Ct=null,Gn(a,l,f),Ct=m,ps=w,Ct!==null)if(ps)try{(Ct.nodeType===9?Ct.body:Ct.nodeName==="HTML"?Ct.ownerDocument.body:Ct).removeChild(f.stateNode)}catch(M){ct(f,l,M)}else try{Ct.removeChild(f.stateNode)}catch(M){ct(f,l,M)}break;case 18:Ct!==null&&(ps?(a=Ct,r0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),la(a)):r0(Ct,f.stateNode));break;case 4:m=Ct,w=ps,Ct=f.stateNode.containerInfo,ps=!0,Gn(a,l,f),Ct=m,ps=w;break;case 0:case 11:case 14:case 15:bi(2,f,l),Ht||bi(4,f,l),Gn(a,l,f);break;case 1:Ht||(mn(f,l),m=f.stateNode,typeof m.componentWillUnmount=="function"&&cy(f,l,m)),Gn(a,l,f);break;case 21:Gn(a,l,f);break;case 22:Ht=(m=Ht)||f.memoizedState!==null,Gn(a,l,f),Ht=m;break;default:Gn(a,l,f)}}function my(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{la(a)}catch(f){ct(l,l.return,f)}}}function yy(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{la(a)}catch(f){ct(l,l.return,f)}}function E1(a){switch(a.tag){case 31:case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new hy),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new hy),l;default:throw Error(s(435,a.tag))}}function Oc(a,l){var f=E1(a);l.forEach(function(m){if(!f.has(m)){f.add(m);var w=N1.bind(null,a,m);m.then(w,w)}})}function gs(a,l){var f=l.deletions;if(f!==null)for(var m=0;m<f.length;m++){var w=f[m],M=a,E=l,P=E;e:for(;P!==null;){switch(P.tag){case 27:if(Ei(P.type)){Ct=P.stateNode,ps=!1;break e}break;case 5:Ct=P.stateNode,ps=!1;break e;case 3:case 4:Ct=P.stateNode.containerInfo,ps=!0;break e}P=P.return}if(Ct===null)throw Error(s(160));gy(M,E,w),Ct=null,ps=!1,M=w.alternate,M!==null&&(M.return=null),w.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)vy(l,a),l=l.sibling}var Zs=null;function vy(a,l){var f=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:gs(l,a),ms(a),m&4&&(bi(3,a,a.return),ir(3,a),bi(5,a,a.return));break;case 1:gs(l,a),ms(a),m&512&&(Ht||f===null||mn(f,f.return)),m&64&&Vn&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var w=Zs;if(gs(l,a),ms(a),m&512&&(Ht||f===null||mn(f,f.return)),m&4){var M=f!==null?f.memoizedState:null;if(m=a.memoizedState,f===null)if(m===null)if(a.stateNode===null){e:{m=a.type,f=a.memoizedProps,w=w.ownerDocument||w;t:switch(m){case"title":M=w.getElementsByTagName("title")[0],(!M||M[_a]||M[vt]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=w.createElement(m),w.head.insertBefore(M,w.querySelector("head > title"))),ns(M,m,f),M[vt]=a,Kt(M),m=M;break e;case"link":var E=v0("link","href",w).get(m+(f.href||""));if(E){for(var P=0;P<E.length;P++)if(M=E[P],M.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&M.getAttribute("rel")===(f.rel==null?null:f.rel)&&M.getAttribute("title")===(f.title==null?null:f.title)&&M.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){E.splice(P,1);break t}}M=w.createElement(m),ns(M,m,f),w.head.appendChild(M);break;case"meta":if(E=v0("meta","content",w).get(m+(f.content||""))){for(P=0;P<E.length;P++)if(M=E[P],M.getAttribute("content")===(f.content==null?null:""+f.content)&&M.getAttribute("name")===(f.name==null?null:f.name)&&M.getAttribute("property")===(f.property==null?null:f.property)&&M.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&M.getAttribute("charset")===(f.charSet==null?null:f.charSet)){E.splice(P,1);break t}}M=w.createElement(m),ns(M,m,f),w.head.appendChild(M);break;default:throw Error(s(468,m))}M[vt]=a,Kt(M),m=M}a.stateNode=m}else b0(w,a.type,a.stateNode);else a.stateNode=y0(w,m,a.memoizedProps);else M!==m?(M===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):M.count--,m===null?b0(w,a.type,a.stateNode):y0(w,m,a.memoizedProps)):m===null&&a.stateNode!==null&&nh(a,a.memoizedProps,f.memoizedProps)}break;case 27:gs(l,a),ms(a),m&512&&(Ht||f===null||mn(f,f.return)),f!==null&&m&4&&nh(a,a.memoizedProps,f.memoizedProps);break;case 5:if(gs(l,a),ms(a),m&512&&(Ht||f===null||mn(f,f.return)),a.flags&32){w=a.stateNode;try{_o(w,"")}catch(xe){ct(a,a.return,xe)}}m&4&&a.stateNode!=null&&(w=a.memoizedProps,nh(a,w,f!==null?f.memoizedProps:w)),m&1024&&(ah=!0);break;case 6:if(gs(l,a),ms(a),m&4){if(a.stateNode===null)throw Error(s(162));m=a.memoizedProps,f=a.stateNode;try{f.nodeValue=m}catch(xe){ct(a,a.return,xe)}}break;case 3:if(el=null,w=Zs,Zs=Jc(l.containerInfo),gs(l,a),Zs=w,ms(a),m&4&&f!==null&&f.memoizedState.isDehydrated)try{la(l.containerInfo)}catch(xe){ct(a,a.return,xe)}ah&&(ah=!1,by(a));break;case 4:m=Zs,Zs=Jc(a.stateNode.containerInfo),gs(l,a),ms(a),Zs=m;break;case 12:gs(l,a),ms(a);break;case 31:gs(l,a),ms(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Oc(a,m)));break;case 13:gs(l,a),ms(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Hc=et()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Oc(a,m)));break;case 22:w=a.memoizedState!==null;var j=f!==null&&f.memoizedState!==null,V=Vn,ne=Ht;if(Vn=V||w,Ht=ne||j,gs(l,a),Ht=ne,Vn=V,ms(a),m&8192)e:for(l=a.stateNode,l._visibility=w?l._visibility&-2:l._visibility|1,w&&(f===null||j||Vn||Ht||co(a)),f=null,l=a;;){if(l.tag===5||l.tag===26){if(f===null){j=f=l;try{if(M=j.stateNode,w)E=M.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{P=j.stateNode;var re=j.memoizedProps.style,W=re!=null&&re.hasOwnProperty("display")?re.display:null;P.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch(xe){ct(j,j.return,xe)}}}else if(l.tag===6){if(f===null){j=l;try{j.stateNode.nodeValue=w?"":j.memoizedProps}catch(xe){ct(j,j.return,xe)}}}else if(l.tag===18){if(f===null){j=l;try{var J=j.stateNode;w?c0(J,!0):c0(j.stateNode,!1)}catch(xe){ct(j,j.return,xe)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;f===l&&(f=null),l=l.return}f===l&&(f=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=a.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,Oc(a,f))));break;case 19:gs(l,a),ms(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Oc(a,m)));break;case 30:break;case 21:break;default:gs(l,a),ms(a)}}function ms(a){var l=a.flags;if(l&2){try{for(var f,m=a.return;m!==null;){if(uy(m)){f=m;break}m=m.return}if(f==null)throw Error(s(160));switch(f.tag){case 27:var w=f.stateNode,M=ih(a);jc(a,M,w);break;case 5:var E=f.stateNode;f.flags&32&&(_o(E,""),f.flags&=-33);var P=ih(a);jc(a,P,E);break;case 3:case 4:var j=f.stateNode.containerInfo,V=ih(a);oh(a,V,j);break;default:throw Error(s(161))}}catch(ne){ct(a,a.return,ne)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function by(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;by(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function Wn(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)fy(a,l.alternate,l),l=l.sibling}function co(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:bi(4,l,l.return),co(l);break;case 1:mn(l,l.return);var f=l.stateNode;typeof f.componentWillUnmount=="function"&&cy(l,l.return,f),co(l);break;case 27:pr(l.stateNode);case 26:case 5:mn(l,l.return),co(l);break;case 22:l.memoizedState===null&&co(l);break;case 30:co(l);break;default:co(l)}a=a.sibling}}function Kn(a,l,f){for(f=f&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,w=a,M=l,E=M.flags;switch(M.tag){case 0:case 11:case 15:Kn(w,M,f),ir(4,M);break;case 1:if(Kn(w,M,f),m=M,w=m.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(V){ct(m,m.return,V)}if(m=M,w=m.updateQueue,w!==null){var P=m.stateNode;try{var j=w.shared.hiddenCallbacks;if(j!==null)for(w.shared.hiddenCallbacks=null,w=0;w<j.length;w++)Yg(j[w],P)}catch(V){ct(m,m.return,V)}}f&&E&64&&ry(M),or(M,M.return);break;case 27:dy(M);case 26:case 5:Kn(w,M,f),f&&m===null&&E&4&&ly(M),or(M,M.return);break;case 12:Kn(w,M,f);break;case 31:Kn(w,M,f),f&&E&4&&my(w,M);break;case 13:Kn(w,M,f),f&&E&4&&yy(w,M);break;case 22:M.memoizedState===null&&Kn(w,M,f),or(M,M.return);break;case 30:break;default:Kn(w,M,f)}l=l.sibling}}function rh(a,l){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&Qa(f))}function ch(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Qa(a))}function en(a,l,f,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)wy(a,l,f,m),l=l.sibling}function wy(a,l,f,m){var w=l.flags;switch(l.tag){case 0:case 11:case 15:en(a,l,f,m),w&2048&&ir(9,l);break;case 1:en(a,l,f,m);break;case 3:en(a,l,f,m),w&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Qa(a)));break;case 12:if(w&2048){en(a,l,f,m),a=l.stateNode;try{var M=l.memoizedProps,E=M.id,P=M.onPostCommit;typeof P=="function"&&P(E,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(j){ct(l,l.return,j)}}else en(a,l,f,m);break;case 31:en(a,l,f,m);break;case 13:en(a,l,f,m);break;case 23:break;case 22:M=l.stateNode,E=l.alternate,l.memoizedState!==null?M._visibility&2?en(a,l,f,m):ar(a,l):M._visibility&2?en(a,l,f,m):(M._visibility|=2,Jo(a,l,f,m,(l.subtreeFlags&10256)!==0||!1)),w&2048&&rh(E,l);break;case 24:en(a,l,f,m),w&2048&&ch(l.alternate,l);break;default:en(a,l,f,m)}}function Jo(a,l,f,m,w){for(w=w&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var M=a,E=l,P=f,j=m,V=E.flags;switch(E.tag){case 0:case 11:case 15:Jo(M,E,P,j,w),ir(8,E);break;case 23:break;case 22:var ne=E.stateNode;E.memoizedState!==null?ne._visibility&2?Jo(M,E,P,j,w):ar(M,E):(ne._visibility|=2,Jo(M,E,P,j,w)),w&&V&2048&&rh(E.alternate,E);break;case 24:Jo(M,E,P,j,w),w&&V&2048&&ch(E.alternate,E);break;default:Jo(M,E,P,j,w)}l=l.sibling}}function ar(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var f=a,m=l,w=m.flags;switch(m.tag){case 22:ar(f,m),w&2048&&rh(m.alternate,m);break;case 24:ar(f,m),w&2048&&ch(m.alternate,m);break;default:ar(f,m)}l=l.sibling}}var rr=8192;function Zo(a,l,f){if(a.subtreeFlags&rr)for(a=a.child;a!==null;)xy(a,l,f),a=a.sibling}function xy(a,l,f){switch(a.tag){case 26:Zo(a,l,f),a.flags&rr&&a.memoizedState!==null&&hR(f,Zs,a.memoizedState,a.memoizedProps);break;case 5:Zo(a,l,f);break;case 3:case 4:var m=Zs;Zs=Jc(a.stateNode.containerInfo),Zo(a,l,f),Zs=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=rr,rr=16777216,Zo(a,l,f),rr=m):Zo(a,l,f));break;default:Zo(a,l,f)}}function My(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function cr(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Yt=m,Cy(m,a)}My(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Sy(a),a=a.sibling}function Sy(a){switch(a.tag){case 0:case 11:case 15:cr(a),a.flags&2048&&bi(9,a,a.return);break;case 3:cr(a);break;case 12:cr(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,qc(a)):cr(a);break;default:cr(a)}}function qc(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Yt=m,Cy(m,a)}My(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:bi(8,l,l.return),qc(l);break;case 22:f=l.stateNode,f._visibility&2&&(f._visibility&=-3,qc(l));break;default:qc(l)}a=a.sibling}}function Cy(a,l){for(;Yt!==null;){var f=Yt;switch(f.tag){case 0:case 11:case 15:bi(8,f,l);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Qa(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,Yt=m;else e:for(f=a;Yt!==null;){m=Yt;var w=m.sibling,M=m.return;if(py(m),m===f){Yt=null;break e}if(w!==null){w.return=M,Yt=w;break e}Yt=M}}}var T1={getCacheForType:function(a){var l=ts(jt),f=l.data.get(a);return f===void 0&&(f=a(),l.data.set(a,f)),f},cacheSignal:function(){return ts(jt).controller.signal}},k1=typeof WeakMap=="function"?WeakMap:Map,nt=0,pt=null,Qe=null,Ge=0,rt=0,Es=null,wi=!1,ea=!1,lh=!1,Yn=0,Et=0,xi=0,lo=0,uh=0,Ts=0,ta=0,lr=null,ys=null,dh=!1,Hc=0,Ry=0,$c=1/0,Bc=null,Mi=null,Ut=0,Si=null,sa=null,Xn=0,hh=0,fh=null,Ey=null,ur=0,ph=null;function ks(){return(nt&2)!==0&&Ge!==0?Ge&-Ge:z.T!==null?wh():us()}function Ty(){if(Ts===0)if((Ge&536870912)===0||Je){var a=Qi;Qi<<=1,(Qi&3932160)===0&&(Qi=262144),Ts=a}else Ts=536870912;return a=Cs.current,a!==null&&(a.flags|=32),Ts}function vs(a,l,f){(a===pt&&(rt===2||rt===9)||a.cancelPendingCommit!==null)&&(na(a,0),Ci(a,Ge,Ts,!1)),we(a,f),((nt&2)===0||a!==pt)&&(a===pt&&((nt&2)===0&&(lo|=f),Et===4&&Ci(a,Ge,Ts,!1)),yn(a))}function ky(a,l,f){if((nt&6)!==0)throw Error(s(327));var m=!f&&(l&127)===0&&(l&a.expiredLanes)===0||In(a,l),w=m?P1(a,l):mh(a,l,!0),M=m;do{if(w===0){ea&&!m&&Ci(a,l,0,!1);break}else{if(f=a.current.alternate,M&&!A1(f)){w=mh(a,l,!1),M=!1;continue}if(w===2){if(M=l,a.errorRecoveryDisabledLanes&M)var E=0;else E=a.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){l=E;e:{var P=a;w=lr;var j=P.current.memoizedState.isDehydrated;if(j&&(na(P,E).flags|=256),E=mh(P,E,!1),E!==2){if(lh&&!j){P.errorRecoveryDisabledLanes|=M,lo|=M,w=4;break e}M=ys,ys=w,M!==null&&(ys===null?ys=M:ys.push.apply(ys,M))}w=E}if(M=!1,w!==2)continue}}if(w===1){na(a,0),Ci(a,l,0,!0);break}e:{switch(m=a,M=w,M){case 0:case 1:throw Error(s(345));case 4:if((l&4194048)!==l)break;case 6:Ci(m,l,Ts,!wi);break e;case 2:ys=null;break;case 3:case 5:break;default:throw Error(s(329))}if((l&62914560)===l&&(w=Hc+300-et(),10<w)){if(Ci(m,l,Ts,!wi),Ln(m,0,!0)!==0)break e;Xn=l,m.timeoutHandle=o0(Ay.bind(null,m,f,ys,Bc,dh,l,Ts,lo,ta,wi,M,"Throttled",-0,0),w);break e}Ay(m,f,ys,Bc,dh,l,Ts,lo,ta,wi,M,null,-0,0)}}break}while(!0);yn(a)}function Ay(a,l,f,m,w,M,E,P,j,V,ne,re,W,J){if(a.timeoutHandle=-1,re=l.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zn},xy(l,M,re);var xe=(M&62914560)===M?Hc-et():(M&4194048)===M?Ry-et():0;if(xe=fR(re,xe),xe!==null){Xn=M,a.cancelPendingCommit=xe(jy.bind(null,a,l,M,f,m,w,E,P,j,ne,re,null,W,J)),Ci(a,M,E,!V);return}}jy(a,l,M,f,m,w,E,P,j)}function A1(a){for(var l=a;;){var f=l.tag;if((f===0||f===11||f===15)&&l.flags&16384&&(f=l.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var w=f[m],M=w.getSnapshot;w=w.value;try{if(!Ms(M(),w))return!1}catch{return!1}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Ci(a,l,f,m){l&=~uh,l&=~lo,a.suspendedLanes|=l,a.pingedLanes&=~l,m&&(a.warmLanes|=l),m=a.expirationTimes;for(var w=l;0<w;){var M=31-Nt(w),E=1<<M;m[M]=-1,w&=~E}f!==0&&je(a,f,l)}function Uc(){return(nt&6)===0?(dr(0),!1):!0}function gh(){if(Qe!==null){if(rt===0)var a=Qe.return;else a=Qe,Hn=eo=null,Pd(a),Go=null,Ga=0,a=Qe;for(;a!==null;)ay(a.alternate,a),a=a.return;Qe=null}}function na(a,l){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,K1(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),Xn=0,gh(),pt=a,Qe=f=On(a.current,null),Ge=l,rt=0,Es=null,wi=!1,ea=In(a,l),lh=!1,ta=Ts=uh=lo=xi=Et=0,ys=lr=null,dh=!1,(l&8)!==0&&(l|=l&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=l;0<m;){var w=31-Nt(m),M=1<<w;l|=a[w],m&=~M}return Yn=l,uc(),f}function Dy(a,l){Oe=null,z.H=tr,l===Vo||l===vc?(l=Vg(),rt=3):l===bd?(l=Vg(),rt=4):rt=l===Gd?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Es=l,Qe===null&&(Et=1,_c(a,js(l,a.current)))}function Py(){var a=Cs.current;return a===null?!0:(Ge&4194048)===Ge?$s===null:(Ge&62914560)===Ge||(Ge&536870912)!==0?a===$s:!1}function _y(){var a=z.H;return z.H=tr,a===null?tr:a}function Ly(){var a=z.A;return z.A=T1,a}function Fc(){Et=4,wi||(Ge&4194048)!==Ge&&Cs.current!==null||(ea=!0),(xi&134217727)===0&&(lo&134217727)===0||pt===null||Ci(pt,Ge,Ts,!1)}function mh(a,l,f){var m=nt;nt|=2;var w=_y(),M=Ly();(pt!==a||Ge!==l)&&(Bc=null,na(a,l)),l=!1;var E=Et;e:do try{if(rt!==0&&Qe!==null){var P=Qe,j=Es;switch(rt){case 8:gh(),E=6;break e;case 3:case 2:case 9:case 6:Cs.current===null&&(l=!0);var V=rt;if(rt=0,Es=null,ia(a,P,j,V),f&&ea){E=0;break e}break;default:V=rt,rt=0,Es=null,ia(a,P,j,V)}}D1(),E=Et;break}catch(ne){Dy(a,ne)}while(!0);return l&&a.shellSuspendCounter++,Hn=eo=null,nt=m,z.H=w,z.A=M,Qe===null&&(pt=null,Ge=0,uc()),E}function D1(){for(;Qe!==null;)Iy(Qe)}function P1(a,l){var f=nt;nt|=2;var m=_y(),w=Ly();pt!==a||Ge!==l?(Bc=null,$c=et()+500,na(a,l)):ea=In(a,l);e:do try{if(rt!==0&&Qe!==null){l=Qe;var M=Es;t:switch(rt){case 1:rt=0,Es=null,ia(a,l,M,1);break;case 2:case 9:if(Fg(M)){rt=0,Es=null,Ny(l);break}l=function(){rt!==2&&rt!==9||pt!==a||(rt=7),yn(a)},M.then(l,l);break e;case 3:rt=7;break e;case 4:rt=5;break e;case 7:Fg(M)?(rt=0,Es=null,Ny(l)):(rt=0,Es=null,ia(a,l,M,7));break;case 5:var E=null;switch(Qe.tag){case 26:E=Qe.memoizedState;case 5:case 27:var P=Qe;if(E?w0(E):P.stateNode.complete){rt=0,Es=null;var j=P.sibling;if(j!==null)Qe=j;else{var V=P.return;V!==null?(Qe=V,Qc(V)):Qe=null}break t}}rt=0,Es=null,ia(a,l,M,5);break;case 6:rt=0,Es=null,ia(a,l,M,6);break;case 8:gh(),Et=6;break e;default:throw Error(s(462))}}_1();break}catch(ne){Dy(a,ne)}while(!0);return Hn=eo=null,z.H=m,z.A=w,nt=f,Qe!==null?0:(pt=null,Ge=0,uc(),Et)}function _1(){for(;Qe!==null&&!mt();)Iy(Qe)}function Iy(a){var l=iy(a.alternate,a,Yn);a.memoizedProps=a.pendingProps,l===null?Qc(a):Qe=l}function Ny(a){var l=a,f=l.alternate;switch(l.tag){case 15:case 0:l=Jm(f,l,l.pendingProps,l.type,void 0,Ge);break;case 11:l=Jm(f,l,l.pendingProps,l.type.render,l.ref,Ge);break;case 5:Pd(l);default:ay(f,l),l=Qe=Lg(l,Yn),l=iy(f,l,Yn)}a.memoizedProps=a.pendingProps,l===null?Qc(a):Qe=l}function ia(a,l,f,m){Hn=eo=null,Pd(l),Go=null,Ga=0;var w=l.return;try{if(w1(a,w,l,f,Ge)){Et=1,_c(a,js(f,a.current)),Qe=null;return}}catch(M){if(w!==null)throw Qe=w,M;Et=1,_c(a,js(f,a.current)),Qe=null;return}l.flags&32768?(Je||m===1?a=!0:ea||(Ge&536870912)!==0?a=!1:(wi=a=!0,(m===2||m===9||m===3||m===6)&&(m=Cs.current,m!==null&&m.tag===13&&(m.flags|=16384))),zy(l,a)):Qc(l)}function Qc(a){var l=a;do{if((l.flags&32768)!==0){zy(l,wi);return}a=l.return;var f=S1(l.alternate,l,Yn);if(f!==null){Qe=f;return}if(l=l.sibling,l!==null){Qe=l;return}Qe=l=a}while(l!==null);Et===0&&(Et=5)}function zy(a,l){do{var f=C1(a.alternate,a);if(f!==null){f.flags&=32767,Qe=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!l&&(a=a.sibling,a!==null)){Qe=a;return}Qe=a=f}while(a!==null);Et=6,Qe=null}function jy(a,l,f,m,w,M,E,P,j){a.cancelPendingCommit=null;do Vc();while(Ut!==0);if((nt&6)!==0)throw Error(s(327));if(l!==null){if(l===a.current)throw Error(s(177));if(M=l.lanes|l.childLanes,M|=id,Ne(a,f,M,E,P,j),a===pt&&(Qe=pt=null,Ge=0),sa=l,Si=a,Xn=f,hh=M,fh=w,Ey=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,z1(Xt,function(){return By(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=z.T,z.T=null,w=I.p,I.p=2,E=nt,nt|=4;try{R1(a,l,f)}finally{nt=E,I.p=w,z.T=m}}Ut=1,Oy(),qy(),Hy()}}function Oy(){if(Ut===1){Ut=0;var a=Si,l=sa,f=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||f){f=z.T,z.T=null;var m=I.p;I.p=2;var w=nt;nt|=4;try{vy(l,a);var M=kh,E=Cg(a.containerInfo),P=M.focusedElem,j=M.selectionRange;if(E!==P&&P&&P.ownerDocument&&Sg(P.ownerDocument.documentElement,P)){if(j!==null&&Zu(P)){var V=j.start,ne=j.end;if(ne===void 0&&(ne=V),"selectionStart"in P)P.selectionStart=V,P.selectionEnd=Math.min(ne,P.value.length);else{var re=P.ownerDocument||document,W=re&&re.defaultView||window;if(W.getSelection){var J=W.getSelection(),xe=P.textContent.length,_e=Math.min(j.start,xe),ht=j.end===void 0?_e:Math.min(j.end,xe);!J.extend&&_e>ht&&(E=ht,ht=_e,_e=E);var $=Mg(P,_e),H=Mg(P,ht);if($&&H&&(J.rangeCount!==1||J.anchorNode!==$.node||J.anchorOffset!==$.offset||J.focusNode!==H.node||J.focusOffset!==H.offset)){var Q=re.createRange();Q.setStart($.node,$.offset),J.removeAllRanges(),_e>ht?(J.addRange(Q),J.extend(H.node,H.offset)):(Q.setEnd(H.node,H.offset),J.addRange(Q))}}}}for(re=[],J=P;J=J.parentNode;)J.nodeType===1&&re.push({element:J,left:J.scrollLeft,top:J.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<re.length;P++){var ae=re[P];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}il=!!Th,kh=Th=null}finally{nt=w,I.p=m,z.T=f}}a.current=l,Ut=2}}function qy(){if(Ut===2){Ut=0;var a=Si,l=sa,f=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||f){f=z.T,z.T=null;var m=I.p;I.p=2;var w=nt;nt|=4;try{fy(a,l.alternate,l)}finally{nt=w,I.p=m,z.T=f}}Ut=3}}function Hy(){if(Ut===4||Ut===3){Ut=0,$t();var a=Si,l=sa,f=Xn,m=Ey;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Ut=5:(Ut=0,sa=Si=null,$y(a,a.pendingLanes));var w=a.pendingLanes;if(w===0&&(Mi=null),At(f),l=l.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(hn,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=z.T,w=I.p,I.p=2,z.T=null;try{for(var M=a.onRecoverableError,E=0;E<m.length;E++){var P=m[E];M(P.value,{componentStack:P.stack})}}finally{z.T=l,I.p=w}}(Xn&3)!==0&&Vc(),yn(a),w=a.pendingLanes,(f&261930)!==0&&(w&42)!==0?a===ph?ur++:(ur=0,ph=a):ur=0,dr(0)}}function $y(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,Qa(l)))}function Vc(){return Oy(),qy(),Hy(),By()}function By(){if(Ut!==5)return!1;var a=Si,l=hh;hh=0;var f=At(Xn),m=z.T,w=I.p;try{I.p=32>f?32:f,z.T=null,f=fh,fh=null;var M=Si,E=Xn;if(Ut=0,sa=Si=null,Xn=0,(nt&6)!==0)throw Error(s(331));var P=nt;if(nt|=4,Sy(M.current),wy(M,M.current,E,f),nt=P,dr(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(hn,M)}catch{}return!0}finally{I.p=w,z.T=m,$y(a,l)}}function Uy(a,l,f){l=js(f,l),l=Vd(a.stateNode,l,2),a=mi(a,l,2),a!==null&&(we(a,2),yn(a))}function ct(a,l,f){if(a.tag===3)Uy(a,a,f);else for(;l!==null;){if(l.tag===3){Uy(l,a,f);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Mi===null||!Mi.has(m))){a=js(f,a),f=Fm(2),m=mi(l,f,2),m!==null&&(Qm(f,m,l,a),we(m,2),yn(m));break}}l=l.return}}function yh(a,l,f){var m=a.pingCache;if(m===null){m=a.pingCache=new k1;var w=new Set;m.set(l,w)}else w=m.get(l),w===void 0&&(w=new Set,m.set(l,w));w.has(f)||(lh=!0,w.add(f),a=L1.bind(null,a,l,f),l.then(a,a))}function L1(a,l,f){var m=a.pingCache;m!==null&&m.delete(l),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,pt===a&&(Ge&f)===f&&(Et===4||Et===3&&(Ge&62914560)===Ge&&300>et()-Hc?(nt&2)===0&&na(a,0):uh|=f,ta===Ge&&(ta=0)),yn(a)}function Fy(a,l){l===0&&(l=ee()),a=Xi(a,l),a!==null&&(we(a,l),yn(a))}function I1(a){var l=a.memoizedState,f=0;l!==null&&(f=l.retryLane),Fy(a,f)}function N1(a,l){var f=0;switch(a.tag){case 31:case 13:var m=a.stateNode,w=a.memoizedState;w!==null&&(f=w.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(l),Fy(a,f)}function z1(a,l){return Ue(a,l)}var Gc=null,oa=null,vh=!1,Wc=!1,bh=!1,Ri=0;function yn(a){a!==oa&&a.next===null&&(oa===null?Gc=oa=a:oa=oa.next=a),Wc=!0,vh||(vh=!0,O1())}function dr(a,l){if(!bh&&Wc){bh=!0;do for(var f=!1,m=Gc;m!==null;){if(a!==0){var w=m.pendingLanes;if(w===0)var M=0;else{var E=m.suspendedLanes,P=m.pingedLanes;M=(1<<31-Nt(42|a)+1)-1,M&=w&~(E&~P),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(f=!0,Wy(m,M))}else M=Ge,M=Ln(m,m===pt?M:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(M&3)===0||In(m,M)||(f=!0,Wy(m,M));m=m.next}while(f);bh=!1}}function j1(){Qy()}function Qy(){Wc=vh=!1;var a=0;Ri!==0&&W1()&&(a=Ri);for(var l=et(),f=null,m=Gc;m!==null;){var w=m.next,M=Vy(m,l);M===0?(m.next=null,f===null?Gc=w:f.next=w,w===null&&(oa=f)):(f=m,(a!==0||(M&3)!==0)&&(Wc=!0)),m=w}Ut!==0&&Ut!==5||dr(a),Ri!==0&&(Ri=0)}function Vy(a,l){for(var f=a.suspendedLanes,m=a.pingedLanes,w=a.expirationTimes,M=a.pendingLanes&-62914561;0<M;){var E=31-Nt(M),P=1<<E,j=w[E];j===-1?((P&f)===0||(P&m)!==0)&&(w[E]=Nu(P,l)):j<=l&&(a.expiredLanes|=P),M&=~P}if(l=pt,f=Ge,f=Ln(a,a===l?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,f===0||a===l&&(rt===2||rt===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&bt(m),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||In(a,f)){if(l=f&-f,l===a.callbackPriority)return l;switch(m!==null&&bt(m),At(f)){case 2:case 8:f=yt;break;case 32:f=Xt;break;case 268435456:f=Pn;break;default:f=Xt}return m=Gy.bind(null,a),f=Ue(f,m),a.callbackPriority=l,a.callbackNode=f,l}return m!==null&&m!==null&&bt(m),a.callbackPriority=2,a.callbackNode=null,2}function Gy(a,l){if(Ut!==0&&Ut!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Vc()&&a.callbackNode!==f)return null;var m=Ge;return m=Ln(a,a===pt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(ky(a,m,l),Vy(a,et()),a.callbackNode!=null&&a.callbackNode===f?Gy.bind(null,a):null)}function Wy(a,l){if(Vc())return null;ky(a,l,!0)}function O1(){Y1(function(){(nt&6)!==0?Ue(wt,j1):Qy()})}function wh(){if(Ri===0){var a=Fo;a===0&&(a=_n,_n<<=1,(_n&261888)===0&&(_n=256)),Ri=a}return Ri}function Ky(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:sc(""+a)}function Yy(a,l){var f=l.ownerDocument.createElement("input");return f.name=l.name,f.value=l.value,a.id&&f.setAttribute("form",a.id),l.parentNode.insertBefore(f,l),a=new FormData(a),f.parentNode.removeChild(f),a}function q1(a,l,f,m,w){if(l==="submit"&&f&&f.stateNode===w){var M=Ky((w[Bt]||null).action),E=m.submitter;E&&(l=(l=E[Bt]||null)?Ky(l.formAction):E.getAttribute("formAction"),l!==null&&(M=l,E=null));var P=new ac("action","action",null,m,w);a.push({event:P,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Ri!==0){var j=E?Yy(w,E):new FormData(w);Hd(f,{pending:!0,data:j,method:w.method,action:M},null,j)}}else typeof M=="function"&&(P.preventDefault(),j=E?Yy(w,E):new FormData(w),Hd(f,{pending:!0,data:j,method:w.method,action:M},M,j))},currentTarget:w}]})}}for(var xh=0;xh<nd.length;xh++){var Mh=nd[xh],H1=Mh.toLowerCase(),$1=Mh[0].toUpperCase()+Mh.slice(1);Js(H1,"on"+$1)}Js(Tg,"onAnimationEnd"),Js(kg,"onAnimationIteration"),Js(Ag,"onAnimationStart"),Js("dblclick","onDoubleClick"),Js("focusin","onFocus"),Js("focusout","onBlur"),Js(n1,"onTransitionRun"),Js(i1,"onTransitionStart"),Js(o1,"onTransitionCancel"),Js(Dg,"onTransitionEnd"),Do("onMouseEnter",["mouseout","mouseover"]),Do("onMouseLeave",["mouseout","mouseover"]),Do("onPointerEnter",["pointerout","pointerover"]),Do("onPointerLeave",["pointerout","pointerover"]),Gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),B1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hr));function Xy(a,l){l=(l&4)!==0;for(var f=0;f<a.length;f++){var m=a[f],w=m.event;m=m.listeners;e:{var M=void 0;if(l)for(var E=m.length-1;0<=E;E--){var P=m[E],j=P.instance,V=P.currentTarget;if(P=P.listener,j!==M&&w.isPropagationStopped())break e;M=P,w.currentTarget=V;try{M(w)}catch(ne){lc(ne)}w.currentTarget=null,M=j}else for(E=0;E<m.length;E++){if(P=m[E],j=P.instance,V=P.currentTarget,P=P.listener,j!==M&&w.isPropagationStopped())break e;M=P,w.currentTarget=V;try{M(w)}catch(ne){lc(ne)}w.currentTarget=null,M=j}}}}function Ve(a,l){var f=l[Fe];f===void 0&&(f=l[Fe]=new Set);var m=a+"__bubble";f.has(m)||(Jy(l,a,2,!1),f.add(m))}function Sh(a,l,f){var m=0;l&&(m|=4),Jy(f,a,m,l)}var Kc="_reactListening"+Math.random().toString(36).slice(2);function Ch(a){if(!a[Kc]){a[Kc]=!0,Qp.forEach(function(f){f!=="selectionchange"&&(B1.has(f)||Sh(f,!1,a),Sh(f,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[Kc]||(l[Kc]=!0,Sh("selectionchange",!1,l))}}function Jy(a,l,f,m){switch(T0(l)){case 2:var w=mR;break;case 8:w=yR;break;default:w=qh}f=w.bind(null,l,f,a),w=void 0,!Fu||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(w=!0),m?w!==void 0?a.addEventListener(l,f,{capture:!0,passive:w}):a.addEventListener(l,f,!0):w!==void 0?a.addEventListener(l,f,{passive:w}):a.addEventListener(l,f,!1)}function Rh(a,l,f,m,w){var M=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var E=m.tag;if(E===3||E===4){var P=m.stateNode.containerInfo;if(P===w)break;if(E===4)for(E=m.return;E!==null;){var j=E.tag;if((j===3||j===4)&&E.stateNode.containerInfo===w)return;E=E.return}for(;P!==null;){if(E=To(P),E===null)return;if(j=E.tag,j===5||j===6||j===26||j===27){m=M=E;continue e}P=P.parentNode}}m=m.return}ng(function(){var V=M,ne=Bu(f),re=[];e:{var W=Pg.get(a);if(W!==void 0){var J=ac,xe=a;switch(a){case"keypress":if(ic(f)===0)break e;case"keydown":case"keyup":J=NC;break;case"focusin":xe="focus",J=Wu;break;case"focusout":xe="blur",J=Wu;break;case"beforeblur":case"afterblur":J=Wu;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=ag;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=SC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=OC;break;case Tg:case kg:case Ag:J=EC;break;case Dg:J=HC;break;case"scroll":case"scrollend":J=xC;break;case"wheel":J=BC;break;case"copy":case"cut":case"paste":J=kC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=cg;break;case"toggle":case"beforetoggle":J=FC}var _e=(l&4)!==0,ht=!_e&&(a==="scroll"||a==="scrollend"),$=_e?W!==null?W+"Capture":null:W;_e=[];for(var H=V,Q;H!==null;){var ae=H;if(Q=ae.stateNode,ae=ae.tag,ae!==5&&ae!==26&&ae!==27||Q===null||$===null||(ae=Ia(H,$),ae!=null&&_e.push(fr(H,ae,Q))),ht)break;H=H.return}0<_e.length&&(W=new J(W,xe,null,f,ne),re.push({event:W,listeners:_e}))}}if((l&7)===0){e:{if(W=a==="mouseover"||a==="pointerover",J=a==="mouseout"||a==="pointerout",W&&f!==$u&&(xe=f.relatedTarget||f.fromElement)&&(To(xe)||xe[fn]))break e;if((J||W)&&(W=ne.window===ne?ne:(W=ne.ownerDocument)?W.defaultView||W.parentWindow:window,J?(xe=f.relatedTarget||f.toElement,J=V,xe=xe?To(xe):null,xe!==null&&(ht=i(xe),_e=xe.tag,xe!==ht||_e!==5&&_e!==27&&_e!==6)&&(xe=null)):(J=null,xe=V),J!==xe)){if(_e=ag,ae="onMouseLeave",$="onMouseEnter",H="mouse",(a==="pointerout"||a==="pointerover")&&(_e=cg,ae="onPointerLeave",$="onPointerEnter",H="pointer"),ht=J==null?W:La(J),Q=xe==null?W:La(xe),W=new _e(ae,H+"leave",J,f,ne),W.target=ht,W.relatedTarget=Q,ae=null,To(ne)===V&&(_e=new _e($,H+"enter",xe,f,ne),_e.target=Q,_e.relatedTarget=ht,ae=_e),ht=ae,J&&xe)t:{for(_e=U1,$=J,H=xe,Q=0,ae=$;ae;ae=_e(ae))Q++;ae=0;for(var Ae=H;Ae;Ae=_e(Ae))ae++;for(;0<Q-ae;)$=_e($),Q--;for(;0<ae-Q;)H=_e(H),ae--;for(;Q--;){if($===H||H!==null&&$===H.alternate){_e=$;break t}$=_e($),H=_e(H)}_e=null}else _e=null;J!==null&&Zy(re,W,J,_e,!1),xe!==null&&ht!==null&&Zy(re,ht,xe,_e,!0)}}e:{if(W=V?La(V):window,J=W.nodeName&&W.nodeName.toLowerCase(),J==="select"||J==="input"&&W.type==="file")var tt=mg;else if(pg(W))if(yg)tt=e1;else{tt=JC;var Re=XC}else J=W.nodeName,!J||J.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?V&&Hu(V.elementType)&&(tt=mg):tt=ZC;if(tt&&(tt=tt(a,V))){gg(re,tt,f,ne);break e}Re&&Re(a,W,V),a==="focusout"&&V&&W.type==="number"&&V.memoizedProps.value!=null&&qu(W,"number",W.value)}switch(Re=V?La(V):window,a){case"focusin":(pg(Re)||Re.contentEditable==="true")&&(zo=Re,ed=V,Ba=null);break;case"focusout":Ba=ed=zo=null;break;case"mousedown":td=!0;break;case"contextmenu":case"mouseup":case"dragend":td=!1,Rg(re,f,ne);break;case"selectionchange":if(s1)break;case"keydown":case"keyup":Rg(re,f,ne)}var qe;if(Yu)e:{switch(a){case"compositionstart":var We="onCompositionStart";break e;case"compositionend":We="onCompositionEnd";break e;case"compositionupdate":We="onCompositionUpdate";break e}We=void 0}else No?hg(a,f)&&(We="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(We="onCompositionStart");We&&(lg&&f.locale!=="ko"&&(No||We!=="onCompositionStart"?We==="onCompositionEnd"&&No&&(qe=ig()):(li=ne,Qu="value"in li?li.value:li.textContent,No=!0)),Re=Yc(V,We),0<Re.length&&(We=new rg(We,a,null,f,ne),re.push({event:We,listeners:Re}),qe?We.data=qe:(qe=fg(f),qe!==null&&(We.data=qe)))),(qe=VC?GC(a,f):WC(a,f))&&(We=Yc(V,"onBeforeInput"),0<We.length&&(Re=new rg("onBeforeInput","beforeinput",null,f,ne),re.push({event:Re,listeners:We}),Re.data=qe)),q1(re,a,V,f,ne)}Xy(re,l)})}function fr(a,l,f){return{instance:a,listener:l,currentTarget:f}}function Yc(a,l){for(var f=l+"Capture",m=[];a!==null;){var w=a,M=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||M===null||(w=Ia(a,f),w!=null&&m.unshift(fr(a,w,M)),w=Ia(a,l),w!=null&&m.push(fr(a,w,M))),a.tag===3)return m;a=a.return}return[]}function U1(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Zy(a,l,f,m,w){for(var M=l._reactName,E=[];f!==null&&f!==m;){var P=f,j=P.alternate,V=P.stateNode;if(P=P.tag,j!==null&&j===m)break;P!==5&&P!==26&&P!==27||V===null||(j=V,w?(V=Ia(f,M),V!=null&&E.unshift(fr(f,V,j))):w||(V=Ia(f,M),V!=null&&E.push(fr(f,V,j)))),f=f.return}E.length!==0&&a.push({event:l,listeners:E})}var F1=/\r\n?/g,Q1=/\u0000|\uFFFD/g;function e0(a){return(typeof a=="string"?a:""+a).replace(F1,`
`).replace(Q1,"")}function t0(a,l){return l=e0(l),e0(a)===l}function dt(a,l,f,m,w,M){switch(f){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||_o(a,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&_o(a,""+m);break;case"className":ec(a,"class",m);break;case"tabIndex":ec(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":ec(a,f,m);break;case"style":tg(a,m,M);break;case"data":if(l!=="object"){ec(a,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||f!=="href")){a.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=sc(""+m),a.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(f==="formAction"?(l!=="input"&&dt(a,l,"name",w.name,w,null),dt(a,l,"formEncType",w.formEncType,w,null),dt(a,l,"formMethod",w.formMethod,w,null),dt(a,l,"formTarget",w.formTarget,w,null)):(dt(a,l,"encType",w.encType,w,null),dt(a,l,"method",w.method,w,null),dt(a,l,"target",w.target,w,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=sc(""+m),a.setAttribute(f,m);break;case"onClick":m!=null&&(a.onclick=zn);break;case"onScroll":m!=null&&Ve("scroll",a);break;case"onScrollEnd":m!=null&&Ve("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(f=m.__html,f!=null){if(w.children!=null)throw Error(s(60));a.innerHTML=f}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}f=sc(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""+m):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":m===!0?a.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,m):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(f,m):a.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(f):a.setAttribute(f,m);break;case"popover":Ve("beforetoggle",a),Ve("toggle",a),Zr(a,"popover",m);break;case"xlinkActuate":Nn(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Nn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Nn(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Nn(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Nn(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Nn(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Nn(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Nn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Nn(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Zr(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=bC.get(f)||f,Zr(a,f,m))}}function Eh(a,l,f,m,w,M){switch(f){case"style":tg(a,m,M);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(f=m.__html,f!=null){if(w.children!=null)throw Error(s(60));a.innerHTML=f}}break;case"children":typeof m=="string"?_o(a,m):(typeof m=="number"||typeof m=="bigint")&&_o(a,""+m);break;case"onScroll":m!=null&&Ve("scroll",a);break;case"onScrollEnd":m!=null&&Ve("scrollend",a);break;case"onClick":m!=null&&(a.onclick=zn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Vp.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(w=f.endsWith("Capture"),l=f.slice(2,w?f.length-7:void 0),M=a[Bt]||null,M=M!=null?M[f]:null,typeof M=="function"&&a.removeEventListener(l,M,w),typeof m=="function")){typeof M!="function"&&M!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(l,m,w);break e}f in a?a[f]=m:m===!0?a.setAttribute(f,""):Zr(a,f,m)}}}function ns(a,l,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ve("error",a),Ve("load",a);var m=!1,w=!1,M;for(M in f)if(f.hasOwnProperty(M)){var E=f[M];if(E!=null)switch(M){case"src":m=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,l));default:dt(a,l,M,E,f,null)}}w&&dt(a,l,"srcSet",f.srcSet,f,null),m&&dt(a,l,"src",f.src,f,null);return;case"input":Ve("invalid",a);var P=M=E=w=null,j=null,V=null;for(m in f)if(f.hasOwnProperty(m)){var ne=f[m];if(ne!=null)switch(m){case"name":w=ne;break;case"type":E=ne;break;case"checked":j=ne;break;case"defaultChecked":V=ne;break;case"value":M=ne;break;case"defaultValue":P=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(s(137,l));break;default:dt(a,l,m,ne,f,null)}}Xp(a,M,P,j,V,E,w,!1);return;case"select":Ve("invalid",a),m=E=M=null;for(w in f)if(f.hasOwnProperty(w)&&(P=f[w],P!=null))switch(w){case"value":M=P;break;case"defaultValue":E=P;break;case"multiple":m=P;default:dt(a,l,w,P,f,null)}l=M,f=E,a.multiple=!!m,l!=null?Po(a,!!m,l,!1):f!=null&&Po(a,!!m,f,!0);return;case"textarea":Ve("invalid",a),M=w=m=null;for(E in f)if(f.hasOwnProperty(E)&&(P=f[E],P!=null))switch(E){case"value":m=P;break;case"defaultValue":w=P;break;case"children":M=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(s(91));break;default:dt(a,l,E,P,f,null)}Zp(a,m,w,M);return;case"option":for(j in f)if(f.hasOwnProperty(j)&&(m=f[j],m!=null))switch(j){case"selected":a.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:dt(a,l,j,m,f,null)}return;case"dialog":Ve("beforetoggle",a),Ve("toggle",a),Ve("cancel",a),Ve("close",a);break;case"iframe":case"object":Ve("load",a);break;case"video":case"audio":for(m=0;m<hr.length;m++)Ve(hr[m],a);break;case"image":Ve("error",a),Ve("load",a);break;case"details":Ve("toggle",a);break;case"embed":case"source":case"link":Ve("error",a),Ve("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in f)if(f.hasOwnProperty(V)&&(m=f[V],m!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,l));default:dt(a,l,V,m,f,null)}return;default:if(Hu(l)){for(ne in f)f.hasOwnProperty(ne)&&(m=f[ne],m!==void 0&&Eh(a,l,ne,m,f,void 0));return}}for(P in f)f.hasOwnProperty(P)&&(m=f[P],m!=null&&dt(a,l,P,m,f,null))}function V1(a,l,f,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,M=null,E=null,P=null,j=null,V=null,ne=null;for(J in f){var re=f[J];if(f.hasOwnProperty(J)&&re!=null)switch(J){case"checked":break;case"value":break;case"defaultValue":j=re;default:m.hasOwnProperty(J)||dt(a,l,J,null,m,re)}}for(var W in m){var J=m[W];if(re=f[W],m.hasOwnProperty(W)&&(J!=null||re!=null))switch(W){case"type":M=J;break;case"name":w=J;break;case"checked":V=J;break;case"defaultChecked":ne=J;break;case"value":E=J;break;case"defaultValue":P=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(s(137,l));break;default:J!==re&&dt(a,l,W,J,m,re)}}Ou(a,E,P,j,V,ne,M,w);return;case"select":J=E=P=W=null;for(M in f)if(j=f[M],f.hasOwnProperty(M)&&j!=null)switch(M){case"value":break;case"multiple":J=j;default:m.hasOwnProperty(M)||dt(a,l,M,null,m,j)}for(w in m)if(M=m[w],j=f[w],m.hasOwnProperty(w)&&(M!=null||j!=null))switch(w){case"value":W=M;break;case"defaultValue":P=M;break;case"multiple":E=M;default:M!==j&&dt(a,l,w,M,m,j)}l=P,f=E,m=J,W!=null?Po(a,!!f,W,!1):!!m!=!!f&&(l!=null?Po(a,!!f,l,!0):Po(a,!!f,f?[]:"",!1));return;case"textarea":J=W=null;for(P in f)if(w=f[P],f.hasOwnProperty(P)&&w!=null&&!m.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:dt(a,l,P,null,m,w)}for(E in m)if(w=m[E],M=f[E],m.hasOwnProperty(E)&&(w!=null||M!=null))switch(E){case"value":W=w;break;case"defaultValue":J=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(s(91));break;default:w!==M&&dt(a,l,E,w,m,M)}Jp(a,W,J);return;case"option":for(var xe in f)if(W=f[xe],f.hasOwnProperty(xe)&&W!=null&&!m.hasOwnProperty(xe))switch(xe){case"selected":a.selected=!1;break;default:dt(a,l,xe,null,m,W)}for(j in m)if(W=m[j],J=f[j],m.hasOwnProperty(j)&&W!==J&&(W!=null||J!=null))switch(j){case"selected":a.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:dt(a,l,j,W,m,J)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _e in f)W=f[_e],f.hasOwnProperty(_e)&&W!=null&&!m.hasOwnProperty(_e)&&dt(a,l,_e,null,m,W);for(V in m)if(W=m[V],J=f[V],m.hasOwnProperty(V)&&W!==J&&(W!=null||J!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(s(137,l));break;default:dt(a,l,V,W,m,J)}return;default:if(Hu(l)){for(var ht in f)W=f[ht],f.hasOwnProperty(ht)&&W!==void 0&&!m.hasOwnProperty(ht)&&Eh(a,l,ht,void 0,m,W);for(ne in m)W=m[ne],J=f[ne],!m.hasOwnProperty(ne)||W===J||W===void 0&&J===void 0||Eh(a,l,ne,W,m,J);return}}for(var $ in f)W=f[$],f.hasOwnProperty($)&&W!=null&&!m.hasOwnProperty($)&&dt(a,l,$,null,m,W);for(re in m)W=m[re],J=f[re],!m.hasOwnProperty(re)||W===J||W==null&&J==null||dt(a,l,re,W,m,J)}function s0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function G1(){if(typeof performance.getEntriesByType=="function"){for(var a=0,l=0,f=performance.getEntriesByType("resource"),m=0;m<f.length;m++){var w=f[m],M=w.transferSize,E=w.initiatorType,P=w.duration;if(M&&P&&s0(E)){for(E=0,P=w.responseEnd,m+=1;m<f.length;m++){var j=f[m],V=j.startTime;if(V>P)break;var ne=j.transferSize,re=j.initiatorType;ne&&s0(re)&&(j=j.responseEnd,E+=ne*(j<P?1:(P-V)/(j-V)))}if(--m,l+=8*(M+E)/(w.duration/1e3),a++,10<a)break}}if(0<a)return l/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Th=null,kh=null;function Xc(a){return a.nodeType===9?a:a.ownerDocument}function n0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function i0(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function Ah(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Dh=null;function W1(){var a=window.event;return a&&a.type==="popstate"?a===Dh?!1:(Dh=a,!0):(Dh=null,!1)}var o0=typeof setTimeout=="function"?setTimeout:void 0,K1=typeof clearTimeout=="function"?clearTimeout:void 0,a0=typeof Promise=="function"?Promise:void 0,Y1=typeof queueMicrotask=="function"?queueMicrotask:typeof a0<"u"?function(a){return a0.resolve(null).then(a).catch(X1)}:o0;function X1(a){setTimeout(function(){throw a})}function Ei(a){return a==="head"}function r0(a,l){var f=l,m=0;do{var w=f.nextSibling;if(a.removeChild(f),w&&w.nodeType===8)if(f=w.data,f==="/$"||f==="/&"){if(m===0){a.removeChild(w),la(l);return}m--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")m++;else if(f==="html")pr(a.ownerDocument.documentElement);else if(f==="head"){f=a.ownerDocument.head,pr(f);for(var M=f.firstChild;M;){var E=M.nextSibling,P=M.nodeName;M[_a]||P==="SCRIPT"||P==="STYLE"||P==="LINK"&&M.rel.toLowerCase()==="stylesheet"||f.removeChild(M),M=E}}else f==="body"&&pr(a.ownerDocument.body);f=w}while(f);la(l)}function c0(a,l){var f=a;a=0;do{var m=f.nextSibling;if(f.nodeType===1?l?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(l?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),m&&m.nodeType===8)if(f=m.data,f==="/$"){if(a===0)break;a--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||a++;f=m}while(f)}function Ph(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var f=l;switch(l=l.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":Ph(f),zu(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function J1(a,l,f,m){for(;a.nodeType===1;){var w=f;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[_a])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(M=a.getAttribute("rel"),M==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(M!==w.rel||a.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||a.getAttribute("title")!==(w.title==null?null:w.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(M=a.getAttribute("src"),(M!==(w.src==null?null:w.src)||a.getAttribute("type")!==(w.type==null?null:w.type)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&M&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var M=w.name==null?null:""+w.name;if(w.type==="hidden"&&a.getAttribute("name")===M)return a}else return a;if(a=Bs(a.nextSibling),a===null)break}return null}function Z1(a,l,f){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=Bs(a.nextSibling),a===null))return null;return a}function l0(a,l){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=Bs(a.nextSibling),a===null))return null;return a}function _h(a){return a.data==="$?"||a.data==="$~"}function Lh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function eR(a,l){var f=a.ownerDocument;if(a.data==="$~")a._reactRetry=l;else if(a.data!=="$?"||f.readyState!=="loading")l();else{var m=function(){l(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function Bs(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return a}var Ih=null;function u0(a){a=a.nextSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="/$"||f==="/&"){if(l===0)return Bs(a.nextSibling);l--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||l++}a=a.nextSibling}return null}function d0(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(l===0)return a;l--}else f!=="/$"&&f!=="/&"||l++}a=a.previousSibling}return null}function h0(a,l,f){switch(l=Xc(f),a){case"html":if(a=l.documentElement,!a)throw Error(s(452));return a;case"head":if(a=l.head,!a)throw Error(s(453));return a;case"body":if(a=l.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function pr(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);zu(a)}var Us=new Map,f0=new Set;function Jc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Jn=I.d;I.d={f:tR,r:sR,D:nR,C:iR,L:oR,m:aR,X:cR,S:rR,M:lR};function tR(){var a=Jn.f(),l=Uc();return a||l}function sR(a){var l=ko(a);l!==null&&l.tag===5&&l.type==="form"?Dm(l):Jn.r(a)}var aa=typeof document>"u"?null:document;function p0(a,l,f){var m=aa;if(m&&typeof l=="string"&&l){var w=Ns(l);w='link[rel="'+a+'"][href="'+w+'"]',typeof f=="string"&&(w+='[crossorigin="'+f+'"]'),f0.has(w)||(f0.add(w),a={rel:a,crossOrigin:f,href:l},m.querySelector(w)===null&&(l=m.createElement("link"),ns(l,"link",a),Kt(l),m.head.appendChild(l)))}}function nR(a){Jn.D(a),p0("dns-prefetch",a,null)}function iR(a,l){Jn.C(a,l),p0("preconnect",a,l)}function oR(a,l,f){Jn.L(a,l,f);var m=aa;if(m&&a&&l){var w='link[rel="preload"][as="'+Ns(l)+'"]';l==="image"&&f&&f.imageSrcSet?(w+='[imagesrcset="'+Ns(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(w+='[imagesizes="'+Ns(f.imageSizes)+'"]')):w+='[href="'+Ns(a)+'"]';var M=w;switch(l){case"style":M=ra(a);break;case"script":M=ca(a)}Us.has(M)||(a=p({rel:"preload",href:l==="image"&&f&&f.imageSrcSet?void 0:a,as:l},f),Us.set(M,a),m.querySelector(w)!==null||l==="style"&&m.querySelector(gr(M))||l==="script"&&m.querySelector(mr(M))||(l=m.createElement("link"),ns(l,"link",a),Kt(l),m.head.appendChild(l)))}}function aR(a,l){Jn.m(a,l);var f=aa;if(f&&a){var m=l&&typeof l.as=="string"?l.as:"script",w='link[rel="modulepreload"][as="'+Ns(m)+'"][href="'+Ns(a)+'"]',M=w;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=ca(a)}if(!Us.has(M)&&(a=p({rel:"modulepreload",href:a},l),Us.set(M,a),f.querySelector(w)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(mr(M)))return}m=f.createElement("link"),ns(m,"link",a),Kt(m),f.head.appendChild(m)}}}function rR(a,l,f){Jn.S(a,l,f);var m=aa;if(m&&a){var w=Ao(m).hoistableStyles,M=ra(a);l=l||"default";var E=w.get(M);if(!E){var P={loading:0,preload:null};if(E=m.querySelector(gr(M)))P.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":l},f),(f=Us.get(M))&&Nh(a,f);var j=E=m.createElement("link");Kt(j),ns(j,"link",a),j._p=new Promise(function(V,ne){j.onload=V,j.onerror=ne}),j.addEventListener("load",function(){P.loading|=1}),j.addEventListener("error",function(){P.loading|=2}),P.loading|=4,Zc(E,l,m)}E={type:"stylesheet",instance:E,count:1,state:P},w.set(M,E)}}}function cR(a,l){Jn.X(a,l);var f=aa;if(f&&a){var m=Ao(f).hoistableScripts,w=ca(a),M=m.get(w);M||(M=f.querySelector(mr(w)),M||(a=p({src:a,async:!0},l),(l=Us.get(w))&&zh(a,l),M=f.createElement("script"),Kt(M),ns(M,"link",a),f.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},m.set(w,M))}}function lR(a,l){Jn.M(a,l);var f=aa;if(f&&a){var m=Ao(f).hoistableScripts,w=ca(a),M=m.get(w);M||(M=f.querySelector(mr(w)),M||(a=p({src:a,async:!0,type:"module"},l),(l=Us.get(w))&&zh(a,l),M=f.createElement("script"),Kt(M),ns(M,"link",a),f.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},m.set(w,M))}}function g0(a,l,f,m){var w=(w=oe.current)?Jc(w):null;if(!w)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(l=ra(f.href),f=Ao(w).hoistableStyles,m=f.get(l),m||(m={type:"style",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=ra(f.href);var M=Ao(w).hoistableStyles,E=M.get(a);if(E||(w=w.ownerDocument||w,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(a,E),(M=w.querySelector(gr(a)))&&!M._p&&(E.instance=M,E.state.loading=5),Us.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},Us.set(a,f),M||uR(w,a,f,E.state))),l&&m===null)throw Error(s(528,""));return E}if(l&&m!==null)throw Error(s(529,""));return null;case"script":return l=f.async,f=f.src,typeof f=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=ca(f),f=Ao(w).hoistableScripts,m=f.get(l),m||(m={type:"script",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function ra(a){return'href="'+Ns(a)+'"'}function gr(a){return'link[rel="stylesheet"]['+a+"]"}function m0(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function uR(a,l,f,m){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=a.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),ns(l,"link",f),Kt(l),a.head.appendChild(l))}function ca(a){return'[src="'+Ns(a)+'"]'}function mr(a){return"script[async]"+a}function y0(a,l,f){if(l.count++,l.instance===null)switch(l.type){case"style":var m=a.querySelector('style[data-href~="'+Ns(f.href)+'"]');if(m)return l.instance=m,Kt(m),m;var w=p({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),Kt(m),ns(m,"style",w),Zc(m,f.precedence,a),l.instance=m;case"stylesheet":w=ra(f.href);var M=a.querySelector(gr(w));if(M)return l.state.loading|=4,l.instance=M,Kt(M),M;m=m0(f),(w=Us.get(w))&&Nh(m,w),M=(a.ownerDocument||a).createElement("link"),Kt(M);var E=M;return E._p=new Promise(function(P,j){E.onload=P,E.onerror=j}),ns(M,"link",m),l.state.loading|=4,Zc(M,f.precedence,a),l.instance=M;case"script":return M=ca(f.src),(w=a.querySelector(mr(M)))?(l.instance=w,Kt(w),w):(m=f,(w=Us.get(M))&&(m=p({},f),zh(m,w)),a=a.ownerDocument||a,w=a.createElement("script"),Kt(w),ns(w,"link",m),a.head.appendChild(w),l.instance=w);case"void":return null;default:throw Error(s(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,Zc(m,f.precedence,a));return l.instance}function Zc(a,l,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=m.length?m[m.length-1]:null,M=w,E=0;E<m.length;E++){var P=m[E];if(P.dataset.precedence===l)M=P;else if(M!==w)break}M?M.parentNode.insertBefore(a,M.nextSibling):(l=f.nodeType===9?f.head:f,l.insertBefore(a,l.firstChild))}function Nh(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function zh(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var el=null;function v0(a,l,f){if(el===null){var m=new Map,w=el=new Map;w.set(f,m)}else w=el,m=w.get(f),m||(m=new Map,w.set(f,m));if(m.has(a))return m;for(m.set(a,null),f=f.getElementsByTagName(a),w=0;w<f.length;w++){var M=f[w];if(!(M[_a]||M[vt]||a==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var E=M.getAttribute(l)||"";E=a+E;var P=m.get(E);P?P.push(M):m.set(E,[M])}}return m}function b0(a,l,f){a=a.ownerDocument||a,a.head.insertBefore(f,l==="title"?a.querySelector("head > title"):null)}function dR(a,l,f){if(f===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return a=l.disabled,typeof l.precedence=="string"&&a==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function w0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function hR(a,l,f,m){if(f.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var w=ra(m.href),M=l.querySelector(gr(w));if(M){l=M._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(a.count++,a=tl.bind(a),l.then(a,a)),f.state.loading|=4,f.instance=M,Kt(M);return}M=l.ownerDocument||l,m=m0(m),(w=Us.get(w))&&Nh(m,w),M=M.createElement("link"),Kt(M);var E=M;E._p=new Promise(function(P,j){E.onload=P,E.onerror=j}),ns(M,"link",m),f.instance=M}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(a.count++,f=tl.bind(a),l.addEventListener("load",f),l.addEventListener("error",f))}}var jh=0;function fR(a,l){return a.stylesheets&&a.count===0&&nl(a,a.stylesheets),0<a.count||0<a.imgCount?function(f){var m=setTimeout(function(){if(a.stylesheets&&nl(a,a.stylesheets),a.unsuspend){var M=a.unsuspend;a.unsuspend=null,M()}},6e4+l);0<a.imgBytes&&jh===0&&(jh=62500*G1());var w=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&nl(a,a.stylesheets),a.unsuspend)){var M=a.unsuspend;a.unsuspend=null,M()}},(a.imgBytes>jh?50:800)+l);return a.unsuspend=f,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(w)}}:null}function tl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nl(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var sl=null;function nl(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,sl=new Map,l.forEach(pR,a),sl=null,tl.call(a))}function pR(a,l){if(!(l.state.loading&4)){var f=sl.get(a);if(f)var m=f.get(null);else{f=new Map,sl.set(a,f);for(var w=a.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<w.length;M++){var E=w[M];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(f.set(E.dataset.precedence,E),m=E)}m&&f.set(null,m)}w=l.instance,E=w.getAttribute("data-precedence"),M=f.get(E)||m,M===m&&f.set(null,w),f.set(E,w),this.count++,m=tl.bind(this),w.addEventListener("load",m),w.addEventListener("error",m),M?M.parentNode.insertBefore(w,M.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(w,a.firstChild)),l.state.loading|=4}}var yr={$$typeof:T,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function gR(a,l,f,m,w,M,E,P,j){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=he(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=he(0),this.hiddenUpdates=he(null),this.identifierPrefix=m,this.onUncaughtError=w,this.onCaughtError=M,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function x0(a,l,f,m,w,M,E,P,j,V,ne,re){return a=new gR(a,l,f,E,j,V,ne,re,P),l=1,M===!0&&(l|=24),M=Ss(3,null,null,l),a.current=M,M.stateNode=a,l=md(),l.refCount++,a.pooledCache=l,l.refCount++,M.memoizedState={element:m,isDehydrated:f,cache:l},wd(M),a}function M0(a){return a?(a=qo,a):qo}function S0(a,l,f,m,w,M){w=M0(w),m.context===null?m.context=w:m.pendingContext=w,m=gi(l),m.payload={element:f},M=M===void 0?null:M,M!==null&&(m.callback=M),f=mi(a,m,l),f!==null&&(vs(f,a,l),Ka(f,a,l))}function C0(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<l?f:l}}function Oh(a,l){C0(a,l),(a=a.alternate)&&C0(a,l)}function R0(a){if(a.tag===13||a.tag===31){var l=Xi(a,67108864);l!==null&&vs(l,a,67108864),Oh(a,67108864)}}function E0(a){if(a.tag===13||a.tag===31){var l=ks();l=Zt(l);var f=Xi(a,l);f!==null&&vs(f,a,l),Oh(a,l)}}var il=!0;function mR(a,l,f,m){var w=z.T;z.T=null;var M=I.p;try{I.p=2,qh(a,l,f,m)}finally{I.p=M,z.T=w}}function yR(a,l,f,m){var w=z.T;z.T=null;var M=I.p;try{I.p=8,qh(a,l,f,m)}finally{I.p=M,z.T=w}}function qh(a,l,f,m){if(il){var w=Hh(m);if(w===null)Rh(a,l,m,ol,f),k0(a,m);else if(bR(w,a,l,f,m))m.stopPropagation();else if(k0(a,m),l&4&&-1<vR.indexOf(a)){for(;w!==null;){var M=ko(w);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var E=Xs(M.pendingLanes);if(E!==0){var P=M;for(P.pendingLanes|=2,P.entangledLanes|=2;E;){var j=1<<31-Nt(E);P.entanglements[1]|=j,E&=~j}yn(M),(nt&6)===0&&($c=et()+500,dr(0))}}break;case 31:case 13:P=Xi(M,2),P!==null&&vs(P,M,2),Uc(),Oh(M,2)}if(M=Hh(m),M===null&&Rh(a,l,m,ol,f),M===w)break;w=M}w!==null&&m.stopPropagation()}else Rh(a,l,m,null,f)}}function Hh(a){return a=Bu(a),$h(a)}var ol=null;function $h(a){if(ol=null,a=To(a),a!==null){var l=i(a);if(l===null)a=null;else{var f=l.tag;if(f===13){if(a=o(l),a!==null)return a;a=null}else if(f===31){if(a=r(l),a!==null)return a;a=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return ol=a,null}function T0(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(It()){case wt:return 2;case yt:return 8;case Xt:case Gt:return 32;case Pn:return 268435456;default:return 32}default:return 32}}var Bh=!1,Ti=null,ki=null,Ai=null,vr=new Map,br=new Map,Di=[],vR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function k0(a,l){switch(a){case"focusin":case"focusout":Ti=null;break;case"dragenter":case"dragleave":ki=null;break;case"mouseover":case"mouseout":Ai=null;break;case"pointerover":case"pointerout":vr.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":br.delete(l.pointerId)}}function wr(a,l,f,m,w,M){return a===null||a.nativeEvent!==M?(a={blockedOn:l,domEventName:f,eventSystemFlags:m,nativeEvent:M,targetContainers:[w]},l!==null&&(l=ko(l),l!==null&&R0(l)),a):(a.eventSystemFlags|=m,l=a.targetContainers,w!==null&&l.indexOf(w)===-1&&l.push(w),a)}function bR(a,l,f,m,w){switch(l){case"focusin":return Ti=wr(Ti,a,l,f,m,w),!0;case"dragenter":return ki=wr(ki,a,l,f,m,w),!0;case"mouseover":return Ai=wr(Ai,a,l,f,m,w),!0;case"pointerover":var M=w.pointerId;return vr.set(M,wr(vr.get(M)||null,a,l,f,m,w)),!0;case"gotpointercapture":return M=w.pointerId,br.set(M,wr(br.get(M)||null,a,l,f,m,w)),!0}return!1}function A0(a){var l=To(a.target);if(l!==null){var f=i(l);if(f!==null){if(l=f.tag,l===13){if(l=o(f),l!==null){a.blockedOn=l,St(a.priority,function(){E0(f)});return}}else if(l===31){if(l=r(f),l!==null){a.blockedOn=l,St(a.priority,function(){E0(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function al(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var f=Hh(a.nativeEvent);if(f===null){f=a.nativeEvent;var m=new f.constructor(f.type,f);$u=m,f.target.dispatchEvent(m),$u=null}else return l=ko(f),l!==null&&R0(l),a.blockedOn=f,!1;l.shift()}return!0}function D0(a,l,f){al(a)&&f.delete(l)}function wR(){Bh=!1,Ti!==null&&al(Ti)&&(Ti=null),ki!==null&&al(ki)&&(ki=null),Ai!==null&&al(Ai)&&(Ai=null),vr.forEach(D0),br.forEach(D0)}function rl(a,l){a.blockedOn===l&&(a.blockedOn=null,Bh||(Bh=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,wR)))}var cl=null;function P0(a){cl!==a&&(cl=a,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){cl===a&&(cl=null);for(var l=0;l<a.length;l+=3){var f=a[l],m=a[l+1],w=a[l+2];if(typeof m!="function"){if($h(m||f)===null)continue;break}var M=ko(f);M!==null&&(a.splice(l,3),l-=3,Hd(M,{pending:!0,data:w,method:f.method,action:m},m,w))}}))}function la(a){function l(j){return rl(j,a)}Ti!==null&&rl(Ti,a),ki!==null&&rl(ki,a),Ai!==null&&rl(Ai,a),vr.forEach(l),br.forEach(l);for(var f=0;f<Di.length;f++){var m=Di[f];m.blockedOn===a&&(m.blockedOn=null)}for(;0<Di.length&&(f=Di[0],f.blockedOn===null);)A0(f),f.blockedOn===null&&Di.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var w=f[m],M=f[m+1],E=w[Bt]||null;if(typeof M=="function")E||P0(f);else if(E){var P=null;if(M&&M.hasAttribute("formAction")){if(w=M,E=M[Bt]||null)P=E.formAction;else if($h(w)!==null)continue}else P=E.action;typeof P=="function"?f[m+1]=P:(f.splice(m,3),m-=3),P0(f)}}}function _0(){function a(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(E){return w=E})},focusReset:"manual",scroll:"manual"})}function l(){w!==null&&(w(),w=null),m||setTimeout(f,20)}function f(){if(!m&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,w=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(f,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),w!==null&&(w(),w=null)}}}function Uh(a){this._internalRoot=a}ll.prototype.render=Uh.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(s(409));var f=l.current,m=ks();S0(f,m,a,l,null,null)},ll.prototype.unmount=Uh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;S0(a.current,2,null,a,null,null),Uc(),l[fn]=null}};function ll(a){this._internalRoot=a}ll.prototype.unstable_scheduleHydration=function(a){if(a){var l=us();a={blockedOn:null,target:a,priority:l};for(var f=0;f<Di.length&&l!==0&&l<Di[f].priority;f++);Di.splice(f,0,a),f===0&&A0(a)}};var L0=t.version;if(L0!=="19.2.0")throw Error(s(527,L0,"19.2.0"));I.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=d(l),a=a!==null?h(a):null,a=a===null?null:a.stateNode,a};var xR={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ul.isDisabled&&ul.supportsFiber)try{hn=ul.inject(xR),Jt=ul}catch{}}return Mr.createRoot=function(a,l){if(!n(a))throw Error(s(299));var f=!1,m="",w=Hm,M=$m,E=Bm;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(w=l.onUncaughtError),l.onCaughtError!==void 0&&(M=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=x0(a,1,!1,null,null,f,m,null,w,M,E,_0),a[fn]=l.current,Ch(a),new Uh(l)},Mr.hydrateRoot=function(a,l,f){if(!n(a))throw Error(s(299));var m=!1,w="",M=Hm,E=$m,P=Bm,j=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(w=f.identifierPrefix),f.onUncaughtError!==void 0&&(M=f.onUncaughtError),f.onCaughtError!==void 0&&(E=f.onCaughtError),f.onRecoverableError!==void 0&&(P=f.onRecoverableError),f.formState!==void 0&&(j=f.formState)),l=x0(a,1,!0,l,f??null,m,w,j,M,E,P,_0),l.context=M0(null),f=l.current,m=ks(),m=Zt(m),w=gi(m),w.callback=null,mi(f,w,m),f=m,l.current.lanes=f,we(l,f),yn(l),a[fn]=l.current,Ch(a),new ll(l)},Mr.version="19.2.0",Mr}var U0;function PR(){if(U0)return Vh.exports;U0=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),Vh.exports=DR(),Vh.exports}var _R=PR();const LR=qf(_R);let IR={data:""},NR=c=>{if(typeof window=="object"){let t=(c?c.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return t.nonce=window.__nonce__,t.parentNode||(c||document.head).appendChild(t),t.firstChild}return c||IR},zR=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,jR=/\/\*[^]*?\*\/|  +/g,F0=/\n+/g,Ii=(c,t)=>{let e="",s="",n="";for(let i in c){let o=c[i];i[0]=="@"?i[1]=="i"?e=i+" "+o+";":s+=i[1]=="f"?Ii(o,i):i+"{"+Ii(o,i[1]=="k"?"":t)+"}":typeof o=="object"?s+=Ii(o,t?t.replace(/([^,])+/g,r=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,u=>/&/.test(u)?u.replace(/&/g,r):r?r+" "+u:u)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=Ii.p?Ii.p(i,o):i+":"+o+";")}return e+(t&&n?t+"{"+n+"}":n)+s},Zn={},Jv=c=>{if(typeof c=="object"){let t="";for(let e in c)t+=e+Jv(c[e]);return t}return c},OR=(c,t,e,s,n)=>{let i=Jv(c),o=Zn[i]||(Zn[i]=(u=>{let d=0,h=11;for(;d<u.length;)h=101*h+u.charCodeAt(d++)>>>0;return"go"+h})(i));if(!Zn[o]){let u=i!==c?c:(d=>{let h,p,g=[{}];for(;h=zR.exec(d.replace(jR,""));)h[4]?g.shift():h[3]?(p=h[3].replace(F0," ").trim(),g.unshift(g[0][p]=g[0][p]||{})):g[0][h[1]]=h[2].replace(F0," ").trim();return g[0]})(c);Zn[o]=Ii(n?{["@keyframes "+o]:u}:u,e?"":"."+o)}let r=e&&Zn.g?Zn.g:null;return e&&(Zn.g=Zn[o]),((u,d,h,p)=>{p?d.data=d.data.replace(p,u):d.data.indexOf(u)===-1&&(d.data=h?u+d.data:d.data+u)})(Zn[o],t,s,r),o},qR=(c,t,e)=>c.reduce((s,n,i)=>{let o=t[i];if(o&&o.call){let r=o(e),u=r&&r.props&&r.props.className||/^go/.test(r)&&r;o=u?"."+u:r&&typeof r=="object"?r.props?"":Ii(r,""):r===!1?"":r}return s+n+(o??"")},"");function Yl(c){let t=this||{},e=c.call?c(t.p):c;return OR(e.unshift?e.raw?qR(e,[].slice.call(arguments,1),t.p):e.reduce((s,n)=>Object.assign(s,n&&n.call?n(t.p):n),{}):e,NR(t.target),t.g,t.o,t.k)}let Zv,yf,vf;Yl.bind({g:1});let ni=Yl.bind({k:1});function HR(c,t,e,s){Ii.p=t,Zv=c,yf=e,vf=s}function Hi(c,t){let e=this||{};return function(){let s=arguments;function n(i,o){let r=Object.assign({},i),u=r.className||n.className;e.p=Object.assign({theme:yf&&yf()},r),e.o=/ *go\d+/.test(u),r.className=Yl.apply(e,s)+(u?" "+u:"");let d=c;return c[0]&&(d=r.as||c,delete r.as),vf&&d[0]&&vf(r),Zv(d,r)}return n}}var $R=c=>typeof c=="function",Nl=(c,t)=>$R(c)?c(t):c,BR=(()=>{let c=0;return()=>(++c).toString()})(),eb=(()=>{let c;return()=>{if(c===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");c=!t||t.matches}return c}})(),UR=20,Bf="default",tb=(c,t)=>{let{toastLimit:e}=c.settings;switch(t.type){case 0:return{...c,toasts:[t.toast,...c.toasts].slice(0,e)};case 1:return{...c,toasts:c.toasts.map(o=>o.id===t.toast.id?{...o,...t.toast}:o)};case 2:let{toast:s}=t;return tb(c,{type:c.toasts.find(o=>o.id===s.id)?1:0,toast:s});case 3:let{toastId:n}=t;return{...c,toasts:c.toasts.map(o=>o.id===n||n===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return t.toastId===void 0?{...c,toasts:[]}:{...c,toasts:c.toasts.filter(o=>o.id!==t.toastId)};case 5:return{...c,pausedAt:t.time};case 6:let i=t.time-(c.pausedAt||0);return{...c,pausedAt:void 0,toasts:c.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},Rl=[],sb={toasts:[],pausedAt:void 0,settings:{toastLimit:UR}},bn={},nb=(c,t=Bf)=>{bn[t]=tb(bn[t]||sb,c),Rl.forEach(([e,s])=>{e===t&&s(bn[t])})},ib=c=>Object.keys(bn).forEach(t=>nb(c,t)),FR=c=>Object.keys(bn).find(t=>bn[t].toasts.some(e=>e.id===c)),Xl=(c=Bf)=>t=>{nb(t,c)},QR={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},VR=(c={},t=Bf)=>{let[e,s]=S.useState(bn[t]||sb),n=S.useRef(bn[t]);S.useEffect(()=>(n.current!==bn[t]&&s(bn[t]),Rl.push([t,s]),()=>{let o=Rl.findIndex(([r])=>r===t);o>-1&&Rl.splice(o,1)}),[t]);let i=e.toasts.map(o=>{var r,u,d;return{...c,...c[o.type],...o,removeDelay:o.removeDelay||((r=c[o.type])==null?void 0:r.removeDelay)||c?.removeDelay,duration:o.duration||((u=c[o.type])==null?void 0:u.duration)||c?.duration||QR[o.type],style:{...c.style,...(d=c[o.type])==null?void 0:d.style,...o.style}}});return{...e,toasts:i}},GR=(c,t="blank",e)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:c,pauseDuration:0,...e,id:e?.id||BR()}),qr=c=>(t,e)=>{let s=GR(t,c,e);return Xl(s.toasterId||FR(s.id))({type:2,toast:s}),s.id},Vt=(c,t)=>qr("blank")(c,t);Vt.error=qr("error");Vt.success=qr("success");Vt.loading=qr("loading");Vt.custom=qr("custom");Vt.dismiss=(c,t)=>{let e={type:3,toastId:c};t?Xl(t)(e):ib(e)};Vt.dismissAll=c=>Vt.dismiss(void 0,c);Vt.remove=(c,t)=>{let e={type:4,toastId:c};t?Xl(t)(e):ib(e)};Vt.removeAll=c=>Vt.remove(void 0,c);Vt.promise=(c,t,e)=>{let s=Vt.loading(t.loading,{...e,...e?.loading});return typeof c=="function"&&(c=c()),c.then(n=>{let i=t.success?Nl(t.success,n):void 0;return i?Vt.success(i,{id:s,...e,...e?.success}):Vt.dismiss(s),n}).catch(n=>{let i=t.error?Nl(t.error,n):void 0;i?Vt.error(i,{id:s,...e,...e?.error}):Vt.dismiss(s)}),c};var WR=1e3,KR=(c,t="default")=>{let{toasts:e,pausedAt:s}=VR(c,t),n=S.useRef(new Map).current,i=S.useCallback((p,g=WR)=>{if(n.has(p))return;let v=setTimeout(()=>{n.delete(p),o({type:4,toastId:p})},g);n.set(p,v)},[]);S.useEffect(()=>{if(s)return;let p=Date.now(),g=e.map(v=>{if(v.duration===1/0)return;let b=(v.duration||0)+v.pauseDuration-(p-v.createdAt);if(b<0){v.visible&&Vt.dismiss(v.id);return}return setTimeout(()=>Vt.dismiss(v.id,t),b)});return()=>{g.forEach(v=>v&&clearTimeout(v))}},[e,s,t]);let o=S.useCallback(Xl(t),[t]),r=S.useCallback(()=>{o({type:5,time:Date.now()})},[o]),u=S.useCallback((p,g)=>{o({type:1,toast:{id:p,height:g}})},[o]),d=S.useCallback(()=>{s&&o({type:6,time:Date.now()})},[s,o]),h=S.useCallback((p,g)=>{let{reverseOrder:v=!1,gutter:b=8,defaultPosition:x}=g||{},R=e.filter(T=>(T.position||x)===(p.position||x)&&T.height),C=R.findIndex(T=>T.id===p.id),k=R.filter((T,A)=>A<C&&T.visible).length;return R.filter(T=>T.visible).slice(...v?[k+1]:[0,k]).reduce((T,A)=>T+(A.height||0)+b,0)},[e]);return S.useEffect(()=>{e.forEach(p=>{if(p.dismissed)i(p.id,p.removeDelay);else{let g=n.get(p.id);g&&(clearTimeout(g),n.delete(p.id))}})},[e,i]),{toasts:e,handlers:{updateHeight:u,startPause:r,endPause:d,calculateOffset:h}}},YR=ni`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,XR=ni`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,JR=ni`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ZR=Hi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${YR} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${XR} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${c=>c.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${JR} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,eE=ni`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,tE=Hi("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${c=>c.secondary||"#e0e0e0"};
  border-right-color: ${c=>c.primary||"#616161"};
  animation: ${eE} 1s linear infinite;
`,sE=ni`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,nE=ni`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,iE=Hi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${sE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${nE} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${c=>c.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,oE=Hi("div")`
  position: absolute;
`,aE=Hi("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,rE=ni`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,cE=Hi("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${rE} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,lE=({toast:c})=>{let{icon:t,type:e,iconTheme:s}=c;return t!==void 0?typeof t=="string"?S.createElement(cE,null,t):t:e==="blank"?null:S.createElement(aE,null,S.createElement(tE,{...s}),e!=="loading"&&S.createElement(oE,null,e==="error"?S.createElement(ZR,{...s}):S.createElement(iE,{...s})))},uE=c=>`
0% {transform: translate3d(0,${c*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,dE=c=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${c*-150}%,-1px) scale(.6); opacity:0;}
`,hE="0%{opacity:0;} 100%{opacity:1;}",fE="0%{opacity:1;} 100%{opacity:0;}",pE=Hi("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,gE=Hi("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,mE=(c,t)=>{let e=c.includes("top")?1:-1,[s,n]=eb()?[hE,fE]:[uE(e),dE(e)];return{animation:t?`${ni(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ni(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},yE=S.memo(({toast:c,position:t,style:e,children:s})=>{let n=c.height?mE(c.position||t||"top-center",c.visible):{opacity:0},i=S.createElement(lE,{toast:c}),o=S.createElement(gE,{...c.ariaProps},Nl(c.message,c));return S.createElement(pE,{className:c.className,style:{...n,...e,...c.style}},typeof s=="function"?s({icon:i,message:o}):S.createElement(S.Fragment,null,i,o))});HR(S.createElement);var vE=({id:c,className:t,style:e,onHeightUpdate:s,children:n})=>{let i=S.useCallback(o=>{if(o){let r=()=>{let u=o.getBoundingClientRect().height;s(c,u)};r(),new MutationObserver(r).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[c,s]);return S.createElement("div",{ref:i,className:t,style:e},n)},bE=(c,t)=>{let e=c.includes("top"),s=e?{top:0}:{bottom:0},n=c.includes("center")?{justifyContent:"center"}:c.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:eb()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(e?1:-1)}px)`,...s,...n}},wE=Yl`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dl=16,xE=({reverseOrder:c,position:t="top-center",toastOptions:e,gutter:s,children:n,toasterId:i,containerStyle:o,containerClassName:r})=>{let{toasts:u,handlers:d}=KR(e,i);return S.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:dl,left:dl,right:dl,bottom:dl,pointerEvents:"none",...o},className:r,onMouseEnter:d.startPause,onMouseLeave:d.endPause},u.map(h=>{let p=h.position||t,g=d.calculateOffset(h,{reverseOrder:c,gutter:s,defaultPosition:t}),v=bE(p,g);return S.createElement(vE,{id:h.id,key:h.id,onHeightUpdate:d.updateHeight,className:h.visible?wE:"",style:v},h.type==="custom"?Nl(h.message,h):n?n(h):S.createElement(yE,{toast:h,position:p}))}))},v3=Vt;function Q0(c,t){if(typeof c=="function")return c(t);c!=null&&(c.current=t)}function kn(...c){return t=>{let e=!1;const s=c.map(n=>{const i=Q0(n,t);return!e&&typeof i=="function"&&(e=!0),i});if(e)return()=>{for(let n=0;n<s.length;n++){const i=s[n];typeof i=="function"?i():Q0(c[n],null)}}}}function Le(...c){return S.useCallback(kn(...c),c)}var ME=Symbol.for("react.lazy"),zl=$f[" use ".trim().toString()];function SE(c){return typeof c=="object"&&c!==null&&"then"in c}function ob(c){return c!=null&&typeof c=="object"&&"$$typeof"in c&&c.$$typeof===ME&&"_payload"in c&&SE(c._payload)}function Uf(c){const t=RE(c),e=S.forwardRef((s,n)=>{let{children:i,...o}=s;ob(i)&&typeof zl=="function"&&(i=zl(i._payload));const r=S.Children.toArray(i),u=r.find(TE);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}var CE=Uf("Slot");function RE(c){const t=S.forwardRef((e,s)=>{let{children:n,...i}=e;if(ob(n)&&typeof zl=="function"&&(n=zl(n._payload)),S.isValidElement(n)){const o=AE(n),r=kE(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var EE=Symbol("radix.slottable");function TE(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===EE}function kE(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function AE(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}function ab(c){var t,e,s="";if(typeof c=="string"||typeof c=="number")s+=c;else if(typeof c=="object")if(Array.isArray(c)){var n=c.length;for(t=0;t<n;t++)c[t]&&(e=ab(c[t]))&&(s&&(s+=" "),s+=e)}else for(e in c)c[e]&&(s&&(s+=" "),s+=e);return s}function rb(){for(var c,t,e=0,s="",n=arguments.length;e<n;e++)(c=arguments[e])&&(t=ab(c))&&(s&&(s+=" "),s+=t);return s}const V0=c=>typeof c=="boolean"?`${c}`:c===0?"0":c,G0=rb,Ff=(c,t)=>e=>{var s;if(t?.variants==null)return G0(c,e?.class,e?.className);const{variants:n,defaultVariants:i}=t,o=Object.keys(n).map(d=>{const h=e?.[d],p=i?.[d];if(h===null)return null;const g=V0(h)||V0(p);return n[d][g]}),r=e&&Object.entries(e).reduce((d,h)=>{let[p,g]=h;return g===void 0||(d[p]=g),d},{}),u=t==null||(s=t.compoundVariants)===null||s===void 0?void 0:s.reduce((d,h)=>{let{class:p,className:g,...v}=h;return Object.entries(v).every(b=>{let[x,R]=b;return Array.isArray(R)?R.includes({...i,...r}[x]):{...i,...r}[x]===R})?[...d,p,g]:d},[]);return G0(c,o,u,e?.class,e?.className)},DE=(c,t)=>{const e=new Array(c.length+t.length);for(let s=0;s<c.length;s++)e[s]=c[s];for(let s=0;s<t.length;s++)e[c.length+s]=t[s];return e},PE=(c,t)=>({classGroupId:c,validator:t}),cb=(c=new Map,t=null,e)=>({nextPart:c,validators:t,classGroupId:e}),jl="-",W0=[],_E="arbitrary..",LE=c=>{const t=NE(c),{conflictingClassGroups:e,conflictingClassGroupModifiers:s}=c;return{getClassGroupId:o=>{if(o.startsWith("[")&&o.endsWith("]"))return IE(o);const r=o.split(jl),u=r[0]===""&&r.length>1?1:0;return lb(r,u,t)},getConflictingClassGroupIds:(o,r)=>{if(r){const u=s[o],d=e[o];return u?d?DE(d,u):u:d||W0}return e[o]||W0}}},lb=(c,t,e)=>{if(c.length-t===0)return e.classGroupId;const n=c[t],i=e.nextPart.get(n);if(i){const d=lb(c,t+1,i);if(d)return d}const o=e.validators;if(o===null)return;const r=t===0?c.join(jl):c.slice(t).join(jl),u=o.length;for(let d=0;d<u;d++){const h=o[d];if(h.validator(r))return h.classGroupId}},IE=c=>c.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=c.slice(1,-1),e=t.indexOf(":"),s=t.slice(0,e);return s?_E+s:void 0})(),NE=c=>{const{theme:t,classGroups:e}=c;return zE(e,t)},zE=(c,t)=>{const e=cb();for(const s in c){const n=c[s];Qf(n,e,s,t)}return e},Qf=(c,t,e,s)=>{const n=c.length;for(let i=0;i<n;i++){const o=c[i];jE(o,t,e,s)}},jE=(c,t,e,s)=>{if(typeof c=="string"){OE(c,t,e);return}if(typeof c=="function"){qE(c,t,e,s);return}HE(c,t,e,s)},OE=(c,t,e)=>{const s=c===""?t:ub(t,c);s.classGroupId=e},qE=(c,t,e,s)=>{if($E(c)){Qf(c(s),t,e,s);return}t.validators===null&&(t.validators=[]),t.validators.push(PE(e,c))},HE=(c,t,e,s)=>{const n=Object.entries(c),i=n.length;for(let o=0;o<i;o++){const[r,u]=n[o];Qf(u,ub(t,r),e,s)}},ub=(c,t)=>{let e=c;const s=t.split(jl),n=s.length;for(let i=0;i<n;i++){const o=s[i];let r=e.nextPart.get(o);r||(r=cb(),e.nextPart.set(o,r)),e=r}return e},$E=c=>"isThemeGetter"in c&&c.isThemeGetter===!0,BE=c=>{if(c<1)return{get:()=>{},set:()=>{}};let t=0,e=Object.create(null),s=Object.create(null);const n=(i,o)=>{e[i]=o,t++,t>c&&(t=0,s=e,e=Object.create(null))};return{get(i){let o=e[i];if(o!==void 0)return o;if((o=s[i])!==void 0)return n(i,o),o},set(i,o){i in e?e[i]=o:n(i,o)}}},bf="!",K0=":",UE=[],Y0=(c,t,e,s,n)=>({modifiers:c,hasImportantModifier:t,baseClassName:e,maybePostfixModifierPosition:s,isExternal:n}),FE=c=>{const{prefix:t,experimentalParseClassName:e}=c;let s=n=>{const i=[];let o=0,r=0,u=0,d;const h=n.length;for(let x=0;x<h;x++){const R=n[x];if(o===0&&r===0){if(R===K0){i.push(n.slice(u,x)),u=x+1;continue}if(R==="/"){d=x;continue}}R==="["?o++:R==="]"?o--:R==="("?r++:R===")"&&r--}const p=i.length===0?n:n.slice(u);let g=p,v=!1;p.endsWith(bf)?(g=p.slice(0,-1),v=!0):p.startsWith(bf)&&(g=p.slice(1),v=!0);const b=d&&d>u?d-u:void 0;return Y0(i,v,g,b)};if(t){const n=t+K0,i=s;s=o=>o.startsWith(n)?i(o.slice(n.length)):Y0(UE,!1,o,void 0,!0)}if(e){const n=s;s=i=>e({className:i,parseClassName:n})}return s},QE=c=>{const t=new Map;return c.orderSensitiveModifiers.forEach((e,s)=>{t.set(e,1e6+s)}),e=>{const s=[];let n=[];for(let i=0;i<e.length;i++){const o=e[i],r=o[0]==="[",u=t.has(o);r||u?(n.length>0&&(n.sort(),s.push(...n),n=[]),s.push(o)):n.push(o)}return n.length>0&&(n.sort(),s.push(...n)),s}},VE=c=>({cache:BE(c.cacheSize),parseClassName:FE(c),sortModifiers:QE(c),...LE(c)}),GE=/\s+/,WE=(c,t)=>{const{parseClassName:e,getClassGroupId:s,getConflictingClassGroupIds:n,sortModifiers:i}=t,o=[],r=c.trim().split(GE);let u="";for(let d=r.length-1;d>=0;d-=1){const h=r[d],{isExternal:p,modifiers:g,hasImportantModifier:v,baseClassName:b,maybePostfixModifierPosition:x}=e(h);if(p){u=h+(u.length>0?" "+u:u);continue}let R=!!x,C=s(R?b.substring(0,x):b);if(!C){if(!R){u=h+(u.length>0?" "+u:u);continue}if(C=s(b),!C){u=h+(u.length>0?" "+u:u);continue}R=!1}const k=g.length===0?"":g.length===1?g[0]:i(g).join(":"),T=v?k+bf:k,A=T+C;if(o.indexOf(A)>-1)continue;o.push(A);const D=n(C,R);for(let _=0;_<D.length;++_){const L=D[_];o.push(T+L)}u=h+(u.length>0?" "+u:u)}return u},KE=(...c)=>{let t=0,e,s,n="";for(;t<c.length;)(e=c[t++])&&(s=db(e))&&(n&&(n+=" "),n+=s);return n},db=c=>{if(typeof c=="string")return c;let t,e="";for(let s=0;s<c.length;s++)c[s]&&(t=db(c[s]))&&(e&&(e+=" "),e+=t);return e},YE=(c,...t)=>{let e,s,n,i;const o=u=>{const d=t.reduce((h,p)=>p(h),c());return e=VE(d),s=e.cache.get,n=e.cache.set,i=r,r(u)},r=u=>{const d=s(u);if(d)return d;const h=WE(u,e);return n(u,h),h};return i=o,(...u)=>i(KE(...u))},XE=[],Ft=c=>{const t=e=>e[c]||XE;return t.isThemeGetter=!0,t},hb=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,fb=/^\((?:(\w[\w-]*):)?(.+)\)$/i,JE=/^\d+\/\d+$/,ZE=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,eT=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tT=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,sT=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,nT=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ua=c=>JE.test(c),He=c=>!!c&&!Number.isNaN(Number(c)),_i=c=>!!c&&Number.isInteger(Number(c)),Yh=c=>c.endsWith("%")&&He(c.slice(0,-1)),ei=c=>ZE.test(c),iT=()=>!0,oT=c=>eT.test(c)&&!tT.test(c),pb=()=>!1,aT=c=>sT.test(c),rT=c=>nT.test(c),cT=c=>!Me(c)&&!Se(c),lT=c=>Ca(c,yb,pb),Me=c=>hb.test(c),uo=c=>Ca(c,vb,oT),Xh=c=>Ca(c,pT,He),X0=c=>Ca(c,gb,pb),uT=c=>Ca(c,mb,rT),hl=c=>Ca(c,bb,aT),Se=c=>fb.test(c),Sr=c=>Ra(c,vb),dT=c=>Ra(c,gT),J0=c=>Ra(c,gb),hT=c=>Ra(c,yb),fT=c=>Ra(c,mb),fl=c=>Ra(c,bb,!0),Ca=(c,t,e)=>{const s=hb.exec(c);return s?s[1]?t(s[1]):e(s[2]):!1},Ra=(c,t,e=!1)=>{const s=fb.exec(c);return s?s[1]?t(s[1]):e:!1},gb=c=>c==="position"||c==="percentage",mb=c=>c==="image"||c==="url",yb=c=>c==="length"||c==="size"||c==="bg-size",vb=c=>c==="length",pT=c=>c==="number",gT=c=>c==="family-name",bb=c=>c==="shadow",mT=()=>{const c=Ft("color"),t=Ft("font"),e=Ft("text"),s=Ft("font-weight"),n=Ft("tracking"),i=Ft("leading"),o=Ft("breakpoint"),r=Ft("container"),u=Ft("spacing"),d=Ft("radius"),h=Ft("shadow"),p=Ft("inset-shadow"),g=Ft("text-shadow"),v=Ft("drop-shadow"),b=Ft("blur"),x=Ft("perspective"),R=Ft("aspect"),C=Ft("ease"),k=Ft("animate"),T=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],D=()=>[...A(),Se,Me],_=()=>["auto","hidden","clip","visible","scroll"],L=()=>["auto","contain","none"],O=()=>[Se,Me,u],X=()=>[ua,"full","auto",...O()],te=()=>[_i,"none","subgrid",Se,Me],ce=()=>["auto",{span:["full",_i,Se,Me]},_i,Se,Me],Z=()=>[_i,"auto",Se,Me],se=()=>["auto","min","max","fr",Se,Me],le=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],ue=()=>["start","end","center","stretch","center-safe","end-safe"],z=()=>["auto",...O()],I=()=>[ua,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...O()],q=()=>[c,Se,Me],Y=()=>[...A(),J0,X0,{position:[Se,Me]}],fe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],N=()=>["auto","cover","contain",hT,lT,{size:[Se,Me]}],F=()=>[Yh,Sr,uo],K=()=>["","none","full",d,Se,Me],ie=()=>["",He,Sr,uo],U=()=>["solid","dashed","dotted","double"],oe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],B=()=>[He,Yh,J0,X0],G=()=>["","none",b,Se,Me],pe=()=>["none",He,Se,Me],me=()=>["none",He,Se,Me],ye=()=>[He,Se,Me],be=()=>[ua,"full",...O()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ei],breakpoint:[ei],color:[iT],container:[ei],"drop-shadow":[ei],ease:["in","out","in-out"],font:[cT],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ei],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ei],shadow:[ei],spacing:["px",He],text:[ei],"text-shadow":[ei],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",ua,Me,Se,R]}],container:["container"],columns:[{columns:[He,Me,Se,r]}],"break-after":[{"break-after":T()}],"break-before":[{"break-before":T()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:D()}],overflow:[{overflow:_()}],"overflow-x":[{"overflow-x":_()}],"overflow-y":[{"overflow-y":_()}],overscroll:[{overscroll:L()}],"overscroll-x":[{"overscroll-x":L()}],"overscroll-y":[{"overscroll-y":L()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:X()}],"inset-x":[{"inset-x":X()}],"inset-y":[{"inset-y":X()}],start:[{start:X()}],end:[{end:X()}],top:[{top:X()}],right:[{right:X()}],bottom:[{bottom:X()}],left:[{left:X()}],visibility:["visible","invisible","collapse"],z:[{z:[_i,"auto",Se,Me]}],basis:[{basis:[ua,"full","auto",r,...O()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[He,ua,"auto","initial","none",Me]}],grow:[{grow:["",He,Se,Me]}],shrink:[{shrink:["",He,Se,Me]}],order:[{order:[_i,"first","last","none",Se,Me]}],"grid-cols":[{"grid-cols":te()}],"col-start-end":[{col:ce()}],"col-start":[{"col-start":Z()}],"col-end":[{"col-end":Z()}],"grid-rows":[{"grid-rows":te()}],"row-start-end":[{row:ce()}],"row-start":[{"row-start":Z()}],"row-end":[{"row-end":Z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":se()}],"auto-rows":[{"auto-rows":se()}],gap:[{gap:O()}],"gap-x":[{"gap-x":O()}],"gap-y":[{"gap-y":O()}],"justify-content":[{justify:[...le(),"normal"]}],"justify-items":[{"justify-items":[...ue(),"normal"]}],"justify-self":[{"justify-self":["auto",...ue()]}],"align-content":[{content:["normal",...le()]}],"align-items":[{items:[...ue(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...ue(),{baseline:["","last"]}]}],"place-content":[{"place-content":le()}],"place-items":[{"place-items":[...ue(),"baseline"]}],"place-self":[{"place-self":["auto",...ue()]}],p:[{p:O()}],px:[{px:O()}],py:[{py:O()}],ps:[{ps:O()}],pe:[{pe:O()}],pt:[{pt:O()}],pr:[{pr:O()}],pb:[{pb:O()}],pl:[{pl:O()}],m:[{m:z()}],mx:[{mx:z()}],my:[{my:z()}],ms:[{ms:z()}],me:[{me:z()}],mt:[{mt:z()}],mr:[{mr:z()}],mb:[{mb:z()}],ml:[{ml:z()}],"space-x":[{"space-x":O()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":O()}],"space-y-reverse":["space-y-reverse"],size:[{size:I()}],w:[{w:[r,"screen",...I()]}],"min-w":[{"min-w":[r,"screen","none",...I()]}],"max-w":[{"max-w":[r,"screen","none","prose",{screen:[o]},...I()]}],h:[{h:["screen","lh",...I()]}],"min-h":[{"min-h":["screen","lh","none",...I()]}],"max-h":[{"max-h":["screen","lh",...I()]}],"font-size":[{text:["base",e,Sr,uo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,Se,Xh]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Yh,Me]}],"font-family":[{font:[dT,Me,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,Se,Me]}],"line-clamp":[{"line-clamp":[He,"none",Se,Xh]}],leading:[{leading:[i,...O()]}],"list-image":[{"list-image":["none",Se,Me]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Se,Me]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:q()}],"text-color":[{text:q()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[He,"from-font","auto",Se,uo]}],"text-decoration-color":[{decoration:q()}],"underline-offset":[{"underline-offset":[He,"auto",Se,Me]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Se,Me]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Se,Me]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Y()}],"bg-repeat":[{bg:fe()}],"bg-size":[{bg:N()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},_i,Se,Me],radial:["",Se,Me],conic:[_i,Se,Me]},fT,uT]}],"bg-color":[{bg:q()}],"gradient-from-pos":[{from:F()}],"gradient-via-pos":[{via:F()}],"gradient-to-pos":[{to:F()}],"gradient-from":[{from:q()}],"gradient-via":[{via:q()}],"gradient-to":[{to:q()}],rounded:[{rounded:K()}],"rounded-s":[{"rounded-s":K()}],"rounded-e":[{"rounded-e":K()}],"rounded-t":[{"rounded-t":K()}],"rounded-r":[{"rounded-r":K()}],"rounded-b":[{"rounded-b":K()}],"rounded-l":[{"rounded-l":K()}],"rounded-ss":[{"rounded-ss":K()}],"rounded-se":[{"rounded-se":K()}],"rounded-ee":[{"rounded-ee":K()}],"rounded-es":[{"rounded-es":K()}],"rounded-tl":[{"rounded-tl":K()}],"rounded-tr":[{"rounded-tr":K()}],"rounded-br":[{"rounded-br":K()}],"rounded-bl":[{"rounded-bl":K()}],"border-w":[{border:ie()}],"border-w-x":[{"border-x":ie()}],"border-w-y":[{"border-y":ie()}],"border-w-s":[{"border-s":ie()}],"border-w-e":[{"border-e":ie()}],"border-w-t":[{"border-t":ie()}],"border-w-r":[{"border-r":ie()}],"border-w-b":[{"border-b":ie()}],"border-w-l":[{"border-l":ie()}],"divide-x":[{"divide-x":ie()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ie()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:q()}],"border-color-x":[{"border-x":q()}],"border-color-y":[{"border-y":q()}],"border-color-s":[{"border-s":q()}],"border-color-e":[{"border-e":q()}],"border-color-t":[{"border-t":q()}],"border-color-r":[{"border-r":q()}],"border-color-b":[{"border-b":q()}],"border-color-l":[{"border-l":q()}],"divide-color":[{divide:q()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[He,Se,Me]}],"outline-w":[{outline:["",He,Sr,uo]}],"outline-color":[{outline:q()}],shadow:[{shadow:["","none",h,fl,hl]}],"shadow-color":[{shadow:q()}],"inset-shadow":[{"inset-shadow":["none",p,fl,hl]}],"inset-shadow-color":[{"inset-shadow":q()}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:q()}],"ring-offset-w":[{"ring-offset":[He,uo]}],"ring-offset-color":[{"ring-offset":q()}],"inset-ring-w":[{"inset-ring":ie()}],"inset-ring-color":[{"inset-ring":q()}],"text-shadow":[{"text-shadow":["none",g,fl,hl]}],"text-shadow-color":[{"text-shadow":q()}],opacity:[{opacity:[He,Se,Me]}],"mix-blend":[{"mix-blend":[...oe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":oe()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[He]}],"mask-image-linear-from-pos":[{"mask-linear-from":B()}],"mask-image-linear-to-pos":[{"mask-linear-to":B()}],"mask-image-linear-from-color":[{"mask-linear-from":q()}],"mask-image-linear-to-color":[{"mask-linear-to":q()}],"mask-image-t-from-pos":[{"mask-t-from":B()}],"mask-image-t-to-pos":[{"mask-t-to":B()}],"mask-image-t-from-color":[{"mask-t-from":q()}],"mask-image-t-to-color":[{"mask-t-to":q()}],"mask-image-r-from-pos":[{"mask-r-from":B()}],"mask-image-r-to-pos":[{"mask-r-to":B()}],"mask-image-r-from-color":[{"mask-r-from":q()}],"mask-image-r-to-color":[{"mask-r-to":q()}],"mask-image-b-from-pos":[{"mask-b-from":B()}],"mask-image-b-to-pos":[{"mask-b-to":B()}],"mask-image-b-from-color":[{"mask-b-from":q()}],"mask-image-b-to-color":[{"mask-b-to":q()}],"mask-image-l-from-pos":[{"mask-l-from":B()}],"mask-image-l-to-pos":[{"mask-l-to":B()}],"mask-image-l-from-color":[{"mask-l-from":q()}],"mask-image-l-to-color":[{"mask-l-to":q()}],"mask-image-x-from-pos":[{"mask-x-from":B()}],"mask-image-x-to-pos":[{"mask-x-to":B()}],"mask-image-x-from-color":[{"mask-x-from":q()}],"mask-image-x-to-color":[{"mask-x-to":q()}],"mask-image-y-from-pos":[{"mask-y-from":B()}],"mask-image-y-to-pos":[{"mask-y-to":B()}],"mask-image-y-from-color":[{"mask-y-from":q()}],"mask-image-y-to-color":[{"mask-y-to":q()}],"mask-image-radial":[{"mask-radial":[Se,Me]}],"mask-image-radial-from-pos":[{"mask-radial-from":B()}],"mask-image-radial-to-pos":[{"mask-radial-to":B()}],"mask-image-radial-from-color":[{"mask-radial-from":q()}],"mask-image-radial-to-color":[{"mask-radial-to":q()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":A()}],"mask-image-conic-pos":[{"mask-conic":[He]}],"mask-image-conic-from-pos":[{"mask-conic-from":B()}],"mask-image-conic-to-pos":[{"mask-conic-to":B()}],"mask-image-conic-from-color":[{"mask-conic-from":q()}],"mask-image-conic-to-color":[{"mask-conic-to":q()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Y()}],"mask-repeat":[{mask:fe()}],"mask-size":[{mask:N()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Se,Me]}],filter:[{filter:["","none",Se,Me]}],blur:[{blur:G()}],brightness:[{brightness:[He,Se,Me]}],contrast:[{contrast:[He,Se,Me]}],"drop-shadow":[{"drop-shadow":["","none",v,fl,hl]}],"drop-shadow-color":[{"drop-shadow":q()}],grayscale:[{grayscale:["",He,Se,Me]}],"hue-rotate":[{"hue-rotate":[He,Se,Me]}],invert:[{invert:["",He,Se,Me]}],saturate:[{saturate:[He,Se,Me]}],sepia:[{sepia:["",He,Se,Me]}],"backdrop-filter":[{"backdrop-filter":["","none",Se,Me]}],"backdrop-blur":[{"backdrop-blur":G()}],"backdrop-brightness":[{"backdrop-brightness":[He,Se,Me]}],"backdrop-contrast":[{"backdrop-contrast":[He,Se,Me]}],"backdrop-grayscale":[{"backdrop-grayscale":["",He,Se,Me]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[He,Se,Me]}],"backdrop-invert":[{"backdrop-invert":["",He,Se,Me]}],"backdrop-opacity":[{"backdrop-opacity":[He,Se,Me]}],"backdrop-saturate":[{"backdrop-saturate":[He,Se,Me]}],"backdrop-sepia":[{"backdrop-sepia":["",He,Se,Me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":O()}],"border-spacing-x":[{"border-spacing-x":O()}],"border-spacing-y":[{"border-spacing-y":O()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Se,Me]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[He,"initial",Se,Me]}],ease:[{ease:["linear","initial",C,Se,Me]}],delay:[{delay:[He,Se,Me]}],animate:[{animate:["none",k,Se,Me]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[x,Se,Me]}],"perspective-origin":[{"perspective-origin":D()}],rotate:[{rotate:pe()}],"rotate-x":[{"rotate-x":pe()}],"rotate-y":[{"rotate-y":pe()}],"rotate-z":[{"rotate-z":pe()}],scale:[{scale:me()}],"scale-x":[{"scale-x":me()}],"scale-y":[{"scale-y":me()}],"scale-z":[{"scale-z":me()}],"scale-3d":["scale-3d"],skew:[{skew:ye()}],"skew-x":[{"skew-x":ye()}],"skew-y":[{"skew-y":ye()}],transform:[{transform:[Se,Me,"","none","gpu","cpu"]}],"transform-origin":[{origin:D()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:be()}],"translate-x":[{"translate-x":be()}],"translate-y":[{"translate-y":be()}],"translate-z":[{"translate-z":be()}],"translate-none":["translate-none"],accent:[{accent:q()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:q()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Se,Me]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Se,Me]}],fill:[{fill:["none",...q()]}],"stroke-w":[{stroke:[He,Sr,uo,Xh]}],stroke:[{stroke:["none",...q()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},yT=YE(mT);function Te(...c){return yT(rb(c))}function b3(c,t){return c?{...t,...c}:t}const Vf=Ff("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ke=S.forwardRef(({className:c,variant:t,size:e,asChild:s=!1,...n},i)=>{const o=s?CE:"button";return y.jsx(o,{className:Te(Vf({variant:t,size:e,className:c})),ref:i,...n})});ke.displayName="Button";var Hr=Xv();const vT=qf(Hr);var bT=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],wT=bT.reduce((c,t)=>{const e=Uf(`Primitive.${t}`),s=S.forwardRef((n,i)=>{const{asChild:o,...r}=n,u=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),y.jsx(u,{...r,ref:i})});return s.displayName=`Primitive.${t}`,{...c,[t]:s}},{}),xT="Separator",Z0="horizontal",MT=["horizontal","vertical"],wb=S.forwardRef((c,t)=>{const{decorative:e,orientation:s=Z0,...n}=c,i=ST(s)?s:Z0,r=e?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return y.jsx(wT.div,{"data-orientation":i,...r,...n,ref:t})});wb.displayName=xT;function ST(c){return MT.includes(c)}var xb=wb;const bs=S.forwardRef(({className:c,orientation:t="horizontal",decorative:e=!0,...s},n)=>y.jsx(xb,{ref:n,decorative:e,orientation:t,className:Te("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",c),...s}));bs.displayName=xb.displayName;const ev=c=>{let t;const e=new Set,s=(d,h)=>{const p=typeof d=="function"?d(t):d;if(!Object.is(p,t)){const g=t;t=h??(typeof p!="object"||p===null)?p:Object.assign({},t,p),e.forEach(v=>v(t,g))}},n=()=>t,r={setState:s,getState:n,getInitialState:()=>u,subscribe:d=>(e.add(d),()=>e.delete(d))},u=t=c(s,n,r);return r},CT=(c=>c?ev(c):ev),RT=c=>c;function ET(c,t=RT){const e=Tt.useSyncExternalStore(c.subscribe,Tt.useCallback(()=>t(c.getState()),[c,t]),Tt.useCallback(()=>t(c.getInitialState()),[c,t]));return Tt.useDebugValue(e),e}const tv=c=>{const t=CT(c),e=s=>ET(t,s);return Object.assign(e,t),e},un=(c=>c?tv(c):tv);class TT{nodes=[];connections=[];handlers=new Map;postgresQueryEngine=null;messageQueue=new Map;messageHistory=[];isRunning=!1;updateInterval=200;intervalId=null;messageIdCounter=0;MAX_HISTORY=1e3;traceContexts=new Map;traceIdCounter=0;constructor(){this.registerDefaultHandlers()}registerDefaultHandlers(){this.registerHandler("crm",this.createBusinessDataHandler("crm")),this.registerHandler("erp",this.createBusinessDataHandler("erp")),this.registerHandler("payment-gateway",this.createBusinessDataHandler("payment")),this.registerHandler("postgres",this.createDatabaseHandler("postgres")),this.registerHandler("mongodb",this.createDatabaseHandler("mongodb")),this.registerHandler("redis",this.createDatabaseHandler("redis")),this.registerHandler("cassandra",this.createDatabaseHandler("cassandra")),this.registerHandler("clickhouse",this.createDatabaseHandler("clickhouse")),this.registerHandler("snowflake",this.createDatabaseHandler("snowflake")),this.registerHandler("elasticsearch",this.createDatabaseHandler("elasticsearch")),this.registerHandler("s3-datalake",this.createStorageHandler("s3-datalake")),this.registerHandler("kafka",this.createMessageBrokerHandler("kafka")),this.registerHandler("rabbitmq",this.createMessageBrokerHandler("rabbitmq")),this.registerHandler("activemq",this.createMessageBrokerHandler("activemq")),this.registerHandler("aws-sqs",this.createMessageBrokerHandler("aws-sqs")),this.registerHandler("gcp-pubsub",this.createMessageBrokerHandler("gcp-pubsub")),this.registerHandler("rest",this.createAPIHandler("rest")),this.registerHandler("grpc",this.createAPIHandler("grpc")),this.registerHandler("graphql",this.createAPIHandler("graphql")),this.registerHandler("websocket",this.createAPIHandler("websocket")),this.registerHandler("webhook",this.createWebhookHandler()),this.registerHandler("kong",this.createIntegrationHandler("kong")),this.registerHandler("api-gateway",this.createIntegrationHandler("api-gateway")),this.registerHandler("nginx",this.createIntegrationHandler("nginx")),this.registerHandler("haproxy",this.createIntegrationHandler("haproxy")),this.registerHandler("traefik",this.createIntegrationHandler("traefik")),this.registerHandler("envoy",this.createIntegrationHandler("envoy")),this.registerHandler("cdn",this.createIntegrationHandler("cdn")),this.registerHandler("apigee",this.createIntegrationHandler("apigee")),this.registerHandler("mulesoft",this.createIntegrationHandler("mulesoft")),this.registerHandler("graphql-gateway",this.createIntegrationHandler("graphql-gateway")),this.registerHandler("bff-service",this.createIntegrationHandler("bff-service")),this.registerHandler("webhook-relay",this.createIntegrationHandler("webhook-relay")),this.registerHandler("loki",this.createLokiHandler()),this.registerHandler("otel-collector",this.createOpenTelemetryCollectorHandler()),this.registerHandler("keycloak",this.createKeycloakHandler()),this.registerHandler("secrets-vault",this.createVaultHandler()),this.registerHandler("waf",this.createWAFHandler()),this.registerHandler("firewall",this.createFirewallHandler()),this.registerHandler("ids-ips",this.createIDSIPSHandler()),this.registerHandler("jenkins",this.createJenkinsHandler()),this.registerHandler("gitlab-ci",this.createGitLabCIHandler()),this.registerHandler("argo-cd",this.createArgoCDHandler()),this.registerHandler("terraform",this.createTerraformHandler()),this.registerHandler("harbor",this.createHarborHandler()),this.registerHandler("docker",this.createDockerHandler()),this.registerHandler("spark",this.createSparkHandler()),this.registerHandler("tensorflow-serving",this.createTensorFlowServingHandler()),this.registerHandler("pytorch-serve",this.createPyTorchServeHandler()),this.registerHandler("feature-store",this.createFeatureStoreHandler())}registerHandler(t,e){this.handlers.set(t,e)}initialize(t,e){this.nodes=t,this.connections=e,this.messageQueue.clear(),this.messageHistory=[];for(const s of e)this.messageQueue.set(s.id,[])}updateNodesAndConnections(t,e){this.nodes=t,this.connections=e;const s=new Set(e.map(n=>n.id));for(const[n]of this.messageQueue.entries())s.has(n)||this.messageQueue.delete(n);for(const n of e)this.messageQueue.has(n.id)||this.messageQueue.set(n.id,[])}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.processDataFlow()},this.updateInterval))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}processDataFlow(){this.generateSourceData(),this.processInTransitMessages(),this.deliverMessages()}generateSourceData(){for(const t of this.connections){const e=this.nodes.find(o=>o.id===t.source);if(!e)continue;const s=this.handlers.get(e.type);if(!s?.generateData)continue;const n=e.data.config||{},i=s.generateData(e,n);if(i&&i.length>0){const o=this.messageQueue.get(t.id)||[];for(const r of i)r.connectionId=t.id,r.target=t.target,r.status="pending",r.id=`msg-${++this.messageIdCounter}`,r.timestamp=Date.now(),o.push(r);this.messageQueue.set(t.id,o)}}}processInTransitMessages(){for(const[t,e]of this.messageQueue.entries()){const s=this.connections.find(o=>o.id===t);if(!s)continue;const n=this.nodes.find(o=>o.id===s.source),i=this.nodes.find(o=>o.id===s.target);if(!(!n||!i)){for(const o of e)if(o.status==="pending")this.transformMessageIfNeeded(o,n,i,s)&&(o.status="in-transit",o.latency=this.calculateTransitTime(s));else if(o.status==="in-transit"){const r=Date.now()-o.timestamp;o.latency&&r>=o.latency&&(o.status="delivered")}}}}deliverMessages(){for(const[t,e]of this.messageQueue.entries()){const s=this.connections.find(u=>u.id===t);if(!s)continue;const n=this.nodes.find(u=>u.id===s.target);if(!n)continue;const i=this.handlers.get(n.type);if(!i?.processData)continue;const o=n.data.config||{},r=e.filter(u=>u.status==="delivered");for(const u of r)try{const d=this.nodes.find(p=>p.id===s.source),h=i.processData(n,u,o);h&&(d&&this.generateTraceForMessage(u,d,n,s,h),this.addToHistory(u),e.splice(e.indexOf(u),1))}catch(d){u.status="failed",u.error=d instanceof Error?d.message:"Unknown error";const h=this.nodes.find(p=>p.id===s.source);h&&this.generateTraceForMessage(u,h,n,s,u),this.addToHistory(u),e.splice(e.indexOf(u),1)}this.messageQueue.set(t,e)}}transformMessageIfNeeded(t,e,s,n){const i=this.handlers.get(e.type),o=this.handlers.get(s.type),r=i?.getSupportedFormats?.(e)||[t.format],u=o?.getSupportedFormats?.(s)||[t.format];if(u.includes(t.format))return t;const d=u.find(p=>r.includes(p));if(d)return t.format=d,t.status="transformed",t;const h=this.findIntegrationHandler(n);if(h?.transformData){const p=h.transformData(e,t,s.type,e.data.config||{});if(p)return p}if(i?.transformData){const p=i.transformData(e,t,s.type,e.data.config||{});if(p)return p}return t.status="failed",t.error=`Format ${t.format} not supported by target ${s.type}`,null}findIntegrationHandler(t){const e=this.nodes.find(s=>s.id===t.source);return e&&["kong","api-gateway","apigee","mulesoft","bff-service"].includes(e.type)&&this.handlers.get(e.type)||null}calculateTransitTime(t){const e=t.data||{},s=e.latencyMs||10,n=(e.jitterMs||0)*(Math.random()-.5);return Math.max(1,s+n)}generateTraceForMessage(t,e,s,n,i){const o=ve.getAllJaegerEngines();if(o.size===0)return;let r=t.metadata?.traceContext;if(!r){const v=this.generateTraceId(),b=this.generateSpanId();r={traceId:v,spanId:b,sampled:!0},this.traceContexts.set(v,r)}const u=t.timestamp*1e3,d=(t.timestamp+(t.latency||0))*1e3,h=d-u,p=this.getOperationName(t,e,s),g={traceId:r.traceId,spanId:r.spanId,parentSpanId:r.parentSpanId,operationName:p,serviceName:e.data.label||e.type,startTime:u,duration:h,tags:[{key:"component.type",value:e.type},{key:"target.component",value:s.data.label||s.type},{key:"target.type",value:s.type},{key:"message.format",value:t.format},{key:"message.size",value:t.size},{key:"connection.id",value:n.id},{key:"status",value:i.status}],logs:[]};if((i.status==="failed"||i.error)&&(g.tags.push({key:"error",value:!0}),g.logs.push({timestamp:d,fields:[{key:"event",value:"error"},{key:"error.message",value:i.error||"Unknown error"}]})),t.metadata)for(const[v,b]of Object.entries(t.metadata))v!=="traceContext"&&b!==void 0&&b!==null&&g.tags.push({key:`metadata.${v}`,value:String(b)});for(const[,v]of o)v.receiveSpan(g);if(i.status==="delivered"&&s){const v=this.generateSpanId(),b={traceId:r.traceId,spanId:v,parentSpanId:r.spanId,sampled:r.sampled};i.metadata||(i.metadata={}),i.metadata.traceContext=b}}generateTraceId(){return`trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getOperationName(t,e,s){return t.metadata?.operation?String(t.metadata.operation):e.type==="api-gateway"||e.type==="kong"||e.type==="apigee"?`HTTP ${t.metadata?.method||"REQUEST"}`:e.type.includes("database")||e.type==="postgres"||e.type==="mongodb"?`DB ${t.metadata?.queryType||"QUERY"}`:e.type.includes("queue")||e.type==="rabbitmq"||e.type==="kafka"?`MQ ${t.metadata?.queue||"SEND"}`:`${e.type} -> ${s.type}`}addToHistory(t){this.messageHistory.push(t),this.messageHistory.length>this.MAX_HISTORY&&this.messageHistory.shift()}getConnectionMessages(t){return this.messageQueue.get(t)||[]}getMessageHistory(t){const e=[...this.messageHistory].reverse();return t?e.slice(0,t):e}getComponentMessages(t){const e=[];for(const s of this.messageQueue.values())for(const n of s)(n.source===t||n.target===t)&&e.push(n);return e}createBusinessDataHandler(t){return{generateData:(e,s)=>{const n=[],i=s.generateInterval||2e3,o=e._lastGenerate||0,r=Date.now();if(r-o<i)return null;switch(e._lastGenerate=r,t){case"crm":n.push(this.createCRMDataMessage(e));break;case"erp":n.push(this.createERPDataMessage(e));break;case"payment":n.push(this.createPaymentDataMessage(e));break}return n},getSupportedFormats:()=>["json","xml"]}}validateMongoDBSchema(t,e){if(!e||!e.$jsonSchema)return{valid:!0};const s=e.$jsonSchema;if(s.required&&Array.isArray(s.required)){for(const n of s.required)if(!(n in t)||t[n]===void 0||t[n]===null)return{valid:!1,error:`Required field "${n}" is missing`}}if(s.properties){for(const[n,i]of Object.entries(s.properties))if(n in t){const o=t[n],r=i;if(r.type){const u=r.type,d=Array.isArray(o)?"array":typeof o;if(u==="string"&&d!=="string")return{valid:!1,error:`Field "${n}" must be of type string`};if(u==="number"&&d!=="number")return{valid:!1,error:`Field "${n}" must be of type number`};if(u==="boolean"&&d!=="boolean")return{valid:!1,error:`Field "${n}" must be of type boolean`};if(u==="array"&&d!=="array")return{valid:!1,error:`Field "${n}" must be of type array`};if(u==="object"&&(d!=="object"||Array.isArray(o)))return{valid:!1,error:`Field "${n}" must be of type object`}}}}return{valid:!0}}createDatabaseHandler(t){return{processData:(e,s,n)=>{if(t==="postgres"&&s.payload?.sql)return this.processPostgreSQLQuery(e,s,n);if(t==="redis")return this.processRedisCommand(e,s,n);if(t==="cassandra")return this.processCQLQuery(e,s,n);if(t==="clickhouse")return this.processClickHouseQuery(e,s,n);if(t==="snowflake")return this.processSnowflakeQuery(e,s,n);if(t==="elasticsearch")return this.processElasticsearchOperation(e,s,n);const i=s.payload?.operation||"insert";switch(i){case"insert":case"update":{const r=n.queryLatency||10;if(s.latency=r,t==="mongodb"){const d=e.data.config?.collections||[],h=s.payload;let p=h?.collection;if(!p&&d.length>0&&(h?.type?p=d.find(v=>v.name.toLowerCase().includes(h.type.toLowerCase()))?.name||d[0].name:p=d[0].name),p){const g=d.find(v=>v.name===p);if(g){if(g.validation){const v=g.validation;if(v.validationLevel!=="off"){const x={...h?.document||h?.data||h};delete x._id;const R=this.validateMongoDBSchema(x,v.validator);if(!R.valid){if(v.validationAction==="error")return s.status="failed",s.error=`Schema validation failed for collection "${p}": ${R.error}`,s;v.validationAction==="warn"&&(s.metadata={...s.metadata,validationWarning:R.error,collection:p})}}}i==="insert"?s.metadata={...s.metadata,collection:p,documentStored:!0}:i==="update"&&(s.metadata={...s.metadata,collection:p,documentUpdated:!0})}else return s.status="failed",s.error=`Collection "${p}" not found`,s}}return s.status="delivered",s}case"delete":const o=n.queryLatency||10;return s.latency=o,s.status="delivered",s;case"query":{let r=[];if(t==="mongodb"){const d=e.data.config?.collections||[],h=s.payload,p=h?.collection||d[0]?.name;if(p){const g=d.find(v=>v.name===p);if(g?.documents&&g.documents.length>0){if(r=g.documents.map(b=>({...b})),h?.filter)try{const b=typeof h.filter=="string"?JSON.parse(h.filter):h.filter;r=r.filter(x=>{for(const[R,C]of Object.entries(b))if(x[R]!==C)return!1;return!0})}catch{}const v=h?.limit||100;r=r.slice(0,v)}else r=this.generateQueryResults(t,h?.query)}else r=this.generateQueryResults(t,h?.query)}else r=this.generateQueryResults(t,s.payload?.query);return s.payload={...s.payload,results:r},s.status="delivered",s}default:return s.status="failed",s.error=`Unknown operation: ${i}`,s}},getSupportedFormats:()=>["json","binary"]}}processClickHouseQuery(t,e,s){const n=e.payload,i=ve.getClickHouseRoutingEngine(t.id);if(!i)return e.status="failed",e.error="ClickHouse Routing Engine not initialized",e;let o;if(n?.sql)o=n.sql;else if(n?.query)o=n.query;else if(typeof n=="string")o=n;else{const u=n?.operation||"select",d=t.data.config,h=n?.database||d?.database||"default",p=n?.table||"default_table";switch(u.toLowerCase()){case"select":case"read":case"query":o=`SELECT * FROM ${h}.${p}`,n?.where&&(o+=` WHERE ${n.where}`),n?.limit&&(o+=` LIMIT ${n.limit}`);break;case"insert":case"write":const g=n?.columns?Object.keys(n.columns).join(", "):"id, data",v=n?.columns?Object.values(n.columns).map(b=>`'${b}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${h}.${p} (${g}) VALUES (${v})`;break;default:return e.status="failed",e.error=`Unknown ClickHouse operation: ${u}`,e}}const r=i.executeQuery(o);return r.success?(e.status="delivered",e.latency=r.latency||45,e.payload={...e.payload,sql:o,rows:r.rows||[],rowCount:r.rowCount||0,columns:r.columns||[],dataRead:r.dataRead,dataWritten:r.dataWritten,clickHouseResult:r.rows},e.metadata={...e.metadata,clickHouseQuery:o,rowsRead:r.dataRead,rowsWritten:r.dataWritten}):(e.status="failed",e.error=r.error||"ClickHouse query execution failed",e.latency=r.latency||0),e}processSnowflakeQuery(t,e,s){const n=e.payload,i=ve.getSnowflakeRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Snowflake Routing Engine not initialized",e;let o,r,u,d;if(n?.sql)o=n.sql,r=n.warehouse,u=n.database,d=n.schema;else if(n?.query)o=n.query,r=n.warehouse,u=n.database,d=n.schema;else if(typeof n=="string")o=n;else{const p=n?.operation||"select",g=t.data.config;u=n?.database||g?.database||"PUBLIC",d=n?.schema||g?.schema||"PUBLIC",r=n?.warehouse||g?.warehouse;const v=n?.table||"default_table";switch(p.toLowerCase()){case"select":case"read":case"query":o=`SELECT * FROM ${u}.${d}.${v}`,n?.where&&(o+=` WHERE ${n.where}`),n?.limit&&(o+=` LIMIT ${n.limit}`);break;case"insert":case"write":const b=n?.columns?Object.keys(n.columns).join(", "):"id, data",x=n?.columns?Object.values(n.columns).map(R=>`'${R}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${u}.${d}.${v} (${b}) VALUES (${x})`;break;default:return e.status="failed",e.error=`Unknown Snowflake operation: ${p}`,e}}const h=i.executeQuery(o,r,u,d);return h.success?(e.status="delivered",e.latency=h.latency||50,e.payload={...e.payload,sql:o,rows:h.rows||[],rowCount:h.rowCount||0,columns:h.columns||[],dataRead:h.dataRead,dataWritten:h.dataWritten,snowflakeResult:h.rows,queryId:h.queryId,warehouse:h.warehouse,resultCacheUsed:h.resultCacheUsed},e.metadata={...e.metadata,snowflakeQuery:o,rowsRead:h.dataRead,rowsWritten:h.dataWritten,warehouse:h.warehouse,queryId:h.queryId,cacheHit:h.resultCacheUsed||!1}):(e.status="failed",e.error=h.error||"Snowflake query execution failed",e.latency=h.latency||0),e}processElasticsearchOperation(t,e,s){const n=e.payload,i=ve.getElasticsearchRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Elasticsearch Routing Engine not initialized",e;const o=n?.operation||n?.method||"index",r=n?.index||n?._index||t.data.config?.index||"archiphoenix-index",u=n?.id||n?._id,d=n?.document||n?._source||n?.body||n,h=n?.query,p=n?.routing||n?._routing;let g;switch(o.toLowerCase()){case"index":case"create":case"update":if(!u||!d)return e.status="failed",e.error="Index operation requires id and document",e;g=i.indexDocument(r,u,d,p);break;case"get":case"read":if(!u)return e.status="failed",e.error="Get operation requires id",e;g=i.getDocument(r,u,p);break;case"search":case"query":h?g=i.search(r,h):n?.queryString?g=i.executeQuery(n.queryString):g=i.search(r,{query:{match_all:{}}});break;case"delete":if(!u)return e.status="failed",e.error="Delete operation requires id",e;g=i.deleteDocument(r,u,p);break;default:if(typeof n=="string"||n?.queryString){const v=typeof n=="string"?n:n.queryString;g=i.executeQuery(v)}else return e.status="failed",e.error=`Unsupported Elasticsearch operation: ${o}`,e}return g.success?(e.status="delivered",e.latency=g.latency||g.took||10,e.payload={...e.payload,operation:g.operation,index:g.index,id:g.id,document:g.document,hits:g.hits,took:g.took,elasticsearchResult:g},e.metadata={...e.metadata,elasticsearchOperation:g.operation,index:g.index,hits:g.hits,took:g.took}):(e.status="failed",e.error=g.error||"Elasticsearch operation failed",e.latency=g.latency||g.took||0),e}createStorageHandler(t){return t==="s3-datalake"?{processData:(e,s,n)=>this.processS3Operation(e,s,n),getSupportedFormats:()=>["json","binary","text","xml"]}:{processData:(e,s,n)=>(s.status="delivered",s.latency=50,s),getSupportedFormats:()=>["json","binary","text"]}}processS3Operation(t,e,s){const n=e.payload,i=ve.getS3RoutingEngine(t.id);if(!i)return e.status="failed",e.error="S3 Routing Engine not initialized",e;const o=n?.operation||n?.method||"PUT",r=n?.bucket||n?.bucketName||t.data.config?.buckets?.[0]?.name||"default-bucket",u=n?.key||n?.objectKey||e.metadata?.key,d=n?.versionId||e.metadata?.versionId;let h;switch(o.toUpperCase()){case"PUT":case"UPLOAD":if(!u||!e.payload)return e.status="failed",e.error="PUT operation requires key and payload",e;const p=n?.data||n?.body||e.payload,g=n?.contentType||e.metadata?.contentType,v=n?.metadata||e.metadata;h=i.putObject(r,u,p,e.size,v,g);break;case"GET":case"DOWNLOAD":if(!u)return e.status="failed",e.error="GET operation requires key",e;h=i.getObject(r,u,d);break;case"DELETE":if(!u)return e.status="failed",e.error="DELETE operation requires key",e;h=i.deleteObject(r,u,d);break;case"LIST":const b=n?.prefix||e.metadata?.prefix,x=n?.maxKeys||n?.maxKeys||1e3;h=i.listObjects(r,b,x);break;case"HEAD":if(!u)return e.status="failed",e.error="HEAD operation requires key",e;h=i.headObject(r,u);break;default:return e.status="failed",e.error=`Unsupported S3 operation: ${o}`,e}return h.success?(e.status="delivered",e.latency=h.latency||50,h.object?e.payload={...e.payload,operation:o.toUpperCase(),bucket:r,key:u,object:h.object,etag:h.object.etag,versionId:h.versionId||h.object.versionId,size:h.object.size,storageClass:h.object.storageClass}:h.objects?e.payload={...e.payload,operation:"LIST",bucket:r,objects:h.objects,count:h.objects.length}:e.payload={...e.payload,operation:o.toUpperCase(),bucket:r,key:u,success:!0,versionId:h.versionId,deleteMarker:h.deleteMarker},e.metadata={...e.metadata,s3Operation:o.toUpperCase(),bucket:r,key:u,latency:h.latency}):(e.status="failed",e.error=h.error||`S3 ${o} operation failed`,e.latency=h.latency||0),e}processPostgreSQLQuery(t,e,s){if(!this.postgresQueryEngine)return e.status="failed",e.error="PostgreSQL Query Engine not initialized",e;const n=e.payload?.sql;if(!n||typeof n!="string")return e.status="failed",e.error="No SQL query provided",e;const i=t.data.config,o=i.tables||[],r=this.extractIndexesFromConfig(i,o),u=i.views||[],d=this.postgresQueryEngine.execute(n,o,r,u);return d.success?(e.status="delivered",e.latency=d.executionTime||s.queryLatency||10,e.payload={...e.payload,results:d.rows||[],rowCount:d.rowCount||0,queryPlan:d.queryPlan,indexesUsed:d.indexesUsed||[]}):(e.status="failed",e.error=d.error||"Query execution failed",e.latency=d.executionTime||0),e}processRedisCommand(t,e,s){const n=e.payload,i=ve.getRedisRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Redis Routing Engine not initialized",e;let o,r;if(n?.command)o=n.command,r=n.args||[];else if(n?.redisCommand){const d=String(n.redisCommand).trim().split(/\s+/);o=d[0],r=d.slice(1)}else if(typeof n=="string"){const d=n.trim().split(/\s+/);o=d[0],r=d.slice(1)}else{const d=n?.operation||"get";switch(d.toLowerCase()){case"get":o="GET",r=[n?.key||"default:key"];break;case"set":o="SET",r=[n?.key||"default:key",typeof n?.value=="string"?n.value:JSON.stringify(n?.value||"")],n?.ttl&&r.push("EX",String(n.ttl));break;case"delete":case"del":o="DEL",r=Array.isArray(n?.keys)?n.keys:[n?.key||"default:key"];break;case"exists":o="EXISTS",r=Array.isArray(n?.keys)?n.keys:[n?.key||"default:key"];break;default:return e.status="failed",e.error=`Unknown Redis operation: ${d}`,e}}const u=i.executeCommand(o,r);return u.success?(e.status="delivered",e.latency=u.latency||1,e.payload={...e.payload,command:o,args:r,result:u.value,redisResult:u.value}):(e.status="failed",e.error=u.error||"Redis command execution failed",e.latency=u.latency||0),e}processCQLQuery(t,e,s){const n=e.payload,i=ve.getCassandraRoutingEngine(t.id);if(!i)return e.status="failed",e.error="Cassandra Routing Engine not initialized",e;let o,r;if(n?.cql)o=n.cql,r=n.consistency;else if(n?.query)o=n.query,r=n.consistency;else if(typeof n=="string")o=n;else{const d=n?.operation||"select",h=t.data.config,p=n?.keyspace||h?.keyspace||"system",g=n?.table||"default_table";switch(d.toLowerCase()){case"select":case"read":o=`SELECT * FROM ${p}.${g}`,n?.limit&&(o+=` LIMIT ${n.limit}`);break;case"insert":case"write":const v=n?.columns?Object.keys(n.columns).join(", "):"id, data",b=n?.columns?Object.values(n.columns).map(C=>`'${C}'`).join(", "):`${Date.now()}, 'data'`;o=`INSERT INTO ${p}.${g} (${v}) VALUES (${b})`;break;case"update":const x=n?.columns||{},R=Object.entries(x).map(([C,k])=>`${C} = '${k}'`).join(", ");o=`UPDATE ${p}.${g} SET ${R}`,n?.where&&(o+=` WHERE ${n.where}`);break;case"delete":o=`DELETE FROM ${p}.${g}`,n?.where&&(o+=` WHERE ${n.where}`);break;default:return e.status="failed",e.error=`Unknown CQL operation: ${d}`,e}}r||(r=t.data.config?.consistencyLevel||"QUORUM");const u=i.executeCQL(o,r);return u.success?(e.status="delivered",e.latency=u.latency||5,e.payload={...e.payload,cql:o,consistency:u.consistency,rows:u.rows||[],rowCount:u.rowCount||0,replicasQueried:u.replicasQueried,cqlResult:u.rows},e.metadata={...e.metadata,cassandraConsistency:u.consistency,cassandraReplicasQueried:u.replicasQueried}):(e.status="failed",e.error=u.error||"CQL query execution failed",e.latency=u.latency||0),e}extractIndexesFromConfig(t,e){const s=[];for(const n of e)for(const i of n.indexes||[]){const o=i.match(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+(\w+)\s+ON\s+\w+\s*\(([^)]+)\)/i);o?s.push({name:o[1],table:n.name,schema:n.schema,columns:o[2].split(",").map(r=>r.trim()),unique:i.toUpperCase().includes("UNIQUE")}):s.push({name:i,table:n.name,schema:n.schema,columns:[i.replace(/^idx_|^index_/i,"")]})}return s}createMessageBrokerHandler(t){return t==="rabbitmq"?{processData:(e,s,n)=>{const i=ve.getRabbitMQRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},r=o.exchange||"amq.topic",u=o.routingKey||s.metadata?.routingKey||"default",d=s.metadata?.headers,h=s.metadata?.priority,p=i.routeMessage(r,u,s.payload,s.size,d,h);return p.length>0?(s.status="delivered",s.metadata={...s.metadata,routedQueues:p,exchange:r,routingKey:u}):(s.status="failed",s.error=`No queues bound to exchange '${r}' with routing key '${u}'`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="activemq"?{processData:(e,s,n)=>{const i=ve.getActiveMQRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},r=o.queue,u=o.topic,d=s.metadata?.headers,h=s.metadata?.priority;let p=!1,g="";const v=e.data.config||{},b=v.acls||[],R=this.nodes.find(k=>k.id===s.source)?.data.config,C=s.metadata?.principal||R?.username||R?.clientId||v.username||`user-${s.source.slice(0,8)}`;if(r){if(!(ve.checkActiveMQACLPermissionPublic?.(b,C,`queue://${r}`,"write")??!0))return s.status="failed",s.error=`Access denied: principal '${C}' does not have write permission for queue '${r}'`,s;i.routeToQueue(r,s.payload,s.size,d,h)&&(p=!0,g=r)}if(u){if(!(ve.checkActiveMQACLPermissionPublic?.(b,C,`topic://${u}`,"write")??!0))return s.status="failed",s.error=`Access denied: principal '${C}' does not have write permission for topic '${u}'`,s;i.publishToTopic(u,s.payload,s.size,d,h).length>0&&(p=!0,g=u)}return p?(s.status="delivered",s.metadata={...s.metadata,destination:g,queue:r||void 0,topic:u||void 0}):(s.status="failed",s.error=`No queue or topic found. Queue: '${r||"none"}', Topic: '${u||"none"}'`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="aws-sqs"?{processData:(e,s,n)=>{const i=ve.getSQSRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},r=o.queueUrl,u=o.queueName||(r?r.split("/").pop():null)||s.metadata?.queueName||"default-queue",d=e.data.config||{},h=d.iamPolicies||[],g=this.nodes.find(T=>T.id===s.source)?.data.config,v=s.metadata?.principal||g?.accessKeyId||g?.clientId||d.accessKeyId||`arn:aws:iam::123456789012:user/${s.source.slice(0,8)}`;if(!(ve.checkSQSIAMPolicy?.(h,v,u,"sqs:SendMessage")??!0))return s.status="failed",s.error=`Access denied: principal '${v}' does not have sqs:SendMessage permission for queue '${u}'`,s;const x=s.metadata?.messageGroupId,R=s.metadata?.messageDeduplicationId,C=s.metadata?.attributes,k=i.sendMessage(u,s.payload,s.size,C,x,R);return k?(s.status="delivered",s.metadata={...s.metadata,queueName:u,messageId:k,queueUrl:r||`https://sqs.${d.defaultRegion||"us-east-1"}.amazonaws.com/.../${u}`}):(s.status="failed",s.error=`Queue '${u}' not found`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="azure-service-bus"?{processData:(e,s,n)=>{const i=ve.getAzureServiceBusRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},r=o.queue,u=o.topic,d=s.metadata?.properties||s.metadata?.headers,h=s.metadata?.sessionId,p=s.metadata?.scheduledEnqueueTime;let g=!1,v="",b=[];if(r){const x=i.sendToQueue(r,s.payload,s.size,d,h,p);x&&(g=!0,v=r,b.push(x))}if(u){const x=i.publishToTopic(u,s.payload,s.size,d,p);x.length>0&&(g=!0,v=u,b=x)}return g?(s.status="delivered",s.metadata={...s.metadata,destination:v,queue:r||void 0,topic:u||void 0,messageIds:b,sessionId:h||void 0}):(s.status="failed",s.error=`No queue or topic found. Queue: '${r||"none"}', Topic: '${u||"none"}'`),s},getSupportedFormats:()=>["json","binary","text"]}:t==="gcp-pubsub"?{processData:(e,s,n)=>{const i=ve.getPubSubRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=n?.messaging||s.metadata?.messaging||{},r=o.topic||s.metadata?.topic,u=o.orderingKey||s.metadata?.orderingKey,d=s.metadata?.attributes||s.metadata?.headers,h=e.data.config||{},p=r||h.topics&&h.topics[0]?.name||null;if(!p)return s.status="failed",s.error="No topic specified for Pub/Sub message",s;const g=i.publishToTopic(p,s.payload,s.size,d,u);return g?(s.status="delivered",s.metadata={...s.metadata,topic:p,messageId:g,orderingKey:u||void 0}):(s.status="failed",s.error=`Topic '${p}' not found`),s},getSupportedFormats:()=>["json","binary","text"]}:{processData:(e,s,n)=>(s.status="delivered",s),getSupportedFormats:()=>["json","binary","text"]}}createAPIHandler(t){return t==="rest"?{processData:(e,s,n)=>{const i=ve.getRestApiRoutingEngine(e.id);if(!i){const b={status:"success",data:s.payload,timestamp:Date.now()};return s.payload=b,s.status="delivered",s}const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=o?.body||o||s.payload,g=o?.clientIP||s.metadata?.clientIP,v=i.routeRequest({path:r,method:u,headers:d,query:h,body:p,clientIP:g});return v.status>=200&&v.status<300?(s.status="delivered",s.latency=v.latency,s.payload=v.data,s.metadata={...s.metadata,restApiEndpoint:v.endpoint,restApiStatus:v.status,restApiHeaders:v.headers}):(s.status="failed",s.error=v.error||`HTTP ${v.status}`,s.latency=v.latency,s.metadata={...s.metadata,restApiEndpoint:v.endpoint,restApiStatus:v.status}),s},transformData:(e,s,n,i)=>(s.format!=="json"&&(s.format="json",s.status="transformed"),s),getSupportedFormats:()=>["json","xml"]}:t==="grpc"?{processData:(e,s,n)=>{const i=ve.getGRPCRoutingEngine(e.id);if(!i){const b={status:"OK",data:s.payload,timestamp:Date.now()};return s.payload=b,s.status="delivered",s}const o=s.payload,r=o?.service||s.metadata?.service||"",u=o?.method||s.metadata?.method||"",d=o?.payload||o?.body||o||s.payload,h=o?.metadata||s.metadata||{},p=o?.timeout||s.metadata?.timeout,g=o?.clientIP||s.metadata?.clientIP,v=i.routeRequest({service:r,method:u,payload:d,metadata:h,timeout:p,clientIP:g});return v.status==="OK"?(s.status="delivered",s.latency=v.latency,s.payload=v.data,s.metadata={...s.metadata,grpcService:v.service,grpcMethod:v.method,grpcStatus:v.status,grpcMetadata:v.metadata}):(s.status="failed",s.error=v.error||`gRPC ${v.status}`,s.latency=v.latency,s.metadata={...s.metadata,grpcService:v.service,grpcMethod:v.method,grpcStatus:v.status}),s},transformData:(e,s,n,i)=>(s.format!=="protobuf"&&s.format!=="binary"&&(s.format="protobuf",s.status="transformed"),s),getSupportedFormats:()=>["protobuf","binary"]}:t==="graphql"?{processData:(e,s,n)=>{const i=ve.getGraphQLEmulationEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload;if(Array.isArray(o)){const v=i.processBatchQueries(o,this.nodes,this.connections);let b=null;v.then(R=>{b=R}).catch(()=>{});const x=b||[];return s.payload=x,s.status=x.every(R=>R.success)?"delivered":"error",(!s.status||s.status==="error")&&(s.error="Some batch queries failed"),s}const r=o?.query||o?.body?.query||s.metadata?.query,u=o?.variables||o?.body?.variables||s.metadata?.variables,d=o?.operationName||o?.body?.operationName||s.metadata?.operationName,h=o?.extensions||o?.body?.extensions||s.metadata?.extensions,p=r&&r.trim().toLowerCase().startsWith("mutation");let g;if(p)g=i.processMutation({query:r,variables:u,operationName:d});else{const v=()=>ve.getAllJaegerEngines(),b=i.processQuery({query:r,variables:u,operationName:d,extensions:h},this.nodes,this.connections,v);if(b&&typeof b.then=="function"){let x=null;b.then(C=>{x=C}).catch(()=>{});const R=Date.now();g=x||{success:!1,errors:[{message:"Query execution timeout"}],latency:Date.now()-R}}else g=b}return g.success?(s.payload={data:g.data,extensions:g.complexity!==void 0?{complexity:g.complexity,depth:g.depth}:void 0},s.metadata={...s.metadata,latency:g.latency,complexity:g.complexity,depth:g.depth,cached:g.cached},s.status="delivered"):(s.payload={errors:g.errors},s.status="error",s.error=g.errors?.[0]?.message||"GraphQL query failed"),s},transformData:(e,s,n,i)=>(s.format!=="json"&&(s.format="json",s.status="transformed"),s),getSupportedFormats:()=>["json"]}:t==="soap"?{processData:(e,s,n)=>{const i=ve.getSOAPEmulationEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.envelope||o?.body||(typeof o=="string"?o:""),u=o?.operation||s.metadata?.operation,d=o?.service||s.metadata?.service,h=o?.headers||s.metadata?.headers||{},p=o?.clientIP||s.metadata?.clientIP;if(!r)return s.status="error",s.error="SOAP envelope is required",s;const g=()=>{const b=new Map;for(const x of this.nodes)if(x.type==="jaeger"){const R=ve.getJaegerEmulationEngine(x.id);R&&b.set(x.id,R)}return b},v=i.processRequest({envelope:r,operation:u,service:d,headers:h,clientIP:p},this.nodes,this.connections,g);return v.success?(s.payload={envelope:v.envelope,status:v.status},s.metadata={...s.metadata,latency:v.latency,soapVersion:n?.soapVersion||"1.1"},s.status="delivered",s.latency=v.latency):(s.payload={envelope:v.envelope,fault:v.fault,error:v.error},s.status="error",s.error=v.error||v.fault?.string||"SOAP request failed",s.latency=v.latency),s},transformData:(e,s,n,i)=>(s.format!=="xml"&&(s.format="xml",s.status="transformed"),s),getSupportedFormats:()=>["xml","json"]}:t==="websocket"?{processData:(e,s,n)=>{const i=ve.getWebSocketEmulationEngine(e.id);if(i){const r=s.metadata?.connectionId||`conn-${Date.now()}`,u=i.processIncomingMessage(r,s.payload,s.metadata);if(!u.processed){const h={status:"error",type:"websocket",connectionId:r,data:s.payload,timestamp:Date.now(),processed:!1,error:u.error||"Failed to process message"};return s.payload=h,s.status="error",s}const d={status:"success",type:"websocket",connectionId:r,data:s.payload,timestamp:Date.now(),processed:u.processed,broadcastToRoom:u.broadcastToRoom,deliveredToSubscriptions:u.deliveredToSubscriptions,forwarded:u.forwarded};return s.payload=d,s.status="delivered",s}const o={status:"success",data:s.payload,timestamp:Date.now()};return s.payload=o,s.status="delivered",s},transformData:(e,s,n,i)=>(n==="rest"&&s.format==="binary"?(s.format="json",s.payload={data:"Binary data converted to JSON"}):n==="grpc"&&s.format==="text"&&(s.format="json",s.payload={message:s.payload}),s),getSupportedFormats:()=>["json","text","binary"]}:{processData:(e,s,n)=>{const i={status:"success",data:s.payload,timestamp:Date.now()};return s.payload=i,s.status="delivered",s},transformData:(e,s,n,i)=>s,getSupportedFormats:()=>["json"]}}createWebhookHandler(){return{processData:(t,e,s)=>{const n=ve.getWebhookEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload,o=i?.url||e.metadata?.url||i?.path||"/",r=i?.method||e.metadata?.method||"POST",u=i?.headers||e.metadata?.headers||{},d=i?.body||i||e.payload,h=i?.ip||e.metadata?.ip||u["x-forwarded-for"]?.split(",")[0]?.trim(),p=i?.event||e.metadata?.event||u["x-event"]||u["x-github-event"]||"",g=n.processWebhookRequest({url:o,method:r,headers:u,body:d,event:p,ip:h});return g.success?(e.status="delivered",e.latency=g.latency,e.metadata={...e.metadata,webhookDeliveryId:g.deliveryId,webhookAttempts:g.attempts,webhookStatus:g.status}):(e.status="failed",e.error=g.error||`Webhook processing failed (HTTP ${g.status})`,e.latency=g.latency,e.metadata={...e.metadata,webhookDeliveryId:g.deliveryId,webhookAttempts:g.attempts,webhookStatus:g.status}),e},transformData:(t,e,s,n)=>(e.format!=="json"&&(e.format="json",e.status="transformed"),e),getSupportedFormats:()=>["json"]}}createIntegrationHandler(t){return t==="kong"?{processData:(e,s,n)=>{const i=ve.getKongRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d.apikey||d["X-API-Key"]||h.apikey,g=s.metadata?.consumerId,v=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,consumerId:g,apiKey:p});return v.response.status>=200&&v.response.status<300?(s.status="delivered",s.latency=v.response.latency,s.metadata={...s.metadata,kongRoute:v.match?.route.id,kongService:v.match?.service.id,kongTarget:v.target,kongResponseStatus:v.response.status}):(s.status="failed",s.error=v.response.error||`HTTP ${v.response.status}`,s.latency=v.response.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}:t==="api-gateway"?{processData:(e,s,n)=>{const i=ve.getCloudAPIGatewayEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["x-api-key"]||d["X-API-Key"]||d["ocp-apim-subscription-key"]||h.key||h["subscription-key"]||h.apikey,g={path:r,method:u.toUpperCase(),headers:d,query:h,body:o?.body,apiKey:p},v=i.processRequest(g);if(v.status>=200&&v.status<300){if(s.status="delivered",s.latency=(s.latency||0)+v.latency,s.metadata={...s.metadata,gatewayProvider:v.metadata?.gatewayProvider,gatewayApiId:v.metadata?.apiId,gatewayKeyId:v.metadata?.keyId,gatewayCacheHit:v.metadata?.cacheHit||!1,gatewayRateLimitRemaining:v.metadata?.rateLimitRemaining,gatewayResponseStatus:v.status},v.metadata?.cacheHit)return s.status="delivered",s.payload=v.body||s.payload,s}else return s.status="failed",s.error=v.error||`HTTP ${v.status}`,s.latency=(s.latency||0)+v.latency,s.metadata={...s.metadata,gatewayProvider:v.metadata?.gatewayProvider,gatewayApiId:v.metadata?.apiId,gatewayError:v.error,gatewayResponseStatus:v.status},s;return s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}:t==="nginx"?{processData:(e,s,n)=>{const i=ve.getNginxRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",v=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,clientIP:p,protocol:g});return v.response.status>=200&&v.response.status<300?(s.status="delivered",s.latency=v.response.latency,s.metadata={...s.metadata,nginxLocation:v.match?.location.path,nginxUpstream:v.upstreamTarget,nginxResponseStatus:v.response.status,nginxCacheHit:v.response.cacheHit},v.response.body&&(s.payload=v.response.body)):(s.status="failed",s.error=v.response.error||`HTTP ${v.response.status}`,s.latency=v.response.latency),s},transformData:(e,s,n,i)=>{(e.data.config||{}).enableGzip&&s.metadata?.nginxCacheHit&&(s.metadata={...s.metadata,contentEncoding:"gzip"});const r=this.getTargetFormats(n);return r.length>0&&!r.includes(s.format)&&(s.format=r[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="envoy"?{processData:(e,s,n)=>{const i=ve.getEnvoyRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",v=d.Host||s.metadata?.host,b=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,clientIP:p,protocol:g,host:v});return b.response.status>=200&&b.response.status<300?(s.status="delivered",s.latency=(s.latency||0)+(b.response.latency||0),s.metadata={...s.metadata,envoyListener:b.listener?.name,envoyRoute:b.route?.name,envoyCluster:b.cluster?.name,envoyEndpoint:b.endpointTarget,envoyResponseStatus:b.response.status},b.response.body&&(s.payload=b.response.body)):(s.status="failed",s.error=b.response.error||`HTTP ${b.response.status}`,s.latency=(s.latency||0)+(b.response.latency||0)),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text","grpc"]}:t==="haproxy"?{processData:(e,s,n)=>{const i=ve.getHAProxyRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",v=d.Host||s.metadata?.host,b=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,clientIP:p,protocol:g,host:v});return b.response.status>=200&&b.response.status<300?(s.status="delivered",s.latency=b.response.latency,s.metadata={...s.metadata,haproxyFrontend:b.frontend?.name,haproxyBackend:b.backendTarget,haproxyServer:b.serverTarget,haproxyResponseStatus:b.response.status},b.response.body&&(s.payload=b.response.body)):(s.status="failed",s.error=b.response.error||`HTTP ${b.response.status}`,s.latency=b.response.latency),s},transformData:(e,s,n,i)=>{e.data.config;const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="traefik"?{processData:(e,s,n)=>{const i=ve.getTraefikEmulationEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",v=d.Host||s.metadata?.host,b=s.metadata?.entryPoint||(g==="https"?"websecure":"web"),x=i.processRequest({path:r,method:u,headers:d,query:h,body:o?.body,clientIP:p,protocol:g,host:v,entryPoint:b});return x.success?(s.status="delivered",s.latency=x.latency,s.metadata={...s.metadata,traefikRouter:x.routerMatched,traefikService:x.serviceTarget,traefikServer:x.serverTarget,traefikResponseStatus:x.status},o?.body&&(s.payload=o.body)):(s.status="failed",s.error=x.error||`HTTP ${x.status}`,s.latency=x.latency),s},transformData:(e,s,n,i)=>{e.data.config;const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="cdn"?{processData:(e,s,n)=>{const i=ve.getCDNEmulationEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["User-Agent"]||s.metadata?.userAgent,b=(e.data.config||{}).distributions||[],x=d.Host||s.metadata?.host||(b.length>0?b[0].domain:"cdn.example.com"),R=i.processRequest({method:u.toUpperCase(),path:r,domain:x,headers:d,query:h,body:o?.body,clientIP:p,userAgent:g});return R.success?(s.status="delivered",s.latency=(s.latency||0)+R.latency,s.metadata={...s.metadata,cdnCacheHit:R.cacheHit,cdnLatency:R.latency,cdnSize:R.size},R.cacheHit&&(s.payload={status:"ok",cached:!0})):(s.status="failed",s.error=R.error||"CDN request failed",s.latency=(s.latency||0)+R.latency),s},transformData:(e,s,n,i)=>{const o=e.data.config||{};o.enableCompression&&s.metadata?.cdnCacheHit&&(s.metadata={...s.metadata,contentEncoding:o.compressionType||"gzip"});const r=this.getTargetFormats(n);return r.length>0&&!r.includes(s.format)&&(s.format=r[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text","html"]}:t==="service-mesh"?{processData:(e,s,n)=>{const i=ve.getServiceMeshRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",v=d.Host||s.metadata?.host,b=d.Host||s.metadata?.authority,x=d["X-Source-Principal"]||s.metadata?.sourcePrincipal,R=d["X-Destination-Principal"]||s.metadata?.destinationPrincipal,C=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,clientIP:p,protocol:g==="https"?"https":g==="grpc"?"grpc":"http",host:v,authority:b,sourcePrincipal:x,destinationPrincipal:R});return C.response.status>=200&&C.response.status<300?(s.status="delivered",s.latency=C.response.latency,s.metadata={...s.metadata,serviceMeshVirtualService:C.virtualService?.name,serviceMeshDestinationRule:C.destinationRule?.name,serviceMeshService:C.serviceTarget,serviceMeshSubset:C.subsetTarget,serviceMeshEndpoint:C.endpointTarget,serviceMeshResponseStatus:C.response.status,serviceMeshRetryAttempts:C.response.retryAttempts,serviceMeshCircuitBreakerOpen:C.response.circuitBreakerOpen},C.response.body&&(s.payload=C.response.body)):(s.status="failed",s.error=C.response.error||`HTTP ${C.response.status}`,s.latency=C.response.latency,s.metadata={...s.metadata,serviceMeshVirtualService:C.virtualService?.name,serviceMeshDestinationRule:C.destinationRule?.name,serviceMeshService:C.serviceTarget,serviceMeshSubset:C.subsetTarget,serviceMeshEndpoint:C.endpointTarget,serviceMeshResponseStatus:C.response.status,serviceMeshError:C.response.error,serviceMeshRetryAttempts:C.response.retryAttempts,serviceMeshCircuitBreakerOpen:C.response.circuitBreakerOpen}),s},transformData:(e,s,n,i)=>{e.data.config;const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="istio"?{processData:(e,s,n)=>{const i=ve.getIstioRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d["X-Real-IP"]||d["X-Forwarded-For"]||s.metadata?.clientIP,g=d["X-Forwarded-Proto"]==="https"||s.metadata?.protocol==="https"?"https":"http",v=d.Host||s.metadata?.host,b=d.Host||s.metadata?.authority,x=d["X-Source-Principal"]||s.metadata?.sourcePrincipal,R=d["X-Destination-Principal"]||s.metadata?.destinationPrincipal,C=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,clientIP:p,protocol:g==="https"?"https":g==="grpc"?"grpc":"http",host:v,authority:b,sourcePrincipal:x,destinationPrincipal:R});return C.response.status>=200&&C.response.status<300?(s.status="delivered",s.latency=C.response.latency,s.metadata={...s.metadata,istioVirtualService:C.virtualService?.name,istioDestinationRule:C.destinationRule?.name,istioService:C.serviceTarget,istioSubset:C.subsetTarget,istioEndpoint:C.endpointTarget,istioResponseStatus:C.response.status,istioRetryAttempts:C.response.retryAttempts,istioCircuitBreakerOpen:C.response.circuitBreakerOpen},C.response.body&&(s.payload=C.response.body)):(s.status="failed",s.error=C.response.error||`HTTP ${C.response.status}`,s.latency=C.response.latency,s.metadata={...s.metadata,istioVirtualService:C.virtualService?.name,istioDestinationRule:C.destinationRule?.name,istioService:C.serviceTarget,istioSubset:C.subsetTarget,istioEndpoint:C.endpointTarget,istioResponseStatus:C.response.status,istioError:C.response.error,istioRetryAttempts:C.response.retryAttempts,istioCircuitBreakerOpen:C.response.circuitBreakerOpen}),s},transformData:(e,s,n,i)=>{e.data.config;const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text","grpc"]}:t==="apigee"?{processData:(e,s,n)=>{const i=ve.getApigeeRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=d.apikey||d["X-API-Key"]||h.apikey,g=d.Authorization||"",v=g.startsWith("OAuth ")?g.replace("OAuth ",""):void 0,b=g.startsWith("Bearer ")?g.replace("Bearer ",""):d["X-JWT-Token"],x=i.routeRequest({path:r,method:u,headers:d,query:h,body:o?.body,apiKey:p,oauthToken:v,jwtToken:b});return x.response.status>=200&&x.response.status<300?(s.status="delivered",s.latency=x.response.latency,s.metadata={...s.metadata,apigeeProxy:x.match?.proxy.name,apigeeTarget:x.target,apigeeResponseStatus:x.response.status,apigeeEnvironment:x.match?.proxy.environment}):(s.status="failed",s.error=x.response.error||`HTTP ${x.response.status}`,s.latency=x.response.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}:t==="graphql-gateway"?{processData:(e,s,n)=>{const i=ve.getGraphQLGatewayRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.query||o?.body||s.metadata?.query,u=o?.variables||s.metadata?.variables,d=o?.operationName||s.metadata?.operationName,h=o?.headers||s.metadata?.headers||{},p=i.routeRequest({query:r||"",variables:u,headers:h,operationName:d});if(s.latency=p.latency,p.status>=200&&p.status<300){s.status="delivered";const b=i.getServiceRegistry().getConnectedServices().map(x=>x.endpoint);s.metadata={...s.metadata,graphqlGatewayStatus:p.status,graphqlGatewayEndpoints:b}}else s.status="failed",s.error=p.error||`HTTP ${p.status}`;return s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json"]}:t==="mulesoft"?{processData:(e,s,n)=>{const i=ve.getMuleSoftRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=this.nodes.find(h=>h.id===s.source),u=this.nodes.find(h=>h.id===s.target),d=i.processData({path:o?.path||s.metadata?.path,method:o?.method||s.metadata?.method||"POST",headers:o?.headers||s.metadata?.headers||{},query:o?.query||s.metadata?.query||{},body:o?.body||o||s.payload,format:s.format,sourceComponentType:r?.type,sourceComponentId:r?.id,targetComponentType:u?.type,targetComponentId:u?.id});return d.response.status==="success"?(s.status="delivered",s.latency=d.response.latency,s.payload=d.response.data,d.response.format&&(s.format=d.response.format),s.metadata={...s.metadata,mulesoftApplication:d.response.application,mulesoftFlow:d.response.flow,mulesoftConnector:d.response.connector}):(s.status="failed",s.error=d.response.error||"MuleSoft processing failed",s.latency=d.response.latency||0),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:t==="bff-service"?{processData:(e,s,n)=>{const i=ve.getBFFRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.path||s.metadata?.path||"/",u=o?.method||s.metadata?.method||"GET",d=o?.headers||s.metadata?.headers||{},h=o?.query||s.metadata?.query||{},p=o?.body||o||s.payload,g=i.routeRequest({path:r,method:u,headers:d,query:h,body:p});return g.status>=200&&g.status<300?(s.status="delivered",s.latency=g.latency,s.payload=g.data,s.metadata={...s.metadata,bffCacheHit:g.cacheHit,bffBackendResponses:g.backendResponses.length,bffStatus:g.status}):(s.status="failed",s.error=g.error||`HTTP ${g.status}`,s.latency=g.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json"]}:t==="webhook-relay"?{processData:(e,s,n)=>{const i=ve.getWebhookRelayRoutingEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.url||s.metadata?.url||o?.path||"/",u=o?.method||s.metadata?.method||"POST",d=o?.headers||s.metadata?.headers||{},h=o?.body||o||s.payload,p=o?.ip||s.metadata?.ip||d["x-forwarded-for"]?.split(",")[0]?.trim(),g=o?.event||s.metadata?.event||d["x-event"]||d["x-github-event"]||"",v=i.relayWebhook({url:r,method:u,headers:d,body:h,ip:p,event:g});return v.success?(s.status="delivered",s.latency=v.latency,s.metadata={...s.metadata,webhookRelayId:v.relayId,webhookDeliveryId:v.deliveryId,webhookAttempts:v.attempts,webhookStatus:v.status}):(s.status="failed",s.error=v.error||`Webhook relay failed (HTTP ${v.status})`,s.latency=v.latency,s.metadata={...s.metadata,webhookRelayId:v.relayId,webhookDeliveryId:v.deliveryId,webhookAttempts:v.attempts,webhookStatus:v.status}),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","text","binary"]}:t==="vpn"?{processData:(e,s,n)=>{const i=ve.getVPNEmulationEngine(e.id);if(!i)return s.status="delivered",s;const o=s.payload,r=o?.source||s.metadata?.source||s.source||"0.0.0.0",u=o?.destination||s.metadata?.destination||s.target||"0.0.0.0",d=o?.protocol||s.metadata?.protocol||"tcp",h=o?.port||s.metadata?.port,p=o?.sourcePort||s.metadata?.sourcePort,g=o?.encrypted||s.metadata?.encrypted||!1,v=o?.connectionId||s.metadata?.connectionId,b=o?.tunnelId||s.metadata?.tunnelId,x=i.processPacket({source:r,destination:u,protocol:d,port:h,sourcePort:p,payload:s.payload,encrypted:g,connectionId:v,tunnelId:b});return x.success?(s.status="delivered",s.latency=(s.latency||0)+x.latency,s.metadata={...s.metadata,vpnEncrypted:x.encrypted,vpnConnectionId:x.connectionId,vpnTunnelId:x.tunnelId,vpnBytesProcessed:x.bytesProcessed},x.encrypted&&(s.metadata={...s.metadata,encrypted:!0})):(s.status="failed",s.error=x.error||"VPN processing failed",s.latency=(s.latency||0)+x.latency),s},transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary","text"]}:{transformData:(e,s,n,i)=>{const o=this.getTargetFormats(n);return o.length>0&&!o.includes(s.format)&&(s.format=o[0],s.status="transformed"),s},getSupportedFormats:()=>["json","xml","binary"]}}getTargetFormats(t){return this.handlers.get(t)?.getSupportedFormats?.({type:t})||["json"]}createLokiHandler(){return{processData:(t,e,s)=>{const n=ve.getLokiEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload;if(i?.query||i?.logql){const o=i.query||i.logql,r=i.startTime||i.start,u=i.endTime||i.end,d=i.limit||100,h=n.executeQuery(o,r,u,d);h.success?(e.status="delivered",e.latency=h.latency,e.payload={...e.payload,query:o,results:h.result||[],resultsCount:h.resultsCount}):(e.status="failed",e.error=h.error||"LogQL query execution failed",e.latency=h.latency||0)}else{const o=[],r=i?.stream||i?.labels||e.metadata?.labels||{app:t.data.label?.toLowerCase().replace(/\s+/g,"-")||"unknown",source:e.source.slice(0,8)};let u=[];if(i?.values&&Array.isArray(i.values))u=i.values;else if(i?.logs&&Array.isArray(i.logs)){const d=Date.now()*1e6;u=i.logs.map((h,p)=>[(d+p).toString(),String(h)])}else if(i?.log)u=[[(Date.now()*1e6).toString(),String(i.log)]];else if(typeof i=="string")u=[[(Date.now()*1e6).toString(),i]];else{const d=JSON.stringify(i);u=[[(Date.now()*1e6).toString(),d]]}if(u.length>0){o.push({stream:r,values:u});const d=n.processIngestion(o,e.source);d.success?(e.status="delivered",e.latency=10,e.payload={...e.payload,ingestedLines:d.ingestedLines,ingestedBytes:d.ingestedBytes}):(e.status="failed",e.error=d.error||"Log ingestion failed")}else e.status="failed",e.error="No log entries found in payload"}return e},getSupportedFormats:()=>["json","text"]}}createKeycloakHandler(){return{processData:(t,e,s)=>{const n=ve.getKeycloakEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Keycloak engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||i.grant_type;let r="login";if(typeof o=="string"){const g=o.toLowerCase();g.includes("refresh")||g==="refresh_token"?r="refresh":g.includes("introspect")?r="introspect":g.includes("userinfo")||g.includes("user_info")?r="userinfo":r="login"}const u=i.clientId||i.client_id||e.metadata?.clientId,d=i.username||i.user||e.metadata?.username,h=i.sub||i.subject||e.metadata?.subject||d,p=n.processAuthRequest(r,{clientId:u,username:d,subject:h,grantType:typeof o=="string"?o:void 0});return e.latency=p.latency,p.success?(e.status="delivered",e.payload={...i||{},keycloak:{realm:p.realm,clientId:p.clientId,subject:p.subject,tokenType:p.tokenType,expiresIn:p.expiresIn}},e.metadata={...e.metadata,authRealm:p.realm,authClientId:p.clientId,authSubject:p.subject,authResult:"success"}):(e.status="failed",e.error=p.error||"Keycloak auth failed"),e},getSupportedFormats:()=>["json","text"]}}createJenkinsHandler(){return{processData:(t,e,s)=>{const n=ve.getJenkinsEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Jenkins engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit){const r=i.pipelineId||i.pipeline||i.job,u=i.branch||i.ref?.replace("refs/heads/","")||"main",d=i.commit||i.sha||void 0;if(r){const h=n.triggerWebhook(r,u,d);h.success?(e.status="delivered",e.latency=50,e.payload={...i||{},jenkins:{webhookReceived:!0,pipelineId:r,branch:u,commit:d,triggered:!0}}):(e.status="failed",e.error=h.reason||"Failed to trigger build",e.latency=50)}else e.status="delivered",e.latency=50,e.payload={...i||{},jenkins:{webhookReceived:!0,branch:u,commit:d,triggered:!1,reason:"No pipeline ID specified"}}}else if(o==="getBuildStatus"||i.buildId||i.buildNumber){const r=i.buildId||i.buildNumber,u=i.pipelineId||i.pipeline,d=n.getBuildById(r||`${u}-${i.buildNumber}`),h=d?.status||"unknown";e.status="delivered",e.latency=20,e.payload={...i||{},jenkins:{buildId:r,pipelineId:u,status:h,progress:d?.progress,duration:d?.duration}}}else e.status="delivered",e.latency=30,e.payload={...i||{},jenkins:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createGitLabCIHandler(){return{processData:(t,e,s)=>{const n=ve.getGitLabCIEmulationEngine(t.id);if(!n)return e.status="failed",e.error="GitLab CI engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit){const r=i.ref||i.branch?.replace("refs/heads/","")||"main",u=i.variables||{},d=n.triggerWebhook(r,u);d.success?(e.status="delivered",e.latency=50,e.payload={...i||{},gitlab:{webhookReceived:!0,pipelineId:d.pipelineId,ref:r,variables:u,triggered:!0}}):(e.status="failed",e.error=d.reason||"Failed to trigger pipeline",e.latency=50)}else if(o==="getPipelineStatus"||i.pipelineId||i.pipelineIid){const r=i.pipelineId||i.pipelineIid?.toString(),u=n.getPipeline(r||"");e.status="delivered",e.latency=20,e.payload={...i||{},gitlab:{pipelineId:r,status:u?.status||"unknown",duration:u?.duration,stages:u?.stages.map(d=>({name:d.name,status:d.status,duration:d.duration}))}}}else if(o==="getJobStatus"||i.jobId){const r=i.jobId,u=n.getJob(r||"");e.status="delivered",e.latency=20,e.payload={...i||{},gitlab:{jobId:r,status:u?.status||"unknown",progress:u?.progress,duration:u?.duration,logs:u?.logs?.slice(-10)}}}else if(o==="cancelPipeline"||i.cancel){const r=i.pipelineId,u=n.cancelPipeline(r||"");e.status=u.success?"delivered":"failed",e.error=u.reason,e.latency=30,e.payload={...i||{},gitlab:{pipelineId:r,canceled:u.success}}}else e.status="delivered",e.latency=30,e.payload={...i||{},gitlab:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createArgoCDHandler(){return{processData:(t,e,s)=>{const n=ve.getArgoCDEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Argo CD engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit||i.repository){const r=i.repository||i.repo||"",u=i.ref||i.branch||i.commit||"main",d=i.application||i.app||"";d?n.startSync(d)?(e.status="delivered",e.latency=50,e.payload={...i||{},argocd:{webhookReceived:!0,application:d,repository:r,ref:u,syncTriggered:!0}}):(e.status="failed",e.error="Failed to trigger sync or application already syncing",e.latency=50):(e.status="delivered",e.latency=30,e.payload={...i||{},argocd:{webhookReceived:!0,repository:r,ref:u,syncTriggered:!1,reason:"No application specified"}})}else if(o==="sync"||o==="startSync"){const r=i.application||i.app||e.metadata?.application;if(!r)return e.status="failed",e.error="Application name is required for sync operation",e;n.startSync(r)?(e.status="delivered",e.latency=50,e.payload={...i||{},argocd:{operation:"sync",application:r,syncStarted:!0}}):(e.status="failed",e.error="Failed to start sync or application already syncing",e.latency=50)}else if(o==="getApplicationStatus"||o==="getAppStatus"||i.application){const r=i.application||i.app||"",u=n.getApplication(r);e.status="delivered",e.latency=20,e.payload={...i||{},argocd:{application:r,status:u?.status||"unknown",health:u?.health||"unknown",lastSync:u?.lastSync,lastSyncDuration:u?.lastSyncDuration,revision:u?.revision,sourceRevision:u?.sourceRevision}}}else if(o==="getSyncStatus"||i.syncOperationId){const r=i.syncOperationId||i.operationId,d=n.getSyncOperations().find(h=>h.id===r);e.status="delivered",e.latency=20,e.payload={...i||{},argocd:{syncOperationId:r,status:d?.status||"unknown",phase:d?.phase,startedAt:d?.startedAt,finishedAt:d?.finishedAt,error:d?.error}}}else if(o==="getMetrics"||o==="getStats"){const r=n.getMetrics(),u=n.getStats();e.status="delivered",e.latency=15,e.payload={...i||{},argocd:{metrics:r,stats:u}}}else e.status="delivered",e.latency=30,e.payload={...i||{},argocd:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createTerraformHandler(){return{processData:(t,e,s)=>{const n=ve.getTerraformEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Terraform engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"webhook";if(o==="webhook"||i.ref||i.branch||i.commit||i.repository){const r=i.workspace||i.workspaceId||"",u=i.workspaceId||i.workspace,d=i.ref?.replace("refs/heads/","")||i.branch||"main",h=i.commit||i.sha||void 0;if(r||u){const p=n.getWorkspaces(),g=u?p.find(v=>v.id===u):p.find(v=>v.name===r);if(g){const v=n.triggerRun(g.id,{planOnly:i.planOnly??!1,source:"vcs",triggeredBy:"vcs-webhook"});v.success?(e.status="delivered",e.latency=50,e.payload={...i||{},terraform:{webhookReceived:!0,workspaceId:g.id,workspaceName:g.name,branch:d,commit:h,runTriggered:!0,runId:v.runId}}):(e.status="failed",e.error=v.reason||"Failed to trigger run",e.latency=50)}else e.status="failed",e.error="Workspace not found",e.latency=50}else e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{webhookReceived:!0,branch:d,commit:h,runTriggered:!1,reason:"No workspace specified"}}}else if(o==="triggerRun"||o==="createRun"||o==="run"){const r=i.workspaceId||i.workspace||e.metadata?.workspaceId,u=i.planOnly??!1;if(!r)return e.status="failed",e.error="Workspace ID is required for run operation",e;const d=n.triggerRun(r,{planOnly:u,source:"api",triggeredBy:i.triggeredBy||"user"});d.success?(e.status="delivered",e.latency=50,e.payload={...i||{},terraform:{operation:"triggerRun",workspaceId:r,planOnly:u,runId:d.runId,runTriggered:!0}}):(e.status="failed",e.error=d.reason||"Failed to trigger run",e.latency=50)}else if(o==="cancelRun"||o==="cancel"){const r=i.runId||i.run||e.metadata?.runId;if(!r)return e.status="failed",e.error="Run ID is required for cancel operation",e;const u=n.cancelRun(r);u.success?(e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{operation:"cancelRun",runId:r,canceled:!0}}):(e.status="failed",e.error=u.reason||"Failed to cancel run",e.latency=30)}else if(o==="getRunStatus"||o==="getRun"||i.runId){const r=i.runId||i.run||"",u=n.getRun(r);e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{runId:r,status:u?.status||"unknown",workspaceId:u?.workspaceId,workspaceName:u?.workspaceName,createdAt:u?.createdAt,startedAt:u?.startedAt,finishedAt:u?.finishedAt,duration:u?.duration,planOnly:u?.planOnly,message:u?.message,error:u?.error,hasChanges:u?.hasChanges,resourceAdditions:u?.resourceAdditions,resourceChanges:u?.resourceChanges,resourceDestructions:u?.resourceDestructions}}}else if(o==="getWorkspaceStatus"||o==="getWorkspace"||i.workspaceId){const r=i.workspaceId||i.workspace||"",u=n.getWorkspace(r),d=u?n.getStateForWorkspace(r):void 0;e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{workspaceId:r,workspace:u?{id:u.id,name:u.name,description:u.description,terraformVersion:u.terraformVersion,autoApply:u.autoApply,lastRun:u.lastRun}:null,state:d?{version:d.version,serial:d.serial,resources:d.resources,updatedAt:d.updatedAt}:null}}}else if(o==="getMetrics"||o==="getStats"){const r=n.getMetrics();e.status="delivered",e.latency=20,e.payload={...i||{},terraform:{metrics:{workspacesTotal:r.workspacesTotal,runsTotal:r.runsTotal,runsSuccess:r.runsSuccess,runsFailed:r.runsFailed,runsRunning:r.runsRunning,runsPending:r.runsPending,runsPerHour:r.runsPerHour,averageRunDuration:r.averageRunDuration,statesTotal:r.statesTotal,resourcesManaged:r.resourcesManaged}}}}else e.status="delivered",e.latency=30,e.payload={...i||{},terraform:{processed:!0,operation:o}};return n.processRequest(e.status==="delivered"),e},getSupportedFormats:()=>["json","text"]}}createHarborHandler(){return{processData:(t,e,s)=>{if(!ve.getHarborEmulationEngine(t.id))return e.status="failed",e.error="Harbor engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"pull";return o==="push"?(e.status="delivered",e.latency=500+Math.random()*1500,e.payload={...i||{},harbor:{operation:"push",repository:i.repository||"unknown",tag:i.tag||"latest",size:i.size||0,status:"completed"}}):o==="pull"?(e.status="delivered",e.latency=200+Math.random()*800,e.payload={...i||{},harbor:{operation:"pull",repository:i.repository||"unknown",tag:i.tag||"latest",status:"completed"}}):o==="scan"?(e.status="delivered",e.latency=5e3+Math.random()*15e3,e.payload={...i||{},harbor:{operation:"scan",repository:i.repository||"unknown",tag:i.tag||"latest",status:"completed"}}):(e.status="delivered",e.latency=100+Math.random()*200,e.payload={...i||{},harbor:{operation:o,status:"completed"}}),e},getSupportedFormats:()=>["json","binary"]}}createDockerHandler(){return{processData:(t,e,s)=>{if(!ve.getDockerEmulationEngine(t.id))return e.status="failed",e.error="Docker engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"container-operation";if(o.startsWith("container-")){const r=o.replace("container-","");switch(e.status="delivered",r){case"create":e.latency=500+Math.random()*1e3;break;case"start":e.latency=200+Math.random()*500;break;case"stop":e.latency=100+Math.random()*300;break;case"restart":e.latency=300+Math.random()*700;break;default:e.latency=100+Math.random()*200}e.payload={...i||{},docker:{operation:r,containerId:i.containerId||"unknown",status:"completed"}}}else if(o.startsWith("image-")){const r=o.replace("image-","");switch(e.status="delivered",r){case"pull":e.latency=2e3+Math.random()*8e3;break;case"push":e.latency=3e3+Math.random()*1e4;break;case"build":e.latency=5e3+Math.random()*15e3;break;default:e.latency=1e3+Math.random()*2e3}e.payload={...i||{},docker:{operation:r,imageId:i.imageId||"unknown",status:"completed"}}}else e.status="delivered",e.latency=100+Math.random()*200,e.payload={...i||{},docker:{operation:o,status:"completed"}};return e},getSupportedFormats:()=>["json","text"]}}createVaultHandler(){return{processData:(t,e,s)=>{const n=ve.getVaultEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Vault engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"read",r=i?.path||e.metadata?.path||"secret/default",u=i?.token||e.metadata?.token;let d;if(typeof o=="string"){const h=o.toLowerCase();if(h.includes("write")||h==="create"||h==="update"){const p=i?.data||i?.value||{};d=n.processWriteRequest(r,p,u)}else if(h.includes("delete")||h==="remove")d=n.processDeleteRequest(r,u);else if(h.includes("encrypt")){const p=i?.plaintext||i?.data||"",g=i?.key||i?.keyName||"default";d=n.processEncryptRequest(p,g,u)}else if(h.includes("decrypt")){const p=i?.ciphertext||i?.data||"",g=i?.key||i?.keyName||"default";d=n.processDecryptRequest(p,g,u)}else if(h.includes("auth")||h==="login"||h==="authenticate"){const p=i?.method||i?.authMethod||"token";d=n.processAuthRequest(p,i)}else{const p=i?.key;d=n.processReadRequest(r,p,u)}}else{const h=i?.key;d=n.processReadRequest(r,h,u)}return e.latency=(e.latency||0)+d.latency,d.success?(e.status="delivered",e.payload={...i||{},vault:{path:r,data:d.data,token:d.token,policies:d.policies}},d.token&&(e.metadata={...e.metadata,vaultToken:d.token,vaultPolicies:d.policies})):(e.status="failed",e.error=d.error||"Vault operation failed"),e},getSupportedFormats:()=>["json","text"]}}createWAFHandler(){return{processData:(t,e,s)=>{const n=ve.getWAFEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload||{},o=i?.path||e.metadata?.path||"/",r=i?.method||e.metadata?.method||"GET",u=i?.headers||e.metadata?.headers||{},d=i?.query||e.metadata?.query||{},h=i?.body||i,p=i?.sourceIP||e.metadata?.sourceIP||u["x-forwarded-for"]||u["x-real-ip"],g=i?.country||e.metadata?.country||u["cf-ipcountry"],v=i?.userAgent||e.metadata?.userAgent||u["user-agent"],b=n.processRequest({path:o,method:r,headers:u,query:d,body:h,sourceIP:p,country:g,userAgent:v});return e.latency=(e.latency||0)+b.latency,b.blocked?(e.status="failed",e.error=b.error||`Request blocked by WAF: ${b.threatDetected?"Threat detected":"Rule matched"}`,b.threatDetected&&(e.metadata={...e.metadata,wafBlocked:!0,wafThreatDetected:!0,wafAction:"block"})):!b.success&&b.action==="challenge"?(e.status="pending",e.metadata={...e.metadata,wafChallenge:!0,wafAction:"challenge"}):(e.status="delivered",e.metadata={...e.metadata,wafChecked:!0,wafAllowed:!0,wafLatency:b.latency},b.threatDetected&&(e.metadata.wafThreatDetected=!0,e.metadata.wafAction="log")),e},getSupportedFormats:()=>["json","text","xml"]}}createFirewallHandler(){return{processData:(t,e,s)=>{const n=ve.getFirewallEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload||{},o=i?.source||e.metadata?.sourceIP||i?.sourceIP||"0.0.0.0",r=i?.destination||e.metadata?.destinationIP||i?.destinationIP||"10.0.0.1",u=i?.protocol||e.metadata?.protocol||"tcp",d=i?.port||e.metadata?.port||i?.destinationPort,h=i?.sourcePort||e.metadata?.sourcePort,p=n.processPacket({source:o,destination:r,protocol:u,port:d,sourcePort:h});return e.latency=(e.latency||0)+p.latency,p.blocked?(e.status="failed",e.error=p.error||`Packet ${p.action} by Firewall: ${p.matchedRule?.name||"Default policy"}`,e.metadata={...e.metadata,firewallBlocked:!0,firewallAction:p.action,firewallRuleId:p.matchedRule?.id,firewallRuleName:p.matchedRule?.name}):(e.status="delivered",e.metadata={...e.metadata,firewallChecked:!0,firewallAllowed:!0,firewallLatency:p.latency,firewallRuleId:p.matchedRule?.id,firewallRuleName:p.matchedRule?.name}),e},getSupportedFormats:()=>["json","text","binary"]}}createIDSIPSHandler(){return{processData:(t,e,s)=>{const n=ve.getIDSIPSEmulationEngine(t.id);if(!n)return e.status="delivered",e;const i=e.payload||{},o=i?.source||e.metadata?.sourceIP||i?.sourceIP||"0.0.0.0",r=i?.destination||e.metadata?.destinationIP||i?.destinationIP||"10.0.0.1",u=i?.protocol||e.metadata?.protocol||"tcp",d=i?.port||e.metadata?.port||i?.destinationPort,h=i?.sourcePort||e.metadata?.sourcePort,p=i?.payload||i?.body||(typeof i=="string"?i:JSON.stringify(i)),g=n.processPacket({source:o,destination:r,protocol:u,port:d,sourcePort:h,payload:p});return e.latency=(e.latency||0)+g.latency,g.blocked?(e.status="failed",e.error=g.error||"Packet blocked by IDS/IPS: Intrusion detected",e.metadata={...e.metadata,idsipsBlocked:!0,idsipsAlertGenerated:g.alertGenerated,idsipsAction:"block"},g.alertGenerated&&(e.metadata.idsipsAlertType="intrusion")):(e.status="delivered",e.metadata={...e.metadata,idsipsChecked:!0,idsipsAllowed:!0,idsipsLatency:g.latency,idsipsAlertGenerated:g.alertGenerated},g.alertGenerated&&(e.metadata.idsipsAction="alert",e.metadata.idsipsAlertType="intrusion")),e},getSupportedFormats:()=>["json","text","binary"]}}createOpenTelemetryCollectorHandler(){return{processData:(t,e,s)=>{const n=ve.getOpenTelemetryCollectorRoutingEngine(t.id);if(!n)return e.status="delivered",e;const i=this.nodes.find(r=>r.id===e.source),o=n.processMessage(e,i||void 0);return o.success?(e.status="delivered",e.latency=o.latency):(e.status="failed",e.error=o.error||"OpenTelemetry Collector processing failed",e.latency=o.latency),e},getSupportedFormats:()=>["json","protobuf","binary","text"]}}createCRMDataMessage(t){const e=t.data.config||{},s=e.contacts||[],n=e.deals||[],i=Math.random()>.5?"contact":"deal";let o;if(i==="contact"&&s.length>0){const u=s[Math.floor(Math.random()*s.length)];o={operation:"create",type:"contact",data:{name:u.name,email:u.email,company:u.company,status:u.status}}}else if(n.length>0){const u=n[Math.floor(Math.random()*n.length)];o={operation:"update",type:"deal",data:{id:u.id,name:u.name,value:u.value,stage:u.stage}}}else o={operation:"create",type:"contact",data:{name:`Contact ${Date.now()}`,email:`contact${Date.now()}@example.com`}};const r=JSON.stringify(o);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:o,size:new Blob([r]).size,metadata:{contentType:"application/json",operation:o.operation},status:"pending"}}createERPDataMessage(t){const e=t.data.config||{},s=e.orders||[],n=e.inventory||[],i=Math.random()>.5?"order":"inventory";let o;if(i==="order"&&s.length>0){const u=s[Math.floor(Math.random()*s.length)];o={operation:"create",type:"order",data:{orderNumber:u.orderNumber,customer:u.customer,total:u.total,items:u.items}}}else if(n.length>0){const u=n[Math.floor(Math.random()*n.length)];o={operation:"update",type:"inventory",data:{sku:u.sku,quantity:u.quantity,status:u.status}}}else o={operation:"create",type:"order",data:{orderNumber:`ORD-${Date.now()}`,total:Math.random()*1e3}};const r=JSON.stringify(o);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:o,size:new Blob([r]).size,metadata:{contentType:"application/json",operation:o.operation},status:"pending"}}createPaymentDataMessage(t){const s=(t.data.config||{}).transactions||[];let n;if(s.length>0){const o=s[Math.floor(Math.random()*s.length)];n={operation:"process",type:"transaction",data:{id:o.id,amount:o.amount,currency:o.currency,status:o.status}}}else n={operation:"process",type:"transaction",data:{amount:Math.random()*1e3,currency:"USD"}};const i=JSON.stringify(n);return{id:"",timestamp:Date.now(),source:t.id,target:"",connectionId:"",format:"json",payload:n,size:new Blob([i]).size,metadata:{contentType:"application/json",operation:n.operation},status:"pending"}}generateQueryResults(t,e){const s=Math.floor(Math.random()*10)+1,n=[];for(let i=0;i<s;i++)n.push({id:i+1,name:`Record ${i+1}`,value:Math.random()*100,timestamp:new Date().toISOString()});return n}createSparkHandler(){return{processData:(t,e,s)=>{const n=ve.getSparkEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Spark engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"process-data";if(o==="process-data"||o==="job"||!o){const r=e.size||0,u=i.jobName||`Data Processing Job ${Date.now()}`,d={id:`job-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:u,status:"RUNNING",startTime:Date.now(),stages:3+Math.floor(Math.random()*5),tasks:10+Math.floor(Math.random()*90),executors:n.getExecutors().filter(h=>h.status==="ALIVE").length,inputBytes:r,outputBytes:Math.floor(r*.8),shuffleRead:Math.floor(r*.3),shuffleWrite:Math.floor(r*.3),submissionTime:Date.now()};return n.addJob(d),e.latency=100+Math.random()*200,e.status="delivered",e.payload={...e.payload,sparkJobId:d.id,jobName:d.name,status:"RUNNING",message:"Spark job created and started"},e}else if(o==="query"||o==="sql"){const r=i.sql||i.query||"";if(!r)return e.status="failed",e.error="SQL query is required",e;const u=n.executeSQL(r,Date.now()),d=u.executionTime||2e3;return e.latency=d,e.status="delivered",e.payload={...e.payload,sqlQueryId:u.id,explainPlan:u.explainPlan,physicalPlan:u.physicalPlan,logicalPlan:u.logicalPlan,results:this.generateQueryResults("spark",r),query:r,processed:!0,status:"RUNNING"},e}else if(o==="streaming"){const r=i.streamConfig||{},u=r.batchInterval||s.streamingBatchInterval||1e3,d=r.name||`Streaming Job ${Date.now()}`,h=n.createStreamingJob(d,u,Date.now());return e.latency=u,e.status="delivered",e.payload={...e.payload,streamingJobId:h.id,streaming:!0,batchInterval:u,message:"Streaming job started",status:"ACTIVE"},e}else return e.status="failed",e.error=`Unknown Spark operation: ${o}`,e},getSupportedFormats:()=>["json","text","binary"]}}createTensorFlowServingHandler(){return{processData:(t,e,s)=>{const n=ve.getTensorFlowServingEmulationEngine(t.id);if(!n)return e.status="failed",e.error="TensorFlow Serving engine not initialized",e;const i=e.payload||{},o=i.model||i.modelName||e.metadata?.model||e.metadata?.modelName||"",r=i.version||e.metadata?.version||"1",u=i.input||i.instances||i.data||e.payload;if(!o)return e.status="failed",e.error="Model name is required",e;try{n.addPendingPrediction(o,r,u).then(h=>{h.success?(e.status="delivered",e.latency=h.latency,e.payload={...e.payload,model:o,version:r,latency:h.latency,predictions:h.output}):(e.status="failed",e.error=h.error||"Prediction failed"),e.metadata={...e.metadata,model:o,version:r}}).catch(h=>{e.status="failed",e.error=h instanceof Error?h.message:"Prediction error"}),e.status="in-transit",e.metadata={...e.metadata,model:o,version:r}}catch(d){e.status="failed",e.error=d instanceof Error?d.message:"Prediction error"}return e},getSupportedFormats:()=>["json"]}}createPyTorchServeHandler(){return{processData:(t,e,s)=>{const n=ve.getPyTorchServeEmulationEngine(t.id);if(!n)return e.status="failed",e.error="PyTorch Serve engine not initialized",e;const i=e.payload||{},o=i.model||i.modelName||e.metadata?.model||e.metadata?.modelName||"",r=i.version||e.metadata?.version||"1",u=i.input||i.instances||i.data||e.payload;if(!o)return e.status="failed",e.error="Model name is required",e;try{n.addPendingPrediction(o,r,u).then(h=>{h.success?(e.status="delivered",e.latency=h.latency,e.payload={...e.payload,model:o,version:r,latency:h.latency,predictions:h.output}):(e.status="failed",e.error=h.error||"Prediction failed"),e.metadata={...e.metadata,model:o,version:r}}).catch(h=>{e.status="failed",e.error=h instanceof Error?h.message:"Prediction error"}),e.status="in-transit",e.metadata={...e.metadata,model:o,version:r}}catch(d){e.status="failed",e.error=d instanceof Error?d.message:"Prediction error"}return e},getSupportedFormats:()=>["json"]}}createFeatureStoreHandler(){return{processData:(t,e,s)=>{const n=ve.getFeatureStoreEmulationEngine(t.id);if(!n)return e.status="failed",e.error="Feature Store engine not initialized",e;const i=e.payload||{},o=e.metadata?.operation||i.operation||i.action||"get-features",r=i.features||i.featureNames||e.metadata?.features||[],u=i.entities||i.entityIds||e.metadata?.entities,d=i.requestType||e.metadata?.requestType||"online",h=i.pointInTime||e.metadata?.pointInTime;if(o==="get-features"||o==="get-feature-set"||!o){if(!Array.isArray(r)||r.length===0)return e.status="failed",e.error="Feature names are required",e;const p=n.processFeatureRequest(r,u,d,h);return e.latency=(e.latency||0)+p.latency,p.success?(e.status="delivered",e.payload={...e.payload,features:p.data,cacheHit:p.cacheHit,requestType:d},e.metadata={...e.metadata,operation:"get-features",features:r,requestType:d,cacheHit:p.cacheHit}):(e.status="failed",e.error=p.error||"Feature request failed"),e}else if(o==="write-features"||o==="write"){const p=i.features||i.data||{};return Object.keys(p).length===0?(e.status="failed",e.error="Features data is required",e):(e.latency=(e.latency||0)+10,e.status="delivered",e.payload={...e.payload,written:!0,features:Object.keys(p)},e.metadata={...e.metadata,operation:"write-features"},e)}else if(o==="validate-features"||o==="validate"){const p=i.features||i.data||{};return Object.keys(p).length===0?(e.status="failed",e.error="Features data is required for validation",e):(e.latency=(e.latency||0)+5,e.status="delivered",e.payload={...e.payload,validated:!0,features:Object.keys(p)},e.metadata={...e.metadata,operation:"validate-features"},e)}else return e.status="failed",e.error=`Unknown Feature Store operation: ${o}`,e},getSupportedFormats:()=>["json","text"]}}}const cs=new TT;class kT{componentStates=new Map;setComponentState(t,e,s){const n={nodeId:t,state:e,degradedLevel:s?.degradedLevel||.5,failureRate:s?.failureRate||.1,latencyMultiplier:s?.latencyMultiplier||2,throughputMultiplier:s?.throughputMultiplier||.5};this.componentStates.set(t,n)}getComponentState(t){return this.componentStates.get(t)}isEnabled(t){const e=this.componentStates.get(t);return!e||e.state==="enabled"}applyStateEffects(t,e){const s=this.componentStates.get(t);if(!s||s.state==="enabled")return{...e};if(s.state==="disabled"||s.state==="failed")return{throughput:0,latency:1/0,errorRate:1,utilization:0};if(s.state==="degraded"){const n=s.degradedLevel||.5;return{throughput:e.throughput*(s.throughputMultiplier||.5)*(1-n*.5),latency:e.latency*(s.latencyMultiplier||2)*(1+n),errorRate:Math.min(1,e.errorRate+(s.failureRate||.1)*n),utilization:Math.min(1,e.utilization*(1+n*.3))}}return{...e}}reset(){this.componentStates.clear()}resetComponent(t){this.componentStates.delete(t)}getAllStates(){return Array.from(this.componentStates.values())}}const ma=new kT;class AT{queues=new Map;exchanges=new Map;bindings=new Map;queueMessages=new Map;unackedMessages=new Map;queueState=new Map;initialize(t){if(this.queues.clear(),this.exchanges.clear(),this.bindings.clear(),this.queueMessages.clear(),this.unackedMessages.clear(),this.queueState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.unackedMessages.set(e.name,[]),this.queueState.set(e.name,{ready:e.ready||0,unacked:e.unacked||0,total:e.messages||0,lastUpdate:Date.now()});if(t.exchanges)for(const e of t.exchanges)this.exchanges.set(e.name,{...e}),this.bindings.set(e.name,[]);if(t.bindings)for(const e of t.bindings){const s=this.bindings.get(e.source)||[];s.push(e),this.bindings.set(e.source,s)}}routeMessage(t,e,s,n,i,o){const r=this.exchanges.get(t);if(!r)return[];const u=this.bindings.get(t)||[],d=[];for(const g of u)this.shouldRouteToQueue(r,g,e,i)&&d.push(g.destination);const h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=Date.now();for(const g of d){const v=this.queues.get(g);if(!v)continue;if(v.maxLength&&(this.queueMessages.get(g)||[]).length>=v.maxLength){v.deadLetterExchange&&this.routeToDeadLetterExchange(v.deadLetterExchange,v.deadLetterRoutingKey||e,s,n,i,o);continue}const b={id:h,timestamp:p,routingKey:e,exchange:t,payload:s,size:n,priority:o||v.maxPriority?o||0:void 0,headers:i,ttl:v.messageTtl?p+v.messageTtl:void 0},x=this.queueMessages.get(g)||[];x.push(b),v.maxPriority&&b.priority!==void 0&&x.sort((R,C)=>(C.priority||0)-(R.priority||0)),this.queueMessages.set(g,x)}return d}shouldRouteToQueue(t,e,s,n){switch(t.type){case"direct":return e.routingKey===s;case"topic":return this.matchTopicPattern(e.routingKey,s);case"fanout":return!0;case"headers":if(!n||!e.arguments)return!1;for(const[i,o]of Object.entries(e.arguments))if(!i.startsWith("x-")&&n[i]!==o)return!1;return!0;default:return!1}}matchTopicPattern(t,e){const s=t.replace(/\./g,"\\.").replace(/\*/g,"[^.]+").replace(/#/g,".*");return new RegExp(`^${s}$`).test(e)}routeToDeadLetterExchange(t,e,s,n,i,o){this.routeMessage(t,e,s,n,i,o)}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){let i=this.queueMessages.get(s)||[],o=this.unackedMessages.get(s)||[];const r=this.queueState.get(s)||{ready:0,unacked:0,total:0,lastUpdate:e};i=i.filter(R=>R.ttl&&e>R.ttl?(n.deadLetterExchange&&this.routeToDeadLetterExchange(n.deadLetterExchange,n.deadLetterRoutingKey||R.routingKey,R.payload,R.size,R.headers,R.priority),!1):!0),this.queueMessages.set(s,i);const h=(n.consumers||0)*10*t/1e3,p=Math.min(h,i.length),g=i.splice(0,p);o.push(...g),this.unackedMessages.set(s,o);const b=t/100*o.length,x=Math.min(b,o.length);o.splice(0,Math.floor(x)),this.unackedMessages.set(s,o),r.ready=i.length,r.unacked=o.length,r.total=i.length+o.length,r.lastUpdate=e,this.queueState.set(s,r)}}getQueueMetrics(t){const e=this.queues.get(t);if(!e)return null;const s=this.queueMessages.get(t)||[],n=this.unackedMessages.get(t)||[];this.queueState.get(t);const i=s.length,o=n.length;return{messages:i+o,ready:i,unacked:o,consumers:e.consumers||0}}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;for(const e of this.unackedMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queues.values())e.consumers&&(t+=e.consumers);return t+=this.exchanges.size,Math.max(1,t)}updateQueue(t,e){const s=this.queues.get(t);s&&(Object.assign(s,e),this.queues.set(t,s))}}class DT{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;queueState=new Map;topicState=new Map;initialize(t){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.queueState.clear(),this.topicState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.queueState.set(e.name,{queueSize:e.queueSize||0,consumerCount:e.consumerCount||0,enqueueCount:e.enqueueCount||0,dequeueCount:e.dequeueCount||0,lastUpdate:Date.now()});if(t.topics)for(const e of t.topics)this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.subscriptions.set(e.name,[]),this.topicState.set(e.name,{subscriberCount:e.subscriberCount||0,enqueueCount:e.enqueueCount||0,dequeueCount:e.dequeueCount||0,lastUpdate:Date.now()});if(t.subscriptions)for(const e of t.subscriptions){const s=this.subscriptions.get(e.destination)||[];s.push(e),this.subscriptions.set(e.destination,s),this.subscriptionMessages.set(e.id,[])}}routeToQueue(t,e,s,n,i){if(!this.queues.get(t))return!1;const r=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=Date.now(),d={id:r,timestamp:u,destination:t,payload:e,size:s,headers:n,priority:i},h=this.queueMessages.get(t)||[];h.push(d),i!==void 0&&h.sort((g,v)=>(v.priority||0)-(g.priority||0)),this.queueMessages.set(t,h);const p=this.queueState.get(t)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:u};return p.queueSize=h.length,p.enqueueCount=(p.enqueueCount||0)+1,p.lastUpdate=u,this.queueState.set(t,p),!0}publishToTopic(t,e,s,n,i){if(!this.topics.get(t))return[];const r=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=Date.now(),d=this.subscriptions.get(t)||[],h=[],p={id:r,timestamp:u,destination:t,payload:e,size:s,headers:n,priority:i};for(const v of d){if(v.selector&&!this.matchesSelector(v.selector,n))continue;const b=this.subscriptionMessages.get(v.id)||[];b.push(p),this.subscriptionMessages.set(v.id,b),h.push(v.id),v.pendingQueueSize=(v.pendingQueueSize||0)+1,v.enqueueCounter=(v.enqueueCounter||0)+1}if(d.length===0){const v=this.topicMessages.get(t)||[];v.push(p),this.topicMessages.set(t,v)}const g=this.topicState.get(t)||{subscriberCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:u};return g.enqueueCount=(g.enqueueCount||0)+1,g.lastUpdate=u,this.topicState.set(t,g),h}matchesSelector(t,e){if(!e||!t)return!0;try{const s=t.trim(),n=s.match(/^(\w+)\s*=\s*['"]([^'"]+)['"]$/);if(n){const o=n[1],r=n[2];return e[o]===r}const i=s.match(/^(\w+)\s*([><=]+)\s*(\d+)$/);if(i){const o=i[1],r=i[2],u=Number(i[3]),d=Number(e[o]);if(isNaN(d))return!1;switch(r){case">":return d>u;case"<":return d<u;case">=":return d>=u;case"<=":return d<=u;case"=":return d===u;default:return!1}}for(const o in e)if(s.includes(o))return!0;return!1}catch{return!0}}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){let i=this.queueMessages.get(s)||[];const o=this.queueState.get(s)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:e};i=i.filter(g=>!(g.ttl&&e>g.ttl)),this.queueMessages.set(s,i);const d=(n.consumerCount||o.consumerCount||0)*10*t/1e3,h=Math.min(d,i.length),p=i.splice(0,Math.floor(h));this.queueMessages.set(s,i),o.queueSize=i.length,o.dequeueCount=(o.dequeueCount||0)+p.length,o.lastUpdate=e,this.queueState.set(s,o)}for(const[s,n]of this.subscriptions.entries()){for(const o of n){let r=this.subscriptionMessages.get(o.id)||[];r=r.filter(g=>!(g.ttl&&e>g.ttl));const d=10*t/1e3,h=Math.min(d,r.length),p=r.splice(0,Math.floor(h));o.pendingQueueSize=r.length,o.dispatchedQueueSize=(o.dispatchedQueueSize||0)+p.length,o.dequeueCounter=(o.dequeueCounter||0)+p.length,this.subscriptionMessages.set(o.id,r)}const i=this.topicState.get(s);i&&(i.dequeueCount=n.reduce((o,r)=>o+(r.dequeueCounter||0),0),i.lastUpdate=e)}}getQueueMetrics(t){if(!this.queues.get(t))return null;const s=this.queueState.get(t);return s?{queueSize:s.queueSize,consumerCount:s.consumerCount,enqueueCount:s.enqueueCount,dequeueCount:s.dequeueCount}:null}getTopicMetrics(t){if(!this.topics.get(t))return null;const s=this.topicState.get(t);return s?{subscriberCount:s.subscriberCount,enqueueCount:s.enqueueCount,dequeueCount:s.dequeueCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getAllTopicMetrics(){const t=new Map;for(const e of this.topics.keys()){const s=this.getTopicMetrics(e);s&&t.set(e,s)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;return t}getTotalTopicMessages(){let t=0;for(const e of this.subscriptionMessages.values())t+=e.length;for(const e of this.topicMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queues.values())e.consumerCount&&(t+=e.consumerCount);for(const e of this.subscriptions.values())t+=e.length;return Math.max(1,t+1)}updateQueue(t,e){const s=this.queues.get(t);if(s){Object.assign(s,e),this.queues.set(t,s);const n=this.queueState.get(t);n&&e.consumerCount!==void 0&&(n.consumerCount=e.consumerCount)}}updateTopic(t,e){const s=this.topics.get(t);if(s){Object.assign(s,e),this.topics.set(t,s);const n=this.topicState.get(t);n&&e.subscriberCount!==void 0&&(n.subscriberCount=e.subscriberCount)}}}class PT{queues=new Map;queueMessages=new Map;inFlightMessages=new Map;dlqMessages=new Map;queueState=new Map;messageGroups=new Map;deduplicationIds=new Map;initialize(t){if(this.queues.clear(),this.queueMessages.clear(),this.inFlightMessages.clear(),this.dlqMessages.clear(),this.queueState.clear(),this.messageGroups.clear(),this.deduplicationIds.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.inFlightMessages.set(e.name,[]),this.queueState.set(e.name,{approximateMessages:0,approximateMessagesNotVisible:0,approximateMessagesDelayed:0,sentCount:0,receivedCount:0,deletedCount:0,dlqCount:0,lastUpdate:Date.now()}),e.type==="fifo"&&(this.messageGroups.set(e.name,new Map),this.deduplicationIds.set(e.name,new Set))}sendMessage(t,e,s,n,i,o){const r=this.queues.get(t);if(!r)return null;const u=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=`${t}-${d}`;if(r.type==="fifo"){if(r.contentBasedDedup&&!o){const k=JSON.stringify(e);o=this.hashString(k)}if(o){const k=this.deduplicationIds.get(t);if(k&&k.has(o))return h;k?.add(o)}i||(i="default-group")}const p=r.messageRetention*24*60*60*1e3,g=u+p,v=r.delaySeconds*1e3,b=v>0?u+v:void 0,x={id:d,messageId:h,timestamp:u,queueName:t,payload:e,size:s,attributes:n,messageGroupId:i,messageDeduplicationId:o,receiveCount:0,retentionExpiresAt:g,delayUntil:b},R=this.queueMessages.get(t)||[];if(r.type==="fifo"&&i){const k=this.messageGroups.get(t);if(k){const T=k.get(i)||[];T.push(x),k.set(i,T)}}R.push(x),this.queueMessages.set(t,R);const C=this.queueState.get(t);if(C){const k=this.queueMessages.get(t)||[],T=this.inFlightMessages.get(t)||[],A=k.filter(D=>D.delayUntil&&u<D.delayUntil);C.approximateMessages=k.length,C.approximateMessagesNotVisible=T.length,C.approximateMessagesDelayed=A.length,C.sentCount=(C.sentCount||0)+1,C.lastUpdate=u}return h}receiveMessage(t,e=1,s){const n=this.queues.get(t);if(!n)return[];const i=Date.now(),r=(s!==void 0?s:n.visibilityTimeout)*1e3;let u=(this.queueMessages.get(t)||[]).filter(g=>!(g.delayUntil&&i<g.delayUntil||i>=g.retentionExpiresAt));if(n.type==="fifo"){const g=this.messageGroups.get(t);if(g){u=[];let v=0;for(const[b,x]of g.entries()){if(v>=e)break;if(x.length>0){const R=x[0];(!R.delayUntil||i>=R.delayUntil)&&i<R.retentionExpiresAt&&(u.push(R),v++)}}}}const d=Math.min(e,u.length),h=[];for(let g=0;g<d;g++){const v=u[g],b=`receipt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;v.receiptHandle=b,v.receiveCount=(v.receiveCount||0)+1,v.firstReceivedAt||(v.firstReceivedAt=i);const x={message:v,receivedAt:i,visibilityTimeoutExpiresAt:i+r},R=this.inFlightMessages.get(t)||[];R.push(x),this.inFlightMessages.set(t,R);const C=this.queueMessages.get(t)||[],k=C.indexOf(v);if(k>-1&&C.splice(k,1),this.queueMessages.set(t,C),n.type==="fifo"&&v.messageGroupId){const T=this.messageGroups.get(t);if(T){const A=T.get(v.messageGroupId)||[],D=A.indexOf(v);D>-1&&A.splice(D,1),A.length===0?T.delete(v.messageGroupId):T.set(v.messageGroupId,A)}}h.push(v)}const p=this.queueState.get(t);return p&&(p.receivedCount=(p.receivedCount||0)+h.length,p.lastUpdate=i),h}deleteMessage(t,e){if(!this.queues.get(t))return!1;const n=this.inFlightMessages.get(t)||[],i=n.findIndex(r=>r.message.receiptHandle===e);if(i===-1)return!1;n[i],n.splice(i,1),this.inFlightMessages.set(t,n);const o=this.queueState.get(t);return o&&(o.deletedCount=(o.deletedCount||0)+1,o.lastUpdate=Date.now()),!0}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){const i=this.inFlightMessages.get(s)||[],o=[],r=[];for(const p of i)if(e>=p.visibilityTimeoutExpiresAt){const g=p.message;g.receiptHandle=void 0,n.maxReceiveCount&&g.receiveCount>=n.maxReceiveCount?this.sendToDLQ(n,g):o.push(g)}else r.push(p);if(this.inFlightMessages.set(s,r),o.length>0){const p=this.queueMessages.get(s)||[];if(n.type==="fifo"){const g=this.messageGroups.get(s);if(g)for(const v of o){const b=v.messageGroupId||"default-group",x=g.get(b)||[];x.push(v),g.set(b,x)}}p.push(...o),this.queueMessages.set(s,p)}const d=(this.queueMessages.get(s)||[]).filter(p=>e>=p.retentionExpiresAt?(n.deadLetterQueue&&this.sendToDLQ(n,p),!1):!0);if(this.queueMessages.set(s,d),n.type==="fifo"){const p=this.messageGroups.get(s);if(p)for(const[g,v]of p.entries()){const b=v.filter(x=>e>=x.retentionExpiresAt?(n.deadLetterQueue&&this.sendToDLQ(n,x),!1):!0);b.length===0?p.delete(g):p.set(g,b)}}const h=this.queueState.get(s);if(h){const p=this.queueMessages.get(s)||[],g=this.inFlightMessages.get(s)||[],v=p.filter(b=>b.delayUntil&&e<b.delayUntil);h.approximateMessages=p.length,h.approximateMessagesNotVisible=g.length,h.approximateMessagesDelayed=v.length,h.lastUpdate=e}}}sendToDLQ(t,e){if(!t.deadLetterQueue||!this.queues.get(t.deadLetterQueue))return;const n=this.dlqMessages.get(t.deadLetterQueue)||[];n.push(e),this.dlqMessages.set(t.deadLetterQueue,n);const i=this.queueState.get(t.deadLetterQueue);i&&(i.dlqCount=(i.dlqCount||0)+1,i.approximateMessages=n.length);const o=this.queueState.get(t.name);o&&(o.dlqCount=(o.dlqCount||0)+1)}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e).toString(36)}getQueueMetrics(t){if(!this.queues.get(t))return null;const s=this.queueState.get(t);return s?{approximateMessages:s.approximateMessages,approximateMessagesNotVisible:s.approximateMessagesNotVisible,approximateMessagesDelayed:s.approximateMessagesDelayed,sentCount:s.sentCount,receivedCount:s.receivedCount,deletedCount:s.deletedCount,dlqCount:s.dlqCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getTotalQueueDepth(){let t=0;for(const e of this.queueMessages.values())t+=e.length;for(const e of this.inFlightMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.queueState.values())(e.sentCount>0||e.receivedCount>0)&&(t+=1);return Math.max(1,t)}updateQueue(t,e){const s=this.queues.get(t);s&&(Object.assign(s,e),this.queues.set(t,s))}}class _T{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;lockedMessages=new Map;deadLetterMessages=new Map;scheduledMessages=new Map;sessionMessages=new Map;queueState=new Map;subscriptionState=new Map;initialize(t){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.lockedMessages.clear(),this.deadLetterMessages.clear(),this.scheduledMessages.clear(),this.sessionMessages.clear(),this.queueState.clear(),this.subscriptionState.clear(),t.queues)for(const e of t.queues)this.queues.set(e.name,{...e}),this.queueMessages.set(e.name,[]),this.lockedMessages.set(e.name,[]),this.deadLetterMessages.set(e.name,[]),this.scheduledMessages.set(e.name,[]),this.queueState.set(e.name,{activeMessageCount:e.activeMessageCount||0,deadLetterMessageCount:e.deadLetterMessageCount||0,scheduledMessageCount:e.scheduledMessageCount||0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),e.enableSessions&&this.sessionMessages.set(e.name,new Map);if(t.topics){for(const e of t.topics)if(this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.scheduledMessages.set(e.name,[]),this.subscriptions.set(e.name,[]),e.subscriptions)for(const s of e.subscriptions){const n=this.subscriptions.get(e.name)||[];n.push(s),this.subscriptions.set(e.name,n);const i=`${e.name}/subscriptions/${s.name}`;this.subscriptionMessages.set(i,[]),this.lockedMessages.set(i,[]),this.deadLetterMessages.set(i,[]),this.subscriptionState.set(i,{activeMessageCount:s.activeMessageCount||0,deadLetterMessageCount:0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),this.sessionMessages.set(i,new Map)}}}sendToQueue(t,e,s,n,i,o){const r=this.queues.get(t);if(!r)return null;const u=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=`${t}-${d}`,p=r.defaultMessageTimeToLive*1e3,g=u+p,v={id:d,messageId:h,timestamp:u,destination:t,payload:e,size:s,properties:n,sessionId:i,scheduledEnqueueTime:o,expirationTime:g,deliveryCount:0,enqueuedTime:o||u};if(o&&o>u){const x=this.scheduledMessages.get(t)||[];x.push(v),this.scheduledMessages.set(t,x);const R=this.queueState.get(t);return R&&(R.scheduledMessageCount=x.length),h}if(r.enableSessions&&i){const x=this.sessionMessages.get(t);if(x){const R=x.get(i)||[];R.push(v),x.set(i,R)}}else{const x=this.queueMessages.get(t)||[];x.push(v),this.queueMessages.set(t,x)}const b=this.queueState.get(t);if(b){const x=this.getAvailableMessages(t);b.activeMessageCount=x.length,b.sentCount=(b.sentCount||0)+1,b.lastUpdate=u}return h}publishToTopic(t,e,s,n,i){const o=this.topics.get(t);if(!o)return[];const r=Date.now(),u=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=`${t}-${u}`,h=o.defaultMessageTimeToLive*1e3,p=r+h,g={id:u,messageId:d,timestamp:r,destination:t,payload:e,size:s,properties:n,scheduledEnqueueTime:i,expirationTime:p,deliveryCount:0,enqueuedTime:i||r},v=[];if(i&&i>r){const x=this.scheduledMessages.get(t)||[];return x.push(g),this.scheduledMessages.set(t,x),[d]}const b=this.subscriptions.get(t)||[];if(b.length===0)return[];for(const x of b){const R=`${t}/subscriptions/${x.name}`,C=this.subscriptionMessages.get(R)||[],k={...g,id:`${u}-${x.name}`,messageId:`${d}-${x.name}`,subscriptionName:x.name};C.push(k),this.subscriptionMessages.set(R,C),v.push(k.messageId);const T=this.subscriptionState.get(R);if(T){const A=this.getAvailableSubscriptionMessages(R);T.activeMessageCount=A.length,T.sentCount=(T.sentCount||0)+1,T.lastUpdate=r}}return v}receiveFromQueue(t,e,s){const n=this.queues.get(t);if(!n)return null;const i=Date.now(),o=(e||n.lockDuration)*1e3,r=i+o;let u;if(n.enableSessions&&s){const g=this.sessionMessages.get(t);if(!g)return null;u=g.get(s)||[]}else u=this.getAvailableMessages(t);if(u.length===0)return null;const d=u.shift();d.deliveryCount=(d.deliveryCount||0)+1,d.lockedUntil=r,d.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const h=this.lockedMessages.get(t)||[];if(h.push({message:d,lockedAt:i,lockExpiresAt:r}),this.lockedMessages.set(t,h),n.enableSessions&&s){const g=this.sessionMessages.get(t);if(g){const v=g.get(s)||[],b=v.findIndex(x=>x.id===d.id);b>=0&&(v.splice(b,1),g.set(s,v))}}const p=this.queueState.get(t);if(p){const g=this.getAvailableMessages(t);p.activeMessageCount=g.length,p.receivedCount=(p.receivedCount||0)+1,p.lastUpdate=i}return d}receiveFromSubscription(t,e,s){const n=`${t}/subscriptions/${e}`,i=this.getAvailableSubscriptionMessages(n);if(i.length===0)return null;const o=this.subscriptions.get(t)?.find(v=>v.name===e);if(!o)return null;const r=Date.now(),u=(s||o.lockDuration)*1e3,d=r+u,h=i.shift();h.deliveryCount=(h.deliveryCount||0)+1,h.lockedUntil=d,h.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const p=this.lockedMessages.get(n)||[];p.push({message:h,lockedAt:r,lockExpiresAt:d}),this.lockedMessages.set(n,p);const g=this.subscriptionState.get(n);if(g){const v=this.getAvailableSubscriptionMessages(n);g.activeMessageCount=v.length,g.receivedCount=(g.receivedCount||0)+1,g.lastUpdate=r}return h}completeMessage(t,e){const s=this.lockedMessages.get(t)||[],n=s.findIndex(o=>o.message.lockToken===e);if(n<0)return!1;if(s.splice(n,1),this.lockedMessages.set(t,s),this.queues.has(t)){const o=this.queueState.get(t);o&&(o.completedCount=(o.completedCount||0)+1,o.lastUpdate=Date.now())}else{const o=this.subscriptionState.get(t);o&&(o.completedCount=(o.completedCount||0)+1,o.lastUpdate=Date.now())}return!0}abandonMessage(t,e){const s=this.lockedMessages.get(t)||[],n=s.findIndex(d=>d.message.lockToken===e);if(n<0)return!1;const i=s[n];s.splice(n,1),this.lockedMessages.set(t,s);const o=i.message;o.lockToken=void 0,o.lockedUntil=void 0;const r=this.queues.has(t),u=r?this.queues.get(t)?.maxDeliveryCount||10:this.subscriptions.get(o.destination)?.find(d=>d.name===o.subscriptionName)?.maxDeliveryCount||10;if(o.deliveryCount>=u){const d=this.deadLetterMessages.get(t)||[];if(d.push(o),this.deadLetterMessages.set(t,d),r){const h=this.queueState.get(t);h&&(h.deadLetterMessageCount=d.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now())}else{const h=this.subscriptionState.get(t);h&&(h.deadLetterMessageCount=d.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now())}}else{if(r){const d=this.queues.get(t);if(d)if(d.enableSessions&&o.sessionId){const h=this.sessionMessages.get(t);if(h){const p=h.get(o.sessionId)||[];p.push(o),h.set(o.sessionId,p)}}else{const h=this.queueMessages.get(t)||[];h.push(o),this.queueMessages.set(t,h)}}else{const d=this.subscriptionMessages.get(t)||[];d.push(o),this.subscriptionMessages.set(t,d)}if(r){const d=this.queueState.get(t);if(d){const h=this.getAvailableMessages(t);d.activeMessageCount=h.length,d.abandonedCount=(d.abandonedCount||0)+1,d.lastUpdate=Date.now()}}else{const d=this.subscriptionState.get(t);if(d){const h=this.getAvailableSubscriptionMessages(t);d.activeMessageCount=h.length,d.abandonedCount=(d.abandonedCount||0)+1,d.lastUpdate=Date.now()}}}return!0}processConsumption(t){const e=Date.now();for(const[s,n]of this.queues.entries()){const i=this.scheduledMessages.get(s)||[],o=this.queueMessages.get(s)||[],r=this.sessionMessages.get(s);for(let p=i.length-1;p>=0;p--){const g=i[p];if(g.scheduledEnqueueTime&&g.scheduledEnqueueTime<=e)if(i.splice(p,1),n.enableSessions&&g.sessionId&&r){const v=r.get(g.sessionId)||[];v.push(g),r.set(g.sessionId,v)}else o.push(g)}this.scheduledMessages.set(s,i),this.queueMessages.set(s,o);const u=this.lockedMessages.get(s)||[];for(let p=u.length-1;p>=0;p--){const g=u[p];g.lockExpiresAt<=e&&(u.splice(p,1),this.abandonMessage(s,g.message.lockToken))}this.lockedMessages.set(s,u);const d=this.getAvailableMessages(s);for(let p=d.length-1;p>=0;p--){const g=d[p];if(g.expirationTime<=e&&(d.splice(p,1),n.enableDeadLetteringOnMessageExpiration)){const v=this.deadLetterMessages.get(s)||[];v.push(g),this.deadLetterMessages.set(s,v)}}this.queueMessages.set(s,d);const h=this.queueState.get(s);h&&(h.activeMessageCount=this.getAvailableMessages(s).length,h.deadLetterMessageCount=(this.deadLetterMessages.get(s)||[]).length,h.scheduledMessageCount=i.length,h.lastUpdate=e)}for(const[s,n]of this.topics.entries()){const i=this.scheduledMessages.get(s)||[];for(let r=i.length-1;r>=0;r--){const u=i[r];u.scheduledEnqueueTime&&u.scheduledEnqueueTime<=e&&(i.splice(r,1),this.publishToTopic(s,u.payload,u.size,u.properties))}this.scheduledMessages.set(s,i);const o=this.subscriptions.get(s)||[];for(const r of o){const u=`${s}/subscriptions/${r.name}`,d=this.lockedMessages.get(u)||[];for(let g=d.length-1;g>=0;g--){const v=d[g];v.lockExpiresAt<=e&&(d.splice(g,1),this.abandonMessage(u,v.message.lockToken))}this.lockedMessages.set(u,d);const h=this.getAvailableSubscriptionMessages(u);for(let g=h.length-1;g>=0;g--){const v=h[g];if(v.expirationTime<=e&&(h.splice(g,1),r.enableDeadLetteringOnMessageExpiration)){const b=this.deadLetterMessages.get(u)||[];b.push(v),this.deadLetterMessages.set(u,b)}}this.subscriptionMessages.set(u,h);const p=this.subscriptionState.get(u);p&&(p.activeMessageCount=this.getAvailableSubscriptionMessages(u).length,p.deadLetterMessageCount=(this.deadLetterMessages.get(u)||[]).length,p.lastUpdate=e)}}}getAvailableMessages(t){if(!this.queues.get(t))return[];const s=Date.now();return(this.queueMessages.get(t)||[]).filter(i=>i.expirationTime>s)}getAvailableSubscriptionMessages(t){const e=Date.now();return(this.subscriptionMessages.get(t)||[]).filter(n=>n.expirationTime>e)}getTotalQueueDepth(){let t=0;for(const e of this.queues.keys())t+=this.getAvailableMessages(e).length;return t}getTotalSubscriptionMessages(){let t=0;for(const e of this.subscriptionMessages.keys())t+=this.getAvailableSubscriptionMessages(e).length;return t}getQueueMetrics(t){const e=this.queueState.get(t);return e?{activeMessageCount:e.activeMessageCount,deadLetterMessageCount:e.deadLetterMessageCount,scheduledMessageCount:e.scheduledMessageCount,sentCount:e.sentCount,receivedCount:e.receivedCount,completedCount:e.completedCount,abandonedCount:e.abandonedCount}:null}getSubscriptionMetrics(t,e){const s=`${t}/subscriptions/${e}`,n=this.subscriptionState.get(s);return n?{activeMessageCount:n.activeMessageCount,deadLetterMessageCount:n.deadLetterMessageCount,sentCount:n.sentCount,receivedCount:n.receivedCount,completedCount:n.completedCount,abandonedCount:n.abandonedCount}:null}getAllQueueMetrics(){const t=new Map;for(const e of this.queues.keys()){const s=this.getQueueMetrics(e);s&&t.set(e,s)}return t}getAllSubscriptionMetrics(){const t=new Map;for(const[e,s]of this.subscriptionState.entries())t.set(e,{activeMessageCount:s.activeMessageCount,deadLetterMessageCount:s.deadLetterMessageCount,sentCount:s.sentCount,receivedCount:s.receivedCount,completedCount:s.completedCount,abandonedCount:s.abandonedCount});return t}getActiveConnections(){return this.queues.size+this.topics.size}}class LT{topics=new Map;subscriptions=new Map;topicSubscriptions=new Map;topicMessages=new Map;subscriptionMessages=new Map;unackedMessages=new Map;orderingKeyQueues=new Map;topicState=new Map;subscriptionState=new Map;initialize(t){if(this.topics.clear(),this.subscriptions.clear(),this.topicSubscriptions.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.unackedMessages.clear(),this.orderingKeyQueues.clear(),this.topicState.clear(),this.subscriptionState.clear(),t.topics)for(const e of t.topics)this.topics.set(e.name,{...e}),this.topicMessages.set(e.name,[]),this.topicSubscriptions.set(e.name,[]),this.orderingKeyQueues.set(e.name,new Map),this.topicState.set(e.name,{messageCount:e.messageCount||0,byteCount:e.byteCount||0,publishedCount:0,lastUpdate:Date.now()});if(t.subscriptions)for(const e of t.subscriptions){this.subscriptions.set(e.name,{...e}),this.subscriptionMessages.set(e.name,[]),this.unackedMessages.set(e.name,[]);const s=this.topicSubscriptions.get(e.topic)||[];s.includes(e.name)||s.push(e.name),this.topicSubscriptions.set(e.topic,s),this.subscriptionState.set(e.name,{messageCount:e.messageCount||0,unackedMessageCount:e.unackedMessageCount||0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:Date.now()})}}publishToTopic(t,e,s,n,i){if(!this.topics.get(t))return null;const r=Date.now(),u=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=r,h={id:`pubsub_${u}`,messageId:u,publishTime:d,data:e,attributes:n,orderingKey:i,size:s},p=this.topicMessages.get(t)||[];if(i){const b=this.orderingKeyQueues.get(t)||new Map,x=b.get(i)||[];x.push(h),b.set(i,x),this.orderingKeyQueues.set(t,b)}else p.push(h),this.topicMessages.set(t,p);const g=this.topicSubscriptions.get(t)||[];for(const b of g){const x=this.subscriptions.get(b);if(!x)continue;const R={...h,id:`${h.id}_${b}`},C=this.subscriptionMessages.get(b)||[];x.enableMessageOrdering,C.push(R),this.subscriptionMessages.set(b,C)}const v=this.topicState.get(t)||{messageCount:0,byteCount:0,publishedCount:0,lastUpdate:r};return v.messageCount=p.length+(i&&this.orderingKeyQueues.get(t)?.get(i)?.length||0),v.byteCount=(v.byteCount||0)+s,v.publishedCount=(v.publishedCount||0)+1,v.lastUpdate=r,this.topicState.set(t,v),u}pullFromSubscription(t,e=100){const s=this.subscriptions.get(t);if(!s)return[];const n=this.subscriptionMessages.get(t)||[];if(n.length===0)return[];const i=Date.now(),o=s.ackDeadlineSeconds*1e3,r=[],u=[];if(s.enableMessageOrdering){const p=new Map;for(const g of n){const v=g.orderingKey||"__no_key__";p.has(v)||p.set(v,[]),p.get(v).push(g)}for(const[g,v]of p.entries()){if(r.length>=e)break;const b=Math.min(v.length,e-r.length),x=v.splice(0,b);r.push(...x),u.push(...v)}for(const[g,v]of p.entries())v.length>0&&u.find(b=>(b.orderingKey||"__no_key__")===g)===void 0&&u.push(...v)}else{const p=Math.min(n.length,e);r.push(...n.splice(0,p)),u.push(...n)}this.subscriptionMessages.set(t,u);const d=this.unackedMessages.get(t)||[];for(const p of r){const g=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;p.ackId=g,d.push({message:p,subscriptionName:t,ackDeadlineExpiresAt:i+o,deliveryAttempt:1,orderingKey:p.orderingKey})}this.unackedMessages.set(t,d);const h=this.subscriptionState.get(t)||{messageCount:0,unackedMessageCount:0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:i};return h.messageCount=u.length,h.unackedMessageCount=d.length,h.deliveredCount=(h.deliveredCount||0)+r.length,h.lastUpdate=i,this.subscriptionState.set(t,h),r}ackMessage(t,e){if(!this.subscriptions.get(t))return!1;const n=this.unackedMessages.get(t)||[],i=n.length,o=n.filter(r=>r.message.ackId!==e);if(this.unackedMessages.set(t,o),o.length<i){const r=this.subscriptionState.get(t);return r&&(r.unackedMessageCount=o.length,r.acknowledgedCount=(r.acknowledgedCount||0)+1,r.lastUpdate=Date.now()),!0}return!1}nackMessage(t,e){if(!this.subscriptions.get(t))return!1;const n=this.unackedMessages.get(t)||[],i=n.findIndex(h=>h.message.ackId===e);if(i===-1)return!1;const r=n[i].message;n.splice(i,1),this.unackedMessages.set(t,n);const u=this.subscriptionMessages.get(t)||[];r.ackId=void 0,u.push(r),this.subscriptionMessages.set(t,u);const d=this.subscriptionState.get(t);return d&&(d.unackedMessageCount=n.length,d.messageCount=u.length,d.nackedCount=(d.nackedCount||0)+1,d.lastUpdate=Date.now()),!0}processConsumption(t){const e=Date.now();for(const[s,n]of this.unackedMessages.entries()){if(!this.subscriptions.get(s))continue;const o=[],r=[];for(const u of n)e>=u.ackDeadlineExpiresAt?o.push(u):r.push(u);if(o.length>0){const u=this.subscriptionMessages.get(s)||[];for(const h of o){const p=h.message;p.ackId=void 0,u.push(p)}this.subscriptionMessages.set(s,u);const d=this.subscriptionState.get(s);d&&(d.unackedMessageCount=r.length,d.messageCount=u.length)}this.unackedMessages.set(s,r)}for(const[s,n]of this.subscriptions.entries())if(n.pushEndpoint){const i=this.subscriptionMessages.get(s)||[];if(i.length>0){const r=Math.min(i.length,10),u=i.splice(0,r),d=this.unackedMessages.get(s)||[],h=Date.now(),p=n.ackDeadlineSeconds*1e3;for(const v of u){const b=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;v.ackId=b,d.push({message:v,subscriptionName:s,ackDeadlineExpiresAt:h+p,deliveryAttempt:1,orderingKey:v.orderingKey})}this.subscriptionMessages.set(s,i),this.unackedMessages.set(s,d);const g=this.subscriptionState.get(s);g&&(g.messageCount=i.length,g.unackedMessageCount=d.length,g.deliveredCount=(g.deliveredCount||0)+u.length)}}for(const[s,n]of this.topics.entries()){const o=(n.messageRetentionDuration||604800)*1e3,r=this.topicMessages.get(s)||[],u=Date.now(),d=r.filter(h=>u-h.publishTime<o);if(d.length<r.length){r.length-d.length,this.topicMessages.set(s,d);const h=this.topicState.get(s);h&&(h.messageCount=d.length)}}}getTopicMetrics(t){if(!this.topics.get(t))return null;const s=this.topicState.get(t);return s?{messageCount:s.messageCount,byteCount:s.byteCount,publishedCount:s.publishedCount}:null}getSubscriptionMetrics(t){if(!this.subscriptions.get(t))return null;const s=this.subscriptionState.get(t);return s?{messageCount:s.messageCount,unackedMessageCount:s.unackedMessageCount,deliveredCount:s.deliveredCount,acknowledgedCount:s.acknowledgedCount,nackedCount:s.nackedCount}:null}getAllTopicMetrics(){const t=new Map;for(const e of this.topics.keys()){const s=this.getTopicMetrics(e);s&&t.set(e,s)}return t}getAllSubscriptionMetrics(){const t=new Map;for(const e of this.subscriptions.keys()){const s=this.getSubscriptionMetrics(e);s&&t.set(e,s)}return t}getTotalTopicMessages(){let t=0;for(const e of this.topicMessages.values())t+=e.length;for(const e of this.orderingKeyQueues.values())for(const s of e.values())t+=s.length;return t}getTotalUnackedMessages(){let t=0;for(const e of this.unackedMessages.values())t+=e.length;return t}getActiveConnections(){let t=0;for(const e of this.subscriptions.values())e.pushEndpoint,t+=1;return Math.max(1,t+1)}updateTopic(t,e){const s=this.topics.get(t);s&&(Object.assign(s,e),this.topics.set(t,s))}updateSubscription(t,e){const s=this.subscriptions.get(t);s&&(Object.assign(s,e),this.subscriptions.set(t,s))}}class IT{services=new Map;routes=new Map;upstreams=new Map;consumers=new Map;plugins=[];roundRobinCounters=new Map;connectionCounts=new Map;consistentHashRing=new Map;rateLimitCounters=new Map;initialize(t){if(this.services.clear(),this.routes.clear(),this.upstreams.clear(),this.consumers.clear(),this.plugins=[],this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.consistentHashRing.clear(),this.rateLimitCounters.clear(),t.services)for(const e of t.services)this.services.set(e.id,{...e});if(t.routes)for(const e of t.routes)this.routes.set(e.id,{...e});if(t.upstreams){for(const e of t.upstreams)if(this.upstreams.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),e.algorithm==="consistent-hashing"&&e.targets){const s=[...e.targets].filter(n=>n.health==="healthy").sort((n,i)=>n.target.localeCompare(i.target));this.consistentHashRing.set(e.name,s.map(n=>n.target))}}if(t.consumers)for(const e of t.consumers)this.consumers.set(e.id,{...e});t.plugins&&(this.plugins=t.plugins.filter(e=>e.enabled))}routeRequest(t){const e=Date.now(),s=this.matchRoute(t);if(!s)return{match:null,response:{status:404,error:"No route matched",latency:Date.now()-e}};const n=this.executePlugins(t,s,"access");if(n.blocked)return{match:s,response:{status:n.status||403,error:n.error||"Request blocked by plugin",latency:Date.now()-e}};const i=this.selectUpstreamTarget(s.service);if(!i)return{match:s,response:{status:503,error:"No healthy upstream target available",latency:Date.now()-e}};this.transformPath(t.path,s);const o={status:200,latency:Date.now()-e};return o.latency=(o.latency||0)+this.simulateUpstreamLatency(i),{match:s,response:o,target:i}}matchRoute(t){const e=Array.from(this.routes.values()).sort((s,n)=>(n.priority||0)-(s.priority||0));for(const s of e){if(s.method&&s.method.toUpperCase()!==t.method.toUpperCase())continue;const n=this.matchPath(s.path,t.path);if(n){const i=this.services.get(s.service);if(!i||!i.enabled)continue;return{route:s,service:i,matchedPath:n.matched,remainingPath:n.remaining}}}return null}matchPath(t,e){if(e.startsWith(t))return{matched:t,remaining:e.substring(t.length)};try{if(new RegExp(`^${t}$`).test(e))return{matched:e,remaining:""}}catch{}return null}selectUpstreamTarget(t){const e=t.upstream||t.name,s=this.upstreams.get(e);if(!s||!s.targets||s.targets.length===0)return t.url;const n=s.targets.filter(o=>o.health==="healthy");if(n.length===0)return null;switch(s.algorithm||"round-robin"){case"round-robin":return this.selectRoundRobin(e,n);case"consistent-hashing":return this.selectConsistentHash(e,n,t.name);case"least-connections":return this.selectLeastConnections(n);default:return n[0].target}}selectRoundRobin(t,e){const s=this.roundRobinCounters.get(t)||0,n=e[s%e.length];return this.roundRobinCounters.set(t,(s+1)%e.length),n.target}selectConsistentHash(t,e,s){const i=this.simpleHash(s)%e.length;return e[i].target}selectLeastConnections(t){let e=1/0,s=t[0].target;for(const i of t){const o=this.connectionCounts.get(i.target)||0;o<e&&(e=o,s=i.target)}const n=this.connectionCounts.get(s)||0;return this.connectionCounts.set(s,n+1),s}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}transformPath(t,e){return e.route.stripPath?e.remainingPath||"/":t}executePlugins(t,e,s){const n=this.plugins.filter(i=>!(i.route&&i.route!==e.route.id||i.service&&i.service!==e.service.id));for(const i of n){const o=this.executePlugin(i,t,e,s);if(o.blocked)return o}return{blocked:!1}}executePlugin(t,e,s,n){const i=t.config||{};switch(t.name){case"rate-limiting":return this.executeRateLimiting(t,e,s,i);case"key-auth":return this.executeKeyAuth(t,e,s,i);case"jwt":return this.executeJWT(t,e,s,i);case"cors":return{blocked:!1};case"ip-restriction":return this.executeIPRestriction(t,e,s,i);default:return{blocked:!1}}}executeRateLimiting(t,e,s,n){const i=e.consumerId||s.service.id||s.route.id,o=Date.now();let r=this.rateLimitCounters.get(t.id);r||(r=new Map,this.rateLimitCounters.set(t.id,r));let u=r.get(i);(!u||u.resetAt<o)&&(u={count:0,resetAt:o+6e4},r.set(i,u));const d=n.minute||1e3;return n.hour,u.count++,u.count>d?{blocked:!0,status:429,error:"Rate limit exceeded (per minute)"}:{blocked:!1}}executeKeyAuth(t,e,s,n){const i=n.key_names||["apikey"],o=e.apiKey||e.headers?.[i[0]]||e.query?.[i[0]];return o?Array.from(this.consumers.values()).find(u=>u.credentials?.some(d=>d.type==="key-auth"&&d.key===o))?{blocked:!1}:{blocked:!0,status:401,error:"Invalid API key"}:{blocked:!0,status:401,error:"API key required"}}executeJWT(t,e,s,n){const i=e.headers?.Authorization;return!i||!i.startsWith("Bearer ")?{blocked:!0,status:401,error:"JWT token required"}:{blocked:!1}}executeIPRestriction(t,e,s,n){const i=e.headers?.["X-Forwarded-For"]||e.headers?.["X-Real-IP"]||"unknown",o=n.whitelist||[];return(n.blacklist||[]).includes(i)?{blocked:!0,status:403,error:"IP address blocked"}:o.length>0&&!o.includes(i)?{blocked:!0,status:403,error:"IP address not whitelisted"}:{blocked:!1}}simulateUpstreamLatency(t){return 10+Math.random()*40}getStats(){return{services:this.services.size,routes:this.routes.size,upstreams:this.upstreams.size,consumers:this.consumers.size,plugins:this.plugins.length}}}class NT{proxies=new Map;policies=[];organization;environment;quotaCounters=new Map;spikeArrestBuckets=new Map;apiKeyCache=new Map;oauthTokenCache=new Map;jwtTokenCache=new Map;proxyMetrics=new Map;initialize(t){if(this.proxies.clear(),this.policies=[],this.quotaCounters.clear(),this.spikeArrestBuckets.clear(),this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear(),this.proxyMetrics.clear(),this.organization=t.organization||"archiphoenix-org",this.environment=t.environment||"prod",t.proxies)for(const e of t.proxies)this.proxies.set(e.name,{...e}),this.proxyMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),e.spikeArrest&&e.spikeArrest>0&&this.spikeArrestBuckets.set(e.name,{tokens:e.spikeArrest,lastRefill:Date.now(),rate:e.spikeArrest});t.policies&&(this.policies=t.policies.filter(e=>e.enabled))}routeRequest(t){const e=Date.now(),s=this.matchProxy(t);if(!s)return{match:null,response:{status:404,error:"No API proxy matched for path",latency:Date.now()-e}};if(s.proxy.status==="undeployed")return this.updateProxyMetrics(s.proxy.name,!1,Date.now()-e),{match:s,response:{status:503,error:`Proxy '${s.proxy.name}' is not deployed`,latency:Date.now()-e}};const n=this.policies.filter(v=>v.enabled&&(v.executionFlow==="PreFlow"||!v.executionFlow&&this.isPreFlowPolicy(v.type))),i=this.executePolicies(n,t,s,"PreFlow");if(i.blocked)return this.updateProxyMetrics(s.proxy.name,!0,Date.now()-e),{match:s,response:{status:i.status||401,error:i.error||"Authentication failed",latency:Date.now()-e}};const o=this.policies.filter(v=>v.enabled&&(v.executionFlow==="RequestFlow"||!v.executionFlow&&this.isRequestFlowPolicy(v.type))),r=this.executePolicies(o,t,s,"RequestFlow");if(r.blocked)return this.updateProxyMetrics(s.proxy.name,!0,Date.now()-e),{match:s,response:{status:r.status||429,error:r.error||"Request policy violation",latency:Date.now()-e}};const u=this.buildTargetUrl(s.proxy,s.remainingPath),d=this.simulateUpstreamLatency(u),h=Date.now()-e+d,p=this.policies.filter(v=>v.enabled&&(v.executionFlow==="PostFlow"||!v.executionFlow&&this.isPostFlowPolicy(v.type))),g={status:200,latency:h};return this.executePolicies(p,t,s,"PostFlow",g),this.updateProxyMetrics(s.proxy.name,!1,h),{match:s,response:g,target:u}}matchProxy(t){const e=Array.from(this.proxies.values()).filter(s=>s.status==="deployed"||s.status===void 0).sort((s,n)=>n.basePath.length-s.basePath.length);for(const s of e)if(t.path.startsWith(s.basePath)){const n=t.path.slice(s.basePath.length)||"/";return{proxy:s,matchedPath:s.basePath,remainingPath:n}}return null}isPreFlowPolicy(t){return["verify-api-key","oauth","jwt"].includes(t)}isRequestFlowPolicy(t){return["quota","spike-arrest"].includes(t)}isPostFlowPolicy(t){return["cors","xml-to-json"].includes(t)}evaluateCondition(t,e,s){if(!t)return!0;try{if(t.includes("request.path")){const n=t.match(/request\.path\s*[=!]=\s*['"]([^'"]+)['"]/);if(n)return e.path===n[1]}return t.length>0}catch{return!0}}executePolicies(t,e,s,n,i){for(const o of t)if(this.evaluateCondition(o.condition,e,s))if(n==="PreFlow"){const r=this.executePreFlowPolicy(o,e,s);if(r.blocked)return r}else if(n==="RequestFlow"){const r=this.executeRequestFlowPolicy(o,e,s);if(r.blocked)return r}else n==="PostFlow"&&i&&this.executePostFlowPolicy(o,e,s,i);return{blocked:!1}}executePreFlowPolicy(t,e,s){if(s.proxy,t.type==="verify-api-key"){const n=e.apiKey||e.headers?.["X-API-Key"]||e.headers?.apikey||e.query?.apikey;if(!n)return{blocked:!0,status:401,error:"API key is required"};if(!this.validateApiKey(n))return{blocked:!0,status:401,error:"Invalid API key"}}if(t.type==="oauth"&&s.proxy.enableOAuth){const i=e.oauthToken||e.headers?.Authorization?.replace("Bearer ","")||e.headers?.Authorization?.replace("OAuth ","");if(!i)return{blocked:!0,status:401,error:"OAuth token is required"};if(!this.validateOAuthToken(i))return{blocked:!0,status:401,error:"Invalid or expired OAuth token"}}if(t.type==="jwt"){const n=s.proxy;if(n.jwtIssuer){const i=e.jwtToken||e.headers?.Authorization?.replace("Bearer ","")||e.headers?.["X-JWT-Token"];if(!i)return{blocked:!0,status:401,error:"JWT token is required"};if(!this.validateJWTToken(i,n.jwtIssuer))return{blocked:!0,status:401,error:"Invalid or expired JWT token"}}}return{blocked:!1}}executeRequestFlowPolicy(t,e,s){const n=s.proxy,i=e.headers?.["X-Consumer-ID"]||"default";if(t.type==="quota"){const o=t.config?.quota||n.quota,r=t.config?.interval||n.quotaInterval;if(o&&r&&!this.checkQuota(n.name,i,o,r))return{blocked:!0,status:429,error:`Quota exceeded: ${o} requests per ${r} seconds`}}if(t.type==="spike-arrest"){const o=t.config?.rate||n.spikeArrest;if(o&&o>0&&!this.checkSpikeArrest(n.name,o))return{blocked:!0,status:429,error:`Spike arrest limit exceeded: ${o} requests per second`}}return{blocked:!1}}executePostFlowPolicy(t,e,s,n){t.type==="cors"&&(n.headers||(n.headers={}),n.headers["Access-Control-Allow-Origin"]=t.config?.origins?.[0]||"*",n.headers["Access-Control-Allow-Methods"]=t.config?.methods?.join(", ")||"GET, POST, PUT, DELETE",n.headers["Access-Control-Allow-Headers"]=t.config?.headers?.join(", ")||"Content-Type, Authorization"),t.type==="xml-to-json"&&(n.headers||(n.headers={}),n.headers["Content-Type"]="application/json")}checkQuota(t,e,s,n){const i=Date.now(),o=n*1e3;let r=this.quotaCounters.get(t);r||(r=new Map,this.quotaCounters.set(t,r));let u=r.get(e);return(!u||u.resetAt<i)&&(u={count:0,resetAt:i+o,identifier:e},r.set(e,u)),u.count>=s?!1:(u.count++,!0)}checkSpikeArrest(t,e){const s=Date.now();let n=this.spikeArrestBuckets.get(t);n||(n={tokens:e,lastRefill:s,rate:e},this.spikeArrestBuckets.set(t,n));const o=(s-n.lastRefill)/1e3*n.rate;return n.tokens=Math.min(n.rate,n.tokens+o),n.lastRefill=s,n.tokens<1?!1:(n.tokens-=1,!0)}validateApiKey(t){const e=this.apiKeyCache.get(t);if(e&&e.expiresAt>Date.now())return e.valid;const s=t.length>=10;return this.apiKeyCache.set(t,{valid:s,expiresAt:Date.now()+300*1e3}),s}validateOAuthToken(t){const e=this.oauthTokenCache.get(t);if(e&&e.expiresAt>Date.now())return e.valid;const s=t.length>=20;return this.oauthTokenCache.set(t,{valid:s,expiresAt:Date.now()+3600*1e3}),s}validateJWTToken(t,e){const s=this.jwtTokenCache.get(t);if(s&&s.expiresAt>Date.now())return s.valid&&s.issuer===e;const n=t.length>=20;return this.jwtTokenCache.set(t,{valid:n,issuer:e,expiresAt:Date.now()+3600*1e3}),n}buildTargetUrl(t,e){const s=t.targetEndpoint.replace(/\/$/,""),n=e.startsWith("/")?e:`/${e}`;return`${s}${n}`}simulateUpstreamLatency(t){const e=10+Math.random()*40,s=(Math.random()-.5)*10;return Math.max(1,e+s)}updateProxyMetrics(t,e,s){const n=this.proxyMetrics.get(t);n&&(n.requestCount++,e&&n.errorCount++,n.totalLatency+=s,n.lastRequestTime=Date.now())}getStats(){let t=0,e=0,s=0;for(const i of this.proxyMetrics.values())t+=i.requestCount,e+=i.errorCount,s+=i.totalLatency;const n=t>0?s/t:0;return{proxies:this.proxies.size,policies:this.policies.length,totalRequests:t,totalErrors:e,avgLatency:n}}getProxyMetrics(t){const e=this.proxyMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgResponseTime:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}clearCaches(){this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear()}}class zT{applications=new Map;connectors=new Map;organization;environment;applicationMetrics=new Map;connectorMetrics=new Map;reconnectionState=new Map;initialize(t){if(this.applications.clear(),this.connectors.clear(),this.applicationMetrics.clear(),this.connectorMetrics.clear(),this.reconnectionState.clear(),this.organization=t.organization||"archiphoenix-org",this.environment=t.environment||"production",t.applications)for(const e of t.applications)this.applications.set(e.name,{...e}),this.applicationMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0});if(t.connectors)for(const e of t.connectors)this.connectors.set(e.name,{...e}),this.connectorMetrics.set(e.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),this.reconnectionState.set(e.name,{attempts:0,lastAttempt:0,nextAttempt:0})}processData(t){const e=Date.now(),s=this.matchApplication(t);if(!s)return{match:null,response:{status:"error",error:"No Mule application matched for request",latency:Date.now()-e}};if(s.application.status!=="running")return this.updateApplicationMetrics(s.application.name,!1,Date.now()-e),{match:s,response:{status:"error",error:`Application '${s.application.name}' is not running (status: ${s.application.status})`,latency:Date.now()-e}};let n=0,i;try{n=this.processFlow(s,t)}catch(r){i=r instanceof Error?r.message:"Unknown error"}if(i&&!this.handleError(s.application,i))return this.updateApplicationMetrics(s.application.name,!0,Date.now()-e),{match:s,response:{status:"error",error:i,latency:Date.now()-e,application:s.application.name,flow:s.flow?.name}};const o=this.transformData(t,s);return this.updateApplicationMetrics(s.application.name,!1,Date.now()-e),s.matchedConnector&&this.updateConnectorMetrics(s.matchedConnector.name,!1,Date.now()-e),{match:s,response:{status:"success",data:o.data,format:o.format||t.format,latency:Date.now()-e,application:s.application.name,flow:s.flow?.name,connector:s.matchedConnector?.name}}}matchApplication(t){if(t.sourceComponentType||t.targetComponentType)for(const[e,s]of this.applications.entries()){if(s.status!=="running")continue;const n=this.findMatchingConnector(s,t.sourceComponentType,t.targetComponentType);if(n){const i=s.flows?.find(o=>o.source===n.name||o.target===n.name)||s.flows?.[0];return{application:s,flow:i,matchedConnector:n}}}for(const[e,s]of this.applications.entries())if(s.status==="running")return{application:s,flow:s.flows?.[0]};return null}findMatchingConnector(t,e,s){const n=t.connectors||[];for(const i of n){const o=this.connectors.get(i);if(!(!o||!o.enabled)&&(e&&this.connectorMatchesComponentType(o,e)||s&&this.connectorMatchesComponentType(o,s)))return o}return null}connectorMatchesComponentType(t,e){const s={database:["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],api:["rest","grpc","graphql","soap","websocket","webhook"],messaging:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],file:["s3-datalake"],business:["crm","erp","payment-gateway"]};for(const[n,i]of Object.entries(s))if(t.type===n&&i.includes(e))return!0;return t.targetComponentType===e}processFlow(t,e){if(!t.flow)return this.calculateBaseProcessingTime(t.application);let s=this.calculateBaseProcessingTime(t.application);if(t.flow.processors)for(const n of t.flow.processors)s+=this.processProcessor(n,e);return t.matchedConnector&&(s+=this.calculateConnectorLatency(t.matchedConnector)),s}calculateBaseProcessingTime(t){const e=5+Math.random()*10,s=parseFloat(t.runtimeVersion)>=4.5?.9:1;return e*s}processProcessor(t,e){switch(t.type){case"transform":return 2+Math.random()*6;case"validate":return 1+Math.random()*2;case"filter":return .5+Math.random()*1.5;case"enrich":return 3+Math.random()*7;case"route":return .5+Math.random()*.5;default:return 1}}calculateConnectorLatency(t){const s={database:10,api:20,messaging:5,file:50,custom:15}[t.type]||15,n=s*.5*Math.random();return s+n}transformData(t,e){if(t.targetComponentType){const s=this.getTargetFormat(t.targetComponentType);if(s&&s!==t.format)return{data:t.body,format:s}}return{data:t.body,format:t.format}}getTargetFormat(t){return{postgres:"json",mongodb:"json",redis:"json",rest:"json",graphql:"json",soap:"xml",grpc:"binary",kafka:"json",rabbitmq:"json"}[t]}handleError(t,e){switch(t.errorStrategy||"continue"){case"continue":return!0;case"rollback":return!1;case"propagate":return!1;default:return!1}}updateApplicationMetrics(t,e,s){const n=this.applicationMetrics.get(t);n&&(n.requestCount++,e&&n.errorCount++,n.totalLatency+=s,n.lastRequestTime=Date.now())}updateConnectorMetrics(t,e,s){const n=this.connectorMetrics.get(t);n&&(n.requestCount++,e&&n.errorCount++,n.totalLatency+=s,n.lastRequestTime=Date.now())}getStats(){let t=0,e=0,s=0;for(const o of this.applicationMetrics.values())t+=o.requestCount,e+=o.errorCount,s+=o.totalLatency;const n=Array.from(this.applications.values()).filter(o=>o.status==="running").length,i=Array.from(this.connectors.values()).filter(o=>o.enabled).length;return{applications:this.applications.size,runningApplications:n,connectors:this.connectors.size,enabledConnectors:i,totalRequests:t,totalErrors:e,avgLatency:t>0?s/t:0}}getApplicationMetrics(t){const e=this.applicationMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgLatency:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}getConnectorMetrics(t){const e=this.connectorMetrics.get(t);return e?{requestCount:e.requestCount,errorCount:e.errorCount,avgLatency:e.requestCount>0?e.totalLatency/e.requestCount:0}:null}}class jT{locations=[];upstreams=new Map;rateLimitZones=new Map;sslCertificates=new Map;roundRobinCounters=new Map;connectionCounts=new Map;ipHashMap=new Map;hashRing=new Map;rateLimitCounters=new Map;cache=new Map;enableSSL=!1;sslPort=443;enableGzip=!0;enableCache=!0;maxWorkers=4;requestCount=0;cacheHits=0;cacheMisses=0;rateLimitBlocks=0;initialize(t){if(this.locations=[],this.upstreams.clear(),this.rateLimitZones.clear(),this.sslCertificates.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.ipHashMap.clear(),this.hashRing.clear(),this.rateLimitCounters.clear(),this.cache.clear(),t.locations&&(this.locations=[...t.locations].sort((e,s)=>s.path.length!==e.path.length?s.path.length-e.path.length:e.path.localeCompare(s.path))),t.upstreams){for(const e of t.upstreams)if(this.upstreams.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),e.method==="hash"&&e.servers){const s=[...e.servers].filter(n=>!n.down&&n.health!=="unhealthy").sort((n,i)=>n.address.localeCompare(i.address));this.hashRing.set(e.name,s.map(n=>n.address))}}if(t.rateLimitZones)for(const e of t.rateLimitZones)this.rateLimitZones.set(e.name,{...e});if(t.sslCertificates)for(const e of t.sslCertificates)this.sslCertificates.set(e.name,{...e});this.enableSSL=t.enableSSL??!1,this.sslPort=t.sslPort||443,this.enableGzip=t.enableGzip??!0,this.enableCache=t.enableCache??!0,this.maxWorkers=t.maxWorkers||4}routeRequest(t){const e=Date.now();if(this.requestCount++,!this.enableSSL&&t.protocol==="https")return{match:null,response:{status:400,error:"HTTPS not enabled",latency:Date.now()-e}};const s=this.matchLocation(t);if(!s)return{match:null,response:{status:404,error:"No location matched",latency:Date.now()-e}};if(s.location.rateLimit){const o=this.checkRateLimit(s.location.rateLimit,t);if(o.blocked)return this.rateLimitBlocks++,{match:s,response:{status:429,error:o.error||"Rate limit exceeded",latency:Date.now()-e}}}if(this.enableCache&&s.location.cache?.enabled&&t.method==="GET"){const o=this.getCacheKey(t,s),r=this.cache.get(o);if(r&&r.expiresAt>Date.now())return this.cacheHits++,{match:s,response:{status:200,body:r.data,latency:Date.now()-e,cacheHit:!0}};this.cacheMisses++}let n,i;switch(s.location.method){case"proxy":case"grpc":if(n=this.selectUpstreamTarget(s.location,t),!n)return{match:s,response:{status:503,error:"No healthy upstream server available",latency:Date.now()-e}};i=this.proxyRequest(t,s,n);break;case"static":i=this.serveStatic(t,s);break;case"fastcgi":case"uwsgi":case"scgi":if(n=this.selectUpstreamTarget(s.location,t),!n)return{match:s,response:{status:503,error:"No upstream server available",latency:Date.now()-e}};i=this.processFastCGI(t,s,n);break;default:i={status:501,error:"Method not implemented",latency:Date.now()-e}}if(this.enableGzip&&this.shouldCompress(i)&&(i.headers={...i.headers,"Content-Encoding":"gzip"}),this.enableCache&&s.location.cache?.enabled&&t.method==="GET"&&i.status===200){const o=this.getCacheKey(t,s),r=this.parseCacheValid(s.location.cache.valid||"1h");this.cache.set(o,{data:i.body,expiresAt:Date.now()+r})}return i.latency=Date.now()-e,i.upstreamTarget=n,{match:s,response:i,upstreamTarget:n}}matchLocation(t){for(const e of this.locations){const s=this.matchPath(e.path,t.path);if(s)return{location:e,matchedPath:s.matched,remainingPath:s.remaining,priority:this.getLocationPriority(e.path)}}return null}matchPath(t,e){const s=t.replace(/^[=~*^]/,""),n=t[0];switch(n){case"=":if(e===s)return{matched:e,remaining:""};break;case"~":case"~*":try{if(new RegExp(s,n==="~*"?"i":"").test(e))return{matched:e,remaining:""}}catch{}break;case"^~":case"*":default:if(e.startsWith(s))return{matched:s,remaining:e.substring(s.length)}}return null}getLocationPriority(t){return t.startsWith("=")?4:t.startsWith("^~")?3:t.startsWith("~")||t.startsWith("~*")?2:1}selectUpstreamTarget(t,e){const s=t.upstream||this.extractUpstreamFromProxyPass(t.proxyPass);if(!s)return t.proxyPass||null;const n=this.upstreams.get(s);if(!n||!n.servers||n.servers.length===0)return null;const i=n.servers.filter(r=>!r.down&&r.health!=="unhealthy");if(i.length===0)return null;switch(n.method||"round-robin"){case"round-robin":return this.selectRoundRobin(s,i);case"least_conn":return this.selectLeastConnections(i);case"ip_hash":return this.selectIPHash(s,i,e);case"hash":return this.selectHash(s,i,e);default:return i[0].address}}selectRoundRobin(t,e){const s=e.reduce((o,r)=>o+(r.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),o.address;return this.roundRobinCounters.set(t,(n+1)%s),e[0].address}selectLeastConnections(t){let e=1/0,s=t[0].address;for(const i of t){const r=(this.connectionCounts.get(i.address)||0)/(i.weight||1);r<e&&(e=r,s=i.address)}const n=this.connectionCounts.get(s)||0;return this.connectionCounts.set(s,n+1),s}selectIPHash(t,e,s){const n=s.clientIP||s.headers?.["X-Real-IP"]||s.headers?.["X-Forwarded-For"]||"0.0.0.0",i=this.ipHashMap.get(n);if(i&&e.some(d=>d.address===i))return i;const r=this.simpleHash(n)%e.length,u=e[r].address;return this.ipHashMap.set(n,u),u}selectHash(t,e,s){const n=this.hashRing.get(t);if(!n||n.length===0)return e[0].address;const i=s.path,r=this.simpleHash(i)%n.length;return n[r]}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}extractUpstreamFromProxyPass(t){if(!t)return null;const e=t.match(/^https?:\/\/([^\/:]+)/);return e&&this.upstreams.has(e[1])?e[1]:null}checkRateLimit(t,e){const s=this.rateLimitZones.get(t.zone);if(!s)return{blocked:!1};const n=s.rate.match(/^(\d+)r\/([smhd])$/);if(!n)return{blocked:!1};const i=parseInt(n[1],10),o=n[2],r=this.getPeriodMs(o),u=e.clientIP||e.headers?.["X-Real-IP"]||"default";let d=this.rateLimitCounters.get(t.zone);d||(d=new Map,this.rateLimitCounters.set(t.zone,d));let h=d.get(u);const p=Date.now();(!h||h.resetAt<p)&&(h={count:0,resetAt:p+r,burst:t.burst||0},d.set(u,h));const g=t.burst||0,v=i+g;return h.count>=v?{blocked:!0,error:`Rate limit exceeded: ${i} requests per ${o}`}:(h.count++,{blocked:!1})}getPeriodMs(t){switch(t){case"s":return 1e3;case"m":return 6e4;case"h":return 36e5;case"d":return 864e5;default:return 1e3}}proxyRequest(t,e,s){const n=10+Math.random()*90;return{status:200,body:{proxied:!0,upstream:s},latency:n}}serveStatic(t,e){const s=1+Math.random()*4;return{status:200,body:{static:!0,path:e.matchedPath},latency:s}}processFastCGI(t,e,s){const n=20+Math.random()*180;return{status:200,body:{processed:!0,upstream:s},latency:n}}getCacheKey(t,e){return e.location.cache?.key?e.location.cache.key.replace(/\$(\w+)/g,(s,n)=>{switch(n){case"uri":return t.path;case"args":return JSON.stringify(t.query);default:return""}}):`${t.method}:${t.path}:${JSON.stringify(t.query)}`}parseCacheValid(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 36e5;const s=parseInt(e[1],10),n=e[2];return s*this.getPeriodMs(n)}shouldCompress(t){if(!t.body)return!1;const e=t.headers?.["Content-Type"]||"";return["text/","application/json","application/javascript","application/xml"].some(n=>e.includes(n))}getStats(){const t=this.cacheHits+this.cacheMisses,e=t>0?this.cacheHits/t:0;return{locations:this.locations.length,upstreams:this.upstreams.size,rateLimitZones:this.rateLimitZones.size,sslCertificates:this.sslCertificates.size,requests:this.requestCount,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses,rateLimitBlocks:this.rateLimitBlocks,cacheHitRate:e}}updateServerHealth(t,e,s){const n=this.upstreams.get(t);if(!n)return;const i=n.servers.find(o=>o.address===e);i&&(i.health=s)}clearCache(){this.cache.clear(),this.cacheHits=0,this.cacheMisses=0}}class OT{frontends=new Map;backends=new Map;globalConfig={};roundRobinCounters=new Map;connectionCounts=new Map;sourceHashMap=new Map;uriHashMap=new Map;stickTable=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;rateLimitBlocks=0;timeoutErrors=0;connectionRejects=0;healthCheckTimers=new Map;serverCheckFailures=new Map;serverCheckSuccesses=new Map;rateLimitTracker=new Map;initialize(t){this.frontends.clear(),this.backends.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.sourceHashMap.clear(),this.uriHashMap.clear(),this.stickTable.clear(),this.serverCheckFailures.clear(),this.serverCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.frontends)for(const e of t.frontends)this.frontends.set(e.name,{...e,acls:e.acls||[]});if(t.backends){for(const e of t.backends)if(this.backends.set(e.name,{...e,acls:e.acls||[]}),this.roundRobinCounters.set(e.name,0),e.healthCheck?.enabled&&e.servers)for(const s of e.servers)s.check&&this.startHealthCheck(e.name,s,e.healthCheck)}this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.rateLimitBlocks=0,this.timeoutErrors=0,this.connectionRejects=0}routeRequest(t,e){const s=Date.now();this.requestCount++;const n=this.globalConfig.maxConnections||4096;if(this.activeConnections>=n)return this.connectionRejects++,this.errorCount++,{frontend:null,backend:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-s}};if(this.activeConnections++,this.globalConfig.rateLimit?.enabled&&!this.checkRateLimit(t).allowed)return this.activeConnections--,this.rateLimitBlocks++,this.errorCount++,{frontend:null,backend:null,response:{status:429,error:"Rate limit exceeded",latency:Date.now()-s}};let i=null;if(e)i=this.frontends.get(e)||null;else{for(const[k,T]of this.frontends.entries()){const A=this.extractPort(T.bind);if(t.protocol==="https"&&A===443){i=T;break}else if(t.protocol==="http"&&A===80){i=T;break}}!i&&this.frontends.size>0&&(i=Array.from(this.frontends.values())[0])}if(!i)return this.activeConnections--,{frontend:null,backend:null,response:{status:503,error:"No frontend available",latency:Date.now()-s}};if(i.acls&&i.acls.length>0){const k=this.evaluateACLs(i.acls,t);if(!k.matched)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:403,error:k.error||"ACL rule denied",latency:Date.now()-s}}}const o=i.defaultBackend||(i.backends&&i.backends.length>0?i.backends[0]:null);if(!o)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:503,error:"No backend configured",latency:Date.now()-s}};const r=this.backends.get(o);if(!r)return this.activeConnections--,this.errorCount++,{frontend:i,backend:null,response:{status:503,error:`Backend ${o} not found`,latency:Date.now()-s}};if(r.acls&&r.acls.length>0){const k=this.evaluateACLs(r.acls,t);if(!k.matched)return this.activeConnections--,this.errorCount++,{frontend:i,backend:r,response:{status:403,error:k.error||"Backend ACL rule denied",latency:Date.now()-s}}}const u=this.selectServer(r,t);if(!u)return this.activeConnections--,this.errorCount++,{frontend:i,backend:r,response:{status:503,error:"No healthy server available",latency:Date.now()-s}};const d=r.servers.find(k=>`${k.address}:${k.port}`===u);if(d){d.sessions=(d.sessions||0)+1;const k=this.connectionCounts.get(u)||0;this.connectionCounts.set(u,k+1)}const h=10+Math.random()*90,p=i.ssl?5+Math.random()*15:0,g=this.globalConfig.timeoutServer||5e4,v=this.globalConfig.timeoutConnect||5e3,b=this.globalConfig.timeoutHttpRequest||1e4,x=Math.min(50+Math.random()*100,v);if(x>=v*.9)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,d&&(d.errors=(d.errors||0)+1),{frontend:i,backend:r,response:{status:504,error:"Connection timeout",latency:v,backendTarget:o,serverTarget:u}};const R=x+h+p;if(R>g)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,d&&(d.errors=(d.errors||0)+1),{frontend:i,backend:r,response:{status:504,error:"Server timeout",latency:g,backendTarget:o,serverTarget:u}};if(R>b)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,d&&(d.errors=(d.errors||0)+1),{frontend:i,backend:r,response:{status:408,error:"Request timeout",latency:b,backendTarget:o,serverTarget:u}};const C={status:200,body:{proxied:!0,backend:o,server:u},latency:R,backendTarget:o,serverTarget:u};return d&&(d.bytesIn=(d.bytesIn||0)+1024,d.bytesOut=(d.bytesOut||0)+2048,d.responseTime=R,this.totalBytesIn+=1024,this.totalBytesOut+=2048),this.responseCount++,this.activeConnections--,{frontend:i,backend:r,response:C,backendTarget:o,serverTarget:u}}selectServer(t,e){const s=t.servers.filter(o=>o.status==="up"&&o.check!==!1);if(s.length===0)return null;if(t.stickTable?.enabled){const o=this.getStickTableKey(e,t.stickTable.type),r=this.stickTable.get(o);if(r&&r.expiresAt>Date.now()&&s.find(d=>`${d.address}:${d.port}`===r.server))return r.server}const n=t.balance||"roundrobin";let i;switch(n){case"roundrobin":i=this.selectRoundRobin(t.name,s);break;case"leastconn":i=this.selectLeastConnections(s);break;case"source":i=this.selectSourceIP(t.name,s,e);break;case"uri":i=this.selectURIHash(t.name,s,e);break;case"hdr":i=this.selectHeaderHash(t.name,s,e);break;default:i=`${s[0].address}:${s[0].port}`}if(t.stickTable?.enabled&&i){const o=this.getStickTableKey(e,t.stickTable.type),r=(t.stickTable.expire||3600)*1e3;this.stickTable.set(o,{server:i,expiresAt:Date.now()+r})}return i}selectRoundRobin(t,e){const s=e.reduce((o,r)=>o+(r.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),`${o.address}:${o.port}`;return this.roundRobinCounters.set(t,(n+1)%s),`${e[0].address}:${e[0].port}`}selectLeastConnections(t){let e=1/0,s=t[0];for(const n of t){const i=`${n.address}:${n.port}`,r=(this.connectionCounts.get(i)||n.sessions||0)/(n.weight||1);r<e&&(e=r,s=n)}return`${s.address}:${s.port}`}selectSourceIP(t,e,s){const n=s.clientIP||s.headers?.["X-Real-IP"]||s.headers?.["X-Forwarded-For"]||"0.0.0.0",i=this.sourceHashMap.get(`${t}:${n}`);if(i&&e.some(d=>`${d.address}:${d.port}`===i))return i;const r=this.simpleHash(n)%e.length,u=`${e[r].address}:${e[r].port}`;return this.sourceHashMap.set(`${t}:${n}`,u),u}selectURIHash(t,e,s){const n=s.path,i=`${t}:${n}`,o=this.uriHashMap.get(i);if(o&&e.some(h=>`${h.address}:${h.port}`===o))return o;const u=this.simpleHash(n)%e.length,d=`${e[u].address}:${e[u].port}`;return this.uriHashMap.set(i,d),d}selectHeaderHash(t,e,s){const n=s.host||s.headers?.Host||s.path,o=this.simpleHash(n)%e.length;return`${e[o].address}:${e[o].port}`}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}getStickTableKey(t,e){switch(e){case"ip":return t.clientIP||t.headers?.["X-Real-IP"]||"0.0.0.0";case"string":return t.host||t.headers?.Host||"";case"integer":return t.headers?.["X-Forwarded-Port"]||"0";default:return t.clientIP||"0.0.0.0"}}evaluateACLs(t,e){for(const s of t)if(!this.evaluateACL(s,e).matched)return{matched:!1,error:`ACL ${s.name} failed`};return{matched:!0}}evaluateACL(t,e){const s=t.operator||"eq",n=t.value||"";if(t.criterion.startsWith("hdr(")){const i=t.criterion.match(/hdr\(([^)]+)\)/)?.[1];if(i){const o=(e.headers?.[i.toLowerCase()]||"").toLowerCase(),r=n.toLowerCase();return{matched:this.compareValues(o,r,s)}}}else{if(t.criterion==="path_beg")return{matched:e.path.toLowerCase().startsWith(n.toLowerCase())};if(t.criterion==="path_end")return{matched:e.path.toLowerCase().endsWith(n.toLowerCase())};if(t.criterion==="path")return{matched:this.compareValues(e.path.toLowerCase(),n.toLowerCase(),s)};if(t.criterion==="src"){const i=e.clientIP||e.headers?.["X-Real-IP"]||e.headers?.["X-Forwarded-For"]||"0.0.0.0";if(n.includes("/")){const[o,r]=n.split("/");return{matched:this.isIPInCIDR(i,o,parseInt(r||"32",10))}}else return{matched:this.compareValues(i,n,s)}}else{if(t.criterion==="method")return{matched:this.compareValues(e.method.toUpperCase(),n.toUpperCase(),s)};if(t.criterion==="url_param"){const i=n.split("=")[0],o=n.split("=")[1]||"",r=e.query?.[i]||"";return o?{matched:this.compareValues(r,o,s)}:{matched:!!r}}}}return{matched:!0}}compareValues(t,e,s){switch(s){case"eq":return t===e;case"ne":return t!==e;case"beg":return t.startsWith(e);case"end":return t.endsWith(e);case"sub":return t.includes(e);case"gt":return parseFloat(t)>parseFloat(e);case"lt":return parseFloat(t)<parseFloat(e);case"gte":return parseFloat(t)>=parseFloat(e);case"lte":return parseFloat(t)<=parseFloat(e);default:return t===e}}isIPInCIDR(t,e,s){if(s===32)return t===e;const n=t.split("."),i=e.split(".");if(n.length!==4||i.length!==4)return!1;const o=Math.floor(s/8);for(let r=0;r<o;r++)if(n[r]!==i[r])return!1;return!0}checkRateLimit(t){if(!this.globalConfig.rateLimit?.enabled)return{allowed:!0};const e=this.globalConfig.rateLimit,s=e.rate||"10r/s",n=e.burst||5,i=s.match(/(\d+)r\/([smh])/);if(!i)return{allowed:!0};const o=parseInt(i[1],10),r=i[2];let u=1e3;switch(r){case"s":u=1e3;break;case"m":u=6e4;break;case"h":u=36e5;break}const d=t.clientIP||t.headers?.["X-Real-IP"]||t.headers?.["X-Forwarded-For"]||"0.0.0.0",h=Date.now(),p=d;let g=this.rateLimitTracker.get(p);return(!g||h>=g.resetAt)&&(g={count:0,resetAt:h+u}),g.count>=o+n?{allowed:!1}:(g.count++,this.rateLimitTracker.set(p,g),{allowed:!0})}startHealthCheck(t,e,s){const n=`${t}:${e.address}:${e.port}`,i=this.healthCheckTimers.get(n);i&&clearInterval(i);const o=s.interval||2e3,r=s.timeout||1e3,u=s.fall||3,d=s.rise||2,h=setInterval(()=>{e.lastCheck=Date.now(),e.checkStatus="checking";const p=Math.random()>.1;setTimeout(()=>{if(p){const g=(this.serverCheckSuccesses.get(n)||0)+1;this.serverCheckSuccesses.set(n,g),this.serverCheckFailures.set(n,0),e.status==="down"&&g>=d?(e.status="up",e.checkStatus="passed"):e.status==="up"&&(e.checkStatus="passed")}else{const g=(this.serverCheckFailures.get(n)||0)+1;this.serverCheckFailures.set(n,g),this.serverCheckSuccesses.set(n,0),e.status==="up"&&g>=u?(e.status="down",e.checkStatus="failed"):e.status==="down"&&(e.checkStatus="failed")}},r)},o);this.healthCheckTimers.set(n,h)}extractPort(t){const e=t.match(/:(\d+)$/);return e?parseInt(e[1],10):80}getStats(){let t=0,e=0,s=0;for(const i of this.backends.values()){t+=i.servers.length;for(const o of i.servers)o.status==="up"?e++:s++}const n=this.requestCount>0?this.errorCount/this.requestCount:0;return{frontends:this.frontends.size,backends:this.backends.size,totalServers:t,upServers:e,downServers:s,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:n,rateLimitBlocks:this.rateLimitBlocks,timeoutErrors:this.timeoutErrors,connectionRejects:this.connectionRejects}}getFrontendStats(t){const e=this.frontends.get(t);return e?{requests:e.requests||0,responses:e.responses||0,bytesIn:e.bytesIn||0,bytesOut:e.bytesOut||0}:null}getBackendStats(t){const e=this.backends.get(t);if(!e)return null;let s=0,n=0,i=0,o=0,r=0,u=0;for(const d of e.servers)d.status==="up"?s++:n++,i+=d.sessions||0,o+=d.bytesIn||0,r+=d.bytesOut||0,u+=d.errors||0;return{servers:e.servers.length,upServers:s,downServers:n,totalSessions:i,totalBytesIn:o,totalBytesOut:r,totalErrors:u}}updateServerStatus(t,e,s){const n=this.backends.get(t);if(!n)return;const i=n.servers.find(o=>o.id===e);i&&(i.status=s)}destroy(){for(const t of this.healthCheckTimers.values())clearInterval(t);this.healthCheckTimers.clear()}}class qT{clusters=new Map;listeners=new Map;routes=new Map;globalConfig={};roundRobinCounters=new Map;leastRequestCounts=new Map;connectionCounts=new Map;ringHashMapping=new Map;maglevTable=new Map;circuitBreakerState=new Map;outlierDetectionState=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;rateLimitBlocks=0;timeoutErrors=0;circuitBreakerTrips=0;healthCheckTimers=new Map;endpointCheckFailures=new Map;endpointCheckSuccesses=new Map;rateLimitTracker=new Map;initialize(t){this.clusters.clear(),this.listeners.clear(),this.routes.clear(),this.roundRobinCounters.clear(),this.leastRequestCounts.clear(),this.connectionCounts.clear(),this.ringHashMapping.clear(),this.maglevTable.clear(),this.circuitBreakerState.clear(),this.outlierDetectionState.clear(),this.endpointCheckFailures.clear(),this.endpointCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.clusters)for(const e of t.clusters){if(this.clusters.set(e.name,{...e}),this.roundRobinCounters.set(e.name,0),this.leastRequestCounts.set(e.name,new Map),this.circuitBreakerState.set(e.name,{isOpen:!1,consecutiveErrors:0}),this.outlierDetectionState.set(e.name,new Map),e.healthCheck?.enabled&&e.endpoints)for(const s of e.endpoints){const n=`${s.address}:${s.port}`;this.leastRequestCounts.get(e.name).set(n,0),this.startHealthCheck(e.name,s,e.healthCheck)}else for(const s of e.endpoints){const n=`${s.address}:${s.port}`;this.leastRequestCounts.get(e.name).set(n,0)}(e.loadBalancingPolicy==="RING_HASH"||e.loadBalancingPolicy==="MAGLEV")&&this.buildHashTable(e.name,e)}if(t.listeners)for(const e of t.listeners)this.listeners.set(e.name,{...e});if(t.routes){const e=[...t.routes].sort((s,n)=>(n.priority||0)-(s.priority||0));for(const s of e)this.routes.set(s.name,{...s})}this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.rateLimitBlocks=0,this.timeoutErrors=0,this.circuitBreakerTrips=0}routeRequest(t,e){const s=Date.now();this.requestCount++;const n=this.globalConfig.maxConnections||1024;if(this.activeConnections>=n)return this.errorCount++,{listener:null,route:null,cluster:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-s}};if(this.activeConnections++,this.globalConfig.rateLimit?.enabled&&!this.checkRateLimit(t).allowed)return this.activeConnections--,this.rateLimitBlocks++,this.errorCount++,{listener:null,route:null,cluster:null,response:{status:429,error:"Rate limit exceeded",latency:Date.now()-s}};let i=null;if(e)i=this.listeners.get(e)||null;else{for(const[D,_]of this.listeners.entries()){const L=_.protocol||"HTTP";if(t.protocol==="https"&&(L==="HTTPS"||_.port===443)){i=_;break}else if(t.protocol==="http"&&(L==="HTTP"||_.port===80)){i=_;break}}!i&&this.listeners.size>0&&(i=Array.from(this.listeners.values())[0])}if(!i)return this.activeConnections--,this.errorCount++,{listener:null,route:null,cluster:null,response:{status:503,error:"No listener available",latency:Date.now()-s}};i.requests=(i.requests||0)+1,i.activeConnections=(i.activeConnections||0)+1;for(const D of i.filters){const _=this.processFilter(D,t);if(!_.allowed)return this.activeConnections--,this.errorCount++,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:null,cluster:null,response:{status:_.status||403,error:_.error||"Filter denied",latency:Date.now()-s}};_.modifiedRequest&&(t=_.modifiedRequest)}let o=null;for(const D of this.routes.values())if(this.matchRoute(D,t)){o=D;break}if(!o)return this.activeConnections--,this.errorCount++,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:null,cluster:null,response:{status:404,error:"No route matched",latency:Date.now()-s}};o.requests=(o.requests||0)+1;const r=this.clusters.get(o.cluster);if(!r)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:null,response:{status:503,error:`Cluster ${o.cluster} not found`,latency:Date.now()-s}};const u=this.circuitBreakerState.get(r.name);if(u&&r.circuitBreaker?.enabled&&u.isOpen){if(u.openUntil&&Date.now()<u.openUntil)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,r.errors=(r.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:r,response:{status:503,error:"Circuit breaker is open",latency:Date.now()-s,clusterTarget:r.name}};u.isOpen=!1,u.consecutiveErrors=0}const d=this.selectEndpoint(r,t);if(!d)return this.activeConnections--,this.errorCount++,o.errors=(o.errors||0)+1,r.errors=(r.errors||0)+1,i.activeConnections=(i.activeConnections||1)-1,{listener:i,route:o,cluster:r,response:{status:503,error:"No healthy endpoint available",latency:Date.now()-s,clusterTarget:r.name}};r.requests=(r.requests||0)+1,r.activeConnections=(r.activeConnections||0)+1;const h=r.endpoints.find(D=>`${D.address}:${D.port}`===d);h&&(h.requests=(h.requests||0)+1);const p=r.connectTimeout||this.globalConfig.connectTimeout||5e3,g=o.timeout||this.globalConfig.requestTimeout||15e3,v=Math.min(50+Math.random()*100,p);if(v>=p*.9)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,o.errors=(o.errors||0)+1,r.errors=(r.errors||0)+1,r.activeConnections=(r.activeConnections||1)-1,i.activeConnections=(i.activeConnections||1)-1,h&&(h.errors=(h.errors||0)+1,this.updateOutlierDetection(r.name,d,!0)),{listener:i,route:o,cluster:r,response:{status:504,error:"Connection timeout",latency:p,clusterTarget:r.name,endpointTarget:d}};const b=10+Math.random()*90,x=v+b;if(x>g)return this.activeConnections--,this.timeoutErrors++,this.errorCount++,o.errors=(o.errors||0)+1,r.errors=(r.errors||0)+1,r.activeConnections=(r.activeConnections||1)-1,i.activeConnections=(i.activeConnections||1)-1,h&&(h.errors=(h.errors||0)+1,this.updateOutlierDetection(r.name,d,!0)),{listener:i,route:o,cluster:r,response:{status:504,error:"Request timeout",latency:g,clusterTarget:r.name,endpointTarget:d}};const R=Math.random()>.1,C=R?200:500+Math.floor(Math.random()*3);R?(this.updateCircuitBreaker(r.name,!1),this.responseCount++,o.responses=(o.responses||0)+1):(this.errorCount++,o.errors=(o.errors||0)+1,r.errors=(r.errors||0)+1,h&&(h.errors=(h.errors||0)+1,this.updateOutlierDetection(r.name,d,!0)),this.updateCircuitBreaker(r.name,!0));const k=1024,T=2048;this.totalBytesIn+=k,this.totalBytesOut+=T,h&&(h.responseTime=x),this.activeConnections--,i.activeConnections=(i.activeConnections||1)-1,r.activeConnections=(r.activeConnections||1)-1;const A={status:C,body:{proxied:!0,cluster:r.name,endpoint:d},latency:x,clusterTarget:r.name,endpointTarget:d};return{listener:i,route:o,cluster:r,response:A,clusterTarget:r.name,endpointTarget:d}}matchRoute(t,e){const s=t.match;if(s.prefix&&!e.path.startsWith(s.prefix)||s.path&&e.path!==s.path||s.regex&&!new RegExp(s.regex).test(e.path))return!1;if(s.headers)for(const n of s.headers){const i=e.headers?.[HT(n.name)]||"";if(n.exact&&i!==n.exact||n.prefix&&!i.startsWith(n.prefix)||n.suffix&&!i.endsWith(n.suffix)||n.regex&&!new RegExp(n.regex).test(i))return!1}if(s.queryParameters)for(const n of s.queryParameters){const i=e.query?.[n.name]||"";if(n.exact&&i!==n.exact||n.regex&&!new RegExp(n.regex).test(i))return!1}return!0}processFilter(t,e){switch(t.type){case"http_connection_manager":return{allowed:!0};case"tls_inspector":return e.protocol==="https"?{allowed:!0}:{allowed:!0};case"router":return{allowed:!0};case"cors":return{allowed:!0,modifiedRequest:e};case"ratelimit":return{allowed:!0};case"fault":const s=t.config?.faultRate||0;return Math.random()<s?{allowed:!1,status:t.config?.faultStatusCode||503,error:"Fault injected"}:{allowed:!0};case"ext_authz":return{allowed:!0};default:return{allowed:!0}}}selectEndpoint(t,e){const s=t.endpoints.filter(o=>{const r=`${o.address}:${o.port}`,u=this.outlierDetectionState.get(t.name)?.get(r);return u?.ejectedUntil&&Date.now()<u.ejectedUntil?!1:o.healthStatus!=="unhealthy"&&o.healthStatus!=="timeout"});if(s.length===0)return null;const n=t.loadBalancingPolicy||"ROUND_ROBIN";let i;switch(n){case"ROUND_ROBIN":i=this.selectRoundRobin(t.name,s);break;case"LEAST_REQUEST":i=this.selectLeastRequest(t.name,s);break;case"RING_HASH":case"MAGLEV":i=this.selectHashBased(t.name,s,e);break;case"RANDOM":i=s[Math.floor(Math.random()*s.length)];break;default:i=s[0]}return`${i.address}:${i.port}`}selectRoundRobin(t,e){const s=e.reduce((o,r)=>o+(r.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),o;return this.roundRobinCounters.set(t,(n+1)%s),e[0]}selectLeastRequest(t,e){const s=this.leastRequestCounts.get(t)||new Map;let n=1/0,i=e[0];for(const u of e){const d=`${u.address}:${u.port}`,p=(s.get(d)||0)/(u.weight||1);p<n&&(n=p,i=u)}const o=`${i.address}:${i.port}`,r=s.get(o)||0;return s.set(o,r+1),i}selectHashBased(t,e,s){const n=s.host||s.path||s.clientIP||"default",o=this.simpleHash(n)%e.length;return e[o]}simpleHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}buildHashTable(t,e){const s=e.endpoints.map(n=>`${n.address}:${n.port}`);this.ringHashMapping.set(t,s)}checkRateLimit(t){if(!this.globalConfig.rateLimit?.enabled)return{allowed:!0};const e=this.globalConfig.rateLimit.rate||100,s=this.globalConfig.rateLimit.burst||10,n=t.clientIP||t.headers?.["X-Real-IP"]||t.headers?.["X-Forwarded-For"]||"0.0.0.0",i=Date.now(),o=n;let r=this.rateLimitTracker.get(o);return(!r||i>=r.resetAt)&&(r={count:0,resetAt:i+1e3}),r.count>=e+s?{allowed:!1}:(r.count++,this.rateLimitTracker.set(o,r),{allowed:!0})}updateCircuitBreaker(t,e){const s=this.clusters.get(t);if(!s||!s.circuitBreaker?.enabled)return;const n=this.circuitBreakerState.get(t);if(n)if(e){n.consecutiveErrors++;const i=s.circuitBreaker.consecutiveErrors||5;n.consecutiveErrors>=i&&!n.isOpen&&(n.isOpen=!0,n.openUntil=Date.now()+3e4,this.circuitBreakerTrips++)}else n.consecutiveErrors=0,n.isOpen&&(n.isOpen=!1,n.openUntil=void 0)}updateOutlierDetection(t,e,s){const n=this.clusters.get(t);if(!n||!n.outlierDetection?.enabled)return;let i=this.outlierDetectionState.get(t);i||(i=new Map,this.outlierDetectionState.set(t,i));let o=i.get(e);if(o||(o={consecutiveErrors:0},i.set(e,o)),s){o.consecutiveErrors++;const r=n.outlierDetection.consecutiveErrors||5,u=n.outlierDetection.baseEjectionTime||3e4;if(o.consecutiveErrors>=r){o.ejectedUntil=Date.now()+u;const d=n.endpoints.find(h=>`${h.address}:${h.port}`===e);d&&(d.healthStatus="unhealthy")}}else if(o.consecutiveErrors=0,o.ejectedUntil&&Date.now()>=o.ejectedUntil){o.ejectedUntil=void 0;const r=n.endpoints.find(u=>`${u.address}:${u.port}`===e);r&&(r.healthStatus="healthy")}}startHealthCheck(t,e,s){const n=`${t}:${e.address}:${e.port}`,i=this.healthCheckTimers.get(n);i&&clearInterval(i);const o=s.interval||1e4,r=s.timeout||5e3,u=s.healthyThreshold||1,d=s.unhealthyThreshold||2,h=setInterval(()=>{e.lastCheck=Date.now();const p=Math.random()>.1;setTimeout(()=>{if(p){const g=(this.endpointCheckSuccesses.get(n)||0)+1;this.endpointCheckSuccesses.set(n,g),this.endpointCheckFailures.set(n,0),(e.healthStatus==="unhealthy"&&g>=u||!e.healthStatus||e.healthStatus==="unknown")&&(e.healthStatus="healthy")}else{const g=(this.endpointCheckFailures.get(n)||0)+1;this.endpointCheckFailures.set(n,g),this.endpointCheckSuccesses.set(n,0),(e.healthStatus==="healthy"&&g>=d||!e.healthStatus||e.healthStatus==="unknown")&&(e.healthStatus="unhealthy")}},r)},o);this.healthCheckTimers.set(n,h)}getStats(){let t=0,e=0,s=0;for(const i of this.clusters.values()){t+=i.endpoints.length;for(const o of i.endpoints)o.healthStatus==="healthy"?e++:o.healthStatus==="unhealthy"&&s++}const n=this.requestCount>0?this.errorCount/this.requestCount:0;return{clusters:this.clusters.size,listeners:this.listeners.size,routes:this.routes.size,totalEndpoints:t,healthyEndpoints:e,unhealthyEndpoints:s,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:n,rateLimitBlocks:this.rateLimitBlocks,timeoutErrors:this.timeoutErrors,circuitBreakerTrips:this.circuitBreakerTrips}}getClusterStats(t){const e=this.clusters.get(t);if(!e)return null;let s=0,n=0;for(const i of e.endpoints)i.healthStatus==="healthy"?s++:i.healthStatus==="unhealthy"&&n++;return{requests:e.requests||0,errors:e.errors||0,activeConnections:e.activeConnections||0,healthyEndpoints:s,unhealthyEndpoints:n}}getListenerStats(t){const e=this.listeners.get(t);return e?{activeConnections:e.activeConnections||0,requests:e.requests||0,responses:e.responses||0}:null}getRouteStats(t){const e=this.routes.get(t);return e?{requests:e.requests||0,responses:e.responses||0,errors:e.errors||0}:null}destroy(){for(const t of this.healthCheckTimers.values())clearInterval(t);this.healthCheckTimers.clear()}}function HT(c){return c.toLowerCase()}class $T{parseQuery(t){const e=t.query.trim(),s=this.extractOperationType(e),n=t.operationName||this.extractOperationName(e),i=this.extractFields(e),o=this.calculateDepth(e),r=this.estimateComplexity(e,n);return{operationName:n,operationType:s,fields:i,depth:o,complexity:r,rawQuery:e}}extractOperationType(t){const e=t.trim();return e.startsWith("mutation")?"mutation":e.startsWith("subscription")?"subscription":"query"}extractOperationName(t){const e=t.match(/(?:query|mutation|subscription)\s+([a-zA-Z0-9_]+)/);return e?e[1]:void 0}extractFields(t){const e=[],s=/([a-zA-Z0-9_]+)\s*(?:\(|\{)/g;let n;for(;(n=s.exec(t))!==null;)e.push(n[1]);return e.length>0?e:["unknown"]}calculateDepth(t){let e=0,s=0;for(const n of t)n==="{"?(e+=1,s=Math.max(s,e)):n==="}"&&(e=Math.max(0,e-1));return s}estimateComplexity(t,e){const s=t.match(/[a-zA-Z0-9_]+(\s*[({])/g),n=s?s.length:5,i=this.calculateDepth(t),o=e?Math.max(1,e.length%5):1;return Math.round(n*(1+i*.5)*o*10)}}class BT{federationConfig;constructor(t){this.federationConfig=t}planQuery(t,e){if(e.length===0)return{subqueries:[],requiresFederation:!1,estimatedLatency:0};const s=this.federationConfig?.enabled??!1,i=this.selectServices(t,e).map(u=>({serviceId:u.id,serviceName:u.name,endpoint:u.endpoint,query:t.rawQuery,fields:t.fields,estimatedLatency:this.estimateServiceLatency(u,t)})),o=i.reduce((u,d)=>u+d.estimatedLatency,0),r=s?3+Math.random()*5:0;return{subqueries:i,requiresFederation:s,estimatedLatency:o+r}}selectServices(t,e){if(this.federationConfig?.enabled&&this.federationConfig.services?.length){const i=e.filter(o=>this.federationConfig.services.includes(o.name));return i.length>0?i:e.slice(0,Math.min(2,e.length))}const s=this.hashString(t.operationName||t.rawQuery),n=Math.abs(s)%e.length;return[e[n]]}estimateServiceLatency(t,e){const s=t.avgLatencyMs,n=Math.sqrt(e.complexity)*.8,i=e.depth*1.5,o=Math.random()*5;return s+n+i+o}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e|=0}return e}updateFederationConfig(t){this.federationConfig=t}}class UT{serviceRegistry;constructor(t){this.serviceRegistry=t}executePlan(t){if(t.subqueries.length===0)return{success:!1,totalLatency:0,error:"No services available",executedEndpoints:[]};let e=0;const s=[];for(const n of t.subqueries){const i=this.serviceRegistry.getService(n.serviceId);if(!i)return{success:!1,totalLatency:e,error:`Service ${n.serviceId} not found`,failedService:n.serviceId,executedEndpoints:s};const o=n.endpoint||i.endpoint;s.push(o);const u=this.getEndpointLatency(o,i.avgLatencyMs)+(n.estimatedLatency-i.avgLatencyMs);if(e+=u,Math.random()<i.errorRate)return this.serviceRegistry.recordRequest(i.id,u,!1),{success:!1,totalLatency:e,error:`Upstream error at ${i.name} (${o})`,failedService:i.id,executedEndpoints:s};this.serviceRegistry.recordRequest(i.id,u,!0)}return{success:!0,totalLatency:e,executedEndpoints:s}}getEndpointLatency(t,e){return t.includes("localhost")||t.includes("127.0.0.1")?e*.8:t.includes("https://")?e*1.1:e}}class FT{services=new Map;registerService(t){const e=this.services.get(t.id);this.services.set(t.id,{id:t.id,name:t.name,endpoint:t.endpoint,avgLatencyMs:t.avgLatencyMs??20,errorRate:t.errorRate??.01,status:t.status??"connected",rollingLatency:e?.rollingLatency||[],rollingErrors:e?.rollingErrors||[]})}unregisterService(t){this.services.delete(t)}getConnectedServices(){return Array.from(this.services.values()).filter(t=>t.status==="connected")}getService(t){return this.services.get(t)}getServiceByName(t){return Array.from(this.services.values()).find(e=>e.name===t)}recordRequest(t,e,s){const n=this.services.get(t);if(!n)return;n.rollingLatency.push(e),n.rollingLatency.length>50&&n.rollingLatency.shift(),s||(n.rollingErrors.push(e),n.rollingErrors.length>50&&n.rollingErrors.shift());const i=n.rollingLatency.reduce((r,u)=>r+u,0)/n.rollingLatency.length;n.avgLatencyMs=i;const o=n.rollingErrors.length/Math.max(n.rollingLatency.length,1);n.errorRate=o}initialize(t){this.services.clear();for(const e of t)this.registerService(e)}getAllServices(){return Array.from(this.services.values())}}class QT{cache=new Map;ttl;persistQueries;constructor(t=0,e=!1){this.ttl=t,this.persistQueries=e}generateCacheKey(t,e){const s=e?JSON.stringify(e):"";return this.hashString(t+s)}getCached(t,e){if(this.ttl<=0||!this.persistQueries)return{hit:!1,latencyReduction:0};const s=this.generateCacheKey(t,e),n=this.cache.get(s);return n?Date.now()-n.timestamp>n.ttl*1e3?(this.cache.delete(s),{hit:!1,latencyReduction:0}):{hit:!0,latencyReduction:.7}:{hit:!1,latencyReduction:0}}setCached(t,e,s){if(this.ttl<=0||!this.persistQueries)return;const n=this.generateCacheKey(t,s);if(this.cache.set(n,{query:t,response:e,timestamp:Date.now(),ttl:this.ttl}),this.cache.size>1e3){const i=this.cache.keys().next().value;this.cache.delete(i)}}getCacheHitProbability(t){if(this.ttl<=0||!this.persistQueries)return 0;const e=.2,s=Math.min(t.complexity/2e3,.4);return Math.min(e+s,.6)}updateConfig(t,e){t!==void 0&&(this.ttl=t),e!==void 0&&(this.persistQueries=e)}clearCache(){this.cache.clear()}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e|=0}return Math.abs(e).toString(16)}}class VT{enabled;limits=new Map;defaultLimit=100;windowMs=6e4;constructor(t=!1,e=100){this.enabled=t,this.defaultLimit=e}checkLimit(t,e){if(!this.enabled)return{allowed:!0,remaining:1/0,resetAt:Date.now()+this.windowMs};const s=e||this.defaultLimit,n=Date.now(),i=this.limits.get(t);if(!i||n>=i.resetAt){const o={count:1,resetAt:n+this.windowMs,windowStart:n};return this.limits.set(t,o),{allowed:!0,remaining:s-1,resetAt:o.resetAt}}return i.count>=s?{allowed:!1,remaining:0,resetAt:i.resetAt}:(i.count+=1,{allowed:!0,remaining:s-i.count,resetAt:i.resetAt})}getIdentifier(t){if(!t)return"default";const e=t["x-api-key"]||t.apikey;if(e)return`key:${e}`;const s=t["x-client-id"];return s?`client:${s}`:"default"}setEnabled(t){this.enabled=t}updateDefaultLimit(t){this.defaultLimit=t}clearLimits(){this.limits.clear()}}class GT{maxQueryDepth;maxQueryComplexity;enabled;constructor(t=15,e=1e3,s=!0){this.maxQueryDepth=t,this.maxQueryComplexity=e,this.enabled=s}validateQuery(t){return this.enabled?t.depth>this.maxQueryDepth?{valid:!1,error:`Query depth ${t.depth} exceeds limit ${this.maxQueryDepth}`}:t.complexity>this.maxQueryComplexity?{valid:!1,error:`Query complexity ${t.complexity} exceeds limit ${this.maxQueryComplexity}`}:{valid:!0}:{valid:!0}}updateLimits(t,e){t!==void 0&&(this.maxQueryDepth=t),e!==void 0&&(this.maxQueryComplexity=e)}setEnabled(t){this.enabled=t}}class WT{config;constructor(t){this.config=t}isEnabled(){return this.config?.enabled??!1}getVersion(){return this.config?.version}getFederatedServices(){return this.config?.services||[]}getPlanningOverhead(){return this.isEnabled()?(this.config?.version==="2"?2:4)+Math.random()*3:0}isFederatedService(t){return this.isEnabled()?this.config?.services?.includes(t.name)??!1:!1}getSupergraphSchema(){return this.config?.supergraph}updateConfig(t){this.config=t}}class KT{queryParser;queryPlanner;queryExecutor;serviceRegistry;cacheManager;rateLimiter;complexityAnalyzer;federationComposer;constructor(){this.serviceRegistry=new FT,this.queryParser=new $T,this.queryPlanner=new BT,this.queryExecutor=new UT(this.serviceRegistry),this.cacheManager=new QT,this.rateLimiter=new VT,this.complexityAnalyzer=new GT,this.federationComposer=new WT}initialize(t){t.services&&this.serviceRegistry.initialize(t.services),this.federationComposer.updateConfig(t.federation),this.queryPlanner.updateFederationConfig(t.federation),this.cacheManager.updateConfig(t.cacheTtl??0,t.persistQueries??!1),this.rateLimiter.setEnabled(t.enableRateLimiting??!1),this.complexityAnalyzer.updateLimits(t.maxQueryDepth??15,t.maxQueryComplexity??1e3),this.complexityAnalyzer.setEnabled(t.enableQueryComplexityAnalysis??!0)}routeRequest(t){const e=Date.now();if(!t.query||t.query.trim().length===0)return{status:400,latency:Date.now()-e,error:"Empty query"};const s=this.rateLimiter.getIdentifier(t.headers);if(!this.rateLimiter.checkLimit(s).allowed)return{status:429,latency:Date.now()-e,error:"Rate limit exceeded"};const i=this.queryParser.parseQuery(t),o=this.cacheManager.getCached(t.query,t.variables);if(o.hit)return{status:200,latency:(Date.now()-e)*(1-o.latencyReduction)};const r=this.complexityAnalyzer.validateQuery(i);if(!r.valid)return{status:413,latency:Date.now()-e,error:r.error};const u=this.serviceRegistry.getConnectedServices();if(u.length===0)return{status:503,latency:Date.now()-e,error:"No connected services"};const d=this.queryPlanner.planQuery(i,u),h=this.queryExecutor.executePlan(d);return h.success?(this.cacheManager.setCached(t.query,{success:!0},t.variables),{status:200,latency:h.totalLatency+(Date.now()-e)}):{status:502,latency:h.totalLatency+(Date.now()-e),error:h.error}}getServiceRegistry(){return this.serviceRegistry}getCacheManager(){return this.cacheManager}getRateLimiter(){return this.rateLimiter}}class YT{backends=new Map;endpoints=new Map;config={};circuitBreakers=new Map;cache=new Map;cacheMode="memory";defaultCacheTtl=5;redisEngine=null;redisNodeId="";backendMetrics=new Map;batchQueue=new Map;batchTimer=null;batchSize=10;batchTimeout=50;initialize(t){if(this.config=t,this.backends.clear(),this.endpoints.clear(),this.circuitBreakers.clear(),this.cache.clear(),this.backendMetrics.clear(),this.cacheMode=t.cacheMode||"memory",this.defaultCacheTtl=t.cacheTtl||5,this.redisEngine=t.redisEngine||null,this.redisNodeId=t.redisNodeId||"",t.backends)for(const e of t.backends)this.backends.set(e.id,{...e}),this.initializeCircuitBreaker(e.id,e.circuitBreaker),this.initializeBackendMetrics(e.id);if(t.endpoints)for(const e of t.endpoints)this.endpoints.set(e.id,{...e})}initializeCircuitBreaker(t,e){e?.enabled&&this.circuitBreakers.set(t,{failures:0,successes:0,state:"closed",lastFailureTime:0,nextAttemptTime:0})}initializeBackendMetrics(t){this.backendMetrics.set(t,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,cacheHits:0,cacheMisses:0})}routeRequest(t){const e=Date.now(),s=this.matchEndpoint(t);if(!s)return{status:404,error:"Endpoint not found",latency:Date.now()-e,backendResponses:[],cacheHit:!1};if(this.config.enableCaching&&this.cacheMode!=="off"){const o=this.getCacheKey(s,t),r=this.getCached(o);if(r){const u=this.backendMetrics.get(s.backends[0])||this.initializeBackendMetrics(s.backends[0]);return u&&u.cacheHits++,{status:200,data:r.data,latency:Date.now()-e,backendResponses:[],cacheHit:!0}}}const n=this.aggregateBackends(s,t),i=this.aggregateResponses(s,n);if(this.config.enableCaching&&this.cacheMode!=="off"&&i.status===200){const o=this.getCacheKey(s,t),r=s.cacheTtl||this.defaultCacheTtl;this.setCached(o,i.data,r)}for(const o of n){const r=this.backendMetrics.get(o.backendId);r&&(r.requestCount++,o.status>=400&&r.errorCount++,r.totalLatency+=o.latency,r.averageLatency=r.totalLatency/r.requestCount,r.lastRequestTime=Date.now(),o.cached||r.cacheMisses++)}return{...i,latency:Date.now()-e,backendResponses:n,cacheHit:!1}}matchEndpoint(t){for(const e of this.endpoints.values())if(e.path===t.path&&e.method===t.method)return e;return null}aggregateBackends(t,e){const s=t.backends;switch(t.aggregator){case"parallel":return this.executeBackendsParallel(s,e,t);case"sequential":return this.executeBackendsSequential(s,e,t);case"merge":default:return this.executeBackendsParallel(s,e,t)}}executeBackendsParallel(t,e,s){const n=[];for(const i of t){const o=this.executeBackend(i,e,s);n.push(o)}return n}executeBackendsSequential(t,e,s){const n=[];let i={};for(const o of t){const r={...e,body:{...typeof e.body=="object"?e.body:{},...i}},u=this.executeBackend(o,r,s);if(n.push(u),u.status>=200&&u.status<300&&u.data)typeof u.data=="object"&&(i={...i,...u.data});else break}return n}executeBackend(t,e,s){const n=this.backends.get(t);if(!n)return{backendId:t,status:503,error:"Backend not found",latency:0,cached:!1};const i=this.circuitBreakers.get(t);if(i){const h=Date.now();if(i.state==="open"){if(h<i.nextAttemptTime)return{backendId:t,status:503,error:"Circuit breaker is open",latency:0,cached:!1};i.state="half-open"}}if(this.config.enableCaching&&this.cacheMode!=="off"){const h=`${t}:${s.path}:${JSON.stringify(e.query||{})}`,p=this.getCached(h);if(p)return{backendId:t,status:200,data:p.data,latency:1,cached:!0}}s.timeout||n.timeout||this.config.defaultTimeout;const o=n.retries||0,r=n.retryBackoff||"exponential";let u,d=0;for(let h=0;h<=o;h++){if(h>0){const R=this.calculateBackoff(h,r);d+=R}const p=50+Math.random()*150,g=(Math.random()-.5)*20,v=p+g;d+=v;const b=n.status==="connected"?.95:.5;if(Math.random()<b){i&&(i.state==="half-open"?(i.successes++,i.successes>=(n.circuitBreaker?.successThreshold||2)&&(i.state="closed",i.failures=0,i.successes=0)):i.failures=Math.max(0,i.failures-1));const R=this.generateMockResponse(n,e);return{backendId:t,status:200,data:R,latency:d,cached:!1}}else u=`Backend error (attempt ${h+1}/${o+1})`,i&&(i.failures++,i.lastFailureTime=Date.now(),i.failures>=(n.circuitBreaker?.failureThreshold||5)&&(i.state="open",i.nextAttemptTime=Date.now()+(n.circuitBreaker?.timeout||6e4)))}return{backendId:t,status:503,error:u||"Backend request failed",latency:d,cached:!1}}calculateBackoff(t,e){switch(e){case"exponential":return Math.min(1e3*Math.pow(2,t-1),1e4);case"linear":return 100*t;case"constant":default:return 100}}generateMockResponse(t,e){const s=t.name.toLowerCase();return s.includes("user")||s.includes("profile")?{id:Math.floor(Math.random()*1e3),name:"John Doe",email:"john.doe@example.com",avatar:"https://example.com/avatar.jpg"}:s.includes("order")||s.includes("cart")?{id:Math.floor(Math.random()*1e3),items:[{id:1,name:"Product 1",price:29.99,quantity:2},{id:2,name:"Product 2",price:49.99,quantity:1}],total:109.97}:s.includes("product")||s.includes("catalog")?{products:[{id:1,name:"Product 1",price:29.99,inStock:!0},{id:2,name:"Product 2",price:49.99,inStock:!0}],total:2}:{data:"Mock response",timestamp:Date.now()}}aggregateResponses(t,e){if(e.length===0)return{status:503,error:"No backends configured for endpoint"};if(e.every(i=>i.status>=400))return{status:503,error:"All backends failed"};const n=e.some(i=>i.status>=400);if(t.aggregator==="merge"||t.aggregator==="parallel"){const i={};for(const o of e)if(o.status>=200&&o.status<300&&o.data){const u=this.backends.get(o.backendId)?.name||o.backendId;typeof o.data=="object"&&o.data,i[u]=o.data}return{status:n?207:200,data:i}}else{const i=e[e.length-1];return i.status>=200&&i.status<300?{status:200,data:i.data}:{status:i.status,error:i.error}}}getCacheKey(t,e){return t.cacheKey?t.cacheKey:`${t.path}:${t.method}:${JSON.stringify(e.query||{})}`}getCached(t){if(this.cacheMode==="off")return null;if(this.cacheMode==="redis"&&this.redisEngine){const s=this.getRedisCacheKey(t),n=this.redisEngine.executeCommand("GET",[s]);if(n.success&&n.value!==null)try{const i=typeof n.value=="string"?JSON.parse(n.value):n.value;return{key:t,data:i,expiresAt:Date.now()+this.defaultCacheTtl*1e3,hitCount:1}}catch{return null}return null}const e=this.cache.get(t);return e?Date.now()>e.expiresAt?(this.cache.delete(t),null):(e.hitCount++,e):null}setCached(t,e,s){if(this.cacheMode!=="off"){if(this.cacheMode==="redis"&&this.redisEngine){const n=this.getRedisCacheKey(t),i=typeof e=="string"?e:JSON.stringify(e),o=[n,i];s>0&&o.push("EX",String(s)),this.redisEngine.executeCommand("SET",o);return}this.cache.set(t,{key:t,data:e,expiresAt:Date.now()+s*1e3,hitCount:0}),this.cache.size>1e3&&this.cleanupCache()}}getRedisCacheKey(t){return`${this.redisNodeId?`bff:${this.redisNodeId}:`:"bff:"}${t}`}cleanupCache(){const t=Date.now();for(const[e,s]of this.cache.entries())t>s.expiresAt&&this.cache.delete(e)}getStats(){let t=0,e=0,s=0,n=0,i=0;const o={};for(const[r,u]of this.backendMetrics.entries())t+=u.requestCount,e+=u.errorCount,s+=u.totalLatency,n+=u.cacheHits,i+=u.cacheMisses,o[r]={...u};return{totalRequests:t,totalErrors:e,averageLatency:t>0?s/t:0,cacheHitRate:n+i>0?n/(n+i):0,backendStats:o}}getBackendMetrics(t){return this.backendMetrics.get(t)}getBackends(){return Array.from(this.backends.values())}getEndpoints(){return Array.from(this.endpoints.values())}updateBackendStatus(t,e){const s=this.backends.get(t);s&&(s.status=e)}}class XT{endpoints=new Map;config={};endpointMetrics=new Map;rateLimitState=new Map;globalRateLimitState=null;requestHistory=[];maxHistorySize=1e3;initialize(t){if(this.config=t,this.endpoints.clear(),this.endpointMetrics.clear(),this.rateLimitState.clear(),this.requestHistory=[],this.globalRateLimitState=null,t.endpoints)for(const e of t.endpoints){const s=e.id||`${e.method}:${e.path}`;this.endpoints.set(s,{...e,id:s,enabled:e.enabled!==!1}),this.initializeEndpointMetrics(s),e.rateLimit&&this.rateLimitState.set(s,{count:0,resetAt:Date.now()+1e3,burst:e.rateLimit})}t.rateLimit?.enabled&&(this.globalRateLimitState={count:0,resetAt:Date.now()+1e3,burst:t.rateLimit.burst||t.rateLimit.requestsPerSecond||1e3})}initializeEndpointMetrics(t){this.endpointMetrics.set(t,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,statusCodeCounts:new Map})}routeRequest(t){const e=Date.now(),s=this.matchEndpoint(t);if(!s)return{status:404,error:"Endpoint not found",latency:Date.now()-e};if(s.enabled===!1)return{status:503,error:"Endpoint is disabled",latency:Date.now()-e,endpoint:s.id};if(this.config.rateLimit?.enabled&&this.globalRateLimitState){const u=this.checkGlobalRateLimit();if(!u.allowed)return this.updateEndpointMetrics(s.id,Date.now()-e,429),{status:429,error:"Rate limit exceeded",latency:Date.now()-e,endpoint:s.id,headers:{"X-RateLimit-Limit":String(this.config.rateLimit.requestsPerSecond||1e3),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(u.resetAt||Date.now()+1e3)}}}if(s.rateLimit&&s.id){const u=this.checkEndpointRateLimit(s.id,s.rateLimit);if(!u.allowed)return this.updateEndpointMetrics(s.id,Date.now()-e,429),{status:429,error:"Endpoint rate limit exceeded",latency:Date.now()-e,endpoint:s.id,headers:{"X-RateLimit-Limit":String(s.rateLimit),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(u.resetAt||Date.now()+1e3)}}}const n=this.authenticate(t);if(!n.success)return this.updateEndpointMetrics(s.id,Date.now()-e,n.status||401),{status:n.status||401,error:n.error||"Authentication failed",latency:Date.now()-e,endpoint:s.id};const i=this.validateParameters(t,s);if(!i.valid)return this.updateEndpointMetrics(s.id,Date.now()-e,400),{status:400,error:i.error||"Invalid parameters",latency:Date.now()-e,endpoint:s.id};const o=this.simulateProcessingLatency(s),r=Date.now()-e+o;return this.updateEndpointMetrics(s.id,r,200),{status:200,data:this.generateResponse(s,t),latency:r,endpoint:s.id,headers:{"Content-Type":"application/json",...this.config.cors?.enabled?this.getCorsHeaders():{}}}}matchEndpoint(t){for(const e of this.endpoints.values())if(e.method===t.method&&e.path===t.path)return e;for(const e of this.endpoints.values())if(e.method===t.method&&this.matchPathPattern(e.path,t.path))return e;return null}matchPathPattern(t,e){const s=t.replace(/:[^/]+/g,"[^/]+").replace(/\*/g,".*");return new RegExp(`^${s}$`).test(e)}checkGlobalRateLimit(){if(!this.globalRateLimitState)return{allowed:!0};const t=Date.now();t>=this.globalRateLimitState.resetAt&&(this.globalRateLimitState.count=0,this.globalRateLimitState.resetAt=t+1e3);const e=this.config.rateLimit?.requestsPerSecond||1e3;return this.globalRateLimitState.count>=e?{allowed:!1,resetAt:this.globalRateLimitState.resetAt}:(this.globalRateLimitState.count++,{allowed:!0})}checkEndpointRateLimit(t,e){let s=this.rateLimitState.get(t);s||(s={count:0,resetAt:Date.now()+1e3,burst:e},this.rateLimitState.set(t,s));const n=Date.now();return n>=s.resetAt&&(s.count=0,s.resetAt=n+1e3),s.count>=e?{allowed:!1,resetAt:s.resetAt}:(s.count++,{allowed:!0})}authenticate(t){const e=this.config.authentication;if(!e||e.type==="none")return{success:!0};switch(e.type){case"bearer":{const s=t.headers?.Authorization||t.headers?.authorization;if(!s||!s.startsWith("Bearer "))return{success:!1,status:401,error:"Missing or invalid Bearer token"};const n=s.replace("Bearer ","");return e.token&&n!==e.token?{success:!1,status:401,error:"Invalid Bearer token"}:{success:!0}}case"apiKey":{const s=e.apiKeyHeader||"X-API-Key",n=t.headers?.[s]||t.headers?.[s.toLowerCase()];return n?e.apiKey&&n!==e.apiKey?{success:!1,status:401,error:"Invalid API key"}:{success:!0}:{success:!1,status:401,error:"Missing API key"}}case"oauth2":{const s=t.headers?.Authorization||t.headers?.authorization;return!s||!s.startsWith("Bearer ")?{success:!1,status:401,error:"Missing OAuth2 token"}:{success:!0}}case"basic":{const s=t.headers?.Authorization||t.headers?.authorization;if(!s||!s.startsWith("Basic "))return{success:!1,status:401,error:"Missing Basic Auth credentials"};const n=s.replace("Basic ","");try{const i=atob(n),[o,r]=i.split(":");return e.username&&o!==e.username?{success:!1,status:401,error:"Invalid username"}:e.password&&r!==e.password?{success:!1,status:401,error:"Invalid password"}:{success:!0}}catch{return{success:!1,status:401,error:"Invalid Basic Auth format"}}}default:return{success:!0}}}validateParameters(t,e){if(!e.parameters||e.parameters.length===0)return{valid:!0};for(const s of e.parameters)if(s.required){let n;switch(s.in){case"query":n=t.query?.[s.name];break;case"path":n="present";break;case"header":n=t.headers?.[s.name]||t.headers?.[s.name.toLowerCase()];break}if(!n&&!s.defaultValue)return{valid:!1,error:`Missing required parameter: ${s.name} (in ${s.in})`}}return{valid:!0}}simulateProcessingLatency(t){const e=10+Math.random()*40,n={GET:0,POST:20,PUT:15,PATCH:10,DELETE:5}[t.method]||0,i=t.timeout?Math.random()*.1*t.timeout:0;return e+n+i}generateResponse(t,e){if(t.responseExample)try{return JSON.parse(t.responseExample)}catch{return{message:t.responseExample}}switch(t.method){case"GET":return{data:[],count:0,message:"Success"};case"POST":return{id:Math.random().toString(36).substring(7),...e.body||{},createdAt:new Date().toISOString()};case"PUT":case"PATCH":return{...e.body||{},updatedAt:new Date().toISOString()};case"DELETE":return{message:"Deleted successfully"};default:return{message:"Success"}}}getCorsHeaders(){const t=this.config.cors;return!t||!t.enabled?{}:{"Access-Control-Allow-Origin":t.allowedOrigins?.join(",")||"*","Access-Control-Allow-Methods":t.allowedMethods?.join(",")||"GET,POST,PUT,DELETE,PATCH","Access-Control-Allow-Headers":t.allowedHeaders?.join(",")||"Content-Type,Authorization"}}updateEndpointMetrics(t,e,s){let n=this.endpointMetrics.get(t);n||(this.initializeEndpointMetrics(t),n=this.endpointMetrics.get(t)),n.requestCount++,s>=400&&n.errorCount++,n.totalLatency+=e,n.averageLatency=n.totalLatency/n.requestCount,n.lastRequestTime=Date.now();const i=n.statusCodeCounts.get(s)||0;n.statusCodeCounts.set(s,i+1),this.requestHistory.push({endpoint:t,timestamp:Date.now(),latency:e,status:s}),this.requestHistory.length>this.maxHistorySize&&this.requestHistory.shift()}getEndpointStats(t){const e=this.endpointMetrics.get(t);if(!e)return null;const s={};for(const[n,i]of e.statusCodeCounts.entries())s[n]=i;return{requestCount:e.requestCount,errorCount:e.errorCount,averageLatency:e.averageLatency,lastRequestTime:e.lastRequestTime,statusCodeCounts:s}}getAllEndpointStats(){const t={};for(const e of this.endpoints.keys())t[e]=this.getEndpointStats(e);return t}getStats(){let t=0,e=0,s=0,n=0;for(const i of this.endpoints.values()){i.enabled!==!1&&n++;const o=this.endpointMetrics.get(i.id);o&&(t+=o.requestCount,e+=o.errorCount,s+=o.totalLatency)}return{totalEndpoints:this.endpoints.size,enabledEndpoints:n,totalRequests:t,totalErrors:e,averageLatency:t>0?s/t:0}}}class JT{services=new Map;config={};methodMetrics=new Map;rateLimitState=new Map;globalRateLimitState=null;connectionState={activeConnections:0,idleConnections:0,totalConnections:0,lastActivity:0};requestHistory=[];maxHistorySize=1e3;initialize(t){if(this.config=t,this.services.clear(),this.methodMetrics.clear(),this.rateLimitState.clear(),this.requestHistory=[],this.globalRateLimitState=null,this.connectionState={activeConnections:0,idleConnections:0,totalConnections:0,lastActivity:0},t.services)for(const e of t.services){this.services.set(e.name,{...e,enabled:e.enabled!==!1});for(const s of e.methods){const n=`${e.name}.${s.name}`;this.initializeMethodMetrics(n),s.rateLimit&&this.rateLimitState.set(n,{count:0,resetAt:Date.now()+1e3,burst:s.rateLimit})}}t.rateLimit?.enabled&&(this.globalRateLimitState={count:0,resetAt:Date.now()+1e3,burst:t.rateLimit.burst||t.rateLimit.requestsPerSecond||1e3})}initializeMethodMetrics(t){this.methodMetrics.set(t,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,statusCounts:new Map,streamingConnections:0})}routeRequest(t){const e=Date.now(),s=this.services.get(t.service);if(!s)return{status:"NOT_FOUND",error:`Service '${t.service}' not found`,latency:Date.now()-e};if(s.enabled===!1)return{status:"UNAVAILABLE",error:`Service '${t.service}' is disabled`,latency:Date.now()-e,service:t.service};const n=s.methods.find(h=>h.name===t.method);if(!n)return{status:"NOT_FOUND",error:`Method '${t.method}' not found in service '${t.service}'`,latency:Date.now()-e,service:t.service};const i=`${t.service}.${t.method}`;if(n.enabled===!1)return{status:"UNAVAILABLE",error:`Method '${t.method}' is disabled`,latency:Date.now()-e,service:t.service,method:t.method};if(this.config.rateLimit?.enabled&&this.globalRateLimitState&&!this.checkGlobalRateLimit().allowed)return this.updateMethodMetrics(i,Date.now()-e,"RESOURCE_EXHAUSTED"),{status:"RESOURCE_EXHAUSTED",error:"Rate limit exceeded",latency:Date.now()-e,service:t.service,method:t.method,metadata:{"grpc-status":"8","grpc-message":"Rate limit exceeded"}};if(n.rateLimit&&!this.checkMethodRateLimit(i,n.rateLimit).allowed)return this.updateMethodMetrics(i,Date.now()-e,"RESOURCE_EXHAUSTED"),{status:"RESOURCE_EXHAUSTED",error:"Method rate limit exceeded",latency:Date.now()-e,service:t.service,method:t.method,metadata:{"grpc-status":"8","grpc-message":"Method rate limit exceeded"}};const o=this.authenticate(t);if(!o.success)return this.updateMethodMetrics(i,Date.now()-e,o.status||"UNAUTHENTICATED"),{status:o.status||"UNAUTHENTICATED",error:o.error||"Authentication failed",latency:Date.now()-e,service:t.service,method:t.method};this.updateConnectionState(!0);const r=this.simulateProcessingLatency(n,t),u=Date.now()-e+r,d=t.timeout||n.timeout||this.config.maxConnectionIdle||3e4;if(u>d)return this.updateMethodMetrics(i,u,"DEADLINE_EXCEEDED"),this.updateConnectionState(!1),{status:"DEADLINE_EXCEEDED",error:"Request timeout exceeded",latency:u,service:t.service,method:t.method,metadata:{"grpc-status":"4","grpc-message":"Deadline exceeded"}};if(n.streaming&&n.streaming!=="unary"){const h=this.methodMetrics.get(i);h&&(h.streamingConnections=(h.streamingConnections||0)+1)}return this.updateMethodMetrics(i,u,"OK"),this.updateConnectionState(!1),{status:"OK",data:this.generateResponse(n,t),latency:u,service:t.service,method:t.method,metadata:{"grpc-status":"0","content-type":"application/grpc"}}}checkGlobalRateLimit(){if(!this.globalRateLimitState)return{allowed:!0};const t=Date.now();t>=this.globalRateLimitState.resetAt&&(this.globalRateLimitState.count=0,this.globalRateLimitState.resetAt=t+1e3);const e=this.config.rateLimit?.requestsPerSecond||1e3;return this.globalRateLimitState.count>=e?{allowed:!1,resetAt:this.globalRateLimitState.resetAt}:(this.globalRateLimitState.count++,{allowed:!0})}checkMethodRateLimit(t,e){let s=this.rateLimitState.get(t);s||(s={count:0,resetAt:Date.now()+1e3,burst:e},this.rateLimitState.set(t,s));const n=Date.now();return n>=s.resetAt&&(s.count=0,s.resetAt=n+1e3),s.count>=e?{allowed:!1,resetAt:s.resetAt}:(s.count++,{allowed:!0})}authenticate(t){const e=this.config.authentication;if(!e||e.type==="none")return{success:!0};switch(e.type){case"jwt":{const s=t.metadata?.authorization||t.metadata?.Authorization;if(!s||!s.startsWith("Bearer "))return{success:!1,status:"UNAUTHENTICATED",error:"Missing or invalid JWT token"};const n=s.replace("Bearer ","");return e.token&&n!==e.token?{success:!1,status:"UNAUTHENTICATED",error:"Invalid JWT token"}:{success:!0}}case"apiKey":{const s=t.metadata?.["x-api-key"]||t.metadata?.["X-API-Key"];return s?e.apiKey&&s!==e.apiKey?{success:!1,status:"UNAUTHENTICATED",error:"Invalid API key"}:{success:!0}:{success:!1,status:"UNAUTHENTICATED",error:"Missing API key"}}case"tls":case"mtls":return this.config.enableTLS?{success:!0}:{success:!1,status:"UNAUTHENTICATED",error:"TLS required but not enabled"};default:return{success:!0}}}simulateProcessingLatency(t,e){const s=5+Math.random()*15;let n=0;if(t.streaming)switch(t.streaming){case"unary":n=0;break;case"client-streaming":case"server-streaming":n=10+Math.random()*20;break;case"bidirectional":n=20+Math.random()*30;break}const i=this.config.enableCompression?2+Math.random()*3:0,o=this.estimateMessageSize(e.payload),r=(this.config.maxMessageSize||4)*1024*1024,u=o>r?50:o/r*10,d=t.timeout?Math.random()*.05*t.timeout:0;return s+n+i+u+d}estimateMessageSize(t){if(!t)return 0;try{return JSON.stringify(t).length}catch{return 0}}generateResponse(t,e){return e.payload?{...e.payload,processedAt:new Date().toISOString(),method:t.name}:{success:!0,message:`Response from ${t.name}`,data:{}}}updateConnectionState(t){t?(this.connectionState.activeConnections++,this.connectionState.totalConnections=Math.max(this.connectionState.totalConnections,this.connectionState.activeConnections+this.connectionState.idleConnections)):this.connectionState.activeConnections>0&&(this.connectionState.activeConnections--,this.connectionState.idleConnections++),this.connectionState.lastActivity=Date.now();const e=(this.config.maxConnectionIdle||300)*1e3;this.connectionState.idleConnections>0&&Date.now()-this.connectionState.lastActivity>e&&(this.connectionState.idleConnections=Math.max(0,this.connectionState.idleConnections-1))}updateMethodMetrics(t,e,s){let n=this.methodMetrics.get(t);n||(this.initializeMethodMetrics(t),n=this.methodMetrics.get(t)),n.requestCount++,s!=="OK"&&n.errorCount++,n.totalLatency+=e,n.averageLatency=n.totalLatency/n.requestCount,n.lastRequestTime=Date.now();const i=n.statusCounts.get(s)||0;n.statusCounts.set(s,i+1);const[o,r]=t.split(".");this.requestHistory.push({service:o||"",method:r||"",timestamp:Date.now(),latency:e,status:s}),this.requestHistory.length>this.maxHistorySize&&this.requestHistory.shift()}getMethodStats(t){const e=this.methodMetrics.get(t);if(!e)return null;const s={};for(const[n,i]of e.statusCounts.entries())s[n]=i;return{requestCount:e.requestCount,errorCount:e.errorCount,averageLatency:e.averageLatency,lastRequestTime:e.lastRequestTime,statusCounts:s,streamingConnections:e.streamingConnections}}getAllMethodStats(){const t={};for(const e of this.methodMetrics.keys())t[e]=this.getMethodStats(e);return t}getStats(){let t=0,e=0,s=0,n=0,i=0,o=0;for(const r of this.services.values()){r.enabled!==!1&&n++,i+=r.methods.length;for(const u of r.methods){u.enabled!==!1&&o++;const d=`${r.name}.${u.name}`,h=this.methodMetrics.get(d);h&&(t+=h.requestCount,e+=h.errorCount,s+=h.totalLatency)}}return{totalServices:this.services.size,enabledServices:n,totalMethods:i,enabledMethods:o,totalRequests:t,totalErrors:e,averageLatency:t>0?s/t:0,activeConnections:this.connectionState.activeConnections,idleConnections:this.connectionState.idleConnections,totalConnections:this.connectionState.totalConnections}}getConnectionState(){return{...this.connectionState}}}class ZT{relays=new Map;config={};deliveries=new Map;pendingDeliveries=new Map;relayMetrics=new Map;initialize(t){if(this.config=t,this.relays.clear(),this.deliveries.clear(),this.pendingDeliveries.clear(),this.relayMetrics.clear(),t.relays)for(const e of t.relays)e.enabled&&(this.relays.set(e.id,{...e}),this.initializeRelayMetrics(e.id))}initializeRelayMetrics(t){this.relayMetrics.set(t,{totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0})}relayWebhook(t){const e=Date.now(),s=this.findMatchingRelay(t);if(!s)return{success:!1,status:404,latency:Date.now()-e,attempts:0,error:"No matching relay found"};if(s.allowedIps&&s.allowedIps.length>0&&t.ip&&!this.isIpAllowed(t.ip,s.allowedIps))return this.updateRelayMetrics(s.id,!1,Date.now()-e),{success:!1,status:403,latency:Date.now()-e,attempts:0,error:"IP address not allowed",relayId:s.id};if(this.config.enableSignatureVerification&&s.signatureSecret&&!this.verifySignature(t,s.signatureSecret,s.signatureHeader||"X-Signature"))return this.updateRelayMetrics(s.id,!1,Date.now()-e),{success:!1,status:401,latency:Date.now()-e,attempts:0,error:"Invalid signature",relayId:s.id};let n=t.body;s.transformTemplate&&(n=this.transformPayload(t.body,s.transformTemplate));const i=this.deliverWebhook(s,{...t,body:n});return this.updateRelayMetrics(s.id,i.success,i.latency),{...i,relayId:s.id}}findMatchingRelay(t){for(const e of this.relays.values())if(t.url.startsWith(e.sourceUrl)||e.sourceUrl==="*"||t.url.includes(e.sourceUrl)){if(e.events&&e.events.length>0){const s=t.event||t.headers["x-event"]||t.headers["x-github-event"]||"";if(!e.events.includes(s)&&s!=="")continue}return e}return null}isIpAllowed(t,e){for(const s of e)if(this.matchesCidr(t,s))return!0;return!1}matchesCidr(t,e){if(e==="*"||e===t)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10),o=s.split("."),r=t.split(".");if(o.length!==4||r.length!==4)return!1;const u=Math.floor(i/8);for(let d=0;d<u;d++)if(o[d]!==r[d])return!1;return!0}return t===e}verifySignature(t,e,s){const n=t.headers[s.toLowerCase()]||t.headers[s]||t.headers["x-signature"]||t.headers["x-hub-signature-256"];return n?(typeof t.body=="string"?t.body:JSON.stringify(t.body),n.length>0&&e.length>0):!1}transformPayload(t,e){try{let s=e;if(s.includes("{{raw}}")){const n=typeof t=="string"?t:JSON.stringify(t);s=s.replace(/\{\{raw\}\}/g,n)}if(s.includes("{{json}}")){const n=typeof t=="string"?JSON.parse(t):t;s=s.replace(/\{\{json\}\}/g,JSON.stringify(n))}try{return JSON.parse(s)}catch{return s}}catch{return t}}deliverWebhook(t,e){const s=t.maxRetryAttempts||this.config.maxRetryAttempts||3,n=t.retryDelay||this.config.retryDelay||5,i=t.timeout||this.config.timeout||30,o=this.config.enableRetryOnFailure!==!1,r=t.retryBackoff||"exponential";let u=0,d,h;const p=Date.now();for(;u<s;){u++;const b=this.simulateHttpRequest(t.targetUrl,e,i);if(b.success){const x=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,R={id:x,relayId:t.id,event:e.event||"unknown",payload:typeof e.body=="string"?e.body:JSON.stringify(e.body),status:"success",timestamp:new Date().toISOString(),attempts:u,responseCode:b.statusCode};return this.deliveries.set(x,R),{success:!0,status:b.statusCode||200,latency:Date.now()-p,deliveryId:x,attempts:u}}if(d=b.error,h=b.statusCode,!o||u>=s)break;this.calculateRetryDelay(u,n,r)}const g=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,v={id:g,relayId:t.id,event:e.event||"unknown",payload:typeof e.body=="string"?e.body:JSON.stringify(e.body),status:"failed",timestamp:new Date().toISOString(),attempts:u,responseCode:h,error:d};return this.deliveries.set(g,v),{success:!1,status:h||500,latency:Date.now()-p,deliveryId:g,attempts:u,error:d||"Delivery failed after all retry attempts"}}simulateHttpRequest(t,e,s){const n=10+Math.random()*40,i=5+Math.random()*95,o=Math.random()<.05;if(Math.random()<.02)return{success:!1,statusCode:504,error:"Request timeout",latency:s*1e3};if(o){const u=[500,502,503,429],d=u[Math.floor(Math.random()*u.length)];return{success:!1,statusCode:d,error:`HTTP ${d} error`,latency:n+i}}return{success:!0,statusCode:200,latency:n+i}}calculateRetryDelay(t,e,s){switch(s){case"exponential":return e*Math.pow(2,t-1);case"linear":return e*t;case"constant":default:return e}}updateRelayMetrics(t,e,s){let n=this.relayMetrics.get(t);n||(n={totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0},this.relayMetrics.set(t,n)),n.totalRequests++,n.totalLatency+=s,n.averageLatency=n.totalLatency/n.totalRequests,n.lastRequestTime=Date.now(),e?n.successfulDeliveries++:n.failedDeliveries++}getDeliveries(t){const e=Array.from(this.deliveries.values());return t?e.filter(s=>s.relayId===t):e}getRelayMetrics(t){return this.relayMetrics.get(t)}getAllRelayMetrics(){return new Map(this.relayMetrics)}getRelay(t){return this.relays.get(t)}getAllRelays(){return Array.from(this.relays.values())}}class ek{config=null;endpoints=new Map;deliveries=new Map;MAX_DELIVERY_HISTORY=1e3;webhookMetrics={endpointsTotal:0,endpointsEnabled:0,deliveriesTotal:0,deliveriesSuccess:0,deliveriesFailed:0,deliveriesPending:0,successRate:0,averageLatency:0,requestsPerSecond:0,errorRate:0,retriesTotal:0,utilization:0};deliveryHistory=[];MAX_DELIVERY_HISTORY_LIST=1e3;requestTimestamps=[];RPS_WINDOW_MS=1e3;rateLimitWindowStart=Date.now();rateLimitRequestsInWindow=0;tokenBucket=null;slidingWindow=[];rateLimitStrategy="fixed";processWebhookRequest(t){const e=Date.now();if(!this.config)return{success:!1,status:500,latency:Date.now()-e,attempts:0,error:"Webhook endpoint not configured"};if(t.ip&&!Array.from(this.endpoints.values()).find(h=>h.enabled&&this.isIPAllowed(t.ip,h.allowedIPs))&&Array.from(this.endpoints.values()).some(h=>h.allowedIPs&&h.allowedIPs.length>0)&&!Array.from(this.endpoints.values()).some(p=>p.enabled&&this.isIPAllowed(t.ip,p.allowedIPs)))return{success:!1,status:403,latency:Date.now()-e,attempts:0,error:"IP address not allowed"};if(this.config.enableRateLimiting&&this.config.rateLimitPerMinute&&!this.checkRateLimit())return{success:!1,status:429,latency:Date.now()-e,attempts:0,error:"Rate limit exceeded"};if(this.config.enableSignatureVerification||this.config.enableSignature){const d=this.config.signatureHeader||"X-Signature";if(!this.verifySignature(t,d))return this.webhookMetrics.deliveriesFailed++,this.webhookMetrics.deliveriesTotal++,this.updateErrorRate(),{success:!1,status:401,latency:Date.now()-e,attempts:0,error:"Invalid signature"}}const s=Date.now();this.requestTimestamps.push(s),this.cleanupOldRequestTimestamps(),this.webhookMetrics.requestsPerSecond=this.requestTimestamps.length;const n=t.event||t.headers?.["x-event"]||t.headers?.["x-github-event"]||"default",i=this.getMatchingEndpoints(n);if(i.length===0)return{success:!0,status:200,latency:Date.now()-e,attempts:0};let o=!0,r=[];for(const d of i){const h=this.deliverToEndpoint(d,t,n);h.deliveryId&&r.push(h.deliveryId),h.success||(o=!1)}const u=Date.now()-e;return this.updateAverageLatency(u),{success:o,status:o?200:500,latency:u,deliveryId:r[0],attempts:1}}transformPayload(t,e){if(!e.payloadTransformation?.enabled)return t;let s=typeof t=="string"?JSON.parse(t):{...t};if(e.payloadTransformation.removeFields)for(const n of e.payloadTransformation.removeFields)delete s[n];if(e.payloadTransformation.addFields&&(s={...s,...e.payloadTransformation.addFields}),e.payloadTransformation.transformFields)for(const[n,i]of Object.entries(e.payloadTransformation.transformFields)){const o=this.getNestedValue(s,n);o!==void 0&&(this.setNestedValue(s,i,o),n!==i&&this.deleteNestedValue(s,n))}if(e.payloadTransformation.template)try{const n=JSON.parse(e.payloadTransformation.template);s=this.applyTemplate(n,s)}catch{}return s}getNestedValue(t,e){return e.split(".").reduce((s,n)=>s?.[n],t)}setNestedValue(t,e,s){const n=e.split("."),i=n.pop(),o=n.reduce((r,u)=>(r[u]||(r[u]={}),r[u]),t);o[i]=s}deleteNestedValue(t,e){const s=e.split("."),n=s.pop(),i=s.reduce((o,r)=>o?.[r],t);i&&delete i[n]}applyTemplate(t,e){if(typeof t=="string")return t.replace(/\{\{([^}]+)\}\}/g,(s,n)=>{const i=this.getNestedValue(e,n.trim());return i!==void 0?String(i):s});if(Array.isArray(t))return t.map(s=>this.applyTemplate(s,e));if(typeof t=="object"&&t!==null){const s={};for(const[n,i]of Object.entries(t))s[n]=this.applyTemplate(i,e);return s}return t}deliverToEndpoint(t,e,s){const n=Date.now(),i=this.config?.maxRetryAttempts||3,o=this.config?.retryDelay||5,r=t.timeoutDuration||this.config?.timeout||this.config?.timeoutDuration||3e4,u=this.config?.enableRetryOnFailure!==!1,d=this.config?.retryBackoff||"exponential";let h=e.body;t.payloadTransformation?.enabled&&(h=this.transformPayload(e.body,t));const p={...e,body:h};let g=0,v,b;for(;g<i;){g++;const k=this.simulateHttpRequest(t.url,p,r);if(k.success){const T=Date.now()-n,A=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,D={id:A,endpointId:t.id,event:s,payload:typeof h=="string"?h:JSON.stringify(h),status:"success",timestamp:new Date().toISOString(),attempts:g,responseCode:k.statusCode,responseBody:k.responseBody,latency:Date.now()-n};return this.addDelivery(D,T),this.updateAverageLatency(T),{success:!0,status:k.statusCode||200,latency:T,deliveryId:A,attempts:g}}if(v=k.error,b=k.statusCode,g>1&&this.webhookMetrics.retriesTotal++,!u||g>=i)break;this.calculateRetryDelay(g,o,d)}const x=Date.now()-n,R=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,C={id:R,endpointId:t.id,event:s,payload:typeof h=="string"?h:JSON.stringify(h),status:"failed",timestamp:new Date().toISOString(),attempts:g,responseCode:b,error:v,latency:x};return this.addDelivery(C,x),this.updateAverageLatency(x),{success:!1,status:b||500,latency:x,deliveryId:R,attempts:g,error:v}}isIPAllowed(t,e){if(!e||e.length===0)return!0;for(const s of e)if(this.isIPInRange(t,s))return!0;return!1}isIPInRange(t,e){if(t===e)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10),o=this.ipToNumber(t),r=this.ipToNumber(s),u=4294967295<<32-i>>>0;return(o&u)===(r&u)}return!1}ipToNumber(t){const e=t.split(".").map(Number);return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]}simulateHttpRequest(t,e,s){const n=Array.from(this.endpoints.values()).find(x=>x.url===t),i=n?.errorRate||this.config?.errorRate||10,o=n?.timeoutDuration||s,r=Math.random(),u=Math.random();let g=100+Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*u)*50;if(g=Math.max(10,Math.min(500,g)),g>o)return{success:!1,statusCode:408,error:"Request timeout"};const v=i/100;if(Math.random()>=v){const x=Math.random();let R=200;return x<.05?R=201:x<.1&&(R=202),{success:!0,statusCode:R,responseBody:JSON.stringify({received:!0,timestamp:Date.now()})}}else{const x=Math.random();if(x<.15){const R=Math.random();return R<.3?{success:!1,statusCode:408,error:"Connection timeout"}:R<.6?{success:!1,statusCode:0,error:"DNS resolution failed"}:{success:!1,statusCode:0,error:"Connection refused"}}else if(x<.3){const R=Math.random();return R<.3?{success:!1,statusCode:400,error:"Bad request"}:R<.6?{success:!1,statusCode:401,error:"Unauthorized"}:R<.8?{success:!1,statusCode:403,error:"Forbidden"}:{success:!1,statusCode:404,error:"Not found"}}else{const R=Math.random();return R<.4?{success:!1,statusCode:500,error:"Internal server error"}:R<.7?{success:!1,statusCode:502,error:"Bad gateway"}:R<.9?{success:!1,statusCode:503,error:"Service unavailable"}:{success:!1,statusCode:504,error:"Gateway timeout"}}}}calculateRetryDelay(t,e,s){switch(s){case"exponential":return e*Math.pow(2,t-1);case"linear":return e*t;case"constant":default:return e}}getMatchingEndpoints(t){const e=[];for(const s of this.endpoints.values())if(s.enabled){if(s.events.length===0){e.push(s);continue}(s.events.includes(t)||s.events.includes("*"))&&e.push(s)}return e}verifySignature(t,e){const s=t.headers?.[e.toLowerCase()]||t.headers?.[e]||t.headers?.["x-signature"]||t.headers?.["x-hub-signature-256"];if(!s)return!1;const n=Array.from(this.endpoints.values()).find(o=>o.secret);if(!n||!n.secret)return s.length>0;const i=this.config?.signatureAlgorithm||"hmac-sha256";return typeof t.body=="string"?t.body:JSON.stringify(t.body),i==="hmac-sha256"||i==="sha256"?/^[0-9a-f]{64}$/i.test(s.replace(/^sha256=/,"").replace(/^hmac-sha256=/,"")):i==="sha512"?/^[0-9a-f]{128}$/i.test(s.replace(/^sha512=/,"")):s.length>=32}checkRateLimit(){const t=this.config?.rateLimitPerMinute||100;switch(this.rateLimitStrategy){case"token-bucket":return this.checkTokenBucket(t);case"sliding-window":return this.checkSlidingWindow(t);case"fixed":default:return this.checkFixedWindow(t)}}checkFixedWindow(t){const e=Date.now();return e-this.rateLimitWindowStart>=6e4&&(this.rateLimitWindowStart=e,this.rateLimitRequestsInWindow=0),this.rateLimitRequestsInWindow>=t?!1:(this.rateLimitRequestsInWindow++,!0)}checkTokenBucket(t){const e=Date.now();this.tokenBucket||(this.tokenBucket={tokens:t,capacity:t,refillRate:t/60,lastRefill:e});const n=(e-this.tokenBucket.lastRefill)/1e3*this.tokenBucket.refillRate;return this.tokenBucket.tokens=Math.min(this.tokenBucket.capacity,this.tokenBucket.tokens+n),this.tokenBucket.lastRefill=e,this.tokenBucket.tokens>=1?(this.tokenBucket.tokens-=1,!0):!1}checkSlidingWindow(t){const e=Date.now(),s=6e4;return this.slidingWindow=this.slidingWindow.filter(n=>e-n.timestamp<s),this.slidingWindow.length>=t?!1:(this.slidingWindow.push({timestamp:e}),!0)}addDelivery(t,e){if(this.deliveries.set(t.id,t),this.webhookMetrics.deliveriesTotal++,t.status==="success"?this.webhookMetrics.deliveriesSuccess++:t.status==="failed"?this.webhookMetrics.deliveriesFailed++:this.webhookMetrics.deliveriesPending++,this.webhookMetrics.deliveriesTotal>0&&(this.webhookMetrics.successRate=this.webhookMetrics.deliveriesSuccess/this.webhookMetrics.deliveriesTotal*100),e!==void 0&&(this.deliveryHistory.push({timestamp:Date.now(),latency:e,status:t.status==="success"?"success":"failed"}),this.deliveryHistory.length>this.MAX_DELIVERY_HISTORY_LIST&&this.deliveryHistory.shift()),this.deliveries.size>this.MAX_DELIVERY_HISTORY){const s=this.deliveries.keys().next().value;this.deliveries.delete(s)}this.updateErrorRate()}updateAverageLatency(t){if(this.deliveryHistory.push({timestamp:Date.now(),latency:t,status:"success"}),this.deliveryHistory.length>this.MAX_DELIVERY_HISTORY_LIST&&this.deliveryHistory.shift(),this.deliveryHistory.length>0){const e=this.deliveryHistory.reduce((s,n)=>s+n.latency,0);this.webhookMetrics.averageLatency=e/this.deliveryHistory.length}}updateErrorRate(){this.webhookMetrics.deliveriesTotal>0&&(this.webhookMetrics.errorRate=this.webhookMetrics.deliveriesFailed/this.webhookMetrics.deliveriesTotal*100)}cleanupOldRequestTimestamps(){const t=Date.now();this.requestTimestamps=this.requestTimestamps.filter(e=>t-e<this.RPS_WINDOW_MS)}initializeConfig(t){const e=t.data.config||{};if(this.config=e,this.endpoints.clear(),e.endpoints)for(const s of e.endpoints)this.endpoints.set(s.id,{...s});this.webhookMetrics.endpointsTotal=this.endpoints.size,this.webhookMetrics.endpointsEnabled=Array.from(this.endpoints.values()).filter(s=>s.enabled).length}updateConfig(t){if(this.config=t,t.enableRateLimiting&&(this.rateLimitStrategy="token-bucket"),this.rateLimitWindowStart=Date.now(),this.rateLimitRequestsInWindow=0,this.tokenBucket=null,this.slidingWindow=[],this.endpoints.clear(),t.endpoints)for(const e of t.endpoints)this.endpoints.set(e.id,{...e});this.webhookMetrics.endpointsTotal=this.endpoints.size,this.webhookMetrics.endpointsEnabled=Array.from(this.endpoints.values()).filter(e=>e.enabled).length}getMetrics(){return this.webhookMetrics.utilization=Math.min(this.webhookMetrics.requestsPerSecond/100*100,100),{...this.webhookMetrics}}getDeliveries(){return Array.from(this.deliveries.values()).sort((t,e)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())}getDeliveriesForEndpoint(t){return this.getDeliveries().filter(e=>e.endpointId===t)}getEndpoints(){return Array.from(this.endpoints.values())}getEndpoint(t){return this.endpoints.get(t)}getEndpointMetrics(t){const e=this.getDeliveriesForEndpoint(t),s=e.length,n=e.filter(v=>v.status==="success").length,i=e.filter(v=>v.status==="failed").length,o=e.filter(v=>v.latency!==void 0).map(v=>v.latency),r=o.length>0?o.reduce((v,b)=>v+b,0)/o.length:0,u=Date.now(),h=e.filter(v=>{const b=new Date(v.timestamp).getTime();return u-b<6e4}).length/60,p=s>0?i/s*100:0,g=s>0?n/s*100:0;return{totalDeliveries:s,successDeliveries:n,failedDeliveries:i,successRate:g,averageLatency:Math.round(r),requestsPerSecond:Math.round(h*100)/100,errorRate:p}}}class tk{keys=new Map;config={};maxMemoryBytes=256*1024*1024;currentMemoryUsage=0;metrics={totalKeys:0,keysByType:{string:0,hash:0,list:0,set:0,zset:0,stream:0},memoryUsage:0,memoryUsagePercent:0,operationsPerSecond:0,hitCount:0,missCount:0,hitRate:0,expiredKeys:0,evictedKeys:0,connectedClients:0};operationCount=0;lastMetricsUpdate=Date.now();operationHistory=[];clusterSlots=new Map;clusterNodes=[];initialize(t){if(this.config={...t},this.keys.clear(),this.currentMemoryUsage=0,this.operationCount=0,this.lastMetricsUpdate=Date.now(),this.operationHistory=[],t.maxMemory&&(this.maxMemoryBytes=this.parseMemorySize(t.maxMemory)),t.enableCluster&&t.clusterNodes&&(this.clusterNodes=[...t.clusterNodes],this.initializeClusterSlots()),t.keys&&Array.isArray(t.keys))for(const e of t.keys)this.setKey(e.key,e.type,e.value,e.ttl);this.updateMetrics()}parseMemorySize(t){const e=t.match(/^(\d+)([kmg]?b?)$/i);if(!e)return 256*1024*1024;const s=parseInt(e[1]);switch(e[2].toLowerCase()){case"kb":return s*1024;case"mb":return s*1024*1024;case"gb":return s*1024*1024*1024;default:return s}}initializeClusterSlots(){if(this.clusterNodes.length===0)return;const t=Math.floor(16384/this.clusterNodes.length);let e=0;for(let s=0;s<this.clusterNodes.length;s++){const n=s===this.clusterNodes.length-1?16383:e+t-1;for(let i=e;i<=n;i++)this.clusterSlots.set(i,this.clusterNodes[s]);e=n+1}}getClusterSlot(t){const e=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935];let s=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);s=(s<<8^e[(s>>8^i)&255])&65535}return s%16384}isKeyForThisNode(t){if(!this.config.enableCluster||this.clusterNodes.length===0)return!0;const e=this.getClusterSlot(t);return this.clusterSlots.get(e),!0}executeCommand(t,e){const s=Date.now(),n=t.toUpperCase();try{let i;switch(n){case"GET":i=this.get(e[0]);break;case"SET":i=this.set(e[0],e[1],e[2]?parseInt(e[2]):void 0);break;case"DEL":i=this.del(e);break;case"EXISTS":i=this.exists(e);break;case"EXPIRE":i=this.expire(e[0],parseInt(e[1]));break;case"TTL":i=this.ttl(e[0]);break;case"KEYS":i=this.keys(e[0]||"*");break;case"HGET":i=this.hget(e[0],e[1]);break;case"HSET":i=this.hset(e[0],e.slice(1));break;case"HGETALL":i=this.hgetall(e[0]);break;case"HDEL":i=this.hdel(e[0],e.slice(1));break;case"HKEYS":i=this.hkeys(e[0]);break;case"HVALS":i=this.hvals(e[0]);break;case"LPUSH":i=this.lpush(e[0],e.slice(1));break;case"RPUSH":i=this.rpush(e[0],e.slice(1));break;case"LPOP":i=this.lpop(e[0]);break;case"RPOP":i=this.rpop(e[0]);break;case"LLEN":i=this.llen(e[0]);break;case"LRANGE":i=this.lrange(e[0],parseInt(e[1]),parseInt(e[2]));break;case"SADD":i=this.sadd(e[0],e.slice(1));break;case"SREM":i=this.srem(e[0],e.slice(1));break;case"SMEMBERS":i=this.smembers(e[0]);break;case"SISMEMBER":i=this.sismember(e[0],e[1]);break;case"SCARD":i=this.scard(e[0]);break;case"ZADD":i=this.zadd(e[0],e.slice(1));break;case"ZREM":i=this.zrem(e[0],e.slice(1));break;case"ZRANGE":i=this.zrange(e[0],parseInt(e[1]),parseInt(e[2]));break;case"ZSCORE":i=this.zscore(e[0],e[1]);break;case"ZCARD":i=this.zcard(e[0]);break;case"PING":i="PONG";break;case"INFO":i=this.info(e[0]);break;case"DBSIZE":i=this.dbsize();break;default:return{success:!1,error:`Unknown command: ${t}`,latency:Date.now()-s}}const o=Date.now()-s;return this.recordOperation(),{success:!0,value:i,latency:o}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",latency:Date.now()-s}}}recordOperation(){this.operationCount++,this.operationHistory.push({timestamp:Date.now()}),this.operationHistory.length>1e3&&this.operationHistory.shift()}get(t){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");const e=this.keys.get(t);return e?this.isExpired(e)?(this.deleteKey(t),this.metrics.missCount++,null):(this.metrics.hitCount++,typeof e.value=="string"?e.value:JSON.stringify(e.value)):(this.metrics.missCount++,null)}set(t,e,s){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();const n=this.keys.get(t);n&&(this.currentMemoryUsage-=this.calculateKeySize(n));const i={key:t,type:"string",value:e,ttl:s!==void 0?s:n?.ttl,expiresAt:s!==void 0&&s>0?Date.now()+s*1e3:n?.expiresAt,size:this.estimateSize(e)};return this.keys.set(t,i),this.currentMemoryUsage+=this.calculateKeySize(i),"OK"}del(t){let e=0;for(const s of t)this.deleteKey(s)&&e++;return e}exists(t){let e=0;for(const s of t){const n=this.keys.get(s);n&&!this.isExpired(n)&&e++}return e}expire(t,e){const s=this.keys.get(t);return s?this.isExpired(s)?(this.deleteKey(t),0):(s.ttl=e,s.expiresAt=e>0?Date.now()+e*1e3:void 0,1):0}ttl(t){const e=this.keys.get(t);if(!e)return-2;if(this.isExpired(e))return this.deleteKey(t),-2;if(!e.expiresAt)return-1;const s=Math.floor((e.expiresAt-Date.now())/1e3);return s>0?s:-2}keys(t){const e=this.patternToRegex(t),s=[];for(const[n,i]of this.keys.entries()){if(this.isExpired(i)){this.deleteKey(n);continue}e.test(n)&&s.push(n)}return s}hget(t,e){const s=this.keys.get(t);return!s||s.type!=="hash"?null:this.isExpired(s)?(this.deleteKey(t),null):s.value[e]||null}hset(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="hash")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"hash",value:{},size:0});const n=s.value;let i=0;for(let o=0;o<e.length;o+=2){const r=e[o],u=e[o+1];n[r]||i++,n[r]=u}return s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),i}hgetall(t){const e=this.keys.get(t);return!e||e.type!=="hash"?{}:this.isExpired(e)?(this.deleteKey(t),{}):{...e.value}}hdel(t,e){const s=this.keys.get(t);if(!s||s.type!=="hash")return 0;if(this.isExpired(s))return this.deleteKey(t),0;const n=s.value;let i=0;for(const o of e)n[o]&&(delete n[o],i++);return i>0&&(s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s)),i}hkeys(t){const e=this.keys.get(t);return!e||e.type!=="hash"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Object.keys(e.value)}hvals(t){const e=this.keys.get(t);return!e||e.type!=="hash"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Object.values(e.value)}lpush(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="list")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"list",value:[],size:0});const n=s.value;return n.unshift(...e),s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),n.length}rpush(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="list")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"list",value:[],size:0});const n=s.value;return n.push(...e),s.size=this.estimateSize(JSON.stringify(n)),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),n.length}lpop(t){const e=this.keys.get(t);if(!e||e.type!=="list")return null;if(this.isExpired(e))return this.deleteKey(t),null;const s=e.value;if(s.length===0)return null;const n=s.shift();return e.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,e),n}rpop(t){const e=this.keys.get(t);if(!e||e.type!=="list")return null;if(this.isExpired(e))return this.deleteKey(t),null;const s=e.value;if(s.length===0)return null;const n=s.pop();return e.size=this.estimateSize(JSON.stringify(s)),this.keys.set(t,e),n}llen(t){const e=this.keys.get(t);return!e||e.type!=="list"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.length}lrange(t,e,s){const n=this.keys.get(t);if(!n||n.type!=="list")return[];if(this.isExpired(n))return this.deleteKey(t),[];const i=n.value,o=i.length,r=e<0?Math.max(0,o+e):Math.min(e,o),u=s<0?Math.max(0,o+s):Math.min(s,o-1);return i.slice(r,u+1)}sadd(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="set")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"set",value:new Set,size:0});const n=s.value;let i=0;for(const o of e)n.has(o)||(n.add(o),i++);return s.size=this.estimateSize(JSON.stringify(Array.from(n))),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),i}srem(t,e){const s=this.keys.get(t);if(!s||s.type!=="set")return 0;if(this.isExpired(s))return this.deleteKey(t),0;const n=s.value;let i=0;for(const o of e)n.has(o)&&(n.delete(o),i++);return i>0&&(s.size=this.estimateSize(JSON.stringify(Array.from(n))),this.keys.set(t,s)),i}smembers(t){const e=this.keys.get(t);return!e||e.type!=="set"?[]:this.isExpired(e)?(this.deleteKey(t),[]):Array.from(e.value)}sismember(t,e){const s=this.keys.get(t);return!s||s.type!=="set"?0:this.isExpired(s)?(this.deleteKey(t),0):s.value.has(e)?1:0}scard(t){const e=this.keys.get(t);return!e||e.type!=="set"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.size}zadd(t,e){if(!this.isKeyForThisNode(t))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let s=this.keys.get(t);(!s||s.type!=="zset")&&(s&&(this.currentMemoryUsage-=this.calculateKeySize(s)),s={key:t,type:"zset",value:new Map,size:0});const n=s.value;let i=0;for(let o=0;o<e.length;o+=2){const r=parseFloat(e[o]),u=e[o+1];n.has(u)||i++,n.set(u,r)}return s.size=this.estimateSize(JSON.stringify(Array.from(n.entries()))),this.keys.set(t,s),this.currentMemoryUsage+=this.calculateKeySize(s),i}zrem(t,e){const s=this.keys.get(t);if(!s||s.type!=="zset")return 0;if(this.isExpired(s))return this.deleteKey(t),0;const n=s.value;let i=0;for(const o of e)n.has(o)&&(n.delete(o),i++);return i>0&&(s.size=this.estimateSize(JSON.stringify(Array.from(n.entries()))),this.keys.set(t,s)),i}zrange(t,e,s){const n=this.keys.get(t);if(!n||n.type!=="zset")return[];if(this.isExpired(n))return this.deleteKey(t),[];const i=n.value,o=Array.from(i.entries()).sort((h,p)=>h[1]-p[1]),r=o.length,u=e<0?Math.max(0,r+e):Math.min(e,r),d=s<0?Math.max(0,r+s):Math.min(s,r-1);return o.slice(u,d+1).map(h=>h[0])}zscore(t,e){const s=this.keys.get(t);return!s||s.type!=="zset"?null:this.isExpired(s)?(this.deleteKey(t),null):s.value.get(e)??null}zcard(t){const e=this.keys.get(t);return!e||e.type!=="zset"?0:this.isExpired(e)?(this.deleteKey(t),0):e.value.size}info(t){const e=this.getMetrics();return`# Server
redis_version:7.2.0
redis_mode:${this.config.enableCluster?"cluster":"standalone"}

# Memory
used_memory:${e.memoryUsage}
used_memory_human:${this.formatBytes(e.memoryUsage)}
maxmemory:${this.maxMemoryBytes}
maxmemory_human:${this.formatBytes(this.maxMemoryBytes)}
maxmemory_policy:${this.config.maxMemoryPolicy||"noeviction"}
mem_fragmentation_ratio:1.0

# Stats
total_keys:${e.totalKeys}
expired_keys:${e.expiredKeys}
evicted_keys:${e.evictedKeys}
keyspace_hits:${e.hitCount}
keyspace_misses:${e.missCount}

# Cluster
cluster_enabled:${this.config.enableCluster?1:0}
`}dbsize(){return this.cleanupExpiredKeys(),this.keys.size}setKey(t,e,s,n){const i={key:t,type:e,value:s,ttl:n!==void 0?n:-1,expiresAt:n!==void 0&&n>0?Date.now()+n*1e3:void 0,size:this.estimateSize(typeof s=="string"?s:JSON.stringify(s))};this.keys.set(t,i),this.currentMemoryUsage+=this.calculateKeySize(i)}deleteKey(t){const e=this.keys.get(t);return e?(this.currentMemoryUsage-=this.calculateKeySize(e),this.keys.delete(t),!0):!1}isExpired(t){return t.expiresAt?Date.now()>=t.expiresAt:!1}cleanupExpiredKeys(){let t=0;for(const[e,s]of this.keys.entries())this.isExpired(s)&&(this.deleteKey(e),t++);t>0&&(this.metrics.expiredKeys+=t)}checkMemoryAndEvict(){if(this.currentMemoryUsage<=this.maxMemoryBytes)return;const t=this.config.maxMemoryPolicy||"noeviction";if(t==="noeviction")return;const e=this.selectKeysToEvict(t);let s=0;for(const n of e)if(this.deleteKey(n),s++,this.currentMemoryUsage<=this.maxMemoryBytes*.9)break;s>0&&(this.metrics.evictedKeys+=s)}selectKeysToEvict(t){const e=Array.from(this.keys.keys());switch(t){case"allkeys-lru":case"allkeys-lfu":case"allkeys-random":return e;case"volatile-lru":case"volatile-lfu":case"volatile-ttl":case"volatile-random":return e.filter(s=>{const n=this.keys.get(s);return n&&n.expiresAt!==void 0});default:return[]}}calculateKeySize(t){if(t.size)return t.size;let e=0;return typeof t.value=="string"?e=Buffer.byteLength(t.value,"utf8"):e=Buffer.byteLength(JSON.stringify(t.value),"utf8"),Buffer.byteLength(t.key,"utf8")+e+100}estimateSize(t){return Buffer.byteLength(t,"utf8")}patternToRegex(t){const e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${e}$`)}formatBytes(t){if(t===0)return"0B";const e=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,n)*100)/100+s[n]}getMetrics(){return this.cleanupExpiredKeys(),this.updateMetrics(),{...this.metrics}}updateMetrics(){const t=Date.now();(t-this.lastMetricsUpdate)/1e3;const e={string:0,hash:0,list:0,set:0,zset:0,stream:0};for(const o of this.keys.values())e[o.type]++;const s=this.operationHistory.filter(o=>o.timestamp>t-1e3).length,n=this.metrics.hitCount+this.metrics.missCount,i=n>0?this.metrics.hitCount/n:0;this.metrics={totalKeys:this.keys.size,keysByType:e,memoryUsage:this.currentMemoryUsage,memoryUsagePercent:this.maxMemoryBytes>0?this.currentMemoryUsage/this.maxMemoryBytes*100:0,operationsPerSecond:s,hitCount:this.metrics.hitCount,missCount:this.metrics.missCount,hitRate:i,expiredKeys:this.metrics.expiredKeys,evictedKeys:this.metrics.evictedKeys,connectedClients:1},this.lastMetricsUpdate=t}getAllKeys(){return this.cleanupExpiredKeys(),Array.from(this.keys.values())}getKey(t){const e=this.keys.get(t);if(e&&this.isExpired(e)){this.deleteKey(t);return}return e}syncKeysFromConfig(t){const e=new Map;for(const s of t)e.set(s.key,s);for(const[s,n]of this.keys.entries());for(const s of t){const n=this.keys.get(s.key);if(!n)this.setKey(s.key,s.type,s.value,s.ttl);else if(n.type!==s.type||JSON.stringify(n.value)!==JSON.stringify(s.value)||n.ttl!==s.ttl){this.currentMemoryUsage-=this.calculateKeySize(n);const i={...s,expiresAt:s.ttl!==void 0&&s.ttl>0?Date.now()+s.ttl*1e3:void 0,size:this.estimateSize(typeof s.value=="string"?s.value:JSON.stringify(s.value))};this.keys.set(s.key,i),this.currentMemoryUsage+=this.calculateKeySize(i)}}this.updateMetrics()}}class sk{clusterName="archiphoenix-cluster";nodes=new Map;keyspaces=new Map;tables=new Map;tableData=new Map;defaultConsistencyLevel="QUORUM";defaultReplicationFactor=3;enableCompaction=!0;compactionStrategy="SizeTieredCompactionStrategy";datacenter="dc1";metrics={readLatency:5,writeLatency:10,totalNodes:0,healthyNodes:0,totalKeyspaces:0,totalTables:0,totalRows:0,totalSize:0,readOperationsPerSecond:0,writeOperationsPerSecond:0,readConsistencyViolations:0,writeConsistencyViolations:0,pendingCompactions:0,hintedHandoffs:0};readOperations=[];writeOperations=[];lastMetricsUpdate=Date.now();initialize(t){if(this.clusterName=t.clusterName||"archiphoenix-cluster",this.defaultConsistencyLevel=t.defaultConsistencyLevel||"QUORUM",this.defaultReplicationFactor=t.defaultReplicationFactor||3,this.enableCompaction=t.enableCompaction??!0,this.compactionStrategy=t.compactionStrategy||"SizeTieredCompactionStrategy",this.datacenter=t.datacenter||"dc1",this.nodes.clear(),t.nodes)for(const e of t.nodes)this.nodes.set(e.address,{...e});else this.nodes.set("localhost:9042",{address:"localhost:9042",status:"up",load:.5,tokens:256});if(this.keyspaces.clear(),t.keyspaces)for(const e of t.keyspaces)this.keyspaces.set(e.name,{...e});else this.keyspaces.set("system",{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0});if(this.tables.clear(),this.tableData.clear(),t.tables)for(const e of t.tables){const s=`${e.keyspace}.${e.name}`;this.tables.set(s,{...e}),this.tableData.set(s,[])}this.updateMetrics()}syncFromConfig(t){if(t.clusterName&&(this.clusterName=t.clusterName),t.defaultConsistencyLevel&&(this.defaultConsistencyLevel=t.defaultConsistencyLevel),t.defaultReplicationFactor!==void 0&&(this.defaultReplicationFactor=t.defaultReplicationFactor),t.nodes)for(const e of t.nodes)this.nodes.set(e.address,{...e});if(t.keyspaces){new Set(this.keyspaces.keys());for(const e of t.keyspaces)this.keyspaces.set(e.name,{...e,tables:this.countTablesInKeyspace(e.name)})}if(t.tables)for(const e of t.tables){const s=`${e.keyspace}.${e.name}`,n=this.tables.get(s);if(n){const i=this.tableData.get(s)||[];this.tables.set(s,{...e,rows:n.rows||i.length||0,size:n.size||i.length*1024||0})}else this.tables.set(s,{...e,rows:0,size:0}),this.tableData.has(s)||this.tableData.set(s,[])}this.updateMetrics()}executeCQL(t,e){const s=Date.now(),n=e||this.defaultConsistencyLevel;try{const i=t.trim().replace(/\s+/g," "),o=i.toUpperCase();return o.startsWith("SELECT")?this.executeSelect(i,n,s):o.startsWith("INSERT")?this.executeInsert(i,n,s):o.startsWith("UPDATE")?this.executeUpdate(i,n,s):o.startsWith("DELETE")?this.executeDelete(i,n,s):o.startsWith("CREATE KEYSPACE")?this.executeCreateKeyspace(i,s):o.startsWith("CREATE TABLE")?this.executeCreateTable(i,s):o.startsWith("DROP TABLE")?this.executeDropTable(i,s):o.startsWith("DROP KEYSPACE")?this.executeDropKeyspace(i,s):{success:!1,error:`Unsupported CQL statement: ${i}`,latency:Date.now()-s}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",latency:Date.now()-s}}}executeSelect(t,e,s){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i),r=this.tables.get(o);if(!r)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const u=this.tableData.get(o)||[],d=t.match(/LIMIT\s+(\d+)/i),h=d?parseInt(d[1],10):void 0;let p=[...u];const g=t.match(/WHERE\s+(.+?)(?:\s+LIMIT|$)/i);if(g){const C=g[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(C){const k=C[1],T=C[2];p=u.filter(A=>String(A[k])===T)}}h!==void 0&&h>0&&(p=p.slice(0,h));const v=this.calculateReadLatency(e),b=this.checkConsistencyViolation(e,r.keyspace);this.recordReadOperation(v,b);const x=this.getRequiredReplicas(e,r.keyspace);return{success:!0,latency:v,consistency:e,rows:p,rowCount:p.length,replicasQueried:x}}executeInsert(t,e,s){const n=t.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i);let r=this.tables.get(o);if(!r)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const u=t.match(/\(([^)]+)\)\s*VALUES/i),d=t.match(/VALUES\s*\(([^)]+)\)/i);if(!u||!d)return{success:!1,error:"Invalid INSERT query: missing columns or values",latency:Date.now()-s};const h=u[1].split(",").map(k=>k.trim()),p=d[1],g=this.parseValueList(p);if(h.length!==g.length)return{success:!1,error:"Column count does not match value count",latency:Date.now()-s};const v={};for(let k=0;k<h.length;k++)v[h[k]]=g[k];const b=this.tableData.get(o)||[];b.push(v),this.tableData.set(o,b),r.rows=b.length,r.size=b.length*1024,this.tables.set(o,r);const x=this.calculateWriteLatency(e,r.keyspace),R=this.checkConsistencyViolation(e,r.keyspace);this.recordWriteOperation(x,R);const C=this.getRequiredReplicas(e,r.keyspace);return this.updateMetrics(),{success:!0,latency:x,consistency:e,rowCount:1,replicasQueried:C}}executeUpdate(t,e,s){const n=t.match(/UPDATE\s+([\w.]+)\s+SET/i);if(!n)return{success:!1,error:"Invalid UPDATE query",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i),r=this.tables.get(o);if(!r)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const u=t.match(/SET\s+(.+?)(?:\s+WHERE|$)/i);if(!u)return{success:!1,error:"Invalid UPDATE query: missing SET clause",latency:Date.now()-s};const d=u[1].trim(),h={},p=d.split(",").map(_=>_.trim());for(const _ of p){const L=_.match(/(\w+)\s*=\s*(.+)/);if(L){const O=L[1].trim(),X=this.parseValue(L[2].trim());h[O]=X}}const g=t.match(/WHERE\s+(.+)/i);if(!g)return{success:!1,error:"UPDATE requires WHERE clause",latency:Date.now()-s};const b=g[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!b)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-s};const x=b[1],R=b[2],C=this.tableData.get(o)||[];let k=0;for(const _ of C)String(_[x])===R&&(Object.assign(_,h),k++);r.rows=C.length,r.size=C.length*1024,this.tables.set(o,r);const T=this.calculateWriteLatency(e,r.keyspace),A=this.checkConsistencyViolation(e,r.keyspace);this.recordWriteOperation(T,A);const D=this.getRequiredReplicas(e,r.keyspace);return this.updateMetrics(),{success:!0,latency:T,consistency:e,rowCount:k,replicasQueried:D}}executeDelete(t,e,s){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DELETE query: missing FROM clause",latency:Date.now()-s};const i=n[1].trim(),o=this.normalizeTableKey(i),r=this.tables.get(o);if(!r)return{success:!1,error:`Table ${i} does not exist`,latency:Date.now()-s};const u=t.match(/WHERE\s+(.+)/i);if(!u)return{success:!1,error:"DELETE requires WHERE clause",latency:Date.now()-s};const h=u[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!h)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-s};const p=h[1],g=h[2],v=this.tableData.get(o)||[],b=v.length,x=v.filter(A=>String(A[p])!==g);this.tableData.set(o,x),r.rows=x.length,r.size=x.length*1024,this.tables.set(o,r);const R=b-x.length,C=this.calculateWriteLatency(e,r.keyspace),k=this.checkConsistencyViolation(e,r.keyspace);this.recordWriteOperation(C,k);const T=this.getRequiredReplicas(e,r.keyspace);return this.updateMetrics(),{success:!0,latency:C,consistency:e,rowCount:R,replicasQueried:T}}executeCreateKeyspace(t,e){const s=t.match(/KEYSPACE\s+(\w+)/i);if(!s)return{success:!1,error:"Invalid CREATE KEYSPACE query",latency:Date.now()-e};const n=s[1].trim();if(this.keyspaces.has(n))return{success:!1,error:`Keyspace ${n} already exists`,latency:Date.now()-e};let i=this.defaultReplicationFactor;const o=t.match(/replication.*?(\d+)/i);return o&&(i=parseInt(o[1],10)),this.keyspaces.set(n,{name:n,replication:i,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeCreateTable(t,e){const s=t.match(/TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);if(this.tables.has(i))return{success:!1,error:`Table ${n} already exists`,latency:Date.now()-e};let o=t;const r=t.toUpperCase().indexOf(" WITH ");r>0&&(o=t.substring(0,r));const u=o.match(/\(([^)]+)\)/);if(!u)return{success:!1,error:"Invalid CREATE TABLE query: missing column definitions",latency:Date.now()-e};const d=u[1],h=[],p=d.split(",").map(C=>C.trim());for(const C of p){if(C.toUpperCase().includes("PRIMARY KEY"))continue;const k=C.match(/(\w+)\s+(\w+)/);k&&h.push({name:k[1],type:k[2]})}const g=n.split("."),v=g.length>1?g[0]:"system",b=g.length>1?g[1]:g[0];if(!this.keyspaces.has(v))return{success:!1,error:`Keyspace ${v} does not exist`,latency:Date.now()-e};const x={name:b,keyspace:v,columns:h,rows:0,size:0};this.tables.set(i,x),this.tableData.set(i,[]);const R=this.keyspaces.get(v);return R&&(R.tables=this.countTablesInKeyspace(v),this.keyspaces.set(v,R)),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeDropTable(t,e){const s=t.match(/TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);if(!this.tables.has(i))return{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e};const o=this.tables.get(i);this.tables.delete(i),this.tableData.delete(i);const r=this.keyspaces.get(o.keyspace);return r&&(r.tables=this.countTablesInKeyspace(o.keyspace),this.keyspaces.set(o.keyspace,r)),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}executeDropKeyspace(t,e){const s=t.match(/KEYSPACE\s+(\w+)/i);if(!s)return{success:!1,error:"Invalid DROP KEYSPACE query",latency:Date.now()-e};const n=s[1].trim();if(!this.keyspaces.has(n))return{success:!1,error:`Keyspace ${n} does not exist`,latency:Date.now()-e};const i=[];for(const[o,r]of this.tables.entries())r.keyspace===n&&i.push(o);for(const o of i)this.tables.delete(o),this.tableData.delete(o);return this.keyspaces.delete(n),this.updateMetrics(),{success:!0,latency:Date.now()-e,rowCount:0}}getNodes(){return Array.from(this.nodes.values())}getKeyspaces(){return Array.from(this.keyspaces.values())}getTables(){return Array.from(this.tables.values())}getMetrics(){return this.updateMetrics(),{...this.metrics}}calculateReadLatency(t){const s=this.getRequiredReplicas(t,"system"),n=Math.log(s+1)*3,i=Math.random()*2;return Math.round(2+n+i)}calculateWriteLatency(t,e){const i=this.getRequiredReplicas(t,e)*2,o=Math.random()*3;return Math.round(5+i+o)}getRequiredReplicas(t,e){const n=this.keyspaces.get(e)?.replication||this.defaultReplicationFactor;switch(t){case"ONE":case"LOCAL_ONE":return 1;case"TWO":return 2;case"THREE":return 3;case"QUORUM":case"LOCAL_QUORUM":return Math.floor(n/2)+1;case"ALL":case"EACH_QUORUM":return n;case"SERIAL":case"LOCAL_SERIAL":return Math.floor(n/2)+1;default:return Math.floor(n/2)+1}}checkConsistencyViolation(t,e){const s=this.metrics.healthyNodes,n=this.getRequiredReplicas(t,e),i=s<n?.8:.05;return Math.random()<i}recordReadOperation(t,e){const s=Date.now();this.readOperations.push({timestamp:s,latency:t,violated:e}),this.readOperations.length>1e3&&this.readOperations.shift(),e&&this.metrics.readConsistencyViolations++}recordWriteOperation(t,e){const s=Date.now();this.writeOperations.push({timestamp:s,latency:t,violated:e}),this.writeOperations.length>1e3&&this.writeOperations.shift(),e&&this.metrics.writeConsistencyViolations++}updateMetrics(){const t=Date.now();(t-this.lastMetricsUpdate)/1e3,this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(d=>d.status==="up").length,this.metrics.totalKeyspaces=this.keyspaces.size,this.metrics.totalTables=this.tables.size;let e=0,s=0;for(const[d,h]of this.tableData.entries())e+=h.length,s+=h.length*1024;this.metrics.totalRows=e,this.metrics.totalSize=s;const n=t-1e3,i=this.readOperations.filter(d=>d.timestamp>n),o=this.writeOperations.filter(d=>d.timestamp>n);if(this.metrics.readOperationsPerSecond=i.length,this.metrics.writeOperationsPerSecond=o.length,i.length>0){const d=i.reduce((h,p)=>h+p.latency,0)/i.length;this.metrics.readLatency=Math.round(d*10)/10}if(o.length>0){const d=o.reduce((h,p)=>h+p.latency,0)/o.length;this.metrics.writeLatency=Math.round(d*10)/10}this.metrics.pendingCompactions=Math.floor(this.metrics.totalSize/(10*1024*1024));const r=this.metrics.totalNodes-this.metrics.healthyNodes;this.metrics.hintedHandoffs=r>0?r*5:0;const u=this.metrics.readOperationsPerSecond+this.metrics.writeOperationsPerSecond;for(const d of this.nodes.values())if(d.status==="up"){const h=Math.min(.95,.3+u/100*.3);d.load=d.load*.9+h*.1,d.load+=(Math.random()-.5)*.05,d.load=Math.max(.1,Math.min(.95,d.load))}this.lastMetricsUpdate=t}countTablesInKeyspace(t){let e=0;for(const s of this.tables.values())s.keyspace===t&&e++;return e}normalizeTableKey(t){return t.includes(".")?t:`system.${t}`}parseValueList(t){const e=[];let s="",n=!1,i="";for(let o=0;o<t.length;o++){const r=t[o];if((r==='"'||r==="'")&&!n){n=!0,i=r;continue}else if(r===i&&n){n=!1,i="";continue}r===","&&!n?(e.push(this.parseValue(s.trim())),s=""):s+=r}return s.trim()&&e.push(this.parseValue(s.trim())),e}parseValue(t){return t=t.trim(),t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):t.toUpperCase()==="TRUE"?!0:t.toUpperCase()==="FALSE"?!1:t.toUpperCase()==="NULL"?null:t}}class nk{cluster="archiphoenix-cluster";replication=!1;tables=new Map;tableData=new Map;tableParts=new Map;maxMemoryUsage=10*1024*1024*1024;compression="LZ4";metrics={queryThroughput:0,avgQueryTime:45,queriesPerSecond:0,readRowsPerSecond:0,writtenRowsPerSecond:0,totalRows:0,totalSize:0,compressionRatio:5,activeQueries:0,memoryUsage:0,memoryUsagePercent:0,partsCount:0,pendingMerges:0,totalTables:0,clusterNodes:1,healthyNodes:1};queryOperations=[];lastMetricsUpdate=Date.now();activeQueriesSet=new Set;initialize(t){if(this.cluster=t.cluster||"archiphoenix-cluster",this.replication=t.replication||!1,this.maxMemoryUsage=t.maxMemoryUsage||10*1024*1024*1024,this.compression=t.compression||"LZ4",this.tables.clear(),this.tableData.clear(),this.tableParts.clear(),t.tables)for(const e of t.tables){const s=`${e.database||"default"}.${e.name}`;this.tables.set(s,{...e}),this.tableData.set(s,[]),this.tableParts.set(s,[])}this.updateMetrics()}syncFromConfig(t){if(t.cluster&&(this.cluster=t.cluster),t.replication!==void 0&&(this.replication=t.replication),t.maxMemoryUsage&&(this.maxMemoryUsage=t.maxMemoryUsage),t.compression&&(this.compression=t.compression),t.tables)for(const e of t.tables){const s=`${e.database||"default"}.${e.name}`,n=this.tables.get(s),i=this.tableData.get(s)||[];n?this.tables.set(s,{...e,rows:n.rows||i.length||0,size:n.size||i.length*512||0}):(this.tables.set(s,{...e,rows:0,size:0}),this.tableData.has(s)||(this.tableData.set(s,[]),this.tableParts.set(s,[])))}this.updateMetrics()}executeQuery(t){const e=Date.now(),s=`query-${Date.now()}-${Math.random()}`;try{const n=t.trim().replace(/\s+/g," "),i=n.toUpperCase();this.activeQueriesSet.add(s),this.metrics.activeQueries=this.activeQueriesSet.size;let o;i.startsWith("SELECT")?o=this.executeSelect(n,e):i.startsWith("INSERT")?o=this.executeInsert(n,e):i.startsWith("ALTER")?o=this.executeAlter(n,e):i.startsWith("CREATE TABLE")?o=this.executeCreateTable(n,e):i.startsWith("DROP TABLE")?o=this.executeDropTable(n,e):o={success:!1,error:`Unsupported SQL statement: ${n}`,latency:Date.now()-e};const r=o.latency||Date.now()-e;return this.queryOperations.push({timestamp:Date.now(),latency:r,rowsRead:o.dataRead||0,rowsWritten:o.dataWritten||0}),this.activeQueriesSet.delete(s),this.metrics.activeQueries=this.activeQueriesSet.size,o}catch(n){return this.activeQueriesSet.delete(s),this.metrics.activeQueries=this.activeQueriesSet.size,{success:!1,error:n instanceof Error?n.message:"Unknown error",latency:Date.now()-e}}}executeSelect(t,e){const s=t.match(/FROM\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n),o=this.tables.get(i);if(!o)return{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e};const r=this.tableData.get(i)||[],u=t.match(/SELECT\s+(.+?)\s+FROM/i),d=u?u[1].trim().split(",").map(k=>k.trim()):["*"];let h=[...r];const p=t.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(p){const T=p[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(T){const A=T[1],D=T[2];h=r.filter(_=>String(_[A])===D)}}const g=t.match(/GROUP\s+BY\s+(\w+)/i);if(g){const k=g[1],T=new Map;h.forEach(A=>{const D=String(A[k]||"null");T.set(D,(T.get(D)||0)+1)}),h=Array.from(T.entries()).map(([A,D])=>({[k]:A,count:D}))}const v=t.match(/ORDER\s+BY\s+(\w+)(?:\s+(ASC|DESC))?/i);if(v){const k=v[1],T=(v[2]||"ASC").toUpperCase();h.sort((A,D)=>{const _=A[k],L=D[k];return T==="DESC"?_>L?-1:_<L?1:0:_<L?-1:_>L?1:0})}const b=t.match(/LIMIT\s+(\d+)/i),x=b?parseInt(b[1],10):void 0;x!==void 0&&x>0&&(h=h.slice(0,x));const R=this.calculateQueryLatency(t,o,h.length);let C=h;return!d.includes("*")&&d.length>0&&(C=h.map(k=>{const T={};return d.forEach(A=>{k.hasOwnProperty(A)&&(T[A]=k[A])}),T})),{success:!0,latency:R,rows:C,rowCount:C.length,columns:d.includes("*")?Object.keys(r[0]||{}):d,dataRead:r.length}}executeInsert(t,e){const s=t.match(/INTO\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);let o=this.tables.get(i);if(!o)return{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e};const r=t.match(/VALUES\s+(.+)/i);if(!r)return{success:!1,error:"Invalid INSERT query: missing VALUES clause",latency:Date.now()-e};const u=r[1].trim(),d=this.parseValues(u),h=this.tableData.get(i)||[],p={},g=t.match(/\(([^)]+)\)\s+VALUES/i),v=g?g[1].split(",").map(x=>x.trim()):[];v.length>0&&v.length===d.length?v.forEach((x,R)=>{p[x]=d[R]}):d.forEach((x,R)=>{p[`column_${R}`]=x}),h.push(p),this.tableData.set(i,h),o.rows=h.length,o.size=h.length*512,this.tables.set(i,o);const b=10+Math.random()*5;return this.simulatePartCreation(i),this.updateMetrics(),{success:!0,latency:b,rowCount:1,dataWritten:1}}executeCreateTable(t,e){const s=t.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);if(this.tables.has(i))return{success:!1,error:`Table ${n} already exists`,latency:Date.now()-e};const o=t.match(/ENGINE\s*=\s*(\w+)/i),r=o?o[1]:"MergeTree",[u,d]=i.split("."),h={name:d,database:u||"default",engine:r,rows:0,size:0,partitions:0};return this.tables.set(i,h),this.tableData.set(i,[]),this.tableParts.set(i,[]),this.updateMetrics(),{success:!0,latency:Date.now()-e}}executeDropTable(t,e){const s=t.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);return this.tables.has(i)?(this.tables.delete(i),this.tableData.delete(i),this.tableParts.delete(i),this.updateMetrics(),{success:!0,latency:Date.now()-e}):{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e}}executeAlter(t,e){const s=t.match(/ALTER\s+TABLE\s+([\w.]+)/i);if(!s)return{success:!1,error:"Invalid ALTER TABLE query",latency:Date.now()-e};const n=s[1].trim(),i=this.normalizeTableKey(n);return this.tables.get(i)?{success:!0,latency:Date.now()-e}:{success:!1,error:`Table ${n} does not exist`,latency:Date.now()-e}}calculateQueryLatency(t,e,s){const i=s/1e6*5;let o=1;const r=t.toUpperCase();r.includes("JOIN")&&(o*=2),r.includes("GROUP BY")&&(o*=1.5),r.includes("ORDER BY")&&(o*=1.3),r.includes("COUNT")&&(o*=.8),(r.includes("SUM")||r.includes("AVG"))&&(o*=.9);const u=this.tableParts.get(`${e.database}.${e.name}`)||[],d=Math.min(1.5,1+u.length/100);return 10+i*o*d}parseValues(t){let e=t.trim();e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,-1));const s=[];let n="",i=!1,o="";for(let r=0;r<e.length;r++){const u=e[r];(u==='"'||u==="'")&&!i?(i=!0,o=u):u===o&&i?(i=!1,o=""):u===","&&!i?(s.push(this.parseValue(n.trim())),n=""):n+=u}return n.trim()&&s.push(this.parseValue(n.trim())),s}parseValue(t){const e=t.trim();return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):/^-?\d+$/.test(e)?parseInt(e,10):/^-?\d*\.\d+$/.test(e)?parseFloat(e):e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e.toLowerCase()==="null"?null:e}normalizeTableKey(t){return t.includes(".")?t:`default.${t}`}simulatePartCreation(t){const e=this.tableParts.get(t)||[],s=new Date().toISOString().split("T")[0],n={name:`${s}_${e.length+1}`,minDate:s,maxDate:s,rows:1e3,size:512*1e3,level:0};if(e.push(n),this.tableParts.set(t,e),e.length>10){const i=e.splice(0,5),o={name:`merged_${Date.now()}`,minDate:i[0].minDate,maxDate:i[i.length-1].maxDate,rows:i.reduce((r,u)=>r+u.rows,0),size:i.reduce((r,u)=>r+u.size,0),level:Math.max(...i.map(r=>r.level))+1};e.unshift(o),this.tableParts.set(t,e)}}updateMetrics(){const t=Date.now(),e=(t-this.lastMetricsUpdate)/1e3;this.metrics.totalTables=this.tables.size;let s=0,n=0,i=0;for(const[d,h]of this.tables.entries()){s+=h.rows,n+=h.size;const p=this.tableParts.get(d)||[];i+=p.length}this.metrics.totalRows=s,this.metrics.totalSize=n,this.metrics.partsCount=i;const o=t-1e3,r=this.queryOperations.filter(d=>d.timestamp>o);if(this.metrics.queriesPerSecond=r.length,this.metrics.queryThroughput=r.length,r.length>0){const d=r.reduce((g,v)=>g+v.latency,0)/r.length;this.metrics.avgQueryTime=Math.round(d*10)/10;const h=r.reduce((g,v)=>g+v.rowsRead,0),p=r.reduce((g,v)=>g+v.rowsWritten,0);this.metrics.readRowsPerSecond=Math.round(h/e),this.metrics.writtenRowsPerSecond=Math.round(p/e)}const u=n/this.metrics.compressionRatio;this.metrics.memoryUsage=u,this.metrics.memoryUsagePercent=u/this.maxMemoryUsage*100,this.metrics.pendingMerges=Math.floor(i/10),this.metrics.clusterNodes=this.replication?3:1,this.metrics.healthyNodes=this.metrics.clusterNodes,this.lastMetricsUpdate=t}getMetrics(){return this.updateMetrics(),{...this.metrics}}insertData(t,e){const s=this.normalizeTableKey(t),n=this.tables.get(s);if(!n)return{success:!1,rowsInserted:0,error:`Table ${t} does not exist`};const i=this.tableData.get(s)||[];return i.push(...e),this.tableData.set(s,i),n.rows=i.length,n.size=i.length*512,this.tables.set(s,n),this.simulatePartCreation(s),this.updateMetrics(),{success:!0,rowsInserted:e.length}}}const da={"X-Small":{servers:1,creditsPerHour:1},Small:{servers:2,creditsPerHour:2},Medium:{servers:4,creditsPerHour:4},Large:{servers:8,creditsPerHour:8},"X-Large":{servers:16,creditsPerHour:16},"2X-Large":{servers:32,creditsPerHour:32},"3X-Large":{servers:64,creditsPerHour:64},"4X-Large":{servers:128,creditsPerHour:128}};class ik{account="archiphoenix";region="us-east-1";warehouses=new Map;databases=new Map;tables=new Map;tableData=new Map;queries=new Map;queryQueue=[];activeQueries=new Map;resultCache=new Map;cacheHits=0;cacheMisses=0;metrics={totalWarehouses:0,runningWarehouses:0,suspendedWarehouses:0,totalQueries:0,runningQueries:0,queuedQueries:0,queriesPerSecond:0,avgQueryTime:0,totalComputeTime:0,totalDataRead:0,totalDataWritten:0,cacheHitRate:0,warehouseUtilization:0,totalCost:0};queryOperations=[];lastMetricsUpdate=Date.now();warehouseLastUpdate=new Map;suspendTimers=new Map;initialize(t){if(this.account=t.account||"archiphoenix",this.region=t.region||"us-east-1",this.warehouses.clear(),t.warehouses&&t.warehouses.length>0)for(const e of t.warehouses)this.warehouses.set(e.name,{...e,status:e.status||"suspended",currentClusterCount:e.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});else this.warehouses.set("COMPUTE_WH",{name:"COMPUTE_WH",size:"Small",status:"suspended",autoSuspend:60,autoResume:!0,minClusterCount:1,maxClusterCount:1,currentClusterCount:1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});if(this.databases.clear(),this.tables.clear(),this.tableData.clear(),t.databases){for(const e of t.databases)if(this.databases.set(e.name,{...e}),e.schemas){for(const s of e.schemas)if(s.tables)for(const n of s.tables){const i=`${e.name}.${s.name}.${n.name}`;this.tables.set(i,{...n}),this.tableData.set(i,[])}}}this.databases.has("SNOWFLAKE")||this.databases.set("SNOWFLAKE",{name:"SNOWFLAKE",comment:"System database",retentionTime:1,size:0,schemas:[{name:"INFORMATION_SCHEMA",tables:[],views:0,functions:0}]}),this.updateMetrics()}syncFromConfig(t){if(t.account&&(this.account=t.account),t.region&&(this.region=t.region),t.warehouses){for(const s of t.warehouses){const n=this.warehouses.get(s.name);n?(this.warehouses.set(s.name,{...s,status:n.status,currentClusterCount:n.currentClusterCount,runningQueries:n.runningQueries,queuedQueries:n.queuedQueries,totalQueriesExecuted:n.totalQueriesExecuted,totalComputeTime:n.totalComputeTime,lastUsed:n.lastUsed}),this.updateWarehouseAutoSuspend(s.name,s)):this.warehouses.set(s.name,{...s,status:"suspended",currentClusterCount:s.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0})}const e=new Set(t.warehouses.map(s=>s.name));for(const[s]of this.warehouses.entries())if(!e.has(s)){this.warehouses.delete(s);const n=this.suspendTimers.get(s);n&&(clearTimeout(n),this.suspendTimers.delete(s))}}if(t.databases){for(const e of t.databases)if(this.databases.get(e.name),this.databases.set(e.name,{...e}),e.schemas){for(const s of e.schemas)if(s.tables)for(const n of s.tables){const i=`${e.name}.${s.name}.${n.name}`,o=this.tables.get(i),r=this.tableData.get(i)||[];o?this.tables.set(i,{...n,rows:o.rows||r.length||0,size:o.size||r.length*512||0}):(this.tables.set(i,{...n,rows:0,size:0}),this.tableData.set(i,[]))}}}this.updateMetrics()}executeQuery(t,e,s,n){const i=Date.now(),o=`query-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=this.getCacheKey(t,s,n),u=this.resultCache.get(r);if(u&&Date.now()-u.timestamp<u.ttl)return this.cacheHits++,this.updateMetrics(),{success:!0,latency:10,rows:u.data,rowCount:u.data.length,queryId:o,resultCacheUsed:!0};this.cacheMisses++;let d;if(e?d=this.warehouses.get(e):d=Array.from(this.warehouses.values()).find(p=>p.status==="running")||Array.from(this.warehouses.values())[0],!d)return{success:!1,error:"No warehouse available",latency:Date.now()-i,queryId:o};const h={id:o,queryText:t,status:"queued",warehouse:d.name,database:s,schema:n,startedAt:i};return this.queries.set(o,h),d.status==="suspended"&&d.autoResume&&this.resumeWarehouse(d.name),d.status==="running"?this.executeQueryOnWarehouse(h,d,i):(d.queuedQueries++,this.queryQueue.push(h),h.status="queued",d.autoResume&&this.resumeWarehouse(d.name),d.status==="running"&&this.processQueryQueue(d),{success:!0,latency:50,queryId:o,warehouse:d.name})}executeQueryOnWarehouse(t,e,s){t.status="running",t.startedAt=Date.now(),e.runningQueries++,this.activeQueries.set(t.id,t),1/(da[e.size]||da.Small).servers,this.estimateQueryComplexity(t.queryText);const i=this.executeSQL(t.queryText,t.database,t.schema),o=Date.now();if(t.completedAt=o,t.duration=o-(t.startedAt||s),t.status=i.success?"success":"failed",t.rowsReturned=i.rowCount,t.error=i.error,e.runningQueries--,e.totalQueriesExecuted++,e.totalComputeTime+=t.duration/1e3,e.lastUsed=o,this.activeQueries.delete(t.id),i.success&&i.rows){const r=this.getCacheKey(t.queryText,t.database,t.schema);this.resultCache.set(r,{data:i.rows,timestamp:o,ttl:3e5})}return this.queryOperations.push({timestamp:o,latency:t.duration,rowsRead:i.dataRead||0,rowsWritten:i.dataWritten||0}),e.autoSuspend&&e.runningQueries===0&&e.queuedQueries===0&&this.scheduleWarehouseSuspend(e.name,e.autoSuspend),this.updateMetrics(),{...i,queryId:t.id,warehouse:e.name,latency:t.duration}}executeSQL(t,e,s){const n=t.trim().replace(/\s+/g," "),i=n.toUpperCase();try{return i.startsWith("SELECT")?this.executeSelect(n,e,s):i.startsWith("INSERT")?this.executeInsert(n,e,s):i.startsWith("UPDATE")?this.executeUpdate(n,e,s):i.startsWith("DELETE")?this.executeDelete(n,e,s):i.startsWith("CREATE TABLE")?this.executeCreateTable(n,e,s):i.startsWith("DROP TABLE")?this.executeDropTable(n,e,s):{success:!1,error:`Unsupported SQL statement: ${n}`}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}executeSelect(t,e,s){const n=t.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s),r=this.tables.get(o);if(!r)return{success:!1,error:`Table ${i} does not exist`};const u=this.tableData.get(o)||[],d=t.match(/SELECT\s+(.+?)\s+FROM/i),h=d?d[1].trim().split(",").map(b=>b.trim()):["*"];let p=[...u];const g=t.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(g){const x=g[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(x){const R=x[1],C=x[2];p=u.filter(k=>String(k[R])===C)}}const v=t.match(/LIMIT\s+(\d+)/i);if(v){const b=parseInt(v[1],10);p=p.slice(0,b)}return{success:!0,rows:p,rowCount:p.length,columns:h.includes("*")?r.columns?.map(b=>b.name)||[]:h,dataRead:u.length}}executeInsert(t,e,s){const n=t.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s),r=this.tables.get(o);if(!r)return{success:!1,error:`Table ${i} does not exist`};const u=t.match(/VALUES\s*\((.+?)\)/i);if(!u)return{success:!1,error:"Invalid INSERT query: missing VALUES clause"};const d=u[1].split(",").map(v=>v.trim().replace(/^['"]|['"]$/g,"")),h=r.columns||[];if(d.length!==h.length)return{success:!1,error:`Column count mismatch: expected ${h.length}, got ${d.length}`};const p={};h.forEach((v,b)=>{p[v.name]=d[b]});const g=this.tableData.get(o)||[];return g.push(p),this.tableData.set(o,g),r.rows=g.length,r.size=g.length*512,{success:!0,rowCount:1,dataWritten:1}}executeUpdate(t,e,s){return{success:!0,rowCount:0,dataWritten:0}}executeDelete(t,e,s){return{success:!0,rowCount:0,dataWritten:0}}executeCreateTable(t,e,s){const n=t.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s);if(this.tables.has(o))return{success:!1,error:`Table ${i} already exists`};const r=t.match(/\((.+?)\)/),u=[];if(r){const v=r[1].split(",").map(b=>b.trim());for(const b of v){const x=b.split(/\s+/);x.length>=2&&u.push({name:x[0],type:x[1],nullable:!b.toUpperCase().includes("NOT NULL")})}}const[d,h,p]=this.parseTableName(i,e,s),g={name:p,schema:h,database:d,columns:u,rows:0,size:0,created:Date.now()};return this.tables.set(o,g),this.tableData.set(o,[]),{success:!0,rowCount:0}}executeDropTable(t,e,s){const n=t.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query"};const i=n[1].trim(),o=this.normalizeTableKey(i,e,s);return this.tables.has(o)?(this.tables.delete(o),this.tableData.delete(o),{success:!0,rowCount:0}):{success:!1,error:`Table ${i} does not exist`}}resumeWarehouse(t){const e=this.warehouses.get(t);if(!e)return!1;if(e.status==="running")return!0;const s=this.suspendTimers.get(t);return s&&(clearTimeout(s),this.suspendTimers.delete(t)),e.status="running",e.currentClusterCount=e.minClusterCount,this.processQueryQueue(e),this.updateMetrics(),!0}suspendWarehouse(t){const e=this.warehouses.get(t);return e?e.status==="suspended"?!0:e.runningQueries>0?!1:(e.status="suspended",e.currentClusterCount=0,this.updateMetrics(),!0):!1}scheduleWarehouseSuspend(t,e){const s=this.suspendTimers.get(t);s&&clearTimeout(s);const n=setTimeout(()=>{const i=this.warehouses.get(t);i&&i.runningQueries===0&&i.queuedQueries===0&&this.suspendWarehouse(t),this.suspendTimers.delete(t)},e*1e3);this.suspendTimers.set(t,n)}updateWarehouseAutoSuspend(t,e){const s=this.warehouses.get(t);if(s){if(e.autoSuspend!==void 0||e.autoResume!==void 0){const n=this.suspendTimers.get(t);n&&(clearTimeout(n),this.suspendTimers.delete(t))}s.status==="running"&&s.autoSuspend&&s.runningQueries===0&&s.queuedQueries===0&&this.scheduleWarehouseSuspend(t,s.autoSuspend)}}processQueryQueue(t){if(t.status!=="running")return;const e=this.queryQueue.filter(s=>s.warehouse===t.name&&s.status==="queued");for(const s of e)t.runningQueries<this.getMaxConcurrentQueries(t)&&(t.queuedQueries--,this.queryQueue=this.queryQueue.filter(n=>n.id!==s.id),this.executeQueryOnWarehouse(s,t,s.startedAt||Date.now()))}getMaxConcurrentQueries(t){return(da[t.size]||da.Small).servers*t.currentClusterCount*8}estimateQueryComplexity(t){let e=1;const s=(t.match(/\bJOIN\b/gi)||[]).length;e+=s*.5,t.match(/\bGROUP\s+BY\b/i)&&(e+=.3),t.match(/\bORDER\s+BY\b/i)&&(e+=.2);const n=(t.match(/\b(COUNT|SUM|AVG|MAX|MIN)\s*\(/gi)||[]).length;return e+=n*.2,Math.max(1,e)}normalizeTableKey(t,e,s){const n=t.split(".");return n.length===3?n.join("."):n.length===2?`${e||"PUBLIC"}.${n.join(".")}`:`${e||"PUBLIC"}.${s||"PUBLIC"}.${n[0]}`}parseTableName(t,e,s){const n=t.split(".");return n.length===3?[n[0],n[1],n[2]]:n.length===2?[e||"PUBLIC",n[0],n[1]]:[e||"PUBLIC",s||"PUBLIC",n[0]]}getCacheKey(t,e,s){return`${t}|${e||""}|${s||""}`}updateMetrics(){const t=Date.now(),e=(t-this.lastMetricsUpdate)/1e3;if(this.metrics.totalWarehouses=this.warehouses.size,this.metrics.runningWarehouses=Array.from(this.warehouses.values()).filter(r=>r.status==="running").length,this.metrics.suspendedWarehouses=Array.from(this.warehouses.values()).filter(r=>r.status==="suspended").length,this.metrics.totalQueries=this.queries.size,this.metrics.runningQueries=Array.from(this.warehouses.values()).reduce((r,u)=>r+u.runningQueries,0),this.metrics.queuedQueries=Array.from(this.warehouses.values()).reduce((r,u)=>r+u.queuedQueries,0),e>0){const r=this.queryOperations.filter(u=>u.timestamp>t-1e3);this.metrics.queriesPerSecond=r.length}if(this.queryOperations.length>0){const r=this.queryOperations.slice(-100),u=r.reduce((d,h)=>d+h.latency,0)/r.length;this.metrics.avgQueryTime=u}this.metrics.totalComputeTime=Array.from(this.warehouses.values()).reduce((r,u)=>r+u.totalComputeTime,0);const s=this.queryOperations.slice(-1e3);this.metrics.totalDataRead=s.reduce((r,u)=>r+u.rowsRead,0),this.metrics.totalDataWritten=s.reduce((r,u)=>r+u.rowsWritten,0);const n=this.cacheHits+this.cacheMisses;this.metrics.cacheHitRate=n>0?this.cacheHits/n:0;let i=0;for(const r of this.warehouses.values())if(r.status==="running"){const u=this.getMaxConcurrentQueries(r),d=u>0?r.runningQueries/u:0;i+=d}this.metrics.warehouseUtilization=this.metrics.runningWarehouses>0?i/this.metrics.runningWarehouses:0;let o=0;for(const r of this.warehouses.values())if(r.status==="running"&&r.totalComputeTime>0){const u=da[r.size]||da.Small,d=r.totalComputeTime/3600;o+=u.creditsPerHour*d*r.currentClusterCount}this.metrics.totalCost=o,this.lastMetricsUpdate=t}getMetrics(){return this.updateMetrics(),{...this.metrics}}getWarehouse(t){return this.warehouses.get(t)}getWarehouses(){return Array.from(this.warehouses.values())}getQuery(t){return this.queries.get(t)}getRecentQueries(t=100){return Array.from(this.queries.values()).sort((e,s)=>(s.startedAt||0)-(e.startedAt||0)).slice(0,t)}getTables(t,e){return!t&&!e?Array.from(this.tables.values()):Array.from(this.tables.values()).filter(s=>!(t&&s.database!==t||e&&s.schema!==e))}}class ok{clusterName="archiphoenix-cluster";nodes=new Map;indices=new Map;shards=new Map;documents=new Map;defaultShards=5;defaultReplicas=1;refreshInterval="1s";metrics={clusterHealth:"green",totalNodes:0,healthyNodes:0,totalIndices:0,totalDocs:0,totalSize:0,activeShards:0,relocatingShards:0,initializingShards:0,unassignedShards:0,indexOperationsPerSecond:0,searchOperationsPerSecond:0,averageIndexLatency:5,averageSearchLatency:10,averageGetLatency:2};indexOperations=[];searchOperations=[];getOperations=[];lastMetricsUpdate=Date.now();recentQueries=[];initialize(t){if(this.clusterName=t.clusterName||"archiphoenix-cluster",this.defaultShards=t.defaultShards||5,this.defaultReplicas=t.defaultReplicas||1,this.refreshInterval=t.refreshInterval||"1s",this.nodes.clear(),t.nodes&&t.nodes.length>0)for(const e of t.nodes)this.nodes.set(e,{address:e,status:"up",load:.3+Math.random()*.4,shards:0});else this.nodes.set("localhost:9200",{address:"localhost:9200",status:"up",load:.5,shards:0});if(this.indices.clear(),this.shards.clear(),this.documents.clear(),t.indices&&t.indices.length>0)for(const e of t.indices)this.createIndex(e.name,e.shards||this.defaultShards,e.replicas||this.defaultReplicas,e);else this.createIndex("archiphoenix-index",this.defaultShards,this.defaultReplicas);this.updateMetrics()}syncFromConfig(t){if(t.clusterName&&(this.clusterName=t.clusterName),t.defaultShards!==void 0&&(this.defaultShards=t.defaultShards),t.defaultReplicas!==void 0&&(this.defaultReplicas=t.defaultReplicas),t.refreshInterval&&(this.refreshInterval=t.refreshInterval),t.nodes){new Set(this.nodes.keys());for(const e of t.nodes)this.nodes.has(e)||this.nodes.set(e,{address:e,status:"up",load:.3+Math.random()*.4,shards:0})}if(t.indices){new Set(this.indices.keys());for(const e of t.indices)if(!this.indices.has(e.name))this.createIndex(e.name,e.shards||this.defaultShards,e.replicas||this.defaultReplicas,e);else{const s=this.indices.get(e.name),n=this.getTotalDocsForIndex(e.name),i=this.getTotalSizeForIndex(e.name);this.indices.set(e.name,{...e,docs:s.docs||n,size:s.size||i,health:this.calculateIndexHealth(e.name)})}}this.updateMetrics()}createIndex(t,e=5,s=1,n){const i={name:t,docs:n?.docs||0,size:n?.size||0,shards:e,replicas:s,health:"yellow",mappings:n?.mappings,settings:n?.settings};this.indices.set(t,i);const o=[],r=Array.from(this.nodes.keys());for(let u=0;u<e;u++){const d=r[u%r.length];o.push({index:t,shard:u,primary:!0,node:d,state:"STARTED",docs:0,size:0});for(let h=0;h<s;h++){const p=r[(u+h+1)%r.length];o.push({index:t,shard:u,primary:!1,node:p,state:"STARTED",docs:0,size:0})}}if(this.shards.set(t,o),!this.documents.has(t)){const u=new Map;for(let d=0;d<e;d++)u.set(d,[]);this.documents.set(t,u)}i.health=this.calculateIndexHealth(t),this.updateMetrics()}routeToShard(t,e){const s=this.indices.get(t);if(!s)return 0;let n=0;for(let i=0;i<e.length;i++){const o=e.charCodeAt(i);n=(n<<5)-n+o,n=n&n}return Math.abs(n)%s.shards}indexDocument(t,e,s,n){const i=Date.now(),o=this.indices.get(t);if(!o)return{operation:"index",index:t,id:e,document:s,routing:n,latency:Date.now()-i,success:!1,error:`Index ${t} does not exist`};const r=n||e,u=this.routeToShard(t,r),d={_id:e,_index:t,_source:s,_routing:n},h=this.documents.get(t),p=h.get(u)||[],g=p.findIndex(x=>x._id===e);g>=0?p[g]=d:p.push(d),h.set(u,p),this.documents.set(t,h),o.docs=this.getTotalDocsForIndex(t),o.size=this.getTotalSizeForIndex(t),o.health=this.calculateIndexHealth(t);const v=this.shards.get(t);for(const x of v)x.index===t&&x.shard===u&&x.primary&&(x.docs=p.length,x.size=p.length*1024);const b=this.calculateIndexLatency();return this.recordIndexOperation(b),this.updateMetrics(),{operation:"index",index:t,id:e,document:s,routing:n,latency:b,success:!0,took:b}}getDocument(t,e,s){const n=Date.now();if(!this.indices.get(t))return{operation:"get",index:t,id:e,routing:s,latency:Date.now()-n,success:!1,error:`Index ${t} does not exist`};const o=s||e,r=this.routeToShard(t,o),h=(this.documents.get(t).get(r)||[]).find(g=>g._id===e),p=this.calculateGetLatency();return this.recordGetOperation(p),this.updateMetrics(),h?{operation:"get",index:t,id:e,document:h._source,routing:s,latency:p,success:!0,took:p}:{operation:"get",index:t,id:e,routing:s,latency:p,success:!1,error:`Document ${e} not found`,took:p}}search(t,e){const s=Date.now(),n=this.indices.get(t);if(!n)return{operation:"search",index:t,query:e,latency:Date.now()-s,success:!1,error:`Index ${t} does not exist`};const i=this.documents.get(t);let o=[];for(let p=0;p<n.shards;p++){const g=i.get(p)||[];o=o.concat(g)}let r=o;if(e&&e.query){if(e.query.match_all)r=o;else if(e.query.match){const p=Object.keys(e.query.match)[0],g=e.query.match[p];g&&typeof g=="string"&&(r=o.filter(v=>{const b=v._source[p];return b&&String(b).toLowerCase().includes(g.toLowerCase())}))}}const u=e?.size||10;r=r.slice(0,u);const d=this.calculateSearchLatency(n.shards,r.length);this.recordSearchOperation(d,r.length),this.updateMetrics();const h={operation:"search",index:t,query:e,latency:d,success:!0,hits:r.length,took:d};return this.recentQueries.unshift(h),this.recentQueries.length>100&&(this.recentQueries=this.recentQueries.slice(0,100)),h}deleteDocument(t,e,s){const n=Date.now(),i=this.indices.get(t);if(!i)return{operation:"delete",index:t,id:e,routing:s,latency:Date.now()-n,success:!1,error:`Index ${t} does not exist`};const o=s||e,r=this.routeToShard(t,o),u=this.documents.get(t),d=u.get(r)||[],h=d.length,p=d.filter(b=>b._id!==e);u.set(r,p),this.documents.set(t,u),i.docs=this.getTotalDocsForIndex(t),i.size=this.getTotalSizeForIndex(t),i.health=this.calculateIndexHealth(t);const g=this.shards.get(t);for(const b of g)b.index===t&&b.shard===r&&b.primary&&(b.docs=p.length,b.size=p.length*1024);const v=this.calculateIndexLatency();return this.updateMetrics(),p.length===h?{operation:"delete",index:t,id:e,routing:s,latency:v,success:!1,error:`Document ${e} not found`,took:v}:{operation:"delete",index:t,id:e,routing:s,latency:v,success:!0,took:v}}executeQuery(t){const e=Date.now();try{let s;try{s=JSON.parse(t)}catch{const n=t.split(`
`);if(n.length>=2){const i=n[0].match(/^(GET|POST|PUT|DELETE)\s+(.+)/);if(i){const o=i[1],r=i[2].trim();if(o==="GET"&&r.includes("/_search")){s=n.length>1?JSON.parse(n.slice(1).join(`
`)):{query:{match_all:{}}};const u=r.match(/^\/([^\/]+)\/_search/),d=u?u[1]:"_all";return this.search(d,s)}else if(o==="GET"&&r.match(/\/[^\/]+\/_doc\/[^\/]+/)){const u=r.match(/\/([^\/]+)\/_doc\/([^\/]+)/);if(u)return this.getDocument(u[1],u[2])}}}return{operation:"search",query:t,latency:Date.now()-e,success:!1,error:"Invalid query format"}}return s.query||s.match_all?this.search("_all",s):{operation:"search",query:t,latency:Date.now()-e,success:!1,error:"Unsupported query format"}}catch(s){return{operation:"search",query:t,latency:Date.now()-e,success:!1,error:s instanceof Error?s.message:"Unknown error"}}}getMetrics(){return this.updateMetrics(),{...this.metrics}}getIndices(){return Array.from(this.indices.values())}getShards(t){return this.shards.get(t)||[]}getRecentQueries(t=10){return this.recentQueries.slice(0,t)}calculateIndexHealth(t){const e=this.shards.get(t)||[],s=e.filter(o=>o.state==="UNASSIGNED").length,n=e.filter(o=>o.state==="INITIALIZING").length,i=e.filter(o=>o.state==="RELOCATING").length;return s>0?"red":n>0||i>0?"yellow":"green"}calculateClusterHealth(){let t=!1,e=!1;for(const i of this.indices.values())i.health==="red"?t=!0:i.health==="yellow"&&(e=!0);const s=Array.from(this.nodes.values()).filter(i=>i.status==="up").length,n=this.nodes.size;return s===0||t?"red":s<n||e?"yellow":"green"}getTotalDocsForIndex(t){const e=this.documents.get(t);if(!e)return 0;let s=0;for(const n of e.values())s+=n.length;return s}getTotalSizeForIndex(t){const e=this.documents.get(t);if(!e)return 0;let s=0;for(const n of e.values())s+=n.length*1024;return s}calculateIndexLatency(){const e=this.metrics.totalDocs;return 5+Math.min(20,e/1e4)+Math.random()*5}calculateSearchLatency(t,e){const n=t*2,i=Math.min(50,e/100);return 10+n+i+Math.random()*10}calculateGetLatency(){return 2+Math.random()*3}recordIndexOperation(t){this.indexOperations.push({timestamp:Date.now(),latency:t}),this.indexOperations.length>500&&(this.indexOperations=this.indexOperations.slice(-500))}recordSearchOperation(t,e){this.searchOperations.push({timestamp:Date.now(),latency:t,hits:e}),this.searchOperations.length>500&&(this.searchOperations=this.searchOperations.slice(-500))}recordGetOperation(t){this.getOperations.push({timestamp:Date.now(),latency:t}),this.getOperations.length>500&&(this.getOperations=this.getOperations.slice(-500))}updateMetrics(){const t=Date.now(),e=1e3,s=this.indexOperations.filter(h=>t-h.timestamp<e),n=this.searchOperations.filter(h=>t-h.timestamp<e),i=this.getOperations.filter(h=>t-h.timestamp<e);this.metrics.indexOperationsPerSecond=s.length,this.metrics.searchOperationsPerSecond=n.length,s.length>0&&(this.metrics.averageIndexLatency=s.reduce((h,p)=>h+p.latency,0)/s.length),n.length>0&&(this.metrics.averageSearchLatency=n.reduce((h,p)=>h+p.latency,0)/n.length),i.length>0&&(this.metrics.averageGetLatency=i.reduce((h,p)=>h+p.latency,0)/i.length),this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(h=>h.status==="up").length,this.metrics.totalIndices=this.indices.size,this.metrics.totalDocs=Array.from(this.indices.values()).reduce((h,p)=>h+p.docs,0),this.metrics.totalSize=Array.from(this.indices.values()).reduce((h,p)=>h+p.size,0);let o=0,r=0,u=0,d=0;for(const h of this.shards.values())for(const p of h)if(p.primary)switch(p.state){case"STARTED":o++;break;case"RELOCATING":r++;break;case"INITIALIZING":u++;break;case"UNASSIGNED":d++;break}this.metrics.activeShards=o,this.metrics.relocatingShards=r,this.metrics.initializingShards=u,this.metrics.unassignedShards=d,this.metrics.clusterHealth=this.calculateClusterHealth();for(const h of this.indices.values())h.health=this.calculateIndexHealth(h.name);this.lastMetricsUpdate=t}}class ak{buckets=new Map;objects=new Map;versions=new Map;operations=[];metrics=new Map;lifecycleTransitions=new Map;initialize(t){if(this.buckets.clear(),this.objects.clear(),this.versions.clear(),this.operations=[],this.metrics.clear(),this.lifecycleTransitions.clear(),t.buckets)for(const e of t.buckets)this.buckets.set(e.name,{...e}),this.objects.set(e.name,new Map),e.versioning&&this.versions.set(e.name,new Map),this.metrics.set(e.name,{bucket:e.name,objectCount:0,totalSize:0,versionsCount:0,putCount:0,getCount:0,deleteCount:0,listCount:0,errorCount:0,averageLatency:0}),this.lifecycleTransitions.set(e.name,new Map)}putObject(t,e,s,n,i,o){const r=Date.now(),u=this.buckets.get(t);if(!u)return{success:!1,etag:"",latency:Date.now()-r,error:`Bucket '${t}' does not exist`};const d=this.generateETag(e,n),h=u.versioning?`${Date.now()}-${Math.random().toString(36).substr(2,9)}`:void 0,p={key:e,bucket:t,size:n,lastModified:Date.now(),storageClass:"STANDARD",etag:d,contentType:o||"application/octet-stream",metadata:i||{},versionId:h,encryption:u.encryption},g=this.objects.get(t);if(u.versioning&&h){const C=this.versions.get(t),k=C.get(e)||[];k.push({versionId:h,object:p,isDeleteMarker:!1}),C.set(e,k),this.versions.set(t,C);const T=this.metrics.get(t);T.versionsCount=this.getTotalVersionsCount(t)}g.set(e,p),this.objects.set(t,g);const v=this.findMatchingLifecycleRule(u,e);if(v&&v.transitions&&v.transitions.length>0){const C=this.lifecycleTransitions.get(t),k=v.transitions[0],T=Date.now()+k.days*24*60*60*1e3;C.set(e,{currentClass:"STANDARD",transitionScheduled:T,targetClass:k.storageClass,ruleId:v.id,transitionIndex:0,allTransitions:v.transitions}),this.lifecycleTransitions.set(t,C)}else if(u.lifecycleEnabled&&u.lifecycleDays){const C=this.lifecycleTransitions.get(t),k=Date.now()+u.lifecycleDays*24*60*60*1e3;C.set(e,{currentClass:"STANDARD",transitionScheduled:k,targetClass:u.glacierEnabled?"GLACIER":"STANDARD_IA"}),this.lifecycleTransitions.set(t,C)}const b=this.metrics.get(t),x=g.get(e);x?b.totalSize-=x.size:b.objectCount++,b.totalSize+=n,b.putCount++;const R=this.calculatePutLatency(n);return this.recordOperation("PUT",t,e,!0,R),this.updateMetrics(t,R,!0),{success:!0,versionId:h,etag:d,latency:R}}getObject(t,e,s){const n=Date.now(),i=this.buckets.get(t);if(!i)return{success:!1,latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t);if(i.versioning&&s){const p=(this.versions.get(t).get(e)||[]).find(v=>v.versionId===s);if(!p||p.isDeleteMarker){const v=this.calculateGetLatency(0);return this.recordOperation("GET",t,e,!1,v),this.updateMetrics(t,v,!1),{success:!1,latency:v,error:p?.isDeleteMarker?"Object version is a delete marker":`Object version '${s}' not found`}}if(p.object.storageClass==="GLACIER"||p.object.storageClass==="DEEP_ARCHIVE"){const v=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",t,e,!1,v),this.updateMetrics(t,v,!1),{success:!1,latency:v,error:`Object is archived in ${p.object.storageClass}. Restore operation required.`}}const g=this.calculateGetLatency(p.object.size);return this.recordOperation("GET",t,e,!0,g),this.updateMetrics(t,g,!0),{success:!0,object:p.object,latency:g}}const r=o.get(e);if(!r){const d=this.calculateGetLatency(0);return this.recordOperation("GET",t,e,!1,d),this.updateMetrics(t,d,!1),{success:!1,latency:d,error:`Object '${e}' not found`}}if(r.storageClass==="GLACIER"||r.storageClass==="DEEP_ARCHIVE"){const d=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",t,e,!1,d),this.updateMetrics(t,d,!1),{success:!1,latency:d,error:`Object is archived in ${r.storageClass}. Restore operation required.`}}const u=this.calculateGetLatency(r.size);return this.recordOperation("GET",t,e,!0,u),this.updateMetrics(t,u,!0),{success:!0,object:r,latency:u}}deleteObject(t,e,s){const n=Date.now(),i=this.buckets.get(t);if(!i)return{success:!1,latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t),r=o.get(e);if(!r){const p=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!1,p),this.updateMetrics(t,p,!1),{success:!1,latency:p,error:`Object '${e}' not found`}}if(i.versioning){const p=this.versions.get(t),g=p.get(e)||[],v=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;g.push({versionId:v,object:{...r},isDeleteMarker:!0}),p.set(e,g),this.versions.set(t,p),o.delete(e),this.objects.set(t,o);const b=this.metrics.get(t);b.versionsCount=this.getTotalVersionsCount(t),b.deleteCount++;const x=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!0,x),this.updateMetrics(t,x,!0),{success:!0,deleteMarker:!0,latency:x}}const u=r.size;o.delete(e),this.objects.set(t,o);const d=this.metrics.get(t);d.objectCount--,d.totalSize-=u,d.deleteCount++;const h=this.calculateDeleteLatency();return this.recordOperation("DELETE",t,e,!0,h),this.updateMetrics(t,h,!0),{success:!0,latency:h}}listObjects(t,e,s){const n=Date.now();if(!this.buckets.get(t))return{success:!1,objects:[],latency:Date.now()-n,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t);let r=Array.from(o.values());e&&(r=r.filter(h=>h.key.startsWith(e))),r.sort((h,p)=>h.key.localeCompare(p.key)),s&&(r=r.slice(0,s));const u=this.calculateListLatency(r.length);this.recordOperation("LIST",t,void 0,!0,u);const d=this.metrics.get(t);return d.listCount++,this.updateMetrics(t,u,!0),{success:!0,objects:r,latency:u}}headObject(t,e){const s=Date.now();if(!this.buckets.get(t))return{success:!1,latency:Date.now()-s,error:`Bucket '${t}' does not exist`};const o=this.objects.get(t).get(e);if(!o){const u=this.calculateHeadLatency();return this.recordOperation("HEAD",t,e,!1,u),this.updateMetrics(t,u,!1),{success:!1,latency:u,error:`Object '${e}' not found`}}const r=this.calculateHeadLatency();return this.recordOperation("HEAD",t,e,!0,r),this.updateMetrics(t,r,!0),{success:!0,object:o,latency:r}}processLifecycleTransitions(t=Date.now()){for(const[e,s]of this.lifecycleTransitions.entries()){const n=this.buckets.get(e);if(!(n&&(n.lifecycleEnabled||n.lifecycleRules&&n.lifecycleRules.some(r=>r.status==="Enabled"))))continue;const o=this.objects.get(e);for(const[r,u]of s.entries())if(t>=u.transitionScheduled){const d=o.get(r);if(d&&d.storageClass===u.currentClass)if(d.storageClass=u.targetClass,o.set(r,d),this.objects.set(e,o),u.ruleId&&u.allTransitions&&u.transitionIndex!==void 0){const h=u.transitionIndex+1;if(h<u.allTransitions.length){const p=u.allTransitions[h],g=t+p.days*24*60*60*1e3;s.set(r,{currentClass:u.targetClass,transitionScheduled:g,targetClass:p.storageClass,ruleId:u.ruleId,transitionIndex:h,allTransitions:u.allTransitions})}else{const p=this.findLifecycleRuleById(n,u.ruleId);if(p?.expiration?.days){const g=t+p.expiration.days*24*60*60*1e3;s.set(r,{currentClass:u.targetClass,transitionScheduled:g,targetClass:u.targetClass,ruleId:u.ruleId,expiration:!0})}else s.delete(r)}}else if(n.glacierEnabled&&n.glacierDays&&u.targetClass==="STANDARD_IA"){const h=t+n.glacierDays*24*60*60*1e3;s.set(r,{currentClass:"STANDARD_IA",transitionScheduled:h,targetClass:"GLACIER"})}else s.delete(r);else d||s.delete(r)}this.lifecycleTransitions.set(e,s)}this.processExpirations(t)}processExpirations(t){for(const[e,s]of this.lifecycleTransitions.entries()){if(!this.buckets.get(e))continue;const i=this.objects.get(e),o=[];for(const[r,u]of s.entries())u.expiration&&t>=u.transitionScheduled&&i.has(r)&&o.push(r);for(const r of o){const u=i.get(r);if(u){const d=this.metrics.get(e);d&&(d.objectCount=Math.max(0,d.objectCount-1),d.totalSize=Math.max(0,d.totalSize-u.size))}i.delete(r),s.delete(r)}this.objects.set(e,i),this.lifecycleTransitions.set(e,s)}}findMatchingLifecycleRule(t,e){return!t.lifecycleRules||t.lifecycleRules.length===0?void 0:t.lifecycleRules.filter(n=>n.status==="Enabled").filter(n=>!n.prefix||e.startsWith(n.prefix)).sort((n,i)=>{const o=n.prefix||"";return(i.prefix||"").length-o.length})[0]}findLifecycleRuleById(t,e){if(t.lifecycleRules)return t.lifecycleRules.find(s=>s.id===e)}findLifecycleRuleById(t,e){if(t.lifecycleRules)return t.lifecycleRules.find(s=>s.id===e)}getBucketMetrics(t){return this.metrics.get(t)}getAllBucketMetrics(){return new Map(this.metrics)}getTotalStorageSize(){let t=0;for(const e of this.metrics.values())t+=e.totalSize;return t}getTotalObjectCount(){let t=0;for(const e of this.metrics.values())t+=e.objectCount;return t}generateETag(t,e){const s=`${t}_${e}_${Date.now()}`;let n=0;for(let i=0;i<s.length;i++){const o=s.charCodeAt(i);n=(n<<5)-n+o,n=n&n}return Math.abs(n).toString(16)}calculatePutLatency(t){const s=t/1024*.1,n=(Math.random()-.5)*10;return Math.max(10,50+s+n)}calculateGetLatency(t){const s=t/1024*.15,n=(Math.random()-.5)*10;return Math.max(10,30+s+n)}calculateDeleteLatency(){const e=(Math.random()-.5)*5;return Math.max(5,20+e)}calculateListLatency(t){const s=t*.01,n=(Math.random()-.5)*10;return Math.max(20,40+s+n)}calculateHeadLatency(){const e=(Math.random()-.5)*5;return Math.max(5,15+e)}calculateGlacierRestoreLatency(){return 5e3}recordOperation(t,e,s,n,i){this.operations.push({operation:t,bucket:e,key:s,success:n,latency:i,timestamp:Date.now()}),this.operations.length>1e3&&this.operations.shift()}updateMetrics(t,e,s){const n=this.metrics.get(t);if(!n)return;const i=n.putCount+n.getCount+n.deleteCount+n.listCount;i>0?n.averageLatency=(n.averageLatency*(i-1)+e)/i:n.averageLatency=e,s||n.errorCount++,n.lastOperation=Date.now()}getTotalVersionsCount(t){const e=this.versions.get(t);if(!e)return 0;let s=0;for(const n of e.values())s+=n.length;return s}}class rk{connections=new Map;config;connectionCounter=0;queryHistory=[];MAX_HISTORY=1e3;constructor(t){this.config={maxConnections:t.maxConnections||100,minConnections:t.minConnections||0,idleTimeout:t.idleTimeout||3e5,maxLifetime:t.maxLifetime||36e5,connectionTimeout:t.connectionTimeout||5e3}}acquireConnection(t){const e=Date.now();this.cleanupIdleConnections(e);for(const[s,n]of this.connections.entries())if(n.status==="idle")return n.status="active",n.lastActivity=e,n.currentQuery=t,n.queryCount++,s;return this.connections.size<this.config.maxConnections?this.createConnection(t,e):null}releaseConnection(t,e){const s=this.connections.get(t);s&&(s.status="idle",s.lastActivity=Date.now(),s.currentQuery=void 0,e!==void 0&&this.recordQuery(e))}terminateConnection(t){const e=this.connections.get(t);e&&(e.status="terminated",this.connections.delete(t))}createConnection(t,e){const s=`conn_${++this.connectionCounter}_${e}`,n={id:s,status:"active",createdAt:e,lastActivity:e,queryCount:1,currentQuery:t};return this.connections.set(s,n),s}cleanupIdleConnections(t){const e=[];for(const[s,n]of this.connections.entries())n.status==="idle"&&(t-n.lastActivity>this.config.idleTimeout||t-n.createdAt>this.config.maxLifetime)&&e.push(s);for(const s of e)this.connections.delete(s)}recordQuery(t){const e=Date.now();this.queryHistory.push({timestamp:e,duration:t}),this.queryHistory.length>this.MAX_HISTORY&&this.queryHistory.shift()}getMetrics(){const t=Date.now();let e=0,s=0,n=0;for(const g of this.connections.values())switch(g.status){case"active":e++;break;case"idle":s++;break;case"waiting":n++;break}const i=this.connections.size,o=i>0?e/this.config.maxConnections:0,r=this.queryHistory.filter(g=>t-g.timestamp<6e4),u=r.length>0?r.reduce((g,v)=>g+v.duration,0)/r.length:0,h=this.queryHistory.filter(g=>t-g.timestamp<1e3).length,p=i>=this.config.maxConnections?this.config.connectionTimeout/2:0;return{totalConnections:i,activeConnections:e,idleConnections:s,waitingConnections:n,utilization:o,averageQueryTime:u,queriesPerSecond:h,connectionWaitTime:p}}getConnection(t){return this.connections.get(t)}getAllConnections(){return Array.from(this.connections.values())}updateConfig(t){if(this.config={...this.config,...t},t.maxConnections!==void 0&&t.maxConnections<this.connections.size){const e=this.connections.size-t.maxConnections,s=Array.from(this.connections.entries()).filter(([n,i])=>i.status==="idle").slice(0,e);for(const[n]of s)this.terminateConnection(n)}}reset(){this.connections.clear(),this.connectionCounter=0,this.queryHistory=[]}}class ck{static exportMetrics(t,e){const s=[],n=this.buildLabels(t,e),i=e.timestamp||Date.now();if(s.push("# HELP component_throughput_total Component throughput in operations per second"),s.push("# TYPE component_throughput_total gauge"),s.push(`component_throughput_total{${n}} ${e.throughput||0} ${i}`),s.push("# HELP component_latency_ms Component latency in milliseconds"),s.push("# TYPE component_latency_ms gauge"),s.push(`component_latency_ms{${n}} ${e.latency||0} ${i}`),e.latencyP50!==void 0&&(s.push("# HELP component_latency_p50_ms Component 50th percentile latency in milliseconds"),s.push("# TYPE component_latency_p50_ms gauge"),s.push(`component_latency_p50_ms{${n}} ${e.latencyP50} ${i}`)),e.latencyP99!==void 0&&(s.push("# HELP component_latency_p99_ms Component 99th percentile latency in milliseconds"),s.push("# TYPE component_latency_p99_ms gauge"),s.push(`component_latency_p99_ms{${n}} ${e.latencyP99} ${i}`)),s.push("# HELP component_error_rate Component error rate (0-1)"),s.push("# TYPE component_error_rate gauge"),s.push(`component_error_rate{${n}} ${e.errorRate||0} ${i}`),s.push("# HELP component_utilization Component utilization (0-1)"),s.push("# TYPE component_utilization gauge"),s.push(`component_utilization{${n}} ${e.utilization||0} ${i}`),e.customMetrics)for(const[o,r]of Object.entries(e.customMetrics)){const u=this.sanitizeMetricName(o);s.push(`# HELP component_${u} Component custom metric: ${o}`),s.push(`# TYPE component_${u} gauge`),s.push(`component_${u}{${n}} ${r} ${i}`)}return s.join(`
`)+`
`}static buildLabels(t,e){const s=[];s.push(`component_id="${this.escapeLabelValue(t.id)}"`),s.push(`component_type="${this.escapeLabelValue(t.type)}"`),t.data.label&&s.push(`component_name="${this.escapeLabelValue(t.data.label)}"`);const n=t.data.config||{};return n.environment&&s.push(`environment="${this.escapeLabelValue(String(n.environment))}"`),n.namespace&&s.push(`namespace="${this.escapeLabelValue(String(n.namespace))}"`),s.join(",")}static escapeLabelValue(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}static sanitizeMetricName(t){return t.replace(/[^a-zA-Z0-9_:]/g,"_").replace(/^[^a-zA-Z]/,"_")}static exportAllMetrics(t,e){const s=[];for(const n of t){const i=e.get(n.id);i&&s.push(this.exportMetrics(n,i))}return s.join(`
`)}static exportEndpointMetrics(t,e){return e?this.exportMetrics(t,e):""}}class lk{config=null;targetStatuses=new Map;scrapedMetrics=new Map;lastScrapeTimes=new Map;prometheusMetrics={scrapeRequestsTotal:0,scrapeErrorsTotal:0,scrapeDurationTotal:0,targetsUp:0,targetsDown:0,samplesScraped:0};initializeConfig(t){const e=t.data.config||{},s=typeof e.scrapeInterval=="number"?`${e.scrapeInterval/1e3}s`:e.scrapeInterval||"15s",n=typeof e.evaluationInterval=="number"?`${e.evaluationInterval/1e3}s`:e.evaluationInterval||"15s";this.config={global:{scrape_interval:s,evaluation_interval:n,external_labels:{prometheus:"archiphoenix"}},scrape_configs:this.buildScrapeConfigs(e),alerting:e.enableAlertmanager?{alertmanagers:[{static_configs:[{targets:[e.alertmanagerUrl||"http://alertmanager:9093"].map(i=>{const o=i.match(/^https?:\/\/([^\/]+)/);return o?o[1]:i})}]}]}:void 0,remote_write:e.enableRemoteWrite&&e.remoteWrite?e.remoteWrite.map(i=>({url:i.url})):void 0},this.initializeTargetStatuses()}buildScrapeConfigs(t){if(t.scrape_configs&&Array.isArray(t.scrape_configs))return t.scrape_configs.map(n=>({job_name:n.job_name,scrape_interval:n.scrape_interval,scrape_timeout:n.scrape_timeout,metrics_path:n.metrics_path,static_configs:n.static_configs||[]}));const e=[],s=t.scrapeInterval||"15s";if(t.targets&&Array.isArray(t.targets)){const n=new Map;for(const i of t.targets){const o=i.job||"default";n.has(o)||n.set(o,[]),n.get(o).push(i)}for(const[i,o]of n.entries()){const r=o[0],u=r.scrapeInterval||r.interval||s,d=r.metricsPath||"/metrics",h=[];for(const p of o)if(Array.isArray(p.targets))h.push(...p.targets);else if(p.endpoint)try{const g=new URL(p.endpoint);h.push(`${g.hostname}${g.port?":"+g.port:""}`)}catch{const g=p.endpoint.match(/^https?:\/\/([^\/]+)/);h.push(g?g[1]:p.endpoint)}else typeof p=="string"&&h.push(p);e.push({job_name:i,scrape_interval:u,metrics_path:d,static_configs:[{targets:h,labels:r.labels||{}}]})}}return e}initializeTargetStatuses(){if(this.targetStatuses.clear(),!!this.config){for(const t of this.config.scrape_configs)if(t.static_configs)for(const e of t.static_configs)for(const s of e.targets){const n=t.metrics_path?`http://${s}${t.metrics_path}`:`http://${s}/metrics`,i=`${t.job_name}:${s}`;this.targetStatuses.set(i,{job:t.job_name,endpoint:n,lastScrape:0,lastSuccess:null,lastError:null,scrapeDuration:null,up:!1,labels:e.labels})}}}performScraping(t,e,s){if(this.config){this.parseDuration(this.config.global.scrape_interval||"15s"),this.prometheusMetrics.targetsUp=0,this.prometheusMetrics.targetsDown=0;for(const[n,i]of this.targetStatuses.entries()){const o=this.lastScrapeTimes.get(n)||0,r=this.getScrapeIntervalForTarget(i.job),u=this.parseDuration(r);t-o>=u&&(this.scrapeTarget(n,i,t,e,s),this.lastScrapeTimes.set(n,t)),i.up?this.prometheusMetrics.targetsUp++:this.prometheusMetrics.targetsDown++}}}scrapeTarget(t,e,s,n,i){const o=performance.now();this.prometheusMetrics.scrapeRequestsTotal++;try{const r=this.findNodeByEndpoint(e.endpoint,n);if(!r)throw new Error(`Target not found: ${e.endpoint}`);const u=i.get(r.id);if(!u)throw new Error(`Metrics not available for component: ${r.id}`);const d=ck.exportMetrics(r,u);e.lastScrape=s,e.lastSuccess=s,e.lastError=null,e.up=!0;const h=performance.now()-o;e.scrapeDuration=h,this.prometheusMetrics.scrapeDurationTotal+=h,this.prometheusMetrics.samplesScraped+=this.countSamples(d),this.scrapedMetrics.set(t,u)}catch(r){const u=performance.now()-o;e.lastScrape=s,e.lastSuccess=null,e.lastError=r instanceof Error?r.message:String(r),e.up=!1,e.scrapeDuration=u,this.prometheusMetrics.scrapeErrorsTotal++}}findNodeByEndpoint(t,e){try{const s=new URL(t),n=s.hostname,i=s.port?parseInt(s.port):null;for(const o of e){const r=o.data.config||{},u=r.port||r.metricsPort||r.metrics?.port;if(o.data.label?.toLowerCase().replace(/\s+/g,"-")===n||i&&u===i)return o}}catch{}return null}getScrapeIntervalForTarget(t){return this.config&&(this.config.scrape_configs.find(s=>s.job_name===t)?.scrape_interval||this.config.global.scrape_interval)||"15s"}parseDuration(t){if(typeof t=="number")return t;if(typeof t!="string")return 15e3;const e=t.match(/^(\d+)([smhd])$/);if(!e)return 15e3;const s=parseInt(e[1]);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;case"d":return s*24*60*60*1e3;default:return 15e3}}countSamples(t){return t.split(`
`).filter(e=>e.trim()&&!e.startsWith("#")).length}getTargetStatuses(){return Array.from(this.targetStatuses.values())}getPrometheusMetrics(){return{...this.prometheusMetrics}}calculateLoad(){const t=this.prometheusMetrics.scrapeRequestsTotal,e=this.prometheusMetrics.scrapeErrorsTotal,s=this.prometheusMetrics.scrapeDurationTotal,n=this.prometheusMetrics.samplesScraped,i=this.targetStatuses.size,o=this.parseDuration(this.config?.global.scrape_interval||"15s"),r=i>0?1e3/o*i:0,u=t>0?s/t:0,d=t>0?e/t:0,h=r*(n/t||0);return{scrapeRequestsPerSecond:r,averageScrapeDuration:u,errorRate:d,samplesPerSecond:h}}}class uk{config=null;lastRefreshTimes=new Map;lastAlertEvaluationTimes=new Map;grafanaMetrics={queriesPerSecond:0,dashboardRefreshesPerSecond:0,alertEvaluationsPerSecond:0,datasourceErrors:0,activeDashboards:0,activePanels:0,totalQueries:0,cachedQueries:0,queryLatency:0,renderingLatency:0};queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(t){const e=t.data.config||{};this.config=e,this.initializeRefreshTimes(),this.initializeAlertEvaluationTimes()}initializeRefreshTimes(){if(this.lastRefreshTimes.clear(),!this.config?.dashboards)return;const t=this.normalizeDashboards(this.config.dashboards);for(const e of t)this.lastRefreshTimes.set(e.id,0)}initializeAlertEvaluationTimes(){if(this.lastAlertEvaluationTimes.clear(),!(!this.config?.alerts||!this.config.enableAlerting))for(const t of this.config.alerts)this.lastAlertEvaluationTimes.set(t.id,0)}normalizeDashboards(t){return!t||!Array.isArray(t)?[]:t.map(e=>{if(e&&typeof e=="object"){if(typeof e.panels=="number")return{id:e.id||String(Date.now()),name:e.name||"Dashboard",panels:[],tags:Array.isArray(e.tags)?e.tags:[],refresh:e.refresh||"30s"};if(Array.isArray(e.panels))return{id:e.id||String(Date.now()),name:e.name||"Dashboard",panels:e.panels.map(s=>({id:s.id||`panel-${Date.now()}`,title:s.title||"Panel",type:s.type||"graph",datasource:s.datasource||"Prometheus",queries:Array.isArray(s.queries)?s.queries:[{refId:"A",expr:"up"}],gridPos:s.gridPos||{x:0,y:0,w:12,h:8}})),tags:Array.isArray(e.tags)?e.tags:[],variables:e.variables,refresh:e.refresh||"30s",timeRange:e.timeRange}}return e}).filter(e=>e&&typeof e=="object"&&e.id)}performUpdate(t,e=!0,s){this.config&&(this.updateDashboards(t,e,s),this.config.enableAlerting&&this.evaluateAlerts(t,e),this.updateMetrics())}updateDashboards(t,e,s){if(!this.config?.dashboards)return;const n=this.normalizeDashboards(this.config.dashboards);let i=0,o=0;for(const r of n){const u=this.parseDuration(r.refresh||"30s"),d=this.lastRefreshTimes.get(r.id)||0;if(t-d>=u){this.lastRefreshTimes.set(r.id,t);for(const h of r.panels){const p=h.datasource,g=p&&this.isLokiDatasource(p);for(const x of h.queries){i++;const R=this.simulateQueryExecution(x,e,g,s);o+=R,this.queryLatencyHistory.push(R),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift()}const v=this.simulatePanelRendering(h),b=this.grafanaMetrics.renderingLatency;this.grafanaMetrics.renderingLatency=b*.9+v*.1}}}this.grafanaMetrics.totalQueries+=i,i>0&&(this.grafanaMetrics.queryLatency=o/i)}isLokiDatasource(t){if(!this.config?.datasources)return!1;const s=(Array.isArray(this.config.datasources)?this.config.datasources:[]).find(n=>typeof n=="string"?n===t:n.name===t);return typeof s=="object"&&s.type?s.type==="loki":!1}evaluateAlerts(t,e){if(this.config?.alerts)for(const s of this.config.alerts){const n=this.parseDuration(s.for||"1m"),i=this.lastAlertEvaluationTimes.get(s.id)||0;t-i>=n&&(this.lastAlertEvaluationTimes.set(s.id,t),this.simulateQueryExecution({refId:"A",expr:s.condition.query},e),e||this.grafanaMetrics.datasourceErrors++)}}simulateQueryExecution(t,e,s=!1,n){if(s&&n)try{const u=Date.now()-36e5,d=Date.now(),h=n(t.expr,u,d,100);return h.success||this.grafanaMetrics.datasourceErrors++,h.latency}catch{return this.grafanaMetrics.datasourceErrors++,1e3}if(!e)return this.grafanaMetrics.datasourceErrors++,1e3;let i=50;const o=this.estimateQueryComplexity(t.expr);i+=o*10;const r=(Math.random()-.5)*20;return Math.max(10,i+r)}estimateQueryComplexity(t){if(!t)return 0;let e=1;t.includes("[")&&(e+=2);const s=["sum","avg","max","min","count","rate","irate","increase"];for(const i of s)t.toLowerCase().includes(i)&&(e+=1);const n=(t.match(/\|/g)||[]).length;return e+=n,e}simulatePanelRendering(t){const s={stat:5,gauge:10,piechart:15,bargraph:20,table:25,graph:30}[t.type]||20,n=Math.sqrt(t.queries.length);return s*n}updateMetrics(){if(!this.config)return;const t=this.normalizeDashboards(this.config.dashboards);this.grafanaMetrics.activeDashboards=t.length,this.grafanaMetrics.activePanels=t.reduce((n,i)=>n+i.panels.length,0);let e=0,s=0;for(const n of t){const o=1e3/this.parseDuration(n.refresh||"30s");s+=o;const r=n.panels.reduce((u,d)=>u+d.queries.length,0);e+=o*r}if(this.grafanaMetrics.queriesPerSecond=e,this.grafanaMetrics.dashboardRefreshesPerSecond=s,this.config.enableAlerting&&this.config.alerts){let n=0;for(const i of this.config.alerts){const r=1e3/this.parseDuration(i.for||"1m");n+=r}this.grafanaMetrics.alertEvaluationsPerSecond=n}else this.grafanaMetrics.alertEvaluationsPerSecond=0;if(this.queryLatencyHistory.length>0){const n=this.queryLatencyHistory.reduce((i,o)=>i+o,0)/this.queryLatencyHistory.length;this.grafanaMetrics.queryLatency=n}}parseDuration(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 3e4;const s=parseInt(e[1]);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;case"d":return s*24*60*60*1e3;default:return 3e4}}getGrafanaMetrics(){return{...this.grafanaMetrics}}calculateLoad(){const t=this.grafanaMetrics,e=.1,s=Math.min(.7,t.queriesPerSecond/100),n=Math.min(.1,t.alertEvaluationsPerSecond/10),i=Math.min(.1,t.activePanels/100),o=Math.min(.95,e+s+n+i),r=.2,u=Math.min(.4,t.activeDashboards/50),d=Math.min(.3,t.cachedQueries/1e3),h=Math.min(.95,r+u+d),p=t.totalQueries+t.alertEvaluationsPerSecond,g=p>0?t.datasourceErrors/p:0;return{queriesPerSecond:t.queriesPerSecond,dashboardRefreshesPerSecond:t.dashboardRefreshesPerSecond,alertEvaluationsPerSecond:t.alertEvaluationsPerSecond,averageQueryLatency:t.queryLatency,averageRenderingLatency:t.renderingLatency,errorRate:g,cpuUtilization:o,memoryUtilization:h}}getActiveDatasources(){return this.config?.datasources?this.config.datasources.length>0&&typeof this.config.datasources[0]=="string"?this.config.datasources.map(t=>({name:t,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:t===this.config.datasources[0]})):this.config.datasources.filter(t=>t&&typeof t=="object"&&t.name):[]}isPrometheusAvailable(t){return!(!t||!this.getActiveDatasources().find(n=>n.type==="prometheus"))}}class dk{config=null;streams=new Map;queryStatuses=new Map;lastIngestionTimes=new Map;lokiMetrics={ingestionRequestsTotal:0,ingestionErrorsTotal:0,ingestionLinesTotal:0,ingestionBytesTotal:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,activeStreams:0,totalStorageSize:0,retentionDeletions:0};ingestionLatencyHistory=[];queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||"http://loki:3100",retentionPeriod:e.retentionPeriod||"168h",maxStreams:e.maxStreams||1e4,maxLineSize:e.maxLineSize||256e3,enableCompression:e.enableCompression??!0,compressionType:e.compressionType||"gzip",enableAuth:e.enableAuth??!1,enableMultiTenancy:e.enableMultiTenancy??!1,tenants:e.tenants||[],ingestionRateLimit:e.ingestionRateLimit,queryRateLimit:e.queryRateLimit},this.initializeStreamsFromConfig(e),this.initializeQueriesFromConfig(e)}initializeStreamsFromConfig(t){if(t.streams&&Array.isArray(t.streams))for(const e of t.streams){const s=this.getStreamKey(e.labels||{}),n=[];if(e.entries&&Array.isArray(e.entries))for(const o of e.entries)n.push({timestamp:o.timestamp||Date.now().toString()+"000000",line:o.line||""});const i=e.size?e.size*1024*1024*1024:0;this.streams.set(s,{labels:e.labels||{},entries:n,size:i,lastEntryTime:Date.now()})}}initializeQueriesFromConfig(t){if(t.queries&&Array.isArray(t.queries))for(const e of t.queries){const s=e.id||`query-${Date.now()}-${Math.random()}`;this.queryStatuses.set(s,{id:s,query:e.query||"",lastExecution:0,lastSuccess:null,lastError:null,executionDuration:null,resultsCount:e.results||0,success:!0})}}processIngestion(t,e){if(!this.config)return{success:!1,error:"Loki not configured",ingestedLines:0,ingestedBytes:0};const s=performance.now();this.lokiMetrics.ingestionRequestsTotal++;try{if(this.config.ingestionRateLimit){const r=e||"default",u=this.lastIngestionTimes.get(r)||0,d=Date.now();d-u<1e3,this.lastIngestionTimes.set(r,d)}let n=0,i=0;for(const r of t){const u=this.getStreamKey(r.stream);if(!this.streams.has(u)&&this.streams.size>=(this.config.maxStreams||1e4)){this.lokiMetrics.ingestionErrorsTotal++;continue}let d=this.streams.get(u);d||(d={labels:r.stream,entries:[],size:0,lastEntryTime:Date.now()},this.streams.set(u,d));for(const[h,p]of r.values){const g=new Blob([p]).size;if(g>(this.config.maxLineSize||256e3)){this.lokiMetrics.ingestionErrorsTotal++;continue}d.entries.push({timestamp:h,line:p}),d.size+=g,d.lastEntryTime=Math.max(d.lastEntryTime,this.parseTimestamp(h)),n++,i+=g}if(this.config.enableCompression){const h=this.getCompressionRatio(this.config.compressionType||"gzip");d.size=Math.floor(d.size*h)}}this.lokiMetrics.ingestionLinesTotal+=n,this.lokiMetrics.ingestionBytesTotal+=i,this.lokiMetrics.totalStorageSize+=i,this.lokiMetrics.activeStreams=this.streams.size;const o=performance.now()-s;return this.ingestionLatencyHistory.push(o),this.ingestionLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.ingestionLatencyHistory.shift(),{success:!0,ingestedLines:n,ingestedBytes:i}}catch(n){return performance.now()-s,this.lokiMetrics.ingestionErrorsTotal++,{success:!1,error:n instanceof Error?n.message:String(n),ingestedLines:0,ingestedBytes:0}}}executeQuery(t,e,s,n){if(!this.config)return{success:!1,error:"Loki not configured",latency:0,resultsCount:0};const i=performance.now();this.lokiMetrics.queryRequestsTotal++;try{this.config.queryRateLimit;const o=this.parseLogQL(t),r=this.executeLogQLQuery(o,e,s,n),u=performance.now()-i;return this.lokiMetrics.queryDurationTotal+=u,this.queryLatencyHistory.push(u),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift(),{success:!0,result:r,latency:u,resultsCount:r.reduce((d,h)=>d+h.values.length,0)}}catch(o){const r=performance.now()-i;return this.lokiMetrics.queryErrorsTotal++,{success:!1,error:o instanceof Error?o.message:String(o),latency:r,resultsCount:0}}}parseLogQL(t){const e={},s=[],n=[],i=t.match(/^\{([^}]+)\}/);if(i){const v=i[1].matchAll(/(\w+)=["']([^"']+)["']/g);for(const b of v)e[b[1]]=b[2]}const o=t.match(/\|\s*=\s*["']([^"']+)["']/);o&&s.push({type:"contains",pattern:o[1]});const r=t.match(/!\s*=\s*["']([^"']+)["']/);r&&s.push({type:"not_contains",pattern:r[1]});const u=t.match(/\|\s*~\s*["']([^"']+)["']/);u&&s.push({type:"regex",pattern:u[1]});const d=t.matchAll(/\|\s*(\w+)\s*(=|=~|!=|!~)\s*["']([^"']+)["']/g);for(const g of d)n.push({label:g[1],operator:g[2],value:g[3]});let h;const p=t.match(/\|\s*(\w+)\(([^)]*)\)/);return p&&(h={function:p[1],params:p[2]?p[2].split(",").map(g=>g.trim()):[]}),{streamSelector:e,lineFilters:s,labelFilters:n,aggregation:h}}executeLogQLQuery(t,e,s,n){const i=[],o=Date.now(),r=e||o-36e5,u=s||o;for(const[d,h]of this.streams.entries()){let p=!0;for(const[b,x]of Object.entries(t.streamSelector))if(h.labels[b]!==x){p=!1;break}if(!p)continue;let v=h.entries.filter(b=>{const x=this.parseTimestamp(b.timestamp);return x>=r&&x<=u});for(const b of t.lineFilters)v=v.filter(x=>{switch(b.type){case"contains":return x.line.includes(b.pattern);case"not_contains":return!x.line.includes(b.pattern);case"regex":try{return new RegExp(b.pattern).test(x.line)}catch{return!1}}});for(const b of t.labelFilters){const x=h.labels[b.label];if(x===void 0){v=[];break}switch(b.operator){case"=":x!==b.value&&(v=[]);break;case"!=":x===b.value&&(v=[]);break;case"=~":try{new RegExp(b.value).test(x)||(v=[])}catch{v=[]}break;case"!~":try{new RegExp(b.value).test(x)&&(v=[])}catch{}break}}if(n&&v.length>n&&(v=v.slice(0,n)),t.aggregation){const b=this.applyAggregation(t.aggregation,v);i.push({stream:h.labels,values:[[Date.now().toString()+"000000",b.toString()]]})}else v.length>0&&i.push({stream:h.labels,values:v.map(b=>[b.timestamp,b.line])})}return i}applyAggregation(t,e){switch(t.function.toLowerCase()){case"rate":if(e.length<2)return 0;const s=this.parseTimestamp(e[0].timestamp),i=(this.parseTimestamp(e[e.length-1].timestamp)-s)/1e3;return i>0?e.length/i:0;case"count_over_time":return e.length;case"sum":return e.reduce((r,u)=>{const d=parseFloat(u.line);return r+(isNaN(d)?0:d)},0);case"avg":case"average":const o=e.map(r=>parseFloat(r.line)).filter(r=>!isNaN(r));return o.length>0?o.reduce((r,u)=>r+u,0)/o.length:0;default:return e.length}}performRetention(t){if(!this.config)return;const e=this.parseDuration(this.config.retentionPeriod||"168h"),s=t-e;let n=0,i=0;for(const[o,r]of this.streams.entries()){const u=r.entries.length;r.entries=r.entries.filter(d=>this.parseTimestamp(d.timestamp)>s),r.entries.length<u&&(n+=u-r.entries.length,r.size=r.entries.reduce((d,h)=>d+new Blob([h.line]).size,0),i+=r.size),r.entries.length===0&&this.streams.delete(o)}this.lokiMetrics.retentionDeletions+=n,this.lokiMetrics.totalStorageSize=Math.max(0,this.lokiMetrics.totalStorageSize-i),this.lokiMetrics.activeStreams=this.streams.size}getStreams(){return Array.from(this.streams.values())}getLokiMetrics(){return{...this.lokiMetrics}}calculateLoad(){const t=this.lokiMetrics.ingestionRequestsTotal,e=this.lokiMetrics.ingestionErrorsTotal,s=this.lokiMetrics.ingestionLinesTotal,n=this.lokiMetrics.ingestionBytesTotal,i=this.lokiMetrics.queryRequestsTotal,o=this.lokiMetrics.queryErrorsTotal,r=this.lokiMetrics.queryDurationTotal,u=this.ingestionLatencyHistory.length>0?this.ingestionLatencyHistory.reduce((C,k)=>C+k,0)/this.ingestionLatencyHistory.length:0,d=this.queryLatencyHistory.length>0?this.queryLatencyHistory.reduce((C,k)=>C+k,0)/this.queryLatencyHistory.length:i>0?r/i:0,h=t>0?e/t:0,p=i>0?o/i:0,g=s>0?s/100:0,v=n>0?n/100:0,b=i>0?i/100:0,x=(this.config?.maxStreams||1e4)*100*1024*1024,R=Math.min(1,this.lokiMetrics.totalStorageSize/x);return{ingestionLinesPerSecond:g,ingestionBytesPerSecond:v,averageIngestionLatency:u,ingestionErrorRate:h,queriesPerSecond:b,averageQueryLatency:d,queryErrorRate:p,storageUtilization:R,streamCount:this.streams.size}}getStreamKey(t){return Object.keys(t).sort().map(s=>`${s}=${t[s]}`).join(",")}parseTimestamp(t){const e=BigInt(t);return Number(e/BigInt(1e6))}parseDuration(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 10080*60*1e3;const s=parseInt(e[1]);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;case"d":return s*24*60*60*1e3;default:return 10080*60*1e3}}getCompressionRatio(t){switch(t){case"gzip":return .3;case"snappy":return .5;case"lz4":return .4;default:return .3}}}class hk{config=null;traces=new Map;serviceStats=new Map;jaegerMetrics={spansReceivedTotal:0,spansDroppedTotal:0,spansProcessedTotal:0,samplingDecisionsTotal:0,samplingErrorsTotal:0,tracesStoredTotal:0,tracesDroppedTotal:0,storageSizeBytes:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,spansSentTotal:0,spansFailedTotal:0};samplingState={};queryHistory=[];MAX_QUERY_HISTORY=100;lastCleanupTime=0;CLEANUP_INTERVAL=6e4;initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||"http://jaeger:16686",agentEndpoint:e.agentEndpoint||"http://jaeger-agent:6831",collectorEndpoint:e.collectorEndpoint||"http://jaeger-collector:14268",queryEndpoint:e.queryEndpoint||"http://jaeger-query:16686",samplingType:e.samplingType||"probabilistic",samplingParam:e.samplingParam??.001,storageBackend:e.storageBackend||"elasticsearch",storageUrl:e.storageUrl||"http://elasticsearch:9200",enableUIGraphQL:e.enableUIGraphQL??!0,enableMetrics:e.enableMetrics??!0,metricsBackend:e.metricsBackend||"prometheus",metricsUrl:e.metricsUrl||"http://prometheus:9090",maxTraces:e.maxTraces||1e4,traceTTL:e.traceTTL||864e5},this.initializeSampling()}initializeSampling(){if(!this.config)return;const{samplingType:t,samplingParam:e}=this.config;switch(t){case"probabilistic":this.samplingState.probabilistic={probability:Math.max(0,Math.min(1,e||.001))};break;case"ratelimiting":this.samplingState.rateLimiting={maxTracesPerSecond:Math.max(1,e||10),bucket:{tokens:e||10,lastRefill:Date.now()}};break;case"peroperation":this.samplingState.perOperation=new Map;break}}receiveSpan(t){if(!this.config)return{sample:!1};this.jaegerMetrics.spansReceivedTotal++;const e=this.makeSamplingDecision(t);return this.jaegerMetrics.samplingDecisionsTotal++,e.sample?(this.processSpan(t),e):(this.jaegerMetrics.spansDroppedTotal++,e)}receiveSpansFromDataFlow(t){for(const e of t)this.receiveSpan(e)}makeSamplingDecision(t){if(!this.config)return{sample:!1};const{samplingType:e}=this.config;try{switch(e){case"probabilistic":return this.probabilisticSampling(t);case"ratelimiting":return this.rateLimitingSampling(t);case"peroperation":return this.perOperationSampling(t);default:return{sample:!0}}}catch{return this.jaegerMetrics.samplingErrorsTotal++,{sample:!1}}}probabilisticSampling(t){const e=this.samplingState.probabilistic;if(!e)return{sample:!0};const s=Math.random()<e.probability;return{sample:s,tags:s?[{key:"sampler.type",value:"probabilistic"},{key:"sampler.param",value:e.probability.toString()}]:void 0}}rateLimitingSampling(t){const e=this.samplingState.rateLimiting;if(!e)return{sample:!0};const s=Date.now(),n=s-e.bucket.lastRefill,i=1e3/e.maxTracesPerSecond,o=Math.floor(n/i);return o>0&&(e.bucket.tokens=Math.min(e.maxTracesPerSecond,e.bucket.tokens+o),e.bucket.lastRefill=s),e.bucket.tokens>0?(e.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"ratelimiting"},{key:"sampler.param",value:e.maxTracesPerSecond.toString()}]}):{sample:!1}}perOperationSampling(t){this.samplingState.perOperation||(this.samplingState.perOperation=new Map);const e=`${t.serviceName}:${t.operationName}`;let s=this.samplingState.perOperation.get(e);if(!s){const u=this.config?.samplingParam||10;s={maxTracesPerSecond:u,bucket:{tokens:u,lastRefill:Date.now()}},this.samplingState.perOperation.set(e,s)}const n=Date.now(),i=n-s.bucket.lastRefill,o=1e3/s.maxTracesPerSecond,r=Math.floor(i/o);return r>0&&(s.bucket.tokens=Math.min(s.maxTracesPerSecond,s.bucket.tokens+r),s.bucket.lastRefill=n),s.bucket.tokens>0?(s.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"peroperation"},{key:"sampler.param",value:s.maxTracesPerSecond.toString()}]}):{sample:!1}}processSpan(t){this.jaegerMetrics.spansProcessedTotal++;let e=this.traces.get(t.traceId);e||(e={traceId:t.traceId,spans:[],startTime:t.startTime,duration:t.duration,serviceCount:0,spanCount:0,hasErrors:!1},this.traces.set(t.traceId,e),this.jaegerMetrics.tracesStoredTotal++),e.spans.push(t),e.spanCount=e.spans.length,t.startTime<e.startTime&&(e.startTime=t.startTime);const s=Math.max(...e.spans.map(i=>i.startTime+i.duration));e.duration=s-e.startTime,!t.parentSpanId&&!e.rootService&&(e.rootService=t.serviceName,e.rootOperation=t.operationName),(t.tags.some(i=>i.key==="error"&&i.value===!0)||t.logs.some(i=>i.fields.some(o=>o.key==="error")))&&(e.hasErrors=!0),this.updateServiceStats(t,e),this.config&&this.traces.size>this.config.maxTraces&&this.evictOldestTraces()}updateServiceStats(t,e){let s=this.serviceStats.get(t.serviceName);s||(s={name:t.serviceName,tracesTotal:0,errorsTotal:0,avgDuration:0,spansTotal:0,lastTraceTime:0},this.serviceStats.set(t.serviceName,s)),s.spansTotal++,s.lastTraceTime=Math.max(s.lastTraceTime,t.startTime/1e3);const n=s.avgDuration*(s.spansTotal-1)+t.duration;s.avgDuration=n/s.spansTotal,(e.spans.length===1||e.spans[0].serviceName===t.serviceName)&&(s.tracesTotal++,e.hasErrors&&s.errorsTotal++)}evictOldestTraces(){if(!this.config)return;const t=Date.now()*1e3,e=this.config.traceTTL*1e3,s=this.config.maxTraces,n=[];for(const[i,o]of this.traces.entries())t-o.startTime>e&&n.push(i);if(this.traces.size-n.length>s){const o=Array.from(this.traces.entries()).filter(([r])=>!n.includes(r)).sort(([,r],[,u])=>r.startTime-u.startTime).slice(0,this.traces.size-n.length-s);n.push(...o.map(([r])=>r))}for(const i of n){const o=this.traces.get(i);if(o){for(const u of o.spans){const d=this.serviceStats.get(u.serviceName);d&&(d.tracesTotal=Math.max(0,d.tracesTotal-1),o.hasErrors&&(d.errorsTotal=Math.max(0,d.errorsTotal-1)))}const r=this.calculateTraceSize(o);this.jaegerMetrics.storageSizeBytes=Math.max(0,this.jaegerMetrics.storageSizeBytes-r),this.jaegerMetrics.tracesDroppedTotal++,this.traces.delete(i)}}}performCleanup(t){t-this.lastCleanupTime<this.CLEANUP_INTERVAL||(this.lastCleanupTime=t,this.evictOldestTraces())}queryTraces(t){const e=performance.now();this.jaegerMetrics.queryRequestsTotal++;try{let s=Array.from(this.traces.values());if(t.service&&(s=s.filter(r=>r.spans.some(u=>u.serviceName===t.service))),t.operation&&(s=s.filter(r=>r.spans.some(u=>u.operationName===t.operation))),t.tags&&(s=s.filter(r=>r.spans.some(u=>Object.entries(t.tags).every(([d,h])=>u.tags.some(p=>p.key===d&&String(p.value)===String(h)))))),t.startTime){const r=t.startTime*1e3;s=s.filter(u=>u.startTime>=r)}if(t.endTime){const r=t.endTime*1e3;s=s.filter(u=>u.startTime+u.duration<=r)}s.sort((r,u)=>u.startTime-r.startTime);const n=t.limit||20,i=s.length;s=s.slice(0,n);const o=performance.now()-e;return this.jaegerMetrics.queryDurationTotal+=o,this.queryHistory.push({params:t,timestamp:Date.now(),duration:o,resultsCount:s.length}),this.queryHistory.length>this.MAX_QUERY_HISTORY&&this.queryHistory.shift(),{traces:s,total:i,limit:n}}catch(s){return this.jaegerMetrics.queryErrorsTotal++,{traces:[],total:0,limit:t.limit||20,errors:[s instanceof Error?s.message:String(s)]}}}getServiceStats(){return Array.from(this.serviceStats.values())}getRecentTraces(t=20){const e=Array.from(this.traces.values());return e.sort((s,n)=>n.startTime-s.startTime),e.slice(0,t)}getTraceById(t){return this.traces.get(t)}getJaegerMetrics(){return{...this.jaegerMetrics}}calculateTraceSize(t){let e=0;for(const s of t.spans)e+=100,e+=s.operationName.length,e+=s.serviceName.length,e+=s.tags.length*50,e+=s.logs.length*100;return e}calculateLoad(){const t=this.jaegerMetrics.spansReceivedTotal,e=this.jaegerMetrics.tracesStoredTotal,s=this.jaegerMetrics.spansDroppedTotal,n=this.jaegerMetrics.queryRequestsTotal,i=this.jaegerMetrics.queryDurationTotal,o=this.jaegerMetrics.queryErrorsTotal,r=t>0?1-s/t:0,u=n>0?i/n:0,d=n>0?o/n:0,h=this.config?.maxTraces||1e4,p=this.traces.size/h,g=t/60,v=e/60;return{spansPerSecond:g,tracesPerSecond:v,samplingRate:r,storageUtilization:p,queryLatency:u,errorRate:d}}getConfig(){return this.config?{...this.config}:null}}class fk{constructor(t,e,s,n){this.resolverId=t,this.executeResolverFn=e,this.nodes=s,this.connections=n}batchQueue=[];batchTimeout=null;BATCH_DELAY=10;cache=new Map;CACHE_TTL=1e3;totalBatches=0;totalRequests=0;totalBatchedRequests=0;totalDeduplicated=0;totalCacheHits=0;totalLatencyReduction=0;async load(t,e=!0){this.totalRequests++;const s=this.getCacheKey(t);if(e){const i=this.cache.get(s);if(i&&Date.now()-i.timestamp<this.CACHE_TTL)return this.totalCacheHits++,i.data}const n=this.batchQueue.find(i=>i.key===s);return n?(this.totalDeduplicated++,new Promise((i,o)=>{n.resolve=r=>{i(r),this.batchQueue.filter(d=>d.key===s&&d!==n).forEach(d=>d.resolve(r))},n.reject=o})):new Promise((i,o)=>{this.batchQueue.push({key:s,resolverId:this.resolverId,variables:t,resolve:r=>{e&&this.cache.set(s,{data:r,timestamp:Date.now()}),i(r)},reject:o}),this.batchTimeout||(this.batchTimeout=setTimeout(()=>{this.executeBatch()},this.BATCH_DELAY))})}async executeBatch(){if(this.batchQueue.length===0){this.batchTimeout=null;return}this.batchTimeout&&(clearTimeout(this.batchTimeout),this.batchTimeout=null);const t=new Map;for(const n of this.batchQueue)t.has(n.key)||t.set(n.key,n);const e=Array.from(t.values());if(this.batchQueue=[],e.length===0)return;this.totalBatches++,this.totalBatchedRequests+=e.length;const s=e.map(n=>n.variables);try{const n=Date.now(),i=await this.executeResolverFn(this.resolverId,s,this.nodes,this.connections),o=Date.now()-n,r=e.length>0?o/e.length:0,d=(r*1.5-r)*e.length;this.totalLatencyReduction+=Math.max(0,d);for(let h=0;h<e.length;h++){const p=e[h],g=i[h];g&&g.success?p.resolve(g.data):p.reject(new Error(g?.error||"Resolver execution failed"))}}catch(n){for(const i of e)i.reject(n instanceof Error?n:new Error(String(n)))}}getCacheKey(t){return`${this.resolverId}:${JSON.stringify(t)}`}getMetrics(){return{totalBatches:this.totalBatches,totalRequests:this.totalRequests,totalBatchedRequests:this.totalBatchedRequests,averageBatchSize:this.totalBatches>0?this.totalBatchedRequests/this.totalBatches:0,deduplicationRate:this.totalRequests>0?this.totalDeduplicated/this.totalRequests*100:0,cacheHitRate:this.totalRequests>0?this.totalCacheHits/this.totalRequests*100:0,averageLatencyReduction:this.totalBatches>0?this.totalLatencyReduction/this.totalBatches:0}}clearCache(){this.cache.clear()}clearQueue(){this.batchTimeout&&(clearTimeout(this.batchTimeout),this.batchTimeout=null),this.batchQueue.length>0&&this.executeBatch()}}class pk{config=null;graphQLMetrics={queriesPerSecond:0,mutationsPerSecond:0,subscriptionsActive:0,averageResponseTime:0,totalQueries:0,totalMutations:0,totalErrors:0,errorRate:0,cacheHitRate:0,averageComplexity:0,averageDepth:0};queryHistory=[];MAX_HISTORY_SIZE=1e3;queryCache=new Map;activeSubscriptions=new Map;latencyHistory=[];MAX_LATENCY_HISTORY=500;complexityHistory=[];depthHistory=[];lastSecondStart=Date.now();queriesThisSecond=0;mutationsThisSecond=0;resolverMetrics=new Map;componentId=null;traceContexts=new Map;traceIdCounter=0;spanIdCounter=0;activeSpans=new Map;dataLoaders=new Map;dataLoaderMetrics={totalBatches:0,totalRequests:0,totalBatchedRequests:0,averageBatchSize:0,deduplicationRate:0,cacheHitRate:0,averageLatencyReduction:0};nPlusOneProblems=[];MAX_N_PLUS_ONE_HISTORY=100;requestCache=new Map;subscriptionEvents=[];MAX_EVENTS_QUEUE=1e3;subscriptionMetrics={totalEvents:0,eventsPerSecond:0,averageDeliveryLatency:0,totalDeliveryErrors:0,deliveryErrorRate:0,lastEventTime:0};deliveryLatencyHistory=[];MAX_DELIVERY_LATENCY_HISTORY=500;eventsThisSecond=0;lastEventSecondStart=Date.now();MAX_SUBSCRIPTIONS=1e3;SUBSCRIPTION_TIMEOUT=3e5;persistedQueries=new Map;persistedQueriesUsage=0;batchQueryMetrics={totalBatches:0,totalBatchRequests:0,averageBatchSize:0,averageBatchLatency:0,totalBatchErrors:0,batchErrorRate:0};batchLatencyHistory=[];MAX_BATCH_LATENCY_HISTORY=500;introspectionMetrics={totalIntrospectionQueries:0,introspectionQueriesPerSecond:0};introspectionQueriesThisSecond=0;lastIntrospectionSecondStart=Date.now();schemaChanges=[];MAX_SCHEMA_CHANGES_HISTORY=100;schemaVersions=[];MAX_SCHEMA_VERSIONS=50;previousSchema=null;fieldMetrics=new Map;MAX_FIELD_METRICS_HISTORY=1e3;typeMetrics=new Map;operationMetrics=new Map;MAX_OPERATION_HISTORY=100;MAX_OPERATIONS=500;errorMetrics=new Map;MAX_ERROR_HISTORY=100;errorHistory=[];MAX_TOTAL_ERROR_HISTORY=500;fieldCallsThisSecond=new Map;typeOpsThisSecond=new Map;operationCallsThisSecond=new Map;errorCountsThisSecond=new Map;lastMetricsSecondStart=Date.now();rateLimitCounters=new Map;rateLimitMetrics={totalBlockedRequests:0,blockedRequestsPerSecond:0,totalRateLimitHits:0,rateLimitHitsPerSecond:0,blockedByType:{queries:0,mutations:0,subscriptions:0}};blockedRequestsThisSecond=0;rateLimitHitsThisSecond=0;lastRateLimitSecondStart=Date.now();timeoutMetrics={totalTimeouts:0,timeoutsPerSecond:0,queryTimeouts:0,mutationTimeouts:0,resolverTimeouts:0};timeoutsThisSecond=0;lastTimeoutSecondStart=Date.now();timeoutDurations=[];MAX_TIMEOUT_HISTORY=100;connectionPools=new Map;connectionPoolMetrics={totalConnections:0,activeConnections:0,idleConnections:0,maxConnections:0,connectionUtilization:0,totalConnectionAttempts:0,failedConnectionAttempts:0,connectionFailureRate:0,averageConnectionWaitTime:0};connectionWaitTimes=[];MAX_WAIT_TIME_HISTORY=100;connectionHealth=new Map;connectionHealthMetrics={healthyConnections:0,unhealthyConnections:0,totalHealthChecks:0,failedHealthChecks:0,healthCheckFailureRate:0,totalReconnects:0,successfulReconnects:0,failedReconnects:0,reconnectSuccessRate:0};healthCheckInterval=null;loadBalancingState=new Map;loadBalancingMetrics={totalRequests:0,averageLoadDistribution:0};initializeConfig(t){this.componentId=t.id;const e=t.data.config||{};if(this.config={endpoint:e.endpoint||"/graphql",schema:e.schema||this.getDefaultSchema(),queries:e.queries||[],subscriptions:e.subscriptions||[],resolvers:e.resolvers||[],subscriptionsEnabled:e.subscriptionsEnabled??!0,introspectionEnabled:e.introspectionEnabled??!0,enableQueryComplexityAnalysis:e.enableQueryComplexityAnalysis??!0,enableQueryDepthLimiting:e.enableQueryDepthLimiting??!0,maxQueryDepth:e.maxQueryDepth??15,maxQueryComplexity:e.maxQueryComplexity??1e3,enableCaching:e.enableCaching??!1,cacheTTL:e.cacheTTL??300,requestsPerSecond:e.requestsPerSecond||100,responseLatency:e.responseLatency||50,enableQueryBatching:e.enableQueryBatching??!0,enablePersistedQueries:e.enablePersistedQueries??!0,persistedQueries:e.persistedQueries||[],fieldComplexityWeights:e.fieldComplexityWeights||{},rateLimit:e.rateLimit||{enabled:!1,queriesPerSecond:100,mutationsPerSecond:50,subscriptionsPerSecond:10,globalPerSecond:200,windowMs:1e3,identifyBy:"ip"},timeout:e.timeout||{enabled:!1,queryTimeout:3e4,mutationTimeout:6e4,resolverTimeout:5e3,defaultTimeout:3e4},connectionPool:e.connectionPool||{enabled:!1,defaultPoolSize:10,maxIdleTime:3e5,healthCheckInterval:3e4,reconnectDelay:1e3,maxReconnectAttempts:3},loadBalancing:e.loadBalancing||{enabled:!1,strategy:"round-robin"}},this.config.connectionPool?.enabled&&this.config.resolvers)for(const s of this.config.resolvers)s.enabled!==!1&&this.initializeConnectionPool(s);if(this.config.loadBalancing?.enabled&&this.config.resolvers)for(const s of this.config.resolvers)s.instances&&s.instances.length>1&&this.initializeLoadBalancing(s);if(this.config.connectionPool?.enabled&&this.config.connectionPool.healthCheckInterval&&this.startHealthChecks(),this.config.persistedQueries)for(const s of this.config.persistedQueries)this.persistedQueries.set(s.hash,s);if(this.config.subscriptions)for(const s of this.config.subscriptions)s.active&&this.activeSubscriptions.set(s.id,s);if(this.config.resolvers)for(const s of this.config.resolvers)this.resolverMetrics.has(s.id)||this.resolverMetrics.set(s.id,{id:s.id,type:s.type,field:s.field,totalCalls:0,totalErrors:0,averageLatency:0,totalLatency:0,errorRate:0});this.graphQLMetrics.subscriptionsActive=this.activeSubscriptions.size,this.config.schema&&this.detectSchemaChanges(this.config.schema)}getDefaultSchema(){return{types:[],queries:[],mutations:[],subscriptions:[]}}computeQueryHash(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e).toString(16).padStart(64,"0").substring(0,64)}getPersistedQuery(t){return this.persistedQueries.get(t)}savePersistedQuery(t,e){const s=this.computeQueryHash(t),n=this.persistedQueries.get(s);if(n)return n.lastUsedAt=Date.now(),n.useCount++,n;const i={id:`pq-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,hash:s,query:t,operationName:e,addedAt:Date.now(),lastUsedAt:Date.now(),useCount:1};return this.persistedQueries.set(s,i),this.config&&(this.config.persistedQueries=Array.from(this.persistedQueries.values())),i}async processBatchQueries(t,e,s){if(!this.config?.enableQueryBatching)return t.map(d=>({success:!1,errors:[{message:"Query batching is disabled"}],latency:0}));const n=Date.now();this.batchQueryMetrics.totalBatches++,this.batchQueryMetrics.totalBatchRequests+=t.length;const i=await Promise.all(t.map(d=>this.processSingleBatchRequest(d,e,s))),o=Date.now()-n;this.batchLatencyHistory.push(o),this.batchLatencyHistory.length>this.MAX_BATCH_LATENCY_HISTORY&&this.batchLatencyHistory.shift();const r=this.batchLatencyHistory.reduce((d,h)=>d+h,0);this.batchQueryMetrics.averageBatchLatency=r/this.batchLatencyHistory.length,this.batchQueryMetrics.averageBatchSize=this.batchQueryMetrics.totalBatchRequests/this.batchQueryMetrics.totalBatches;const u=i.filter(d=>!d.success).length;return this.batchQueryMetrics.totalBatchErrors+=u,this.batchQueryMetrics.batchErrorRate=this.batchQueryMetrics.totalBatchErrors/this.batchQueryMetrics.totalBatchRequests,i}async processSingleBatchRequest(t,e,s){let n=t.query;if(!n&&t.extensions?.persistedQuery){const i=t.extensions.persistedQuery.sha256Hash,o=this.getPersistedQuery(i);if(o)n=o.query,o.lastUsedAt=Date.now(),o.useCount++,this.persistedQueriesUsage++;else return{success:!1,errors:[{message:`Persisted query not found: ${i}`}],latency:0}}return n?await this.processQuery({query:n,variables:t.variables,operationName:t.operationName},e,s):{success:!1,errors:[{message:"Query is required"}],latency:0}}async processQuery(t,e,s,n){const i=Date.now();let o=t.query;if(!o&&t.extensions?.persistedQuery&&this.config?.enablePersistedQueries){const D=t.extensions.persistedQuery.sha256Hash,_=this.getPersistedQuery(D);if(_)o=_.query,_.lastUsedAt=Date.now(),_.useCount++,this.persistedQueriesUsage++;else{const L=Date.now()-i,O=Date.now()/1e3,X=i/1e3,te=`Persisted query not found: ${D}`;return this.createQuerySpan("persisted_query","query",X,O,!1,void 0,void 0,te,void 0,n),{success:!1,errors:[{message:te}],latency:L}}}if(!o){const D=Date.now()-i,_=Date.now()/1e3,L=i/1e3,O="Query is required";return this.createQuerySpan("unknown","query",L,_,!1,void 0,void 0,O,void 0,n),{success:!1,errors:[{message:O}],latency:D}}const r=this.parseQuery(o),u=r.operationType||"query",d=r.fields,h=t.operationName||(d&&d.length>0?d[0].name:void 0),p=this.getClientIdentifier(t.headers,t.variables),g=this.checkRateLimit(u,p);if(!g.allowed){const D=Date.now()-i,_=`Rate limit exceeded. Limit: ${g.limit}/${g.resetAt-Date.now()}ms. Reset at: ${new Date(g.resetAt).toISOString()}`;this.recordQuery(!1,D,0,0,!1,h,u,d,_);const L=Date.now()/1e3,O=i/1e3;return this.createQuerySpan(h||"unknown",u,O,L,!1,void 0,void 0,_,void 0,n),{success:!1,errors:[{message:_}],latency:D}}if(this.config?.enableCaching){const D=this.getCacheKey({query:o,variables:t.variables}),_=this.queryCache.get(D);if(_&&Date.now()-_.timestamp<this.config.cacheTTL*1e3){const L=Date.now()-i;return this.recordQuery(!0,L,0,0,!0,h,u,d),{success:!0,data:_.data,latency:L,cached:!0}}}if(o.includes("__schema")||o.includes("__type")||o.includes("__typename")){const D=this.handleIntrospectionQuery(o),_=Date.now()-i;if(D.success){this.recordQuery(!0,_,0,0,!1,"__introspection","query",d);const L=Date.now()/1e3,O=i/1e3;return this.createQuerySpan("__introspection","query",O,L,!0,void 0,void 0,void 0,void 0,n),{success:!0,data:D.data,latency:_}}else{const L=D.error||"Introspection query failed";this.recordQuery(!1,_,0,0,!1,"__introspection","query",d,L);const O=Date.now()/1e3,X=i/1e3;return this.createQuerySpan("__introspection","query",X,O,!1,void 0,void 0,L,void 0,n),{success:!1,errors:[{message:L}],latency:_}}}if(!r.success){const D=Date.now()-i,_=r.error||"Invalid query";this.recordQuery(!1,D,0,0,!1,h,u,d,_);const L=Date.now()/1e3,O=i/1e3;return this.createQuerySpan(h||"unknown",u,O,L,!1,void 0,void 0,_,void 0,n),{success:!1,errors:[{message:_}],latency:D}}if(r.operationType&&r.fields){const D=this.validateQueryAgainstSchema(r.operation||"",r.operationType,r.fields,t.variables);if(!D.valid){const _=Date.now()-i,L=D.errors[0]?.message||"Validation failed";this.recordQuery(!1,_,0,0,!1,h,u,d,L);const O=Date.now()/1e3,X=i/1e3;return this.createQuerySpan(h||"unknown",u,X,O,!1,void 0,void 0,L,void 0,n),{success:!1,errors:D.errors.map(te=>({message:te.message,path:te.path})),latency:_}}}const v=this.calculateComplexity(r.operation||""),b=this.calculateDepth(r.operation||"");if(this.config?.enableQueryDepthLimiting&&b>(this.config.maxQueryDepth||15)){const D=Date.now()-i,_=`Query depth ${b} exceeds maximum ${this.config.maxQueryDepth}`;this.recordQuery(!1,D,v,b,!1,h,u,d,_);const L=Date.now()/1e3,O=i/1e3;return this.createQuerySpan(h||"unknown",u,O,L,!1,v,b,_,void 0,n),{success:!1,errors:[{message:_}],latency:D,complexity:v,depth:b}}if(this.config?.enableQueryComplexityAnalysis&&v>(this.config.maxQueryComplexity||1e3)){const D=Date.now()-i,_=`Query complexity ${v} exceeds maximum ${this.config.maxQueryComplexity}`;this.recordQuery(!1,D,v,b,!1,h,u,d,_);const L=Date.now()/1e3,O=i/1e3;return this.createQuerySpan(h||"unknown",u,O,L,!1,v,b,_,void 0,n),{success:!1,errors:[{message:_}],latency:D,complexity:v,depth:b}}let x;if(n&&n().size>0){const _=this.generateTraceId(),L=this.generateSpanId();x={traceId:_,spanId:L,sampled:!0},this.traceContexts.set(_,x)}const R=u==="subscription"?0:this.getTimeoutForOperation(u);let C;try{e&&s&&this.config?.resolvers&&this.config.resolvers.length>0?R>0?C=await this.executeWithTimeout(()=>this.executeQuery(r.operation||"",t.variables,e,s,x,n),R,u==="subscription"?"query":u,h):C=await this.executeQuery(r.operation||"",t.variables,e,s,x,n):R>0?C=await this.executeWithTimeout(()=>Promise.resolve(this.executeQuery(r.operation||"",t.variables,e,s,x,n)),R,u==="subscription"?"query":u,h):C=await Promise.resolve(this.executeQuery(r.operation||"",t.variables,e,s,x,n))}catch(D){const _=Date.now()-i,L=D.message||"Query execution failed";this.recordQuery(!1,_,0,0,!1,h,u,d,L);const O=Date.now()/1e3,X=i/1e3;return this.createQuerySpan(h||"unknown",u,X,O,!1,void 0,void 0,L,void 0,n),{success:!1,errors:[{message:L}],latency:_}}const k=Date.now()-i;if(this.config?.enableCaching&&C){const D=this.getCacheKey({query:o,variables:t.variables});this.queryCache.set(D,{data:C,timestamp:Date.now()})}this.config?.enablePersistedQueries&&o&&this.savePersistedQuery(o,t.operationName),this.recordQuery(!0,k,v,b,!1,h,u,d);const T=Date.now()/1e3,A=i/1e3;return this.createQuerySpan(h||"unknown",u,A,T,!0,v,b,void 0,x,n),{success:!0,data:C,latency:k,complexity:v,depth:b}}processMutation(t){const e=Date.now(),s=this.parseQuery(t.query),n=s.fields,i=t.operationName||(n&&n.length>0?n[0].name:void 0);if(!s.success){const u=Date.now()-e,d=s.error||"Invalid mutation";return this.recordMutation(!1,u,i,n,d),{success:!1,errors:[{message:d}],latency:u}}const o=this.executeMutation(s.operation||"",t.variables),r=Date.now()-e;return this.recordMutation(!0,r,i,n),{success:!0,data:o,latency:r}}createSubscription(t){if(!this.config?.subscriptionsEnabled)return{success:!1,error:"Subscriptions are disabled"};if(this.activeSubscriptions.size>=this.MAX_SUBSCRIPTIONS)return{success:!1,error:`Maximum subscriptions limit reached (${this.MAX_SUBSCRIPTIONS})`};const e=`sub-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,query:t.query,variables:t.variables,timestamp:Date.now(),active:!0,clientId:t.clientId,lastEventTime:Date.now(),eventCount:0,filter:t.filter};return this.activeSubscriptions.set(e,s),this.graphQLMetrics.subscriptionsActive=this.activeSubscriptions.size,{success:!0,subscriptionId:e}}cancelSubscription(t){return this.activeSubscriptions.delete(t)?(this.graphQLMetrics.subscriptionsActive=this.activeSubscriptions.size,!0):!1}generateSubscriptionEvent(t,e,s,n,i){if(!this.config?.subscriptionsEnabled)return;const o={id:`event-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,field:e,data:s,timestamp:Date.now(),sourceComponentId:n,metadata:i};this.subscriptionEvents.push(o),this.subscriptionEvents.length>this.MAX_EVENTS_QUEUE&&this.subscriptionEvents.shift(),this.recordSubscriptionEvent(),this.processSubscriptionEvent(o)}processSubscriptionEvent(t){const e=Date.now(),s=[];for(const i of this.activeSubscriptions.values())if(i.active){if(i.filter){const o=i.filter;if(o.field&&o.field!==t.field||o.type&&o.type.length>0&&!o.type.includes(t.type)||o.sourceComponentId&&o.sourceComponentId!==t.sourceComponentId)continue}s.push(i)}for(const i of s)this.deliverEventToSubscription(i,t);const n=Date.now()-e;this.recordDeliveryLatency(n)}deliverEventToSubscription(t,e){try{t.lastEventTime=Date.now(),t.eventCount=(t.eventCount||0)+1,t.clientId}catch{this.subscriptionMetrics.totalDeliveryErrors++,this.updateDeliveryErrorRate()}}processSubscriptions(t,e){if(!this.config?.subscriptionsEnabled)return;const s=Date.now();this.cleanupInactiveSubscriptions(s),t&&e&&this.generateEventsFromComponents(t,e),this.processEventQueue()}cleanupInactiveSubscriptions(t){const e=[];for(const[s,n]of this.activeSubscriptions.entries()){const i=n.lastEventTime||n.timestamp;t-i>this.SUBSCRIPTION_TIMEOUT&&e.push(s)}for(const s of e)this.activeSubscriptions.delete(s);e.length>0&&(this.graphQLMetrics.subscriptionsActive=this.activeSubscriptions.size)}generateEventsFromComponents(t,e){if(this.config?.resolvers)for(const s of this.config.resolvers){if(!s.enabled||!s.targetService)continue;const n=t.find(o=>o.id===s.targetService);!n||!e.find(o=>o.source===this.componentId&&o.target===s.targetService)||this.simulateComponentEvents(n,s)}}simulateComponentEvents(t,e){const s=Date.now(),n=`lastEvent_${t.id}_${e.id}`,i=this[n]||0,o=s-i;if(Math.random()<.01&&o>1e3){let d="update";if(t.type==="postgres"||t.type==="mongodb"||t.type==="redis"){const h=["create","update","delete"];d=h[Math.floor(Math.random()*h.length)]}this.generateSubscriptionEvent(d,e.field,this.getFallbackDataForField(e.field,{}),t.id,{componentType:t.type,resolverId:e.id}),this[n]=s}}processEventQueue(){const t=this.subscriptionEvents.filter(e=>!e.processed);for(const e of t)this.processSubscriptionEvent(e),e.processed=!0;this.subscriptionEvents=this.subscriptionEvents.filter(e=>!e.processed||Date.now()-e.timestamp<6e4)}recordSubscriptionEvent(){const t=Date.now();t-this.lastEventSecondStart>=1e3&&(this.subscriptionMetrics.eventsPerSecond=this.eventsThisSecond,this.eventsThisSecond=0,this.lastEventSecondStart=t),this.eventsThisSecond++,this.subscriptionMetrics.totalEvents++,this.subscriptionMetrics.lastEventTime=t}recordDeliveryLatency(t){this.deliveryLatencyHistory.push(t),this.deliveryLatencyHistory.length>this.MAX_DELIVERY_LATENCY_HISTORY&&this.deliveryLatencyHistory.shift();const e=this.deliveryLatencyHistory.reduce((s,n)=>s+n,0);this.subscriptionMetrics.averageDeliveryLatency=e/this.deliveryLatencyHistory.length}updateDeliveryErrorRate(){this.subscriptionMetrics.totalEvents>0&&(this.subscriptionMetrics.deliveryErrorRate=this.subscriptionMetrics.totalDeliveryErrors/this.subscriptionMetrics.totalEvents)}getSubscriptionMetrics(){return{...this.subscriptionMetrics}}parseQuery(t){if(!t||!t.trim())return{success:!1,error:"Empty query"};const e=t.trim();let s;if(e.startsWith("query"))s="query";else if(e.startsWith("mutation"))s="mutation";else if(e.startsWith("subscription"))s="subscription";else if(e.startsWith("{"))s="query";else return{success:!1,error:"Invalid query format"};const n=[],i=e.match(/(\w+)\s*(\([^)]*\))?\s*\{/g);if(i)for(const o of i){const r=o.match(/(\w+)/);if(r){const u=r[1];if(!["query","mutation","subscription"].includes(u.toLowerCase())){const d=o.match(/\(([^)]*)\)/),h={};if(d&&d[1]){const v=d[1].split(",").map(b=>b.trim());for(const b of v){const[x,R]=b.split(":").map(C=>C.trim());x&&R&&(h[x]=R.replace(/^["']|["']$/g,""))}}const p=[],g=e.match(new RegExp(`${u}\\s*[^{]*\\{([^}]+)\\}`,"s"));if(g&&g[1]){const v=g[1].match(/(\w+)/g);v&&p.push(...v)}n.push({name:u,args:Object.keys(h).length>0?h:void 0,nestedFields:p.length>0?p:void 0})}}}return{success:!0,operation:e,operationType:s,fields:n}}validateQueryAgainstSchema(t,e,s,n){const i=[];if(!this.config?.schema)return{valid:!0,errors:[]};const o=this.config.schema;let r;if(e==="query"&&o.queries?r=o.queries.find(u=>u.name==="Query"):e==="mutation"&&o.mutations?r=o.mutations.find(u=>u.name==="Mutation"):e==="subscription"&&o.subscriptions&&(r=o.subscriptions.find(u=>u.name==="Subscription")),!r)return i.push({message:`Root type for ${e} not found in schema`,type:e}),{valid:!1,errors:i};for(const u of s){const d=r.fields?.find(h=>h.name===u.name);if(!d){i.push({message:`Field "${u.name}" does not exist on type "${r.name}"`,field:u.name,type:r.name});continue}if(u.args&&d.args){for(const[h,p]of Object.entries(u.args))d.args.find(v=>v.name===h)||i.push({message:`Argument "${h}" does not exist on field "${u.name}"`,field:u.name,path:[u.name,h]});for(const h of d.args)h.type.endsWith("!")&&!u.args[h.name]&&h.defaultValue===void 0&&(u.args[`$${h.name}`]||n?.[h.name]||i.push({message:`Required argument "${h.name}" is missing on field "${u.name}"`,field:u.name,path:[u.name,h.name]}))}else if(d.args&&d.args.length>0)for(const h of d.args)h.type.endsWith("!")&&h.defaultValue===void 0&&(n?.[h.name]||i.push({message:`Required argument "${h.name}" is missing on field "${u.name}"`,field:u.name,path:[u.name,h.name]}));if(u.nestedFields&&d.type){const h=this.extractTypeName(d.type),p=this.findTypeInSchema(h,o);if(p&&p.kind==="OBJECT")for(const g of u.nestedFields)p.fields?.find(b=>b.name===g)||i.push({message:`Field "${g}" does not exist on type "${h}"`,field:g,type:h,path:[u.name,g]})}}return{valid:i.length===0,errors:i}}extractTypeName(t){let e=t.replace(/^\[|\]$/g,"").replace(/!$/,"");return e=e.replace(/^\[|\]$/g,"").replace(/!$/,""),e}findTypeInSchema(t,e){return e.types?.find(s=>s.name===t)}handleIntrospectionQuery(t){if(!this.config?.introspectionEnabled)return{success:!1,error:"Introspection is disabled"};const e=Date.now();return e-this.lastIntrospectionSecondStart>=1e3&&(this.introspectionMetrics.introspectionQueriesPerSecond=this.introspectionQueriesThisSecond,this.introspectionQueriesThisSecond=0,this.lastIntrospectionSecondStart=e),this.introspectionQueriesThisSecond++,this.introspectionMetrics.totalIntrospectionQueries++,this.introspectionMetrics.lastIntrospectionTime=e,t.includes("__schema")||t.includes("__type")?{success:!0,data:this.buildIntrospectionResponse()}:t.includes("__typename")?{success:!0,data:{__typename:"Query"}}:{success:!1,error:"Invalid introspection query"}}buildIntrospectionResponse(){if(!this.config?.schema)return{__schema:null};const t=this.config.schema,e=(t.types||[]).map(o=>({name:o.name,kind:o.kind,description:o.description,fields:o.fields?.map(r=>({name:r.name,description:r.description,type:{name:this.extractTypeName(r.type),kind:this.getTypeKind(r.type)},args:r.args?.map(u=>({name:u.name,type:{name:this.extractTypeName(u.type),kind:this.getTypeKind(u.type)},defaultValue:u.defaultValue}))||[]}))||[]})),s=t.queries?.find(o=>o.name==="Query"),n=t.mutations?.find(o=>o.name==="Mutation"),i=t.subscriptions?.find(o=>o.name==="Subscription");return{__schema:{queryType:s?{name:s.name,kind:s.kind,fields:s.fields?.map(o=>({name:o.name,type:{name:this.extractTypeName(o.type)}}))}:null,mutationType:n?{name:n.name,kind:n.kind}:null,subscriptionType:i?{name:i.name,kind:i.kind}:null,types:e}}}getTypeKind(t){const e=this.extractTypeName(t);return this.findTypeInSchema(e,this.config?.schema||{})?.kind||"SCALAR"}detectSchemaChanges(t){const e=[];if(!this.previousSchema)return this.previousSchema=JSON.parse(JSON.stringify(t)),e;const s=this.previousSchema,n=new Map((s.types||[]).map(r=>[r.name,r])),i=new Map((t.types||[]).map(r=>[r.name,r]));for(const[r,u]of i.entries())if(!n.has(r))e.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"type_added",typeName:r,breaking:!1,timestamp:Date.now()});else{const d=n.get(r),h=this.detectFieldChanges(d,u,r);e.push(...h)}for(const[r]of n.entries())i.has(r)||e.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"type_removed",typeName:r,breaking:!0,timestamp:Date.now()});return this.detectRootTypeChanges(s.queries||[],t.queries||[],"Query",e),this.detectRootTypeChanges(s.mutations||[],t.mutations||[],"Mutation",e),this.detectRootTypeChanges(s.subscriptions||[],t.subscriptions||[],"Subscription",e),this.previousSchema=JSON.parse(JSON.stringify(t)),this.schemaChanges.push(...e),this.schemaChanges.length>this.MAX_SCHEMA_CHANGES_HISTORY&&this.schemaChanges.shift(),(e.some(r=>r.breaking)||e.length>0)&&this.createSchemaVersion(t,e),e}detectFieldChanges(t,e,s){const n=[],i=new Map((t.fields||[]).map(r=>[r.name,r])),o=new Map((e.fields||[]).map(r=>[r.name,r]));for(const[r,u]of o.entries())if(!i.has(r))n.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"field_added",field:r,typeName:s,newValue:u,breaking:!1,timestamp:Date.now()});else{const d=i.get(r);d.type!==u.type&&n.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"field_type_changed",field:r,typeName:s,oldValue:d.type,newValue:u.type,breaking:!0,timestamp:Date.now()});const h=this.detectArgumentChanges(d,u,s,r);n.push(...h)}for(const[r,u]of i.entries())o.has(r)||n.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"field_removed",field:r,typeName:s,oldValue:u,breaking:!0,timestamp:Date.now()});return n}detectArgumentChanges(t,e,s,n){const i=[],o=new Map((t.args||[]).map(u=>[u.name,u])),r=new Map((e.args||[]).map(u=>[u.name,u]));for(const[u,d]of r.entries())if(!o.has(u))i.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"argument_added",field:n,typeName:s,newValue:d,breaking:d.type.endsWith("!")&&d.defaultValue===void 0,timestamp:Date.now()});else{const h=o.get(u);h.type!==d.type&&i.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"argument_type_changed",field:n,typeName:s,oldValue:h.type,newValue:d.type,breaking:!0,timestamp:Date.now()})}for(const[u,d]of o.entries())r.has(u)||i.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"argument_removed",field:n,typeName:s,oldValue:d,breaking:!0,timestamp:Date.now()});return i}detectRootTypeChanges(t,e,s,n){const i=t.find(r=>r.name===s),o=e.find(r=>r.name===s);if(!i&&o)n.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"type_added",typeName:s,breaking:!1,timestamp:Date.now()});else if(i&&o){const r=this.detectFieldChanges(i,o,s);n.push(...r)}else i&&!o&&n.push({id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,changeType:"type_removed",typeName:s,breaking:!0,timestamp:Date.now()})}createSchemaVersion(t,e){const s={version:`v${this.schemaVersions.length+1}.0.0`,schema:JSON.parse(JSON.stringify(t)),timestamp:Date.now(),changes:[...e]};this.schemaVersions.push(s),this.schemaVersions.length>this.MAX_SCHEMA_VERSIONS&&this.schemaVersions.shift()}calculateComplexity(t){let e=1;const s=t.match(/(\w+)\s*(\([^)]*\))?\s*\{/g);if(s)for(const u of s){const d=u.match(/(\w+)/);if(d){const h=d[1];if(["query","mutation","subscription"].includes(h.toLowerCase()))continue;const p=this.config?.fieldComplexityWeights?.[h]||1;e+=p,this.isListField(h)&&(e+=p*2)}}const n=this.calculateDepth(t);e+=n*3;const i=t.match(/\([^)]+\)/g);i&&(e+=i.length*1.5);const o=t.match(/fragment\s+\w+/gi);o&&(e+=o.length*2);const r=t.match(/\.\.\.\s*on\s+\w+/gi);return r&&(e+=r.length*1.5),Math.round(e)}isListField(t){if(!this.config?.schema)return!1;const e=this.config.schema.queries?.find(s=>s.name==="Query");if(e?.fields){const s=e.fields.find(n=>n.name===t);if(s)return s.type.startsWith("[")||s.type.includes("List")}return!1}calculateDepth(t){let e=0,s=0;for(const n of t)n==="{"?(s++,e=Math.max(e,s)):n==="}"&&s--;return e}getClientIdentifier(t,e){if(!this.config?.rateLimit)return"default";const s=this.config.rateLimit.identifyBy||"ip",n=[];if(s==="ip"||s==="all"){const i=t?.["x-forwarded-for"]||t?.["x-real-ip"]||t?.["client-ip"]||"0.0.0.0";n.push(`ip:${i.split(",")[0].trim()}`)}if(s==="apiKey"||s==="all"){const i=t?.["x-api-key"]||t?.authorization?.replace(/^Bearer\s+/i,"")||e?.apiKey;i&&n.push(`key:${i.substring(0,20)}`)}if(s==="user"||s==="all"){const i=t?.["x-user-id"]||e?.userId||e?.user_id;i&&n.push(`user:${i}`)}return n.length>0?n.join("|"):"default"}checkRateLimit(t,e){if(!this.config?.rateLimit?.enabled)return{allowed:!0,remaining:1/0,resetAt:Date.now()+1e3,limit:1/0};const s=this.config.rateLimit,n=s.windowMs||1e3,i=Date.now();let o;t==="query"?o=s.queriesPerSecond||100:t==="mutation"?o=s.mutationsPerSecond||50:o=s.subscriptionsPerSecond||10;const r=s.globalPerSecond;if(r){const h=`global:${e}`,p=this.rateLimitCounters.get(h);if(p)if(i>=p.resetAt)this.rateLimitCounters.set(h,{count:1,resetAt:i+n,windowStart:i});else{if(p.count>=r)return this.rateLimitMetrics.totalRateLimitHits++,this.rateLimitHitsThisSecond++,this.rateLimitMetrics.totalBlockedRequests++,this.blockedRequestsThisSecond++,this.rateLimitMetrics.blockedByType[t+"s"]++,this.rateLimitMetrics.lastBlockedTime=i,{allowed:!1,remaining:0,resetAt:p.resetAt,limit:r};p.count++}else this.rateLimitCounters.set(h,{count:1,resetAt:i+n,windowStart:i})}const u=`${e}:${t}`,d=this.rateLimitCounters.get(u);return!d||i>=d.resetAt?(this.rateLimitCounters.set(u,{count:1,resetAt:i+n,windowStart:i}),{allowed:!0,remaining:o-1,resetAt:i+n,limit:o}):d.count>=o?(this.rateLimitMetrics.totalRateLimitHits++,this.rateLimitHitsThisSecond++,this.rateLimitMetrics.totalBlockedRequests++,this.blockedRequestsThisSecond++,this.rateLimitMetrics.blockedByType[t+"s"]++,this.rateLimitMetrics.lastBlockedTime=i,{allowed:!1,remaining:0,resetAt:d.resetAt,limit:o}):(d.count++,{allowed:!0,remaining:o-d.count,resetAt:d.resetAt,limit:o})}async executeWithTimeout(t,e,s,n){if(!this.config?.timeout?.enabled||e<=0)return await t();const i=Date.now();return Promise.race([t(),new Promise((o,r)=>{setTimeout(()=>{const u=Date.now()-i;this.recordTimeout(s,u,n),r(new Error(`${s} timeout after ${e}ms`))},e)})])}recordTimeout(t,e,s){if(this.timeoutMetrics.totalTimeouts++,this.timeoutsThisSecond++,t==="query"?this.timeoutMetrics.queryTimeouts++:t==="mutation"?this.timeoutMetrics.mutationTimeouts++:this.timeoutMetrics.resolverTimeouts++,this.timeoutMetrics.lastTimeoutTime=Date.now(),this.timeoutDurations.push(e),this.timeoutDurations.length>this.MAX_TIMEOUT_HISTORY&&this.timeoutDurations.shift(),this.timeoutDurations.length>0){const n=this.timeoutDurations.reduce((i,o)=>i+o,0);this.timeoutMetrics.averageTimeoutDuration=n/this.timeoutDurations.length}this.recordError("timeout",`Timeout after ${e}ms`,s,t==="resolver"?void 0:t)}getTimeoutForOperation(t){if(!this.config?.timeout?.enabled)return 0;const e=this.config.timeout;return t==="query"?e.queryTimeout||e.defaultTimeout||3e4:t==="mutation"?e.mutationTimeout||e.defaultTimeout||6e4:e.defaultTimeout||3e4}async executeQuery(t,e,s,n,i,o){const r=this.extractRequestedFields(t);return this.config?.resolvers&&this.config.resolvers.length>0&&s&&n?await this.executeQueryWithResolvers(t,e,r,s,n,i,o):this.executeQuerySimple(t,e)}async executeQueryWithResolvers(t,e,s,n,i,o,r){const u={};this.requestCache.clear();const d=t.trim().toLowerCase().startsWith("query");this.detectNPlusOneProblems(t,s,d?"Query":"Mutation");const h=new Map;for(const v of s){const b=this.findResolverForField(v,d?"Query":"Mutation");if(b&&b.enabled!==!1&&b.targetService){const x=b.id;h.has(x)||h.set(x,{resolver:b,fields:[]}),h.get(x).fields.push(v)}}const p=[];for(const[v,b]of h.entries()){const{resolver:x,fields:R}=b;let C=this.dataLoaders.get(v);if(!C){const k=async(T,A,D,_)=>this.executeResolverBatch(T,A,D,_,o,r);C=new fk(v,k,n,i),this.dataLoaders.set(v,C)}C.nodes=n,C.connections=i,C.traceContext=o,C.getJaegerEngines=r;for(const k of R){const T=this.extractFieldVariables(t,k,e);p.push(C.load(T,!0).then(A=>({field:k,data:A})).catch(A=>({field:k,data:this.getFallbackDataForField(k,e)})))}}for(const v of s)h.has(this.findResolverForField(v,d?"Query":"Mutation")?.id||"")||(u[v]=this.getFallbackDataForField(v,e));const g=await Promise.all(p);for(const{field:v,data:b}of g)u[v]=b;for(const v of this.dataLoaders.values())v.clearQueue();return u}extractFieldVariables(t,e,s){const n=new RegExp(`${e}\\s*\\(([^)]*)\\)`,"i"),i=t.match(n);if(i&&i[1]){const o={},r=i[1].split(",").map(u=>u.trim());for(const u of r){const[d,h]=u.split(":").map(p=>p.trim());d&&h&&(o[d]=h.replace(/^["']|["']$/g,""))}return{...s,...o}}return s||{}}async executeResolverBatch(t,e,s,n,i,o){const r=this.config?.resolvers?.find(p=>p.id===t);if(!r)return e.map(()=>({success:!1,error:`Resolver not found: ${t}`,latency:0,resolverId:t}));const u=Date.now(),d=await Promise.all(e.map(p=>this.executeResolver(r,p,s,n,i,o))),h=Date.now();if(i&&o&&e.length>1){const p=d.every(g=>g.success);this.createDataLoaderBatchSpan(t,e.length,u/1e3,h/1e3,p,i,o)}return d}detectNPlusOneProblems(t,e,s){for(const n of e){const i=this.findResolverForField(n,s);if(i&&i.enabled!==!1){const o=new RegExp(`\\[.*?${n}.*?\\{`,"s"),r=new RegExp(`${n}\\s*\\{[^}]*\\}`,"s");if(o.test(t)&&r.test(t)){const u=t.match(/\[/g),d=u?Math.pow(10,u.length):10;let h="low";d>100?h="high":d>20&&(h="medium"),this.nPlusOneProblems.find(g=>g.field===n&&g.resolverId===i.id)||(this.nPlusOneProblems.push({field:n,resolverId:i.id,parentType:s,estimatedCalls:d,severity:h,detectedAt:Date.now()}),this.nPlusOneProblems.length>this.MAX_N_PLUS_ONE_HISTORY&&this.nPlusOneProblems.shift())}}}}executeQuerySimple(t,e){return t.includes("users")?{users:[{id:"1",name:"John Doe",email:"john@example.com"},{id:"2",name:"Jane Smith",email:"jane@example.com"}]}:t.includes("user")?{user:{id:e?.id||"1",name:"John Doe",email:"john@example.com"}}:t.includes("posts")?{posts:[{id:"1",title:"Post 1",content:"Content 1",author:{id:"1",name:"John Doe"}},{id:"2",title:"Post 2",content:"Content 2",author:{id:"2",name:"Jane Smith"}}]}:{data:null}}extractRequestedFields(t){const e=[],s=t.match(/\b(\w+)\s*\{/g);if(s)for(const n of s){const i=n.replace(/\s*\{/,"").trim();["query","mutation","subscription"].includes(i.toLowerCase())||e.push(i)}return e}findResolverForField(t,e){if(this.config?.resolvers)return this.config.resolvers.find(s=>s.field===t&&s.type===e&&s.enabled!==!1)}async executeResolver(t,e,s,n,i,o){const r=Date.now(),d=this.selectInstanceForLoadBalancing(t)||t.targetService;let h=null;try{h=await this.getConnectionFromPool(t.id,d)}catch(x){const R=Date.now()-r,C=`Failed to get connection from pool: ${x.message}`;return this.recordResolverCall(t.id,!1,R),{success:!1,error:C,latency:R,resolverId:t.id}}const p=s.find(x=>x.id===d);if(!p){h&&(this.releaseConnectionToPool(t.id,h.connectionId,!1),this.releaseInstanceFromLoadBalancing(t.id,h.instanceId));const x=Date.now()-r,R=Date.now(),C=`Target service not found: ${t.targetService}`;return i&&o&&this.createResolverSpan(t,r/1e3,R/1e3,!1,C,i,o),this.recordResolverCall(t.id,!1,x),{success:!1,error:C,latency:x,resolverId:t.id}}if(!n.find(x=>x.source===this.componentId&&x.target===d)){h&&(this.releaseConnectionToPool(t.id,h.connectionId,!1),this.releaseInstanceFromLoadBalancing(t.id,h.instanceId));const x=Date.now()-r,R=Date.now(),C=`No connection found to target service: ${d}`;return i&&o&&this.createResolverSpan(t,r/1e3,R/1e3,!1,C,i,o),this.recordResolverCall(t.id,!1,x),{success:!1,error:C,latency:x,resolverId:t.id}}const v=t.latency||this.config?.responseLatency||50,b=this.config?.timeout?.resolverTimeout||this.config?.timeout?.defaultTimeout||5e3;try{const x=await this.executeWithTimeout(async()=>(await new Promise(k=>setTimeout(k,v)),this.simulateResolverData(p,t,e)),b,"resolver",`${t.type}.${t.field}`),R=Date.now()-r,C=Date.now();return i&&o&&this.createResolverSpan(t,r/1e3,C/1e3,!0,void 0,i,o),this.recordResolverCall(t.id,!0,R),h&&(this.releaseConnectionToPool(t.id,h.connectionId,!0),this.releaseInstanceFromLoadBalancing(t.id,h.instanceId)),{success:!0,data:x,latency:R,resolverId:t.id}}catch(x){const R=Date.now()-r,C=Date.now(),k=x.message||"Resolver execution failed";return h&&(this.releaseConnectionToPool(t.id,h.connectionId,!1),this.releaseInstanceFromLoadBalancing(t.id,h.instanceId)),i&&o&&this.createResolverSpan(t,r/1e3,C/1e3,!1,k,i,o),this.recordResolverCall(t.id,!1,R),{success:!1,error:k,latency:R,resolverId:t.id}}}initializeConnectionPool(t){const e=t.connectionPoolSize||this.config?.connectionPool?.defaultPoolSize||10;this.connectionPools.set(t.id,{connections:[],maxSize:e,currentSize:0,waitingQueue:[],totalRequests:0,failedRequests:0})}initializeLoadBalancing(t){if(!t.instances||t.instances.length<=1)return;const e=this.config?.loadBalancing?.strategy||"round-robin",s=this.config?.loadBalancing?.weights,n=new Map;if(e==="weighted"&&s)for(const i of t.instances)n.set(i,s[i]||1);this.loadBalancingState.set(t.id,{strategy:e,currentIndex:0,instanceConnections:new Map,instanceWeights:e==="weighted"?n:void 0,totalRequests:0,requestsByInstance:new Map});for(const i of t.instances)this.loadBalancingState.get(t.id).instanceConnections.set(i,0),this.loadBalancingState.get(t.id).requestsByInstance.set(i,0)}async getConnectionFromPool(t,e){if(!this.config?.connectionPool?.enabled)return{connectionId:`${t}:${e||"default"}`,instanceId:e||"default"};const s=this.connectionPools.get(t);if(!s){const o=this.config?.resolvers?.find(r=>r.id===t);if(o)return this.initializeConnectionPool(o),this.getConnectionFromPool(t,e);throw new Error(`Connection pool not found for resolver: ${t}`)}const n=Date.now();this.connectionPoolMetrics.totalConnectionAttempts++;const i=s.connections.find(o=>o.status==="idle"&&(!e||o.id.includes(e)));if(i){i.status="active",i.lastUsed=Date.now(),this.connectionPoolMetrics.activeConnections++,this.connectionPoolMetrics.idleConnections--;const o=Date.now()-n;return this.connectionWaitTimes.push(o),this.connectionWaitTimes.length>this.MAX_WAIT_TIME_HISTORY&&this.connectionWaitTimes.shift(),{connectionId:i.id,instanceId:e||i.id.split(":")[1]||"default"}}if(s.currentSize<s.maxSize){const o=`${t}:${e||"default"}:${Date.now()}`,r={id:o,status:"active",createdAt:Date.now(),lastUsed:Date.now(),consecutiveFailures:0};s.connections.push(r),s.currentSize++,this.connectionPoolMetrics.totalConnections++,this.connectionPoolMetrics.activeConnections++;const u=`${t}:${e||"default"}`;this.connectionHealth.has(u)||this.connectionHealth.set(u,{status:"healthy",lastCheckTime:Date.now(),consecutiveFailures:0,reconnectAttempts:0});const d=Date.now()-n;return this.connectionWaitTimes.push(d),this.connectionWaitTimes.length>this.MAX_WAIT_TIME_HISTORY&&this.connectionWaitTimes.shift(),{connectionId:o,instanceId:e||"default"}}return new Promise((o,r)=>{const u=setTimeout(()=>{s.waitingQueue=s.waitingQueue.filter(d=>d.reject!==r),this.connectionPoolMetrics.failedConnectionAttempts++,r(new Error("Connection pool timeout"))},5e3);s.waitingQueue.push({resolve:d=>{clearTimeout(u),o(d)},reject:d=>{clearTimeout(u),r(d)},timestamp:Date.now()})})}releaseConnectionToPool(t,e,s){if(!this.config?.connectionPool?.enabled)return;const n=this.connectionPools.get(t);if(!n)return;const i=n.connections.find(o=>o.id===e);if(i){if(n.totalRequests++,s)i.consecutiveFailures=0;else if(n.failedRequests++,i.consecutiveFailures++,i.consecutiveFailures>=3){i.status="unhealthy";const o=e.split(":").slice(0,2).join(":"),r=this.connectionHealth.get(o);r&&(r.status="unhealthy",r.consecutiveFailures=i.consecutiveFailures)}if(i.status==="unhealthy"){if(n.connections=n.connections.filter(o=>o.id!==e),n.currentSize--,this.connectionPoolMetrics.totalConnections--,this.connectionPoolMetrics.activeConnections--,n.waitingQueue.length>0){const o=n.waitingQueue.shift();o&&this.getConnectionFromPool(t).then(r=>{o.resolve(r)}).catch(r=>{o.reject(r)})}return}if(i.status="idle",i.lastUsed=Date.now(),this.connectionPoolMetrics.activeConnections--,this.connectionPoolMetrics.idleConnections++,n.waitingQueue.length>0){const o=n.waitingQueue.shift();o&&(i.status="active",i.lastUsed=Date.now(),this.connectionPoolMetrics.activeConnections++,this.connectionPoolMetrics.idleConnections--,o.resolve({connectionId:i.id,instanceId:i.id.split(":")[1]||"default"}))}}}selectInstanceForLoadBalancing(t){if(!this.config?.loadBalancing?.enabled||!t.instances||t.instances.length<=1)return t.targetService;const e=this.loadBalancingState.get(t.id);if(!e)return t.instances[0];let s=t.instances[0];switch(e.strategy){case"round-robin":s=t.instances[e.currentIndex%t.instances.length],e.currentIndex=(e.currentIndex+1)%t.instances.length;break;case"least-connections":let o=1/0;s=t.instances[0];for(const d of t.instances){const h=e.instanceConnections.get(d)||0;h<o&&(o=h,s=d)}break;case"random":s=t.instances[Math.floor(Math.random()*t.instances.length)];break;case"weighted":if(!e.instanceWeights){s=t.instances[0];break}const r=Array.from(e.instanceWeights.values()).reduce((d,h)=>d+h,0);let u=Math.random()*r;for(const d of t.instances){const h=e.instanceWeights.get(d)||1;if(u-=h,u<=0){s=d;break}}s||(s=t.instances[0]);break;default:s=t.instances[0]}e.totalRequests++;const n=e.requestsByInstance.get(s)||0;e.requestsByInstance.set(s,n+1);const i=e.instanceConnections.get(s)||0;return e.instanceConnections.set(s,i+1),this.loadBalancingMetrics.totalRequests++,s}releaseInstanceFromLoadBalancing(t,e){if(!this.config?.loadBalancing?.enabled)return;const s=this.loadBalancingState.get(t);if(!s)return;const n=s.instanceConnections.get(e)||0;n>0&&s.instanceConnections.set(e,n-1)}startHealthChecks(){if(this.healthCheckInterval)return;const t=this.config?.connectionPool?.healthCheckInterval||3e4;this.healthCheckInterval=setInterval(()=>{this.performHealthChecks()},t)}performHealthChecks(){if(!this.config?.connectionPool?.enabled)return;const t=Date.now();this.connectionHealthMetrics.totalHealthChecks++;for(const[n,i]of this.connectionPools.entries())for(const o of i.connections){const r=o.id.split(":").slice(0,2).join(":");let u=this.connectionHealth.get(r);u||(u={status:"healthy",lastCheckTime:t,consecutiveFailures:0,reconnectAttempts:0},this.connectionHealth.set(r,u)),u.lastCheckTime=t,this.connectionHealthMetrics.lastHealthCheckTime=t,Math.random()>.05?u.status==="unhealthy"&&(u.status="healthy",u.consecutiveFailures=0,o.status=o.status==="unhealthy"?"idle":o.status,this.connectionHealthMetrics.successfulReconnects++,this.connectionHealthMetrics.totalReconnects++):(this.connectionHealthMetrics.failedHealthChecks++,u.consecutiveFailures++,u.consecutiveFailures>=3&&(u.status="unhealthy",o.status="unhealthy",this.connectionHealthMetrics.unhealthyConnections++,u.reconnectAttempts<(this.config.connectionPool?.maxReconnectAttempts||3)?(u.status="reconnecting",u.reconnectAttempts++,this.connectionHealthMetrics.totalReconnects++,setTimeout(()=>{Math.random()>.3?(u.status="healthy",o.status="idle",u.consecutiveFailures=0,this.connectionHealthMetrics.successfulReconnects++):(u.status="unhealthy",this.connectionHealthMetrics.failedReconnects++)},this.config.connectionPool?.reconnectDelay||1e3)):this.connectionHealthMetrics.failedReconnects++))}let e=0,s=0;for(const n of this.connectionHealth.values())n.status==="healthy"?e++:s++;this.connectionHealthMetrics.healthyConnections=e,this.connectionHealthMetrics.unhealthyConnections=s,this.connectionHealthMetrics.healthCheckFailureRate=this.connectionHealthMetrics.totalHealthChecks>0?this.connectionHealthMetrics.failedHealthChecks/this.connectionHealthMetrics.totalHealthChecks:0,this.connectionHealthMetrics.reconnectSuccessRate=this.connectionHealthMetrics.totalReconnects>0?this.connectionHealthMetrics.successfulReconnects/this.connectionHealthMetrics.totalReconnects:0}simulateResolverData(t,e,s){switch(t.type){case"postgres":case"mongodb":case"redis":case"cassandra":case"clickhouse":case"snowflake":case"elasticsearch":return this.simulateDatabaseResponse(e,s);case"rest":case"grpc":return this.simulateAPIResponse(e,s);default:return this.getFallbackDataForField(e.field,s)}}simulateDatabaseResponse(t,e){const s=t.field.toLowerCase();return s.includes("user")?e?.id?{id:e.id,name:`User ${e.id}`,email:`user${e.id}@example.com`}:[{id:"1",name:"User 1",email:"user1@example.com"},{id:"2",name:"User 2",email:"user2@example.com"}]:s.includes("post")?[{id:"1",title:"Post 1",content:"Content 1"},{id:"2",title:"Post 2",content:"Content 2"}]:null}simulateAPIResponse(t,e){return{data:this.getFallbackDataForField(t.field,e),status:"success"}}getFallbackDataForField(t,e){const s=t.toLowerCase();return s.includes("user")?e?.id?{id:e.id,name:`User ${e.id}`,email:`user${e.id}@example.com`}:[{id:"1",name:"John Doe",email:"john@example.com"},{id:"2",name:"Jane Smith",email:"jane@example.com"}]:s.includes("post")?[{id:"1",title:"Post 1",content:"Content 1"},{id:"2",title:"Post 2",content:"Content 2"}]:null}recordResolverCall(t,e,s){let n=this.resolverMetrics.get(t);if(!n){const i=this.config?.resolvers?.find(o=>o.id===t);if(!i)return;n={id:t,type:i.type,field:i.field,totalCalls:0,totalErrors:0,averageLatency:0,totalLatency:0,errorRate:0},this.resolverMetrics.set(t,n)}n.totalCalls++,n.totalLatency+=s,n.averageLatency=n.totalLatency/n.totalCalls,n.lastCallTime=Date.now(),e||n.totalErrors++,n.errorRate=n.totalErrors/n.totalCalls}executeMutation(t,e){return t.includes("createUser")?{createUser:{id:`user-${Date.now()}`,name:e?.name||"New User",email:e?.email||"newuser@example.com"}}:t.includes("updateUser")?{updateUser:{id:e?.id||"1",name:e?.name||"Updated User",email:e?.email||"updated@example.com"}}:t.includes("deleteUser")?{deleteUser:!0}:{data:null}}getCacheKey(t){const e=t.variables?JSON.stringify(t.variables):"";return`${t.query}:${e}`}getPersistedQueries(){return Array.from(this.persistedQueries.values())}getPersistedQueryByHash(t){return this.persistedQueries.get(t)}deletePersistedQuery(t){const e=this.persistedQueries.delete(t);return e&&this.config&&(this.config.persistedQueries=Array.from(this.persistedQueries.values())),e}getBatchQueryMetrics(){return{...this.batchQueryMetrics}}recordQuery(t,e,s,n,i=!1,o,r="query",u,d){const h=Date.now();if(h-this.lastSecondStart>=1e3&&(this.graphQLMetrics.queriesPerSecond=this.queriesThisSecond,this.queriesThisSecond=0,this.lastSecondStart=h),this.queriesThisSecond++,this.graphQLMetrics.totalQueries++,!t&&(this.graphQLMetrics.totalErrors++,d)){const b=this.categorizeError(d,r);this.recordError(b,d,o,r)}this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const p=this.latencyHistory.reduce((b,x)=>b+x,0);if(this.graphQLMetrics.averageResponseTime=p/this.latencyHistory.length,s>0){this.complexityHistory.push(s),this.complexityHistory.length>this.MAX_LATENCY_HISTORY&&this.complexityHistory.shift();const b=this.complexityHistory.reduce((x,R)=>x+R,0);this.graphQLMetrics.averageComplexity=b/this.complexityHistory.length}if(n>0){this.depthHistory.push(n),this.depthHistory.length>this.MAX_LATENCY_HISTORY&&this.depthHistory.shift();const b=this.depthHistory.reduce((x,R)=>x+R,0);this.graphQLMetrics.averageDepth=b/this.depthHistory.length}this.graphQLMetrics.totalQueries>0&&(this.graphQLMetrics.errorRate=this.graphQLMetrics.totalErrors/this.graphQLMetrics.totalQueries);const g=r==="query"?"Query":r==="mutation"?"Mutation":"Subscription";if(this.recordTypeMetrics(g,t,e,s,n),o&&this.recordOperationMetrics(o,r,t,e,s,n),u)for(const b of u)this.recordFieldMetrics(b.name,g,t,e);const v={id:`query-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,query:"",timestamp:h,duration:e,success:t,complexity:s,depth:n,operationName:o};this.queryHistory.push(v),this.queryHistory.length>this.MAX_HISTORY_SIZE&&this.queryHistory.shift()}recordMutation(t,e,s,n,i){Date.now()-this.lastSecondStart>=1e3&&(this.graphQLMetrics.mutationsPerSecond=this.mutationsThisSecond,this.mutationsThisSecond=0),this.mutationsThisSecond++,this.graphQLMetrics.totalMutations++,t||(this.graphQLMetrics.totalErrors++,i&&this.recordError(this.categorizeError(i,"mutation"),i,s,"mutation"));const r=this.graphQLMetrics.totalQueries+this.graphQLMetrics.totalMutations;if(r>0&&(this.graphQLMetrics.errorRate=this.graphQLMetrics.totalErrors/r),this.recordTypeMetrics("Mutation",t,e,0,0),s&&this.recordOperationMetrics(s,"mutation",t,e,0,0),n)for(const u of n)this.recordFieldMetrics(u.name,"Mutation",t,e)}recordFieldMetrics(t,e,s,n){const i=`${e}:${t}`;let o=this.fieldMetrics.get(i);o||(o={fieldName:t,typeName:e,totalCalls:0,totalErrors:0,averageLatency:0,totalLatency:0,minLatency:n,maxLatency:n,errorRate:0,callsPerSecond:0},this.fieldMetrics.set(i,o)),o.totalCalls++,o.totalLatency+=n,o.averageLatency=o.totalLatency/o.totalCalls,o.minLatency=Math.min(o.minLatency,n),o.maxLatency=Math.max(o.maxLatency,n),o.lastCallTime=Date.now(),s||o.totalErrors++,o.errorRate=o.totalErrors/o.totalCalls;const r=Date.now();r-this.lastMetricsSecondStart>=1e3&&(this.updateFieldMetricsPerSecond(),this.lastMetricsSecondStart=r);const u=this.fieldCallsThisSecond.get(i)||0;this.fieldCallsThisSecond.set(i,u+1)}updateFieldMetricsPerSecond(){for(const[t,e]of this.fieldCallsThisSecond.entries()){const s=this.fieldMetrics.get(t);s&&(s.callsPerSecond=e)}this.fieldCallsThisSecond.clear()}recordTypeMetrics(t,e,s,n,i){let o=this.typeMetrics.get(t);o||(o={typeName:t,totalOperations:0,totalErrors:0,averageLatency:0,averageComplexity:0,averageDepth:0,errorRate:0,operationsPerSecond:0},this.typeMetrics.set(t,o)),o.totalOperations++,e||o.totalErrors++;const r=.1;o.averageLatency=o.averageLatency*(1-r)+s*r,n>0&&(o.averageComplexity=o.averageComplexity*(1-r)+n*r),i>0&&(o.averageDepth=o.averageDepth*(1-r)+i*r),o.errorRate=o.totalErrors/o.totalOperations,o.lastOperationTime=Date.now(),Date.now()-this.lastMetricsSecondStart>=1e3&&this.updateTypeMetricsPerSecond();const d=this.typeOpsThisSecond.get(t)||0;this.typeOpsThisSecond.set(t,d+1)}updateTypeMetricsPerSecond(){for(const[t,e]of this.typeOpsThisSecond.entries()){const s=this.typeMetrics.get(t);s&&(s.operationsPerSecond=e)}this.typeOpsThisSecond.clear()}recordOperationMetrics(t,e,s,n,i,o){if(this.operationMetrics.size>=this.MAX_OPERATIONS&&!this.operationMetrics.has(t)){let p=null,g=1/0;for(const[v,b]of this.operationMetrics.entries())b.totalCalls<g&&(g=b.totalCalls,p=v);p&&this.operationMetrics.delete(p)}let r=this.operationMetrics.get(t);r||(r={operationName:t,operationType:e,totalCalls:0,totalErrors:0,averageLatency:0,averageComplexity:0,averageDepth:0,errorRate:0,callsPerSecond:0,history:[]},this.operationMetrics.set(t,r)),r.totalCalls++,s||r.totalErrors++;const u=.1;r.averageLatency=r.averageLatency*(1-u)+n*u,i>0&&(r.averageComplexity=r.averageComplexity*(1-u)+i*u),o>0&&(r.averageDepth=r.averageDepth*(1-u)+o*u),r.errorRate=r.totalErrors/r.totalCalls,r.lastCallTime=Date.now(),r.history&&(r.history.push({timestamp:Date.now(),latency:n,success:s,complexity:i>0?i:void 0,depth:o>0?o:void 0}),r.history.length>this.MAX_OPERATION_HISTORY&&r.history.shift()),Date.now()-this.lastMetricsSecondStart>=1e3&&this.updateOperationMetricsPerSecond();const h=this.operationCallsThisSecond.get(t)||0;this.operationCallsThisSecond.set(t,h+1)}updateOperationMetricsPerSecond(){for(const[t,e]of this.operationCallsThisSecond.entries()){const s=this.operationMetrics.get(t);s&&(s.callsPerSecond=e)}this.operationCallsThisSecond.clear()}recordError(t,e,s,n){let i=this.errorMetrics.get(t);i||(i={category:t,totalErrors:0,errorsPerSecond:0,recentErrors:[]},this.errorMetrics.set(t,i)),i.totalErrors++,i.lastErrorTime=Date.now();const o={timestamp:Date.now(),category:t,message:e,operationName:s,operationType:n};i.recentErrors&&(i.recentErrors.push(o),i.recentErrors.length>this.MAX_ERROR_HISTORY&&i.recentErrors.shift()),this.errorHistory.push(o),this.errorHistory.length>this.MAX_TOTAL_ERROR_HISTORY&&this.errorHistory.shift(),Date.now()-this.lastMetricsSecondStart>=1e3&&this.updateErrorMetricsPerSecond();const u=this.errorCountsThisSecond.get(t)||0;this.errorCountsThisSecond.set(t,u+1)}updateErrorMetricsPerSecond(){for(const[t,e]of this.errorCountsThisSecond.entries()){const s=this.errorMetrics.get(t);s&&(s.errorsPerSecond=e)}this.errorCountsThisSecond.clear()}generateTraceId(){return`graphql-trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`graphql-span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}sendSpanToJaeger(t,e){if(!e)return;const s=e();if(s.size!==0)for(const[,n]of s)n&&typeof n.receiveSpan=="function"&&n.receiveSpan(t)}createQuerySpan(t,e,s,n,i,o,r,u,d,h){if(!h||h().size===0)return;let g;if(d)g={traceId:d.traceId,spanId:this.generateSpanId(),parentSpanId:d.spanId,sampled:d.sampled};else{const R=this.generateTraceId(),C=this.generateSpanId();g={traceId:R,spanId:C,sampled:!0},this.traceContexts.set(R,g)}const v=(n-s)*1e3,b=s*1e3,x={traceId:g.traceId,spanId:g.spanId,parentSpanId:g.parentSpanId,operationName:`graphql.${e}.${t||"unknown"}`,serviceName:this.componentId||"graphql",startTime:b,duration:v,tags:[{key:"component.type",value:"graphql"},{key:"graphql.operation.type",value:e},{key:"graphql.operation.name",value:t||"unknown"},{key:"status",value:i?"success":"error"}],logs:[]};return o!==void 0&&x.tags.push({key:"graphql.complexity",value:o}),r!==void 0&&x.tags.push({key:"graphql.depth",value:r}),!i&&u&&(x.tags.push({key:"error",value:!0}),x.logs.push({timestamp:b+v,fields:[{key:"event",value:"error"},{key:"error.message",value:u}]})),this.sendSpanToJaeger(x,h),g}createResolverSpan(t,e,s,n,i,o,r){if(!r||!o||r().size===0)return;const d=this.generateSpanId(),h=(s-e)*1e3,p=e*1e3,g={traceId:o.traceId,spanId:d,parentSpanId:o.spanId,sampled:o.sampled},v={traceId:g.traceId,spanId:g.spanId,parentSpanId:g.parentSpanId,operationName:`graphql.resolver.${t.field}`,serviceName:t.targetService||"unknown",startTime:p,duration:h,tags:[{key:"component.type",value:"graphql.resolver"},{key:"graphql.resolver.id",value:t.id},{key:"graphql.resolver.type",value:t.type},{key:"graphql.resolver.field",value:t.field},{key:"graphql.resolver.target",value:t.targetService||"unknown"},{key:"status",value:n?"success":"error"}],logs:[]};return!n&&i&&(v.tags.push({key:"error",value:!0}),v.logs.push({timestamp:p+h,fields:[{key:"event",value:"error"},{key:"error.message",value:i}]})),this.sendSpanToJaeger(v,r),g}createDataLoaderBatchSpan(t,e,s,n,i,o,r){if(!r||!o||r().size===0)return;const d=this.generateSpanId(),h=(n-s)*1e3,p=s*1e3,g={traceId:o.traceId,spanId:d,parentSpanId:o.spanId,operationName:"graphql.dataloader.batch",serviceName:this.componentId||"graphql",startTime:p,duration:h,tags:[{key:"component.type",value:"graphql.dataloader"},{key:"graphql.resolver.id",value:t},{key:"graphql.dataloader.batch.size",value:e},{key:"status",value:i?"success":"error"}],logs:[]};this.sendSpanToJaeger(g,r)}categorizeError(t,e){const s=t.toLowerCase();return s.includes("validation")||s.includes("invalid")||s.includes("schema")?"validation":s.includes("resolver")||s.includes("target service")?"resolver":s.includes("timeout")||s.includes("timed out")?"timeout":s.includes("rate limit")||s.includes("too many requests")?"rate_limit":s.includes("complexity")&&s.includes("exceed")?"complexity_limit":s.includes("depth")&&s.includes("exceed")?"depth_limit":s.includes("execution")||s.includes("execution failed")?"execution":"other"}getGraphQLMetrics(){let t=0,e=0,s=0,n=0,i=0,o=0;for(const u of this.dataLoaders.values()){const d=u.getMetrics();t+=d.totalBatches,e+=d.totalRequests,s+=d.totalBatchedRequests,n+=d.deduplicationRate*d.totalRequests/100,i+=d.cacheHitRate*d.totalRequests/100,o+=d.averageLatencyReduction*d.totalBatches}this.dataLoaderMetrics={totalBatches:t,totalRequests:e,totalBatchedRequests:s,averageBatchSize:t>0?s/t:0,deduplicationRate:e>0?n/e*100:0,cacheHitRate:e>0?i/e*100:0,averageLatencyReduction:t>0?o/t:0};const r=Date.now();return r-this.lastMetricsSecondStart>=1e3&&(this.updateFieldMetricsPerSecond(),this.updateTypeMetricsPerSecond(),this.updateOperationMetricsPerSecond(),this.updateErrorMetricsPerSecond(),this.updateRateLimitMetricsPerSecond(),this.updateTimeoutMetricsPerSecond(),this.lastMetricsSecondStart=r),{...this.graphQLMetrics,resolverMetrics:this.getResolverMetrics(),batchQueryMetrics:this.batchQueryMetrics,persistedQueriesCount:this.persistedQueries.size,persistedQueriesUsage:this.persistedQueriesUsage,introspectionMetrics:this.getIntrospectionMetrics(),fieldMetrics:Array.from(this.fieldMetrics.values()),typeMetrics:Array.from(this.typeMetrics.values()),operationMetrics:Array.from(this.operationMetrics.values()),errorMetrics:Array.from(this.errorMetrics.values()),rateLimitMetrics:{...this.rateLimitMetrics},timeoutMetrics:{...this.timeoutMetrics},connectionPoolMetrics:this.getConnectionPoolMetrics(),connectionHealthMetrics:{...this.connectionHealthMetrics},loadBalancingMetrics:this.getLoadBalancingMetrics()}}getConnectionPoolMetrics(){let t=0,e=0,s=0,n=0;const i={};for(const[o,r]of this.connectionPools.entries()){const u=r.connections.filter(h=>h.status==="active").length,d=r.connections.filter(h=>h.status==="idle").length;t+=r.currentSize,e+=u,s+=d,n+=r.maxSize,i[o]={poolSize:r.maxSize,activeConnections:u,idleConnections:d,utilization:r.maxSize>0?r.currentSize/r.maxSize:0,totalRequests:r.totalRequests,failedRequests:r.failedRequests}}if(this.connectionWaitTimes.length>0){const o=this.connectionWaitTimes.reduce((r,u)=>r+u,0);this.connectionPoolMetrics.averageConnectionWaitTime=o/this.connectionWaitTimes.length}return this.connectionPoolMetrics.totalConnections=t,this.connectionPoolMetrics.activeConnections=e,this.connectionPoolMetrics.idleConnections=s,this.connectionPoolMetrics.maxConnections=n,this.connectionPoolMetrics.connectionUtilization=n>0?t/n:0,this.connectionPoolMetrics.connectionFailureRate=this.connectionPoolMetrics.totalConnectionAttempts>0?this.connectionPoolMetrics.failedConnectionAttempts/this.connectionPoolMetrics.totalConnectionAttempts:0,this.connectionPoolMetrics.poolMetricsByResolver=i,{...this.connectionPoolMetrics}}getLoadBalancingMetrics(){const t={},e={},s={};for(const[i,o]of this.loadBalancingState.entries()){for(const[u,d]of o.requestsByInstance.entries()){const h=`${i}:${u}`;t[h]=(t[h]||0)+d}s[o.strategy]=(s[o.strategy]||0)+o.totalRequests;const r=this.config?.resolvers?.find(u=>u.id===i);if(r?.instances)for(const u of r.instances){const d=o.instanceConnections.get(u)||0,h=o.requestsByInstance.get(u)||0,p=`${i}:${u}`;e[p]=Math.min(1,d/Math.max(1,h/10))}}let n=0;if(Object.keys(t).length>0){const i=Object.values(t),o=i.reduce((d,h)=>d+h,0)/i.length,r=i.reduce((d,h)=>d+Math.pow(h-o,2),0)/i.length,u=Math.sqrt(r);n=o>0?u/o:0}return this.loadBalancingMetrics.requestsByInstance=t,this.loadBalancingMetrics.instanceUtilization=e,this.loadBalancingMetrics.requestsByStrategy=s,this.loadBalancingMetrics.averageLoadDistribution=n,{...this.loadBalancingMetrics}}updateRateLimitMetricsPerSecond(){const t=Date.now();t-this.lastRateLimitSecondStart>=1e3&&(this.rateLimitMetrics.blockedRequestsPerSecond=this.blockedRequestsThisSecond,this.rateLimitMetrics.rateLimitHitsPerSecond=this.rateLimitHitsThisSecond,this.blockedRequestsThisSecond=0,this.rateLimitHitsThisSecond=0,this.lastRateLimitSecondStart=t)}updateTimeoutMetricsPerSecond(){const t=Date.now();t-this.lastTimeoutSecondStart>=1e3&&(this.timeoutMetrics.timeoutsPerSecond=this.timeoutsThisSecond,this.timeoutsThisSecond=0,this.lastTimeoutSecondStart=t)}getDataLoaderMetrics(){return{...this.dataLoaderMetrics}}getNPlusOneProblems(){return[...this.nPlusOneProblems]}getResolverMetrics(){return Array.from(this.resolverMetrics.values())}getResolverMetricsById(t){return this.resolverMetrics.get(t)}getLoad(){const t=this.getGraphQLMetrics(),e=this.config?.requestsPerSecond||100,s=this.config?.responseLatency||50,n=t.queriesPerSecond+t.mutationsPerSecond,i=Math.min(1,n/e),o=Math.min(1,t.subscriptionsActive/100*.5+this.queryCache.size/1e3*.3+.2);return{queriesPerSecond:t.queriesPerSecond,mutationsPerSecond:t.mutationsPerSecond,averageLatency:t.averageResponseTime||s,errorRate:t.errorRate,cpuUtilization:i,memoryUtilization:o}}simulateRequests(t,e,s){if(t<=0)return;const n=Date.now(),i=n-(this.lastSecondStart||n);if(i<=0)return;const o=Math.floor(t*i/1e3);if(o===0)return;const r=["query { users { id name email } }",'query { user(id: "1") { id name email posts { id title } } }',"query { posts { id title author { name } } }"];for(let u=0;u<o;u++){const d=r[Math.floor(Math.random()*r.length)],h=this.processQuery({query:d},e,s);h instanceof Promise&&h.catch(()=>{})}}updateConfig(t){this.config||(this.config={}),t.schema&&this.config.schema&&this.detectSchemaChanges(t.schema),this.config={...this.config,...t},t.subscriptionsEnabled===!1&&(this.activeSubscriptions.clear(),this.graphQLMetrics.subscriptionsActive=0),t.enableCaching===!1&&this.queryCache.clear()}getIntrospectionMetrics(){return{...this.introspectionMetrics}}getSchemaChanges(t){return t?this.schemaChanges.slice(-t):[...this.schemaChanges]}getSchemaVersions(t){return t?this.schemaVersions.slice(-t):[...this.schemaVersions]}getLatestSchemaVersion(){return this.schemaVersions.length>0?this.schemaVersions[this.schemaVersions.length-1]:void 0}getQueryHistory(t){return t?this.queryHistory.slice(-t):[...this.queryHistory]}getActiveSubscriptions(){return Array.from(this.activeSubscriptions.values())}resetMetrics(){this.graphQLMetrics={queriesPerSecond:0,mutationsPerSecond:0,subscriptionsActive:this.activeSubscriptions.size,averageResponseTime:0,totalQueries:0,totalMutations:0,totalErrors:0,errorRate:0,cacheHitRate:0,averageComplexity:0,averageDepth:0},this.queryHistory=[],this.latencyHistory=[],this.complexityHistory=[],this.depthHistory=[],this.queriesThisSecond=0,this.mutationsThisSecond=0,this.lastSecondStart=Date.now(),this.rateLimitMetrics={totalBlockedRequests:0,blockedRequestsPerSecond:0,totalRateLimitHits:0,rateLimitHitsPerSecond:0,blockedByType:{queries:0,mutations:0,subscriptions:0}},this.blockedRequestsThisSecond=0,this.rateLimitHitsThisSecond=0,this.lastRateLimitSecondStart=Date.now(),this.timeoutMetrics={totalTimeouts:0,timeoutsPerSecond:0,queryTimeouts:0,mutationTimeouts:0,resolverTimeouts:0},this.timeoutsThisSecond=0,this.lastTimeoutSecondStart=Date.now(),this.timeoutDurations=[],this.connectionPoolMetrics={totalConnections:0,activeConnections:0,idleConnections:0,maxConnections:0,connectionUtilization:0,totalConnectionAttempts:0,failedConnectionAttempts:0,connectionFailureRate:0,averageConnectionWaitTime:0},this.connectionWaitTimes=[],this.connectionHealthMetrics={healthyConnections:0,unhealthyConnections:0,totalHealthChecks:0,failedHealthChecks:0,healthCheckFailureRate:0,totalReconnects:0,successfulReconnects:0,failedReconnects:0,reconnectSuccessRate:0},this.loadBalancingMetrics={totalRequests:0,averageLoadDistribution:0};for(const t of this.connectionPools.values())t.connections=[],t.currentSize=0,t.waitingQueue=[],t.totalRequests=0,t.failedRequests=0;for(const t of this.loadBalancingState.values())t.currentIndex=0,t.instanceConnections.clear(),t.totalRequests=0,t.requestsByInstance.clear();this.dataLoaderMetrics={totalBatches:0,totalRequests:0,totalBatchedRequests:0,averageBatchSize:0,deduplicationRate:0,cacheHitRate:0,averageLatencyReduction:0},this.nPlusOneProblems=[];for(const t of this.dataLoaders.values())t.clearCache();this.subscriptionMetrics={totalEvents:0,eventsPerSecond:0,averageDeliveryLatency:0,totalDeliveryErrors:0,deliveryErrorRate:0,lastEventTime:0},this.deliveryLatencyHistory=[],this.eventsThisSecond=0,this.lastEventSecondStart=Date.now(),this.subscriptionEvents=[],this.batchQueryMetrics={totalBatches:0,totalBatchRequests:0,averageBatchSize:0,averageBatchLatency:0,totalBatchErrors:0,batchErrorRate:0},this.batchLatencyHistory=[],this.persistedQueriesUsage=0,this.introspectionMetrics={totalIntrospectionQueries:0,introspectionQueriesPerSecond:0},this.introspectionQueriesThisSecond=0,this.lastIntrospectionSecondStart=Date.now(),this.fieldMetrics.clear(),this.typeMetrics.clear(),this.operationMetrics.clear(),this.errorMetrics.clear(),this.errorHistory=[],this.fieldCallsThisSecond.clear(),this.typeOpsThisSecond.clear(),this.operationCallsThisSecond.clear(),this.errorCountsThisSecond.clear(),this.lastMetricsSecondStart=Date.now()}getFieldMetrics(){return Array.from(this.fieldMetrics.values())}getFieldMetricsByName(t,e){const s=`${e}:${t}`;return this.fieldMetrics.get(s)}getTypeMetrics(){return Array.from(this.typeMetrics.values())}getTypeMetricsByName(t){return this.typeMetrics.get(t)}getOperationMetrics(){return Array.from(this.operationMetrics.values())}getOperationMetricsByName(t){return this.operationMetrics.get(t)}getErrorMetrics(){return Array.from(this.errorMetrics.values())}getErrorMetricsByCategory(t){return this.errorMetrics.get(t)}getErrorHistory(t){return t?this.errorHistory.slice(-t):[...this.errorHistory]}}class gk{config=null;soapMetrics={requestsPerSecond:0,averageResponseTime:0,totalRequests:0,totalErrors:0,errorRate:0,successRate:0,averageLatency:0};requestHistory=[];MAX_HISTORY_SIZE=1e3;requestCache=new Map;latencyHistory=[];MAX_LATENCY_HISTORY=500;lastSecondStart=Date.now();requestsThisSecond=0;operationMetrics=new Map;serviceMetrics=new Map;componentId=null;sendMessageToTarget;activeRequests=new Map;traceContexts=new Map;traceIdCounter=0;spanIdCounter=0;errorMetrics=new Map;MAX_ERROR_HISTORY=100;errorHistory=[];MAX_TOTAL_ERROR_HISTORY=500;operationCallsThisSecond=new Map;serviceRequestsThisSecond=new Map;errorCountsThisSecond=new Map;lastMetricsSecondStart=Date.now();rateLimitCounters=new Map;rateLimitMetrics={totalBlockedRequests:0,blockedRequestsPerSecond:0,totalRateLimitHits:0,rateLimitHitsPerSecond:0};blockedRequestsThisSecond=0;rateLimitHitsThisSecond=0;lastRateLimitSecondStart=Date.now();timeoutMetrics={totalTimeouts:0,timeoutsPerSecond:0};timeoutsThisSecond=0;lastTimeoutSecondStart=Date.now();timeoutDurations=[];MAX_TIMEOUT_HISTORY=100;wsSecurityMetrics={totalValidations:0,successfulValidations:0,failedValidations:0,validationSuccessRate:0,signaturesProcessed:0,encryptionsProcessed:0};wsAddressingMetrics={totalMessages:0,messagesWithAddressing:0,asyncResponses:0,addressingUsageRate:0};mtomMetrics={totalMessages:0,messagesWithMTOM:0,totalAttachments:0,averageAttachmentsPerMessage:0,mtomUsageRate:0};requestSizeMetrics={totalRequests:0,averageRequestSize:0,minRequestSize:1/0,maxRequestSize:0,totalBytesReceived:0,totalBytesSent:0,averageResponseSize:0,sizeDistribution:[]};throughputHistory=[];MAX_THROUGHPUT_HISTORY=60;previousRPS=0;peakRPS=0;peakRPSTime=0;PERCENTILE_P50=50;PERCENTILE_P95=95;PERCENTILE_P99=99;initializeConfig(t){this.componentId=t.id;const e=t.data.config||{};if(this.config={endpoint:e.endpoint||"/soap",wsdlUrl:e.wsdlUrl||"",services:e.services||[],requests:e.requests||[],totalRequests:e.totalRequests||0,successRate:e.successRate||100,averageLatency:e.averageLatency||50,enableWSSecurity:e.enableWSSecurity??!1,enableWSAddressing:e.enableWSAddressing??!1,enableMTOM:e.enableMTOM??!1,enableValidation:e.enableValidation??!0,soapVersion:e.soapVersion||"1.1",requestsPerSecond:e.requestsPerSecond||100,responseLatency:e.responseLatency||50,enableCaching:e.enableCaching??!1,cacheTTL:e.cacheTTL??300,rateLimit:e.rateLimit||{enabled:!1,requestsPerSecond:1e3,windowMs:1e3,identifyBy:"ip"},timeout:e.timeout||{enabled:!1,requestTimeout:3e4,defaultTimeout:3e4},maxRequestSize:e.maxRequestSize||10*1024*1024,wsdl:e.wsdl},this.config.services)for(const s of this.config.services){this.initializeServiceMetrics(s.name);for(const n of s.operations)this.initializeOperationMetrics(s.name,n.name)}}updateConfig(t){if(this.config&&(this.config={...this.config,...t},t.services))for(const e of t.services){this.serviceMetrics.has(e.name)||this.initializeServiceMetrics(e.name);for(const s of e.operations){const n=`${e.name}:${s.name}`;this.operationMetrics.has(n)||this.initializeOperationMetrics(e.name,s.name)}}}initializeServiceMetrics(t){this.serviceMetrics.has(t)||this.serviceMetrics.set(t,{serviceName:t,totalRequests:0,totalErrors:0,averageLatency:0,errorRate:0,requestsPerSecond:0,operationsCount:0})}initializeOperationMetrics(t,e){const s=`${t}:${e}`;this.operationMetrics.has(s)||this.operationMetrics.set(s,{operationName:e,serviceName:t,totalCalls:0,totalErrors:0,averageLatency:0,totalLatency:0,minLatency:1/0,maxLatency:0,errorRate:0,callsPerSecond:0})}setSendMessageFunction(t){this.sendMessageToTarget=t}processRequest(t,e,s,n){const i=Date.now(),o=this.createRequestSpan(t.operation||"unknown",i,n);if(!this.config)return this.createErrorResponse("SOAP service not configured",500,i);const r=t.envelope?Buffer.byteLength(t.envelope,"utf8"):0;if(this.config.maxRequestSize&&r>this.config.maxRequestSize)return this.recordError("validation",`Request size ${r} bytes exceeds maximum ${this.config.maxRequestSize} bytes`,t.operation,t.service),this.createFaultResponse("Client",`Request too large: ${r} bytes exceeds maximum ${this.config.maxRequestSize} bytes`,Date.now()-i);if(this.config.rateLimit?.enabled){const T=this.getClientIdentifier(t.clientIP,t.headers);if(!this.checkRateLimit(T))return this.recordError("rate_limit","Rate limit exceeded",t.operation,t.service),this.createErrorResponse("Rate limit exceeded",429,i)}const u=this.parseSOAPEnvelope(t.envelope);if(!u.success)return this.recordError("validation",u.error||"Invalid SOAP envelope",t.operation,t.service),this.createFaultResponse("Client",u.error||"Invalid SOAP envelope",i);const d=t.operation||u.operation||"unknown",h=t.service||u.service||"default";if(this.config.enableWSSecurity&&u.headers){this.wsSecurityMetrics.totalValidations++;const T=this.validateWSSecurity(u.headers,t.envelope);if(!T.valid)return this.wsSecurityMetrics.failedValidations++,this.recordError("security",T.error||"WS-Security validation failed",d,h),this.createFaultResponse("Client",T.error||"WS-Security validation failed",i);this.wsSecurityMetrics.successfulValidations++,u.headers.Security?.includes("Signature")&&this.wsSecurityMetrics.signaturesProcessed++,u.headers.Security?.includes("EncryptedData")&&this.wsSecurityMetrics.encryptionsProcessed++,this.wsSecurityMetrics.validationSuccessRate=this.wsSecurityMetrics.totalValidations>0?this.wsSecurityMetrics.successfulValidations/this.wsSecurityMetrics.totalValidations*100:0}if(this.config.enableWSAddressing&&u.headers){this.wsAddressingMetrics.totalMessages++,u.headers.MessageID&&this.wsAddressingMetrics.messagesWithAddressing++;const T=this.processWSAddressing(u.headers);T.success||this.recordError("validation",T.error||"WS-Addressing processing failed",d,h),T.replyTo&&this.wsAddressingMetrics.asyncResponses++,this.wsAddressingMetrics.addressingUsageRate=this.wsAddressingMetrics.totalMessages>0?this.wsAddressingMetrics.messagesWithAddressing/this.wsAddressingMetrics.totalMessages*100:0}if(this.config.enableMTOM&&u.body){this.mtomMetrics.totalMessages++;const T=this.processMTOM(u.body);T.processed&&(this.mtomMetrics.messagesWithMTOM++,T.attachments&&(this.mtomMetrics.totalAttachments+=T.attachments.length),u.body=T.body||u.body,this.mtomMetrics.averageAttachmentsPerMessage=this.mtomMetrics.messagesWithMTOM>0?this.mtomMetrics.totalAttachments/this.mtomMetrics.messagesWithMTOM:0,this.mtomMetrics.mtomUsageRate=this.mtomMetrics.totalMessages>0?this.mtomMetrics.messagesWithMTOM/this.mtomMetrics.totalMessages*100:0)}if(this.config.enableValidation&&this.config.wsdl){const T=this.validateRequest(u,d,h);if(!T.valid)return this.recordError("validation",T.error||"Validation failed",d,h),this.createFaultResponse("Client",T.error||"Validation failed",i)}if(this.config.enableCaching){const T=this.generateCacheKey(t.envelope,d),A=this.requestCache.get(T);if(A&&Date.now()-A.timestamp<(this.config.cacheTTL||300)*1e3){const D=Date.now()-i,_=t.envelope?Buffer.byteLength(t.envelope,"utf8"):void 0,L=A.response.envelope?Buffer.byteLength(A.response.envelope,"utf8"):void 0;return this.recordRequest(d,h,D,!0,_,L),{...A.response,latency:D}}}const p=this.config.timeout?.enabled?this.config.timeout.requestTimeout||this.config.timeout.defaultTimeout||3e4:void 0,g=Date.now(),v=this.executeOperation(d,h,u.body||"",e,s,o,n),b=Date.now()-g;if(p&&b>p)return this.timeoutMetrics.totalTimeouts++,this.timeoutsThisSecond++,this.recordError("timeout",`Operation ${d} exceeded timeout of ${p}ms (took ${b}ms)`,d,h),this.createFaultResponse("Server",`Operation timed out: exceeded ${p}ms (took ${b}ms)`,Date.now()-i);const x=Date.now()-i;let R;if(v.success){if(R=this.createSuccessResponse(d,v.data||{},this.config.soapVersion||"1.1",x,u.headers),this.config.enableCaching){const T=this.generateCacheKey(t.envelope,d);this.requestCache.set(T,{response:R,timestamp:Date.now()})}}else R=this.createFaultResponse("Server",v.error||"Operation failed",x),this.recordError("fault",v.error||"Operation failed",d,h);const C=t.envelope?Buffer.byteLength(t.envelope,"utf8"):void 0,k=R.envelope?Buffer.byteLength(R.envelope,"utf8"):void 0;return this.recordRequest(d,h,x,v.success,C,k),this.finishRequestSpan(o,i,Date.now(),v.success,v.error,n),R}parseSOAPEnvelope(t){try{if(!t||typeof t!="string")return{success:!1,error:"Envelope is empty or invalid"};if(!t.includes("<")||!t.includes(">"))return{success:!1,error:"Invalid XML format"};if(!/<[^:>]*:?Envelope[^>]*>/i.test(t))return{success:!1,error:"SOAP Envelope element not found"};const s=t.includes("http://schemas.xmlsoap.org/soap/envelope/")?"1.1":t.includes("http://www.w3.org/2003/05/soap-envelope")?"1.2":"1.1",n=t.match(/<soap:?Header[^>]*>(.*?)<\/soap:?Header>/is),i=n?n[1]:void 0,o={};if(i){const x=i.match(/<wsa:MessageID[^>]*>(.*?)<\/wsa:MessageID>/is);x&&(o.MessageID=x[1].trim());const R=i.match(/<wsa:To[^>]*>(.*?)<\/wsa:To>/is);R&&(o.To=R[1].trim());const C=i.match(/<wsa:From[^>]*>(.*?)<\/wsa:From>/is);C&&(o.From=C[1].trim());const k=i.match(/<wsa:ReplyTo[^>]*>(.*?)<\/wsa:ReplyTo>/is);k&&(o.ReplyTo=k[1].trim());const T=i.match(/<wsa:Action[^>]*>(.*?)<\/wsa:Action>/is);T&&(o.Action=T[1].trim());const A=i.match(/<wsse:Security[^>]*>(.*?)<\/wsse:Security>/is);A&&(o.Security=A[1].trim())}const r=t.match(/<[^:>]*:?Body[^>]*>(.*?)<\/[^:>]*:?Body>/is);if(!r)return{success:!1,error:"SOAP Body not found"};const u=r[1];if(!u.trim())return{success:!1,error:"SOAP Body is empty"};const d=u.match(/<([^:>\/\s]+:)?([^:>\/\s]+?)(?:Request|Input|Response|Output)?[^>]*>/i),h=d?d[2]:void 0;if(!h){const x=u.match(/<([^:>\/\s]+:)?([^:>\/\s]+)[^>]*>/i);if(x){const C=x[2].replace(/(Request|Response|Input|Output)$/i,"");if(C)return{success:!0,operation:C,service:b,body:u,header:i,soapVersion:s,headers:o,bodyElements:[]}}}const p=[],g=/<([^:>]+:)?([^:>]+)[^>]*>(.*?)<\/\1?\2>/gis;let v;for(;(v=g.exec(u))!==null;){const x=v[2],R=v[3].trim();x&&R&&p.push({name:x,value:R})}let b;if(o.Action){const x=o.Action.split("/");x.length>1&&(b=x[x.length-2])}return{success:!0,operation:h,service:b,body:u,header:i,soapVersion:s,headers:o,bodyElements:p}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to parse SOAP envelope"}}}validateRequest(t,e,s){if(!this.config?.wsdl)return{valid:!0};const n=this.config.wsdl.services?.find(o=>o.name===s);if(!n)return{valid:!1,error:`Service ${s} not found in WSDL`};const i=n.operations.find(o=>o.name===e);if(!i)return{valid:!1,error:`Operation ${e} not found in service ${s}`};if(t.soapVersion&&this.config.soapVersion&&t.soapVersion!==this.config.soapVersion)return{valid:!1,error:`SOAP version mismatch: expected ${this.config.soapVersion}, got ${t.soapVersion}`};if(t.body){if(![new RegExp(`<[^:>]*:?${e}[^>]*>`,"i"),new RegExp(`<[^:>]*:?${e}Request[^>]*>`,"i"),new RegExp(`<[^:>]*:?${e}Input[^>]*>`,"i")].some(h=>h.test(t.body||"")))return{valid:!1,error:`Operation ${e} not found in SOAP Body`};const u=(t.body.match(/<[^\/][^>]*>/g)||[]).length,d=(t.body.match(/<\/[^>]+>/g)||[]).length;if(u!==d)return{valid:!1,error:`XML structure invalid: unbalanced tags (${u} open, ${d} close)`}}if(i.inputMessage&&this.config.wsdl.messages){const o=this.config.wsdl.messages.find(r=>r.name===i.inputMessage);if(o&&t.body)for(const r of o.parts)r.name&&t.body.includes(r.name)}return{valid:!0}}parseWSDL(t){try{const e={services:[],types:[],messages:[],portTypes:[],bindings:[]},s=t.match(/targetNamespace=["']([^"']+)["']/);s&&(e.targetNamespace=s[1]);const n=t.match(/<wsdl:types[^>]*>(.*?)<\/wsdl:types>/is),i=/<wsdl:message[^>]*name=["']([^"']+)["'][^>]*>(.*?)<\/wsdl:message>/gis;let o;for(;(o=i.exec(t))!==null;){const v=o[1],b=o[2],x=[],R=/<wsdl:part[^>]*name=["']([^"']+)["'][^>]*(?:type=["']([^"']+)["']|element=["']([^"']+)["'])/gi;let C;for(;(C=R.exec(b))!==null;)x.push({name:C[1],type:C[2]||C[3]||"string"});e.messages?.push({name:v,parts:x})}const r=/<wsdl:portType[^>]*name=["']([^"']+)["'][^>]*>(.*?)<\/wsdl:portType>/gis;let u;for(;(u=r.exec(t))!==null;){const v=u[1],b=u[2],x=[],R=/<wsdl:operation[^>]*name=["']([^"']+)["'][^>]*>(.*?)<\/wsdl:operation>/gis;let C;for(;(C=R.exec(b))!==null;){const k=C[1],T=C[2],A=T.match(/<wsdl:input[^>]*(?:message=["']([^"']+)["']|name=["']([^"']+)["'])/i),D=T.match(/<wsdl:output[^>]*(?:message=["']([^"']+)["']|name=["']([^"']+)["'])/i),_=T.matchAll(/<wsdl:fault[^>]*(?:message=["']([^"']+)["']|name=["']([^"']+)["'])/gi),L=[];for(const O of _)L.push(O[1]||O[2]||"");x.push({name:k,input:A?.[1]||A?.[2],output:D?.[1]||D?.[2],faults:L.length>0?L:void 0})}e.portTypes?.push({name:v,operations:x})}const d=/<wsdl:binding[^>]*name=["']([^"']+)["'][^>]*(?:type=["']([^"']+)["'])/gi;let h;for(;(h=d.exec(t))!==null;){const v=h[1],b=h[2],x=t.match(new RegExp(`<wsdl:binding[^>]*name=["']${v}["'][^>]*>.*?<soap:binding[^>]*style=["']([^"']+)["']`,"is")),R=t.match(new RegExp(`<wsdl:binding[^>]*name=["']${v}["'][^>]*>.*?<soap:binding[^>]*transport=["']([^"']+)["']`,"is"));e.bindings?.push({name:v,type:b,style:x?.[1],transport:R?.[1]})}const p=/<wsdl:service[^>]*name=["']([^"']+)["'][^>]*>(.*?)<\/wsdl:service>/gis;let g;for(;(g=p.exec(t))!==null;){const v=g[1],b=g[2],R=/<wsdl:port[^>]*name=["']([^"']+)["'][^>]*>.*?<soap:address[^>]*location=["']([^"']+)["']/gis.exec(b),C=R?.[1]||"default",k=R?.[2]||"",T=[];e.services?.push({name:v,port:C,operations:T,endpoint:k})}return e}catch(e){return console.error("Failed to parse WSDL:",e),null}}generateWSDL(){if(!this.config||!this.config.services||this.config.services.length===0)return"";const e=(this.config.soapVersion||"1.1")==="1.1"?"http://schemas.xmlsoap.org/wsdl/soap/":"http://schemas.xmlsoap.org/wsdl/soap12/",s=this.config.wsdl?.targetNamespace||"http://tempuri.org/",n=this.config.endpoint||"/soap";let i=`<?xml version="1.0" encoding="UTF-8"?>
<wsdl:definitions xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
                  xmlns:soap="${e}"
                  xmlns:tns="${s}"
                  targetNamespace="${s}">
  
  <wsdl:types>
    <xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" targetNamespace="${s}">
`;for(const o of this.config.services)for(const r of o.operations)i+=`      <xs:element name="${r.name}Request">
        <xs:complexType>
          <xs:sequence>
            <xs:element name="input" type="xs:string"/>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
      <xs:element name="${r.name}Response">
        <xs:complexType>
          <xs:sequence>
            <xs:element name="output" type="xs:string"/>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
`;i+=`    </xs:schema>
  </wsdl:types>
`;for(const o of this.config.services)for(const r of o.operations)i+=`  <wsdl:message name="${r.name}Request">
    <wsdl:part name="parameters" element="tns:${r.name}Request"/>
  </wsdl:message>
  <wsdl:message name="${r.name}Response">
    <wsdl:part name="parameters" element="tns:${r.name}Response"/>
  </wsdl:message>
`;for(const o of this.config.services){i+=`  <wsdl:portType name="${o.name}PortType">
`;for(const r of o.operations){if(i+=`    <wsdl:operation name="${r.name}">
      <wsdl:input message="tns:${r.name}Request"/>
      <wsdl:output message="tns:${r.name}Response"/>
`,r.faults&&r.faults.length>0)for(const u of r.faults)i+=`      <wsdl:fault name="${u}" message="tns:${u}"/>
`;i+=`    </wsdl:operation>
`}i+=`  </wsdl:portType>
`}for(const o of this.config.services){i+=`  <wsdl:binding name="${o.name}Binding" type="tns:${o.name}PortType">
    <soap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
`;for(const r of o.operations)i+=`    <wsdl:operation name="${r.name}">
      <soap:operation soapAction="${s}${r.name}"/>
      <wsdl:input>
        <soap:body use="literal"/>
      </wsdl:input>
      <wsdl:output>
        <soap:body use="literal"/>
      </wsdl:output>
    </wsdl:operation>
`;i+=`  </wsdl:binding>
`}for(const o of this.config.services)i+=`  <wsdl:service name="${o.name}">
    <wsdl:port name="${o.port||"default"}" binding="tns:${o.name}Binding">
      <soap:address location="${n}"/>
    </wsdl:port>
  </wsdl:service>
`;return i+="</wsdl:definitions>",i}async loadWSDL(t){try{const e=this.parseWSDL(t);return e&&this.config&&(this.config.wsdl=e,e.services&&(this.config.services=e.services.map(s=>({name:s.name,port:s.port,operations:s.operations,wsdlUrl:this.config?.wsdlUrl,endpoint:s.endpoint})))),e}catch(e){return console.error("Failed to load WSDL:",e),null}}validateWSSecurity(t,e){return t.Security?t.Security.includes("Signature")||e.includes("<ds:Signature")||e.includes("<wsse:Signature")?(t.Security.includes("EncryptedData")||e.includes("<xenc:EncryptedData"),Math.random()>.05?{valid:!0}:{valid:!1,error:"WS-Security signature validation failed"}):{valid:!1,error:"WS-Security signature not found"}:{valid:!1,error:"WS-Security header not found"}}processWSAddressing(t){const e=t.MessageID,s=t.ReplyTo,n=t.To;t.From;const i=t.Action;return e?n?i?!e.startsWith("urn:uuid:")&&!e.startsWith("http://")?{success:!1,error:"WS-Addressing MessageID must be a valid URI"}:{success:!0,messageId:e,replyTo:s}:{success:!1,error:"WS-Addressing Action is required"}:{success:!1,error:"WS-Addressing To is required"}:{success:!1,error:"WS-Addressing MessageID is required"}}processMTOM(t){if(!(t.includes("xop:Include")||t.includes('href="cid:')||t.includes("Content-ID:")))return{processed:!1};const s=[],n=/<xop:Include[^>]*href=["']cid:([^"']+)["'][^>]*\/>/gi;let i;for(;(i=n.exec(t))!==null;){const r=i[1];s.push({id:r,content:`[Binary data for ${r}]`})}let o=t;for(const r of s)o=o.replace(new RegExp(`<xop:Include[^>]*href=["']cid:${r.id}["'][^>]*/>`,"gi"),`[Optimized binary data: ${r.id}]`);return{processed:!0,body:o,attachments:s}}executeOperation(t,e,s,n,i,o,r){if(!this.config)return{success:!1,error:"SOAP service not configured"};const u=this.config.services?.find(h=>h.name===e);if(!u)return{success:!1,error:`Service ${e} not found`};const d=u.operations.find(h=>h.name===t);return!d||!d.enabled?{success:!1,error:`Operation ${t} not found or disabled`}:d.targetService&&n&&i?this.simulateTargetServiceCall(d,s,n,i,o,r):(d.latency||this.config.responseLatency,{success:!0,data:this.generateMockResponseData(t)})}simulateTargetServiceCall(t,e,s,n,i,o){if(!t.targetService)return{success:!1,error:"No target service specified"};const r=s.find(d=>d.id===t.targetService);if(!r)return{success:!1,error:`Target service ${t.targetService} not found`};const u=n.find(d=>d.source===this.componentId&&d.target===t.targetService);if(!u)return t.latency,{success:!0,data:this.generateMockResponseData(t.name)};if(this.sendMessageToTarget&&this.componentId)try{const d={id:`soap-msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),source:this.componentId,target:t.targetService,connectionId:u.id,format:"xml",payload:{envelope:e,operation:t.name,soapVersion:this.config?.soapVersion||"1.1"},size:Buffer.byteLength(e,"utf8"),metadata:{contentType:"application/soap+xml",traceContext:i},status:"pending"},h=Date.now(),p=t.latency||this.getTargetComponentLatency(r),g=this.simulateTargetResponse(r,e,t.name),v=p;return{success:!0,data:g}}catch(d){return{success:!1,error:d instanceof Error?d.message:"Failed to call target service"}}return t.latency,{success:!0,data:this.generateMockResponseData(t.name)}}getTargetComponentLatency(t){return{postgresql:10,mysql:15,mongodb:20,redis:5,rest:50,graphql:60,grpc:30}[t.type]||50}simulateTargetResponse(t,e,s){switch(t.type){case"postgresql":case"mysql":return{rows:[{id:1,name:"Result 1",value:100},{id:2,name:"Result 2",value:200}],count:2};case"mongodb":return{documents:[{_id:"1",data:"Result 1"},{_id:"2",data:"Result 2"}]};case"rest":case"graphql":return{data:{result:`Response from ${t.type} for ${s}`,timestamp:Date.now()}};default:return this.generateMockResponseData(s)}}generateMockResponseData(t){return{result:`Response from ${t}`,timestamp:Date.now()}}createSuccessResponse(t,e,s,n,i){const o=s==="1.1"?"http://schemas.xmlsoap.org/soap/envelope/":"http://www.w3.org/2003/05/soap-envelope";let r="";if(this.config?.enableWSAddressing&&i){const d=`urn:uuid:${Date.now()}-${Math.random().toString(36).substr(2,9)}`,h=i.MessageID||"";r=`  <soap:Header>
    <wsa:MessageID xmlns:wsa="http://www.w3.org/2005/08/addressing">${d}</wsa:MessageID>
    <wsa:RelatesTo xmlns:wsa="http://www.w3.org/2005/08/addressing">${h}</wsa:RelatesTo>
    <wsa:To xmlns:wsa="http://www.w3.org/2005/08/addressing">${i.ReplyTo||i.From||"http://www.w3.org/2005/08/addressing/anonymous"}</wsa:To>
    <wsa:Action xmlns:wsa="http://www.w3.org/2005/08/addressing">${i.Action?.replace("Request","Response")||`${this.config.wsdl?.targetNamespace||"http://tempuri.org/"}${t}Response`}</wsa:Action>
  </soap:Header>
`}return{envelope:`<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="${o}">
${r}  <soap:Body>
    <${t}Response>
      ${this.serializeDataToXML(e)}
    </${t}Response>
  </soap:Body>
</soap:Envelope>`,status:200,latency:n,success:!0}}createFaultResponse(t,e,s,n="1.1"){const i=n==="1.1"?"http://schemas.xmlsoap.org/soap/envelope/":"http://www.w3.org/2003/05/soap-envelope",o={code:t,string:e};return{envelope:`<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="${i}">
  <soap:Body>
    <soap:Fault>
      <faultcode>soap:${t}</faultcode>
      <faultstring>${e}</faultstring>
    </soap:Fault>
  </soap:Body>
</soap:Envelope>`,status:500,latency:s,success:!1,fault:o}}createErrorResponse(t,e,s){return{envelope:"",status:e,latency:Date.now()-s,success:!1,error:t}}serializeDataToXML(t){return typeof t=="string"?t:typeof t=="object"&&t!==null?Object.entries(t).map(([e,s])=>`<${e}>${this.serializeDataToXML(s)}</${e}>`).join(""):String(t)}generateCacheKey(t,e){return`${e}:${t.substring(0,100)}`}recordRequest(t,e,s,n){const i=Date.now();this.soapMetrics.totalRequests++,n||this.soapMetrics.totalErrors++,this.latencyHistory.push(s),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const o=this.latencyHistory.reduce((p,g)=>p+g,0);if(this.soapMetrics.averageLatency=o/this.latencyHistory.length,this.soapMetrics.averageResponseTime=this.soapMetrics.averageLatency,this.soapMetrics.errorRate=this.soapMetrics.totalRequests>0?this.soapMetrics.totalErrors/this.soapMetrics.totalRequests*100:0,this.soapMetrics.successRate=100-this.soapMetrics.errorRate,i-this.lastSecondStart>=1e3){this.previousRPS=this.soapMetrics.requestsPerSecond,this.soapMetrics.requestsPerSecond=this.requestsThisSecond,this.throughputHistory.push(this.requestsThisSecond),this.throughputHistory.length>this.MAX_THROUGHPUT_HISTORY&&this.throughputHistory.shift(),this.requestsThisSecond>this.peakRPS&&(this.peakRPS=this.requestsThisSecond,this.peakRPSTime=i);const p=this.previousRPS>0?(this.requestsThisSecond-this.previousRPS)/this.previousRPS*100:0,g=p>5?"increasing":p<-5?"decreasing":"stable";this.soapMetrics.throughputTrends={current:this.requestsThisSecond,previous:this.previousRPS,trend:g,changePercent:p,peak:this.peakRPS,peakTime:this.peakRPSTime},this.requestsThisSecond=0,this.lastSecondStart=i}else this.requestsThisSecond++;const r=`${e}:${t}`,u=this.operationMetrics.get(r);if(u){u.totalCalls++,n||u.totalErrors++,u.totalLatency+=s,u.averageLatency=u.totalLatency/u.totalCalls,u.minLatency=Math.min(u.minLatency,s),u.maxLatency=Math.max(u.maxLatency,s),u.lastCallTime=i,u.errorRate=u.totalCalls>0?u.totalErrors/u.totalCalls*100:0;const p=this.operationCallsThisSecond.get(r)||0;this.operationCallsThisSecond.set(r,p+1)}const d=this.serviceMetrics.get(e);if(d){d.totalRequests++,n||d.totalErrors++,d.averageLatency=(d.averageLatency*(d.totalRequests-1)+s)/d.totalRequests,d.errorRate=d.totalRequests>0?d.totalErrors/d.totalRequests*100:0;const p=this.serviceRequestsThisSecond.get(e)||0;this.serviceRequestsThisSecond.set(e,p+1)}const h={id:`req-${Date.now()}-${Math.random()}`,operation:t,service:e,envelope:"",timestamp:i,duration:s,success:n};this.requestHistory.push(h),this.requestHistory.length>this.MAX_HISTORY_SIZE&&this.requestHistory.shift()}recordError(t,e,s,n){const i=Date.now();let o=this.errorMetrics.get(t);o||(o={category:t,totalErrors:0,errorsPerSecond:0},this.errorMetrics.set(t,o)),o.totalErrors++,o.lastErrorTime=i;const r=this.errorCountsThisSecond.get(t)||0;this.errorCountsThisSecond.set(t,r+1),this.errorHistory.push({timestamp:i,category:t,message:e,operationName:s,serviceName:n}),this.errorHistory.length>this.MAX_TOTAL_ERROR_HISTORY&&this.errorHistory.shift()}checkRateLimit(t){if(!this.config?.rateLimit?.enabled)return!0;const e=t,s=Date.now(),n=this.config.rateLimit.windowMs||1e3,i=this.config.rateLimit.requestsPerSecond||1e3;let o=this.rateLimitCounters.get(e);return(!o||s>=o.resetAt)&&(o={count:0,resetAt:s+n,windowStart:s},this.rateLimitCounters.set(e,o)),o.count>=i?(this.rateLimitMetrics.totalBlockedRequests++,this.rateLimitHitsThisSecond++,!1):(o.count++,!0)}getClientIdentifier(t,e){const s=this.config?.rateLimit?.identifyBy||"ip";return s==="ip"&&t?`ip:${t}`:s==="apiKey"&&e?.["X-API-Key"]?`apikey:${e["X-API-Key"]}`:s==="user"&&e?.["X-User-Id"]?`user:${e["X-User-Id"]}`:"default"}createRequestSpan(t,e,s){if(!s||s().size===0)return;const i=this.generateTraceId(),o=this.generateSpanId(),r={traceId:i,spanId:o,parentSpanId:void 0};return this.traceContexts.set(i,r),r}finishRequestSpan(t,e,s,n,i,o){if(!t||!o)return;const r=o();if(r.size===0)return;const u=(s-e)*1e3,d=e*1e3,h={traceId:t.traceId,spanId:t.spanId,parentSpanId:t.parentSpanId,operationName:"soap.request",serviceName:this.componentId||"soap",startTime:d,duration:u,tags:[{key:"component.type",value:"soap"},{key:"soap.operation",value:"unknown"},{key:"status",value:n?"success":"error"}],logs:[]};i&&(h.tags.push({key:"error",value:!0}),h.logs.push({timestamp:d+u,fields:[{key:"event",value:"error"},{key:"error.message",value:i}]}));for(const p of r.values())p&&typeof p.addSpan=="function"&&p.addSpan(h)}generateTraceId(){return`trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${++this.spanIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}calculatePercentile(t,e){if(t.length===0)return 0;if(t.length===1)return t[0];const s=e/100*(t.length-1),n=Math.floor(s),i=Math.ceil(s),o=s-n;return n===i?t[n]:t[n]*(1-o)+t[i]*o}updateRequestSizeDistribution(){const e=[{range:"0-1KB",min:0,max:1024},{range:"1-5KB",min:1024,max:5120},{range:"5-10KB",min:5120,max:10240},{range:"10-50KB",min:10240,max:51200},{range:"50-100KB",min:51200,max:102400},{range:"100KB+",min:102400,max:1/0}].map(s=>({range:s.range,count:0}));this.requestSizeMetrics.sizeDistribution=e}updateMetricsPerSecond(){const t=Date.now();if(!(t-this.lastMetricsSecondStart<1e3)){for(const[e,s]of this.operationCallsThisSecond.entries()){const n=this.operationMetrics.get(e);n&&(n.callsPerSecond=s)}this.operationCallsThisSecond.clear();for(const[e,s]of this.serviceRequestsThisSecond.entries()){const n=this.serviceMetrics.get(e);n&&(n.requestsPerSecond=s)}this.serviceRequestsThisSecond.clear();for(const[e,s]of this.errorCountsThisSecond.entries()){const n=this.errorMetrics.get(e);n&&(n.errorsPerSecond=s)}this.errorCountsThisSecond.clear(),t-this.lastRateLimitSecondStart>=1e3&&(this.rateLimitMetrics.blockedRequestsPerSecond=this.blockedRequestsThisSecond,this.rateLimitMetrics.rateLimitHitsPerSecond=this.rateLimitHitsThisSecond,this.blockedRequestsThisSecond=0,this.rateLimitHitsThisSecond=0,this.lastRateLimitSecondStart=t),t-this.lastTimeoutSecondStart>=1e3&&(this.timeoutMetrics.timeoutsPerSecond=this.timeoutsThisSecond,this.timeoutsThisSecond=0,this.lastTimeoutSecondStart=t),this.lastMetricsSecondStart=t}}getSOAPMetrics(){this.updateMetricsPerSecond(),this.updateRequestSizeDistribution();const t=[...this.latencyHistory].sort((i,o)=>i-o),e=t.length>0?this.calculatePercentile(t,this.PERCENTILE_P50):void 0,s=t.length>0?this.calculatePercentile(t,this.PERCENTILE_P95):void 0,n=t.length>0?this.calculatePercentile(t,this.PERCENTILE_P99):void 0;return{...this.soapMetrics,latencyP50:e,latencyP95:s,latencyP99:n,operationMetrics:Array.from(this.operationMetrics.values()),serviceMetrics:Array.from(this.serviceMetrics.values()),errorMetrics:Array.from(this.errorMetrics.values()),rateLimitMetrics:{...this.rateLimitMetrics},timeoutMetrics:{...this.timeoutMetrics},wsSecurityMetrics:{...this.wsSecurityMetrics},wsAddressingMetrics:{...this.wsAddressingMetrics},mtomMetrics:{...this.mtomMetrics},requestSizeMetrics:{...this.requestSizeMetrics},throughputTrends:this.soapMetrics.throughputTrends}}resetMetrics(){this.soapMetrics={requestsPerSecond:0,averageResponseTime:0,totalRequests:0,totalErrors:0,errorRate:0,successRate:0,averageLatency:0},this.requestHistory=[],this.latencyHistory=[],this.operationMetrics.clear(),this.serviceMetrics.clear(),this.errorMetrics.clear(),this.errorHistory=[],this.rateLimitMetrics={totalBlockedRequests:0,blockedRequestsPerSecond:0,totalRateLimitHits:0,rateLimitHitsPerSecond:0},this.timeoutMetrics={totalTimeouts:0,timeoutsPerSecond:0},this.wsSecurityMetrics={totalValidations:0,successfulValidations:0,failedValidations:0,validationSuccessRate:0,signaturesProcessed:0,encryptionsProcessed:0},this.wsAddressingMetrics={totalMessages:0,messagesWithAddressing:0,asyncResponses:0,addressingUsageRate:0},this.mtomMetrics={totalMessages:0,messagesWithMTOM:0,totalAttachments:0,averageAttachmentsPerMessage:0,mtomUsageRate:0},this.requestSizeMetrics={totalRequests:0,averageRequestSize:0,minRequestSize:1/0,maxRequestSize:0,totalBytesReceived:0,totalBytesSent:0,averageResponseSize:0,sizeDistribution:[]},this.throughputHistory=[],this.previousRPS=0,this.peakRPS=0,this.peakRPSTime=0,this.requestCache.clear()}getThroughputHistory(t=60){return this.throughputHistory.slice(-t)}getLatencyHistory(t=500){return this.latencyHistory.slice(-t)}getRequestHistory(t=100){return this.requestHistory.slice(-t)}getOperationMetrics(t,e){return this.operationMetrics.get(`${t}:${e}`)}getServiceMetrics(t){return this.serviceMetrics.get(t)}getErrorHistory(t=100){return this.errorHistory.slice(-t)}getWSDL(){return this.config?.wsdl}setWSDL(t){if(this.config&&(this.config.wsdl=t,t.services)){this.config.services=t.services.map(e=>({name:e.name,port:e.port,operations:e.operations,wsdlUrl:this.config?.wsdlUrl,endpoint:e.endpoint}));for(const e of t.services){this.initializeServiceMetrics(e.name);for(const s of e.operations)this.initializeOperationMetrics(e.name,s.name)}}}getWSDLXML(){return this.generateWSDL()}validateWSDL(t){const e=[];(!t.services||t.services.length===0)&&e.push("WSDL must contain at least one service");for(const s of t.services||[]){s.name||e.push("Service must have a name"),(!s.operations||s.operations.length===0)&&e.push(`Service ${s.name} must have at least one operation`);for(const n of s.operations)n.name||e.push(`Operation in service ${s.name} must have a name`)}return{valid:e.length===0,errors:e.length>0?e:void 0}}}class mk{config=null;wsMetrics={connectionsTotal:0,connectionsActive:0,connectionsPerSecond:0,messagesPerSecond:0,messagesTotal:0,messagesSent:0,messagesReceived:0,bytesSent:0,bytesReceived:0,averageLatency:0,errorRate:0,connectionErrorRate:0,pingPongSuccessRate:1,compressionRatio:.5,roomsCount:0,subscriptionsCount:0,averageConnectionsPerRoom:0,averageSubscriptionsPerConnection:0,utilization:0};connections=new Map;rooms=new Map;subscriptions=new Map;messageHistory=[];MAX_HISTORY_SIZE=1e3;latencyHistory=[];MAX_LATENCY_HISTORY=500;lastSecondStart=Date.now();connectionsThisSecond=0;messagesThisSecond=0;rateLimitWindowStart=Date.now();rateLimitConnectionsInWindow=0;rateLimitMessagesInWindow=0;connectionMetrics=new Map;roomMetrics=new Map;subscriptionMetrics=new Map;componentId=null;sendMessageToTarget;simulatedConnectionRate=0;simulatedMessageRate=0;lastSimulationTime=Date.now();pingPongHistory=[];MAX_PING_PONG_HISTORY=100;initialize(t,e){this.componentId=t.id,this.sendMessageToTarget=e;const s=t.data.config||{};if(this.config={endpoint:s.endpoint||"ws://localhost:8080/ws",protocol:s.protocol||"ws",enableCompression:s.enableCompression??!0,enablePingPong:s.enablePingPong??!0,pingInterval:s.pingInterval||30,maxConnections:s.maxConnections||1e3,maxMessageSize:s.maxMessageSize||1024,roomsEnabled:s.roomsEnabled??!0,subscriptionsEnabled:s.subscriptionsEnabled??!0,authentication:s.authentication||{enabled:!1,method:"none"},rateLimit:s.rateLimit||{enabled:!1,messagesPerSecond:1e3,connectionsPerSecond:100},...s},s.connections)for(const n of s.connections)n.status==="connected"&&this.connections.set(n.id,{...n});if(s.rooms)for(const n of s.rooms)this.rooms.set(n.id,{...n});if(s.subscriptions)for(const n of s.subscriptions)n.enabled&&this.subscriptions.set(n.id,{...n});s.messages&&(this.messageHistory=s.messages.slice(-this.MAX_HISTORY_SIZE))}updateMetrics(t,e){if(!this.config)return;const s=Date.now(),n=(s-this.lastSimulationTime)/1e3;if(!t){this.simulatedConnectionRate=Math.max(0,this.simulatedConnectionRate*.95),this.simulatedMessageRate=Math.max(0,this.simulatedMessageRate*.95),this.closeIdleConnections(),this.lastSimulationTime=s,this.calculateMetrics();return}if(n>0){const i=this.simulatedConnectionRate||5,o=Math.floor(i*n);for(let p=0;p<o;p++)this.connections.size<(this.config.maxConnections||1e3)&&this.simulateNewConnection();const r=Array.from(this.connections.values()).filter(p=>p.status==="connected"),d=(this.simulatedMessageRate||50)/Math.max(1,r.length),h=Math.floor(d*r.length*n);for(let p=0;p<h&&p<r.length*10;p++){const g=r[Math.floor(Math.random()*r.length)];g&&this.simulateMessage(g.id,"received")}}this.config.enablePingPong&&this.processPingPong(),this.updateConnectionMetrics(),this.updateRoomMetrics(),this.updateSubscriptionMetrics(),this.calculateMetrics(),this.lastSimulationTime=s}createConnection(t,e){if(!this.config||this.connections.size>=(this.config.maxConnections||1e3)||this.config.authentication?.enabled&&!this.authenticateConnection())return!1;const s=Date.now(),n={id:t,status:"connected",connectedAt:s,messagesSent:0,messagesReceived:0,bytesSent:0,bytesReceived:0,lastMessageAt:s,subscriptions:e?.subscriptions||[],authenticated:!0,authMethod:this.config.authentication?.method||"none",latency:10+Math.random()*20,clientIP:e?.clientIP,userAgent:e?.userAgent,roomId:e?.roomId};if(this.connections.set(t,n),this.wsMetrics.connectionsTotal++,this.connectionsThisSecond++,e?.roomId&&this.config.roomsEnabled){const i=this.rooms.get(e.roomId);i&&!i.connections.includes(t)&&i.connections.push(t)}if(e?.subscriptions&&this.config.subscriptionsEnabled)for(const i of e.subscriptions){const o=this.subscriptions.get(i);o&&o.enabled&&!o.connections.includes(t)&&o.connections.push(t)}return!0}closeConnection(t){const e=this.connections.get(t);if(e){if(e.status="disconnected",e.disconnectedAt=Date.now(),e.roomId){const s=this.rooms.get(e.roomId);s&&(s.connections=s.connections.filter(n=>n!==t))}for(const s of e.subscriptions){const n=this.subscriptions.get(s);n&&(n.connections=n.connections.filter(i=>i!==t))}}}simulateNewConnection(){if(!this.config)return;const t=Date.now();if(this.config.rateLimit?.enabled){t-this.rateLimitWindowStart>=1e3&&(this.rateLimitWindowStart=t,this.rateLimitConnectionsInWindow=0,this.rateLimitMessagesInWindow=0);const r=this.config.rateLimit.connectionsPerSecond||100;if(this.rateLimitConnectionsInWindow>=r){this.wsMetrics.connectionsTotal++,this.wsMetrics.connectionErrorRate=this.wsMetrics.connectionErrorRate*.9+.1*1;return}this.rateLimitConnectionsInWindow++}const e=`ws-conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;let s=!0;if(this.config.authentication?.enabled&&(s=this.authenticateConnection()),!s){this.wsMetrics.connectionsTotal++,this.wsMetrics.connectionErrorRate=this.wsMetrics.connectionErrorRate*.9+.1*1;return}const n={id:e,status:"connected",connectedAt:t,messagesSent:0,messagesReceived:0,bytesSent:0,bytesReceived:0,lastMessageAt:t,subscriptions:[],authenticated:!0,authMethod:this.config.authentication?.method||"none",latency:10+Math.random()*20};if(this.connections.set(e,n),this.wsMetrics.connectionsTotal++,this.connectionsThisSecond++,this.config.roomsEnabled&&this.rooms.size>0){const i=Array.from(this.rooms.keys()),o=i[Math.floor(Math.random()*i.length)];if(o){const r=this.rooms.get(o);r&&(r.connections.push(e),n.roomId=o)}}if(this.config.subscriptionsEnabled&&this.subscriptions.size>0){const i=Array.from(this.subscriptions.keys()).filter(r=>this.subscriptions.get(r)?.enabled),o=i[Math.floor(Math.random()*i.length)];if(o){const r=this.subscriptions.get(o);r&&(r.connections.push(e),n.subscriptions.push(o))}}}simulateMessage(t,e){if(!this.config)return;const s=this.connections.get(t);if(!s||s.status!=="connected")return;const n=Date.now();if(this.config.rateLimit?.enabled){n-this.rateLimitWindowStart>=1e3&&(this.rateLimitWindowStart=n,this.rateLimitConnectionsInWindow=0,this.rateLimitMessagesInWindow=0);const h=this.config.rateLimit.messagesPerSecond||1e3;if(this.rateLimitMessagesInWindow>=h){const p={id:`ws-msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,connectionId:t,type:"text",content:"Rate limit exceeded",timestamp:n,direction:e,size:0,error:"Rate limit exceeded"};this.messageHistory.push(p),this.messageHistory.length>this.MAX_HISTORY_SIZE&&this.messageHistory.shift();return}this.rateLimitMessagesInWindow++}const i=100+Math.random()*900,o=s.latency||10+Math.random()*20,r={id:`ws-msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,connectionId:t,type:Math.random()>.9?"binary":"text",content:e==="sent"?"Message sent":"Message received",timestamp:n,direction:e,size:i,compressed:this.config.enableCompression&&Math.random()>.5,latency:o,roomId:s.roomId};if(e==="sent"?(s.messagesSent++,s.bytesSent+=i):(s.messagesReceived++,s.bytesReceived+=i),s.lastMessageAt=n,this.messageHistory.push(r),this.messageHistory.length>this.MAX_HISTORY_SIZE&&this.messageHistory.shift(),this.wsMetrics.messagesTotal++,this.messagesThisSecond++,e==="sent"?(this.wsMetrics.messagesSent++,this.wsMetrics.bytesSent+=i):(this.wsMetrics.messagesReceived++,this.wsMetrics.bytesReceived+=i),this.latencyHistory.push(o),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift(),s.roomId&&this.config.roomsEnabled){const u=this.rooms.get(s.roomId);if(u){u.messagesBroadcast++;const d=u.connections.filter(h=>h!==t);for(const h of d.slice(0,5)){const p=this.connections.get(h);p&&p.status==="connected"&&(p.messagesReceived++,p.bytesReceived+=i)}}}if(s.subscriptions.length>0&&this.config.subscriptionsEnabled)for(const u of s.subscriptions){const d=this.subscriptions.get(u);if(d&&d.enabled){d.messagesDelivered++;const h=d.connections.filter(p=>p!==t);for(const p of h.slice(0,10)){const g=this.connections.get(p);g&&g.status==="connected"&&(g.messagesReceived++,g.bytesReceived+=i)}}}}processPingPong(){if(!this.config)return;const t=Date.now(),e=(this.config.pingInterval||30)*1e3;for(const s of this.connections.values()){if(s.status!=="connected")continue;const n=s.lastPingAt||s.connectedAt||0;t-n>=e&&(s.lastPingAt=t,Math.random()>.1?(s.lastPongAt=t,this.pingPongHistory.push({timestamp:t,success:!0})):(this.pingPongHistory.push({timestamp:t,success:!1}),s.status="disconnected",s.disconnectedAt=t),this.pingPongHistory.length>this.MAX_PING_PONG_HISTORY&&this.pingPongHistory.shift())}}closeIdleConnections(){const t=Date.now(),e=3e5;for(const s of this.connections.values()){if(s.status!=="connected")continue;const n=s.lastMessageAt||s.connectedAt||0;t-n>e&&(s.status="disconnected",s.disconnectedAt=t)}}authenticateConnection(){if(!this.config?.authentication?.enabled)return!0;switch(this.config.authentication.method){case"token":return Math.random()>.1;case"apiKey":return Math.random()>.05;case"basic":return Math.random()>.15;default:return!0}}updateConnectionMetrics(){const t=Date.now();for(const e of this.connections.values()){if(e.status!=="connected")continue;const s={connectionId:e.id,messagesSent:e.messagesSent,messagesReceived:e.messagesReceived,bytesSent:e.bytesSent,bytesReceived:e.bytesReceived,averageLatency:e.latency||0,uptime:e.connectedAt?(t-e.connectedAt)/1e3:0,lastActivity:e.lastMessageAt||e.connectedAt||0};this.connectionMetrics.set(e.id,s)}}updateRoomMetrics(){for(const t of this.rooms.values()){const e=t.connections.filter(n=>this.connections.get(n)?.status==="connected"),s={roomId:t.id,connectionsCount:e.length,messagesBroadcast:t.messagesBroadcast,averageLatency:15+Math.random()*10};this.roomMetrics.set(t.id,s)}}updateSubscriptionMetrics(){for(const t of this.subscriptions.values()){if(!t.enabled)continue;const e=t.connections.filter(n=>this.connections.get(n)?.status==="connected"),s={subscriptionId:t.id,connectionsCount:e.length,messagesDelivered:t.messagesDelivered,averageLatency:20+Math.random()*15};this.subscriptionMetrics.set(t.id,s)}}calculateMetrics(){const t=Date.now(),e=(t-this.lastSecondStart)/1e3;if(e>=1&&(this.wsMetrics.connectionsPerSecond=this.connectionsThisSecond/e,this.wsMetrics.messagesPerSecond=this.messagesThisSecond/e,this.connectionsThisSecond=0,this.messagesThisSecond=0,this.lastSecondStart=t),this.wsMetrics.connectionsActive=Array.from(this.connections.values()).filter(d=>d.status==="connected").length,this.latencyHistory.length>0){const d=this.latencyHistory.reduce((p,g)=>p+g,0);this.wsMetrics.averageLatency=d/this.latencyHistory.length;const h=[...this.latencyHistory].sort((p,g)=>p-g);this.wsMetrics.latencyP50=h[Math.floor(h.length*.5)],this.wsMetrics.latencyP95=h[Math.floor(h.length*.95)],this.wsMetrics.latencyP99=h[Math.floor(h.length*.99)]}const s=this.wsMetrics.connectionsTotal,n=Array.from(this.connections.values()).filter(d=>d.status==="error"||d.status==="disconnected").length;if(this.wsMetrics.connectionErrorRate=s>0?n/s:0,this.pingPongHistory.length>0){const d=this.pingPongHistory.filter(h=>h.success).length;this.wsMetrics.pingPongSuccessRate=d/this.pingPongHistory.length}const i=this.messageHistory.filter(d=>d.compressed).length;if(this.wsMetrics.compressionRatio=this.messageHistory.length>0?i/this.messageHistory.length:.5,this.wsMetrics.roomsCount=this.rooms.size,this.wsMetrics.subscriptionsCount=Array.from(this.subscriptions.values()).filter(d=>d.enabled).length,this.rooms.size>0){const d=Array.from(this.rooms.values()).reduce((h,p)=>h+p.connections.length,0);this.wsMetrics.averageConnectionsPerRoom=d/this.rooms.size}if(this.wsMetrics.connectionsActive>0){const d=Array.from(this.connections.values()).reduce((h,p)=>h+p.subscriptions.length,0);this.wsMetrics.averageSubscriptionsPerConnection=d/this.wsMetrics.connectionsActive}const o=this.config?.maxConnections||1e3;this.wsMetrics.utilization=Math.min(1,this.wsMetrics.connectionsActive/o);const r=this.wsMetrics.messagesTotal,u=this.messageHistory.filter(d=>d.error).length;this.wsMetrics.errorRate=r>0?u/r:0}getWebSocketMetrics(){return{...this.wsMetrics}}getConnectionMetrics(){return Array.from(this.connectionMetrics.values())}getRoomMetrics(){return Array.from(this.roomMetrics.values())}getSubscriptionMetrics(){return Array.from(this.subscriptionMetrics.values())}getActiveConnections(){return Array.from(this.connections.values()).filter(t=>t.status==="connected")}getRooms(){return Array.from(this.rooms.values())}getSubscriptions(){return Array.from(this.subscriptions.values()).filter(t=>t.enabled)}getMessageHistory(t=100){return this.messageHistory.slice(-t)}processIncomingMessage(t,e,s,n="received"){if(!this.config)return{processed:!1,error:"Configuration not initialized"};const i=this.connections.get(t);if(!i||i.status!=="connected")return{processed:!1,error:"Connection not found or not connected"};const o=Date.now(),r=typeof e=="string"?e:JSON.stringify(e),u=new Blob([r]).size,d=(this.config.maxMessageSize||1024)*1024;if(u>d){const g={id:`ws-msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,connectionId:t,type:"text",content:"Message size exceeds maximum",timestamp:o,direction:n,size:u,error:`Message size ${u} bytes exceeds maximum ${d} bytes`};return this.messageHistory.push(g),this.messageHistory.length>this.MAX_HISTORY_SIZE&&this.messageHistory.shift(),this.wsMetrics.errorRate=this.wsMetrics.errorRate*.9+.1*1,{processed:!1,error:`Message size exceeds maximum ${d} bytes`}}if(this.config.rateLimit?.enabled){o-this.rateLimitWindowStart>=1e3&&(this.rateLimitWindowStart=o,this.rateLimitConnectionsInWindow=0,this.rateLimitMessagesInWindow=0);const b=this.config.rateLimit.messagesPerSecond||1e3;if(this.rateLimitMessagesInWindow>=b){const x={id:`ws-msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,connectionId:t,type:"text",content:"Rate limit exceeded",timestamp:o,direction:n,size:u,error:"Rate limit exceeded"};return this.messageHistory.push(x),this.messageHistory.length>this.MAX_HISTORY_SIZE&&this.messageHistory.shift(),this.wsMetrics.errorRate=this.wsMetrics.errorRate*.9+.1*1,{processed:!1,error:"Rate limit exceeded"}}this.rateLimitMessagesInWindow++}const h={id:`ws-msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,connectionId:t,type:typeof e=="string"?"text":"binary",content:r,timestamp:o,direction:n,size:u,compressed:this.config.enableCompression&&Math.random()>.5,latency:i.latency||10+Math.random()*20,roomId:i.roomId};n==="sent"?(i.messagesSent++,i.bytesSent+=u):(i.messagesReceived++,i.bytesReceived+=u),i.lastMessageAt=o,this.messageHistory.push(h),this.messageHistory.length>this.MAX_HISTORY_SIZE&&this.messageHistory.shift(),this.wsMetrics.messagesTotal++,n==="sent"?(this.wsMetrics.messagesSent++,this.wsMetrics.bytesSent+=u):(this.wsMetrics.messagesReceived++,this.wsMetrics.bytesReceived+=u),this.messagesThisSecond++,h.latency&&(this.latencyHistory.push(h.latency),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift());const p={processed:!0};if(i.roomId&&this.config.roomsEnabled){const g=this.rooms.get(i.roomId);if(g){g.messagesBroadcast++,h.roomId=i.roomId,p.broadcastToRoom=i.roomId;const v=g.connections.filter(b=>b!==t);for(const b of v){const x=this.connections.get(b);x&&x.status==="connected"&&(x.messagesReceived++,x.bytesReceived+=u)}}}if(i.subscriptions.length>0&&this.config.subscriptionsEnabled){const g=[];for(const v of i.subscriptions){const b=this.subscriptions.get(v);if(b&&b.enabled){b.messagesDelivered++,h.subscriptionId=v,g.push(v);const x=b.connections.filter(R=>R!==t);for(const R of x){const C=this.connections.get(R);C&&C.status==="connected"&&(C.messagesReceived++,C.bytesReceived+=u)}}}g.length>0&&(p.deliveredToSubscriptions=g)}if(this.sendMessageToTarget&&this.componentId){const g=s?.targetIds||[];if(g.length>0){for(const v of g){const b={id:`ws-forward-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,source:this.componentId,target:v,payload:e,format:typeof e=="string"?"text":"json",timestamp:o,status:"in_transit",metadata:{...s,connectionId:t,roomId:i.roomId,subscriptions:i.subscriptions}};this.sendMessageToTarget(this.componentId,v,b).catch(()=>{})}p.forwarded=!0}}return p}resetMetrics(){this.wsMetrics={connectionsTotal:0,connectionsActive:0,connectionsPerSecond:0,messagesPerSecond:0,messagesTotal:0,messagesSent:0,messagesReceived:0,bytesSent:0,bytesReceived:0,averageLatency:0,errorRate:0,connectionErrorRate:0,pingPongSuccessRate:1,compressionRatio:.5,roomsCount:0,subscriptionsCount:0,averageConnectionsPerRoom:0,averageSubscriptionsPerConnection:0,utilization:0},this.messageHistory=[],this.latencyHistory=[],this.pingPongHistory=[],this.connectionsThisSecond=0,this.messagesThisSecond=0}updateConfig(t){if(this.config?this.config={...this.config,...t}:this.config={endpoint:t.endpoint||"ws://localhost:8080/ws",protocol:t.protocol||"ws",enableCompression:t.enableCompression??!0,enablePingPong:t.enablePingPong??!0,pingInterval:t.pingInterval||30,maxConnections:t.maxConnections||1e3,maxMessageSize:t.maxMessageSize||1024,roomsEnabled:t.roomsEnabled??!0,subscriptionsEnabled:t.subscriptionsEnabled??!0,authentication:t.authentication||{enabled:!1,method:"none"},rateLimit:t.rateLimit||{enabled:!1,messagesPerSecond:1e3,connectionsPerSecond:100},...t},t.rooms!==void 0){this.rooms.clear();for(const e of t.rooms)this.rooms.set(e.id,{...e})}if(t.subscriptions!==void 0){this.subscriptions.clear();for(const e of t.subscriptions)e.enabled&&this.subscriptions.set(e.id,{...e})}if(t.maxConnections!==void 0&&this.connections.size>t.maxConnections){const s=Array.from(this.connections.entries()).sort((n,i)=>(n[1].connectedAt||0)-(i[1].connectedAt||0)).slice(0,this.connections.size-t.maxConnections);for(const[n]of s){const i=this.connections.get(n);i&&(i.status="disconnected",i.disconnectedAt=Date.now())}}}}class yk{config=null;receivers=new Map;processors=new Map;exporters=new Map;pipelines=new Map;metricsReceived=0;tracesReceived=0;logsReceived=0;metricsExported=0;tracesExported=0;logsExported=0;initializeConfig(t){const e=t.data.config||{};if(this.config={receivers:Array.isArray(e.receivers)?e.receivers:[],processors:Array.isArray(e.processors)?e.processors:[],exporters:Array.isArray(e.exporters)?e.exporters:[],pipelines:Array.isArray(e.pipelines)?e.pipelines:[]},this.receivers.clear(),this.config.receivers)for(const s of this.config.receivers)s.id&&this.receivers.set(s.id,s);if(this.processors.clear(),this.config.processors)for(const s of this.config.processors)s.id&&this.processors.set(s.id,s);if(this.exporters.clear(),this.config.exporters)for(const s of this.config.exporters)s.id&&this.exporters.set(s.id,s);if(this.pipelines.clear(),this.config.pipelines)for(const s of this.config.pipelines)s.id&&this.pipelines.set(s.id,s)}processMessage(t,e){const s=Date.now();try{const n=this.determineDataType(t,e),i=Array.from(this.pipelines.values()).filter(o=>o.type===n&&o.enabled!==!1);if(i.length===0)return{success:!0,latency:Date.now()-s};for(const o of i){if(o.receivers.map(p=>this.receivers.get(p)).filter(p=>p&&p.enabled).length===0)continue;let u=t.payload;const d=o.processors.map(p=>this.processors.get(p)).filter(p=>p&&p.enabled);for(const p of d)u=this.applyProcessor(p,u);const h=o.exporters.map(p=>this.exporters.get(p)).filter(p=>p&&p.enabled);for(const p of h)this.applyExporter(p,u,n);n==="metrics"?(this.metricsReceived++,this.metricsExported+=h.length):n==="traces"?(this.tracesReceived++,this.tracesExported+=h.length):n==="logs"&&(this.logsReceived++,this.logsExported+=h.length)}return{success:!0,latency:Date.now()-s}}catch(n){return{success:!1,latency:Date.now()-s,error:n instanceof Error?n.message:"Unknown error"}}}determineDataType(t,e){if(e){const s=e.type?.toLowerCase()||"";if(s.includes("prometheus")||s.includes("metric"))return"metrics";if(s.includes("jaeger")||s.includes("trace"))return"traces";if(s.includes("loki")||s.includes("log"))return"logs"}if(t.format){const s=t.format.toLowerCase();if(s.includes("prometheus")||s.includes("metric"))return"metrics";if(s.includes("jaeger")||s.includes("trace")||s.includes("zipkin"))return"traces";if(s.includes("log"))return"logs"}return"traces"}applyProcessor(t,e){switch(t.type){case"batch":return e;case"memory_limiter":return e;case"filter":return e;case"transform":return e;case"resource":return e;case"attributes":return e;default:return e}}applyExporter(t,e,s){t.type}getMetrics(){return{metricsReceived:this.metricsReceived,tracesReceived:this.tracesReceived,logsReceived:this.logsReceived,metricsExported:this.metricsExported,tracesExported:this.tracesExported,logsExported:this.logsExported,receiversCount:this.receivers.size,processorsCount:this.processors.size,exportersCount:this.exporters.size,pipelinesCount:this.pipelines.size}}resetMetrics(){this.metricsReceived=0,this.tracesReceived=0,this.logsReceived=0,this.metricsExported=0,this.tracesExported=0,this.logsExported=0}}class vk{config=null;incidents=new Map;incidentState=new Map;metrics={notificationsSent:0,escalationsTriggered:0,acknowledgements:0,totalAckLatency:0,totalAckCount:0,totalResolveLatency:0,totalResolveCount:0,apiRequests:0,webhookCalls:0,errors:0};initializeFromNode(t){const e=t.data.config||{},s=(e.services||[]).map(o=>({id:String(o.id??o.name??"service"),name:String(o.name??"service"),integrationKey:o.integrationKey,status:o.status??"active",escalationPolicy:o.escalationPolicy??e.escalationPolicy??"default-policy",autoResolve:o.autoResolve??e.enableAutoResolve??!0,resolveTimeout:o.resolveTimeout??e.resolveTimeout??300})),n=(e.escalationPolicies||[]).map(o=>({id:String(o.id??o.name??"policy"),name:String(o.name??"policy"),levels:Array.isArray(o.levels)?o.levels.map((r,u)=>({level:typeof r.level=="number"?r.level:u+1,timeout:typeof r.timeout=="number"?r.timeout:5,targets:Array.isArray(r.targets)?r.targets.map(d=>String(d)):[]})):[]})),i=(e.onCallUsers||[]).map(o=>({id:String(o.id??o.email??o.name??"user"),name:String(o.name??"On-Call User"),email:String(o.email??"user@example.com"),status:o.status==="off-call"?"off-call":"on-call"}));this.config={services:s,escalationPolicies:n,onCallUsers:i,severityMapping:e.severityMapping??"standard",enableAutoResolve:e.enableAutoResolve??!0,resolveTimeout:e.resolveTimeout??300}}processAlerts(t,e){if(!(!this.config||e.length===0))for(const s of e){const n=this.findServiceForAlert(s);if(!n||n.status==="disabled")continue;const i=this.mapSeverity(s),o=this.findExistingIncident(s,n);if(o)o.lastSignalAt=t,o.alertIds=Array.from(new Set([...o.alertIds||[],s.id])),this.incidents.set(o.id,o),this.metrics.apiRequests++;else{const r=`inc-${Date.now()}-${Math.floor(Math.random()*1e3)}`,u={id:r,title:s.title,serviceId:n.id,status:"triggered",severity:i,createdAt:t,lastSignalAt:t,alertIds:[s.id]};this.incidents.set(r,u),this.incidentState.set(r,{escalationLevelIndex:0,lastEscalationAt:t}),this.metrics.apiRequests++,this.triggerEscalation(t,u,n)}}}advanceTime(t){if(this.config)for(const[e,s]of this.incidents.entries()){if(s.status==="resolved")continue;const n=this.config.services.find(g=>g.id===s.serviceId);if(!n)continue;const i=n.autoResolve??this.config.enableAutoResolve,o=(n.resolveTimeout??this.config.resolveTimeout)*1e3;if(i&&s.status!=="resolved"&&s.lastSignalAt&&t-s.lastSignalAt>=o){this.resolveIncident(t,s),this.incidents.set(e,s);continue}const r=this.findEscalationPolicy(n);if(!r||r.levels.length===0)continue;const u=this.incidentState.get(e);if(!u)continue;const d=r.levels[u.escalationLevelIndex];if(!d)continue;const h=d.timeout*60*1e3;s.status==="triggered"&&t-u.lastEscalationAt>=h&&u.escalationLevelIndex<r.levels.length-1&&(u.escalationLevelIndex+=1,u.lastEscalationAt=t,this.incidentState.set(e,u),this.triggerEscalation(t,s,n,u.escalationLevelIndex))}}acknowledgeIncident(t,e){const s=this.incidents.get(e);!s||s.status!=="triggered"||(s.status="acknowledged",s.acknowledgedAt=t,this.incidents.set(e,s),this.metrics.acknowledgements++,this.metrics.totalAckCount++,this.metrics.totalAckLatency+=t-s.createdAt)}resolveIncidentManually(t,e){const s=this.incidents.get(e);!s||s.status==="resolved"||(this.resolveIncident(t,s),this.incidents.set(e,s))}getIncidents(){return Array.from(this.incidents.values())}getMetrics(){const t=Array.from(this.incidents.values()),e=t.length,s=t.filter(x=>x.status!=="resolved").length,n=t.filter(x=>x.status==="resolved").length,i=this.metrics.totalAckCount>0?this.metrics.totalAckLatency/this.metrics.totalAckCount:0,o=this.metrics.totalResolveCount>0?this.metrics.totalResolveLatency/this.metrics.totalResolveCount:0,r=300,u=this.metrics.apiRequests/r,d=this.metrics.webhookCalls/r,h=u+d+s*.1+this.metrics.notificationsSent/r,p=Math.min(.95,.1+h/200),g=Math.min(.95,.2+e/1e3),v=this.metrics.apiRequests+this.metrics.webhookCalls+1,b=this.metrics.errors/v;return{incidentsTotal:e,incidentsActive:s,incidentsResolved:n,notificationsSent:this.metrics.notificationsSent,escalationsTriggered:this.metrics.escalationsTriggered,acknowledgements:this.metrics.acknowledgements,averageAckLatency:i,averageResolveLatency:o,apiRequestsPerSecond:u,webhooksPerSecond:d,errorRate:b,cpuUtilization:p,memoryUtilization:g}}calculateLoad(){const t=this.getMetrics(),e=t.apiRequestsPerSecond+t.webhooksPerSecond+t.incidentsActive/60+t.notificationsSent/300,n=100+(t.averageAckLatency||0)*.01+(t.averageResolveLatency||0)*.005,i=(t.cpuUtilization+t.memoryUtilization)/2;return{throughput:e,latency:n,errorRate:t.errorRate,utilization:i}}findServiceForAlert(t){if(this.config){if(t.nodeLabel){const e=t.nodeLabel.toLowerCase(),s=this.config.services.find(n=>n.name.toLowerCase()===e||e.includes(n.name.toLowerCase()));if(s)return s}if(t.nodeId){const e=this.config.services.find(s=>s.id===t.nodeId);if(e)return e}return this.config.services[0]}}mapSeverity(t){if(!this.config)return"warning";const e=t.type==="critical"?"critical":t.type==="warning"?"warning":"info";switch(this.config.severityMapping){case"error-focused":return e==="warning"?"error":e;case"warning-demoted":return e==="warning"?"info":e;default:return e}}findExistingIncident(t,e){for(const s of this.incidents.values())if(s.serviceId===e.id&&s.status!=="resolved"&&s.title===t.title)return s}findEscalationPolicy(t){if(this.config)return t.escalationPolicy?this.config.escalationPolicies.find(e=>e.id===t.escalationPolicy||e.name===t.escalationPolicy)??this.config.escalationPolicies[0]:this.config.escalationPolicies[0]}resolveIncident(t,e){e.status!=="resolved"&&(e.status="resolved",e.resolvedAt=t,this.metrics.totalResolveCount++,this.metrics.totalResolveLatency+=t-e.createdAt)}triggerEscalation(t,e,s,n=0){if(!this.config)return;const i=this.findEscalationPolicy(s);if(!i)return;const o=i.levels[n];if(!o)return;const r=this.config.onCallUsers.filter(h=>h.status==="on-call"&&o.targets.includes(h.id)),u=r.length>0?r:this.config.onCallUsers,d=Math.max(1,u.length);this.metrics.notificationsSent+=d,this.metrics.escalationsTriggered++,this.metrics.webhookCalls+=1}}class bk{alerts=new Map;alertCallbacks=[];isAnalyzing=!1;onAlert(t){this.alertCallbacks.push(t)}analyze(t,e,s,n){if(this.isAnalyzing)return[];this.isAnalyzing=!0;const i=[];try{for(const o of t){const r=e.get(o.id),u=n.find(d=>d.nodeId===o.id);if(!(!r||!u)){if(u.health==="down"){const d=`down-${o.id}`;if(!this.alerts.has(d)){const h={id:d,type:"critical",title:"Component Down",message:`${o.data.label} is down and not responding`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:1};this.addAlert(h),i.push(h)}}if(r.errorRate>.1){const d=`error-${o.id}`,h=this.alerts.get(d);if(!h||h.acknowledged){const p={id:d,type:"critical",title:"High Error Rate",message:`${o.data.label} has ${(r.errorRate*100).toFixed(1)}% error rate`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.9};this.addAlert(p),i.push(p)}}if(r.latency>2e3){const d=`latency-${o.id}`,h=this.alerts.get(d);if(!h||h.acknowledged){const p={id:d,type:"warning",title:"High Latency",message:`${o.data.label} has latency of ${r.latency.toFixed(0)}ms`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.7};this.addAlert(p),i.push(p)}}if(r.utilization>.9){const d=`utilization-${o.id}`,h=this.alerts.get(d);if(!h||h.acknowledged){const p={id:d,type:"warning",title:"High Utilization",message:`${o.data.label} is at ${(r.utilization*100).toFixed(0)}% capacity`,nodeId:o.id,nodeLabel:o.data.label,timestamp:Date.now(),acknowledged:!1,severity:.6};this.addAlert(p),i.push(p)}}}}for(const[o,r]of s.entries())if(r.bottleneck){const u=`bottleneck-${o}`,d=this.alerts.get(u);if(!d||d.acknowledged){const h={id:u,type:"critical",title:"Connection Bottleneck",message:"Bottleneck detected in connection",timestamp:Date.now(),acknowledged:!1,severity:.85};this.addAlert(h),i.push(h)}}this.cleanupResolvedAlerts(t,e,s,n)}finally{this.isAnalyzing=!1}return i}addAlert(t){this.alerts.set(t.id,t),this.alertCallbacks.forEach(e=>e(t))}cleanupResolvedAlerts(t,e,s,n){new Set(t.map(i=>i.id)),new Set(s.keys());for(const[i,o]of this.alerts.entries()){if(o.acknowledged)continue;let r=!1;if(o.nodeId)if(!t.find(d=>d.id===o.nodeId))r=!0;else{const d=e.get(o.nodeId),h=n.find(p=>p.nodeId===o.nodeId);(i.startsWith("down-")&&h&&h.health!=="down"||i.startsWith("error-")&&d&&d.errorRate<=.1||i.startsWith("latency-")&&d&&d.latency<=2e3||i.startsWith("utilization-")&&d&&d.utilization<=.9)&&(r=!0)}else if(i.startsWith("bottleneck-")){const u=i.replace("bottleneck-",""),d=s.get(u);(!d||!d.bottleneck)&&(r=!0)}r&&this.alerts.delete(i)}}acknowledge(t){const e=this.alerts.get(t);e&&(e.acknowledged=!0,this.alerts.set(t,e))}getAlerts(){return Array.from(this.alerts.values()).filter(t=>!t.acknowledged).sort((t,e)=>e.severity-t.severity)}getAlertsByType(t){return this.getAlerts().filter(e=>e.type===t)}clear(){this.alerts.clear()}}const fo=new bk;class wk{config=null;metrics={loginRequestsTotal:0,loginErrorsTotal:0,tokenRefreshTotal:0,introspectionRequestsTotal:0,userInfoRequestsTotal:0,sessionsCreatedTotal:0,sessionsExpiredTotal:0,activeSessions:0};sessions=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(t){const e=t.data.config||{},s=Array.isArray(e.clients)?e.clients.map(i=>({id:String(i.id??i.clientId??"client"),name:String(i.name??i.id??"Client"),type:i.type??"public",enabled:i.enabled??!0,protocol:i.protocol??"openid-connect"})):[{id:"archiphoenix-app",name:"ArchiPhoenix App",type:"public",enabled:!0,protocol:"openid-connect"}],n=Array.isArray(e.users)?e.users.map(i=>({id:String(i.id??i.username??"user"),username:String(i.username??`user-${i.id??"1"}`),email:i.email?String(i.email):void 0,enabled:i.enabled??!0,roles:Array.isArray(i.roles)?i.roles.map(o=>String(o)):[]})):[{id:"1",username:"admin",email:"admin@archiphoenix.com",enabled:!0,roles:["admin","user"]}];this.config={realm:String(e.realm||"archiphoenix"),adminUrl:String(e.adminUrl||"http://keycloak:8080"),enableSSL:e.enableSSL??!1,sslRequired:e.sslRequired||"external",accessTokenLifespan:Number(e.accessTokenLifespan||300),ssoSessionIdle:Number(e.ssoSessionIdle||1800),ssoSessionMax:Number(e.ssoSessionMax||36e3),enableOAuth2:e.enableOAuth2??!0,enableSAML:e.enableSAML??!1,enableLDAP:e.enableLDAP??!1,passwordPolicy:String(e.passwordPolicy||"length(8)"),clients:s,users:n}}processAuthRequest(t,e){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredSessions(s);const n=this.config;if(!n)return this.recordLatency(50),this.metrics.loginErrorsTotal++,{success:!1,latency:50,error:"Keycloak not configured"};const i=e.clientId||this.inferDefaultClientId(),o=n.clients.find(p=>p.id===i&&p.enabled);let r=t==="login"?80:t==="refresh"?40:t==="introspect"?60:40;t==="login"&&(r+=this.estimatePasswordPolicyCost(n.passwordPolicy)),n.enableLDAP&&(r*=1.3);const u=(Math.random()-.5)*20,d=Math.max(10,r+u);if(this.recordLatency(d),!o)return this.metrics.loginErrorsTotal++,this.bumpCounter(t),{success:!1,latency:d,error:`Client ${i} not found or disabled`,clientId:i,realm:n.realm};let h;if(t==="login"||t==="userinfo"){const p=e.username||e.subject;if(p&&(h=n.users.find(g=>g.username===p)),!h||!h.enabled)return this.metrics.loginErrorsTotal++,this.bumpCounter(t),{success:!1,latency:d,error:`User ${p||"unknown"} not found or disabled`,clientId:i,realm:n.realm}}switch(t){case"login":return this.metrics.loginRequestsTotal++,this.createOrUpdateSession(s,n,i,h),{success:!0,latency:d,tokenType:"access",expiresIn:n.accessTokenLifespan,subject:h.username,clientId:i,realm:n.realm};case"refresh":return this.metrics.tokenRefreshTotal++,e.subject&&this.touchUserSessions(s,e.subject),{success:!0,latency:d,tokenType:"access",expiresIn:n.accessTokenLifespan,subject:e.subject,clientId:i,realm:n.realm};case"introspect":return this.metrics.introspectionRequestsTotal++,{success:!0,latency:d,tokenType:"access",expiresIn:n.accessTokenLifespan,subject:e.subject,clientId:i,realm:n.realm};case"userinfo":return this.metrics.userInfoRequestsTotal++,{success:!0,latency:d,tokenType:"id",expiresIn:n.accessTokenLifespan,subject:h?.username??e.subject,clientId:i,realm:n.realm}}}calculateLoad(){const t=this.metrics,e=t.loginRequestsTotal+t.tokenRefreshTotal+t.introspectionRequestsTotal+t.userInfoRequestsTotal,s=e>0?Math.min(1,t.loginErrorsTotal/e):0,n=this.latencyHistory.length>0?this.latencyHistory.reduce((r,u)=>r+u,0)/this.latencyHistory.length:0;let i=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const r=(this.lastRequestTime-this.firstRequestTime)/1e3;i=e/Math.max(r,1)}const o=t.loginRequestsTotal>0?1-t.loginErrorsTotal/t.loginRequestsTotal:1;return{requestsPerSecond:i,averageLatency:n,errorRate:s,activeSessions:this.metrics.activeSessions,authSuccessRate:o}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}inferDefaultClientId(){return this.config?.clients.length?(this.config.clients.filter(e=>e.enabled)[0]||this.config.clients[0]).id:"default-client"}estimatePasswordPolicyCost(t){if(!t)return 0;let e=0;const s=t.toLowerCase();s.includes("length(")&&(e+=10),s.includes("digits(")&&(e+=15),s.includes("special(")&&(e+=20),s.includes("uppercase(")&&(e+=10),s.includes("lowercase(")&&(e+=5);const n=(t.match(/\)/g)||[]).length;return e+=n*5,e}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}bumpCounter(t){switch(t){case"login":this.metrics.loginRequestsTotal++;break;case"refresh":this.metrics.tokenRefreshTotal++;break;case"introspect":this.metrics.introspectionRequestsTotal++;break;case"userinfo":this.metrics.userInfoRequestsTotal++;break}}createOrUpdateSession(t,e,s,n){for(const d of this.sessions.values())if(d.userId===n.id&&d.clientId===s)return d.lastAccess=t,d.sessionId;const i=`sess-${t}-${Math.random().toString(36).slice(2,8)}`,o=e.ssoSessionIdle*1e3,r=e.ssoSessionMax*1e3,u={sessionId:i,userId:n.id,clientId:s,realm:e.realm,createdAt:t,lastAccess:t,idleTimeoutMs:o,maxLifespanMs:r};return this.sessions.set(i,u),this.metrics.sessionsCreatedTotal++,this.metrics.activeSessions=this.sessions.size,i}touchUserSessions(t,e){if(!this.config)return;const s=this.config.users.find(n=>n.username===e);if(s)for(const n of this.sessions.values())n.userId===s.id&&(n.lastAccess=t)}cleanupExpiredSessions(t){let e=0;for(const[s,n]of this.sessions.entries()){const i=t-n.lastAccess>n.idleTimeoutMs,o=t-n.createdAt>n.maxLifespanMs;(i||o)&&(this.sessions.delete(s),e++)}e>0&&(this.metrics.sessionsExpiredTotal+=e,this.metrics.activeSessions=this.sessions.size)}}class xk{config=null;rules=new Map;threats=[];stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0};rateLimitTracker=new Map;RATE_LIMIT_WINDOW_MS=6e4;ddosTracker=new Map;DDOS_WINDOW_MS=1e3;MAX_THREATS=1e3;initializeConfig(t){const e=t.data.config||{};if(this.config={mode:e.mode||"detection",enableOWASP:e.enableOWASP??!0,owaspRuleset:e.owaspRuleset||"3.3",enableRateLimiting:e.enableRateLimiting??!0,rateLimitPerMinute:e.rateLimitPerMinute||100,enableGeoBlocking:e.enableGeoBlocking??!1,blockedCountries:Array.isArray(e.blockedCountries)?e.blockedCountries:[],enableIPWhitelist:e.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(e.whitelistedIPs)?e.whitelistedIPs:[],enableDDoSProtection:e.enableDDoSProtection??!0,ddosThreshold:e.ddosThreshold||1e3,rules:Array.isArray(e.rules)?e.rules:[]},this.rules.clear(),this.config.rules)for(const s of this.config.rules)s.id&&this.rules.set(s.id,s);this.stats.activeRules=Array.from(this.rules.values()).filter(s=>s.enabled).length}processRequest(t){const e=performance.now(),s=t.timestamp||Date.now(),n=t.sourceIP||"0.0.0.0";if(this.stats.totalRequests++,this.config?.enableIPWhitelist&&this.config.whitelistedIPs?.includes(n))return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e};if(this.config?.enableGeoBlocking&&t.country&&this.config.blockedCountries?.includes(t.country)){const o={id:`threat-${Date.now()}-${Math.random()}`,type:"geo-block",sourceIP:n,target:t.path,timestamp:s,severity:"medium",blocked:!0,details:{country:t.country}};if(this.addThreat(o),this.stats.geoBlockHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:o}}if(this.config?.enableDDoSProtection){const o=this.checkDDoS(n,s);if(o.blocked){const r={id:`threat-${Date.now()}-${Math.random()}`,type:"ddos",sourceIP:n,target:t.path,timestamp:s,severity:"critical",blocked:!0,details:{requestCount:o.count}};if(this.addThreat(r),this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:r}}}if(this.config?.enableRateLimiting){const o=this.checkRateLimit(n,s);if(o.blocked){const r={id:`threat-${Date.now()}-${Math.random()}`,type:"rate-limit",sourceIP:n,target:t.path,timestamp:s,severity:"medium",blocked:!0,details:{requestCount:o.count}};if(this.addThreat(r),this.stats.rateLimitHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:r}}}if(this.config?.enableOWASP){const o=this.checkOWASPRules(t);if(o.detected){const r={id:`threat-${Date.now()}-${Math.random()}`,type:o.threatType||"custom",sourceIP:n,target:t.path,timestamp:s,severity:o.severity||"high",blocked:!0,details:o.details};if(this.addThreat(r),this.stats.owaspHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:r}}}const i=Array.from(this.rules.values()).filter(o=>o.enabled).sort((o,r)=>o.priority-r.priority);for(const o of i){const r=this.matchRule(o,t);if(r.matched){const u={id:`threat-${Date.now()}-${Math.random()}`,type:"custom",sourceIP:n,target:t.path,timestamp:s,severity:r.severity||"medium",blocked:o.action==="block",ruleId:o.id,ruleName:o.name,details:r.details};if(this.addThreat(u),this.stats.threatsDetected++,o.action==="block"&&this.config?.mode==="prevention")return this.stats.blockedRequests++,{allowed:!1,blocked:!0,action:"block",latency:performance.now()-e,threatDetected:u,matchedRule:o};if(o.action==="log")continue;if(o.action==="challenge")return{allowed:!1,blocked:!1,action:"challenge",latency:performance.now()-e,threatDetected:u,matchedRule:o}}}return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e}}matchRule(t,e){if(!t.conditions||t.conditions.length===0)return{matched:!1};for(const s of t.conditions){let n,i=!1;switch(s.type){case"ip":n=e.sourceIP;break;case"uri":n=e.path;break;case"method":n=e.method;break;case"header":n=e.headers?.[s.value]||"";break;case"body":n=typeof e.body=="string"?e.body:JSON.stringify(e.body||"");break;case"country":n=e.country;break;case"user-agent":n=e.userAgent;break}if(n===void 0)return{matched:!1};switch(s.operator){case"equals":i=n===s.value;break;case"contains":i=n.toLowerCase().includes(s.value.toLowerCase());break;case"startsWith":i=n.toLowerCase().startsWith(s.value.toLowerCase());break;case"endsWith":i=n.toLowerCase().endsWith(s.value.toLowerCase());break;case"regex":try{i=new RegExp(s.value,"i").test(n)}catch{i=!1}break;case"in":i=s.value.split(",").map(u=>u.trim()).includes(n);break;case"not-in":i=!s.value.split(",").map(u=>u.trim()).includes(n);break}if(!i)return{matched:!1}}return{matched:!0,severity:"medium",details:{matchedConditions:t.conditions.length}}}checkOWASPRules(t){const e=typeof t.body=="string"?t.body:JSON.stringify(t.body||""),s=t.path||"",n=JSON.stringify(t.query||""),i=`${e} ${s} ${n}`.toLowerCase(),o=[/(\bunion\b.*\bselect\b)/i,/(\bselect\b.*\bfrom\b)/i,/(\bdrop\b.*\btable\b)/i,/(\binsert\b.*\binto\b)/i,/(\bdelete\b.*\bfrom\b)/i,/('.*--)/,/(\bor\b.*=.*)/i,/(\band\b.*=.*)/i];for(const h of o)if(h.test(i))return{detected:!0,threatType:"sql-injection",severity:"critical",details:{pattern:h.toString()}};const r=[/<script[^>]*>/i,/javascript:/i,/on\w+\s*=/i,/<iframe[^>]*>/i,/eval\s*\(/i,/expression\s*\(/i];for(const h of r)if(h.test(i))return{detected:!0,threatType:"xss",severity:"high",details:{pattern:h.toString()}};const u=[/\.\.\//,/\.\.\\/,/\.\.%2f/i,/\.\.%5c/i];for(const h of u)if(h.test(i))return{detected:!0,threatType:"path-traversal",severity:"high",details:{pattern:h.toString()}};const d=[/\$\{[^}]*\}/,/\$\([^)]*\)/,/`[^`]*`/,/\|\s*\w+.*\s*\|/];for(const h of d)if(h.test(i))return{detected:!0,threatType:"rce",severity:"critical",details:{pattern:h.toString()}};return{detected:!1}}checkRateLimit(t,e){if(!this.config?.enableRateLimiting||!this.config.rateLimitPerMinute)return{blocked:!1,count:0};const s=e-this.RATE_LIMIT_WINDOW_MS,n=this.rateLimitTracker.get(t)||[],i=n.filter(o=>o>s);return i.length>=this.config.rateLimitPerMinute?{blocked:!0,count:i.length}:(i.push(e),this.rateLimitTracker.set(t,i),n.length>this.config.rateLimitPerMinute*2&&this.rateLimitTracker.set(t,i),{blocked:!1,count:i.length})}checkDDoS(t,e){if(!this.config?.enableDDoSProtection||!this.config.ddosThreshold)return{blocked:!1,count:0};const s=this.ddosTracker.get(t),n=e-this.DDOS_WINDOW_MS;return!s||s.windowStart<n?(this.ddosTracker.set(t,{count:1,windowStart:e}),{blocked:!1,count:1}):(s.count++,this.ddosTracker.set(t,s),s.count>=this.config.ddosThreshold?{blocked:!0,count:s.count}:{blocked:!1,count:s.count})}addThreat(t){this.threats.push(t),this.threats.length>this.MAX_THREATS&&this.threats.shift()}getThreats(t=100){return this.threats.slice(-t).reverse()}getStats(){return{...this.stats}}resetStats(){this.stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:this.stats.activeRules,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0},this.threats=[],this.rateLimitTracker.clear(),this.ddosTracker.clear()}}class Mk{config=null;routingEngine;metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:0,averageLatency:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new xk}initializeConfig(t){const e=t.data.config||{};this.config={mode:e.mode||"detection",enableOWASP:e.enableOWASP??!0,owaspRuleset:e.owaspRuleset||"3.3",enableRateLimiting:e.enableRateLimiting??!0,rateLimitPerMinute:e.rateLimitPerMinute||100,enableGeoBlocking:e.enableGeoBlocking??!1,blockedCountries:Array.isArray(e.blockedCountries)?e.blockedCountries:[],enableIPWhitelist:e.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(e.whitelistedIPs)?e.whitelistedIPs:[],enableDDoSProtection:e.enableDDoSProtection??!0,ddosThreshold:e.ddosThreshold||1e3,rules:Array.isArray(e.rules)?e.rules:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),s={path:t.path||"/",method:t.method||"GET",headers:t.headers,query:t.query,body:t.body,sourceIP:t.sourceIP||this.generateRandomIP(),country:t.country||this.generateRandomCountry(),userAgent:t.userAgent||"Mozilla/5.0",timestamp:Date.now()},n=this.routingEngine.processRequest(s),i=performance.now()-e+n.latency;if(this.recordLatency(i),this.metrics.requestsTotal++,n.allowed?this.metrics.requestsAllowed++:(this.metrics.requestsBlocked++,n.blocked&&this.metrics.threatsBlocked++),n.threatDetected){this.metrics.threatsDetected++;const r=this.routingEngine.getStats();this.metrics.rateLimitHits=r.rateLimitHits,this.metrics.geoBlockHits=r.geoBlockHits,this.metrics.ipBlockHits=r.ipBlockHits,this.metrics.owaspHits=r.owaspHits,this.metrics.customRuleHits=r.threatsDetected-r.owaspHits-r.rateLimitHits-r.geoBlockHits-r.ipBlockHits}const o=Date.now();return this.firstRequestTime||(this.firstRequestTime=o),this.lastRequestTime=o,{success:n.allowed,blocked:n.blocked,latency:i,threatDetected:!!n.threatDetected,error:n.error}}simulateRequests(t){const e=Date.now(),s=e-this.lastSimulationTime;if(this.lastSimulationTime=e,s<=0||t<=0)return;const n=Math.floor(t*s/1e3);if(n!==0){for(let i=0;i<n;i++){const o=this.generateRandomRequest();this.processRequest(o)}this.updateMetricsFromStats()}}generateRandomRequest(){const t=["GET","POST","PUT","DELETE","PATCH"],e=["/api/users","/api/products","/api/orders","/api/auth","/api/data"],s=["US","GB","DE","FR","CN","RU","JP"],n=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"],i=Math.random()<.05;let o=e[Math.floor(Math.random()*e.length)],r=null;return i?Math.random()<.5?(o+="?id=1' OR '1'='1",r={query:"SELECT * FROM users WHERE id = '1' OR '1'='1'"}):r={content:'<script>alert("XSS")<\/script>'}:Math.random()<.3&&(r={data:Math.random().toString(36).substring(7)}),{path:o,method:t[Math.floor(Math.random()*t.length)],headers:{"Content-Type":"application/json","User-Agent":n[Math.floor(Math.random()*n.length)]},body:r,sourceIP:this.generateRandomIP(),country:s[Math.floor(Math.random()*s.length)],userAgent:n[Math.floor(Math.random()*n.length)]}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomCountry(){const t=["US","GB","DE","FR","CN","RU","JP","BR","IN","AU"];return t[Math.floor(Math.random()*t.length)]}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.metrics.averageLatency=e/this.latencyHistory.length}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.requestsTotal=t.totalRequests,this.metrics.requestsAllowed=t.allowedRequests,this.metrics.requestsBlocked=t.blockedRequests,this.metrics.threatsDetected=t.threatsDetected,this.metrics.rateLimitHits=t.rateLimitHits,this.metrics.geoBlockHits=t.geoBlockHits,this.metrics.ipBlockHits=t.ipBlockHits,this.metrics.owaspHits=t.owaspHits,this.metrics.activeRules=t.activeRules,this.metrics.customRuleHits=t.threatsDetected-t.owaspHits-t.rateLimitHits-t.geoBlockHits-t.ipBlockHits}calculateLoad(){let t=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const o=(this.lastRequestTime-this.firstRequestTime)/1e3;o>0&&(t=this.metrics.requestsTotal/o)}t===0&&this.simulatedRequestRate>0&&(t=this.simulatedRequestRate);const e=this.metrics.averageLatency||5,s=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,n=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,i=this.metrics.requestsTotal>0?this.metrics.threatsDetected/this.metrics.requestsTotal:0;return{requestsPerSecond:t,averageLatency:e,errorRate:s,blockRate:n,threatDetectionRate:i}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getThreats(t=100){return this.routingEngine.getThreats(t)}getStats(){return this.routingEngine.getStats()}setSimulatedRequestRate(t){this.simulatedRequestRate=t}resetMetrics(){this.metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:this.metrics.activeRules,averageLatency:0},this.latencyHistory=[],this.firstRequestTime=null,this.lastRequestTime=null,this.routingEngine.resetStats()}}class Sk{config=null;rules=new Map;logs=[];stats={totalPackets:0,allowedPackets:0,blockedPackets:0,rejectedPackets:0,activeRules:0,totalConnections:0,activeConnections:0};connections=new Map;MAX_CONNECTIONS=1e4;CONNECTION_TIMEOUT_MS=3e5;MAX_LOGS=1e4;initializeConfig(t){const e=t.data.config||{};if(this.config={enableFirewall:e.enableFirewall??!0,enableLogging:e.enableLogging??!0,enableIntrusionDetection:e.enableIntrusionDetection??!1,enableStatefulInspection:e.enableStatefulInspection??!0,defaultPolicy:e.defaultPolicy||"deny",logRetention:e.logRetention||30,rules:Array.isArray(e.rules)?e.rules:[]},this.rules.clear(),this.config.rules)for(const s of this.config.rules)s.id&&s.enabled&&this.rules.set(s.id,s);this.stats.activeRules=Array.from(this.rules.values()).filter(s=>s.enabled).length,this.cleanOldLogs()}processPacket(t){const e=performance.now(),s=t.timestamp||Date.now();if(!this.config?.enableFirewall)return{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e};if(this.stats.totalPackets++,this.config?.enableStatefulInspection){const r=this.getConnectionKey(t),u=this.connections.get(r);if(u){if(u.lastSeen=s,u.packets++,u.state="established",u.state==="established")return this.stats.allowedPackets++,this.logPacket(t,"allowed",void 0,"Established connection"),{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-e}}else this.connections.size<this.MAX_CONNECTIONS&&(this.connections.set(r,{source:t.source,destination:t.destination,sourcePort:t.sourcePort||0,destinationPort:t.port||0,protocol:t.protocol,state:"new",firstSeen:s,lastSeen:s,packets:1}),this.stats.totalConnections++)}const n=Array.from(this.rules.values()).filter(r=>r.enabled).sort((r,u)=>u.priority-r.priority);for(const r of n){const u=this.matchRule(r,t);if(u.matched){if(r.hits=(r.hits||0)+1,this.config?.enableLogging&&this.logPacket(t,r.action==="allow"?"allowed":r.action==="deny"?"blocked":"rejected",r,u.reason),r.action==="allow"?this.stats.allowedPackets++:r.action==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,r.action==="allow"&&this.config?.enableStatefulInspection){const d=this.getConnectionKey(t),h=this.connections.get(d);h&&(h.state="established")}return{allowed:r.action==="allow",blocked:r.action==="deny"||r.action==="reject",action:r.action,latency:performance.now()-e,matchedRule:r}}}const i=this.config?.defaultPolicy||"deny",o=i==="allow"?"allowed":i==="deny"?"blocked":"rejected";return this.config?.enableLogging&&this.logPacket(t,o,void 0,`Default policy: ${i}`),i==="allow"?this.stats.allowedPackets++:i==="deny"?this.stats.blockedPackets++:this.stats.rejectedPackets++,{allowed:i==="allow",blocked:i==="deny"||i==="reject",action:i,latency:performance.now()-e}}matchRule(t,e){return t.protocol!=="all"&&t.protocol!==e.protocol?{matched:!1}:t.source&&!this.matchIP(e.source,t.source)?{matched:!1}:t.destination&&!this.matchIP(e.destination,t.destination)?{matched:!1}:(e.protocol==="tcp"||e.protocol==="udp")&&t.port!==void 0&&e.port!==t.port?{matched:!1}:(e.protocol==="tcp"||e.protocol==="udp")&&t.sourcePort!==void 0&&e.sourcePort!==t.sourcePort?{matched:!1}:{matched:!0,reason:`Matched rule: ${t.name}`}}matchIP(t,e){if(t===e)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10);if(isNaN(i)||i<0||i>32)return!1;const o=this.ipToNumber(t),r=this.ipToNumber(s),u=4294967295<<32-i>>>0;return(o&u)===(r&u)}return!1}ipToNumber(t){const e=t.split(".");return e.length!==4?0:(parseInt(e[0],10)<<24)+(parseInt(e[1],10)<<16)+(parseInt(e[2],10)<<8)+parseInt(e[3],10)}getConnectionKey(t){return`${t.source}:${t.sourcePort||0}-${t.destination}:${t.port||0}-${t.protocol}`}logPacket(t,e,s,n){if(!this.config?.enableLogging)return;const i={id:`log-${Date.now()}-${Math.random()}`,timestamp:t.timestamp||Date.now(),action:e,source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,ruleId:s?.id,ruleName:s?.name,reason:n||s?.name};this.logs.push(i),this.logs.length>this.MAX_LOGS&&this.logs.shift()}cleanOldLogs(){if(!this.config?.logRetention)return;const t=this.config.logRetention*24*60*60*1e3,e=Date.now()-t;this.logs=this.logs.filter(s=>s.timestamp>=e)}cleanupConnections(){const t=Date.now(),e=this.CONNECTION_TIMEOUT_MS;for(const[s,n]of this.connections.entries())t-n.lastSeen>e&&this.connections.delete(s);this.stats.activeConnections=this.connections.size}getStats(){return this.stats.activeConnections=this.connections.size,{...this.stats}}getLogs(t){const e=[...this.logs].reverse();return t?e.slice(0,t):e}getRules(){return Array.from(this.rules.values())}getConfig(){return this.config}}class Ck{config=null;routingEngine;metrics={packetsTotal:0,packetsAllowed:0,packetsBlocked:0,packetsRejected:0,activeRules:0,totalConnections:0,activeConnections:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new Sk}initializeConfig(t){const e=t.data.config||{};this.config={enableFirewall:e.enableFirewall??!0,enableLogging:e.enableLogging??!0,enableIntrusionDetection:e.enableIntrusionDetection??!1,enableStatefulInspection:e.enableStatefulInspection??!0,defaultPolicy:e.defaultPolicy||"deny",logRetention:e.logRetention||30,rules:Array.isArray(e.rules)?e.rules:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){const e=performance.now(),s={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,timestamp:Date.now()},n=this.routingEngine.processPacket(s),i=performance.now()-e;return this.recordLatency(i),this.updateMetricsFromStats(),{success:n.allowed,blocked:n.blocked,latency:i,error:n.blocked?n.matchedRule?.name||`Packet ${n.action}`:void 0}}simulatePackets(t){const e=Date.now(),s=e-this.lastSimulationTime;if(this.lastSimulationTime=e,s<=0||t<=0)return;const n=Math.floor(t*s/1e3);if(n!==0){for(let i=0;i<n;i++){const o=this.generateRandomPacket();this.processPacket(o)}this.updateMetricsFromStats()}}generateRandomPacket(){const t=["tcp","udp","icmp"],e=t[Math.floor(Math.random()*t.length)],s=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,n=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i=e==="icmp"?void 0:Math.floor(Math.random()*65535),o=e==="icmp"?void 0:Math.floor(Math.random()*65535);return{source:s,destination:n,protocol:e,port:i,sourcePort:o}}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}updateMetricsFromStats(){const t=this.routingEngine.getStats();if(this.routingEngine.getRules(),this.metrics.packetsTotal=t.totalPackets,this.metrics.packetsAllowed=t.allowedPackets,this.metrics.packetsBlocked=t.blockedPackets,this.metrics.packetsRejected=t.rejectedPackets,this.metrics.activeRules=t.activeRules,this.metrics.totalConnections=t.totalConnections,this.metrics.activeConnections=t.activeConnections,this.latencyHistory.length>0){const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.metrics.averageLatency=e/this.latencyHistory.length}}setSimulatedPacketRate(t){this.simulatedPacketRate=t}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLogs(t){return this.routingEngine.getLogs(t)}getRules(){return this.routingEngine.getRules()}getConfig(){return this.config}calculateLoad(){let t=0;if(this.firstPacketTime&&this.lastPacketTime){const n=(this.lastPacketTime-this.firstPacketTime)/1e3;n>0&&(t=this.metrics.packetsTotal/n)}t===0&&this.simulatedPacketRate>0&&(t=this.simulatedPacketRate);const e=this.metrics.packetsTotal>0?this.metrics.packetsBlocked/this.metrics.packetsTotal:0,s=this.metrics.packetsTotal>0?this.metrics.packetsRejected/this.metrics.packetsTotal:0;return{packetsPerSecond:t,averageLatency:this.metrics.averageLatency,blockRate:e,rejectionRate:s}}cleanup(){this.routingEngine.cleanupConnections(),this.updateMetricsFromStats()}}class Rk{config=null;signatures=new Map;alerts=[];stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0};blockedIPs=new Map;behavioralPatterns=new Map;MAX_BEHAVIORAL_PATTERNS=1e4;BEHAVIORAL_WINDOW_MS=3e5;MAX_ALERTS=1e4;initializeConfig(t){const e=t.data.config||{};if(this.config={mode:e.mode||"ids",enableSignatureDetection:e.enableSignatureDetection??!0,enableAnomalyDetection:e.enableAnomalyDetection??!0,enableBehavioralAnalysis:e.enableBehavioralAnalysis??!1,alertThreshold:e.alertThreshold||"medium",enableAutoBlock:e.enableAutoBlock??!1,blockDuration:e.blockDuration||3600,enableLogging:e.enableLogging??!0,logRetention:e.logRetention||30,signatures:Array.isArray(e.signatures)?e.signatures:[]},this.signatures.clear(),this.config.signatures)for(const s of this.config.signatures)s.id&&s.enabled&&this.signatures.set(s.id,s);if(Array.isArray(e.blockedIPs)){this.blockedIPs.clear();for(const s of e.blockedIPs)if(s.ip){const n=s.expiresAt?new Date(s.expiresAt).getTime():Date.now()+(this.config.blockDuration||3600)*1e3;this.blockedIPs.set(s.ip,{ip:s.ip,reason:s.reason||"Intrusion detected",blockedAt:s.blockedAt?new Date(s.blockedAt).getTime():Date.now(),expiresAt:n})}}this.stats.activeSignatures=Array.from(this.signatures.values()).filter(s=>s.enabled).length,this.stats.blockedIPs=this.blockedIPs.size,this.cleanExpiredBlocks()}processPacket(t){const e=performance.now();if(this.stats.totalPackets++,this.isIPBlocked(t.source))return this.stats.alertsBlocked++,{allowed:!1,blocked:!0,alertGenerated:!1,latency:performance.now()-e,error:`IP ${t.source} is blocked`};this.stats.packetsAnalyzed++;let s,n=!1;if(this.config?.enableSignatureDetection){const o=this.detectSignature(t);if(o&&(s=o,this.stats.signatureMatches++,this.stats.alertsGenerated++,o.signatureId)){const r=this.signatures.get(o.signatureId);r&&r.action==="block"&&this.config.mode==="ips"&&(n=!0)}}if(!s&&this.config?.enableAnomalyDetection){const o=this.detectAnomaly(t);o&&(s=o,this.stats.anomalyDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&o.anomalyScore&&o.anomalyScore>.8&&(n=!0))}if(!s&&this.config?.enableBehavioralAnalysis){const o=this.detectBehavioral(t);o&&(s=o,this.stats.behavioralDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&o.behavioralPattern==="suspicious"&&(n=!0))}n&&this.config?.mode==="ips"&&(this.blockIP(t.source,s?.description||"Intrusion detected",s?.signatureId),this.stats.alertsBlocked++,s=s?{...s,blocked:!0}:void 0),s&&this.shouldGenerateAlert(s.severity)&&this.addAlert(s);const i=performance.now()-e;return{allowed:!n,blocked:n,alertGenerated:!!s,latency:i,alert:s}}detectSignature(t){const e=Array.from(this.signatures.values()).filter(s=>s.enabled).sort((s,n)=>{const i={critical:4,high:3,medium:2,low:1};return i[n.severity]-i[s.severity]});for(const s of e)if(!(s.protocol&&s.protocol!=="all"&&s.protocol!==t.protocol)&&!(s.sourceIP&&!this.matchIP(t.source,s.sourceIP))&&!(s.destinationIP&&!this.matchIP(t.destination,s.destinationIP))&&!(s.port!==void 0&&t.port!==void 0&&s.port!==t.port)&&!(s.sourcePort!==void 0&&t.sourcePort!==void 0&&s.sourcePort!==t.sourcePort)){if(s.pattern&&t.payload)try{if(new RegExp(s.pattern,"i").test(t.payload))return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:s.severity,timestamp:t.timestamp||Date.now(),description:s.description||`Signature match: ${s.name}`,blocked:!1,signature:s.name,signatureId:s.id}}catch{}else if(!s.pattern)return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:s.severity,timestamp:t.timestamp||Date.now(),description:s.description||`Signature match: ${s.name}`,blocked:!1,signature:s.name,signatureId:s.id}}return null}detectAnomaly(t){let e=0;const s=[22,23,80,443,3306,5432,27017,6379,8080];if(t.port&&s.includes(t.port)&&(e+=.2),t.protocol==="icmp"&&(e+=.1),t.payload){const i=t.payload.length;(i>1e4||i<10)&&(e+=.3)}if(t.payload){const i=["SELECT","UNION","DROP","DELETE","INSERT","UPDATE","<script","eval(","base64"];for(const o of i)if(t.payload.toLowerCase().includes(o.toLowerCase())){e+=.4;break}}const n=this.getAnomalyThreshold();if(e>=n){const i=e>=.8?"critical":e>=.6?"high":"medium";return{id:`alert-${Date.now()}-${Math.random()}`,type:"anomaly",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:i,timestamp:t.timestamp||Date.now(),description:`Anomaly detected: unusual network activity (score: ${e.toFixed(2)})`,blocked:!1,anomalyScore:e}}return null}detectBehavioral(t){const e=`${t.source}-${t.destination}-${t.protocol}-${t.port||"any"}`,s=Date.now();let n=this.behavioralPatterns.get(e);n||(n={sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,requestCount:0,firstSeen:s,lastSeen:s,suspiciousScore:0},this.behavioralPatterns.set(e,n)),n.requestCount++,n.lastSeen=s,this.behavioralPatterns.size>this.MAX_BEHAVIORAL_PATTERNS&&this.cleanOldBehavioralPatterns();const i=(s-n.firstSeen)/1e3,o=i>0?n.requestCount/i:n.requestCount;return o>10&&(n.suspiciousScore=Math.min(1,o/100)),n.suspiciousScore>.7?{id:`alert-${Date.now()}-${Math.random()}`,type:"behavioral",sourceIP:t.source,destinationIP:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,severity:n.suspiciousScore>.9?"critical":"high",timestamp:s,description:`Behavioral pattern detected: high request rate (${o.toFixed(2)} req/s)`,blocked:!1,behavioralPattern:"suspicious"}:null}isIPBlocked(t){return this.cleanExpiredBlocks(),this.blockedIPs.has(t)}blockIP(t,e,s){const n=Date.now()+(this.config?.blockDuration||3600)*1e3;this.blockedIPs.set(t,{ip:t,reason:e,blockedAt:Date.now(),expiresAt:n}),this.stats.blockedIPs=this.blockedIPs.size}cleanExpiredBlocks(){const t=Date.now();for(const[e,s]of this.blockedIPs.entries())s.expiresAt<t&&this.blockedIPs.delete(e);this.stats.blockedIPs=this.blockedIPs.size}cleanOldBehavioralPatterns(){const t=Date.now();for(const[e,s]of this.behavioralPatterns.entries())t-s.lastSeen>this.BEHAVIORAL_WINDOW_MS&&this.behavioralPatterns.delete(e)}shouldGenerateAlert(t){const e=this.config?.alertThreshold||"medium",s={critical:4,high:3,medium:2,low:1},n={critical:4,high:3,medium:2,low:1};return s[t]>=n[e]}getAnomalyThreshold(){const t=this.config?.alertThreshold||"medium";return{low:.9,medium:.7,high:.5,critical:.3}[t]}matchIP(t,e){if(t===e)return!0;if(e.includes("/")){const[s,n]=e.split("/"),i=parseInt(n,10);return t.startsWith(s.split(".").slice(0,Math.floor(i/8)).join("."))}return!1}addAlert(t){this.alerts.push(t),this.alerts.length>this.MAX_ALERTS&&this.alerts.shift()}getAlerts(t=100){return this.alerts.slice(-t).reverse()}getBlockedIPs(){return this.cleanExpiredBlocks(),Array.from(this.blockedIPs.values())}unblockIP(t){this.blockedIPs.delete(t),this.stats.blockedIPs=this.blockedIPs.size}getStats(){return{...this.stats}}getSignatures(){return Array.from(this.signatures.values())}resetStats(){this.stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.stats.activeSignatures,blockedIPs:this.blockedIPs.size}}}class Ek{config=null;routingEngine;metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new Rk}initializeConfig(t){const e=t.data.config||{};this.config={mode:e.mode||"ids",enableSignatureDetection:e.enableSignatureDetection??!0,enableAnomalyDetection:e.enableAnomalyDetection??!0,enableBehavioralAnalysis:e.enableBehavioralAnalysis??!1,alertThreshold:e.alertThreshold||"medium",enableAutoBlock:e.enableAutoBlock??!1,blockDuration:e.blockDuration||3600,enableLogging:e.enableLogging??!0,logRetention:e.logRetention||30,signatures:Array.isArray(e.signatures)?e.signatures:[],blockedIPs:Array.isArray(e.blockedIPs)?e.blockedIPs:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){const e=performance.now(),s={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,payload:t.payload,timestamp:Date.now()},n=this.routingEngine.processPacket(s),i=performance.now()-e+n.latency;this.recordLatency(i),this.metrics.packetsTotal++,n.alertGenerated&&this.metrics.alertsGenerated++,n.blocked&&this.metrics.alertsBlocked++;const o=Date.now();return this.firstPacketTime||(this.firstPacketTime=o),this.lastPacketTime=o,this.updateMetricsFromStats(),{success:n.allowed,blocked:n.blocked,latency:i,alertGenerated:n.alertGenerated,error:n.error}}simulatePackets(t){const e=Date.now(),s=e-this.lastSimulationTime;if(this.lastSimulationTime=e,s<=0||t<=0)return;const n=Math.floor(t*s/1e3);if(n!==0){for(let i=0;i<n;i++){const o=this.generateRandomPacket();this.processPacket(o)}this.updateMetricsFromStats()}}generateRandomPacket(){const t=["tcp","udp","icmp"],e=t[Math.floor(Math.random()*t.length)],s=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,n=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i=e==="icmp"?void 0:Math.floor(Math.random()*65535),o=e==="icmp"?void 0:Math.floor(Math.random()*65535),r=Math.random()<.05;let u;if(r){const d=["SELECT * FROM users WHERE id = 1 OR 1=1",'<script>alert("XSS")<\/script>',"DROP TABLE users","UNION SELECT password FROM users","../../../etc/passwd","eval(base64_decode("];u=d[Math.floor(Math.random()*d.length)]}else Math.random()<.3&&(u=`GET /api/data HTTP/1.1\r
Host: example.com\r
User-Agent: Mozilla/5.0`);return{source:s,destination:n,protocol:e,port:i,sourcePort:o,payload:u}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.metrics.averageLatency=e/this.latencyHistory.length}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.packetsTotal=t.totalPackets,this.metrics.packetsAnalyzed=t.packetsAnalyzed,this.metrics.alertsGenerated=t.alertsGenerated,this.metrics.alertsBlocked=t.alertsBlocked,this.metrics.signatureMatches=t.signatureMatches,this.metrics.anomalyDetections=t.anomalyDetections,this.metrics.behavioralDetections=t.behavioralDetections,this.metrics.activeSignatures=t.activeSignatures,this.metrics.blockedIPs=t.blockedIPs}calculateLoad(){let t=0;if(this.firstPacketTime&&this.lastPacketTime&&this.lastPacketTime>this.firstPacketTime){const o=(this.lastPacketTime-this.firstPacketTime)/1e3;o>0&&(t=this.metrics.packetsTotal/o)}t===0&&this.simulatedPacketRate>0&&(t=this.simulatedPacketRate);const e=this.metrics.averageLatency||5,s=this.config?.mode==="ips"&&this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,n=this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,i=this.metrics.packetsTotal>0?this.metrics.alertsGenerated/this.metrics.packetsTotal:0;return{packetsPerSecond:t,averageLatency:e,errorRate:s,blockRate:n,alertRate:i}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getAlerts(t=100){return this.routingEngine.getAlerts(t)}getStats(){return this.routingEngine.getStats()}getBlockedIPs(){return this.routingEngine.getBlockedIPs()}unblockIP(t){this.routingEngine.unblockIP(t),this.updateMetricsFromStats()}setSimulatedPacketRate(t){this.simulatedPacketRate=t}resetMetrics(){this.metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.metrics.activeSignatures,blockedIPs:this.metrics.blockedIPs,averageLatency:0},this.latencyHistory=[],this.firstPacketTime=null,this.lastPacketTime=null,this.routingEngine.resetStats()}}class Tk{config=null;metrics={readRequestsTotal:0,writeRequestsTotal:0,deleteRequestsTotal:0,listRequestsTotal:0,authRequestsTotal:0,authErrorsTotal:0,tokenIssuedTotal:0,tokenRenewedTotal:0,tokenRevokedTotal:0,encryptionOperationsTotal:0,decryptionOperationsTotal:0,activeTokens:0,secretsTotal:0};tokens=new Map;secrets=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(t){const e=t.data.config||{},s=Array.isArray(e.secrets)?e.secrets.map(r=>({id:String(r.id??`secret-${Date.now()}`),path:String(r.path??"secret/default"),key:String(r.key??"key"),value:String(r.value??""),version:Number(r.version??1),created:r.created?String(r.created):new Date().toISOString(),updated:r.updated?String(r.updated):new Date().toISOString(),visible:r.visible??!1})):[],n=Array.isArray(e.engines)?e.engines.map(r=>({id:String(r.id??`engine-${Date.now()}`),name:String(r.name??"secret/"),type:r.type??"kv",enabled:r.enabled??!0,version:r.version?Number(r.version):void 0,description:r.description?String(r.description):void 0})):[{id:"1",name:"secret/",type:"kv",enabled:e.enableKV??!0,version:e.kvVersion==="1"?1:2,description:"Key-Value secrets"}],i=Array.isArray(e.policies)?e.policies.map(r=>({id:String(r.id??`policy-${Date.now()}`),name:String(r.name??"default"),rules:String(r.rules??'path "*" { capabilities = ["read"] }'),enabled:r.enabled??!0})):[{id:"1",name:"default",rules:'path "*" { capabilities = ["read", "list"] }',enabled:!0}],o=String(e.tokenTTL||"24h");this.parseTTL(o),this.config={vaultType:e.vaultType||"hashicorp",address:String(e.address||"http://vault:8200"),enableTLS:e.enableTLS??!1,enableTransit:e.enableTransit??!0,enableKV:e.enableKV??!0,kvVersion:String(e.kvVersion||"2"),enablePKI:e.enablePKI??!1,enableAuth:e.enableAuth??!0,authMethod:e.authMethod||"token",tokenTTL:o,secrets:s,engines:n,policies:i},this.secrets.clear(),s.forEach(r=>{this.secrets.set(r.id,r)}),this.metrics.secretsTotal=s.length,this.cleanupExpiredTokens(Date.now())}processReadRequest(t,e,s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.readRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.readRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=Array.from(this.secrets.values()).find(h=>h.path===t&&(!e||h.key===e)),r=15,u=(Math.random()-.5)*10,d=Math.max(5,r+u);return this.recordLatency(d),this.metrics.readRequestsTotal++,o?{success:!0,latency:d,data:{[o.key]:o.value,version:o.version}}:{success:!1,latency:d,error:`Secret not found at path: ${t}`}}processWriteRequest(t,e,s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(60),this.metrics.writeRequestsTotal++,{success:!1,latency:60,error:"Vault not configured"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.writeRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};if(!i.enableKV)return this.recordLatency(20),this.metrics.writeRequestsTotal++,{success:!1,latency:20,error:"KV engine is not enabled"};const o=25,r=(Math.random()-.5)*15,u=Math.max(10,o+r);this.recordLatency(u),this.metrics.writeRequestsTotal++;const d=Array.from(this.secrets.values()).find(h=>h.path===t&&h.key===Object.keys(e)[0]);if(d)d.value=Object.values(e)[0],d.version=(d.version||1)+1,d.updated=new Date().toISOString(),this.secrets.set(d.id,d);else{const h={id:`secret-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,path:t,key:Object.keys(e)[0],value:Object.values(e)[0],version:1,created:new Date().toISOString(),updated:new Date().toISOString(),visible:!1};this.secrets.set(h.id,h),this.metrics.secretsTotal=this.secrets.size}return{success:!0,latency:u,data:{path:t,version:d?.version||1}}}processDeleteRequest(t,e){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const n=this.config;if(!n)return this.recordLatency(50),this.metrics.deleteRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(n.enableAuth&&e&&!this.validateToken(e,s))return this.recordLatency(30),this.metrics.deleteRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const i=20,o=(Math.random()-.5)*10,r=Math.max(8,i+o);this.recordLatency(r),this.metrics.deleteRequestsTotal++;const u=Array.from(this.secrets.values()).find(d=>d.path===t);return u?(this.secrets.delete(u.id),this.metrics.secretsTotal=this.secrets.size,{success:!0,latency:r}):{success:!1,latency:r,error:`Secret not found at path: ${t}`}}processAuthRequest(t,e){const s=Date.now();this.firstRequestTime??=s,this.lastRequestTime=s,this.cleanupExpiredTokens(s);const n=this.config;if(!n)return this.recordLatency(50),this.metrics.authRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!n.enableAuth)return this.recordLatency(20),this.metrics.authRequestsTotal++,{success:!1,latency:20,error:"Authentication is not enabled"};let i=40;t==="ldap"?i=80:t==="approle"?i=50:t==="aws"&&(i=60);const o=(Math.random()-.5)*20,r=Math.max(15,i+o);this.recordLatency(r),this.metrics.authRequestsTotal++;const u=this.parseTTL(n.tokenTTL),d=`vault-token-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,h={id:d,token:d,policies:n.policies.filter(p=>p.enabled).map(p=>p.name),ttl:u,renewable:!0,createdAt:s,expiresAt:s+u*1e3};return this.tokens.set(d,h),this.metrics.tokenIssuedTotal++,this.metrics.activeTokens=this.tokens.size,{success:!0,latency:r,token:d,policies:h.policies}}processEncryptRequest(t,e="default",s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.encryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!i.enableTransit)return this.recordLatency(20),this.metrics.encryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.encryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=t.length,r=30+Math.min(100,o/100),u=(Math.random()-.5)*15,d=Math.max(15,r+u);this.recordLatency(d),this.metrics.encryptionOperationsTotal++;const h=Buffer.from(t).toString("base64");return{success:!0,latency:d,data:{ciphertext:`vault:v1:${h}`,key:e}}}processDecryptRequest(t,e="default",s){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const i=this.config;if(!i)return this.recordLatency(50),this.metrics.decryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!i.enableTransit)return this.recordLatency(20),this.metrics.decryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(i.enableAuth&&s&&!this.validateToken(s,n))return this.recordLatency(30),this.metrics.decryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const o=25+Math.min(80,t.length/150),r=(Math.random()-.5)*12,u=Math.max(12,o+r);this.recordLatency(u),this.metrics.decryptionOperationsTotal++;const d=t.replace(/^vault:v1:/,"");let h;try{h=Buffer.from(d,"base64").toString("utf-8")}catch{return{success:!1,latency:u,error:"Invalid ciphertext format"}}return{success:!0,latency:u,data:{plaintext:h,key:e}}}calculateLoad(){const t=this.metrics,e=t.readRequestsTotal+t.writeRequestsTotal+t.deleteRequestsTotal+t.listRequestsTotal+t.authRequestsTotal+t.encryptionOperationsTotal+t.decryptionOperationsTotal,s=e>0?Math.min(1,t.authErrorsTotal/e):0,n=this.latencyHistory.length>0?this.latencyHistory.reduce((r,u)=>r+u,0)/this.latencyHistory.length:0;let i=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const r=(this.lastRequestTime-this.firstRequestTime)/1e3;i=e/Math.max(r,1)}const o=this.config?.engines.filter(r=>r.enabled).length||0;return{requestsPerSecond:i,averageLatency:n,errorRate:s,activeTokens:this.metrics.activeTokens,secretsCount:this.metrics.secretsTotal,enginesEnabled:o}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}getSecrets(){return Array.from(this.secrets.values())}getActiveTokens(){const t=Date.now();return this.cleanupExpiredTokens(t),Array.from(this.tokens.values())}parseTTL(t){const e=t.match(/^(\d+)([smhd])$/);if(!e)return 86400;const s=parseInt(e[1],10);switch(e[2]){case"s":return s;case"m":return s*60;case"h":return s*3600;case"d":return s*86400;default:return 86400}}validateToken(t,e){const s=this.tokens.get(t);return s?e>s.expiresAt?(this.tokens.delete(t),this.metrics.activeTokens=this.tokens.size,!1):!0:!1}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}cleanupExpiredTokens(t){let e=0;for(const[s,n]of this.tokens.entries())t>n.expiresAt&&(this.tokens.delete(s),e++);e>0&&(this.metrics.tokenRevokedTotal+=e,this.metrics.activeTokens=this.tokens.size)}}class kk{config=null;connections=new Map;tunnels=new Map;stats={totalConnections:0,activeConnections:0,totalTunnels:0,activeTunnels:0,totalBytesIn:0,totalBytesOut:0,totalPacketsIn:0,totalPacketsOut:0,encryptionOperations:0,compressionOperations:0,failedConnections:0,averageLatency:0};latencyHistory=[];MAX_LATENCY_HISTORY=200;CONNECTION_TIMEOUT_MS=3e5;initializeConfig(t){const e=t.data.config||{};if(this.config={vpnProtocol:e.vpnProtocol||"openvpn",encryptionAlgorithm:e.encryptionAlgorithm||"aes-256",enableCompression:e.enableCompression??!0,enableKeepAlive:e.enableKeepAlive??!0,maxConnections:e.maxConnections||1e3,connectionTimeout:e.connectionTimeout||300,enableSSL:e.enableSSL??!0,sslPort:e.sslPort||443,enableIPSec:e.enableIPSec??!0,ipsecPort:e.ipsecPort||500,enableL2TP:e.enableL2TP??!1,enablePPTP:e.enablePPTP??!1,enableRadius:e.enableRadius??!1,radiusServer:e.radiusServer||"",enableMFA:e.enableMFA??!1,mfaProvider:e.mfaProvider||"totp",connections:Array.isArray(e.connections)?e.connections:[],tunnels:Array.isArray(e.tunnels)?e.tunnels:[]},this.connections.clear(),this.config.connections)for(const s of this.config.connections)s.id&&this.connections.set(s.id,{...s,bytesIn:s.bytesIn||0,bytesOut:s.bytesOut||0,packetsIn:s.packetsIn||0,packetsOut:s.packetsOut||0,protocol:s.protocol||this.config.vpnProtocol||"openvpn",encryptionAlgorithm:s.encryptionAlgorithm||this.config.encryptionAlgorithm,compressionEnabled:s.compressionEnabled??this.config.enableCompression,lastActivity:s.lastActivity||Date.now()});if(this.tunnels.clear(),this.config.tunnels)for(const s of this.config.tunnels)s.id&&this.tunnels.set(s.id,{...s,bytesIn:s.bytesIn||0,bytesOut:s.bytesOut||0,packetsIn:s.packetsIn||0,packetsOut:s.packetsOut||0,protocol:s.protocol||this.config.vpnProtocol||"openvpn",encryptionAlgorithm:s.encryptionAlgorithm||this.config.encryptionAlgorithm,compressionEnabled:s.compressionEnabled??this.config.enableCompression,keepAliveEnabled:s.keepAliveEnabled??this.config.enableKeepAlive,keepAliveInterval:s.keepAliveInterval||30,connections:s.connections||[],lastActivity:s.lastActivity||Date.now()});this.updateStats()}processPacket(t){performance.now();const e=t.timestamp||Date.now();let s,n;if(t.connectionId)s=this.connections.get(t.connectionId);else if(t.tunnelId)n=this.tunnels.get(t.tunnelId);else for(const h of this.connections.values())if(h.remoteIP===t.source&&h.status==="connected"){s=h;break}if(!s&&!n){const h=this.calculateEncryptionLatency(this.config?.encryptionAlgorithm||"aes-256");return this.recordLatency(h),{success:!1,encrypted:!1,latency:h,error:"No active VPN connection or tunnel found",bytesProcessed:0}}const i=!t.encrypted&&s?.status==="connected",o=!!(t.encrypted&&s?.status==="connected");let r=0,u=0;(i||o)&&(r+=this.calculateEncryptionLatency(s?.encryptionAlgorithm||n?.encryptionAlgorithm||this.config?.encryptionAlgorithm||"aes-256"),this.stats.encryptionOperations++),(s?.compressionEnabled||n?.compressionEnabled||this.config?.enableCompression)&&(r+=this.calculateCompressionLatency(),this.stats.compressionOperations++);const d=this.estimatePacketSize(t);return u=d,s&&(i||o?(s.bytesIn+=d,s.packetsIn++,this.stats.totalBytesIn+=d,this.stats.totalPacketsIn++):(s.bytesOut+=d,s.packetsOut++,this.stats.totalBytesOut+=d,this.stats.totalPacketsOut++),s.lastActivity=e),n&&(i||o?(n.bytesIn+=d,n.packetsIn++):(n.bytesOut+=d,n.packetsOut++),n.lastActivity=e),this.recordLatency(r),this.updateStats(),{success:!0,encrypted:!!(i||t.encrypted&&o),latency:r,connectionId:s?.id,tunnelId:n?.id,bytesProcessed:u}}createConnection(t){if(this.connections.size>=(this.config?.maxConnections||1e3))throw this.stats.failedConnections++,new Error("Maximum connections reached");this.connections.set(t.id,{...t,bytesIn:t.bytesIn||0,bytesOut:t.bytesOut||0,packetsIn:t.packetsIn||0,packetsOut:t.packetsOut||0,protocol:t.protocol||this.config?.vpnProtocol||"openvpn",encryptionAlgorithm:t.encryptionAlgorithm||this.config?.encryptionAlgorithm,compressionEnabled:t.compressionEnabled??this.config?.enableCompression??!0,lastActivity:t.lastActivity||Date.now()}),this.stats.totalConnections++,this.updateStats()}updateConnectionStatus(t,e){const s=this.connections.get(t);s&&(s.status=e,e==="connected"&&(s.connectedAt=s.connectedAt||Date.now()),this.updateStats())}removeConnection(t){this.connections.delete(t)&&this.updateStats()}createTunnel(t){this.tunnels.set(t.id,{...t,bytesIn:t.bytesIn||0,bytesOut:t.bytesOut||0,packetsIn:t.packetsIn||0,packetsOut:t.packetsOut||0,protocol:t.protocol||this.config?.vpnProtocol||"openvpn",encryptionAlgorithm:t.encryptionAlgorithm||this.config?.encryptionAlgorithm,compressionEnabled:t.compressionEnabled??this.config?.enableCompression,keepAliveEnabled:t.keepAliveEnabled??this.config?.enableKeepAlive,keepAliveInterval:t.keepAliveInterval||30,connections:t.connections||[],lastActivity:t.lastActivity||Date.now()}),this.stats.totalTunnels++,this.updateStats()}updateTunnelStatus(t,e){const s=this.tunnels.get(t);s&&(s.status=e,this.updateStats())}removeTunnel(t){this.tunnels.delete(t)&&this.updateStats()}getConnections(){return Array.from(this.connections.values())}getTunnels(){return Array.from(this.tunnels.values())}getStats(){return{...this.stats}}getConfig(){return this.config?{...this.config}:null}calculateEncryptionLatency(t){switch(t){case"aes-128":return .5+Math.random()*.5;case"aes-256":return .8+Math.random()*.7;case"chacha20-poly1305":return .6+Math.random()*.6;default:return 1+Math.random()*1}}calculateCompressionLatency(){return .2+Math.random()*.3}estimatePacketSize(t){if(t.payload){if(typeof t.payload=="string")return Buffer.byteLength(t.payload,"utf8");if(typeof t.payload=="object")return Buffer.byteLength(JSON.stringify(t.payload),"utf8")}return 1500}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const e=this.latencyHistory.reduce((s,n)=>s+n,0);this.stats.averageLatency=e/this.latencyHistory.length}updateStats(){this.stats.activeConnections=Array.from(this.connections.values()).filter(i=>i.status==="connected").length,this.stats.activeTunnels=Array.from(this.tunnels.values()).filter(i=>i.status==="up").length;let t=0,e=0,s=0,n=0;for(const i of this.connections.values())t+=i.bytesIn,e+=i.bytesOut,s+=i.packetsIn,n+=i.packetsOut;for(const i of this.tunnels.values())t+=i.bytesIn,e+=i.bytesOut,s+=i.packetsIn,n+=i.packetsOut;this.stats.totalBytesIn=t,this.stats.totalBytesOut=e,this.stats.totalPacketsIn=s,this.stats.totalPacketsOut=n}cleanupStaleConnections(){const t=(this.config?.connectionTimeout||300)*1e3,e=Date.now();for(const[s,n]of this.connections.entries())n.status==="connected"&&n.lastActivity&&e-n.lastActivity>t&&(n.status="disconnected",this.updateStats())}}class Ak{config=null;routingEngine;metrics={totalConnections:0,activeConnections:0,totalTunnels:0,activeTunnels:0,totalBytesIn:0,totalBytesOut:0,totalPacketsIn:0,totalPacketsOut:0,encryptionOperations:0,compressionOperations:0,failedConnections:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;packetCount=0;byteCount=0;connectionCount=0;lastConnectionTime=null;simulatedPacketRate=0;simulatedConnectionRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new kk}initializeConfig(t){const e=t.data.config||{};this.config={vpnProtocol:e.vpnProtocol||"openvpn",encryptionAlgorithm:e.encryptionAlgorithm||"aes-256",enableCompression:e.enableCompression??!0,enableKeepAlive:e.enableKeepAlive??!0,maxConnections:e.maxConnections||1e3,connectionTimeout:e.connectionTimeout||300,enableSSL:e.enableSSL??!0,sslPort:e.sslPort||443,enableIPSec:e.enableIPSec??!0,ipsecPort:e.ipsecPort||500,enableL2TP:e.enableL2TP??!1,enablePPTP:e.enablePPTP??!1,enableRadius:e.enableRadius??!1,radiusServer:e.radiusServer||"",enableMFA:e.enableMFA??!1,mfaProvider:e.mfaProvider||"totp",connections:Array.isArray(e.connections)?e.connections:[],tunnels:Array.isArray(e.tunnels)?e.tunnels:[]},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processPacket(t){performance.now();const e={source:t.source,destination:t.destination,protocol:t.protocol,port:t.port,sourcePort:t.sourcePort,payload:t.payload,encrypted:t.encrypted,connectionId:t.connectionId,tunnelId:t.tunnelId,timestamp:Date.now()},s=this.routingEngine.processPacket(e),n=Date.now();return this.firstPacketTime||(this.firstPacketTime=n),this.lastPacketTime=n,this.packetCount++,this.byteCount+=s.bytesProcessed,this.updateMetricsFromStats(),{success:s.success,encrypted:s.encrypted,latency:s.latency,error:s.error,bytesProcessed:s.bytesProcessed}}createConnection(t){try{this.routingEngine.createConnection(t),this.connectionCount++,this.lastConnectionTime=Date.now(),this.updateMetricsFromStats()}catch(e){throw this.metrics.failedConnections++,e}}updateConnectionStatus(t,e){this.routingEngine.updateConnectionStatus(t,e),this.updateMetricsFromStats()}removeConnection(t){this.routingEngine.removeConnection(t),this.updateMetricsFromStats()}createTunnel(t){this.routingEngine.createTunnel(t),this.updateMetricsFromStats()}updateTunnelStatus(t,e){this.routingEngine.updateTunnelStatus(t,e),this.updateMetricsFromStats()}removeTunnel(t){this.routingEngine.removeTunnel(t),this.updateMetricsFromStats()}getConnections(){return this.routingEngine.getConnections()}getTunnels(){return this.routingEngine.getTunnels()}getConfig(){return this.config?{...this.config}:null}getMetrics(){return{...this.metrics}}getRoutingEngine(){return this.routingEngine}calculateLoad(){const t=Date.now(),e=1e3;let s=0,n=0,i=0;if(this.firstPacketTime&&this.lastPacketTime){const b=(this.lastPacketTime-this.firstPacketTime)/1e3;b>0&&(s=this.packetCount/b,n=this.byteCount/b)}if(this.lastConnectionTime){const b=(t-this.lastConnectionTime)/1e3;b>0&&b<e&&(i=this.connectionCount/b)}s===0&&(s=this.simulatedPacketRate),n===0&&(n=s*1500),i===0&&(i=this.simulatedConnectionRate);const o=this.config?.maxConnections||1e3,r=Math.min(1,this.metrics.activeConnections/o),u=this.metrics.activeTunnels>0?.3:0,d=Math.min(.5,n/(100*1024*1024)),h=Math.min(.2,this.metrics.encryptionOperations/1e4),p=Math.min(.95,.1+r*.4+u+d+h),g=this.metrics.totalConnections+this.metrics.failedConnections,v=g>0?this.metrics.failedConnections/g:0;return{connectionsPerSecond:i,packetsPerSecond:s,bytesPerSecond:n,averageLatency:this.metrics.averageLatency,errorRate:v,utilization:p}}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics={totalConnections:t.totalConnections,activeConnections:t.activeConnections,totalTunnels:t.totalTunnels,activeTunnels:t.activeTunnels,totalBytesIn:t.totalBytesIn,totalBytesOut:t.totalBytesOut,totalPacketsIn:t.totalPacketsIn,totalPacketsOut:t.totalPacketsOut,encryptionOperations:t.encryptionOperations,compressionOperations:t.compressionOperations,failedConnections:t.failedConnections,averageLatency:t.averageLatency}}simulateIncomingTraffic(t,e){this.simulatedPacketRate=t,this.simulatedConnectionRate=e,this.lastSimulationTime=Date.now()}cleanupStaleConnections(){this.routingEngine.cleanupStaleConnections(),this.updateMetricsFromStats()}}class Dk{distributions=new Map;edgeLocations=new Map;cache=new Map;stats;requestHistory=[];MAX_CACHE_SIZE=1e3;MAX_HISTORY_SIZE=1e3;constructor(){this.stats={totalRequests:0,totalCacheHits:0,totalCacheMisses:0,totalBandwidth:0,totalErrors:0,averageLatency:0,averageCacheHitRate:0,requestsPerSecond:0,bandwidthPerSecond:0,errorRate:0,distributions:new Map,edgeLocations:new Map}}initializeConfig(t){const e=t.data.config||{},s=e.distributions||[];this.distributions.clear();for(const i of s)this.distributions.set(i.id,{id:i.id,domain:i.domain,origin:i.origin,status:i.status||"deployed",edgeLocations:i.edgeLocations||0,cachePolicy:i.cachePolicy||e.cachePolicy||"cache-first",defaultTTL:i.defaultTTL||e.defaultTTL||3600,maxTTL:i.maxTTL||e.maxTTL||86400,enableCompression:i.enableCompression??e.enableCompression??!0,compressionType:i.compressionType||e.compressionType||"gzip",enableHTTP2:i.enableHTTP2??e.enableHTTP2??!0,enableHTTP3:i.enableHTTP3??e.enableHTTP3??!1,enableHTTPS:i.enableHTTPS??e.enableHTTPS??!0,enableGeoRouting:i.enableGeoRouting??e.enableGeoRouting??!1,enableDDoSProtection:i.enableDDoSProtection??e.enableDDoSProtection??!0});const n=e.edgeLocations||[];this.edgeLocations.clear();for(const i of n)this.edgeLocations.set(i.id,{id:i.id,region:i.region,city:i.city,status:i.status||"active",capacity:i.capacity||1e4,latency:i.latency||50});for(const i of this.distributions.keys())this.stats.distributions.set(i,{requests:0,cacheHits:0,cacheMisses:0,bandwidth:0,errors:0});for(const i of this.edgeLocations.keys())this.stats.edgeLocations.set(i,{requests:0,cacheHits:0,bandwidth:0,latency:0})}processRequest(t){const e=Date.now();this.stats.totalRequests++;const s=Array.from(this.distributions.values()).find(h=>h.domain===t.domain&&h.status==="deployed");if(!s)return this.stats.totalErrors++,{status:404,headers:{},cacheHit:!1,servedFrom:"origin",latency:Date.now()-e,size:0};const n=this.stats.distributions.get(s.id);n&&n.requests++;const i=this.selectEdgeLocation(t,s);if(i){const h=this.stats.edgeLocations.get(i.id);h&&h.requests++}let o=!1,r;if(t.method==="GET"&&s.cachePolicy!=="bypass"){const h=this.getCacheKey(t,s);if(r=this.cache.get(h),r&&r.expiresAt>Date.now()){if(o=!0,this.stats.totalCacheHits++,r.hitCount++,r.lastAccessed=Date.now(),n&&n.cacheHits++,i){const p=this.stats.edgeLocations.get(i.id);p&&p.cacheHits++}}else this.stats.totalCacheMisses++,n&&n.cacheMisses++}let u=0;o&&r?u=i?.latency?i.latency*.1:5:(u=i?.latency?i.latency*2:100,u+=50+Math.random()*50);let d=r?.size||1024;if(s.enableCompression&&t.method==="GET"){const h=.3+Math.random()*.2;d=Math.floor(d*h)}if(this.stats.totalBandwidth+=d,n&&(n.bandwidth+=d),i){const h=this.stats.edgeLocations.get(i.id);h&&(h.bandwidth+=d)}if(!o&&t.method==="GET"&&s.cachePolicy!=="bypass"){const h=this.getCacheKey(t,s),p=s.defaultTTL||3600;this.cache.set(h,{key:h,data:{status:200,body:"cached"},headers:{"content-type":"application/json"},expiresAt:Date.now()+p*1e3,size:d,hitCount:0,lastAccessed:Date.now()}),this.cache.size>this.MAX_CACHE_SIZE&&this.evictCacheEntries()}return this.requestHistory.push({timestamp:Date.now(),size:d}),this.requestHistory.length>this.MAX_HISTORY_SIZE&&this.requestHistory.shift(),this.updateStats(),{status:200,headers:{"content-type":"application/json","cache-control":`max-age=${s.defaultTTL||3600}`,"x-cache":o?"HIT":"MISS","x-edge-location":i?.city||"unknown"},body:o?r?.data:{status:"ok"},cacheHit:o,servedFrom:o?"cache":"origin",edgeLocation:i?.city,latency:u,size:d}}selectEdgeLocation(t,e){const s=Array.from(this.edgeLocations.values()).filter(n=>n.status==="active");if(s.length!==0){if(e.enableGeoRouting&&t.clientIP){const n=this.hashString(t.clientIP);return s[n%s.length]}return s.reduce((n,i)=>(i.latency||50)<(n.latency||50)?i:n)}}getCacheKey(t,e){const s=t.query?"?"+Object.entries(t.query).sort().map(([n,i])=>`${n}=${i}`).join("&"):"";return`${e.id}:${t.method}:${t.path}${s}`}evictCacheEntries(){const t=Array.from(this.cache.entries());t.sort((s,n)=>s[1].lastAccessed-n[1].lastAccessed);const e=Math.floor(t.length*.1);for(let s=0;s<e;s++)this.cache.delete(t[s][0])}updateStats(){const t=this.stats.totalCacheHits+this.stats.totalCacheMisses;this.stats.averageCacheHitRate=t>0?this.stats.totalCacheHits/t:0,this.stats.averageLatency=50;const s=Date.now()-1e3,n=this.requestHistory.filter(o=>o.timestamp>s);this.stats.requestsPerSecond=n.length;const i=n.reduce((o,r)=>o+r.size,0);this.stats.bandwidthPerSecond=i,this.stats.errorRate=this.stats.totalRequests>0?this.stats.totalErrors/this.stats.totalRequests:0}purgeCache(t,e){let s=0;if(t&&e){const n=`${t}:`;for(const[i,o]of this.cache.entries())i.startsWith(n)&&i.includes(e)&&(this.cache.delete(i),s++)}else if(t){const n=`${t}:`;for(const[i]of this.cache.entries())i.startsWith(n)&&(this.cache.delete(i),s++)}else s=this.cache.size,this.cache.clear();return s}getStats(){return{...this.stats}}getDistributions(){return Array.from(this.distributions.values())}getEdgeLocations(){return Array.from(this.edgeLocations.values())}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}}class Pk{config=null;routingEngine;metrics={totalDistributions:0,activeDistributions:0,totalEdgeLocations:0,activeEdgeLocations:0,totalRequests:0,totalCacheHits:0,totalCacheMisses:0,totalBandwidth:0,averageCacheHitRate:0,averageLatency:0,requestsPerSecond:0,bandwidthPerSecond:0,errorRate:0};simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new Dk}initializeConfig(t){const e=t.data.config||{};this.config={cdnProvider:e.cdnProvider||"cloudflare",distributions:Array.isArray(e.distributions)?e.distributions:[],edgeLocations:Array.isArray(e.edgeLocations)?e.edgeLocations:[],enableCaching:e.enableCaching??!0,cacheTTL:e.cacheTTL||3600,enableCompression:e.enableCompression??!0,compressionType:e.compressionType||"gzip",enableSSL:e.enableSSL??!0,enableHTTP2:e.enableHTTP2??!0,enableHTTP3:e.enableHTTP3??!1,enablePurge:e.enablePurge??!0,enableGeoRouting:e.enableGeoRouting??!1,enableDDoSProtection:e.enableDDoSProtection??!0,defaultTTL:e.defaultTTL||3600,maxTTL:e.maxTTL||86400,cachePolicy:e.cachePolicy||"cache-first"},this.routingEngine.initializeConfig(t),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),s={id:`req-${Date.now()}-${Math.random()}`,method:t.method,path:t.path,domain:t.domain,headers:t.headers,query:t.query,body:t.body,clientIP:t.clientIP,userAgent:t.userAgent,timestamp:Date.now()},n=this.routingEngine.processRequest(s);return performance.now()-e,this.updateMetricsFromStats(),{success:n.status<400,cacheHit:n.cacheHit,latency:n.latency,error:n.status>=400?`HTTP ${n.status}`:void 0,size:n.size}}getConfig(){return this.config?{...this.config}:null}getMetrics(){return{...this.metrics}}getRoutingEngine(){return this.routingEngine}calculateLoad(){const t=this.routingEngine.getStats(),e=this.routingEngine.getDistributions(),s=this.routingEngine.getEdgeLocations(),n=t.requestsPerSecond||this.simulatedRequestRate,i=t.bandwidthPerSecond||n*1024,o=t.averageLatency||50,r=t.errorRate||0,u=t.averageCacheHitRate||0,d=e.filter(k=>k.status==="deployed").length,h=e.length||1,p=d/h,g=s.filter(k=>k.status==="active").length,v=s.length||1,b=g/v,x=s.reduce((k,T)=>k+(T.capacity||1e4),0),R=x>0?Math.min(1,n/x):0,C=Math.min(.95,.1+p*.2+b*.2+R*.5);return{requestsPerSecond:n,bandwidthPerSecond:i,averageLatency:o,errorRate:r,utilization:C,cacheHitRate:u}}updateMetricsFromStats(){const t=this.routingEngine.getStats(),e=this.routingEngine.getDistributions(),s=this.routingEngine.getEdgeLocations();this.metrics={totalDistributions:e.length,activeDistributions:e.filter(n=>n.status==="deployed").length,totalEdgeLocations:s.length,activeEdgeLocations:s.filter(n=>n.status==="active").length,totalRequests:t.totalRequests,totalCacheHits:t.totalCacheHits,totalCacheMisses:t.totalCacheMisses,totalBandwidth:t.totalBandwidth,averageCacheHitRate:t.averageCacheHitRate,averageLatency:t.averageLatency,requestsPerSecond:t.requestsPerSecond,bandwidthPerSecond:t.bandwidthPerSecond,errorRate:t.errorRate}}simulateIncomingTraffic(t){if(this.simulatedRequestRate=t,this.lastSimulationTime=Date.now(),t>0){const s=this.routingEngine.getDistributions().filter(n=>n.status==="deployed");if(s.length>0){const n=t/s.length;for(const i of s){const o=Math.floor(n*.8);for(let u=0;u<o;u++)this.routingEngine.processRequest({id:`sim-${Date.now()}-${Math.random()}`,method:"GET",path:`/api/resource/${Math.floor(Math.random()*100)}`,domain:i.domain,timestamp:Date.now(),clientIP:`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`});const r=Math.floor(n*.2);for(let u=0;u<r;u++)this.routingEngine.processRequest({id:`sim-${Date.now()}-${Math.random()}`,method:"POST",path:"/api/update",domain:i.domain,timestamp:Date.now(),clientIP:`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`})}}}}purgeCache(t,e){return this.routingEngine.purgeCache(t,e)}getDistributions(){return this.routingEngine.getDistributions()}getEdgeLocations(){return this.routingEngine.getEdgeLocations()}}class _k{config=null;pipelines=new Map;activeBuilds=new Map;nodes=new Map;plugins=new Map;jenkinsMetrics={buildsTotal:0,buildsSuccess:0,buildsFailed:0,buildsRunning:0,buildsPending:0,buildsPerMinute:0,averageBuildDuration:0,executorUtilization:0,executorIdle:0,executorBusy:0,pipelinesTotal:0,pipelinesEnabled:0,nodesTotal:0,nodesOnline:0,pluginsTotal:0,pluginsActive:0,artifactStorageBytes:0,requestsTotal:0,requestsErrors:0};processRequest(t=!0){this.jenkinsMetrics.requestsTotal++,t||this.jenkinsMetrics.requestsErrors++}buildHistory=[];MAX_BUILD_HISTORY=1e3;lastBuildTrigger=new Map;buildTriggerCounter=0;artifacts=new Map;initializeConfig(t){const e=t.data.config||{};this.config={jenkinsUrl:e.jenkinsUrl||"http://jenkins:8080",enableCSRF:e.enableCSRF??!0,executorCount:e.executorCount||2,enablePlugins:e.enablePlugins??!0,plugins:e.plugins||["git","docker","kubernetes"],enablePipeline:e.enablePipeline??!0,enableBlueOcean:e.enableBlueOcean??!1,enableArtifactArchiving:e.enableArtifactArchiving??!0,retentionDays:e.retentionDays||30,pipelines:e.pipelines||[],nodes:e.nodes||[],buildTriggerRate:e.buildTriggerRate||.5,averageBuildDuration:e.averageBuildDuration||12e4,failureRate:e.failureRate||.1},this.initializePipelines(),this.initializeNodes(),this.initializePlugins()}initializePipelines(){if(this.pipelines.clear(),!this.config||!this.config.enablePipeline)return;const t=this.config.pipelines||[];for(const e of t){const s=e.lastBuild||0,n={id:e.id,name:e.name,status:"pending",lastBuild:s,lastSuccessfulBuild:void 0,lastFailedBuild:void 0,duration:void 0,branch:e.branch||"main",enabled:e.enabled!==!1,builds:[],nextBuildNumber:s+1};n.config={triggers:e.triggers||[],parameters:e.parameters||[],environmentVariables:e.environmentVariables||{},postBuildActions:e.postBuildActions||[]},this.pipelines.set(n.id,n)}}calculatePipelineStatus(t){return t.builds.length===0?Array.from(this.activeBuilds.values()).find(n=>n.pipelineId===t.id&&n.status==="running")?"running":"pending":t.builds[t.builds.length-1].status}initializeNodes(){this.nodes.clear();const t={id:"master",name:"master",status:"online",numExecutors:this.config?.executorCount||2,busyExecutors:0,idleExecutors:this.config?.executorCount||2,labels:["master"]};this.nodes.set("master",t);const e=this.config?.nodes||[];for(const s of e){const n={id:s.id,name:s.name,status:"online",numExecutors:s.numExecutors||1,busyExecutors:0,idleExecutors:s.numExecutors||1,labels:s.labels||[]};this.nodes.set(n.id,n)}}initializePlugins(){if(this.plugins.clear(),!this.config||!this.config.enablePlugins)return;const t={git:{version:"4.11.0",description:"Git integration plugin"},docker:{version:"1.2.9",description:"Docker pipeline plugin",dependencies:["workflow-aggregator"]},kubernetes:{version:"1.31.1",description:"Kubernetes plugin for dynamic agent provisioning"},"workflow-aggregator":{version:"2.6",description:"Pipeline plugin aggregator"},"blue-ocean":{version:"1.25.3",description:"Blue Ocean UI for Jenkins",dependencies:["workflow-aggregator"]},credentials:{version:"2.6.1",description:"Credentials management plugin"},"ssh-slaves":{version:"1.32.0",description:"SSH agent plugin"},junit:{version:"1.53",description:"JUnit test result publisher"},"maven-plugin":{version:"3.20",description:"Maven integration plugin"},gradle:{version:"1.36.1",description:"Gradle plugin"}},e=this.config.plugins||[];for(const s of e){let n,i=!0;typeof s=="string"?n=s:(n=s.name||s,i=s.enabled!==!1);const o=t[n]||{version:"1.0.0",description:`${n} plugin`},r={name:n,version:o.version,description:o.description,enabled:i,active:i,dependencies:o.dependencies};this.plugins.set(n,r)}this.updatePluginActiveStatus()}updatePluginActiveStatus(){for(const t of this.plugins.values()){if(!t.enabled){t.active=!1;continue}if(t.dependencies&&t.dependencies.length>0){const e=t.dependencies.every(s=>{const n=this.plugins.get(s);return n&&n.enabled&&n.active});t.active=e}else t.active=t.enabled}}addPlugin(t,e,s){if(this.plugins.has(t))return!1;const n={name:t,version:e||"1.0.0",description:s||`${t} plugin`,enabled:!0,active:!0};return this.plugins.set(t,n),this.updatePluginActiveStatus(),!0}removePlugin(t){if(!this.plugins.get(t))return{success:!1,reason:"Plugin not found"};const s=Array.from(this.plugins.values()).filter(n=>n.dependencies?.includes(t));return s.length>0?{success:!1,reason:`Cannot remove plugin. It is required by: ${s.map(n=>n.name).join(", ")}`}:(this.plugins.delete(t),this.updatePluginActiveStatus(),{success:!0})}setPluginEnabled(t,e){const s=this.plugins.get(t);return s?(s.enabled=e,this.updatePluginActiveStatus(),!0):!1}performUpdate(t){this.config&&(this.updateActiveBuilds(t),this.config.enablePipeline&&this.triggerBuilds(t),this.config.enableArtifactArchiving&&this.cleanupArtifacts(t),this.updateMetrics())}updateActiveBuilds(t){const e=Array.from(this.activeBuilds.entries());for(const[s,n]of e)if(n.status==="running")try{n.startTime&&(t-n.startTime)%5e3<100&&this.updateBuildLogs(n,t);const i=t-n.startTime,o=n.estimatedDuration||this.config?.averageBuildDuration||12e4;if(i<0)continue;if(n.progress=Math.min(100,Math.max(0,Math.floor(i/o*100))),i>=o){const r=Math.random()<(this.config?.failureRate||.1);if(n.status=r?"failed":"success",n.duration=i,n.progress=100,n.logs&&(r?(n.logs.push("[Pipeline] FAILED"),n.logs.push(`Build failed after ${(i/1e3).toFixed(1)}s`)):(n.logs.push("[Pipeline] SUCCESS"),n.logs.push(`Build completed successfully in ${(i/1e3).toFixed(1)}s`)),n.logs.push(`Finished: ${n.status}`)),n.stages)for(const d of n.stages)(d.status==="running"||d.status==="pending")&&(d.status=n.status,d.startTime&&(d.duration=t-d.startTime));this.executePostBuildActions(n,n.status==="success");const u=this.pipelines.get(n.pipelineId);u&&(u.lastBuild=n.number,n.status==="success"?u.lastSuccessfulBuild=n.number:n.status==="failed"&&(u.lastFailedBuild=n.number),u.duration=n.duration,u.builds.push(n),u.builds.length>50&&u.builds.shift(),u.status=this.calculatePipelineStatus(u)),this.freeExecutor(s),this.addBuildToHistory(n),this.activeBuilds.delete(s)}}catch(i){console.error(`Error updating build ${s}:`,i),n.status="failed",this.activeBuilds.delete(s),this.freeExecutor(s)}}triggerBuilds(t){if(!(!this.config||!this.config.enablePipeline))for(const[e,s]of this.pipelines.entries()){if(!s.enabled)continue;const i=(s.config||{}).triggers||[];let o=!1;if(i.length===0){const r=this.config.buildTriggerRate||0;if(r>0){const u=6e4/r,d=this.lastBuildTrigger.get(e)||0;t-d>=u&&(o=!0)}}else for(const r of i)if(r.enabled){if(r.type==="cron"&&r.config?.schedule)o=this.shouldTriggerCron(r.config.schedule,e,t);else if(r.type==="scm"&&r.config?.pollInterval){const u=r.config.pollInterval*60*1e3,d=this.lastBuildTrigger.get(`${e}-scm`)||0;t-d>=u&&(o=!0,this.lastBuildTrigger.set(`${e}-scm`,t))}}o&&this.hasAvailableExecutor()&&(this.startBuild(e,t),this.lastBuildTrigger.set(e,t))}}shouldTriggerCron(t,e,s){const n=this.lastBuildTrigger.get(`${e}-cron`)||0,i=60*1e3;return s-n>=i?(this.lastBuildTrigger.set(`${e}-cron`,s),!0):!1}triggerWebhook(t,e,s){const n=this.pipelines.get(t);if(!n)return{success:!1,reason:"Pipeline not found"};if(!n.enabled)return{success:!1,reason:"Pipeline is disabled"};const o=(n.config||{}).triggers||[],r=o.find(d=>d.type==="webhook"&&d.enabled);if(!r&&o.length>0)return{success:!1,reason:"Webhook trigger not configured or disabled"};if(r?.config?.branches&&e&&!r.config.branches.includes(e))return{success:!1,reason:`Branch ${e} not in allowed branches`};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const u=Date.now();return this.startBuild(t,u,{branch:e,commit:s,triggeredBy:"webhook"}),{success:!0}}triggerBuildManually(t){const e=this.pipelines.get(t);if(!e)return{success:!1,reason:"Pipeline not found"};if(!e.enabled)return{success:!1,reason:"Pipeline is disabled"};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const s=Date.now();return this.startBuild(t,s),{success:!0,buildId:`${t}-${e.nextBuildNumber-1}`}}startBuild(t,e,s){const n=this.pipelines.get(t);if(!n)return;const i=n.nextBuildNumber++,o=`${t}-${i}`,r=this.config?.averageBuildDuration||12e4,u=r*.3,d=r+(Math.random()*2-1)*u,h=this.generateBuildLogs(i,n.name,n.branch||"main"),p=this.generateArtifacts(n.name,i),g=n.config||{},v=s?.parameters||{},b=g.parameters||[],x={};for(const k of b)k.defaultValue!==void 0&&(x[k.name]=k.defaultValue);Object.assign(x,v);const R={...g.environmentVariables||{},...x},C={id:o,number:i,pipelineId:t,status:"running",startTime:e,estimatedDuration:d,progress:0,branch:s?.branch||n.branch,commit:s?.commit,logs:h,artifacts:p.map(k=>k.name),triggeredBy:s?.triggeredBy||"system",stages:[{name:"Checkout",status:"running",startTime:e},{name:"Build",status:"pending"},{name:"Test",status:"pending"},{name:"Deploy",status:"pending"}]};C.parameters=x,C.environmentVariables=R,C.postBuildActions=g.postBuildActions||[];for(const k of p)this.artifacts.set(`${o}-${k.name}`,{size:k.size,created:e});this.activeBuilds.set(o,C),n.status=this.calculatePipelineStatus(n),this.allocateExecutor(o),this.jenkinsMetrics.buildsTotal++,this.jenkinsMetrics.buildsRunning++}generateBuildLogs(t,e,s){const n=[];return n.push("Started by system"),n.push(`Building on master in workspace /var/jenkins_home/workspace/${e}`),n.push(`[${e}] $ /usr/bin/git rev-parse --is-inside-work-tree`),n.push("true"),n.push(`[${e}] $ /usr/bin/git config remote.origin.url https://github.com/example/${e}.git`),n.push(`[${e}] $ /usr/bin/git --version`),n.push("git version 2.39.0"),n.push(`[${e}] $ /usr/bin/git fetch --tags --force --progress -- https://github.com/example/${e}.git +refs/heads/${s}:refs/remotes/origin/${s}`),n.push(`From https://github.com/example/${e}`),n.push(` * [new branch]      ${s}       -> origin/${s}`),n.push(`[${e}] $ /usr/bin/git rev-parse "refs/remotes/origin/${s}^{commit}"`),n.push("abc123def456789"),n.push(`[${e}] $ /usr/bin/git checkout -f abc123def456789`),n.push(`HEAD is now at abc123def456789 Commit message for build #${t}`),n.push(`[${e}] $ /usr/bin/git clean -fdx`),n.push("Removing .gradle/"),n.push("Removing build/"),n.push("[Pipeline] Start of Pipeline"),n.push("[Pipeline] node"),n.push(`Running on Jenkins in /var/jenkins_home/workspace/${e}`),n.push("[Pipeline] {"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Checkout)"),n.push("[Pipeline] checkout"),n.push(`Checking out abc123def456789 from ${s}`),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Build)"),n.push("[Pipeline] sh"),n.push('+ echo "Building application..."'),n.push("Building application..."),n.push("[Pipeline] sh"),n.push("+ ./gradlew build -x test"),n.push("> Task :compileJava"),n.push("> Task :processResources"),n.push("> Task :classes"),n.push("> Task :jar"),n.push("BUILD SUCCESSFUL in 45s"),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Test)"),n.push("[Pipeline] sh"),n.push('+ echo "Running tests..."'),n.push("Running tests..."),n.push("[Pipeline] sh"),n.push("+ ./gradlew test"),n.push("> Task :test"),n.push("Test results: 127 passed, 0 failed"),n.push("BUILD SUCCESSFUL in 30s"),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] stage"),n.push("[Pipeline] { (Deploy)"),n.push("[Pipeline] sh"),n.push('+ echo "Deploying to staging..."'),n.push("Deploying to staging..."),n.push("[Pipeline] }"),n.push("[Pipeline] // stage"),n.push("[Pipeline] }"),n.push("[Pipeline] // node"),n.push("[Pipeline] End of Pipeline"),n}generateArtifacts(t,e){const s=[];return s.push({name:`app-${e}.jar`,size:15*1024*1024}),s.push({name:`app-${e}-sources.jar`,size:3*1024*1024}),s.push({name:`test-results-${e}.xml`,size:512*1024}),s.push({name:`coverage-report-${e}.html`,size:2*1024*1024}),s}cancelBuild(t){const e=this.activeBuilds.get(t);if(!e)return{success:!1,reason:"Build not found or already completed"};if(e.status!=="running"&&e.status!=="pending")return{success:!1,reason:"Build is not running"};if(e.status="aborted",e.duration=Date.now()-e.startTime,e.progress=0,e.logs&&(e.logs.push("[Pipeline] Aborted by user"),e.logs.push("[Pipeline] Terminated")),e.stages)for(const n of e.stages)(n.status==="running"||n.status==="pending")&&(n.status="aborted");this.freeExecutor(t);const s=this.pipelines.get(e.pipelineId);return s&&(s.builds.push(e),s.builds.length>50&&s.builds.shift(),s.status=this.calculatePipelineStatus(s),!s.builds.some(i=>i.status==="success")&&s.builds.every(i=>i.status==="aborted"||i.status==="failed")&&(s.status="pending")),this.activeBuilds.delete(t),this.jenkinsMetrics.buildsRunning--,{success:!0}}updateBuildLogs(t,e){if(!t.logs||t.status!=="running")return;const s=e-t.startTime,n=t.estimatedDuration||12e4,i=Math.min(100,Math.floor(s/n*100)),o=[10,30,50,70,90];for(const r of o)i>=r&&!t.logs.some(u=>u.includes(`Progress: ${r}%`))&&t.logs.push(`[Pipeline] Progress: ${r}% completed`);if(t.stages){const r=Math.floor(i/(100/t.stages.length));for(let u=0;u<t.stages.length;u++)(u<r&&t.stages[u].status==="pending"||u===r&&t.stages[u].status==="pending")&&(t.stages[u].status="running",t.stages[u].startTime=e)}}getBuildLogs(t){return this.getBuildById(t)?.logs}getBuildArtifacts(t){const e=this.getBuildById(t);if(!e||!e.artifacts)return[];const s=[];for(const n of e.artifacts){const i=`${t}-${n}`,o=this.artifacts.get(i);o&&s.push({name:n,size:o.size})}return s}executePostBuildActions(t,e){const s=t.postBuildActions||[];for(const n of s)if(n.enabled)switch(n.type){case"email":if(t.logs){const i=n.config?.recipients||["default@example.com"];t.logs.push(`[Post-Build] Sending email notification to: ${i.join(", ")}`),t.logs.push(`[Post-Build] Email subject: Build ${t.status==="success"?"SUCCESS":"FAILED"} - ${t.pipelineId} #${t.number}`)}break;case"archive":if(t.logs){const i=n.config?.archivePattern||"**/*";t.logs.push(`[Post-Build] Archiving artifacts matching pattern: ${i}`),t.artifacts&&t.artifacts.length>0&&t.logs.push(`[Post-Build] Archived ${t.artifacts.length} artifact(s)`)}break;case"publish":if(t.logs){const i=n.config?.publishTarget||"default";t.logs.push(`[Post-Build] Publishing test results to: ${i}`),t.logs.push("[Post-Build] Published build metrics and artifacts")}break;case"deploy":if(e&&n.config?.deployEnv){if(t.logs){const i=n.config.deployEnv;t.logs.push(`[Post-Build] Deploying to environment: ${i}`),t.logs.push(`[Post-Build] Deployment initiated for build #${t.number}`),t.logs.push(`[Post-Build] Deployment to ${i} completed successfully`)}}else e||t.logs&&t.logs.push("[Post-Build] Skipping deployment - build failed");break}}getPipelineConfig(t){const e=this.pipelines.get(t);return e?e.config||{}:null}updatePipelineConfig(t,e){const s=this.pipelines.get(t);return s?(s.config={...s.config||{},...e},!0):!1}hasAvailableExecutor(){for(const t of this.nodes.values())if(t.idleExecutors>0)return!0;return!1}allocateExecutor(t){for(const e of this.nodes.values())if(e.idleExecutors>0){e.idleExecutors--,e.busyExecutors++;return}}freeExecutor(t){for(const e of this.nodes.values())if(e.busyExecutors>0){e.busyExecutors--,e.idleExecutors++;return}}addBuildToHistory(t){t.duration&&(this.buildHistory.push({timestamp:t.startTime,duration:t.duration,status:t.status}),this.buildHistory.length>this.MAX_BUILD_HISTORY&&this.buildHistory.shift(),t.status==="success"?this.jenkinsMetrics.buildsSuccess++:t.status==="failed"&&this.jenkinsMetrics.buildsFailed++,this.jenkinsMetrics.buildsRunning--)}cleanupArtifacts(t){if(!this.config)return;const e=(this.config.retentionDays||30)*24*60*60*1e3;for(const[s,n]of this.artifacts.entries())t-n.created>e&&this.artifacts.delete(s)}updateMetrics(){this.jenkinsMetrics.buildsRunning=this.activeBuilds.size,this.jenkinsMetrics.buildsPending=Array.from(this.activeBuilds.values()).filter(u=>u.status==="pending").length;const t=this.buildHistory.length;this.jenkinsMetrics.buildsTotal=t+this.activeBuilds.size;const e=Date.now()-6e4,s=this.buildHistory.filter(u=>u.timestamp>e);if(this.jenkinsMetrics.buildsPerMinute=s.length,this.buildHistory.length>0){const u=this.buildHistory.slice(-100),d=u.reduce((h,p)=>h+p.duration,0)/u.length;this.jenkinsMetrics.averageBuildDuration=d}let n=0,i=0,o=0;for(const u of this.nodes.values())n+=u.numExecutors,i+=u.busyExecutors,o+=u.idleExecutors;this.jenkinsMetrics.executorBusy=i,this.jenkinsMetrics.executorIdle=o,this.jenkinsMetrics.executorUtilization=n>0?i/n*100:0,this.jenkinsMetrics.pipelinesTotal=this.pipelines.size,this.jenkinsMetrics.pipelinesEnabled=Array.from(this.pipelines.values()).filter(u=>u.enabled).length,this.jenkinsMetrics.nodesTotal=this.nodes.size,this.jenkinsMetrics.nodesOnline=Array.from(this.nodes.values()).filter(u=>u.status==="online").length,this.jenkinsMetrics.pluginsTotal=this.plugins.size,this.jenkinsMetrics.pluginsActive=Array.from(this.plugins.values()).filter(u=>u.active).length;let r=0;for(const u of this.artifacts.values())r+=u.size;this.jenkinsMetrics.artifactStorageBytes=r}getJenkinsMetrics(){return{...this.jenkinsMetrics}}getPipelines(){for(const t of this.pipelines.values())t.status=this.calculatePipelineStatus(t);return Array.from(this.pipelines.values())}getActiveBuilds(){return Array.from(this.activeBuilds.values())}getNodes(){return Array.from(this.nodes.values())}getPlugins(){return Array.from(this.plugins.values())}getPipelineBuilds(t){const e=this.pipelines.get(t);return e?e.builds:[]}getAllBuilds(){const t=[];t.push(...Array.from(this.activeBuilds.values()));for(const e of this.pipelines.values()){const s=e.builds.slice(-50);t.push(...s)}return t.sort((e,s)=>{const n=e.startTime||0;return(s.startTime||0)-n})}getBuildById(t){if(this.activeBuilds.has(t))return this.activeBuilds.get(t);for(const e of this.pipelines.values()){const s=e.builds.find(n=>n.id===t);if(s)return s}}updateConfig(t){const e=this.config,s=new Set(this.pipelines.keys());this.initializeConfig(t);const n=this.config?.executorCount||2;e&&e.executorCount!==n&&this.updateExecutorCount(n);const i=new Set(this.pipelines.keys());for(const d of s)if(!i.has(d)){for(const[h,p]of this.activeBuilds.entries())p.pipelineId===d&&(p.status="aborted",this.freeExecutor(h),this.activeBuilds.delete(h));this.pipelines.delete(d)}const o=this.config?.pipelines||[];for(const d of o){const h=this.pipelines.get(d.id);h&&(h.name=d.name,h.branch=d.branch||"main",h.enabled=d.enabled!==!1,h.config={triggers:d.triggers||[],parameters:d.parameters||[],environmentVariables:d.environmentVariables||{},postBuildActions:d.postBuildActions||[]})}const r=this.config?.nodes||[],u=new Set(this.nodes.keys());for(const d of u)d!=="master"&&!r.find(h=>h.id===d)&&this.nodes.delete(d);for(const d of r){const h=this.nodes.get(d.id);if(h)h.name=d.name,h.numExecutors=d.numExecutors||1,h.labels=d.labels||[],h.idleExecutors=h.numExecutors-h.busyExecutors;else{const p={id:d.id,name:d.name,status:"online",numExecutors:d.numExecutors||1,busyExecutors:0,idleExecutors:d.numExecutors||1,labels:d.labels||[]};this.nodes.set(d.id,p)}}}setPipelineEnabled(t,e){const s=this.pipelines.get(t);return s?(s.enabled=e,!0):!1}updateExecutorCount(t){const e=this.nodes.get("master");return!e||t<e.busyExecutors?!1:(e.numExecutors,e.numExecutors=t,e.idleExecutors=t-e.busyExecutors,!0)}canUpdateExecutorCount(t){const e=this.nodes.get("master");return e?t<1||t>100?{can:!1,reason:"Executor count must be between 1 and 100"}:t<e.busyExecutors?{can:!1,reason:`Cannot reduce executors to ${t}. Currently ${e.busyExecutors} executors are busy.`}:{can:!0}:{can:!1,reason:"Master node not found"}}setPipelineEnabled(t,e){const s=this.pipelines.get(t);return s?(s.enabled=e,!0):!1}calculateComponentMetrics(){const t=this.getJenkinsMetrics(),e=t.buildsPerMinute/60,s=t.averageBuildDuration,n=t.executorUtilization,i=t.buildsSuccess+t.buildsFailed,o=i>0?t.buildsFailed/i*100:0;return{throughput:e,latency:s,utilization:n,errorRate:o}}}class Lk{config=null;pipelines=new Map;activeJobs=new Map;runners=new Map;variables=new Map;environments=new Map;schedules=new Map;artifacts=new Map;cacheEntries=new Map;gitlabMetrics={pipelinesTotal:0,pipelinesSuccess:0,pipelinesFailed:0,pipelinesRunning:0,pipelinesPending:0,pipelinesPerHour:0,averagePipelineDuration:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,averageJobDuration:0,runnersTotal:0,runnersOnline:0,runnersBusy:0,runnersIdle:0,runnerUtilization:0,cacheHits:0,cacheMisses:0,cacheHitRate:0,artifactsTotal:0,artifactsSizeBytes:0,requestsTotal:0,requestsErrors:0};pipelineHistory=[];MAX_PIPELINE_HISTORY=1e3;jobHistory=[];MAX_JOB_HISTORY=5e3;lastPipelineTrigger=new Map;pipelineIidCounter=0;scheduleLastRun=new Map;processRequest(t=!0){this.gitlabMetrics.requestsTotal++,t||this.gitlabMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};let s=e.runners;typeof s=="number"?s=Array.from({length:s},(n,i)=>({id:`runner-${i+1}`,name:`docker-runner-${i+1}`,executor:e.runnerType||"docker",maxJobs:e.concurrentJobs||4,tags:[],isShared:!1})):Array.isArray(s)||(s=[]),this.config={gitlabUrl:e.gitlabUrl||"https://gitlab.com",projectId:e.projectId||"1",projectUrl:e.projectUrl||"https://gitlab.com/archiphoenix/project",enableRunners:e.enableRunners??!0,runnerType:e.runnerType||"docker",concurrentJobs:e.concurrentJobs||4,enableCache:e.enableCache??!0,cacheType:e.cacheType||"s3",enableArtifacts:e.enableArtifacts??!0,artifactsExpiry:e.artifactsExpiry||"7d",enableKubernetes:e.enableKubernetes??!1,k8sNamespace:e.k8sNamespace||"gitlab-runner",pipelines:Array.isArray(e.pipelines)?e.pipelines:[],runners:s,variables:Array.isArray(e.variables)?e.variables:[],environments:Array.isArray(e.environments)?e.environments:[],schedules:Array.isArray(e.schedules)?e.schedules:[],pipelineTriggerRate:e.pipelineTriggerRate||2,averagePipelineDuration:e.averagePipelineDuration||3e5,averageJobDuration:e.averageJobDuration||6e4,failureRate:e.failureRate||.1,cacheHitRate:e.cacheHitRate||.7},this.initializePipelines(),this.initializeRunners(),this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}initializePipelines(){this.pipelines.clear();const t=Array.isArray(this.config?.pipelines)?this.config.pipelines:[];for(const e of t){const s=e.id,i=(Array.isArray(e.stages)?e.stages:[{name:"build",jobs:[{name:"build",stage:"build"}]},{name:"test",jobs:[{name:"test",stage:"test"}]},{name:"deploy",jobs:[{name:"deploy",stage:"deploy"}]}]).map(r=>({name:r.name,status:"pending",jobs:Array.isArray(r.jobs)?r.jobs.map(u=>({id:`${s}-${r.name}-${u.name}`,name:u.name,stage:r.name,status:"created",pipelineId:s,when:u.when||"on_success",allowFailure:u.allowFailure||!1,tags:Array.isArray(u.tags)?u.tags:[],image:u.image,script:Array.isArray(u.script)?u.script:[`echo "Running ${u.name}"`]})):[]})),o={id:s,iid:++this.pipelineIidCounter,status:"created",ref:e.ref||"main",source:e.source||"push",stages:i,createdAt:Date.now(),updatedAt:Date.now(),variables:{}};this.pipelines.set(s,o)}}initializeRunners(){this.runners.clear();const t=Array.isArray(this.config?.runners)?this.config.runners:[];if(t.length===0&&this.config?.enableRunners){const e={id:"default-runner-1",name:"docker-runner-1",status:"online",runnerType:"project_type",executor:this.config.runnerType||"docker",active:!0,isShared:!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",currentJobs:0,maxJobs:this.config.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(e.id,e);return}for(const e of t){const s={id:e.id,name:e.name,status:"online",runnerType:"project_type",executor:e.executor||this.config?.runnerType||"docker",active:!0,isShared:e.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:e.tags||[],currentJobs:0,maxJobs:e.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(s.id,s)}}initializeVariables(){this.variables.clear();const t=Array.isArray(this.config?.variables)?this.config.variables:[];for(const e of t){const s={key:e.key,value:e.value,variableType:"env_var",protected:e.protected??!1,masked:e.masked??!1,raw:!1,environmentScope:e.environmentScope||"*"};this.variables.set(e.key,s)}}initializeEnvironments(){this.environments.clear();const t=Array.isArray(this.config?.environments)?this.config.environments:[];for(const e of t){const s={id:e.id,name:e.name,slug:e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),externalUrl:e.externalUrl,state:"available",deployments:[]};this.environments.set(e.id,s)}}initializeSchedules(){this.schedules.clear();const t=Array.isArray(this.config?.schedules)?this.config.schedules:[];for(const e of t){const s={id:e.id,description:e.description,ref:e.ref,cron:e.cron,active:e.active!==!1,variables:e.variables||{}};s.nextRunAt=this.calculateNextRunTime(s.cron),this.schedules.set(e.id,s)}}calculateNextRunTime(t){const e=Date.now(),s=3600*1e3;return e+s}performUpdate(t){this.config&&(this.updateActiveJobs(t),this.updateActivePipelines(t),this.triggerPipelines(t),this.checkSchedules(t),this.config.enableArtifacts&&this.cleanupArtifacts(t),this.updateMetrics())}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[s,n]of e)if(n.status==="running")try{if(!n.startTime){n.startTime=t;continue}const i=t-n.startTime,o=n.estimatedDuration||this.config?.averageJobDuration||6e4;if(i<0)continue;if(n.progress=Math.min(100,Math.max(0,Math.floor(i/o*100))),i%5e3<100&&n.logs&&this.updateJobLogs(n,i,o),i>=o){const r=Math.random()<(this.config?.failureRate||.1);n.status=r?"failed":"success",n.duration=i,n.progress=100,n.logs&&(r?n.logs.push(`Job ${n.name} failed after ${(i/1e3).toFixed(1)}s`):n.logs.push(`Job ${n.name} succeeded in ${(i/1e3).toFixed(1)}s`)),n.status==="success"&&this.config?.enableArtifacts&&this.generateJobArtifacts(n,t),this.freeRunner(n.runnerId),n.runnerId=void 0,this.updatePipelineStage(n),this.addJobToHistory(n),this.activeJobs.delete(s)}}catch(i){console.error(`Error updating job ${s}:`,i),n.status="failed",this.activeJobs.delete(s),this.freeRunner(n.runnerId)}}updateActivePipelines(t){for(const e of this.pipelines.values()){if(e.status!=="running"&&e.status!=="pending")continue;const s=e.stages.every(n=>n.status==="success"||n.status==="failed"||n.status==="canceled");if(s&&e.status==="running"){const n=e.stages.some(i=>i.status==="failed");e.status=n?"failed":"success",e.finishedAt=t,e.startedAt&&(e.duration=t-e.startedAt),e.status==="success"&&(e.coverage=75+Math.random()*20),this.addPipelineToHistory(e),e.status==="success"?this.gitlabMetrics.pipelinesSuccess++:this.gitlabMetrics.pipelinesFailed++,this.gitlabMetrics.pipelinesRunning--}else if(e.status==="pending"&&!s){const n=e.stages.find(i=>i.status==="pending");n&&this.hasAvailableRunner(n.jobs[0]?.tags)&&(e.status="running",e.startedAt=t,this.startStage(n,e.id,t))}else if(e.status==="running")for(let n=0;n<e.stages.length;n++){const i=e.stages[n],o=n>0?e.stages[n-1]:null;if(i.status==="pending"&&(!o||o.status==="success")){this.startStage(i,e.id,t);break}}e.updatedAt=t}}startStage(t,e,s){t.status="running",t.startTime=s;for(const n of t.jobs)if(n.status==="created"||n.status==="pending"){const i=this.findAvailableRunner(n.tags);i?(n.status="running",n.startTime=s,n.runnerId=i.id,n.estimatedDuration=this.config?.averageJobDuration||6e4,n.progress=0,n.logs=this.generateJobLogs(n),i.currentJobs++,i.busy=i.currentJobs>=i.maxJobs,this.activeJobs.set(n.id,n),this.gitlabMetrics.jobsRunning++):(n.status="pending",this.gitlabMetrics.jobsPending++)}}updateJobLogs(t,e,s){if(!t.logs)return;const n=Math.floor(e/s*100),i=[10,30,50,70,90];for(const o of i)n>=o&&!t.logs.some(r=>r.includes(`Progress: ${o}%`))&&t.logs.push(`[${t.name}] Progress: ${o}% completed`)}generateJobLogs(t){const e=[];if(e.push(`Running with ${t.image||"default"} image`),e.push(`$ ${t.script?.[0]||`echo "Running ${t.name}"`}`),t.script)for(const s of t.script)s.startsWith("echo")?e.push(s.replace("echo ","")):(e.push(`$ ${s}`),e.push(`[output from ${s}]`));return e}generateJobArtifacts(t,e){if(!this.config?.enableArtifacts)return;const s=[{name:`${t.name}-output.log`,size:1024*10,fileType:"text/plain"},{name:`${t.name}-results.json`,size:1024*5,fileType:"application/json"}];for(const n of s){const i=`${t.id}-${n.name}`,o={id:i,jobId:t.id,pipelineId:t.pipelineId,name:n.name,size:n.size,fileType:n.fileType,filename:n.name,createdAt:e},r=parseInt(this.config.artifactsExpiry?.replace("d","")||"7");o.expiresAt=e+r*24*60*60*1e3,this.artifacts.set(i,o),t.artifacts||(t.artifacts=[]),t.artifacts.push(n.name)}}updatePipelineStage(t){const e=this.pipelines.get(t.pipelineId);if(!e)return;const s=e.stages.find(o=>o.name===t.stage);if(!s)return;const n=s.jobs.find(o=>o.id===t.id);if(n&&(n.status=t.status,n.duration=t.duration),s.jobs.every(o=>o.status==="success"||o.status==="failed"||o.status==="canceled"||o.status==="skipped")){const o=s.jobs.some(r=>r.status==="failed"&&!r.allowFailure);s.status=o?"failed":"success",s.startTime&&(s.duration=Date.now()-s.startTime)}}triggerPipelines(t){if(!this.config)return;const e=this.config.pipelineTriggerRate||2,s=3600*1e3/e;for(const[n,i]of this.pipelines.entries()){if(i.status==="running"||i.status==="pending")continue;const o=this.lastPipelineTrigger.get(n)||0;t-o>=s&&(this.startPipeline(n,t),this.lastPipelineTrigger.set(n,t))}}checkSchedules(t){for(const[e,s]of this.schedules.entries())if(s.active&&s.nextRunAt&&t>=s.nextRunAt){const n=Array.from(this.pipelines.values()).find(i=>i.ref===s.ref&&(i.status==="created"||i.status==="success"||i.status==="failed"));n&&(this.startPipeline(n.id,t,"schedule",s.variables),s.lastRunPipelineId=n.id),s.nextRunAt=this.calculateNextRunTime(s.cron),this.scheduleLastRun.set(e,t)}}startPipeline(t,e,s="push",n){const i=this.pipelines.get(t);if(!i)return{success:!1,reason:"Pipeline not found"};if(i.status==="running"||i.status==="pending")return{success:!1,reason:"Pipeline already running"};i.status="pending",i.source=s,i.createdAt=e,i.updatedAt=e,i.startedAt=void 0,i.finishedAt=void 0,i.duration=void 0,i.coverage=void 0,n&&(i.variables={...i.variables,...n});for(const o of i.stages){o.status="pending",o.startTime=void 0,o.duration=void 0;for(const r of o.jobs)r.status="created",r.startTime=void 0,r.duration=void 0,r.progress=0,r.logs=void 0,r.artifacts=void 0,r.runnerId=void 0}return this.gitlabMetrics.pipelinesTotal++,this.gitlabMetrics.pipelinesPending++,{success:!0}}triggerWebhook(t,e){const s=Array.from(this.pipelines.values()).find(i=>i.ref===t&&(i.status==="created"||i.status==="success"||i.status==="failed"));if(!s)return{success:!1,reason:`No pipeline found for ref: ${t}`};const n=this.startPipeline(s.id,Date.now(),"trigger",e);return n.success?{success:!0,pipelineId:s.id}:n}cancelPipeline(t){const e=this.pipelines.get(t);if(!e)return{success:!1,reason:"Pipeline not found"};if(e.status!=="running"&&e.status!=="pending")return{success:!1,reason:"Pipeline is not running"};e.status="canceled",e.finishedAt=Date.now(),e.startedAt&&(e.duration=Date.now()-e.startedAt);for(const s of e.stages){s.status="canceled";for(const n of s.jobs)(n.status==="running"||n.status==="pending")&&(n.status="canceled",this.freeRunner(n.runnerId),this.activeJobs.delete(n.id),this.gitlabMetrics.jobsRunning--)}return this.gitlabMetrics.pipelinesRunning--,{success:!0}}hasAvailableRunner(t){for(const e of this.runners.values())if(!(e.status!=="online"||!e.active)&&!(e.currentJobs>=e.maxJobs)&&!(t&&t.length>0&&(!e.runUntagged&&(!e.tagList||e.tagList.length===0)||e.tagList&&e.tagList.length>0&&!t.some(n=>e.tagList?.includes(n))&&!e.runUntagged)))return!0;return!1}findAvailableRunner(t){for(const e of this.runners.values())if(!(e.status!=="online"||!e.active)&&!(e.currentJobs>=e.maxJobs)&&!(t&&t.length>0&&(!e.runUntagged&&(!e.tagList||e.tagList.length===0)||e.tagList&&e.tagList.length>0&&!t.some(n=>e.tagList?.includes(n))&&!e.runUntagged)))return e}freeRunner(t){if(!t)return;const e=this.runners.get(t);e&&e.currentJobs>0&&(e.currentJobs--,e.busy=e.currentJobs>=e.maxJobs)}addPipelineToHistory(t){t.duration&&(this.pipelineHistory.push({timestamp:t.startedAt||t.createdAt,duration:t.duration,status:t.status}),this.pipelineHistory.length>this.MAX_PIPELINE_HISTORY&&this.pipelineHistory.shift())}addJobToHistory(t){t.duration&&(this.jobHistory.push({timestamp:t.startTime||Date.now(),duration:t.duration,status:t.status}),this.jobHistory.length>this.MAX_JOB_HISTORY&&this.jobHistory.shift(),t.status==="success"?this.gitlabMetrics.jobsSuccess++:t.status==="failed"&&this.gitlabMetrics.jobsFailed++,this.gitlabMetrics.jobsRunning--)}cleanupArtifacts(t){if(!this.config)return;const s=parseInt(this.config.artifactsExpiry?.replace("d","")||"7")*24*60*60*1e3;for(const[n,i]of this.artifacts.entries())i.expiresAt&&t>i.expiresAt?this.artifacts.delete(n):t-i.createdAt>s&&this.artifacts.delete(n)}updateMetrics(){this.gitlabMetrics.pipelinesRunning=Array.from(this.pipelines.values()).filter(d=>d.status==="running").length,this.gitlabMetrics.pipelinesPending=Array.from(this.pipelines.values()).filter(d=>d.status==="pending").length;const t=Date.now()-3600*1e3,e=this.pipelineHistory.filter(d=>d.timestamp>t);if(this.gitlabMetrics.pipelinesPerHour=e.length,this.pipelineHistory.length>0){const d=this.pipelineHistory.slice(-100),h=d.reduce((p,g)=>p+g.duration,0)/d.length;this.gitlabMetrics.averagePipelineDuration=h}if(this.gitlabMetrics.jobsRunning=this.activeJobs.size,this.gitlabMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(d=>d.status==="pending").length,this.jobHistory.length>0){const d=this.jobHistory.slice(-500),h=d.reduce((p,g)=>p+g.duration,0)/d.length;this.gitlabMetrics.averageJobDuration=h}this.gitlabMetrics.runnersTotal=this.runners.size,this.gitlabMetrics.runnersOnline=Array.from(this.runners.values()).filter(d=>d.status==="online").length;let s=0,n=0,i=0;for(const d of this.runners.values())d.status==="online"&&(s+=d.currentJobs,n+=d.maxJobs-d.currentJobs,i+=d.maxJobs);this.gitlabMetrics.runnersBusy=s,this.gitlabMetrics.runnersIdle=n,this.gitlabMetrics.runnerUtilization=i>0?s/i*100:0;const o=this.gitlabMetrics.cacheHits+this.gitlabMetrics.cacheMisses;o>0?this.gitlabMetrics.cacheHitRate=this.gitlabMetrics.cacheHits/o:(this.gitlabMetrics.cacheHits=Math.floor(Math.random()*100),this.gitlabMetrics.cacheMisses=Math.floor(this.gitlabMetrics.cacheHits*.3),this.gitlabMetrics.cacheHitRate=this.config?.cacheHitRate||.7),this.gitlabMetrics.artifactsTotal=this.artifacts.size;let r=0;for(const d of this.artifacts.values())r+=d.size;this.gitlabMetrics.artifactsSizeBytes=r;const u=Array.from(this.pipelines.values()).filter(d=>d.status==="success"&&d.coverage!==void 0);if(u.length>0){const d=u.reduce((h,p)=>h+(p.coverage||0),0)/u.length;this.gitlabMetrics.coverage=d}}getGitLabCIMetrics(){return{...this.gitlabMetrics}}getMetrics(){return this.getGitLabCIMetrics()}getPipelines(){return Array.from(this.pipelines.values())}getPipeline(t){return this.pipelines.get(t)}getActiveJobs(){return Array.from(this.activeJobs.values())}getJob(t){if(this.activeJobs.has(t))return this.activeJobs.get(t);for(const e of this.pipelines.values())for(const s of e.stages){const n=s.jobs.find(i=>i.id===t);if(n)return n}}getRunners(){return Array.from(this.runners.values())}getVariables(){return Array.from(this.variables.values())}getEnvironments(){return Array.from(this.environments.values())}getSchedules(){return Array.from(this.schedules.values())}getArtifacts(){return Array.from(this.artifacts.values())}getJobLogs(t){return this.getJob(t)?.logs}updateConfig(t){this.config;const e=new Set(this.pipelines.keys());this.initializeConfig(t);const s=new Set(this.pipelines.keys());for(const r of e)if(!s.has(r)){for(const[u,d]of this.activeJobs.entries())d.pipelineId===r&&(d.status="canceled",this.freeRunner(d.runnerId),this.activeJobs.delete(u));this.pipelines.delete(r)}const n=this.config?.pipelines||[];for(const r of n){const u=this.pipelines.get(r.id);u&&(u.ref=r.ref||u.ref,u.source=r.source||u.source,u.status!=="running"&&u.status)}const i=this.config?.runners||[],o=new Set(this.runners.keys());for(const r of o)if(!i.find(u=>u.id===r)){for(const[u,d]of this.activeJobs.entries())d.runnerId===r&&(d.status="canceled",this.activeJobs.delete(u));this.runners.delete(r)}for(const r of i){const u=this.runners.get(r.id);if(u)u.name=r.name,u.executor=r.executor||u.executor,u.maxJobs=r.maxJobs||u.maxJobs,u.tagList=r.tags||u.tagList,u.isShared=r.isShared??u.isShared;else{const d={id:r.id,name:r.name,status:"online",runnerType:"project_type",executor:r.executor||this.config?.runnerType||"docker",active:!0,isShared:r.isShared??!1,locked:!1,runUntagged:!0,accessLevel:"not_protected",tagList:r.tags||[],currentJobs:0,maxJobs:r.maxJobs||this.config?.concurrentJobs||4,busy:!1,platform:"linux",architecture:"amd64",contactedAt:Date.now()};this.runners.set(r.id,d)}}this.initializeVariables(),this.initializeEnvironments(),this.initializeSchedules()}calculateComponentMetrics(){const t=this.getGitLabCIMetrics(),e=t.pipelinesPerHour/3600,s=t.averagePipelineDuration,n=t.runnerUtilization/100,i=t.pipelinesSuccess+t.pipelinesFailed,o=i>0?t.pipelinesFailed/i:0;return{throughput:e,latency:s,utilization:n,errorRate:o}}}class Ik{config=null;applications=new Map;repositories=new Map;projects=new Map;syncOperations=new Map;argoMetrics={applicationsTotal:0,applicationsSynced:0,applicationsOutOfSync:0,applicationsProgressing:0,applicationsDegraded:0,applicationsHealthy:0,syncOperationsTotal:0,syncOperationsSuccess:0,syncOperationsFailed:0,syncOperationsRunning:0,syncRate:0,averageSyncDuration:0,repositoriesTotal:0,repositoriesConnected:0,repositoriesFailed:0,projectsTotal:0,requestsTotal:0,requestsErrors:0};syncHistory=[];MAX_SYNC_HISTORY=1e3;lastSyncTime=new Map;lastHealthCheck=new Map;processRequest(t=!0){this.argoMetrics.requestsTotal++,t||this.argoMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={serverUrl:e.serverUrl||e.argoUrl||"https://argocd.example.com",enableSSO:e.enableSSO??!1,ssoProvider:e.ssoProvider||"oidc",enableRBAC:e.enableRBAC??!0,enableSyncPolicy:e.enableSyncPolicy??!0,autoSync:e.autoSync??!1,syncPolicy:e.syncPolicy||"manual",enableHealthChecks:e.enableHealthChecks??!0,enableNotifications:e.enableNotifications??!0,notificationChannels:e.notificationChannels||["slack"],applications:e.applications||[],repositories:e.repositories||[],projects:e.projects||[],syncRate:e.syncRate||1,averageSyncDuration:e.averageSyncDuration||3e4,failureRate:e.failureRate||.05,healthCheckInterval:e.healthCheckInterval||3e5},this.initializeApplications(),this.initializeRepositories(),this.initializeProjects()}initializeApplications(){this.applications.clear();const t=this.config?.applications||[];if(t.length===0){const e={name:"web-app",namespace:"production",project:"default",repository:"https://github.com/example/web-app",path:"k8s",targetRevision:"main",destination:{server:"https://kubernetes.default.svc",namespace:"production"},syncPolicy:this.config?.syncPolicy||"manual",status:"synced",health:"healthy",lastSync:Date.now()-12e4,revision:"abc123",sourceRevision:"abc123"};this.applications.set(e.name,e);return}for(const e of t){const s={name:e.name,namespace:e.namespace,project:e.project||"default",repository:e.repository,path:e.path||".",targetRevision:e.targetRevision||"main",destination:e.destination||{server:"https://kubernetes.default.svc",namespace:e.namespace||"default"},syncPolicy:e.syncPolicy||this.config?.syncPolicy||"manual",status:e.status||"synced",health:e.health||"healthy",lastSync:Date.now()-Math.random()*36e5,revision:this.generateRevision(),sourceRevision:this.generateRevision()};this.applications.set(s.name,s)}}initializeRepositories(){this.repositories.clear();const t=this.config?.repositories||[],e=new Set;for(const s of this.applications.values())e.add(s.repository);for(const s of t){const n={name:s.name||s.url,url:s.url,type:s.type||"git",username:s.username,password:s.password,insecure:s.insecure??!1,project:s.project,connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(n.name,n)}for(const s of e)if(!this.repositories.has(s)){const n={name:s,url:s,type:"git",connectionStatus:"successful",lastVerifiedAt:Date.now()};this.repositories.set(s,n)}}initializeProjects(){this.projects.clear();const t=this.config?.projects||[];if(t.length===0){const e={name:"default",description:"Default project",sourceRepos:["*"],destinations:[{server:"*",namespace:"*"}]};this.projects.set("default",e);return}for(const e of t){const s={name:e.name,description:e.description,sourceRepos:e.sourceRepos||["*"],destinations:e.destinations||[{server:"*",namespace:"*"}]};this.projects.set(s.name,s)}}generateRevision(){return Math.random().toString(36).substring(2,8)}performUpdate(t){this.config&&(this.updateSyncOperations(t),(this.config.autoSync||this.config.syncPolicy==="automated")&&this.triggerAutoSyncs(t),this.config.enableHealthChecks&&this.performHealthChecks(t),this.checkRepositoryConnections(t),this.updateMetrics())}updateSyncOperations(t){const e=Array.from(this.syncOperations.entries());for(const[s,n]of e){if(n.status!=="running")continue;if(!n.startedAt){n.startedAt=t;continue}const i=t-n.startedAt,o=this.config?.averageSyncDuration||3e4;if(i>=o){const r=Math.random()<(this.config?.failureRate||.05);n.status=r?"failed":"success",n.finishedAt=t,r&&(n.error="Sync failed: resource conflict or validation error");const u=this.applications.get(n.application);u&&(n.status==="success"?(u.status="synced",u.health="healthy",u.lastSync=t,u.lastSyncDuration=i,u.revision=u.sourceRevision=this.generateRevision(),u.history||(u.history=[]),u.history.unshift({id:s,revision:u.revision,deployedAt:t}),u.history.length>10&&u.history.pop()):(u.status="degraded",u.health="degraded")),this.addSyncToHistory(n),n.status==="success"?this.argoMetrics.syncOperationsSuccess++:this.argoMetrics.syncOperationsFailed++,this.argoMetrics.syncOperationsRunning--,this.syncOperations.delete(s)}}}triggerAutoSyncs(t){const s=36e5/(this.config?.syncRate||1);for(const n of this.applications.values()){if(n.syncPolicy!=="automated"&&n.syncPolicy!=="auto")continue;const i=this.lastSyncTime.get(n.name)||n.lastSync||0;t-i>=s&&(n.status==="outofsync"||n.status==="synced")&&(this.startSync(n.name,t),this.lastSyncTime.set(n.name,t))}}performHealthChecks(t){const e=this.config?.healthCheckInterval||3e5;for(const s of this.applications.values()){const n=this.lastHealthCheck.get(s.name)||0;t-n>=e&&(Math.random()<.05&&s.health==="healthy"?(s.health="degraded",s.status="degraded"):s.health==="degraded"&&Math.random()<.3&&(s.health="healthy",s.status==="degraded"&&(s.status="synced")),this.lastHealthCheck.set(s.name,t))}}checkRepositoryConnections(t){for(const s of this.repositories.values()){const n=s.lastVerifiedAt||0;t-n>=6e5&&(Math.random()<.95?(s.connectionStatus="successful",s.lastVerifiedAt=t,s.lastConnectionError=void 0):(s.connectionStatus="failed",s.lastConnectionError="Connection timeout or authentication failed",s.lastVerifiedAt=t))}}startSync(t,e=Date.now()){const s=this.applications.get(t);if(!s||Array.from(this.syncOperations.values()).find(r=>r.application===t&&r.status==="running"))return!1;const i=`sync-${t}-${e}`,o={id:i,application:t,startedAt:e,status:"running",phase:"sync"};return this.syncOperations.set(i,o),this.argoMetrics.syncOperationsRunning++,this.argoMetrics.syncOperationsTotal++,s.status="progressing",s.syncStartedAt=e,!0}updateMetrics(){if(this.argoMetrics.applicationsTotal=this.applications.size,this.argoMetrics.applicationsSynced=Array.from(this.applications.values()).filter(t=>t.status==="synced").length,this.argoMetrics.applicationsOutOfSync=Array.from(this.applications.values()).filter(t=>t.status==="outofsync").length,this.argoMetrics.applicationsProgressing=Array.from(this.applications.values()).filter(t=>t.status==="progressing").length,this.argoMetrics.applicationsDegraded=Array.from(this.applications.values()).filter(t=>t.status==="degraded").length,this.argoMetrics.applicationsHealthy=Array.from(this.applications.values()).filter(t=>t.health==="healthy").length,this.argoMetrics.repositoriesTotal=this.repositories.size,this.argoMetrics.repositoriesConnected=Array.from(this.repositories.values()).filter(t=>t.connectionStatus==="successful").length,this.argoMetrics.repositoriesFailed=Array.from(this.repositories.values()).filter(t=>t.connectionStatus==="failed").length,this.argoMetrics.projectsTotal=this.projects.size,this.syncHistory.length>0){const t=Date.now()-36e5,e=this.syncHistory.filter(n=>n.timestamp>=t).length;this.argoMetrics.syncRate=e;const s=this.syncHistory.filter(n=>n.status==="success");if(s.length>0){const n=s.reduce((i,o)=>i+o.duration,0);this.argoMetrics.averageSyncDuration=n/s.length}}}addSyncToHistory(t){if(!t.finishedAt||!t.startedAt)return;const e=t.finishedAt-t.startedAt,s=t.status==="success"?"success":"failed";this.syncHistory.push({timestamp:t.finishedAt,duration:e,status:s}),this.syncHistory.length>this.MAX_SYNC_HISTORY&&this.syncHistory.shift()}getMetrics(){return{...this.argoMetrics}}getApplications(){return Array.from(this.applications.values())}getApplication(t){return this.applications.get(t)}addApplication(t){this.applications.set(t.name,t)}removeApplication(t){return this.applications.delete(t)}updateApplication(t,e){const s=this.applications.get(t);return s?(this.applications.set(t,{...s,...e}),!0):!1}getRepositories(){return Array.from(this.repositories.values())}getRepository(t){return this.repositories.get(t)}addRepository(t){this.repositories.set(t.name,t)}removeRepository(t){return this.repositories.delete(t)}updateRepository(t,e){const s=this.repositories.get(t);return s?(this.repositories.set(t,{...s,...e}),!0):!1}getProjects(){return Array.from(this.projects.values())}getProject(t){return this.projects.get(t)}addProject(t){this.projects.set(t.name,t)}updateProject(t,e){const s=this.projects.get(t);return s?(this.projects.set(t,{...s,...e}),!0):!1}removeProject(t){return this.projects.delete(t)}getSyncOperations(){return Array.from(this.syncOperations.values())}getStats(){return{metrics:this.getMetrics(),applications:this.getApplications(),repositories:this.getRepositories(),projects:this.getProjects(),activeSyncs:this.getSyncOperations()}}}class Nk{config=null;workspaces=new Map;activeRuns=new Map;runHistory=new Map;MAX_RUN_HISTORY=1e3;states=new Map;terraformMetrics={workspacesTotal:0,runsTotal:0,runsSuccess:0,runsFailed:0,runsRunning:0,runsPending:0,runsPerHour:0,averageRunDuration:0,statesTotal:0,resourcesManaged:0,requestsTotal:0,requestsErrors:0};runHistoryList=[];MAX_RUN_HISTORY_LIST=1e3;lastRunTime=new Map;lastVCSWebhook=new Map;processRequest(t=!0){this.terraformMetrics.requestsTotal++,t||this.terraformMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={organizationName:e.organizationName||"archiphoenix",enableVCS:e.enableVCS??!0,enableStateLocking:e.enableStateLocking??!0,enableRemoteState:e.enableRemoteState??!0,defaultTerraformVersion:e.defaultTerraformVersion||"1.5.0",workspaces:e.workspaces||[],runs:e.runs||[],states:e.states||[],runTriggerRate:e.runTriggerRate||.5,averagePlanDuration:e.averagePlanDuration||3e4,averageApplyDuration:e.averageApplyDuration||12e4,failureRate:e.failureRate??.05,changeProbability:e.changeProbability??.7,maxResourceAdditions:e.maxResourceAdditions||10,maxResourceChanges:e.maxResourceChanges||5,maxResourceDestructions:e.maxResourceDestructions||3,vcsWebhookProbability:e.vcsWebhookProbability??.3,defaultStateResources:e.defaultStateResources||10,durationVariation:e.durationVariation??.3,resourceTimeMultiplier:e.resourceTimeMultiplier||500},this.initializeWorkspaces(),this.initializeRuns(),this.initializeStates()}updateConfig(t){this.initializeConfig(t)}initializeWorkspaces(){this.workspaces.clear();const t=this.config?.workspaces||[];if(t.length===0){const e={id:"default",name:"production",description:"Production infrastructure",terraformVersion:this.config?.defaultTerraformVersion||"1.5.0",autoApply:!1,queueAllRuns:!0,workingDirectory:"/terraform"};this.workspaces.set("default",e);return}for(const e of t){const s={id:e.id,name:e.name,description:e.description,terraformVersion:e.terraformVersion||this.config?.defaultTerraformVersion||"1.5.0",autoApply:e.autoApply??!1,queueAllRuns:e.queueAllRuns??!0,workingDirectory:e.workingDirectory,vcsRepo:e.vcsRepo,variables:e.variables||[]};this.workspaces.set(s.id,s)}}initializeRuns(){const t=new Set(Array.from(this.activeRuns.keys())),e=new Set((this.config?.runs||[]).map(n=>n.id));for(const[n,i]of this.runHistory.entries())!t.has(n)&&!e.has(n)&&this.runHistory.delete(n);const s=this.config?.runs||[];for(const n of s){const i=this.workspaces.values().next().value;if(!i)continue;const o={id:n.id,workspaceId:i.id,workspaceName:n.workspace||i.name,status:n.status||"applied",createdAt:n.createdAt?new Date(n.createdAt).getTime():Date.now()-36e5,finishedAt:n.createdAt?new Date(n.createdAt).getTime()+(n.duration||12e4):Date.now()-348e4,duration:n.duration||12e4,planOnly:n.planOnly??!1,message:n.message,hasChanges:n.status==="applied"};["pending","planning","applying"].includes(o.status)?this.activeRuns.set(o.id,o):this.runHistory.set(o.id,o)}}initializeStates(){this.states.clear();const t=this.config?.states||[];if(t.length===0){const e=this.config?.defaultStateResources||10;for(const s of this.workspaces.values()){const n={id:`state-${s.id}`,workspaceId:s.id,workspaceName:s.name,version:1,serial:1,resources:e,updatedAt:Date.now()-(36e5+Math.random()*36e5),createdAt:Date.now()-(864e5+Math.random()*864e5)};this.states.set(n.id,n)}return}for(const e of t){const s=Array.from(this.workspaces.values()).find(i=>i.name===e.workspace);if(!s)continue;const n={id:e.id,workspaceId:s.id,workspaceName:e.workspace,version:e.version||1,serial:e.serial||1,resources:e.resources,updatedAt:e.updatedAt?new Date(e.updatedAt).getTime():Date.now(),createdAt:e.updatedAt?new Date(e.updatedAt).getTime()-864e5:Date.now()-864e5};this.states.set(n.id,n)}}performUpdate(t){this.config&&(this.updateActiveRuns(t),this.config.enableVCS&&this.triggerVCSWebhooks(t),this.triggerAutoRuns(t),this.updateMetrics())}updateActiveRuns(t){const e=Array.from(this.activeRuns.entries());for(const[s,n]of e){if(!["pending","planning","applying"].includes(n.status)){if(this.runHistory.set(s,n),this.runHistory.size>this.MAX_RUN_HISTORY){const R=this.runHistory.keys().next().value;R&&this.runHistory.delete(R)}this.activeRuns.delete(s);continue}if(!n.startedAt){n.startedAt=t;continue}const i=t-n.startedAt;let o;const u=this.getStateForWorkspace(n.workspaceId)?.resources||this.config?.defaultStateResources||10,d=this.config?.resourceTimeMultiplier||500,h=this.config?.averagePlanDuration||3e4,p=this.config?.averageApplyDuration||12e4,g=this.config?.durationVariation||.3,v=Math.log10(Math.max(1,u))*d,b=h+v,x=p+v*2;if(n.status==="pending"){n.status="planning";const C=n.estimatedPlanDuration||b,k=C*g*(Math.random()*2-1);o=C+k}else if(n.status==="planning"){const R=b*g*(Math.random()*2-1);if(o=b+R,i>=o){const C=this.config?.changeProbability??.7,k=Math.random()<C;if(n.hasChanges=k,k){const T=this.config?.maxResourceAdditions||10,A=this.config?.maxResourceChanges||5,D=this.config?.maxResourceDestructions||3,_=Math.min(1.5,1+u/100);n.resourceAdditions=Math.floor(Math.random()*T*_)+1,n.resourceChanges=Math.floor(Math.random()*A*_),n.resourceDestructions=Math.floor(Math.random()*D*_)}else n.resourceAdditions=0,n.resourceChanges=0,n.resourceDestructions=0;if(n.planOnly)n.status="planned",n.finishedAt=t,n.duration=i,n.message=k?`Plan completed with ${n.resourceAdditions+n.resourceChanges+n.resourceDestructions} changes`:"No changes detected";else if(this.workspaces.get(n.workspaceId)?.autoApply&&k){n.status="applying";const A=x*g*(Math.random()*2-1);o=x+A}else k?(n.status="planned",n.message=`Plan completed. ${n.resourceAdditions+n.resourceChanges+n.resourceDestructions} changes detected.`):(n.status="applied",n.finishedAt=t,n.duration=i,n.message="No changes detected")}}else if(n.status==="applying"){const R=x*g*(Math.random()*2-1);if(o=x+R,i>=o){const C=this.config?.failureRate??.05,k=Math.random()<C;n.status=k?"errored":"applied",n.finishedAt=t,n.duration=i,k?(n.error="Apply failed: resource provisioning error or validation failure",n.message=n.error):(n.message="Apply completed successfully",this.updateStateAfterApply(n))}}}}updateStateAfterApply(t){const e=Array.from(this.states.values()).find(n=>n.workspaceId===t.workspaceId);if(!e)return;e.version++,e.serial++,e.updatedAt=Date.now(),t.resourceAdditions!==void 0&&(e.resources=(e.resources||0)+t.resourceAdditions,t.resourceDestructions!==void 0&&(e.resources=Math.max(0,e.resources-t.resourceDestructions)));const s=this.workspaces.get(t.workspaceId);s&&(s.lastRun={id:t.id,status:t.status,createdAt:t.finishedAt||Date.now()})}triggerVCSWebhooks(t){for(const s of this.workspaces.values()){if(!s.vcsRepo)continue;const n=this.lastVCSWebhook.get(s.id)||0;if(t-n<36e5)continue;const i=this.config?.vcsWebhookProbability??.3;Math.random()<i&&(this.lastVCSWebhook.set(s.id,t),this.triggerRun(s.id,{source:"vcs"}))}}triggerAutoRuns(t){const s=36e5/(this.config?.runTriggerRate||.5);for(const n of this.workspaces.values()){const i=this.lastRunTime.get(n.id)||0;t-i>=s&&!Array.from(this.activeRuns.values()).some(u=>u.workspaceId===n.id&&["pending","planning","applying"].includes(u.status))&&n.queueAllRuns&&(this.lastRunTime.set(n.id,t),this.triggerRun(n.id,{source:"scheduled"}))}}triggerRun(t,e){const s=this.workspaces.get(t);if(!s)return{success:!1,reason:"Workspace not found"};if(Array.from(this.activeRuns.values()).some(v=>v.workspaceId===t&&["pending","planning","applying"].includes(v.status))&&!s.queueAllRuns)return{success:!1,reason:"Workspace already has an active run"};const i=Date.now(),o=`run-${t}-${i}`,u=this.getStateForWorkspace(t)?.resources||this.config?.defaultStateResources||10,d=this.config?.resourceTimeMultiplier||500,h=this.config?.averagePlanDuration||3e4,p=Math.log10(Math.max(1,u))*d,g={id:o,workspaceId:s.id,workspaceName:s.name,status:"pending",createdAt:i,planOnly:e?.planOnly??!1,source:e?.source||"api",triggeredBy:e?.triggeredBy||"user"};return g.estimatedPlanDuration=h+p,this.activeRuns.set(o,g),this.terraformMetrics.runsTotal++,this.terraformMetrics.runsPending++,s.lastRun={id:o,status:"pending",createdAt:i},{success:!0,runId:o}}cancelRun(t){const e=this.activeRuns.get(t);if(!e)return{success:!1,reason:"Run not found or not active"};if(!["pending","planning","applying"].includes(e.status))return{success:!1,reason:"Run is not in a cancelable state"};if(e.status="canceled",e.finishedAt=Date.now(),e.duration=e.startedAt?Date.now()-e.startedAt:0,e.message="Run canceled by user",this.runHistory.set(t,e),this.runHistory.size>this.MAX_RUN_HISTORY){const s=this.runHistory.keys().next().value;s&&this.runHistory.delete(s)}return this.activeRuns.delete(t),{success:!0}}updateMetrics(){const t=Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values()));this.terraformMetrics.workspacesTotal=this.workspaces.size,this.terraformMetrics.statesTotal=this.states.size,this.terraformMetrics.runsRunning=Array.from(this.activeRuns.values()).filter(i=>["planning","applying"].includes(i.status)).length,this.terraformMetrics.runsPending=Array.from(this.activeRuns.values()).filter(i=>i.status==="pending").length,this.terraformMetrics.runsSuccess=t.filter(i=>i.status==="applied").length,this.terraformMetrics.runsFailed=t.filter(i=>i.status==="errored").length,this.terraformMetrics.resourcesManaged=Array.from(this.states.values()).reduce((i,o)=>i+(o.resources||0),0);const e=t.filter(i=>i.duration!==void 0);if(e.length>0){const i=e.reduce((o,r)=>o+(r.duration||0),0);this.terraformMetrics.averageRunDuration=i/e.length}const s=Date.now()-36e5,n=this.runHistoryList.filter(i=>i.timestamp>=s);this.terraformMetrics.runsPerHour=n.length}addRunToHistory(t){t.duration!==void 0&&(this.runHistoryList.push({timestamp:t.finishedAt||Date.now(),duration:t.duration,status:t.status}),this.runHistoryList.length>this.MAX_RUN_HISTORY_LIST&&this.runHistoryList.shift())}getMetrics(){return{...this.terraformMetrics}}getWorkspace(t){return this.workspaces.get(t)}getWorkspaces(){return Array.from(this.workspaces.values())}getRun(t){return this.activeRuns.get(t)||this.runHistory.get(t)}getActiveRuns(){return Array.from(this.activeRuns.values())}getRunsForWorkspace(t,e=100){return Array.from(this.activeRuns.values()).concat(Array.from(this.runHistory.values())).filter(n=>n.workspaceId===t).sort((n,i)=>(i.createdAt||0)-(n.createdAt||0)).slice(0,e)}getStateForWorkspace(t){return Array.from(this.states.values()).find(e=>e.workspaceId===t)}getStates(){return Array.from(this.states.values())}getConfig(){return this.config}}class zk{config=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;pushLatencyHistory=[];pullLatencyHistory=[];scanLatencyHistory=[];MAX_LATENCY_HISTORY=500;harborMetrics={pushOperationsPerSecond:0,pullOperationsPerSecond:0,scanOperationsPerSecond:0,replicationOperationsPerSecond:0,averagePushLatency:0,averagePullLatency:0,averageScanLatency:0,storageUsed:0,storageTotal:100,totalProjects:0,totalRepositories:0,totalTags:0,totalVulnerabilities:0,scansCompleted:0,scansRunning:0,scansFailed:0,replicationPoliciesEnabled:0,activeReplications:0,gcOperationsTotal:0,gcStorageFreed:0};lastGCRun=0;initializeConfig(t){const e=t.data.config||{};this.config=e,this.updateMetricsFromConfig()}updateConfig(t){const e=t.data.config||{};this.config=e,this.updateMetricsFromConfig()}updateMetricsFromConfig(){if(!this.config)return;this.harborMetrics.totalProjects=this.config.projects?.length||0,this.harborMetrics.totalRepositories=this.config.repositories?.length||0,this.harborMetrics.totalTags=this.config.tags?.length||0;let t=0;this.config.projects&&(t=this.config.projects.reduce((s,n)=>s+(n.storageUsed||0),0)),this.harborMetrics.storageUsed=t;let e=0;this.config.tags&&this.config.tags.forEach(s=>{s.vulnerabilityScan?.totalVulnerabilities&&(e+=s.vulnerabilityScan.totalVulnerabilities)}),this.harborMetrics.totalVulnerabilities=e,this.harborMetrics.replicationPoliciesEnabled=(this.config.replicationPolicies||[]).filter(s=>s.enabled).length,this.harborMetrics.scansRunning=(this.config.tags||[]).filter(s=>s.vulnerabilityScan?.status==="running").length}performUpdate(t,e=!1){this.config&&(e&&this.simulatePushPullOperations(t),(this.config.enableVulnerabilityScanning||this.config.enableImageScanning)&&this.simulateVulnerabilityScans(t),this.config.replicationPolicies&&this.config.replicationPolicies.length>0&&this.simulateReplication(t),this.config.enableGarbageCollection&&this.simulateGarbageCollection(t),this.updateActiveOperations(t),this.updateMetrics(t))}simulatePushPullOperations(t){if(!this.config?.repositories||this.config.repositories.length===0)return;const e=Math.min(2,.1+this.config.repositories.length/10);if(Math.random()<e/10){const s=this.config.repositories[Math.floor(Math.random()*this.config.repositories.length)];Math.random()<.3?this.simulatePush(s,t):this.simulatePull(s,t)}}simulatePush(t,e){const s=`push-${e}-${Math.random()}`,n=50+Math.random()*500,i=500+Math.random()*1500,o=e+i,r={id:s,type:"push",repository:t.name,project:t.project,startTime:e,status:"running",size:n,completionTime:o};this.activeOperations.set(s,r)}simulatePull(t,e){const s=`pull-${e}-${Math.random()}`,n=200+Math.random()*800,i=e+n,o={id:s,type:"pull",repository:t.name,project:t.project,startTime:e,status:"running",completionTime:i};this.activeOperations.set(s,o)}simulateVulnerabilityScans(t){if(!this.config?.tags)return;const e=this.config.tags.filter(s=>{const n=s.vulnerabilityScan;return!n||n.status==="pending"||n.status==="completed"&&this.shouldRescan(s)});if(e.length!==0){if(this.harborMetrics.scansRunning<3&&Math.random()<.1){const s=e[Math.floor(Math.random()*e.length)];this.startVulnerabilityScan(s.id,t)}this.completeVulnerabilityScans(t)}}startVulnerabilityScan(t,e){if(!this.config?.tags)return;const s=this.config.tags.find(d=>d.id===t);if(!s)return;const n=`scan-${t}-${e}`,i=5e3+Math.random()*15e3,o=e+i,r={id:n,type:"scan",repository:s.repository,tag:s.name,startTime:e,status:"running",completionTime:o};this.activeOperations.set(n,r),this.harborMetrics.scansRunning++;const u=this.config.tags.map(d=>d.id===t?{...d,vulnerabilityScan:{status:"running",severity:"none",scannedAt:new Date(e).toISOString()}}:d);this.config.tags=u}completeVulnerabilityScans(t){}shouldRescan(t){if(!t.vulnerabilityScan?.scannedAt)return!0;const e=new Date(t.vulnerabilityScan.scannedAt).getTime(),s=Date.now()-e,n=10080*60*1e3;return s>n}simulateReplication(t){if(!this.config?.replicationPolicies)return;const e=this.config.replicationPolicies.filter(s=>s.enabled);e.length!==0&&e.forEach(s=>{if(s.trigger==="event-based"&&Math.random()<.05)this.simulateReplicationOperation(s,t);else if(s.trigger==="scheduled"){const n=this.getLastReplicationRun(s.id);t-n>36e5&&(this.simulateReplicationOperation(s,t),this.setLastReplicationRun(s.id,t))}})}lastReplicationRuns=new Map;getLastReplicationRun(t){return this.lastReplicationRuns.get(t)||0}setLastReplicationRun(t,e){this.lastReplicationRuns.set(t,e)}simulateReplicationOperation(t,e){const s=`replication-${t.id}-${e}`,n=2e3+Math.random()*5e3,i=e+n,o={id:s,type:"replication",startTime:e,status:"running",completionTime:i};this.activeOperations.set(s,o),this.harborMetrics.activeReplications++}simulateGarbageCollection(t){this.config?.gcSchedule&&t-this.lastGCRun>1440*60*1e3&&(this.runGarbageCollection(t),this.lastGCRun=t)}runGarbageCollection(t){const e=`gc-${t}`,s=3e4+Math.random()*6e4,n=t+s,i=Math.random()*5,o={id:e,type:"gc",startTime:t,status:"running",completionTime:n,size:i*1024};this.activeOperations.set(e,o)}updateActiveOperations(t){const e=[];for(const[n,i]of this.activeOperations.entries())i.completionTime&&t>=i.completionTime&&i.status==="running"&&e.push(i);for(const n of e)this.completeOperation(n,t);const s=t-6e4;for(const[n,i]of this.activeOperations.entries())i.startTime<s&&i.status==="completed"&&this.activeOperations.delete(n)}completeOperation(t,e){const s=t.completionTime?t.completionTime-t.startTime:0;switch(t.status="completed",t.duration=s,this.activeOperations.delete(t.id),this.addOperationToHistory(t),t.type){case"push":this.config&&t.size&&(this.harborMetrics.storageUsed+=t.size/1024),s>0&&(this.pushLatencyHistory.push(s),this.pushLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pushLatencyHistory.shift());break;case"pull":s>0&&(this.pullLatencyHistory.push(s),this.pullLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.pullLatencyHistory.shift());break;case"scan":if(this.config?.tags&&t.id){const n=t.id.match(/^scan-(.+?)-/);if(n){const i=n[1];if(this.config.tags.find(r=>r.id===i)){const r=Math.floor(Math.random()*3),u=Math.floor(Math.random()*5),d=Math.floor(Math.random()*10),h=Math.floor(Math.random()*15),p=r+u+d+h,g=r>0?"critical":u>0?"high":d>0?"medium":h>0?"low":"none",v=this.config.tags.map(b=>b.id===i?{...b,vulnerabilityScan:{status:"completed",severity:g,totalVulnerabilities:p,critical:r,high:u,medium:d,low:h,scannedAt:new Date(e).toISOString(),scanDuration:s}}:b);this.config.tags=v,this.harborMetrics.scansRunning=Math.max(0,this.harborMetrics.scansRunning-1),this.harborMetrics.scansCompleted++,this.scanLatencyHistory.push(s),this.scanLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.scanLatencyHistory.shift()}}}break;case"replication":this.harborMetrics.activeReplications=Math.max(0,this.harborMetrics.activeReplications-1);break;case"gc":if(t.size){const n=t.size/1024;this.harborMetrics.gcOperationsTotal++,this.harborMetrics.gcStorageFreed+=n,this.harborMetrics.storageUsed=Math.max(0,this.harborMetrics.storageUsed-n)}break}}addOperationToHistory(t){this.operationHistory.push(t),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(t){const e=t-1e4,s=this.operationHistory.filter(n=>n.startTime>e);this.harborMetrics.pushOperationsPerSecond=s.filter(n=>n.type==="push").length/10,this.harborMetrics.pullOperationsPerSecond=s.filter(n=>n.type==="pull").length/10,this.harborMetrics.scanOperationsPerSecond=s.filter(n=>n.type==="scan").length/10,this.harborMetrics.replicationOperationsPerSecond=s.filter(n=>n.type==="replication").length/10,this.pushLatencyHistory.length>0&&(this.harborMetrics.averagePushLatency=this.pushLatencyHistory.reduce((n,i)=>n+i,0)/this.pushLatencyHistory.length),this.pullLatencyHistory.length>0&&(this.harborMetrics.averagePullLatency=this.pullLatencyHistory.reduce((n,i)=>n+i,0)/this.pullLatencyHistory.length),this.scanLatencyHistory.length>0&&(this.harborMetrics.averageScanLatency=this.scanLatencyHistory.reduce((n,i)=>n+i,0)/this.scanLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const t=this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond+this.harborMetrics.replicationOperationsPerSecond,e=(this.harborMetrics.averagePushLatency*this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.averagePullLatency*this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.averageScanLatency*this.harborMetrics.scanOperationsPerSecond)/Math.max(1,this.harborMetrics.pushOperationsPerSecond+this.harborMetrics.pullOperationsPerSecond+this.harborMetrics.scanOperationsPerSecond),s=this.operationHistory.filter(d=>d.status==="failed").length,n=Math.min(1,s/Math.max(1,this.operationHistory.length)),i=Math.min(.95,.1+t/10*.4),o=Math.min(.95,.2+this.harborMetrics.storageUsed/this.harborMetrics.storageTotal*.5),r=this.harborMetrics.storageUsed/this.harborMetrics.storageTotal,u=Math.min(.95,t/20*.6);return{throughput:t,averageLatency:e||0,errorRate:n,cpuUtilization:i,memoryUtilization:o,storageUtilization:r,networkUtilization:u}}getMetrics(){return{...this.harborMetrics}}getConfig(){return this.config?{...this.config}:null}}class jk{config;connected=!1;eventSubscribers=new Set;eventStream=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;reconnectTimeout=3e3;constructor(t){this.config=t}getBaseUrl(){if(this.config.type==="local")return"/api/docker";{const t=this.config.useTLS?"https":"http",e=this.config.host||"localhost",s=this.config.port||2376;return`${t}://${e}:${s}`}}async request(t,e,s,n){const i=`${this.getBaseUrl()}${e}`,o=n?.timeout||this.config.timeout||3e4,r=new AbortController,u=setTimeout(()=>r.abort(),o);try{const d={"Content-Type":"application/json"};this.config.useTLS&&this.config.clientCert&&this.config.clientKey&&(d["X-Client-Cert"]=this.config.clientCert,d["X-Client-Key"]=this.config.clientKey);const h=await fetch(i,{method:t,headers:d,body:s?JSON.stringify(s):void 0,signal:r.signal});if(clearTimeout(u),!h.ok){const g=await h.text();throw new Error(`Docker API error: ${h.status} ${h.statusText} - ${g}`)}const p=h.headers.get("content-type");return p&&p.includes("application/json")?await h.json():{}}catch(d){throw clearTimeout(u),d.name==="AbortError"?new Error(`Request timeout after ${o}ms`):d}}async connect(){try{return await this.getSystemInfo()?(this.connected=!0,this.reconnectAttempts=0,this.startEventStream(),!0):!1}catch(t){return this.connected=!1,console.error("Failed to connect to Docker daemon:",t),!1}}async disconnect(){this.connected=!1,this.stopEventStream(),this.eventSubscribers.clear()}isConnected(){return this.connected}async testConnection(){try{return{success:!!await this.getSystemInfo()}}catch(t){return{success:!1,error:t.message}}}startEventStream(){if(this.eventSubscribers.size!==0)try{const t=`${this.getBaseUrl()}/events`;this.pollEvents()}catch(t){console.error("Failed to start event stream:",t)}}stopEventStream(){this.eventStream&&(this.eventStream.close(),this.eventStream=null)}async pollEvents(){}async listContainers(){return(await this.request("GET","/containers/json?all=true")).map(this.mapContainerFromAPI)}async getContainer(t){try{const e=await this.request("GET",`/containers/${t}/json`);return this.mapContainerFromAPI(e)}catch(e){if(e.message.includes("404"))return null;throw e}}async createContainer(t){const e=this.mapContainerConfigToAPI(t),s=await this.request("POST","/containers/create",e);return await this.getContainer(s.Id)||this.createContainerFromConfig(t,s.Id)}async startContainer(t){await this.request("POST",`/containers/${t}/start`)}async stopContainer(t){await this.request("POST",`/containers/${t}/stop`)}async pauseContainer(t){await this.request("POST",`/containers/${t}/pause`)}async unpauseContainer(t){await this.request("POST",`/containers/${t}/unpause`)}async restartContainer(t){await this.request("POST",`/containers/${t}/restart`)}async removeContainer(t,e=!1){await this.request("DELETE",`/containers/${t}?force=${e}`)}async listImages(){return(await this.request("GET","/images/json")).map(this.mapImageFromAPI)}async pullImage(t,e="latest"){await this.request("POST",`/images/create?fromImage=${t}&tag=${e}`);const n=(await this.listImages()).find(i=>i.repository===t&&i.tag===e);if(!n)throw new Error(`Failed to find pulled image ${t}:${e}`);return n}async buildImage(t){throw new Error("Build image not fully implemented - requires streaming support")}async removeImage(t,e=!1){await this.request("DELETE",`/images/${t}?force=${e}`)}async listNetworks(){return(await this.request("GET","/networks")).map(this.mapNetworkFromAPI)}async createNetwork(t){const e=this.mapNetworkConfigToAPI(t),s=await this.request("POST","/networks/create",e),i=(await this.listNetworks()).find(o=>o.id===s.Id);if(!i)throw new Error(`Failed to find created network ${s.Id}`);return i}async removeNetwork(t){await this.request("DELETE",`/networks/${t}`)}async listVolumes(){return(await this.request("GET","/volumes")).Volumes.map(this.mapVolumeFromAPI)}async createVolume(t){const e=this.mapVolumeConfigToAPI(t),s=await this.request("POST","/volumes/create",e),i=(await this.listVolumes()).find(o=>o.name===s.Name);if(!i)throw new Error(`Failed to find created volume ${s.Name}`);return i}async removeVolume(t){await this.request("DELETE",`/volumes/${t}`)}async getContainerStats(t){try{const e=await this.request("GET",`/containers/${t}/stats?stream=false`);return this.mapStatsFromAPI(e,t)}catch(e){if(e.message.includes("404"))return null;throw e}}async getSystemInfo(){try{const t=await this.request("GET","/info"),e=await this.request("GET","/version");return this.mapSystemInfoFromAPI(t,e)}catch(t){return console.error("Failed to get system info:",t),null}}subscribeToEvents(t){return this.eventSubscribers.add(t),this.connected&&!this.eventStream&&this.startEventStream(),()=>{this.eventSubscribers.delete(t),this.eventSubscribers.size===0&&this.stopEventStream()}}mapContainerFromAPI(t){const s=(t.Names||[])[0]?.replace(/^\//,"")||t.Id?.substring(0,12)||"unknown";return{id:t.Id||t.ID||"",name:s,image:t.Image||"",imageId:t.ImageID||"",status:this.mapContainerStatus(t.Status||t.State||"unknown"),createdAt:t.Created?new Date(t.Created).getTime():Date.now(),startedAt:t.StartedAt?new Date(t.StartedAt).getTime():void 0,finishedAt:t.FinishedAt?new Date(t.FinishedAt).getTime():void 0,restartCount:t.RestartCount||0,ports:this.mapPortsFromAPI(t.Ports),environment:t.Env?this.parseEnvVars(t.Env):void 0,volumes:t.Mounts?t.Mounts.map(n=>n.Name||n.Source):void 0,networks:t.NetworkSettings?Object.keys(t.NetworkSettings.Networks||{}):void 0,health:this.mapHealthStatus(t.Health)}}mapContainerStatus(t){const e=t.toLowerCase();return e.includes("running")?"running":e.includes("paused")?"paused":e.includes("restarting")?"restarting":e.includes("removing")?"removing":e.includes("exited")||e.includes("stopped")?"exited":e.includes("dead")?"dead":"created"}mapPortsFromAPI(t){if(t)return t.map(e=>({containerPort:e.PrivatePort||e.ContainerPort||0,hostPort:e.PublicPort||e.HostPort,protocol:(e.Type||"tcp").toLowerCase()}))}parseEnvVars(t){const e={};for(const s of t){const[n,...i]=s.split("=");n&&(e[n]=i.join("="))}return e}mapHealthStatus(t){if(!t)return"none";const e=t.Status||t.status||"";return e==="healthy"?"healthy":e==="unhealthy"?"unhealthy":e==="starting"?"starting":"none"}mapImageFromAPI(t){const e=t.RepoTags&&t.RepoTags[0]||"<none>:<none>",[s,n]=e.split(":");return{id:t.Id||t.ID||"",repository:s||"<none>",tag:n||"latest",digest:t.RepoDigests?.[0]?.split("@")[1],size:t.Size||0,createdAt:t.Created?new Date(t.Created*1e3).getTime():Date.now(),layers:t.Layers?.length}}mapNetworkFromAPI(t){return{id:t.Id||t.ID||"",name:t.Name||"",driver:t.Driver||"bridge",scope:t.Scope||"local",subnet:t.IPAM?.Config?.[0]?.Subnet,gateway:t.IPAM?.Config?.[0]?.Gateway,containers:t.Containers?Object.keys(t.Containers):void 0,created:t.Created?new Date(t.Created).getTime():Date.now(),internal:t.Internal||!1,enableIPv6:t.EnableIPv6||!1}}mapVolumeFromAPI(t){return{id:t.Name||t.Driver||"",name:t.Name||"",driver:t.Driver||"local",mountpoint:t.Mountpoint,size:t.UsageData?.Size,usedBy:t.UsageData?.RefCount?[t.UsageData.RefCount]:void 0,created:t.CreatedAt?new Date(t.CreatedAt).getTime():Date.now(),labels:t.Labels}}mapStatsFromAPI(t,e){const s=t.cpu_stats?.cpu_usage?.total_usage-(t.precpu_stats?.cpu_usage?.total_usage||0),n=t.cpu_stats?.system_cpu_usage-(t.precpu_stats?.system_cpu_usage||0),i=t.cpu_stats?.online_cpus||1,o=n>0?s/n*i*100:0,r=t.memory_stats?.usage||0,u=t.memory_stats?.limit||0,d=t.networks?Object.values(t.networks).reduce((p,g)=>p+(g.rx_bytes||0),0):0,h=t.networks?Object.values(t.networks).reduce((p,g)=>p+(g.tx_bytes||0),0):0;return{id:e,name:t.name||"",cpuUsage:Math.min(100,Math.max(0,o)),memoryUsage:r,memoryLimit:u,networkRx:d,networkTx:h,timestamp:Date.now()}}mapSystemInfoFromAPI(t,e){return{version:e.Version||"unknown",apiVersion:e.ApiVersion||"unknown",os:t.OperatingSystem||"unknown",arch:t.Architecture||"unknown",kernelVersion:t.KernelVersion||"unknown",totalMemory:t.MemTotal||0,totalCpus:t.NCPU||0,containers:t.Containers||0,containersRunning:t.ContainersRunning||0,containersPaused:t.ContainersPaused||0,containersStopped:t.ContainersStopped||0,images:t.Images||0,imagesSize:0}}mapContainerConfigToAPI(t){const e={Image:t.image,Cmd:t.command,Env:t.env?Object.entries(t.env).map(([s,n])=>`${s}=${n}`):void 0,HostConfig:{}};if(t.ports){e.ExposedPorts={},e.HostConfig.PortBindings={};for(const s of t.ports){const n=`${s.containerPort}/${s.protocol||"tcp"}`;e.ExposedPorts[n]={},s.hostPort&&(e.HostConfig.PortBindings[n]=[{HostPort:s.hostPort.toString()}])}}if(t.volumes&&(e.Volumes={},e.HostConfig.Binds=t.volumes),t.memoryLimit&&(e.HostConfig.Memory=t.memoryLimit),t.cpuLimit){const s=parseFloat(t.cpuLimit);isNaN(s)||(e.HostConfig.CpuQuota=Math.floor(s*1e5),e.HostConfig.CpuPeriod=1e5)}return t.restartPolicy&&(e.HostConfig.RestartPolicy={Name:t.restartPolicy}),t.healthCheck&&(e.Healthcheck={Test:t.healthCheck.test,Interval:t.healthCheck.interval||3e10,Timeout:t.healthCheck.timeout||5e9,Retries:t.healthCheck.retries||3,StartPeriod:t.healthCheck.startPeriod||0}),e}createContainerFromConfig(t,e){return{id:e,name:t.name||e.substring(0,12),image:t.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:t.ports,environment:t.env,volumes:t.volumes,networks:t.networks,health:"none"}}mapNetworkConfigToAPI(t){return{Name:t.name,Driver:t.driver||"bridge",IPAM:t.subnet||t.gateway?{Config:[{Subnet:t.subnet,Gateway:t.gateway}]}:void 0,Internal:t.internal||!1,EnableIPv6:t.enableIPv6||!1,Labels:t.labels}}mapVolumeConfigToAPI(t){return{Name:t.name,Driver:t.driver||"local",Labels:t.labels,DriverOpts:t.options}}}class Ok{containers=new Map;images=new Map;networks=new Map;volumes=new Map;eventSubscribers=new Set;statsCache=new Map;systemInfo=null;constructor(t,e,s,n){if(t&&Array.isArray(t))for(const i of t)this.containers.set(i.id,{...i});if(e&&Array.isArray(e))for(const i of e)this.images.set(i.id,{...i});if(s&&Array.isArray(s))for(const i of s)this.networks.set(i.id,{...i});if(n&&Array.isArray(n))for(const i of n)this.volumes.set(i.id,{...i});this.systemInfo={version:"24.0.0",apiVersion:"1.43",os:"linux",arch:"amd64",kernelVersion:"5.15.0",totalMemory:16*1024*1024*1024,totalCpus:8,containers:this.containers.size,containersRunning:Array.from(this.containers.values()).filter(i=>i.status==="running").length,containersPaused:Array.from(this.containers.values()).filter(i=>i.status==="paused").length,containersStopped:Array.from(this.containers.values()).filter(i=>i.status==="exited"||i.status==="dead").length,images:this.images.size,imagesSize:Array.from(this.images.values()).reduce((i,o)=>i+o.size,0)}}async connect(){return!0}async disconnect(){this.eventSubscribers.clear()}isConnected(){return!0}async testConnection(){return{success:!0}}async listContainers(){return Array.from(this.containers.values())}async getContainer(t){return this.containers.get(t)||null}async createContainer(t){const e=`sim-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,name:t.name||e.substring(0,12),image:t.image,imageId:"",status:"created",createdAt:Date.now(),restartCount:0,ports:t.ports,environment:t.env,volumes:t.volumes,networks:t.networks,health:"none",memoryLimit:t.memoryLimit};return this.containers.set(e,s),this.emitEvent("container","create",e,{}),s}async startContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",e.startedAt=Date.now(),this.emitEvent("container","start",t,{})}async stopContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="exited",e.finishedAt=Date.now(),e.cpuUsage=0,e.memoryUsage=0,this.emitEvent("container","stop",t,{})}async pauseContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="paused",this.emitEvent("container","pause",t,{})}async unpauseContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",this.emitEvent("container","unpause",t,{})}async restartContainer(t){const e=this.containers.get(t);if(!e)throw new Error(`Container ${t} not found`);e.status="running",e.startedAt=Date.now(),e.restartCount=(e.restartCount||0)+1,this.emitEvent("container","restart",t,{})}async removeContainer(t,e=!1){const s=this.containers.get(t);if(!s)throw new Error(`Container ${t} not found`);if(s.status==="running"&&!e)throw new Error("Cannot remove running container without force");this.containers.delete(t),this.statsCache.delete(t),this.emitEvent("container","destroy",t,{})}async listImages(){return Array.from(this.images.values())}async pullImage(t,e="latest"){await new Promise(i=>setTimeout(i,1e3));const s=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:s,repository:t,tag:e,size:100*1024*1024+Math.random()*500*1024*1024,createdAt:Date.now(),pulledAt:Date.now()};return this.images.set(s,n),this.emitEvent("image","pull",s,{repository:t,tag:e}),n}async buildImage(t){await new Promise(o=>setTimeout(o,2e3));const e=`img-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[s,n]=t.tag.split(":"),i={id:e,repository:s||t.tag,tag:n||"latest",size:200*1024*1024+Math.random()*800*1024*1024,createdAt:Date.now(),builtAt:Date.now()};return this.images.set(e,i),this.emitEvent("image","build",e,{tag:t.tag}),i}async removeImage(t,e=!1){if(!this.images.get(t))throw new Error(`Image ${t} not found`);this.images.delete(t),this.emitEvent("image","delete",t,{})}async listNetworks(){return Array.from(this.networks.values())}async createNetwork(t){const e=`net-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,name:t.name,driver:t.driver||"bridge",scope:"local",subnet:t.subnet,gateway:t.gateway,created:Date.now(),internal:t.internal||!1,enableIPv6:t.enableIPv6||!1};return this.networks.set(e,s),this.emitEvent("network","create",e,{name:t.name}),s}async removeNetwork(t){if(!this.networks.get(t))throw new Error(`Network ${t} not found`);this.networks.delete(t),this.emitEvent("network","destroy",t,{})}async listVolumes(){return Array.from(this.volumes.values())}async createVolume(t){const e=`vol-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:e,name:t.name,driver:t.driver||"local",created:Date.now(),labels:t.labels};return this.volumes.set(e,s),this.emitEvent("volume","create",e,{name:t.name}),s}async removeVolume(t){if(!this.volumes.get(t))throw new Error(`Volume ${t} not found`);this.volumes.delete(t),this.emitEvent("volume","destroy",t,{})}async getContainerStats(t){const e=this.containers.get(t);if(!e||e.status!=="running")return null;let s=this.statsCache.get(t);return s||(s={id:t,name:e.name,cpuUsage:e.cpuUsage||10+Math.random()*70,memoryUsage:e.memoryUsage||(e.memoryLimit||512*1024*1024)*.3,memoryLimit:e.memoryLimit||512*1024*1024,networkRx:e.networkRx||0,networkTx:e.networkTx||0,timestamp:Date.now()},this.statsCache.set(t,s)),s.cpuUsage=e.cpuUsage||s.cpuUsage,s.memoryUsage=e.memoryUsage||s.memoryUsage,s.networkRx=e.networkRx||s.networkRx,s.networkTx=e.networkTx||s.networkTx,s.timestamp=Date.now(),s}async getSystemInfo(){return this.systemInfo?(this.systemInfo.containers=this.containers.size,this.systemInfo.containersRunning=Array.from(this.containers.values()).filter(t=>t.status==="running").length,this.systemInfo.containersPaused=Array.from(this.containers.values()).filter(t=>t.status==="paused").length,this.systemInfo.containersStopped=Array.from(this.containers.values()).filter(t=>t.status==="exited"||t.status==="dead").length,this.systemInfo.images=this.images.size,this.systemInfo.imagesSize=Array.from(this.images.values()).reduce((t,e)=>t+e.size,0),{...this.systemInfo}):null}subscribeToEvents(t){return this.eventSubscribers.add(t),()=>{this.eventSubscribers.delete(t)}}emitEvent(t,e,s,n){const i={id:`evt-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,action:e,actor:{id:s,attributes:n},time:Math.floor(Date.now()/1e3),timeNano:Date.now()*1e6};for(const o of this.eventSubscribers)try{o(i)}catch(r){console.error("Error in event callback:",r)}}updateContainerStats(t,e){const s=this.containers.get(t);s&&(e.cpuUsage!==void 0&&(s.cpuUsage=e.cpuUsage),e.memoryUsage!==void 0&&(s.memoryUsage=e.memoryUsage),e.memoryLimit!==void 0&&(s.memoryLimit=e.memoryLimit),e.networkRx!==void 0&&(s.networkRx=e.networkRx),e.networkTx!==void 0&&(s.networkTx=e.networkTx))}}class qk{config=null;mode="simulation";simulationProvider=null;realProvider=null;currentProvider=null;activeOperations=new Map;operationHistory=[];MAX_HISTORY_SIZE=1e3;operationLatencyHistory=[];MAX_LATENCY_HISTORY=500;containers=new Map;syncInterval=null;syncEnabled=!1;lastSyncTime=0;dockerMetrics={containersTotal:0,containersRunning:0,containersStopped:0,containersPaused:0,imagesTotal:0,imagesSize:0,networksTotal:0,volumesTotal:0,volumesSize:0,operationsPerSecond:0,averageOperationLatency:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryLimit:0,totalNetworkRx:0,totalNetworkTx:0,buildOperationsPerSecond:0,pullOperationsPerSecond:0,pushOperationsPerSecond:0};lastUpdateTime=Date.now();initializeConfig(t){const e=t.data.config||{};if(Array.isArray(e.images)||(e.images=[]),Array.isArray(e.networks)||(e.networks=[]),Array.isArray(e.volumes)||(e.volumes=[]),Array.isArray(e.containers)||(e.containers=[]),this.config=e,this.mode=e.mode||"simulation",this.initializeProviders(),e.containers&&Array.isArray(e.containers))for(const s of e.containers)this.containers.set(s.id,{...s});this.updateMetricsFromConfig(),this.mode!=="simulation"&&e.syncSettings?.enabled&&this.startSync()}initializeProviders(){const t=Array.isArray(this.config?.containers)?this.config.containers:void 0,e=Array.isArray(this.config?.images)?this.config.images:void 0,s=Array.isArray(this.config?.networks)?this.config.networks:void 0,n=Array.isArray(this.config?.volumes)?this.config.volumes:void 0;if(this.simulationProvider=new Ok(t,e,s,n),(this.mode==="real"||this.mode==="hybrid")&&this.config?.dockerConnection){const i={type:this.config.dockerConnection.type,url:this.config.dockerConnection.url,host:this.config.dockerConnection.host,port:this.config.dockerConnection.port,useTLS:this.config.dockerConnection.useTLS,caCert:this.config.dockerConnection.caCert,clientCert:this.config.dockerConnection.clientCert,clientKey:this.config.dockerConnection.clientKey};this.realProvider=new jk(i)}this.currentProvider=this.mode==="simulation"?this.simulationProvider:this.realProvider||this.simulationProvider}setMode(t){this.mode!==t&&(this.mode=t,this.stopSync(),this.initializeProviders(),this.mode!=="simulation"&&this.config?.syncSettings?.enabled&&this.startSync())}getMode(){return this.mode}startSync(){if(this.syncInterval)return;const t=this.config?.syncSettings?.interval||2e3;this.syncEnabled=!0,this.syncFromProvider(),this.syncInterval=setInterval(()=>{this.syncFromProvider()},t),this.config?.syncSettings?.useEvents&&this.currentProvider&&this.currentProvider.subscribeToEvents(e=>{this.handleDockerEvent(e)})}stopSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.syncEnabled=!1}async syncFromProvider(){if(!(!this.currentProvider||!this.currentProvider.isConnected()))try{const t=await this.currentProvider.listContainers();this.syncContainers(t);const e=await this.currentProvider.listImages();this.config&&(this.config.images=Array.isArray(e)?e:[]);const s=await this.currentProvider.listNetworks();this.config&&(this.config.networks=Array.isArray(s)?s:[]);const n=await this.currentProvider.listVolumes();this.config&&(this.config.volumes=Array.isArray(n)?n:[]),this.lastSyncTime=Date.now(),this.updateMetricsFromConfig()}catch(t){console.error("Failed to sync from Docker provider:",t)}}syncContainers(t){for(const s of t){const n=this.containers.get(s.id);n?Object.assign(n,s):this.containers.set(s.id,{...s})}const e=new Set(t.map(s=>s.id));for(const[s]of this.containers.entries())e.has(s)||this.containers.delete(s);this.config&&(this.config.containers=Array.from(this.containers.values()))}handleDockerEvent(t){switch(t.type){case"container":this.handleContainerEvent(t);break;case"image":this.handleImageEvent(t);break;case"network":this.handleNetworkEvent(t);break;case"volume":this.handleVolumeEvent(t);break}}handleContainerEvent(t){const e=t.actor.id;t.action==="destroy"||t.action==="die"?this.containers.delete(e):this.currentProvider&&this.currentProvider.getContainer(e).then(s=>{s&&this.containers.set(e,s)})}handleImageEvent(t){}handleNetworkEvent(t){}handleVolumeEvent(t){}updateConfig(t){const e=t.data.config||{};Array.isArray(e.images)||(e.images=[]),Array.isArray(e.networks)||(e.networks=[]),Array.isArray(e.volumes)||(e.volumes=[]),Array.isArray(e.containers)||(e.containers=[]),this.config;const s=this.mode;this.config=e;const n=e.mode||"simulation";if(n!==s&&this.setMode(n),e.containers&&Array.isArray(e.containers)){const i=new Set(e.containers.map(o=>o.id));for(const[o,r]of this.containers.entries())i.has(o)||this.containers.delete(o);for(const o of e.containers){const r=this.containers.get(o.id);if(r){const u={...r,name:o.name,image:o.image,imageId:o.imageId,ports:o.ports,environment:o.environment,volumes:o.volumes,networks:o.networks,health:o.health,cpuUsage:r.status==="running"?r.cpuUsage:o.cpuUsage,memoryUsage:r.status==="running"?r.memoryUsage:o.memoryUsage,memoryLimit:o.memoryLimit||r.memoryLimit,networkRx:r.status==="running"?r.networkRx:o.networkRx,networkTx:r.status==="running"?r.networkTx:o.networkTx,status:o.status||r.status,createdAt:o.createdAt||r.createdAt,startedAt:o.startedAt||r.startedAt,finishedAt:o.finishedAt||r.finishedAt,restartCount:o.restartCount!==void 0?o.restartCount:r.restartCount,exitCode:o.exitCode!==void 0?o.exitCode:r.exitCode};this.containers.set(o.id,u)}else{const u={id:o.id,name:o.name,image:o.image,imageId:o.imageId,status:o.status||"created",createdAt:o.createdAt||Date.now(),startedAt:o.startedAt,finishedAt:o.finishedAt,restartCount:o.restartCount||0,cpuUsage:o.cpuUsage,memoryUsage:o.memoryUsage,memoryLimit:o.memoryLimit,networkRx:o.networkRx,networkTx:o.networkTx,ports:o.ports,environment:o.environment,volumes:o.volumes,networks:o.networks,health:o.health,exitCode:o.exitCode};this.containers.set(o.id,u)}}}this.updateMetricsFromConfig()}updateMetricsFromConfig(){if(!this.config)return;this.dockerMetrics.containersTotal=this.containers.size,this.dockerMetrics.containersRunning=Array.from(this.containers.values()).filter(n=>n.status==="running").length,this.dockerMetrics.containersStopped=Array.from(this.containers.values()).filter(n=>n.status==="exited"||n.status==="dead").length,this.dockerMetrics.containersPaused=Array.from(this.containers.values()).filter(n=>n.status==="paused").length;const t=Array.isArray(this.config.images)?this.config.images:[];this.dockerMetrics.imagesTotal=t.length,this.dockerMetrics.imagesSize=t.reduce((n,i)=>n+(i.size||0),0);const e=Array.isArray(this.config.networks)?this.config.networks:[];this.dockerMetrics.networksTotal=e.length;const s=Array.isArray(this.config.volumes)?this.config.volumes:[];this.dockerMetrics.volumesTotal=s.length,this.dockerMetrics.volumesSize=s.reduce((n,i)=>n+(i.size||0),0)}performUpdate(t,e=!1){if(!this.config)return;const s=t-this.lastUpdateTime;this.lastUpdateTime=t,this.mode!=="simulation"&&this.currentProvider?.isConnected()&&this.updateContainerStatsFromProvider(),this.mode==="simulation"&&e&&this.simulateContainerOperations(t),this.mode==="simulation"&&this.simulateImageOperations(t,e),this.mode==="simulation"&&this.updateContainerResources(s),this.updateActiveOperations(t),this.updateMetrics(t)}async updateContainerStatsFromProvider(){if(!this.currentProvider)return;const t=Array.from(this.containers.values()).filter(e=>e.status==="running");for(const e of t)try{const s=await this.currentProvider.getContainerStats(e.id);s&&(e.cpuUsage=s.cpuUsage,e.memoryUsage=s.memoryUsage,e.memoryLimit=s.memoryLimit,e.networkRx=s.networkRx,e.networkTx=s.networkTx,this.mode==="hybrid"&&this.simulationProvider&&this.simulationProvider.updateContainerStats(e.id,s))}catch(s){console.error(`Failed to get stats for container ${e.id}:`,s)}}simulateContainerOperations(t){if(this.containers.size===0)return;const e=Math.min(1,.1+this.containers.size/20);if(Math.random()<e/10){const s=Array.from(this.containers.values()),n=s[Math.floor(Math.random()*s.length)];let i;n.status==="running"?i=Math.random()<.1?"stop":Math.random()<.2?"pause":Math.random()<.3?"restart":"create":n.status==="exited"||n.status==="dead"?i=Math.random()<.5?"start":"create":n.status==="paused"?i=Math.random()<.5?"unpause":"stop":i="create",this.simulateContainerOperation(n.id,i,t)}}simulateContainerOperation(t,e,s){if(!this.containers.get(t))return;const i=`${e}-${t}-${s}-${Math.random()}`;let o=100;switch(e){case"create":o=500+Math.random()*1e3;break;case"start":o=200+Math.random()*500;break;case"stop":o=100+Math.random()*300;break;case"pause":o=50+Math.random()*100;break;case"unpause":o=50+Math.random()*100;break;case"restart":o=300+Math.random()*700;break;case"remove":o=200+Math.random()*400;break}const r=s+o,u={id:i,type:e,containerId:t,startTime:s,status:"running",completionTime:r};this.activeOperations.set(i,u)}simulateImageOperations(t,e){if(!this.config?.images||!Array.isArray(this.config.images)||this.config.images.length===0)return;const s=Math.min(.5,.05+this.config.images.length/50);if(e&&Math.random()<s/10){const n=this.config.images[Math.floor(Math.random()*this.config.images.length)],i=Math.random()<.7?"pull":Math.random()<.9?"build":"push";this.simulateImageOperation(n.id,i,t)}}simulateImageOperation(t,e,s){const n=`${e}-${t}-${s}-${Math.random()}`;let i=1e3;switch(e){case"pull":i=2e3+Math.random()*8e3;break;case"push":i=3e3+Math.random()*1e4;break;case"build":i=5e3+Math.random()*15e3;break}const o=s+i,r={id:n,type:e,imageId:t,startTime:s,status:"running",completionTime:o};this.activeOperations.set(n,r)}updateContainerResources(t){const e=Array.from(this.containers.values()).filter(u=>u.status==="running");let s=0,n=0,i=0,o=0,r=0;for(const u of e){const d=10+Math.random()*70,h=(Math.random()-.5)*10;u.cpuUsage=Math.max(0,Math.min(100,d+h));const p=u.memoryLimit||512*1024*1024;if(u.memoryLimit=p,!u.memoryUsage)u.memoryUsage=p*.3;else{const b=1+(Math.random()-.4)*.1;u.memoryUsage=Math.min(p*.95,u.memoryUsage*b)}const v=(1e3+Math.random()*9e3)*t/1e3;u.networkRx=(u.networkRx||0)+v,u.networkTx=(u.networkTx||0)+v*.8,s+=u.cpuUsage,n+=u.memoryUsage,i+=p,o+=u.networkRx||0,r+=u.networkTx||0}this.dockerMetrics.totalCpuUsage=e.length>0?s/e.length:0,this.dockerMetrics.totalMemoryUsage=n,this.dockerMetrics.totalMemoryLimit=i,this.dockerMetrics.totalNetworkRx=o,this.dockerMetrics.totalNetworkTx=r}updateActiveOperations(t){const e=[];for(const[n,i]of this.activeOperations.entries())i.completionTime&&t>=i.completionTime&&i.status==="running"&&e.push(i);for(const n of e)this.completeOperation(n,t);const s=t-6e4;for(const[n,i]of this.activeOperations.entries())i.startTime<s&&i.status==="completed"&&this.activeOperations.delete(n)}completeOperation(t,e){const s=t.completionTime?t.completionTime-t.startTime:0;switch(t.status="completed",t.duration=s,this.activeOperations.delete(t.id),this.addOperationToHistory(t),t.type){case"create":case"start":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="running",n.startedAt=e,n.restartCount=n.restartCount||0)}break;case"stop":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="exited",n.finishedAt=e,n.cpuUsage=0,n.memoryUsage=0)}break;case"pause":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="paused")}break;case"unpause":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="running")}break;case"restart":if(t.containerId){const n=this.containers.get(t.containerId);n&&(n.status="running",n.startedAt=e,n.restartCount=(n.restartCount||0)+1)}break;case"remove":t.containerId&&this.containers.delete(t.containerId);break}s>0&&(this.operationLatencyHistory.push(s),this.operationLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.operationLatencyHistory.shift())}addOperationToHistory(t){this.operationHistory.push(t),this.operationHistory.length>this.MAX_HISTORY_SIZE&&this.operationHistory.shift()}updateMetrics(t){const e=t-1e4,s=this.operationHistory.filter(n=>n.startTime>e);this.dockerMetrics.operationsPerSecond=s.length/10,this.dockerMetrics.buildOperationsPerSecond=s.filter(n=>n.type==="build").length/10,this.dockerMetrics.pullOperationsPerSecond=s.filter(n=>n.type==="pull").length/10,this.dockerMetrics.pushOperationsPerSecond=s.filter(n=>n.type==="push").length/10,this.operationLatencyHistory.length>0&&(this.dockerMetrics.averageOperationLatency=this.operationLatencyHistory.reduce((n,i)=>n+i,0)/this.operationLatencyHistory.length),this.updateMetricsFromConfig()}calculateLoad(){const t=this.dockerMetrics.operationsPerSecond,e=this.dockerMetrics.averageOperationLatency,s=this.operationHistory.filter(g=>g.status==="failed").length,n=Math.min(1,s/Math.max(1,this.operationHistory.length)),i=Math.min(.95,this.dockerMetrics.totalCpuUsage/100),o=this.dockerMetrics.totalMemoryLimit>0?Math.min(.95,this.dockerMetrics.totalMemoryUsage/this.dockerMetrics.totalMemoryLimit):.1,r=1e3*1024*1024,u=Math.min(.95,(this.dockerMetrics.totalNetworkRx+this.dockerMetrics.totalNetworkTx)/r*8),d=100*1024*1024*1024,h=this.dockerMetrics.imagesSize+this.dockerMetrics.volumesSize,p=Math.min(.95,h/d);return{throughput:t,averageLatency:e||0,errorRate:n,cpuUtilization:i,memoryUtilization:o,networkUtilization:u,diskUtilization:p}}getMetrics(){return{...this.dockerMetrics}}getConfig(){return this.config?{...this.config}:null}getContainers(){return Array.from(this.containers.values())}getContainer(t){return this.containers.get(t)}getImages(){return this.config?.images||[]}getNetworks(){return this.config?.networks||[]}getVolumes(){return this.config?.volumes||[]}getProvider(){return this.currentProvider}async testConnection(){return this.currentProvider?await this.currentProvider.testConnection():{success:!1,error:"No provider available"}}async connect(){if(!this.currentProvider)return!1;const t=await this.currentProvider.connect();return t&&this.config?.syncSettings?.enabled&&this.startSync(),t}async disconnect(){this.stopSync(),this.currentProvider&&await this.currentProvider.disconnect()}isConnected(){return this.currentProvider?.isConnected()||!1}async createContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");const e={name:t.name,image:t.image,command:t.command,env:t.env,ports:t.ports,volumes:t.volumes,networks:t.networks,memoryLimit:t.memoryLimit,cpuLimit:t.cpuLimit},s=await this.currentProvider.createContainer(e);return this.containers.set(s.id,s),this.config&&(this.config.containers=Array.from(this.containers.values())),s}async startContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.startContainer(t);const e=this.containers.get(t);e&&(e.status="running",e.startedAt=Date.now())}async stopContainerViaProvider(t){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.stopContainer(t);const e=this.containers.get(t);e&&(e.status="exited",e.finishedAt=Date.now())}async removeContainerViaProvider(t,e=!1){if(!this.currentProvider)throw new Error("No provider available");await this.currentProvider.removeContainer(t,e),this.containers.delete(t),this.config&&(this.config.containers=Array.from(this.containers.values()))}async pullImageViaProvider(t,e="latest"){if(!this.currentProvider)throw new Error("No provider available");const s=await this.currentProvider.pullImage(t,e);if(this.config){Array.isArray(this.config.images)||(this.config.images=[]);const n=this.config.images.findIndex(i=>i.id===s.id);n>=0?this.config.images[n]=s:this.config.images.push(s)}return s}async getSystemInfo(){return this.currentProvider?await this.currentProvider.getSystemInfo():null}}class Hk{config=null;pods=new Map;deployments=new Map;services=new Map;configMaps=new Map;secrets=new Map;namespaces=new Map;nodes=new Map;events=[];persistentVolumeClaims=new Map;kubernetesMetrics={podsTotal:0,podsRunning:0,podsPending:0,podsFailed:0,podsSucceeded:0,deploymentsTotal:0,deploymentsReady:0,deploymentsNotReady:0,servicesTotal:0,servicesClusterIP:0,servicesNodePort:0,servicesLoadBalancer:0,nodesTotal:0,nodesReady:0,nodesNotReady:0,totalCpuRequests:0,totalCpuLimits:0,totalMemoryRequests:0,totalMemoryLimits:0,totalCpuUsage:0,totalMemoryUsage:0,totalMemoryCapacity:0,namespacesTotal:0,configMapsTotal:0,secretsTotal:0};lastUpdateTime=Date.now();updateInterval=1e3;initializeConfig(t){const e=t.data.config||{};this.config=e,this.config.defaultNamespace||(this.config.defaultNamespace="default"),this.config.namespaces||(this.config.namespaces=[]),this.config.namespaces.some(n=>n.name===(this.config?.defaultNamespace||"default"))||this.config.namespaces.push({id:this.generateId(),name:this.config.defaultNamespace,phase:"Active",createdAt:Date.now()}),(!this.config.nodes||this.config.nodes.length===0)&&(this.config.nodes=[{id:this.generateId(),name:"node-1",roles:["worker"],conditions:[{type:"Ready",status:"True",lastTransitionTime:Date.now()}],allocatable:{cpu:"4",memory:"8Gi",pods:"110"},capacity:{cpu:"4",memory:"8Gi",pods:"110"},createdAt:Date.now(),unschedulable:!1,podCount:0}]),this.initializeResources(),this.updateMetricsFromResources()}initializeResources(){if(this.config){if(this.pods.clear(),this.config.pods)for(const t of this.config.pods)this.pods.set(t.id,{...t});if(this.deployments.clear(),this.config.deployments)for(const t of this.config.deployments)this.deployments.set(t.id,{...t});if(this.services.clear(),this.config.services)for(const t of this.config.services)this.services.set(t.id,{...t});if(this.configMaps.clear(),this.config.configMaps)for(const t of this.config.configMaps)this.configMaps.set(t.id,{...t});if(this.secrets.clear(),this.config.secrets)for(const t of this.config.secrets)this.secrets.set(t.id,{...t});if(this.namespaces.clear(),this.config.namespaces)for(const t of this.config.namespaces)this.namespaces.set(t.id,{...t});if(this.nodes.clear(),this.config.nodes)for(const t of this.config.nodes)this.nodes.set(t.id,{...t});if(this.persistentVolumeClaims.clear(),this.config.persistentVolumeClaims)for(const t of this.config.persistentVolumeClaims)this.persistentVolumeClaims.set(t.id,{...t});this.events=this.config.events||[]}}updateConfig(t){const e=t.data.config||{};this.config,this.config=e,this.syncResources(),this.updateMetricsFromResources()}syncResources(){if(this.config){if(this.config.pods){const t=new Set(this.config.pods.map(e=>e.id));for(const[e]of this.pods.entries())t.has(e)||this.pods.delete(e);for(const e of this.config.pods){const s=this.pods.get(e.id);s?this.pods.set(e.id,{...s,...e,totalCpuUsage:s.phase==="Running"?s.totalCpuUsage:e.totalCpuUsage,totalMemoryUsage:s.phase==="Running"?s.totalMemoryUsage:e.totalMemoryUsage,startedAt:e.startedAt||s.startedAt}):this.pods.set(e.id,{...e})}}this.initializeResources()}}updateMetricsFromResources(){this.kubernetesMetrics.podsTotal=this.pods.size,this.kubernetesMetrics.podsRunning=Array.from(this.pods.values()).filter(n=>n.phase==="Running").length,this.kubernetesMetrics.podsPending=Array.from(this.pods.values()).filter(n=>n.phase==="Pending").length,this.kubernetesMetrics.podsFailed=Array.from(this.pods.values()).filter(n=>n.phase==="Failed").length,this.kubernetesMetrics.podsSucceeded=Array.from(this.pods.values()).filter(n=>n.phase==="Succeeded").length,this.kubernetesMetrics.deploymentsTotal=this.deployments.size,this.kubernetesMetrics.deploymentsReady=Array.from(this.deployments.values()).filter(n=>n.readyReplicas===n.replicas&&n.replicas>0).length,this.kubernetesMetrics.deploymentsNotReady=Array.from(this.deployments.values()).filter(n=>n.readyReplicas!==n.replicas||n.replicas===0).length,this.kubernetesMetrics.servicesTotal=this.services.size,this.kubernetesMetrics.servicesClusterIP=Array.from(this.services.values()).filter(n=>n.type==="ClusterIP").length,this.kubernetesMetrics.servicesNodePort=Array.from(this.services.values()).filter(n=>n.type==="NodePort").length,this.kubernetesMetrics.servicesLoadBalancer=Array.from(this.services.values()).filter(n=>n.type==="LoadBalancer").length,this.kubernetesMetrics.nodesTotal=this.nodes.size,this.kubernetesMetrics.nodesReady=Array.from(this.nodes.values()).filter(n=>n.conditions?.some(i=>i.type==="Ready"&&i.status==="True")).length,this.kubernetesMetrics.nodesNotReady=this.kubernetesMetrics.nodesTotal-this.kubernetesMetrics.nodesReady;let t=0,e=0,s=0;for(const n of this.pods.values())n.totalCpuUsage&&(t+=n.totalCpuUsage),n.totalMemoryUsage&&(e+=n.totalMemoryUsage);for(const n of this.nodes.values())n.memoryCapacity&&(s+=n.memoryCapacity);this.kubernetesMetrics.totalCpuUsage=t,this.kubernetesMetrics.totalMemoryUsage=e,this.kubernetesMetrics.totalMemoryCapacity=s,this.kubernetesMetrics.namespacesTotal=this.namespaces.size,this.kubernetesMetrics.configMapsTotal=this.configMaps.size,this.kubernetesMetrics.secretsTotal=this.secrets.size}simulateStep(){const t=Date.now(),e=t-this.lastUpdateTime;this.lastUpdateTime=t,this.simulatePodLifecycle(e),this.simulateDeploymentReconciliation(e),this.simulateNodeMetrics(e),this.updateMetricsFromResources()}simulatePodLifecycle(t){for(const e of this.pods.values())e.phase==="Running"&&(e.totalCpuUsage?e.totalCpuUsage=Math.max(0,Math.min(100,e.totalCpuUsage+(Math.random()-.5)*5)):e.totalCpuUsage=20+Math.random()*60,e.totalMemoryUsage?e.totalMemoryUsage=Math.max(0,e.totalMemoryUsage+(Math.random()-.5)*100*1024*1024):e.totalMemoryUsage=512*1024*1024+Math.random()*(2*1024*1024*1024),e.totalMemoryLimit||(e.totalMemoryLimit=e.totalMemoryUsage*1.5))}simulateDeploymentReconciliation(t){for(const e of this.deployments.values()){const s=Array.from(this.pods.values()).filter(o=>o.namespace!==e.namespace?!1:e.selector?Object.entries(e.selector).every(([r,u])=>o.labels?.[r]===u):!1),n=s.filter(o=>o.phase==="Running"),i=n.filter(o=>o.conditions?.find(u=>u.type==="Ready")?.status==="True");e.readyReplicas=i.length,e.availableReplicas=n.length,e.updatedReplicas=n.length,e.unavailableReplicas=Math.max(0,e.replicas-e.availableReplicas),s.length<e.replicas&&!e.paused&&e.replicas-s.length>0&&Math.random()>.7&&this.createPodForDeployment(e)}}createPodForDeployment(t){const e=`${t.name}-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,s=this.generateId(),n={id:s,name:e,namespace:t.namespace||this.config?.defaultNamespace||"default",labels:t.template?.labels||t.selector,phase:"Pending",status:"Pending",createdAt:Date.now(),restartPolicy:"Always",restartCount:0};this.pods.set(s,n),this.config&&this.config.pods?this.config.pods.push(n):this.config&&(this.config.pods=[n]),setTimeout(()=>{const i=this.pods.get(s);i&&(i.phase="Running",i.status="Running",i.startedAt=Date.now(),i.podIP=`10.244.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,i.conditions=[{type:"Ready",status:"True",lastTransitionTime:Date.now()},{type:"PodScheduled",status:"True",lastTransitionTime:Date.now()}])},1e3+Math.random()*2e3)}simulateNodeMetrics(t){for(const e of this.nodes.values()){const s=Array.from(this.pods.values()).filter(o=>o.nodeName===e.name);e.podCount=s.length;let n=0,i=0;for(const o of s)o.totalCpuUsage&&(n+=o.totalCpuUsage),o.totalMemoryUsage&&(i+=o.totalMemoryUsage);e.cpuUsage=Math.min(100,n),e.capacity?.memory&&!e.memoryCapacity&&(e.memoryCapacity=this.parseMemoryString(e.capacity.memory)),e.memoryCapacity&&(e.memoryUsage=Math.min(e.memoryCapacity,i))}}parseMemoryString(t){const e=t.match(/^(\d+)([KMGT]?i?)$/);if(!e)return 0;const s=parseInt(e[1],10),n=e[2].toLowerCase(),i={"":1,k:1024,ki:1024,m:1024*1024,mi:1024*1024,g:1024*1024*1024,gi:1024*1024*1024,t:1024*1024*1024*1024,ti:1024*1024*1024*1024};return s*(i[n]||1)}createEvent(t,e,s,n){const i={id:this.generateId(),name:`${n.name}.${Date.now()}`,namespace:n.namespace||this.config?.defaultNamespace||"default",type:t,reason:e,message:s,involvedObject:n,firstTimestamp:Date.now(),lastTimestamp:Date.now(),count:1};this.events.push(i),this.events.length>1e3&&(this.events=this.events.slice(-1e3)),this.config&&(this.config.events=[...this.events])}syncResourcesToConfig(){this.config&&(this.config.pods=Array.from(this.pods.values()),this.config.deployments=Array.from(this.deployments.values()),this.config.services=Array.from(this.services.values()),this.config.configMaps=Array.from(this.configMaps.values()),this.config.secrets=Array.from(this.secrets.values()),this.config.namespaces=Array.from(this.namespaces.values()),this.config.nodes=Array.from(this.nodes.values()),this.config.events=this.events,this.config.persistentVolumeClaims=Array.from(this.persistentVolumeClaims.values()))}createPod(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),phase:t.phase||"Pending",status:t.status||"Pending"};return this.pods.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Pod ${s.name} created`,{kind:"Pod",name:s.name,namespace:s.namespace,uid:s.id}),s}updatePod(t,e){const s=this.pods.get(t);if(!s)throw new Error(`Pod with id "${t}" not found`);const n={...s,...e,id:s.id};return this.pods.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Pod ${s.name} updated`,{kind:"Pod",name:s.name,namespace:s.namespace,uid:s.id}),n}deletePod(t){const e=this.pods.get(t);if(!e)throw new Error(`Pod with id "${t}" not found`);this.pods.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Pod ${e.name} deleted`,{kind:"Pod",name:e.name,namespace:e.namespace,uid:e.id})}createDeployment(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),readyReplicas:0,availableReplicas:0,updatedReplicas:0,unavailableReplicas:t.replicas,paused:!1};if(this.deployments.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),s.replicas>0)for(let n=0;n<s.replicas;n++)this.createPodForDeployment(s);return this.createEvent("Normal","Created",`Deployment ${s.name} created`,{kind:"Deployment",name:s.name,namespace:s.namespace,uid:s.id}),s}updateDeployment(t,e){const s=this.deployments.get(t);if(!s)throw new Error(`Deployment with id "${t}" not found`);const n=s.replicas,i={...s,...e,id:s.id};if(e.replicas!==void 0&&e.replicas!==n){const o=e.replicas-n;if(o>0)for(let r=0;r<o;r++)this.createPodForDeployment(i);else if(o<0){const u=Array.from(this.pods.values()).filter(d=>d.namespace!==s.namespace?!1:s.selector?Object.entries(s.selector).every(([h,p])=>d.labels?.[h]===p):!1).slice(0,Math.abs(o));for(const d of u)this.deletePod(d.id)}}return this.deployments.set(t,i),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Deployment ${s.name} updated`,{kind:"Deployment",name:s.name,namespace:s.namespace,uid:s.id}),i}deleteDeployment(t){const e=this.deployments.get(t);if(!e)throw new Error(`Deployment with id "${t}" not found`);const s=Array.from(this.pods.values()).filter(n=>n.namespace!==e.namespace?!1:e.selector?Object.entries(e.selector).every(([i,o])=>n.labels?.[i]===o):!1);for(const n of s)this.deletePod(n.id);this.deployments.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Deployment ${e.name} deleted`,{kind:"Deployment",name:e.name,namespace:e.namespace,uid:e.id})}createService(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),type:t.type||"ClusterIP",clusterIP:t.clusterIP||`10.96.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`};if(s.selector){const n=Array.from(this.pods.values()).filter(i=>i.namespace!==s.namespace?!1:Object.entries(s.selector).every(([o,r])=>i.labels?.[o]===r));s.endpoints=[{addresses:n.filter(i=>i.podIP).map(i=>i.podIP),ports:s.ports?.map(i=>({port:typeof i.targetPort=="number"?i.targetPort:parseInt(i.targetPort,10),protocol:i.protocol||"TCP"}))}]}return this.services.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Service ${s.name} created`,{kind:"Service",name:s.name,namespace:s.namespace,uid:s.id}),s}updateService(t,e){const s=this.services.get(t);if(!s)throw new Error(`Service with id "${t}" not found`);const n={...s,...e,id:s.id};if(e.selector&&n.selector){const i=Array.from(this.pods.values()).filter(o=>o.namespace!==s.namespace?!1:Object.entries(n.selector).every(([r,u])=>o.labels?.[r]===u));n.endpoints=[{addresses:i.filter(o=>o.podIP).map(o=>o.podIP),ports:n.ports?.map(o=>({port:typeof o.targetPort=="number"?o.targetPort:parseInt(o.targetPort,10),protocol:o.protocol||"TCP"}))}]}return this.services.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Service ${s.name} updated`,{kind:"Service",name:s.name,namespace:s.namespace,uid:s.id}),n}deleteService(t){const e=this.services.get(t);if(!e)throw new Error(`Service with id "${t}" not found`);this.services.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Service ${e.name} deleted`,{kind:"Service",name:e.name,namespace:e.namespace,uid:e.id})}createConfigMap(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s={...t,id:this.generateId(),createdAt:Date.now(),data:t.data||{}};return this.configMaps.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`ConfigMap ${s.name} created`,{kind:"ConfigMap",name:s.name,namespace:s.namespace,uid:s.id}),s}updateConfigMap(t,e){const s=this.configMaps.get(t);if(!s)throw new Error(`ConfigMap with id "${t}" not found`);if(s.immutable)throw new Error(`ConfigMap "${s.name}" is immutable`);const n={...s,...e,id:s.id};return this.configMaps.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`ConfigMap ${s.name} updated`,{kind:"ConfigMap",name:s.name,namespace:s.namespace,uid:s.id}),n}deleteConfigMap(t){const e=this.configMaps.get(t);if(!e)throw new Error(`ConfigMap with id "${t}" not found`);this.configMaps.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`ConfigMap ${e.name} deleted`,{kind:"ConfigMap",name:e.name,namespace:e.namespace,uid:e.id})}createSecret(t){if(!this.config)throw new Error("Engine not initialized");const e=this.namespaces.get(t.namespace);if(!e||e.phase!=="Active")throw new Error(`Namespace "${t.namespace}" does not exist or is not active`);const s=t.data||{};if(t.stringData)for(const[i,o]of Object.entries(t.stringData))s[i]=btoa(o);const n={...t,id:this.generateId(),createdAt:Date.now(),type:t.type||"Opaque",data:s};return this.secrets.set(n.id,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Secret ${n.name} created`,{kind:"Secret",name:n.name,namespace:n.namespace,uid:n.id}),n}updateSecret(t,e){const s=this.secrets.get(t);if(!s)throw new Error(`Secret with id "${t}" not found`);if(s.immutable)throw new Error(`Secret "${s.name}" is immutable`);const n={...s,...e,id:s.id};if(e.stringData){n.data={...n.data};for(const[i,o]of Object.entries(e.stringData))n.data[i]=btoa(o)}return this.secrets.set(t,n),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Updated",`Secret ${s.name} updated`,{kind:"Secret",name:s.name,namespace:s.namespace,uid:s.id}),n}deleteSecret(t){const e=this.secrets.get(t);if(!e)throw new Error(`Secret with id "${t}" not found`);this.secrets.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Secret ${e.name} deleted`,{kind:"Secret",name:e.name,namespace:e.namespace,uid:e.id})}createNamespace(t){if(!this.config)throw new Error("Engine not initialized");if(Array.from(this.namespaces.values()).find(n=>n.name===t.name))throw new Error(`Namespace "${t.name}" already exists`);const s={...t,id:this.generateId(),createdAt:Date.now(),phase:"Active"};return this.namespaces.set(s.id,s),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Created",`Namespace ${s.name} created`,{kind:"Namespace",name:s.name,uid:s.id}),s}deleteNamespace(t){const e=this.namespaces.get(t);if(!e)throw new Error(`Namespace with id "${t}" not found`);if(e.name==="default"||e.name===this.config?.defaultNamespace)throw new Error("Cannot delete default namespace");const s=Array.from(this.pods.values()).some(o=>o.namespace===e.name),n=Array.from(this.deployments.values()).some(o=>o.namespace===e.name),i=Array.from(this.services.values()).some(o=>o.namespace===e.name);if(s||n||i)throw new Error(`Namespace "${e.name}" contains resources and cannot be deleted`);this.namespaces.delete(t),this.syncResourcesToConfig(),this.updateMetricsFromResources(),this.createEvent("Normal","Deleted",`Namespace ${e.name} deleted`,{kind:"Namespace",name:e.name,uid:e.id})}getPods(){return Array.from(this.pods.values())}getPodsByNamespace(t){return Array.from(this.pods.values()).filter(e=>e.namespace===t)}getDeployments(){return Array.from(this.deployments.values())}getDeploymentsByNamespace(t){return Array.from(this.deployments.values()).filter(e=>e.namespace===t)}getServices(){return Array.from(this.services.values())}getServicesByNamespace(t){return Array.from(this.services.values()).filter(e=>e.namespace===t)}getConfigMaps(){return Array.from(this.configMaps.values())}getConfigMapsByNamespace(t){return Array.from(this.configMaps.values()).filter(e=>e.namespace===t)}getSecrets(){return Array.from(this.secrets.values())}getSecretsByNamespace(t){return Array.from(this.secrets.values()).filter(e=>e.namespace===t)}getNamespaces(){return Array.from(this.namespaces.values())}getNodes(){return Array.from(this.nodes.values())}getEvents(){return[...this.events]}getEventsByNamespace(t){return this.events.filter(e=>e.namespace===t)}getPersistentVolumeClaims(){return Array.from(this.persistentVolumeClaims.values())}getMetrics(){return{...this.kubernetesMetrics}}getLoad(){const t=Array.from(this.nodes.values()).reduce((u,d)=>{if(d.capacity?.cpu){const h=parseFloat(d.capacity.cpu);return u+h*1e3}return u},0),e=this.kubernetesMetrics.totalCpuUsage,s=t>0?e/t:0,n=this.kubernetesMetrics.totalMemoryCapacity>0?this.kubernetesMetrics.totalMemoryUsage/this.kubernetesMetrics.totalMemoryCapacity:0,i=Array.from(this.nodes.values()).reduce((u,d)=>d.capacity?.pods?u+parseInt(d.capacity.pods,10):u,0),o=i>0?this.kubernetesMetrics.podsTotal/i:0,r=this.kubernetesMetrics.podsTotal>0?this.kubernetesMetrics.podsFailed/this.kubernetesMetrics.podsTotal:0;return{throughput:this.kubernetesMetrics.podsRunning*10,averageLatency:100+Math.random()*200,errorRate:r,cpuUtilization:Math.min(1,s),memoryUtilization:Math.min(1,n),podUtilization:Math.min(1,o),networkUtilization:.1+Math.random()*.3,diskUtilization:.2+Math.random()*.2}}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getConfig(){return this.config?(this.syncResourcesToConfig(),{...this.config}):null}}class $k{config=null;inventories=new Map;projects=new Map;credentials=new Map;jobTemplates=new Map;activeJobs=new Map;jobHistory=new Map;MAX_JOB_HISTORY=1e3;schedules=new Map;ansibleMetrics={inventoriesTotal:0,projectsTotal:0,credentialsTotal:0,jobTemplatesTotal:0,jobTemplatesEnabled:0,jobsTotal:0,jobsSuccess:0,jobsFailed:0,jobsRunning:0,jobsPending:0,jobsPerHour:0,averageJobDuration:0,hostsTotal:0,hostsOk:0,hostsChanged:0,hostsFailed:0,hostsUnreachable:0,schedulesTotal:0,schedulesEnabled:0,requestsTotal:0,requestsErrors:0};jobHistoryList=[];MAX_JOB_HISTORY_LIST=1e3;lastJobTime=new Map;scheduleNextRuns=new Map;processRequest(t=!0){this.ansibleMetrics.requestsTotal++,t||this.ansibleMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={towerUrl:e.towerUrl||"https://tower.example.com",organizationName:e.organizationName||"Default",defaultExecutionEnvironment:e.defaultExecutionEnvironment||"default",inventories:e.inventories||[],projects:e.projects||[],credentials:e.credentials||[],jobTemplates:e.jobTemplates||[],jobs:e.jobs||[],schedules:e.schedules||[],jobTriggerRate:e.jobTriggerRate||.5,averageJobDuration:e.averageJobDuration||12e4,failureRate:e.failureRate??.05,hostFailureRate:e.hostFailureRate??.02,playbookComplexity:e.playbookComplexity??.5,maxForks:e.maxForks||5,defaultTimeout:e.defaultTimeout||3600},this.initializeInventories(),this.initializeProjects(),this.initializeCredentials(),this.initializeJobTemplates(),this.initializeJobs(),this.initializeSchedules()}updateConfig(t){this.initializeConfig(t)}initializeInventories(){this.inventories.clear();const t=this.config?.inventories||[];if(t.length===0){const e={id:"default",name:"Default",description:"Default inventory",type:"static",organization:this.config?.organizationName||"Default",hosts:[],groups:[]};this.inventories.set("default",e);return}for(const e of t){const s={id:e.id,name:e.name,description:e.description,type:e.type||"static",organization:this.config?.organizationName||"Default",hosts:(e.hosts||[]).map((n,i)=>({id:n.id||`host-${e.id}-${i}`,name:n.name,enabled:!0,groups:n.groups||[],variables:n.variables||{}})),groups:(e.groups||[]).map((n,i)=>({id:n.id||`group-${e.id}-${i}`,name:n.name,hosts:n.hosts||[],variables:n.variables||{},children:n.children||[]}))};this.inventories.set(s.id,s)}}initializeProjects(){this.projects.clear();const t=this.config?.projects||[];if(t.length===0){const e={id:"default",name:"Default",description:"Default project",organization:this.config?.organizationName||"Default",scmType:"manual",playbooks:["playbook.yml"]};this.projects.set("default",e);return}for(const e of t){const s={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",scmType:e.scmType||"manual",scmUrl:e.scmUrl,scmBranch:e.scmBranch||"main",playbooks:e.playbooks||["playbook.yml"],status:"successful",lastUpdateTime:Date.now()-Math.random()*864e5};this.projects.set(s.id,s)}}initializeCredentials(){this.credentials.clear();const t=this.config?.credentials||[];for(const e of t){const s={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",credentialType:e.credentialType||"machine",username:e.username,password:e.password,sshKey:e.sshKey,becomeMethod:e.becomeMethod,becomeUsername:e.becomeUsername};this.credentials.set(s.id,s)}}initializeJobTemplates(){this.jobTemplates.clear();const t=this.config?.jobTemplates||[];for(const e of t){const s={id:e.id,name:e.name,description:e.description,organization:this.config?.organizationName||"Default",inventory:e.inventory,project:e.project,playbook:e.playbook,credential:e.credential,enabled:e.enabled!==!1,jobType:e.jobType||"run",becomeEnabled:e.becomeEnabled,becomeUser:e.becomeUser,forks:e.forks||this.config?.maxForks||5,timeout:e.timeout||this.config?.defaultTimeout||3600,verbosity:e.verbosity||0};this.jobTemplates.set(s.id,s)}}initializeJobs(){const t=new Set(Array.from(this.activeJobs.keys())),e=new Set((this.config?.jobs||[]).map(n=>n.id));for(const[n,i]of this.jobHistory.entries())!t.has(n)&&!e.has(n)&&this.jobHistory.delete(n);const s=this.config?.jobs||[];for(const n of s){const i={id:n.id,name:n.name||`Job ${n.id}`,type:n.type||"job",status:n.status||"successful",jobTemplate:n.jobTemplate,created:n.startedAt?new Date(n.startedAt).getTime():Date.now()-36e5,started:n.startedAt?new Date(n.startedAt).getTime():void 0,finished:n.finishedAt?new Date(n.finishedAt).getTime():void 0,elapsed:n.duration,hosts:n.hosts?.map((o,r)=>({id:`host-${n.id}-${r}`,name:o.name,status:o.status,failed:o.status==="failed"||o.status==="unreachable",changed:o.status==="changed",unreachable:o.status==="unreachable",skipped:o.status==="skipped"}))};["new","pending","waiting","running"].includes(i.status)?this.activeJobs.set(i.id,i):this.jobHistory.set(i.id,i)}}initializeSchedules(){this.schedules.clear();const t=this.config?.schedules||[];for(const e of t){const s={id:e.id,name:e.name,unifiedJobTemplate:e.unifiedJobTemplate,enabled:e.enabled!==!1,rrule:e.rrule||`DTSTART:20240101T000000Z
RRULE:FREQ=HOURLY;INTERVAL=1`,nextRun:Date.now()+36e5};this.schedules.set(s.id,s),this.scheduleNextRuns.set(s.id,s.nextRun||Date.now()+36e5)}}performUpdate(t){this.config&&(this.updateActiveJobs(t),this.triggerScheduledJobs(t),this.triggerAutomaticJobs(t),this.updateMetrics())}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[s,n]of e){if(!["new","pending","waiting","running"].includes(n.status)){if(this.jobHistory.set(s,n),this.jobHistory.size>this.MAX_JOB_HISTORY){const p=this.jobHistory.keys().next().value;p&&this.jobHistory.delete(p)}this.activeJobs.delete(s);continue}if(!n.started){n.started=t,n.status="running";continue}const i=(t-n.started)/1e3,o=this.config?.averageJobDuration||12e4,r=this.config?.playbookComplexity||.5,h=o*(1+r*.5)*(1+(Math.random()-.5)*.3)/1e3;if(i>=h){if(Math.random()<(this.config?.failureRate||.05)?n.status="failed":n.status="successful",n.finished=t,n.elapsed=i,n.hosts&&n.hosts.length>0){const g=this.config?.hostFailureRate||.02;for(const v of n.hosts)n.status==="failed"?Math.random()<g*2?(v.status=Math.random()<.5?"failed":"unreachable",v.failed=!0):Math.random()<.3?(v.status="changed",v.changed=!0):v.status="ok":Math.random()<g?(v.status="unreachable",v.unreachable=!0):Math.random()<.4?(v.status="changed",v.changed=!0):v.status="ok"}n.hosts&&(n.resultSummary={ok:n.hosts.filter(g=>g.status==="ok").length,changed:n.hosts.filter(g=>g.status==="changed").length,unreachable:n.hosts.filter(g=>g.status==="unreachable").length,failed:n.hosts.filter(g=>g.status==="failed").length,skipped:n.hosts.filter(g=>g.status==="skipped").length}),this.jobHistoryList.push({timestamp:t,duration:i,status:n.status}),this.jobHistoryList.length>this.MAX_JOB_HISTORY_LIST&&this.jobHistoryList.shift()}else if(n.elapsed=i,n.hosts){const p=i/h;for(let g=0;g<n.hosts.length;g++)p+(Math.random()-.5)*.2>=.9&&n.hosts[g].status==="ok"&&Math.random()<.3&&(n.hosts[g].status="changed",n.hosts[g].changed=!0)}}}triggerScheduledJobs(t){for(const[e,s]of this.schedules.entries()){if(!s.enabled)continue;const n=this.scheduleNextRuns.get(e);if(!n||t<n)continue;const i=this.jobTemplates.get(s.unifiedJobTemplate);if(!i||!i.enabled)continue;this.launchJobFromTemplate(i.id,s.extraData||{});const o=t+36e5;this.scheduleNextRuns.set(e,o),s.nextRun=o,s.lastRun=t}}triggerAutomaticJobs(t){if(!this.config)return;const s=36e5/(this.config.jobTriggerRate||.5);for(const[n,i]of this.jobTemplates.entries()){if(!i.enabled)continue;const o=this.lastJobTime.get(n)||0;t-o>=s&&Math.random()<.1&&(this.launchJobFromTemplate(n),this.lastJobTime.set(n,t))}}launchJobFromTemplate(t,e){const s=this.jobTemplates.get(t);if(!s||!s.enabled)return null;const n=this.inventories.get(s.inventory);if(!n)return null;const i=this.projects.get(s.project);if(!i)return null;const o=`job-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=n.hosts||[],u={id:o,name:`${s.name} - ${new Date().toISOString()}`,type:"job",status:"pending",jobTemplate:t,jobTemplateName:s.name,inventory:s.inventory,inventoryName:n.name,project:s.project,projectName:i.name,playbook:s.playbook,credential:s.credential,vaultCredential:s.vaultCredential,organization:s.organization,created:Date.now(),jobType:s.jobType,becomeEnabled:s.becomeEnabled,forks:s.forks||this.config?.maxForks||5,limit:s.limit||e?.limit,verbosity:s.verbosity||0,extraVars:s.extraVars||e?.extraVars,jobTags:s.jobTags||e?.jobTags,skipTags:s.skipTags||e?.skipTags,timeout:s.timeout||this.config?.defaultTimeout||3600,hosts:r.map((d,h)=>({id:d.id,name:d.name,status:"ok",failed:!1,changed:!1,unreachable:!1,skipped:!1}))};return this.activeJobs.set(o,u),s.lastJobRun=o,s.lastJobStatus="running",s.lastJobStarted=Date.now(),u}updateMetrics(){this.ansibleMetrics.inventoriesTotal=this.inventories.size,this.ansibleMetrics.projectsTotal=this.projects.size,this.ansibleMetrics.credentialsTotal=this.credentials.size,this.ansibleMetrics.jobTemplatesTotal=this.jobTemplates.size,this.ansibleMetrics.jobTemplatesEnabled=Array.from(this.jobTemplates.values()).filter(d=>d.enabled).length;const t=[...this.activeJobs.values(),...this.jobHistory.values()];this.ansibleMetrics.jobsTotal=t.length,this.ansibleMetrics.jobsSuccess=t.filter(d=>d.status==="successful").length,this.ansibleMetrics.jobsFailed=t.filter(d=>d.status==="failed"||d.status==="error").length,this.ansibleMetrics.jobsRunning=this.activeJobs.size,this.ansibleMetrics.jobsPending=Array.from(this.activeJobs.values()).filter(d=>d.status==="pending"||d.status==="waiting").length;const e=Date.now()-36e5,s=this.jobHistoryList.filter(d=>d.timestamp>=e);if(this.ansibleMetrics.jobsPerHour=s.length,this.jobHistoryList.length>0){const d=this.jobHistoryList.reduce((h,p)=>h+p.duration,0);this.ansibleMetrics.averageJobDuration=d/this.jobHistoryList.length}else this.ansibleMetrics.averageJobDuration=0;let n=0,i=0,o=0,r=0,u=0;for(const d of this.inventories.values())n+=d.hosts?.length||0;for(const d of this.activeJobs.values())if(d.hosts)for(const h of d.hosts)h.status==="ok"&&i++,h.status==="changed"&&o++,h.status==="failed"&&r++,h.status==="unreachable"&&u++;this.ansibleMetrics.hostsTotal=n,this.ansibleMetrics.hostsOk=i,this.ansibleMetrics.hostsChanged=o,this.ansibleMetrics.hostsFailed=r,this.ansibleMetrics.hostsUnreachable=u,this.ansibleMetrics.schedulesTotal=this.schedules.size,this.ansibleMetrics.schedulesEnabled=Array.from(this.schedules.values()).filter(d=>d.enabled).length}getMetrics(){return{...this.ansibleMetrics}}getInventories(){return Array.from(this.inventories.values())}getProjects(){return Array.from(this.projects.values())}getCredentials(){return Array.from(this.credentials.values())}getJobTemplates(){return Array.from(this.jobTemplates.values())}getActiveJobs(){return Array.from(this.activeJobs.values())}getAllJobs(){return[...Array.from(this.activeJobs.values()),...Array.from(this.jobHistory.values())]}getJob(t){return this.activeJobs.get(t)||this.jobHistory.get(t)}getSchedules(){return Array.from(this.schedules.values())}getJobLogs(t){const e=this.getJob(t);if(!e)return[];const s=[];if(s.push(`Starting job ${e.name} (ID: ${e.id})`),s.push(`Job Template: ${e.jobTemplateName||"N/A"}`),s.push(`Inventory: ${e.inventoryName||"N/A"}`),s.push(`Playbook: ${e.playbook||"N/A"}`),e.hosts){s.push(`
Running on ${e.hosts.length} host(s)...`);for(const n of e.hosts)s.push(`
${n.name}:`),n.status==="ok"?s.push("  OK - Task completed successfully"):n.status==="changed"?s.push("  CHANGED - Task made changes to the system"):n.status==="failed"?s.push("  FAILED - Task failed to execute"):n.status==="unreachable"?s.push("  UNREACHABLE - Host is unreachable"):n.status==="skipped"&&s.push("  SKIPPED - Task was skipped")}return e.resultSummary&&(s.push(`
PLAY RECAP`),s.push(`ok: ${e.resultSummary.ok}, changed: ${e.resultSummary.changed}, unreachable: ${e.resultSummary.unreachable}, failed: ${e.resultSummary.failed}, skipped: ${e.resultSummary.skipped}`)),e.status==="successful"?s.push(`
Job completed successfully in ${e.elapsed?.toFixed(2)}s`):e.status==="failed"&&s.push(`
Job failed after ${e.elapsed?.toFixed(2)}s`),s}cancelJob(t){const e=this.activeJobs.get(t);return!e||!["pending","waiting","running"].includes(e.status)?!1:(e.status="canceled",e.canceled=!0,e.canceledBy="user",e.finished=Date.now(),e.started&&(e.elapsed=(Date.now()-e.started)/1e3),this.jobHistory.set(t,e),this.activeJobs.delete(t),!0)}}class Bk{routers=new Map;services=new Map;middlewares=new Map;entryPoints=new Map;globalConfig={};roundRobinCounters=new Map;connectionCounts=new Map;serverHealthStatus=new Map;serverCheckFailures=new Map;serverCheckSuccesses=new Map;healthCheckTimers=new Map;rateLimitTracker=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;totalLatency=0;latencyCount=0;initialize(t){this.routers.clear(),this.services.clear(),this.middlewares.clear(),this.entryPoints.clear(),this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.serverHealthStatus.clear(),this.serverCheckFailures.clear(),this.serverCheckSuccesses.clear(),this.rateLimitTracker.clear(),this.globalConfig=t.globalConfig||{};for(const e of this.healthCheckTimers.values())clearInterval(e);if(this.healthCheckTimers.clear(),t.entryPoints)for(const e of t.entryPoints)this.entryPoints.set(e.name,e);else this.entryPoints.set("web",{name:"web",address:":80"}),this.entryPoints.set("websecure",{name:"websecure",address:":443"});if(t.routers)for(const e of t.routers)this.routers.set(e.name,{...e,priority:e.priority||0,requests:e.requests||0,responses:e.responses||0,errors:e.errors||0,bytesIn:e.bytesIn||0,bytesOut:e.bytesOut||0});if(t.services){for(const e of t.services)if(this.services.set(e.name,e),this.roundRobinCounters.set(e.name,0),e.loadBalancer?.healthCheck?.enabled&&e.loadBalancer.servers)for(const s of e.loadBalancer.servers)this.startHealthCheck(e.name,s.url,e.loadBalancer.healthCheck)}if(t.middlewares)for(const e of t.middlewares)this.middlewares.set(e.name,e);this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.latencyCount=0}routeRequest(t){const e=Date.now();this.requestCount++;const s=this.globalConfig.maxConnections||1e4;if(this.activeConnections>=s)return this.connectionRejects++,this.errorCount++,{router:null,service:null,response:{status:503,error:"Max connections exceeded",latency:Date.now()-e}};this.activeConnections++;const n=this.findMatchingRouter(t);if(!n)return this.activeConnections--,this.errorCount++,{router:null,service:null,response:{status:404,error:"No matching router found",latency:Date.now()-e}};n.requests=(n.requests||0)+1;let i={...t};const o=[];if(n.middlewares&&n.middlewares.length>0)for(const C of n.middlewares){const k=this.middlewares.get(C);if(k){const T=this.applyMiddleware(k,i);if(T.block)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:null,response:{status:T.status||403,error:T.error||"Middleware blocked request",latency:Date.now()-e,routerMatched:n.name},middlewaresApplied:o};T.request&&(i=T.request),o.push(C)}}const r=this.services.get(n.service);if(!r)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:null,response:{status:503,error:`Service ${n.service} not found`,latency:Date.now()-e,routerMatched:n.name},middlewaresApplied:o};const u=this.selectServer(r,i);if(!u)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:r,response:{status:503,error:"No healthy server available",latency:Date.now()-e,routerMatched:n.name},middlewaresApplied:o};const d=5+Math.random()*95,h=n.tls?.enabled?5+Math.random()*15:0,p=this.globalConfig.responseTimeout||3e4,g=d+h;if(g>p)return this.activeConnections--,this.errorCount++,n.errors=(n.errors||0)+1,{router:n,service:r,response:{status:504,error:"Response timeout",latency:p,serviceTarget:r.name,serverTarget:u,routerMatched:n.name},middlewaresApplied:o};const v={status:200,body:{proxied:!0,service:r.name,server:u},latency:g,serviceTarget:r.name,serverTarget:u,routerMatched:n.name},b=1024,x=2048;n.bytesIn=(n.bytesIn||0)+b,n.bytesOut=(n.bytesOut||0)+x,n.responses=(n.responses||0)+1,n.averageLatency=((n.averageLatency||0)*(n.responses-1)+g)/n.responses,r.totalRequests=(r.totalRequests||0)+1,r.totalResponses=(r.totalResponses||0)+1,this.totalBytesIn+=b,this.totalBytesOut+=x,this.responseCount++,this.activeConnections--,this.totalLatency+=g,this.latencyCount++;const R=this.connectionCounts.get(u)||0;return this.connectionCounts.set(u,R+1),{router:n,service:r,response:v,middlewaresApplied:o}}findMatchingRouter(t){let e=[];for(const s of this.routers.values())t.entryPoint&&!s.entryPoints.includes(t.entryPoint)||this.evaluateRule(s.rule,t)&&e.push(s);return e.sort((s,n)=>(n.priority||0)-(s.priority||0)),e.length>0?e[0]:null}evaluateRule(t,e){try{const s=t.split("&&").map(n=>n.trim());for(const n of s){if(n.startsWith("Host(")){const i=n.match(/Host\(`([^`]+)`\)/);if(i){const o=i[1],r=e.host||e.headers?.Host||"";if(r!==o&&!r.endsWith(`.${o}`))return!1}}if(n.startsWith("PathPrefix(")){const i=n.match(/PathPrefix\(`([^`]+)`\)/);if(i){const o=i[1];if(!e.path.startsWith(o))return!1}}if(n.startsWith("Path(")&&!n.startsWith("PathPrefix(")){const i=n.match(/Path\(`([^`]+)`\)/);if(i){const o=i[1];if(e.path!==o)return!1}}if(n.startsWith("Method(")){const i=n.match(/Method\(`([^`]+)`\)/);if(i){const o=i[1];if(e.method.toUpperCase()!==o.toUpperCase())return!1}}}return!0}catch(s){return console.warn("Failed to parse Traefik rule:",t,s),!0}}applyMiddleware(t,e){switch(t.type){case"rateLimit":return this.applyRateLimit(t,e);case"ipAllowList":case"ipWhiteList":return this.applyIPAllowList(t,e);case"auth":case"basicAuth":case"digestAuth":return this.applyAuth(t,e);case"headers":return this.applyHeaders(t,e);case"redirect":return this.applyRedirect(t,e);case"stripPrefix":return this.applyStripPrefix(t,e);case"addPrefix":return this.applyAddPrefix(t,e);default:return{block:!1,request:e}}}applyRateLimit(t,e){if(!t.config)return{block:!1};const s=t.config.average||100,n=t.config.burst||50,i=this.parsePeriod(t.config.period||"1s"),o=e.clientIP||"0.0.0.0",r=`${t.name}:${o}`,u=Date.now();let d=this.rateLimitTracker.get(r);return(!d||d.resetAt<u)&&(d={count:0,resetAt:u+i,burst:n},this.rateLimitTracker.set(r,d)),d.count>=s+n?{block:!0,status:429,error:"Rate limit exceeded"}:(d.count++,{block:!1})}applyIPAllowList(t,e){if(!t.config?.sourceRange)return{block:!1};const s=e.clientIP||"0.0.0.0";return t.config.sourceRange.some(i=>i.includes("/")?s.startsWith(i.split("/")[0]):s===i)?{block:!1}:{block:!0,status:403,error:"IP not allowed"}}applyAuth(t,e){return t.config?.headerField&&!e.headers?.[t.config.headerField]?{block:!0,status:401,error:"Authentication required"}:{block:!1}}applyHeaders(t,e){const s={...e};return s.headers||(s.headers={}),t.config?.customRequestHeaders&&Object.assign(s.headers,t.config.customRequestHeaders),{block:!1,request:s}}applyRedirect(t,e){return{block:!1}}applyStripPrefix(t,e){if(!t.config?.prefix)return{block:!1,request:e};const s={...e};return s.path.startsWith(t.config.prefix)&&(s.path=s.path.substring(t.config.prefix.length)),{block:!1,request:s}}applyAddPrefix(t,e){if(!t.config?.prefix)return{block:!1,request:e};const s={...e};return s.path=t.config.prefix+s.path,{block:!1,request:s}}selectServer(t,e){const n=(t.loadBalancer?.servers||[]).filter(o=>{const r=this.serverHealthStatus.get(o.url);return r==="healthy"||r===void 0});if(n.length===0)return null;switch(t.loadBalancer?.strategy||"roundRobin"){case"roundRobin":return this.selectRoundRobin(t.name,n);case"wrr":return this.selectWeightedRoundRobin(t.name,n);case"drr":return this.selectDynamicRoundRobin(t.name,n);default:return n[0]?.url||null}}selectRoundRobin(t,e){const s=this.roundRobinCounters.get(t)||0,n=e[s%e.length];return this.roundRobinCounters.set(t,(s+1)%e.length),n.url}selectWeightedRoundRobin(t,e){const s=e.reduce((o,r)=>o+(r.weight||1),0);let n=this.roundRobinCounters.get(t)||0,i=0;for(const o of e)if(i+=o.weight||1,n<i)return this.roundRobinCounters.set(t,(n+1)%s),o.url;return this.roundRobinCounters.set(t,(n+1)%s),e[0]?.url||""}selectDynamicRoundRobin(t,e){let s=1/0,n=e[0];for(const i of e){const r=(this.connectionCounts.get(i.url)||0)/(i.weight||1);r<s&&(s=r,n=i)}return n.url}startHealthCheck(t,e,s){const n=(s.interval||10)*1e3,i=`${t}:${e}`;this.serverHealthStatus.set(e,"checking");const o=async()=>{try{if(Math.random()>.1){this.serverHealthStatus.set(e,"healthy");const h=this.serverCheckSuccesses.get(e)||0;this.serverCheckSuccesses.set(e,h+1),this.serverCheckFailures.set(e,0)}else{const h=(this.serverCheckFailures.get(e)||0)+1;this.serverCheckFailures.set(e,h),h>=3&&this.serverHealthStatus.set(e,"unhealthy")}}catch{const d=(this.serverCheckFailures.get(e)||0)+1;this.serverCheckFailures.set(e,d),d>=3&&this.serverHealthStatus.set(e,"unhealthy")}};o();const r=setInterval(o,n);this.healthCheckTimers.set(i,r)}parsePeriod(t){const e=t.match(/^(\d+)([smh])$/);if(!e)return 1e3;const s=parseInt(e[1],10);switch(e[2]){case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;default:return 1e3}}getStats(){let t=0,e=0;for(const o of this.services.values()){const r=o.loadBalancer?.servers||[];t+=r.length;for(const u of r){const d=this.serverHealthStatus.get(u.url);(d==="healthy"||d===void 0)&&e++}}const s=Array.from(this.routers.values()).filter(o=>(o.requests||0)>0).length,n=this.latencyCount>0?this.totalLatency/this.latencyCount:0,i=this.requestCount>0?this.errorCount/this.requestCount:0;return{routers:this.routers.size,activeRouters:s,services:this.services.size,middlewares:this.middlewares.size,entryPoints:this.entryPoints.size,totalServers:t,healthyServers:e,totalRequests:this.requestCount,totalResponses:this.responseCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:i,averageLatency:n}}getRouter(t){return this.routers.get(t)}getService(t){return this.services.get(t)}getMiddleware(t){return this.middlewares.get(t)}resetStats(){this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.latencyCount=0;for(const t of this.routers.values())t.requests=0,t.responses=0,t.errors=0,t.bytesIn=0,t.bytesOut=0,t.averageLatency=0;for(const t of this.services.values())t.totalRequests=0,t.totalResponses=0,t.activeConnections=0}connectionRejects=0}class Uk{config=null;routingEngine;metrics={requestsTotal:0,responsesTotal:0,errorsTotal:0,activeRouters:0,totalRouters:0,totalServices:0,totalMiddlewares:0,totalServers:0,healthyServers:0,activeConnections:0,totalBytesIn:0,totalBytesOut:0,averageLatency:0,errorRate:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new Bk}initializeConfig(t){const e=t.data.config||{},s=Array.isArray(e.routers)?e.routers.map(r=>({id:r.id||r.name,name:r.name,rule:r.rule||`Host(\`${r.name||"example.com"}\`)`,service:r.service,entryPoints:Array.isArray(r.entryPoints)?r.entryPoints:["web"],middlewares:Array.isArray(r.middlewares)?r.middlewares:[],tls:r.tls?{enabled:r.tls===!0||r.tls.enabled===!0}:void 0,priority:r.priority||0,requests:r.requests||0,responses:r.responses||0,errors:r.errors||0})):[],n=Array.isArray(e.services)?e.services.map(r=>({id:r.id||r.name,name:r.name,loadBalancer:{servers:Array.isArray(r.servers)?r.servers.map(u=>({url:u.url||u.address||"http://localhost:8080",weight:u.weight||1})):r.url?[{url:r.url,weight:1}]:[],strategy:r.loadBalancer||"roundRobin",healthCheck:r.healthCheck?.enabled?{enabled:!0,path:r.healthCheck.path||"/health",interval:r.healthCheck.interval||10,timeout:r.healthCheck.timeout||5}:void 0},totalRequests:r.totalRequests||0,totalResponses:r.totalResponses||0})):[],i=Array.isArray(e.middlewares)?e.middlewares.map(r=>({id:r.id||r.name,name:r.name,type:r.type||"headers",config:r.config||{}})):[],o=Array.isArray(e.entryPoints)?e.entryPoints.map(r=>typeof r=="string"?{name:r,address:r.includes(":")?r:`:${r==="web"?"80":r==="websecure"?"443":"80"}`}:r):[{name:"web",address:":80"},{name:"websecure",address:":443"}];this.config={routers:s,services:n,middlewares:i,entryPoints:o,enableDashboard:e.enableDashboard??!0,enableAPI:e.enableAPI??!0,autoDiscoverServices:e.autoDiscoverServices??!0,maxConnections:e.maxConnections||1e4,idleTimeout:e.idleTimeout||18e4,responseTimeout:e.responseTimeout||3e4},this.routingEngine.initialize({routers:s,services:n,middlewares:i,entryPoints:o,globalConfig:{maxConnections:this.config.maxConnections,idleTimeout:this.config.idleTimeout,responseTimeout:this.config.responseTimeout}}),this.updateMetricsFromStats()}processRequest(t){const e=performance.now(),s={path:t.path||"/",method:t.method||"GET",headers:t.headers,query:t.query,body:t.body,clientIP:t.clientIP||this.generateRandomIP(),protocol:t.protocol||"http",host:t.host||t.headers?.Host||"localhost",entryPoint:t.entryPoint||"web"},n=this.routingEngine.routeRequest(s),i=performance.now()-e+(n.response.latency||0);this.recordLatency(i);const o=Date.now();return this.firstRequestTime||(this.firstRequestTime=o),this.lastRequestTime=o,this.updateMetricsFromStats(),{success:n.response.status>=200&&n.response.status<400,latency:i,status:n.response.status,serviceTarget:n.response.serviceTarget,serverTarget:n.response.serverTarget,routerMatched:n.response.routerMatched,error:n.response.error}}updateMetricsFromStats(){const t=this.routingEngine.getStats();this.metrics.requestsTotal=t.totalRequests,this.metrics.responsesTotal=t.totalResponses,this.metrics.activeRouters=t.activeRouters,this.metrics.totalRouters=t.routers,this.metrics.totalServices=t.services,this.metrics.totalMiddlewares=t.middlewares,this.metrics.totalServers=t.totalServers,this.metrics.healthyServers=t.healthyServers,this.metrics.activeConnections=t.activeConnections,this.metrics.totalBytesIn=t.totalBytesIn,this.metrics.totalBytesOut=t.totalBytesOut,this.metrics.averageLatency=t.averageLatency,this.metrics.errorRate=t.errorRate,this.metrics.errorsTotal=Math.floor(t.totalRequests*t.errorRate)}getMetrics(){return{...this.metrics}}getStats(){return this.routingEngine.getStats()}getLoad(){const t=this.getStats(),e=this.config?.maxConnections||1e4;let s=this.simulatedRequestRate;if(this.firstRequestTime&&this.lastRequestTime){const i=(this.lastRequestTime-this.firstRequestTime)/1e3;i>0&&(s=t.totalRequests/i)}s===0&&this.simulatedRequestRate>0&&(s=this.simulatedRequestRate);const n=e>0?Math.min(1,t.activeConnections/e):0;return{requestsPerSecond:s,averageLatency:t.averageLatency||0,errorRate:t.errorRate||0,utilization:n}}simulateRequests(t){this.simulatedRequestRate=t;const e=Date.now(),s=(e-this.lastSimulationTime)/1e3;if(this.lastSimulationTime=e,t<=0||s<=0)return;const n=Math.floor(t*s);for(let i=0;i<n;i++){const o=this.generateRandomPath(),r=["GET","POST","PUT","DELETE"][Math.floor(Math.random()*4)];this.processRequest({path:o,method:r,headers:{Host:"example.com","User-Agent":"Mozilla/5.0"},clientIP:this.generateRandomIP(),protocol:Math.random()>.5?"https":"http",host:"example.com",entryPoint:Math.random()>.5?"websecure":"web"})}}recordLatency(t){this.latencyHistory.push(t),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomPath(){const t=["/","/api","/api/users","/api/products","/health","/status","/docs"];return t[Math.floor(Math.random()*t.length)]}updateConfig(t){this.initializeConfig(t)}resetStats(){this.routingEngine.resetStats(),this.firstRequestTime=null,this.lastRequestTime=null,this.latencyHistory=[],this.updateMetricsFromStats()}}class Fk{config=null;jobs=new Map;activeJobs=new Map;MAX_JOB_HISTORY=1e3;stages=new Map;activeStages=new Map;MAX_STAGE_HISTORY=5e3;executors=new Map;sqlQueries=new Map;activeSqlQueries=new Map;MAX_SQL_QUERY_HISTORY=1e3;streamingJobs=new Map;activeStreamingJobs=new Map;MAX_STREAMING_JOB_HISTORY=100;lastStreamingCheckpoint=0;CHECKPOINT_INTERVAL=6e4;sparkMetrics={totalJobs:0,activeJobs:0,succeededJobs:0,failedJobs:0,totalStages:0,activeStages:0,totalExecutors:0,aliveExecutors:0,totalCores:0,totalMemory:0,totalMemoryUsed:0,totalInputBytes:0,totalOutputBytes:0,totalShuffleRead:0,totalShuffleWrite:0,totalShuffleNetworkRead:0,totalShuffleNetworkWrite:0,totalShuffleSpillMemory:0,totalShuffleSpillDisk:0,jobsPerHour:0,averageJobDuration:0,throughput:0,requestsTotal:0,requestsErrors:0,gcPauseTime:0,gcFrequency:0,memoryBeforeGC:0,memoryAfterGC:0,totalNetworkIO:0,networkUtilization:0,networkErrors:0,diskIORate:0,diskUtilization:0,diskErrors:0,heapUsage:0,nonHeapUsage:0,threadCount:0};gcHistory=[];MAX_GC_HISTORY=100;lastNetworkUpdate=Date.now();lastDiskUpdate=Date.now();jobHistoryList=[];MAX_JOB_HISTORY_LIST=1e3;lastJobCreation=0;executorHeartbeatInterval=new Map;processRequest(t=!0){this.sparkMetrics.requestsTotal++,t||this.sparkMetrics.requestsErrors++}initializeConfig(t){const e=t.data.config||{};this.config={master:e.master||e.sparkMaster||"local[*]",appName:e.appName||e.sparkAppName||"archiphoenix-spark",driverMemory:e.driverMemory||"2g",executorMemory:e.executorMemory||"4g",executorCores:e.executorCores||2,enableDynamicAllocation:e.enableDynamicAllocation??!0,minExecutors:e.minExecutors||1,maxExecutors:e.maxExecutors||10,enableCheckpointing:e.enableCheckpointing??!0,checkpointDirectory:e.checkpointDirectory||"/checkpoint",enableStreaming:e.enableStreaming??!1,streamingBatchInterval:e.streamingBatchInterval||1e3,jobs:e.jobs||[],stages:e.stages||[],executors:e.executors||[],jobCreationRate:e.jobCreationRate||2,averageJobDuration:e.averageJobDuration||3e5,failureRate:e.failureRate??.05,dataProcessingRate:e.dataProcessingRate||104857600,shuffleIntensity:e.shuffleIntensity??.3,executorFailureRate:e.executorFailureRate??.01,durationVariation:e.durationVariation??.3},this.initializeExecutors(),this.initializeJobs(),this.initializeStages(),this.config.enableStreaming&&this.initializeStreamingJob(Date.now())}updateConfig(t){this.initializeConfig(t)}initializeExecutors(){const t=this.config?.executors||[],e=this.config?.minExecutors||1,s=this.config?.maxExecutors||10,n=this.parseMemory(this.config?.executorMemory||"4g"),i=this.config?.executorCores||2,o=new Set(t.map(r=>r.id));for(const[r,u]of this.executors.entries())!o.has(r)&&u.status==="DEAD"&&this.executors.delete(r);if(t.length===0){const r=Math.max(e,Math.min(3,s));for(let u=0;u<r;u++){const d={id:`executor-${u}`,host:`host-${u}.example.com`,status:"ALIVE",cores:i,memoryUsed:n*.3,memoryMax:n,diskUsed:n*.2,diskMax:n*2,activeTasks:0,totalTasks:0,totalInputBytes:0,totalShuffleRead:0,totalShuffleWrite:0,startTime:Date.now()-Math.random()*36e5,lastHeartbeat:Date.now()};this.executors.set(d.id,d),this.executorHeartbeatInterval.set(d.id,3e3+Math.random()*2e3)}return}for(const r of t){const u=this.executors.get(r.id),d=this.parseMemory(this.config?.executorMemory||"4g"),h={id:r.id,host:r.host||`host-${r.id}.example.com`,status:r.status||u?.status||"ALIVE",cores:r.cores||i,memoryUsed:u?.memoryUsed||d*.3,memoryMax:r.memoryMax||d,diskUsed:u?.diskUsed||d*.2,diskMax:r.diskMax||d*2,activeTasks:u?.activeTasks||0,totalTasks:u?.totalTasks||0,totalInputBytes:u?.totalInputBytes||0,totalShuffleRead:u?.totalShuffleRead||0,totalShuffleWrite:u?.totalShuffleWrite||0,startTime:u?.startTime||Date.now()-Math.random()*36e5,lastHeartbeat:Date.now()};this.executors.set(h.id,h),this.executorHeartbeatInterval.has(h.id)||this.executorHeartbeatInterval.set(h.id,3e3+Math.random()*2e3)}}initializeJobs(){const t=new Set(Array.from(this.activeJobs.keys())),e=new Set((this.config?.jobs||[]).map(n=>n.id));for(const[n,i]of this.jobs.entries())!t.has(n)&&!e.has(n)&&this.jobs.delete(n);const s=this.config?.jobs||[];for(const n of s){const i=this.jobs.get(n.id),o={id:n.id,name:n.name,status:n.status||i?.status||"SUCCEEDED",startTime:n.startTime?new Date(n.startTime).getTime():i?.startTime||Date.now()-36e5,stages:n.stages||i?.stages||3,tasks:n.tasks||i?.tasks||100,executors:i?.executors||this.executors.size,inputBytes:i?.inputBytes||0,outputBytes:i?.outputBytes||0,shuffleRead:i?.shuffleRead||0,shuffleWrite:i?.shuffleWrite||0};o.status==="RUNNING"&&this.activeJobs.set(o.id,o),this.jobs.set(o.id,o)}}initializeStages(){const t=new Set(Array.from(this.activeStages.keys())),e=new Set((this.config?.stages||[]).map(n=>n.id));for(const[n,i]of this.stages.entries())!t.has(n)&&!e.has(n)&&this.stages.delete(n);const s=this.config?.stages||[];for(const n of s){const i=this.stages.get(n.id);if(!this.jobs.get(n.jobId))continue;const r={id:n.id,jobId:n.jobId,name:n.name,status:n.status||i?.status||"COMPLETE",numTasks:n.numTasks||i?.numTasks||10,numActiveTasks:i?.numActiveTasks||0,numCompleteTasks:i?.numCompleteTasks||(n.status==="COMPLETE"?n.numTasks||10:0),numFailedTasks:i?.numFailedTasks||0,inputBytes:i?.inputBytes||0,outputBytes:i?.outputBytes||0,shuffleRead:i?.shuffleRead||0,shuffleWrite:i?.shuffleWrite||0,duration:i?.duration||0};r.status==="ACTIVE"&&this.activeStages.set(r.id,r),this.stages.set(r.id,r)}}performUpdate(t){if(this.config){this.updateActiveJobs(t),this.updateActiveStages(t),this.updateExecutors(t);for(const[e,s]of this.activeSqlQueries.entries())this.updateSQLQuery(e,t);this.config.enableStreaming&&this.updateStreamingJobs(t),this.triggerNewJobs(t),this.updateMetrics()}}updateActiveJobs(t){const e=Array.from(this.activeJobs.entries());for(const[s,n]of e){if(n.status!=="RUNNING"){if(this.jobs.size>this.MAX_JOB_HISTORY){const v=this.jobs.keys().next().value;v&&!this.activeJobs.has(v)&&this.jobs.delete(v)}this.activeJobs.delete(s);continue}if(!n.submissionTime){n.submissionTime=n.startTime;continue}const i=t-n.startTime,o=this.config?.averageJobDuration||3e5,r=this.config?.durationVariation||.3,u=o*r*(Math.random()*2-1),d=o+u,h=this.config?.dataProcessingRate||104857600,p=this.config?.shuffleIntensity||.3;if(n.inputBytes===0){const v=h*(d/1e3)*.5;n.inputBytes=v,n.outputBytes=v*.8,n.shuffleRead=v*p,n.shuffleWrite=v*p}else{const v=Math.min(1,i/d);n.inputBytes=n.inputBytes*(.5+v*.5),n.outputBytes=n.inputBytes*.8*v,n.shuffleRead=n.inputBytes*p*v,n.shuffleWrite=n.inputBytes*p*v}const g=Array.from(this.stages.values()).filter(v=>v.jobId===s);if(n.stages=g.length,n.tasks=g.reduce((v,b)=>v+b.numTasks,0),n.executors=this.executors.size,i>=d){const v=this.config?.failureRate??.05;if(Math.random()<v)n.status="FAILED",n.endTime=t,n.completionTime=t,n.duration=i;else{n.status="SUCCEEDED",n.endTime=t,n.completionTime=t,n.duration=i;const x=h*(d/1e3);n.inputBytes=x,n.outputBytes=x*.8,n.shuffleRead=x*p,n.shuffleWrite=x*p}this.jobHistoryList.push({timestamp:t,duration:i,status:n.status}),this.jobHistoryList.length>this.MAX_JOB_HISTORY_LIST&&this.jobHistoryList.shift()}}}updateActiveStages(t){const e=Array.from(this.activeStages.entries()),s=[];for(const[i,o]of e){if(o.status!=="ACTIVE"){this.activeStages.delete(i);continue}if(!o.submissionTime){o.submissionTime=t;continue}const r=this.jobs.get(o.jobId);if(!r||r.status!=="RUNNING"){o.status="COMPLETE",o.completionTime=t,o.duration=t-(o.submissionTime||t),o.numActiveTasks=0,o.numCompleteTasks=o.numTasks,s.push(i);continue}const u=t-(o.submissionTime||t),d=(this.config?.averageJobDuration||3e5)/(r.stages||3),h=this.config?.durationVariation||.3,p=d*h*(Math.random()*2-1),g=d+p,v=Math.min(1,u/g);o.numCompleteTasks=Math.floor(o.numTasks*v),o.numActiveTasks=Math.max(0,o.numTasks-o.numCompleteTasks-o.numFailedTasks);const b=Math.min(1,u/g);if(this.config?.shuffleIntensity,o.inputBytes=r.inputBytes/(r.stages||3)*b,o.outputBytes=r.outputBytes/(r.stages||3)*b,o.shuffleRead=r.shuffleRead/(r.stages||3)*b,o.shuffleWrite=r.shuffleWrite/(r.stages||3)*b,o.stageType==="shuffle"||o.parentStageIds&&o.parentStageIds.length>0){const x=this.executors.size,R=100*1024*1024;o.shuffleNetworkRead=o.shuffleRead*.7*b,o.shuffleNetworkWrite=o.shuffleWrite*.7*b;const C=Math.min(1,this.sparkMetrics.totalMemoryUsed/this.sparkMetrics.totalMemory||.5),k=.8;if(C>k){const D=(C-k)/(1-k);o.shuffleSpillMemory=o.shuffleWrite*.3*D*b,o.shuffleSpillDisk=o.shuffleRead*.2*D*b}else o.shuffleSpillMemory=0,o.shuffleSpillDisk=0;const T=10,A=Math.min(1,(o.shuffleNetworkRead||0)/(R*x));o.shuffleFetchWaitTime=T+A*50}else o.shuffleNetworkRead=0,o.shuffleNetworkWrite=0,o.shuffleSpillMemory=0,o.shuffleSpillDisk=0,o.shuffleFetchWaitTime=0;if(u>=g||o.numCompleteTasks>=o.numTasks){if(o.status="COMPLETE",o.completionTime=t,o.duration=u,o.numActiveTasks=0,o.numCompleteTasks=o.numTasks,o.inputBytes=r.inputBytes/(r.stages||3),o.outputBytes=r.outputBytes/(r.stages||3),o.shuffleRead=r.shuffleRead/(r.stages||3),o.shuffleWrite=r.shuffleWrite/(r.stages||3),o.stageType==="shuffle"||o.parentStageIds&&o.parentStageIds.length>0){this.executors.size;const x=Math.min(1,this.sparkMetrics.totalMemoryUsed/this.sparkMetrics.totalMemory||.5),R=.8;if(o.shuffleNetworkRead=o.shuffleRead*.7,o.shuffleNetworkWrite=o.shuffleWrite*.7,x>R){const C=(x-R)/(1-R);o.shuffleSpillMemory=o.shuffleWrite*.3*C,o.shuffleSpillDisk=o.shuffleRead*.2*C}else o.shuffleSpillMemory=0,o.shuffleSpillDisk=0}s.push(i)}}for(const i of s){const o=this.stages.get(i);if(!(!o||!o.childStageIds))for(const r of o.childStageIds){const u=this.stages.get(r);if(!u||u.status!=="SKIPPED")continue;(u.parentStageIds||[]).every(p=>{const g=this.stages.get(p);return g&&g.status==="COMPLETE"})&&(u.status="ACTIVE",u.submissionTime=t,u.numActiveTasks=u.numTasks,this.activeStages.set(r,u))}}const n=this.jobs.values().next().value;if(n&&n.rootStageIds)for(const i of n.rootStageIds){const o=this.stages.get(i);o&&o.status==="SKIPPED"&&(o.status="ACTIVE",o.submissionTime=t,o.numActiveTasks=o.numTasks,this.activeStages.set(i,o))}}updateExecutors(t){const e=this.config?.executorFailureRate??.01;for(const[s,n]of this.executors.entries()){if(n.status==="DEAD")continue;const i=this.executorHeartbeatInterval.get(s)||5e3;if(t-n.lastHeartbeat>i*3){n.status="DEAD",n.activeTasks=0;continue}if(Math.random()<e/3600){n.status="DEAD",n.activeTasks=0;continue}t-n.lastHeartbeat>=i&&(n.lastHeartbeat=t);const o=this.activeJobs.size,r=this.executors.size,u=o>0?Math.ceil(100/r):0;n.activeTasks=Math.min(u,n.cores*2),n.totalTasks+=n.activeTasks;const d=.3+n.activeTasks/(n.cores*2)*.5;n.memoryUsed=n.memoryMax*d;const p=.2+(this.config?.shuffleIntensity||.3)*.4;n.diskUsed=n.diskMax*p;const g=Array.from(this.activeJobs.values())[0];g&&(n.totalShuffleRead=g.shuffleRead/r||0,n.totalShuffleWrite=g.shuffleWrite/r||0,n.totalInputBytes=g.inputBytes/r||0)}if(this.config?.enableDynamicAllocation){const s=this.config.minExecutors||1,n=this.config.maxExecutors||10,i=this.activeJobs.size,o=Array.from(this.executors.values()).filter(r=>r.status==="ALIVE").length;if(i>0&&o<n){const r=`executor-${Date.now()}`,u=this.parseMemory(this.config.executorMemory||"4g"),d=this.config.executorCores||2,h={id:r,host:`host-${r}.example.com`,status:"ALIVE",cores:d,memoryUsed:u*.3,memoryMax:u,diskUsed:u*.2,diskMax:u*2,activeTasks:0,totalTasks:0,totalInputBytes:0,totalShuffleRead:0,totalShuffleWrite:0,startTime:t,lastHeartbeat:t};this.executors.set(r,h),this.executorHeartbeatInterval.set(r,3e3+Math.random()*2e3)}else if(i===0&&o>s){const r=Array.from(this.executors.entries()).filter(([u,d])=>d.status==="ALIVE");if(r.length>s){const[u,d]=r[r.length-1];d.status="DEAD"}}}}triggerNewJobs(t){if(!this.config)return;const e=this.config.jobCreationRate||2,s=t-this.lastJobCreation,n=36e5/e;s>=n&&this.activeJobs.size<5&&(this.createNewJob(t),this.lastJobCreation=t)}createNewJob(t){if(!this.config)return;const e=`job-${Date.now()}`,s=`Spark Job ${this.jobs.size+1}`,n=3+Math.floor(Math.random()*5),i=10+Math.floor(Math.random()*90),o=new Map,r=[],u=[];for(let h=0;h<n;h++)u.push(`stage-${e}-${h}`);for(let h=0;h<n;h++){const p=u[h],g=[];if(h===0)r.push(p);else if(h===1)g.push(u[0]);else if(h===2&&n>3)g.push(u[0]);else{const v=Math.max(0,h-1);g.push(u[v])}o.set(p,g)}const d={id:e,name:s,status:"RUNNING",startTime:t,stages:n,tasks:n*i,executors:this.executors.size,inputBytes:0,outputBytes:0,shuffleRead:0,shuffleWrite:0,submissionTime:t,stageDependencies:o,rootStageIds:r};this.jobs.set(e,d),this.activeJobs.set(e,d);for(let h=0;h<n;h++){const p=u[h],g=o.get(p)||[],v=r.includes(p);let b="map";h===0?b="map":h===n-1?b="action":g.length>0?b="shuffle":b="reduce";const x={id:p,jobId:e,name:`Stage ${h+1}`,status:v?"ACTIVE":"SKIPPED",numTasks:i,numActiveTasks:v?i:0,numCompleteTasks:0,numFailedTasks:0,inputBytes:0,outputBytes:0,shuffleRead:0,shuffleWrite:0,duration:0,submissionTime:v?t:void 0,parentStageIds:g,childStageIds:[],stageType:b,shuffleNetworkRead:0,shuffleNetworkWrite:0,shuffleSpillMemory:0,shuffleSpillDisk:0,shuffleFetchWaitTime:0};for(const R of g){const C=this.stages.get(R);C&&(C.childStageIds||(C.childStageIds=[]),C.childStageIds.push(p))}this.stages.set(p,x),x.status==="ACTIVE"&&this.activeStages.set(p,x)}for(let h=0;h<n;h++){const p=u[h],g=this.stages.get(p);if(!(!g||!g.parentStageIds))for(const v of g.parentStageIds){const b=this.stages.get(v);b&&(b.childStageIds||(b.childStageIds=[]),b.childStageIds.push(p))}}}updateMetrics(){const t=Array.from(this.jobs.values()),e=Array.from(this.activeJobs.values()),s=Array.from(this.stages.values()),n=Array.from(this.activeStages.values()),i=Array.from(this.executors.values()),o=i.filter(h=>h.status==="ALIVE");this.sparkMetrics.totalJobs=t.length,this.sparkMetrics.activeJobs=e.length,this.sparkMetrics.succeededJobs=t.filter(h=>h.status==="SUCCEEDED").length,this.sparkMetrics.failedJobs=t.filter(h=>h.status==="FAILED").length,this.sparkMetrics.totalStages=s.length,this.sparkMetrics.activeStages=n.length,this.sparkMetrics.totalExecutors=i.length,this.sparkMetrics.aliveExecutors=o.length,this.sparkMetrics.totalCores=o.reduce((h,p)=>h+p.cores,0),this.sparkMetrics.totalMemory=o.reduce((h,p)=>h+p.memoryMax,0)/1024,this.sparkMetrics.totalMemoryUsed=o.reduce((h,p)=>h+p.memoryUsed,0)/1024,this.sparkMetrics.totalInputBytes=t.reduce((h,p)=>h+p.inputBytes,0),this.sparkMetrics.totalOutputBytes=t.reduce((h,p)=>h+p.outputBytes,0),this.sparkMetrics.totalShuffleRead=t.reduce((h,p)=>h+p.shuffleRead,0),this.sparkMetrics.totalShuffleWrite=t.reduce((h,p)=>h+p.shuffleWrite,0),this.sparkMetrics.totalShuffleNetworkRead=s.reduce((h,p)=>h+(p.shuffleNetworkRead||0),0),this.sparkMetrics.totalShuffleNetworkWrite=s.reduce((h,p)=>h+(p.shuffleNetworkWrite||0),0),this.sparkMetrics.totalShuffleSpillMemory=s.reduce((h,p)=>h+(p.shuffleSpillMemory||0),0),this.sparkMetrics.totalShuffleSpillDisk=s.reduce((h,p)=>h+(p.shuffleSpillDisk||0),0);const r=this.sparkMetrics.totalInputBytes+this.sparkMetrics.totalOutputBytes;this.sparkMetrics.throughput=r/3600;const u=Date.now()-36e5,d=this.jobHistoryList.filter(h=>h.timestamp>=u);if(this.sparkMetrics.jobsPerHour=d.length,this.jobHistoryList.length>0){const h=this.jobHistoryList.reduce((p,g)=>p+g.duration,0);this.sparkMetrics.averageJobDuration=h/this.jobHistoryList.length}else this.sparkMetrics.averageJobDuration=this.config?.averageJobDuration||3e5;this.updateGCMetrics(),this.updateNetworkMetrics(),this.updateDiskMetrics(),this.updateJVMMetrics()}updateGCMetrics(){const t=Date.now(),e=this.sparkMetrics.totalMemoryUsed,s=e/this.sparkMetrics.totalMemory,n=Math.max(0,(s-.7)*.1);if(Math.random()<n&&this.sparkMetrics.totalMemory>0){const r=50+Math.random()*150,u=e,d=e*(.85+Math.random()*.1);this.gcHistory.push({timestamp:t,pauseTime:r,memoryBefore:u,memoryAfter:d}),this.gcHistory.length>this.MAX_GC_HISTORY&&this.gcHistory.shift()}const i=t-36e5,o=this.gcHistory.filter(r=>r.timestamp>=i);if(this.sparkMetrics.gcFrequency=o.length,this.sparkMetrics.gcPauseTime=o.reduce((r,u)=>r+u.pauseTime,0),o.length>0){const r=o[o.length-1];this.sparkMetrics.memoryBeforeGC=r.memoryBefore,this.sparkMetrics.memoryAfterGC=r.memoryAfter}else this.sparkMetrics.memoryBeforeGC=e,this.sparkMetrics.memoryAfterGC=e}updateNetworkMetrics(){const t=Date.now(),e=(t-this.lastNetworkUpdate)/1e3;this.lastNetworkUpdate=t,this.sparkMetrics.totalNetworkIO=this.sparkMetrics.totalShuffleNetworkRead+this.sparkMetrics.totalShuffleNetworkWrite;const s=this.sparkMetrics.aliveExecutors||1,i=100*1024*1024*s,o=this.sparkMetrics.totalNetworkIO/(e||1);this.sparkMetrics.networkUtilization=Math.min(100,o/i*100),this.sparkMetrics.networkUtilization>90&&Math.random()<.01&&(this.sparkMetrics.networkErrors+=1)}updateDiskMetrics(){const t=Date.now(),e=(t-this.lastDiskUpdate)/1e3;this.lastDiskUpdate=t;const s=this.sparkMetrics.totalShuffleSpillMemory+this.sparkMetrics.totalShuffleSpillDisk;this.sparkMetrics.diskIORate=s/(e||1);const n=Array.from(this.executors.values()),i=n.reduce((r,u)=>r+u.diskMax,0),o=n.reduce((r,u)=>r+u.diskUsed,0);i>0?this.sparkMetrics.diskUtilization=o/i*100:this.sparkMetrics.diskUtilization=0,this.sparkMetrics.diskUtilization>95&&Math.random()<.005&&(this.sparkMetrics.diskErrors+=1)}updateJVMMetrics(){this.sparkMetrics.heapUsage=this.sparkMetrics.totalMemoryUsed;const t=.15;this.sparkMetrics.nonHeapUsage=this.sparkMetrics.totalMemory*t;const e=10,s=this.sparkMetrics.aliveExecutors*2,n=this.sparkMetrics.activeJobs*5,i=this.sparkMetrics.activeStages*3;this.sparkMetrics.threadCount=e+s+n+i}parseMemory(t){const e=t.match(/^(\d+)([kmg]?)$/i);if(!e)return 4096;const s=parseInt(e[1],10);switch(e[2].toLowerCase()){case"k":return s/1024;case"m":return s;case"g":return s*1024;default:return s}}getMetrics(){return{...this.sparkMetrics}}getJobs(){return Array.from(this.jobs.values())}getStages(){return Array.from(this.stages.values())}getExecutors(){return Array.from(this.executors.values())}getJob(t){return this.jobs.get(t)}getStagesForJob(t){return Array.from(this.stages.values()).filter(e=>e.jobId===t)}getJobDAG(t){if(!this.jobs.get(t))return{stages:[],edges:[]};const s=this.getStagesForJob(t),n=[];for(const i of s)if(i.parentStageIds)for(const o of i.parentStageIds)n.push({from:o,to:i.id});return{stages:s,edges:n}}addJob(t){this.jobs.set(t.id,t),t.status==="RUNNING"&&this.activeJobs.set(t.id,t)}removeJob(t){this.jobs.delete(t),this.activeJobs.delete(t);const e=Array.from(this.stages.entries()).filter(([s,n])=>n.jobId===t);for(const[s,n]of e)this.stages.delete(s),this.activeStages.delete(s)}addExecutor(t){this.executors.set(t.id,t),this.executorHeartbeatInterval.set(t.id,3e3+Math.random()*2e3)}removeExecutor(t){const e=this.executors.get(t);e&&(e.status="DEAD"),this.executorHeartbeatInterval.delete(t)}executeSQL(t,e=Date.now()){const s=`sql-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n=this.generateLogicalPlan(t),i=this.generatePhysicalPlan(t),o=this.generateExplainPlan(t,n,i),r=this.estimateQueryRows(t),u=this.estimateQueryDuration(t,r),d=`job-${s}`,h={id:d,name:`SQL Query: ${t.substring(0,50)}...`,status:"RUNNING",startTime:e,stages:this.estimateQueryStages(t),tasks:this.estimateQueryTasks(t,r),executors:this.executors.size,inputBytes:r*1024,outputBytes:r*512,shuffleRead:r*256,shuffleWrite:r*256,submissionTime:e};this.jobs.set(d,h),this.activeJobs.set(d,h);const p=[];for(let v=0;v<h.stages;v++){const b=`stage-${d}-${v}`;p.push(b);const x={id:b,jobId:d,name:`SQL Stage ${v+1}`,status:v===0?"ACTIVE":"SKIPPED",numTasks:Math.floor(h.tasks/h.stages),numActiveTasks:v===0?Math.floor(h.tasks/h.stages):0,numCompleteTasks:0,numFailedTasks:0,inputBytes:h.inputBytes/h.stages,outputBytes:h.outputBytes/h.stages,shuffleRead:h.shuffleRead/h.stages,shuffleWrite:h.shuffleWrite/h.stages,duration:0,submissionTime:v===0?e:void 0,parentStageIds:v>0?[p[v-1]]:void 0,childStageIds:v<h.stages-1?[p[v+1]]:void 0,stageType:v===0?"map":v===h.stages-1?"action":"shuffle",shuffleNetworkRead:0,shuffleNetworkWrite:0,shuffleSpillMemory:0,shuffleSpillDisk:0,shuffleFetchWaitTime:0};this.stages.set(b,x),x.status==="ACTIVE"&&this.activeStages.set(b,x)}const g={id:s,query:t,status:"RUNNING",startTime:e,executionTime:u,rowsProcessed:0,explainPlan:o,physicalPlan:i,logicalPlan:n,stages:p,jobId:d};return this.sqlQueries.set(s,g),this.activeSqlQueries.set(s,g),g}generateLogicalPlan(t){const e=t.toUpperCase().trim();return e.startsWith("SELECT")?`== Logical Plan ==
Project [columns]
+- Filter [conditions]
   +- Relation [table]
`:e.startsWith("INSERT")?`== Logical Plan ==
InsertIntoTable [target]
+- Project [columns]
   +- Relation [source]
`:e.startsWith("CREATE TABLE")?`== Logical Plan ==
CreateTable [table]
+- Relation [schema]
`:`== Logical Plan ==
UnresolvedRelation [table]
`}generatePhysicalPlan(t){const e=t.toUpperCase().trim(),s=e.includes("JOIN"),n=e.includes("GROUP BY"),i=e.includes("ORDER BY");let o=`== Physical Plan ==
*Project [columns]
`;return i&&(o+=`+- *Sort [order]
`),n&&(o+=`+- *HashAggregate [grouping]
`),s?o+=`+- *BroadcastHashJoin [join]
   :- *Project [left]
   :  +- *Scan [leftTable]
   +- *Project [right]
      +- *Scan [rightTable]
`:o+=`+- *Scan [table]
`,o}generateExplainPlan(t,e,s){return`${e}
${s}`}estimateQueryRows(t){const e=t.toUpperCase();let s=1e4;return e.includes("WHERE")&&(s*=.5),e.includes("JOIN")&&(s*=2),e.includes("GROUP BY")&&(s*=.3),e.includes("LIMIT")&&(s=Math.min(s,1e3)),Math.floor(s*(.5+Math.random()))}estimateQueryDuration(t,e){const i=1e3+e/1e4*1e3;return Math.floor(i*(.8+Math.random()*.4))}estimateQueryStages(t){const e=t.toUpperCase();let s=2;return e.includes("JOIN")&&(s+=1),e.includes("GROUP BY")&&(s+=1),e.includes("ORDER BY")&&(s+=1),Math.min(s,7)}estimateQueryTasks(t,e){const n=Math.ceil(e/1e4*10);return Math.max(10,Math.min(n,200))}updateSQLQuery(t,e){const s=this.sqlQueries.get(t);if(!s||s.status!=="RUNNING")return;const n=e-(s.startTime||e),i=s.executionTime||5e3;if(n>=i){if(Math.random()<.05?s.status="FAILED":(s.status="SUCCEEDED",s.rowsProcessed=this.estimateQueryRows(s.query)),s.endTime=e,s.executionTime=n,s.jobId){const r=this.jobs.get(s.jobId);r&&(r.status=s.status==="SUCCEEDED"?"SUCCEEDED":"FAILED",r.endTime=e,r.completionTime=e,r.duration=n)}this.activeSqlQueries.delete(t)}else{const o=Math.min(1,n/i);s.rowsProcessed=Math.floor(this.estimateQueryRows(s.query)*o)}}getSQLQueries(){return Array.from(this.sqlQueries.values())}getSQLQuery(t){return this.sqlQueries.get(t)}createStreamingJob(t,e,s=Date.now()){const n=`streaming-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:n,name:t,status:"ACTIVE",batchInterval:e,startTime:s,lastBatchTime:s,nextBatchTime:s+e,totalBatches:0,processedBatches:0,failedBatches:0,totalRecordsProcessed:0,averageProcessingTime:e*.8,checkpointDirectory:this.config?.checkpointDirectory||"/checkpoint",backpressureEnabled:!0,currentBackpressure:0};return this.streamingJobs.set(n,i),this.activeStreamingJobs.set(n,i),i}updateStreamingJobs(t){if(!this.config?.enableStreaming)return;const e=Array.from(this.activeStreamingJobs.entries());for(const[s,n]of e){if(n.status!=="ACTIVE"){this.activeStreamingJobs.delete(s);continue}n.nextBatchTime&&t>=n.nextBatchTime&&this.processStreamingBatch(s,t),this.updateBackpressure(s,t),this.config.enableCheckpointing&&this.performCheckpoint(s,t)}}processStreamingBatch(t,e){const s=this.streamingJobs.get(t);if(!s||s.status!=="ACTIVE")return;if(s.backpressureEnabled&&s.currentBackpressure>.8){s.nextBatchTime=e+s.batchInterval*.5;return}s.totalBatches++,s.lastBatchTime=e;const n=s.batchInterval*(.5+Math.random()*.5),i=Math.floor(1e3+Math.random()*9e3);if(Math.random()<.05)s.failedBatches++,s.status="FAILED",this.activeStreamingJobs.delete(t);else{s.processedBatches++,s.totalRecordsProcessed+=i,s.averageProcessingTime=(s.averageProcessingTime*(s.processedBatches-1)+n)/s.processedBatches;const r=`batch-${t}-${s.totalBatches}`,u={id:r,name:`${s.name} - Batch ${s.totalBatches}`,status:"RUNNING",startTime:e,stages:2+Math.floor(Math.random()*3),tasks:10+Math.floor(Math.random()*40),executors:this.executors.size,inputBytes:i*1024,outputBytes:i*512,shuffleRead:i*256,shuffleWrite:i*256,submissionTime:e};this.jobs.set(r,u),this.activeJobs.set(r,u),s.jobId=r,s.nextBatchTime=e+s.batchInterval}}updateBackpressure(t,e){const s=this.streamingJobs.get(t);if(!s||!s.backpressureEnabled)return;const n=s.averageProcessingTime/s.batchInterval;n>1?s.currentBackpressure=Math.min(1,(n-1)*.5):s.currentBackpressure=Math.max(0,s.currentBackpressure-.1),this.activeJobs.size>=5&&(s.currentBackpressure=Math.min(1,s.currentBackpressure+.2))}performCheckpoint(t,e){const s=this.streamingJobs.get(t);!s||!this.config?.enableCheckpointing||e-this.lastStreamingCheckpoint>=this.CHECKPOINT_INTERVAL&&(this.lastStreamingCheckpoint=e,Math.random()<.01&&(s.status="FAILED",this.activeStreamingJobs.delete(t)))}getStreamingJobs(){return Array.from(this.streamingJobs.values())}getStreamingJob(t){return this.streamingJobs.get(t)}stopStreamingJob(t){const e=this.streamingJobs.get(t);e&&(e.status="STOPPED",this.activeStreamingJobs.delete(t))}initializeStreamingJob(t){if(!this.config?.enableStreaming||Array.from(this.streamingJobs.values()).some(n=>n.status==="ACTIVE"))return;const s=this.config.streamingBatchInterval||1e3;this.createStreamingJob("Spark Streaming Job",s,t)}}class Qk{config=null;models=new Map;predictions=new Map;MAX_PREDICTION_HISTORY=1e4;batchQueues=new Map;metrics={totalModels:0,servingModels:0,loadingModels:0,unavailableModels:0,totalPredictions:0,successfulPredictions:0,failedPredictions:0,averageLatency:0,p50Latency:0,p99Latency:0,requestsPerSecond:0,throughput:0,errorRate:0,batchUtilization:0,memoryUsage:0,cpuUtilization:0,requestsTotal:0,requestsErrors:0,modelMetrics:new Map};latencyHistory=[];MAX_LATENCY_HISTORY=1e3;requestTimestamps=[];MAX_REQUEST_TIMESTAMPS=1e3;lastSecondStart=Date.now();requestsThisSecond=0;lastUpdateTime=Date.now();modelLoadingStates=new Map;pendingPredictions=[];metricsHistory=[];MAX_METRICS_HISTORY=300;initializeConfig(t){const e=t.data.config||{};this.config={enabled:e.enabled!==!1,endpoint:e.endpoint||"localhost:8501",modelBasePath:e.modelBasePath||"/models",enableBatching:e.enableBatching!==!1,batchSize:e.batchSize||32,maxBatchSize:e.maxBatchSize||128,maxBatchWaitTime:e.maxBatchWaitTime||100,enableGPU:e.enableGPU||!1,gpuMemoryFraction:e.gpuMemoryFraction||.5,enableMonitoring:e.enableMonitoring!==!1,monitoringPort:e.monitoringPort||8501,numThreads:e.numThreads||4,interOpParallelismThreads:e.interOpParallelismThreads||2,intraOpParallelismThreads:e.intraOpParallelismThreads||2,errorRate:e.errorRate||0,enableErrorSimulation:e.enableErrorSimulation||!1,timeoutMs:e.timeoutMs||3e4,versioningPolicy:e.versioningPolicy||"latest",enableABTesting:e.enableABTesting||!1,abTestConfig:e.abTestConfig||[],enablePrometheusExport:e.enablePrometheusExport||!1,prometheusPort:e.prometheusPort||8502,enableGRPC:e.enableGRPC||!1,grpcPort:e.grpcPort||8500,...e},this.initializeModels(),this.initializeBatchQueues()}initializeModels(){if(this.config){if(this.models.clear(),this.config.models&&Array.isArray(this.config.models))for(const t of this.config.models){const e=`${t.name}:${t.version}`,s={name:t.name,version:t.version,status:t.status||"serving",platform:t.platform||"tensorflow",inputs:t.inputs||[],outputs:t.outputs||[],requests:0,avgLatency:0,totalPredictions:0,successfulPredictions:0,failedPredictions:0,memoryUsage:this.estimateModelMemory(t),loadTime:this.estimateLoadTime(t),lastUsed:Date.now()};this.models.set(e,s),s.status==="loading"&&this.modelLoadingStates.set(e,{startTime:Date.now(),loadDuration:s.loadTime||5e3})}this.updateModelMetrics()}}initializeBatchQueues(){if(!(!this.config||!this.config.enableBatching)){this.batchQueues.clear();for(const[t,e]of this.models.entries())e.status==="serving"&&this.batchQueues.set(t,{modelName:e.name,version:e.version,items:[],lastBatchTime:Date.now()})}}estimateModelMemory(t){let e=100;if(t.inputs&&Array.isArray(t.inputs))for(const s of t.inputs){const i=(s.shape||"[1,1]").match(/\d+/g);if(i){const o=i.reduce((r,u)=>parseInt(r)*parseInt(u),1);e+=o*.001}}return Math.max(50,Math.min(5e3,e))}estimateLoadTime(t){let e=2e3;const s=this.estimateModelMemory(t);return e+=s*2,Math.max(1e3,Math.min(3e4,e))}performUpdate(t,e=!1){!this.config||!this.config.enabled||(t-this.lastUpdateTime,this.lastUpdateTime=t,this.updateModelLoadingStates(t),this.processPendingPredictions(t),this.config.enableBatching&&this.processBatchQueues(t),e&&this.pendingPredictions.length===0&&this.simulatePredictions(t),this.updateMetrics(t))}addPendingPrediction(t,e,s){return new Promise((n,i)=>{const o=`pred-${Date.now()}-${Math.random()}`;this.pendingPredictions.push({id:o,modelName:t,version:e,input:s,timestamp:Date.now(),resolve:r=>n(r),reject:r=>i(r)})})}processPendingPredictions(t){if(this.pendingPredictions.length===0)return;const e=[...this.pendingPredictions];this.pendingPredictions=[];for(const s of e){const n=t-s.timestamp;if(this.config?.timeoutMs&&n>this.config.timeoutMs){t-s.timestamp,this.metrics.requestsTotal++,this.metrics.requestsErrors++,s.reject(new Error("Request timeout"));continue}this.processPredictionInternal(s.id,s.modelName,s.version,s.input,t,s.resolve,s.reject)}}processPredictionInternal(t,e,s,n,i,o,r){const u=`${e}:${s}`,d=this.models.get(u);if(!d){this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error(`Model ${e}:${s} not found`));return}if(d.status!=="serving"){this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error(`Model ${e}:${s} is not serving (status: ${d.status})`));return}this.requestTimestamps.push(i),this.requestTimestamps.length>this.MAX_REQUEST_TIMESTAMPS&&(this.requestTimestamps=this.requestTimestamps.slice(-this.MAX_REQUEST_TIMESTAMPS));let h=!1,p="model";if(this.config?.enableErrorSimulation&&this.config.errorRate&&this.config.errorRate>0&&Math.random()<this.config.errorRate){h=!0;const g=Math.random();g<.3?p="timeout":g<.6?p="validation":p="model"}if(h){const g=this.calculateBaseLatency(d),v=p==="timeout"?"Request timeout":p==="validation"?"Input validation failed":"Model inference error",b={id:t,model:e,version:s,input:JSON.stringify(n),status:"error",timestamp:i,latency:Math.floor(g),error:v};this.predictions.set(b.id,b),d.requests=(d.requests||0)+1,d.totalPredictions=(d.totalPredictions||0)+1,d.failedPredictions=(d.failedPredictions||0)+1,this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error(v));return}if(this.config?.enableBatching){const g=this.batchQueues.get(u);if(!g){this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error("Batch queue not found"));return}g.items.push({predictionId:t,input:n,timestamp:i,resolve:o,reject:r})}else{const g=this.calculateBaseLatency(d),v=this.generateMockOutput(d),b={id:t,model:e,version:s,input:JSON.stringify(n),output:JSON.stringify(v),status:"success",timestamp:i,latency:Math.floor(g)};if(this.predictions.set(b.id,b),d.requests=(d.requests||0)+1,d.totalPredictions=(d.totalPredictions||0)+1,d.successfulPredictions=(d.successfulPredictions||0)+1,d.avgLatency=this.updateAverageLatency(d.avgLatency||0,b.latency,d.totalPredictions),d.lastUsed=i,this.predictions.size>this.MAX_PREDICTION_HISTORY){const x=this.predictions.keys().next().value;this.predictions.delete(x)}this.metrics.requestsTotal++,o({success:!0,output:v,latency:b.latency})}}updateModelLoadingStates(t){for(const[e,s]of this.modelLoadingStates.entries())if(t-s.startTime>=s.loadDuration){const i=this.models.get(e);i&&(i.status="serving",i.lastUsed=t),this.modelLoadingStates.delete(e),this.config?.enableBatching&&i&&this.batchQueues.set(e,{modelName:i.name,version:i.version,items:[],lastBatchTime:t})}}processBatchQueues(t){if(this.config)for(const[e,s]of this.batchQueues.entries()){const n=this.models.get(e);if(!n||n.status!=="serving")continue;const i=t-s.lastBatchTime;(s.items.length>=(this.config.batchSize||32)||i>=(this.config.maxBatchWaitTime||100)&&s.items.length>0)&&s.items.length>0&&this.executeBatch(e,s,t)}}executeBatch(t,e,s){const n=this.models.get(t);if(!n){const h=e.items.splice(0,e.items.length);for(const p of h)p.reject(new Error("Model not found"));return}const i=e.items.length,o=e.items.splice(0,i),r=this.calculateBaseLatency(n),u=Math.max(.5,1-(i-1)*.05),d=r*u;for(const h of o){let p=!1,g="model";if(this.config?.enableErrorSimulation&&this.config.errorRate&&this.config.errorRate>0&&Math.random()<this.config.errorRate){p=!0;const x=Math.random();x<.3?g="timeout":x<.6?g="validation":g="model"}if(p){const x=Math.floor(d),R=g==="timeout"?"Request timeout":g==="validation"?"Input validation failed":"Model inference error",C={id:h.predictionId,model:n.name,version:n.version,input:JSON.stringify(h.input),status:"error",timestamp:s,latency:x,batchSize:i,error:R};this.predictions.set(C.id,C),n.requests=(n.requests||0)+1,n.totalPredictions=(n.totalPredictions||0)+1,n.failedPredictions=(n.failedPredictions||0)+1,this.metrics.requestsTotal++,this.metrics.requestsErrors++,h.reject(new Error(R));continue}const v=this.generateMockOutput(n),b={id:h.predictionId,model:n.name,version:n.version,input:JSON.stringify(h.input),output:JSON.stringify(v),status:"success",timestamp:s,latency:Math.floor(d+(Math.random()*10-5)),batchSize:i};this.predictions.set(b.id,b),n.requests=(n.requests||0)+1,n.totalPredictions=(n.totalPredictions||0)+1,n.successfulPredictions=(n.successfulPredictions||0)+1,n.avgLatency=this.updateAverageLatency(n.avgLatency||0,b.latency,n.totalPredictions),n.lastUsed=s,this.metrics.requestsTotal++,h.resolve({success:!0,output:v,latency:b.latency})}if(e.lastBatchTime=s,this.predictions.size>this.MAX_PREDICTION_HISTORY){const h=this.predictions.keys().next().value;this.predictions.delete(h)}}simulatePredictions(t){if(!this.config)return;const e=this.calculateRequestRate(),s=Math.floor(e*.1);for(let n=0;n<s;n++){const i=Array.from(this.models.values()).filter(h=>h.status==="serving");if(i.length===0)continue;const o=i[Math.floor(Math.random()*i.length)],r=`${o.name}:${o.version}`,u=`pred-${t}-${n}`,d=this.generateMockInput(o);if(this.config.enableBatching){const h=this.batchQueues.get(r);h&&h.items.push({predictionId:u,input:d,timestamp:t,resolve:()=>{},reject:()=>{}})}else{const h=this.calculateBaseLatency(o),p={id:u,model:o.name,version:o.version,input:JSON.stringify(d),output:JSON.stringify(this.generateMockOutput(o)),status:"success",timestamp:t,latency:Math.floor(h+(Math.random()*10-5))};this.predictions.set(p.id,p),o.requests=(o.requests||0)+1,o.totalPredictions=(o.totalPredictions||0)+1,o.successfulPredictions=(o.successfulPredictions||0)+1,o.avgLatency=this.updateAverageLatency(o.avgLatency||0,p.latency,o.totalPredictions),o.lastUsed=t}}}calculateBaseLatency(t){let e=20;const s=t.memoryUsage||100;return e+=s*.1,this.config?.enableGPU&&(e*=.3),e+=Math.random()*10-5,Math.max(5,e)}calculateRequestRate(){return Array.from(this.models.values()).filter(e=>e.status==="serving").length*10}generateMockInput(t){const e={};if(t.inputs&&Array.isArray(t.inputs))for(const s of t.inputs){const i=(s.shape||"[1,1]").match(/\d+/g);if(i){const o=i.map(r=>parseInt(r));e[s.name]=this.generateArray(o)}else e[s.name]=[Math.random()]}else e.instances=[[Math.random(),Math.random(),Math.random()]];return e}generateArray(t){if(t.length===1)return Array(t[0]).fill(0).map(()=>Math.random());if(t.length===2)return Array(t[0]).fill(0).map(()=>Array(t[1]).fill(0).map(()=>Math.random()));{const e=t.reduce((s,n)=>s*n,1);return Array(e).fill(0).map(()=>Math.random())}}generateMockOutput(t){if(t.outputs&&t.outputs.length>0){const e={};for(const s of t.outputs){const i=(s.shape||"[1,1]").match(/\d+/g);if(i){const o=i.map(r=>parseInt(r));e[s.name]=this.generateArray(o)}else e[s.name]=[[Math.random()]]}return e}return{predictions:[[Math.random(),Math.random(),Math.random()]]}}updateAverageLatency(t,e,s){return s===1?e:(t*(s-1)+e)/s}updateMetrics(t){let e=0,s=0,n=0;for(const d of this.models.values())switch(d.status){case"serving":e++;break;case"loading":s++;break;case"unavailable":case"error":n++;break}this.metrics.totalModels=this.models.size,this.metrics.servingModels=e,this.metrics.loadingModels=s,this.metrics.unavailableModels=n;const i=Array.from(this.predictions.values()).filter(d=>t-d.timestamp<6e4);if(this.metrics.totalPredictions=this.predictions.size,this.metrics.successfulPredictions=i.filter(d=>d.status==="success").length,this.metrics.failedPredictions=i.filter(d=>d.status==="error").length,i.length>0){const d=i.map(h=>h.latency).sort((h,p)=>h-p);this.metrics.averageLatency=d.reduce((h,p)=>h+p,0)/d.length,this.metrics.p50Latency=this.calculatePercentile(d,50),this.metrics.p99Latency=this.calculatePercentile(d,99),this.latencyHistory.push(...d.slice(-100)),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&(this.latencyHistory=this.latencyHistory.slice(-this.MAX_LATENCY_HISTORY))}const o=t-1e3,r=this.requestTimestamps.filter(d=>d>o);if(this.metrics.requestsPerSecond=r.length,this.metrics.throughput=this.metrics.requestsPerSecond,i.length>0&&(this.metrics.errorRate=this.metrics.failedPredictions/i.length),this.config?.enableBatching){let d=0,h=0;for(const g of this.batchQueues.values())d+=g.items.length,h++;const p=h>0?d/h:0;this.metrics.batchUtilization=Math.min(1,p/(this.config.batchSize||32))}this.config?.enableGPU&&(this.metrics.gpuUtilization=Math.min(1,this.metrics.requestsPerSecond/100));let u=0;for(const d of this.models.values())u+=d.memoryUsage||0;this.metrics.memoryUsage=u,this.metrics.cpuUtilization=Math.min(1,this.metrics.requestsPerSecond/50),this.updateModelSpecificMetrics(),this.metricsHistory.push({timestamp:t,latency:this.metrics.averageLatency,rps:this.metrics.requestsPerSecond,errorRate:this.metrics.errorRate,throughput:this.metrics.throughput,batchUtilization:this.metrics.batchUtilization,gpuUtilization:this.metrics.gpuUtilization,cpuUtilization:this.metrics.cpuUtilization}),this.metricsHistory.length>this.MAX_METRICS_HISTORY&&(this.metricsHistory=this.metricsHistory.slice(-this.MAX_METRICS_HISTORY))}updateModelSpecificMetrics(){this.metrics.modelMetrics.clear();for(const[t,e]of this.models.entries()){const s=Array.from(this.predictions.values()).filter(i=>i.model===e.name&&i.version===e.version),n=`${e.name}:${e.version}`;this.metrics.modelMetrics.set(n,{predictions:s.length,avgLatency:e.avgLatency||0,errorRate:e.failedPredictions&&e.totalPredictions?e.failedPredictions/e.totalPredictions:0,requestsPerSecond:e.requests?e.requests/60:0})}}calculatePercentile(t,e){if(t.length===0)return 0;const s=Math.ceil(e/100*t.length)-1;return t[Math.max(0,Math.min(s,t.length-1))]}async processPrediction(t,e,s){const n=Date.now(),i=`${t}:${e}`,o=this.models.get(i);if(!o){const r=Date.now()-n;return this.metrics.requestsTotal++,this.metrics.requestsErrors++,{success:!1,error:`Model ${t}:${e} not found`,latency:r}}if(o.status!=="serving"){const r=Date.now()-n;return this.metrics.requestsTotal++,this.metrics.requestsErrors++,{success:!1,error:`Model ${t}:${e} is not serving (status: ${o.status})`,latency:r}}if(this.requestTimestamps.push(n),this.requestTimestamps.length>this.MAX_REQUEST_TIMESTAMPS&&(this.requestTimestamps=this.requestTimestamps.slice(-this.MAX_REQUEST_TIMESTAMPS)),this.config?.enableBatching)return new Promise((r,u)=>{const d=this.batchQueues.get(i);if(!d){const p=Date.now()-n;this.metrics.requestsTotal++,this.metrics.requestsErrors++,r({success:!1,error:"Batch queue not found",latency:p});return}const h=`pred-${Date.now()}-${Math.random()}`;d.items.push({predictionId:h,input:s,timestamp:n,resolve:p=>{const g=Date.now()-n;this.metrics.requestsTotal++,r({success:!0,output:p,latency:g})},reject:p=>{const g=Date.now()-n;this.metrics.requestsTotal++,this.metrics.requestsErrors++,r({success:!1,error:p.message,latency:g})}})});{const r=this.calculateBaseLatency(o),u=this.generateMockOutput(o),d={id:`pred-${Date.now()}`,model:t,version:e,input:JSON.stringify(s),output:JSON.stringify(u),status:"success",timestamp:n,latency:Math.floor(r)};if(this.predictions.set(d.id,d),o.requests=(o.requests||0)+1,o.totalPredictions=(o.totalPredictions||0)+1,o.successfulPredictions=(o.successfulPredictions||0)+1,o.avgLatency=this.updateAverageLatency(o.avgLatency||0,d.latency,o.totalPredictions),o.lastUsed=n,this.predictions.size>this.MAX_PREDICTION_HISTORY){const h=this.predictions.keys().next().value;this.predictions.delete(h)}return this.metrics.requestsTotal++,{success:!0,output:u,latency:d.latency}}}getMetrics(){return{...this.metrics}}getModels(){return Array.from(this.models.values())}getRecentPredictions(t=100){return Array.from(this.predictions.values()).sort((e,s)=>s.timestamp-e.timestamp).slice(0,t)}syncModelsFromConfig(){this.config&&(this.initializeModels(),this.initializeBatchQueues())}getMetricsHistory(t){return t?this.metricsHistory.slice(-t):[...this.metricsHistory]}selectModelVersion(t){if(!this.config)return null;if(this.config.enableABTesting&&this.config.abTestConfig){const s=this.config.abTestConfig.find(n=>n.modelName===t);if(s&&s.versions.length>0){const n=Math.random()*100;let i=0;for(const o of s.versions)if(i+=o.trafficPercentage,n<=i){const r=`${t}:${o.version}`;if(this.models.has(r)&&this.models.get(r)?.status==="serving")return o.version}for(const o of s.versions){const r=`${t}:${o.version}`;if(this.models.has(r)&&this.models.get(r)?.status==="serving")return o.version}}}const e=Array.from(this.models.values()).filter(s=>s.name===t&&s.status==="serving").map(s=>({version:s.version,timestamp:s.lastUsed||0})).sort((s,n)=>n.version.localeCompare(s.version));if(e.length===0)return null;switch(this.config.versioningPolicy){case"latest":return e[0].version;case"all":return e[Math.floor(Math.random()*e.length)].version;case"specific":return e[0].version;default:return e[0].version}}getPrometheusMetrics(){const t=[];t.push("# HELP tensorflow_serving_models_total Total number of models"),t.push("# TYPE tensorflow_serving_models_total gauge"),t.push(`tensorflow_serving_models_total ${this.metrics.totalModels}`),t.push("# HELP tensorflow_serving_models_serving Number of serving models"),t.push("# TYPE tensorflow_serving_models_serving gauge"),t.push(`tensorflow_serving_models_serving ${this.metrics.servingModels}`),t.push("# HELP tensorflow_serving_predictions_total Total number of predictions"),t.push("# TYPE tensorflow_serving_predictions_total counter"),t.push(`tensorflow_serving_predictions_total ${this.metrics.totalPredictions}`),t.push("# HELP tensorflow_serving_predictions_successful Successful predictions"),t.push("# TYPE tensorflow_serving_predictions_successful counter"),t.push(`tensorflow_serving_predictions_successful ${this.metrics.successfulPredictions}`),t.push("# HELP tensorflow_serving_predictions_failed Failed predictions"),t.push("# TYPE tensorflow_serving_predictions_failed counter"),t.push(`tensorflow_serving_predictions_failed ${this.metrics.failedPredictions}`),t.push("# HELP tensorflow_serving_latency_ms Average latency in milliseconds"),t.push("# TYPE tensorflow_serving_latency_ms gauge"),t.push(`tensorflow_serving_latency_ms ${this.metrics.averageLatency}`),t.push("# HELP tensorflow_serving_latency_p50_ms P50 latency in milliseconds"),t.push("# TYPE tensorflow_serving_latency_p50_ms gauge"),t.push(`tensorflow_serving_latency_p50_ms ${this.metrics.p50Latency}`),t.push("# HELP tensorflow_serving_latency_p99_ms P99 latency in milliseconds"),t.push("# TYPE tensorflow_serving_latency_p99_ms gauge"),t.push(`tensorflow_serving_latency_p99_ms ${this.metrics.p99Latency}`),t.push("# HELP tensorflow_serving_requests_per_second Requests per second"),t.push("# TYPE tensorflow_serving_requests_per_second gauge"),t.push(`tensorflow_serving_requests_per_second ${this.metrics.requestsPerSecond}`),t.push("# HELP tensorflow_serving_error_rate Error rate (0-1)"),t.push("# TYPE tensorflow_serving_error_rate gauge"),t.push(`tensorflow_serving_error_rate ${this.metrics.errorRate}`),t.push("# HELP tensorflow_serving_batch_utilization Batch utilization (0-1)"),t.push("# TYPE tensorflow_serving_batch_utilization gauge"),t.push(`tensorflow_serving_batch_utilization ${this.metrics.batchUtilization}`),this.metrics.gpuUtilization!==void 0&&(t.push("# HELP tensorflow_serving_gpu_utilization GPU utilization (0-1)"),t.push("# TYPE tensorflow_serving_gpu_utilization gauge"),t.push(`tensorflow_serving_gpu_utilization ${this.metrics.gpuUtilization}`)),t.push("# HELP tensorflow_serving_cpu_utilization CPU utilization (0-1)"),t.push("# TYPE tensorflow_serving_cpu_utilization gauge"),t.push(`tensorflow_serving_cpu_utilization ${this.metrics.cpuUtilization}`),t.push("# HELP tensorflow_serving_memory_usage_mb Memory usage in MB"),t.push("# TYPE tensorflow_serving_memory_usage_mb gauge"),t.push(`tensorflow_serving_memory_usage_mb ${this.metrics.memoryUsage}`);for(const[e,s]of this.metrics.modelMetrics.entries()){const[n,i]=e.split(":");t.push(`# Model-specific metrics for ${n}:${i}`),t.push(`tensorflow_serving_model_predictions_total{model="${n}",version="${i}"} ${s.predictions}`),t.push(`tensorflow_serving_model_latency_ms{model="${n}",version="${i}"} ${s.avgLatency}`),t.push(`tensorflow_serving_model_error_rate{model="${n}",version="${i}"} ${s.errorRate}`),t.push(`tensorflow_serving_model_rps{model="${n}",version="${i}"} ${s.requestsPerSecond}`)}return t.join(`
`)}getModelStatus(t,e){const s=Array.from(this.models.values()).filter(n=>n.name===t&&(!e||n.version===e));return s.length===0?null:{model_version_status:s.map(n=>({version:n.version,state:n.status==="serving"?"AVAILABLE":n.status==="loading"?"LOADING":(n.status==="error","UNAVAILABLE"),status:{error_code:n.status==="error"?1:0,error_message:n.status==="error"?"Model error":""}}))}}async processGRPCPrediction(t,e,s){return this.processPrediction(t,e,s)}getGRPCInfo(){if(!this.config||!this.config.enableGRPC)return null;const t=this.config.endpoint?.split(":")[0]||"localhost",e=this.config.grpcPort||8500;return{enabled:!0,port:e,endpoint:`${t}:${e}`}}}class Vk{config=null;models=new Map;predictions=new Map;MAX_PREDICTION_HISTORY=1e4;batchQueues=new Map;metrics={totalModels:0,servingModels:0,loadingModels:0,unavailableModels:0,totalPredictions:0,successfulPredictions:0,failedPredictions:0,averageLatency:0,p50Latency:0,p99Latency:0,requestsPerSecond:0,throughput:0,errorRate:0,batchUtilization:0,memoryUsage:0,cpuUtilization:0,requestsTotal:0,requestsErrors:0,modelMetrics:new Map};latencyHistory=[];MAX_LATENCY_HISTORY=1e3;requestTimestamps=[];MAX_REQUEST_TIMESTAMPS=1e3;lastSecondStart=Date.now();requestsThisSecond=0;lastUpdateTime=Date.now();modelLoadingStates=new Map;pendingPredictions=[];metricsHistory=[];MAX_METRICS_HISTORY=300;initializeConfig(t){const e=t.data.config||{};this.config={enabled:e.enabled!==!1,endpoint:e.endpoint||"localhost:8080",modelStore:e.modelStore||"/models",enableWorkers:e.enableWorkers!==!1,numWorkers:e.numWorkers||1,enableBatching:e.enableBatching!==!1,batchSize:e.batchSize||1,maxBatchDelay:e.maxBatchDelay||100,enableGPU:e.enableGPU||!1,enableMetrics:e.enableMetrics!==!1,metricsPort:e.metricsPort||8082,errorRate:e.errorRate||0,enableErrorSimulation:e.enableErrorSimulation||!1,timeoutMs:e.timeoutMs||3e4,...e},this.initializeModels(),this.initializeBatchQueues()}initializeModels(){if(this.config){if(this.models.clear(),this.config.models&&Array.isArray(this.config.models))for(const t of this.config.models){const e=`${t.name}:${t.version}`,s={name:t.name,version:t.version,status:t.status||"serving",handler:t.handler||"image_classifier",inputs:t.inputs||[],outputs:t.outputs||[],requests:0,avgLatency:0,totalPredictions:0,successfulPredictions:0,failedPredictions:0,memoryUsage:this.estimateModelMemory(t),loadTime:this.estimateLoadTime(t),lastUsed:Date.now()};this.models.set(e,s),s.status==="loading"&&this.modelLoadingStates.set(e,{startTime:Date.now(),loadDuration:s.loadTime||5e3})}this.updateModelMetrics()}}initializeBatchQueues(){if(!(!this.config||!this.config.enableBatching)){this.batchQueues.clear();for(const[t,e]of this.models.entries())e.status==="serving"&&this.batchQueues.set(t,{modelName:e.name,version:e.version,items:[],lastBatchTime:Date.now()})}}estimateModelMemory(t){let e=100;if(t.inputs&&Array.isArray(t.inputs))for(const s of t.inputs){const i=(s.shape||"[1,1]").match(/\d+/g);if(i){const o=i.reduce((r,u)=>parseInt(r)*parseInt(u),1);e+=o*.001}}return Math.max(50,Math.min(5e3,e))}estimateLoadTime(t){let e=2e3;const s=this.estimateModelMemory(t);return e+=s*2,Math.max(1e3,Math.min(3e4,e))}performUpdate(t,e=!1){!this.config||!this.config.enabled||(t-this.lastUpdateTime,this.lastUpdateTime=t,this.updateModelLoadingStates(t),this.processPendingPredictions(t),this.config.enableBatching&&this.processBatchQueues(t),e&&this.pendingPredictions.length===0&&this.simulatePredictions(t),this.updateMetrics(t))}addPendingPrediction(t,e,s){return new Promise((n,i)=>{const o=`pred-${Date.now()}-${Math.random()}`;this.pendingPredictions.push({id:o,modelName:t,version:e,input:s,timestamp:Date.now(),resolve:r=>n(r),reject:r=>i(r)})})}processPendingPredictions(t){if(this.pendingPredictions.length===0)return;const e=[...this.pendingPredictions];this.pendingPredictions=[];for(const s of e){const n=t-s.timestamp;if(this.config?.timeoutMs&&n>this.config.timeoutMs){t-s.timestamp,this.metrics.requestsTotal++,this.metrics.requestsErrors++,s.reject(new Error("Request timeout"));continue}this.processPredictionInternal(s.id,s.modelName,s.version,s.input,t,s.resolve,s.reject)}}processPredictionInternal(t,e,s,n,i,o,r){const u=`${e}:${s}`,d=this.models.get(u);if(!d){this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error(`Model ${e}:${s} not found`));return}if(d.status!=="serving"){this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error(`Model ${e}:${s} is not serving (status: ${d.status})`));return}this.requestTimestamps.push(i),this.requestTimestamps.length>this.MAX_REQUEST_TIMESTAMPS&&(this.requestTimestamps=this.requestTimestamps.slice(-this.MAX_REQUEST_TIMESTAMPS));let h=!1,p="model";if(this.config?.enableErrorSimulation&&this.config.errorRate&&this.config.errorRate>0&&Math.random()<this.config.errorRate){h=!0;const g=Math.random();g<.3?p="timeout":g<.6?p="validation":p="model"}if(h){const g=this.calculateBaseLatency(d),v=p==="timeout"?"Request timeout":p==="validation"?"Input validation failed":"Model inference error",b={id:t,model:e,version:s,input:JSON.stringify(n),status:"error",timestamp:i,latency:Math.floor(g),error:v};this.predictions.set(b.id,b),d.requests=(d.requests||0)+1,d.totalPredictions=(d.totalPredictions||0)+1,d.failedPredictions=(d.failedPredictions||0)+1,this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error(v));return}if(this.config?.enableBatching){const g=this.batchQueues.get(u);if(!g){this.metrics.requestsTotal++,this.metrics.requestsErrors++,r(new Error("Batch queue not found"));return}g.items.push({predictionId:t,input:n,timestamp:i,resolve:o,reject:r})}else{const g=this.calculateBaseLatency(d),v=this.generateMockOutput(d),b={id:t,model:e,version:s,input:JSON.stringify(n),output:JSON.stringify(v),status:"success",timestamp:i,latency:Math.floor(g)};if(this.predictions.set(b.id,b),d.requests=(d.requests||0)+1,d.totalPredictions=(d.totalPredictions||0)+1,d.successfulPredictions=(d.successfulPredictions||0)+1,d.avgLatency=this.updateAverageLatency(d.avgLatency||0,b.latency,d.totalPredictions),d.lastUsed=i,this.predictions.size>this.MAX_PREDICTION_HISTORY){const x=this.predictions.keys().next().value;this.predictions.delete(x)}this.metrics.requestsTotal++,o({success:!0,output:v,latency:b.latency})}}updateModelLoadingStates(t){for(const[e,s]of this.modelLoadingStates.entries())if(t-s.startTime>=s.loadDuration){const i=this.models.get(e);i&&(i.status="serving",i.lastUsed=t),this.modelLoadingStates.delete(e),this.config?.enableBatching&&i&&this.batchQueues.set(e,{modelName:i.name,version:i.version,items:[],lastBatchTime:t})}}processBatchQueues(t){if(this.config)for(const[e,s]of this.batchQueues.entries()){const n=this.models.get(e);if(!n||n.status!=="serving")continue;const i=t-s.lastBatchTime;(s.items.length>=(this.config.batchSize||1)||i>=(this.config.maxBatchDelay||100)&&s.items.length>0)&&s.items.length>0&&this.executeBatch(e,s,t)}}executeBatch(t,e,s){const n=this.models.get(t);if(!n){const h=e.items.splice(0,e.items.length);for(const p of h)p.reject(new Error("Model not found"));return}const i=e.items.length,o=e.items.splice(0,i),r=this.calculateBaseLatency(n),u=Math.max(.5,1-(i-1)*.05),d=r*u;for(const h of o){let p=!1,g="model";if(this.config?.enableErrorSimulation&&this.config.errorRate&&this.config.errorRate>0&&Math.random()<this.config.errorRate){p=!0;const x=Math.random();x<.3?g="timeout":x<.6?g="validation":g="model"}if(p){const x=Math.floor(d),R=g==="timeout"?"Request timeout":g==="validation"?"Input validation failed":"Model inference error",C={id:h.predictionId,model:n.name,version:n.version,input:JSON.stringify(h.input),status:"error",timestamp:s,latency:x,batchSize:i,error:R};this.predictions.set(C.id,C),n.requests=(n.requests||0)+1,n.totalPredictions=(n.totalPredictions||0)+1,n.failedPredictions=(n.failedPredictions||0)+1,this.metrics.requestsTotal++,this.metrics.requestsErrors++,h.reject(new Error(R));continue}const v=this.generateMockOutput(n),b={id:h.predictionId,model:n.name,version:n.version,input:JSON.stringify(h.input),output:JSON.stringify(v),status:"success",timestamp:s,latency:Math.floor(d+(Math.random()*10-5)),batchSize:i};this.predictions.set(b.id,b),n.requests=(n.requests||0)+1,n.totalPredictions=(n.totalPredictions||0)+1,n.successfulPredictions=(n.successfulPredictions||0)+1,n.avgLatency=this.updateAverageLatency(n.avgLatency||0,b.latency,n.totalPredictions),n.lastUsed=s,this.metrics.requestsTotal++,h.resolve({success:!0,output:v,latency:b.latency})}if(e.lastBatchTime=s,this.predictions.size>this.MAX_PREDICTION_HISTORY){const h=this.predictions.keys().next().value;this.predictions.delete(h)}}simulatePredictions(t){if(!this.config)return;const e=this.calculateRequestRate(),s=Math.floor(e*.1);for(let n=0;n<s;n++){const i=Array.from(this.models.values()).filter(h=>h.status==="serving");if(i.length===0)continue;const o=i[Math.floor(Math.random()*i.length)],r=`${o.name}:${o.version}`,u=`pred-${t}-${n}`,d=this.generateMockInput(o);if(this.config.enableBatching){const h=this.batchQueues.get(r);h&&h.items.push({predictionId:u,input:d,timestamp:t,resolve:()=>{},reject:()=>{}})}else{const h=this.calculateBaseLatency(o),p={id:u,model:o.name,version:o.version,input:JSON.stringify(d),output:JSON.stringify(this.generateMockOutput(o)),status:"success",timestamp:t,latency:Math.floor(h+(Math.random()*10-5))};this.predictions.set(p.id,p),o.requests=(o.requests||0)+1,o.totalPredictions=(o.totalPredictions||0)+1,o.successfulPredictions=(o.successfulPredictions||0)+1,o.avgLatency=this.updateAverageLatency(o.avgLatency||0,p.latency,o.totalPredictions),o.lastUsed=t}}}calculateBaseLatency(t){let e=20;const s=t.memoryUsage||100;return e+=s*.1,this.config?.enableGPU&&(e*=.3),e+=Math.random()*10-5,Math.max(5,e)}calculateRequestRate(){return Array.from(this.models.values()).filter(e=>e.status==="serving").length*10}generateMockInput(t){const e={};if(t.inputs&&Array.isArray(t.inputs))for(const s of t.inputs){const i=(s.shape||"[1,1]").match(/\d+/g);if(i){const o=i.map(r=>parseInt(r));e[s.name]=this.generateArray(o)}else e[s.name]=[Math.random()]}else t.handler==="image_classifier"?e.data=[[Math.random(),Math.random(),Math.random()]]:t.handler==="object_detector"?e.data=[[Math.random(),Math.random(),Math.random()]]:e.data=[[Math.random(),Math.random(),Math.random()]];return e}generateArray(t){if(t.length===1)return Array(t[0]).fill(0).map(()=>Math.random());if(t.length===2)return Array(t[0]).fill(0).map(()=>Array(t[1]).fill(0).map(()=>Math.random()));{const e=t.reduce((s,n)=>s*n,1);return Array(e).fill(0).map(()=>Math.random())}}generateMockOutput(t){if(t.outputs&&t.outputs.length>0){const e={};for(const s of t.outputs){const i=(s.shape||"[1,1]").match(/\d+/g);if(i){const o=i.map(r=>parseInt(r));e[s.name]=this.generateArray(o)}else e[s.name]=[[Math.random()]]}return e}return t.handler==="image_classifier"?{predictions:[[.85,.1,.05]]}:t.handler==="object_detector"?{detections:[{class:"object",confidence:.9,bbox:[10,20,100,150]}]}:{predictions:[[Math.random(),Math.random(),Math.random()]]}}updateAverageLatency(t,e,s){return s===1?e:(t*(s-1)+e)/s}updateMetrics(t){let e=0,s=0,n=0;for(const d of this.models.values())switch(d.status){case"serving":e++;break;case"loading":s++;break;case"unavailable":case"error":n++;break}this.metrics.totalModels=this.models.size,this.metrics.servingModels=e,this.metrics.loadingModels=s,this.metrics.unavailableModels=n;const i=Array.from(this.predictions.values()).filter(d=>t-d.timestamp<6e4);if(this.metrics.totalPredictions=this.predictions.size,this.metrics.successfulPredictions=i.filter(d=>d.status==="success").length,this.metrics.failedPredictions=i.filter(d=>d.status==="error").length,i.length>0){const d=i.map(h=>h.latency).sort((h,p)=>h-p);this.metrics.averageLatency=d.reduce((h,p)=>h+p,0)/d.length,this.metrics.p50Latency=this.calculatePercentile(d,50),this.metrics.p99Latency=this.calculatePercentile(d,99),this.latencyHistory.push(...d.slice(-100)),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&(this.latencyHistory=this.latencyHistory.slice(-this.MAX_LATENCY_HISTORY))}const o=t-1e3,r=this.requestTimestamps.filter(d=>d>o);if(this.metrics.requestsPerSecond=r.length,this.metrics.throughput=this.metrics.requestsPerSecond,i.length>0&&(this.metrics.errorRate=this.metrics.failedPredictions/i.length),this.config?.enableBatching){let d=0,h=0;for(const g of this.batchQueues.values())d+=g.items.length,h++;const p=h>0?d/h:0;this.metrics.batchUtilization=Math.min(1,p/(this.config.batchSize||1))}this.config?.enableGPU&&(this.metrics.gpuUtilization=Math.min(1,this.metrics.requestsPerSecond/100));let u=0;for(const d of this.models.values())u+=d.memoryUsage||0;this.metrics.memoryUsage=u,this.metrics.cpuUtilization=Math.min(1,this.metrics.requestsPerSecond/50),this.updateModelSpecificMetrics(),this.metricsHistory.push({timestamp:t,latency:this.metrics.averageLatency,rps:this.metrics.requestsPerSecond,errorRate:this.metrics.errorRate,throughput:this.metrics.throughput,batchUtilization:this.metrics.batchUtilization,gpuUtilization:this.metrics.gpuUtilization,cpuUtilization:this.metrics.cpuUtilization}),this.metricsHistory.length>this.MAX_METRICS_HISTORY&&(this.metricsHistory=this.metricsHistory.slice(-this.MAX_METRICS_HISTORY))}updateModelSpecificMetrics(){this.metrics.modelMetrics.clear();for(const[t,e]of this.models.entries()){const s=Array.from(this.predictions.values()).filter(i=>i.model===e.name&&i.version===e.version),n=`${e.name}:${e.version}`;this.metrics.modelMetrics.set(n,{predictions:s.length,avgLatency:e.avgLatency||0,errorRate:e.failedPredictions&&e.totalPredictions?e.failedPredictions/e.totalPredictions:0,requestsPerSecond:e.requests?e.requests/60:0})}}updateModelMetrics(){this.metrics.totalModels=this.models.size,this.metrics.servingModels=Array.from(this.models.values()).filter(t=>t.status==="serving").length,this.metrics.loadingModels=Array.from(this.models.values()).filter(t=>t.status==="loading").length,this.metrics.unavailableModels=Array.from(this.models.values()).filter(t=>t.status==="unavailable"||t.status==="error").length}calculatePercentile(t,e){if(t.length===0)return 0;const s=Math.ceil(e/100*t.length)-1;return t[Math.max(0,Math.min(s,t.length-1))]}async processPrediction(t,e,s){const n=Date.now(),i=`${t}:${e}`,o=this.models.get(i);if(!o){const r=Date.now()-n;return this.metrics.requestsTotal++,this.metrics.requestsErrors++,{success:!1,error:`Model ${t}:${e} not found`,latency:r}}if(o.status!=="serving"){const r=Date.now()-n;return this.metrics.requestsTotal++,this.metrics.requestsErrors++,{success:!1,error:`Model ${t}:${e} is not serving (status: ${o.status})`,latency:r}}if(this.requestTimestamps.push(n),this.requestTimestamps.length>this.MAX_REQUEST_TIMESTAMPS&&(this.requestTimestamps=this.requestTimestamps.slice(-this.MAX_REQUEST_TIMESTAMPS)),this.config?.enableBatching)return new Promise((r,u)=>{const d=this.batchQueues.get(i);if(!d){const p=Date.now()-n;this.metrics.requestsTotal++,this.metrics.requestsErrors++,r({success:!1,error:"Batch queue not found",latency:p});return}const h=`pred-${Date.now()}-${Math.random()}`;d.items.push({predictionId:h,input:s,timestamp:n,resolve:p=>{const g=Date.now()-n;this.metrics.requestsTotal++,r({success:!0,output:p,latency:g})},reject:p=>{const g=Date.now()-n;this.metrics.requestsTotal++,this.metrics.requestsErrors++,r({success:!1,error:p.message,latency:g})}})});{const r=this.calculateBaseLatency(o),u=this.generateMockOutput(o),d={id:`pred-${Date.now()}`,model:t,version:e,input:JSON.stringify(s),output:JSON.stringify(u),status:"success",timestamp:n,latency:Math.floor(r)};if(this.predictions.set(d.id,d),o.requests=(o.requests||0)+1,o.totalPredictions=(o.totalPredictions||0)+1,o.successfulPredictions=(o.successfulPredictions||0)+1,o.avgLatency=this.updateAverageLatency(o.avgLatency||0,d.latency,o.totalPredictions),o.lastUsed=n,this.predictions.size>this.MAX_PREDICTION_HISTORY){const h=this.predictions.keys().next().value;this.predictions.delete(h)}return this.metrics.requestsTotal++,{success:!0,output:u,latency:d.latency}}}getMetrics(){return{...this.metrics}}getModels(){return Array.from(this.models.values())}getRecentPredictions(t=100){return Array.from(this.predictions.values()).sort((e,s)=>s.timestamp-e.timestamp).slice(0,t)}syncModelsFromConfig(){this.config&&(this.initializeModels(),this.initializeBatchQueues())}getMetricsHistory(t){return t?this.metricsHistory.slice(-t):[...this.metricsHistory]}}class Gk{config=null;features=new Map;featureSets=new Map;requests=new Map;MAX_REQUEST_HISTORY=1e4;cache=new Map;metrics={totalFeatures:0,activeFeatures:0,deprecatedFeatures:0,totalFeatureSets:0,requestsTotal:0,requestsOnline:0,requestsOffline:0,requestsSuccess:0,requestsErrors:0,requestsTimeout:0,averageLatency:0,p50Latency:0,p99Latency:0,requestsPerSecond:0,throughput:0,errorRate:0,cacheHits:0,cacheMisses:0,cacheHitRate:0,onlineStoreUtilization:0,offlineStoreUtilization:0,validationPassed:0,validationFailed:0,driftDetections:0,totalFeatureUsage:0,topFeatures:[]};latencyHistory=[];MAX_LATENCY_HISTORY=1e3;requestTimestamps=[];MAX_REQUEST_TIMESTAMPS=1e3;lastSecondStart=Date.now();requestsThisSecond=0;lastUpdateTime=Date.now();pendingRequests=[];metricsHistory=[];MAX_METRICS_HISTORY=300;initializeConfig(t){const e=t.data.config||{};this.config={enabled:e.enabled!==!1,featureStoreType:e.featureStoreType||"feast",enableOnlineServing:e.enableOnlineServing!==!1,onlineStoreType:e.onlineStoreType||"redis",onlineStoreUrl:e.onlineStoreUrl||"redis://localhost:6379",enableOfflineServing:e.enableOfflineServing!==!1,offlineStoreType:e.offlineStoreType||"snowflake",offlineStoreUrl:e.offlineStoreUrl||"",enableFeatureValidation:e.enableFeatureValidation!==!1,enableFeatureMonitoring:e.enableFeatureMonitoring!==!1,ttlDays:e.ttlDays||30,enableCaching:e.enableCaching!==!1,cacheSize:e.cacheSize||100,cacheTtl:e.cacheTtl||3600,maxConcurrentRequests:e.maxConcurrentRequests||100,requestTimeout:e.requestTimeout||3e4,enableDriftDetection:e.enableDriftDetection||!1,driftThreshold:e.driftThreshold||.1,...e},this.initializeFeatures(),this.initializeFeatureSets()}initializeFeatures(){if(this.config&&(this.features.clear(),this.config.features&&Array.isArray(this.config.features))){const t=Date.now();for(const e of this.config.features){const s=`${e.name}:${e.version}`,n={name:e.name,version:e.version,type:e.type||"numerical",description:e.description,dataType:e.dataType||"float64",defaultValue:e.defaultValue,tags:e.tags||[],status:"active",createdAt:t,updatedAt:t,usageCount:0};this.features.set(s,n)}}}initializeFeatureSets(){if(this.config&&(this.featureSets.clear(),this.config.featureSets&&Array.isArray(this.config.featureSets))){const t=Date.now();for(const e of this.config.featureSets){const s=`${e.name}:${e.version}`,n={name:e.name,version:e.version,features:e.features||[],description:e.description,createdAt:t,updatedAt:t,usageCount:0};this.featureSets.set(s,n)}}}processFeatureRequest(t,e,s="online",n){if(!this.config||!this.config.enabled)return{success:!1,latency:0,error:"Feature Store is not enabled"};const i=Date.now(),o=`req-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(s==="online"&&!this.config.enableOnlineServing)return{success:!1,latency:Date.now()-i,error:"Online serving is not enabled"};if(s==="offline"&&!this.config.enableOfflineServing)return{success:!1,latency:Date.now()-i,error:"Offline serving is not enabled"};let r=!1;if(s==="online"&&this.config.enableCaching){const g=this.getCacheKey(t,e),v=this.cache.get(g);if(v&&Date.now()-v.timestamp<v.ttl*1e3){r=!0,this.metrics.cacheHits++;const b=this.getOnlineLatency(!0);return this.updateRequestMetrics(o,s,!0,b,!0),{success:!0,data:v.data,latency:b,cacheHit:!0}}else this.metrics.cacheMisses++}const u=[];for(const g of t)Array.from(this.features.values()).find(b=>b.name===g&&b.status==="active")||u.push(g);if(u.length>0){const g=this.getOnlineLatency(!1);return this.updateRequestMetrics(o,s,!1,g),{success:!1,latency:g,error:`Features not found: ${u.join(", ")}`}}const d=s==="online"?this.getOnlineLatency(!1):this.getOfflineLatency();if(Math.random()<this.metrics.errorRate*.1){const g=s==="online"?this.getOnlineLatency(!1):this.getOfflineLatency();return this.updateRequestMetrics(o,s,!1,g),{success:!1,latency:g,error:"Feature retrieval failed"}}const p={};for(const g of t){const v=Array.from(this.features.values()).find(b=>b.name===g);v&&(v.usageCount++,v.lastUsed=Date.now(),p[g]=this.generateFeatureValue(v))}if(this.config.enableFeatureValidation){const g=this.validateFeatures(t,p);if(!g.valid){const v=s==="online"?this.getOnlineLatency(!1):this.getOfflineLatency();return this.updateRequestMetrics(o,s,!1,v),{success:!1,latency:v,error:`Validation failed: ${g.error}`}}}if(s==="online"&&this.config.enableCaching&&!r){const g=this.getCacheKey(t,e);if(this.cache.set(g,{data:p,timestamp:Date.now(),ttl:this.config.cacheTtl||3600}),this.cache.size>(this.config.cacheSize||100)*1024){const v=this.cache.keys().next().value;this.cache.delete(v)}}this.updateRequestMetrics(o,s,!0,d,r);for(const g of t){const v=Array.from(this.features.values()).find(b=>b.name===g);v&&(v.usageCount++,v.lastUsed=Date.now())}return{success:!0,data:p,latency:d,cacheHit:!1}}getOnlineLatency(t){if(t)return 1+Math.random()*4;switch(this.config?.onlineStoreType||"redis"){case"redis":return 5+Math.random()*10;case"dynamodb":return 10+Math.random()*20;case"cassandra":return 15+Math.random()*25;default:return 10+Math.random()*20}}getOfflineLatency(){switch(this.config?.offlineStoreType||"snowflake"){case"snowflake":return 500+Math.random()*1e3;case"bigquery":return 400+Math.random()*800;case"redshift":return 600+Math.random()*1200;default:return 500+Math.random()*1e3}}getCacheKey(t,e){const s=[...t].sort().join(","),n=e?[...e].sort().join(","):"";return`features:${s}:${n}`}generateFeatureValue(t){switch(t.type){case"numerical":return t.dataType==="int"||t.dataType==="int64"?Math.floor(Math.random()*1e3):Math.random()*100;case"categorical":const e=["A","B","C","D","E"];return e[Math.floor(Math.random()*e.length)];case"embedding":return Array.from({length:128},()=>Math.random());case"timestamp":return Date.now();default:return t.defaultValue||null}}validateFeatures(t,e){for(const s of t){const n=Array.from(this.features.values()).find(r=>r.name===s);if(!n)continue;const i=e[s],o=n.validationRules;if(o){if(o.required&&i==null)return{valid:!1,error:`Feature ${s} is required but missing`};if(n.type==="numerical"&&typeof i=="number"){if(o.min!==void 0&&i<o.min)return{valid:!1,error:`Feature ${s} value ${i} is below minimum ${o.min}`};if(o.max!==void 0&&i>o.max)return{valid:!1,error:`Feature ${s} value ${i} is above maximum ${o.max}`}}if(o.allowedValues&&!o.allowedValues.includes(i))return{valid:!1,error:`Feature ${s} value ${i} is not in allowed values`}}}return{valid:!0}}updateRequestMetrics(t,e,s,n,i){this.metrics.requestsTotal++,e==="online"?this.metrics.requestsOnline++:this.metrics.requestsOffline++,s?this.metrics.requestsSuccess++:this.metrics.requestsErrors++,this.latencyHistory.push(n),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const o=Date.now();this.requestTimestamps.push(o),this.requestTimestamps.length>this.MAX_REQUEST_TIMESTAMPS&&this.requestTimestamps.shift();const r={id:t,featureNames:[],requestType:e,timestamp:o,latency:n,status:s?"success":"error",cacheHit:i};if(this.requests.set(t,r),this.requests.size>this.MAX_REQUEST_HISTORY){const u=this.requests.keys().next().value;this.requests.delete(u)}this.config?.enableFeatureValidation&&(s?this.metrics.validationPassed++:this.metrics.validationFailed++)}updateMetrics(){const t=Date.now();(t-this.lastUpdateTime)/1e3;const e=Array.from(this.features.values());if(this.metrics.totalFeatures=e.length,this.metrics.activeFeatures=e.filter(r=>r.status==="active").length,this.metrics.deprecatedFeatures=e.filter(r=>r.status==="deprecated").length,this.metrics.totalFeatureSets=this.featureSets.size,this.latencyHistory.length>0){const r=[...this.latencyHistory].sort((u,d)=>u-d);this.metrics.averageLatency=r.reduce((u,d)=>u+d,0)/r.length,this.metrics.p50Latency=this.calculatePercentile(r,50),this.metrics.p99Latency=this.calculatePercentile(r,99)}const s=Math.floor(t/1e3),n=Math.floor(this.lastSecondStart/1e3);if(s>n){const r=this.requestTimestamps.filter(u=>u>=this.lastSecondStart&&u<s*1e3).length;this.metrics.requestsPerSecond=r,this.metrics.throughput=r,this.lastSecondStart=s*1e3}this.metrics.requestsTotal>0&&(this.metrics.errorRate=this.metrics.requestsErrors/this.metrics.requestsTotal);const i=this.metrics.cacheHits+this.metrics.cacheMisses;i>0&&(this.metrics.cacheHitRate=this.metrics.cacheHits/i),this.metrics.onlineStoreUtilization=Math.min(1,this.metrics.requestsOnline/(this.config?.maxConcurrentRequests||100)),this.metrics.offlineStoreUtilization=Math.min(1,this.metrics.requestsOffline/10);const o=new Map;for(const r of e)o.set(r.name,(o.get(r.name)||0)+r.usageCount);this.metrics.topFeatures=Array.from(o.entries()).map(([r,u])=>({name:r,usage:u})).sort((r,u)=>u.usage-r.usage).slice(0,10),this.metrics.totalFeatureUsage=e.reduce((r,u)=>r+u.usageCount,0),this.metricsHistory.push({timestamp:t,latency:this.metrics.averageLatency,rps:this.metrics.requestsPerSecond,errorRate:this.metrics.errorRate,throughput:this.metrics.throughput,cacheHitRate:this.metrics.cacheHitRate}),this.metricsHistory.length>this.MAX_METRICS_HISTORY&&this.metricsHistory.shift(),this.lastUpdateTime=t}calculatePercentile(t,e){if(t.length===0)return 0;const s=e/100*(t.length-1),n=Math.floor(s),i=Math.ceil(s),o=s-n;return n===i?t[n]:t[n]*(1-o)+t[i]*o}getMetrics(){return{...this.metrics}}getFeatures(){return Array.from(this.features.values())}getFeatureSets(){return Array.from(this.featureSets.values())}getFeature(t,e){return this.features.get(`${t}:${e}`)}addFeature(t){const e=`${t.name}:${t.version}`,s=this.features.get(e),n=Date.now(),i={...t,createdAt:s?.createdAt||n,updatedAt:n,usageCount:s?.usageCount||0,lastUsed:s?.lastUsed};this.features.set(e,i)}removeFeature(t,e){this.features.delete(`${t}:${e}`)}addFeatureSet(t){const e=`${t.name}:${t.version}`,s=this.featureSets.get(e),n=Date.now(),i={...t,createdAt:s?.createdAt||n,updatedAt:n,usageCount:s?.usageCount||0,lastUsed:s?.lastUsed};this.featureSets.set(e,i)}removeFeatureSet(t,e){this.featureSets.delete(`${t}:${e}`)}getMetricsHistory(){return[...this.metricsHistory]}getRecentRequests(t=100){return Array.from(this.requests.values()).sort((e,s)=>s.timestamp-e.timestamp).slice(0,t)}performUpdate(t,e=!1){!this.config||!this.config.enabled||(this.processPendingRequests(t),e&&this.pendingRequests.length===0&&this.simulateRequests(t),this.updateMetrics(),this.cleanupCache())}processPendingRequests(t){for(;this.pendingRequests.length>0;){const e=this.pendingRequests.shift();if(!e)break;try{const s=this.processFeatureRequest(e.featureNames,e.entityIds,e.requestType);s.success?e.resolve(s.data):e.reject(new Error(s.error||"Feature request failed"))}catch(s){e.reject(s instanceof Error?s:new Error("Unknown error"))}}}simulateRequests(t){const e=this.getFeatures();if(e.length===0)return;const s=1+Math.floor(Math.random()*4);for(let n=0;n<s;n++){const i=1+Math.floor(Math.random()*3),o=e.filter(u=>u.status==="active").sort(()=>Math.random()-.5).slice(0,i).map(u=>u.name);if(o.length===0)continue;const r=Math.random()<.8?"online":"offline";this.processFeatureRequest(o,void 0,r)}}cleanupCache(){const t=Date.now();for(const[e,s]of this.cache.entries())t-s.timestamp>s.ttl*1e3&&this.cache.delete(e)}}class Mb{services=new Map;virtualServices=new Map;destinationRules=new Map;gateways=new Map;peerAuthentications=new Map;authorizationPolicies=new Map;serviceEntries=new Map;sidecars=new Map;globalConfig={};roundRobinCounters=new Map;leastConnCounts=new Map;consistentHashRing=new Map;connectionPoolCounts=new Map;circuitBreakerState=new Map;outlierDetectionState=new Map;mtlsConnections=new Map;requestCount=0;responseCount=0;errorCount=0;totalBytesIn=0;totalBytesOut=0;activeConnections=0;totalLatency=0;circuitBreakerTrips=0;retryAttempts=0;timeoutErrors=0;rateLimitBlocks=0;serviceEndpoints=new Map;initialize(t){if(this.services.clear(),this.virtualServices.clear(),this.destinationRules.clear(),this.gateways.clear(),this.peerAuthentications.clear(),this.authorizationPolicies.clear(),this.serviceEntries.clear(),this.sidecars.clear(),this.roundRobinCounters.clear(),this.leastConnCounts.clear(),this.consistentHashRing.clear(),this.circuitBreakerState.clear(),this.outlierDetectionState.clear(),this.mtlsConnections.clear(),this.serviceEndpoints.clear(),this.connectionPoolCounts.clear(),this.globalConfig=t.globalConfig||{},t.services)for(const e of t.services){const s=this.normalizeHost(e.host);if(this.services.set(s,e),e.ports&&e.ports.length>0){const n=e.ports[0].number,i=`${s}:default`;this.serviceEndpoints.set(i,[{address:e.host,port:n,weight:100,healthy:!0,labels:e.labels}])}}if(t.virtualServices)for(const e of t.virtualServices)this.virtualServices.set(e.name,e);if(t.destinationRules){for(const e of t.destinationRules)if(this.destinationRules.set(e.name,e),e.subsets)for(const s of e.subsets){const n=`${e.host}:${s.name}`;this.roundRobinCounters.set(n,0),this.leastConnCounts.set(n,new Map);const i=this.services.get(this.normalizeHost(e.host));if(i&&i.ports&&i.ports.length>0){const o=i.ports[0].number;this.serviceEndpoints.set(n,[{address:i.host,port:o,weight:100,healthy:!0,labels:s.labels}])}}}if(t.gateways)for(const e of t.gateways)this.gateways.set(e.name,e);if(t.peerAuthentications)for(const e of t.peerAuthentications)this.peerAuthentications.set(e.name,e);if(t.authorizationPolicies)for(const e of t.authorizationPolicies)this.authorizationPolicies.set(e.name,e);if(t.serviceEntries){for(const e of t.serviceEntries)if(this.serviceEntries.set(e.name,e),e.endpoints)for(const s of e.hosts){const n=this.normalizeHost(s);if(e.ports&&e.ports.length>0){const i=e.ports[0].number,o=`${n}:default`;this.serviceEndpoints.set(o,e.endpoints.map(r=>({address:r.address,port:r.ports?Object.values(r.ports)[0]:i,weight:r.weight||100,healthy:!0,labels:r.labels})))}}}if(t.sidecars)for(const e of t.sidecars)this.sidecars.set(e.name,e);this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.circuitBreakerTrips=0,this.retryAttempts=0,this.timeoutErrors=0,this.rateLimitBlocks=0}routeRequest(t,e){const s=Date.now();this.requestCount++,this.activeConnections++;try{if(!this.checkMTLS(t).allowed)return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:403,error:"mTLS authentication failed",latency:Date.now()-s}};const i=this.checkAuthorization(t);if(!i.allowed)return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:403,error:i.reason||"Authorization denied",latency:Date.now()-s}};const o=this.findMatchingVirtualService(t,e);if(!o){const g=this.findServiceByHost(t.host||"");if(!g)return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:404,error:`Service not found: ${t.host}`,latency:Date.now()-s}};const v=this.routeToService(g.host,void 0,t,s);return this.activeConnections--,v}const r=this.matchHTTPRoute(o,t);if(!r)return this.activeConnections--,this.errorCount++,{virtualService:o,destinationRule:null,response:{status:404,error:"No matching route in VirtualService",latency:Date.now()-s}};const u=this.applyFaultInjection(r.fault,t);if(u.abort)return this.activeConnections--,this.errorCount++,{virtualService:o,destinationRule:null,response:{status:u.abort.httpStatus||500,error:"Fault injection: abort",latency:Date.now()-s}};if(u.delay){const g=this.parseDuration(u.delay.fixedDelay||"0s")}let d=null;if(r.route&&r.route.length>0)d=this.selectDestination(r.route,t);else if(r.redirect)return this.activeConnections--,this.responseCount++,{virtualService:o,destinationRule:null,response:{status:r.redirect.redirectCode||301,headers:{Location:r.redirect.uri||r.redirect.authority||""},latency:Date.now()-s}};if(!d)return this.activeConnections--,this.errorCount++,{virtualService:o,destinationRule:null,response:{status:500,error:"No destination configured",latency:Date.now()-s}};const h=this.findDestinationRule(d.host),p=this.routeToService(d.host,d.subset,d.port,t,s,r.retries,r.timeout,h);return p.virtualService=o,p.destinationRule=h,this.activeConnections--,p}catch(n){return this.activeConnections--,this.errorCount++,{virtualService:null,destinationRule:null,response:{status:500,error:n.message||"Internal error",latency:Date.now()-s}}}}checkMTLS(t){const e=this.globalConfig.mtlsMode||(this.globalConfig.enableMTLS?"PERMISSIVE":"DISABLE");if(e==="DISABLE")return{allowed:!0};for(const s of this.peerAuthentications.values())if(s.mtls){if(s.mtls.mode==="STRICT"&&!t.sourcePrincipal)return{allowed:!1,reason:"mTLS required but not provided"};if(s.mtls.mode==="DISABLE")return{allowed:!0}}return e==="STRICT"&&!t.sourcePrincipal?{allowed:!1,reason:"mTLS required in STRICT mode"}:{allowed:!0}}checkAuthorization(t){const e=[];for(const s of this.authorizationPolicies.values())this.matchesAuthorizationPolicy(s,t)&&e.push(s);if(e.length===0)return{allowed:!0};for(const s of e){const n=s.action||"ALLOW";if(n==="DENY")return{allowed:!1,reason:`Denied by policy: ${s.name}`};if(n==="ALLOW"){if(s.rules&&s.rules.length>0){let i=!1;for(const o of s.rules)if(this.matchesAuthorizationRule(o,t)){i=!0;break}if(!i)return{allowed:!1,reason:`No matching rule in policy: ${s.name}`}}return{allowed:!0}}}return{allowed:!0}}matchesAuthorizationPolicy(t,e){return!t.selector||!t.selector.matchLabels,!0}matchesAuthorizationRule(t,e){if(t.from&&t.from.length>0){let s=!1;for(const n of t.from)if(n.source)if(n.source.principals&&e.sourcePrincipal){if(n.source.principals.includes(e.sourcePrincipal)||n.source.principals.includes("*")){s=!0;break}}else s=!0;else s=!0;if(!s)return!1}if(t.to&&t.to.length>0){let s=!1;for(const n of t.to)if(n.operation){if(n.operation.methods&&!n.operation.methods.includes(e.method)||n.operation.paths&&!n.operation.paths.some(i=>e.path.startsWith(i))||n.operation.hosts&&e.host&&!n.operation.hosts.includes(e.host))continue;s=!0;break}else s=!0;if(!s)return!1}return!0}findMatchingVirtualService(t,e){const s=t.host||t.authority||"";for(const n of this.virtualServices.values())if(n.hosts.some(o=>{if(o==="*"||o===s)return!0;if(o.startsWith("*.")){const r=o.substring(2);return s.endsWith("."+r)||s===r}return!1})&&!(e&&n.gateways&&n.gateways.length>0&&!n.gateways.includes(e)))return n;return null}matchHTTPRoute(t,e){if(!t.http||t.http.length===0)return null;for(const s of t.http){if(!s.match||s.match.length===0)return{route:s.route,redirect:s.redirect,rewrite:s.rewrite,timeout:s.timeout,retries:s.retries,fault:s.fault};for(const n of s.match){let i=!0;if(n.uri){if(n.uri.exact&&e.path!==n.uri.exact){i=!1;continue}if(n.uri.prefix&&!e.path.startsWith(n.uri.prefix)){i=!1;continue}if(n.uri.regex&&!new RegExp(n.uri.regex).test(e.path)){i=!1;continue}}if(n.method){if(n.method.exact&&e.method!==n.method.exact){i=!1;continue}if(n.method.regex&&!new RegExp(n.method.regex).test(e.method)){i=!1;continue}}if(n.headers)for(const[o,r]of Object.entries(n.headers)){const u=e.headers?.[o.toLowerCase()];if(!u){i=!1;break}if(r.exact&&u!==r.exact){i=!1;break}if(r.prefix&&!u.startsWith(r.prefix)){i=!1;break}if(r.regex&&!new RegExp(r.regex).test(u)){i=!1;break}}if(i)return{route:s.route,redirect:s.redirect,rewrite:s.rewrite,timeout:s.timeout,retries:s.retries,fault:s.fault}}}return null}applyFaultInjection(t,e){if(!t)return{};const s={};if(t.delay){const n=t.delay.percentage?.value||0;Math.random()*100<n&&(s.delay=t.delay)}if(t.abort){const n=t.abort.percentage?.value||0;Math.random()*100<n&&(s.abort=t.abort)}return s}selectDestination(t,e){if(t.length===0)return null;if(t.length===1)return t[0].destination;const s=t.reduce((o,r)=>o+(r.weight||100),0),n=Math.random()*s;let i=0;for(const o of t)if(i+=o.weight||100,n<=i)return o.destination;return t[0].destination}findDestinationRule(t){const e=this.normalizeHost(t);for(const s of this.destinationRules.values())if(this.normalizeHost(s.host)===e)return s;return null}routeToService(t,e,s,n,i,o,r,u){const d=`${t}:${e||"default"}`,h=this.circuitBreakerState.get(d);if(h?.isOpen&&(!h.openUntil||Date.now()<h.openUntil))return this.circuitBreakerTrips++,this.errorCount++,{virtualService:null,destinationRule:u||null,response:{status:503,error:"Circuit breaker is open",latency:Date.now()-i,circuitBreakerOpen:!0},serviceTarget:t,subsetTarget:e};const p=this.serviceEndpoints.get(d)||[];if(p.length===0)return this.errorCount++,{virtualService:null,destinationRule:u||null,response:{status:503,error:"No endpoints available",latency:Date.now()-i},serviceTarget:t,subsetTarget:e};const g=this.getTrafficPolicy(t,e,u),v=g?.connectionPool?.tcp?.maxConnections;if(v){const T=this.connectionPoolCounts.get(d)||0;if(T>=v)return this.errorCount++,{virtualService:null,destinationRule:u||null,response:{status:503,error:"Connection pool exhausted",latency:Date.now()-i},serviceTarget:t,subsetTarget:e};this.connectionPoolCounts.set(d,T+1)}const b=this.selectEndpoint(p,d,n,g),x=g?.connectionPool?.tcp?.connectTimeout,R=r?this.parseDuration(r):x?this.parseDuration(x):this.globalConfig.defaultTimeout?this.parseDuration(this.globalConfig.defaultTimeout):3e4,C=o?.attempts||this.globalConfig.defaultRetryAttempts||0;let k=null;for(let T=0;T<=C;T++){T>0&&this.retryAttempts++;const A=this.simulateEndpointRequest(b,n,R);if(A.status>=200&&A.status<500){if(this.responseCount++,this.totalLatency+=A.latency||0,v){const D=this.connectionPoolCounts.get(d)||0;D>0&&this.connectionPoolCounts.set(d,D-1)}return h&&(h.consecutiveErrors=0,h.isOpen&&h.halfOpenRequests!==void 0&&(h.halfOpenRequests++,h.halfOpenRequests>=3&&(h.isOpen=!1,h.halfOpenRequests=void 0))),{virtualService:null,destinationRule:u||null,response:{...A,serviceTarget:t,subsetTarget:e,endpointTarget:`${b.address}:${b.port}`,retryAttempts:T}}}if(!(A.status>=500&&(k=A,(o?.retryOn||"5xx,reset,connect-failure").includes("5xx")&&A.status>=500&&T<C))){if(v){const D=this.connectionPoolCounts.get(d)||0;D>0&&this.connectionPoolCounts.set(d,D-1)}if(h){h.consecutiveErrors++;const D=u?.trafficPolicy?.outlierDetection?.consecutiveErrors||5;h.consecutiveErrors>=D&&(h.isOpen=!0,h.openUntil=Date.now()+(this.parseDuration(u?.trafficPolicy?.outlierDetection?.baseEjectionTime||"30s")||3e4),h.halfOpenRequests=0)}this.errorCount++;break}}return{virtualService:null,destinationRule:u||null,response:{...k||{status:500,error:"Request failed after retries",latency:Date.now()-i},serviceTarget:t,subsetTarget:e,endpointTarget:`${b.address}:${b.port}`,retryAttempts:C}}}getTrafficPolicy(t,e,s){if(!s)return null;if(e&&s.subsets){const n=s.subsets.find(i=>i.name===e);if(n?.trafficPolicy)return n.trafficPolicy}return s.trafficPolicy||null}selectEndpoint(t,e,s,n){const i=t.filter(r=>r.healthy!==!1);if(i.length===0)return t[0];switch(n?.loadBalancer?.simple||"ROUND_ROBIN"){case"ROUND_ROBIN":{const r=this.roundRobinCounters.get(e)||0,u=i[r%i.length];return this.roundRobinCounters.set(e,r+1),u}case"LEAST_CONN":{let r=1/0,u=i[0];const d=this.leastConnCounts.get(e)||new Map;for(const p of i){const g=`${p.address}:${p.port}`,v=d.get(g)||0;v<r&&(r=v,u=p)}const h=`${u.address}:${u.port}`;return d.set(h,(d.get(h)||0)+1),this.leastConnCounts.set(e,d),u}case"RANDOM":return i[Math.floor(Math.random()*i.length)];case"PASSTHROUGH":default:return i[0]}}simulateEndpointRequest(t,e,s){const n=10+Math.random()*90,i=Math.random()*50,o=n+i;return Math.random()<.01?{status:500,error:"Internal server error",latency:o}:o>s?(this.timeoutErrors++,{status:504,error:"Gateway timeout",latency:s}):{status:200,latency:o}}findServiceByHost(t){const e=this.normalizeHost(t);return this.services.get(e)||null}normalizeHost(t){return t.toLowerCase().trim()}parseDuration(t){const e=t.match(/^(\d+)(ms|s|m|h)$/);if(!e)return 0;const s=parseInt(e[1],10);switch(e[2]){case"ms":return s;case"s":return s*1e3;case"m":return s*60*1e3;case"h":return s*60*60*1e3;default:return 0}}getStats(){const t=this.responseCount>0?this.totalLatency/this.responseCount:0,e=this.requestCount>0?this.errorCount/this.requestCount:0;return{services:this.services.size,virtualServices:this.virtualServices.size,destinationRules:this.destinationRules.size,gateways:this.gateways.size,totalRequests:this.requestCount,totalResponses:this.responseCount,totalErrors:this.errorCount,activeConnections:this.activeConnections,totalBytesIn:this.totalBytesIn,totalBytesOut:this.totalBytesOut,errorRate:e,averageLatency:t,mtlsConnections:Array.from(this.mtlsConnections.values()).filter(s=>s).length,circuitBreakerTrips:this.circuitBreakerTrips,retryAttempts:this.retryAttempts,timeoutErrors:this.timeoutErrors,rateLimitBlocks:this.rateLimitBlocks}}resetStats(){this.requestCount=0,this.responseCount=0,this.errorCount=0,this.totalBytesIn=0,this.totalBytesOut=0,this.activeConnections=0,this.totalLatency=0,this.circuitBreakerTrips=0,this.retryAttempts=0,this.timeoutErrors=0,this.rateLimitBlocks=0}}class Wk{istioEngine;constructor(){this.istioEngine=new Mb}initialize(t){const e=(t.services||[]).map(s=>({id:s.id||s.name,name:s.name,namespace:s.namespace||"default",host:s.host||`${s.name}.${s.namespace||"default"}.svc.cluster.local`,ports:s.ports||[{number:80,protocol:"HTTP"}],labels:s.labels||{},requests:s.requests||0,errors:s.errors||0,latency:s.latency||0,pods:s.pods||1,healthyPods:s.healthyPods||s.pods||1}));this.istioEngine.initialize({services:e,virtualServices:t.virtualServices||[],destinationRules:t.destinationRules||[],gateways:t.gateways||[],peerAuthentications:t.peerAuthentications||[],authorizationPolicies:t.authorizationPolicies||[],serviceEntries:t.serviceEntries||[],sidecars:t.sidecars||[],globalConfig:t.globalConfig})}updateConfig(t){this.initialize(t)}routeRequest(t){return this.istioEngine.routeRequest(t)}getStats(){return this.istioEngine.getStats()}resetStats(){this.istioEngine.resetStats()}getIstioEngine(){return this.istioEngine}}class Kk{errors=[];maxErrors=200;errorCounts=new Map;listeners=[];addError(t,e={}){const s=this.generateErrorId(t,e),n=this.errorCounts.get(s)||0;this.errorCounts.set(s,n+1);const i=this.errors.find(r=>r.id===s);if(i&&i.count!==void 0)return i.count=n+1,i.timestamp=Date.now(),this.notifyListeners(i),s;const o={id:s,timestamp:Date.now(),severity:e.severity||this.determineSeverity(t),source:e.source||"unknown",componentId:e.componentId,componentLabel:e.componentLabel,componentType:e.componentType,message:t instanceof Error?t.message:String(t),errorType:t instanceof Error?t.constructor.name:void 0,stack:t instanceof Error?t.stack:void 0,context:e.context,count:n+1};if(this.errors.unshift(o),this.errors.length>this.maxErrors){const r=this.errors.pop();r&&this.errorCounts.delete(r.id)}return this.notifyListeners(o),s}generateErrorId(t,e){const s=t instanceof Error?t.message:String(t),n=`${e.source||"unknown"}-${e.componentType||"unknown"}-${e.componentId||"global"}-${s}`;let i=0;for(let o=0;o<n.length;o++){const r=n.charCodeAt(o);i=(i<<5)-i+r,i=i&i}return`error-${Math.abs(i)}`}determineSeverity(t){if(t instanceof Error){const e=t.constructor.name,s=t.message.toLowerCase();if(e==="RangeError"||e==="ReferenceError"||s.includes("maximum call stack")||s.includes("cannot read property")||s.includes("is not a function"))return"critical";if(e==="TypeError"||s.includes("undefined")||s.includes("null"))return"warning"}return"info"}getErrors(){return[...this.errors]}getErrorsBySeverity(t){return this.errors.filter(e=>e.severity===t)}getErrorsBySource(t){return this.errors.filter(e=>e.source===t)}getErrorsByComponent(t){return this.errors.filter(e=>e.componentId===t)}getCriticalErrors(){return this.getErrorsBySeverity("critical")}getErrorCount(t){return t?this.getErrorsBySeverity(t).length:this.errors.length}clear(){this.errors=[],this.errorCounts.clear()}clearByFilter(t){this.errors=this.errors.filter(e=>{const s=!t(e);return s||this.errorCounts.delete(e.id),s})}removeError(t){this.errors=this.errors.filter(e=>e.id!==t),this.errorCounts.delete(t)}onError(t){return this.listeners.push(t),()=>{const e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}}notifyListeners(t){this.listeners.forEach(e=>{try{e(t)}catch(s){console.error("Error in error listener:",s)}})}getStats(){const t={total:this.errors.length,critical:this.getErrorCount("critical"),warning:this.getErrorCount("warning"),info:this.getErrorCount("info"),bySource:{}};return["emulation-engine","component-engine","alert-system","data-flow","routing-engine","initialization","configuration","unknown"].forEach(s=>{t.bySource[s]=this.getErrorsBySource(s).length}),t}}const Ke=new Kk;class Gf{config;constructor(t){this.config=t}}class sv extends Gf{cache=new Map;rateLimitCounters=new Map;awsConfig;constructor(t){super(t),this.awsConfig=t.providerConfig}authenticate(t,e){if(e.authRequired===!1)return{success:!0};if(!(e.authRequired!==void 0?e.authRequired:this.config.enableAuthentication))return{success:!0};if(this.config.authType==="api-key"&&this.config.keys){const n=this.config.keys.find(i=>i.key===t.apiKey||t.headers?.["x-api-key"]===i.key);return!n||!n.enabled?{success:!1,statusCode:403,error:"Invalid API Key"}:n.apiIds.includes(e.id)?(e.authScopes&&e.authScopes.length>0&&this.config.authType,{success:!0,key:n}):{success:!1,statusCode:403,error:"API Key does not have access to this API"}}return this.awsConfig.authorizers&&this.awsConfig.authorizers.length>0?{success:!0}:{success:!1,statusCode:401,error:"Unauthorized"}}checkRateLimit(t,e,s){if(!this.config.enableRateLimiting)return{allowed:!0};const n=Date.now(),i=s?`key-${s.id}`:`api-${e.id}`,o=s?.rateLimit||e.rateLimit||this.config.defaultRateLimit||1e3,r=60*1e3,u=this.rateLimitCounters.get(i);return!u||u.resetAt<n?(this.rateLimitCounters.set(i,{count:1,resetAt:n+r}),{allowed:!0,remaining:o-1,resetAt:n+r}):u.count>=o?{allowed:!1,remaining:0,resetAt:u.resetAt}:(u.count++,{allowed:!0,remaining:o-u.count,resetAt:u.resetAt})}calculateLatency(t,e){let s=50+Math.random()*50;this.config.enableAuthentication&&(s+=10,this.awsConfig.authorizers&&this.awsConfig.authorizers.length>0&&(s+=20)),this.config.enableRateLimiting&&(s+=5),(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching)&&(s+=3),this.config.enableRequestLogging&&(s+=2),this.awsConfig.enableXRay&&(s+=5);const i=this.calculateUtilization();return s+=i*30,Math.round(s)}getCachedResponse(t,e){if(!(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching))return null;const n=this.cache.get(t);return!n||n.expiresAt<Date.now()?(this.cache.delete(t),null):n.response}setCachedResponse(t,e,s){const n=Date.now()+s*1e3;this.cache.set(t,{response:e,expiresAt:n})}generateCacheKey(t,e){const n=(e.caching?.cacheKey||["method","path"]).map(i=>i==="method"?t.method:i==="path"?t.path:i==="query"?JSON.stringify(t.query||{}):t.headers?.[i]||"");return`${e.id}:${n.join(":")}`}getProviderSpecificMetrics(){return{cacheHitRate:this.calculateCacheHitRate(),xRayEnabled:this.awsConfig.enableXRay?1:0,stagesCount:this.awsConfig.stages?.length||0,usagePlansCount:this.awsConfig.usagePlans?.length||0}}calculateUtilization(){const t=Array.from(this.rateLimitCounters.values()).reduce((s,n)=>s+n.count,0),e=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1);return Math.min(t/e,1)}calculateCacheHitRate(){return .3}}class nv extends Gf{cache=new Map;rateLimitCounters=new Map;azureConfig;constructor(t){super(t),this.azureConfig=t.providerConfig}authenticate(t,e){if(e.authRequired===!1)return{success:!0};if(!(e.authRequired!==void 0?e.authRequired:this.config.enableAuthentication))return{success:!0};if(this.config.authType==="api-key"){const n=t.headers?.["ocp-apim-subscription-key"]||t.query?.["subscription-key"]||t.apiKey;if(!n)return{success:!1,statusCode:401,error:"Missing subscription key"};const i=this.azureConfig.subscriptions?.find(r=>r.primaryKey===n||r.secondaryKey===n);if(!i||i.state!=="active")return{success:!1,statusCode:401,error:"Invalid subscription key"};const o=this.azureConfig.products?.find(r=>r.apis?.includes(e.id));return o&&o.subscriptionRequired&&i.productId!==o.id?{success:!1,statusCode:403,error:"Subscription does not have access to this API"}:{success:!0}}return{success:!1,statusCode:401,error:"Unauthorized"}}checkRateLimit(t,e,s){if(!this.config.enableRateLimiting)return{allowed:!0};const n=t.headers?.["ocp-apim-subscription-key"]||t.query?.["subscription-key"],i=this.azureConfig.subscriptions?.find(p=>p.primaryKey===n||p.secondaryKey===n),o=Date.now(),r=i?`sub-${i.id}`:`api-${e.id}`,u=e.rateLimit||this.config.defaultRateLimit||1e3,d=60*1e3,h=this.rateLimitCounters.get(r);return!h||h.resetAt<o?(this.rateLimitCounters.set(r,{count:1,resetAt:o+d}),{allowed:!0,remaining:u-1,resetAt:o+d}):h.count>=u?{allowed:!1,remaining:0,resetAt:h.resetAt}:(h.count++,{allowed:!0,remaining:u-h.count,resetAt:h.resetAt})}calculateLatency(t,e){let s=30+Math.random()*50;const n=this.azureConfig.policies?.filter(r=>r.scope==="Global"||r.scope==="API"||r.scope==="Operation"&&r.scopeId===e.id).length||0;s+=n*5,this.config.enableAuthentication&&(s+=8),this.config.enableRateLimiting&&(s+=4),(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching)&&(s+=2),this.azureConfig.enableApplicationInsights&&(s+=3);const o=this.calculateUtilization();return s+=o*25,Math.round(s)}getCachedResponse(t,e){if(!(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching))return null;const n=this.cache.get(t);return!n||n.expiresAt<Date.now()?(this.cache.delete(t),null):n.response}setCachedResponse(t,e,s){const n=Date.now()+s*1e3;this.cache.set(t,{response:e,expiresAt:n})}generateCacheKey(t,e){const n=(e.caching?.cacheKey||["method","path"]).map(i=>i==="method"?t.method:i==="path"?t.path:i==="query"?JSON.stringify(t.query||{}):t.headers?.[i]||"");return`${e.id}:${n.join(":")}`}getProviderSpecificMetrics(){return{cacheHitRate:this.calculateCacheHitRate(),productsCount:this.azureConfig.products?.length||0,subscriptionsCount:this.azureConfig.subscriptions?.length||0,policiesCount:this.azureConfig.policies?.length||0,applicationInsightsEnabled:this.azureConfig.enableApplicationInsights?1:0}}calculateUtilization(){const t=Array.from(this.rateLimitCounters.values()).reduce((s,n)=>s+n.count,0),e=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1);return Math.min(t/e,1)}calculateCacheHitRate(){return .25}}class iv extends Gf{cache=new Map;rateLimitCounters=new Map;gcpConfig;constructor(t){super(t),this.gcpConfig=t.providerConfig}authenticate(t,e){if(e.authRequired===!1)return{success:!0};if(!(e.authRequired!==void 0?e.authRequired:this.config.enableAuthentication))return{success:!0};if(this.config.authType==="api-key"&&this.config.keys){const n=t.headers?.["x-api-key"]||t.query?.key||t.apiKey;if(!n)return{success:!1,statusCode:401,error:"Missing API key"};const i=this.config.keys.find(r=>r.key===n);if(!i||!i.enabled)return{success:!1,statusCode:403,error:"Invalid API key"};const o=i.providerMetadata?.gcp?.restrictions;if(o){if(o.apiTargets&&!o.apiTargets.some(r=>r.service===this.gcpConfig.serviceName&&(r.methods.includes(e.method)||r.methods.includes("*"))))return{success:!1,statusCode:403,error:"API key does not have access to this endpoint"};if(o.httpReferrers&&t.headers?.referer){const r=t.headers.referer;if(!o.httpReferrers.some(u=>r.includes(u)))return{success:!1,statusCode:403,error:"API key restricted by referer"}}if(o.ipAddresses&&t.headers?.["x-forwarded-for"]){const r=t.headers["x-forwarded-for"].split(",")[0].trim();if(!o.ipAddresses.some(u=>r.startsWith(u)))return{success:!1,statusCode:403,error:"API key restricted by IP address"}}}return i.apiIds.includes(e.id)?{success:!0,key:i}:{success:!1,statusCode:403,error:"API key does not have access to this API"}}return{success:!1,statusCode:401,error:"Unauthorized"}}checkRateLimit(t,e,s){if(!this.config.enableRateLimiting)return{allowed:!0};const n=this.gcpConfig.quotas?.find(h=>h.metric==="requests");if(n){const h=Date.now(),p=`quota-${n.id}`,g=this.rateLimitCounters.get(p);return!g||g.resetAt<h?(this.rateLimitCounters.set(p,{count:1,resetAt:h+6e4}),{allowed:!0,remaining:n.limit-1,resetAt:h+6e4}):g.count>=n.limit?{allowed:!1,remaining:0,resetAt:g.resetAt}:(g.count++,{allowed:!0,remaining:n.limit-g.count,resetAt:g.resetAt})}const i=Date.now(),o=s?`key-${s.id}`:`api-${e.id}`,r=s?.rateLimit||e.rateLimit||this.config.defaultRateLimit||1e3,u=60*1e3,d=this.rateLimitCounters.get(o);return!d||d.resetAt<i?(this.rateLimitCounters.set(o,{count:1,resetAt:i+u}),{allowed:!0,remaining:r-1,resetAt:i+u}):d.count>=r?{allowed:!1,remaining:0,resetAt:d.resetAt}:(d.count++,{allowed:!0,remaining:r-d.count,resetAt:d.resetAt})}calculateLatency(t,e){let s=40+Math.random()*50;this.gcpConfig.openApiSpec&&(s+=15),s+=10,this.config.enableAuthentication&&(s+=12),this.config.enableRateLimiting&&(s+=5),(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching)&&(s+=3),this.gcpConfig.enableCloudLogging&&(s+=4);const i=this.calculateUtilization();return s+=i*30,Math.round(s)}getCachedResponse(t,e){if(!(e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching))return null;const n=this.cache.get(t);return!n||n.expiresAt<Date.now()?(this.cache.delete(t),null):n.response}setCachedResponse(t,e,s){const n=Date.now()+s*1e3;this.cache.set(t,{response:e,expiresAt:n})}generateCacheKey(t,e){const n=(e.caching?.cacheKey||["method","path"]).map(i=>i==="method"?t.method:i==="path"?t.path:i==="query"?JSON.stringify(t.query||{}):t.headers?.[i]||"");return`${e.id}:${n.join(":")}`}getProviderSpecificMetrics(){return{cacheHitRate:this.calculateCacheHitRate(),quotasCount:this.gcpConfig.quotas?.length||0,serviceAccountsCount:this.gcpConfig.serviceAccounts?.length||0,openApiSpecSize:this.gcpConfig.openApiSpec?.length||0,cloudLoggingEnabled:this.gcpConfig.enableCloudLogging?1:0,cloudMonitoringEnabled:this.gcpConfig.enableCloudMonitoring?1:0}}calculateUtilization(){const t=Array.from(this.rateLimitCounters.values()).reduce((s,n)=>s+n.count,0),e=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1);return Math.min(t/e,1)}calculateCacheHitRate(){return .35}}class Yk{config;providerEngine;requestCount=0;errorCount=0;totalLatency=0;latencyHistory=[];constructor(t){switch(this.config=t,t.provider){case"aws":this.providerEngine=new sv(t);break;case"azure":this.providerEngine=new nv(t);break;case"gcp":this.providerEngine=new iv(t);break;default:throw new Error(`Unsupported provider: ${t.provider}`)}}processRequest(t){const e=this.findRoute(t);if(!e||!e.enabled)return{status:404,latency:5,error:"API not found",metadata:{gatewayProvider:this.config.provider}};const s=this.providerEngine.authenticate(t,e);if(!s.success)return this.errorCount++,{status:s.statusCode||401,latency:this.providerEngine.calculateLatency(t,e),error:s.error,metadata:{gatewayProvider:this.config.provider,apiId:e.id}};const n=this.providerEngine.checkRateLimit(t,e,s.key);if(!n.allowed)return this.errorCount++,{status:429,latency:this.providerEngine.calculateLatency(t,e),error:"Rate limit exceeded",headers:{"X-RateLimit-Limit":String(e.rateLimit||this.config.defaultRateLimit||1e3),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(n.resetAt||Date.now()+6e4)},metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:s.key?.id}};const i=this.providerEngine.generateCacheKey(t,e),o=this.providerEngine.getCachedResponse(i,e);if(o)return this.requestCount++,{...o,metadata:{...o.metadata,cacheHit:!0}};const r=this.providerEngine.calculateLatency(t,e),d=(e.timeout||this.config.requestTimeout||30)*1e3,h=r+Math.random()*100;if(h>d)return this.errorCount++,{status:504,latency:d,error:"Gateway Timeout",metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:s.key?.id}};const p=h/d,g=p>.8?Math.min(h+(p-.8)*200,d-10):h;this.requestCount++,this.totalLatency+=g,this.latencyHistory.push(g),this.latencyHistory.length>100&&this.latencyHistory.shift();const v=e.caching?.enabled!==void 0?e.caching.enabled:this.config.enableCaching,b={status:200,latency:Math.round(g),metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:s.key?.id,cacheHit:!1,rateLimitRemaining:n.remaining,rateLimitReset:n.resetAt}};if(v){const x=e.caching?.ttl||this.config.cacheTTL||300;this.providerEngine.setCachedResponse(i,b,x)}return{status:200,latency:Math.round(g),metadata:{gatewayProvider:this.config.provider,apiId:e.id,keyId:s.key?.id,cacheHit:!1,rateLimitRemaining:n.remaining,rateLimitReset:n.resetAt}}}findRoute(t){if(!this.config.apis)return;let e=this.config.apis.find(s=>s.path===t.path&&(s.method===t.method||s.method==="ALL")&&s.enabled);return e||(e=this.config.apis.find(s=>t.path.startsWith(s.path)&&(s.method===t.method||s.method==="ALL")&&s.enabled)),e}calculateMetrics(){const t=this.requestCount/60,e=this.requestCount>0?this.totalLatency/this.requestCount:0,s=[...this.latencyHistory].sort((p,g)=>p-g),n=s.length>0?s[Math.floor(s.length*.5)]:void 0,i=s.length>0?s[Math.floor(s.length*.95)]:void 0,o=s.length>0?s[Math.floor(s.length*.99)]:void 0,r=this.requestCount>0?this.errorCount/this.requestCount:0,u=(this.config.defaultRateLimit||1e3)*(this.config.apis?.length||1),d=Math.min(t/u,1),h=this.providerEngine.getProviderSpecificMetrics();return{throughput:t,latency:e,latencyP50:n,latencyP95:i,latencyP99:o,errorRate:r,utilization:d,customMetrics:{...h,totalRequests:this.requestCount,totalErrors:this.errorCount,apisCount:this.config.apis?.length||0,keysCount:this.config.keys?.length||0}}}resetMetrics(){this.requestCount=0,this.errorCount=0,this.totalLatency=0,this.latencyHistory=[]}updateConfig(t){switch(this.config=t,t.provider){case"aws":this.providerEngine=new sv(t);break;case"azure":this.providerEngine=new nv(t);break;case"gcp":this.providerEngine=new iv(t);break}}}class Xk{nodes=[];connections=[];metrics=new Map;connectionMetrics=new Map;isRunning=!1;simulationTime=0;baseTime=Date.now();pausedTime=0;updateInterval=100;intervalId=null;latencyHistory=new Map;connectionLatencyHistory=new Map;HISTORY_SIZE=500;rabbitMQRoutingEngines=new Map;lastRabbitMQUpdate=new Map;activeMQRoutingEngines=new Map;lastActiveMQUpdate=new Map;sqsRoutingEngines=new Map;lastSQSUpdate=new Map;azureServiceBusRoutingEngines=new Map;lastAzureServiceBusUpdate=new Map;pubSubRoutingEngines=new Map;lastPubSubUpdate=new Map;kongRoutingEngines=new Map;cloudAPIGatewayEngines=new Map;nginxRoutingEngines=new Map;haproxyRoutingEngines=new Map;envoyRoutingEngines=new Map;istioRoutingEngines=new Map;serviceMeshRoutingEngines=new Map;apigeeRoutingEngines=new Map;mulesoftRoutingEngines=new Map;graphQLGatewayRoutingEngines=new Map;lastGraphQLGatewayUpdate=new Map;bffRoutingEngines=new Map;restApiRoutingEngines=new Map;grpcRoutingEngines=new Map;webhookRelayRoutingEngines=new Map;webhookEngines=new Map;redisRoutingEngines=new Map;cassandraRoutingEngines=new Map;clickHouseRoutingEngines=new Map;snowflakeRoutingEngines=new Map;elasticsearchRoutingEngines=new Map;s3RoutingEngines=new Map;postgresConnectionPools=new Map;prometheusEngines=new Map;grafanaEngines=new Map;graphQLEngines=new Map;soapEngines=new Map;websocketEngines=new Map;lokiEngines=new Map;jaegerEngines=new Map;otelCollectorEngines=new Map;pagerDutyEngines=new Map;keycloakEngines=new Map;vaultEngines=new Map;wafEngines=new Map;firewallEngines=new Map;vpnEngines=new Map;cdnEngines=new Map;idsIpsEngines=new Map;jenkinsEngines=new Map;gitlabCIEngines=new Map;argoCDEngines=new Map;terraformEngines=new Map;harborEngines=new Map;dockerEngines=new Map;kubernetesEngines=new Map;ansibleEngines=new Map;traefikEngines=new Map;sparkEngines=new Map;tensorFlowServingEngines=new Map;pytorchServeEngines=new Map;featureStoreEngines=new Map;constructor(){this.initializeMetrics()}calculatePercentile(t,e){if(t.length===0)return 0;const s=e/100*(t.length-1),n=Math.floor(s),i=Math.ceil(s),o=s-n;return n===i?t[n]:t[n]*(1-o)+t[i]*o}updateLatencyPercentiles(t,e,s){let n=this.latencyHistory.get(t);if(n||(n=[],this.latencyHistory.set(t,n)),n.push(e),n.length>this.HISTORY_SIZE&&n.shift(),n.length>0){const i=[...n].sort((o,r)=>o-r);s.latencyP50=this.calculatePercentile(i,50),s.latencyP99=this.calculatePercentile(i,99)}}updateConnectionLatencyPercentiles(t,e,s){let n=this.connectionLatencyHistory.get(t);if(n||(n=[],this.connectionLatencyHistory.set(t,n)),n.push(e),n.length>this.HISTORY_SIZE&&n.shift(),n.length>0){const i=[...n].sort((o,r)=>o-r);s.latencyP50=this.calculatePercentile(i,50),s.latencyP99=this.calculatePercentile(i,99)}}initialize(t,e){this.nodes=t,this.connections=e,this.initializeMetrics();for(const s of t){if(s.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(s),s.type==="activemq"&&this.initializeActiveMQRoutingEngine(s),s.type==="aws-sqs"&&this.initializeSQSRoutingEngine(s),s.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(s),s.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(s),s.type==="kong"&&this.initializeKongRoutingEngine(s),s.type==="api-gateway"&&this.initializeCloudAPIGatewayEngine(s),s.type==="nginx"&&this.initializeNginxRoutingEngine(s),s.type==="haproxy"&&this.initializeHAProxyRoutingEngine(s),s.type==="envoy"&&this.initializeEnvoyRoutingEngine(s),s.type==="istio"&&this.initializeIstioRoutingEngine(s),s.type==="apigee"&&this.initializeApigeeRoutingEngine(s),s.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(s),s.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(s),s.type==="bff-service"&&this.initializeBFFRoutingEngine(s),s.type==="rest"&&this.initializeRestApiRoutingEngine(s),s.type==="grpc"&&this.initializeGRPCRoutingEngine(s),s.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(s),s.type==="postgres"&&this.initializePostgreSQLConnectionPool(s),s.type==="redis"&&this.initializeRedisRoutingEngine(s),s.type==="cassandra"&&this.initializeCassandraRoutingEngine(s),s.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(s),s.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(s),s.type==="elasticsearch"&&this.initializeElasticsearchRoutingEngine(s),s.type==="s3-datalake"&&this.initializeS3RoutingEngine(s),s.type==="prometheus"&&this.initializePrometheusEngine(s),s.type==="grafana"&&this.initializeGrafanaEngine(s),s.type==="graphql"&&this.initializeGraphQLEngine(s),s.type==="jaeger"&&this.initializeJaegerEngine(s),s.type==="otel-collector"&&this.initializeOpenTelemetryCollectorEngine(s),s.type==="pagerduty"&&this.initializePagerDutyEngine(s),s.type==="keycloak")try{this.initializeKeycloakEngine(s)}catch(n){Ke.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeKeycloakEngine"}})}if(s.type==="secrets-vault")try{this.initializeVaultEngine(s)}catch(n){Ke.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeVaultEngine"}})}if(s.type==="waf")try{this.initializeWAFEngine(s)}catch(n){Ke.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeWAFEngine"}})}if(s.type==="firewall")try{this.initializeFirewallEngine(s)}catch(n){Ke.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeFirewallEngine"}})}if(s.type==="ids-ips")try{this.initializeIDSIPSEngine(s)}catch(n){Ke.addError(n,{severity:"critical",source:"initialization",componentId:s.id,componentLabel:s.data.label,componentType:s.type,context:{operation:"initializeIDSIPSEngine"}})}s.type==="jenkins"&&this.initializeJenkinsEngine(s),s.type==="gitlab-ci"&&this.initializeGitLabCIEngine(s),s.type==="argo-cd"&&this.initializeArgoCDEngine(s),s.type==="terraform"&&this.initializeTerraformEngine(s),s.type==="ansible"&&(this.ansibleEngines.has(s.id)?this.ansibleEngines.get(s.id).updateConfig(s):this.initializeAnsibleEngine(s)),s.type==="spark"&&this.initializeSparkEngine(s),s.type==="harbor"&&(this.harborEngines.has(s.id)?this.harborEngines.get(s.id).updateConfig(s):this.initializeHarborEngine(s)),s.type==="docker"&&(this.dockerEngines.has(s.id)?this.dockerEngines.get(s.id).updateConfig(s):this.initializeDockerEngine(s)),s.type==="kubernetes"&&(this.kubernetesEngines.has(s.id)?this.kubernetesEngines.get(s.id).updateConfig(s):this.initializeKubernetesEngine(s))}for(const s of t)if(s.type==="postgres"){const n=this.postgresConnectionPools.get(s.id);if(n){const i=s.data.config;n.updateConfig({maxConnections:i.maxConnections||100,minConnections:i.minConnections||0,idleTimeout:i.idleTimeout||3e5,maxLifetime:i.maxLifetime||36e5,connectionTimeout:i.connectionTimeout||5e3})}}cs.initialize(t,e)}updateNodesAndConnections(t,e){this.nodes=t,this.connections=e;for(const i of t){if(this.metrics.has(i.id)||this.metrics.set(i.id,this.createDefaultMetrics(i.id,i.type)),i.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(i),i.type==="activemq"&&this.initializeActiveMQRoutingEngine(i),i.type==="aws-sqs"&&this.initializeSQSRoutingEngine(i),i.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(i),i.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(i),i.type==="kong"&&this.initializeKongRoutingEngine(i),i.type==="nginx"&&this.initializeNginxRoutingEngine(i),i.type==="haproxy"&&this.initializeHAProxyRoutingEngine(i),i.type==="envoy"&&this.initializeEnvoyRoutingEngine(i),i.type==="istio"&&this.initializeIstioRoutingEngine(i),i.type==="apigee"&&this.initializeApigeeRoutingEngine(i),i.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(i),i.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(i),i.type==="bff-service"&&this.initializeBFFRoutingEngine(i),i.type==="rest"&&this.initializeRestApiRoutingEngine(i),i.type==="grpc"&&this.initializeGRPCRoutingEngine(i),i.type==="graphql"&&(this.graphQLEngines.has(i.id)?this.graphQLEngines.get(i.id).updateConfig(i.data.config||{}):this.initializeGraphQLEngine(i)),i.type==="soap"&&(this.soapEngines.has(i.id)?this.soapEngines.get(i.id).updateConfig(i.data.config||{}):this.initializeSOAPEngine(i)),i.type==="websocket"&&(this.websocketEngines.has(i.id)?this.websocketEngines.get(i.id).updateConfig(i.data.config||{}):this.initializeWebSocketEngine(i)),i.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(i),i.type==="webhook"&&(this.webhookEngines.has(i.id)?this.webhookEngines.get(i.id).updateConfig(i.data.config||{}):this.initializeWebhookEngine(i)),i.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(i),i.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(i),i.type==="waf")try{this.wafEngines.has(i.id)?this.wafEngines.get(i.id).initializeConfig(i):this.initializeWAFEngine(i)}catch(o){Ke.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeWAFEngine"}})}if(i.type==="firewall")try{this.firewallEngines.has(i.id)?this.firewallEngines.get(i.id).initializeConfig(i):this.initializeFirewallEngine(i)}catch(o){Ke.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeFirewallEngine"}})}if(i.type==="vpn")try{this.vpnEngines.has(i.id)?this.vpnEngines.get(i.id).initializeConfig(i):this.initializeVPNEngine(i)}catch(o){Ke.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeVPNEngine"}})}if(i.type==="ids-ips")try{this.idsIpsEngines.has(i.id)?this.idsIpsEngines.get(i.id).initializeConfig(i):this.initializeIDSIPSEngine(i)}catch(o){Ke.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeIDSIPSEngine"}})}if(i.type==="jenkins"&&(this.jenkinsEngines.has(i.id)?this.jenkinsEngines.get(i.id).updateConfig(i):this.initializeJenkinsEngine(i)),i.type==="gitlab-ci"&&(this.gitlabCIEngines.has(i.id)?this.gitlabCIEngines.get(i.id).updateConfig(i):this.initializeGitLabCIEngine(i)),i.type==="argo-cd"&&(this.argoCDEngines.has(i.id)?this.argoCDEngines.get(i.id).initializeConfig(i):this.initializeArgoCDEngine(i)),i.type==="terraform"&&(this.terraformEngines.has(i.id)?this.terraformEngines.get(i.id).updateConfig(i):this.initializeTerraformEngine(i)),i.type==="ansible"&&(this.ansibleEngines.has(i.id)?this.ansibleEngines.get(i.id).updateConfig(i):this.initializeAnsibleEngine(i)),i.type==="spark"&&(this.sparkEngines.has(i.id)?this.sparkEngines.get(i.id).updateConfig(i):this.initializeSparkEngine(i)),i.type==="tensorflow-serving"&&(this.tensorFlowServingEngines.has(i.id)?this.tensorFlowServingEngines.get(i.id).initializeConfig(i):this.initializeTensorFlowServingEngine(i)),i.type==="pytorch-serve"&&(this.pytorchServeEngines.has(i.id)?this.pytorchServeEngines.get(i.id).initializeConfig(i):this.initializePyTorchServeEngine(i)),i.type==="feature-store"&&(this.featureStoreEngines.has(i.id)?this.featureStoreEngines.get(i.id).initializeConfig(i):this.initializeFeatureStoreEngine(i)),i.type==="traefik"&&(this.traefikEngines.has(i.id)?this.traefikEngines.get(i.id).updateConfig(i):this.initializeTraefikEngine(i)),i.type==="cdn")try{this.cdnEngines.has(i.id)?this.cdnEngines.get(i.id).initializeConfig(i):this.initializeCDNEngine(i)}catch(o){Ke.addError(o,{severity:"critical",source:"initialization",componentId:i.id,componentLabel:i.data.label,componentType:i.type,context:{operation:"initializeCDNEngine"}})}}const s=new Set(t.map(i=>i.id));for(const[i]of this.metrics.entries())s.has(i)||(this.metrics.delete(i),this.rabbitMQRoutingEngines.delete(i),this.activeMQRoutingEngines.delete(i),this.sqsRoutingEngines.delete(i),this.azureServiceBusRoutingEngines.delete(i),this.pubSubRoutingEngines.delete(i),this.kongRoutingEngines.delete(i),this.nginxRoutingEngines.delete(i),this.haproxyRoutingEngines.delete(i),this.envoyRoutingEngines.delete(i),this.istioRoutingEngines.delete(i),this.apigeeRoutingEngines.delete(i),this.mulesoftRoutingEngines.delete(i),this.graphQLGatewayRoutingEngines.delete(i),this.bffRoutingEngines.delete(i),this.restApiRoutingEngines.delete(i),this.grpcRoutingEngines.delete(i),this.webhookRelayRoutingEngines.delete(i),this.redisRoutingEngines.delete(i),this.cassandraRoutingEngines.delete(i),this.clickHouseRoutingEngines.delete(i),this.snowflakeRoutingEngines.delete(i),this.elasticsearchRoutingEngines.delete(i),this.s3RoutingEngines.delete(i),this.graphQLGatewayRoutingEngines.delete(i),this.keycloakEngines.delete(i),this.vaultEngines.delete(i),this.wafEngines.delete(i),this.firewallEngines.delete(i),this.vpnEngines.delete(i),this.cdnEngines.delete(i),this.idsIpsEngines.delete(i),this.jenkinsEngines.delete(i),this.gitlabCIEngines.delete(i),this.argoCDEngines.delete(i),this.terraformEngines.delete(i),this.ansibleEngines.delete(i),this.traefikEngines.delete(i),this.sparkEngines.delete(i),this.tensorFlowServingEngines.delete(i),this.pytorchServeEngines.delete(i),this.featureStoreEngines.delete(i),this.harborEngines.delete(i),this.prometheusEngines.delete(i),this.grafanaEngines.delete(i),this.graphQLEngines.delete(i),this.soapEngines.delete(i),this.websocketEngines.delete(i),this.lokiEngines.delete(i),this.jaegerEngines.delete(i),this.lastRabbitMQUpdate.delete(i),this.lastActiveMQUpdate.delete(i),this.lastSQSUpdate.delete(i),this.lastAzureServiceBusUpdate.delete(i),this.lastPubSubUpdate.delete(i),this.lastGraphQLGatewayUpdate.delete(i));for(const i of e)this.connectionMetrics.has(i.id)||this.connectionMetrics.set(i.id,this.createDefaultConnectionMetrics(i));const n=new Set(e.map(i=>i.id));for(const[i]of this.connectionMetrics.entries())n.has(i)||this.connectionMetrics.delete(i);cs.updateNodesAndConnections(t,e)}start(){if(console.log("EmulationEngine.start() called",{isRunning:this.isRunning,hasInterval:!!this.intervalId}),this.isRunning&&!this.intervalId&&(console.log("Inconsistent state detected: isRunning=true but no interval, stopping first..."),this.stop()),this.isRunning){console.log("Already running, returning early");return}console.log("Setting isRunning to true and creating interval..."),this.isRunning=!0,this.baseTime=Date.now()-this.pausedTime,console.log("Starting data flow engine..."),cs.start(),console.log("Creating simulation interval..."),this.intervalId=setInterval(()=>{try{this.simulate()}catch(t){console.error("Error in simulation step:",t),Ke.addError(t,{severity:"critical",source:"emulation-engine",context:{simulationTime:this.simulationTime}})}},this.updateInterval),console.log("EmulationEngine.start() complete",{intervalId:!!this.intervalId})}stop(){this.isRunning&&(this.isRunning=!1,this.pausedTime=this.simulationTime,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),cs.stop())}resetSimulation(){this.stop(),this.simulationTime=0,this.pausedTime=0,this.baseTime=Date.now(),this.initializeMetrics()}simulate(){this.simulationTime=Date.now()-this.baseTime;const t=Date.now();for(const[s,n]of this.rabbitMQRoutingEngines.entries()){const i=this.lastRabbitMQUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastRabbitMQUpdate.set(s,t))}for(const[s,n]of this.activeMQRoutingEngines.entries()){const i=this.lastActiveMQUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastActiveMQUpdate.set(s,t))}for(const[s,n]of this.sqsRoutingEngines.entries()){const i=this.lastSQSUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastSQSUpdate.set(s,t))}for(const[s,n]of this.azureServiceBusRoutingEngines.entries()){const i=this.lastAzureServiceBusUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastAzureServiceBusUpdate.set(s,t))}for(const[s,n]of this.pubSubRoutingEngines.entries()){const i=this.lastPubSubUpdate.get(s)||t,o=t-i;o>0&&(n.processConsumption(o),this.lastPubSubUpdate.set(s,t))}for(const s of this.nodes)this.updateComponentMetrics(s);try{fo.analyze(this.nodes,this.metrics,this.connectionMetrics,[])}catch(s){Ke.addError(s,{severity:"critical",source:"alert-system",context:{operation:"analyze"}})}const e=fo.getAlerts();for(const[s,n]of this.pagerDutyEngines.entries())n.processAlerts(t,e),n.advanceTime(t);for(const[s,n]of this.prometheusEngines.entries())n.performScraping(t,this.nodes,this.metrics);for(const[s,n]of this.grafanaEngines.entries()){const i=this.nodes.find(o=>o.id===s);if(i){const o=this.isPrometheusAvailableForGrafana(i),r=this.createLokiQueryExecutor(i);n.performUpdate(t,o,r)}}for(const[s,n]of this.lokiEngines.entries())n.performRetention(t);for(const[s,n]of this.jaegerEngines.entries())n.performCleanup(t);for(const[s,n]of this.jenkinsEngines.entries())try{const i=this.nodes.find(u=>u.id===s);n.performUpdate(t);const o=n.calculateComponentMetrics(),r=this.metrics.get(s);r&&o&&(r.throughput=o.throughput||r.throughput,r.latency=o.latency||r.latency,r.utilization=(o.utilization||0)/100,r.errorRate=(o.errorRate||0)/100,r.timestamp=t)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"jenkins",operation:"performUpdate"}})}for(const[s,n]of this.gitlabCIEngines.entries())try{const i=this.nodes.find(u=>u.id===s);n.performUpdate(t);const o=n.getMetrics(),r=this.metrics.get(s);if(r&&o){r.throughput=o.pipelinesPerHour/3600,r.latency=o.averagePipelineDuration||0;const u=o.pipelinesSuccess+o.pipelinesFailed;r.errorRate=u>0?o.pipelinesFailed/u:0,r.utilization=o.pipelinesTotal>0?o.pipelinesRunning/o.pipelinesTotal:0,r.customMetrics={pipelinesTotal:o.pipelinesTotal,pipelinesRunning:o.pipelinesRunning,jobsRunning:o.jobsRunning,runnersOnline:o.runnersOnline}}}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"gitlab-ci",operation:"performUpdate"}})}for(const[s,n]of this.argoCDEngines.entries())try{const i=this.nodes.find(u=>u.id===s);n.performUpdate(t);const o=n.getMetrics(),r=this.metrics.get(s);if(r&&o){r.throughput=o.syncRate/3600,r.latency=o.averageSyncDuration||0;const u=o.syncOperationsSuccess+o.syncOperationsFailed;r.errorRate=u>0?o.syncOperationsFailed/u:0,r.utilization=o.applicationsTotal>0?o.syncOperationsRunning/o.applicationsTotal:0,r.customMetrics={applicationsTotal:o.applicationsTotal,applicationsSynced:o.applicationsSynced,applicationsOutOfSync:o.applicationsOutOfSync,syncOperationsRunning:o.syncOperationsRunning,repositoriesConnected:o.repositoriesConnected}}}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"argo-cd",operation:"performUpdate"}})}for(const[s,n]of this.harborEngines.entries())try{if(!this.nodes.find(r=>r.id===s))continue;const o=this.connections.some(r=>r.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"harbor",operation:"performUpdate"}})}for(const[s,n]of this.dockerEngines.entries())try{if(!this.nodes.find(r=>r.id===s))continue;const o=this.connections.some(r=>r.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"docker",operation:"performUpdate"}})}for(const[s,n]of this.kubernetesEngines.entries())try{if(!this.nodes.find(o=>o.id===s))continue;n.simulateStep()}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"kubernetes",operation:"simulateStep"}})}for(const[s,n]of this.ansibleEngines.entries())try{if(!this.nodes.find(u=>u.id===s))continue;n.performUpdate(t);const o=n.getMetrics(),r=this.metrics.get(s);r&&o&&(r.throughput=o.jobsPerHour/3600,r.latency=o.averageJobDuration*1e3)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"ansible",operation:"performUpdate"}})}for(const[s,n]of this.sparkEngines.entries())try{if(!this.nodes.find(o=>o.id===s))continue;n.performUpdate(t)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"spark",operation:"performUpdate"}})}for(const[s,n]of this.tensorFlowServingEngines.entries())try{if(!this.nodes.find(r=>r.id===s))continue;const o=this.connections.some(r=>r.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"tensorflow-serving",operation:"performUpdate"}})}for(const[s,n]of this.pytorchServeEngines.entries())try{if(!this.nodes.find(r=>r.id===s))continue;const o=this.connections.some(r=>r.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"pytorch-serve",operation:"performUpdate"}})}for(const[s,n]of this.featureStoreEngines.entries())try{if(!this.nodes.find(r=>r.id===s))continue;const o=this.connections.some(r=>r.target===s);n.performUpdate(t,o)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"feature-store",operation:"performUpdate"}})}for(const[s,n]of this.otelCollectorEngines.entries())try{const i=this.nodes.find(o=>o.id===s)}catch(i){const o=this.nodes.find(r=>r.id===s);Ke.addError(i,{severity:"warning",source:"component-engine",componentId:s,componentLabel:o?.data.label,componentType:o?.type,context:{engine:"opentelemetry",operation:"processBatchFlush"}})}for(const s of this.connections)try{this.updateConnectionMetrics(s)}catch(n){Ke.addError(n,{severity:"warning",source:"emulation-engine",context:{operation:"updateConnectionMetrics",connectionId:s.id}})}}updateComponentMetrics(t){const e=t.data.config||{},s=this.metrics.get(t.id)||this.createDefaultMetrics(t.id,t.type),n=this.connections.some(u=>u.target===t.id),i=this.connections.some(u=>u.source===t.id);if(!(n||i))s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,s.customMetrics={};else switch(t.type){case"kafka":this.simulateKafka(t,e,s,n);break;case"rabbitmq":this.simulateRabbitMQ(t,e,s,n);break;case"activemq":this.simulateActiveMQ(t,e,s,n);break;case"aws-sqs":this.simulateSQS(t,e,s,n);break;case"azure-service-bus":this.simulateAzureServiceBus(t,e,s,n);break;case"gcp-pubsub":this.simulatePubSub(t,e,s,n);break;case"postgres":case"mongodb":case"redis":case"cassandra":this.simulateDatabase(t,e,s,n);break;case"nginx":this.simulateNginx(t,e,s,n);break;case"haproxy":this.simulateHAProxy(t,e,s,n);break;case"traefik":this.simulateTraefik(t,e,s,n);break;case"envoy":this.simulateEnvoy(t,e,s,n);break;case"istio":this.simulateIstio(t,e,s,n);break;case"service-mesh":this.simulateServiceMesh(t,e,s,n);break;case"docker":this.simulateDocker(t,e,s,n);break;case"kubernetes":this.simulateKubernetes(t,e,s,n);break;case"rest":case"grpc":case"graphql":case"websocket":this.simulateAPI(t,e,s,n);break;case"webhook":this.simulateWebhook(t,e,s,n);break;case"soap":this.simulateSOAP(t,e,s,n);break;case"kong":this.simulateKong(t,e,s,n);break;case"api-gateway":this.simulateAPIGateway(t,e,s,n);break;case"apigee":this.simulateApigee(t,e,s,n);break;case"mulesoft":this.simulateMuleSoft(t,e,s,n);break;case"bff-service":this.simulateBFF(t,e,s,n);break;case"prometheus":this.simulatePrometheus(t,e,s,n);break;case"grafana":this.simulateGrafana(t,e,s,n);break;case"loki":this.simulateLoki(t,e,s,n);break;case"keycloak":this.simulateKeycloak(t,e,s,n);break;case"secrets-vault":this.simulateVault(t,e,s,n);break;case"pagerduty":this.simulatePagerDuty(t,e,s,n);break;case"waf":this.simulateWAF(t,e,s,n);break;case"firewall":this.simulateFirewall(t,e,s,n);break;case"vpn":this.simulateVPN(t,e,s,n);break;case"cdn":this.simulateCDN(t,e,s,n);break;case"ids-ips":this.simulateIDSIPS(t,e,s,n);break;case"argo-cd":this.simulateArgoCD(t,e,s,n);break;case"terraform":this.simulateTerraform(t,e,s,n);break;case"ansible":this.simulateAnsible(t,e,s,n);break;case"harbor":this.simulateHarbor(t,e,s,n);break;case"docker":this.simulateDocker(t,e,s,n);break;case"spark":this.simulateSpark(t,e,s,n);break;case"tensorflow-serving":this.simulateTensorFlowServing(t,e,s,n);break;case"pytorch-serve":this.simulatePyTorchServe(t,e,s,n);break;case"feature-store":this.simulateFeatureStore(t,e,s,n);break}this.applyCascadeEffects(t,s);const r=ma.applyStateEffects(t.id,{throughput:s.throughput,latency:s.latency,errorRate:s.errorRate,utilization:s.utilization});s.throughput=r.throughput,s.latency=r.latency,s.errorRate=r.errorRate,s.utilization=r.utilization,this.updateLatencyPercentiles(t.id,s.latency,s),s.timestamp=Date.now(),this.metrics.set(t.id,s)}applyCascadeEffects(t,e){const s=this.connections.filter(h=>h.target===t.id);if(s.length===0)return;let n=0,i=0,o=0;const r=e.latency;for(const h of s){const p=this.metrics.get(h.source),g=this.connectionMetrics.get(h.id);if(!p||!g)continue;const v=g.throughputDependency||.5;o+=v;const b=p.errorRate*v*.3;n+=b*v;const R=Math.min(p.latency,500)*v*.2;i+=R*v,(p.errorRate>.5||p.utilization>.95)&&(n+=.1*v,i+=100*v)}o>0&&(n/=o,i/=o),i=Math.min(i,500),e.errorRate=Math.min(1,e.errorRate+n),e.latency=r+i;const d=1e4;e.latency=Math.min(e.latency,d),i>50&&(e.utilization=Math.min(1,e.utilization+.1)),n>.1&&(e.throughput=e.throughput*(1-n*.5))}updateConnectionMetrics(t){const e=this.metrics.get(t.source),s=this.metrics.get(t.target);if(!e||!s)return;const n=this.connectionMetrics.get(t.id)||{id:t.id,source:t.source,target:t.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0},i=this.nodes.find(u=>u.id===t.source),o=this.nodes.find(u=>u.id===t.target),r=i?.data.config?.avgPayloadSize||1024;n.traffic=e.throughput*r/1024,n.latency=this.calculateConnectionLatency(t,e,s),n.errorRate=e.errorRate*.1,this.calculateInteractionMetrics(t,n,e,s,i,o),this.updateConnectionLatencyPercentiles(t.id,n.latency,n),n.timestamp=Date.now(),this.connectionMetrics.set(t.id,n)}calculateInteractionMetrics(t,e,s,n,i,o){const r=t.data||{},d=(r.bandwidthMbps||1e3)*1024*1024/8;this.getComponentCapacity(i);const h=this.getComponentCapacity(o),p=s.throughput,g=i?.data.config?.avgPayloadSize||1024,v=p*g,b=Math.min(v,d),x=h*g,R=Math.min(b,x);e.effectiveThroughput=R/g;const k=this.connections.filter(Z=>Z.target===t.target).reduce((Z,se)=>{const le=this.metrics.get(se.source);return Z+(le?.throughput||0)},0);e.throughputDependency=k>0?p/k:0;const T=n.utilization,A=v/d,D=p/h,_=(r.packetLossPercent||0)/100;e.backpressure=Math.min(1,T*.4+A*.3+D*.2+_*.1);const L=v>d*.8,O=p>h*.8,X=e.backpressure>.7;e.bottleneck=L||O||X;const te=this.getBaseLatency(t.type),ce=Math.max(0,e.latency-te)/te;e.congestion=Math.min(1,A*.4+ce*.3+_*.3),e.utilization=Math.min(1,e.effectiveThroughput/h)}getComponentCapacity(t){if(!t)return 1e3;const e=t.data.config||{};switch(t.type){case"kafka":case"rabbitmq":case"activemq":return e.throughputMsgs||1e3;case"postgres":case"mongodb":case"redis":return e.maxConnections?e.maxConnections*10:1e3;case"nginx":case"haproxy":case"rest":case"grpc":case"websocket":return e.requestsPerSecond||1e3;case"docker":case"kubernetes":return(e.workerThreads||1)*500;default:return 1e3}}getBaseLatency(t){return{sync:5,async:2,http:10,grpc:5,websocket:3}[t]||10}simulateKafka(t,e,s,n){const i=t.data.config,o=i?.brokers||["localhost:9092"],r=i?.topics||[],u=i?.consumerGroups||[],d=r.length||e.topicCount||5,h=r.reduce((I,q)=>I+(q.partitions||3),0)||e.partitions||3,p=r.length>0?r.reduce((I,q)=>I+(q.replication||1),0)/r.length:e.replicationFactor||1,g=this.connections.filter(I=>I.target===t.id);let v=0;for(const I of g){const q=this.metrics.get(I.source);q&&(v+=q.throughput||0)}const b=e.throughputMsgs||Math.max(1e3,v);if(!n&&b<=0){if(s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,r.length>0)for(const I of r)I.messages=I.messages||0,I.size=I.size||0;for(const I of u)I.lag=0;s.customMetrics={topics:d,partitions:h,replication:Math.round(p*10)/10,brokers:o.length,consumer_groups:u.length,total_lag:0};return}const x=.2*Math.sin(this.simulationTime/1e3);s.throughput=b*(1+x);const R=3,C=Math.min(h/10,10),k=Math.max(1,(p-1)*2),T=Math.max(0,(p-1)*1),A=this.calculateCompressionOverhead(r);if(s.latency=R+C+k+T+A,o.length>1){const I=Math.min(5,o.length*.5);s.latency+=I}const D=this.calculateUnderReplicatedPartitions(r,o.length),_=p>1?(p-1)*5e-4:0,L=D>0?D*.001:0,O=i?.acls||[];let X=0,te=0;for(const I of g){const q=this.nodes.find(K=>K.id===I.source);if(!q)continue;const Y=q.data.config||{},fe=Y.messaging?.producerId||Y.clientId||`User:${q.id.slice(0,8)}`,N=Y.messaging?.topic||r[0]?.name||"default-topic";if(!this.checkACLPermission(O,fe,"Topic",N,"Write")){const K=this.metrics.get(I.source);K&&(te+=K.throughput*.9,X+=.45)}}te>0&&(s.throughput=Math.max(0,s.throughput-te)),s.errorRate=Math.max(0,Math.min(.1,_+L+X+1e-4));const Z=Math.min(1,s.throughput/1e4),se=Math.min(1,h/200);s.utilization=Math.min(1,Z*.7+se*.3);const le=e.avgPayloadSize||1024,ue=this.updateInterval/1e3;for(const I of r){const q=s.throughput/d,Y=q*ue;I.messages=(I.messages||0)+Y;const fe=this.getCompressionRatio(I.config?.compressionType),N=Y*le*fe;if(I.size=(I.size||0)+N,I.config?.retentionMs&&I.config.retentionMs>0){const F=I.config.retentionMs/1e3,ie=q*F;if(I.messages>ie){const U=I.messages-ie;I.messages=ie,I.size=Math.max(0,I.size-U*le*fe)}}if(I.config?.retentionBytes&&I.config.retentionBytes>0&&I.size>I.config.retentionBytes){const F=1-I.config.retentionBytes/I.size;I.size=I.config.retentionBytes,I.messages=Math.max(0,I.messages*(1-F))}if((I.config?.cleanupPolicy==="compact"||I.config?.cleanupPolicy==="delete,compact")&&this.simulationTime%3e5<this.updateInterval){const ie=Math.round(I.messages*.85),U=I.messages-ie;I.messages=ie,I.size=Math.max(0,I.size-U*le*fe)}if(I.config?.minInsyncReplicas){const F=I.config.minInsyncReplicas,K=this.getAverageISRCount(I,o.length);if(K<F){const ie=F-K;s.errorRate+=ie*.01}}if(I.config?.maxMessageBytes&&le>I.config.maxMessageBytes){const F=Math.min(.1,(le-I.config.maxMessageBytes)/I.config.maxMessageBytes);s.errorRate+=F*.5}}let z=0;for(const I of u){const q=r.find(ot=>ot.name===I.topic);if(!q)continue;const Y=I.members||1,fe=q.partitions||1,N=this.assignPartitionsToConsumers(Y,fe),F=300;let K=0;for(const ot of N){const Ze=ot.partitions.length;K+=Ze*F}const ie=Math.min(K,Y*F),U=s.throughput/d||0,oe=I.id||`Group:${I.id}`,B=this.checkACLPermission(O,oe,"Topic",I.topic,"Read"),G=this.checkACLPermission(O,oe,"Group",I.id,"Read");let pe=ie;(!B||!G)&&(pe=0);const me=U,ye=pe,be=Math.max(0,(me-ye)*ue),Ie=I.lag||0,Be=Math.max(0,Ie+be-ye*ue);I.lag=Be,z+=Be,this.isRebalancing(t.id,I.id)&&(I.lag=Math.min(Be*1.2,Be+me*ue*.3),z+=Be*.2)}s.customMetrics={topics:d,partitions:h,replication:Math.round(p*10)/10,brokers:o.length,consumer_groups:u.length,total_lag:Math.round(z),avg_topic_messages:d>0?Math.round(r.reduce((I,q)=>I+(q.messages||0),0)/d):0,total_topic_size_mb:Math.round(r.reduce((I,q)=>I+(q.size||0),0)/1024/1024*100)/100,under_replicated_partitions:D}}calculateCompressionOverhead(t){if(t.length===0)return 0;const e={uncompressed:0,gzip:2,snappy:.5,lz4:.3,zstd:1};let s=0,n=0;for(const i of t){const o=i.config?.compressionType||"gzip",r=e[o]||0;r>0&&(s+=r,n++)}return n>0?s/n:0}getCompressionRatio(t){return{uncompressed:1,gzip:.3,snappy:.5,lz4:.4,zstd:.25}[t||"gzip"]||.3}calculateUnderReplicatedPartitions(t,e){let s=0;for(const n of t){const i=n.replication||1,o=n.partitions||1;if(n.partitionInfo&&Array.isArray(n.partitionInfo))for(const r of n.partitionInfo){const u=i;(r.isr?.length||r.replicas?.length||1)<u&&s++}else i>e&&(s+=o*Math.max(0,1-e/i)),Math.random()<.05&&i>1&&(s+=o*.1)}return Math.round(s)}assignPartitionsToConsumers(t,e){if(t===0||e===0)return[];const s=[],n=Math.floor(e/t),i=e%t;let o=0;for(let r=0;r<t;r++){const u=[],d=n+(r<i?1:0);for(let h=0;h<d;h++)o<e&&(u.push(o),o++);s.push({consumerId:r,partitions:u})}return s}consumerGroupMemberCounts=new Map;rebalancingGroups=new Map;isRebalancing(t,e){const s=`${t}:${e}`,n=this.rebalancingGroups.get(s);if(n&&Date.now()<n)return!0;const i=this.getCurrentGroupMembers(t,e),o=this.consumerGroupMemberCounts.get(s);return o!==void 0&&i!==o?(this.rebalancingGroups.set(s,Date.now()+2e3),this.consumerGroupMemberCounts.set(s,i),!0):((o===void 0||i!==o)&&this.consumerGroupMemberCounts.set(s,i),!1)}getCurrentGroupMembers(t,e){const s=this.nodes.find(r=>r.id===t);return s&&(s.data.config?.consumerGroups||[]).find(r=>r.id===e)?.members||0}getAverageISRCount(t,e){if(!t.partitionInfo||!Array.isArray(t.partitionInfo)||t.partitionInfo.length===0){const i=t.replication||1;return Math.min(i,e)*.95}let s=0,n=0;for(const i of t.partitionInfo){const o=i.isr?.length||i.replicas?.length||1;s+=o,n++}return n>0?s/n:1}checkACLPermission(t,e,s,n,i,o){if(!t||t.length===0)return!0;const r=e.includes(":")?e:`User:${e}`,u=t.filter(p=>{const g=p.principal||"";if(g!==r&&g!=="*"&&!r.includes(g)||p.resourceType!==s)return!1;const v=p.resourcePatternType||"Literal",b=p.resourceName||"";let x=!1;switch(v){case"Literal":x=b===n||b==="*";break;case"Prefixed":if(b==="*")x=!0;else if(b.endsWith("*")){const R=b.slice(0,-1);x=n.startsWith(R)}else x=n.startsWith(b);break;case"Match":if(b==="*")x=!0;else{const R=b.replace(/\./g,"\\.").replace(/\*/g,".*");x=new RegExp(`^${R}$`).test(n)}break;default:x=b===n||b==="*"}return!(!x||p.operation!==i&&p.operation!=="All"||p.host&&p.host!=="*"&&o&&p.host!==o)});return u.length===0||u.filter(p=>p.permission==="Deny").length>0?!1:u.filter(p=>p.permission==="Allow").length>0}simulateRabbitMQ(t,e,s,n){this.rabbitMQRoutingEngines.has(t.id)||this.initializeRabbitMQRoutingEngine(t);const i=this.rabbitMQRoutingEngines.get(t.id);if(t.data.config,!n){s.throughput=0,s.latency=2,s.errorRate=0;const T=i.getTotalQueueDepth();s.utilization=Math.min(1,T/1e5);const A=i.getAllQueueMetrics(),D=i.getActiveConnections();s.customMetrics={queue_depth:T,connections:D,replication:e.replicationFactor||1},this.updateQueueMetricsInConfig(t,A);return}const o=this.connections.filter(T=>T.target===t.id);let r=0;for(const T of o){const A=this.connectionMetrics.get(T.id);if(A){const _=A.traffic/1024;r+=_}}const u=e.throughputMsgs||r||1e3,d=e.replicationFactor||1,h=(Math.random()-.5)*.1;s.throughput=u*(1+h);const p=i.getTotalQueueDepth(),g=2,v=Math.min(50,p/1e3);s.latency=g+d*5+v+Math.random()*5;const b=5e-4,x=Math.min(.01,p/1e6);s.errorRate=b+x,s.utilization=Math.min(1,p/1e5);const R=i.getAllQueueMetrics(),C=i.getActiveConnections();let k=0;for(const T of R.values())k+=T.consumers;s.customMetrics={queue_depth:p,connections:C,replication:d,queues:R.size,consumers:k},this.updateQueueMetricsInConfig(t,R)}initializeRabbitMQRoutingEngine(t){const e=t.data.config||{},s=new AT;s.initialize({queues:e.queues||[],exchanges:e.exchanges||[{name:"amq.direct",type:"direct",durable:!0,autoDelete:!1,internal:!1},{name:"amq.topic",type:"topic",durable:!0,autoDelete:!1,internal:!1},{name:"amq.fanout",type:"fanout",durable:!0,autoDelete:!1,internal:!1}],bindings:e.bindings||[]}),this.rabbitMQRoutingEngines.set(t.id,s),this.lastRabbitMQUpdate.set(t.id,Date.now())}updateQueueMetricsInConfig(t,e){const s=t.data.config||{},n=s.queues||[];for(let i=0;i<n.length;i++){const o=n[i],r=e.get(o.name);r&&(n[i]={...o,messages:r.messages,ready:r.ready,unacked:r.unacked,consumers:r.consumers})}s.queues=n}simulateActiveMQ(t,e,s,n){this.activeMQRoutingEngines.has(t.id)||this.initializeActiveMQRoutingEngine(t);const i=this.activeMQRoutingEngines.get(t.id),o=t.data.config||{},r=o.protocol||"openwire",u=o.persistenceEnabled??!0,d=o.maxConnections||1e3,h=o.memoryLimit||1024,p=o.storeUsage||0,g=o.tempUsage||0,v=o.connections||[];if(!n){s.throughput=0,s.latency=this.getProtocolBaseLatency(r),s.errorRate=0;const U=i.getTotalQueueDepth(),oe=i.getTotalTopicMessages(),B=U+oe;s.utilization=Math.min(1,B/1e5);const G=i.getAllQueueMetrics(),pe=i.getAllTopicMetrics(),me=i.getActiveConnections();let ye=0;for(const Ie of G.values())ye+=Ie.consumerCount;let be=0;for(const Ie of pe.values())be+=Ie.subscriberCount;s.customMetrics={queue_depth:U,topic_messages:oe,connections:me,queues:G.size,topics:pe.size,consumers:ye,subscribers:be,memory_usage:p+g,memory_percent:h>0?(p+g)/h*100:0},this.updateActiveMQMetricsInConfig(t,G,pe);return}const b=this.connections.filter(U=>U.target===t.id);let x=0;for(const U of b){const oe=this.connectionMetrics.get(U.id);if(oe){const G=oe.traffic/1024;x+=G}}const R=e.throughputMsgs||x||1e3,C=(Math.random()-.5)*.1;s.throughput=R*(1+C);const k=i.getTotalQueueDepth(),T=i.getTotalTopicMessages(),A=k+T,D=this.getProtocolBaseLatency(r),_=u?5:0,L=Math.min(50,A/1e3),O=h>0&&p+g>h*.8?10:0;s.latency=D+_+L+O+Math.random()*5;const X=o.acls||[];let te=0,ce=0;for(const U of b){const oe=this.nodes.find(me=>me.id===U.source);if(!oe)continue;const B=oe.data.config,G=B?.messaging||{},pe=B?.username||B?.clientId||o.username||`user-${U.source.slice(0,8)}`;if(G.queue&&!this.checkActiveMQACLPermission(X,pe,`queue://${G.queue}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,te+=.45)}if(G.topic&&!this.checkActiveMQACLPermission(X,pe,`topic://${G.topic}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,te+=.45)}}const Z=o.queues||[];for(const U of Z)U.consumerCount&&U.consumerCount>0&&(this.checkActiveMQACLPermission(X,o.username||"admin",`queue://${U.name}`,"read")||(te+=.1));const se=5e-4,le=Math.min(.01,A/1e6),ue=h>0&&p+g>h?.01:0,z=v.length>=d?.005:0;ce>0&&(s.throughput=Math.max(0,s.throughput-ce)),s.errorRate=Math.min(1,se+le+ue+z+te);const I=Math.min(1,A/1e5),q=h>0?Math.min(1,(p+g)/h):0,Y=Math.min(1,v.length/d);s.utilization=Math.max(I,q,Y);const fe=i.getAllQueueMetrics(),N=i.getAllTopicMetrics(),F=i.getActiveConnections();let K=0;for(const U of fe.values())K+=U.consumerCount;let ie=0;for(const U of N.values())ie+=U.subscriberCount;s.customMetrics={queue_depth:k,topic_messages:T,connections:F,queues:fe.size,topics:N.size,consumers:K,subscribers:ie,memory_usage:p+g,memory_percent:h>0?(p+g)/h*100:0,protocol:r},this.updateActiveMQMetricsInConfig(t,fe,N)}checkActiveMQACLPermission(t,e,s,n){if(!t||t.length===0)return!0;const i=t.filter(u=>{const d=u.principal||"";if(d!==e&&d!=="*"&&!e.includes(d))return!1;const h=u.resource||"";let p=!1;if(h==="*"||h===s)p=!0;else if(h.endsWith("*")){const b=h.slice(0,-1);p=s.startsWith(b)}else h.includes("://")?p=h===s:p=s.includes(h);if(!p)return!1;const g=(u.operation||"").toLowerCase(),v=n.toLowerCase();return!(g!==v&&g!=="all"&&g!=="*")});return i.length===0?!0:i.filter(u=>u.permission==="deny").length>0?!1:(i.filter(u=>u.permission==="allow").length>0,!0)}getProtocolBaseLatency(t){return{openwire:2,amqp:5,mqtt:8,stomp:10,ws:12}[t]||5}initializeActiveMQRoutingEngine(t){const e=t.data.config||{},s=new DT;s.initialize({queues:e.queues||[],topics:e.topics||[],subscriptions:e.subscriptions||[]}),this.activeMQRoutingEngines.set(t.id,s),this.lastActiveMQUpdate.set(t.id,Date.now())}updateActiveMQMetricsInConfig(t,e,s){const n=t.data.config||{},i=n,o=n.queues||[];for(let p=0;p<o.length;p++){const g=o[p],v=e.get(g.name);v&&(o[p]={...g,queueSize:v.queueSize,consumerCount:v.consumerCount,enqueueCount:v.enqueueCount,dequeueCount:v.dequeueCount})}n.queues=o;const r=n.topics||[];for(let p=0;p<r.length;p++){const g=r[p],v=s.get(g.name);v&&(r[p]={...g,subscriberCount:v.subscriberCount,enqueueCount:v.enqueueCount,dequeueCount:v.dequeueCount})}n.topics=r;const u=this.connections.filter(p=>p.target===t.id),d=[];for(const p of u){const g=this.nodes.find(C=>C.id===p.source);if(!g)continue;g.data.config?.messaging;const b=i.protocol||"openwire",x=this.connectionMetrics.get(p.id),R=x?Math.floor(x.traffic/1024):0;d.push({id:p.id,remoteAddress:`${g.data.label||g.id}`,clientId:`client-${p.source.slice(0,8)}`,userName:i.username||"admin",connectedSince:new Date().toISOString(),messageCount:R,protocol:b==="openwire"?"OpenWire":b==="amqp"?"AMQP":b==="mqtt"?"MQTT":b==="stomp"?"STOMP":b==="ws"?"WebSocket":"OpenWire"})}n.connections=d;const h=[];for(const p of r)for(const g of u){const v=this.nodes.find(R=>R.id===g.source);if(!v)continue;const x=v.data.config?.messaging||{};if(x.topic===p.name||!x.queue){const R=s.get(p.name);h.push({id:`sub-${g.id}-${p.name}`,destination:p.name,clientId:`client-${g.source.slice(0,8)}`,pendingQueueSize:0,dispatchedQueueSize:0,dispatchedCounter:R?.enqueueCount||0,enqueueCounter:R?.enqueueCount||0,dequeueCounter:R?.dequeueCount||0})}}n.subscriptions=h}simulateAzureServiceBus(t,e,s,n){this.azureServiceBusRoutingEngines.has(t.id)||this.initializeAzureServiceBusRoutingEngine(t);const i=this.azureServiceBusRoutingEngines.get(t.id),o=t.data.config||{};if(!n){s.throughput=0,s.latency=5,s.errorRate=0;const te=i.getTotalQueueDepth(),ce=i.getTotalSubscriptionMessages(),Z=te+ce;s.utilization=Math.min(1,Z/1e5);const se=i.getAllQueueMetrics(),le=i.getAllSubscriptionMetrics(),ue=i.getActiveConnections();s.customMetrics={queue_depth:te,subscription_messages:ce,connections:ue,queues:o.queues?.length||0,topics:o.topics?.length||0},this.updateAzureServiceBusMetricsInConfig(t,se,le);return}const r=this.connections.filter(te=>te.target===t.id);let u=0;for(const te of r){const ce=this.connectionMetrics.get(te.id);if(ce){const se=ce.traffic/1024;u+=se}}const d=e.throughputMsgs||u||1e3,h=(Math.random()-.5)*.1;s.throughput=d*(1+h);const p=i.getTotalQueueDepth(),g=i.getTotalSubscriptionMessages(),v=p+g,b=5,x=Math.min(50,v/1e3),R=2;s.latency=b+x+R+Math.random()*5;const C=i.getAllQueueMetrics(),k=i.getAllSubscriptionMetrics(),T=i.getActiveConnections(),A=5e-4,D=Math.min(.01,v/1e6);let _=0;for(const te of C.values())_+=te.deadLetterMessageCount||0;for(const te of k.values())_+=te.deadLetterMessageCount||0;const L=_>0?Math.min(.05,_/1e4):0;s.errorRate=Math.min(1,A+D+L),s.utilization=Math.min(1,v/1e5);let O=0;const X=o.topics||[];for(const te of X)O+=(te.subscriptions||[]).length;s.customMetrics={queue_depth:p,subscription_messages:g,dead_letter_messages:_,connections:T,queues:o.queues?.length||0,topics:o.topics?.length||0,subscriptions:O},this.updateAzureServiceBusMetricsInConfig(t,C,k)}initializeAzureServiceBusRoutingEngine(t){const e=t.data.config||{},s=new _T,n=(e.queues||[]).map(o=>({name:o.name,namespace:o.namespace||e.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:o.maxSizeInMegabytes||1024,defaultMessageTimeToLive:o.defaultMessageTimeToLive||2592e3,lockDuration:o.lockDuration||30,maxDeliveryCount:o.maxDeliveryCount||10,enablePartitioning:o.enablePartitioning||!1,enableDeadLetteringOnMessageExpiration:o.enableDeadLetteringOnMessageExpiration!==void 0?o.enableDeadLetteringOnMessageExpiration:!0,enableSessions:o.enableSessions||!1,activeMessageCount:o.activeMessageCount||0,deadLetterMessageCount:o.deadLetterMessageCount||0,scheduledMessageCount:o.scheduledMessageCount||0})),i=(e.topics||[]).map(o=>({name:o.name,namespace:o.namespace||e.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:o.maxSizeInMegabytes||1024,defaultMessageTimeToLive:o.defaultMessageTimeToLive||2592e3,enablePartitioning:o.enablePartitioning||!1,subscriptions:(o.subscriptions||[]).map(r=>({name:r.name,maxDeliveryCount:r.maxDeliveryCount||10,lockDuration:r.lockDuration||30,enableDeadLetteringOnMessageExpiration:r.enableDeadLetteringOnMessageExpiration!==void 0?r.enableDeadLetteringOnMessageExpiration:!0,activeMessageCount:r.activeMessageCount||0}))}));s.initialize({queues:n,topics:i}),this.azureServiceBusRoutingEngines.set(t.id,s),this.lastAzureServiceBusUpdate.set(t.id,Date.now())}updateAzureServiceBusMetricsInConfig(t,e,s){const n=t.data.config||{},i=n.queues||[];for(let r=0;r<i.length;r++){const u=i[r],d=e.get(u.name);d&&(i[r]={...u,activeMessageCount:d.activeMessageCount,deadLetterMessageCount:d.deadLetterMessageCount,scheduledMessageCount:d.scheduledMessageCount})}n.queues=i;const o=n.topics||[];for(let r=0;r<o.length;r++){const u=o[r],d=u.subscriptions||[];for(let h=0;h<d.length;h++){const p=d[h],g=`${u.name}/subscriptions/${p.name}`,v=s.get(g);v&&(d[h]={...p,activeMessageCount:v.activeMessageCount})}o[r]={...u,subscriptions:d}}n.topics=o}simulatePubSub(t,e,s,n){this.pubSubRoutingEngines.has(t.id)||this.initializePubSubRoutingEngine(t);const i=this.pubSubRoutingEngines.get(t.id),o=t.data.config||{},r=o.topics||[],u=o.subscriptions||[];if(!n){s.throughput=0,s.latency=3,s.errorRate=0;const z=i.getTotalTopicMessages(),I=i.getTotalUnackedMessages(),q=z+I;s.utilization=Math.min(1,q/1e5);const Y=i.getAllTopicMetrics(),fe=i.getAllSubscriptionMetrics(),N=i.getActiveConnections();s.customMetrics={topic_messages:z,unacked_messages:I,connections:N,topics:r.length,subscriptions:u.length},this.updatePubSubMetricsInConfig(t,Y,fe);return}const d=this.connections.filter(z=>z.target===t.id);let h=0;for(const z of d){const I=this.connectionMetrics.get(z.id);if(I){const Y=I.traffic/1024;h+=Y}}const p=e.throughputMsgs||h||1e3,g=(Math.random()-.5)*.1;s.throughput=p*(1+g);const v=i.getTotalTopicMessages(),b=i.getTotalUnackedMessages(),x=v+b,R=3,C=Math.min(15,x/1e4),k=u.filter(z=>z.pushEndpoint).length,T=k>0?2:0,A=b>0?.5:0;s.latency=R+C+T+A+Math.random()*2;const D=i.getAllTopicMetrics(),_=i.getAllSubscriptionMetrics(),L=i.getActiveConnections(),O=1e-4,X=Math.min(.001,x/5e6),te=k>0&&b>0?Math.min(.002,b/1e5):0,ce=u.length>0?u.reduce((z,I)=>z+(I.ackDeadlineSeconds||10),0)/u.length:10,Z=b>0&&ce<60?Math.min(.005,b/1e5):0;s.errorRate=Math.min(1,O+X+te+Z);const se=Math.min(1,s.throughput/1e5),le=Math.min(.3,x/5e5);s.utilization=Math.min(1,se*.7+le*.3);const ue=u.length-k;s.customMetrics={topic_messages:v,unacked_messages:b,connections:L,topics:r.length,subscriptions:u.length,push_subscriptions:k,pull_subscriptions:ue,total_bytes:Array.from(D.values()).reduce((z,I)=>z+I.byteCount,0)},this.updatePubSubMetricsInConfig(t,D,_)}initializePubSubRoutingEngine(t){const e=t.data.config||{},s=new LT,n=(e.topics||[]).map(o=>({name:o.name,projectId:o.projectId||e.projectId||"archiphoenix-lab",messageRetentionDuration:o.messageRetentionDuration||604800,labels:o.labels||{},messageCount:o.messageCount||0,byteCount:o.byteCount||0})),i=(e.subscriptions||[]).map(o=>({name:o.name,topic:o.topic,projectId:o.projectId||e.projectId||"archiphoenix-lab",ackDeadlineSeconds:o.ackDeadlineSeconds||10,messageRetentionDuration:o.messageRetentionDuration,enableMessageOrdering:o.enableMessageOrdering||!1,pushEndpoint:o.pushEndpoint,pushAttributes:o.pushAttributes||{},messageCount:o.messageCount||0,unackedMessageCount:o.unackedMessageCount||0}));s.initialize({topics:n,subscriptions:i}),this.pubSubRoutingEngines.set(t.id,s),this.lastPubSubUpdate.set(t.id,Date.now())}updatePubSubMetricsInConfig(t,e,s){const n=t.data.config||{},i=n.topics||[];for(let r=0;r<i.length;r++){const u=i[r],d=e.get(u.name);d&&(i[r]={...u,messageCount:d.messageCount,byteCount:d.byteCount})}n.topics=i;const o=n.subscriptions||[];for(let r=0;r<o.length;r++){const u=o[r],d=s.get(u.name);d&&(o[r]={...u,messageCount:d.messageCount,unackedMessageCount:d.unackedMessageCount})}n.subscriptions=o}updateWebSocketMetricsInConfig(t,e){const s=t.data.config||{},n=e.getActiveConnections();s.connections=n,s.totalConnections=e.getWebSocketMetrics().connectionsTotal,s.activeConnections=e.getWebSocketMetrics().connectionsActive;const i=e.getRooms();s.rooms=i;const o=e.getSubscriptions();s.subscriptions=o;const r=e.getMessageHistory(100);s.messages=r,s.totalMessages=e.getWebSocketMetrics().messagesTotal}simulateSQS(t,e,s,n){this.sqsRoutingEngines.has(t.id)||this.initializeSQSRoutingEngine(t);const i=this.sqsRoutingEngines.get(t.id);if(t.data.config,!n){s.throughput=0,s.latency=5,s.errorRate=0;const C=i.getTotalQueueDepth();s.utilization=Math.min(1,C/1e5);const k=i.getAllQueueMetrics(),T=i.getActiveConnections();s.customMetrics={queue_depth:C,connections:T,queues:k.size},this.updateSQSQueueMetricsInConfig(t,k);return}const o=this.connections.filter(C=>C.target===t.id);let r=0;for(const C of o){const k=this.connectionMetrics.get(C.id);if(k){const A=k.traffic/1024;r+=A}}const u=e.throughputMsgs||r||1e3,d=(Math.random()-.5)*.1;s.throughput=u*(1+d);const h=i.getTotalQueueDepth(),p=5,g=Math.min(50,h/1e3);s.latency=p+g+Math.random()*5;const v=5e-4,b=Math.min(.01,h/1e6);s.errorRate=v+b,s.utilization=Math.min(1,h/1e5);const x=i.getAllQueueMetrics(),R=i.getActiveConnections();s.customMetrics={queue_depth:h,connections:R,queues:x.size},this.updateSQSQueueMetricsInConfig(t,x)}initializeSQSRoutingEngine(t){const e=t.data.config||{},s=new PT,n=(e.queues||[]).map(i=>({name:i.name,type:i.type||"standard",region:i.region||e.defaultRegion||"us-east-1",visibilityTimeout:i.visibilityTimeout||30,messageRetention:i.messageRetention||4,delaySeconds:i.delaySeconds||0,maxReceiveCount:i.maxReceiveCount,deadLetterQueue:i.deadLetterQueue,contentBasedDedup:i.contentBasedDedup,fifoThroughputLimit:i.fifoThroughputLimit||"perQueue"}));s.initialize({queues:n}),this.sqsRoutingEngines.set(t.id,s),this.lastSQSUpdate.set(t.id,Date.now())}updateSQSQueueMetricsInConfig(t,e){const s=t.data.config||{},n=s.queues||[];for(let i=0;i<n.length;i++){const o=n[i],r=e.get(o.name);r&&(n[i]={...o,approximateMessages:r.approximateMessages,approximateMessagesNotVisible:r.approximateMessagesNotVisible,approximateMessagesDelayed:r.approximateMessagesDelayed})}s.queues=n}simulateDatabase(t,e,s,n){if(!n){if(s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,s.customMetrics={},t.type==="postgres"){const g=this.postgresConnectionPools.get(t.id);g&&g.reset()}return}const i=e.maxConnections||100,o=e.queryLatency||10;if(t.type==="postgres"){const g=this.postgresConnectionPools.get(t.id);if(g){const b=this.connections.filter(_=>_.target===t.id).reduce((_,L)=>{const O=this.metrics.get(L.source);return _+(O?.throughput||0)},0),R=Math.min(b,i*10)*this.updateInterval/1e3;for(let _=0;_<Math.floor(R);_++){const L=g.acquireConnection("SELECT");if(L){const O=o+Math.random()*20;setTimeout(()=>{g.releaseConnection(L,O)},O)}}const C=g.getMetrics();s.throughput=C.queriesPerSecond,s.latency=C.averageQueryTime||o,s.utilization=C.utilization,s.errorRate=C.waitingConnections>0?.01:.001;const T=t.data.config.tables||[];let A=0;for(const _ of T)A+=(_.indexes||[]).length;A===0&&(A=5);const D=this.calculateCacheHitRatio(t,C.queriesPerSecond);s.customMetrics={active_connections:C.activeConnections,idle_connections:C.idleConnections,waiting_connections:C.waitingConnections,total_connections:C.totalConnections,max_connections:i,indexes:A,cache_hit_ratio:D,connection_wait_time:C.connectionWaitTime};return}}if(t.type==="redis"){this.redisRoutingEngines.has(t.id)||this.initializeRedisRoutingEngine(t);const g=this.redisRoutingEngines.get(t.id),v=t.data.config;v?.keys&&Array.isArray(v.keys)&&g.syncKeysFromConfig(v.keys);const b=g.getMetrics(),R=this.connections.filter(A=>A.target===t.id).reduce((A,D)=>{const _=this.metrics.get(D.source);return A+(_?.throughput||0)},0);s.throughput=Math.max(b.operationsPerSecond,R);const C=.5,k=b.memoryUsagePercent/100,T=Math.min(1,b.totalKeys/1e5);s.latency=C+k*2+T*1,s.errorRate=k>.95?.01:.001,s.utilization=b.memoryUsagePercent/100,s.customMetrics={total_keys:b.totalKeys,keys_string:b.keysByType.string,keys_hash:b.keysByType.hash,keys_list:b.keysByType.list,keys_set:b.keysByType.set,keys_zset:b.keysByType.zset,keys_stream:b.keysByType.stream,memory_usage:b.memoryUsage,memory_usage_percent:b.memoryUsagePercent,operations_per_second:b.operationsPerSecond,hit_count:b.hitCount,miss_count:b.missCount,hit_rate:b.hitRate,expired_keys:b.expiredKeys,evicted_keys:b.evictedKeys,connected_clients:b.connectedClients};return}if(t.type==="cassandra"){this.cassandraRoutingEngines.has(t.id)||this.initializeCassandraRoutingEngine(t);const g=this.cassandraRoutingEngines.get(t.id),v=t.data.config;v&&g.syncFromConfig({clusterName:v.clusterName,nodes:v.nodes,keyspaces:v.keyspaces,tables:v.tables,defaultConsistencyLevel:v.consistencyLevel,defaultReplicationFactor:v.replicationFactor});const b=g.getMetrics(),R=this.connections.filter(D=>D.target===t.id).reduce((D,_)=>{const L=this.metrics.get(_.source);return D+(L?.throughput||0)},0);s.throughput=Math.max(b.readOperationsPerSecond+b.writeOperationsPerSecond,R);const C=b.readOperationsPerSecond+b.writeOperationsPerSecond;if(C>0){const D=b.readOperationsPerSecond/C,_=b.writeOperationsPerSecond/C;s.latency=b.readLatency*D+b.writeLatency*_}else s.latency=(b.readLatency+b.writeLatency)/2;const k=b.readConsistencyViolations+b.writeConsistencyViolations;s.errorRate=Math.min(.1,k/Math.max(1,C))||.001;const T=b.totalNodes>0?(b.totalNodes-b.healthyNodes)/b.totalNodes:0,A=Math.min(1,b.pendingCompactions/100);s.utilization=Math.min(1,T*.7+A*.3),s.customMetrics={total_nodes:b.totalNodes,healthy_nodes:b.healthyNodes,total_keyspaces:b.totalKeyspaces,total_tables:b.totalTables,total_rows:b.totalRows,total_size_gb:b.totalSize/(1024*1024*1024),read_latency_ms:b.readLatency,write_latency_ms:b.writeLatency,read_ops_per_sec:b.readOperationsPerSecond,write_ops_per_sec:b.writeOperationsPerSecond,pending_compactions:b.pendingCompactions,read_consistency_violations:b.readConsistencyViolations,write_consistency_violations:b.writeConsistencyViolations,hinted_handoffs:b.hintedHandoffs};return}if(t.type==="clickhouse"){this.clickHouseRoutingEngines.has(t.id)||this.initializeClickHouseRoutingEngine(t);const g=this.clickHouseRoutingEngines.get(t.id),v=t.data.config;v&&g.syncFromConfig({cluster:v.cluster,replication:v.replication,tables:v.tables?.map(A=>({name:A.name,database:v.database||"default",engine:A.engine||"MergeTree",rows:A.rows||0,size:A.size||0,partitions:A.partitions||0,columns:A.columns||[]})),maxMemoryUsage:v.maxMemoryUsage,compression:v.compression});const b=g.getMetrics(),R=this.connections.filter(A=>A.target===t.id).reduce((A,D)=>{const _=this.metrics.get(D.source);return A+(_?.throughput||0)},0);s.throughput=Math.max(b.queriesPerSecond,R),s.latency=b.avgQueryTime;const C=b.memoryUsagePercent/100;s.errorRate=C>.95?.01:.001;const k=Math.min(1,b.activeQueries/10),T=C;s.utilization=Math.max(k,T),s.customMetrics={total_tables:b.totalTables,total_rows:b.totalRows,total_size_gb:b.totalSize/(1024*1024*1024),queries_per_sec:b.queriesPerSecond,read_rows_per_sec:b.readRowsPerSecond,written_rows_per_sec:b.writtenRowsPerSecond,avg_query_time_ms:b.avgQueryTime,active_queries:b.activeQueries,memory_usage_bytes:b.memoryUsage,memory_usage_percent:b.memoryUsagePercent,parts_count:b.partsCount,pending_merges:b.pendingMerges,compression_ratio:b.compressionRatio,cluster_nodes:b.clusterNodes,healthy_nodes:b.healthyNodes};return}if(t.type==="snowflake"){this.snowflakeRoutingEngines.has(t.id)||this.initializeSnowflakeRoutingEngine(t);const g=this.snowflakeRoutingEngines.get(t.id),v=t.data.config;v&&g.syncFromConfig({account:v.account,region:v.region,warehouses:v.warehouses,databases:v.databases,role:v.role,enableAutoSuspend:v.enableAutoSuspend,autoSuspendSeconds:v.autoSuspendSeconds,enableAutoResume:v.enableAutoResume});const b=g.getMetrics(),R=this.connections.filter(C=>C.target===t.id).reduce((C,k)=>{const T=this.metrics.get(k.source);return C+(T?.throughput||0)},0);s.throughput=Math.max(b.queriesPerSecond,R),s.latency=b.avgQueryTime,s.errorRate=.001,s.utilization=b.warehouseUtilization,s.customMetrics={total_warehouses:b.totalWarehouses,running_warehouses:b.runningWarehouses,suspended_warehouses:b.suspendedWarehouses,total_queries:b.totalQueries,running_queries:b.runningQueries,queued_queries:b.queuedQueries,queries_per_sec:b.queriesPerSecond,avg_query_time_ms:b.avgQueryTime,total_compute_time_sec:b.totalComputeTime,total_data_read:b.totalDataRead,total_data_written:b.totalDataWritten,cache_hit_rate:b.cacheHitRate,warehouse_utilization:b.warehouseUtilization,total_cost_credits:b.totalCost};return}if(t.type==="elasticsearch"){this.elasticsearchRoutingEngines.has(t.id)||this.initializeElasticsearchRoutingEngine(t);const g=this.elasticsearchRoutingEngines.get(t.id),v=t.data.config;v&&g.syncFromConfig({clusterName:v.clusterName,nodes:v.nodes,indices:v.indices,defaultShards:v.shards,defaultReplicas:v.replicas,refreshInterval:v.refreshInterval});const b=g.getMetrics(),R=this.connections.filter(D=>D.target===t.id).reduce((D,_)=>{const L=this.metrics.get(_.source);return D+(L?.throughput||0)},0);s.throughput=Math.max(b.indexOperationsPerSecond+b.searchOperationsPerSecond,R);const C=b.indexOperationsPerSecond+b.searchOperationsPerSecond;if(C>0){const D=b.indexOperationsPerSecond/C,_=b.searchOperationsPerSecond/C;s.latency=b.averageIndexLatency*D+b.averageSearchLatency*_}else s.latency=b.averageSearchLatency||10;const k=b.clusterHealth==="red"?.01:b.clusterHealth==="yellow"?.002:.001;s.errorRate=k;const T=b.unassignedShards>0?1:b.relocatingShards>0?.7:b.initializingShards>0?.5:.3,A=b.healthyNodes/b.totalNodes;s.utilization=Math.max(T,1-A),this.updateElasticsearchMetricsInConfig(t,b),s.customMetrics={cluster_health:b.clusterHealth==="green"?1:b.clusterHealth==="yellow"?.5:0,total_nodes:b.totalNodes,healthy_nodes:b.healthyNodes,total_indices:b.totalIndices,total_docs:b.totalDocs,total_size_gb:b.totalSize/(1024*1024*1024),active_shards:b.activeShards,relocating_shards:b.relocatingShards,initializing_shards:b.initializingShards,unassigned_shards:b.unassignedShards,index_ops_per_sec:b.indexOperationsPerSecond,search_ops_per_sec:b.searchOperationsPerSecond,avg_index_latency_ms:b.averageIndexLatency,avg_search_latency_ms:b.averageSearchLatency,avg_get_latency_ms:b.averageGetLatency};return}if(t.type==="s3-datalake"){this.s3RoutingEngines.has(t.id)||this.initializeS3RoutingEngine(t);const g=this.s3RoutingEngines.get(t.id);if(g.processLifecycleTransitions(),!n){s.throughput=0,s.latency=50,s.errorRate=0;const Z=g.getAllBucketMetrics(),se=g.getTotalStorageSize(),le=g.getTotalObjectCount(),ue=1024*1024*1024*1024,z=Z.size,I=ue*z;s.utilization=I>0?Math.min(1,se/I):0,s.customMetrics={buckets:z,total_objects:le,total_size:se,total_size_mb:Math.round(se/(1024*1024)*100)/100},this.updateS3BucketMetricsInConfig(t,Z);return}const v=this.connections.filter(Z=>Z.target===t.id);let b=0,x=0;for(const Z of v){const se=this.connectionMetrics.get(Z.id);se&&(b+=se.traffic/1024,x+=se.traffic)}const R=1024*1024,C=x>0?x/R:0;s.throughput=Math.max(0,C),s.latency=50+(C>100?(C-100)*.1:0),s.errorRate=.001;const k=g.getAllBucketMetrics(),T=g.getTotalStorageSize(),A=g.getTotalObjectCount(),D=k.size,L=1024*1024*1024*1024*D,O=L>0?Math.min(1,T/L):0,te=3500*D,ce=te>0?Math.min(1,C/te):0;s.utilization=Math.max(O,ce),s.customMetrics={buckets:D,total_objects:A,total_size:T,total_size_mb:Math.round(T/(1024*1024)*100)/100,total_size_gb:Math.round(T/(1024*1024*1024)*100)/100,estimated_ops_per_sec:Math.round(C*100)/100,storage_utilization:Math.round(O*1e3)/10,ops_utilization:Math.round(ce*1e3)/10},this.updateS3BucketMetricsInConfig(t,k);return}let r=e.indexCount||5;t.type==="mongodb"&&(r=(t.data.config?.collections||[]).reduce((b,x)=>b+(x.indexes?.length||0),0),r===0&&(r=1));const d=this.connections.filter(g=>g.target===t.id).reduce((g,v)=>{const b=this.metrics.get(v.source);return g+(b?.throughput||0)},0),h=Math.min(i,Math.floor(d/10)||Math.floor(i*.3));s.throughput=h*(1e3/(o+Math.random()*20));const p=Math.min(.3,r*.02);if(s.latency=o+h/i*50*(1-p),s.errorRate=.001,s.utilization=h/i,s.customMetrics={active_connections:h,max_connections:i,indexes:r,cache_hit_ratio:Math.random()*.8+.2},t.type==="mongodb"){const g=t.data.config,v=g?.collections||[],b=v.filter(T=>T.validation&&T.validation.validationLevel!=="off").length;if(b>0){const T=Math.min(.05,b*.01);s.errorRate=Math.max(s.errorRate,T)}const x=g?.enableReplicaSet||!1,R=g?.replicaSetMembers||[];if(x&&R.length>1){const T=R.length,A=Math.min(.3,(T-1)*.1);s.errorRate=Math.max(0,s.errorRate*(1-A)),s.latency=s.latency*(1+.05*(T-1))}const C=g?.enableSharding||!1,k=g?.shardConfig;if(C&&k?.shards){const T=k.shards.length,A=1+(T-1)*.3;s.throughput=s.throughput*A,s.latency=s.latency*(1+.02*(T-1))}s.customMetrics={...s.customMetrics,collections:v.length,collections_with_validation:b,total_documents:v.reduce((T,A)=>T+(A.documentCount||0),0),replica_set_enabled:x,replica_members:x?R.length:0,sharding_enabled:C,shard_count:C&&k?.shards?.length||0}}}simulateNginx(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.nginxRoutingEngines.get(t.id);if(!i){const C=e.workerThreads||e.maxWorkers||4,k=e.requestsPerSecond||1e4,T=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=k*T,s.latency=1+(1-T)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/k*(C/4)),s.customMetrics={worker_threads:C,active_connections:Math.floor(s.throughput*.1)};return}const o=e||{},r=o.maxWorkers||4,u=o.requestsPerSecond||1e4;o.enableCache;const d=o.enableGzip??!0,h=i.getStats(),p=.5*Math.sin(this.simulationTime/2e3)+.5;let g=u*p;if(h.rateLimitBlocks>0){const C=Math.min(.1,h.rateLimitBlocks/Math.max(1,h.requests));g=g*(1-C)}s.throughput=g;const v=1+(1-p)*4,b=10+Math.random()*90;s.latency=v+b*.3;const x=h.rateLimitBlocks>0?Math.min(.05,h.rateLimitBlocks/Math.max(1,h.requests)):0;s.errorRate=1e-5+x;const R=Math.min(1,s.throughput/u*(r/4));s.utilization=R,s.customMetrics={worker_threads:r,active_connections:Math.floor(s.throughput*.1),cache_hits:h.cacheHits,cache_misses:h.cacheMisses,cache_hit_rate:Math.round(h.cacheHitRate*100)/100,rate_limit_blocks:h.rateLimitBlocks,locations:h.locations,upstreams:h.upstreams,ssl_enabled:o.enableSSL?1:0,gzip_enabled:d?1:0}}simulateHAProxy(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.haproxyRoutingEngines.get(t.id);if(!i){const R=e.maxConnections||4096,C=e.requestsPerSecond||1e4,k=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=C*k,s.latency=1+(1-k)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/C*(R/4096)),s.customMetrics={max_connections:R,active_connections:Math.floor(s.throughput*.1)};return}const o=e||{},r=o.maxConnections||4096,u=o.requestsPerSecond||1e4,d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=u*h;const g=d.totalServers>0?d.upServers/d.totalServers:1;p=p*g,s.throughput=p;const v=1+(1-h)*4,b=10+Math.random()*90;s.latency=v+b*.3,s.errorRate=d.errorRate||1e-5;const x=Math.min(1,d.activeConnections/r);s.utilization=x,s.customMetrics={max_connections:r,active_connections:d.activeConnections,frontends:d.frontends,backends:d.backends,total_servers:d.totalServers,up_servers:d.upServers,down_servers:d.downServers,total_requests:d.totalRequests,total_responses:d.totalResponses,total_bytes_in:d.totalBytesIn,total_bytes_out:d.totalBytesOut}}simulateEnvoy(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.envoyRoutingEngines.get(t.id);if(!i){const R=e.maxConnections||1024,C=e.requestsPerSecond||1e4,k=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=C*k,s.latency=1+(1-k)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/C*(R/1024)),s.customMetrics={max_connections:R,active_connections:Math.floor(s.throughput*.1)};return}const o=e||{},r=o.maxConnections||1024,u=o.requestsPerSecond||1e4,d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=u*h;const g=d.totalEndpoints>0?d.healthyEndpoints/d.totalEndpoints:1;p=p*g,s.throughput=p;const v=1+(1-h)*4,b=10+Math.random()*90;s.latency=v+b*.2,s.errorRate=d.errorRate||1e-5;const x=Math.min(1,d.activeConnections/r);s.utilization=x,s.customMetrics={max_connections:r,active_connections:d.activeConnections,clusters:d.clusters,listeners:d.listeners,routes:d.routes,total_endpoints:d.totalEndpoints,healthy_endpoints:d.healthyEndpoints,unhealthy_endpoints:d.unhealthyEndpoints,total_requests:d.totalRequests,total_responses:d.totalResponses,total_bytes_in:d.totalBytesIn,total_bytes_out:d.totalBytesOut,rate_limit_blocks:d.rateLimitBlocks||0,timeout_errors:d.timeoutErrors||0,circuit_breaker_trips:d.circuitBreakerTrips||0}}simulateServiceMesh(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.serviceMeshRoutingEngines.get(t.id);if(!i){const k=e.maxConnections||1e4,T=e.requestsPerSecond||5e3,A=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=T*A,s.latency=5+(1-A)*10,s.errorRate=1e-4,s.utilization=Math.min(1,s.throughput/T*(k/1e4)),s.customMetrics={max_connections:k,active_connections:Math.floor(s.throughput*.1),services:e.services?.length||0};return}const o=e||{},r=o.maxConnections||1e4,u=o.requestsPerSecond||5e3,d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=u*h;const g=d.services,v=g>0?Math.min(1,g/Math.max(1,o.services?.length||g)):1;p=p*v,s.throughput=p;const b=5+(1-h)*10,x=10+Math.random()*90,R=o.enableMTLS?2:0;s.latency=b+x*.15+R,s.errorRate=d.errorRate||1e-4;const C=Math.min(1,d.activeConnections/r);s.utilization=C,s.customMetrics={max_connections:r,active_connections:d.activeConnections,services:d.services,virtual_services:d.virtualServices,destination_rules:d.destinationRules,gateways:d.gateways,total_requests:d.totalRequests,total_responses:d.totalResponses,total_errors:d.totalErrors,total_bytes_in:d.totalBytesIn,total_bytes_out:d.totalBytesOut,mtls_connections:d.mtlsConnections,circuit_breaker_trips:d.circuitBreakerTrips,retry_attempts:d.retryAttempts,timeout_errors:d.timeoutErrors,rate_limit_blocks:d.rateLimitBlocks,average_latency:Math.round(d.averageLatency)}}simulateIstio(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.istioRoutingEngines.get(t.id);if(!i){const k=e.maxConnections||1e4,T=e.requestsPerSecond||5e3,A=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=T*A,s.latency=5+(1-A)*10,s.errorRate=1e-4,s.utilization=Math.min(1,s.throughput/T*(k/1e4)),s.customMetrics={max_connections:k,active_connections:Math.floor(s.throughput*.1),services:e.services?.length||0};return}const o=e||{},r=o.maxConnections||1e4,u=o.requestsPerSecond||5e3,d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=u*h;const g=d.services,v=g>0?Math.min(1,g/Math.max(1,o.services?.length||g)):1;p=p*v,s.throughput=p;const b=5+(1-h)*10,x=10+Math.random()*90,R=o.enableMTLS?2:0;s.latency=b+x*.15+R,s.errorRate=d.errorRate||1e-4;const C=Math.min(1,d.activeConnections/r);s.utilization=C,s.customMetrics={max_connections:r,active_connections:d.activeConnections,services:d.services,virtual_services:d.virtualServices,destination_rules:d.destinationRules,gateways:d.gateways,total_requests:d.totalRequests,total_responses:d.totalResponses,total_errors:d.totalErrors,total_bytes_in:d.totalBytesIn,total_bytes_out:d.totalBytesOut,mtls_connections:d.mtlsConnections,circuit_breaker_trips:d.circuitBreakerTrips,retry_attempts:d.retryAttempts,timeout_errors:d.timeoutErrors,rate_limit_blocks:d.rateLimitBlocks,average_latency:Math.round(d.averageLatency)}}simulateInfrastructure(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=e.workerThreads||1;s.throughput=100*i+Math.random()*50,s.latency=50+Math.random()*100,s.errorRate=1e-4,s.utilization=Math.random()*.8,s.customMetrics={replicas:i,cpu_percent:Math.random()*80,memory_percent:Math.random()*70}}simulateAPI(t,e,s,n){if(!n){if(s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0,t.type==="rest"){const u=this.restApiRoutingEngines.get(t.id);u&&u.getStats()}return}if(t.type==="rest"){const u=this.restApiRoutingEngines.get(t.id);if(u){const d=u.getStats(),h=u.getAllEndpointStats(),p=d.totalRequests,g=d.totalErrors,v=d.averageLatency,b=e.requestsPerSecond||100,x=Math.sin(this.simulationTime/1500)*.1+1;s.throughput=b*x,s.latency=v>0?v:(e.responseLatency||50)+Math.random()*30,p>0?s.errorRate=g/p:s.errorRate=.005,s.utilization=Math.min(1,s.throughput/b);const R=d.enabledEndpoints,C={};for(const[k,T]of Object.entries(h))T&&(C[`endpoint_${k}_requests`]=T.requestCount,C[`endpoint_${k}_errors`]=T.errorCount,C[`endpoint_${k}_latency`]=T.averageLatency);s.customMetrics={rps:s.throughput,total_requests:p,total_errors:g,p50_latency:Math.round(s.latency*.5),p99_latency:Math.round(s.latency*2),errors:Math.round(s.throughput*s.errorRate),endpoints:d.totalEndpoints,enabled_endpoints:R,...C};return}}if(t.type==="grpc"){const u=this.grpcRoutingEngines.get(t.id);if(u){const d=u.getStats(),h=u.getAllMethodStats(),p=u.getConnectionState(),g=d.totalRequests,v=d.totalErrors,b=d.averageLatency,x=e.requestsPerSecond||100,R=Math.sin(this.simulationTime/1500)*.1+1;s.throughput=x*R,s.latency=b>0?b:(e.responseLatency||20)+Math.random()*15,g>0?s.errorRate=v/g:s.errorRate=.002;const C=p.totalConnections||100,k=Math.min(1,(p.activeConnections+p.idleConnections)/C);s.utilization=Math.min(1,s.throughput/x*.7+k*.3);const T={};for(const[A,D]of Object.entries(h))D&&(T[`method_${A}_requests`]=D.requestCount,T[`method_${A}_errors`]=D.errorCount,T[`method_${A}_latency`]=D.averageLatency,D.streamingConnections&&(T[`method_${A}_streaming_connections`]=D.streamingConnections));s.customMetrics={rps:s.throughput,total_requests:g,total_errors:v,p50_latency:Math.round(s.latency*.5),p99_latency:Math.round(s.latency*1.8),errors:Math.round(s.throughput*s.errorRate),services:d.totalServices,enabled_services:d.enabledServices,methods:d.totalMethods,enabled_methods:d.enabledMethods,active_connections:p.activeConnections,idle_connections:p.idleConnections,total_connections:p.totalConnections,...T};return}}if(t.type==="graphql"){const u=this.graphQLEngines.get(t.id);if(u){u.getLoad();const d=u.getGraphQLMetrics();if(!n){const g=e.requestsPerSecond||100;u.simulateRequests(g,this.nodes,this.connections)}u.processSubscriptions(this.nodes,this.connections);const h=u.getLoad();s.throughput=h.queriesPerSecond+h.mutationsPerSecond,s.latency=h.averageLatency,s.errorRate=h.errorRate,s.utilization=(h.cpuUtilization+h.memoryUtilization)/2,s.customMetrics={queries_per_second:d.queriesPerSecond,mutations_per_second:d.mutationsPerSecond,subscriptions_active:d.subscriptionsActive,total_queries:d.totalQueries,total_mutations:d.totalMutations,total_errors:d.totalErrors,average_response_time:d.averageResponseTime,average_complexity:d.averageComplexity,average_depth:d.averageDepth,cache_hit_rate:d.cacheHitRate,error_rate:d.errorRate,cpu_utilization:h.cpuUtilization,memory_utilization:h.memoryUtilization};const p=u.getSubscriptionMetrics();s.customMetrics={...s.customMetrics,subscription_events_total:p.totalEvents,subscription_events_per_second:p.eventsPerSecond,subscription_avg_delivery_latency:p.averageDeliveryLatency,subscription_delivery_errors:p.totalDeliveryErrors,subscription_delivery_error_rate:p.deliveryErrorRate};return}}if(t.type==="soap"){const u=this.soapEngines.get(t.id);if(u){const d=u.getSOAPMetrics();s.throughput=d.requestsPerSecond,s.latency=d.averageLatency,s.errorRate=d.errorRate/100,s.utilization=Math.min(1,s.throughput/(e.requestsPerSecond||100));const h=e;if(s.customMetrics={requests_per_second:d.requestsPerSecond,total_requests:d.totalRequests,total_errors:d.totalErrors,average_response_time:d.averageResponseTime,average_latency:d.averageLatency,error_rate:d.errorRate,success_rate:d.successRate,services_count:h?.services?.length||0,operations_count:h?.services?.reduce((p,g)=>p+(g.operations?.length||0),0)||0},d.operationMetrics)for(const p of d.operationMetrics)s.customMetrics[`operation_${p.operationName}_calls`]=p.totalCalls,s.customMetrics[`operation_${p.operationName}_latency`]=p.averageLatency,s.customMetrics[`operation_${p.operationName}_errors`]=p.totalErrors;if(d.serviceMetrics)for(const p of d.serviceMetrics)s.customMetrics[`service_${p.serviceName}_requests`]=p.totalRequests,s.customMetrics[`service_${p.serviceName}_latency`]=p.averageLatency,s.customMetrics[`service_${p.serviceName}_errors`]=p.totalErrors;d.rateLimitMetrics&&(s.customMetrics.rate_limit_blocked=d.rateLimitMetrics.totalBlockedRequests,s.customMetrics.rate_limit_hits_per_sec=d.rateLimitMetrics.rateLimitHitsPerSecond),d.timeoutMetrics&&(s.customMetrics.timeouts_total=d.timeoutMetrics.totalTimeouts,s.customMetrics.timeouts_per_sec=d.timeoutMetrics.timeoutsPerSecond);return}}if(t.type==="websocket"){const u=this.websocketEngines.get(t.id);if(u){u.updateMetrics(n,this.simulationTime);const d=u.getWebSocketMetrics();s.throughput=d.messagesPerSecond,s.latency=d.averageLatency,s.latencyP50=d.latencyP50,s.latencyP99=d.latencyP99,s.errorRate=d.errorRate,s.utilization=d.utilization,s.customMetrics={connections_total:d.connectionsTotal,connections_active:d.connectionsActive,connections_per_second:d.connectionsPerSecond,messages_per_second:d.messagesPerSecond,messages_total:d.messagesTotal,messages_sent:d.messagesSent,messages_received:d.messagesReceived,bytes_sent:d.bytesSent,bytes_received:d.bytesReceived,average_latency:d.averageLatency,latency_p50:d.latencyP50||0,latency_p95:d.latencyP95||0,latency_p99:d.latencyP99||0,error_rate:d.errorRate,connection_error_rate:d.connectionErrorRate,ping_pong_success_rate:d.pingPongSuccessRate,compression_ratio:d.compressionRatio,rooms_count:d.roomsCount,subscriptions_count:d.subscriptionsCount,avg_connections_per_room:d.averageConnectionsPerRoom,avg_subscriptions_per_connection:d.averageSubscriptionsPerConnection},this.updateWebSocketMetricsInConfig(t,u);return}}const i=e.requestsPerSecond||100,o=e.responseLatency||50,r=Math.sin(this.simulationTime/1500)*.1+1;s.throughput=i*r,s.latency=o+Math.random()*30,s.errorRate=.005,s.utilization=s.throughput/i*Math.random(),s.customMetrics={rps:i,p50_latency:Math.round(o*.5),p99_latency:Math.round(o*2),errors:Math.round(s.throughput*s.errorRate)}}simulateWebhook(t,e,s,n){const i=this.webhookEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=i.getMetrics();if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}s.throughput=o.requestsPerSecond,s.latency=o.averageLatency||50,s.errorRate=o.errorRate/100,s.utilization=o.utilization/100,s.customMetrics={rps:o.requestsPerSecond,endpoints_total:o.endpointsTotal,endpoints_enabled:o.endpointsEnabled,deliveries_total:o.deliveriesTotal,deliveries_success:o.deliveriesSuccess,deliveries_failed:o.deliveriesFailed,deliveries_pending:o.deliveriesPending,success_rate:o.successRate,retries_total:o.retriesTotal,p50_latency:Math.round(s.latency*.5),p99_latency:Math.round(s.latency*2),errors:Math.round(s.throughput*s.errorRate)}}simulateKong(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.kongRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=e||{},r=o.requestsPerSecond||e.requestsPerSecond||450,u=i.getStats(),d=.5*Math.sin(this.simulationTime/2e3)+.5;let h=r*d;const p=(o.plugins||[]).filter(C=>C.name==="rate-limiting"&&C.enabled);if(p.length>0){const C=Math.min(...p.map(k=>k.config?.minute||1e3));h=Math.min(h,C*d)}s.throughput=h;const g=2+Math.random()*3,v=u.plugins*.5,b=10+Math.random()*40;s.latency=g+v+b;const x=.001,R=u.consumers>0?.02:0;s.errorRate=Math.min(1,x+R),s.utilization=Math.min(1,s.throughput/r),s.customMetrics={services:u.services,routes:u.routes,upstreams:u.upstreams,consumers:u.consumers,plugins:u.plugins,requests_per_second:r,gateway_latency:g+v,upstream_latency:b}}simulateAPIGateway(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;const d=this.cloudAPIGatewayEngines.get(t.id);d&&d.resetMetrics();return}const i=this.cloudAPIGatewayEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=t.data.config||{},r=o.apis||[],u=i.calculateMetrics();s.throughput=u.throughput,s.latency=u.latency,s.latencyP50=u.latencyP50,s.latencyP99=u.latencyP99,s.errorRate=u.errorRate,s.utilization=u.utilization,s.customMetrics={...u.customMetrics,apis_count:r.length,keys_count:o.keys?.length||0,provider:o.provider==="aws"?1:o.provider==="azure"?2:3,auth_enabled:o.enableAuthentication?1:0,rate_limiting_enabled:o.enableRateLimiting?1:0,caching_enabled:o.enableCaching?1:0}}simulateApigee(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.apigeeRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=e||{},r=o.proxies||[],u=o.requestsPerSecond||e.requestsPerSecond||500,d=i.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=u*h;const g=r.filter(T=>T.status!=="undeployed");if(g.length>0){const T=g.filter(D=>D.quota&&D.quotaInterval).map(D=>D.quota/D.quotaInterval*h);if(T.length>0){const D=Math.min(...T);p=Math.min(p,D)}const A=g.filter(D=>D.spikeArrest&&D.spikeArrest>0).map(D=>D.spikeArrest);if(A.length>0){const D=Math.min(...A);p=Math.min(p,D*h)}}s.throughput=p;const v=3+Math.random()*2,b=d.policies*.8,x=15+Math.random()*35;s.latency=v+b+x;const R=.001,C=d.policies>0?.015:0,k=d.totalErrors>0?d.totalErrors/Math.max(d.totalRequests,1)*.1:0;s.errorRate=Math.min(1,R+C+k),s.utilization=Math.min(1,s.throughput/u),s.customMetrics={proxies:d.proxies,policies:d.policies,total_requests:d.totalRequests,total_errors:d.totalErrors,avg_latency:Math.round(d.avgLatency),requests_per_second:u,gateway_latency:v+b,upstream_latency:x}}simulateMuleSoft(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.mulesoftRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const r=(e||{}).applications||[],u=i.getStats(),d=.5*Math.sin(this.simulationTime/2e3)+.5;let h=0,p=0;for(const D of r)if(D.status==="running"){const _=D.workerCount||2;p+=_,h+=_*75}h===0&&(h=100);let g=h*d;s.throughput=g;const v=5+Math.random()*10,b=u.enabledConnectors*2,x=3+Math.random()*5,R=15+Math.random()*25;s.latency=v+b+x+R;const C=.002,k=u.totalErrors>0?u.totalErrors/Math.max(u.totalRequests,1)*.15:0,T=u.runningApplications>0?.005:.01;s.errorRate=Math.min(1,C+k+T);const A=p>0?Math.min(1,s.throughput/(p*75)):.5;s.utilization=Math.min(1,A),s.customMetrics={applications:u.applications,running_applications:u.runningApplications,connectors:u.connectors,enabled_connectors:u.enabledConnectors,total_requests:u.totalRequests,total_errors:u.totalErrors,avg_latency:Math.round(u.avgLatency),total_workers:p,runtime_latency:v,connector_latency:R,transformation_latency:x}}simulateGrafana(t,e,s,n){const i=this.grafanaEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.getGrafanaMetrics(),r=i.calculateLoad();s.throughput=r.queriesPerSecond+r.alertEvaluationsPerSecond,s.latency=r.averageQueryLatency+r.averageRenderingLatency,s.errorRate=r.errorRate,s.utilization=(r.cpuUtilization+r.memoryUtilization)/2,s.customMetrics={queries_per_second:r.queriesPerSecond,dashboard_refreshes_per_second:r.dashboardRefreshesPerSecond,alert_evaluations_per_second:r.alertEvaluationsPerSecond,average_query_latency:r.averageQueryLatency,average_rendering_latency:r.averageRenderingLatency,datasource_errors:o.datasourceErrors,active_dashboards:o.activeDashboards,active_panels:o.activePanels,total_queries:o.totalQueries,cpu_utilization:r.cpuUtilization,memory_utilization:r.memoryUtilization}}simulateKeycloak(t,e,s,n){const i=this.keycloakEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics(),u=i.getConfig();s.throughput=o.requestsPerSecond,s.latency=o.averageLatency,s.errorRate=o.errorRate;const d=Math.min(.6,(o.activeSessions||0)/500),h=Math.min(.3,o.requestsPerSecond/200),p=u?.passwordPolicy?this.estimateKeycloakPolicyComplexity(u.passwordPolicy):0,g=Math.min(.2,p/100);s.utilization=Math.min(.95,.1+d+h+g),s.customMetrics={...s.customMetrics||{},keycloak_login_requests_total:r.loginRequestsTotal,keycloak_login_errors_total:r.loginErrorsTotal,keycloak_token_refresh_total:r.tokenRefreshTotal,keycloak_introspection_requests_total:r.introspectionRequestsTotal,keycloak_userinfo_requests_total:r.userInfoRequestsTotal,keycloak_sessions_active:r.activeSessions,keycloak_sessions_created_total:r.sessionsCreatedTotal,keycloak_sessions_expired_total:r.sessionsExpiredTotal,keycloak_auth_success_rate:o.authSuccessRate,keycloak_clients_configured:u?.clients.length??0,keycloak_users_configured:u?.users.length??0}}simulateVault(t,e,s,n){const i=this.vaultEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();i.getConfig(),s.throughput=o.requestsPerSecond,s.latency=o.averageLatency,s.errorRate=o.errorRate;const u=Math.min(.4,(o.secretsCount||0)/1e3),d=Math.min(.3,(o.activeTokens||0)/500),h=Math.min(.2,o.requestsPerSecond/300),p=Math.min(.1,(o.enginesEnabled||0)/10);s.utilization=Math.min(.95,.1+u+d+h+p),s.customMetrics={...s.customMetrics||{},vault_read_requests_total:r.readRequestsTotal,vault_write_requests_total:r.writeRequestsTotal,vault_delete_requests_total:r.deleteRequestsTotal,vault_list_requests_total:r.listRequestsTotal,vault_auth_requests_total:r.authRequestsTotal,vault_auth_errors_total:r.authErrorsTotal,vault_token_issued_total:r.tokenIssuedTotal,vault_token_renewed_total:r.tokenRenewedTotal,vault_token_revoked_total:r.tokenRevokedTotal,vault_tokens_active:r.activeTokens,vault_secrets_total:r.secretsTotal,vault_encryption_operations_total:r.encryptionOperationsTotal,vault_decryption_operations_total:r.decryptionOperationsTotal,vault_engines_enabled:o.enginesEnabled}}estimateKeycloakPolicyComplexity(t){if(!t)return 0;let e=0;const s=t.toLowerCase();s.includes("length(")&&(e+=20),s.includes("digits(")&&(e+=25),s.includes("special(")&&(e+=30),s.includes("uppercase(")&&(e+=15),s.includes("lowercase(")&&(e+=10);const n=(t.match(/\)/g)||[]).length;return e+=n*5,e}simulatePrometheus(t,e,s,n){const i=this.prometheusEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.getPrometheusMetrics(),r=i.calculateLoad();s.throughput=r.scrapeRequestsPerSecond,s.latency=r.averageScrapeDuration,s.errorRate=r.errorRate;const u=i.getTargetStatuses().length,d=Math.min(.95,.1+u/100*.5+r.scrapeRequestsPerSecond/10*.2);s.utilization=d,s.customMetrics={scrape_requests_total:o.scrapeRequestsTotal,scrape_errors_total:o.scrapeErrorsTotal,targets_up:o.targetsUp,targets_down:o.targetsDown,samples_scraped:o.samplesScraped,scrape_requests_per_second:r.scrapeRequestsPerSecond,samples_per_second:r.samplesPerSecond}}simulateWAF(t,e,s,n){const i=this.wafEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();i.getStats(),s.throughput=o.requestsPerSecond,s.latency=o.averageLatency;const u=i.getConfig();u?.mode==="prevention"?s.errorRate=o.blockRate:s.errorRate=0;const d=Math.min(.4,(r.activeRules||0)/50),h=Math.min(.3,o.requestsPerSecond/1e3),p=u?.enableOWASP?.15:0,g=u?.enableRateLimiting?.1:0,v=u?.enableGeoBlocking?.05:0;if(s.utilization=Math.min(.95,.1+d+h+p+g+v),s.customMetrics={...s.customMetrics||{},waf_requests_total:r.requestsTotal,waf_requests_allowed:r.requestsAllowed,waf_requests_blocked:r.requestsBlocked,waf_threats_detected:r.threatsDetected,waf_threats_blocked:r.threatsBlocked,waf_rate_limit_hits:r.rateLimitHits,waf_geo_block_hits:r.geoBlockHits,waf_ip_block_hits:r.ipBlockHits,waf_owasp_hits:r.owaspHits,waf_custom_rule_hits:r.customRuleHits,waf_active_rules:r.activeRules,waf_block_rate:o.blockRate,waf_threat_detection_rate:o.threatDetectionRate,waf_average_latency:o.averageLatency},n){const b=this.connections.filter(R=>R.target===t.id);let x=0;for(const R of b){const C=this.metrics.get(R.source);C&&(x+=C.throughput||0)}x>0&&(i.setSimulatedRequestRate(x),i.simulateRequests(x))}}simulateFirewall(t,e,s,n){const i=this.firewallEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();i.getStats(),s.throughput=o.packetsPerSecond,s.latency=o.averageLatency,s.errorRate=o.blockRate+o.rejectionRate;const u=Math.min(.3,(r.activeRules||0)/100),d=Math.min(.3,o.packetsPerSecond/1e4),h=i.getConfig()?.enableStatefulInspection?.2:0,p=i.getConfig()?.enableIntrusionDetection?.2:0;if(s.utilization=Math.min(.95,.1+u+d+h+p),s.customMetrics={...s.customMetrics||{},firewall_packets_total:r.packetsTotal,firewall_packets_allowed:r.packetsAllowed,firewall_packets_blocked:r.packetsBlocked,firewall_packets_rejected:r.packetsRejected,firewall_active_rules:r.activeRules,firewall_total_connections:r.totalConnections,firewall_active_connections:r.activeConnections,firewall_block_rate:o.blockRate,firewall_rejection_rate:o.rejectionRate,firewall_average_latency:o.averageLatency},n){const g=this.connections.filter(b=>b.target===t.id);let v=0;for(const b of g){const x=this.metrics.get(b.source);x&&(v+=x.throughput||0)}v>0&&(i.setSimulatedPacketRate(v),i.simulatePackets(v))}i.cleanup()}simulateVPN(t,e,s,n){const i=this.vpnEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();i.getConfig(),s.throughput=o.packetsPerSecond,s.latency=o.averageLatency,s.errorRate=o.errorRate;const u=Math.min(.3,o.utilization*.5),d=Math.min(.2,(r.activeTunnels||0)/10),h=Math.min(.3,o.bytesPerSecond/(100*1024*1024)),p=Math.min(.2,(r.encryptionOperations||0)/1e4);if(s.utilization=Math.min(.95,.1+u+d+h+p),s.customMetrics={...s.customMetrics||{},vpn_total_connections:r.totalConnections,vpn_active_connections:r.activeConnections,vpn_total_tunnels:r.totalTunnels,vpn_active_tunnels:r.activeTunnels,vpn_bytes_in:r.totalBytesIn,vpn_bytes_out:r.totalBytesOut,vpn_packets_in:r.totalPacketsIn,vpn_packets_out:r.totalPacketsOut,vpn_encryption_operations:r.encryptionOperations,vpn_compression_operations:r.compressionOperations,vpn_failed_connections:r.failedConnections,vpn_average_latency:o.averageLatency,vpn_connections_per_second:o.connectionsPerSecond,vpn_bytes_per_second:o.bytesPerSecond},n){const g=this.connections.filter(x=>x.target===t.id);let v=0,b=0;for(const x of g){const R=this.metrics.get(x.source);R&&(v+=R.throughput||0,b+=(R.throughput||0)*1500)}v>0&&i.simulateIncomingTraffic(v,o.connectionsPerSecond)}i.cleanupStaleConnections()}simulateCDN(t,e,s,n){const i=this.cdnEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();i.getConfig(),s.throughput=o.requestsPerSecond,s.latency=o.averageLatency,s.errorRate=o.errorRate;const u=Math.min(.2,r.activeDistributions/Math.max(1,r.totalDistributions)),d=Math.min(.2,r.activeEdgeLocations/Math.max(1,r.totalEdgeLocations)),h=Math.min(.5,o.utilization*.5),p=o.cacheHitRate>.8?.1:0;if(s.utilization=Math.min(.95,.1+u+d+h-p),s.customMetrics={...s.customMetrics||{},cdn_total_distributions:r.totalDistributions,cdn_active_distributions:r.activeDistributions,cdn_total_edge_locations:r.totalEdgeLocations,cdn_active_edge_locations:r.activeEdgeLocations,cdn_total_requests:r.totalRequests,cdn_total_cache_hits:r.totalCacheHits,cdn_total_cache_misses:r.totalCacheMisses,cdn_total_bandwidth:r.totalBandwidth,cdn_average_cache_hit_rate:r.averageCacheHitRate,cdn_average_latency:o.averageLatency,cdn_requests_per_second:o.requestsPerSecond,cdn_bandwidth_per_second:o.bandwidthPerSecond,cdn_error_rate:o.errorRate,cdn_cache_hit_rate:o.cacheHitRate},n){const g=this.connections.filter(b=>b.target===t.id);let v=0;for(const b of g){const x=this.metrics.get(b.source);x&&(v+=x.throughput||0)}v>0&&i.simulateIncomingTraffic(v)}}simulateArgoCD(t,e,s,n){const i=this.argoCDEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.syncRate/3600,s.latency=o.averageSyncDuration||0;const r=o.syncOperationsSuccess+o.syncOperationsFailed;s.errorRate=r>0?o.syncOperationsFailed/r:0,s.utilization=o.applicationsTotal>0?o.syncOperationsRunning/o.applicationsTotal:0,s.customMetrics={applicationsTotal:o.applicationsTotal,applicationsSynced:o.applicationsSynced,applicationsOutOfSync:o.applicationsOutOfSync,syncOperationsRunning:o.syncOperationsRunning,repositoriesConnected:o.repositoriesConnected}}simulateTerraform(t,e,s,n){const i=this.terraformEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.runsPerHour/3600,s.latency=o.averageRunDuration||0;const r=o.runsSuccess+o.runsFailed;s.errorRate=r>0?o.runsFailed/r:0,s.utilization=o.workspacesTotal>0?Math.min(1,o.runsRunning/o.workspacesTotal):0,s.customMetrics={workspacesTotal:o.workspacesTotal,runsTotal:o.runsTotal,runsRunning:o.runsRunning,runsPending:o.runsPending,runsSuccess:o.runsSuccess,runsFailed:o.runsFailed,statesTotal:o.statesTotal,resourcesManaged:o.resourcesManaged,runsPerHour:o.runsPerHour,averageRunDuration:o.averageRunDuration}}simulateSpark(t,e,s,n){const i=this.sparkEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics(),r=1024;s.throughput=o.throughput/r,s.latency=o.averageJobDuration||0;const u=o.succeededJobs+o.failedJobs;s.errorRate=u>0?o.failedJobs/u:0;const d=5;if(s.utilization=Math.min(1,o.activeJobs/d),o.totalExecutors>0){const h=o.aliveExecutors/o.totalExecutors;s.utilization=Math.max(s.utilization,h*.7)}s.customMetrics={totalJobs:o.totalJobs,activeJobs:o.activeJobs,succeededJobs:o.succeededJobs,failedJobs:o.failedJobs,totalStages:o.totalStages,activeStages:o.activeStages,totalExecutors:o.totalExecutors,aliveExecutors:o.aliveExecutors,totalCores:o.totalCores,totalMemory:o.totalMemory,totalMemoryUsed:o.totalMemoryUsed,totalInputBytes:o.totalInputBytes,totalOutputBytes:o.totalOutputBytes,totalShuffleRead:o.totalShuffleRead,totalShuffleWrite:o.totalShuffleWrite,jobsPerHour:o.jobsPerHour,averageJobDuration:o.averageJobDuration,throughput:o.throughput}}simulateTensorFlowServing(t,e,s,n){const i=this.tensorFlowServingEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate;let r=o.batchUtilization;o.gpuUtilization!==void 0&&(r=Math.max(r,o.gpuUtilization)),r=Math.max(r,o.cpuUtilization),s.utilization=Math.min(1,r),s.customMetrics={totalModels:o.totalModels,servingModels:o.servingModels,loadingModels:o.loadingModels,unavailableModels:o.unavailableModels,totalPredictions:o.totalPredictions,successfulPredictions:o.successfulPredictions,failedPredictions:o.failedPredictions,averageLatency:o.averageLatency,p50Latency:o.p50Latency,p99Latency:o.p99Latency,requestsPerSecond:o.requestsPerSecond,throughput:o.throughput,errorRate:o.errorRate,batchUtilization:o.batchUtilization,gpuUtilization:o.gpuUtilization||0,memoryUsage:o.memoryUsage,cpuUtilization:o.cpuUtilization}}simulatePyTorchServe(t,e,s,n){const i=this.pytorchServeEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate;let r=o.batchUtilization;o.gpuUtilization!==void 0&&(r=Math.max(r,o.gpuUtilization)),r=Math.max(r,o.cpuUtilization),s.utilization=Math.min(1,r),s.customMetrics={totalModels:o.totalModels,servingModels:o.servingModels,loadingModels:o.loadingModels,unavailableModels:o.unavailableModels,totalPredictions:o.totalPredictions,successfulPredictions:o.successfulPredictions,failedPredictions:o.failedPredictions,averageLatency:o.averageLatency,p50Latency:o.p50Latency,p99Latency:o.p99Latency,requestsPerSecond:o.requestsPerSecond,throughput:o.throughput,errorRate:o.errorRate,batchUtilization:o.batchUtilization,gpuUtilization:o.gpuUtilization||0,memoryUsage:o.memoryUsage,cpuUtilization:o.cpuUtilization}}simulateFeatureStore(t,e,s,n){const i=this.featureStoreEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate;const r=Math.max(o.onlineStoreUtilization,o.offlineStoreUtilization);s.utilization=Math.min(1,r),s.customMetrics={totalFeatures:o.totalFeatures,activeFeatures:o.activeFeatures,deprecatedFeatures:o.deprecatedFeatures,totalFeatureSets:o.totalFeatureSets,requestsTotal:o.requestsTotal,requestsOnline:o.requestsOnline,requestsOffline:o.requestsOffline,requestsSuccess:o.requestsSuccess,requestsErrors:o.requestsErrors,averageLatency:o.averageLatency,p50Latency:o.p50Latency,p99Latency:o.p99Latency,requestsPerSecond:o.requestsPerSecond,throughput:o.throughput,errorRate:o.errorRate,cacheHits:o.cacheHits,cacheMisses:o.cacheMisses,cacheHitRate:o.cacheHitRate,onlineStoreUtilization:o.onlineStoreUtilization,offlineStoreUtilization:o.offlineStoreUtilization,validationPassed:o.validationPassed,validationFailed:o.validationFailed,totalFeatureUsage:o.totalFeatureUsage}}simulateTraefik(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.traefikEngines.get(t.id);if(!i){const u=e.maxConnections||1e4,d=e.requestsPerSecond||1e4,h=.5*Math.sin(this.simulationTime/2e3)+.5;s.throughput=d*h,s.latency=1+(1-h)*4,s.errorRate=1e-5,s.utilization=Math.min(1,s.throughput/d*(u/1e4)),s.customMetrics={max_connections:u,active_connections:Math.floor(s.throughput*.1)};return}const o=i.getStats(),r=i.getLoad();if(n&&o.totalRequests===0){const d=(e||{}).requestsPerSecond||100;i.simulateRequests(d)}s.throughput=r.requestsPerSecond,s.latency=r.averageLatency,s.errorRate=r.errorRate,s.utilization=r.utilization,s.customMetrics={routers:o.routers,active_routers:o.activeRouters,services:o.services,middlewares:o.middlewares,entry_points:o.entryPoints,total_servers:o.totalServers,healthy_servers:o.healthyServers,total_requests:o.totalRequests,total_responses:o.totalResponses,active_connections:o.activeConnections,total_bytes_in:o.totalBytesIn,total_bytes_out:o.totalBytesOut,error_rate:o.errorRate,average_latency:o.averageLatency}}simulateAnsible(t,e,s,n){const i=this.ansibleEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const o=i.getMetrics();s.throughput=o.jobsPerHour/3600,s.latency=o.averageJobDuration*1e3;const r=o.jobsSuccess+o.jobsFailed;s.errorRate=r>0?o.jobsFailed/r:0;const u=o.jobTemplatesEnabled||o.jobTemplatesTotal||1;s.utilization=Math.min(1,o.jobsRunning/u),s.customMetrics={inventoriesTotal:o.inventoriesTotal,projectsTotal:o.projectsTotal,credentialsTotal:o.credentialsTotal,jobTemplatesTotal:o.jobTemplatesTotal,jobTemplatesEnabled:o.jobTemplatesEnabled,jobsTotal:o.jobsTotal,jobsSuccess:o.jobsSuccess,jobsFailed:o.jobsFailed,jobsRunning:o.jobsRunning,jobsPending:o.jobsPending,jobsPerHour:o.jobsPerHour,averageJobDuration:o.averageJobDuration,hostsTotal:o.hostsTotal,hostsOk:o.hostsOk,hostsChanged:o.hostsChanged,hostsFailed:o.hostsFailed,hostsUnreachable:o.hostsUnreachable,schedulesTotal:o.schedulesTotal,schedulesEnabled:o.schedulesEnabled,requestsTotal:o.requestsTotal,requestsErrors:o.requestsErrors}}simulateHarbor(t,e,s,n){const i=this.harborEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate,s.utilization=(o.cpuUtilization+o.memoryUtilization+o.storageUtilization+o.networkUtilization)/4,s.customMetrics={...s.customMetrics||{},harbor_push_ops_per_sec:r.pushOperationsPerSecond,harbor_pull_ops_per_sec:r.pullOperationsPerSecond,harbor_scan_ops_per_sec:r.scanOperationsPerSecond,harbor_replication_ops_per_sec:r.replicationOperationsPerSecond,harbor_avg_push_latency:r.averagePushLatency,harbor_avg_pull_latency:r.averagePullLatency,harbor_avg_scan_latency:r.averageScanLatency,harbor_storage_used:r.storageUsed,harbor_storage_total:r.storageTotal,harbor_projects_total:r.totalProjects,harbor_repositories_total:r.totalRepositories,harbor_tags_total:r.totalTags,harbor_vulnerabilities_total:r.totalVulnerabilities,harbor_scans_completed:r.scansCompleted,harbor_scans_running:r.scansRunning,harbor_scans_failed:r.scansFailed,harbor_replication_policies_enabled:r.replicationPoliciesEnabled,harbor_active_replications:r.activeReplications,harbor_gc_operations_total:r.gcOperationsTotal,harbor_gc_storage_freed:r.gcStorageFreed,harbor_cpu_utilization:o.cpuUtilization,harbor_memory_utilization:o.memoryUtilization,harbor_storage_utilization:o.storageUtilization,harbor_network_utilization:o.networkUtilization}}simulateDocker(t,e,s,n){const i=this.dockerEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate,s.utilization=(o.cpuUtilization+o.memoryUtilization+o.networkUtilization+o.diskUtilization)/4,s.customMetrics={...s.customMetrics||{},docker_containers_total:r.containersTotal,docker_containers_running:r.containersRunning,docker_containers_stopped:r.containersStopped,docker_containers_paused:r.containersPaused,docker_images_total:r.imagesTotal,docker_images_size:r.imagesSize,docker_networks_total:r.networksTotal,docker_volumes_total:r.volumesTotal,docker_volumes_size:r.volumesSize,docker_ops_per_sec:r.operationsPerSecond,docker_avg_operation_latency:r.averageOperationLatency,docker_total_cpu_usage:r.totalCpuUsage,docker_total_memory_usage:r.totalMemoryUsage,docker_total_memory_limit:r.totalMemoryLimit,docker_total_network_rx:r.totalNetworkRx,docker_total_network_tx:r.totalNetworkTx,docker_build_ops_per_sec:r.buildOperationsPerSecond,docker_pull_ops_per_sec:r.pullOperationsPerSecond,docker_push_ops_per_sec:r.pushOperationsPerSecond,docker_cpu_utilization:o.cpuUtilization,docker_memory_utilization:o.memoryUtilization,docker_network_utilization:o.networkUtilization,docker_disk_utilization:o.diskUtilization}}simulateKubernetes(t,e,s,n){const i=this.kubernetesEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.getLoad(),r=i.getMetrics();s.throughput=o.throughput,s.latency=o.averageLatency,s.errorRate=o.errorRate,s.utilization=(o.cpuUtilization+o.memoryUtilization+o.podUtilization+o.networkUtilization+o.diskUtilization)/5,s.customMetrics={...s.customMetrics||{},k8s_pods_total:r.podsTotal,k8s_pods_running:r.podsRunning,k8s_pods_pending:r.podsPending,k8s_pods_failed:r.podsFailed,k8s_pods_succeeded:r.podsSucceeded,k8s_deployments_total:r.deploymentsTotal,k8s_deployments_ready:r.deploymentsReady,k8s_deployments_not_ready:r.deploymentsNotReady,k8s_services_total:r.servicesTotal,k8s_services_clusterip:r.servicesClusterIP,k8s_services_nodeport:r.servicesNodePort,k8s_services_loadbalancer:r.servicesLoadBalancer,k8s_nodes_total:r.nodesTotal,k8s_nodes_ready:r.nodesReady,k8s_nodes_not_ready:r.nodesNotReady,k8s_namespaces_total:r.namespacesTotal,k8s_configmaps_total:r.configMapsTotal,k8s_secrets_total:r.secretsTotal,k8s_total_cpu_usage:r.totalCpuUsage,k8s_total_memory_usage:r.totalMemoryUsage,k8s_total_memory_capacity:r.totalMemoryCapacity,k8s_cpu_utilization:o.cpuUtilization,k8s_memory_utilization:o.memoryUtilization,k8s_pod_utilization:o.podUtilization,k8s_network_utilization:o.networkUtilization,k8s_disk_utilization:o.diskUtilization}}simulateIDSIPS(t,e,s,n){const i=this.idsIpsEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();i.getStats(),s.throughput=o.packetsPerSecond,s.latency=o.averageLatency;const u=i.getConfig();u?.mode==="ips"?s.errorRate=o.blockRate:s.errorRate=0;const d=Math.min(.3,(r.activeSignatures||0)/100),h=Math.min(.3,o.packetsPerSecond/1e4),p=u?.enableSignatureDetection?.15:0,g=u?.enableAnomalyDetection?.15:0,v=u?.enableBehavioralAnalysis?.1:0;if(s.utilization=Math.min(.95,.1+d+h+p+g+v),s.customMetrics={...s.customMetrics||{},idsips_packets_total:r.packetsTotal,idsips_packets_analyzed:r.packetsAnalyzed,idsips_alerts_generated:r.alertsGenerated,idsips_alerts_blocked:r.alertsBlocked,idsips_signature_matches:r.signatureMatches,idsips_anomaly_detections:r.anomalyDetections,idsips_behavioral_detections:r.behavioralDetections,idsips_active_signatures:r.activeSignatures,idsips_blocked_ips:r.blockedIPs,idsips_alert_rate:o.alertRate,idsips_block_rate:o.blockRate},this.updateLatencyPercentiles(t.id,s.latency,s),!n){const b=this.connections.filter(R=>R.target===t.id);let x=0;for(const R of b){const C=this.metrics.get(R.source);C&&(x+=C.throughput||0)}x>0&&(i.setSimulatedPacketRate(x),i.simulatePackets(x))}}simulatePagerDuty(t,e,s,n){const i=this.pagerDutyEngines.get(t.id);if(!i){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=.1;return}const o=i.calculateLoad(),r=i.getMetrics();s.throughput=o.throughput,s.latency=o.latency,s.errorRate=o.errorRate,s.utilization=o.utilization,s.customMetrics={incidents_total:r.incidentsTotal,incidents_active:r.incidentsActive,incidents_resolved:r.incidentsResolved,notifications_sent:r.notificationsSent,escalations_triggered:r.escalationsTriggered,acknowledgements:r.acknowledgements,average_ack_latency_ms:r.averageAckLatency,average_resolve_latency_ms:r.averageResolveLatency,api_requests_per_second:r.apiRequestsPerSecond,webhooks_per_second:r.webhooksPerSecond,cpu_utilization:r.cpuUtilization,memory_utilization:r.memoryUtilization}}simulateLoki(t,e,s,n){if(!this.lokiEngines.has(t.id)){const p=new dk;p.initializeConfig(t),this.lokiEngines.set(t.id,p)}const i=this.lokiEngines.get(t.id);n&&this.processLokiIngestion(t,i);const o=i.getLokiMetrics(),r=i.calculateLoad();s.throughput=r.ingestionLinesPerSecond+r.queriesPerSecond;const u=r.ingestionLinesPerSecond/(r.ingestionLinesPerSecond+r.queriesPerSecond||1),d=1-u;s.latency=r.averageIngestionLatency*u+r.averageQueryLatency*d,s.errorRate=r.ingestionErrorRate*u+r.queryErrorRate*d;const h=Math.min(1,r.streamCount/(e.maxStreams||1e4));s.utilization=Math.max(r.storageUtilization,h),s.customMetrics={ingestion_lines_per_second:r.ingestionLinesPerSecond,ingestion_bytes_per_second:r.ingestionBytesPerSecond,ingestion_requests_total:o.ingestionRequestsTotal,ingestion_errors_total:o.ingestionErrorsTotal,ingestion_lines_total:o.ingestionLinesTotal,ingestion_bytes_total:o.ingestionBytesTotal,queries_per_second:r.queriesPerSecond,query_requests_total:o.queryRequestsTotal,query_errors_total:o.queryErrorsTotal,average_query_latency:r.averageQueryLatency,average_ingestion_latency:r.averageIngestionLatency,active_streams:r.streamCount,total_storage_size:o.totalStorageSize,storage_utilization:r.storageUtilization,retention_deletions:o.retentionDeletions}}processLokiIngestion(t,e){const s=this.connections.filter(n=>n.target===t.id);for(const n of s){const i=this.nodes.find(h=>h.id===n.source);if(!i)continue;const o=this.connectionMetrics.get(n.id);if(!o||o.traffic===0)continue;const u=o.traffic/200,d=this.generateLogsFromComponent(i,u);d.length>0&&e.processIngestion(d,i.id)}}generateLogsFromComponent(t,e){const s=[],n=t.type,i=t.data.label||t.id,o={app:i.toLowerCase().replace(/\s+/g,"-"),component:n,source:t.id.slice(0,8)},r=this.metrics.get(t.id),u=Math.ceil(e/100),d=Math.floor(e/u)||1;for(let h=0;h<u&&h<10;h++){const p=[];for(let g=0;g<d;g++){const v=Date.now()*1e6+g,b=this.getLogLevel(r),x=this.generateLogMessage(n,i,b,r);p.push([v.toString(),x])}p.length>0&&s.push({stream:{...o,level:this.getLogLevel(r)},values:p})}return s}getLogLevel(t){return t?t.errorRate>.1?"error":t.errorRate>.05||t.utilization>.9?"warn":"info":"info"}generateLogMessage(t,e,s,n){const i=new Date().toISOString();return s==="error"&&n?`[${i}] ERROR ${t}: Request failed, error rate: ${(n.errorRate*100).toFixed(2)}%`:s==="warn"&&n?`[${i}] WARN ${t}: High utilization: ${(n.utilization*100).toFixed(2)}%`:`[${i}] INFO ${t}: ${e} processing requests, throughput: ${n?.throughput.toFixed(2)||0}/s`}simulateBFF(t,e,s,n){if(!n){s.throughput=0,s.latency=0,s.errorRate=0,s.utilization=0;return}const i=this.bffRoutingEngines.get(t.id);if(!i){this.simulateAPI(t,e,s,n);return}const o=e||{},r=o.endpoints||[],u=o.backends||[],d=this.connections.filter(X=>X.target===t.id);let h=0;for(const X of d){const te=this.connectionMetrics.get(X.id);if(te){const Z=te.traffic/2048;h+=Z}}const p=e.requestsPerSecond||h||100,g=i.getStats(),v=.3*Math.sin(this.simulationTime/2e3)+.7;s.throughput=p*v;let b=g.averageLatency||100;const x=5+Math.random()*10,R=g.cacheHitRate||0,C=R*.8,k=b*(1-C)+x;s.latency=k+Math.random()*20;const T=g.totalRequests>0?g.totalErrors/g.totalRequests:.005,A=.001;s.errorRate=Math.min(1,T+A);const D=o.maxConcurrentRequests||100,_=s.throughput*(s.latency/1e3);s.utilization=Math.min(1,_/D);const L=r.reduce((X,te)=>X+(te.requests||0),0),O=u.filter(X=>X.status==="connected").length;s.customMetrics={endpoints:r.length,backends:u.length,connected_backends:O,total_requests:g.totalRequests,total_errors:g.totalErrors,avg_latency:Math.round(g.averageLatency),cache_hit_rate:Math.round(R*100)/100,endpoint_requests:L,aggregation_overhead:Math.round(x),concurrent_requests:Math.round(_)}}initializeKongRoutingEngine(t){const e=t.data.config||{},s=new IT;s.initialize({services:e.services||[],routes:e.routes||[],upstreams:e.upstreams||[],consumers:e.consumers||[],plugins:e.plugins||[]}),this.kongRoutingEngines.set(t.id,s)}initializeCloudAPIGatewayEngine(t){const e=t.data.config||{};e.provider||(e.provider="aws");const s=new Yk(e);this.cloudAPIGatewayEngines.set(t.id,s)}initializeNginxRoutingEngine(t){const e=t.data.config||{},s=new jT;s.initialize({locations:e.locations||[],upstreams:e.upstreams||[],rateLimitZones:e.rateLimitZones||[],sslCertificates:e.sslCertificates||[],enableSSL:e.enableSSL,sslPort:e.sslPort,enableGzip:e.enableGzip,enableCache:e.enableCache,maxWorkers:e.maxWorkers}),this.nginxRoutingEngines.set(t.id,s)}initializeHAProxyRoutingEngine(t){const e=t.data.config||{},s=new OT,n=(e.frontends||[]).map(o=>({id:o.id,name:o.name,bind:o.bind,mode:o.mode,defaultBackend:o.backends&&o.backends.length>0?o.backends[0]:void 0,backends:o.backends,ssl:o.ssl,requests:o.requests||0,responses:o.responses||0,bytesIn:o.bytesIn||0,bytesOut:o.bytesOut||0})),i=(e.backends||[]).map(o=>({id:o.id,name:o.name,mode:o.mode,balance:o.balance,servers:o.servers||[],healthCheck:o.healthCheck,stickTable:o.stickTable}));s.initialize({frontends:n,backends:i}),this.haproxyRoutingEngines.set(t.id,s)}initializeEnvoyRoutingEngine(t){const e=t.data.config||{},s=new qT,n=(e.clusters||[]).map(r=>({name:r.name,type:r.type||"STRICT_DNS",endpoints:(r.hosts||[]).map(u=>({address:u.address,port:u.port,weight:u.weight||1,healthStatus:u.healthStatus||"unknown"})),connectTimeout:r.connectTimeout||5e3,healthCheck:r.healthChecks?{enabled:!0,interval:r.healthCheckInterval||1e4,timeout:r.healthCheckTimeout||5e3,path:r.healthCheckPath||"/health",healthyThreshold:r.healthCheckHealthyThreshold||1,unhealthyThreshold:r.healthCheckUnhealthyThreshold||2}:void 0,circuitBreaker:r.circuitBreaker?{enabled:!0,maxConnections:r.circuitBreakerMaxConnections,maxRequests:r.circuitBreakerMaxRequests,maxRetries:r.circuitBreakerMaxRetries,consecutiveErrors:r.circuitBreakerConsecutiveErrors||5}:void 0,loadBalancingPolicy:r.loadBalancingPolicy||"ROUND_ROBIN",outlierDetection:r.outlierDetection?{enabled:!0,consecutiveErrors:r.outlierDetectionConsecutiveErrors||5,interval:r.outlierDetectionInterval||1e4,baseEjectionTime:r.outlierDetectionBaseEjectionTime||3e4,maxEjectionPercent:r.outlierDetectionMaxEjectionPercent||50}:void 0})),i=(e.listeners||[]).map(r=>({name:r.name,address:r.address||"0.0.0.0",port:r.port,protocol:r.protocol||"HTTP",filters:(r.filters||[]).map(u=>typeof u=="string"?{name:u,type:u}:u)})),o=(e.routes||[]).map(r=>({name:r.name,match:{prefix:r.match?.startsWith("/")?r.match:void 0,path:r.match&&!r.match.includes("*")&&!r.match.startsWith("/")?r.match:void 0,regex:r.match?.includes("*")?r.match.replace(/\*/g,".*"):void 0},cluster:r.cluster,priority:r.priority||0,timeout:r.timeout,retryPolicy:r.retryPolicy}));s.initialize({clusters:n,listeners:i,routes:o,globalConfig:{maxConnections:e.maxConnections||1024,connectTimeout:e.connectTimeout||5e3,requestTimeout:e.requestTimeout||15e3,drainTime:e.drainTime||600,rateLimit:e.enableRateLimiting?{enabled:!0,rate:e.rateLimitPerSecond||100,burst:e.rateLimitBurst||10}:void 0,tracing:e.enableTracing?{enabled:!0,provider:e.tracingProvider||"jaeger"}:void 0}}),this.envoyRoutingEngines.set(t.id,s)}initializeServiceMeshRoutingEngine(t){const e=t.data.config||{},s=new Wk;s.initialize({services:e.services||[],virtualServices:e.virtualServices||[],destinationRules:e.destinationRules||[],gateways:e.gateways||[],peerAuthentications:e.peerAuthentications||[],authorizationPolicies:e.authorizationPolicies||[],serviceEntries:e.serviceEntries||[],sidecars:e.sidecars||[],globalConfig:{enableMTLS:e.enableMTLS,mtlsMode:e.mtlsMode,enableTracing:e.enableTracing,tracingProvider:e.tracingProvider,enableMetrics:e.enableMetrics,metricsProvider:e.metricsProvider,enableAccessLog:e.enableAccessLog,maxConnections:e.maxConnections,defaultTimeout:e.defaultTimeout,defaultRetryAttempts:e.defaultRetryAttempts,defaultLoadBalancer:e.defaultLoadBalancer}}),this.serviceMeshRoutingEngines.set(t.id,s)}initializeIstioRoutingEngine(t){const e=t.data.config||{},s=new Mb,n=(e.services||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",host:g.host||`${g.name}.${g.namespace||"default"}.svc.cluster.local`,ports:g.ports||[{number:80,protocol:"HTTP"}],labels:g.labels||{},requests:g.requests||0,errors:g.errors||0,latency:g.latency||0,pods:g.pods||1,healthyPods:g.healthyPods||g.pods||1})),i=(e.virtualServices||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",hosts:g.hosts||[],gateways:g.gateways||[],http:g.http||[],tcp:g.tcp||[],tls:g.tls||[]})),o=(e.destinationRules||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",host:g.host,subsets:g.subsets||[],trafficPolicy:g.trafficPolicy||{}})),r=(e.gateways||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",selector:g.selector||{},servers:g.servers||[]})),u=(e.peerAuthentications||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",selector:g.selector||{},mtls:g.mtls||{mode:"PERMISSIVE"},portLevelMtls:g.portLevelMtls||{}})),d=(e.authorizationPolicies||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",selector:g.selector||{},action:g.action||"ALLOW",rules:g.rules||[]})),h=(e.serviceEntries||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",hosts:g.hosts||[],addresses:g.addresses||[],ports:g.ports||[],location:g.location||"MESH_EXTERNAL",resolution:g.resolution||"DNS",endpoints:g.endpoints||[]})),p=(e.sidecars||[]).map(g=>({id:g.id||g.name,name:g.name,namespace:g.namespace||"default",workloadSelector:g.workloadSelector||{},egress:g.egress||[],ingress:g.ingress||[]}));s.initialize({services:n,virtualServices:i,destinationRules:o,gateways:r,peerAuthentications:u,authorizationPolicies:d,serviceEntries:h,sidecars:p,globalConfig:{enableMTLS:e.enableMTLS??!0,mtlsMode:e.mtlsMode||"PERMISSIVE",enableTracing:e.enableTracing??!0,tracingProvider:e.tracingProvider||"jaeger",enableMetrics:e.enableMetrics??!0,metricsProvider:e.metricsProvider||"prometheus",enableAccessLog:e.enableAccessLog??!0,maxConnections:e.maxConnections||1e4,defaultTimeout:e.defaultTimeout||"30s",defaultRetryAttempts:e.defaultRetryAttempts||3}}),this.istioRoutingEngines.set(t.id,s)}initializeApigeeRoutingEngine(t){const e=t.data.config||{},s=new NT;s.initialize({organization:e.organization,environment:e.environment,proxies:e.proxies||[],policies:e.policies||[]}),this.apigeeRoutingEngines.set(t.id,s)}initializeMuleSoftRoutingEngine(t){const e=t.data.config||{},s=new zT,n=(e.applications||[]).map(o=>({name:o.name,runtimeVersion:o.runtimeVersion||"4.6.0",workerCount:o.workerCount||2,status:o.status||"stopped",connectors:o.connectors||[],errorStrategy:o.errorStrategy||"continue",reconnectionStrategy:o.reconnectionStrategy||"exponential",auditLogging:o.auditLogging||!1,flows:o.flows||[]})),i=(e.connectors||[]).map(o=>({name:o.name,type:o.type||"api",enabled:o.enabled!==!1,config:o.config||{},targetComponentType:o.targetComponentType,targetComponentId:o.targetComponentId}));s.initialize({organization:e.organization,environment:e.environment,applications:n,connectors:i}),this.mulesoftRoutingEngines.set(t.id,s)}initializeGraphQLGatewayRoutingEngine(t){const e=t.data.config||{},s=new KT;s.initialize({services:e.services||[],federation:e.federation,cacheTtl:e.cacheTtl,persistQueries:e.persistQueries,subscriptions:e.subscriptions,enableIntrospection:e.enableIntrospection,enableQueryComplexityAnalysis:e.enableQueryComplexityAnalysis,enableRateLimiting:e.enableRateLimiting,maxQueryDepth:e.maxQueryDepth,maxQueryComplexity:e.maxQueryComplexity,endpoint:e.endpoint}),this.graphQLGatewayRoutingEngines.set(t.id,s),this.lastGraphQLGatewayUpdate.set(t.id,Date.now())}initializeBFFRoutingEngine(t){const e=t.data.config||{},s=new YT;let n=null,i="";if(e.cacheMode==="redis"){const o=this.connections.find(r=>(r.source===t.id||r.target===t.id)&&this.nodes.find(u=>u.id===(r.source===t.id?r.target:r.source))?.type==="redis");if(o){const r=this.nodes.find(u=>u.id===(o.source===t.id?o.target:o.source));r&&r.type==="redis"&&(this.redisRoutingEngines.has(r.id)||this.initializeRedisRoutingEngine(r),n=this.redisRoutingEngines.get(r.id),i=r.id)}}s.initialize({backends:e.backends||[],endpoints:e.endpoints||[],enableCaching:e.enableCaching??!0,enableRequestBatching:e.enableRequestBatching??!1,enableResponseCompression:e.enableResponseCompression??!0,defaultTimeout:e.defaultTimeout||5e3,maxConcurrentRequests:e.maxConcurrentRequests||100,cacheMode:e.cacheMode||"memory",cacheTtl:e.cacheTtl||5,fallbackEnabled:e.fallbackEnabled??!0,fallbackComponent:e.fallbackComponent,redisEngine:n||void 0,redisNodeId:i||void 0}),this.bffRoutingEngines.set(t.id,s)}initializeRestApiRoutingEngine(t){const e=t.data.config||{},s=new XT;s.initialize({baseUrl:e.baseUrl||"https://api.example.com",version:e.version||"v1",title:e.title||"REST API",description:e.description||"RESTful API service",endpoints:(e.endpoints||[]).map(n=>({id:n.id||`${n.method}:${n.path}`,path:n.path,method:n.method,description:n.description,summary:n.summary,tags:n.tags,parameters:n.parameters,requestBody:n.requestBody,responseExample:n.responseExample,targetService:n.targetService,enabled:n.enabled!==!1,timeout:n.timeout,rateLimit:n.rateLimit})),authentication:e.authentication||{type:"none"},rateLimit:e.rateLimit,cors:e.cors}),this.restApiRoutingEngines.set(t.id,s)}initializeGRPCRoutingEngine(t){const e=t.data.config||{},s=new JT;s.initialize({endpoint:e.endpoint||"localhost:50051",services:(e.services||[]).map(n=>({name:n.name,methods:(n.methods||[]).map(i=>({name:i.name,inputType:i.inputType||"google.protobuf.Empty",outputType:i.outputType||"google.protobuf.Empty",streaming:i.streaming||"unary",enabled:i.enabled!==!1,timeout:i.timeout,rateLimit:i.rateLimit,retryPolicy:i.retryPolicy})),enabled:n.enabled!==!1})),reflectionEnabled:e.reflectionEnabled??!0,enableTLS:e.enableTLS??!1,enableCompression:e.enableCompression??!0,maxMessageSize:e.maxMessageSize||4,keepAliveTime:e.keepAliveTime||30,keepAliveTimeout:e.keepAliveTimeout||5,maxConnectionIdle:e.maxConnectionIdle||300,maxConnectionAge:e.maxConnectionAge||3600,maxConnectionAgeGrace:e.maxConnectionAgeGrace||5,authentication:e.authentication||{type:"none"},rateLimit:e.rateLimit,loadBalancing:e.loadBalancing}),this.grpcRoutingEngines.set(t.id,s)}initializeWebhookRelayRoutingEngine(t){const e=t.data.config||{},s=new ZT;s.initialize({relays:e.relays||[],enableRetryOnFailure:e.enableRetryOnFailure??!0,enableSignatureVerification:e.enableSignatureVerification??!0,enableRequestLogging:e.enableRequestLogging??!0,maxRetryAttempts:e.maxRetryAttempts||3,retryDelay:e.retryDelay||5,timeout:e.timeout||30}),this.webhookRelayRoutingEngines.set(t.id,s)}initializeWebhookEngine(t){const e=new ek;e.initializeConfig(t),this.webhookEngines.set(t.id,e)}initializeRedisRoutingEngine(t){const e=t.data.config||{},s=new tk;s.initialize({host:e.host||"localhost",port:e.port||6379,password:e.password||"",database:e.database||0,maxMemory:e.maxMemory||"256mb",maxMemoryPolicy:e.maxMemoryPolicy||"noeviction",enablePersistence:e.enablePersistence??!0,persistenceType:e.persistenceType||"rdb",enableCluster:e.enableCluster??!1,clusterNodes:e.clusterNodes||[],keys:Array.isArray(e.keys)?e.keys:[]}),this.redisRoutingEngines.set(t.id,s)}initializeCassandraRoutingEngine(t){const e=t.data.config||{},s=new sk;s.initialize({clusterName:e.clusterName||"archiphoenix-cluster",nodes:e.nodes||[],keyspaces:e.keyspaces||[],tables:e.tables||[],defaultConsistencyLevel:e.consistencyLevel||"QUORUM",defaultReplicationFactor:e.replicationFactor||3,datacenter:e.datacenter||"dc1"}),this.cassandraRoutingEngines.set(t.id,s)}initializeClickHouseRoutingEngine(t){const e=t.data.config||{},s=new nk;s.initialize({cluster:e.cluster||"archiphoenix-cluster",replication:e.replication||!1,tables:e.tables?.map(n=>({name:n.name,database:e.database||"default",engine:n.engine||"MergeTree",rows:n.rows||0,size:n.size||0,partitions:n.partitions||0,columns:n.columns||[]}))||[],maxMemoryUsage:e.maxMemoryUsage||10*1024*1024*1024,compression:e.compression||"LZ4"}),this.clickHouseRoutingEngines.set(t.id,s)}initializeSnowflakeRoutingEngine(t){const e=t.data.config||{},s=new ik;s.initialize({account:e.account||"archiphoenix",region:e.region||"us-east-1",warehouses:e.warehouses?.map(n=>({name:n.name,size:n.size||"Small",status:n.status||"suspended",autoSuspend:n.autoSuspend||(e.enableAutoSuspend?e.autoSuspendSeconds:void 0),autoResume:n.autoResume!==void 0?n.autoResume:e.enableAutoResume!==!1,minClusterCount:n.minClusterCount||1,maxClusterCount:n.maxClusterCount||1,currentClusterCount:n.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0}))||[],databases:e.databases?.map(n=>({name:n.name,comment:n.comment,retentionTime:n.retentionTime,size:n.size,schemas:n.schemas?.map(i=>({name:i.name,tables:i.tables||[],views:i.views||0,functions:i.functions||0}))||[]}))||[],role:e.role||"ACCOUNTADMIN",enableAutoSuspend:e.enableAutoSuspend,autoSuspendSeconds:e.autoSuspendSeconds,enableAutoResume:e.enableAutoResume}),this.snowflakeRoutingEngines.set(t.id,s)}initializeElasticsearchRoutingEngine(t){const e=t.data.config||{},s=new ok;s.initialize({clusterName:e.clusterName||"archiphoenix-cluster",nodes:e.nodes||["localhost:9200"],indices:e.indices||[],defaultShards:e.shards||5,defaultReplicas:e.replicas||1,refreshInterval:e.refreshInterval||"1s",enableSSL:e.enableSSL??!1,enableAuth:e.enableAuth??!1,username:e.username||"elastic",password:e.password||""}),this.elasticsearchRoutingEngines.set(t.id,s)}initializeS3RoutingEngine(t){const e=t.data.config||{},s=new ak,n=(e.buckets||[]).map(i=>({name:i.name,region:i.region||e.defaultRegion||"us-east-1",versioning:i.versioning||!1,encryption:i.encryption||"AES256",lifecycleEnabled:i.lifecycleEnabled||!1,lifecycleDays:i.lifecycleDays,glacierEnabled:i.glacierEnabled||!1,glacierDays:i.glacierDays,publicAccess:i.publicAccess||!1,lifecycleRules:e.lifecycleRules||[]}));s.initialize({buckets:n,defaultRegion:e.defaultRegion||"us-east-1"}),this.s3RoutingEngines.set(t.id,s)}initializePrometheusEngine(t){const e=new lk;e.initializeConfig(t),this.prometheusEngines.set(t.id,e)}initializeGrafanaEngine(t){const e=new uk;e.initializeConfig(t),this.grafanaEngines.set(t.id,e)}initializeGraphQLEngine(t){const e=new pk;e.initializeConfig(t),this.graphQLEngines.set(t.id,e)}initializeSOAPEngine(t){const e=new gk;e.initializeConfig(t),this.soapEngines.set(t.id,e)}initializeWebSocketEngine(t){const e=new mk;e.initialize(t,async(s,n,i)=>await cs.sendMessage(s,n,i)),this.websocketEngines.set(t.id,e)}initializeJaegerEngine(t){const e=new hk;e.initializeConfig(t),this.jaegerEngines.set(t.id,e)}initializeOpenTelemetryCollectorEngine(t){if(this.otelCollectorEngines.has(t.id))this.otelCollectorEngines.get(t.id).initializeConfig(t);else{const e=new yk;e.initializeConfig(t),this.otelCollectorEngines.set(t.id,e)}}initializePagerDutyEngine(t){const e=new vk;e.initializeFromNode(t),this.pagerDutyEngines.set(t.id,e)}initializeKeycloakEngine(t){const e=new wk;e.initializeConfig(t),this.keycloakEngines.set(t.id,e)}initializeVaultEngine(t){const e=new Tk;e.initializeConfig(t),this.vaultEngines.set(t.id,e)}initializeWAFEngine(t){const e=new Mk;e.initializeConfig(t),this.wafEngines.set(t.id,e)}initializeFirewallEngine(t){const e=new Ck;e.initializeConfig(t),this.firewallEngines.set(t.id,e)}initializeVPNEngine(t){const e=new Ak;e.initializeConfig(t),this.vpnEngines.set(t.id,e)}initializeCDNEngine(t){const e=new Pk;e.initializeConfig(t),this.cdnEngines.set(t.id,e)}initializeIDSIPSEngine(t){const e=new Ek;e.initializeConfig(t),this.idsIpsEngines.set(t.id,e)}initializeJenkinsEngine(t){const e=new _k;e.initializeConfig(t),this.jenkinsEngines.set(t.id,e)}initializeGitLabCIEngine(t){const e=new Lk;e.initializeConfig(t),this.gitlabCIEngines.set(t.id,e)}initializeArgoCDEngine(t){const e=new Ik;e.initializeConfig(t),this.argoCDEngines.set(t.id,e)}initializeTerraformEngine(t){const e=new Nk;e.initializeConfig(t),this.terraformEngines.set(t.id,e)}initializeAnsibleEngine(t){const e=new $k;e.initializeConfig(t),this.ansibleEngines.set(t.id,e)}initializeSparkEngine(t){const e=new Fk;e.initializeConfig(t),this.sparkEngines.set(t.id,e)}initializeTensorFlowServingEngine(t){const e=new Qk;e.initializeConfig(t),this.tensorFlowServingEngines.set(t.id,e)}initializePyTorchServeEngine(t){const e=new Vk;e.initializeConfig(t),this.pytorchServeEngines.set(t.id,e)}initializeFeatureStoreEngine(t){const e=new Gk;e.initializeConfig(t),this.featureStoreEngines.set(t.id,e)}initializeTraefikEngine(t){const e=new Uk;e.initializeConfig(t),this.traefikEngines.set(t.id,e)}initializeHarborEngine(t){const e=new zk;e.initializeConfig(t),this.harborEngines.set(t.id,e)}initializeDockerEngine(t){const e=new qk;e.initializeConfig(t),this.dockerEngines.set(t.id,e)}initializeKubernetesEngine(t){const e=new Hk;e.initializeConfig(t),this.kubernetesEngines.set(t.id,e)}createLokiQueryExecutor(t){const n=((t.data.config||{}).datasources||[]).find(u=>typeof u=="string"?!1:u.type==="loki");if(!n||typeof n=="string")return;const i=n.url||"",o=this.nodes.find(u=>u.type!=="loki"?!1:((u.data.config||{}).serverUrl||"http://loki:3100")===i||i.includes(u.id)||i.includes(u.data.label||""));if(!o)return;const r=this.lokiEngines.get(o.id);if(r)return(u,d,h,p)=>{const g=r.executeQuery(u,d,h,p);return{success:g.success,latency:g.latency,resultsCount:g.resultsCount,error:g.error}}}isPrometheusAvailableForGrafana(t){const e=this.connections.find(o=>o.source===t.id&&this.nodes.find(r=>r.id===o.target)?.type==="prometheus");if(!e)return!1;const s=this.nodes.find(o=>o.id===e.target);if(!s||!this.prometheusEngines.get(s.id))return!1;const i=this.metrics.get(s.id);return!(i&&i.errorRate>.5)}initializePostgreSQLConnectionPool(t){const e=t.data.config||{},s={maxConnections:e.maxConnections||100,minConnections:e.minConnections||0,idleTimeout:e.idleTimeout||3e5,maxLifetime:e.maxLifetime||36e5,connectionTimeout:e.connectionTimeout||5e3},n=new rk(s);this.postgresConnectionPools.set(t.id,n)}updateElasticsearchMetricsInConfig(t,e){const s=t.data.config||{};s.clusterHealth=e.clusterHealth,s.activeShards=e.activeShards,s.relocatingShards=e.relocatingShards,s.initializingShards=e.initializingShards;const n=s.indices||[],i=this.elasticsearchRoutingEngines.get(t.id)?.getIndices()||[];for(let o=0;o<n.length;o++){const r=n[o],u=i.find(d=>d.name===r.name);u&&(n[o]={...r,docs:u.docs,size:u.size,health:u.health})}s.indices=n,s.totalDocs=e.totalDocs,s.totalSize=e.totalSize}updateS3BucketMetricsInConfig(t,e){const s=t.data.config||{},n=s.buckets||[];for(let i=0;i<n.length;i++){const o=n[i],r=e.get(o.name);r&&(n[i]={...o,objectCount:r.objectCount,totalSize:r.totalSize})}s.buckets=n}calculateConnectionLatency(t,e,s){const i={sync:5,async:2,http:10,grpc:5,websocket:3}[t.type]||10,o=e.latency||0,r=s.latency||0,u=t.data||{},d=u.latencyMs||0,h=(u.jitterMs||0)*(Math.random()-.5),p=2+Math.random()*8+d+h;return i+(o+r)/2+p}calculateCacheHitRatio(t,e){let s=.95;e>0&&e<100?s=.9+Math.random()*.05:e>=100&&e<1e3?s=.95+Math.random()*.04:e>=1e3&&(s=.92+Math.random()*.05);const n=Math.sin(this.simulationTime/1e4)*.02;return Math.max(.85,Math.min(.99,s+n))}createDefaultMetrics(t,e){return{id:t,type:e,throughput:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now()}}createDefaultConnectionMetrics(t){return{id:t.id,source:t.source,target:t.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0}}initializeMetrics(){this.metrics.clear(),this.connectionMetrics.clear(),this.latencyHistory.clear(),this.connectionLatencyHistory.clear();for(const t of this.nodes)this.metrics.set(t.id,this.createDefaultMetrics(t.id,t.type))}getComponentMetrics(t){return this.metrics.get(t)}getRabbitMQRoutingEngine(t){return this.rabbitMQRoutingEngines.get(t)}getActiveMQRoutingEngine(t){return this.activeMQRoutingEngines.get(t)}getSQSRoutingEngine(t){return this.sqsRoutingEngines.get(t)}getAzureServiceBusRoutingEngine(t){return this.azureServiceBusRoutingEngines.get(t)}getPubSubRoutingEngine(t){return this.pubSubRoutingEngines.get(t)}getRedisRoutingEngine(t){return this.redisRoutingEngines.get(t)}getCassandraRoutingEngine(t){return this.cassandraRoutingEngines.get(t)}getClickHouseRoutingEngine(t){return this.clickHouseRoutingEngines.get(t)}getSnowflakeRoutingEngine(t){return this.snowflakeRoutingEngines.get(t)}getElasticsearchRoutingEngine(t){return this.elasticsearchRoutingEngines.get(t)}getKongRoutingEngine(t){return this.kongRoutingEngines.get(t)}getCloudAPIGatewayEngine(t){return this.cloudAPIGatewayEngines.get(t)}getNginxRoutingEngine(t){return this.nginxRoutingEngines.get(t)}getHAProxyRoutingEngine(t){return this.haproxyRoutingEngines.get(t)}getTraefikEmulationEngine(t){return this.traefikEngines.get(t)}getEnvoyRoutingEngine(t){return this.envoyRoutingEngines.get(t)}getIstioRoutingEngine(t){return this.istioRoutingEngines.get(t)}getServiceMeshRoutingEngine(t){return this.serviceMeshRoutingEngines.get(t)}getApigeeRoutingEngine(t){return this.apigeeRoutingEngines.get(t)}getMuleSoftRoutingEngine(t){return this.mulesoftRoutingEngines.get(t)}getGraphQLGatewayRoutingEngine(t){return this.graphQLGatewayRoutingEngines.get(t)}getBFFRoutingEngine(t){return this.bffRoutingEngines.get(t)}getRestApiRoutingEngine(t){return this.restApiRoutingEngines.get(t)}getGRPCRoutingEngine(t){return this.grpcRoutingEngines.get(t)}getWebhookRelayRoutingEngine(t){return this.webhookRelayRoutingEngines.get(t)}getWebhookEmulationEngine(t){return this.webhookEngines.get(t)}getLokiEmulationEngine(t){return this.lokiEngines.get(t)}getKeycloakEmulationEngine(t){return this.keycloakEngines.get(t)}getJenkinsEmulationEngine(t){return this.jenkinsEngines.get(t)}getGitLabCIEmulationEngine(t){return this.gitlabCIEngines.get(t)}getArgoCDEmulationEngine(t){return this.argoCDEngines.get(t)}getTerraformEmulationEngine(t){return this.terraformEngines.get(t)}getAnsibleEmulationEngine(t){return this.ansibleEngines.get(t)}getHarborEmulationEngine(t){return this.harborEngines.get(t)}getDockerEmulationEngine(t){return this.dockerEngines.get(t)}getSparkEmulationEngine(t){return this.sparkEngines.get(t)}getTensorFlowServingEmulationEngine(t){return this.tensorFlowServingEngines.get(t)}getPyTorchServeEmulationEngine(t){return this.pytorchServeEngines.get(t)}getFeatureStoreEmulationEngine(t){return this.featureStoreEngines.get(t)}getKubernetesEmulationEngine(t){return this.kubernetesEngines.get(t)}getVaultEmulationEngine(t){return this.vaultEngines.get(t)}getWAFEmulationEngine(t){return this.wafEngines.get(t)}getFirewallEmulationEngine(t){return this.firewallEngines.get(t)}getVPNEmulationEngine(t){return this.vpnEngines.get(t)}getCDNEmulationEngine(t){return this.cdnEngines.get(t)}getIDSIPSEmulationEngine(t){return this.idsIpsEngines.get(t)}getGraphQLEmulationEngine(t){return this.graphQLEngines.get(t)}getSOAPEmulationEngine(t){return this.soapEngines.get(t)}getWebSocketEmulationEngine(t){return this.websocketEngines.get(t)}getJaegerEmulationEngine(t){return this.jaegerEngines.get(t)}getAllJaegerEngines(){return new Map(this.jaegerEngines)}getOpenTelemetryCollectorRoutingEngine(t){return this.otelCollectorEngines.get(t)}checkSQSIAMPolicy(t,e,s,n){if(!t||t.length===0)return!0;const i=t.filter(u=>{const d=u.principal||"";if(d!==e&&d!=="*"&&!e.includes(d))return!1;const h=u.resource||"";let p=!1;if(h==="*"||h===s)p=!0;else if(h.endsWith("*")){const v=h.slice(0,-1);p=s.startsWith(v.replace(/.*:/,""))}else if(h.includes("sqs:")||h.includes("arn:aws:sqs")){const v=h.split(":").pop()||h.split("/").pop()||"";p=v===s||v==="*"||s.includes(v)}else p=s.includes(h)||h==="*";if(!p)return!1;const g=u.action||"";return!(g!==n&&g!=="*"&&!g.includes(n))});return i.length===0?!0:i.filter(u=>u.effect==="Deny").length>0?!1:(i.filter(u=>u.effect==="Allow").length>0,!0)}checkActiveMQACLPermissionPublic(t,e,s,n){return this.checkActiveMQACLPermission(t,e,s,n)}getConnectionMetrics(t){return this.connectionMetrics.get(t)}getAllComponentMetrics(){return Array.from(this.metrics.values())}getAllConnectionMetrics(){return Array.from(this.connectionMetrics.values())}getPagerDutyIncidents(t){const e=this.pagerDutyEngines.get(t);return e?e.getIncidents():[]}getPagerDutyMetrics(t){const e=this.pagerDutyEngines.get(t);return e?e.getMetrics():null}acknowledgePagerDutyIncident(t,e){const s=this.pagerDutyEngines.get(t);s&&s.acknowledgeIncident(Date.now(),e)}resolvePagerDutyIncident(t,e){const s=this.pagerDutyEngines.get(t);s&&s.resolveIncidentManually(Date.now(),e)}getIsRunning(){return this.isRunning}getSimulationTime(){return this.simulationTime}}const ve=new Xk;function Jk(c,t){let e=null;return function(...n){const i=()=>{e=null,c(...n)};e!==null&&clearTimeout(e),e=setTimeout(i,t)}}class Zk{logLevel;logs=[];maxLogs=100;constructor(){this.logLevel=2}debug(t,e){this.log(0,t,void 0,e)}info(t,e){this.log(1,t,void 0,e)}warn(t,e,s){this.log(2,t,e,s)}error(t,e,s){this.log(3,t,e,s)}log(t,e,s,n){if(t<this.logLevel)return;const i={level:t,message:e,error:s,timestamp:Date.now(),context:n};this.logs.push(i),this.logs.length>this.maxLogs&&this.logs.shift();const o=`[${this.getLevelName(t)}] ${e}`,r=n?{...n,error:s}:s;switch(t){case 0:console.debug(o,r||"");break;case 1:console.info(o,r||"");break;case 2:console.warn(o,r||"");break;case 3:console.error(o,r||"");break}}getLevelName(t){switch(t){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARN";case 3:return"ERROR";default:return"UNKNOWN"}}getRecentLogs(t,e=50){let s=this.logs;return t!==void 0&&(s=this.logs.filter(n=>n.level>=t)),s.slice(-e)}clearLogs(){this.logs=[]}setLogLevel(t){this.logLevel=t}}const Sb=new Zk,Cb=(c,t,e)=>Sb.warn(c,t,e),ii=(c,t,e)=>Sb.error(c,t,e),El="archiphoenix_diagram",Wf=1,eA=500,tA=()=>{try{const c=localStorage.getItem(El);if(!c)return null;const t=JSON.parse(c);return t.version!==Wf?(Cb("Diagram version mismatch, using defaults"),null):t}catch(c){return ii("Failed to load diagram from storage",c instanceof Error?c:new Error(String(c))),null}},sA=(c,t="My Diagram")=>{try{const e={...c,version:Wf,name:t,createdAt:localStorage.getItem(`${El}_createdAt`)||new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem(El,JSON.stringify(e)),localStorage.setItem(`${El}_createdAt`,e.createdAt)}catch(e){ii("Failed to save diagram to storage",e instanceof Error?e:new Error(String(e)))}},gt=Jk(sA,eA),nA=(c,t="diagram.json")=>{try{const e={...c,version:Wf,name:t.replace(".json",""),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},s=JSON.stringify(e,null,2),n=new Blob([s],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(e){ii("Failed to export diagram",e instanceof Error?e:new Error(String(e)))}},iA=c=>new Promise(t=>{try{const e=new FileReader;e.onload=s=>{try{const n=s.target?.result,i=JSON.parse(n);if(!i.nodes||!i.connections||typeof i.zoom!="number"||!i.pan)throw new Error("Invalid diagram format");i.groups||(i.groups=[]),t(i)}catch(n){ii("Failed to parse diagram file",n instanceof Error?n:new Error(String(n))),t(null)}},e.readAsText(c)}catch(e){ii("Failed to import diagram",e instanceof Error?e:new Error(String(e))),t(null)}}),oA=50,Ar=un((c,t)=>({past:[],future:[],canUndo:!1,canRedo:!1,pushState:e=>{c(s=>{const n=[...s.past,e];return n.length>oA&&n.shift(),{past:n,future:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{past:e,future:s}=t();if(e.length===0)return null;const n=e[e.length-1],i=e.slice(0,-1);return c({past:i,future:[n,...s],canUndo:i.length>0,canRedo:!0}),n},redo:()=>{const{past:e,future:s}=t();if(s.length===0)return null;const n=s[0],i=s.slice(1);return c({past:[...e,n],future:i,canUndo:!0,canRedo:i.length>0}),n},clearHistory:()=>{c({past:[],future:[],canUndo:!1,canRedo:!1})}}));class aA{rules=new Map;allRules=[];register(t){const e=t.sourceType;this.rules.has(e)||this.rules.set(e,[]);const s=this.rules.get(e);s&&(s.push(t),this.allRules.push(t),s.sort((n,i)=>(i.priority||0)-(n.priority||0)))}registerMany(t){t.forEach(e=>this.register(e))}findRules(t,e){const s=[],n=this.rules.get(t)||[];for(const o of n)(o.targetTypes==="*"||Array.isArray(o.targetTypes)&&o.targetTypes.includes(e))&&s.push(o);const i=this.rules.get("*")||[];for(const o of i)(o.targetTypes==="*"||Array.isArray(o.targetTypes)&&o.targetTypes.includes(e))&&s.push(o);return s.sort((o,r)=>(r.priority||0)-(o.priority||0))}getAllRules(){return[...this.allRules]}getRulesForSource(t){return this.rules.get(t)||[]}clear(){this.rules.clear(),this.allRules=[]}}const rA={postgres:5432,mongodb:27017,redis:6379,cassandra:9042,clickhouse:8123,elasticsearch:9200,rest:8080,grpc:50051,graphql:4e3,websocket:8080,webhook:8080,soap:8080,nginx:80,envoy:80,haproxy:80,traefik:80,docker:2375,kubernetes:6443,kafka:9092,rabbitmq:5672,activemq:61616,"aws-sqs":9324,prometheus:9090,grafana:3e3,loki:3100,jaeger:16686,keycloak:8080,"secrets-vault":8200,crm:8080,erp:8080,"payment-gateway":443},cA={"api-gateway":9100,postgres:9187,redis:9121,"service-mesh":15014,istio:15014,envoy:9901,cdn:9101,"aws-sqs":9102};class Rb{getHost(t){return t.data.label?t.data.label.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):t.id.slice(0,8)}getPort(t,e){const s=t.data.config||{};switch(e){case"main":return s.port||s.host?.split(":")[1]||rA[t.type];case"metrics":return s.metricsPort||s.metrics?.port||cA[t.type];case"admin":return s.adminPort||s.admin?.port}}getEndpoint(t,e="main"){const s=this.getHost(t),n=this.getPort(t,e);if(!n)throw new Error(`Port not found for ${t.type}:${e}`);return`${s}:${n}`}getURL(t,e="main",s="http"){const n=this.getEndpoint(t,e);return`${s}://${n}`}getConnectionMetadata(t,e,s){const n=this.getHost(t),i=this.getHost(e),o=this.getPort(t,"main"),r=this.getPort(e,"main");let u="http";return s.type==="grpc"?u="grpc":s.type==="websocket"?u="websocket":e.type==="kafka"?u="kafka":e.type==="rabbitmq"||e.type==="activemq"?u="rabbitmq":s.type==="async"?u="async":s.type==="sync"&&(u="sync"),{protocol:u,sourceHost:n,targetHost:i,sourcePort:o,targetPort:r,endpoint:r?`${i}:${r}`:void 0}}getCapabilities(t){return{defaultPort:this.getPort(t,"main"),metricsPort:this.getPort(t,"metrics"),adminPort:this.getPort(t,"admin"),getHost:e=>this.getHost(e),getPort:(e,s)=>this.getPort(e,s)}}}class lA{registry;discovery;constructor(){this.registry=new aA,this.discovery=new Rb}initialize(t){this.registry.registerMany(t)}handleConnectionCreated(t,e,s,n){const i=this.registry.findRules(t.type,e.type);if(i.length===0)return{sourceUpdated:!1,targetUpdated:!1};let o=!1,r=!1;const u=this.discovery.getConnectionMetadata(t,e,s);for(const d of i)try{const h=d.updateSourceConfig(t,e,s,u);if(h&&Object.keys(h).length>0&&(n(t.id,{data:{...t.data,config:{...t.data.config,...h}}}),o=!0),d.updateTargetConfig){const p=d.updateTargetConfig(t,e,s,u);p&&Object.keys(p).length>0&&(n(e.id,{data:{...e.data,config:{...e.data.config,...p}}}),r=!0)}}catch(h){ii(`Error applying rule for ${t.type} -> ${e.type}`,h instanceof Error?h:new Error(String(h)),{sourceType:t.type,targetType:e.type})}return{sourceUpdated:o,targetUpdated:r}}handleConnectionDeleted(t,e,s,n){const i=this.registry.findRules(t.type,e.type);if(i.length===0)return{sourceUpdated:!1,targetUpdated:!1};let o=!1,r=!1;const u=this.discovery.getConnectionMetadata(t,e,s);for(const d of i)try{if(d.cleanupSourceConfig){const h=d.cleanupSourceConfig(t,e,s,u);h&&Object.keys(h).length>0&&(n(t.id,{data:{...t.data,config:{...t.data.config,...h}}}),o=!0)}if(d.cleanupTargetConfig){const h=d.cleanupTargetConfig(t,e,s,u);h&&Object.keys(h).length>0&&(n(e.id,{data:{...e.data,config:{...e.data.config,...h}}}),r=!0)}}catch(h){ii(`Error cleaning up rule for ${t.type} -> ${e.type}`,h instanceof Error?h:new Error(String(h)),{sourceType:t.type,targetType:e.type})}return{sourceUpdated:o,targetUpdated:r}}getDiscovery(){return this.discovery}getRegistry(){return this.registry}}function uA(c){return{sourceType:"envoy",targetTypes:["rest","grpc","graphql","websocket","soap","webhook","postgres","mongodb","redis","cassandra","clickhouse","crm","erp","payment-gateway","bpmn-engine"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).clusters||[],r=o.find(p=>!p.hosts||!Array.isArray(p.hosts)?!1:p.hosts.some(g=>g.address===n.targetHost&&g.port===n.targetPort));if(r)return r.hosts.some(g=>g.address===n.targetHost&&g.port===n.targetPort)?null:{clusters:o.map(g=>g===r?{...g,hosts:[...g.hosts||[],{address:n.targetHost,port:n.targetPort}]}:g)};e.data.label||e.type;const u=`${e.type}-${e.id.slice(0,8)}-cluster`;let d="STRICT_DNS";n.protocol==="grpc"?d="STRICT_DNS":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(d="STATIC_DNS");const h={name:u,type:d,hosts:[{address:n.targetHost,port:n.targetPort}],healthChecks:!0,connectTimeout:5e3,requests:0,errors:0};return{clusters:[...o,h],totalClusters:o.length+1}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function dA(c){return{sourceType:"api-gateway",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).apis||[],u=`${n.protocol==="grpc","http"}://${n.targetHost}:${n.targetPort}`,d=`https://${n.targetHost}:${n.targetPort}`;if(o.find(R=>R.backendUrl===u||R.backendUrl===d||R.backend===u||R.backend===d))return null;const g=`${e.data.label||e.type}-api`,v=`/api/${e.type}`;let b="GET";e.type==="grpc"?b="POST":e.type==="websocket"&&(b="GET");const x={id:`api-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:g,path:v,method:b,backendUrl:u,enabled:!0,requests:0,errors:0,providerMetadata:{}};return{apis:[...o,x]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function hA(c){return{sourceType:"kong",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=i.services||[],r=i.routes||[],d=`${n.protocol==="grpc","http"}://${n.targetHost}:${n.targetPort}`,p=`${e.data.label||e.type}-service`;let g=o.find(C=>C.name===p||C.url===d);g||(g={id:String(o.length+1),name:p,url:d,routes:0,enabled:!0},o.push(g));const v=`/api/${e.type}`;if(r.find(C=>C.service===g.name&&C.path===v))return null;let x="GET";e.type==="grpc"?x="POST":(e.type==="websocket"||e.type==="rest"||e.type==="graphql")&&(x="GET");const R={id:String(r.length+1),path:v,method:x,service:g.name,stripPath:!0,protocols:["http","https"]};return g.routes=(g.routes||0)+1,{services:o,routes:[...r,R]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function fA(c){return{sourceType:"service-mesh",targetTypes:"*",priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).services||[];if(o.find(g=>g.host===n.targetHost&&g.port===n.targetPort))return null;const d=(e.data.label||e.type).toLowerCase().replace(/\s+/g,"-");let h="http";n.protocol==="grpc"?h="grpc":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(h="tcp");const p={name:d,namespace:"default",host:n.targetHost,port:n.targetPort,protocol:h,enabled:!0};return{services:[...o,p]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function pA(c){return{sourceType:"istio",targetTypes:"*",priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).services||[];if(o.find(g=>g.host===n.targetHost&&g.port===n.targetPort))return null;const d=(e.data.label||e.type).toLowerCase().replace(/\s+/g,"-");let h="http";n.protocol==="grpc"?h="grpc":(e.type==="postgres"||e.type==="mongodb"||e.type==="redis")&&(h="tcp");const p={name:d,namespace:"default",host:n.targetHost,port:n.targetPort,protocol:h,enabled:!0};return{services:[...o,p]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function gA(c){return{sourceType:"nginx",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).upstreams||[],r=`${e.type}-upstream`;let u=o.find(h=>h.name===r);if(u)return u.servers?.some(p=>(p.host===n.targetHost||p.address===`${n.targetHost}:${n.targetPort}`)&&(p.port===n.targetPort||p.address?.includes(`:${n.targetPort}`)))?null:{upstreams:o.map(p=>p.name===r?{...p,servers:[...p.servers||[],{host:n.targetHost,port:n.targetPort}]}:p)};const d={name:r,servers:[{host:n.targetHost,port:n.targetPort}],loadBalancing:"round-robin"};return{upstreams:[...o,d]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function mA(c){return{sourceType:"haproxy",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).backends||[],r=`${e.type}-backend`;let u=o.find(h=>h.name===r);if(u)return u.servers?.some(p=>(p.host===n.targetHost||p.address===`${n.targetHost}:${n.targetPort}`)&&(p.port===n.targetPort||p.address?.includes(`:${n.targetPort}`)))?null:{backends:o.map(p=>p.name===r?{...p,servers:[...p.servers||[],{host:n.targetHost,port:n.targetPort}]}:p)};const d={name:r,servers:[{host:n.targetHost,port:n.targetPort}],balance:"roundrobin"};return{backends:[...o,d]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function yA(c){return{sourceType:"traefik",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=i.services||{},r=i.routers||{},u=`${e.type}-service`,d=`${e.type}-router`;if(o[u])return o[u].servers?.some(v=>v.url===`http://${n.targetHost}:${n.targetPort}`)?null:{services:{...o,[u]:{...o[u],servers:[...o[u].servers||[],{url:`http://${n.targetHost}:${n.targetPort}`}]}}};const p=`Host(\`${(e.data.label||e.type).toLowerCase()}.local\`)`;return{services:{...o,[u]:{loadBalancer:{servers:[{url:`http://${n.targetHost}:${n.targetPort}`}]}}},routers:{...r,[d]:{rule:p,service:u}}}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function vA(c){return{sourceType:"*",targetTypes:["postgres","mongodb","redis","cassandra","clickhouse","elasticsearch"],priority:5,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=e.type;let r={};switch(o){case"postgres":r={database:{host:n.targetHost,port:n.targetPort,database:i.database?.database||"postgres",username:i.database?.username||"postgres",password:i.database?.password||""}};break;case"mongodb":r={database:{connectionString:`mongodb://${n.targetHost}:${n.targetPort}`,database:i.database?.database||"admin"}};break;case"redis":r={database:{host:n.targetHost,port:n.targetPort,password:i.database?.password||""}};break;case"cassandra":r={database:{hosts:[`${n.targetHost}:${n.targetPort}`],keyspace:i.database?.keyspace||"system"}};break;case"clickhouse":r={database:{host:n.targetHost,port:n.targetPort,database:i.database?.database||"default"}};break;case"elasticsearch":r={database:{hosts:[`http://${n.targetHost}:${n.targetPort}`]}};break;default:return null}return r},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function bA(c){return{sourceType:"*",targetTypes:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],priority:5,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const i=t.data.config||{},o=e.type;let r={};switch(o){case"kafka":r={messaging:{broker:`${n.targetHost}:${n.targetPort}`,topic:i.messaging?.topic||e.data.config?.defaultTopic||"default-topic",producerId:i.messaging?.producerId||t.id.slice(0,8)}};break;case"rabbitmq":r={messaging:{broker:`${n.targetHost}:${n.targetPort}`,exchange:i.messaging?.exchange||e.data.config?.defaultExchange||"amq.topic",routingKey:i.messaging?.routingKey||"default"}};break;case"activemq":const u=e.data.config?.queues||[],d=u.length>0&&typeof u[0]=="object"?u[0].name:u.length>0?u[0]:null;r={messaging:{broker:`${n.targetHost}:${n.targetPort}`,queue:i.messaging?.queue||d||"default-queue"}};break;case"aws-sqs":{const h=e.data.config?.queues||[],p=h.length>0&&typeof h[0]=="object"?h[0].name:h.length>0?h[0]:null,g=h.length>0&&typeof h[0]=="object"?h[0].region:e.data.config?.defaultRegion||"us-east-1";r={messaging:{queueUrl:`https://sqs.${g}.amazonaws.com/account/${p||"default-queue"}`,queueName:p||"default-queue",region:i.messaging?.region||g}};break}case"azure-service-bus":{const h=e.data.config||{},p=h.namespace||"archiphoenix.servicebus.windows.net";h.connectionString||`${p}`;const g=i.messaging?.entityType||h.entityType||"queue",v=i.messaging?.entityName||i.messaging?.queue||i.messaging?.topic||h.entityName||(g==="queue"?"events":"events-topic"),b=i.messaging?.subscriptionName||h.subscriptionName;r={messaging:{connectionString:h.connectionString||`Endpoint=sb://${p}/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=...`,namespace:p,entityType:g,queue:g==="queue"?v:void 0,topic:g==="topic"?v:void 0,subscriptionName:g==="topic"&&b?b:void 0}};break}case"gcp-pubsub":r={messaging:{projectId:i.messaging?.projectId||"default-project",topic:i.messaging?.topic||e.data.config?.defaultTopic||"default-topic"}};break;default:return null}return r},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function wA(c,t){const e=c.data.config||{};return e.metrics?.port?e.metrics.port:e.metricsPort?e.metricsPort:(c.type==="service-mesh"||c.type==="istio")&&e.metrics?.controlPlanePort?e.metrics.controlPlanePort:t.getPort(c,"metrics")}function xA(c){const t=c.data.config||{};return t.metrics?.path?t.metrics.path:t.metricsPath?t.metricsPath:c.type==="envoy"?t.metrics?.prometheusPath||"/stats/prometheus":"/metrics"}function ov(c){return c.data.label?c.data.label.toLowerCase().replace(/\s+/g,"-"):`${c.type}-${c.id.slice(0,8)}`}function av(c,t){const e=t.getHost(c),s=wA(c,t);if(!s){const n=t.getPort(c,"main");return n?`${e}:${n}`:null}return`${e}:${s}`}function MA(c){return{sourceType:"*",targetTypes:["prometheus"],priority:5,updateTargetConfig:(t,e,s,n)=>{const i=e.data.config||{},o=i.scrape_configs||[],r=i.scrapeInterval||"15s",u=xA(t),d=av(t,c);if(!d)return null;const h=ov(t),p={component:t.type,componentId:t.id},g=o.findIndex(b=>b.job_name===h);if(g>=0){const b=o[g];let x=!1;for(const R of b.static_configs||[]){if(R.targets&&R.targets.includes(d)){x=!0;break}if(R.labels?.componentId===t.id){R.targets.includes(d)||R.targets.push(d),x=!0;break}}if(!x){const R=[...o],C=[...b.static_configs||[]];return C.push({targets:[d],labels:p}),R[g]={...b,static_configs:C},{scrape_configs:R}}return null}const v={job_name:h,scrape_interval:r!=="15s"?r:void 0,metrics_path:u!=="/metrics"?u:void 0,static_configs:[{targets:[d],labels:p}]};return{scrape_configs:[...o,v]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s),cleanupTargetConfig:(t,e,s,n)=>{const o=(e.data.config||{}).scrape_configs||[];if(!o||o.length===0)return null;const r=av(t,c),u=ov(t),d=t.id;let h=!1;const p=o.map(g=>{if(g.job_name!==u)return g;const v=(g.static_configs||[]).map(b=>{if(b.labels?.componentId===d)return h=!0,null;if(r&&b.targets&&b.targets.includes(r)){const x=b.targets.filter(R=>R!==r);return x.length===0?(h=!0,null):(h=!0,{...b,targets:x})}return b}).filter(b=>b!==null);return v.length===0?(h=!0,null):{...g,static_configs:v}}).filter(g=>g!==null);return h?{scrape_configs:p}:null}}}function SA(c){return{sourceType:"grafana",targetTypes:["prometheus"],priority:10,updateSourceConfig:(t,e,s,n)=>{let o=(t.data.config||{}).datasources||[];o.length>0&&typeof o[0]=="string"&&(o=o.map(g=>({name:g,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:g===o[0]})));const r=c.getURL(e,"main"),u=n.targetHost||c.getHost(e),d=n.targetPort||c.getPort(e,"main")||9090,h=d===9090?`http://${u}:${d}`:r,p=o.findIndex(g=>g&&typeof g=="object"&&(g.type==="prometheus"||g.name?.toLowerCase().includes("prometheus")));if(p>=0){const g=[...o];return g[p]={...g[p],url:h,type:"prometheus",isDefault:g[p].isDefault??!0},{datasources:g}}else{const g={name:"Prometheus",type:"prometheus",url:h,access:"proxy",isDefault:o.length===0};return{datasources:[...o,g]}}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s),cleanupSourceConfig:(t,e,s,n)=>{let o=(t.data.config||{}).datasources||[];if(o.length>0&&typeof o[0]=="string")return null;const r=c.getURL(e,"main"),u=n.targetHost||c.getHost(e),d=n.targetPort||c.getPort(e,"main")||9090,h=d===9090?`http://${u}:${d}`:r,p=o.filter(g=>!(g&&typeof g=="object"&&g.url===h&&g.type==="prometheus"));return p.length!==o.length?{datasources:p}:null}}}function Eb(c){const t=["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],e=["rest","grpc","graphql","soap","websocket","webhook"],s=["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],n=["s3-datalake"],i=["crm","erp","payment-gateway"];return t.includes(c)?"database":e.includes(c)?"api":s.includes(c)?"messaging":n.includes(c)?"file":i.includes(c)?"api":"custom"}function Ol(c,t,e){const s=e?c.label||c.type:t.label||t.type,n=e?c.id.slice(0,8):t.id.slice(0,8);return`${s}-${n}`.toLowerCase().replace(/\s+/g,"-")}function CA(c){return{sourceType:"*",targetTypes:["mulesoft"],priority:5,updateTargetConfig:(t,e,s,n)=>{const o=(e.data.config||{}).connectors||[];if(o.find(p=>p.targetComponentId===t.id||p.name===Ol(t,e,!0)))return null;const u=Eb(t.type),h={name:Ol(t,e,!0),type:u,enabled:!0,config:{},targetComponentType:t.type,targetComponentId:t.id};return u==="database"&&n.targetHost&&n.targetPort?h.config={host:n.targetHost,port:n.targetPort}:u==="api"&&n.targetHost&&n.targetPort?h.config={baseUrl:`http://${n.targetHost}:${n.targetPort}`}:u==="messaging"&&(h.config={broker:n.targetHost&&n.targetPort?`${n.targetHost}:${n.targetPort}`:void 0}),{connectors:[...o,h]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function RA(c){return{sourceType:"mulesoft",targetTypes:"*",priority:5,updateSourceConfig:(t,e,s,n)=>{const o=(t.data.config||{}).connectors||[];if(o.find(p=>p.targetComponentId===e.id||p.name===Ol(t,e,!1)))return null;const u=Eb(e.type),h={name:Ol(t,e,!1),type:u,enabled:!0,config:{},targetComponentType:e.type,targetComponentId:e.id};return u==="database"&&n.targetHost&&n.targetPort?h.config={host:n.targetHost,port:n.targetPort}:u==="api"&&n.targetHost&&n.targetPort?h.config={baseUrl:`http://${n.targetHost}:${n.targetPort}`}:u==="messaging"&&n.targetHost&&n.targetPort&&(h.config={broker:`${n.targetHost}:${n.targetPort}`}),{connectors:[...o,h]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function EA(c){return{sourceType:"graphql-gateway",targetTypes:["graphql"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).services||[],r=`http://${n.targetHost}:${n.targetPort}/graphql`;if(o.find(p=>p.endpoint===r||p.name===e.data.label))return null;const d=e.data.label||e.type,h={id:`svc-${o.length+1}`,name:d,endpoint:r,status:"connected",requests:0,errors:0};return{services:[...o,h]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function TA(c){return{sourceType:"bff-service",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(t,e,s,n)=>{if(!n.targetHost||!n.targetPort)return null;const o=(t.data.config||{}).backends||[],r=e.data.label||e.type;if(o.find(p=>p.name===r||p.endpoint===`http://${n.targetHost}:${n.targetPort}`||p.id===e.id))return null;let d="http";e.type==="grpc"?d="grpc":e.type==="graphql"&&(d="graphql");const h={id:e.id||`backend-${Date.now()}`,name:r,endpoint:`http://${n.targetHost}:${n.targetPort}`,protocol:d,status:"connected",timeout:5e3,retries:3,retryBackoff:"exponential",circuitBreaker:{enabled:!0,failureThreshold:5,successThreshold:2,timeout:6e4}};return{backends:[...o,h]}},extractMetadata:(t,e,s)=>c.getConnectionMetadata(t,e,s)}}function kA(c){return[uA(c),gA(c),mA(c),yA(c),dA(c),hA(c),EA(c),TA(c),fA(c),pA(c),vA(c),bA(c),MA(c),SA(c),CA(c),RA(c)]}let Jh=null;function rv(){if(!Jh){const c=new Rb,t=new lA,e=kA(c);t.initialize(e),Jh=t}return Jh}const Gs=2e3,cv=140,lv=200,pl=(c,t)=>({x:Math.floor(c/Gs),y:Math.floor(t/Gs)}),AA=(c,t,e,s,n,i)=>{const o=n*Gs,r=(n+1)*Gs,u=i*Gs,d=(i+1)*Gs,h=c,p=c+e,g=t,v=t+s;return!(p<o||h>r||v<u||g>d)},Zh=c=>{const t=new Set,e=cv+lv,s=cv+lv,n=c.position.x,i=n+e,o=c.position.y,r=o+s,u=pl(n,o).x,d=pl(i,r).x,h=pl(n,o).y,p=pl(i,r).y;for(let g=u;g<=d;g++)for(let v=h;v<=p;v++)AA(n,o,e,s,g,v)&&t.add(`${g},${v}`);return t},Fs=(c,t=[])=>{if(c.length===0)return[];const e=new Set,s=new Map(c.map(n=>[n.id,n]));return c.forEach(n=>{Zh(n).forEach(o=>e.add(o))}),t.forEach(n=>{const i=s.get(n.source),o=s.get(n.target);i&&Zh(i).forEach(u=>e.add(u)),o&&Zh(o).forEach(u=>e.add(u))}),Array.from(e).map(n=>{const[i,o]=n.split(",").map(Number);return{x:i,y:o}})},Qs=c=>{if(c.length===0)return{minX:0,minY:0,maxX:Gs,maxY:Gs};const t=c.map(r=>r.x),e=c.map(r=>r.y),s=Math.min(...t),n=Math.min(...e),i=Math.max(...t),o=Math.max(...e);return{minX:s*Gs,minY:n*Gs,maxX:(i+1)*Gs,maxY:(o+1)*Gs}},ef={nodes:[],connections:[],groups:[],zoom:1,pan:{x:0,y:0}},Ee=un((c,t)=>{const e=tA(),s=e?{...ef,...e,groups:e.groups||[]}:ef;let n=!1,i=!1;const o=()=>{const h=t();return{nodes:h.nodes,connections:h.connections,groups:h.groups||[],zoom:h.zoom,pan:h.pan}},r=()=>{Ar.getState().pushState(o())},u=Fs(s.nodes,s.connections||[]),d=Qs(u);return{...s,selectedNodeId:null,selectedConnectionId:null,diagramName:e?.name||"Untitled Diagram",viewportWidth:0,viewportHeight:0,canvasBounds:d,canvasChunks:u,getDiagramState:o,updateCanvasBounds:()=>c(h=>{const p=Fs(h.nodes,h.connections);return{canvasChunks:p,canvasBounds:Qs(p)}}),addNode:h=>c(p=>{r();const g=[...p.nodes,h],v=Fs(g,p.connections),b={nodes:g,canvasChunks:v,canvasBounds:Qs(v)};return gt({...p,...b},p.diagramName),b}),updateNode:(h,p,g=!1)=>c(v=>{!g&&!n&&r();const b=v.nodes.map(C=>C.id===h?{...C,...p}:C),x=Fs(b,v.connections),R={nodes:b,canvasChunks:x,canvasBounds:Qs(x)};return(!n||!g)&&gt({...v,...R},v.diagramName),R}),updateNodes:(h,p=!1)=>c(g=>{!p&&!n&&!i&&r();const v=new Map(h.map(C=>[C.id,C.updates])),b=g.nodes.map(C=>{const k=v.get(C.id);return k?{...C,...k}:C}),x=Fs(b,g.connections),R={nodes:b,canvasChunks:x,canvasBounds:Qs(x)};return(!i||!p)&&gt({...g,...R},g.diagramName),R}),deleteNode:h=>c(p=>{r();const g=p.nodes.filter(R=>R.id!==h),v=p.connections.filter(R=>R.source!==h&&R.target!==h),b=Fs(g,v),x={nodes:g,connections:v,selectedNodeId:p.selectedNodeId===h?null:p.selectedNodeId,canvasChunks:b,canvasBounds:Qs(b)};return gt({...p,...x},p.diagramName),x}),selectNode:(h,p=!1)=>c(g=>p&&h&&g.nodes.find(b=>b.id===h)?{selectedNodeId:h,nodes:g.nodes.map(b=>({...b,selected:b.id===h?!b.selected:b.selected||!1}))}:{selectedNodeId:h,nodes:g.nodes.map(v=>({...v,selected:v.id===h}))}),selectNodesByIds:h=>c(p=>({selectedNodeId:h.length>0?h[0]:null,nodes:p.nodes.map(g=>({...g,selected:h.includes(g.id)}))})),addConnection:h=>c(p=>{r();const g={...h,type:h.type||"async"},v=p.nodes.find(T=>T.id===g.source),b=p.nodes.find(T=>T.id===g.target);let x=[...p.nodes];if(v&&b){const T=rv(),A=(D,_)=>{const L=x.findIndex(O=>O.id===D);L!==-1&&(x[L]={...x[L],..._})};T.handleConnectionCreated(v,b,g,A)}const R=[...p.connections,g],C=Fs(x,R),k={nodes:x,connections:R,canvasChunks:C,canvasBounds:Qs(C)};return gt({...p,...k},p.diagramName),k}),updateConnection:(h,p)=>c(g=>{r();const v={connections:g.connections.map(b=>b.id===h?{...b,...p}:b)};return gt({...g,...v},g.diagramName),v}),deleteConnection:h=>c(p=>{r();const g=p.connections.find(C=>C.id===h);let v=[...p.nodes];if(g){const C=p.nodes.find(T=>T.id===g.source),k=p.nodes.find(T=>T.id===g.target);if(C&&k){const T=rv(),A=(D,_)=>{const L=v.findIndex(O=>O.id===D);L!==-1&&(v[L]={...v[L],..._})};T.handleConnectionDeleted(C,k,g,A)}}const b=p.connections.filter(C=>C.id!==h),x=Fs(v,b),R={nodes:v,connections:b,selectedConnectionId:p.selectedConnectionId===h?null:p.selectedConnectionId,canvasChunks:x,canvasBounds:Qs(x)};return gt({...p,...R},p.diagramName),R}),selectConnection:h=>c(p=>({selectedConnectionId:h,selectedNodeId:null,selectedGroupId:null,connections:p.connections.map(g=>({...g,selected:g.id===h}))})),addGroup:h=>c(p=>{r();const g={groups:[...p.groups,h]};return gt({...p,...g},p.diagramName),g}),updateGroup:(h,p)=>c(g=>{r();const v={groups:g.groups.map(b=>b.id===h?{...b,...p}:b)};return gt({...g,...v},g.diagramName),v}),deleteGroup:h=>c(p=>{r();const g={groups:p.groups.filter(v=>v.id!==h)};return gt({...p,...g},p.diagramName),g}),addNodeToGroup:(h,p)=>c(g=>{r();const v={groups:g.groups.map(b=>b.id===h&&!b.nodeIds.includes(p)?{...b,nodeIds:[...b.nodeIds,p]}:b)};return gt({...g,...v},g.diagramName),v}),removeNodeFromGroup:(h,p)=>c(g=>{r();const v={groups:g.groups.map(b=>b.id===h?{...b,nodeIds:b.nodeIds.filter(x=>x!==p)}:b)};return gt({...g,...v},g.diagramName),v}),selectGroup:h=>c(p=>({selectedGroupId:h,selectedNodeId:null,selectedConnectionId:null})),createGroupFromSelection:h=>c(p=>{r();const g=p.nodes.filter(x=>x.selected||x.id===p.selectedNodeId).map(x=>x.id);if(g.length===0)return p;const v={id:`group-${Date.now()}`,name:h,nodeIds:g,color:`hsl(${Math.random()*360}, 70%, 50%)`},b={groups:[...p.groups,v],nodes:p.nodes.map(x=>({...x,selected:!1})),selectedNodeId:null};return gt({...p,...b},p.diagramName),b}),autoGroupByConnections:()=>c(h=>{r();const p=new Set;h.groups.forEach(T=>{T.nodeIds.forEach(A=>p.add(A))});const g=new Map,v=T=>{g.has(T)||g.set(T,T);const A=g.get(T);if(A!==void 0&&A!==T){const D=v(A);return g.set(T,D),D}return A??T},b=(T,A)=>{const D=v(T),_=v(A);D!==_&&g.set(D,_)};h.connections.forEach(T=>{!p.has(T.source)&&!p.has(T.target)&&b(T.source,T.target)});const x=new Map;h.nodes.forEach(T=>{if(!p.has(T.id)){const A=v(T.id);x.has(A)||x.set(A,[]);const D=x.get(A);D&&D.push(T.id)}});const R=[];let C=h.groups.length+1;x.forEach((T,A)=>{T.length>=2&&R.push({id:`group-${Date.now()}-${R.length}`,name:`Group ${C++}`,nodeIds:T,color:`hsl(${Math.random()*360}, 70%, 50%)`})});const k={groups:[...h.groups,...R]};return gt({...h,...k},h.diagramName),k}),setZoom:h=>c(p=>(gt({...p,zoom:h},p.diagramName),{zoom:h})),setPan:h=>c(p=>(gt({...p,pan:h},p.diagramName),{pan:h})),setViewportSize:h=>c(()=>({viewportWidth:h.width,viewportHeight:h.height})),setDiagramName:h=>c(p=>(gt(p,h),{diagramName:h})),loadDiagramState:(h,p=!1)=>c(()=>{p||r();const g=Fs(h.nodes||[],h.connections||[]),v={...h,canvasChunks:g,canvasBounds:Qs(g)};return gt(v,t().diagramName),v}),saveDiagram:()=>{const h=t();gt(h,h.diagramName)},resetCanvas:()=>{r();const h=Fs([],[]);c({...ef,canvasChunks:h,canvasBounds:Qs(h)})},undo:()=>{const h=Ar.getState().undo();h&&c(()=>{const p=Fs(h.nodes||[],h.connections||[]),g={...h,canvasChunks:p,canvasBounds:Qs(p)};return gt(g,t().diagramName),g})},redo:()=>{const h=Ar.getState().redo();h&&c(()=>{const p=Fs(h.nodes||[],h.connections||[]),g={...h,canvasChunks:p,canvasBounds:Qs(p)};return gt(g,t().diagramName),g})},startDragOperation:h=>{const p=t();n=!0,p.nodes.find(g=>g.id===h),r()},endDragOperation:()=>{n=!1;const h=t();gt(h,h.diagramName)},setGroupDragging:h=>{i=h},getIsGroupDragging:()=>i,bringToFront:h=>c(p=>{r();const g=p.nodes.findIndex(R=>R.id===h);if(g===-1)return p;const v=[...p.nodes],[b]=v.splice(g,1);v.push(b);const x={nodes:v};return gt({...p,...x},p.diagramName),x}),sendToBack:h=>c(p=>{r();const g=p.nodes.findIndex(R=>R.id===h);if(g===-1)return p;const v=[...p.nodes],[b]=v.splice(g,1);v.unshift(b);const x={nodes:v};return gt({...p,...x},p.diagramName),x}),bringForward:h=>c(p=>{r();const g=p.nodes.findIndex(x=>x.id===h);if(g===-1||g===p.nodes.length-1)return p;const v=[...p.nodes];[v[g],v[g+1]]=[v[g+1],v[g]];const b={nodes:v};return gt({...p,...b},p.diagramName),b}),sendBackward:h=>c(p=>{r();const g=p.nodes.findIndex(x=>x.id===h);if(g===-1||g===0)return p;const v=[...p.nodes];[v[g],v[g-1]]=[v[g-1],v[g]];const b={nodes:v};return gt({...p,...b},p.diagramName),b})}}),Ni=un((c,t)=>({isRunning:!1,messages:new Map,messageHistory:[],initialize:(e,s)=>{cs.initialize(e,s),t().updateMessages(e,s)},start:()=>{cs.start(),c({isRunning:!0});const e=setInterval(()=>{const{nodes:s,connections:n}=Ee.getState();t().updateMessages(s,n)},200);cs._pollInterval=e},stop:()=>{cs.stop();const e=cs._pollInterval;e&&clearInterval(e),c({isRunning:!1})},updateMessages:(e,s)=>{cs.updateNodesAndConnections(e,s);const n=new Map;for(const o of s)n.set(o.id,cs.getConnectionMessages(o.id));const i=cs.getMessageHistory(100);c({messages:n,messageHistory:i})},getConnectionMessages:e=>cs.getConnectionMessages(e),getComponentMessages:e=>cs.getComponentMessages(e),getMessageHistory:e=>cs.getMessageHistory(e)}));class DA{nodes=[];connections=[];componentMetrics=new Map;connectionMetrics=new Map;dependencyGraph=new Map;componentStatuses=new Map;update(t,e,s,n){this.nodes=t,this.connections=e,this.componentMetrics=s,this.connectionMetrics=n,this.buildDependencyGraph(),this.analyzeComponentHealth(),this.identifyCriticalPaths(),this.calculateImpactScores()}buildDependencyGraph(){this.dependencyGraph.clear();for(const t of this.nodes){const e=[],s=this.connections.filter(n=>n.target===t.id);for(const n of s){const i=this.connectionMetrics.get(n.id),o=this.componentMetrics.get(n.source);if(!i||!o)continue;const r=Math.max(i.throughputDependency,i.utilization,i.backpressure);let u="direct";i.bottleneck?u="critical":r>.7&&(u="indirect"),e.push({sourceId:n.source,targetId:t.id,connectionId:n.id,type:u,strength:r,impact:this.calculateDependencyImpact(n,o)})}this.dependencyGraph.set(t.id,e)}}calculateDependencyImpact(t,e){const s=this.connectionMetrics.get(t.id);if(!s)return 0;const n=e.errorRate,i=Math.min(1,s.latency/1e3),o=s.backpressure,r=e.utilization>.8?.5:0;return Math.min(1,n*.4+i*.2+o*.3+r*.1)}analyzeComponentHealth(){this.componentStatuses.clear();for(const t of this.nodes){const e=this.componentMetrics.get(t.id),s=this.dependencyGraph.get(t.id)||[];if(!e){this.componentStatuses.set(t.id,{nodeId:t.id,health:"down",dependencies:s,dependents:[],criticalPath:!1,impactScore:0,failureRisk:1});continue}let n="healthy",i=0;e.errorRate>.1?(n="critical",i+=.4):e.errorRate>.05&&(n="degraded",i+=.2),e.utilization>.9?(n==="healthy"&&(n="degraded"),i+=.3):e.utilization>.8&&(i+=.15),e.latency>1e3?(n==="healthy"&&(n="degraded"),i+=.2):e.latency>500&&(i+=.1);for(const r of s){const u=this.componentStatuses.get(r.sourceId);u&&(u.health==="critical"||u.health==="down"?(n==="healthy"&&(n="degraded"),i+=r.impact*.3):u.health==="degraded"&&(i+=r.impact*.15))}i=Math.min(1,i);const o=[];for(const r of this.connections)if(r.source===t.id){const u=this.connectionMetrics.get(r.id);u&&o.push({sourceId:t.id,targetId:r.target,connectionId:r.id,type:u.bottleneck?"critical":"direct",strength:u.throughputDependency,impact:this.calculateDependencyImpact(r,e)})}this.componentStatuses.set(t.id,{nodeId:t.id,health:n,dependencies:s,dependents:o,criticalPath:!1,impactScore:0,failureRisk:i})}}identifyCriticalPaths(){const t=this.nodes.filter(s=>!this.connections.some(n=>n.target===s.id)),e=this.nodes.filter(s=>!this.connections.some(n=>n.source===s.id));for(const s of t)for(const n of e){const i=this.findPath(s.id,n.id);i&&i.length>1&&i.some(r=>{const u=this.componentStatuses.get(r),d=this.connections.find(h=>i.includes(h.source)&&i.includes(h.target)&&i.indexOf(h.source)<i.indexOf(h.target));if(d){const h=this.connectionMetrics.get(d.id);return h?.bottleneck||(h?.backpressure||0)>.7}return u?.health==="critical"||u?.health==="down"})&&i.forEach(r=>{const u=this.componentStatuses.get(r);u&&(u.criticalPath=!0)})}}findPath(t,e){if(t===e)return[t];const s=[{nodeId:t,path:[t]}],n=new Set([t]);for(;s.length>0;){const{nodeId:i,path:o}=s.shift(),r=this.connections.filter(u=>u.source===i);for(const u of r){if(u.target===e)return[...o,e];n.has(u.target)||(n.add(u.target),s.push({nodeId:u.target,path:[...o,u.target]}))}}return null}calculateImpactScores(){for(const[t,e]of this.componentStatuses.entries()){let s=0;s+=Math.min(1,e.dependents.length/5)*.3,e.health==="critical"||e.health==="down"?s+=.4:e.health==="degraded"&&(s+=.2),e.criticalPath&&(s+=.2),s+=e.failureRisk*.1,e.impactScore=Math.min(1,s),this.componentStatuses.set(t,e)}}analyzeSystem(){const t=[],e=[],s=[],n=[];for(const[u,d]of this.componentStatuses.entries())if(d.criticalPath){const h=this.findPathToSink(u);h&&!t.some(p=>JSON.stringify(p)===JSON.stringify(h))&&t.push(h)}for(const[u,d]of this.connectionMetrics.entries())if(d.bottleneck){const h=this.connections.find(p=>p.id===u);h&&(e.includes(h.source)||e.push(h.source),e.includes(h.target)||e.push(h.target))}for(const[u,d]of this.componentStatuses.entries())(d.failureRisk>.6||d.health==="critical"||d.health==="down")&&s.push(u);this.generateRecommendations(n);const i=Array.from(this.componentStatuses.values()).map(u=>{switch(u.health){case"down":return 0;case"critical":return .25;case"degraded":return .5;case"healthy":return 1}}),o=i.length>0?i.reduce((u,d)=>u+d,0)/i.length:1;let r="healthy";return o<.25?r="down":o<.5?r="critical":o<.75&&(r="degraded"),{criticalPaths:t,bottlenecks:e,riskComponents:s,recommendations:n,overallHealth:r}}findPathToSink(t){const e=this.nodes.filter(s=>!this.connections.some(n=>n.source===s.id));for(const s of e){const n=this.findPath(t,s.id);if(n)return n}return null}generateRecommendations(t){for(const[s,n]of this.componentStatuses.entries()){const i=this.nodes.find(r=>r.id===s),o=this.componentMetrics.get(s);!i||!o||(o.utilization>.85&&t.push({type:"scaling",priority:o.utilization>.95?"critical":"high",componentId:s,message:`${i.data.label} is highly utilized (${(o.utilization*100).toFixed(0)}%)`,impact:"May cause performance degradation and increased latency",suggestion:`Consider scaling ${i.data.label} horizontally or vertically`}),o.errorRate>.05&&t.push({type:"monitoring",priority:o.errorRate>.1?"critical":"high",componentId:s,message:`${i.data.label} has high error rate (${(o.errorRate*100).toFixed(1)}%)`,impact:"Affects system reliability and user experience",suggestion:`Investigate error logs and implement error handling for ${i.data.label}`}),o.latency>500&&t.push({type:"optimization",priority:o.latency>1e3?"high":"medium",componentId:s,message:`${i.data.label} has high latency (${o.latency.toFixed(0)}ms)`,impact:"Affects end-to-end response time",suggestion:`Optimize ${i.data.label} performance or add caching`}),n.criticalPath&&n.failureRisk>.5&&t.push({type:"redundancy",priority:"high",componentId:s,message:`${i.data.label} is on a critical path and at risk`,impact:"Failure would significantly impact system",suggestion:`Add redundancy or failover for ${i.data.label}`}))}for(const[s,n]of this.connectionMetrics.entries()){const i=this.connections.find(u=>u.id===s);if(!i)continue;const o=this.nodes.find(u=>u.id===i.source),r=this.nodes.find(u=>u.id===i.target);n.bottleneck&&t.push({type:"optimization",priority:"critical",connectionId:s,message:`Connection between ${o?.data.label||"source"} and ${r?.data.label||"target"} is a bottleneck`,impact:"Limiting overall system throughput",suggestion:"Increase bandwidth or optimize data transfer between these components"}),n.backpressure>.7&&t.push({type:"optimization",priority:"high",connectionId:s,message:`High backpressure (${(n.backpressure*100).toFixed(0)}%) on connection`,impact:"Target component cannot process data fast enough",suggestion:"Scale target component or implement buffering/queuing"})}const e={critical:0,high:1,medium:2,low:3};t.sort((s,n)=>e[s.priority]-e[n.priority])}getComponentStatus(t){return this.componentStatuses.get(t)}getAllComponentStatuses(){return Array.from(this.componentStatuses.values())}getDependencies(t){return this.dependencyGraph.get(t)||[]}}const tf=new DA,yo=un((c,t)=>({componentStatuses:new Map,systemAnalysis:null,updateAnalysis:()=>{const{nodes:e,connections:s}=Ee.getState(),{componentMetrics:n,connectionMetrics:i}=_t.getState();tf.update(e,s,n,i);const o=tf.analyzeSystem(),r=new Map(tf.getAllComponentStatuses().map(u=>[u.nodeId,u]));c({componentStatuses:r,systemAnalysis:o})},getComponentStatus:e=>t().componentStatuses.get(e),getAllComponentStatuses:()=>Array.from(t().componentStatuses.values()),getSystemAnalysis:()=>t().systemAnalysis})),Kf=un((c,t)=>({alerts:[],updateAlerts:()=>{try{const{nodes:e,connections:s}=Ee.getState(),{componentMetrics:n,connectionMetrics:i}=_t.getState(),o=yo.getState().getAllComponentStatuses();fo.analyze(e,n,i,o);const r=fo.getAlerts();c({alerts:r})}catch(e){console.error("Error in updateAlerts:",e)}},acknowledgeAlert:e=>{fo.acknowledge(e);const s=fo.getAlerts();c({alerts:s})},clearAlerts:()=>{fo.clear(),c({alerts:[]})},getCriticalAlerts:()=>t().alerts.filter(e=>e.type==="critical"),getWarningAlerts:()=>t().alerts.filter(e=>e.type==="warning")})),Tb=un((c,t)=>(Ke.onError(()=>{t().updateErrors()}),{errors:[],updateErrors:()=>{const e=Ke.getErrors();c({errors:e})},clearErrors:()=>{Ke.clear(),c({errors:[]})},clearErrorsByFilter:e=>{Ke.clearByFilter(e),t().updateErrors()},removeError:e=>{Ke.removeError(e),t().updateErrors()},getErrorsBySeverity:e=>Ke.getErrorsBySeverity(e),getErrorsBySource:e=>Ke.getErrorsBySource(e),getErrorsByComponent:e=>Ke.getErrorsByComponent(e),getCriticalErrors:()=>Ke.getCriticalErrors(),getErrorCount:e=>Ke.getErrorCount(e),getStats:()=>Ke.getStats()})),_t=un((c,t)=>({isRunning:!1,simulationTime:0,updateInterval:100,componentMetrics:new Map,connectionMetrics:new Map,initialize:(e,s)=>{ve.initialize(e,s),c({componentMetrics:new Map(ve.getAllComponentMetrics().map(n=>[n.id,n])),connectionMetrics:new Map(ve.getAllConnectionMetrics().map(n=>[n.id,n]))}),Ni.getState().initialize(e,s)},start:()=>{console.log("useEmulationStore.start() called");try{const e=ve.getIsRunning();console.log("Engine running state:",e),e&&(console.log("Stopping engine first..."),ve.stop()),console.log("Calling emulationEngine.start()..."),ve.start(),console.log("Engine started, setting store isRunning to true"),c({isRunning:!0}),console.log("Starting data flow..."),Ni.getState().start(),console.log("Setting up polling interval...");const s=setInterval(()=>{t().updateMetrics()},t().updateInterval);ve._pollInterval=s,console.log("Start complete, polling interval set")}catch(e){throw console.error("Error in useEmulationStore.start():",e),e}},stop:()=>{ve.stop();const e=ve._pollInterval;e&&clearInterval(e),Ni.getState().stop(),c({isRunning:!1})},reset:()=>{ve.resetSimulation();const e=ve._pollInterval;e&&clearInterval(e),Ni.getState().stop(),c({isRunning:!1,simulationTime:0,componentMetrics:new Map,connectionMetrics:new Map})},setUpdateInterval:e=>{c({updateInterval:e})},updateMetrics:()=>{const{nodes:e,connections:s}=Ee.getState();ve.updateNodesAndConnections(e,s),c(n=>({simulationTime:ve.getSimulationTime(),componentMetrics:new Map(ve.getAllComponentMetrics().map(i=>[i.id,i])),connectionMetrics:new Map(ve.getAllConnectionMetrics().map(i=>[i.id,i]))})),Ni.getState().updateMessages(e,s),yo.getState().updateAnalysis(),Kf.getState().updateAlerts(),Tb.getState().updateErrors()},getComponentMetrics:e=>t().componentMetrics.get(e),getConnectionMetrics:e=>t().connectionMetrics.get(e)}));const PA=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),_A=c=>c.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,s)=>s?s.toUpperCase():e.toLowerCase()),uv=c=>{const t=_A(c);return t.charAt(0).toUpperCase()+t.slice(1)},kb=(...c)=>c.filter((t,e,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===e).join(" ").trim(),LA=c=>{for(const t in c)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var IA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const NA=S.forwardRef(({color:c="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:s,className:n="",children:i,iconNode:o,...r},u)=>S.createElement("svg",{ref:u,...IA,width:t,height:t,stroke:c,strokeWidth:s?Number(e)*24/Number(t):e,className:kb("lucide",n),...!i&&!LA(r)&&{"aria-hidden":"true"},...r},[...o.map(([d,h])=>S.createElement(d,h)),...Array.isArray(i)?i:[i]]));const Pe=(c,t)=>{const e=S.forwardRef(({className:s,...n},i)=>S.createElement(NA,{ref:i,iconNode:t,className:kb(`lucide-${PA(uv(c))}`,`lucide-${c}`,s),...n}));return e.displayName=uv(c),e};const zA=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],vo=Pe("activity",zA);const jA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],OA=Pe("arrow-down",jA);const qA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],HA=Pe("arrow-right",qA);const $A=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],BA=Pe("arrow-up",$A);const UA=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],FA=Pe("ban",UA);const QA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Yf=Pe("check",QA);const VA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Jl=Pe("chevron-down",VA);const GA=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Xf=Pe("chevron-right",GA);const WA=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ab=Pe("chevron-up",WA);const KA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],bo=Pe("circle-alert",KA);const YA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Jf=Pe("circle-check",YA);const XA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],JA=Pe("circle-question-mark",XA);const ZA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],go=Pe("circle-x",ZA);const eD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],tD=Pe("circle",eD);const sD=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Db=Pe("copy",sD);const nD=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],iD=Pe("download",nD);const oD=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],aD=Pe("eye",oD);const rD=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],dv=Pe("file-text",rD);const cD=[["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],lD=Pe("folder-minus",cD);const uD=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],wf=Pe("folder-plus",uD);const dD=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Pb=Pe("funnel",dD);const hD=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],fD=Pe("grip-vertical",hD);const pD=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],_b=Pe("info",pD);const gD=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Lb=Pe("layers",gD);const mD=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],yD=Pe("map",mD);const vD=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],bD=Pe("maximize-2",vD);const wD=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],xD=Pe("network",wD);const MD=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],SD=Pe("pause",MD);const CD=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],RD=Pe("play",CD);const ED=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ql=Pe("plus",ED);const TD=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Tl=Pe("power-off",TD);const kD=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],sf=Pe("power",kD);const AD=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],DD=Pe("redo-2",AD);const PD=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],_D=Pe("refresh-cw",PD);const LD=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ib=Pe("rotate-ccw",LD);const ID=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],ND=Pe("ruler",ID);const zD=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],jD=Pe("save",zD);const OD=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$r=Pe("search",OD);const qD=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],nf=Pe("settings-2",qD);const HD=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],$D=Pe("settings",HD);const BD=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],UD=Pe("sparkles",BD);const FD=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],QD=Pe("square-pen",FD);const VD=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],GD=Pe("star",VD);const WD=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Zl=Pe("trash-2",WD);const KD=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Nb=Pe("trending-down",KD);const YD=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],on=Pe("triangle-alert",YD);const XD=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],JD=Pe("undo-2",XD);const ZD=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],eP=Pe("upload",ZD);const tP=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],an=Pe("x",tP);const sP=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],zb=Pe("zap",sP);const nP=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],iP=Pe("zoom-in",nP);const oP=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],aP=Pe("zoom-out",oP);function rP(){const{isRunning:c,simulationTime:t,initialize:e,start:s,stop:n,reset:i}=_t(),{nodes:o,connections:r}=Ee();S.useEffect(()=>{const g=ve.getIsRunning();console.log("EmulationPanel mounted/updated",{storeIsRunning:c,engineIsRunning:g,simulationTime:t,nodesCount:o.length,connectionsCount:r.length}),c!==g&&(console.warn("State mismatch detected!",{storeIsRunning:c,engineIsRunning:g}),c&&!g?(console.log("Fixing: stopping store"),n()):!c&&g&&(console.log("Fixing: stopping engine"),ve.stop()))},[c,t,o.length,r.length,n]);const u=()=>{console.log("handleStart called",{isRunning:c,simulationTime:t,nodesCount:o.length,connectionsCount:r.length});try{t===0&&(console.log("Initializing emulation..."),e(o,r),console.log("Initialization complete")),console.log("Starting emulation..."),s(),console.log("Start called, isRunning should be true now")}catch(g){console.error("Error starting emulation:",g)}},d=()=>{n()},h=()=>{i()},p=g=>{const v=Math.floor(g/1e3),b=Math.floor(v/60),x=v%60;return`${b}:${x.toString().padStart(2,"0")}`};return y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx("div",{className:"text-sm text-muted-foreground w-12",children:p(t)}),y.jsx(ke,{size:"sm",variant:c?"default":"outline",onClick:g=>{console.log("Button clicked!",{isRunning:c,simulationTime:t,disabled:c}),g.preventDefault(),g.stopPropagation(),c?console.warn("Button clicked but isRunning is true, button should be disabled"):u()},disabled:c,title:"Start emulation",style:{pointerEvents:c?"none":"auto"},children:y.jsx(RD,{className:"w-4 h-4"})}),y.jsx(ke,{size:"sm",variant:c?"default":"outline",onClick:d,disabled:!c,title:"Stop emulation",children:y.jsx(SD,{className:"w-4 h-4"})}),y.jsx(ke,{size:"sm",variant:"outline",onClick:h,title:"Reset simulation",children:y.jsx(Ib,{className:"w-4 h-4"})})]})}const kt=S.forwardRef(({className:c,type:t,...e},s)=>y.jsx("input",{type:t,className:Te("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",c),ref:s,...e}));kt.displayName="Input";function cP(c){const t=lP(c),e=S.forwardRef((s,n)=>{const{children:i,...o}=s,r=S.Children.toArray(i),u=r.find(dP);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}function lP(c){const t=S.forwardRef((e,s)=>{const{children:n,...i}=e;if(S.isValidElement(n)){const o=fP(n),r=hP(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var uP=Symbol("radix.slottable");function dP(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===uP}function hP(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function fP(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}var pP=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],De=pP.reduce((c,t)=>{const e=cP(`Primitive.${t}`),s=S.forwardRef((n,i)=>{const{asChild:o,...r}=n,u=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),y.jsx(u,{...r,ref:i})});return s.displayName=`Primitive.${t}`,{...c,[t]:s}},{});function jb(c,t){c&&Hr.flushSync(()=>c.dispatchEvent(t))}var as=globalThis?.document?S.useLayoutEffect:()=>{};function gP(c,t){return S.useReducer((e,s)=>t[e][s]??e,c)}var ls=c=>{const{present:t,children:e}=c,s=mP(t),n=typeof e=="function"?e({present:s.isPresent}):S.Children.only(e),i=Le(s.ref,yP(n));return typeof e=="function"||s.isPresent?S.cloneElement(n,{ref:i}):null};ls.displayName="Presence";function mP(c){const[t,e]=S.useState(),s=S.useRef(null),n=S.useRef(c),i=S.useRef("none"),o=c?"mounted":"unmounted",[r,u]=gP(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const d=gl(s.current);i.current=r==="mounted"?d:"none"},[r]),as(()=>{const d=s.current,h=n.current;if(h!==c){const g=i.current,v=gl(d);c?u("MOUNT"):v==="none"||d?.display==="none"?u("UNMOUNT"):u(h&&g!==v?"ANIMATION_OUT":"UNMOUNT"),n.current=c}},[c,u]),as(()=>{if(t){let d;const h=t.ownerDocument.defaultView??window,p=v=>{const x=gl(s.current).includes(CSS.escape(v.animationName));if(v.target===t&&x&&(u("ANIMATION_END"),!n.current)){const R=t.style.animationFillMode;t.style.animationFillMode="forwards",d=h.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=R)})}},g=v=>{v.target===t&&(i.current=gl(s.current))};return t.addEventListener("animationstart",g),t.addEventListener("animationcancel",p),t.addEventListener("animationend",p),()=>{h.clearTimeout(d),t.removeEventListener("animationstart",g),t.removeEventListener("animationcancel",p),t.removeEventListener("animationend",p)}}else u("ANIMATION_END")},[t,u]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:S.useCallback(d=>{s.current=d?getComputedStyle(d):null,e(d)},[])}}function gl(c){return c?.animationName||"none"}function yP(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}function vP(c,t){const e=S.createContext(t),s=i=>{const{children:o,...r}=i,u=S.useMemo(()=>r,Object.values(r));return y.jsx(e.Provider,{value:u,children:o})};s.displayName=c+"Provider";function n(i){const o=S.useContext(e);if(o)return o;if(t!==void 0)return t;throw new Error(`\`${i}\` must be used within \`${c}\``)}return[s,n]}function xs(c,t=[]){let e=[];function s(i,o){const r=S.createContext(o),u=e.length;e=[...e,o];const d=p=>{const{scope:g,children:v,...b}=p,x=g?.[c]?.[u]||r,R=S.useMemo(()=>b,Object.values(b));return y.jsx(x.Provider,{value:R,children:v})};d.displayName=i+"Provider";function h(p,g){const v=g?.[c]?.[u]||r,b=S.useContext(v);if(b)return b;if(o!==void 0)return o;throw new Error(`\`${p}\` must be used within \`${i}\``)}return[d,h]}const n=()=>{const i=e.map(o=>S.createContext(o));return function(r){const u=r?.[c]||i;return S.useMemo(()=>({[`__scope${c}`]:{...r,[c]:u}}),[r,u])}};return n.scopeName=c,[s,bP(n,...t)]}function bP(...c){const t=c[0];if(c.length===1)return t;const e=()=>{const s=c.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=s.reduce((r,{useScope:u,scopeName:d})=>{const p=u(i)[`__scope${d}`];return{...r,...p}},{});return S.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return e.scopeName=t.scopeName,e}function os(c){const t=S.useRef(c);return S.useEffect(()=>{t.current=c}),S.useMemo(()=>(...e)=>t.current?.(...e),[])}var wP=S.createContext(void 0);function Ea(c){const t=S.useContext(wP);return c||t||"ltr"}function Lr(c,[t,e]){return Math.min(e,Math.max(t,c))}function ge(c,t,{checkForDefaultPrevented:e=!0}={}){return function(n){if(c?.(n),e===!1||!n.defaultPrevented)return t?.(n)}}function xP(c,t){return S.useReducer((e,s)=>t[e][s]??e,c)}var Zf="ScrollArea",[Ob]=xs(Zf),[MP,Ks]=Ob(Zf),qb=S.forwardRef((c,t)=>{const{__scopeScrollArea:e,type:s="hover",dir:n,scrollHideDelay:i=600,...o}=c,[r,u]=S.useState(null),[d,h]=S.useState(null),[p,g]=S.useState(null),[v,b]=S.useState(null),[x,R]=S.useState(null),[C,k]=S.useState(0),[T,A]=S.useState(0),[D,_]=S.useState(!1),[L,O]=S.useState(!1),X=Le(t,ce=>u(ce)),te=Ea(n);return y.jsx(MP,{scope:e,type:s,dir:te,scrollHideDelay:i,scrollArea:r,viewport:d,onViewportChange:h,content:p,onContentChange:g,scrollbarX:v,onScrollbarXChange:b,scrollbarXEnabled:D,onScrollbarXEnabledChange:_,scrollbarY:x,onScrollbarYChange:R,scrollbarYEnabled:L,onScrollbarYEnabledChange:O,onCornerWidthChange:k,onCornerHeightChange:A,children:y.jsx(De.div,{dir:te,...o,ref:X,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":T+"px",...c.style}})})});qb.displayName=Zf;var Hb="ScrollAreaViewport",$b=S.forwardRef((c,t)=>{const{__scopeScrollArea:e,children:s,nonce:n,...i}=c,o=Ks(Hb,e),r=S.useRef(null),u=Le(t,r,o.onViewportChange);return y.jsxs(y.Fragment,{children:[y.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),y.jsx(De.div,{"data-radix-scroll-area-viewport":"",...i,ref:u,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...c.style},children:y.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});$b.displayName=Hb;var An="ScrollAreaScrollbar",ep=S.forwardRef((c,t)=>{const{forceMount:e,...s}=c,n=Ks(An,c.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=n,r=c.orientation==="horizontal";return S.useEffect(()=>(r?i(!0):o(!0),()=>{r?i(!1):o(!1)}),[r,i,o]),n.type==="hover"?y.jsx(SP,{...s,ref:t,forceMount:e}):n.type==="scroll"?y.jsx(CP,{...s,ref:t,forceMount:e}):n.type==="auto"?y.jsx(Bb,{...s,ref:t,forceMount:e}):n.type==="always"?y.jsx(tp,{...s,ref:t}):null});ep.displayName=An;var SP=S.forwardRef((c,t)=>{const{forceMount:e,...s}=c,n=Ks(An,c.__scopeScrollArea),[i,o]=S.useState(!1);return S.useEffect(()=>{const r=n.scrollArea;let u=0;if(r){const d=()=>{window.clearTimeout(u),o(!0)},h=()=>{u=window.setTimeout(()=>o(!1),n.scrollHideDelay)};return r.addEventListener("pointerenter",d),r.addEventListener("pointerleave",h),()=>{window.clearTimeout(u),r.removeEventListener("pointerenter",d),r.removeEventListener("pointerleave",h)}}},[n.scrollArea,n.scrollHideDelay]),y.jsx(ls,{present:e||i,children:y.jsx(Bb,{"data-state":i?"visible":"hidden",...s,ref:t})})}),CP=S.forwardRef((c,t)=>{const{forceMount:e,...s}=c,n=Ks(An,c.__scopeScrollArea),i=c.orientation==="horizontal",o=tu(()=>u("SCROLL_END"),100),[r,u]=xP("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return S.useEffect(()=>{if(r==="idle"){const d=window.setTimeout(()=>u("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(d)}},[r,n.scrollHideDelay,u]),S.useEffect(()=>{const d=n.viewport,h=i?"scrollLeft":"scrollTop";if(d){let p=d[h];const g=()=>{const v=d[h];p!==v&&(u("SCROLL"),o()),p=v};return d.addEventListener("scroll",g),()=>d.removeEventListener("scroll",g)}},[n.viewport,i,u,o]),y.jsx(ls,{present:e||r!=="hidden",children:y.jsx(tp,{"data-state":r==="hidden"?"hidden":"visible",...s,ref:t,onPointerEnter:ge(c.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:ge(c.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),Bb=S.forwardRef((c,t)=>{const e=Ks(An,c.__scopeScrollArea),{forceMount:s,...n}=c,[i,o]=S.useState(!1),r=c.orientation==="horizontal",u=tu(()=>{if(e.viewport){const d=e.viewport.offsetWidth<e.viewport.scrollWidth,h=e.viewport.offsetHeight<e.viewport.scrollHeight;o(r?d:h)}},10);return wa(e.viewport,u),wa(e.content,u),y.jsx(ls,{present:s||i,children:y.jsx(tp,{"data-state":i?"visible":"hidden",...n,ref:t})})}),tp=S.forwardRef((c,t)=>{const{orientation:e="vertical",...s}=c,n=Ks(An,c.__scopeScrollArea),i=S.useRef(null),o=S.useRef(0),[r,u]=S.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=Gb(r.viewport,r.content),h={...s,sizes:r,onSizesChange:u,hasThumb:d>0&&d<1,onThumbChange:g=>i.current=g,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:g=>o.current=g};function p(g,v){return DP(g,o.current,r,v)}return e==="horizontal"?y.jsx(RP,{...h,ref:t,onThumbPositionChange:()=>{if(n.viewport&&i.current){const g=n.viewport.scrollLeft,v=hv(g,r,n.dir);i.current.style.transform=`translate3d(${v}px, 0, 0)`}},onWheelScroll:g=>{n.viewport&&(n.viewport.scrollLeft=g)},onDragScroll:g=>{n.viewport&&(n.viewport.scrollLeft=p(g,n.dir))}}):e==="vertical"?y.jsx(EP,{...h,ref:t,onThumbPositionChange:()=>{if(n.viewport&&i.current){const g=n.viewport.scrollTop,v=hv(g,r);i.current.style.transform=`translate3d(0, ${v}px, 0)`}},onWheelScroll:g=>{n.viewport&&(n.viewport.scrollTop=g)},onDragScroll:g=>{n.viewport&&(n.viewport.scrollTop=p(g))}}):null}),RP=S.forwardRef((c,t)=>{const{sizes:e,onSizesChange:s,...n}=c,i=Ks(An,c.__scopeScrollArea),[o,r]=S.useState(),u=S.useRef(null),d=Le(t,u,i.onScrollbarXChange);return S.useEffect(()=>{u.current&&r(getComputedStyle(u.current))},[u]),y.jsx(Fb,{"data-orientation":"horizontal",...n,ref:d,sizes:e,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":eu(e)+"px",...c.style},onThumbPointerDown:h=>c.onThumbPointerDown(h.x),onDragScroll:h=>c.onDragScroll(h.x),onWheelScroll:(h,p)=>{if(i.viewport){const g=i.viewport.scrollLeft+h.deltaX;c.onWheelScroll(g),Kb(g,p)&&h.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&s({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:$l(o.paddingLeft),paddingEnd:$l(o.paddingRight)}})}})}),EP=S.forwardRef((c,t)=>{const{sizes:e,onSizesChange:s,...n}=c,i=Ks(An,c.__scopeScrollArea),[o,r]=S.useState(),u=S.useRef(null),d=Le(t,u,i.onScrollbarYChange);return S.useEffect(()=>{u.current&&r(getComputedStyle(u.current))},[u]),y.jsx(Fb,{"data-orientation":"vertical",...n,ref:d,sizes:e,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":eu(e)+"px",...c.style},onThumbPointerDown:h=>c.onThumbPointerDown(h.y),onDragScroll:h=>c.onDragScroll(h.y),onWheelScroll:(h,p)=>{if(i.viewport){const g=i.viewport.scrollTop+h.deltaY;c.onWheelScroll(g),Kb(g,p)&&h.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&s({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:$l(o.paddingTop),paddingEnd:$l(o.paddingBottom)}})}})}),[TP,Ub]=Ob(An),Fb=S.forwardRef((c,t)=>{const{__scopeScrollArea:e,sizes:s,hasThumb:n,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:r,onThumbPositionChange:u,onDragScroll:d,onWheelScroll:h,onResize:p,...g}=c,v=Ks(An,e),[b,x]=S.useState(null),R=Le(t,X=>x(X)),C=S.useRef(null),k=S.useRef(""),T=v.viewport,A=s.content-s.viewport,D=os(h),_=os(u),L=tu(p,10);function O(X){if(C.current){const te=X.clientX-C.current.left,ce=X.clientY-C.current.top;d({x:te,y:ce})}}return S.useEffect(()=>{const X=te=>{const ce=te.target;b?.contains(ce)&&D(te,A)};return document.addEventListener("wheel",X,{passive:!1}),()=>document.removeEventListener("wheel",X,{passive:!1})},[T,b,A,D]),S.useEffect(_,[s,_]),wa(b,L),wa(v.content,L),y.jsx(TP,{scope:e,scrollbar:b,hasThumb:n,onThumbChange:os(i),onThumbPointerUp:os(o),onThumbPositionChange:_,onThumbPointerDown:os(r),children:y.jsx(De.div,{...g,ref:R,style:{position:"absolute",...g.style},onPointerDown:ge(c.onPointerDown,X=>{X.button===0&&(X.target.setPointerCapture(X.pointerId),C.current=b.getBoundingClientRect(),k.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",v.viewport&&(v.viewport.style.scrollBehavior="auto"),O(X))}),onPointerMove:ge(c.onPointerMove,O),onPointerUp:ge(c.onPointerUp,X=>{const te=X.target;te.hasPointerCapture(X.pointerId)&&te.releasePointerCapture(X.pointerId),document.body.style.webkitUserSelect=k.current,v.viewport&&(v.viewport.style.scrollBehavior=""),C.current=null})})})}),Hl="ScrollAreaThumb",Qb=S.forwardRef((c,t)=>{const{forceMount:e,...s}=c,n=Ub(Hl,c.__scopeScrollArea);return y.jsx(ls,{present:e||n.hasThumb,children:y.jsx(kP,{ref:t,...s})})}),kP=S.forwardRef((c,t)=>{const{__scopeScrollArea:e,style:s,...n}=c,i=Ks(Hl,e),o=Ub(Hl,e),{onThumbPositionChange:r}=o,u=Le(t,p=>o.onThumbChange(p)),d=S.useRef(void 0),h=tu(()=>{d.current&&(d.current(),d.current=void 0)},100);return S.useEffect(()=>{const p=i.viewport;if(p){const g=()=>{if(h(),!d.current){const v=PP(p,r);d.current=v,r()}};return r(),p.addEventListener("scroll",g),()=>p.removeEventListener("scroll",g)}},[i.viewport,h,r]),y.jsx(De.div,{"data-state":o.hasThumb?"visible":"hidden",...n,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:ge(c.onPointerDownCapture,p=>{const v=p.target.getBoundingClientRect(),b=p.clientX-v.left,x=p.clientY-v.top;o.onThumbPointerDown({x:b,y:x})}),onPointerUp:ge(c.onPointerUp,o.onThumbPointerUp)})});Qb.displayName=Hl;var sp="ScrollAreaCorner",Vb=S.forwardRef((c,t)=>{const e=Ks(sp,c.__scopeScrollArea),s=!!(e.scrollbarX&&e.scrollbarY);return e.type!=="scroll"&&s?y.jsx(AP,{...c,ref:t}):null});Vb.displayName=sp;var AP=S.forwardRef((c,t)=>{const{__scopeScrollArea:e,...s}=c,n=Ks(sp,e),[i,o]=S.useState(0),[r,u]=S.useState(0),d=!!(i&&r);return wa(n.scrollbarX,()=>{const h=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(h),u(h)}),wa(n.scrollbarY,()=>{const h=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(h),o(h)}),d?y.jsx(De.div,{...s,ref:t,style:{width:i,height:r,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...c.style}}):null});function $l(c){return c?parseInt(c,10):0}function Gb(c,t){const e=c/t;return isNaN(e)?0:e}function eu(c){const t=Gb(c.viewport,c.content),e=c.scrollbar.paddingStart+c.scrollbar.paddingEnd,s=(c.scrollbar.size-e)*t;return Math.max(s,18)}function DP(c,t,e,s="ltr"){const n=eu(e),i=n/2,o=t||i,r=n-o,u=e.scrollbar.paddingStart+o,d=e.scrollbar.size-e.scrollbar.paddingEnd-r,h=e.content-e.viewport,p=s==="ltr"?[0,h]:[h*-1,0];return Wb([u,d],p)(c)}function hv(c,t,e="ltr"){const s=eu(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=t.scrollbar.size-n,o=t.content-t.viewport,r=i-s,u=e==="ltr"?[0,o]:[o*-1,0],d=Lr(c,u);return Wb([0,o],[0,r])(d)}function Wb(c,t){return e=>{if(c[0]===c[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(c[1]-c[0]);return t[0]+s*(e-c[0])}}function Kb(c,t){return c>0&&c<t}var PP=(c,t=()=>{})=>{let e={left:c.scrollLeft,top:c.scrollTop},s=0;return(function n(){const i={left:c.scrollLeft,top:c.scrollTop},o=e.left!==i.left,r=e.top!==i.top;(o||r)&&t(),e=i,s=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(s)};function tu(c,t){const e=os(c),s=S.useRef(0);return S.useEffect(()=>()=>window.clearTimeout(s.current),[]),S.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(e,t)},[e,t])}function wa(c,t){const e=os(t);as(()=>{let s=0;if(c){const n=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(e)});return n.observe(c),()=>{window.cancelAnimationFrame(s),n.unobserve(c)}}},[c,e])}var Yb=qb,_P=$b,LP=Vb;const is=S.forwardRef(({className:c,children:t,...e},s)=>y.jsxs(Yb,{ref:s,className:Te("relative overflow-hidden",c),scrollHideDelay:0,...e,children:[y.jsx(_P,{className:"h-full w-full rounded-[inherit]",children:t}),y.jsx(su,{}),y.jsx(LP,{})]}));is.displayName=Yb.displayName;const su=S.forwardRef(({className:c,orientation:t="vertical",...e},s)=>y.jsx(ep,{ref:s,orientation:t,className:Te("flex touch-none select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]","data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30","[&[data-state=hidden]]:opacity-0 [&[data-state=visible]]:opacity-100",c),style:{transition:"none !important",transitionDelay:"0ms !important",transitionDuration:"0ms !important"},...e,children:y.jsx(Qb,{className:"relative flex-1 rounded-full bg-accent/80 hover:bg-accent",style:{transition:"none !important"}})}));su.displayName=ep.displayName;const Br=un(c=>({showMinimap:!0,setShowMinimap:t=>c({showMinimap:t}),toggleMinimap:()=>c(t=>({showMinimap:!t.showMinimap})),showHeatMapLegend:!0,setShowHeatMapLegend:t=>c({showHeatMapLegend:t}),toggleHeatMapLegend:()=>c(t=>({showHeatMapLegend:!t.showHeatMapLegend})),showRuler:!1,setShowRuler:t=>c({showRuler:t}),toggleRuler:()=>c(t=>({showRuler:!t.showRuler})),autoCenterOnSelect:!0,setAutoCenterOnSelect:t=>c({autoCenterOnSelect:t}),searchQuery:"",setSearchQuery:t=>c({searchQuery:t}),highlightedNodeId:null,setHighlightedNodeId:t=>c({highlightedNodeId:t})})),Ir=[{id:"kafka",type:"kafka",label:"Apache Kafka",icon:"",color:"#000000",category:"messaging"},{id:"rabbitmq",type:"rabbitmq",label:"RabbitMQ",icon:"",color:"#FF6600",category:"messaging"},{id:"activemq",type:"activemq",label:"ActiveMQ",icon:"",color:"#A1005A",category:"messaging"},{id:"aws-sqs",type:"aws-sqs",label:"AWS SQS",icon:"",color:"#FF9900",category:"messaging"},{id:"azure-service-bus",type:"azure-service-bus",label:"Azure Service Bus",icon:"",color:"#0078D7",category:"messaging"},{id:"gcp-pubsub",type:"gcp-pubsub",label:"Google Pub/Sub",icon:"",color:"#4285F4",category:"messaging"},{id:"kong",type:"kong",label:"Kong Gateway",icon:"",color:"#003459",category:"integration"},{id:"apigee",type:"apigee",label:"Apigee",icon:"",color:"#F26522",category:"integration"},{id:"mulesoft",type:"mulesoft",label:"MuleSoft",icon:"",color:"#00A0DF",category:"integration"},{id:"graphql-gateway",type:"graphql-gateway",label:"GraphQL Gateway",icon:"",color:"#E10098",category:"integration"},{id:"bff-service",type:"bff-service",label:"BFF Service",icon:"",color:"#6C5CE7",category:"integration"},{id:"webhook-relay",type:"webhook-relay",label:"Webhook Relay",icon:"",color:"#1ABC9C",category:"integration"},{id:"postgres",type:"postgres",label:"PostgreSQL",icon:"",color:"#336791",category:"data"},{id:"mongodb",type:"mongodb",label:"MongoDB",icon:"",color:"#47A248",category:"data"},{id:"redis",type:"redis",label:"Redis",icon:"",color:"#DC382D",category:"data"},{id:"cassandra",type:"cassandra",label:"Apache Cassandra",icon:"",color:"#1287B1",category:"data"},{id:"clickhouse",type:"clickhouse",label:"ClickHouse",icon:"",color:"#FFCC00",category:"data"},{id:"snowflake",type:"snowflake",label:"Snowflake",icon:"",color:"#29B5E8",category:"data"},{id:"elasticsearch",type:"elasticsearch",label:"Elasticsearch",icon:"",color:"#00A79D",category:"data"},{id:"s3-datalake",type:"s3-datalake",label:"S3 Data Lake",icon:"",color:"#FF9900",category:"data"},{id:"prometheus",type:"prometheus",label:"Prometheus",icon:"",color:"#E6522C",category:"observability"},{id:"grafana",type:"grafana",label:"Grafana",icon:"",color:"#F56815",category:"observability"},{id:"loki",type:"loki",label:"Loki",icon:"",color:"#7CBA3C",category:"observability"},{id:"jaeger",type:"jaeger",label:"Jaeger",icon:"",color:"#65D6AD",category:"observability"},{id:"otel-collector",type:"otel-collector",label:"OpenTelemetry Collector",icon:"",color:"#6E56CF",category:"observability"},{id:"pagerduty",type:"pagerduty",label:"PagerDuty",icon:"",color:"#06AC38",category:"observability"},{id:"keycloak",type:"keycloak",label:"Keycloak",icon:"",color:"#5C6BC0",category:"security"},{id:"waf",type:"waf",label:"WAF / API Shield",icon:"",color:"#F44336",category:"security"},{id:"firewall",type:"firewall",label:"Firewall",icon:"",color:"#FF7043",category:"security"},{id:"secrets-vault",type:"secrets-vault",label:"Secrets Vault",icon:"",color:"#009688",category:"security"},{id:"ids-ips",type:"ids-ips",label:"IDS / IPS",icon:"",color:"#512DA8",category:"security"},{id:"jenkins",type:"jenkins",label:"Jenkins",icon:"",color:"#D24939",category:"devops"},{id:"gitlab-ci",type:"gitlab-ci",label:"GitLab CI",icon:"",color:"#FC6D26",category:"devops"},{id:"argo-cd",type:"argo-cd",label:"Argo CD",icon:"",color:"#EF7B45",category:"devops"},{id:"terraform",type:"terraform",label:"Terraform",icon:"",color:"#7B42BC",category:"devops"},{id:"ansible",type:"ansible",label:"Ansible",icon:"",color:"#000000",category:"devops"},{id:"harbor",type:"harbor",label:"Harbor Registry",icon:"",color:"#3BC1C4",category:"devops"},{id:"nginx",type:"nginx",label:"NGINX",icon:"",color:"#009639",category:"infrastructure"},{id:"docker",type:"docker",label:"Docker",icon:"",color:"#2496ED",category:"infrastructure"},{id:"kubernetes",type:"kubernetes",label:"Kubernetes",icon:"",color:"#326CE5",category:"infrastructure"},{id:"haproxy",type:"haproxy",label:"HAProxy",icon:"",color:"#009FDF",category:"infrastructure"},{id:"envoy",type:"envoy",label:"Envoy Proxy",icon:"",color:"#D63384",category:"infrastructure"},{id:"traefik",type:"traefik",label:"Traefik",icon:"",color:"#24A1DE",category:"infrastructure"},{id:"istio",type:"istio",label:"Istio Mesh",icon:"",color:"#466BB0",category:"edge"},{id:"service-mesh",type:"service-mesh",label:"Service Mesh",icon:"",color:"#5E81AC",category:"edge"},{id:"api-gateway",type:"api-gateway",label:"Cloud API Gateway",icon:"",color:"#FFB300",category:"edge"},{id:"vpn",type:"vpn",label:"VPN Concentrator",icon:"",color:"#2D9CDB",category:"edge"},{id:"cdn",type:"cdn",label:"CDN Edge",icon:"",color:"#FF5A5F",category:"edge"},{id:"rest",type:"rest",label:"REST API",icon:"",color:"#61DAFB",category:"api"},{id:"grpc",type:"grpc",label:"gRPC",icon:"",color:"#244C5A",category:"api"},{id:"graphql",type:"graphql",label:"GraphQL",icon:"",color:"#DE33A6",category:"api"},{id:"soap",type:"soap",label:"SOAP",icon:"",color:"#2196F3",category:"api"},{id:"websocket",type:"websocket",label:"WebSocket",icon:"",color:"#010101",category:"api"},{id:"webhook",type:"webhook",label:"Webhook Endpoint",icon:"",color:"#0FA3B1",category:"api"},{id:"spark",type:"spark",label:"Apache Spark",icon:"",color:"#E25A1C",category:"ml"},{id:"tensorflow-serving",type:"tensorflow-serving",label:"TensorFlow Serving",icon:"",color:"#FF6F00",category:"ml"},{id:"pytorch-serve",type:"pytorch-serve",label:"PyTorch Serve",icon:"",color:"#EE4C2C",category:"ml"},{id:"feature-store",type:"feature-store",label:"Feature Store",icon:"",color:"#8E44AD",category:"ml"},{id:"crm",type:"crm",label:"CRM System",icon:"",color:"#F39C12",category:"business"},{id:"erp",type:"erp",label:"ERP / SAP",icon:"",color:"#1B75BC",category:"business"},{id:"payment-gateway",type:"payment-gateway",label:"Payment Gateway",icon:"",color:"#4CAF50",category:"business"},{id:"bpmn-engine",type:"bpmn-engine",label:"BPMN Engine",icon:"",color:"#34495E",category:"business"},{id:"rpa-bot",type:"rpa-bot",label:"RPA Bot",icon:"",color:"#9B59B6",category:"business"}],Cr=[{id:"messaging",label:"Messaging & Event Bus",icon:""},{id:"integration",label:"Integration & API",icon:""},{id:"data",label:"Data & Storage",icon:""},{id:"observability",label:"Observability",icon:""},{id:"security",label:"Security & IAM",icon:""},{id:"devops",label:"DevOps & Platform",icon:""},{id:"infrastructure",label:"Runtime & Infra",icon:""},{id:"edge",label:"Edge & Networking",icon:""},{id:"api",label:"Protocols & APIs",icon:""},{id:"ml",label:"ML & Analytics",icon:""},{id:"business",label:"Business Systems",icon:""}];function IP(){const{nodes:c,selectNode:t,zoom:e,pan:s,setPan:n,setZoom:i}=Ee(),{searchQuery:o,setSearchQuery:r,highlightedNodeId:u,setHighlightedNodeId:d}=Br(),[h,p]=S.useState(!1),g=S.useRef(null);S.useEffect(()=>{const x=R=>{g.current&&!g.current.contains(R.target)&&p(!1)};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]);const v=S.useMemo(()=>{if(!o.trim())return[];const x=o.toLowerCase();return c.filter(R=>{const C=Ir.find(D=>D.type===R.type),k=R.data?.label||"",T=R.type||"",A=C?.category||"";return k.toLowerCase().includes(x)||T.toLowerCase().includes(x)||A.toLowerCase().includes(x)})},[c,o]),b=x=>{t(x),d(x);const R=c.find(C=>C.id===x);if(R&&h){const C=window.innerWidth/2,k=window.innerHeight/2,T=R.position.x+70,A=R.position.y+70,D=C-T*e,_=k-A*e;n({x:D,y:_}),e<.8&&i(1)}setTimeout(()=>d(null),2e3)};return y.jsxs("div",{className:"relative",ref:g,children:[y.jsxs("div",{className:"relative",children:[y.jsx($r,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),y.jsx(kt,{type:"text",placeholder:"Search components...",value:o,onChange:x=>{r(x.target.value),p(!0)},onFocus:()=>p(!0),className:"pl-8 pr-8 w-64"}),o&&y.jsx(ke,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>{r(""),p(!1),d(null)},children:y.jsx(an,{className:"h-3 w-3"})})]}),h&&o&&y.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-card border border-border rounded-md shadow-lg z-50 max-h-80 overflow-hidden",children:v.length>0?y.jsx(is,{className:"max-h-80",children:y.jsx("div",{className:"p-1",children:v.map(x=>{const R=Ir.find(k=>k.type===x.type),C=u===x.id;return y.jsxs("button",{onClick:()=>b(x.id),className:Te("w-full text-left px-3 py-2 rounded-sm hover:bg-accent transition-colors flex items-center justify-between",C&&"bg-accent"),children:[y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx("div",{className:"text-sm font-medium truncate",children:x.data?.label||x.type}),y.jsxs("div",{className:"text-xs text-muted-foreground truncate",children:[R?.category||"Unknown","  ",x.type]})]}),y.jsx(Xf,{className:"h-4 w-4 text-muted-foreground flex-shrink-0 ml-2"})]},x.id)})})}):y.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No components found"})})]})}function NP(c){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",t.appendChild(e),e.styleSheet?e.styleSheet.cssText=c:e.appendChild(document.createTextNode(c))}Array(12).fill(0);let xf=1;class zP{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;const{message:s,...n}=t,i=typeof t?.id=="number"||((e=t.id)==null?void 0:e.length)>0?t.id:xf++,o=this.toasts.find(u=>u.id===i),r=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(u=>u.id===i?(this.publish({...u,...t,id:i,title:s}),{...u,...t,id:i,dismissible:r,title:s}):u):this.addToast({title:s,...n,dismissible:r,id:i}),i},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(e=>e({id:t,dismiss:!0})))):this.toasts.forEach(e=>{this.subscribers.forEach(s=>s({id:e.id,dismiss:!0}))}),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let s;e.loading!==void 0&&(s=this.create({...e,promise:t,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));const n=Promise.resolve(t instanceof Function?t():t);let i=s!==void 0,o;const r=n.then(async d=>{if(o=["resolve",d],Tt.isValidElement(d))i=!1,this.create({id:s,type:"default",message:d});else if(OP(d)&&!d.ok){i=!1;const p=typeof e.error=="function"?await e.error(`HTTP error! status: ${d.status}`):e.error,g=typeof e.description=="function"?await e.description(`HTTP error! status: ${d.status}`):e.description,b=typeof p=="object"&&!Tt.isValidElement(p)?p:{message:p};this.create({id:s,type:"error",description:g,...b})}else if(d instanceof Error){i=!1;const p=typeof e.error=="function"?await e.error(d):e.error,g=typeof e.description=="function"?await e.description(d):e.description,b=typeof p=="object"&&!Tt.isValidElement(p)?p:{message:p};this.create({id:s,type:"error",description:g,...b})}else if(e.success!==void 0){i=!1;const p=typeof e.success=="function"?await e.success(d):e.success,g=typeof e.description=="function"?await e.description(d):e.description,b=typeof p=="object"&&!Tt.isValidElement(p)?p:{message:p};this.create({id:s,type:"success",description:g,...b})}}).catch(async d=>{if(o=["reject",d],e.error!==void 0){i=!1;const h=typeof e.error=="function"?await e.error(d):e.error,p=typeof e.description=="function"?await e.description(d):e.description,v=typeof h=="object"&&!Tt.isValidElement(h)?h:{message:h};this.create({id:s,type:"error",description:p,...v})}}).finally(()=>{i&&(this.dismiss(s),s=void 0),e.finally==null||e.finally.call(e)}),u=()=>new Promise((d,h)=>r.then(()=>o[0]==="reject"?h(o[1]):d(o[1])).catch(h));return typeof s!="string"&&typeof s!="number"?{unwrap:u}:Object.assign(s,{unwrap:u})},this.custom=(t,e)=>{const s=e?.id||xf++;return this.create({jsx:t(s),id:s,...e}),s},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Vs=new zP,jP=(c,t)=>{const e=t?.id||xf++;return Vs.addToast({title:c,...t,id:e}),e},OP=c=>c&&typeof c=="object"&&"ok"in c&&typeof c.ok=="boolean"&&"status"in c&&typeof c.status=="number",qP=jP,HP=()=>Vs.toasts,$P=()=>Vs.getActiveToasts(),Ye=Object.assign(qP,{success:Vs.success,info:Vs.info,warning:Vs.warning,error:Vs.error,custom:Vs.custom,message:Vs.message,promise:Vs.promise,dismiss:Vs.dismiss,loading:Vs.loading},{getHistory:HP,getToasts:$P});NP("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");var BP=$f[" useId ".trim().toString()]||(()=>{}),UP=0;function rn(c){const[t,e]=S.useState(BP());return as(()=>{e(s=>s??String(UP++))},[c]),t?`radix-${t}`:""}var FP=$f[" useInsertionEffect ".trim().toString()]||as;function En({prop:c,defaultProp:t,onChange:e=()=>{},caller:s}){const[n,i,o]=QP({defaultProp:t,onChange:e}),r=c!==void 0,u=r?c:n;{const h=S.useRef(c!==void 0);S.useEffect(()=>{const p=h.current;p!==r&&console.warn(`${s} is changing from ${p?"controlled":"uncontrolled"} to ${r?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=r},[r,s])}const d=S.useCallback(h=>{if(r){const p=VP(h)?h(c):h;p!==c&&o.current?.(p)}else i(h)},[r,c,i,o]);return[u,d]}function QP({defaultProp:c,onChange:t}){const[e,s]=S.useState(c),n=S.useRef(e),i=S.useRef(t);return FP(()=>{i.current=t},[t]),S.useEffect(()=>{n.current!==e&&(i.current?.(e),n.current=e)},[e,n]),[e,s,i]}function VP(c){return typeof c=="function"}function GP(c,t=globalThis?.document){const e=os(c);S.useEffect(()=>{const s=n=>{n.key==="Escape"&&e(n)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[e,t])}var WP="DismissableLayer",Mf="dismissableLayer.update",KP="dismissableLayer.pointerDownOutside",YP="dismissableLayer.focusOutside",fv,Xb=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ur=S.forwardRef((c,t)=>{const{disableOutsidePointerEvents:e=!1,onEscapeKeyDown:s,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:r,...u}=c,d=S.useContext(Xb),[h,p]=S.useState(null),g=h?.ownerDocument??globalThis?.document,[,v]=S.useState({}),b=Le(t,L=>p(L)),x=Array.from(d.layers),[R]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),C=x.indexOf(R),k=h?x.indexOf(h):-1,T=d.layersWithOutsidePointerEventsDisabled.size>0,A=k>=C,D=ZP(L=>{const O=L.target,X=[...d.branches].some(te=>te.contains(O));!A||X||(n?.(L),o?.(L),L.defaultPrevented||r?.())},g),_=e_(L=>{const O=L.target;[...d.branches].some(te=>te.contains(O))||(i?.(L),o?.(L),L.defaultPrevented||r?.())},g);return GP(L=>{k===d.layers.size-1&&(s?.(L),!L.defaultPrevented&&r&&(L.preventDefault(),r()))},g),S.useEffect(()=>{if(h)return e&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(fv=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(h)),d.layers.add(h),pv(),()=>{e&&d.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=fv)}},[h,g,e,d]),S.useEffect(()=>()=>{h&&(d.layers.delete(h),d.layersWithOutsidePointerEventsDisabled.delete(h),pv())},[h,d]),S.useEffect(()=>{const L=()=>v({});return document.addEventListener(Mf,L),()=>document.removeEventListener(Mf,L)},[]),y.jsx(De.div,{...u,ref:b,style:{pointerEvents:T?A?"auto":"none":void 0,...c.style},onFocusCapture:ge(c.onFocusCapture,_.onFocusCapture),onBlurCapture:ge(c.onBlurCapture,_.onBlurCapture),onPointerDownCapture:ge(c.onPointerDownCapture,D.onPointerDownCapture)})});Ur.displayName=WP;var XP="DismissableLayerBranch",JP=S.forwardRef((c,t)=>{const e=S.useContext(Xb),s=S.useRef(null),n=Le(t,s);return S.useEffect(()=>{const i=s.current;if(i)return e.branches.add(i),()=>{e.branches.delete(i)}},[e.branches]),y.jsx(De.div,{...c,ref:n})});JP.displayName=XP;function ZP(c,t=globalThis?.document){const e=os(c),s=S.useRef(!1),n=S.useRef(()=>{});return S.useEffect(()=>{const i=r=>{if(r.target&&!s.current){let u=function(){Jb(KP,e,d,{discrete:!0})};const d={originalEvent:r};r.pointerType==="touch"?(t.removeEventListener("click",n.current),n.current=u,t.addEventListener("click",n.current,{once:!0})):u()}else t.removeEventListener("click",n.current);s.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",i),t.removeEventListener("click",n.current)}},[t,e]),{onPointerDownCapture:()=>s.current=!0}}function e_(c,t=globalThis?.document){const e=os(c),s=S.useRef(!1);return S.useEffect(()=>{const n=i=>{i.target&&!s.current&&Jb(YP,e,{originalEvent:i},{discrete:!1})};return t.addEventListener("focusin",n),()=>t.removeEventListener("focusin",n)},[t,e]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function pv(){const c=new CustomEvent(Mf);document.dispatchEvent(c)}function Jb(c,t,e,{discrete:s}){const n=e.originalEvent.target,i=new CustomEvent(c,{bubbles:!1,cancelable:!0,detail:e});t&&n.addEventListener(c,t,{once:!0}),s?jb(n,i):n.dispatchEvent(i)}var of="focusScope.autoFocusOnMount",af="focusScope.autoFocusOnUnmount",gv={bubbles:!1,cancelable:!0},t_="FocusScope",Fr=S.forwardRef((c,t)=>{const{loop:e=!1,trapped:s=!1,onMountAutoFocus:n,onUnmountAutoFocus:i,...o}=c,[r,u]=S.useState(null),d=os(n),h=os(i),p=S.useRef(null),g=Le(t,x=>u(x)),v=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(s){let x=function(T){if(v.paused||!r)return;const A=T.target;r.contains(A)?p.current=A:Li(p.current,{select:!0})},R=function(T){if(v.paused||!r)return;const A=T.relatedTarget;A!==null&&(r.contains(A)||Li(p.current,{select:!0}))},C=function(T){if(document.activeElement===document.body)for(const D of T)D.removedNodes.length>0&&Li(r)};document.addEventListener("focusin",x),document.addEventListener("focusout",R);const k=new MutationObserver(C);return r&&k.observe(r,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",R),k.disconnect()}}},[s,r,v.paused]),S.useEffect(()=>{if(r){yv.add(v);const x=document.activeElement;if(!r.contains(x)){const C=new CustomEvent(of,gv);r.addEventListener(of,d),r.dispatchEvent(C),C.defaultPrevented||(s_(r_(Zb(r)),{select:!0}),document.activeElement===x&&Li(r))}return()=>{r.removeEventListener(of,d),setTimeout(()=>{const C=new CustomEvent(af,gv);r.addEventListener(af,h),r.dispatchEvent(C),C.defaultPrevented||Li(x??document.body,{select:!0}),r.removeEventListener(af,h),yv.remove(v)},0)}}},[r,d,h,v]);const b=S.useCallback(x=>{if(!e&&!s||v.paused)return;const R=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,C=document.activeElement;if(R&&C){const k=x.currentTarget,[T,A]=n_(k);T&&A?!x.shiftKey&&C===A?(x.preventDefault(),e&&Li(T,{select:!0})):x.shiftKey&&C===T&&(x.preventDefault(),e&&Li(A,{select:!0})):C===k&&x.preventDefault()}},[e,s,v.paused]);return y.jsx(De.div,{tabIndex:-1,...o,ref:g,onKeyDown:b})});Fr.displayName=t_;function s_(c,{select:t=!1}={}){const e=document.activeElement;for(const s of c)if(Li(s,{select:t}),document.activeElement!==e)return}function n_(c){const t=Zb(c),e=mv(t,c),s=mv(t.reverse(),c);return[e,s]}function Zb(c){const t=[],e=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const n=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||n?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();)t.push(e.currentNode);return t}function mv(c,t){for(const e of c)if(!i_(e,{upTo:t}))return e}function i_(c,{upTo:t}){if(getComputedStyle(c).visibility==="hidden")return!0;for(;c;){if(t!==void 0&&c===t)return!1;if(getComputedStyle(c).display==="none")return!0;c=c.parentElement}return!1}function o_(c){return c instanceof HTMLInputElement&&"select"in c}function Li(c,{select:t=!1}={}){if(c&&c.focus){const e=document.activeElement;c.focus({preventScroll:!0}),c!==e&&o_(c)&&t&&c.select()}}var yv=a_();function a_(){let c=[];return{add(t){const e=c[0];t!==e&&e?.pause(),c=vv(c,t),c.unshift(t)},remove(t){c=vv(c,t),c[0]?.resume()}}}function vv(c,t){const e=[...c],s=e.indexOf(t);return s!==-1&&e.splice(s,1),e}function r_(c){return c.filter(t=>t.tagName!=="A")}var c_="Portal",Qr=S.forwardRef((c,t)=>{const{container:e,...s}=c,[n,i]=S.useState(!1);as(()=>i(!0),[]);const o=e||n&&globalThis?.document?.body;return o?vT.createPortal(y.jsx(De.div,{...s,ref:t}),o):null});Qr.displayName=c_;var rf=0;function nu(){S.useEffect(()=>{const c=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",c[0]??bv()),document.body.insertAdjacentElement("beforeend",c[1]??bv()),rf++,()=>{rf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),rf--}},[])}function bv(){const c=document.createElement("span");return c.setAttribute("data-radix-focus-guard",""),c.tabIndex=0,c.style.outline="none",c.style.opacity="0",c.style.position="fixed",c.style.pointerEvents="none",c}var vn=function(){return vn=Object.assign||function(t){for(var e,s=1,n=arguments.length;s<n;s++){e=arguments[s];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},vn.apply(this,arguments)};function ew(c,t){var e={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&t.indexOf(s)<0&&(e[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(c);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(c,s[n])&&(e[s[n]]=c[s[n]]);return e}function l_(c,t,e){if(e||arguments.length===2)for(var s=0,n=t.length,i;s<n;s++)(i||!(s in t))&&(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return c.concat(i||Array.prototype.slice.call(t))}var kl="right-scroll-bar-position",Al="width-before-scroll-bar",u_="with-scroll-bars-hidden",d_="--removed-body-scroll-bar-size";function cf(c,t){return typeof c=="function"?c(t):c&&(c.current=t),c}function h_(c,t){var e=S.useState(function(){return{value:c,callback:t,facade:{get current(){return e.value},set current(s){var n=e.value;n!==s&&(e.value=s,e.callback(s,n))}}}})[0];return e.callback=t,e.facade}var f_=typeof window<"u"?S.useLayoutEffect:S.useEffect,wv=new WeakMap;function p_(c,t){var e=h_(null,function(s){return c.forEach(function(n){return cf(n,s)})});return f_(function(){var s=wv.get(e);if(s){var n=new Set(s),i=new Set(c),o=e.current;n.forEach(function(r){i.has(r)||cf(r,null)}),i.forEach(function(r){n.has(r)||cf(r,o)})}wv.set(e,c)},[c]),e}function g_(c){return c}function m_(c,t){t===void 0&&(t=g_);var e=[],s=!1,n={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return e.length?e[e.length-1]:c},useMedium:function(i){var o=t(i,s);return e.push(o),function(){e=e.filter(function(r){return r!==o})}},assignSyncMedium:function(i){for(s=!0;e.length;){var o=e;e=[],o.forEach(i)}e={push:function(r){return i(r)},filter:function(){return e}}},assignMedium:function(i){s=!0;var o=[];if(e.length){var r=e;e=[],r.forEach(i),o=e}var u=function(){var h=o;o=[],h.forEach(i)},d=function(){return Promise.resolve().then(u)};d(),e={push:function(h){o.push(h),d()},filter:function(h){return o=o.filter(h),e}}}};return n}function y_(c){c===void 0&&(c={});var t=m_(null);return t.options=vn({async:!0,ssr:!1},c),t}var tw=function(c){var t=c.sideCar,e=ew(c,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return S.createElement(s,vn({},e))};tw.isSideCarExport=!0;function v_(c,t){return c.useMedium(t),tw}var sw=y_(),lf=function(){},iu=S.forwardRef(function(c,t){var e=S.useRef(null),s=S.useState({onScrollCapture:lf,onWheelCapture:lf,onTouchMoveCapture:lf}),n=s[0],i=s[1],o=c.forwardProps,r=c.children,u=c.className,d=c.removeScrollBar,h=c.enabled,p=c.shards,g=c.sideCar,v=c.noRelative,b=c.noIsolation,x=c.inert,R=c.allowPinchZoom,C=c.as,k=C===void 0?"div":C,T=c.gapMode,A=ew(c,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),D=g,_=p_([e,t]),L=vn(vn({},A),n);return S.createElement(S.Fragment,null,h&&S.createElement(D,{sideCar:sw,removeScrollBar:d,shards:p,noRelative:v,noIsolation:b,inert:x,setCallbacks:i,allowPinchZoom:!!R,lockRef:e,gapMode:T}),o?S.cloneElement(S.Children.only(r),vn(vn({},L),{ref:_})):S.createElement(k,vn({},L,{className:u,ref:_}),r))});iu.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};iu.classNames={fullWidth:Al,zeroRight:kl};var b_=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function w_(){if(!document)return null;var c=document.createElement("style");c.type="text/css";var t=b_();return t&&c.setAttribute("nonce",t),c}function x_(c,t){c.styleSheet?c.styleSheet.cssText=t:c.appendChild(document.createTextNode(t))}function M_(c){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(c)}var S_=function(){var c=0,t=null;return{add:function(e){c==0&&(t=w_())&&(x_(t,e),M_(t)),c++},remove:function(){c--,!c&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},C_=function(){var c=S_();return function(t,e){S.useEffect(function(){return c.add(t),function(){c.remove()}},[t&&e])}},nw=function(){var c=C_(),t=function(e){var s=e.styles,n=e.dynamic;return c(s,n),null};return t},R_={left:0,top:0,right:0,gap:0},uf=function(c){return parseInt(c||"",10)||0},E_=function(c){var t=window.getComputedStyle(document.body),e=t[c==="padding"?"paddingLeft":"marginLeft"],s=t[c==="padding"?"paddingTop":"marginTop"],n=t[c==="padding"?"paddingRight":"marginRight"];return[uf(e),uf(s),uf(n)]},T_=function(c){if(c===void 0&&(c="margin"),typeof window>"u")return R_;var t=E_(c),e=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-e+t[2]-t[0])}},k_=nw(),ya="data-scroll-locked",A_=function(c,t,e,s){var n=c.left,i=c.top,o=c.right,r=c.gap;return e===void 0&&(e="margin"),`
  .`.concat(u_,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(r,"px ").concat(s,`;
  }
  body[`).concat(ya,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),e==="margin"&&`
    padding-left: `.concat(n,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(r,"px ").concat(s,`;
    `),e==="padding"&&"padding-right: ".concat(r,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(kl,` {
    right: `).concat(r,"px ").concat(s,`;
  }
  
  .`).concat(Al,` {
    margin-right: `).concat(r,"px ").concat(s,`;
  }
  
  .`).concat(kl," .").concat(kl,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(Al," .").concat(Al,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(ya,`] {
    `).concat(d_,": ").concat(r,`px;
  }
`)},xv=function(){var c=parseInt(document.body.getAttribute(ya)||"0",10);return isFinite(c)?c:0},D_=function(){S.useEffect(function(){return document.body.setAttribute(ya,(xv()+1).toString()),function(){var c=xv()-1;c<=0?document.body.removeAttribute(ya):document.body.setAttribute(ya,c.toString())}},[])},P_=function(c){var t=c.noRelative,e=c.noImportant,s=c.gapMode,n=s===void 0?"margin":s;D_();var i=S.useMemo(function(){return T_(n)},[n]);return S.createElement(k_,{styles:A_(i,!t,n,e?"":"!important")})},Sf=!1;if(typeof window<"u")try{var ml=Object.defineProperty({},"passive",{get:function(){return Sf=!0,!0}});window.addEventListener("test",ml,ml),window.removeEventListener("test",ml,ml)}catch{Sf=!1}var ha=Sf?{passive:!1}:!1,__=function(c){return c.tagName==="TEXTAREA"},iw=function(c,t){if(!(c instanceof Element))return!1;var e=window.getComputedStyle(c);return e[t]!=="hidden"&&!(e.overflowY===e.overflowX&&!__(c)&&e[t]==="visible")},L_=function(c){return iw(c,"overflowY")},I_=function(c){return iw(c,"overflowX")},Mv=function(c,t){var e=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var n=ow(c,s);if(n){var i=aw(c,s),o=i[1],r=i[2];if(o>r)return!0}s=s.parentNode}while(s&&s!==e.body);return!1},N_=function(c){var t=c.scrollTop,e=c.scrollHeight,s=c.clientHeight;return[t,e,s]},z_=function(c){var t=c.scrollLeft,e=c.scrollWidth,s=c.clientWidth;return[t,e,s]},ow=function(c,t){return c==="v"?L_(t):I_(t)},aw=function(c,t){return c==="v"?N_(t):z_(t)},j_=function(c,t){return c==="h"&&t==="rtl"?-1:1},O_=function(c,t,e,s,n){var i=j_(c,window.getComputedStyle(t).direction),o=i*s,r=e.target,u=t.contains(r),d=!1,h=o>0,p=0,g=0;do{if(!r)break;var v=aw(c,r),b=v[0],x=v[1],R=v[2],C=x-R-i*b;(b||C)&&ow(c,r)&&(p+=C,g+=b);var k=r.parentNode;r=k&&k.nodeType===Node.DOCUMENT_FRAGMENT_NODE?k.host:k}while(!u&&r!==document.body||u&&(t.contains(r)||t===r));return(h&&Math.abs(p)<1||!h&&Math.abs(g)<1)&&(d=!0),d},yl=function(c){return"changedTouches"in c?[c.changedTouches[0].clientX,c.changedTouches[0].clientY]:[0,0]},Sv=function(c){return[c.deltaX,c.deltaY]},Cv=function(c){return c&&"current"in c?c.current:c},q_=function(c,t){return c[0]===t[0]&&c[1]===t[1]},H_=function(c){return`
  .block-interactivity-`.concat(c,` {pointer-events: none;}
  .allow-interactivity-`).concat(c,` {pointer-events: all;}
`)},$_=0,fa=[];function B_(c){var t=S.useRef([]),e=S.useRef([0,0]),s=S.useRef(),n=S.useState($_++)[0],i=S.useState(nw)[0],o=S.useRef(c);S.useEffect(function(){o.current=c},[c]),S.useEffect(function(){if(c.inert){document.body.classList.add("block-interactivity-".concat(n));var x=l_([c.lockRef.current],(c.shards||[]).map(Cv),!0).filter(Boolean);return x.forEach(function(R){return R.classList.add("allow-interactivity-".concat(n))}),function(){document.body.classList.remove("block-interactivity-".concat(n)),x.forEach(function(R){return R.classList.remove("allow-interactivity-".concat(n))})}}},[c.inert,c.lockRef.current,c.shards]);var r=S.useCallback(function(x,R){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!o.current.allowPinchZoom;var C=yl(x),k=e.current,T="deltaX"in x?x.deltaX:k[0]-C[0],A="deltaY"in x?x.deltaY:k[1]-C[1],D,_=x.target,L=Math.abs(T)>Math.abs(A)?"h":"v";if("touches"in x&&L==="h"&&_.type==="range")return!1;var O=Mv(L,_);if(!O)return!0;if(O?D=L:(D=L==="v"?"h":"v",O=Mv(L,_)),!O)return!1;if(!s.current&&"changedTouches"in x&&(T||A)&&(s.current=D),!D)return!0;var X=s.current||D;return O_(X,R,x,X==="h"?T:A)},[]),u=S.useCallback(function(x){var R=x;if(!(!fa.length||fa[fa.length-1]!==i)){var C="deltaY"in R?Sv(R):yl(R),k=t.current.filter(function(D){return D.name===R.type&&(D.target===R.target||R.target===D.shadowParent)&&q_(D.delta,C)})[0];if(k&&k.should){R.cancelable&&R.preventDefault();return}if(!k){var T=(o.current.shards||[]).map(Cv).filter(Boolean).filter(function(D){return D.contains(R.target)}),A=T.length>0?r(R,T[0]):!o.current.noIsolation;A&&R.cancelable&&R.preventDefault()}}},[]),d=S.useCallback(function(x,R,C,k){var T={name:x,delta:R,target:C,should:k,shadowParent:U_(C)};t.current.push(T),setTimeout(function(){t.current=t.current.filter(function(A){return A!==T})},1)},[]),h=S.useCallback(function(x){e.current=yl(x),s.current=void 0},[]),p=S.useCallback(function(x){d(x.type,Sv(x),x.target,r(x,c.lockRef.current))},[]),g=S.useCallback(function(x){d(x.type,yl(x),x.target,r(x,c.lockRef.current))},[]);S.useEffect(function(){return fa.push(i),c.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:g}),document.addEventListener("wheel",u,ha),document.addEventListener("touchmove",u,ha),document.addEventListener("touchstart",h,ha),function(){fa=fa.filter(function(x){return x!==i}),document.removeEventListener("wheel",u,ha),document.removeEventListener("touchmove",u,ha),document.removeEventListener("touchstart",h,ha)}},[]);var v=c.removeScrollBar,b=c.inert;return S.createElement(S.Fragment,null,b?S.createElement(i,{styles:H_(n)}):null,v?S.createElement(P_,{noRelative:c.noRelative,gapMode:c.gapMode}):null)}function U_(c){for(var t=null;c!==null;)c instanceof ShadowRoot&&(t=c.host,c=c.host),c=c.parentNode;return t}const F_=v_(sw,B_);var Vr=S.forwardRef(function(c,t){return S.createElement(iu,vn({},c,{ref:t,sideCar:F_}))});Vr.classNames=iu.classNames;var Q_=function(c){if(typeof document>"u")return null;var t=Array.isArray(c)?c[0]:c;return t.ownerDocument.body},pa=new WeakMap,vl=new WeakMap,bl={},df=0,rw=function(c){return c&&(c.host||rw(c.parentNode))},V_=function(c,t){return t.map(function(e){if(c.contains(e))return e;var s=rw(e);return s&&c.contains(s)?s:(console.error("aria-hidden",e,"in not contained inside",c,". Doing nothing"),null)}).filter(function(e){return!!e})},G_=function(c,t,e,s){var n=V_(t,Array.isArray(c)?c:[c]);bl[e]||(bl[e]=new WeakMap);var i=bl[e],o=[],r=new Set,u=new Set(n),d=function(p){!p||r.has(p)||(r.add(p),d(p.parentNode))};n.forEach(d);var h=function(p){!p||u.has(p)||Array.prototype.forEach.call(p.children,function(g){if(r.has(g))h(g);else try{var v=g.getAttribute(s),b=v!==null&&v!=="false",x=(pa.get(g)||0)+1,R=(i.get(g)||0)+1;pa.set(g,x),i.set(g,R),o.push(g),x===1&&b&&vl.set(g,!0),R===1&&g.setAttribute(e,"true"),b||g.setAttribute(s,"true")}catch(C){console.error("aria-hidden: cannot operate on ",g,C)}})};return h(t),r.clear(),df++,function(){o.forEach(function(p){var g=pa.get(p)-1,v=i.get(p)-1;pa.set(p,g),i.set(p,v),g||(vl.has(p)||p.removeAttribute(s),vl.delete(p)),v||p.removeAttribute(e)}),df--,df||(pa=new WeakMap,pa=new WeakMap,vl=new WeakMap,bl={})}},ou=function(c,t,e){e===void 0&&(e="data-aria-hidden");var s=Array.from(Array.isArray(c)?c:[c]),n=Q_(c);return n?(s.push.apply(s,Array.from(n.querySelectorAll("[aria-live], script"))),G_(s,n,e,"aria-hidden")):function(){return null}};function W_(c){const t=K_(c),e=S.forwardRef((s,n)=>{const{children:i,...o}=s,r=S.Children.toArray(i),u=r.find(X_);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}function K_(c){const t=S.forwardRef((e,s)=>{const{children:n,...i}=e;if(S.isValidElement(n)){const o=Z_(n),r=J_(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var Y_=Symbol("radix.slottable");function X_(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===Y_}function J_(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function Z_(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}var au="Dialog",[cw,lw]=xs(au),[eL,dn]=cw(au),uw=c=>{const{__scopeDialog:t,children:e,open:s,defaultOpen:n,onOpenChange:i,modal:o=!0}=c,r=S.useRef(null),u=S.useRef(null),[d,h]=En({prop:s,defaultProp:n??!1,onChange:i,caller:au});return y.jsx(eL,{scope:t,triggerRef:r,contentRef:u,contentId:rn(),titleId:rn(),descriptionId:rn(),open:d,onOpenChange:h,onOpenToggle:S.useCallback(()=>h(p=>!p),[h]),modal:o,children:e})};uw.displayName=au;var dw="DialogTrigger",hw=S.forwardRef((c,t)=>{const{__scopeDialog:e,...s}=c,n=dn(dw,e),i=Le(t,n.triggerRef);return y.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":op(n.open),...s,ref:i,onClick:ge(c.onClick,n.onOpenToggle)})});hw.displayName=dw;var np="DialogPortal",[tL,fw]=cw(np,{forceMount:void 0}),pw=c=>{const{__scopeDialog:t,forceMount:e,children:s,container:n}=c,i=dn(np,t);return y.jsx(tL,{scope:t,forceMount:e,children:S.Children.map(s,o=>y.jsx(ls,{present:e||i.open,children:y.jsx(Qr,{asChild:!0,container:n,children:o})}))})};pw.displayName=np;var Bl="DialogOverlay",gw=S.forwardRef((c,t)=>{const e=fw(Bl,c.__scopeDialog),{forceMount:s=e.forceMount,...n}=c,i=dn(Bl,c.__scopeDialog);return i.modal?y.jsx(ls,{present:s||i.open,children:y.jsx(nL,{...n,ref:t})}):null});gw.displayName=Bl;var sL=W_("DialogOverlay.RemoveScroll"),nL=S.forwardRef((c,t)=>{const{__scopeDialog:e,...s}=c,n=dn(Bl,e);return y.jsx(Vr,{as:sL,allowPinchZoom:!0,shards:[n.contentRef],children:y.jsx(De.div,{"data-state":op(n.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),wo="DialogContent",mw=S.forwardRef((c,t)=>{const e=fw(wo,c.__scopeDialog),{forceMount:s=e.forceMount,...n}=c,i=dn(wo,c.__scopeDialog);return y.jsx(ls,{present:s||i.open,children:i.modal?y.jsx(iL,{...n,ref:t}):y.jsx(oL,{...n,ref:t})})});mw.displayName=wo;var iL=S.forwardRef((c,t)=>{const e=dn(wo,c.__scopeDialog),s=S.useRef(null),n=Le(t,e.contentRef,s);return S.useEffect(()=>{const i=s.current;if(i)return ou(i)},[]),y.jsx(yw,{...c,ref:n,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(c.onCloseAutoFocus,i=>{i.preventDefault(),e.triggerRef.current?.focus()}),onPointerDownOutside:ge(c.onPointerDownOutside,i=>{const o=i.detail.originalEvent,r=o.button===0&&o.ctrlKey===!0;(o.button===2||r)&&i.preventDefault()}),onFocusOutside:ge(c.onFocusOutside,i=>i.preventDefault())})}),oL=S.forwardRef((c,t)=>{const e=dn(wo,c.__scopeDialog),s=S.useRef(!1),n=S.useRef(!1);return y.jsx(yw,{...c,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{c.onCloseAutoFocus?.(i),i.defaultPrevented||(s.current||e.triggerRef.current?.focus(),i.preventDefault()),s.current=!1,n.current=!1},onInteractOutside:i=>{c.onInteractOutside?.(i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;e.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),yw=S.forwardRef((c,t)=>{const{__scopeDialog:e,trapFocus:s,onOpenAutoFocus:n,onCloseAutoFocus:i,...o}=c,r=dn(wo,e),u=S.useRef(null),d=Le(t,u);return nu(),y.jsxs(y.Fragment,{children:[y.jsx(Fr,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:n,onUnmountAutoFocus:i,children:y.jsx(Ur,{role:"dialog",id:r.contentId,"aria-describedby":r.descriptionId,"aria-labelledby":r.titleId,"data-state":op(r.open),...o,ref:d,onDismiss:()=>r.onOpenChange(!1)})}),y.jsxs(y.Fragment,{children:[y.jsx(rL,{titleId:r.titleId}),y.jsx(lL,{contentRef:u,descriptionId:r.descriptionId})]})]})}),ip="DialogTitle",vw=S.forwardRef((c,t)=>{const{__scopeDialog:e,...s}=c,n=dn(ip,e);return y.jsx(De.h2,{id:n.titleId,...s,ref:t})});vw.displayName=ip;var bw="DialogDescription",ww=S.forwardRef((c,t)=>{const{__scopeDialog:e,...s}=c,n=dn(bw,e);return y.jsx(De.p,{id:n.descriptionId,...s,ref:t})});ww.displayName=bw;var xw="DialogClose",Mw=S.forwardRef((c,t)=>{const{__scopeDialog:e,...s}=c,n=dn(xw,e);return y.jsx(De.button,{type:"button",...s,ref:t,onClick:ge(c.onClick,()=>n.onOpenChange(!1))})});Mw.displayName=xw;function op(c){return c?"open":"closed"}var Sw="DialogTitleWarning",[aL,Cw]=vP(Sw,{contentName:wo,titleName:ip,docsSlug:"dialog"}),rL=({titleId:c})=>{const t=Cw(Sw),e=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return S.useEffect(()=>{c&&(document.getElementById(c)||console.error(e))},[e,c]),null},cL="DialogDescriptionWarning",lL=({contentRef:c,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Cw(cL).contentName}}.`;return S.useEffect(()=>{const n=c.current?.getAttribute("aria-describedby");t&&n&&(document.getElementById(t)||console.warn(s))},[s,c,t]),null},Rw=uw,Ew=hw,Tw=pw,ap=gw,rp=mw,cp=vw,lp=ww,up=Mw,uL=Symbol("radix.slottable");function dL(c){const t=({children:e})=>y.jsx(y.Fragment,{children:e});return t.displayName=`${c}.Slottable`,t.__radixId=uL,t}var kw="AlertDialog",[hL]=xs(kw,[lw]),ri=lw(),Aw=c=>{const{__scopeAlertDialog:t,...e}=c,s=ri(t);return y.jsx(Rw,{...s,...e,modal:!0})};Aw.displayName=kw;var fL="AlertDialogTrigger",Dw=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,...s}=c,n=ri(e);return y.jsx(Ew,{...n,...s,ref:t})});Dw.displayName=fL;var pL="AlertDialogPortal",Pw=c=>{const{__scopeAlertDialog:t,...e}=c,s=ri(t);return y.jsx(Tw,{...s,...e})};Pw.displayName=pL;var gL="AlertDialogOverlay",_w=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,...s}=c,n=ri(e);return y.jsx(ap,{...n,...s,ref:t})});_w.displayName=gL;var va="AlertDialogContent",[mL,yL]=hL(va),vL=dL("AlertDialogContent"),Lw=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,children:s,...n}=c,i=ri(e),o=S.useRef(null),r=Le(t,o),u=S.useRef(null);return y.jsx(aL,{contentName:va,titleName:Iw,docsSlug:"alert-dialog",children:y.jsx(mL,{scope:e,cancelRef:u,children:y.jsxs(rp,{role:"alertdialog",...i,...n,ref:r,onOpenAutoFocus:ge(n.onOpenAutoFocus,d=>{d.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[y.jsx(vL,{children:s}),y.jsx(wL,{contentRef:o})]})})})});Lw.displayName=va;var Iw="AlertDialogTitle",Nw=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,...s}=c,n=ri(e);return y.jsx(cp,{...n,...s,ref:t})});Nw.displayName=Iw;var zw="AlertDialogDescription",jw=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,...s}=c,n=ri(e);return y.jsx(lp,{...n,...s,ref:t})});jw.displayName=zw;var bL="AlertDialogAction",Ow=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,...s}=c,n=ri(e);return y.jsx(up,{...n,...s,ref:t})});Ow.displayName=bL;var qw="AlertDialogCancel",Hw=S.forwardRef((c,t)=>{const{__scopeAlertDialog:e,...s}=c,{cancelRef:n}=yL(qw,e),i=ri(e),o=Le(t,n);return y.jsx(up,{...i,...s,ref:o})});Hw.displayName=qw;var wL=({contentRef:c})=>{const t=`\`${va}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${va}\` by passing a \`${zw}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${va}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return S.useEffect(()=>{document.getElementById(c.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,c]),null},xL=Aw,ML=Dw,SL=Pw,$w=_w,Bw=Lw,Uw=Ow,Fw=Hw,Qw=Nw,Vw=jw;const Gw=xL,w3=ML,CL=SL,Ww=S.forwardRef(({className:c,...t},e)=>y.jsx($w,{className:Te("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",c),...t,ref:e}));Ww.displayName=$w.displayName;const dp=S.forwardRef(({className:c,...t},e)=>y.jsxs(CL,{children:[y.jsx(Ww,{}),y.jsx(Bw,{ref:e,className:Te("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",c),...t})]}));dp.displayName=Bw.displayName;const Kw=({className:c,...t})=>y.jsx("div",{className:Te("flex flex-col space-y-2 text-center sm:text-left",c),...t});Kw.displayName="AlertDialogHeader";const Yw=({className:c,...t})=>y.jsx("div",{className:Te("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",c),...t});Yw.displayName="AlertDialogFooter";const hp=S.forwardRef(({className:c,...t},e)=>y.jsx(Qw,{ref:e,className:Te("text-lg font-semibold",c),...t}));hp.displayName=Qw.displayName;const fp=S.forwardRef(({className:c,...t},e)=>y.jsx(Vw,{ref:e,className:Te("text-sm text-muted-foreground",c),...t}));fp.displayName=Vw.displayName;const pp=S.forwardRef(({className:c,...t},e)=>y.jsx(Uw,{ref:e,className:Te(Vf(),c),...t}));pp.displayName=Uw.displayName;const gp=S.forwardRef(({className:c,...t},e)=>y.jsx(Fw,{ref:e,className:Te(Vf({variant:"outline"}),"mt-2 sm:mt-0",c),...t}));gp.displayName=Fw.displayName;const mp=Rw,x3=Ew,RL=Tw,Xw=S.forwardRef(({className:c,...t},e)=>y.jsx(ap,{ref:e,className:Te("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",c),...t}));Xw.displayName=ap.displayName;const ru=S.forwardRef(({className:c,children:t,...e},s)=>y.jsxs(RL,{children:[y.jsx(Xw,{}),y.jsxs(rp,{ref:s,className:Te("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",c),...e,children:[t,y.jsxs(up,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[y.jsx(an,{className:"h-4 w-4"}),y.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ru.displayName=rp.displayName;const cu=({className:c,...t})=>y.jsx("div",{className:Te("flex flex-col space-y-1.5 text-center sm:text-left",c),...t});cu.displayName="DialogHeader";const lu=({className:c,...t})=>y.jsx("div",{className:Te("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",c),...t});lu.displayName="DialogFooter";const uu=S.forwardRef(({className:c,...t},e)=>y.jsx(cp,{ref:e,className:Te("text-lg font-semibold leading-none tracking-tight",c),...t}));uu.displayName=cp.displayName;const du=S.forwardRef(({className:c,...t},e)=>y.jsx(lp,{ref:e,className:Te("text-sm text-muted-foreground",c),...t}));du.displayName=lp.displayName;var EL=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],TL=EL.reduce((c,t)=>{const e=Uf(`Primitive.${t}`),s=S.forwardRef((n,i)=>{const{asChild:o,...r}=n,u=o?e:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),y.jsx(u,{...r,ref:i})});return s.displayName=`Primitive.${t}`,{...c,[t]:s}},{}),kL="Label",Jw=S.forwardRef((c,t)=>y.jsx(TL.label,{...c,ref:t,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(c.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));Jw.displayName=kL;var Zw=Jw;const AL=Ff("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),it=S.forwardRef(({className:c,...t},e)=>y.jsx(Zw,{ref:e,className:Te(AL(),c),...t}));it.displayName=Zw.displayName;function yp({open:c,initialName:t="",onConfirm:e,onCancel:s}){const[n,i]=S.useState(t);S.useEffect(()=>{c&&i(t)},[c,t]);const o=()=>{n.trim()&&e(n.trim())};return y.jsx(mp,{open:c,onOpenChange:r=>!r&&s(),children:y.jsxs(ru,{children:[y.jsxs(cu,{children:[y.jsx(uu,{children:t?"Rename Group":"Create Group"}),y.jsx(du,{children:t?"Enter a new name for the group":"Enter a name for the new group"})]}),y.jsxs("div",{className:"py-4",children:[y.jsx(it,{htmlFor:"group-name",children:"Group Name"}),y.jsx(kt,{id:"group-name",value:n,onChange:r=>i(r.target.value),onKeyDown:r=>{r.key==="Enter"&&o()},className:"mt-2",autoFocus:!0})]}),y.jsxs(lu,{children:[y.jsx(ke,{variant:"outline",onClick:s,children:"Cancel"}),y.jsx(ke,{onClick:o,disabled:!n.trim(),children:t?"Save":"Create"})]})]})})}function DL(){const{zoom:c,setZoom:t,diagramName:e,setDiagramName:s,saveDiagram:n,loadDiagramState:i,undo:o,redo:r,selectedNodeId:u,createGroupFromSelection:d,autoGroupByConnections:h,nodes:p,pan:g,setPan:v,viewportWidth:b,viewportHeight:x}=Ee(),{canUndo:R,canRedo:C}=Ar(),k=S.useRef(null),[T,A]=S.useState(!1),[D,_]=S.useState(e),[L,O]=S.useState(!1),{showMinimap:X,toggleMinimap:te,showHeatMapLegend:ce,toggleHeatMapLegend:Z,showRuler:se,toggleRuler:le}=Br(),ue=()=>t(Math.min(c+.1,2)),z=()=>t(c-.1),I=()=>{const oe=p;if(!oe.length){t(1),v({x:0,y:0});return}const B=100,G=oe.map(Gt=>Gt.position.x),pe=oe.map(Gt=>Gt.position.y),me=oe.map(Gt=>Gt.position.x+140),ye=oe.map(Gt=>Gt.position.y+140),be=Math.min(...G)-B,Ie=Math.min(...pe)-B,Be=Math.max(...me)+B,ot=Math.max(...ye)+B,Ze=Be-be,Lt=ot-Ie,de=b||window.innerWidth,$e=x||window.innerHeight-56,Ue=de/Ze,bt=$e/Lt;let mt=Math.min(Ue,bt);mt=Math.min(Math.max(mt,.2),2.5);const $t=be+Ze/2,et=Ie+Lt/2,It=de/2,wt=$e/2,yt=It-$t*mt,Xt=wt-et*mt;t(mt),v({x:yt,y:Xt})},q=()=>{n(),Ye.success("Diagram saved to browser storage")},Y=()=>{const oe=`${e.replace(/\s+/g,"_")}_${Date.now()}.json`;nA(Ee.getState(),oe),Ye.success("Diagram exported as JSON")},fe=()=>{k.current?.click()},N=async oe=>{const B=oe.target.files?.[0];if(B){try{const G=await iA(B);if(!G){Ye.error("Failed to import diagram: Invalid file format");return}i({nodes:G.nodes||[],connections:G.connections||[],groups:G.groups||[],zoom:G.zoom||1,pan:G.pan||{x:0,y:0}}),s(G.name),Ye.success(`Diagram "${G.name}" imported successfully`)}catch(G){Ye.error("Failed to import diagram"),ii("Failed to import diagram",G instanceof Error?G:new Error(String(G)))}k.current&&(k.current.value="")}},F=()=>{D.trim()&&(s(D.trim()),Ye.success("Diagram renamed")),A(!1)},K=()=>{const{nodes:oe}=Ee.getState();if(oe.filter(G=>G.selected||G.id===u).length===0){Ye.error("Select at least one component to create a group");return}O(!0)},ie=oe=>{d(oe),Ye.success(`Group "${oe}" created`),O(!1)},U=()=>{h(),Ye.success("Groups created automatically from connections")};return y.jsxs(y.Fragment,{children:[y.jsx(yp,{open:L,onConfirm:ie,onCancel:()=>O(!1)}),y.jsxs("div",{className:"h-14 bg-toolbar-bg border-b border-border flex items-center justify-between px-4",children:[y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsxs("button",{onClick:()=>A(!0),className:"text-lg font-semibold text-foreground hover:text-primary transition-colors cursor-pointer",title:"Click to rename diagram",children:[y.jsx("span",{className:"text-primary",children:"Archi"}),"Phoenix",y.jsxs("span",{className:"text-xs text-secondary-foreground ml-2",children:[" ",e]})]}),y.jsx(bs,{orientation:"vertical",className:"h-6 mx-2"}),y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:o,disabled:!R,title:"Undo (Ctrl/Cmd+Z)",children:y.jsx(JD,{className:"h-4 w-4"})}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:r,disabled:!C,title:"Redo (Ctrl/Cmd+Shift+Z or Ctrl/Cmd+Y)",children:y.jsx(DD,{className:"h-4 w-4"})})]}),y.jsx(bs,{orientation:"vertical",className:"h-6 mx-2"}),y.jsx(IP,{})]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 rounded-md p-1",children:[y.jsx(ke,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ue,title:"Zoom In",children:y.jsx(iP,{className:"h-4 w-4"})}),y.jsxs("span",{className:"text-sm font-mono px-2 min-w-[60px] text-center",children:[Math.round(c*100),"%"]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:z,title:"Zoom Out",children:y.jsx(aP,{className:"h-4 w-4"})}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:I,title:"Fit to View",children:y.jsx(bD,{className:"h-4 w-4"})})]}),y.jsx(bs,{orientation:"vertical",className:"h-6"}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:q,title:"Save diagram to browser storage (auto-saves on changes)",children:y.jsx(jD,{className:"h-4 w-4"})}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:Y,title:"Export diagram as JSON file",children:y.jsx(iD,{className:"h-4 w-4"})}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:fe,title:"Import diagram from JSON file",children:y.jsx(eP,{className:"h-4 w-4"})}),y.jsx(bs,{orientation:"vertical",className:"h-6"}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Create group from selection",onClick:K,disabled:!u,children:y.jsx(Lb,{className:"h-4 w-4"})}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Auto-group by connections",onClick:U,children:y.jsx(UD,{className:"h-4 w-4"})}),y.jsx(bs,{orientation:"vertical",className:"h-6"}),y.jsx(rP,{}),y.jsx(ke,{variant:X?"default":"ghost",size:"icon",className:"h-9 w-9",title:X?"Hide minimap":"Show minimap",onClick:te,children:y.jsx(yD,{className:"h-4 w-4"})}),y.jsx(ke,{variant:ce?"default":"ghost",size:"icon",className:"h-9 w-9",title:ce?"Hide heat map legend":"Show heat map legend",onClick:Z,children:y.jsx(vo,{className:"h-4 w-4"})}),y.jsx(ke,{variant:se?"default":"ghost",size:"icon",className:"h-9 w-9",title:se?"Hide ruler":"Show ruler",onClick:le,children:y.jsx(ND,{className:"h-4 w-4"})}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Settings",children:y.jsx($D,{className:"h-4 w-4"})})]})]}),y.jsx("input",{ref:k,type:"file",accept:".json",onChange:N,className:"hidden","aria-label":"Import diagram from file"}),y.jsx(Gw,{open:T,onOpenChange:A,children:y.jsxs(dp,{children:[y.jsx(hp,{children:"Rename Diagram"}),y.jsx(fp,{children:"Enter a new name for your diagram"}),y.jsx("div",{className:"py-4",children:y.jsx(kt,{value:D,onChange:oe=>_(oe.target.value),placeholder:"Diagram name",onKeyDown:oe=>{oe.key==="Enter"&&F()},autoFocus:!0})}),y.jsxs("div",{className:"flex gap-2 justify-end",children:[y.jsx(gp,{children:"Cancel"}),y.jsx(pp,{onClick:F,children:"Save"})]})]})})]})}function Rv(c){const t=PL(c),e=S.forwardRef((s,n)=>{const{children:i,...o}=s,r=S.Children.toArray(i),u=r.find(LL);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}function PL(c){const t=S.forwardRef((e,s)=>{const{children:n,...i}=e;if(S.isValidElement(n)){const o=NL(n),r=IL(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var _L=Symbol("radix.slottable");function LL(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===_L}function IL(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function NL(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}function hu(c){const t=c+"CollectionProvider",[e,s]=xs(t),[n,i]=e(t,{collectionRef:{current:null},itemMap:new Map}),o=x=>{const{scope:R,children:C}=x,k=Tt.useRef(null),T=Tt.useRef(new Map).current;return y.jsx(n,{scope:R,itemMap:T,collectionRef:k,children:C})};o.displayName=t;const r=c+"CollectionSlot",u=Rv(r),d=Tt.forwardRef((x,R)=>{const{scope:C,children:k}=x,T=i(r,C),A=Le(R,T.collectionRef);return y.jsx(u,{ref:A,children:k})});d.displayName=r;const h=c+"CollectionItemSlot",p="data-radix-collection-item",g=Rv(h),v=Tt.forwardRef((x,R)=>{const{scope:C,children:k,...T}=x,A=Tt.useRef(null),D=Le(R,A),_=i(h,C);return Tt.useEffect(()=>(_.itemMap.set(A,{ref:A,...T}),()=>void _.itemMap.delete(A))),y.jsx(g,{[p]:"",ref:D,children:k})});v.displayName=h;function b(x){const R=i(c+"CollectionConsumer",x);return Tt.useCallback(()=>{const k=R.collectionRef.current;if(!k)return[];const T=Array.from(k.querySelectorAll(`[${p}]`));return Array.from(R.itemMap.values()).sort((_,L)=>T.indexOf(_.ref.current)-T.indexOf(L.ref.current))},[R.collectionRef,R.itemMap])}return[{Provider:o,Slot:d,ItemSlot:v},b,s]}var hf="rovingFocusGroup.onEntryFocus",zL={bubbles:!1,cancelable:!0},Gr="RovingFocusGroup",[Cf,ex,jL]=hu(Gr),[OL,fu]=xs(Gr,[jL]),[qL,HL]=OL(Gr),tx=S.forwardRef((c,t)=>y.jsx(Cf.Provider,{scope:c.__scopeRovingFocusGroup,children:y.jsx(Cf.Slot,{scope:c.__scopeRovingFocusGroup,children:y.jsx($L,{...c,ref:t})})}));tx.displayName=Gr;var $L=S.forwardRef((c,t)=>{const{__scopeRovingFocusGroup:e,orientation:s,loop:n=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:r,onCurrentTabStopIdChange:u,onEntryFocus:d,preventScrollOnEntryFocus:h=!1,...p}=c,g=S.useRef(null),v=Le(t,g),b=Ea(i),[x,R]=En({prop:o,defaultProp:r??null,onChange:u,caller:Gr}),[C,k]=S.useState(!1),T=os(d),A=ex(e),D=S.useRef(!1),[_,L]=S.useState(0);return S.useEffect(()=>{const O=g.current;if(O)return O.addEventListener(hf,T),()=>O.removeEventListener(hf,T)},[T]),y.jsx(qL,{scope:e,orientation:s,dir:b,loop:n,currentTabStopId:x,onItemFocus:S.useCallback(O=>R(O),[R]),onItemShiftTab:S.useCallback(()=>k(!0),[]),onFocusableItemAdd:S.useCallback(()=>L(O=>O+1),[]),onFocusableItemRemove:S.useCallback(()=>L(O=>O-1),[]),children:y.jsx(De.div,{tabIndex:C||_===0?-1:0,"data-orientation":s,...p,ref:v,style:{outline:"none",...c.style},onMouseDown:ge(c.onMouseDown,()=>{D.current=!0}),onFocus:ge(c.onFocus,O=>{const X=!D.current;if(O.target===O.currentTarget&&X&&!C){const te=new CustomEvent(hf,zL);if(O.currentTarget.dispatchEvent(te),!te.defaultPrevented){const ce=A().filter(z=>z.focusable),Z=ce.find(z=>z.active),se=ce.find(z=>z.id===x),ue=[Z,se,...ce].filter(Boolean).map(z=>z.ref.current);ix(ue,h)}}D.current=!1}),onBlur:ge(c.onBlur,()=>k(!1))})})}),sx="RovingFocusGroupItem",nx=S.forwardRef((c,t)=>{const{__scopeRovingFocusGroup:e,focusable:s=!0,active:n=!1,tabStopId:i,children:o,...r}=c,u=rn(),d=i||u,h=HL(sx,e),p=h.currentTabStopId===d,g=ex(e),{onFocusableItemAdd:v,onFocusableItemRemove:b,currentTabStopId:x}=h;return S.useEffect(()=>{if(s)return v(),()=>b()},[s,v,b]),y.jsx(Cf.ItemSlot,{scope:e,id:d,focusable:s,active:n,children:y.jsx(De.span,{tabIndex:p?0:-1,"data-orientation":h.orientation,...r,ref:t,onMouseDown:ge(c.onMouseDown,R=>{s?h.onItemFocus(d):R.preventDefault()}),onFocus:ge(c.onFocus,()=>h.onItemFocus(d)),onKeyDown:ge(c.onKeyDown,R=>{if(R.key==="Tab"&&R.shiftKey){h.onItemShiftTab();return}if(R.target!==R.currentTarget)return;const C=FL(R,h.orientation,h.dir);if(C!==void 0){if(R.metaKey||R.ctrlKey||R.altKey||R.shiftKey)return;R.preventDefault();let T=g().filter(A=>A.focusable).map(A=>A.ref.current);if(C==="last")T.reverse();else if(C==="prev"||C==="next"){C==="prev"&&T.reverse();const A=T.indexOf(R.currentTarget);T=h.loop?QL(T,A+1):T.slice(A+1)}setTimeout(()=>ix(T))}}),children:typeof o=="function"?o({isCurrentTabStop:p,hasTabStop:x!=null}):o})})});nx.displayName=sx;var BL={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function UL(c,t){return t!=="rtl"?c:c==="ArrowLeft"?"ArrowRight":c==="ArrowRight"?"ArrowLeft":c}function FL(c,t,e){const s=UL(c.key,e);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return BL[s]}function ix(c,t=!1){const e=document.activeElement;for(const s of c)if(s===e||(s.focus({preventScroll:t}),document.activeElement!==e))return}function QL(c,t){return c.map((e,s)=>c[(t+s)%c.length])}var ox=tx,ax=nx,pu="Tabs",[VL]=xs(pu,[fu]),rx=fu(),[GL,vp]=VL(pu),cx=S.forwardRef((c,t)=>{const{__scopeTabs:e,value:s,onValueChange:n,defaultValue:i,orientation:o="horizontal",dir:r,activationMode:u="automatic",...d}=c,h=Ea(r),[p,g]=En({prop:s,onChange:n,defaultProp:i??"",caller:pu});return y.jsx(GL,{scope:e,baseId:rn(),value:p,onValueChange:g,orientation:o,dir:h,activationMode:u,children:y.jsx(De.div,{dir:h,"data-orientation":o,...d,ref:t})})});cx.displayName=pu;var lx="TabsList",ux=S.forwardRef((c,t)=>{const{__scopeTabs:e,loop:s=!0,...n}=c,i=vp(lx,e),o=rx(e);return y.jsx(ox,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:s,children:y.jsx(De.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:t})})});ux.displayName=lx;var dx="TabsTrigger",hx=S.forwardRef((c,t)=>{const{__scopeTabs:e,value:s,disabled:n=!1,...i}=c,o=vp(dx,e),r=rx(e),u=gx(o.baseId,s),d=mx(o.baseId,s),h=s===o.value;return y.jsx(ax,{asChild:!0,...r,focusable:!n,active:h,children:y.jsx(De.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":d,"data-state":h?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:u,...i,ref:t,onMouseDown:ge(c.onMouseDown,p=>{!n&&p.button===0&&p.ctrlKey===!1?o.onValueChange(s):p.preventDefault()}),onKeyDown:ge(c.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&o.onValueChange(s)}),onFocus:ge(c.onFocus,()=>{const p=o.activationMode!=="manual";!h&&!n&&p&&o.onValueChange(s)})})})});hx.displayName=dx;var fx="TabsContent",px=S.forwardRef((c,t)=>{const{__scopeTabs:e,value:s,forceMount:n,children:i,...o}=c,r=vp(fx,e),u=gx(r.baseId,s),d=mx(r.baseId,s),h=s===r.value,p=S.useRef(h);return S.useEffect(()=>{const g=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(g)},[]),y.jsx(ls,{present:n||h,children:({present:g})=>y.jsx(De.div,{"data-state":h?"active":"inactive","data-orientation":r.orientation,role:"tabpanel","aria-labelledby":u,hidden:!g,id:d,tabIndex:0,...o,ref:t,style:{...c.style,animationDuration:p.current?"0s":void 0},children:g&&i})})});px.displayName=fx;function gx(c,t){return`${c}-trigger-${t}`}function mx(c,t){return`${c}-content-${t}`}var WL=cx,yx=ux,vx=hx,bx=px;const bp=WL,gu=S.forwardRef(({className:c,...t},e)=>y.jsx(yx,{ref:e,className:Te("inline-flex items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground","flex-wrap gap-1",c),...t}));gu.displayName=yx.displayName;const sn=S.forwardRef(({className:c,...t},e)=>y.jsx(vx,{ref:e,className:Te("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",c),...t}));sn.displayName=vx.displayName;const si=S.forwardRef(({className:c,...t},e)=>y.jsx(bx,{ref:e,className:Te("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",c),...t}));si.displayName=bx.displayName;const KL=["top","right","bottom","left"],ji=Math.min,As=Math.max,Ul=Math.round,wl=Math.floor,Mn=c=>({x:c,y:c}),YL={left:"right",right:"left",bottom:"top",top:"bottom"},XL={start:"end",end:"start"};function Rf(c,t,e){return As(c,ji(t,e))}function oi(c,t){return typeof c=="function"?c(t):c}function ai(c){return c.split("-")[0]}function Ta(c){return c.split("-")[1]}function wp(c){return c==="x"?"y":"x"}function xp(c){return c==="y"?"height":"width"}const JL=new Set(["top","bottom"]);function wn(c){return JL.has(ai(c))?"y":"x"}function Mp(c){return wp(wn(c))}function ZL(c,t,e){e===void 0&&(e=!1);const s=Ta(c),n=Mp(c),i=xp(n);let o=n==="x"?s===(e?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(o=Fl(o)),[o,Fl(o)]}function e2(c){const t=Fl(c);return[Ef(c),t,Ef(t)]}function Ef(c){return c.replace(/start|end/g,t=>XL[t])}const Ev=["left","right"],Tv=["right","left"],t2=["top","bottom"],s2=["bottom","top"];function n2(c,t,e){switch(c){case"top":case"bottom":return e?t?Tv:Ev:t?Ev:Tv;case"left":case"right":return t?t2:s2;default:return[]}}function i2(c,t,e,s){const n=Ta(c);let i=n2(ai(c),e==="start",s);return n&&(i=i.map(o=>o+"-"+n),t&&(i=i.concat(i.map(Ef)))),i}function Fl(c){return c.replace(/left|right|bottom|top/g,t=>YL[t])}function o2(c){return{top:0,right:0,bottom:0,left:0,...c}}function wx(c){return typeof c!="number"?o2(c):{top:c,right:c,bottom:c,left:c}}function Ql(c){const{x:t,y:e,width:s,height:n}=c;return{width:s,height:n,top:e,left:t,right:t+s,bottom:e+n,x:t,y:e}}function kv(c,t,e){let{reference:s,floating:n}=c;const i=wn(t),o=Mp(t),r=xp(o),u=ai(t),d=i==="y",h=s.x+s.width/2-n.width/2,p=s.y+s.height/2-n.height/2,g=s[r]/2-n[r]/2;let v;switch(u){case"top":v={x:h,y:s.y-n.height};break;case"bottom":v={x:h,y:s.y+s.height};break;case"right":v={x:s.x+s.width,y:p};break;case"left":v={x:s.x-n.width,y:p};break;default:v={x:s.x,y:s.y}}switch(Ta(t)){case"start":v[o]-=g*(e&&d?-1:1);break;case"end":v[o]+=g*(e&&d?-1:1);break}return v}const a2=async(c,t,e)=>{const{placement:s="bottom",strategy:n="absolute",middleware:i=[],platform:o}=e,r=i.filter(Boolean),u=await(o.isRTL==null?void 0:o.isRTL(t));let d=await o.getElementRects({reference:c,floating:t,strategy:n}),{x:h,y:p}=kv(d,s,u),g=s,v={},b=0;for(let x=0;x<r.length;x++){const{name:R,fn:C}=r[x],{x:k,y:T,data:A,reset:D}=await C({x:h,y:p,initialPlacement:s,placement:g,strategy:n,middlewareData:v,rects:d,platform:o,elements:{reference:c,floating:t}});h=k??h,p=T??p,v={...v,[R]:{...v[R],...A}},D&&b<=50&&(b++,typeof D=="object"&&(D.placement&&(g=D.placement),D.rects&&(d=D.rects===!0?await o.getElementRects({reference:c,floating:t,strategy:n}):D.rects),{x:h,y:p}=kv(d,g,u)),x=-1)}return{x:h,y:p,placement:g,strategy:n,middlewareData:v}};async function Nr(c,t){var e;t===void 0&&(t={});const{x:s,y:n,platform:i,rects:o,elements:r,strategy:u}=c,{boundary:d="clippingAncestors",rootBoundary:h="viewport",elementContext:p="floating",altBoundary:g=!1,padding:v=0}=oi(t,c),b=wx(v),R=r[g?p==="floating"?"reference":"floating":p],C=Ql(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(R)))==null||e?R:R.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(r.floating)),boundary:d,rootBoundary:h,strategy:u})),k=p==="floating"?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,T=await(i.getOffsetParent==null?void 0:i.getOffsetParent(r.floating)),A=await(i.isElement==null?void 0:i.isElement(T))?await(i.getScale==null?void 0:i.getScale(T))||{x:1,y:1}:{x:1,y:1},D=Ql(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:k,offsetParent:T,strategy:u}):k);return{top:(C.top-D.top+b.top)/A.y,bottom:(D.bottom-C.bottom+b.bottom)/A.y,left:(C.left-D.left+b.left)/A.x,right:(D.right-C.right+b.right)/A.x}}const r2=c=>({name:"arrow",options:c,async fn(t){const{x:e,y:s,placement:n,rects:i,platform:o,elements:r,middlewareData:u}=t,{element:d,padding:h=0}=oi(c,t)||{};if(d==null)return{};const p=wx(h),g={x:e,y:s},v=Mp(n),b=xp(v),x=await o.getDimensions(d),R=v==="y",C=R?"top":"left",k=R?"bottom":"right",T=R?"clientHeight":"clientWidth",A=i.reference[b]+i.reference[v]-g[v]-i.floating[b],D=g[v]-i.reference[v],_=await(o.getOffsetParent==null?void 0:o.getOffsetParent(d));let L=_?_[T]:0;(!L||!await(o.isElement==null?void 0:o.isElement(_)))&&(L=r.floating[T]||i.floating[b]);const O=A/2-D/2,X=L/2-x[b]/2-1,te=ji(p[C],X),ce=ji(p[k],X),Z=te,se=L-x[b]-ce,le=L/2-x[b]/2+O,ue=Rf(Z,le,se),z=!u.arrow&&Ta(n)!=null&&le!==ue&&i.reference[b]/2-(le<Z?te:ce)-x[b]/2<0,I=z?le<Z?le-Z:le-se:0;return{[v]:g[v]+I,data:{[v]:ue,centerOffset:le-ue-I,...z&&{alignmentOffset:I}},reset:z}}}),c2=function(c){return c===void 0&&(c={}),{name:"flip",options:c,async fn(t){var e,s;const{placement:n,middlewareData:i,rects:o,initialPlacement:r,platform:u,elements:d}=t,{mainAxis:h=!0,crossAxis:p=!0,fallbackPlacements:g,fallbackStrategy:v="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:x=!0,...R}=oi(c,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const C=ai(n),k=wn(r),T=ai(r)===r,A=await(u.isRTL==null?void 0:u.isRTL(d.floating)),D=g||(T||!x?[Fl(r)]:e2(r)),_=b!=="none";!g&&_&&D.push(...i2(r,x,b,A));const L=[r,...D],O=await Nr(t,R),X=[];let te=((s=i.flip)==null?void 0:s.overflows)||[];if(h&&X.push(O[C]),p){const le=ZL(n,o,A);X.push(O[le[0]],O[le[1]])}if(te=[...te,{placement:n,overflows:X}],!X.every(le=>le<=0)){var ce,Z;const le=(((ce=i.flip)==null?void 0:ce.index)||0)+1,ue=L[le];if(ue&&(!(p==="alignment"?k!==wn(ue):!1)||te.every(q=>wn(q.placement)===k?q.overflows[0]>0:!0)))return{data:{index:le,overflows:te},reset:{placement:ue}};let z=(Z=te.filter(I=>I.overflows[0]<=0).sort((I,q)=>I.overflows[1]-q.overflows[1])[0])==null?void 0:Z.placement;if(!z)switch(v){case"bestFit":{var se;const I=(se=te.filter(q=>{if(_){const Y=wn(q.placement);return Y===k||Y==="y"}return!0}).map(q=>[q.placement,q.overflows.filter(Y=>Y>0).reduce((Y,fe)=>Y+fe,0)]).sort((q,Y)=>q[1]-Y[1])[0])==null?void 0:se[0];I&&(z=I);break}case"initialPlacement":z=r;break}if(n!==z)return{reset:{placement:z}}}return{}}}};function Av(c,t){return{top:c.top-t.height,right:c.right-t.width,bottom:c.bottom-t.height,left:c.left-t.width}}function Dv(c){return KL.some(t=>c[t]>=0)}const l2=function(c){return c===void 0&&(c={}),{name:"hide",options:c,async fn(t){const{rects:e}=t,{strategy:s="referenceHidden",...n}=oi(c,t);switch(s){case"referenceHidden":{const i=await Nr(t,{...n,elementContext:"reference"}),o=Av(i,e.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Dv(o)}}}case"escaped":{const i=await Nr(t,{...n,altBoundary:!0}),o=Av(i,e.floating);return{data:{escapedOffsets:o,escaped:Dv(o)}}}default:return{}}}}},xx=new Set(["left","top"]);async function u2(c,t){const{placement:e,platform:s,elements:n}=c,i=await(s.isRTL==null?void 0:s.isRTL(n.floating)),o=ai(e),r=Ta(e),u=wn(e)==="y",d=xx.has(o)?-1:1,h=i&&u?-1:1,p=oi(t,c);let{mainAxis:g,crossAxis:v,alignmentAxis:b}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return r&&typeof b=="number"&&(v=r==="end"?b*-1:b),u?{x:v*h,y:g*d}:{x:g*d,y:v*h}}const d2=function(c){return c===void 0&&(c=0),{name:"offset",options:c,async fn(t){var e,s;const{x:n,y:i,placement:o,middlewareData:r}=t,u=await u2(t,c);return o===((e=r.offset)==null?void 0:e.placement)&&(s=r.arrow)!=null&&s.alignmentOffset?{}:{x:n+u.x,y:i+u.y,data:{...u,placement:o}}}}},h2=function(c){return c===void 0&&(c={}),{name:"shift",options:c,async fn(t){const{x:e,y:s,placement:n}=t,{mainAxis:i=!0,crossAxis:o=!1,limiter:r={fn:R=>{let{x:C,y:k}=R;return{x:C,y:k}}},...u}=oi(c,t),d={x:e,y:s},h=await Nr(t,u),p=wn(ai(n)),g=wp(p);let v=d[g],b=d[p];if(i){const R=g==="y"?"top":"left",C=g==="y"?"bottom":"right",k=v+h[R],T=v-h[C];v=Rf(k,v,T)}if(o){const R=p==="y"?"top":"left",C=p==="y"?"bottom":"right",k=b+h[R],T=b-h[C];b=Rf(k,b,T)}const x=r.fn({...t,[g]:v,[p]:b});return{...x,data:{x:x.x-e,y:x.y-s,enabled:{[g]:i,[p]:o}}}}}},f2=function(c){return c===void 0&&(c={}),{options:c,fn(t){const{x:e,y:s,placement:n,rects:i,middlewareData:o}=t,{offset:r=0,mainAxis:u=!0,crossAxis:d=!0}=oi(c,t),h={x:e,y:s},p=wn(n),g=wp(p);let v=h[g],b=h[p];const x=oi(r,t),R=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(u){const T=g==="y"?"height":"width",A=i.reference[g]-i.floating[T]+R.mainAxis,D=i.reference[g]+i.reference[T]-R.mainAxis;v<A?v=A:v>D&&(v=D)}if(d){var C,k;const T=g==="y"?"width":"height",A=xx.has(ai(n)),D=i.reference[p]-i.floating[T]+(A&&((C=o.offset)==null?void 0:C[p])||0)+(A?0:R.crossAxis),_=i.reference[p]+i.reference[T]+(A?0:((k=o.offset)==null?void 0:k[p])||0)-(A?R.crossAxis:0);b<D?b=D:b>_&&(b=_)}return{[g]:v,[p]:b}}}},p2=function(c){return c===void 0&&(c={}),{name:"size",options:c,async fn(t){var e,s;const{placement:n,rects:i,platform:o,elements:r}=t,{apply:u=()=>{},...d}=oi(c,t),h=await Nr(t,d),p=ai(n),g=Ta(n),v=wn(n)==="y",{width:b,height:x}=i.floating;let R,C;p==="top"||p==="bottom"?(R=p,C=g===(await(o.isRTL==null?void 0:o.isRTL(r.floating))?"start":"end")?"left":"right"):(C=p,R=g==="end"?"top":"bottom");const k=x-h.top-h.bottom,T=b-h.left-h.right,A=ji(x-h[R],k),D=ji(b-h[C],T),_=!t.middlewareData.shift;let L=A,O=D;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(O=T),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(L=k),_&&!g){const te=As(h.left,0),ce=As(h.right,0),Z=As(h.top,0),se=As(h.bottom,0);v?O=b-2*(te!==0||ce!==0?te+ce:As(h.left,h.right)):L=x-2*(Z!==0||se!==0?Z+se:As(h.top,h.bottom))}await u({...t,availableWidth:O,availableHeight:L});const X=await o.getDimensions(r.floating);return b!==X.width||x!==X.height?{reset:{rects:!0}}:{}}}};function mu(){return typeof window<"u"}function ka(c){return Mx(c)?(c.nodeName||"").toLowerCase():"#document"}function Ds(c){var t;return(c==null||(t=c.ownerDocument)==null?void 0:t.defaultView)||window}function Dn(c){var t;return(t=(Mx(c)?c.ownerDocument:c.document)||window.document)==null?void 0:t.documentElement}function Mx(c){return mu()?c instanceof Node||c instanceof Ds(c).Node:!1}function cn(c){return mu()?c instanceof Element||c instanceof Ds(c).Element:!1}function Tn(c){return mu()?c instanceof HTMLElement||c instanceof Ds(c).HTMLElement:!1}function Pv(c){return!mu()||typeof ShadowRoot>"u"?!1:c instanceof ShadowRoot||c instanceof Ds(c).ShadowRoot}const g2=new Set(["inline","contents"]);function Wr(c){const{overflow:t,overflowX:e,overflowY:s,display:n}=ln(c);return/auto|scroll|overlay|hidden|clip/.test(t+s+e)&&!g2.has(n)}const m2=new Set(["table","td","th"]);function y2(c){return m2.has(ka(c))}const v2=[":popover-open",":modal"];function yu(c){return v2.some(t=>{try{return c.matches(t)}catch{return!1}})}const b2=["transform","translate","scale","rotate","perspective"],w2=["transform","translate","scale","rotate","perspective","filter"],x2=["paint","layout","strict","content"];function Sp(c){const t=Cp(),e=cn(c)?ln(c):c;return b2.some(s=>e[s]?e[s]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||w2.some(s=>(e.willChange||"").includes(s))||x2.some(s=>(e.contain||"").includes(s))}function M2(c){let t=Oi(c);for(;Tn(t)&&!xa(t);){if(Sp(t))return t;if(yu(t))return null;t=Oi(t)}return null}function Cp(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const S2=new Set(["html","body","#document"]);function xa(c){return S2.has(ka(c))}function ln(c){return Ds(c).getComputedStyle(c)}function vu(c){return cn(c)?{scrollLeft:c.scrollLeft,scrollTop:c.scrollTop}:{scrollLeft:c.scrollX,scrollTop:c.scrollY}}function Oi(c){if(ka(c)==="html")return c;const t=c.assignedSlot||c.parentNode||Pv(c)&&c.host||Dn(c);return Pv(t)?t.host:t}function Sx(c){const t=Oi(c);return xa(t)?c.ownerDocument?c.ownerDocument.body:c.body:Tn(t)&&Wr(t)?t:Sx(t)}function zr(c,t,e){var s;t===void 0&&(t=[]),e===void 0&&(e=!0);const n=Sx(c),i=n===((s=c.ownerDocument)==null?void 0:s.body),o=Ds(n);if(i){const r=Tf(o);return t.concat(o,o.visualViewport||[],Wr(n)?n:[],r&&e?zr(r):[])}return t.concat(n,zr(n,[],e))}function Tf(c){return c.parent&&Object.getPrototypeOf(c.parent)?c.frameElement:null}function Cx(c){const t=ln(c);let e=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const n=Tn(c),i=n?c.offsetWidth:e,o=n?c.offsetHeight:s,r=Ul(e)!==i||Ul(s)!==o;return r&&(e=i,s=o),{width:e,height:s,$:r}}function Rp(c){return cn(c)?c:c.contextElement}function ba(c){const t=Rp(c);if(!Tn(t))return Mn(1);const e=t.getBoundingClientRect(),{width:s,height:n,$:i}=Cx(t);let o=(i?Ul(e.width):e.width)/s,r=(i?Ul(e.height):e.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!r||!Number.isFinite(r))&&(r=1),{x:o,y:r}}const C2=Mn(0);function Rx(c){const t=Ds(c);return!Cp()||!t.visualViewport?C2:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function R2(c,t,e){return t===void 0&&(t=!1),!e||t&&e!==Ds(c)?!1:t}function xo(c,t,e,s){t===void 0&&(t=!1),e===void 0&&(e=!1);const n=c.getBoundingClientRect(),i=Rp(c);let o=Mn(1);t&&(s?cn(s)&&(o=ba(s)):o=ba(c));const r=R2(i,e,s)?Rx(i):Mn(0);let u=(n.left+r.x)/o.x,d=(n.top+r.y)/o.y,h=n.width/o.x,p=n.height/o.y;if(i){const g=Ds(i),v=s&&cn(s)?Ds(s):s;let b=g,x=Tf(b);for(;x&&s&&v!==b;){const R=ba(x),C=x.getBoundingClientRect(),k=ln(x),T=C.left+(x.clientLeft+parseFloat(k.paddingLeft))*R.x,A=C.top+(x.clientTop+parseFloat(k.paddingTop))*R.y;u*=R.x,d*=R.y,h*=R.x,p*=R.y,u+=T,d+=A,b=Ds(x),x=Tf(b)}}return Ql({width:h,height:p,x:u,y:d})}function bu(c,t){const e=vu(c).scrollLeft;return t?t.left+e:xo(Dn(c)).left+e}function Ex(c,t){const e=c.getBoundingClientRect(),s=e.left+t.scrollLeft-bu(c,e),n=e.top+t.scrollTop;return{x:s,y:n}}function E2(c){let{elements:t,rect:e,offsetParent:s,strategy:n}=c;const i=n==="fixed",o=Dn(s),r=t?yu(t.floating):!1;if(s===o||r&&i)return e;let u={scrollLeft:0,scrollTop:0},d=Mn(1);const h=Mn(0),p=Tn(s);if((p||!p&&!i)&&((ka(s)!=="body"||Wr(o))&&(u=vu(s)),Tn(s))){const v=xo(s);d=ba(s),h.x=v.x+s.clientLeft,h.y=v.y+s.clientTop}const g=o&&!p&&!i?Ex(o,u):Mn(0);return{width:e.width*d.x,height:e.height*d.y,x:e.x*d.x-u.scrollLeft*d.x+h.x+g.x,y:e.y*d.y-u.scrollTop*d.y+h.y+g.y}}function T2(c){return Array.from(c.getClientRects())}function k2(c){const t=Dn(c),e=vu(c),s=c.ownerDocument.body,n=As(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),i=As(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-e.scrollLeft+bu(c);const r=-e.scrollTop;return ln(s).direction==="rtl"&&(o+=As(t.clientWidth,s.clientWidth)-n),{width:n,height:i,x:o,y:r}}const _v=25;function A2(c,t){const e=Ds(c),s=Dn(c),n=e.visualViewport;let i=s.clientWidth,o=s.clientHeight,r=0,u=0;if(n){i=n.width,o=n.height;const h=Cp();(!h||h&&t==="fixed")&&(r=n.offsetLeft,u=n.offsetTop)}const d=bu(s);if(d<=0){const h=s.ownerDocument,p=h.body,g=getComputedStyle(p),v=h.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,b=Math.abs(s.clientWidth-p.clientWidth-v);b<=_v&&(i-=b)}else d<=_v&&(i+=d);return{width:i,height:o,x:r,y:u}}const D2=new Set(["absolute","fixed"]);function P2(c,t){const e=xo(c,!0,t==="fixed"),s=e.top+c.clientTop,n=e.left+c.clientLeft,i=Tn(c)?ba(c):Mn(1),o=c.clientWidth*i.x,r=c.clientHeight*i.y,u=n*i.x,d=s*i.y;return{width:o,height:r,x:u,y:d}}function Lv(c,t,e){let s;if(t==="viewport")s=A2(c,e);else if(t==="document")s=k2(Dn(c));else if(cn(t))s=P2(t,e);else{const n=Rx(c);s={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return Ql(s)}function Tx(c,t){const e=Oi(c);return e===t||!cn(e)||xa(e)?!1:ln(e).position==="fixed"||Tx(e,t)}function _2(c,t){const e=t.get(c);if(e)return e;let s=zr(c,[],!1).filter(r=>cn(r)&&ka(r)!=="body"),n=null;const i=ln(c).position==="fixed";let o=i?Oi(c):c;for(;cn(o)&&!xa(o);){const r=ln(o),u=Sp(o);!u&&r.position==="fixed"&&(n=null),(i?!u&&!n:!u&&r.position==="static"&&!!n&&D2.has(n.position)||Wr(o)&&!u&&Tx(c,o))?s=s.filter(h=>h!==o):n=r,o=Oi(o)}return t.set(c,s),s}function L2(c){let{element:t,boundary:e,rootBoundary:s,strategy:n}=c;const o=[...e==="clippingAncestors"?yu(t)?[]:_2(t,this._c):[].concat(e),s],r=o[0],u=o.reduce((d,h)=>{const p=Lv(t,h,n);return d.top=As(p.top,d.top),d.right=ji(p.right,d.right),d.bottom=ji(p.bottom,d.bottom),d.left=As(p.left,d.left),d},Lv(t,r,n));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function I2(c){const{width:t,height:e}=Cx(c);return{width:t,height:e}}function N2(c,t,e){const s=Tn(t),n=Dn(t),i=e==="fixed",o=xo(c,!0,i,t);let r={scrollLeft:0,scrollTop:0};const u=Mn(0);function d(){u.x=bu(n)}if(s||!s&&!i)if((ka(t)!=="body"||Wr(n))&&(r=vu(t)),s){const v=xo(t,!0,i,t);u.x=v.x+t.clientLeft,u.y=v.y+t.clientTop}else n&&d();i&&!s&&n&&d();const h=n&&!s&&!i?Ex(n,r):Mn(0),p=o.left+r.scrollLeft-u.x-h.x,g=o.top+r.scrollTop-u.y-h.y;return{x:p,y:g,width:o.width,height:o.height}}function ff(c){return ln(c).position==="static"}function Iv(c,t){if(!Tn(c)||ln(c).position==="fixed")return null;if(t)return t(c);let e=c.offsetParent;return Dn(c)===e&&(e=e.ownerDocument.body),e}function kx(c,t){const e=Ds(c);if(yu(c))return e;if(!Tn(c)){let n=Oi(c);for(;n&&!xa(n);){if(cn(n)&&!ff(n))return n;n=Oi(n)}return e}let s=Iv(c,t);for(;s&&y2(s)&&ff(s);)s=Iv(s,t);return s&&xa(s)&&ff(s)&&!Sp(s)?e:s||M2(c)||e}const z2=async function(c){const t=this.getOffsetParent||kx,e=this.getDimensions,s=await e(c.floating);return{reference:N2(c.reference,await t(c.floating),c.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function j2(c){return ln(c).direction==="rtl"}const O2={convertOffsetParentRelativeRectToViewportRelativeRect:E2,getDocumentElement:Dn,getClippingRect:L2,getOffsetParent:kx,getElementRects:z2,getClientRects:T2,getDimensions:I2,getScale:ba,isElement:cn,isRTL:j2};function Ax(c,t){return c.x===t.x&&c.y===t.y&&c.width===t.width&&c.height===t.height}function q2(c,t){let e=null,s;const n=Dn(c);function i(){var r;clearTimeout(s),(r=e)==null||r.disconnect(),e=null}function o(r,u){r===void 0&&(r=!1),u===void 0&&(u=1),i();const d=c.getBoundingClientRect(),{left:h,top:p,width:g,height:v}=d;if(r||t(),!g||!v)return;const b=wl(p),x=wl(n.clientWidth-(h+g)),R=wl(n.clientHeight-(p+v)),C=wl(h),T={rootMargin:-b+"px "+-x+"px "+-R+"px "+-C+"px",threshold:As(0,ji(1,u))||1};let A=!0;function D(_){const L=_[0].intersectionRatio;if(L!==u){if(!A)return o();L?o(!1,L):s=setTimeout(()=>{o(!1,1e-7)},1e3)}L===1&&!Ax(d,c.getBoundingClientRect())&&o(),A=!1}try{e=new IntersectionObserver(D,{...T,root:n.ownerDocument})}catch{e=new IntersectionObserver(D,T)}e.observe(c)}return o(!0),i}function H2(c,t,e,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:u=!1}=s,d=Rp(c),h=n||i?[...d?zr(d):[],...zr(t)]:[];h.forEach(C=>{n&&C.addEventListener("scroll",e,{passive:!0}),i&&C.addEventListener("resize",e)});const p=d&&r?q2(d,e):null;let g=-1,v=null;o&&(v=new ResizeObserver(C=>{let[k]=C;k&&k.target===d&&v&&(v.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var T;(T=v)==null||T.observe(t)})),e()}),d&&!u&&v.observe(d),v.observe(t));let b,x=u?xo(c):null;u&&R();function R(){const C=xo(c);x&&!Ax(x,C)&&e(),x=C,b=requestAnimationFrame(R)}return e(),()=>{var C;h.forEach(k=>{n&&k.removeEventListener("scroll",e),i&&k.removeEventListener("resize",e)}),p?.(),(C=v)==null||C.disconnect(),v=null,u&&cancelAnimationFrame(b)}}const $2=d2,B2=h2,U2=c2,F2=p2,Q2=l2,Nv=r2,V2=f2,G2=(c,t,e)=>{const s=new Map,n={platform:O2,...e},i={...n.platform,_c:s};return a2(c,t,{...n,platform:i})};var W2=typeof document<"u",K2=function(){},Dl=W2?S.useLayoutEffect:K2;function Vl(c,t){if(c===t)return!0;if(typeof c!=typeof t)return!1;if(typeof c=="function"&&c.toString()===t.toString())return!0;let e,s,n;if(c&&t&&typeof c=="object"){if(Array.isArray(c)){if(e=c.length,e!==t.length)return!1;for(s=e;s--!==0;)if(!Vl(c[s],t[s]))return!1;return!0}if(n=Object.keys(c),e=n.length,e!==Object.keys(t).length)return!1;for(s=e;s--!==0;)if(!{}.hasOwnProperty.call(t,n[s]))return!1;for(s=e;s--!==0;){const i=n[s];if(!(i==="_owner"&&c.$$typeof)&&!Vl(c[i],t[i]))return!1}return!0}return c!==c&&t!==t}function Dx(c){return typeof window>"u"?1:(c.ownerDocument.defaultView||window).devicePixelRatio||1}function zv(c,t){const e=Dx(c);return Math.round(t*e)/e}function pf(c){const t=S.useRef(c);return Dl(()=>{t.current=c}),t}function Y2(c){c===void 0&&(c={});const{placement:t="bottom",strategy:e="absolute",middleware:s=[],platform:n,elements:{reference:i,floating:o}={},transform:r=!0,whileElementsMounted:u,open:d}=c,[h,p]=S.useState({x:0,y:0,strategy:e,placement:t,middlewareData:{},isPositioned:!1}),[g,v]=S.useState(s);Vl(g,s)||v(s);const[b,x]=S.useState(null),[R,C]=S.useState(null),k=S.useCallback(q=>{q!==_.current&&(_.current=q,x(q))},[]),T=S.useCallback(q=>{q!==L.current&&(L.current=q,C(q))},[]),A=i||b,D=o||R,_=S.useRef(null),L=S.useRef(null),O=S.useRef(h),X=u!=null,te=pf(u),ce=pf(n),Z=pf(d),se=S.useCallback(()=>{if(!_.current||!L.current)return;const q={placement:t,strategy:e,middleware:g};ce.current&&(q.platform=ce.current),G2(_.current,L.current,q).then(Y=>{const fe={...Y,isPositioned:Z.current!==!1};le.current&&!Vl(O.current,fe)&&(O.current=fe,Hr.flushSync(()=>{p(fe)}))})},[g,t,e,ce,Z]);Dl(()=>{d===!1&&O.current.isPositioned&&(O.current.isPositioned=!1,p(q=>({...q,isPositioned:!1})))},[d]);const le=S.useRef(!1);Dl(()=>(le.current=!0,()=>{le.current=!1}),[]),Dl(()=>{if(A&&(_.current=A),D&&(L.current=D),A&&D){if(te.current)return te.current(A,D,se);se()}},[A,D,se,te,X]);const ue=S.useMemo(()=>({reference:_,floating:L,setReference:k,setFloating:T}),[k,T]),z=S.useMemo(()=>({reference:A,floating:D}),[A,D]),I=S.useMemo(()=>{const q={position:e,left:0,top:0};if(!z.floating)return q;const Y=zv(z.floating,h.x),fe=zv(z.floating,h.y);return r?{...q,transform:"translate("+Y+"px, "+fe+"px)",...Dx(z.floating)>=1.5&&{willChange:"transform"}}:{position:e,left:Y,top:fe}},[e,r,z.floating,h.x,h.y]);return S.useMemo(()=>({...h,update:se,refs:ue,elements:z,floatingStyles:I}),[h,se,ue,z,I])}const X2=c=>{function t(e){return{}.hasOwnProperty.call(e,"current")}return{name:"arrow",options:c,fn(e){const{element:s,padding:n}=typeof c=="function"?c(e):c;return s&&t(s)?s.current!=null?Nv({element:s.current,padding:n}).fn(e):{}:s?Nv({element:s,padding:n}).fn(e):{}}}},J2=(c,t)=>({...$2(c),options:[c,t]}),Z2=(c,t)=>({...B2(c),options:[c,t]}),eI=(c,t)=>({...V2(c),options:[c,t]}),tI=(c,t)=>({...U2(c),options:[c,t]}),sI=(c,t)=>({...F2(c),options:[c,t]}),nI=(c,t)=>({...Q2(c),options:[c,t]}),iI=(c,t)=>({...X2(c),options:[c,t]});var oI="Arrow",Px=S.forwardRef((c,t)=>{const{children:e,width:s=10,height:n=5,...i}=c;return y.jsx(De.svg,{...i,ref:t,width:s,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:c.asChild?e:y.jsx("polygon",{points:"0,0 30,0 15,10"})})});Px.displayName=oI;var aI=Px;function wu(c){const[t,e]=S.useState(void 0);return as(()=>{if(c){e({width:c.offsetWidth,height:c.offsetHeight});const s=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const i=n[0];let o,r;if("borderBoxSize"in i){const u=i.borderBoxSize,d=Array.isArray(u)?u[0]:u;o=d.inlineSize,r=d.blockSize}else o=c.offsetWidth,r=c.offsetHeight;e({width:o,height:r})});return s.observe(c,{box:"border-box"}),()=>s.unobserve(c)}else e(void 0)},[c]),t}var Ep="Popper",[_x,Aa]=xs(Ep),[rI,Lx]=_x(Ep),Ix=c=>{const{__scopePopper:t,children:e}=c,[s,n]=S.useState(null);return y.jsx(rI,{scope:t,anchor:s,onAnchorChange:n,children:e})};Ix.displayName=Ep;var Nx="PopperAnchor",zx=S.forwardRef((c,t)=>{const{__scopePopper:e,virtualRef:s,...n}=c,i=Lx(Nx,e),o=S.useRef(null),r=Le(t,o),u=S.useRef(null);return S.useEffect(()=>{const d=u.current;u.current=s?.current||o.current,d!==u.current&&i.onAnchorChange(u.current)}),s?null:y.jsx(De.div,{...n,ref:r})});zx.displayName=Nx;var Tp="PopperContent",[cI,lI]=_x(Tp),jx=S.forwardRef((c,t)=>{const{__scopePopper:e,side:s="bottom",sideOffset:n=0,align:i="center",alignOffset:o=0,arrowPadding:r=0,avoidCollisions:u=!0,collisionBoundary:d=[],collisionPadding:h=0,sticky:p="partial",hideWhenDetached:g=!1,updatePositionStrategy:v="optimized",onPlaced:b,...x}=c,R=Lx(Tp,e),[C,k]=S.useState(null),T=Le(t,B=>k(B)),[A,D]=S.useState(null),_=wu(A),L=_?.width??0,O=_?.height??0,X=s+(i!=="center"?"-"+i:""),te=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},ce=Array.isArray(d)?d:[d],Z=ce.length>0,se={padding:te,boundary:ce.filter(dI),altBoundary:Z},{refs:le,floatingStyles:ue,placement:z,isPositioned:I,middlewareData:q}=Y2({strategy:"fixed",placement:X,whileElementsMounted:(...B)=>H2(...B,{animationFrame:v==="always"}),elements:{reference:R.anchor},middleware:[J2({mainAxis:n+O,alignmentAxis:o}),u&&Z2({mainAxis:!0,crossAxis:!1,limiter:p==="partial"?eI():void 0,...se}),u&&tI({...se}),sI({...se,apply:({elements:B,rects:G,availableWidth:pe,availableHeight:me})=>{const{width:ye,height:be}=G.reference,Ie=B.floating.style;Ie.setProperty("--radix-popper-available-width",`${pe}px`),Ie.setProperty("--radix-popper-available-height",`${me}px`),Ie.setProperty("--radix-popper-anchor-width",`${ye}px`),Ie.setProperty("--radix-popper-anchor-height",`${be}px`)}}),A&&iI({element:A,padding:r}),hI({arrowWidth:L,arrowHeight:O}),g&&nI({strategy:"referenceHidden",...se})]}),[Y,fe]=Hx(z),N=os(b);as(()=>{I&&N?.()},[I,N]);const F=q.arrow?.x,K=q.arrow?.y,ie=q.arrow?.centerOffset!==0,[U,oe]=S.useState();return as(()=>{C&&oe(window.getComputedStyle(C).zIndex)},[C]),y.jsx("div",{ref:le.setFloating,"data-radix-popper-content-wrapper":"",style:{...ue,transform:I?ue.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:U,"--radix-popper-transform-origin":[q.transformOrigin?.x,q.transformOrigin?.y].join(" "),...q.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:c.dir,children:y.jsx(cI,{scope:e,placedSide:Y,onArrowChange:D,arrowX:F,arrowY:K,shouldHideArrow:ie,children:y.jsx(De.div,{"data-side":Y,"data-align":fe,...x,ref:T,style:{...x.style,animation:I?void 0:"none"}})})})});jx.displayName=Tp;var Ox="PopperArrow",uI={top:"bottom",right:"left",bottom:"top",left:"right"},qx=S.forwardRef(function(t,e){const{__scopePopper:s,...n}=t,i=lI(Ox,s),o=uI[i.placedSide];return y.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:y.jsx(aI,{...n,ref:e,style:{...n.style,display:"block"}})})});qx.displayName=Ox;function dI(c){return c!==null}var hI=c=>({name:"transformOrigin",options:c,fn(t){const{placement:e,rects:s,middlewareData:n}=t,o=n.arrow?.centerOffset!==0,r=o?0:c.arrowWidth,u=o?0:c.arrowHeight,[d,h]=Hx(e),p={start:"0%",center:"50%",end:"100%"}[h],g=(n.arrow?.x??0)+r/2,v=(n.arrow?.y??0)+u/2;let b="",x="";return d==="bottom"?(b=o?p:`${g}px`,x=`${-u}px`):d==="top"?(b=o?p:`${g}px`,x=`${s.floating.height+u}px`):d==="right"?(b=`${-u}px`,x=o?p:`${v}px`):d==="left"&&(b=`${s.floating.width+u}px`,x=o?p:`${v}px`),{data:{x:b,y:x}}}});function Hx(c){const[t,e="center"]=c.split("-");return[t,e]}var kp=Ix,xu=zx,Ap=jx,Dp=qx;function fI(c){const t=pI(c),e=S.forwardRef((s,n)=>{const{children:i,...o}=s,r=S.Children.toArray(i),u=r.find(mI);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}function pI(c){const t=S.forwardRef((e,s)=>{const{children:n,...i}=e;if(S.isValidElement(n)){const o=vI(n),r=yI(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var gI=Symbol("radix.slottable");function mI(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===gI}function yI(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function vI(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}var kf=["Enter"," "],bI=["ArrowDown","PageUp","Home"],$x=["ArrowUp","PageDown","End"],wI=[...bI,...$x],xI={ltr:[...kf,"ArrowRight"],rtl:[...kf,"ArrowLeft"]},MI={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Kr="Menu",[jr,SI,CI]=hu(Kr),[Co,Bx]=xs(Kr,[CI,Aa,fu]),Mu=Aa(),Ux=fu(),[RI,Ro]=Co(Kr),[EI,Yr]=Co(Kr),Fx=c=>{const{__scopeMenu:t,open:e=!1,children:s,dir:n,onOpenChange:i,modal:o=!0}=c,r=Mu(t),[u,d]=S.useState(null),h=S.useRef(!1),p=os(i),g=Ea(n);return S.useEffect(()=>{const v=()=>{h.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>h.current=!1;return document.addEventListener("keydown",v,{capture:!0}),()=>{document.removeEventListener("keydown",v,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),y.jsx(kp,{...r,children:y.jsx(RI,{scope:t,open:e,onOpenChange:p,content:u,onContentChange:d,children:y.jsx(EI,{scope:t,onClose:S.useCallback(()=>p(!1),[p]),isUsingKeyboardRef:h,dir:g,modal:o,children:s})})})};Fx.displayName=Kr;var TI="MenuAnchor",Pp=S.forwardRef((c,t)=>{const{__scopeMenu:e,...s}=c,n=Mu(e);return y.jsx(xu,{...n,...s,ref:t})});Pp.displayName=TI;var _p="MenuPortal",[kI,Qx]=Co(_p,{forceMount:void 0}),Vx=c=>{const{__scopeMenu:t,forceMount:e,children:s,container:n}=c,i=Ro(_p,t);return y.jsx(kI,{scope:t,forceMount:e,children:y.jsx(ls,{present:e||i.open,children:y.jsx(Qr,{asChild:!0,container:n,children:s})})})};Vx.displayName=_p;var Ws="MenuContent",[AI,Lp]=Co(Ws),Gx=S.forwardRef((c,t)=>{const e=Qx(Ws,c.__scopeMenu),{forceMount:s=e.forceMount,...n}=c,i=Ro(Ws,c.__scopeMenu),o=Yr(Ws,c.__scopeMenu);return y.jsx(jr.Provider,{scope:c.__scopeMenu,children:y.jsx(ls,{present:s||i.open,children:y.jsx(jr.Slot,{scope:c.__scopeMenu,children:o.modal?y.jsx(DI,{...n,ref:t}):y.jsx(PI,{...n,ref:t})})})})}),DI=S.forwardRef((c,t)=>{const e=Ro(Ws,c.__scopeMenu),s=S.useRef(null),n=Le(t,s);return S.useEffect(()=>{const i=s.current;if(i)return ou(i)},[]),y.jsx(Ip,{...c,ref:n,trapFocus:e.open,disableOutsidePointerEvents:e.open,disableOutsideScroll:!0,onFocusOutside:ge(c.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>e.onOpenChange(!1)})}),PI=S.forwardRef((c,t)=>{const e=Ro(Ws,c.__scopeMenu);return y.jsx(Ip,{...c,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>e.onOpenChange(!1)})}),_I=fI("MenuContent.ScrollLock"),Ip=S.forwardRef((c,t)=>{const{__scopeMenu:e,loop:s=!1,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:r,onEntryFocus:u,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:g,onDismiss:v,disableOutsideScroll:b,...x}=c,R=Ro(Ws,e),C=Yr(Ws,e),k=Mu(e),T=Ux(e),A=SI(e),[D,_]=S.useState(null),L=S.useRef(null),O=Le(t,L,R.onContentChange),X=S.useRef(0),te=S.useRef(""),ce=S.useRef(0),Z=S.useRef(null),se=S.useRef("right"),le=S.useRef(0),ue=b?Vr:S.Fragment,z=b?{as:_I,allowPinchZoom:!0}:void 0,I=Y=>{const fe=te.current+Y,N=A().filter(B=>!B.disabled),F=document.activeElement,K=N.find(B=>B.ref.current===F)?.textValue,ie=N.map(B=>B.textValue),U=FI(ie,fe,K),oe=N.find(B=>B.textValue===U)?.ref.current;(function B(G){te.current=G,window.clearTimeout(X.current),G!==""&&(X.current=window.setTimeout(()=>B(""),1e3))})(fe),oe&&setTimeout(()=>oe.focus())};S.useEffect(()=>()=>window.clearTimeout(X.current),[]),nu();const q=S.useCallback(Y=>se.current===Z.current?.side&&VI(Y,Z.current?.area),[]);return y.jsx(AI,{scope:e,searchRef:te,onItemEnter:S.useCallback(Y=>{q(Y)&&Y.preventDefault()},[q]),onItemLeave:S.useCallback(Y=>{q(Y)||(L.current?.focus(),_(null))},[q]),onTriggerLeave:S.useCallback(Y=>{q(Y)&&Y.preventDefault()},[q]),pointerGraceTimerRef:ce,onPointerGraceIntentChange:S.useCallback(Y=>{Z.current=Y},[]),children:y.jsx(ue,{...z,children:y.jsx(Fr,{asChild:!0,trapped:n,onMountAutoFocus:ge(i,Y=>{Y.preventDefault(),L.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:y.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:r,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:g,onDismiss:v,children:y.jsx(ox,{asChild:!0,...T,dir:C.dir,orientation:"vertical",loop:s,currentTabStopId:D,onCurrentTabStopIdChange:_,onEntryFocus:ge(u,Y=>{C.isUsingKeyboardRef.current||Y.preventDefault()}),preventScrollOnEntryFocus:!0,children:y.jsx(Ap,{role:"menu","aria-orientation":"vertical","data-state":lM(R.open),"data-radix-menu-content":"",dir:C.dir,...k,...x,ref:O,style:{outline:"none",...x.style},onKeyDown:ge(x.onKeyDown,Y=>{const N=Y.target.closest("[data-radix-menu-content]")===Y.currentTarget,F=Y.ctrlKey||Y.altKey||Y.metaKey,K=Y.key.length===1;N&&(Y.key==="Tab"&&Y.preventDefault(),!F&&K&&I(Y.key));const ie=L.current;if(Y.target!==ie||!wI.includes(Y.key))return;Y.preventDefault();const oe=A().filter(B=>!B.disabled).map(B=>B.ref.current);$x.includes(Y.key)&&oe.reverse(),BI(oe)}),onBlur:ge(c.onBlur,Y=>{Y.currentTarget.contains(Y.target)||(window.clearTimeout(X.current),te.current="")}),onPointerMove:ge(c.onPointerMove,Or(Y=>{const fe=Y.target,N=le.current!==Y.clientX;if(Y.currentTarget.contains(fe)&&N){const F=Y.clientX>le.current?"right":"left";se.current=F,le.current=Y.clientX}}))})})})})})})});Gx.displayName=Ws;var LI="MenuGroup",Np=S.forwardRef((c,t)=>{const{__scopeMenu:e,...s}=c;return y.jsx(De.div,{role:"group",...s,ref:t})});Np.displayName=LI;var II="MenuLabel",Wx=S.forwardRef((c,t)=>{const{__scopeMenu:e,...s}=c;return y.jsx(De.div,{...s,ref:t})});Wx.displayName=II;var Gl="MenuItem",jv="menu.itemSelect",Su=S.forwardRef((c,t)=>{const{disabled:e=!1,onSelect:s,...n}=c,i=S.useRef(null),o=Yr(Gl,c.__scopeMenu),r=Lp(Gl,c.__scopeMenu),u=Le(t,i),d=S.useRef(!1),h=()=>{const p=i.current;if(!e&&p){const g=new CustomEvent(jv,{bubbles:!0,cancelable:!0});p.addEventListener(jv,v=>s?.(v),{once:!0}),jb(p,g),g.defaultPrevented?d.current=!1:o.onClose()}};return y.jsx(Kx,{...n,ref:u,disabled:e,onClick:ge(c.onClick,h),onPointerDown:p=>{c.onPointerDown?.(p),d.current=!0},onPointerUp:ge(c.onPointerUp,p=>{d.current||p.currentTarget?.click()}),onKeyDown:ge(c.onKeyDown,p=>{const g=r.searchRef.current!=="";e||g&&p.key===" "||kf.includes(p.key)&&(p.currentTarget.click(),p.preventDefault())})})});Su.displayName=Gl;var Kx=S.forwardRef((c,t)=>{const{__scopeMenu:e,disabled:s=!1,textValue:n,...i}=c,o=Lp(Gl,e),r=Ux(e),u=S.useRef(null),d=Le(t,u),[h,p]=S.useState(!1),[g,v]=S.useState("");return S.useEffect(()=>{const b=u.current;b&&v((b.textContent??"").trim())},[i.children]),y.jsx(jr.ItemSlot,{scope:e,disabled:s,textValue:n??g,children:y.jsx(ax,{asChild:!0,...r,focusable:!s,children:y.jsx(De.div,{role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:d,onPointerMove:ge(c.onPointerMove,Or(b=>{s?o.onItemLeave(b):(o.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ge(c.onPointerLeave,Or(b=>o.onItemLeave(b))),onFocus:ge(c.onFocus,()=>p(!0)),onBlur:ge(c.onBlur,()=>p(!1))})})})}),NI="MenuCheckboxItem",Yx=S.forwardRef((c,t)=>{const{checked:e=!1,onCheckedChange:s,...n}=c;return y.jsx(tM,{scope:c.__scopeMenu,checked:e,children:y.jsx(Su,{role:"menuitemcheckbox","aria-checked":Wl(e)?"mixed":e,...n,ref:t,"data-state":jp(e),onSelect:ge(n.onSelect,()=>s?.(Wl(e)?!0:!e),{checkForDefaultPrevented:!1})})})});Yx.displayName=NI;var Xx="MenuRadioGroup",[zI,jI]=Co(Xx,{value:void 0,onValueChange:()=>{}}),Jx=S.forwardRef((c,t)=>{const{value:e,onValueChange:s,...n}=c,i=os(s);return y.jsx(zI,{scope:c.__scopeMenu,value:e,onValueChange:i,children:y.jsx(Np,{...n,ref:t})})});Jx.displayName=Xx;var Zx="MenuRadioItem",eM=S.forwardRef((c,t)=>{const{value:e,...s}=c,n=jI(Zx,c.__scopeMenu),i=e===n.value;return y.jsx(tM,{scope:c.__scopeMenu,checked:i,children:y.jsx(Su,{role:"menuitemradio","aria-checked":i,...s,ref:t,"data-state":jp(i),onSelect:ge(s.onSelect,()=>n.onValueChange?.(e),{checkForDefaultPrevented:!1})})})});eM.displayName=Zx;var zp="MenuItemIndicator",[tM,OI]=Co(zp,{checked:!1}),sM=S.forwardRef((c,t)=>{const{__scopeMenu:e,forceMount:s,...n}=c,i=OI(zp,e);return y.jsx(ls,{present:s||Wl(i.checked)||i.checked===!0,children:y.jsx(De.span,{...n,ref:t,"data-state":jp(i.checked)})})});sM.displayName=zp;var qI="MenuSeparator",nM=S.forwardRef((c,t)=>{const{__scopeMenu:e,...s}=c;return y.jsx(De.div,{role:"separator","aria-orientation":"horizontal",...s,ref:t})});nM.displayName=qI;var HI="MenuArrow",iM=S.forwardRef((c,t)=>{const{__scopeMenu:e,...s}=c,n=Mu(e);return y.jsx(Dp,{...n,...s,ref:t})});iM.displayName=HI;var $I="MenuSub",[M3,oM]=Co($I),Tr="MenuSubTrigger",aM=S.forwardRef((c,t)=>{const e=Ro(Tr,c.__scopeMenu),s=Yr(Tr,c.__scopeMenu),n=oM(Tr,c.__scopeMenu),i=Lp(Tr,c.__scopeMenu),o=S.useRef(null),{pointerGraceTimerRef:r,onPointerGraceIntentChange:u}=i,d={__scopeMenu:c.__scopeMenu},h=S.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return S.useEffect(()=>h,[h]),S.useEffect(()=>{const p=r.current;return()=>{window.clearTimeout(p),u(null)}},[r,u]),y.jsx(Pp,{asChild:!0,...d,children:y.jsx(Kx,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":e.open,"aria-controls":n.contentId,"data-state":lM(e.open),...c,ref:kn(t,n.onTriggerChange),onClick:p=>{c.onClick?.(p),!(c.disabled||p.defaultPrevented)&&(p.currentTarget.focus(),e.open||e.onOpenChange(!0))},onPointerMove:ge(c.onPointerMove,Or(p=>{i.onItemEnter(p),!p.defaultPrevented&&!c.disabled&&!e.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{e.onOpenChange(!0),h()},100))})),onPointerLeave:ge(c.onPointerLeave,Or(p=>{h();const g=e.content?.getBoundingClientRect();if(g){const v=e.content?.dataset.side,b=v==="right",x=b?-5:5,R=g[b?"left":"right"],C=g[b?"right":"left"];i.onPointerGraceIntentChange({area:[{x:p.clientX+x,y:p.clientY},{x:R,y:g.top},{x:C,y:g.top},{x:C,y:g.bottom},{x:R,y:g.bottom}],side:v}),window.clearTimeout(r.current),r.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(p),p.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:ge(c.onKeyDown,p=>{const g=i.searchRef.current!=="";c.disabled||g&&p.key===" "||xI[s.dir].includes(p.key)&&(e.onOpenChange(!0),e.content?.focus(),p.preventDefault())})})})});aM.displayName=Tr;var rM="MenuSubContent",cM=S.forwardRef((c,t)=>{const e=Qx(Ws,c.__scopeMenu),{forceMount:s=e.forceMount,...n}=c,i=Ro(Ws,c.__scopeMenu),o=Yr(Ws,c.__scopeMenu),r=oM(rM,c.__scopeMenu),u=S.useRef(null),d=Le(t,u);return y.jsx(jr.Provider,{scope:c.__scopeMenu,children:y.jsx(ls,{present:s||i.open,children:y.jsx(jr.Slot,{scope:c.__scopeMenu,children:y.jsx(Ip,{id:r.contentId,"aria-labelledby":r.triggerId,...n,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:h=>{o.isUsingKeyboardRef.current&&u.current?.focus(),h.preventDefault()},onCloseAutoFocus:h=>h.preventDefault(),onFocusOutside:ge(c.onFocusOutside,h=>{h.target!==r.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:ge(c.onEscapeKeyDown,h=>{o.onClose(),h.preventDefault()}),onKeyDown:ge(c.onKeyDown,h=>{const p=h.currentTarget.contains(h.target),g=MI[o.dir].includes(h.key);p&&g&&(i.onOpenChange(!1),r.trigger?.focus(),h.preventDefault())})})})})})});cM.displayName=rM;function lM(c){return c?"open":"closed"}function Wl(c){return c==="indeterminate"}function jp(c){return Wl(c)?"indeterminate":c?"checked":"unchecked"}function BI(c){const t=document.activeElement;for(const e of c)if(e===t||(e.focus(),document.activeElement!==t))return}function UI(c,t){return c.map((e,s)=>c[(t+s)%c.length])}function FI(c,t,e){const n=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,i=e?c.indexOf(e):-1;let o=UI(c,Math.max(i,0));n.length===1&&(o=o.filter(d=>d!==e));const u=o.find(d=>d.toLowerCase().startsWith(n.toLowerCase()));return u!==e?u:void 0}function QI(c,t){const{x:e,y:s}=c;let n=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const r=t[i],u=t[o],d=r.x,h=r.y,p=u.x,g=u.y;h>s!=g>s&&e<(p-d)*(s-h)/(g-h)+d&&(n=!n)}return n}function VI(c,t){if(!t)return!1;const e={x:c.clientX,y:c.clientY};return QI(e,t)}function Or(c){return t=>t.pointerType==="mouse"?c(t):void 0}var GI=Fx,WI=Pp,KI=Vx,YI=Gx,XI=Np,JI=Wx,ZI=Su,eN=Yx,tN=Jx,sN=eM,nN=sM,iN=nM,oN=iM,aN=aM,rN=cM,Cu="DropdownMenu",[cN]=xs(Cu,[Bx]),hs=Bx(),[lN,uM]=cN(Cu),dM=c=>{const{__scopeDropdownMenu:t,children:e,dir:s,open:n,defaultOpen:i,onOpenChange:o,modal:r=!0}=c,u=hs(t),d=S.useRef(null),[h,p]=En({prop:n,defaultProp:i??!1,onChange:o,caller:Cu});return y.jsx(lN,{scope:t,triggerId:rn(),triggerRef:d,contentId:rn(),open:h,onOpenChange:p,onOpenToggle:S.useCallback(()=>p(g=>!g),[p]),modal:r,children:y.jsx(GI,{...u,open:h,onOpenChange:p,dir:s,modal:r,children:e})})};dM.displayName=Cu;var hM="DropdownMenuTrigger",fM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,disabled:s=!1,...n}=c,i=uM(hM,e),o=hs(e);return y.jsx(WI,{asChild:!0,...o,children:y.jsx(De.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...n,ref:kn(t,i.triggerRef),onPointerDown:ge(c.onPointerDown,r=>{!s&&r.button===0&&r.ctrlKey===!1&&(i.onOpenToggle(),i.open||r.preventDefault())}),onKeyDown:ge(c.onKeyDown,r=>{s||(["Enter"," "].includes(r.key)&&i.onOpenToggle(),r.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(r.key)&&r.preventDefault())})})})});fM.displayName=hM;var uN="DropdownMenuPortal",pM=c=>{const{__scopeDropdownMenu:t,...e}=c,s=hs(t);return y.jsx(KI,{...s,...e})};pM.displayName=uN;var gM="DropdownMenuContent",mM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=uM(gM,e),i=hs(e),o=S.useRef(!1);return y.jsx(YI,{id:n.contentId,"aria-labelledby":n.triggerId,...i,...s,ref:t,onCloseAutoFocus:ge(c.onCloseAutoFocus,r=>{o.current||n.triggerRef.current?.focus(),o.current=!1,r.preventDefault()}),onInteractOutside:ge(c.onInteractOutside,r=>{const u=r.detail.originalEvent,d=u.button===0&&u.ctrlKey===!0,h=u.button===2||d;(!n.modal||h)&&(o.current=!0)}),style:{...c.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mM.displayName=gM;var dN="DropdownMenuGroup",hN=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(XI,{...n,...s,ref:t})});hN.displayName=dN;var fN="DropdownMenuLabel",yM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(JI,{...n,...s,ref:t})});yM.displayName=fN;var pN="DropdownMenuItem",vM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(ZI,{...n,...s,ref:t})});vM.displayName=pN;var gN="DropdownMenuCheckboxItem",bM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(eN,{...n,...s,ref:t})});bM.displayName=gN;var mN="DropdownMenuRadioGroup",yN=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(tN,{...n,...s,ref:t})});yN.displayName=mN;var vN="DropdownMenuRadioItem",wM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(sN,{...n,...s,ref:t})});wM.displayName=vN;var bN="DropdownMenuItemIndicator",xM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(nN,{...n,...s,ref:t})});xM.displayName=bN;var wN="DropdownMenuSeparator",MM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(iN,{...n,...s,ref:t})});MM.displayName=wN;var xN="DropdownMenuArrow",MN=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(oN,{...n,...s,ref:t})});MN.displayName=xN;var SN="DropdownMenuSubTrigger",SM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(aN,{...n,...s,ref:t})});SM.displayName=SN;var CN="DropdownMenuSubContent",CM=S.forwardRef((c,t)=>{const{__scopeDropdownMenu:e,...s}=c,n=hs(e);return y.jsx(rN,{...n,...s,ref:t,style:{...c.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});CM.displayName=CN;var RN=dM,EN=fM,TN=pM,RM=mM,EM=yM,TM=vM,kM=bM,AM=wM,DM=xM,PM=MM,_M=SM,LM=CM;const kN=RN,AN=EN,DN=S.forwardRef(({className:c,inset:t,children:e,...s},n)=>y.jsxs(_M,{ref:n,className:Te("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",c),...s,children:[e,y.jsx(Xf,{className:"ml-auto"})]}));DN.displayName=_M.displayName;const PN=S.forwardRef(({className:c,...t},e)=>y.jsx(LM,{ref:e,className:Te("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",c),...t}));PN.displayName=LM.displayName;const IM=S.forwardRef(({className:c,sideOffset:t=4,...e},s)=>y.jsx(TN,{children:y.jsx(RM,{ref:s,sideOffset:t,className:Te("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",c),...e})}));IM.displayName=RM.displayName;const Pl=S.forwardRef(({className:c,inset:t,...e},s)=>y.jsx(TM,{ref:s,className:Te("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",c),...e}));Pl.displayName=TM.displayName;const _N=S.forwardRef(({className:c,children:t,checked:e,...s},n)=>y.jsxs(kM,{ref:n,className:Te("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",c),checked:e,...s,children:[y.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:y.jsx(DM,{children:y.jsx(Yf,{className:"h-4 w-4"})})}),t]}));_N.displayName=kM.displayName;const LN=S.forwardRef(({className:c,children:t,...e},s)=>y.jsxs(AM,{ref:s,className:Te("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",c),...e,children:[y.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:y.jsx(DM,{children:y.jsx(tD,{className:"h-2 w-2 fill-current"})})}),t]}));LN.displayName=AM.displayName;const Af=S.forwardRef(({className:c,inset:t,...e},s)=>y.jsx(EM,{ref:s,className:Te("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",c),...e}));Af.displayName=EM.displayName;const NM=S.forwardRef(({className:c,...t},e)=>y.jsx(PM,{ref:e,className:Te("-mx-1 my-1 h-px bg-muted",c),...t}));NM.displayName=PM.displayName;const zM="archiphoenix_component_library",Ov=()=>{if(typeof window>"u")return{favorites:[],collections:[]};try{const c=window.localStorage.getItem(zM);if(!c)return{favorites:[],collections:[]};const t=JSON.parse(c);return{favorites:Array.isArray(t.favorites)?t.favorites:[],collections:Array.isArray(t.collections)?t.collections:[]}}catch(c){return Cb("Failed to load component library state",c instanceof Error?c:new Error(String(c))),{favorites:[],collections:[]}}},ga=c=>{typeof window>"u"||window.localStorage.setItem(zM,JSON.stringify(c))},IN=un((c,t)=>({favorites:Ov().favorites,collections:Ov().collections,toggleFavorite:e=>{c(s=>{const i=s.favorites.includes(e)?s.favorites.filter(o=>o!==e):[...s.favorites,e];return ga({favorites:i,collections:s.collections}),{favorites:i}})},createCollection:e=>{const s=e.trim();if(!s)return null;const n={id:`collection-${Date.now()}`,name:s,componentIds:[]};return c(i=>{const o=[...i.collections,n];return ga({favorites:i.favorites,collections:o}),{collections:o}}),n.id},renameCollection:(e,s)=>{c(n=>{const i=n.collections.map(o=>o.id===e?{...o,name:s}:o);return ga({favorites:n.favorites,collections:i}),{collections:i}})},deleteCollection:e=>{c(s=>{const n=s.collections.filter(i=>i.id!==e);return ga({favorites:s.favorites,collections:n}),{collections:n}})},addComponentToCollection:(e,s)=>{c(n=>{const i=n.collections.map(o=>o.id!==e||o.componentIds.includes(s)?o:{...o,componentIds:[...o.componentIds,s]});return ga({favorites:n.favorites,collections:i}),{collections:i}})},removeComponentFromCollection:(e,s)=>{c(n=>{const i=n.collections.map(o=>o.id!==e?o:{...o,componentIds:o.componentIds.filter(r=>r!==s)});return ga({favorites:n.favorites,collections:i}),{collections:i}})}}));function qv({open:c,initialName:t="",onConfirm:e,onCancel:s}){const[n,i]=S.useState(t);S.useEffect(()=>{c&&i(t)},[c,t]);const o=()=>{n.trim()&&e(n.trim())};return y.jsx(mp,{open:c,onOpenChange:r=>!r&&s(),children:y.jsxs(ru,{children:[y.jsxs(cu,{children:[y.jsx(uu,{children:t?"Rename Collection":"Create Collection"}),y.jsx(du,{children:t?"Enter a new name for the collection":"Enter a name for the new collection"})]}),y.jsxs("div",{className:"py-4",children:[y.jsx(it,{htmlFor:"collection-name",children:"Collection Name"}),y.jsx(kt,{id:"collection-name",value:n,onChange:r=>i(r.target.value),onKeyDown:r=>{r.key==="Enter"&&o()},className:"mt-2",autoFocus:!0})]}),y.jsxs(lu,{children:[y.jsx(ke,{variant:"outline",onClick:s,children:"Cancel"}),y.jsx(ke,{onClick:o,disabled:!n.trim(),children:t?"Save":"Create"})]})]})})}function NN(){const[c,t]=S.useState(""),[e,s]=S.useState("all"),[n,i]=S.useState(!1),[o,r]=S.useState(!1),[u,d]=S.useState(null),[h,p]=S.useState(null),[g,v]=S.useState(180),[b,x]=S.useState(!1),R=S.useRef(null),[C,k]=S.useState(()=>{const U=localStorage.getItem("sidebar-expanded-categories");if(U)try{const oe=JSON.parse(U);return Cr.reduce((B,G)=>(B[G.id]=oe[G.id]!==void 0?oe[G.id]:!0,B),{})}catch{}return Cr.reduce((oe,B)=>(oe[B.id]=!0,oe),{})}),{favorites:T,collections:A,toggleFavorite:D,createCollection:_,renameCollection:L,deleteCollection:O,addComponentToCollection:X,removeComponentFromCollection:te}=IN(),ce=U=>{k(oe=>({...oe,[U]:!oe[U]}))},Z=c.toLowerCase(),se=S.useMemo(()=>Ir.filter(U=>U.label.toLowerCase().includes(Z)),[Z]),le=S.useMemo(()=>se.filter(U=>T.includes(U.id)),[T,se]),ue=(U,oe)=>{U.dataTransfer.setData("application/json",JSON.stringify(oe)),U.dataTransfer.effectAllowed="copy"},z=()=>{d(null),i(!0)},I=U=>{if(u)L(u.id,U),d(null);else{if(A.some(G=>G.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}_(U)||alert("Failed to create collection")}i(!1)},q=()=>{i(!1),d(null)},Y=U=>{p(U),d(null),r(!0)},fe=U=>{if(!h)return;if(A.some(G=>G.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}const B=_(U);B?X(B,h):alert("Failed to create collection"),r(!1),p(null)},N=()=>{r(!1),p(null)},F=U=>{d(U),i(!0)};S.useEffect(()=>{localStorage.setItem("sidebar-expanded-categories",JSON.stringify(C))},[C]),S.useEffect(()=>{if(!b)return;const U=B=>{if(!R.current)return;const G=R.current.closest(".h-full");if(!G)return;const pe=G.getBoundingClientRect();R.current.getBoundingClientRect();const me=pe.bottom-B.clientY,ye=70,be=pe.height*.8;v(Math.max(ye,Math.min(be,me)))},oe=()=>{x(!1)};return document.addEventListener("mousemove",U),document.addEventListener("mouseup",oe),()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",oe)}},[b]);const K=(U,oe)=>{const B=T.includes(U.id);return y.jsxs("div",{draggable:!0,onDragStart:G=>ue(G,U),className:`flex items-center gap-1 px-1 ${oe?.compact?"py-0.5 text-[10px]":"py-1 text-xs"} rounded-md bg-secondary/50 hover:bg-secondary cursor-move transition-colors border border-border/50`,children:[y.jsxs("div",{className:"flex items-center gap-0.5 flex-1 min-w-0",children:[y.jsx("span",{className:"text-sm flex-shrink-0",children:U.icon}),y.jsx("span",{className:"text-foreground truncate min-w-0",children:U.label})]}),y.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[y.jsx("button",{type:"button",onClick:G=>{G.preventDefault(),G.stopPropagation(),D(U.id)},onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:B?"Remove from favorites":"Add to favorites",children:y.jsx(GD,{className:`h-4 w-4 ${B?"text-yellow-400":"text-muted-foreground"}`,fill:B?"currentColor":"none"})}),y.jsxs(kN,{children:[y.jsx(AN,{asChild:!0,children:y.jsx("button",{type:"button",onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Add to collection",children:y.jsx(ql,{className:"h-4 w-4 text-muted-foreground"})})}),y.jsxs(IM,{align:"end",className:"w-48",children:[A.length===0&&y.jsxs(y.Fragment,{children:[y.jsx(Af,{children:"No collections"}),y.jsxs(Pl,{onSelect:G=>{G.preventDefault(),Y(U.id)},children:[y.jsx(wf,{className:"h-4 w-4 mr-2"}),"Create and add"]})]}),A.length>0&&y.jsxs(y.Fragment,{children:[y.jsx(Af,{children:"Add to collection"}),A.map(G=>y.jsx(Pl,{onSelect:pe=>{pe.preventDefault(),X(G.id,U.id)},children:G.name},G.id)),y.jsx(NM,{}),y.jsxs(Pl,{onSelect:G=>{G.preventDefault(),Y(U.id)},children:[y.jsx(wf,{className:"h-4 w-4 mr-2"}),"New collection"]})]})]})]}),oe?.onRemove&&y.jsx("button",{type:"button",onClick:G=>{G.preventDefault(),G.stopPropagation(),oe.onRemove?.()},onMouseDown:G=>G.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Remove from collection",children:y.jsx(an,{className:"h-4 w-4 text-muted-foreground"})})]})]},`${U.id}-${oe?.compact?"compact":"default"}`)},ie=e==="all"?Cr:Cr.filter(U=>U.id===e);return y.jsxs("div",{className:"w-60 h-full bg-sidebar-bg border-r border-border flex flex-col",children:[y.jsxs("div",{className:"p-3 border-b border-border",children:[y.jsx("h2",{className:"text-xs font-semibold text-foreground mb-2",children:"Components"}),y.jsxs("div",{className:"relative",children:[y.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),y.jsx(kt,{type:"text",placeholder:"Search...",value:c,onChange:U=>t(U.target.value),className:"pl-7 h-8 text-xs"})]})]}),y.jsx("div",{className:"px-3 py-1.5 border-b border-border pb-2",children:y.jsx(bp,{value:e,onValueChange:s,children:y.jsxs(is,{orientation:"horizontal",className:"w-full",children:[y.jsxs(gu,{className:"flex w-max gap-0.5",children:[y.jsx(sn,{value:"all",className:"text-xs px-2 py-1",children:"All"}),Cr.map(U=>y.jsx(sn,{value:U.id,className:"text-xs px-2 py-1",children:U.icon},U.id))]}),y.jsx(su,{orientation:"horizontal",className:"data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30 [&>[data-radix-scroll-area-thumb]]:bg-accent/80 hover:[&>[data-radix-scroll-area-thumb]]:bg-accent rounded-full",style:{transition:"none"}})]})})}),le.length>0&&y.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[y.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[y.jsx("span",{className:"text-[10px] font-semibold uppercase text-muted-foreground",children:"Favorites"}),y.jsx("span",{className:"text-[10px] text-muted-foreground",children:le.length})]}),y.jsx("div",{className:"space-y-1",children:le.map(U=>K(U,{compact:!0}))})]}),y.jsx(is,{className:"flex-1",children:y.jsx("div",{className:"pl-3 pr-6 py-2",children:ie.map(U=>{const oe=se.filter(B=>B.category===U.id);return oe.length===0&&c?null:y.jsxs("div",{className:"mb-1.5",children:[y.jsxs(ke,{variant:"ghost",className:"w-full justify-start px-1 h-7 text-xs",onClick:()=>ce(U.id),children:[C[U.id]?y.jsx(Jl,{className:"h-3.5 w-3.5 mr-0.5"}):y.jsx(Xf,{className:"h-3.5 w-3.5 mr-0.5"}),y.jsx("span",{className:"mr-1",children:U.icon}),y.jsx("span",{className:"flex-1 text-left truncate min-w-0 mr-1",children:U.label}),y.jsx("span",{className:"text-[10px] text-muted-foreground flex-shrink-0",children:oe.length})]}),C[U.id]&&y.jsx("div",{className:"ml-1.5 mt-1 space-y-1",children:oe.map(B=>K(B,{compact:!0}))})]},U.id)})})}),y.jsx("div",{ref:R,className:"h-2 border-t border-border cursor-row-resize hover:bg-accent/50 transition-colors relative group flex items-center justify-center",onMouseDown:U=>{U.preventDefault(),x(!0)},style:{userSelect:"none"},children:y.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:y.jsx(fD,{className:"h-3 w-3 text-muted-foreground"})})}),y.jsxs("div",{className:"border-t border-border overflow-hidden flex flex-col",style:{height:`${g}px`},children:[y.jsx("div",{className:"p-2 pb-1.5 flex-shrink-0",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsx("span",{className:"text-[10px] uppercase font-semibold text-muted-foreground",children:"Collections"}),y.jsxs(ke,{size:"xs",variant:"outline",className:"h-6 text-[10px] px-2",onClick:U=>{U.preventDefault(),U.stopPropagation(),z()},type:"button",children:[y.jsx(ql,{className:"h-3 w-3 mr-0.5"}),"New"]})]})}),y.jsx(is,{className:"flex-1",children:y.jsx("div",{className:"pl-1.5 pr-4 pb-2 space-y-1.5",children:A.length===0?y.jsx("p",{className:"text-[10px] text-muted-foreground px-0.5",children:"Create collections to quickly build typical architectures."}):A.map(U=>{const oe=U.componentIds.map(B=>Ir.find(G=>G.id===B)).filter(B=>!!B).filter(B=>B.label.toLowerCase().includes(Z));return y.jsxs("div",{className:"rounded-md border border-border/60 p-1.5",children:[y.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:U.name}),y.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[oe.length," items"]})]}),y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(ke,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Rename",onClick:()=>F(U),children:""}),y.jsx(ke,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Delete collection",onClick:()=>O(U.id),children:y.jsx(an,{className:"h-4 w-4"})})]})]}),oe.length===0?y.jsx("p",{className:"text-[10px] text-muted-foreground",children:'Add components via "+" menu.'}):y.jsx("div",{className:"space-y-1",children:oe.map(B=>K(B,{compact:!0,onRemove:()=>te(U.id,B.id)}))})]},U.id)})})})]}),y.jsx(qv,{open:n,initialName:u?.name||"",onConfirm:I,onCancel:q}),y.jsx(qv,{open:o,initialName:"",onConfirm:fe,onCancel:N})]})}const Ru=un(c=>({tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}],addTab:t=>c(e=>{if(t.componentId){const n=e.tabs.find(i=>i.componentId===t.componentId);if(n)return{tabs:e.tabs.map(i=>({...i,active:i.id===n.id}))}}const s={...t,id:`${t.type}-${Date.now()}`,active:!0};return{tabs:[...e.tabs.map(n=>({...n,active:!1})),s]}}),closeTab:t=>c(e=>{const s=e.tabs.filter(o=>o.id!==t);if(s.length===0)return{tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}]};const n=e.tabs.findIndex(o=>o.id===t);if(e.tabs[n]?.active&&s.length>0){const o=Math.min(n,s.length-1);s[o].active=!0}return{tabs:s}}),setActiveTab:t=>c(e=>({tabs:e.tabs.map(s=>({...s,active:s.id===t}))})),updateTab:(t,e)=>c(s=>({tabs:s.tabs.map(n=>n.id===t?{...n,...e}:n)}))}));function zN(c){const t=jN(c),e=S.forwardRef((s,n)=>{const{children:i,...o}=s,r=S.Children.toArray(i),u=r.find(qN);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}function jN(c){const t=S.forwardRef((e,s)=>{const{children:n,...i}=e;if(S.isValidElement(n)){const o=$N(n),r=HN(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var ON=Symbol("radix.slottable");function qN(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===ON}function HN(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function $N(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}function Eu(c){const t=S.useRef({value:c,previous:c});return S.useMemo(()=>(t.current.value!==c&&(t.current.previous=t.current.value,t.current.value=c),t.current.previous),[c])}var jM=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),BN="VisuallyHidden",OM=S.forwardRef((c,t)=>y.jsx(De.span,{...c,ref:t,style:{...jM,...c.style}}));OM.displayName=BN;var S3=OM,UN=[" ","Enter","ArrowUp","ArrowDown"],FN=[" ","Enter"],Mo="Select",[Tu,ku,QN]=hu(Mo),[Da]=xs(Mo,[QN,Aa]),Au=Aa(),[VN,$i]=Da(Mo),[GN,WN]=Da(Mo),qM=c=>{const{__scopeSelect:t,children:e,open:s,defaultOpen:n,onOpenChange:i,value:o,defaultValue:r,onValueChange:u,dir:d,name:h,autoComplete:p,disabled:g,required:v,form:b}=c,x=Au(t),[R,C]=S.useState(null),[k,T]=S.useState(null),[A,D]=S.useState(!1),_=Ea(d),[L,O]=En({prop:s,defaultProp:n??!1,onChange:i,caller:Mo}),[X,te]=En({prop:o,defaultProp:r,onChange:u,caller:Mo}),ce=S.useRef(null),Z=R?b||!!R.closest("form"):!0,[se,le]=S.useState(new Set),ue=Array.from(se).map(z=>z.props.value).join(";");return y.jsx(kp,{...x,children:y.jsxs(VN,{required:v,scope:t,trigger:R,onTriggerChange:C,valueNode:k,onValueNodeChange:T,valueNodeHasChildren:A,onValueNodeHasChildrenChange:D,contentId:rn(),value:X,onValueChange:te,open:L,onOpenChange:O,dir:_,triggerPointerDownPosRef:ce,disabled:g,children:[y.jsx(Tu.Provider,{scope:t,children:y.jsx(GN,{scope:c.__scopeSelect,onNativeOptionAdd:S.useCallback(z=>{le(I=>new Set(I).add(z))},[]),onNativeOptionRemove:S.useCallback(z=>{le(I=>{const q=new Set(I);return q.delete(z),q})},[]),children:e})}),Z?y.jsxs(lS,{"aria-hidden":!0,required:v,tabIndex:-1,name:h,autoComplete:p,value:X,onChange:z=>te(z.target.value),disabled:g,form:b,children:[X===void 0?y.jsx("option",{value:""}):null,Array.from(se)]},ue):null]})})};qM.displayName=Mo;var HM="SelectTrigger",$M=S.forwardRef((c,t)=>{const{__scopeSelect:e,disabled:s=!1,...n}=c,i=Au(e),o=$i(HM,e),r=o.disabled||s,u=Le(t,o.onTriggerChange),d=ku(e),h=S.useRef("touch"),[p,g,v]=dS(x=>{const R=d().filter(T=>!T.disabled),C=R.find(T=>T.value===o.value),k=hS(R,x,C);k!==void 0&&o.onValueChange(k.value)}),b=x=>{r||(o.onOpenChange(!0),v()),x&&(o.triggerPointerDownPosRef.current={x:Math.round(x.pageX),y:Math.round(x.pageY)})};return y.jsx(xu,{asChild:!0,...i,children:y.jsx(De.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:r,"data-disabled":r?"":void 0,"data-placeholder":uS(o.value)?"":void 0,...n,ref:u,onClick:ge(n.onClick,x=>{x.currentTarget.focus(),h.current!=="mouse"&&b(x)}),onPointerDown:ge(n.onPointerDown,x=>{h.current=x.pointerType;const R=x.target;R.hasPointerCapture(x.pointerId)&&R.releasePointerCapture(x.pointerId),x.button===0&&x.ctrlKey===!1&&x.pointerType==="mouse"&&(b(x),x.preventDefault())}),onKeyDown:ge(n.onKeyDown,x=>{const R=p.current!=="";!(x.ctrlKey||x.altKey||x.metaKey)&&x.key.length===1&&g(x.key),!(R&&x.key===" ")&&UN.includes(x.key)&&(b(),x.preventDefault())})})})});$M.displayName=HM;var BM="SelectValue",UM=S.forwardRef((c,t)=>{const{__scopeSelect:e,className:s,style:n,children:i,placeholder:o="",...r}=c,u=$i(BM,e),{onValueNodeHasChildrenChange:d}=u,h=i!==void 0,p=Le(t,u.onValueNodeChange);return as(()=>{d(h)},[d,h]),y.jsx(De.span,{...r,ref:p,style:{pointerEvents:"none"},children:uS(u.value)?y.jsx(y.Fragment,{children:o}):i})});UM.displayName=BM;var KN="SelectIcon",FM=S.forwardRef((c,t)=>{const{__scopeSelect:e,children:s,...n}=c;return y.jsx(De.span,{"aria-hidden":!0,...n,ref:t,children:s||""})});FM.displayName=KN;var YN="SelectPortal",QM=c=>y.jsx(Qr,{asChild:!0,...c});QM.displayName=YN;var So="SelectContent",VM=S.forwardRef((c,t)=>{const e=$i(So,c.__scopeSelect),[s,n]=S.useState();if(as(()=>{n(new DocumentFragment)},[]),!e.open){const i=s;return i?Hr.createPortal(y.jsx(GM,{scope:c.__scopeSelect,children:y.jsx(Tu.Slot,{scope:c.__scopeSelect,children:y.jsx("div",{children:c.children})})}),i):null}return y.jsx(WM,{...c,ref:t})});VM.displayName=So;var tn=10,[GM,Bi]=Da(So),XN="SelectContentImpl",JN=zN("SelectContent.RemoveScroll"),WM=S.forwardRef((c,t)=>{const{__scopeSelect:e,position:s="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:i,onPointerDownOutside:o,side:r,sideOffset:u,align:d,alignOffset:h,arrowPadding:p,collisionBoundary:g,collisionPadding:v,sticky:b,hideWhenDetached:x,avoidCollisions:R,...C}=c,k=$i(So,e),[T,A]=S.useState(null),[D,_]=S.useState(null),L=Le(t,B=>A(B)),[O,X]=S.useState(null),[te,ce]=S.useState(null),Z=ku(e),[se,le]=S.useState(!1),ue=S.useRef(!1);S.useEffect(()=>{if(T)return ou(T)},[T]),nu();const z=S.useCallback(B=>{const[G,...pe]=Z().map(be=>be.ref.current),[me]=pe.slice(-1),ye=document.activeElement;for(const be of B)if(be===ye||(be?.scrollIntoView({block:"nearest"}),be===G&&D&&(D.scrollTop=0),be===me&&D&&(D.scrollTop=D.scrollHeight),be?.focus(),document.activeElement!==ye))return},[Z,D]),I=S.useCallback(()=>z([O,T]),[z,O,T]);S.useEffect(()=>{se&&I()},[se,I]);const{onOpenChange:q,triggerPointerDownPosRef:Y}=k;S.useEffect(()=>{if(T){let B={x:0,y:0};const G=me=>{B={x:Math.abs(Math.round(me.pageX)-(Y.current?.x??0)),y:Math.abs(Math.round(me.pageY)-(Y.current?.y??0))}},pe=me=>{B.x<=10&&B.y<=10?me.preventDefault():T.contains(me.target)||q(!1),document.removeEventListener("pointermove",G),Y.current=null};return Y.current!==null&&(document.addEventListener("pointermove",G),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",G),document.removeEventListener("pointerup",pe,{capture:!0})}}},[T,q,Y]),S.useEffect(()=>{const B=()=>q(!1);return window.addEventListener("blur",B),window.addEventListener("resize",B),()=>{window.removeEventListener("blur",B),window.removeEventListener("resize",B)}},[q]);const[fe,N]=dS(B=>{const G=Z().filter(ye=>!ye.disabled),pe=G.find(ye=>ye.ref.current===document.activeElement),me=hS(G,B,pe);me&&setTimeout(()=>me.ref.current.focus())}),F=S.useCallback((B,G,pe)=>{const me=!ue.current&&!pe;(k.value!==void 0&&k.value===G||me)&&(X(B),me&&(ue.current=!0))},[k.value]),K=S.useCallback(()=>T?.focus(),[T]),ie=S.useCallback((B,G,pe)=>{const me=!ue.current&&!pe;(k.value!==void 0&&k.value===G||me)&&ce(B)},[k.value]),U=s==="popper"?Df:KM,oe=U===Df?{side:r,sideOffset:u,align:d,alignOffset:h,arrowPadding:p,collisionBoundary:g,collisionPadding:v,sticky:b,hideWhenDetached:x,avoidCollisions:R}:{};return y.jsx(GM,{scope:e,content:T,viewport:D,onViewportChange:_,itemRefCallback:F,selectedItem:O,onItemLeave:K,itemTextRefCallback:ie,focusSelectedItem:I,selectedItemText:te,position:s,isPositioned:se,searchRef:fe,children:y.jsx(Vr,{as:JN,allowPinchZoom:!0,children:y.jsx(Fr,{asChild:!0,trapped:k.open,onMountAutoFocus:B=>{B.preventDefault()},onUnmountAutoFocus:ge(n,B=>{k.trigger?.focus({preventScroll:!0}),B.preventDefault()}),children:y.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:B=>B.preventDefault(),onDismiss:()=>k.onOpenChange(!1),children:y.jsx(U,{role:"listbox",id:k.contentId,"data-state":k.open?"open":"closed",dir:k.dir,onContextMenu:B=>B.preventDefault(),...C,...oe,onPlaced:()=>le(!0),ref:L,style:{display:"flex",flexDirection:"column",outline:"none",...C.style},onKeyDown:ge(C.onKeyDown,B=>{const G=B.ctrlKey||B.altKey||B.metaKey;if(B.key==="Tab"&&B.preventDefault(),!G&&B.key.length===1&&N(B.key),["ArrowUp","ArrowDown","Home","End"].includes(B.key)){let me=Z().filter(ye=>!ye.disabled).map(ye=>ye.ref.current);if(["ArrowUp","End"].includes(B.key)&&(me=me.slice().reverse()),["ArrowUp","ArrowDown"].includes(B.key)){const ye=B.target,be=me.indexOf(ye);me=me.slice(be+1)}setTimeout(()=>z(me)),B.preventDefault()}})})})})})})});WM.displayName=XN;var ZN="SelectItemAlignedPosition",KM=S.forwardRef((c,t)=>{const{__scopeSelect:e,onPlaced:s,...n}=c,i=$i(So,e),o=Bi(So,e),[r,u]=S.useState(null),[d,h]=S.useState(null),p=Le(t,L=>h(L)),g=ku(e),v=S.useRef(!1),b=S.useRef(!0),{viewport:x,selectedItem:R,selectedItemText:C,focusSelectedItem:k}=o,T=S.useCallback(()=>{if(i.trigger&&i.valueNode&&r&&d&&x&&R&&C){const L=i.trigger.getBoundingClientRect(),O=d.getBoundingClientRect(),X=i.valueNode.getBoundingClientRect(),te=C.getBoundingClientRect();if(i.dir!=="rtl"){const ye=te.left-O.left,be=X.left-ye,Ie=L.left-be,Be=L.width+Ie,ot=Math.max(Be,O.width),Ze=window.innerWidth-tn,Lt=Lr(be,[tn,Math.max(tn,Ze-ot)]);r.style.minWidth=Be+"px",r.style.left=Lt+"px"}else{const ye=O.right-te.right,be=window.innerWidth-X.right-ye,Ie=window.innerWidth-L.right-be,Be=L.width+Ie,ot=Math.max(Be,O.width),Ze=window.innerWidth-tn,Lt=Lr(be,[tn,Math.max(tn,Ze-ot)]);r.style.minWidth=Be+"px",r.style.right=Lt+"px"}const ce=g(),Z=window.innerHeight-tn*2,se=x.scrollHeight,le=window.getComputedStyle(d),ue=parseInt(le.borderTopWidth,10),z=parseInt(le.paddingTop,10),I=parseInt(le.borderBottomWidth,10),q=parseInt(le.paddingBottom,10),Y=ue+z+se+q+I,fe=Math.min(R.offsetHeight*5,Y),N=window.getComputedStyle(x),F=parseInt(N.paddingTop,10),K=parseInt(N.paddingBottom,10),ie=L.top+L.height/2-tn,U=Z-ie,oe=R.offsetHeight/2,B=R.offsetTop+oe,G=ue+z+B,pe=Y-G;if(G<=ie){const ye=ce.length>0&&R===ce[ce.length-1].ref.current;r.style.bottom="0px";const be=d.clientHeight-x.offsetTop-x.offsetHeight,Ie=Math.max(U,oe+(ye?K:0)+be+I),Be=G+Ie;r.style.height=Be+"px"}else{const ye=ce.length>0&&R===ce[0].ref.current;r.style.top="0px";const Ie=Math.max(ie,ue+x.offsetTop+(ye?F:0)+oe)+pe;r.style.height=Ie+"px",x.scrollTop=G-ie+x.offsetTop}r.style.margin=`${tn}px 0`,r.style.minHeight=fe+"px",r.style.maxHeight=Z+"px",s?.(),requestAnimationFrame(()=>v.current=!0)}},[g,i.trigger,i.valueNode,r,d,x,R,C,i.dir,s]);as(()=>T(),[T]);const[A,D]=S.useState();as(()=>{d&&D(window.getComputedStyle(d).zIndex)},[d]);const _=S.useCallback(L=>{L&&b.current===!0&&(T(),k?.(),b.current=!1)},[T,k]);return y.jsx(tz,{scope:e,contentWrapper:r,shouldExpandOnScrollRef:v,onScrollButtonChange:_,children:y.jsx("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:y.jsx(De.div,{...n,ref:p,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});KM.displayName=ZN;var ez="SelectPopperPosition",Df=S.forwardRef((c,t)=>{const{__scopeSelect:e,align:s="start",collisionPadding:n=tn,...i}=c,o=Au(e);return y.jsx(Ap,{...o,...i,ref:t,align:s,collisionPadding:n,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Df.displayName=ez;var[tz,Op]=Da(So,{}),Pf="SelectViewport",YM=S.forwardRef((c,t)=>{const{__scopeSelect:e,nonce:s,...n}=c,i=Bi(Pf,e),o=Op(Pf,e),r=Le(t,i.onViewportChange),u=S.useRef(0);return y.jsxs(y.Fragment,{children:[y.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),y.jsx(Tu.Slot,{scope:e,children:y.jsx(De.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:r,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:ge(n.onScroll,d=>{const h=d.currentTarget,{contentWrapper:p,shouldExpandOnScrollRef:g}=o;if(g?.current&&p){const v=Math.abs(u.current-h.scrollTop);if(v>0){const b=window.innerHeight-tn*2,x=parseFloat(p.style.minHeight),R=parseFloat(p.style.height),C=Math.max(x,R);if(C<b){const k=C+v,T=Math.min(b,k),A=k-T;p.style.height=T+"px",p.style.bottom==="0px"&&(h.scrollTop=A>0?A:0,p.style.justifyContent="flex-end")}}}u.current=h.scrollTop})})})]})});YM.displayName=Pf;var XM="SelectGroup",[sz,nz]=Da(XM),iz=S.forwardRef((c,t)=>{const{__scopeSelect:e,...s}=c,n=rn();return y.jsx(sz,{scope:e,id:n,children:y.jsx(De.div,{role:"group","aria-labelledby":n,...s,ref:t})})});iz.displayName=XM;var JM="SelectLabel",ZM=S.forwardRef((c,t)=>{const{__scopeSelect:e,...s}=c,n=nz(JM,e);return y.jsx(De.div,{id:n.id,...s,ref:t})});ZM.displayName=JM;var Kl="SelectItem",[oz,eS]=Da(Kl),tS=S.forwardRef((c,t)=>{const{__scopeSelect:e,value:s,disabled:n=!1,textValue:i,...o}=c,r=$i(Kl,e),u=Bi(Kl,e),d=r.value===s,[h,p]=S.useState(i??""),[g,v]=S.useState(!1),b=Le(t,k=>u.itemRefCallback?.(k,s,n)),x=rn(),R=S.useRef("touch"),C=()=>{n||(r.onValueChange(s),r.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return y.jsx(oz,{scope:e,value:s,disabled:n,textId:x,isSelected:d,onItemTextChange:S.useCallback(k=>{p(T=>T||(k?.textContent??"").trim())},[]),children:y.jsx(Tu.ItemSlot,{scope:e,value:s,disabled:n,textValue:h,children:y.jsx(De.div,{role:"option","aria-labelledby":x,"data-highlighted":g?"":void 0,"aria-selected":d&&g,"data-state":d?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...o,ref:b,onFocus:ge(o.onFocus,()=>v(!0)),onBlur:ge(o.onBlur,()=>v(!1)),onClick:ge(o.onClick,()=>{R.current!=="mouse"&&C()}),onPointerUp:ge(o.onPointerUp,()=>{R.current==="mouse"&&C()}),onPointerDown:ge(o.onPointerDown,k=>{R.current=k.pointerType}),onPointerMove:ge(o.onPointerMove,k=>{R.current=k.pointerType,n?u.onItemLeave?.():R.current==="mouse"&&k.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ge(o.onPointerLeave,k=>{k.currentTarget===document.activeElement&&u.onItemLeave?.()}),onKeyDown:ge(o.onKeyDown,k=>{u.searchRef?.current!==""&&k.key===" "||(FN.includes(k.key)&&C(),k.key===" "&&k.preventDefault())})})})})});tS.displayName=Kl;var kr="SelectItemText",sS=S.forwardRef((c,t)=>{const{__scopeSelect:e,className:s,style:n,...i}=c,o=$i(kr,e),r=Bi(kr,e),u=eS(kr,e),d=WN(kr,e),[h,p]=S.useState(null),g=Le(t,C=>p(C),u.onItemTextChange,C=>r.itemTextRefCallback?.(C,u.value,u.disabled)),v=h?.textContent,b=S.useMemo(()=>y.jsx("option",{value:u.value,disabled:u.disabled,children:v},u.value),[u.disabled,u.value,v]),{onNativeOptionAdd:x,onNativeOptionRemove:R}=d;return as(()=>(x(b),()=>R(b)),[x,R,b]),y.jsxs(y.Fragment,{children:[y.jsx(De.span,{id:u.textId,...i,ref:g}),u.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Hr.createPortal(i.children,o.valueNode):null]})});sS.displayName=kr;var nS="SelectItemIndicator",iS=S.forwardRef((c,t)=>{const{__scopeSelect:e,...s}=c;return eS(nS,e).isSelected?y.jsx(De.span,{"aria-hidden":!0,...s,ref:t}):null});iS.displayName=nS;var _f="SelectScrollUpButton",oS=S.forwardRef((c,t)=>{const e=Bi(_f,c.__scopeSelect),s=Op(_f,c.__scopeSelect),[n,i]=S.useState(!1),o=Le(t,s.onScrollButtonChange);return as(()=>{if(e.viewport&&e.isPositioned){let r=function(){const d=u.scrollTop>0;i(d)};const u=e.viewport;return r(),u.addEventListener("scroll",r),()=>u.removeEventListener("scroll",r)}},[e.viewport,e.isPositioned]),n?y.jsx(rS,{...c,ref:o,onAutoScroll:()=>{const{viewport:r,selectedItem:u}=e;r&&u&&(r.scrollTop=r.scrollTop-u.offsetHeight)}}):null});oS.displayName=_f;var Lf="SelectScrollDownButton",aS=S.forwardRef((c,t)=>{const e=Bi(Lf,c.__scopeSelect),s=Op(Lf,c.__scopeSelect),[n,i]=S.useState(!1),o=Le(t,s.onScrollButtonChange);return as(()=>{if(e.viewport&&e.isPositioned){let r=function(){const d=u.scrollHeight-u.clientHeight,h=Math.ceil(u.scrollTop)<d;i(h)};const u=e.viewport;return r(),u.addEventListener("scroll",r),()=>u.removeEventListener("scroll",r)}},[e.viewport,e.isPositioned]),n?y.jsx(rS,{...c,ref:o,onAutoScroll:()=>{const{viewport:r,selectedItem:u}=e;r&&u&&(r.scrollTop=r.scrollTop+u.offsetHeight)}}):null});aS.displayName=Lf;var rS=S.forwardRef((c,t)=>{const{__scopeSelect:e,onAutoScroll:s,...n}=c,i=Bi("SelectScrollButton",e),o=S.useRef(null),r=ku(e),u=S.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return S.useEffect(()=>()=>u(),[u]),as(()=>{r().find(h=>h.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[r]),y.jsx(De.div,{"aria-hidden":!0,...n,ref:t,style:{flexShrink:0,...n.style},onPointerDown:ge(n.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(s,50))}),onPointerMove:ge(n.onPointerMove,()=>{i.onItemLeave?.(),o.current===null&&(o.current=window.setInterval(s,50))}),onPointerLeave:ge(n.onPointerLeave,()=>{u()})})}),az="SelectSeparator",cS=S.forwardRef((c,t)=>{const{__scopeSelect:e,...s}=c;return y.jsx(De.div,{"aria-hidden":!0,...s,ref:t})});cS.displayName=az;var If="SelectArrow",rz=S.forwardRef((c,t)=>{const{__scopeSelect:e,...s}=c,n=Au(e),i=$i(If,e),o=Bi(If,e);return i.open&&o.position==="popper"?y.jsx(Dp,{...n,...s,ref:t}):null});rz.displayName=If;var cz="SelectBubbleInput",lS=S.forwardRef(({__scopeSelect:c,value:t,...e},s)=>{const n=S.useRef(null),i=Le(s,n),o=Eu(t);return S.useEffect(()=>{const r=n.current;if(!r)return;const u=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(u,"value").set;if(o!==t&&h){const p=new Event("change",{bubbles:!0});h.call(r,t),r.dispatchEvent(p)}},[o,t]),y.jsx(De.select,{...e,style:{...jM,...e.style},ref:i,defaultValue:t})});lS.displayName=cz;function uS(c){return c===""||c===void 0}function dS(c){const t=os(c),e=S.useRef(""),s=S.useRef(0),n=S.useCallback(o=>{const r=e.current+o;t(r),(function u(d){e.current=d,window.clearTimeout(s.current),d!==""&&(s.current=window.setTimeout(()=>u(""),1e3))})(r)},[t]),i=S.useCallback(()=>{e.current="",window.clearTimeout(s.current)},[]);return S.useEffect(()=>()=>window.clearTimeout(s.current),[]),[e,n,i]}function hS(c,t,e){const n=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,i=e?c.indexOf(e):-1;let o=lz(c,Math.max(i,0));n.length===1&&(o=o.filter(d=>d!==e));const u=o.find(d=>d.textValue.toLowerCase().startsWith(n.toLowerCase()));return u!==e?u:void 0}function lz(c,t){return c.map((e,s)=>c[(t+s)%c.length])}var uz=qM,fS=$M,dz=UM,hz=FM,fz=QM,pS=VM,pz=YM,gS=ZM,mS=tS,gz=sS,mz=iS,yS=oS,vS=aS,bS=cS;const _l=uz,Ll=dz,Dr=S.forwardRef(({className:c,children:t,...e},s)=>y.jsxs(fS,{ref:s,className:Te("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",c),...e,children:[t,y.jsx(hz,{asChild:!0,children:y.jsx(Jl,{className:"h-4 w-4 opacity-50"})})]}));Dr.displayName=fS.displayName;const wS=S.forwardRef(({className:c,...t},e)=>y.jsx(yS,{ref:e,className:Te("flex cursor-default items-center justify-center py-1",c),...t,children:y.jsx(Ab,{className:"h-4 w-4"})}));wS.displayName=yS.displayName;const xS=S.forwardRef(({className:c,...t},e)=>y.jsx(vS,{ref:e,className:Te("flex cursor-default items-center justify-center py-1",c),...t,children:y.jsx(Jl,{className:"h-4 w-4"})}));xS.displayName=vS.displayName;const Pr=S.forwardRef(({className:c,children:t,position:e="popper",...s},n)=>y.jsx(fz,{children:y.jsxs(pS,{ref:n,className:Te("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",e==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",c),position:e,...s,children:[y.jsx(wS,{}),y.jsx(pz,{className:Te("p-1",e==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),y.jsx(xS,{})]})}));Pr.displayName=pS.displayName;const yz=S.forwardRef(({className:c,...t},e)=>y.jsx(gS,{ref:e,className:Te("px-2 py-1.5 text-sm font-semibold",c),...t}));yz.displayName=gS.displayName;const Qt=S.forwardRef(({className:c,children:t,...e},s)=>y.jsxs(mS,{ref:s,className:Te("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",c),...e,children:[y.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:y.jsx(mz,{children:y.jsx(Yf,{className:"h-4 w-4"})})}),y.jsx(gz,{children:t})]}));Qt.displayName=mS.displayName;const vz=S.forwardRef(({className:c,...t},e)=>y.jsx(bS,{ref:e,className:Te("-mx-1 my-1 h-px bg-muted",c),...t}));vz.displayName=bS.displayName;var MS=["PageUp","PageDown"],SS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],CS={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Pa="Slider",[Nf,bz,wz]=hu(Pa),[RS]=xs(Pa,[wz]),[xz,Du]=RS(Pa),ES=S.forwardRef((c,t)=>{const{name:e,min:s=0,max:n=100,step:i=1,orientation:o="horizontal",disabled:r=!1,minStepsBetweenThumbs:u=0,defaultValue:d=[s],value:h,onValueChange:p=()=>{},onValueCommit:g=()=>{},inverted:v=!1,form:b,...x}=c,R=S.useRef(new Set),C=S.useRef(0),T=o==="horizontal"?Mz:Sz,[A=[],D]=En({prop:h,defaultProp:d,onChange:ce=>{[...R.current][C.current]?.focus(),p(ce)}}),_=S.useRef(A);function L(ce){const Z=kz(A,ce);te(ce,Z)}function O(ce){te(ce,C.current)}function X(){const ce=_.current[C.current];A[C.current]!==ce&&g(A)}function te(ce,Z,{commit:se}={commit:!1}){const le=_z(i),ue=Lz(Math.round((ce-s)/i)*i+s,le),z=Lr(ue,[s,n]);D((I=[])=>{const q=Ez(I,z,Z);if(Pz(q,u*i)){C.current=q.indexOf(z);const Y=String(q)!==String(I);return Y&&se&&g(q),Y?q:I}else return I})}return y.jsx(xz,{scope:c.__scopeSlider,name:e,disabled:r,min:s,max:n,valueIndexToChangeRef:C,thumbs:R.current,values:A,orientation:o,form:b,children:y.jsx(Nf.Provider,{scope:c.__scopeSlider,children:y.jsx(Nf.Slot,{scope:c.__scopeSlider,children:y.jsx(T,{"aria-disabled":r,"data-disabled":r?"":void 0,...x,ref:t,onPointerDown:ge(x.onPointerDown,()=>{r||(_.current=A)}),min:s,max:n,inverted:v,onSlideStart:r?void 0:L,onSlideMove:r?void 0:O,onSlideEnd:r?void 0:X,onHomeKeyDown:()=>!r&&te(s,0,{commit:!0}),onEndKeyDown:()=>!r&&te(n,A.length-1,{commit:!0}),onStepKeyDown:({event:ce,direction:Z})=>{if(!r){const ue=MS.includes(ce.key)||ce.shiftKey&&SS.includes(ce.key)?10:1,z=C.current,I=A[z],q=i*ue*Z;te(I+q,z,{commit:!0})}}})})})})});ES.displayName=Pa;var[TS,kS]=RS(Pa,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Mz=S.forwardRef((c,t)=>{const{min:e,max:s,dir:n,inverted:i,onSlideStart:o,onSlideMove:r,onSlideEnd:u,onStepKeyDown:d,...h}=c,[p,g]=S.useState(null),v=Le(t,T=>g(T)),b=S.useRef(void 0),x=Ea(n),R=x==="ltr",C=R&&!i||!R&&i;function k(T){const A=b.current||p.getBoundingClientRect(),D=[0,A.width],L=qp(D,C?[e,s]:[s,e]);return b.current=A,L(T-A.left)}return y.jsx(TS,{scope:c.__scopeSlider,startEdge:C?"left":"right",endEdge:C?"right":"left",direction:C?1:-1,size:"width",children:y.jsx(AS,{dir:x,"data-orientation":"horizontal",...h,ref:v,style:{...h.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:T=>{const A=k(T.clientX);o?.(A)},onSlideMove:T=>{const A=k(T.clientX);r?.(A)},onSlideEnd:()=>{b.current=void 0,u?.()},onStepKeyDown:T=>{const D=CS[C?"from-left":"from-right"].includes(T.key);d?.({event:T,direction:D?-1:1})}})})}),Sz=S.forwardRef((c,t)=>{const{min:e,max:s,inverted:n,onSlideStart:i,onSlideMove:o,onSlideEnd:r,onStepKeyDown:u,...d}=c,h=S.useRef(null),p=Le(t,h),g=S.useRef(void 0),v=!n;function b(x){const R=g.current||h.current.getBoundingClientRect(),C=[0,R.height],T=qp(C,v?[s,e]:[e,s]);return g.current=R,T(x-R.top)}return y.jsx(TS,{scope:c.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:y.jsx(AS,{"data-orientation":"vertical",...d,ref:p,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:x=>{const R=b(x.clientY);i?.(R)},onSlideMove:x=>{const R=b(x.clientY);o?.(R)},onSlideEnd:()=>{g.current=void 0,r?.()},onStepKeyDown:x=>{const C=CS[v?"from-bottom":"from-top"].includes(x.key);u?.({event:x,direction:C?-1:1})}})})}),AS=S.forwardRef((c,t)=>{const{__scopeSlider:e,onSlideStart:s,onSlideMove:n,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:r,onStepKeyDown:u,...d}=c,h=Du(Pa,e);return y.jsx(De.span,{...d,ref:t,onKeyDown:ge(c.onKeyDown,p=>{p.key==="Home"?(o(p),p.preventDefault()):p.key==="End"?(r(p),p.preventDefault()):MS.concat(SS).includes(p.key)&&(u(p),p.preventDefault())}),onPointerDown:ge(c.onPointerDown,p=>{const g=p.target;g.setPointerCapture(p.pointerId),p.preventDefault(),h.thumbs.has(g)?g.focus():s(p)}),onPointerMove:ge(c.onPointerMove,p=>{p.target.hasPointerCapture(p.pointerId)&&n(p)}),onPointerUp:ge(c.onPointerUp,p=>{const g=p.target;g.hasPointerCapture(p.pointerId)&&(g.releasePointerCapture(p.pointerId),i(p))})})}),DS="SliderTrack",PS=S.forwardRef((c,t)=>{const{__scopeSlider:e,...s}=c,n=Du(DS,e);return y.jsx(De.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...s,ref:t})});PS.displayName=DS;var zf="SliderRange",_S=S.forwardRef((c,t)=>{const{__scopeSlider:e,...s}=c,n=Du(zf,e),i=kS(zf,e),o=S.useRef(null),r=Le(t,o),u=n.values.length,d=n.values.map(g=>NS(g,n.min,n.max)),h=u>1?Math.min(...d):0,p=100-Math.max(...d);return y.jsx(De.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...s,ref:r,style:{...c.style,[i.startEdge]:h+"%",[i.endEdge]:p+"%"}})});_S.displayName=zf;var jf="SliderThumb",LS=S.forwardRef((c,t)=>{const e=bz(c.__scopeSlider),[s,n]=S.useState(null),i=Le(t,r=>n(r)),o=S.useMemo(()=>s?e().findIndex(r=>r.ref.current===s):-1,[e,s]);return y.jsx(Cz,{...c,ref:i,index:o})}),Cz=S.forwardRef((c,t)=>{const{__scopeSlider:e,index:s,name:n,...i}=c,o=Du(jf,e),r=kS(jf,e),[u,d]=S.useState(null),h=Le(t,k=>d(k)),p=u?o.form||!!u.closest("form"):!0,g=wu(u),v=o.values[s],b=v===void 0?0:NS(v,o.min,o.max),x=Tz(s,o.values.length),R=g?.[r.size],C=R?Az(R,b,r.direction):0;return S.useEffect(()=>{if(u)return o.thumbs.add(u),()=>{o.thumbs.delete(u)}},[u,o.thumbs]),y.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[r.startEdge]:`calc(${b}% + ${C}px)`},children:[y.jsx(Nf.ItemSlot,{scope:c.__scopeSlider,children:y.jsx(De.span,{role:"slider","aria-label":c["aria-label"]||x,"aria-valuemin":o.min,"aria-valuenow":v,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:h,style:v===void 0?{display:"none"}:c.style,onFocus:ge(c.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),p&&y.jsx(IS,{name:n??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:v},s)]})});LS.displayName=jf;var Rz="RadioBubbleInput",IS=S.forwardRef(({__scopeSlider:c,value:t,...e},s)=>{const n=S.useRef(null),i=Le(n,s),o=Eu(t);return S.useEffect(()=>{const r=n.current;if(!r)return;const u=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(u,"value").set;if(o!==t&&h){const p=new Event("input",{bubbles:!0});h.call(r,t),r.dispatchEvent(p)}},[o,t]),y.jsx(De.input,{style:{display:"none"},...e,ref:i,defaultValue:t})});IS.displayName=Rz;function Ez(c=[],t,e){const s=[...c];return s[e]=t,s.sort((n,i)=>n-i)}function NS(c,t,e){const i=100/(e-t)*(c-t);return Lr(i,[0,100])}function Tz(c,t){return t>2?`Value ${c+1} of ${t}`:t===2?["Minimum","Maximum"][c]:void 0}function kz(c,t){if(c.length===1)return 0;const e=c.map(n=>Math.abs(n-t)),s=Math.min(...e);return e.indexOf(s)}function Az(c,t,e){const s=c/2,i=qp([0,50],[0,s]);return(s-i(t)*e)*e}function Dz(c){return c.slice(0,-1).map((t,e)=>c[e+1]-t)}function Pz(c,t){if(t>0){const e=Dz(c);return Math.min(...e)>=t}return!0}function qp(c,t){return e=>{if(c[0]===c[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(c[1]-c[0]);return t[0]+s*(e-c[0])}}function _z(c){return(String(c).split(".")[1]||"").length}function Lz(c,t){const e=Math.pow(10,t);return Math.round(c*e)/e}var zS=ES,Iz=PS,Nz=_S,zz=LS;const nn=S.forwardRef(({className:c,...t},e)=>y.jsxs(zS,{ref:e,className:Te("relative flex w-full touch-none select-none items-center",c),...t,children:[y.jsx(Iz,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:y.jsx(Nz,{className:"absolute h-full bg-primary"})}),y.jsx(zz,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));nn.displayName=zS.displayName;var Pu="Switch",[jz]=xs(Pu),[Oz,qz]=jz(Pu),jS=S.forwardRef((c,t)=>{const{__scopeSwitch:e,name:s,checked:n,defaultChecked:i,required:o,disabled:r,value:u="on",onCheckedChange:d,form:h,...p}=c,[g,v]=S.useState(null),b=Le(t,T=>v(T)),x=S.useRef(!1),R=g?h||!!g.closest("form"):!0,[C,k]=En({prop:n,defaultProp:i??!1,onChange:d,caller:Pu});return y.jsxs(Oz,{scope:e,checked:C,disabled:r,children:[y.jsx(De.button,{type:"button",role:"switch","aria-checked":C,"aria-required":o,"data-state":$S(C),"data-disabled":r?"":void 0,disabled:r,value:u,...p,ref:b,onClick:ge(c.onClick,T=>{k(A=>!A),R&&(x.current=T.isPropagationStopped(),x.current||T.stopPropagation())})}),R&&y.jsx(HS,{control:g,bubbles:!x.current,name:s,value:u,checked:C,required:o,disabled:r,form:h,style:{transform:"translateX(-100%)"}})]})});jS.displayName=Pu;var OS="SwitchThumb",qS=S.forwardRef((c,t)=>{const{__scopeSwitch:e,...s}=c,n=qz(OS,e);return y.jsx(De.span,{"data-state":$S(n.checked),"data-disabled":n.disabled?"":void 0,...s,ref:t})});qS.displayName=OS;var Hz="SwitchBubbleInput",HS=S.forwardRef(({__scopeSwitch:c,control:t,checked:e,bubbles:s=!0,...n},i)=>{const o=S.useRef(null),r=Le(o,i),u=Eu(e),d=wu(t);return S.useEffect(()=>{const h=o.current;if(!h)return;const p=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(p,"checked").set;if(u!==e&&v){const b=new Event("click",{bubbles:s});v.call(h,e),h.dispatchEvent(b)}},[u,e,s]),y.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...n,tabIndex:-1,ref:r,style:{...n.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});HS.displayName=Hz;function $S(c){return c?"checked":"unchecked"}var BS=jS,$z=qS;const po=S.forwardRef(({className:c,...t},e)=>y.jsx(BS,{className:Te("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",c),...t,ref:e,children:y.jsx($z,{className:Te("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));po.displayName=BS.displayName;const ws=S.forwardRef(({className:c,...t},e)=>y.jsx("div",{ref:e,className:Te("rounded-xl border bg-card text-card-foreground shadow",c),...t}));ws.displayName="Card";const Sn=S.forwardRef(({className:c,...t},e)=>y.jsx("div",{ref:e,className:Te("flex flex-col space-y-1.5 p-6",c),...t}));Sn.displayName="CardHeader";const Cn=S.forwardRef(({className:c,...t},e)=>y.jsx("div",{ref:e,className:Te("font-semibold leading-none tracking-tight",c),...t}));Cn.displayName="CardTitle";const mo=S.forwardRef(({className:c,...t},e)=>y.jsx("div",{ref:e,className:Te("text-sm text-muted-foreground",c),...t}));mo.displayName="CardDescription";const Rn=S.forwardRef(({className:c,...t},e)=>y.jsx("div",{ref:e,className:Te("p-6 pt-0",c),...t}));Rn.displayName="CardContent";const Bz=S.forwardRef(({className:c,...t},e)=>y.jsx("div",{ref:e,className:Te("flex items-center p-6 pt-0",c),...t}));Bz.displayName="CardFooter";const Uz=Ff("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ft({className:c,variant:t,...e}){return y.jsx("div",{className:Te(Uz({variant:t}),c),...e})}const _r={heading:{h1:"text-2xl font-bold text-foreground",h2:"text-lg font-semibold text-foreground",h3:"text-sm font-semibold text-foreground",h4:"text-xs font-semibold text-foreground",h5:"text-[10px] font-semibold text-muted-foreground uppercase"},body:{base:"text-sm text-foreground",small:"text-xs text-foreground",micro:"text-[10px] text-foreground"},muted:{base:"text-sm text-muted-foreground",small:"text-xs text-muted-foreground",micro:"text-[10px] text-muted-foreground"},mono:{base:"font-mono text-sm text-foreground",small:"font-mono text-xs text-foreground",micro:"font-mono text-[10px] text-foreground"},status:{success:"text-success",warning:"text-warning",error:"text-destructive",info:"text-primary"}},xn=S.forwardRef(({level:c,as:t,className:e,children:s,...n},i)=>{const o=t||`h${c}`,r=`h${c}`;return y.jsx(o,{ref:i,className:Te(_r.heading[r],e),...n,children:s})});xn.displayName="Heading";const Xe=S.forwardRef(({size:c="base",muted:t=!1,mono:e=!1,as:s="p",className:n,children:i,...o},r)=>{const u=s;let d;return e?d=_r.mono[c]:t?d=_r.muted[c]:d=_r.body[c],y.jsx(u,{ref:r,className:Te(d,n),...o,children:i})});Xe.displayName="Text";const ho=S.forwardRef(({status:c,size:t="base",weight:e="normal",as:s="span",className:n,children:i,...o},r)=>{const u=s,d={base:"text-sm",small:"text-xs",micro:"text-[10px]"},h={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};return y.jsx(u,{ref:r,className:Te(d[t],h[e],_r.status[c],n),...o,children:i})});ho.displayName="StatusText";const Fz=S.forwardRef(({as:c="h2",className:t,children:e,...s},n)=>y.jsx(xn,{ref:n,level:1,as:c,className:t,...s,children:e}));Fz.displayName="PageTitle";const Qz=S.forwardRef(({as:c="h3",className:t,children:e,...s},n)=>y.jsx(xn,{ref:n,level:2,as:c,className:t,...s,children:e}));Qz.displayName="SectionTitle";const ti=S.forwardRef(({as:c="h3",className:t,children:e,...s},n)=>y.jsx(xn,{ref:n,level:3,as:c,className:t,...s,children:e}));ti.displayName="PanelTitle";const Vz=S.forwardRef(({as:c="p",className:t,children:e,...s},n)=>y.jsx(Xe,{ref:n,size:"base",muted:!0,as:c,className:Te("mt-1",t),...s,children:e}));Vz.displayName="Description";function Gz({connection:c,onUpdate:t}){const e=c.data||{},{isRunning:s}=_t(),{getConnectionMessages:n,getMessageHistory:i}=Ni(),[o,r]=S.useState([]),[u,d]=S.useState([]);S.useEffect(()=>{if(!s){r([]),d([]);return}const C=setInterval(()=>{const k=n(c.id),T=i(50).filter(A=>A.connectionId===c.id);r(k),d(T)},200);return()=>clearInterval(C)},[s,c.id,n,i]);const h=C=>{const k={...e,...C};t(c.id,{data:k})},p=C=>{h({latencyMs:Math.max(0,C)})},g=C=>{h({bandwidthMbps:Math.max(1,C)})},v=C=>{h({packetLossPercent:Math.max(0,Math.min(100,C))})},b=C=>{h({jitterMs:Math.max(0,C)})},x=C=>{h({retryCount:Math.max(0,C)})},R=C=>{h({timeoutMs:Math.max(1e3,C)})};return y.jsxs("div",{className:"space-y-2",children:[y.jsxs("div",{className:"space-y-1",children:[y.jsx(ti,{children:"Connection"}),y.jsxs("div",{className:"space-y-0.5",children:[y.jsxs(Xe,{size:"micro",muted:!0,children:["From: ",c.source]}),y.jsxs(Xe,{size:"micro",muted:!0,children:["To: ",c.target]}),y.jsxs(Xe,{size:"micro",muted:!0,children:["Type: ",c.type]})]})]}),y.jsxs("div",{className:"border-t border-border pt-2 space-y-2",children:[y.jsxs("div",{children:[y.jsx(xn,{level:5,className:"mb-1.5 opacity-70",children:"Network Parameters"}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx(it,{className:"text-xs",children:"Latency (ms)"}),y.jsx(Xe,{mono:!0,size:"micro",className:"text-primary",children:e.latencyMs??0})]}),y.jsx(nn,{value:[e.latencyMs??0],onValueChange:C=>p(C[0]),min:0,max:5e3,step:10,className:"w-full"}),y.jsx(kt,{type:"number",value:e.latencyMs??0,onChange:C=>p(parseInt(C.target.value)||0),placeholder:"0-5000",className:"h-7 text-xs"})]}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx(it,{className:"text-xs",children:"Bandwidth (Mbps)"}),y.jsx(Xe,{mono:!0,size:"micro",className:"text-primary",children:e.bandwidthMbps??1e3})]}),y.jsx(nn,{value:[e.bandwidthMbps??1e3],onValueChange:C=>g(C[0]),min:1,max:1e5,step:10,className:"w-full"}),y.jsx(kt,{type:"number",value:e.bandwidthMbps??1e3,onChange:C=>g(parseInt(C.target.value)||1e3),placeholder:"1-100000",className:"h-7 text-xs"})]}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx(it,{className:"text-xs",children:"Packet Loss (%)"}),y.jsx(Xe,{mono:!0,size:"micro",className:"text-primary",children:e.packetLossPercent??0})]}),y.jsx(nn,{value:[e.packetLossPercent??0],onValueChange:C=>v(C[0]),min:0,max:100,step:.1,className:"w-full"}),y.jsx(kt,{type:"number",step:"0.1",value:e.packetLossPercent??0,onChange:C=>v(parseFloat(C.target.value)||0),placeholder:"0-100",className:"h-7 text-xs"})]}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx(it,{className:"text-xs",children:"Jitter (ms)"}),y.jsx(Xe,{mono:!0,size:"micro",className:"text-primary",children:e.jitterMs??0})]}),y.jsx(nn,{value:[e.jitterMs??0],onValueChange:C=>b(C[0]),min:0,max:1e3,step:5,className:"w-full"}),y.jsx(kt,{type:"number",value:e.jitterMs??0,onChange:C=>b(parseInt(C.target.value)||0),placeholder:"0-1000",className:"h-7 text-xs"})]})]}),y.jsxs("div",{className:"border-t border-border pt-2",children:[y.jsx("h4",{className:"text-[9px] font-semibold text-foreground mb-1.5 uppercase opacity-70",children:"Traffic Characteristics"}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsx(it,{className:"text-xs",children:"Priority Level"}),y.jsxs(_l,{value:e.priorityLevel||"medium",onValueChange:C=>h({priorityLevel:C}),children:[y.jsx(Dr,{className:"h-7 text-[11px]",children:y.jsx(Ll,{})}),y.jsxs(Pr,{children:[y.jsx(Qt,{value:"low",children:"Low"}),y.jsx(Qt,{value:"medium",children:"Medium"}),y.jsx(Qt,{value:"high",children:"High"}),y.jsx(Qt,{value:"critical",children:"Critical"})]})]})]}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx(it,{className:"text-xs",children:"Retry Count"}),y.jsx(Xe,{mono:!0,size:"micro",className:"text-primary",children:e.retryCount??3})]}),y.jsx(nn,{value:[e.retryCount??3],onValueChange:C=>x(C[0]),min:0,max:10,step:1,className:"w-full"}),y.jsx(kt,{type:"number",value:e.retryCount??3,onChange:C=>x(parseInt(C.target.value)||0),placeholder:"0-10",className:"h-7 text-xs"})]}),y.jsxs("div",{className:"space-y-1 mb-2",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx(it,{className:"text-xs",children:"Timeout (ms)"}),y.jsx(Xe,{mono:!0,size:"micro",className:"text-primary",children:e.timeoutMs??3e4})]}),y.jsx(nn,{value:[e.timeoutMs??3e4],onValueChange:C=>R(C[0]),min:1e3,max:12e4,step:1e3,className:"w-full"}),y.jsx(kt,{type:"number",value:e.timeoutMs??3e4,onChange:C=>R(parseInt(C.target.value)||3e4),placeholder:"1000-120000",className:"h-7 text-xs"})]})]}),y.jsxs("div",{className:"border-t border-border pt-2",children:[y.jsx(xn,{level:5,className:"mb-1.5 opacity-70",children:"Monitoring"}),y.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-accent/20 rounded-md",children:[y.jsx(it,{className:"text-xs cursor-pointer",children:"Enable Monitoring"}),y.jsx(po,{checked:e.enableMonitoring??!1,onCheckedChange:C=>h({enableMonitoring:C})})]})]}),y.jsx(ws,{className:"bg-card/50 border-border/50 p-1.5 mt-2",children:y.jsxs("div",{className:"space-y-0.5",children:[y.jsxs("div",{className:"flex justify-between",children:[y.jsx(Xe,{size:"micro",muted:!0,children:"Effective Bandwidth:"}),y.jsxs(Xe,{mono:!0,size:"micro",children:[Math.max(1,(e.bandwidthMbps??1e3)*(1-(e.packetLossPercent??0)/100)).toFixed(2)," Mbps"]})]}),y.jsxs("div",{className:"flex justify-between",children:[y.jsx(Xe,{size:"micro",muted:!0,children:"Effective Latency:"}),y.jsxs(Xe,{mono:!0,size:"micro",children:[((e.latencyMs??0)+(e.jitterMs??0)/2).toFixed(0)," ms"]})]})]})}),s&&y.jsx("div",{className:"border-t border-border pt-2 mt-2",children:y.jsxs(bp,{defaultValue:"active",className:"w-full",children:[y.jsxs(gu,{className:"grid w-full grid-cols-2 h-7",children:[y.jsxs(sn,{value:"active",className:"text-xs px-2",children:[y.jsx(vo,{className:"h-3 w-3 mr-1"}),"Active (",o.length,")"]}),y.jsxs(sn,{value:"history",className:"text-xs px-2",children:[y.jsx(dv,{className:"h-3 w-3 mr-1"}),"History (",u.length,")"]})]}),y.jsx(si,{value:"active",className:"mt-1.5 space-y-1",children:o.length===0?y.jsxs("div",{className:"text-center py-3",children:[y.jsx(vo,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),y.jsx(Xe,{size:"micro",muted:!0,children:"No active messages"})]}):y.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:o.map((C,k)=>y.jsxs(ws,{className:"p-1 border-border/50",children:[y.jsx("div",{className:"flex items-start justify-between gap-1.5",children:y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[y.jsx(ft,{variant:"outline",className:"text-xs px-0.5 py-0",children:C.format}),y.jsx(ft,{variant:C.status==="delivered"?"default":C.status==="failed"?"destructive":C.status==="transformed"?"secondary":"outline",className:"text-xs px-0.5 py-0",children:C.status})]}),y.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[y.jsxs("div",{children:["Size: ",(C.size/1024).toFixed(2)," KB"]}),C.latency&&y.jsxs("div",{children:["Latency: ",C.latency.toFixed(0)," ms"]})]}),C.error&&y.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[y.jsx(bo,{className:"h-2.5 w-2.5"}),C.error]})]})}),C.payload&&y.jsxs("details",{className:"mt-1",children:[y.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),y.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(C.payload,null,2)})]})]},C.id||k))})}),y.jsx(si,{value:"history",className:"mt-1.5 space-y-1",children:u.length===0?y.jsxs("div",{className:"text-center py-3",children:[y.jsx(dv,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),y.jsx(Xe,{size:"micro",muted:!0,children:"History is empty"})]}):y.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:u.map((C,k)=>y.jsxs(ws,{className:"p-1 border-border/50",children:[y.jsx("div",{className:"flex items-start justify-between gap-1.5",children:y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[y.jsx(ft,{variant:"outline",className:"text-xs px-0.5 py-0",children:C.format}),y.jsx(ft,{variant:C.status==="delivered"?"default":C.status==="failed"?"destructive":"outline",className:"text-xs px-0.5 py-0",children:C.status}),y.jsx("span",{className:"text-[9px] text-muted-foreground",children:new Date(C.timestamp).toLocaleTimeString()})]}),y.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[y.jsxs("div",{children:["Size: ",(C.size/1024).toFixed(2)," KB"]}),C.latency&&y.jsxs("div",{children:["Latency: ",C.latency.toFixed(0)," ms"]})]}),C.error&&y.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[y.jsx(bo,{className:"h-2.5 w-2.5"}),C.error]})]})}),C.payload&&y.jsxs("details",{className:"mt-1",children:[y.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),y.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(C.payload,null,2)})]})]},C.id||k))})})]})})]})]})}function Wz(c){const t=Kz(c),e=S.forwardRef((s,n)=>{const{children:i,...o}=s,r=S.Children.toArray(i),u=r.find(Xz);if(u){const d=u.props.children,h=r.map(p=>p===u?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:p);return y.jsx(t,{...o,ref:n,children:S.isValidElement(d)?S.cloneElement(d,void 0,h):null})}return y.jsx(t,{...o,ref:n,children:i})});return e.displayName=`${c}.Slot`,e}function Kz(c){const t=S.forwardRef((e,s)=>{const{children:n,...i}=e;if(S.isValidElement(n)){const o=Zz(n),r=Jz(i,n.props);return n.type!==S.Fragment&&(r.ref=s?kn(s,o):o),S.cloneElement(n,r)}return S.Children.count(n)>1?S.Children.only(null):null});return t.displayName=`${c}.SlotClone`,t}var Yz=Symbol("radix.slottable");function Xz(c){return S.isValidElement(c)&&typeof c.type=="function"&&"__radixId"in c.type&&c.type.__radixId===Yz}function Jz(c,t){const e={...t};for(const s in t){const n=c[s],i=t[s];/^on[A-Z]/.test(s)?n&&i?e[s]=(...r)=>{const u=i(...r);return n(...r),u}:n&&(e[s]=n):s==="style"?e[s]={...n,...i}:s==="className"&&(e[s]=[n,i].filter(Boolean).join(" "))}return{...c,...e}}function Zz(c){let t=Object.getOwnPropertyDescriptor(c.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?c.ref:(t=Object.getOwnPropertyDescriptor(c,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?c.props.ref:c.props.ref||c.ref)}var _u="Popover",[US]=xs(_u,[Aa]),Xr=Aa(),[ej,Ui]=US(_u),FS=c=>{const{__scopePopover:t,children:e,open:s,defaultOpen:n,onOpenChange:i,modal:o=!1}=c,r=Xr(t),u=S.useRef(null),[d,h]=S.useState(!1),[p,g]=En({prop:s,defaultProp:n??!1,onChange:i,caller:_u});return y.jsx(kp,{...r,children:y.jsx(ej,{scope:t,contentId:rn(),triggerRef:u,open:p,onOpenChange:g,onOpenToggle:S.useCallback(()=>g(v=>!v),[g]),hasCustomAnchor:d,onCustomAnchorAdd:S.useCallback(()=>h(!0),[]),onCustomAnchorRemove:S.useCallback(()=>h(!1),[]),modal:o,children:e})})};FS.displayName=_u;var QS="PopoverAnchor",tj=S.forwardRef((c,t)=>{const{__scopePopover:e,...s}=c,n=Ui(QS,e),i=Xr(e),{onCustomAnchorAdd:o,onCustomAnchorRemove:r}=n;return S.useEffect(()=>(o(),()=>r()),[o,r]),y.jsx(xu,{...i,...s,ref:t})});tj.displayName=QS;var VS="PopoverTrigger",GS=S.forwardRef((c,t)=>{const{__scopePopover:e,...s}=c,n=Ui(VS,e),i=Xr(e),o=Le(t,n.triggerRef),r=y.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":JS(n.open),...s,ref:o,onClick:ge(c.onClick,n.onOpenToggle)});return n.hasCustomAnchor?r:y.jsx(xu,{asChild:!0,...i,children:r})});GS.displayName=VS;var Hp="PopoverPortal",[sj,nj]=US(Hp,{forceMount:void 0}),WS=c=>{const{__scopePopover:t,forceMount:e,children:s,container:n}=c,i=Ui(Hp,t);return y.jsx(sj,{scope:t,forceMount:e,children:y.jsx(ls,{present:e||i.open,children:y.jsx(Qr,{asChild:!0,container:n,children:s})})})};WS.displayName=Hp;var Ma="PopoverContent",KS=S.forwardRef((c,t)=>{const e=nj(Ma,c.__scopePopover),{forceMount:s=e.forceMount,...n}=c,i=Ui(Ma,c.__scopePopover);return y.jsx(ls,{present:s||i.open,children:i.modal?y.jsx(oj,{...n,ref:t}):y.jsx(aj,{...n,ref:t})})});KS.displayName=Ma;var ij=Wz("PopoverContent.RemoveScroll"),oj=S.forwardRef((c,t)=>{const e=Ui(Ma,c.__scopePopover),s=S.useRef(null),n=Le(t,s),i=S.useRef(!1);return S.useEffect(()=>{const o=s.current;if(o)return ou(o)},[]),y.jsx(Vr,{as:ij,allowPinchZoom:!0,children:y.jsx(YS,{...c,ref:n,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(c.onCloseAutoFocus,o=>{o.preventDefault(),i.current||e.triggerRef.current?.focus()}),onPointerDownOutside:ge(c.onPointerDownOutside,o=>{const r=o.detail.originalEvent,u=r.button===0&&r.ctrlKey===!0,d=r.button===2||u;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:ge(c.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),aj=S.forwardRef((c,t)=>{const e=Ui(Ma,c.__scopePopover),s=S.useRef(!1),n=S.useRef(!1);return y.jsx(YS,{...c,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{c.onCloseAutoFocus?.(i),i.defaultPrevented||(s.current||e.triggerRef.current?.focus(),i.preventDefault()),s.current=!1,n.current=!1},onInteractOutside:i=>{c.onInteractOutside?.(i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;e.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),YS=S.forwardRef((c,t)=>{const{__scopePopover:e,trapFocus:s,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:r,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,...p}=c,g=Ui(Ma,e),v=Xr(e);return nu(),y.jsx(Fr,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:n,onUnmountAutoFocus:i,children:y.jsx(Ur,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:h,onEscapeKeyDown:r,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>g.onOpenChange(!1),children:y.jsx(Ap,{"data-state":JS(g.open),role:"dialog",id:g.contentId,...v,...p,ref:t,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),XS="PopoverClose",rj=S.forwardRef((c,t)=>{const{__scopePopover:e,...s}=c,n=Ui(XS,e);return y.jsx(De.button,{type:"button",...s,ref:t,onClick:ge(c.onClick,()=>n.onOpenChange(!1))})});rj.displayName=XS;var cj="PopoverArrow",lj=S.forwardRef((c,t)=>{const{__scopePopover:e,...s}=c,n=Xr(e);return y.jsx(Dp,{...n,...s,ref:t})});lj.displayName=cj;function JS(c){return c?"open":"closed"}var uj=FS,dj=GS,hj=WS,ZS=KS;const fj=uj,pj=dj,eC=S.forwardRef(({className:c,align:t="center",sideOffset:e=4,...s},n)=>y.jsx(hj,{children:y.jsx(ZS,{ref:n,align:t,sideOffset:e,className:Te("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",c),...s})}));eC.displayName=ZS.displayName;const tC=un((c,t)=>({componentStates:new Map,setComponentState:(e,s,n)=>{ma.setComponentState(e,s,n);const i=ma.getComponentState(e);i&&c(o=>({componentStates:new Map(o.componentStates).set(e,i)}))},resetComponent:e=>{ma.resetComponent(e),c(s=>{const n=new Map(s.componentStates);return n.delete(e),{componentStates:n}})},resetAll:()=>{ma.reset(),c({componentStates:new Map})},getComponentState:e=>t().componentStates.get(e),isEnabled:e=>ma.isEnabled(e),getAllStates:()=>Array.from(t().componentStates.values())}));function gj({componentId:c,componentLabel:t}){const{isRunning:e}=_t(),{getComponentState:s,setComponentState:n,resetComponent:i}=tC(),o=s(c),r=o?.state||"enabled",[u,d]=S.useState(o?.degradedLevel||.5),[h,p]=S.useState(o?.failureRate||.1),[g,v]=S.useState(o?.latencyMultiplier||2),[b,x]=S.useState(o?.throughputMultiplier||.5),R=A=>{A==="degraded"?n(c,A,{degradedLevel:u,failureRate:h,latencyMultiplier:g,throughputMultiplier:b}):n(c,A)},C=()=>{i(c),d(.5),p(.1),v(2),x(.5)},k=A=>{switch(A){case"enabled":return"bg-green-500/20 text-green-500 border-green-500/50";case"disabled":return"bg-gray-500/20 text-gray-500 border-gray-500/50";case"degraded":return"bg-yellow-500/20 text-yellow-500 border-yellow-500/50";case"failed":return"bg-red-500/20 text-red-500 border-red-500/50"}},T=A=>{switch(A){case"enabled":return y.jsx(sf,{className:"w-4 h-4"});case"disabled":return y.jsx(Tl,{className:"w-4 h-4"});case"degraded":return y.jsx(on,{className:"w-4 h-4"});case"failed":return y.jsx(go,{className:"w-4 h-4"})}};return y.jsxs(ws,{className:"border",children:[y.jsx(Sn,{className:"p-2 pb-1.5",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsxs(Cn,{className:"text-[11px] flex items-center gap-1",children:[y.jsx(vo,{className:"w-3 h-3"}),"Component State",y.jsxs(fj,{children:[y.jsx(pj,{asChild:!0,children:y.jsx(ke,{variant:"ghost",size:"icon",className:"h-3.5 w-3.5 rounded-full",children:y.jsx(JA,{className:"w-2.5 h-2.5 text-muted-foreground"})})}),y.jsx(eC,{className:"w-72 text-xs",align:"start",children:y.jsxs("div",{className:"space-y-2",children:[y.jsx("h4",{className:"font-semibold text-sm",children:"Component States"}),y.jsxs("div",{className:"space-y-1.5",children:[y.jsxs("div",{className:"flex items-start gap-2",children:[y.jsx(sf,{className:"w-3.5 h-3.5 text-green-500 mt-0.5 flex-shrink-0"}),y.jsxs("div",{children:[y.jsx("span",{className:"font-medium text-green-500",children:"Enabled"}),y.jsx("span",{className:"text-muted-foreground",children:"  normal operation"})]})]}),y.jsxs("div",{className:"flex items-start gap-2",children:[y.jsx(Tl,{className:"w-3.5 h-3.5 text-gray-500 mt-0.5 flex-shrink-0"}),y.jsxs("div",{children:[y.jsx("span",{className:"font-medium text-gray-500",children:"Disabled"}),y.jsx("span",{className:"text-muted-foreground",children:"  turned off. Throughput=0, Errors=100%"})]})]}),y.jsxs("div",{className:"flex items-start gap-2",children:[y.jsx(on,{className:"w-3.5 h-3.5 text-yellow-500 mt-0.5 flex-shrink-0"}),y.jsxs("div",{children:[y.jsx("span",{className:"font-medium text-yellow-500",children:"Degraded"}),y.jsx("span",{className:"text-muted-foreground",children:"  partial failure. Throughput 50%, Latency 2x, Errors 10%"})]})]}),y.jsxs("div",{className:"flex items-start gap-2",children:[y.jsx(go,{className:"w-3.5 h-3.5 text-red-500 mt-0.5 flex-shrink-0"}),y.jsxs("div",{children:[y.jsx("span",{className:"font-medium text-red-500",children:"Failed"}),y.jsx("span",{className:"text-muted-foreground",children:"  crashed. Same as Disabled but indicates failure"})]})]})]}),y.jsx("p",{className:"text-muted-foreground pt-1 border-t border-border",children:"Use to simulate failures and test architecture resilience."})]})})]})]}),y.jsx(mo,{className:"text-[9px] mt-0.5",children:"Control operational state"})]}),o&&y.jsxs(ft,{variant:"outline",className:`${k(r)} text-xs px-1 py-0.5`,children:[T(r),y.jsx("span",{className:"ml-0.5",children:r.toUpperCase()})]})]})}),y.jsxs(Rn,{className:"p-2 pt-1.5 space-y-2",children:[y.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[y.jsxs(ke,{variant:r==="enabled"?"default":"outline",size:"sm",onClick:()=>R("enabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[y.jsx(sf,{className:"w-3.5 h-3.5"}),"Enabled"]}),y.jsxs(ke,{variant:r==="disabled"?"destructive":"outline",size:"sm",onClick:()=>R("disabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[y.jsx(Tl,{className:"w-3.5 h-3.5"}),"Disabled"]}),y.jsxs(ke,{variant:r==="degraded"?"default":"outline",size:"sm",onClick:()=>R("degraded"),className:"flex items-center gap-1 h-7 text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-600 dark:text-yellow-400",disabled:!e,children:[y.jsx(on,{className:"w-3.5 h-3.5"}),"Degraded"]}),y.jsxs(ke,{variant:r==="failed"?"destructive":"outline",size:"sm",onClick:()=>R("failed"),className:"flex items-center gap-1 h-7 text-xs",disabled:!e,children:[y.jsx(go,{className:"w-3.5 h-3.5"}),"Failed"]})]}),r==="degraded"&&y.jsxs("div",{className:"space-y-2 p-2 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[y.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[y.jsx(Nb,{className:"w-3 h-3 text-yellow-600 dark:text-yellow-400"}),y.jsx(it,{className:"text-[11px] font-semibold text-yellow-600 dark:text-yellow-400",children:"Degradation Settings"})]}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[y.jsx(it,{className:"text-[10px]",children:"Degradation Level"}),y.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(u*100).toFixed(0),"%"]})]}),y.jsx(nn,{value:[u],onValueChange:A=>{d(A[0]),R("degraded")},min:0,max:1,step:.1,className:"w-full"})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[y.jsx(it,{className:"text-[10px]",children:"Failure Rate"}),y.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(h*100).toFixed(0),"%"]})]}),y.jsx(nn,{value:[h],onValueChange:A=>{p(A[0]),R("degraded")},min:0,max:1,step:.05,className:"w-full"})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[y.jsx(it,{className:"text-[10px]",children:"Latency Multiplier"}),y.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[g.toFixed(1),"x"]})]}),y.jsx(nn,{value:[g],onValueChange:A=>{v(A[0]),R("degraded")},min:1,max:5,step:.1,className:"w-full"})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[y.jsx(it,{className:"text-[10px]",children:"Throughput Multiplier"}),y.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(b*100).toFixed(0),"%"]})]}),y.jsx(nn,{value:[b],onValueChange:A=>{x(A[0]),R("degraded")},min:0,max:1,step:.05,className:"w-full"})]})]})]}),o&&y.jsxs(ke,{variant:"outline",size:"sm",onClick:C,className:"w-full flex items-center gap-1 h-7 text-xs",disabled:!e,children:[y.jsx(Ib,{className:"w-3.5 h-3.5"}),"Reset to Normal"]}),!e&&y.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded text-[9px] text-muted-foreground",children:[y.jsx(bo,{className:"w-3 h-3"}),"Start emulation to control component state"]})]})]})}function mj({onFilterChange:c}){const{nodes:t,connections:e,selectNode:s}=Ee(),{isRunning:n,getComponentMetrics:i}=_t(),{getAllComponentStatuses:o}=yo(),[r,u]=S.useState(""),[d,h]=S.useState(!1),[p,g]=S.useState(!0),[v,b]=S.useState(!0),[x,R]=S.useState(!0),[C,k]=S.useState(!0),[T,A]=S.useState(100),[D,_]=S.useState(5),[L,O]=S.useState(new Set),X=Tt.useMemo(()=>n?t.filter(se=>{if(r&&!se.data.label.toLowerCase().includes(r.toLowerCase()))return!1;if(!d)return!0;const le=i(se.id),z=o().find(I=>I.nodeId===se.id);return!!(p&&e.some(q=>q.source===se.id||q.target===se.id?_t.getState().getConnectionMetrics(q.id)?.bottleneck:!1)||v&&le&&le.errorRate*100>=D||C&&le&&le.latency>=T||x&&z?.criticalPath||z&&(z.health==="critical"||z.health==="down"))}):t,[r,d,p,v,C,x,T,D,n,t,e]);Tt.useEffect(()=>{if(d){const se=new Set(X.map(le=>le.id));O(se),c?.(Array.from(se))}else O(new Set),c?.(t.map(se=>se.id))},[d,X,t,c]);const te=se=>{s(se)},ce=X.length,Z=t.filter(se=>{if(!n)return!1;const le=i(se.id),z=o().find(I=>I.nodeId===se.id);return le&&(le.errorRate*100>=D||le.latency>=T)||z?.criticalPath||z&&(z.health==="critical"||z.health==="down")||e.some(I=>I.source===se.id||I.target===se.id?_t.getState().getConnectionMetrics(I.id)?.bottleneck:!1)}).length;return y.jsxs(ws,{className:"h-full border-2",children:[y.jsx(Sn,{className:"pb-3",children:y.jsxs(Cn,{className:"text-sm flex items-center gap-2",children:[y.jsx(Pb,{className:"w-4 h-4"}),"Problem Filters",ce>0&&y.jsx(ft,{variant:"destructive",className:"ml-auto",children:ce})]})}),y.jsxs(Rn,{className:"space-y-4",children:[y.jsxs("div",{className:"space-y-2",children:[y.jsx(it,{className:"text-xs",children:"Search Components"}),y.jsxs("div",{className:"relative",children:[y.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),y.jsx(kt,{placeholder:"Search by name...",value:r,onChange:se=>u(se.target.value),className:"pl-8 h-8 text-xs"})]})]}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs(it,{className:"text-xs flex items-center gap-2",children:[y.jsx(aD,{className:"w-4 h-4"}),"Show Only Problems"]}),y.jsx(po,{checked:d,onCheckedChange:h})]}),d&&y.jsxs("div",{className:"pl-6 space-y-2 border-l-2 border-border",children:[y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs(it,{className:"text-xs flex items-center gap-2",children:[y.jsx(Nb,{className:"w-4 h-4 text-red-500"}),"Bottlenecks"]}),y.jsx(po,{checked:p,onCheckedChange:g})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs(it,{className:"text-xs flex items-center gap-2",children:[y.jsx(go,{className:"w-4 h-4 text-orange-500"}),"High Error Rate (>",D,"%)"]}),y.jsx(po,{checked:v,onCheckedChange:b})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs(it,{className:"text-xs flex items-center gap-2",children:[y.jsx(zb,{className:"w-4 h-4 text-yellow-500"}),"High Latency (>",T,"ms)"]}),y.jsx(po,{checked:C,onCheckedChange:k})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs(it,{className:"text-xs flex items-center gap-2",children:[y.jsx(vo,{className:"w-4 h-4 text-purple-500"}),"Critical Paths"]}),y.jsx(po,{checked:x,onCheckedChange:R})]})]})]}),d&&y.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[y.jsxs("div",{children:[y.jsx(it,{className:"text-xs",children:"Min Latency (ms)"}),y.jsx(kt,{type:"number",value:T,onChange:se=>A(Number(se.target.value)),className:"h-8 text-xs mt-1",min:0})]}),y.jsxs("div",{children:[y.jsx(it,{className:"text-xs",children:"Min Error Rate (%)"}),y.jsx(kt,{type:"number",value:D,onChange:se=>_(Number(se.target.value)),className:"h-8 text-xs mt-1",min:0,max:100})]})]}),n&&y.jsx("div",{className:"pt-2 border-t border-border",children:y.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total problems detected: ",y.jsx("span",{className:"font-semibold text-foreground",children:Z})]})}),d&&X.length>0&&y.jsx(is,{className:"h-48 border border-border rounded p-2",children:y.jsx("div",{className:"space-y-1",children:X.map(se=>{const le=i(se.id),z=o().find(I=>I.nodeId===se.id);return y.jsx(ke,{variant:"ghost",size:"sm",className:"w-full justify-start text-xs h-auto py-1.5",onClick:()=>te(se.id),children:y.jsxs("div",{className:"flex items-center gap-2 w-full",children:[z?.criticalPath&&y.jsx(ft,{variant:"outline",className:"bg-purple-500/20 text-purple-500 border-purple-500/50 text-xs px-1",children:"Critical"}),y.jsx("span",{className:"flex-1 text-left truncate",children:se.data.label}),le&&le.errorRate*100>=D&&y.jsxs(ft,{variant:"destructive",className:"text-xs px-1",children:[(le.errorRate*100).toFixed(0),"%"]})]})},se.id)})})}),!n&&y.jsx("div",{className:"text-xs text-muted-foreground text-center py-4",children:"Start emulation to see problems"})]})]})}function yj(){const{nodes:c,connections:t}=Ee(),{isRunning:e,getComponentMetrics:s,getConnectionMetrics:n}=_t(),{getAllComponentStatuses:i,getSystemAnalysis:o}=yo(),[r,u]=S.useState(""),[d,h]=S.useState("all");if(!e)return y.jsx(ws,{className:"h-full",children:y.jsxs(Sn,{children:[y.jsx(Cn,{children:"Diagnostics"}),y.jsx(mo,{children:"Start emulation to see diagnostics"})]})});const p=[],g=i();o(),c.forEach(R=>{const C=s(R.id),k=g.find(D=>D.nodeId===R.id);if(!C||!k)return;const T={nodeId:R.id,nodeLabel:R.data.label,problem:"",severity:"info",metrics:{throughput:C.throughput,latency:C.latency,errorRate:C.errorRate,utilization:C.utilization},affectedConnections:[],recommendations:[]},A=t.filter(D=>D.source===R.id||D.target===R.id?n(D.id)?.bottleneck:!1);if(A.length>0){T.problem=`Bottleneck detected in ${A.length} connection(s)`,T.severity="critical",T.affectedConnections=A.map(D=>D.id),T.rootCause="High throughput dependency or backpressure",T.recommendations=["Consider scaling this component horizontally","Optimize data processing logic","Check for connection bandwidth limits"],p.push(T);return}if(C.errorRate>.05){T.problem=`High error rate: ${(C.errorRate*100).toFixed(1)}%`,T.severity=C.errorRate>.1?"critical":"warning",T.rootCause="Component is experiencing failures",T.recommendations=["Check component logs for error details","Verify input data format and validation","Review retry and error handling logic"],p.push(T);return}if(C.latency>1e3){T.problem=`High latency: ${C.latency.toFixed(0)}ms`,T.severity=C.latency>2e3?"critical":"warning",T.rootCause="Component processing is slow",T.recommendations=["Optimize database queries or data processing","Consider caching frequently accessed data","Review component configuration for performance"],p.push(T);return}if(C.utilization>.9){T.problem=`High utilization: ${(C.utilization*100).toFixed(0)}%`,T.severity="warning",T.rootCause="Component is near capacity",T.recommendations=["Consider scaling this component","Optimize resource usage","Monitor for potential failures"],p.push(T);return}(k.health==="critical"||k.health==="down")&&(T.problem=`Component health: ${k.health}`,T.severity="critical",T.rootCause="Component is in critical state or down",T.recommendations=["Immediately check component status","Review error logs and metrics","Consider failover or restart"],p.push(T))});const v=p.filter(R=>!(d!=="all"&&R.severity!==d||r&&!R.nodeLabel.toLowerCase().includes(r.toLowerCase()))),b=R=>{switch(R){case"critical":return y.jsx(go,{className:"w-4 h-4 text-red-500"});case"warning":return y.jsx(on,{className:"w-4 h-4 text-yellow-500"});default:return y.jsx(bo,{className:"w-4 h-4 text-blue-500"})}},x=R=>{switch(R){case"critical":return y.jsx(ft,{variant:"destructive",className:"text-xs",children:"Critical"});case"warning":return y.jsx(ft,{variant:"outline",className:"border-yellow-500 text-yellow-600 text-xs",children:"Warning"});default:return y.jsx(ft,{variant:"outline",className:"text-xs",children:"Info"})}};return y.jsxs(ws,{className:"h-full flex flex-col",children:[y.jsxs(Sn,{className:"pb-3",children:[y.jsx(Cn,{className:"text-sm font-semibold",children:"Diagnostics"}),y.jsxs(mo,{className:"text-xs text-muted-foreground",children:[v.length," problem",v.length!==1?"s":""," detected"]})]}),y.jsxs(Rn,{className:"flex-1 flex flex-col overflow-hidden p-0",children:[y.jsxs("div",{className:"p-4 border-b border-border space-y-2",children:[y.jsxs("div",{className:"relative",children:[y.jsx($r,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),y.jsx(kt,{placeholder:"Search components...",value:r,onChange:R=>u(R.target.value),className:"pl-8 h-8 text-xs"})]}),y.jsxs("div",{className:"flex gap-1",children:[y.jsx(ke,{variant:d==="all"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>h("all"),children:"All"}),y.jsx(ke,{variant:d==="critical"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>h("critical"),children:"Critical"}),y.jsx(ke,{variant:d==="warning"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>h("warning"),children:"Warning"})]})]}),y.jsx(is,{className:"flex-1",children:y.jsx("div",{className:"p-4 space-y-2",children:v.length===0?y.jsxs("div",{className:"text-center text-sm text-muted-foreground py-6",children:[y.jsx(vo,{className:"w-6 h-6 mx-auto mb-1.5 opacity-50"}),y.jsx("p",{children:"No problems detected"})]}):v.map((R,C)=>y.jsxs(ws,{className:`border-l-4 ${R.severity==="critical"?"border-l-red-500":R.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[y.jsxs(Sn,{className:"pb-2 p-3",children:[y.jsxs("div",{className:"flex items-start justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[b(R.severity),y.jsx(Cn,{className:"text-xs font-semibold",children:R.nodeLabel}),x(R.severity)]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{c.find(T=>T.id===R.nodeId)&&Ee.getState().selectNode(R.nodeId)},children:y.jsx(HA,{className:"w-3.5 h-3.5"})})]}),y.jsx(mo,{className:"text-xs mt-0.5",children:R.problem})]}),y.jsxs(Rn,{className:"pt-0 p-3 space-y-2",children:[y.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[R.metrics.throughput!==void 0&&y.jsxs("div",{children:[y.jsx("span",{className:"text-muted-foreground",children:"Throughput: "}),y.jsxs("span",{className:"font-mono",children:[R.metrics.throughput.toFixed(0)," ops/s"]})]}),R.metrics.latency!==void 0&&y.jsxs("div",{children:[y.jsx("span",{className:"text-muted-foreground",children:"Latency: "}),y.jsxs("span",{className:"font-mono",children:[R.metrics.latency.toFixed(0),"ms"]})]}),R.metrics.errorRate!==void 0&&y.jsxs("div",{children:[y.jsx("span",{className:"text-muted-foreground",children:"Error Rate: "}),y.jsxs("span",{className:"font-mono",children:[(R.metrics.errorRate*100).toFixed(1),"%"]})]}),R.metrics.utilization!==void 0&&y.jsxs("div",{children:[y.jsx("span",{className:"text-muted-foreground",children:"Utilization: "}),y.jsxs("span",{className:"font-mono",children:[(R.metrics.utilization*100).toFixed(0),"%"]})]})]}),R.rootCause&&y.jsxs("div",{children:[y.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Root Cause:"}),y.jsx("div",{className:"text-xs",children:R.rootCause})]}),R.recommendations.length>0&&y.jsxs("div",{children:[y.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Recommendations:"}),y.jsx("ul",{className:"text-xs space-y-0.5 list-disc list-inside",children:R.recommendations.map((k,T)=>y.jsx("li",{className:"text-muted-foreground",children:k},T))})]})]})]},C))})})]})]})}function vj(){const{alerts:c,acknowledgeAlert:t,clearAlerts:e,getCriticalAlerts:s,getWarningAlerts:n}=Kf(),{selectNode:i}=Ee(),o=s(),r=n();c.filter(h=>h.type==="info");const u=h=>{switch(h){case"critical":return y.jsx(go,{className:"w-4 h-4 text-red-500"});case"warning":return y.jsx(on,{className:"w-4 h-4 text-yellow-500"});default:return y.jsx(_b,{className:"w-4 h-4 text-blue-500"})}},d=h=>{i(h)};return c.length===0?y.jsxs(ws,{className:"h-full",children:[y.jsx(Sn,{children:y.jsx(Cn,{className:"text-sm",children:"Alerts"})}),y.jsx(Rn,{children:y.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[y.jsx(Jf,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),y.jsx("p",{children:"No active alerts"})]})})]}):y.jsxs(ws,{className:"h-full flex flex-col",children:[y.jsx(Sn,{className:"pb-3",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx(Cn,{className:"text-sm",children:"Alerts"}),y.jsxs("div",{className:"flex gap-2 mt-1",children:[o.length>0&&y.jsxs(ft,{variant:"destructive",className:"text-xs",children:[o.length," Critical"]}),r.length>0&&y.jsxs(ft,{variant:"outline",className:"text-xs border-yellow-500 text-yellow-600",children:[r.length," Warning"]})]})]}),y.jsx(ke,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:e,children:"Clear All"})]})}),y.jsx(Rn,{className:"flex-1 overflow-hidden p-0",children:y.jsx(is,{className:"h-full",children:y.jsx("div",{className:"p-4 space-y-2",children:c.map(h=>y.jsx(ws,{className:`border-l-4 ${h.type==="critical"?"border-l-red-500 bg-red-500/5":h.type==="warning"?"border-l-yellow-500 bg-yellow-500/5":"border-l-blue-500 bg-blue-500/5"}`,children:y.jsx(Rn,{className:"p-3",children:y.jsxs("div",{className:"flex items-start justify-between gap-2",children:[y.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[u(h.type),y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[y.jsx("h4",{className:"text-xs font-semibold",children:h.title}),y.jsx(ft,{variant:h.type==="critical"?"destructive":h.type==="warning"?"outline":"secondary",className:"text-xs",children:h.type})]}),y.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:h.message}),h.nodeLabel&&y.jsxs(ke,{variant:"ghost",size:"sm",className:"h-6 text-xs p-1",onClick:()=>h.nodeId&&d(h.nodeId),children:["View: ",h.nodeLabel]}),y.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(h.timestamp).toLocaleTimeString()})]})]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>t(h.id),children:y.jsx(an,{className:"w-3 h-3"})})]})})},h.id))})})})]})}function bj(){const{nodes:c,connections:t}=Ee(),{isRunning:e,componentMetrics:s,connectionMetrics:n}=_t(),{getSystemAnalysis:i}=yo(),{getCriticalAlerts:o,getWarningAlerts:r}=Kf(),u=S.useMemo(()=>{if(!e)return{totalThroughput:0,averageLatency:0,totalErrorRate:0,activeComponents:0,activeConnections:0,bottlenecks:0,healthyComponents:0,degradedComponents:0,criticalComponents:0};let p=0,g=0,v=0,b=0,x=0,R=0,C=0,k=0,T=0;s.forEach(L=>{(L.throughput>.1||L.errorRate>.001)&&(b++,p+=L.throughput||0,g+=L.latency||0,v+=L.errorRate||0)}),n.forEach(L=>{(L.effectiveThroughput>0||L.traffic>0)&&(x++,L.bottleneck&&R++)});const A=yo.getState();c.forEach(L=>{const O=A.getComponentStatus(L.id);if(O)switch(O.health){case"healthy":C++;break;case"degraded":k++;break;case"critical":case"down":T++;break}});const D=b>0?g/b:0,_=b>0?v/b:0;return{totalThroughput:p,averageLatency:D,totalErrorRate:_,activeComponents:b,activeConnections:x,bottlenecks:R,healthyComponents:C,degradedComponents:k,criticalComponents:T}},[e,s,n,c]),d=o(),h=r();return e?y.jsxs("div",{className:"space-y-2.5",children:[y.jsxs("div",{className:"space-y-1.5",children:[y.jsx(xn,{level:5,children:"Performance"}),y.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[y.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[y.jsx(Xe,{size:"micro",muted:!0,className:"mb-0.5",children:"Total Throughput"}),y.jsxs(ho,{status:"success",size:"base",weight:"bold",children:[u.totalThroughput.toFixed(0),y.jsx(Xe,{size:"micro",muted:!0,className:"ml-0.5",children:"ops/s"})]})]}),y.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[y.jsx(Xe,{size:"micro",muted:!0,className:"mb-0.5",children:"Avg Latency"}),y.jsxs(ho,{status:"warning",size:"base",weight:"bold",children:[u.averageLatency.toFixed(0),y.jsx(Xe,{size:"micro",muted:!0,className:"ml-0.5",children:"ms"})]})]}),y.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[y.jsx(Xe,{size:"micro",muted:!0,className:"mb-0.5",children:"Error Rate"}),y.jsxs(ho,{status:"error",size:"base",weight:"bold",children:[(u.totalErrorRate*100).toFixed(2),y.jsx(Xe,{size:"micro",muted:!0,className:"ml-0.5",children:"%"})]})]}),y.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[y.jsx(Xe,{size:"micro",muted:!0,className:"mb-0.5",children:"Bottlenecks"}),y.jsxs(ho,{status:"warning",size:"base",weight:"bold",children:[u.bottlenecks,y.jsx(Xe,{size:"micro",muted:!0,className:"ml-0.5",children:"conn"})]})]})]})]}),y.jsxs("div",{className:"space-y-1.5",children:[y.jsx(xn,{level:5,children:"Component Health"}),y.jsxs("div",{className:"space-y-0.5",children:[y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx(Jf,{className:"w-4 h-4 text-success"}),y.jsx(Xe,{size:"micro",children:"Healthy"})]}),y.jsx(ft,{variant:"outline",className:"bg-success/20 border-success/50 text-success text-xs px-1 py-0",children:u.healthyComponents})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx(on,{className:"w-4 h-4 text-warning"}),y.jsx(Xe,{size:"micro",children:"Degraded"})]}),y.jsx(ft,{variant:"outline",className:"bg-warning/20 border-warning/50 text-warning text-xs px-1 py-0",children:u.degradedComponents})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx(on,{className:"w-4 h-4 text-destructive"}),y.jsx(Xe,{size:"micro",children:"Critical/Down"})]}),y.jsx(ft,{variant:"outline",className:"bg-destructive/20 border-destructive/50 text-destructive text-xs px-1 py-0",children:u.criticalComponents})]})]})]}),y.jsxs("div",{className:"space-y-1.5",children:[y.jsx(xn,{level:5,children:"Activity"}),y.jsxs("div",{className:"space-y-0.5",children:[y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx(xD,{className:"w-4 h-4 text-muted-foreground"}),y.jsx(Xe,{size:"micro",children:"Active Components"})]}),y.jsxs(Xe,{mono:!0,size:"micro",children:[u.activeComponents," / ",c.length]})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx(zb,{className:"w-4 h-4 text-muted-foreground"}),y.jsx(Xe,{size:"micro",children:"Active Connections"})]}),y.jsxs(Xe,{mono:!0,size:"micro",children:[u.activeConnections," / ",t.length]})]})]})]}),(d.length>0||h.length>0)&&y.jsxs("div",{className:"space-y-1.5",children:[y.jsx(xn,{level:5,children:"Alerts"}),y.jsxs("div",{className:"space-y-0.5",children:[d.length>0&&y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsx(ho,{status:"error",size:"micro",children:"Critical"}),y.jsx(ft,{variant:"destructive",className:"text-xs px-1 py-0",children:d.length})]}),h.length>0&&y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsx(ho,{status:"warning",size:"micro",children:"Warnings"}),y.jsx(ft,{variant:"outline",className:"border-warning text-warning text-xs px-1 py-0",children:h.length})]})]})]})]}):y.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[y.jsx(vo,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),y.jsx("p",{children:"Start emulation to see system statistics"})]})}const xl=43200,Hv=1440,$v=Symbol.for("constructDateFrom");function $p(c,t){return typeof c=="function"?c(t):c&&typeof c=="object"&&$v in c?c[$v](t):c instanceof Date?new c.constructor(t):new Date(t)}function qi(c,t){return $p(c,c)}let wj={};function xj(){return wj}function Bv(c){const t=qi(c),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+c-+e}function Bp(c,...t){const e=$p.bind(null,c||t.find(s=>typeof s=="object"));return t.map(e)}function Il(c,t){const e=+qi(c)-+qi(t);return e<0?-1:e>0?1:e}function Mj(c){return $p(c,Date.now())}function Sj(c,t,e){const[s,n]=Bp(e?.in,c,t),i=s.getFullYear()-n.getFullYear(),o=s.getMonth()-n.getMonth();return i*12+o}function Cj(c){return t=>{const s=(c?Math[c]:Math.trunc)(t);return s===0?0:s}}function Rj(c,t){return+qi(c)-+qi(t)}function Ej(c,t){const e=qi(c);return e.setHours(23,59,59,999),e}function Tj(c,t){const e=qi(c),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function kj(c,t){const e=qi(c);return+Ej(e)==+Tj(e)}function Aj(c,t,e){const[s,n,i]=Bp(e?.in,c,c,t),o=Il(n,i),r=Math.abs(Sj(n,i));if(r<1)return 0;n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-o*r);let u=Il(n,i)===-o;kj(s)&&r===1&&Il(s,i)===1&&(u=!1);const d=o*(r-+u);return d===0?0:d}function Dj(c,t,e){const s=Rj(c,t)/1e3;return Cj(e?.roundingMethod)(s)}const Pj={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},_j=(c,t,e)=>{let s;const n=Pj[c];return typeof n=="string"?s=n:t===1?s=n.one:s=n.other.replace("{{count}}",t.toString()),e?.addSuffix?e.comparison&&e.comparison>0?"in "+s:s+" ago":s};function gf(c){return(t={})=>{const e=t.width?String(t.width):c.defaultWidth;return c.formats[e]||c.formats[c.defaultWidth]}}const Lj={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ij={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Nj={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},zj={date:gf({formats:Lj,defaultWidth:"full"}),time:gf({formats:Ij,defaultWidth:"full"}),dateTime:gf({formats:Nj,defaultWidth:"full"})},jj={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Oj=(c,t,e,s)=>jj[c];function Rr(c){return(t,e)=>{const s=e?.context?String(e.context):"standalone";let n;if(s==="formatting"&&c.formattingValues){const o=c.defaultFormattingWidth||c.defaultWidth,r=e?.width?String(e.width):o;n=c.formattingValues[r]||c.formattingValues[o]}else{const o=c.defaultWidth,r=e?.width?String(e.width):c.defaultWidth;n=c.values[r]||c.values[o]}const i=c.argumentCallback?c.argumentCallback(t):t;return n[i]}}const qj={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Hj={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},$j={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Bj={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Uj={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Fj={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Qj=(c,t)=>{const e=Number(c),s=e%100;if(s>20||s<10)switch(s%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"},Vj={ordinalNumber:Qj,era:Rr({values:qj,defaultWidth:"wide"}),quarter:Rr({values:Hj,defaultWidth:"wide",argumentCallback:c=>c-1}),month:Rr({values:$j,defaultWidth:"wide"}),day:Rr({values:Bj,defaultWidth:"wide"}),dayPeriod:Rr({values:Uj,defaultWidth:"wide",formattingValues:Fj,defaultFormattingWidth:"wide"})};function Er(c){return(t,e={})=>{const s=e.width,n=s&&c.matchPatterns[s]||c.matchPatterns[c.defaultMatchWidth],i=t.match(n);if(!i)return null;const o=i[0],r=s&&c.parsePatterns[s]||c.parsePatterns[c.defaultParseWidth],u=Array.isArray(r)?Wj(r,p=>p.test(o)):Gj(r,p=>p.test(o));let d;d=c.valueCallback?c.valueCallback(u):u,d=e.valueCallback?e.valueCallback(d):d;const h=t.slice(o.length);return{value:d,rest:h}}}function Gj(c,t){for(const e in c)if(Object.prototype.hasOwnProperty.call(c,e)&&t(c[e]))return e}function Wj(c,t){for(let e=0;e<c.length;e++)if(t(c[e]))return e}function Kj(c){return(t,e={})=>{const s=t.match(c.matchPattern);if(!s)return null;const n=s[0],i=t.match(c.parsePattern);if(!i)return null;let o=c.valueCallback?c.valueCallback(i[0]):i[0];o=e.valueCallback?e.valueCallback(o):o;const r=t.slice(n.length);return{value:o,rest:r}}}const Yj=/^(\d+)(th|st|nd|rd)?/i,Xj=/\d+/i,Jj={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Zj={any:[/^b/i,/^(a|c)/i]},eO={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},tO={any:[/1/i,/2/i,/3/i,/4/i]},sO={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},nO={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},iO={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},oO={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},aO={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},rO={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},cO={ordinalNumber:Kj({matchPattern:Yj,parsePattern:Xj,valueCallback:c=>parseInt(c,10)}),era:Er({matchPatterns:Jj,defaultMatchWidth:"wide",parsePatterns:Zj,defaultParseWidth:"any"}),quarter:Er({matchPatterns:eO,defaultMatchWidth:"wide",parsePatterns:tO,defaultParseWidth:"any",valueCallback:c=>c+1}),month:Er({matchPatterns:sO,defaultMatchWidth:"wide",parsePatterns:nO,defaultParseWidth:"any"}),day:Er({matchPatterns:iO,defaultMatchWidth:"wide",parsePatterns:oO,defaultParseWidth:"any"}),dayPeriod:Er({matchPatterns:aO,defaultMatchWidth:"any",parsePatterns:rO,defaultParseWidth:"any"})},lO={code:"en-US",formatDistance:_j,formatLong:zj,formatRelative:Oj,localize:Vj,match:cO,options:{weekStartsOn:0,firstWeekContainsDate:1}};function uO(c,t,e){const s=xj(),n=e?.locale??s.locale??lO,i=2520,o=Il(c,t);if(isNaN(o))throw new RangeError("Invalid time value");const r=Object.assign({},e,{addSuffix:e?.addSuffix,comparison:o}),[u,d]=Bp(e?.in,...o>0?[t,c]:[c,t]),h=Dj(d,u),p=(Bv(d)-Bv(u))/1e3,g=Math.round((h-p)/60);let v;if(g<2)return e?.includeSeconds?h<5?n.formatDistance("lessThanXSeconds",5,r):h<10?n.formatDistance("lessThanXSeconds",10,r):h<20?n.formatDistance("lessThanXSeconds",20,r):h<40?n.formatDistance("halfAMinute",0,r):h<60?n.formatDistance("lessThanXMinutes",1,r):n.formatDistance("xMinutes",1,r):g===0?n.formatDistance("lessThanXMinutes",1,r):n.formatDistance("xMinutes",g,r);if(g<45)return n.formatDistance("xMinutes",g,r);if(g<90)return n.formatDistance("aboutXHours",1,r);if(g<Hv){const b=Math.round(g/60);return n.formatDistance("aboutXHours",b,r)}else{if(g<i)return n.formatDistance("xDays",1,r);if(g<xl){const b=Math.round(g/Hv);return n.formatDistance("xDays",b,r)}else if(g<xl*2)return v=Math.round(g/xl),n.formatDistance("aboutXMonths",v,r)}if(v=Aj(d,u),v<12){const b=Math.round(g/xl);return n.formatDistance("xMonths",b,r)}else{const b=v%12,x=Math.trunc(v/12);return b<3?n.formatDistance("aboutXYears",x,r):b<9?n.formatDistance("overXYears",x,r):n.formatDistance("almostXYears",x+1,r)}}function dO(c,t){return uO(c,Mj(c),t)}function hO(){const{errors:c,updateErrors:t,clearErrors:e,removeError:s,getErrorCount:n,getStats:i}=Tb(),{nodes:o}=Ee(),[r,u]=S.useState("all"),[d,h]=S.useState("all"),[p,g]=S.useState("all"),[v,b]=S.useState("");S.useEffect(()=>{t();const _=setInterval(()=>{t()},1e3);return()=>clearInterval(_)},[t]);const x=i(),R=S.useMemo(()=>{let _=c;if(r!=="all"&&(_=_.filter(L=>L.severity===r)),d!=="all"&&(_=_.filter(L=>L.source===d)),p!=="all"&&(_=_.filter(L=>L.componentId===p)),v){const L=v.toLowerCase();_=_.filter(O=>O.message.toLowerCase().includes(L)||O.componentLabel?.toLowerCase().includes(L)||O.componentType?.toLowerCase().includes(L)||O.errorType?.toLowerCase().includes(L))}return _},[c,r,d,p,v]),C=S.useMemo(()=>{const _=new Map;return c.forEach(L=>{L.componentId&&L.componentLabel&&_.set(L.componentId,{id:L.componentId,label:L.componentLabel,type:L.componentType||"unknown"})}),Array.from(_.values())},[c]),k=_=>{switch(_){case"critical":return y.jsx(FA,{className:"h-3 w-3 text-red-500"});case"warning":return y.jsx(on,{className:"h-3 w-3 text-yellow-500"});case"info":return y.jsx(_b,{className:"h-3 w-3 text-blue-500"})}},T=_=>{switch(_){case"critical":return y.jsx(ft,{variant:"destructive",className:"text-[9px] px-1 py-0 h-4",children:"Critical"});case"warning":return y.jsx(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-yellow-500/10 text-yellow-600 border-yellow-500",children:"Warning"});case"info":return y.jsx(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4 bg-blue-500/10 text-blue-600 border-blue-500",children:"Info"})}},A=_=>{const L={"emulation-engine":"bg-purple-500/10 text-purple-600 border-purple-500","component-engine":"bg-green-500/10 text-green-600 border-green-500","alert-system":"bg-orange-500/10 text-orange-600 border-orange-500","data-flow":"bg-cyan-500/10 text-cyan-600 border-cyan-500","routing-engine":"bg-pink-500/10 text-pink-600 border-pink-500",initialization:"bg-indigo-500/10 text-indigo-600 border-indigo-500",configuration:"bg-gray-500/10 text-gray-600 border-gray-500",unknown:"bg-gray-500/10 text-gray-600 border-gray-500"},O={"emulation-engine":"Engine","component-engine":"Component","alert-system":"Alert","data-flow":"DataFlow","routing-engine":"Routing",initialization:"Init",configuration:"Config",unknown:"Unknown"};return y.jsx(ft,{variant:"outline",className:`text-[9px] px-1 py-0 h-4 ${L[_]||L.unknown}`,children:O[_]||O.unknown})},D=_=>{try{return dO(new Date(_),{addSuffix:!0})}catch{return"unknown time"}};return y.jsxs("div",{className:"h-full flex flex-col",children:[y.jsxs("div",{className:"p-2 border-b border-border",children:[y.jsxs("div",{className:"flex items-center justify-between mb-2",children:[y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx(bo,{className:"h-4 w-4 text-muted-foreground"}),y.jsx("h3",{className:"text-sm font-semibold",children:"Simulation Errors"})]}),c.length>0&&y.jsxs(ke,{variant:"ghost",size:"sm",onClick:e,className:"h-6 text-xs",children:[y.jsx(Zl,{className:"h-3 w-3 mr-1"}),"Clear All"]})]}),y.jsxs("div",{className:"flex gap-2 text-xs",children:[y.jsxs(ft,{variant:"outline",className:"text-xs",children:["Total: ",x.total]}),x.critical>0&&y.jsxs(ft,{variant:"destructive",className:"text-xs",children:["Critical: ",x.critical]}),x.warning>0&&y.jsxs(ft,{variant:"outline",className:"text-xs bg-yellow-500/10 text-yellow-600 border-yellow-500",children:["Warning: ",x.warning]}),x.info>0&&y.jsxs(ft,{variant:"outline",className:"text-xs bg-blue-500/10 text-blue-600 border-blue-500",children:["Info: ",x.info]})]})]}),y.jsxs("div",{className:"p-2 border-b border-border space-y-2",children:[y.jsxs("div",{className:"relative",children:[y.jsx($r,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-muted-foreground"}),y.jsx(kt,{placeholder:"Search errors...",value:v,onChange:_=>b(_.target.value),className:"h-7 pl-7 text-xs"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[y.jsxs(_l,{value:r,onValueChange:_=>u(_),children:[y.jsx(Dr,{className:"h-7 text-xs",children:y.jsx(Ll,{placeholder:"Severity"})}),y.jsxs(Pr,{children:[y.jsx(Qt,{value:"all",children:"All Severities"}),y.jsx(Qt,{value:"critical",children:"Critical"}),y.jsx(Qt,{value:"warning",children:"Warning"}),y.jsx(Qt,{value:"info",children:"Info"})]})]}),y.jsxs(_l,{value:d,onValueChange:_=>h(_),children:[y.jsx(Dr,{className:"h-7 text-xs",children:y.jsx(Ll,{placeholder:"Source"})}),y.jsxs(Pr,{children:[y.jsx(Qt,{value:"all",children:"All Sources"}),y.jsx(Qt,{value:"emulation-engine",children:"Emulation Engine"}),y.jsx(Qt,{value:"component-engine",children:"Component Engine"}),y.jsx(Qt,{value:"alert-system",children:"Alert System"}),y.jsx(Qt,{value:"data-flow",children:"Data Flow"}),y.jsx(Qt,{value:"routing-engine",children:"Routing Engine"}),y.jsx(Qt,{value:"initialization",children:"Initialization"}),y.jsx(Qt,{value:"configuration",children:"Configuration"})]})]})]}),C.length>0&&y.jsxs(_l,{value:p,onValueChange:g,children:[y.jsx(Dr,{className:"h-7 text-xs",children:y.jsx(Ll,{placeholder:"Component"})}),y.jsxs(Pr,{children:[y.jsx(Qt,{value:"all",children:"All Components"}),C.map(_=>y.jsxs(Qt,{value:_.id,children:[_.label," (",_.type,")"]},_.id))]})]})]}),y.jsx(is,{className:"flex-1",children:y.jsx("div",{className:"p-1.5 space-y-1.5",children:R.length===0?y.jsx("div",{className:"text-center text-sm text-muted-foreground py-8",children:c.length===0?y.jsxs("div",{className:"flex flex-col items-center gap-2",children:[y.jsx(bo,{className:"h-8 w-8 opacity-50"}),y.jsx("p",{children:"No errors detected"})]}):y.jsxs("div",{className:"flex flex-col items-center gap-2",children:[y.jsx(Pb,{className:"h-8 w-8 opacity-50"}),y.jsx("p",{children:"No errors match the filters"})]})}):R.map(_=>y.jsxs(ws,{className:`border-l-2 ${_.severity==="critical"?"border-l-red-500":_.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[y.jsx(Sn,{className:"pb-1 p-1.5",children:y.jsxs("div",{className:"flex items-start justify-between gap-1",children:[y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsxs("div",{className:"flex items-center gap-1 mb-0.5 flex-wrap",children:[y.jsx("span",{className:"flex-shrink-0",children:k(_.severity)}),y.jsx(Cn,{className:"text-[11px] font-semibold truncate",children:_.componentLabel||"System"}),y.jsx("span",{className:"flex-shrink-0",children:T(_.severity)}),y.jsx("span",{className:"flex-shrink-0",children:A(_.source)}),_.count&&_.count>1&&y.jsxs(ft,{variant:"outline",className:"text-[9px] px-1 py-0 h-4",children:[_.count,"x"]})]}),y.jsx(mo,{className:"text-[10px] mt-0.5 break-words line-clamp-2",children:_.message}),y.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[9px] text-muted-foreground",children:[y.jsx("span",{children:D(_.timestamp)}),_.componentType&&y.jsxs("span",{className:"truncate",children:[" ",_.componentType]}),_.errorType&&y.jsxs("span",{className:"truncate",children:[" ",_.errorType]})]})]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5 flex-shrink-0",onClick:()=>s(_.id),children:y.jsx(an,{className:"h-3 w-3"})})]})}),_.context&&Object.keys(_.context).length>0||_.stack?y.jsxs(Rn,{className:"pt-0 p-1.5 space-y-1",children:[_.context&&Object.keys(_.context).length>0&&y.jsxs("details",{className:"text-[9px]",children:[y.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Context"}),y.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:JSON.stringify(_.context,null,2)})]}),_.stack&&y.jsxs("details",{className:"text-[9px]",children:[y.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground py-0.5",children:"Stack"}),y.jsx("pre",{className:"mt-0.5 p-1 bg-muted rounded text-[8px] overflow-x-auto max-h-20",children:_.stack})]})]}):null]},_.id))})})]})}var Lu="Checkbox",[fO]=xs(Lu),[pO,Up]=fO(Lu);function gO(c){const{__scopeCheckbox:t,checked:e,children:s,defaultChecked:n,disabled:i,form:o,name:r,onCheckedChange:u,required:d,value:h="on",internal_do_not_use_render:p}=c,[g,v]=En({prop:e,defaultProp:n??!1,onChange:u,caller:Lu}),[b,x]=S.useState(null),[R,C]=S.useState(null),k=S.useRef(!1),T=b?!!o||!!b.closest("form"):!0,A={checked:g,disabled:i,setChecked:v,control:b,setControl:x,name:r,form:o,value:h,hasConsumerStoppedPropagationRef:k,required:d,defaultChecked:zi(n)?!1:n,isFormControl:T,bubbleInput:R,setBubbleInput:C};return y.jsx(pO,{scope:t,...A,children:mO(p)?p(A):s})}var sC="CheckboxTrigger",nC=S.forwardRef(({__scopeCheckbox:c,onKeyDown:t,onClick:e,...s},n)=>{const{control:i,value:o,disabled:r,checked:u,required:d,setControl:h,setChecked:p,hasConsumerStoppedPropagationRef:g,isFormControl:v,bubbleInput:b}=Up(sC,c),x=Le(n,h),R=S.useRef(u);return S.useEffect(()=>{const C=i?.form;if(C){const k=()=>p(R.current);return C.addEventListener("reset",k),()=>C.removeEventListener("reset",k)}},[i,p]),y.jsx(De.button,{type:"button",role:"checkbox","aria-checked":zi(u)?"mixed":u,"aria-required":d,"data-state":cC(u),"data-disabled":r?"":void 0,disabled:r,value:o,...s,ref:x,onKeyDown:ge(t,C=>{C.key==="Enter"&&C.preventDefault()}),onClick:ge(e,C=>{p(k=>zi(k)?!0:!k),b&&v&&(g.current=C.isPropagationStopped(),g.current||C.stopPropagation())})})});nC.displayName=sC;var Fp=S.forwardRef((c,t)=>{const{__scopeCheckbox:e,name:s,checked:n,defaultChecked:i,required:o,disabled:r,value:u,onCheckedChange:d,form:h,...p}=c;return y.jsx(gO,{__scopeCheckbox:e,checked:n,defaultChecked:i,disabled:r,required:o,onCheckedChange:d,name:s,form:h,value:u,internal_do_not_use_render:({isFormControl:g})=>y.jsxs(y.Fragment,{children:[y.jsx(nC,{...p,ref:t,__scopeCheckbox:e}),g&&y.jsx(rC,{__scopeCheckbox:e})]})})});Fp.displayName=Lu;var iC="CheckboxIndicator",oC=S.forwardRef((c,t)=>{const{__scopeCheckbox:e,forceMount:s,...n}=c,i=Up(iC,e);return y.jsx(ls,{present:s||zi(i.checked)||i.checked===!0,children:y.jsx(De.span,{"data-state":cC(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:t,style:{pointerEvents:"none",...c.style}})})});oC.displayName=iC;var aC="CheckboxBubbleInput",rC=S.forwardRef(({__scopeCheckbox:c,...t},e)=>{const{control:s,hasConsumerStoppedPropagationRef:n,checked:i,defaultChecked:o,required:r,disabled:u,name:d,value:h,form:p,bubbleInput:g,setBubbleInput:v}=Up(aC,c),b=Le(e,v),x=Eu(i),R=wu(s);S.useEffect(()=>{const k=g;if(!k)return;const T=window.HTMLInputElement.prototype,D=Object.getOwnPropertyDescriptor(T,"checked").set,_=!n.current;if(x!==i&&D){const L=new Event("click",{bubbles:_});k.indeterminate=zi(i),D.call(k,zi(i)?!1:i),k.dispatchEvent(L)}},[g,x,i,n]);const C=S.useRef(zi(i)?!1:i);return y.jsx(De.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??C.current,required:r,disabled:u,name:d,value:h,form:p,...t,tabIndex:-1,ref:b,style:{...t.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});rC.displayName=aC;function mO(c){return typeof c=="function"}function zi(c){return c==="indeterminate"}function cC(c){return zi(c)?"indeterminate":c?"checked":"unchecked"}const Of=S.forwardRef(({className:c,...t},e)=>y.jsx(Fp,{ref:e,className:Te("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",c),...t,children:y.jsx(oC,{className:Te("grid place-content-center text-current"),children:y.jsx(Yf,{className:"h-4 w-4"})})}));Of.displayName=Fp.displayName;function lC({open:c,groupName:t,onConfirm:e,onCancel:s}){return y.jsx(Gw,{open:c,onOpenChange:n=>!n&&s(),children:y.jsxs(dp,{children:[y.jsxs(Kw,{children:[y.jsx(hp,{children:"Delete Group?"}),y.jsxs(fp,{children:['Are you sure you want to delete the group "',t,'"? This action cannot be undone.']})]}),y.jsxs(Yw,{children:[y.jsx(gp,{onClick:s,children:"Cancel"}),y.jsx(pp,{onClick:e,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}function yO({group:c}){const{nodes:t,updateGroup:e,deleteGroup:s,removeNodeFromGroup:n,addNodeToGroup:i,selectGroup:o}=Ee(),[r,u]=S.useState(!1),[d,h]=S.useState(!1),[p,g]=S.useState(!1),[v,b]=S.useState(new Set),x=A=>{e(c.id,{name:A}),Ye.success("Group renamed"),h(!1)},R=()=>{u(!0)},C=()=>{s(c.id),o(null),Ye.success("Group deleted"),u(!1)},k=A=>{n(c.id,A),Ye.success("Component removed from group")},T=t.filter(A=>c.nodeIds.includes(A.id));return y.jsxs("div",{className:"space-y-2.5",children:[y.jsxs("div",{children:[y.jsx(it,{htmlFor:"group-name",className:"text-xs font-medium",children:"Group Name"}),y.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[y.jsx(kt,{id:"group-name",value:c.name,onChange:A=>e(c.id,{name:A.target.value}),className:"flex-1 h-8 text-xs"}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:R,children:y.jsx(Zl,{className:"h-3.5 w-3.5 text-destructive"})})]})]}),y.jsx(lC,{open:r,groupName:c.name,onConfirm:C,onCancel:()=>u(!1)}),y.jsx(yp,{open:d,initialName:c.name,onConfirm:x,onCancel:()=>h(!1)}),y.jsx(bs,{}),y.jsxs("div",{className:"flex items-center space-x-2",children:[y.jsx(Of,{id:"show-name",checked:c.showName!==!1,onCheckedChange:A=>e(c.id,{showName:A!==!1})}),y.jsx(it,{htmlFor:"show-name",className:"text-xs font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show name on canvas"})]}),y.jsx(bs,{}),y.jsxs("div",{children:[y.jsx(it,{className:"text-xs font-medium mb-1.5 block",children:"Color"}),y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("input",{type:"color",value:c.color||"#3b82f6",onChange:A=>e(c.id,{color:A.target.value}),className:"w-10 h-8 rounded border border-border cursor-pointer"}),y.jsx(kt,{value:c.color||"#3b82f6",onChange:A=>e(c.id,{color:A.target.value}),className:"flex-1 font-mono text-xs h-8",placeholder:"#3b82f6"})]})]}),y.jsx(bs,{}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[y.jsxs(it,{className:"text-xs font-medium",children:["Components (",c.nodeIds.length,")"]}),y.jsxs(ke,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{if(Ee.getState().nodes.filter(_=>!c.nodeIds.includes(_.id)).length===0){Ye.info("All components are already in this group");return}b(new Set),g(!0)},children:[y.jsx(ql,{className:"h-3 w-3 mr-1"}),"Add"]})]}),y.jsxs("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[T.map(A=>y.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-secondary/50 rounded border border-border",children:[y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx("div",{className:"text-xs font-medium truncate",children:A.data?.label||A.type}),y.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:A.type})]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>k(A.id),title:"Remove from group",children:y.jsx(an,{className:"h-3 w-3"})})]},A.id)),T.length===0&&y.jsx("div",{className:"text-xs text-muted-foreground text-center py-3",children:"No components in group"})]})]}),y.jsx(bs,{}),y.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[y.jsx("span",{children:"Group ID:"}),y.jsx("code",{className:"font-mono bg-secondary/50 px-1.5 py-0.5 rounded text-[10px]",children:c.id})]}),y.jsx(mp,{open:p,onOpenChange:g,children:y.jsxs(ru,{className:"max-w-md",children:[y.jsxs(cu,{children:[y.jsx(uu,{children:"Add Components to Group"}),y.jsxs(du,{children:['Select components to add to "',c.name,'"']})]}),y.jsx(is,{className:"max-h-96",children:y.jsxs("div",{className:"space-y-2 py-2",children:[t.filter(A=>!c.nodeIds.includes(A.id)).map(A=>y.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border border-border hover:bg-secondary/50 cursor-pointer",onClick:()=>{const D=new Set(v);D.has(A.id)?D.delete(A.id):D.add(A.id),b(D)},children:[y.jsx(Of,{checked:v.has(A.id),onCheckedChange:D=>{const _=new Set(v);D?_.add(A.id):_.delete(A.id),b(_)}}),y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx("div",{className:"text-sm font-medium truncate",children:A.data?.label||A.type}),y.jsx("div",{className:"text-xs text-muted-foreground truncate",children:A.type})]})]},A.id)),t.filter(A=>!c.nodeIds.includes(A.id)).length===0&&y.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"All components are already in this group"})]})}),y.jsxs(lu,{children:[y.jsx(ke,{variant:"outline",onClick:()=>{g(!1),b(new Set)},children:"Cancel"}),y.jsxs(ke,{onClick:()=>{if(v.size===0){Ye.error("Select at least one component");return}v.forEach(A=>{i(c.id,A)}),Ye.success(`${v.size} component(s) added to group`),g(!1),b(new Set)},children:["Add Selected (",v.size,")"]})]})]})})]})}function vO(){const{selectedNodeId:c,nodes:t,updateNode:e,selectNode:s,connections:n,updateConnection:i,selectedConnectionId:o,selectConnection:r,selectedGroupId:u,groups:d,selectGroup:h}=Ee(),{addTab:p}=Ru(),g=t.find(x=>x.id===c),v=n.find(x=>x.id===o),b=d.find(x=>x.id===u);return b?y.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[y.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(nf,{className:"h-3 w-3 text-muted-foreground"}),y.jsx(ti,{children:"Group Properties"})]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>h(null),children:y.jsx(an,{className:"h-3 w-3"})})]}),y.jsx(is,{className:"flex-1",children:y.jsx("div",{className:"p-1.5",children:y.jsx(yO,{group:b})})})]}):!g&&!v?y.jsx("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:y.jsxs(bp,{defaultValue:"stats",className:"h-full flex flex-col",children:[y.jsx("div",{className:"p-1 border-b border-border",children:y.jsxs(gu,{className:"grid w-full grid-cols-6 h-6 gap-0.5 p-0.5",children:[y.jsx(sn,{value:"stats",className:"text-xs px-1 py-0.5",children:"Stats"}),y.jsx(sn,{value:"diagnostics",className:"text-xs px-1 py-0.5",children:"Diag"}),y.jsx(sn,{value:"alerts",className:"text-xs px-1 py-0.5",children:"Alerts"}),y.jsx(sn,{value:"errors",className:"text-xs px-1 py-0.5",children:"Errors"}),y.jsx(sn,{value:"filters",className:"text-xs px-1 py-0.5",children:"Filter"}),y.jsx(sn,{value:"properties",className:"text-xs px-1 py-0.5",children:"Groups"})]})}),y.jsx(si,{value:"stats",className:"flex-1 m-0 p-0 overflow-hidden",children:y.jsx(is,{className:"h-full",children:y.jsx("div",{className:"p-1.5",children:y.jsx(bj,{})})})}),y.jsx(si,{value:"diagnostics",className:"flex-1 m-0 p-0 overflow-hidden",children:y.jsx(yj,{})}),y.jsx(si,{value:"alerts",className:"flex-1 m-0 p-0 overflow-hidden",children:y.jsx(vj,{})}),y.jsx(si,{value:"errors",className:"flex-1 m-0 p-0 overflow-hidden",children:y.jsx(hO,{})}),y.jsx(si,{value:"filters",className:"flex-1 m-0 p-0 overflow-hidden",children:y.jsx(is,{className:"h-full",children:y.jsx("div",{className:"p-1.5",children:y.jsx(mj,{})})})}),y.jsx(si,{value:"properties",className:"flex-1 m-0 p-0 overflow-hidden",children:y.jsx(is,{className:"h-full",children:y.jsx("div",{className:"p-1.5 space-y-1.5",children:y.jsxs("div",{children:[y.jsxs(ti,{as:"h4",className:"mb-1",children:["Groups (",d.length,")"]}),d.length>0?y.jsx("div",{className:"space-y-1",children:d.map(x=>y.jsx("div",{className:"p-1.5 bg-secondary/50 rounded border border-border cursor-pointer hover:bg-secondary transition-colors",onClick:()=>h(x.id),children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx(Xe,{size:"small",className:"font-medium truncate",children:x.name}),y.jsxs(Xe,{size:"micro",muted:!0,children:[x.nodeIds.length," component",x.nodeIds.length!==1?"s":""]})]}),y.jsx("div",{className:"w-2.5 h-2.5 rounded border-2 border-border flex-shrink-0 ml-1",style:{backgroundColor:x.color||"hsl(var(--primary))"}})]})},x.id))}):y.jsx(Xe,{size:"micro",muted:!0,className:"text-center py-2",children:"No groups created yet"})]})})})})]})}):v?y.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[y.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(nf,{className:"h-3 w-3 text-muted-foreground"}),y.jsx(ti,{children:"Connection"})]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>r(null),children:y.jsx(an,{className:"h-3 w-3"})})]}),y.jsx(is,{className:"flex-1",children:y.jsx("div",{className:"p-1.5",children:y.jsx(Gz,{connection:v,onUpdate:(x,R)=>i(x,R)})})})]}):y.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[y.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(nf,{className:"h-3 w-3 text-muted-foreground"}),y.jsx(ti,{children:"Properties"})]}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>s(null),children:y.jsx(an,{className:"h-3 w-3"})})]}),y.jsx(is,{className:"flex-1",children:y.jsxs("div",{className:"p-1.5 space-y-1.5",children:[y.jsx(gj,{componentId:g.id,componentLabel:g.data.label}),y.jsx(bs,{}),y.jsxs("div",{children:[y.jsx(it,{htmlFor:"label",className:"text-xs font-medium",children:"Label"}),y.jsx(kt,{id:"label",value:g.data.label,onChange:x=>e(g.id,{data:{...g.data,label:x.target.value}}),className:"mt-0.5 h-7 text-xs"})]}),y.jsx(bs,{}),y.jsxs("div",{children:[y.jsx(ti,{as:"h4",className:"mb-1",children:"Position"}),y.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[y.jsxs("div",{children:[y.jsx(it,{htmlFor:"pos-x",className:"text-xs text-muted-foreground",children:"X"}),y.jsx(kt,{id:"pos-x",type:"number",value:Math.round(g.position.x),onChange:x=>e(g.id,{position:{...g.position,x:parseInt(x.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]}),y.jsxs("div",{children:[y.jsx(it,{htmlFor:"pos-y",className:"text-xs text-muted-foreground",children:"Y"}),y.jsx(kt,{id:"pos-y",type:"number",value:Math.round(g.position.y),onChange:x=>e(g.id,{position:{...g.position,y:parseInt(x.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]})]})]}),y.jsx(bs,{}),y.jsxs("div",{children:[y.jsx(ti,{as:"h4",className:"mb-1",children:"Component Type"}),y.jsx("div",{className:"bg-secondary/50 rounded-md p-1.5 border border-border",children:y.jsx(Xe,{mono:!0,size:"small",children:g.type})})]}),y.jsx(bs,{}),y.jsxs("div",{children:[y.jsx(ti,{as:"h4",className:"mb-1",children:"Configuration"}),y.jsx(ke,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:()=>{p({title:`${g.data.label} Config`,type:"component",componentId:g.id,componentType:g.type})},children:"Open Configuration Panel"})]})]})})]})}function bO(){const{tabs:c,setActiveTab:t,closeTab:e,addTab:s}=Ru(),n=()=>{s({title:"Untitled Diagram",type:"diagram"})};return y.jsx("div",{className:"h-10 bg-secondary/30 border-b border-border flex items-center",children:y.jsxs(is,{className:"flex-1",children:[y.jsxs("div",{className:"flex items-center",children:[c.map(i=>y.jsxs("div",{className:`
                flex items-center gap-2 px-4 h-10 border-r border-border cursor-pointer group
                transition-colors
                ${i.active?"bg-canvas-bg text-foreground":"text-muted-foreground hover:bg-secondary/50"}
              `,onClick:()=>t(i.id),children:[y.jsx("span",{className:"text-sm",children:i.title}),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:bg-destructive/10",onClick:o=>{o.stopPropagation(),e(i.id)},children:y.jsx(an,{className:"h-3 w-3"})})]},i.id)),y.jsx(ke,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:n,children:y.jsx(ql,{className:"h-4 w-4"})})]}),y.jsx(su,{orientation:"horizontal"})]})})}const Uv=c=>Symbol.iterator in c,Fv=c=>"entries"in c,Qv=(c,t)=>{const e=c instanceof Map?c:new Map(c.entries()),s=t instanceof Map?t:new Map(t.entries());if(e.size!==s.size)return!1;for(const[n,i]of e)if(!s.has(n)||!Object.is(i,s.get(n)))return!1;return!0},wO=(c,t)=>{const e=c[Symbol.iterator](),s=t[Symbol.iterator]();let n=e.next(),i=s.next();for(;!n.done&&!i.done;){if(!Object.is(n.value,i.value))return!1;n=e.next(),i=s.next()}return!!n.done&&!!i.done};function xO(c,t){return Object.is(c,t)?!0:typeof c!="object"||c===null||typeof t!="object"||t===null||Object.getPrototypeOf(c)!==Object.getPrototypeOf(t)?!1:Uv(c)&&Uv(t)?Fv(c)&&Fv(t)?Qv(c,t):wO(c,t):Qv({entries:()=>Object.entries(c)},{entries:()=>Object.entries(t)})}function uC(c){const t=Tt.useRef(void 0);return e=>{const s=c(e);return xO(t.current,s)?t.current:t.current=s}}const Vv=globalThis;function Ml(c){try{if(typeof Vv.structuredClone=="function")return Vv.structuredClone(c)}catch{}return JSON.parse(JSON.stringify(c))}function Sa(c,t,e=140,s=100,n=16){const i=[],o=e/2,r=s/2,u=c+o,d=t+r;for(let h=0;h<n;h++){const p=h/n*2*Math.PI-Math.PI/2;let g,v;const b=(p%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(b>=0&&b<Math.PI/2){const x=b/(Math.PI/2);g=u+o,v=d-r+x*s}else if(b>=Math.PI/2&&b<Math.PI){const x=(b-Math.PI/2)/(Math.PI/2);g=u+o-x*e,v=d+r}else if(b>=Math.PI&&b<3*Math.PI/2){const x=(b-Math.PI)/(Math.PI/2);g=u-o,v=d+r-x*s}else{const x=(b-3*Math.PI/2)/(Math.PI/2);g=u-o+x*e,v=d-r}i.push({x:g,y:v,index:h})}return i}function MO(c,t,e){let s=1/0,n=0;for(let i=0;i<c.length;i++){const o=c[i],r=Math.sqrt(Math.pow(t-o.x,2)+Math.pow(e-o.y,2));r<s&&(s=r,n=i)}return n}function Gv(c,t,e,s,n,i,o,r=140,u=100){const d=Sa(i,o,r,u),h=MO(d,e,s);if(n.filter(g=>g.source===c&&g.target===t&&g.sourcePort===h||g.target===c&&g.source===t&&g.targetPort===h).length===0)return h;for(let g=1;g<d.length;g++){const v=(h+g)%d.length,b=(h-g+d.length)%d.length;if(n.filter(C=>C.source===c&&C.target===t&&C.sourcePort===v||C.target===c&&C.source===t&&C.targetPort===v).length===0)return v;if(n.filter(C=>C.source===c&&C.target===t&&C.sourcePort===b||C.target===c&&C.source===t&&C.targetPort===b).length===0)return b}return h}const dC=S.createContext(null);function SO({children:c}){const t=S.useRef(new Map),e=S.useCallback((o,r)=>{r?t.current.set(o,r):t.current.delete(o)},[]),s=S.useCallback(o=>t.current.get(o)||null,[]),n=S.useCallback(o=>{t.current.delete(o)},[]),i={registerNodeRef:e,getNodeRef:s,unregisterNodeRef:n};return y.jsx(dC.Provider,{value:i,children:c})}function Iu(){const c=S.useContext(dC);if(!c)throw new Error("useNodeRefs must be used within NodeRefsProvider");return c}function CO({node:c,onConnectionStart:t,onConnectionEnd:e,isConnecting:s=!1,onContextMenu:n}){const{registerNodeRef:i,unregisterNodeRef:o}=Iu(),r=S.useRef(null);S.useEffect(()=>(r.current&&i(c.id,r.current),()=>{o(c.id)}),[c.id,i,o]);const u=Ee(de=>de.selectNode),d=Ee(de=>de.updateNode),h=Ee(de=>de.updateNodes),p=Ee(de=>de.deleteNode);Ee(de=>de.addNode);const g=Ee(de=>de.startDragOperation),v=Ee(de=>de.endDragOperation);Ee(de=>de.bringToFront),Ee(de=>de.sendToBack),Ee(de=>de.bringForward),Ee(de=>de.sendBackward);const{connections:b,zoom:x,pan:R,nodes:C}=Ee(uC(de=>({connections:de.connections,zoom:de.zoom,pan:de.pan,nodes:de.nodes}))),{addTab:k}=Ru(),[T,A]=S.useState(!1),[D,_]=S.useState(!1),L=S.useRef({x:0,y:0}),O=S.useRef({x:0,y:0}),X=S.useRef({x:0,y:0}),te=S.useRef({x:0,y:0}),ce=S.useRef(null),Z=S.useRef(null),se=S.useRef(!1),le=S.useRef(!1),ue=S.useRef({}),z=S.useMemo(()=>Ir.find(de=>de.type===c.type),[c.type]),{isRunning:I,getComponentMetrics:q}=_t(),Y=yo(de=>de.getComponentStatus(c.id)),fe=tC(de=>de.getComponentState(c.id)),N=I?q(c.id):void 0,K=Br(de=>de.highlightedNodeId)===c.id,ie=S.useMemo(()=>b.some(de=>de.source===c.id||de.target===c.id),[b,c.id]),U=N&&(N.throughput&&N.throughput>.1||N.errorRate&&N.errorRate>.001||N.utilization&&N.utilization>.01),oe=()=>{if(!I||!N||!ie||!U)return"";const de=N.utilization||0,$e=N.errorRate||0,Ue=Math.min(1,de*.7+$e*.3);return Ue>.8?"border-red-500":Ue>.6?"border-orange-500":Ue>.4?"border-yellow-500":Ue>.2?"border-green-500":""},B=()=>{if(!I)return null;if(fe)switch(fe.state){case"disabled":case"failed":return y.jsx(Tl,{className:"text-red-500",size:16});case"degraded":return y.jsx(on,{className:"text-yellow-500",size:16})}if(!ie||!U||!Y)return null;const de=Y.health,$e=16;switch(de){case"healthy":return y.jsx(Jf,{className:"text-green-500",size:$e});case"degraded":return y.jsx(on,{className:"text-yellow-500",size:$e});case"critical":return y.jsx(bo,{className:"text-orange-500",size:$e});case"down":return y.jsx(go,{className:"text-red-500",size:$e});default:return null}},G=()=>{if(!I)return c.selected?"border-primary":"border-border";if(fe)switch(fe.state){case"disabled":case"failed":return"border-red-500 border-2";case"degraded":return"border-yellow-500 border-2"}if(!Y)return c.selected?"border-primary":"border-border";if(Y.criticalPath)return"border-purple-500 border-2";switch(Y.health){case"down":return"border-red-500 border-2";case"critical":return"border-orange-500";case"degraded":return"border-yellow-500";default:return c.selected?"border-primary":"border-border"}},pe=S.useRef(x),me=S.useRef(R);S.useEffect(()=>{pe.current=x,me.current=R},[x,R]),S.useEffect(()=>{const de=Ue=>{if(!se.current)return;if(Ee.getState().getIsGroupDragging()){se.current=!1,le.current=!1,A(!1);return}const mt=Ue.clientX-O.current.x,$t=Ue.clientY-O.current.y,et=Math.sqrt(mt*mt+$t*$t);if(!le.current&&et>3){le.current=!0,A(!0),g(c.id);const wt=Ee.getState().nodes.filter(yt=>yt.selected);ue.current={},wt.forEach(yt=>{ue.current[yt.id]={x:yt.position.x,y:yt.position.y}})}if(le.current&&ce.current){const It=pe.current,wt=me.current,yt=ce.current.getBoundingClientRect(),Xt=(Ue.clientX-yt.left-wt.x)/It,Gt=(Ue.clientY-yt.top-wt.y)/It,Pn=Xt-X.current.x,Ys=Gt-X.current.y,hn=Ee.getState().nodes.filter(Wt=>Wt.selected),Jt=Object.keys(ue.current).length>0;if(hn.length>1&&Jt){const Wt=[];hn.forEach(Nt=>{const Fi=ue.current[Nt.id];Fi&&Wt.push({id:Nt.id,updates:{position:{x:Fi.x+Pn,y:Fi.y+Ys}}})}),Wt.length>0&&h(Wt,!0)}else{const Wt=te.current.x+Pn,Nt=te.current.y+Ys;d(c.id,{position:{x:Wt,y:Nt}},!0)}}},$e=()=>{se.current&&(se.current=!1,le.current&&(le.current=!1,A(!1),v()))};return document.addEventListener("mousemove",de),document.addEventListener("mouseup",$e),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",$e)}},[c.id,d,h,g,v]);const ye=de=>{if(de.button!==0)return;const Ue=Ee.getState().nodes.filter(Ps=>Ps.selected),bt=c.selected,mt=Ue.some(Ps=>Ps.id!==c.id);if(!(bt&&mt&&!de.ctrlKey&&!de.metaKey)){const Ps=de.ctrlKey||de.metaKey;u(c.id,Ps)}const $t=document.querySelector(".flex-1.overflow-hidden.relative");if(!$t){L.current={x:0,y:0},X.current={x:0,y:0},te.current={x:0,y:0},ce.current=null,Z.current=null;return}ce.current=$t;const et=pe.current,It=me.current,wt=$t.getBoundingClientRect();Z.current=wt;const yt=(de.clientX-wt.left-It.x)/et,Xt=(de.clientY-wt.top-It.y)/et;X.current={x:yt,y:Xt};const Ys=Ee.getState().nodes.find(Ps=>Ps.id===c.id)?.position||c.position;te.current={x:Ys.x,y:Ys.y},L.current={x:yt-Ys.x,y:Xt-Ys.y},O.current={x:de.clientX,y:de.clientY},se.current=!0,le.current=!1,de.stopPropagation()},be=de=>{de.stopPropagation(),de.preventDefault(),T&&(A(!1),v()),k({title:`${c.data.label} Config`,type:"component",componentId:c.id,componentType:c.type})},Ie=de=>{de.key==="Delete"&&c.selected&&p(c.id)},Be=de=>{if(de.preventDefault(),de.stopPropagation(),!c.selected){const $e=C.some(Ue=>Ue.id!==c.id&&Ue.selected);u(c.id,$e)}n?.(de.clientX,de.clientY)},ot=(de,$e)=>{de.stopPropagation(),t?.($e)},Ze=S.useCallback(()=>{if(!r.current)return{width:140,height:100};const Ue=(r.current.querySelector(".bg-card")||r.current).getBoundingClientRect();return{width:Ue.width/x,height:Ue.height/x}},[x]),Lt=de=>{if(s){de.stopPropagation();const $e=Ze(),Ue=Sa(c.position.x,c.position.y,$e.width,$e.height,16),bt=document.querySelector(".flex-1.overflow-hidden.relative");if(bt){const mt=bt.getBoundingClientRect(),$t=(de.clientX-mt.left-R.x)/x,et=(de.clientY-mt.top-R.y)/x;let It=1/0,wt=0;for(let yt=0;yt<Ue.length;yt++){const Xt=Ue[yt],Gt=Math.sqrt(Math.pow($t-Xt.x,2)+Math.pow(et-Xt.y,2));Gt<It&&(It=Gt,wt=yt)}e?.(wt)}else e?.()}};return y.jsx(y.Fragment,{children:y.jsx("div",{ref:r,"data-node-id":c.id,className:`
          absolute cursor-move select-none
          transition-shadow
          ${c.selected?"glow-primary":""}
          ${T?"pointer-events-none":""}
        `,style:{left:`${c.position.x}px`,top:`${c.position.y}px`},onMouseDown:ye,onMouseUp:Lt,onDoubleClick:be,onContextMenu:Be,onKeyDown:Ie,onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),tabIndex:0,children:y.jsxs("div",{className:Te("bg-card border-2 rounded-lg p-4 min-w-[140px] relative",G(),oe(),"hover:border-primary/50 transition-colors",Y?.criticalPath&&"shadow-lg shadow-purple-500/20",K&&"ring-4 ring-yellow-400 ring-offset-2 animate-pulse"),children:[I&&Y&&y.jsx("div",{className:"absolute -top-2 -right-2 bg-card rounded-full p-0.5 border border-border",children:B()}),I&&Y?.criticalPath&&y.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 bg-purple-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-semibold",children:"CRITICAL"}),y.jsxs("div",{className:"flex flex-col items-center gap-2 select-none",children:[y.jsx("div",{className:"text-3xl select-none pointer-events-none",children:z?.icon}),y.jsx("div",{className:"text-sm font-medium text-center text-foreground select-none pointer-events-none",children:c.data.label})]}),(D||s)&&(()=>{const de=r.current?(()=>{const mt=(r.current.querySelector(".bg-card")||r.current).getBoundingClientRect();return{width:mt.width/x,height:mt.height/x}})():{width:140,height:100},$e=Sa(c.position.x,c.position.y,de.width,de.height,16);return y.jsx(y.Fragment,{children:$e.map((Ue,bt)=>{const mt=Ue.x-c.position.x,$t=Ue.y-c.position.y;return y.jsx("div",{className:"absolute w-3 h-3 rounded-full bg-primary/80 border-2 border-card cursor-crosshair hover:scale-150 hover:bg-primary transition-all z-10",style:{left:`${mt-6}px`,top:`${$t-6}px`},onMouseDown:et=>{et.stopPropagation(),ot(et,bt)},onMouseUp:et=>{et.stopPropagation(),s&&e?.(bt)},title:"Connection point"},bt)})})})()]})})})}const RO=S.memo(CO,(c,t)=>!(c.node.id!==t.node.id||c.node.position.x!==t.node.position.x||c.node.position.y!==t.node.position.y||c.node.selected!==t.node.selected||c.node.type!==t.node.type||c.node.data.label!==t.node.data.label||c.isConnecting!==t.isConnecting||c.onConnectionStart!==t.onConnectionStart||c.onConnectionEnd!==t.onConnectionEnd||c.onContextMenu!==t.onContextMenu));function EO({selectedNodeId:c,highlightPath:t=!0}){const{nodes:e,connections:s}=Ee(),{isRunning:n}=_t(),{getConnectionMessages:i}=Ni(),[o,r]=S.useState(new Set),[u,d]=S.useState(new Map);return S.useEffect(()=>{if(!c||!t||!n){r(new Set),d(new Map);return}const h=new Set,p=new Map,g=[{nodeId:c,path:[c]}];for(;g.length>0;){const{nodeId:v,path:b}=g.shift();if(h.has(v))continue;h.add(v);const x=s.filter(R=>R.source===v);for(const R of x){const C=R.target,k=[...b,C];p.set(R.id,k),h.has(C)||g.push({nodeId:C,path:k})}}d(p),r(new Set(p.keys()))},[c,s,t,n]),S.useEffect(()=>{if(!c||!t||!n)return;const h=new Set,p=[{nodeId:c,path:[c]}];for(;p.length>0;){const{nodeId:g,path:v}=p.shift();if(h.has(g))continue;h.add(g);const b=s.filter(x=>x.target===g);for(const x of b){const R=x.source,C=[R,...v],k=u.get(x.id)||[];(k.length===0||C.length<k.length)&&(u.set(x.id,C),d(new Map(u))),h.has(R)||p.push({nodeId:R,path:C})}}r(new Set(u.keys()))},[c,s,t,n]),null}function TO(c){const{selectedNodeId:t}=Ee(),{isRunning:e}=_t(),[s,n]=S.useState(!1);return S.useEffect(()=>{if(!t||!e){n(!1);return}const{nodes:i,connections:o}=Ee.getState();if(!i.find(d=>d.id===t)){n(!1);return}const u=o.find(d=>d.id===c);u&&(u.source===t||u.target===t)?n(!0):n(!1)},[t,c,e]),s}const hC=S.createContext(null);function kO({children:c}){const t=S.useRef(null),e=S.useRef(new WeakMap);S.useEffect(()=>(t.current=new ResizeObserver(i=>{i.forEach(o=>{const r=e.current.get(o.target);r&&r()})}),()=>{t.current&&(t.current.disconnect(),t.current=null)}),[]);const n={observe:S.useCallback((i,o)=>t.current?(e.current.set(i,o),t.current.observe(i),()=>{t.current&&(t.current.unobserve(i),e.current.delete(i))}):()=>{},[])};return y.jsx(hC.Provider,{value:n,children:c})}function fC(){const c=S.useContext(hC);if(!c)throw new Error("useResizeObserver must be used within ResizeObserverProvider");return c}function AO({connection:c,sourceNode:t,targetNode:e,zoom:s,pan:n,isSelected:i=!1,onClick:o,onContextMenu:r}){const[u,d]=S.useState(!1),{isRunning:h,connectionMetrics:p}=_t(uC(G=>({isRunning:G.isRunning,connectionMetrics:G.connectionMetrics}))),g=h?p.get(c.id):void 0,{getConnectionMessages:v}=Ni(),b=Ee(G=>G.selectedNodeId),x=Ee(G=>G.connections),R=h?v(c.id):[],C=S.useMemo(()=>R.filter(G=>G.status==="in-transit"||G.status==="pending"),[R]),k=TO(c.id);S.useMemo(()=>x.some(G=>G.source===c.target&&G.target===c.source),[x,c.target,c.source]);const{getNodeRef:T}=Iu(),{observe:A}=fC(),[D,_]=S.useState(()=>{const G=pe=>{const me=T(pe);if(!me)return{width:140,height:100};const Ie=(me.querySelector(".bg-card")||me).getBoundingClientRect();return{width:Ie.width/s,height:Ie.height/s}};return{source:G(t.id),target:G(e.id)}});S.useEffect(()=>{const G=()=>{const Ze=Lt=>{const de=T(Lt);if(!de)return{width:140,height:100};const bt=(de.querySelector(".bg-card")||de).getBoundingClientRect();return{width:bt.width/s,height:bt.height/s}};_({source:Ze(t.id),target:Ze(e.id)})};G();const pe=T(t.id),me=T(e.id),ye=pe?.querySelector(".bg-card"),be=me?.querySelector(".bg-card"),Ie=ye||pe,Be=be||me,ot=[];if(Ie){const Ze=A(Ie,G);ot.push(Ze)}if(Be){const Ze=A(Be,G);ot.push(Ze)}return()=>{ot.forEach(Ze=>Ze())}},[t.id,e.id,s,T,A]);const L=D.source.width,O=D.source.height,X=D.target.width,te=D.target.height,ce=L/2,Z=O/2,se=X/2,le=te/2;let ue,z,I,q;if(c.sourcePort!==void 0&&c.targetPort!==void 0){const G=Sa(t.position.x,t.position.y,L,O,16),pe=Sa(e.position.x,e.position.y,X,te,16),me=G[c.sourcePort],ye=pe[c.targetPort];ue=me.x,z=me.y,I=ye.x,q=ye.y}else{const G=t.position.x+ce,pe=t.position.y+Z,me=e.position.x+se,ye=e.position.y+le,be=Math.atan2(ye-pe,me-G),Ie=(Ze,Lt,de,$e)=>{const Ue=Math.abs(de),bt=$e?ce:se,mt=$e?Z:le,$t=Math.atan2(mt,bt);let et,It;if(Ue<$t||Ue>Math.PI-$t){const wt=$e?1:-1;et=Ze+wt*bt*Math.sign(Math.cos(de)),It=Lt+wt*bt*Math.tan(de)*Math.sign(Math.cos(de))}else{const wt=$e?1:-1;et=Ze+wt*mt/Math.tan(de)*Math.sign(Math.sin(de)),It=Lt+wt*mt*Math.sign(Math.sin(de))}return{x:et,y:It}},Be=Ie(G,pe,be,!0),ot=Ie(me,ye,be,!1);ue=Be.x,z=Be.y,I=ot.x,q=ot.y}const Y=I-ue,fe=q-z,N=Math.min(Math.abs(Y),Math.abs(fe))*.3+30,F=`
    M ${ue},${z}
    C ${ue+N*Math.sign(Y)},${z}
      ${I-N*Math.sign(Y)},${q}
      ${I},${q}
  `;let K="hsl(var(--border))",ie=2;k&&b?(K="hsl(280 100% 70%)",ie=3):i?(K="hsl(var(--primary))",ie=2.5):u?(K="hsl(var(--accent))",ie=2.5):g&&h&&(g.effectiveThroughput>0||g.traffic>0)&&(g.bottleneck?(K="hsl(0 84% 60%)",ie=3):g.backpressure>.7?(K="hsl(25 95% 53%)",ie=2.5):g.congestion>.6?(K="hsl(45 93% 47%)",ie=2.5):g.throughputDependency>.5?(K="hsl(142 76% 36%)",ie=2):g.effectiveThroughput>0&&(K="hsl(var(--primary))",ie=2));const U=G=>{G.stopPropagation(),o?.()},oe=G=>{G.preventDefault(),G.stopPropagation(),r?.(G)},B=h&&g&&g.effectiveThroughput>0?g.effectiveThroughput%40/2:0;return y.jsxs("g",{children:[y.jsx("path",{d:F,fill:"none",stroke:"transparent",strokeWidth:20/s,style:{cursor:"pointer"},onClick:U,onContextMenu:oe,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)}),h&&g&&g.effectiveThroughput>0&&g.traffic>0&&y.jsx("path",{d:F,fill:"none",stroke:K,strokeWidth:Math.max(1,ie/s),strokeLinecap:"round",strokeDasharray:`${Math.max(4,8/s)} ${Math.max(2,4/s)}`,strokeDashoffset:-B,style:{opacity:.4,pointerEvents:"none",animation:"flow 2s linear infinite"}}),h&&C.map((G,pe)=>{const me=Date.now()-G.timestamp,be=G.latency?Math.min(1,me/G.latency):0,Ie=ue+(I-ue)*be,Be=z+(q-z)*be,Ze={json:"hsl(142 76% 36%)",xml:"hsl(25 95% 53%)",binary:"hsl(221 83% 53%)",protobuf:"hsl(280 100% 70%)",text:"hsl(210 40% 50%)"}[G.format]||"hsl(var(--primary))";return y.jsxs("g",{children:[y.jsx("circle",{cx:Ie,cy:Be,r:4/s,fill:Ze,stroke:"hsl(var(--background))",strokeWidth:1/s,style:{pointerEvents:"none",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.3))"},children:y.jsx("animate",{attributeName:"opacity",values:"0.5;1;0.5",dur:"1s",repeatCount:"indefinite"})}),G.size>1e3&&y.jsx("text",{x:Ie,y:Be-8/s,fill:Ze,fontSize:8/s,textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:G.format})]},G.id||pe)}),y.jsx("path",{d:F,fill:"none",stroke:K,strokeWidth:Math.max(1,ie/s),strokeLinecap:"round",markerEnd:h&&g&&(g.effectiveThroughput>0||g.traffic>0)?`url(#arrowhead-${i?"selected":g?.bottleneck?"bottleneck":"default"})`:i?"url(#arrowhead-selected)":"url(#arrowhead-default)",style:{transition:"stroke 0.3s, stroke-width 0.3s",pointerEvents:"none"}}),h&&g&&(g.effectiveThroughput>0||g.traffic>0)?y.jsxs("g",{children:[y.jsx("text",{x:(ue+I)/2,y:(z+q)/2-10/s,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/s),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:c.label||`${g.latency.toFixed(1)}ms`}),y.jsx("text",{x:(ue+I)/2,y:(z+q)/2+8/s,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(7,9/s),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:g.traffic>0?`${g.traffic.toFixed(1)} KB/s`:`${g.effectiveThroughput.toFixed(0)} msg/s`}),c.data?.bandwidthMbps&&g.traffic>0&&y.jsxs("text",{x:(ue+I)/2,y:(z+q)/2+20/s,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(6,8/s),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none",opacity:.7},children:["Limit: ",c.data.bandwidthMbps,"Mbps"]})]}):c.label?y.jsx("g",{children:y.jsx("text",{x:(ue+I)/2,y:(z+q)/2-10/s,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/s),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:c.label})}):null]})}const DO=S.memo(AO,(c,t)=>!(c.connection.id!==t.connection.id||c.connection.sourcePort!==t.connection.sourcePort||c.connection.targetPort!==t.connection.targetPort||c.connection.label!==t.connection.label||c.sourceNode.id!==t.sourceNode.id||c.sourceNode.position.x!==t.sourceNode.position.x||c.sourceNode.position.y!==t.sourceNode.position.y||c.targetNode.id!==t.targetNode.id||c.targetNode.position.x!==t.targetNode.position.x||c.targetNode.position.y!==t.targetNode.position.y||c.zoom!==t.zoom||c.pan.x!==t.pan.x||c.pan.y!==t.pan.y||c.isSelected!==t.isSelected||c.onClick!==t.onClick||c.onContextMenu!==t.onContextMenu)),PO=140,_O=140,LO=16;function IO({nodeId:c,position:t}){const e=_t(h=>h.componentMetrics.get(c)),{connections:s}=Ee(),{isRunning:n}=_t(),i=s.some(h=>h.source===c||h.target===c),o=e&&(e.throughput&&e.throughput>.1||e.errorRate&&e.errorRate>.001||e.utilization&&e.utilization>.01),r=S.useMemo(()=>{if(!e)return[];const h=[{label:"Throughput",value:`${Math.round(e.throughput)}`,unit:"ops/s",color:"text-blue-400"},{label:"Latency (avg)",value:`${Math.round(e.latency)}`,unit:"ms",color:"text-yellow-400"}];return e.latencyP50!==void 0&&h.push({label:"Latency (p50)",value:`${Math.round(e.latencyP50)}`,unit:"ms",color:"text-green-400"}),e.latencyP99!==void 0&&h.push({label:"Latency (p99)",value:`${Math.round(e.latencyP99)}`,unit:"ms",color:"text-red-400"}),h.push({label:"Error Rate",value:`${(e.errorRate*100).toFixed(2)}`,unit:"%",color:"text-orange-400"},{label:"Utilization",value:`${Math.round(e.utilization*100)}`,unit:"%",color:"text-purple-400"}),h},[e]);if(!n||!e||!i||!o||r.length===0)return null;const u=t.x+PO/2,d=t.y+_O+LO;return y.jsx("div",{className:"absolute pointer-events-none",style:{left:`${u}px`,top:`${d}px`,transform:"translateX(-50%)",zIndex:10},children:y.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-2 shadow-lg min-w-max",children:y.jsx("div",{className:"text-xs space-y-1",children:r.map(h=>y.jsxs("div",{className:"flex items-center justify-between gap-3",children:[y.jsxs("span",{className:"text-slate-400",children:[h.label,":"]}),y.jsxs("span",{className:`font-mono font-semibold ${h.color}`,children:[h.value," ",h.unit]})]},h.label))})})})}function NO({isVisible:c=!0}){return c?y.jsx("div",{className:"absolute bottom-4 right-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:y.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-muted-foreground",children:[y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("div",{className:"w-3 h-3 rounded bg-green-500/20 border border-green-500/30"}),y.jsx("span",{children:"<20%"})]}),y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500/20 border border-yellow-500/30"}),y.jsx("span",{children:"20-40%"})]}),y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("div",{className:"w-3 h-3 rounded bg-orange-500/20 border border-orange-500/30"}),y.jsx("span",{children:"40-60%"})]}),y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("div",{className:"w-3 h-3 rounded bg-red-500/20 border border-red-500/30"}),y.jsx("span",{children:">60%"})]})]})}):null}function zO({isVisible:c=!0}){const{nodes:t,connections:e,zoom:s,pan:n}=Ee(),{isRunning:i}=_t(),o=Tt.useMemo(()=>{if(t.length===0)return{minX:0,minY:0,maxX:2e3,maxY:2e3};const k=t.map(O=>O.position.x),T=t.map(O=>O.position.y),A=Math.min(...k)-200,D=Math.min(...T)-200,_=Math.max(...k)+200,L=Math.max(...T)+200;return{minX:A,minY:D,maxX:_,maxY:L}},[t]),r=o.maxX-o.minX,u=o.maxY-o.minY,d=120,h=80,p=d/Math.max(r,1e3),g=h/Math.max(u,1e3),v=Math.min(p,g),b=window.innerWidth/s*v,x=window.innerHeight/s*v,R=(-n.x/s-o.minX)*v,C=(-n.y/s-o.minY)*v;return c?y.jsx("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:y.jsxs("svg",{width:d,height:h,className:"border border-border/50 rounded",style:{background:"hsl(var(--background))"},children:[e.map(k=>{const T=t.find(X=>X.id===k.source),A=t.find(X=>X.id===k.target);if(!T||!A)return null;const D=(T.position.x-o.minX)*v,_=(T.position.y-o.minY)*v,L=(A.position.x-o.minX)*v,O=(A.position.y-o.minY)*v;return y.jsx("line",{x1:D,y1:_,x2:L,y2:O,stroke:"hsl(var(--border))",strokeWidth:.3,opacity:.2},k.id)}),t.map(k=>y.jsx("circle",{cx:(k.position.x-o.minX)*v,cy:(k.position.y-o.minY)*v,r:1.5,fill:"hsl(var(--muted-foreground))",opacity:.5},k.id)),y.jsx("rect",{x:R,y:C,width:b,height:x,fill:"hsl(var(--primary))",fillOpacity:.2,stroke:"hsl(var(--primary))",strokeWidth:1.5,strokeDasharray:"2 2"})]})}):null}function jO({x:c,y:t,onDelete:e,onRename:s,onCopyId:n,onClose:i}){const o=S.useRef(null),[r,u]=S.useState({x:c,y:t});return S.useEffect(()=>{if(o.current){const d=o.current.getBoundingClientRect(),h=window.innerWidth,p=window.innerHeight;let g=c,v=t;c+d.width>h&&(g=h-d.width-10),t+d.height>p&&(v=p-d.height-10),g=Math.max(10,g),v=Math.max(10,v),u({x:g,y:v})}},[c,t]),S.useEffect(()=>{const d=p=>{o.current&&!o.current.contains(p.target)&&i()},h=p=>{p.key==="Escape"&&i()};return document.addEventListener("mousedown",d),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",h)}},[i]),y.jsxs("div",{ref:o,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[120px]",style:{left:`${r.x}px`,top:`${r.y}px`},children:[y.jsxs("button",{onClick:()=>{s(),i()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(QD,{className:"w-3.5 h-3.5"}),"Rename"]}),y.jsxs("button",{onClick:()=>{n(),i()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Db,{className:"w-3.5 h-3.5"}),"Copy ID"]}),y.jsx("div",{className:"border-t border-border my-0.5"}),y.jsxs("button",{onClick:()=>{e(),i()},className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}const OO=140,qO=100;function HO(c,t,e){const s=e(c);if(!s)return{width:OO,height:qO};const o=(s.querySelector(".bg-card")||s).getBoundingClientRect();return{width:o.width/t,height:o.height/t}}function $O(c,t){const{getNodeRef:e}=Iu(),{observe:s}=fC(),[n,i]=S.useState({}),o=S.useCallback(()=>{const r={};c.forEach(u=>{const d=HO(u,t,e);d&&(r[u]=d)}),i(u=>({...u,...r}))},[c,t,e]);return S.useEffect(()=>{if(c.length===0)return;o();const r=[];return c.forEach(u=>{const d=e(u);if(d){const p=d.querySelector(".bg-card")||d;if(p){const g=s(p,o);r.push(g)}}}),()=>{r.forEach(u=>u())}},[c,t,o,e,s]),n}const mf=20,BO=140,UO=100,FO=18,QO=6,VO=FO+QO*2;function GO(c,t,e,s){return S.useMemo(()=>{const n=t.filter(g=>c.nodeIds.includes(g.id));if(n.length===0)return null;const i=mf,o=mf,r=c.showName!==!1?VO:mf;let u=1/0,d=1/0,h=-1/0,p=-1/0;return n.forEach(g=>{const v=e[g.id]||{width:BO,height:UO},b=g.position.x,x=g.position.y,R=b+v.width,C=x+v.height;u=Math.min(u,b),d=Math.min(d,x),h=Math.max(h,R),p=Math.max(p,C)}),{x:u-i,y:d-r,width:h-u+i*2,height:p-d+r+o}},[t,c.nodeIds,e,s,c.showName])}function WO(c,t){const{nodes:e,updateNodes:s}=Ee(),[n,i]=S.useState(!1),o=S.useRef({x:0,y:0}),r=S.useRef({}),u=S.useCallback(d=>{if(d.button!==0||d.target.closest("[data-node-id]"))return;d.stopPropagation();const g=Ee.getState();g.selectGroup(c.id),i(!0),o.current.x=d.clientX,o.current.y=d.clientY,g.setGroupDragging(!0);const v=e.filter(b=>c.nodeIds.includes(b.id));r.current={},v.forEach(b=>{r.current[b.id]={...b.position}})},[c.id,c.nodeIds,e]);return S.useEffect(()=>{if(!n)return;let d=null,h=null,p=!0;const g=b=>{if(!p)return;const x=(b.clientX-o.current.x)/t,R=(b.clientY-o.current.y)/t;h={dx:x,dy:R},d===null&&(d=requestAnimationFrame(()=>{if(!p||!h){d=null,h=null;return}const{dx:C,dy:k}=h,T=Ee.getState(),A=c.nodeIds.map(D=>{const _=r.current[D];return _?{id:D,updates:{position:{x:_.x+C,y:_.y+k}}}:null}).filter(D=>D!==null);A.length>0&&T.updateNodes(A,!0),d=null,h=null}))},v=b=>{if(b&&b.button!==0)return;p=!1,d!==null&&(cancelAnimationFrame(d),d=null);const x=Ee.getState();if(h){const{dx:R,dy:C}=h,k=c.nodeIds.map(T=>{const A=r.current[T];return A?{id:T,updates:{position:{x:A.x+R,y:A.y+C}}}:null}).filter(T=>T!==null);if(x.setGroupDragging(!1),k.length>0){x.updateNodes(k,!0);const T=Ee.getState();gt(T,T.diagramName)}}else x.setGroupDragging(!1);h=null,i(!1)};return document.addEventListener("mousemove",g,{passive:!0}),document.addEventListener("mouseup",v,{capture:!0}),()=>{p=!1,d!==null&&cancelAnimationFrame(d),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",v,{capture:!0}),Ee.getState().setGroupDragging(!1)}},[n,c.nodeIds,t]),{isDragging:n,handleMouseDown:u}}const Wv=18,Sl=6;function KO({group:c,zoom:t}){const{nodes:e,selectedGroupId:s,selectGroup:n,deleteGroup:i,updateGroup:o}=Ee(),[r,u]=S.useState(null),[d,h]=S.useState(!1),[p,g]=S.useState(!1),v=$O(c.nodeIds,t),b=GO(c,e,v,t),{handleMouseDown:x}=WO(c,t);if(!b)return null;const R=s===c.id,C=c.color||"hsl(var(--primary))",k=O=>{O.preventDefault(),O.stopPropagation(),n(c.id),u({x:O.clientX,y:O.clientY})},T=()=>{h(!0)},A=()=>{i(c.id),Ye.success("Group deleted"),h(!1)},D=()=>{g(!0)},_=O=>{o(c.id,{name:O}),Ye.success("Group renamed"),g(!1)},L=()=>{navigator.clipboard.writeText(c.id),Ye.success("Group ID copied to clipboard")};return y.jsxs(y.Fragment,{children:[y.jsxs("g",{children:[y.jsx("rect",{x:b.x,y:b.y,width:b.width,height:b.height,fill:C,fillOpacity:R?.1:.05,stroke:C,strokeWidth:R?3/t:2/t,strokeDasharray:R?"0":"5,5",rx:8/t,ry:8/t,style:{cursor:"pointer",transition:"all 0.2s"},onMouseDown:x,onContextMenu:k}),c.showName!==!1&&y.jsxs("g",{onClick:O=>{O.stopPropagation(),n(c.id)},onContextMenu:k,style:{cursor:"pointer"},children:[y.jsx("rect",{x:b.x+Sl,y:b.y+Sl,width:Math.max(80,c.name.length*6.5+16),height:Wv,fill:C,fillOpacity:.85,rx:3,ry:3,stroke:C,strokeWidth:.5}),y.jsx("text",{x:b.x+Sl+8,y:b.y+Sl+Wv/2,fill:"white",fontSize:11,fontWeight:"600",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:c.name})]})]}),r&&y.jsx(jO,{x:r.x,y:r.y,onDelete:T,onRename:D,onCopyId:L,onClose:()=>u(null)}),y.jsx(lC,{open:d,groupName:c.name,onConfirm:A,onCancel:()=>h(!1)}),y.jsx(yp,{open:p,initialName:c.name,onConfirm:_,onCancel:()=>g(!1)})]})}const YO=S.memo(KO,(c,t)=>!(c.group.id!==t.group.id||c.group.name!==t.group.name||c.group.color!==t.group.color||c.group.nodeIds.length!==t.group.nodeIds.length||c.group.nodeIds.some((e,s)=>e!==t.group.nodeIds[s])||c.zoom!==t.zoom));function XO({isVisible:c,canvasRef:t}){const{zoom:e,pan:s}=Ee(),[n,i]=S.useState(null),o=S.useRef(null);if(S.useEffect(()=>{if(!c){i(null);return}const D=()=>{if(t?.current)i(t.current.getBoundingClientRect());else if(o.current?.parentElement){const te=o.current.parentElement.getBoundingClientRect(),ce=24;i({...te,width:te.width-ce,height:te.height-ce,left:te.left+ce,top:te.top+ce})}},_=setTimeout(D,10),L=requestAnimationFrame(D),O=requestAnimationFrame(()=>{requestAnimationFrame(D)});return window.addEventListener("resize",D),()=>{clearTimeout(_),cancelAnimationFrame(L),cancelAnimationFrame(O),window.removeEventListener("resize",D)}},[c,t]),S.useEffect(()=>{if(!c)return;const _=requestAnimationFrame(()=>{t?.current&&i(t.current.getBoundingClientRect())});return()=>cancelAnimationFrame(_)},[e,s,c,t]),!c)return null;if(!n)return y.jsx("div",{ref:o,className:"absolute inset-0 pointer-events-none z-20"});const r=20,u=r*e;let d=1;u<10?d=10:u<20?d=5:u<40&&(d=2);const h=r*d,p=24,g=24,v=n.width,b=n.height,x=Math.floor(-s.x/e/h)*h,R=Math.floor(-s.y/e/h)*h,C=x+v/e+h*2,k=R+b/e+h*2,T=[];for(let D=x;D<=C;D+=h)T.push(D);const A=[];for(let D=R;D<=k;D+=h)A.push(D);return y.jsxs("div",{ref:o,className:"absolute inset-0 pointer-events-none z-20",children:[y.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-border pointer-events-none",style:{top:0,left:`${p}px`,right:0,height:`${g}px`,transform:`translate(${s.x}px, 0) scale(${e})`,transformOrigin:"0 0"},children:T.map(D=>y.jsx("div",{className:"absolute top-0 bottom-0 border-l border-border/60",style:{left:`${D}px`,width:"1px"},children:y.jsx("span",{className:"absolute top-0.5 left-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/e})`,transformOrigin:"0 0"},children:D})},`h-${D}`))}),y.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-r border-border pointer-events-none",style:{top:`${g}px`,left:0,bottom:0,width:`${p}px`,transform:`translate(0, ${s.y}px) scale(${e})`,transformOrigin:"0 0"},children:A.map(D=>y.jsx("div",{className:"absolute left-0 right-0 border-t border-border/60",style:{top:`${D}px`,height:"1px"},children:y.jsx("span",{className:"absolute left-0.5 top-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/e})`,transformOrigin:"0 0"},children:D})},`v-${D}`))}),y.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-r border-border pointer-events-none",style:{top:0,left:0,width:`${p}px`,height:`${g}px`}})]})}function JO({x:c,y:t,onDelete:e,onDuplicate:s,onCopyId:n,onBringToFront:i,onSendToBack:o,onBringForward:r,onSendBackward:u,onAddToGroup:d,onRemoveFromGroup:h,onClose:p}){const g=S.useRef(null);S.useEffect(()=>{const _=O=>{g.current&&!g.current.contains(O.target)&&p()},L=O=>{O.key==="Escape"&&p()};return document.addEventListener("mousedown",_),document.addEventListener("keydown",L),()=>{document.removeEventListener("mousedown",_),document.removeEventListener("keydown",L)}},[p]);const v=()=>{e(),p()},b=()=>{s(),p()},x=()=>{n(),p()},R=()=>{i?.(),p()},C=()=>{o?.(),p()},k=()=>{r?.(),p()},T=()=>{u?.(),p()},A=()=>{d?.(),p()},D=()=>{h?.(),p()};return y.jsxs("div",{ref:g,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[140px]",style:{left:`${c}px`,top:`${t}px`},children:[y.jsxs("button",{onClick:b,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Lb,{className:"w-3.5 h-3.5"}),"Duplicate"]}),y.jsxs("button",{onClick:x,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Db,{className:"w-3.5 h-3.5"}),"Copy ID"]}),(d||h)&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"border-t border-border my-0.5"}),h&&y.jsxs("button",{onClick:D,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(lD,{className:"w-3.5 h-3.5"}),"Remove from Group"]}),d&&y.jsxs("button",{onClick:A,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(wf,{className:"w-3.5 h-3.5"}),"Add to Group"]})]}),y.jsx("div",{className:"border-t border-border my-0.5"}),(i||o||r||u)&&y.jsxs(y.Fragment,{children:[y.jsxs("button",{onClick:R,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(BA,{className:"w-3.5 h-3.5"}),"Bring to Front"]}),y.jsxs("button",{onClick:C,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(OA,{className:"w-3.5 h-3.5"}),"Send to Back"]}),y.jsxs("button",{onClick:k,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Ab,{className:"w-3.5 h-3.5"}),"Bring Forward"]}),y.jsxs("button",{onClick:T,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Jl,{className:"w-3.5 h-3.5"}),"Send Backward"]}),y.jsx("div",{className:"border-t border-border my-0.5"})]}),y.jsxs("button",{onClick:v,className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[y.jsx(Zl,{className:"w-3.5 h-3.5"}),"Delete"]})]})}function ZO({nodeId:c,x:t,y:e,onClose:s}){const n=S.useRef(null),{groups:i,addNodeToGroup:o}=Ee();return S.useEffect(()=>{const r=d=>{n.current&&!n.current.contains(d.target)&&s()},u=d=>{d.key==="Escape"&&s()};return document.addEventListener("mousedown",r),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("keydown",u)}},[s]),y.jsxs("div",{ref:n,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${t}px`,top:`${e}px`},children:[y.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Add to Group"}),y.jsx("div",{className:"max-h-60 overflow-y-auto",children:(()=>{const r=i.filter(u=>!u.nodeIds.includes(c));return r.length>0?r.map(u=>y.jsxs("button",{onClick:()=>{o(u.id,c),Ye.success(`Added to "${u.name}"`),s()},className:"w-full px-2 py-1.5 text-xs text-left text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 transition-colors",children:[y.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:u.color||"hsl(var(--primary))"}}),y.jsx("span",{className:"truncate flex-1",children:u.name})]},u.id)):y.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:i.length===0?"No groups available":"Already in all groups"})})()}),y.jsx("div",{className:"border-t border-border mt-1",children:y.jsx("button",{onClick:s,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function e5({nodeId:c,x:t,y:e,onClose:s}){const n=S.useRef(null),{groups:i,removeNodeFromGroup:o}=Ee(),r=i.filter(u=>u.nodeIds.includes(c));return S.useEffect(()=>{const u=h=>{n.current&&!n.current.contains(h.target)&&s()},d=h=>{h.key==="Escape"&&s()};return document.addEventListener("mousedown",u),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("keydown",d)}},[s]),y.jsxs("div",{ref:n,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${t}px`,top:`${e}px`},children:[y.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Remove from Group"}),y.jsx("div",{className:"max-h-60 overflow-y-auto",children:r.length>0?r.map(u=>y.jsxs("button",{onClick:()=>{o(u.id,c),Ye.success(`Removed from "${u.name}"`),s()},className:"w-full px-2 py-1.5 text-xs text-left text-destructive hover:bg-destructive/10 hover:text-destructive flex items-center gap-2 transition-colors",children:[y.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:u.color||"hsl(var(--primary))"}}),y.jsx("span",{className:"truncate flex-1",children:u.name})]},u.id)):y.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:"Not in any groups"})}),y.jsx("div",{className:"border-t border-border mt-1",children:y.jsx("button",{onClick:s,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function t5({x:c,y:t,onDelete:e,onClose:s}){const n=S.useRef(null),[i,o]=S.useState({x:c,y:t});return S.useEffect(()=>{if(n.current){const r=n.current.getBoundingClientRect(),u=window.innerWidth,d=window.innerHeight;let h=c,p=t;c+r.width>u&&(h=u-r.width-8),t+r.height>d&&(p=d-r.height-8),h=Math.max(8,h),p=Math.max(8,p),o({x:h,y:p})}},[c,t]),S.useEffect(()=>{const r=d=>{n.current&&!n.current.contains(d.target)&&s()},u=d=>{d.key==="Escape"&&s()};return document.addEventListener("mousedown",r),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("keydown",u)}},[s]),y.jsx("div",{ref:n,className:"fixed bg-card border border-border rounded-md shadow-lg z-50",style:{left:`${i.x}px`,top:`${i.y}px`},children:y.jsx("button",{className:"w-full px-3 py-2 text-sm text-left hover:bg-accent transition-colors first:rounded-t-md last:rounded-b-md",onClick:e,children:"Delete"})})}function Kv(){const c=S.useRef(null),{nodes:t,connections:e,groups:s=[],addNode:n,addConnection:i,deleteConnection:o,zoom:r,pan:u,setPan:d,setZoom:h,selectNode:p,selectConnection:g,selectGroup:v,selectNodesByIds:b,selectedConnectionId:x,selectedNodeId:R,setViewportSize:C,deleteNode:k,updateNode:T,bringToFront:A,sendToBack:D,bringForward:_,sendBackward:L,canvasBounds:O,canvasChunks:X,addNodeToGroup:te,removeNodeFromGroup:ce}=Ee(),{isRunning:Z}=_t(),{showMinimap:se,showHeatMapLegend:le,showRuler:ue}=Br(),{getNodeRef:z}=Iu(),[I,q]=S.useState(!1),[Y,fe]=S.useState({x:0,y:0}),[N,F]=S.useState(!1),[K,ie]=S.useState(null),[U,oe]=S.useState(void 0),[B,G]=S.useState(null),[pe,me]=S.useState(null),[ye,be]=S.useState(null),[Ie,Be]=S.useState(null),[ot,Ze]=S.useState(null),[Lt,de]=S.useState(null),[$e,Ue]=S.useState(null);S.useEffect(()=>{if(!c.current)return;const ee=()=>{if(!c.current)return;const we=c.current.getBoundingClientRect();C({width:we.width,height:we.height})};ee();const he=new ResizeObserver(()=>{ee()});return he.observe(c.current),window.addEventListener("resize",ee),()=>{he.disconnect(),window.removeEventListener("resize",ee)}},[C]),S.useEffect(()=>{const ee=he=>{if((he.ctrlKey||he.metaKey)&&c.current){const we=c.current.getBoundingClientRect();he.clientX>=we.left&&he.clientX<=we.right&&he.clientY>=we.top&&he.clientY<=we.bottom&&he.preventDefault()}};return document.addEventListener("wheel",ee,{passive:!1,capture:!0}),()=>{document.removeEventListener("wheel",ee,{capture:!0})}},[]);const bt=ee=>{if(ee.preventDefault(),!c.current)return;const he=ee.dataTransfer.getData("application/json");if(!he)return;const we=JSON.parse(he),Ne=c.current.getBoundingClientRect(),je=(ee.clientX-Ne.left-u.x)/r,lt=(ee.clientY-Ne.top-u.y)/r,zt={id:`node-${Date.now()}`,type:we.type,position:{x:je,y:lt},data:{label:we.label}};n(zt)},mt=ee=>{ee.preventDefault(),ee.dataTransfer.dropEffect="copy"},$t=ee=>{const he=ee.button===0;if(ee.button===1||he&&ee.ctrlKey){q(!0),fe({x:ee.clientX-u.x,y:ee.clientY-u.y}),ee.preventDefault();return}if(he&&!N&&!ee.ctrlKey&&!ee.metaKey){if(c.current){const Ne=c.current.getBoundingClientRect(),je=(ee.clientX-Ne.left-u.x)/r,lt=(ee.clientY-Ne.top-u.y)/r;Be({x:je,y:lt}),Ze({x:je,y:lt,width:0,height:0})}p(null),g(null),v(null)}},et=ee=>{if(I)d({x:ee.clientX-Y.x,y:ee.clientY-Y.y});else if(N&&c.current){const he=c.current.getBoundingClientRect();G({x:(ee.clientX-he.left-u.x)/r,y:(ee.clientY-he.top-u.y)/r})}else if(Ie&&c.current){const he=c.current.getBoundingClientRect(),we=(ee.clientX-he.left-u.x)/r,Ne=(ee.clientY-he.top-u.y)/r,je=Math.min(Ie.x,we),lt=Math.min(Ie.y,Ne),zt=Math.abs(we-Ie.x),Zt=Math.abs(Ne-Ie.y),At={x:je,y:lt,width:zt,height:Zt};Ze(At);const us=t.filter(St=>{const at=St.position.x,vt=St.position.y,Bt=St.position.x+140,fn=St.position.y+140;return Bt>=At.x&&at<=At.x+At.width&&fn>=At.y&&vt<=At.y+At.height}).map(St=>St.id);b(us)}},It=()=>{q(!1),N&&(F(!1),ie(null),G(null)),Ie&&(Be(null),Ze(null))},wt=S.useCallback((ee,he)=>{F(!0),ie(ee),oe(he)},[]),yt=S.useCallback(ee=>{const he=z(ee);if(!he)return{width:140,height:100};const je=(he.querySelector(".bg-card")||he).getBoundingClientRect();return{width:je.width/r,height:je.height/r}},[z,r]),Xt=S.useCallback((ee,he)=>{if(N&&K&&K!==ee){const we=t.find(je=>je.id===K),Ne=t.find(je=>je.id===ee);if(we&&Ne){const je=yt(K),lt=yt(ee),zt=B?.x??Ne.position.x+lt.width/2,Zt=B?.y??Ne.position.y+lt.height/2,At=we.position.x+je.width/2,us=we.position.y+je.height/2,St=U!==void 0?U:Gv(K,ee,zt,Zt,e,we.position.x,we.position.y,je.width,je.height),at=he!==void 0?he:Gv(ee,K,At,us,e,Ne.position.x,Ne.position.y,lt.width,lt.height),vt={id:`conn-${Date.now()}`,source:K,target:ee,type:"async",sourcePort:St,targetPort:at};i(vt)}}F(!1),ie(null),oe(void 0),G(null)},[N,K,U,t,e,i,B,yt]),Gt=S.useCallback(ee=>{g(ee)},[g]),Pn=S.useCallback((ee,he,we)=>{me({connectionId:ee,x:he,y:we})},[]),Ys=S.useCallback(ee=>{const he=ee.target,we=he.closest?.("[data-node-id]"),Ne=he.closest?.("[data-connection-id]"),je=he instanceof SVGElement,lt=he.closest?.("svg")!==null;if(we||Ne||je||lt)return;const zt=t.filter(Zt=>Zt.selected);zt.length>0&&(ee.preventDefault(),ee.stopPropagation(),be({nodeId:zt[0].id,x:ee.clientX,y:ee.clientY}))},[t]),Ps=S.useCallback(()=>{pe&&(o(pe.connectionId),me(null))},[pe,o]),hn=S.useMemo(()=>t.map(ee=>ee.id).join(","),[t]),Jt=S.useMemo(()=>{const ee=new Map;return t.forEach(he=>{const we=he.id;ee.set(we,{onConnectionStart:Ne=>wt(we,Ne),onConnectionEnd:Ne=>Xt(we,Ne),onContextMenu:(Ne,je)=>be({nodeId:we,x:Ne,y:je})})}),ee},[hn,wt,Xt,t]),Wt=S.useMemo(()=>e.map(ee=>ee.id).join(","),[e]),Nt=S.useMemo(()=>{const ee=new Map;return e.forEach(he=>{const we=he.id;ee.set(we,{onClick:()=>Gt(we),onContextMenu:Ne=>Pn(we,Ne.clientX,Ne.clientY)})}),ee},[Wt,Gt,Pn,e]),Fi=ee=>{if(ee.ctrlKey&&c.current){ee.preventDefault();const{left:he,top:we,width:Ne,height:je}=c.current.getBoundingClientRect(),lt=ee.clientX-he,zt=ee.clientY-we,Zt=(lt-u.x)/r,At=(zt-u.y)/r,us=1+Math.min(Math.max(-ee.deltaY/500,-.5),.5);let St=r*us;St=Math.min(Math.max(St,.3),2.5);const at=lt-Zt*St,vt=zt-At*St;h(St),d({x:at,y:vt})}},_s=20,Jr=ue?24:0,_n=2e3,Qi=r<.5,ci=Ee(ee=>ee.viewportWidth),Xs=Ee(ee=>ee.viewportHeight),Ln=S.useMemo(()=>{if(ci===0||Xs===0)return t;const ee=-u.x/r,he=-u.y/r,we=(ci-u.x)/r,Ne=(Xs-u.y)/r,je=200,lt=ee-je,zt=he-je,Zt=we+je,At=Ne+je;return t.filter(us=>{const St=us.position.x,at=us.position.y;return St+140>=lt&&St<=Zt&&at+100>=zt&&at<=At})},[t,r,u,ci,Xs]),In=S.useMemo(()=>new Set(Ln.map(ee=>ee.id)),[Ln]),Nu=S.useMemo(()=>e.filter(ee=>In.has(ee.source)&&In.has(ee.target)),[e,In]);return y.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[y.jsx(XO,{isVisible:ue,canvasRef:c}),y.jsx("div",{ref:c,className:"absolute overflow-hidden",style:{top:`${Jr}px`,left:`${Jr}px`,right:0,bottom:0,cursor:I?"grabbing":N?"crosshair":"default",backgroundColor:"hsl(var(--muted) / 0.1)"},onDrop:bt,onDragOver:mt,onMouseDown:$t,onMouseMove:et,onMouseUp:It,onMouseLeave:It,onWheel:Fi,onContextMenu:Ys,children:y.jsxs("div",{style:{transform:`translate(${u.x}px, ${u.y}px) scale(${r})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[X.map(ee=>{const he=ee.x*_n,we=ee.y*_n,Ne=X.some(at=>at.x===ee.x+1&&at.y===ee.y),je=X.some(at=>at.x===ee.x&&at.y===ee.y+1),lt=u.x/r,zt=u.y/r,Zt=(-lt%_s+_s)%_s,At=(-zt%_s+_s)%_s,us=he%_s,St=we%_s;return y.jsxs("div",{className:"absolute pointer-events-none",style:{left:`${he}px`,top:`${we}px`,width:`${_n}px`,height:`${_n}px`,backgroundColor:"hsl(var(--canvas-bg))",backgroundImage:`
                  linear-gradient(hsl(var(--canvas-grid)) 1px, transparent 1px),
                  linear-gradient(90deg, hsl(var(--canvas-grid)) 1px, transparent 1px)
                `,backgroundSize:`${_s}px ${_s}px`,backgroundPosition:`${Zt+us}px ${At+St}px`,border:Qi?"2px dashed hsl(var(--border) / 0.6)":"none",boxShadow:Qi?"inset 0 0 0 1px hsl(var(--border) / 0.3)":"none"},children:[Ne&&y.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none z-10",style:{right:0,width:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}}),je&&y.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{bottom:0,height:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}})]},`chunk-${ee.x}-${ee.y}`)}),ot&&y.jsx("div",{className:"absolute border-2 border-primary/60 bg-primary/10 pointer-events-none",style:{left:ot.x,top:ot.y,width:ot.width,height:ot.height}}),y.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"visible"},children:[y.jsxs("defs",{children:[y.jsx("marker",{id:"arrowhead-default",markerWidth:"8",markerHeight:"8",refX:"7",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse",children:y.jsx("path",{d:"M0,0 L0,8 L8,4 z",fill:"hsl(var(--border))",stroke:"none"})}),y.jsx("marker",{id:"arrowhead-selected",markerWidth:"10",markerHeight:"10",refX:"8",refY:"5",orient:"auto",markerUnits:"userSpaceOnUse",children:y.jsx("path",{d:"M0,0 L0,10 L10,5 z",fill:"hsl(var(--primary))",stroke:"none"})}),y.jsx("marker",{id:"arrowhead-bottleneck",markerWidth:"12",markerHeight:"12",refX:"10",refY:"6",orient:"auto",markerUnits:"userSpaceOnUse",children:y.jsx("path",{d:"M0,0 L0,12 L12,6 z",fill:"hsl(0 84% 60%)",stroke:"none"})})]}),s&&s.length>0&&y.jsx("g",{style:{pointerEvents:"auto"},children:s.map(ee=>y.jsx(YO,{group:ee,zoom:r},ee.id))}),y.jsxs("g",{style:{pointerEvents:"auto"},children:[Nu.map(ee=>{const he=t.find(je=>je.id===ee.source),we=t.find(je=>je.id===ee.target);if(!he||!we)return null;const Ne=Nt.get(ee.id);return Ne?y.jsx(DO,{connection:ee,sourceNode:he,targetNode:we,zoom:r,pan:u,isSelected:x===ee.id,onClick:Ne.onClick,onContextMenu:Ne.onContextMenu},ee.id):null}),N&&K&&B&&(()=>{const ee=t.find(je=>je.id===K);if(!ee)return null;const he=yt(K);let we,Ne;if(U!==void 0){const lt=Sa(ee.position.x,ee.position.y,he.width,he.height,16)[U];we=lt.x,Ne=lt.y}else we=ee.position.x+he.width/2,Ne=ee.position.y+he.height/2;return y.jsx("line",{x1:we,y1:Ne,x2:B.x,y2:B.y,stroke:"hsl(var(--primary))",strokeWidth:2/r,strokeDasharray:"5,5",style:{pointerEvents:"none"}})})()]})]}),Ln.map(ee=>{const he=Jt.get(ee.id);return he?y.jsx(RO,{node:ee,onConnectionStart:he.onConnectionStart,onConnectionEnd:he.onConnectionEnd,isConnecting:N,onContextMenu:he.onContextMenu},ee.id):null}),Z&&Ln.map(ee=>y.jsx(IO,{nodeId:ee.id,position:ee.position},`metrics-${ee.id}`))]})}),y.jsx(NO,{isVisible:le}),y.jsx(zO,{isVisible:se}),y.jsx(EO,{selectedNodeId:R,highlightPath:!0}),pe&&y.jsx(t5,{x:pe.x,y:pe.y,onDelete:Ps,onClose:()=>me(null)}),ye&&(()=>{const ee=t.find(Fe=>Fe.id===ye.nodeId);if(!ee)return null;const he=t.filter(Fe=>Fe.selected),we=he.length>1,Ne=()=>{we?(he.forEach(Fe=>{k(Fe.id)}),Ye.success(`${he.length} elements deleted`)):(k(ee.id),Ye.success("Element deleted")),be(null)},je=()=>{if(we)he.forEach((Fe,Ls)=>{const Vi={...Ml(Fe),id:`${Fe.type}_${Date.now()}_${Ls}`,position:{x:Fe.position.x+20+Ls*10,y:Fe.position.y+20+Ls*10},selected:!1};Vi.data?.config&&(Vi.data.config=Ml(Vi.data.config)),n(Vi)}),Ye.success(`${he.length} elements duplicated`);else{const Fe={...Ml(ee),id:`${ee.type}_${Date.now()}`,position:{x:ee.position.x+20,y:ee.position.y+20},selected:!1};Fe.data?.config&&(Fe.data.config=Ml(Fe.data.config)),n(Fe),Ye.success("Element duplicated")}be(null)},lt=()=>{if(we){const Fe=he.map(Ls=>Ls.id).join(", ");navigator.clipboard.writeText(Fe),Ye.success(`${he.length} IDs copied to clipboard`)}else navigator.clipboard.writeText(ee.id),Ye.success("ID copied to clipboard");be(null)},zt=()=>{we?(he.forEach(Fe=>{A(Fe.id)}),Ye.success(`${he.length} elements brought to front`)):(A(ee.id),Ye.success("Brought to front")),be(null)},Zt=()=>{we?(he.forEach(Fe=>{D(Fe.id)}),Ye.success(`${he.length} elements sent to back`)):(D(ee.id),Ye.success("Sent to back")),be(null)},At=()=>{we?(he.forEach(Fe=>{_(Fe.id)}),Ye.success(`${he.length} elements brought forward`)):(_(ee.id),Ye.success("Brought forward")),be(null)},us=()=>{we?(he.forEach(Fe=>{L(Fe.id)}),Ye.success(`${he.length} elements sent backward`)):(L(ee.id),Ye.success("Sent backward")),be(null)},St=()=>{de(we?{nodeId:he[0].id,x:ye.x,y:ye.y}:{nodeId:ee.id,x:ye.x,y:ye.y}),be(null)},at=we?s.filter(Fe=>he.some(Ls=>Fe.nodeIds.includes(Ls.id))):s.filter(Fe=>Fe.nodeIds.includes(ee.id)),vt=at.length>=1,Bt=at.length>=2,fn=()=>{if(we){let Fe=0;he.forEach(Ls=>{s.filter(Eo=>Eo.nodeIds.includes(Ls.id)).forEach(Eo=>{ce(Eo.id,Ls.id),Fe++})}),Fe>0&&Ye.success(`Removed ${he.length} elements from groups`),be(null)}else Bt?(Ue({nodeId:ee.id,x:ye.x,y:ye.y}),be(null)):at.length===1&&(ce(at[0].id,ee.id),Ye.success(`Removed from "${at[0].name}"`),be(null))};return y.jsx(JO,{x:ye.x,y:ye.y,onDelete:Ne,onDuplicate:je,onCopyId:lt,onBringToFront:zt,onSendToBack:Zt,onBringForward:At,onSendBackward:us,onAddToGroup:St,onRemoveFromGroup:vt?fn:void 0,onClose:()=>be(null)})})(),Lt&&y.jsx(ZO,{nodeId:Lt.nodeId,x:Lt.x,y:Lt.y,onClose:()=>de(null)}),$e&&y.jsx(e5,{nodeId:$e.nodeId,x:$e.x,y:$e.y,onClose:()=>Ue(null)})]})}const s5="modulepreload",n5=function(c){return"/"+c},Yv={},Ce=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){let u=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),r=o?.nonce||o?.getAttribute("nonce");n=u(e.map(d=>{if(d=n5(d),d in Yv)return;Yv[d]=!0;const h=d.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":s5,h||(g.as="script"),g.crossOrigin="",g.href=d,r&&g.setAttribute("nonce",r),document.head.appendChild(g),h)return new Promise((v,b)=>{g.addEventListener("load",v),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o}return n.then(o=>{for(const r of o||[])r.status==="rejected"&&i(r.reason);return t().catch(i)})},i5=S.lazy(()=>Ce(()=>import("./KafkaConfigAdvanced-DBBQe9qC.js"),__vite__mapDeps([0,1,2,3,4,5])).then(c=>({default:c.KafkaConfigAdvanced}))),o5=S.lazy(()=>Ce(()=>import("./RabbitMQConfigAdvanced-C1d8RQ9u.js"),__vite__mapDeps([6,1,7,8,9,10,11,12,5,3])).then(c=>({default:c.RabbitMQConfigAdvanced}))),a5=S.lazy(()=>Ce(()=>import("./PostgreSQLConfigAdvanced-BFIVu_4k.js"),__vite__mapDeps([13,2,7,9,8,3,14,15,4,12])).then(c=>({default:c.PostgreSQLConfigAdvanced}))),r5=S.lazy(()=>Ce(()=>import("./MongoDBConfigAdvanced-CseyRXpR.js"),__vite__mapDeps([16,2,7,9,8,3])).then(c=>({default:c.MongoDBConfigAdvanced}))),c5=S.lazy(()=>Ce(()=>import("./RedisConfigAdvanced-DyCm2fhT.js"),__vite__mapDeps([17,2,9,8,3,12,18])).then(c=>({default:c.RedisConfigAdvanced}))),l5=S.lazy(()=>Ce(()=>import("./ElasticsearchConfigAdvanced-CsPESOGm.js"),__vite__mapDeps([19,2,9,20,21,3,5])).then(c=>({default:c.ElasticsearchConfigAdvanced}))),u5=S.lazy(()=>Ce(()=>import("./CassandraConfigAdvanced-DKc2wWaO.js"),__vite__mapDeps([22,1,2,3,15,21])).then(c=>({default:c.CassandraConfigAdvanced}))),d5=S.lazy(()=>Ce(()=>import("./ClickHouseConfigAdvanced-2LkaLoOJ.js"),__vite__mapDeps([23,2,1,7,8,9,24,3,21])).then(c=>({default:c.ClickHouseConfigAdvanced}))),h5=S.lazy(()=>Ce(()=>import("./SnowflakeConfigAdvanced-BRaeV9yi.js"),__vite__mapDeps([25,2,20,3,12])).then(c=>({default:c.SnowflakeConfigAdvanced}))),f5=S.lazy(()=>Ce(()=>import("./S3DataLakeConfigAdvanced-D7SGWMh3.js"),__vite__mapDeps([26,20,12,27])).then(c=>({default:c.S3DataLakeConfigAdvanced}))),p5=S.lazy(()=>Ce(()=>import("./NginxConfigAdvanced-KGoGuud5.js"),__vite__mapDeps([28,2,1,29,30,31,11,5])).then(c=>({default:c.NginxConfigAdvanced}))),g5=S.lazy(()=>Ce(()=>import("./RestApiConfigAdvanced-CBVhF6Kk.js"),__vite__mapDeps([32,2,1,33,9,30,34,35,21])).then(c=>({default:c.RestApiConfigAdvanced}))),m5=S.lazy(()=>Ce(()=>import("./GRPCConfigAdvanced-BD-VIugm.js"),__vite__mapDeps([36,2,9,20,31,37])).then(c=>({default:c.GRPCConfigAdvanced}))),y5=S.lazy(()=>Ce(()=>import("./WebSocketConfigAdvanced-3Z-zTRfT.js"),__vite__mapDeps([38,2,9,20,10,39,40,37,41])).then(c=>({default:c.WebSocketConfigAdvanced}))),v5=S.lazy(()=>Ce(()=>import("./GraphQLConfigAdvanced-B1ObwlCF.js"),__vite__mapDeps([42,2,29,20,3,24,34,37])).then(c=>({default:c.GraphQLConfigAdvanced}))),b5=S.lazy(()=>Ce(()=>import("./SOAPConfigAdvanced-DJ5CY4zC.js"),__vite__mapDeps([43,2,29,20,31,37,5])).then(c=>({default:c.SOAPConfigAdvanced}))),w5=S.lazy(()=>Ce(()=>import("./WebhookConfigAdvanced-BHLPeGkI.js"),__vite__mapDeps([44,2,45,9,20,46,39,37,47,48,35,49])).then(c=>({default:c.WebhookConfigAdvanced}))),x5=S.lazy(()=>Ce(()=>import("./DockerK8sConfigAdvanced-rRwydtTR.js"),__vite__mapDeps([50,2,1,51,9,49,52])).then(c=>({default:c.DockerK8sConfigAdvanced})));S.lazy(()=>Ce(()=>import("./InfrastructureConfig-AIJd4-dd.js"),__vite__mapDeps([53,2])).then(c=>({default:c.InfrastructureConfig})));const M5=S.lazy(()=>Ce(()=>import("./KubernetesConfigAdvanced-BihVehn2.js"),__vite__mapDeps([54,2,9,1,5,3,31,52])).then(c=>({default:c.KubernetesConfigAdvanced}))),S5=S.lazy(()=>Ce(()=>import("./HAProxyConfigAdvanced-q3NxUU2W.js"),__vite__mapDeps([55,9,20,34,37,31,5])).then(c=>({default:c.HAProxyConfigAdvanced}))),C5=S.lazy(()=>Ce(()=>import("./TraefikConfigAdvanced-DYqq7eoj.js"),__vite__mapDeps([56,9,20,57,37,5])).then(c=>({default:c.TraefikConfigAdvanced}))),R5=S.lazy(()=>Ce(()=>import("./EnvoyConfigAdvanced-DHK1oHPN.js"),__vite__mapDeps([58,9,20,31,30,37])).then(c=>({default:c.EnvoyConfigAdvanced}))),E5=S.lazy(()=>Ce(()=>import("./ActiveMQConfigAdvanced-COQSKn1E.js"),__vite__mapDeps([59,1,51,20,10,3,4,5,41])).then(c=>({default:c.ActiveMQConfigAdvanced}))),T5=S.lazy(()=>Ce(()=>import("./AWSSQSConfigAdvanced-Dac8pxwE.js"),__vite__mapDeps([60,1,20,61,10,12,5,39])).then(c=>({default:c.AWSSQSConfigAdvanced}))),k5=S.lazy(()=>Ce(()=>import("./AzureServiceBusConfigAdvanced-CtFGwilA.js"),__vite__mapDeps([62,2,10,12])).then(c=>({default:c.AzureServiceBusConfigAdvanced}))),A5=S.lazy(()=>Ce(()=>import("./GCPPubSubConfigAdvanced-DHGc6Kg7.js"),__vite__mapDeps([63,2,10,4,12])).then(c=>({default:c.GCPPubSubConfigAdvanced}))),D5=S.lazy(()=>Ce(()=>import("./KongConfigAdvanced-BqOJbMwP.js"),__vite__mapDeps([64,2,9,31,57,4])).then(c=>({default:c.KongConfigAdvanced}))),P5=S.lazy(()=>Ce(()=>import("./ApigeeConfigAdvanced-D1axFas0.js"),__vite__mapDeps([65,1,5])).then(c=>({default:c.ApigeeConfigAdvanced}))),_5=S.lazy(()=>Ce(()=>import("./MuleSoftConfigAdvanced-Cr97L_eA.js"),__vite__mapDeps([66,1,3,37])).then(c=>({default:c.MuleSoftConfigAdvanced}))),L5=S.lazy(()=>Ce(()=>import("./GraphQLGatewayConfigAdvanced-CyZUFkIo.js"),__vite__mapDeps([67,37,30])).then(c=>({default:c.GraphQLGatewayConfigAdvanced}))),I5=S.lazy(()=>Ce(()=>import("./BFFServiceConfigAdvanced-CWBA0KKe.js"),__vite__mapDeps([68,20])).then(c=>({default:c.BFFServiceConfigAdvanced}))),N5=S.lazy(()=>Ce(()=>import("./WebhookRelayConfigAdvanced-CS1B1PnY.js"),__vite__mapDeps([69,2,51,20,46,39,37,35])).then(c=>({default:c.WebhookRelayConfigAdvanced}))),z5=S.lazy(()=>Ce(()=>import("./PrometheusConfigAdvanced-JKn_kOTV.js"),__vite__mapDeps([70,2,9,52])).then(c=>({default:c.PrometheusConfigAdvanced}))),j5=S.lazy(()=>Ce(()=>import("./GrafanaConfigAdvanced-BBpv7EME.js"),__vite__mapDeps([71,24,47,72,2,3])).then(c=>({default:c.GrafanaConfigAdvanced}))),O5=S.lazy(()=>Ce(()=>import("./LokiConfigAdvanced-BPG1gAhu.js"),__vite__mapDeps([73,2,41])).then(c=>({default:c.LokiConfigAdvanced}))),q5=S.lazy(()=>Ce(()=>import("./JaegerConfigAdvanced-Bz-BYrz6.js"),__vite__mapDeps([74,1,75])).then(c=>({default:c.JaegerConfigAdvanced}))),H5=S.lazy(()=>Ce(()=>import("./OpenTelemetryCollectorConfigAdvanced-YW7GCkK3.js"),__vite__mapDeps([76,1,20,11])).then(c=>({default:c.OpenTelemetryCollectorConfigAdvanced}))),$5=S.lazy(()=>Ce(()=>import("./PagerDutyConfigAdvanced-B7up574-.js"),__vite__mapDeps([77,20,4,40,35])).then(c=>({default:c.PagerDutyConfigAdvanced}))),B5=S.lazy(()=>Ce(()=>import("./KeycloakConfigAdvanced-CjEHMAMi.js"),__vite__mapDeps([78,2,29,5,30,12,4,35,79,80,81])).then(c=>({default:c.KeycloakConfigAdvanced}))),U5=S.lazy(()=>Ce(()=>import("./WAFConfigAdvanced-riPlqZN-.js"),__vite__mapDeps([82,29,20,5,30,37])).then(c=>({default:c.WAFConfigAdvanced}))),F5=S.lazy(()=>Ce(()=>import("./SecretsVaultConfigAdvanced-FJY9L6IF.js"),__vite__mapDeps([83,29,2,20,12,3,5,79,81,37])).then(c=>({default:c.SecretsVaultConfigAdvanced}))),Q5=S.lazy(()=>Ce(()=>import("./IDSIPSConfigAdvanced-DgkNhfjH.js"),__vite__mapDeps([84,29,20,5,37])).then(c=>({default:c.IDSIPSConfigAdvanced}))),V5=S.lazy(()=>Ce(()=>import("./FirewallConfigAdvanced-2GjTzR6M.js"),__vite__mapDeps([85,51,29,20,5,37,34])).then(c=>({default:c.FirewallConfigAdvanced}))),G5=S.lazy(()=>Ce(()=>import("./JenkinsConfigAdvanced-BeLrkZqM.js"),__vite__mapDeps([86,1,2,29,75,87,31,4,24,34,47,48,35,72,49])).then(c=>({default:c.JenkinsConfigAdvanced}))),W5=S.lazy(()=>Ce(()=>import("./GitLabCIConfigAdvanced-Su2RjTvi.js"),__vite__mapDeps([88,1,29,75,21,31,3,30,89,35])).then(c=>({default:c.GitLabCIConfigAdvanced}))),K5=S.lazy(()=>Ce(()=>import("./ArgoCDConfigAdvanced-DgTIZvI0.js"),__vite__mapDeps([90,1,2,29,3,91,5,40,75,35])).then(c=>({default:c.ArgoCDConfigAdvanced}))),Y5=S.lazy(()=>Ce(()=>import("./HarborConfigAdvanced-C8FtAHfr.js"),__vite__mapDeps([92,9,87,27,4,5])).then(c=>({default:c.HarborConfigAdvanced}))),X5=S.lazy(()=>Ce(()=>import("./TerraformConfigAdvanced-BaXadPJn.js"),__vite__mapDeps([93,29,2,20,37,61,35])).then(c=>({default:c.TerraformConfigAdvanced}))),J5=S.lazy(()=>Ce(()=>import("./AnsibleConfigAdvanced-BBIgKuBq.js"),__vite__mapDeps([94,29,2,20,31,37,91,12,89,35])).then(c=>({default:c.AnsibleConfigAdvanced}))),Z5=S.lazy(()=>Ce(()=>import("./IstioConfigAdvanced-DAfSfxAw.js"),__vite__mapDeps([95,51,2,20,57,30,5])).then(c=>({default:c.IstioConfigAdvanced}))),e3=S.lazy(()=>Ce(()=>import("./ServiceMeshConfigAdvanced-BWdWaXA6.js"),__vite__mapDeps([96,51,2,9,20,57,30,5])).then(c=>({default:c.ServiceMeshConfigAdvanced}))),t3=S.lazy(()=>Ce(()=>import("./APIGatewayConfigAdvanced-BtGuDEiB.js"),__vite__mapDeps([97,2,9,20,61,30,5,34,87,12,31,14,4,57])).then(c=>({default:c.APIGatewayConfigAdvanced}))),s3=S.lazy(()=>Ce(()=>import("./VPNConfigAdvanced-DkduuzOi.js"),__vite__mapDeps([98,9,20,4,79,35])).then(c=>({default:c.VPNConfigAdvanced}))),n3=S.lazy(()=>Ce(()=>import("./CDNConfigAdvanced-DMKWTKIJ.js"),__vite__mapDeps([99,29,45,20,30,34])).then(c=>({default:c.CDNConfigAdvanced}))),i3=S.lazy(()=>Ce(()=>import("./SparkConfigAdvanced-B3qd8QQX.js"),__vite__mapDeps([100,2,1,33,29,20,3,21,35,52,18,24,37,47,48])).then(c=>({default:c.SparkConfigAdvanced}))),o3=S.lazy(()=>Ce(()=>import("./TensorFlowServingConfigAdvanced-CgXI8caj.js"),__vite__mapDeps([101,2,29,20,3,24,37,47,48])).then(c=>({default:c.TensorFlowServingConfigAdvanced}))),a3=S.lazy(()=>Ce(()=>import("./PyTorchServeConfigAdvanced-NqOp9zxf.js"),__vite__mapDeps([102,2,9,20,3,37])).then(c=>({default:c.PyTorchServeConfigAdvanced}))),r3=S.lazy(()=>Ce(()=>import("./FeatureStoreConfigAdvanced-DerSXJ50.js"),__vite__mapDeps([103,2,29,20,87,3,34,31])).then(c=>({default:c.FeatureStoreConfigAdvanced}))),c3=S.lazy(()=>Ce(()=>import("./CRMConfigAdvanced-Bwyx7zog.js"),__vite__mapDeps([104,20,4,105,34,106,80])).then(c=>({default:c.CRMConfigAdvanced}))),l3=S.lazy(()=>Ce(()=>import("./ERPConfigAdvanced-Dgw6tJY8.js"),__vite__mapDeps([107,20,87,105,34,106])).then(c=>({default:c.ERPConfigAdvanced}))),u3=S.lazy(()=>Ce(()=>import("./RPABotConfigAdvanced-MsWa7WOm.js"),__vite__mapDeps([108,20,34,37,35])).then(c=>({default:c.RPABotConfigAdvanced}))),d3=S.lazy(()=>Ce(()=>import("./BPMNEngineConfigAdvanced-BeenqPqi.js"),__vite__mapDeps([109,20,37,35,4])).then(c=>({default:c.BPMNEngineConfigAdvanced}))),h3=S.lazy(()=>Ce(()=>import("./PaymentGatewayConfigAdvanced-B4O88Bjb.js"),__vite__mapDeps([110,20,105,34,5,37,35])).then(c=>({default:c.PaymentGatewayConfigAdvanced}))),f3=()=>y.jsx("div",{className:"flex items-center justify-center h-full",children:y.jsx("div",{className:"text-muted-foreground",children:"Loading configuration..."})});function p3({componentId:c,componentType:t}){const e=()=>{switch(t){case"kafka":return y.jsx(i5,{componentId:c});case"rabbitmq":return y.jsx(o5,{componentId:c});case"postgres":return y.jsx(a5,{componentId:c});case"mongodb":return y.jsx(r5,{componentId:c});case"redis":return y.jsx(c5,{componentId:c});case"elasticsearch":return y.jsx(l5,{componentId:c});case"cassandra":return y.jsx(u5,{componentId:c});case"clickhouse":return y.jsx(d5,{componentId:c});case"snowflake":return y.jsx(h5,{componentId:c});case"s3-datalake":return y.jsx(f5,{componentId:c});case"nginx":return y.jsx(p5,{componentId:c});case"rest":return y.jsx(g5,{componentId:c});case"grpc":return y.jsx(m5,{componentId:c});case"websocket":return y.jsx(y5,{componentId:c});case"graphql":return y.jsx(v5,{componentId:c});case"soap":return y.jsx(b5,{componentId:c});case"webhook":return y.jsx(w5,{componentId:c});case"docker":return y.jsx(x5,{componentId:c});case"kubernetes":return y.jsx(M5,{componentId:c});case"haproxy":return y.jsx(S5,{componentId:c});case"traefik":return y.jsx(C5,{componentId:c});case"envoy":return y.jsx(R5,{componentId:c});case"activemq":return y.jsx(E5,{componentId:c});case"aws-sqs":return y.jsx(T5,{componentId:c});case"azure-service-bus":return y.jsx(k5,{componentId:c});case"gcp-pubsub":return y.jsx(A5,{componentId:c});case"kong":return y.jsx(D5,{componentId:c});case"apigee":return y.jsx(P5,{componentId:c});case"mulesoft":return y.jsx(_5,{componentId:c});case"graphql-gateway":return y.jsx(L5,{componentId:c});case"bff-service":return y.jsx(I5,{componentId:c});case"webhook-relay":return y.jsx(N5,{componentId:c});case"prometheus":return y.jsx(z5,{componentId:c});case"grafana":return y.jsx(j5,{componentId:c});case"loki":return y.jsx(O5,{componentId:c});case"jaeger":return y.jsx(q5,{componentId:c});case"otel-collector":return y.jsx(H5,{componentId:c});case"pagerduty":return y.jsx($5,{componentId:c});case"keycloak":return y.jsx(B5,{componentId:c});case"waf":return y.jsx(U5,{componentId:c});case"firewall":return y.jsx(V5,{componentId:c});case"secrets-vault":return y.jsx(F5,{componentId:c});case"ids-ips":return y.jsx(Q5,{componentId:c});case"jenkins":return y.jsx(G5,{componentId:c});case"gitlab-ci":return y.jsx(W5,{componentId:c});case"argo-cd":return y.jsx(K5,{componentId:c});case"terraform":return y.jsx(X5,{componentId:c});case"ansible":return y.jsx(J5,{componentId:c});case"harbor":return y.jsx(Y5,{componentId:c});case"istio":return y.jsx(Z5,{componentId:c});case"service-mesh":return y.jsx(e3,{componentId:c});case"api-gateway":return y.jsx(t3,{componentId:c});case"vpn":return y.jsx(s3,{componentId:c});case"cdn":return y.jsx(n3,{componentId:c});case"spark":return y.jsx(i3,{componentId:c});case"tensorflow-serving":return y.jsx(o3,{componentId:c});case"pytorch-serve":return y.jsx(a3,{componentId:c});case"feature-store":return y.jsx(r3,{componentId:c});case"crm":return y.jsx(c3,{componentId:c});case"erp":return y.jsx(l3,{componentId:c});case"rpa-bot":return y.jsx(u3,{componentId:c});case"bpmn-engine":return y.jsx(d3,{componentId:c});case"payment-gateway":return y.jsx(h3,{componentId:c});default:return y.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"Configuration panel not available for this component type"})}};return y.jsx(S.Suspense,{fallback:y.jsx(f3,{}),children:e()})}function g3(){const{undo:c,redo:t,zoom:e,setZoom:s,pan:n,setPan:i,resetCanvas:o,saveDiagram:r,selectedConnectionId:u,selectedNodeId:d,selectedGroupId:h,nodes:p,deleteConnection:g,deleteNode:v,deleteGroup:b,selectConnection:x,selectNode:R,selectGroup:C}=Ee(),{canUndo:k,canRedo:T}=Ar(),{isRunning:A,start:D,stop:_}=_t(),{showMinimap:L,toggleMinimap:O,showHeatMapLegend:X,toggleHeatMapLegend:te}=Br();S.useEffect(()=>{const ce=Z=>{const se=Z.ctrlKey||Z.metaKey;if(se&&Z.key==="z"&&!Z.shiftKey&&k){Z.preventDefault(),c();return}if(se&&(Z.key==="z"&&Z.shiftKey||Z.key==="y")&&T){Z.preventDefault(),t();return}if(se&&(Z.key==="="||Z.key==="+")){Z.preventDefault(),s(Math.min(e+.1,2));return}if(se&&Z.key==="-"){Z.preventDefault(),s(Math.max(e-.1,.5));return}if(se&&Z.key==="0"){Z.preventDefault(),s(1),i({x:0,y:0});return}const le=50;if(!se){if(Z.key==="ArrowLeft"){Z.preventDefault(),i({x:n.x+le,y:n.y});return}if(Z.key==="ArrowRight"){Z.preventDefault(),i({x:n.x-le,y:n.y});return}if(Z.key==="ArrowUp"){Z.preventDefault(),i({x:n.x,y:n.y+le});return}if(Z.key==="ArrowDown"){Z.preventDefault(),i({x:n.x,y:n.y-le});return}}if(!se&&Z.key===" "){const ue=Z.target;if(!ue){if(Z.preventDefault(),A)_();else{const{nodes:Y,connections:fe}=Ee.getState();_t.getState().initialize(Y,fe),D()}return}const z=ue.tagName;if(z==="INPUT"||z==="TEXTAREA"||z==="SELECT"||ue.isContentEditable||ue.closest('input, textarea, select, [contenteditable="true"]'))return;const q=ue.getAttribute("role");if(q==="textbox"||q==="combobox"||q==="searchbox"||q==="spinbutton"||ue.closest("[data-radix-select-trigger], [data-radix-select-content], [data-radix-select-viewport]"))return;if(Z.preventDefault(),A)_();else{const{nodes:Y,connections:fe}=Ee.getState();_t.getState().initialize(Y,fe),D()}return}if(se&&(Z.key==="s"||Z.key==="")){Z.preventDefault(),r();return}if(se&&(Z.key==="m"||Z.key==="")){Z.preventDefault(),O();return}if(se&&(Z.key==="h"||Z.key==="")){Z.preventDefault(),te();return}if((Z.key==="Delete"||Z.key==="Backspace")&&!se){const ue=document.activeElement;if(ue){const I=ue.tagName;if(I==="INPUT"||I==="TEXTAREA"||I==="SELECT"||ue.isContentEditable)return;const q=ue.getAttribute("role");if(q==="textbox"||q==="combobox"||q==="searchbox"||q==="spinbutton")return;const Y=ue.closest("form")!==null,fe=ue.closest('[role="textbox"], [role="combobox"], [contenteditable="true"]')!==null,N=ue.closest("[data-radix-select-trigger], [data-radix-select-content]")!==null,F=ue.closest('[role="dialog"]')!==null;if(Y||fe||N||F)return}if(Z.preventDefault(),u){g(u),x(null);return}if(h){b(h),C(null);return}const z=p.filter(I=>I.selected);if(z.length>0){z.forEach(I=>v(I.id)),R(null);return}if(d){v(d),R(null);return}}};return window.addEventListener("keydown",ce),()=>{window.removeEventListener("keydown",ce)}},[c,t,k,T,e,s,n,i,o,r,A,D,_,L,O,X,te,u,d,h,p,g,v,b,x,R,C])}class Cl extends S.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,e){ii("ErrorBoundary caught an error",t,{componentStack:e.componentStack}),this.setState({error:t,errorInfo:e}),this.props.onError&&this.props.onError(t,e)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:y.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:y.jsxs(ws,{className:"w-full max-w-2xl",children:[y.jsxs(Sn,{children:[y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx(on,{className:"h-5 w-5 text-destructive"}),y.jsx(Cn,{children:"-   "})]}),y.jsx(mo,{children:"    "})]}),y.jsxs(Rn,{className:"space-y-4",children:[this.state.error&&y.jsxs("div",{className:"space-y-2",children:[y.jsx("p",{className:"text-sm font-semibold text-foreground",children:":"}),y.jsx("pre",{className:"text-xs bg-muted p-3 rounded-md overflow-auto max-h-48",children:this.state.error.toString()})]}),!1,y.jsxs("div",{className:"flex gap-2",children:[y.jsxs(ke,{onClick:this.handleReset,variant:"default",children:[y.jsx(_D,{className:"h-4 w-4 mr-2"})," "]}),y.jsx(ke,{onClick:()=>window.location.reload(),variant:"outline",children:" "})]})]})]})}):this.props.children}}function m3(){g3();const{tabs:c}=Ru(),t=c.find(e=>e.active);return y.jsx(Cl,{children:y.jsx(kO,{children:y.jsx(SO,{children:y.jsxs("div",{className:"h-screen flex flex-col bg-background",children:[y.jsx(DL,{}),y.jsx(bO,{}),y.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[y.jsx(Cl,{children:y.jsx(NN,{})}),y.jsx(Cl,{children:t?.type==="diagram"?y.jsx(Kv,{}):t?.type==="component"&&t.componentId&&t.componentType?y.jsx("div",{className:"flex-1 overflow-hidden",children:y.jsx(p3,{componentId:t.componentId,componentType:t.componentType})}):y.jsx(Kv,{})}),y.jsx(Cl,{children:y.jsx(vO,{})})]})]})})})})}LR.createRoot(document.getElementById("root")).render(y.jsxs(Tt.StrictMode,{children:[y.jsx(xE,{position:"top-right"}),y.jsx(m3,{})]}));export{w3 as $,vo as A,ft as B,ws as C,mp as D,Pe as E,dv as F,y3 as G,Fz as H,kt as I,Vz as J,$r as K,it as L,aD as M,RD as N,Pb as O,ql as P,Db as Q,xD as R,bs as S,bp as T,QD as U,ve as V,Lb as W,_t as X,an as Y,zb as Z,Gw as _,gu as a,dp as a0,Kw as a1,hp as a2,fp as a3,Yw as a4,gp as a5,pp as a6,Jl as a7,Xf as a8,go as a9,xu as aA,Qr as aB,Ur as aC,Ap as aD,S3 as aE,Dp as aF,qf as aG,rb as aH,Tt as aI,Ff as aJ,is as aK,ii as aL,x3 as aM,FA as aN,hu as aO,Ea as aP,on as aa,iD as ab,eP as ac,Te as ad,Of as ae,Ib as af,Ab as ag,Jf as ah,SD as ai,_D as aj,jD as ak,_b as al,tC as am,yo as an,Uf as ao,v3 as ap,En as aq,xs as ar,rn as as,De as at,ge as au,ls as av,Le as aw,as as ax,Aa as ay,kp as az,sn as b,$D as c,si as d,Sn as e,Cn as f,b3 as g,mo as h,ke as i,y as j,Rn as k,bo as l,Zl as m,_l as n,Dr as o,Ll as p,Pr as q,S as r,Qt as s,po as t,Ee as u,ru as v,cu as w,uu as x,du as y,lu as z};
