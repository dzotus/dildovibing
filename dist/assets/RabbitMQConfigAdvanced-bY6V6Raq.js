import{K as ts,u as ds,a as os,r as u,j as e,e as ce,B as f,S as Ae,T as xs,b as hs,c as W,D as ms,A as ge,f as _,C as b,h as M,i as R,k as L,l as h,P as te,m as A,I as t,d as De,o as de,L as i,x as z,q as w,s as E,t as k,v as T,w as c,n as V}from"./index-HDGrDyRq.js";import{P as Be}from"./progress-DX86yUno.js";import{T as j,a as g,b as p,c as v}from"./tooltip-B60CeQc-.js";import{u as us}from"./usePortValidation-DV6YP6En.js";import{v as js}from"./requiredFields-BLgUUVkB.js";import{s as H,a as pe}from"./toast-CFyeuGtH.js";import{M as ve}from"./message-square-Bx--DnvZ.js";import{A as fe}from"./arrow-right-left-DK_rIAqd.js";import{K as Ie}from"./key-CMmIYHBN.js";import{S as Ke}from"./shield-DzL7mY-o.js";const gs=[["path",{d:"M13 16a3 3 0 0 1 2.24 5",key:"1epib5"}],["path",{d:"M18 12h.01",key:"yjnet6"}],["path",{d:"M18 21h-8a4 4 0 0 1-4-4 7 7 0 0 1 7-7h.2L9.6 6.4a1 1 0 1 1 2.8-2.8L15.8 7h.2c3.3 0 6 2.7 6 6v1a2 2 0 0 1-2 2h-1a3 3 0 0 0-3 3",key:"ue9ozu"}],["path",{d:"M20 8.54V4a2 2 0 1 0-4 0v3",key:"49iql8"}],["path",{d:"M7.612 12.524a3 3 0 1 0-1.6 4.3",key:"1e33i0"}]],ps=ts("rabbit",gs);function Qs({componentId:S}){const{nodes:Z,updateNode:oe,connections:xe}=ds(),{isRunning:Ne}=os(),Q=Z.find(s=>s.id===S),q=u.useRef(Q);if(u.useEffect(()=>{q.current=Q},[Q]),!Q)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const C=Q.data.config||{},ee=C.host||"localhost",se=C.port||5672,Fe=C.username||"guest",Ve=C.password||"",ze=C.vhost||"/",o=C.queues||[],ye=C.consumptionRate??10,be=C.processingTime??100,d=C.exchanges||[{name:"amq.direct",type:"direct",durable:!0,autoDelete:!1,internal:!1},{name:"amq.topic",type:"topic",durable:!0,autoDelete:!1,internal:!1},{name:"amq.fanout",type:"fanout",durable:!0,autoDelete:!1,internal:!1}],O=C.bindings||[],I=C.policies||[],{portError:X,hostError:G,portConflict:J}=us(Z,S,ee,se),Ce=xe.some(s=>s.source===S||s.target===S),[we,Ee]=u.useState(null),[He,he]=u.useState(!1),[Oe,me]=u.useState(!1),[Ue,ue]=u.useState(!1),[K,ae]=u.useState({name:"",type:"direct"}),[r,U]=u.useState({source:d[0]?.name||"",destination:o[0]?.name||"",routingKey:"",xMatch:"all"}),[P,Y]=u.useState({name:"",pattern:".*",applyTo:"all"}),[$e,je]=u.useState(null),[ke,We]=u.useState(""),[Te,_e]=u.useState(""),[ne,Xe]=u.useState(""),[le,Ge]=u.useState("");u.useEffect(()=>{if(!Q||o.length===0||!Ne)return;const s=setInterval(()=>{const l=ce.getRabbitMQRoutingEngine(S);if(!l)return;const n=l.getAllQueueMetrics(),a=q.current?.data.config||{},m=a.queues||[],y=m.map(F=>{const B=n.get(F.name);return B?{...F,messages:B.messages,ready:B.ready,unacked:B.unacked,consumers:B.consumers}:F});y.some((F,B)=>F.messages!==m[B]?.messages||F.ready!==m[B]?.ready||F.unacked!==m[B]?.unacked||F.consumers!==m[B]?.consumers)&&q.current&&oe(S,{data:{...q.current.data,config:{...a,queues:y}}})},500);return()=>clearInterval(s)},[S,o.length,Q?.id,oe,Ne]),u.useEffect(()=>{if(!Q)return;const s=ce.getRabbitMQRoutingEngine(S);if(!s)return;const l=Q.data.config||{};s.initialize({queues:l.queues||[],exchanges:l.exchanges||[],bindings:l.bindings||[],consumptionRate:l.consumptionRate??10,processingTime:l.processingTime??100}),l.consumptionRate!==void 0||l.processingTime,ce.updateNodesAndConnections(Z,xe)},[S,o.length,d.length,O.length,ye,be,Q?.id,Z,xe]);const Je=(s,l)=>{const n=ce.getRabbitMQRoutingEngine(S);n&&n.updateQueue(s,{consumers:l})},x=s=>{if(oe(S,{data:{...Q.data,config:{...C,...s}}}),Object.keys(s).some(l=>["host","port"].includes(l))){const l={...D};Object.keys(s).forEach(n=>{l[n]&&delete l[n]}),Se(l)}},[D,Se]=u.useState({}),Ye=[{field:"host",label:"Host"},{field:"port",label:"Port",validator:s=>typeof s=="number"&&s>0&&s<=65535}],Qe=()=>{const s=js({host:ee,port:se},Ye);return Se(s.errors),s.isValid},Ze=()=>{x({queues:[...o,{name:"new-queue",durable:!0,exclusive:!1,autoDelete:!1,messages:0,consumers:0,ready:0,unacked:0}]})},qe=s=>{x({queues:o.filter((l,n)=>n!==s)})},N=(s,l,n)=>{const a=[...o];a[s]={...a[s],[l]:n},x({queues:a}),l==="consumers"&&typeof n=="number"&&Je(a[s].name,n)},es=()=>{if(!K.name.trim()){H("Имя exchange не может быть пустым");return}if(d.some(l=>l.name===K.name.trim())){H("Exchange с таким именем уже существует");return}const s={name:K.name.trim(),type:K.type,durable:!0,autoDelete:!1,internal:!1};x({exchanges:[...d,s]}),he(!1),ae({name:"",type:"direct"}),pe("Exchange создан")},ss=s=>{x({exchanges:d.filter((l,n)=>n!==s)})},$=(s,l,n)=>{const a=[...d];a[s]={...a[s],[l]:n},x({exchanges:a})},ie=s=>{if(!s)return{valid:!0};if(s.includes("**"))return{valid:!1,warning:"Invalid: consecutive wildcards (**) are not allowed"};if(s.startsWith("*")||s.startsWith("#"))return{valid:!1,warning:"Warning: wildcard at the start may not match as expected"};const l=s.indexOf("#");return l!==-1&&l!==s.length-1?{valid:!1,warning:"Invalid: # wildcard must be at the end of the pattern"}:(s.match(/#/g)||[]).length>1?{valid:!1,warning:"Invalid: only one # wildcard is allowed and must be at the end"}:{valid:!0}},as=(s,l)=>d.find(m=>m.name===s)?o.find(m=>m.name===l)?{valid:!0}:{valid:!1,error:`Queue "${l}" does not exist`}:{valid:!1,error:`Exchange "${s}" does not exist`},ns=()=>{if(!r.source||!r.destination){H("Необходимо выбрать exchange и queue");return}const s=as(r.source,r.destination);if(!s.valid){H(s.error||"Invalid binding");return}const l=d.find(a=>a.name===r.source);if(l?.type==="topic"&&r.routingKey){const a=ie(r.routingKey);if(!a.valid){H(a.warning||"Invalid routing key");return}}const n={id:`binding-${Date.now()}`,source:r.source,destination:r.destination,routingKey:r.routingKey||"",arguments:l?.type==="headers"&&r.xMatch?{"x-match":r.xMatch}:void 0};x({bindings:[...O,n]}),me(!1),U({source:d[0]?.name||"",destination:o[0]?.name||"",routingKey:"",xMatch:"all"}),pe("Binding создан")},ls=s=>{x({bindings:O.filter(l=>l.id!==s)})},Pe=(s,l,n)=>{const a=O.map(m=>m.id===s?{...m,[l]:n}:m);x({bindings:a})},is=()=>{if(!P.name.trim()){H("Имя policy не может быть пустым");return}if(I.some(l=>l.name===P.name.trim())){H("Policy с таким именем уже существует");return}const s={name:P.name.trim(),pattern:P.pattern||".*",definition:{},priority:0,applyTo:P.applyTo};x({policies:[...I,s]}),ue(!1),Y({name:"",pattern:".*",applyTo:"all"}),pe("Policy создана")},re=(s,l,n)=>{const a=[...I];a[s]={...a[s],[l]:n},x({policies:a})},rs=s=>{x({policies:I.filter((l,n)=>n!==s)})};o.reduce((s,l)=>s+(l.messages||0),0),o.reduce((s,l)=>s+(l.consumers||0),0);const Me=o.filter(s=>s.name.toLowerCase().includes(ke.toLowerCase())),cs=d.filter(s=>s.name.toLowerCase().includes(Te.toLowerCase())),Re=O.filter(s=>!(ne&&ne!=="all"&&s.source!==ne)),Le=I.filter(s=>!(le&&le!=="all"&&s.applyTo!==le));return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(ps,{className:"h-6 w-6 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"RabbitMQ"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Message Broker Management"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(f,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${Ce?"bg-green-500 animate-pulse":"bg-gray-400"}`}),Ce?"Connected":"Not Connected"]})})]}),e.jsx(Ae,{}),e.jsxs(xs,{defaultValue:"queues",className:"w-full",children:[e.jsxs(hs,{className:"flex w-full flex-wrap gap-1",children:[e.jsxs(W,{value:"queues",className:"gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Queues"]}),e.jsxs(W,{value:"exchanges",className:"gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Exchanges"]}),e.jsxs(W,{value:"bindings",className:"gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Bindings"]}),e.jsxs(W,{value:"policies",className:"gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),"Policies"]}),e.jsxs(W,{value:"connection",className:"gap-2",children:[e.jsx(ms,{className:"h-4 w-4"}),"Connection"]}),e.jsxs(W,{value:"monitoring",className:"gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Monitoring"]})]}),e.jsx(_,{value:"queues",className:"space-y-4 mt-4",children:e.jsxs(b,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Message Queues"}),e.jsx(L,{children:"Configure and monitor RabbitMQ queues"})]}),e.jsxs(h,{size:"sm",onClick:Ze,variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Queue"]})]})}),e.jsxs(A,{children:[o.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(t,{placeholder:"Search queues...",value:ke,onChange:s=>We(s.target.value),className:"max-w-sm"})}),Me.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No queues configured"}),e.jsx("p",{className:"text-xs mt-2",children:'Click "Add Queue" to create a new queue'})]}):e.jsx("div",{className:"space-y-4",children:Me.map((s,l)=>{const n=o.findIndex(a=>a.name===s.name);return e.jsxs(b,{className:"border-border",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(ve,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(R,{className:"text-lg",children:s.name}),e.jsxs(L,{className:"text-xs mt-1 flex items-center gap-2",children:[s.durable&&e.jsx(f,{variant:"outline",className:"text-xs",children:"Durable"}),s.exclusive&&e.jsx(f,{variant:"outline",className:"text-xs",children:"Exclusive"}),s.autoDelete&&e.jsx(f,{variant:"outline",className:"text-xs",children:"Auto-Delete"}),s.maxLength?s.messages&&s.messages>=s.maxLength?e.jsx(f,{variant:"destructive",className:"text-xs",children:"Full"}):s.messages&&s.messages>=s.maxLength*.8?e.jsx(f,{variant:"outline",className:"text-xs text-amber-600",children:"Warning"}):s.messages===0?e.jsx(f,{variant:"outline",className:"text-xs text-gray-500",children:"Empty"}):e.jsx(f,{variant:"outline",className:"text-xs text-green-600",children:"Normal"}):s.messages===0?e.jsx(f,{variant:"outline",className:"text-xs text-gray-500",children:"Empty"}):e.jsx(f,{variant:"outline",className:"text-xs text-green-600",children:"Normal"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>Ee(we===n?null:n),children:e.jsx(De,{className:"h-4 w-4"})}),o.length>1&&e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>qe(n),children:e.jsx(de,{className:"h-4 w-4"})})]})]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Queue Name"}),e.jsx(t,{value:s.name,onChange:a=>N(n,"name",a.target.value),placeholder:"queue-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Properties"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.durable,onCheckedChange:a=>{a&&s.exclusive&&N(n,"exclusive",!1),N(n,"durable",a)},disabled:s.exclusive}),e.jsx(i,{className:"text-xs",children:"Durable"})]})}),e.jsx(v,{children:e.jsx("p",{children:"Queue survives broker restart"})})]})})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.exclusive,onCheckedChange:a=>{a&&N(n,"durable",!1),N(n,"exclusive",a)}}),e.jsx(i,{className:"text-xs",children:"Exclusive"})]})}),e.jsx(v,{children:e.jsx("p",{children:"Queue can only be used by one connection"})})]})})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.autoDelete,onCheckedChange:a=>N(n,"autoDelete",a)}),e.jsx(i,{className:"text-xs",children:"Auto-Delete"})]})}),e.jsx(v,{children:e.jsx("p",{children:"Queue is deleted when no longer in use"})})]})})})]})]})]}),we===n&&e.jsxs("div",{className:"pt-4 border-t border-border space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Advanced Configuration"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Ee(null),children:"Done"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Dead Letter Exchange"})}),e.jsx(v,{children:e.jsx("p",{children:"Exchange to send rejected/expired messages to"})})]})}),e.jsx(t,{value:s.deadLetterExchange||"",onChange:a=>N(n,"deadLetterExchange",a.target.value),placeholder:"dlx"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Dead Letter Routing Key"})}),e.jsx(v,{children:e.jsx("p",{children:"Routing key for messages sent to DLX"})})]})}),e.jsx(t,{value:s.deadLetterRoutingKey||"",onChange:a=>N(n,"deadLetterRoutingKey",a.target.value),placeholder:"routing-key"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Message TTL (ms)"})}),e.jsx(v,{children:e.jsx("p",{children:"Time to live for messages in milliseconds"})})]})}),e.jsx(t,{type:"number",value:s.messageTtl||"",onChange:a=>N(n,"messageTtl",parseInt(a.target.value)||void 0),placeholder:"60000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Max Length"})}),e.jsx(v,{children:e.jsx("p",{children:"Maximum number of messages in queue"})})]})}),e.jsx(t,{type:"number",value:s.maxLength||"",onChange:a=>N(n,"maxLength",parseInt(a.target.value)||void 0),placeholder:"10000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Max Priority"})}),e.jsx(v,{children:e.jsx("p",{children:"Maximum priority level (0-255)"})})]})}),e.jsx(t,{type:"number",min:"0",max:"255",value:s.maxPriority||"",onChange:a=>N(n,"maxPriority",parseInt(a.target.value)||void 0),placeholder:"10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Consumers"}),e.jsx(t,{type:"number",min:"0",value:s.consumers||0,onChange:a=>N(n,"consumers",parseInt(a.target.value)||0),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Queue Type (x-queue-type)"})}),e.jsx(v,{children:e.jsx("p",{children:"classic: standard queue, quorum: replicated queue, stream: message stream"})})]})}),e.jsxs(w,{value:s.queueType||"classic",onValueChange:a=>N(n,"queueType",a),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"classic",children:"Classic"}),e.jsx(c,{value:"quorum",children:"Quorum"}),e.jsx(c,{value:"stream",children:"Stream"})]})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.singleActiveConsumer||!1,onCheckedChange:a=>N(n,"singleActiveConsumer",a)}),e.jsx(i,{children:"Single Active Consumer (x-single-active-consumer)"})]})}),e.jsx(v,{children:e.jsx("p",{children:"Only one consumer receives messages at a time (useful for load balancing)"})})]})})})]})]}),e.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Messages:"}),e.jsx("span",{className:"ml-2 font-semibold",children:(s.messages||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Ready:"}),e.jsx("span",{className:"ml-2 font-semibold",children:(s.ready||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Unacked:"}),e.jsx("span",{className:"ml-2 font-semibold",children:(s.unacked||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Consumers:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.consumers||0})]})]}),s.maxLength&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Queue Fill Level"}),e.jsxs("span",{children:[Math.round((s.messages||0)/s.maxLength*100),"%"]})]}),e.jsx(Be,{value:s.maxLength?(s.messages||0)/s.maxLength*100:0,className:`h-2 ${s.messages&&s.messages>=s.maxLength?"bg-destructive":s.messages&&s.messages>=s.maxLength*.8?"bg-amber-500":"bg-primary"}`})]})]})]})]},n)})})]})]})}),e.jsxs(_,{value:"exchanges",className:"space-y-4 mt-4",children:[He&&e.jsxs(b,{className:"mb-4 border-primary",children:[e.jsxs(M,{children:[e.jsx(R,{children:"Create Exchange"}),e.jsx(L,{children:"Configure exchange settings"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Exchange Name"}),e.jsx(t,{placeholder:"my-exchange",value:K.name,onChange:s=>ae({...K,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Type"}),e.jsxs(w,{value:K.type,onValueChange:s=>ae({...K,type:s}),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"direct",children:"Direct"}),e.jsx(c,{value:"topic",children:"Topic"}),e.jsx(c,{value:"fanout",children:"Fanout"}),e.jsx(c,{value:"headers",children:"Headers"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:es,children:"Create Exchange"}),e.jsx(h,{variant:"outline",onClick:()=>{he(!1),ae({name:"",type:"direct"})},children:"Cancel"})]})]})]}),e.jsxs(b,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Exchanges"}),e.jsx(L,{children:"Message routing exchanges"})]}),e.jsxs(h,{size:"sm",onClick:()=>he(!0),variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Create Exchange"]})]})}),e.jsxs(A,{children:[d.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(t,{placeholder:"Search exchanges...",value:Te,onChange:s=>_e(s.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"space-y-4",children:cs.map((s,l)=>{const n=d.findIndex(a=>a.name===s.name);return e.jsxs(b,{className:"border-border",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(fe,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(R,{className:"text-lg",children:s.name}),e.jsxs(L,{className:"text-xs mt-1",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(f,{variant:"outline",children:s.type})}),e.jsx(v,{children:e.jsxs("p",{children:[s.type==="direct"&&"Exact routing key match",s.type==="topic"&&"Pattern-based routing with wildcards (*, #)",s.type==="fanout"&&"Broadcast to all bound queues",s.type==="headers"&&"Match based on message headers"]})})]})}),s.durable&&e.jsx(f,{variant:"outline",className:"ml-1",children:"Durable"}),s.internal&&e.jsx(f,{variant:"outline",className:"ml-1",children:"Internal"})]})]})]}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>ss(n),children:e.jsx(de,{className:"h-4 w-4"})})]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Exchange Name"}),e.jsx(t,{value:s.name,onChange:a=>$(n,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Type"}),e.jsxs(w,{value:s.type,onValueChange:a=>$(n,"type",a),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"direct",children:"Direct"}),e.jsx(c,{value:"topic",children:"Topic"}),e.jsx(c,{value:"fanout",children:"Fanout"}),e.jsx(c,{value:"headers",children:"Headers"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.durable,onCheckedChange:a=>$(n,"durable",a)}),e.jsx(i,{className:"text-xs",children:"Durable"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.autoDelete,onCheckedChange:a=>$(n,"autoDelete",a)}),e.jsx(i,{className:"text-xs",children:"Auto-Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:s.internal,onCheckedChange:a=>$(n,"internal",a)}),e.jsx(i,{className:"text-xs",children:"Internal"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Alternate Exchange"})}),e.jsx(v,{children:e.jsx("p",{children:"Exchange to route messages when no bindings match (messages are dropped if not set)"})})]})}),e.jsxs(w,{value:s.alternateExchange||"none",onValueChange:a=>$(n,"alternateExchange",a==="none"?void 0:a),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"None (messages dropped)"})}),e.jsxs(T,{children:[e.jsx(c,{value:"none",children:"None (messages dropped)"}),d.filter(a=>a.name!==s.name).map(a=>e.jsx(c,{value:a.name,children:a.name},a.name))]})]})]})]})]},n)})})]})]})]}),e.jsxs(_,{value:"bindings",className:"space-y-4 mt-4",children:[Oe&&e.jsxs(b,{className:"mb-4 border-primary",children:[e.jsxs(M,{children:[e.jsx(R,{children:"Create Binding"}),e.jsx(L,{children:"Bind exchange to queue"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Source Exchange"}),e.jsxs(w,{value:r.source,onValueChange:s=>U({...r,source:s}),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select exchange"})}),e.jsx(T,{children:d.map(s=>e.jsx(c,{value:s.name,children:s.name},s.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Destination Queue"}),e.jsxs(w,{value:r.destination,onValueChange:s=>U({...r,destination:s}),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select queue"})}),e.jsx(T,{children:o.map(s=>e.jsx(c,{value:s.name,children:s.name},s.name))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Routing Key"})}),e.jsx(v,{children:e.jsx("p",{children:d.find(s=>s.name===r.source)?.type==="topic"?"Use * for single word, # for multiple words. Example: *.error or logs.#":d.find(s=>s.name===r.source)?.type==="direct"?"Exact match required for direct exchange":"Routing key for message routing"})})]})}),e.jsx(t,{placeholder:d.find(s=>s.name===r.source)?.type==="topic"?"*.error or logs.#":"routing.key",value:r.routingKey,onChange:s=>U({...r,routingKey:s.target.value}),className:d.find(s=>s.name===r.source)?.type==="topic"&&r.routingKey?ie(r.routingKey).valid?"":"border-amber-500":""}),d.find(s=>s.name===r.source)?.type==="topic"&&r.routingKey&&(()=>{const s=ie(r.routingKey);return s.warning?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-600",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{children:s.warning})]}):null})()]}),d.find(s=>s.name===r.source)?.type==="headers"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"X-Match"})}),e.jsx(v,{children:e.jsx("p",{children:"all: all headers must match, any: at least one header must match"})})]})}),e.jsxs(w,{value:r.xMatch||"all",onValueChange:s=>U({...r,xMatch:s}),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"All (all headers must match)"}),e.jsx(c,{value:"any",children:"Any (at least one header must match)"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:ns,children:"Create Binding"}),e.jsx(h,{variant:"outline",onClick:()=>{me(!1),U({source:d[0]?.name||"",destination:o[0]?.name||"",routingKey:"",xMatch:"all"})},children:"Cancel"})]})]})]}),e.jsxs(b,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Bindings"}),e.jsx(L,{children:"Exchange to queue bindings"})]}),e.jsxs(h,{size:"sm",onClick:()=>me(!0),variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Create Binding"]})]})}),e.jsxs(A,{children:[O.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs(w,{value:ne||"all",onValueChange:Xe,children:[e.jsx(E,{className:"max-w-sm",children:e.jsx(k,{placeholder:"Filter by exchange..."})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"All Exchanges"}),d.map(s=>e.jsx(c,{value:s.name,children:s.name},s.name))]})]})}),Re.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No bindings configured"})]}):e.jsx("div",{className:"space-y-3",children:Re.map(s=>{const l=d.find(y=>y.name===s.source),n=o.find(y=>y.name===s.destination),a=!l||!n,m=l?.type==="topic"&&s.routingKey?ie(s.routingKey).warning:void 0;return e.jsx(b,{className:`p-3 ${a?"border-destructive":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:s.source}),!l&&e.jsx(f,{variant:"destructive",className:"text-xs",children:"Exchange not found"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["→ ",e.jsx("span",{className:n?"":"text-destructive font-semibold",children:s.destination}),!n&&e.jsx(f,{variant:"destructive",className:"ml-1 text-xs",children:"Queue not found"}),n&&e.jsxs(e.Fragment,{children:[" • Key: ",e.jsx("span",{className:m?"text-amber-600":"",children:s.routingKey||"(none)"}),m&&e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(V,{className:"h-3 w-3 inline ml-1 text-amber-600"})}),e.jsx(v,{children:e.jsx("p",{children:m})})]})})]}),s.arguments?.["x-match"]&&e.jsxs("span",{children:[" • X-Match: ",s.arguments["x-match"]]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{value:s.source,onValueChange:y=>Pe(s.id,"source",y),children:[e.jsx(E,{className:"w-32",children:e.jsx(k,{})}),e.jsx(T,{children:d.map(y=>e.jsx(c,{value:y.name,children:y.name},y.name))})]}),e.jsx(t,{className:"w-32",value:s.routingKey,onChange:y=>Pe(s.id,"routingKey",y.target.value),placeholder:"routing key"}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>ls(s.id),children:e.jsx(de,{className:"h-4 w-4"})})]})]})},s.id)})})]})]})]}),e.jsxs(_,{value:"policies",className:"space-y-4 mt-4",children:[Ue&&e.jsxs(b,{className:"mb-4 border-primary",children:[e.jsxs(M,{children:[e.jsx(R,{children:"Create Policy"}),e.jsx(L,{children:"Configure queue/exchange policies"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Policy Name"}),e.jsx(t,{placeholder:"ha-policy",value:P.name,onChange:s=>Y({...P,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Pattern"}),e.jsx(t,{placeholder:".*",value:P.pattern,onChange:s=>Y({...P,pattern:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Apply To"}),e.jsxs(w,{value:P.applyTo,onValueChange:s=>Y({...P,applyTo:s}),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"queues",children:"Queues"}),e.jsx(c,{value:"exchanges",children:"Exchanges"}),e.jsx(c,{value:"all",children:"All"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:is,children:"Create Policy"}),e.jsx(h,{variant:"outline",onClick:()=>{ue(!1),Y({name:"",pattern:".*",applyTo:"all"})},children:"Cancel"})]})]})]}),e.jsxs(b,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Policies"}),e.jsx(L,{children:"Queue and exchange policies"})]}),e.jsxs(h,{size:"sm",onClick:()=>ue(!0),variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Create Policy"]})]})}),e.jsxs(A,{children:[I.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs(w,{value:le||"all",onValueChange:Ge,children:[e.jsx(E,{className:"max-w-sm",children:e.jsx(k,{placeholder:"Filter by apply to..."})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"All Policies"}),e.jsx(c,{value:"queues",children:"Queues Only"}),e.jsx(c,{value:"exchanges",children:"Exchanges Only"})]})]})}),Le.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ke,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:I.length===0?"No policies configured":"No policies match the filter"})]}):e.jsx("div",{className:"space-y-3",children:Le.map((s,l)=>{const n=I.findIndex(a=>a.name===s.name);return e.jsx(b,{className:"p-3",children:$e===n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Policy Name"}),e.jsx(t,{value:s.name,onChange:a=>re(n,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Pattern"}),e.jsx(t,{value:s.pattern,onChange:a=>re(n,"pattern",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Apply To"}),e.jsxs(w,{value:s.applyTo,onValueChange:a=>re(n,"applyTo",a),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"queues",children:"Queues"}),e.jsx(c,{value:"exchanges",children:"Exchanges"}),e.jsx(c,{value:"all",children:"All"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Priority"}),e.jsx(t,{type:"number",value:s.priority,onChange:a=>re(n,"priority",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",onClick:()=>je(null),children:"Save"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>je(null),children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Pattern: ",s.pattern," • Apply to: ",s.applyTo," • Priority: ",s.priority]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>je(n),children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>rs(n),children:e.jsx(de,{className:"h-4 w-4"})})]})]})},n)})})]})]})]}),e.jsx(_,{value:"connection",className:"space-y-4 mt-4",children:e.jsxs(b,{children:[e.jsxs(M,{children:[e.jsx(R,{children:"Connection Settings"}),e.jsx(L,{children:"RabbitMQ server connection details"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"host",children:["Host ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(t,{id:"host",value:ee,onChange:s=>{x({host:s.target.value}),D.host&&Qe()},onBlur:Qe,placeholder:"localhost",className:G||D.host?"border-destructive":""}),G&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{children:G})]}),!G&&D.host&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{children:D.host})]}),!G&&D.host&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{children:D.host})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx(t,{id:"port",type:"number",value:se,onChange:s=>x({port:parseInt(s.target.value)||5672}),placeholder:"5672",className:X||J.hasConflict?"border-destructive":""}),X&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{children:X})]}),!X&&!D.port&&J.hasConflict&&J.conflictingNode&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-amber-600 dark:text-amber-400",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsxs("span",{children:['Конфликт порта: компонент "',J.conflictingNode.data.label||J.conflictingNode.type,'" уже использует ',ee,":",se]})]}),!X&&D.port&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{children:D.port})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(t,{id:"username",value:Fe,onChange:s=>x({username:s.target.value}),placeholder:"guest"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(t,{id:"password",type:"password",value:Ve,onChange:s=>x({password:s.target.value}),placeholder:"password"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"vhost",children:"Virtual Host"}),e.jsx(t,{id:"vhost",value:ze,onChange:s=>x({vhost:s.target.value}),placeholder:"/"})]}),e.jsx(Ae,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Performance Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Consumption Rate (msgs/sec per consumer)"})}),e.jsx(v,{children:e.jsx("p",{children:"Number of messages consumed per second by each consumer"})})]})}),e.jsx(t,{type:"number",min:"1",value:ye,onChange:s=>x({consumptionRate:parseInt(s.target.value)||10}),placeholder:"10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(p,{asChild:!0,children:e.jsx(i,{children:"Processing Time (ms per message)"})}),e.jsx(v,{children:e.jsx("p",{children:"Time to process each message before acknowledgment"})})]})}),e.jsx(t,{type:"number",min:"1",value:be,onChange:s=>x({processingTime:parseInt(s.target.value)||100}),placeholder:"100"})]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Параметры подключения сохраняются автоматически при изменении. Эти настройки используются для симуляции работы RabbitMQ брокера."})})]})]})}),e.jsx(_,{value:"monitoring",className:"space-y-4 mt-4",children:e.jsxs(b,{children:[e.jsxs(M,{children:[e.jsx(R,{children:"Queue Monitoring"}),e.jsx(L,{children:"Real-time queue statistics and metrics"})]}),e.jsxs(A,{children:[o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ge,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Нет очередей для мониторинга"}),e.jsx("p",{className:"text-xs mt-2",children:'Создайте очереди во вкладке "Queues" для отслеживания метрик'})]}):e.jsx("div",{className:"space-y-4",children:o.map((s,l)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs(f,{variant:"secondary",children:[s.messages||0," messages"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ready Messages"}),e.jsx("span",{className:"font-semibold",children:(s.ready||0).toLocaleString()})]}),e.jsx(Be,{value:s.messages?(s.ready||0)/s.messages*100:0,className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Unacked Messages"}),e.jsx("span",{className:"font-semibold",children:(s.unacked||0).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Consumers"}),e.jsx("span",{className:"font-semibold",children:s.consumers||0})]})]})]},l))}),e.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg border border-border",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Как проверить мониторинг"]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Запустите симуляцию (кнопка Play в панели управления)"}),e.jsx("li",{children:"Подключите компоненты к RabbitMQ через connections"}),e.jsx("li",{children:"Метрики обновляются автоматически во время симуляции"}),e.jsx("li",{children:"Обратите внимание на значения Ready, Unacked и Consumers"}),e.jsx("li",{children:"Если очередь растет (Ready увеличивается), проверьте количество Consumers"}),e.jsx("li",{children:"Unacked показывает сообщения в обработке у consumers"})]})]})]})]})})]})]})})}export{Qs as RabbitMQConfigAdvanced};
