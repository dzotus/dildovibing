const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KafkaConfigAdvanced-isnaxvOs.js","assets/progress-Bivej_Y2.js","assets/textarea-BSFjV7Yh.js","assets/database-Ck9K8pXy.js","assets/users-B0LkoMSP.js","assets/shield-Czwvtzuc.js","assets/RabbitMQConfigAdvanced-DtGWFEXq.js","assets/usePortValidation-xMTIvgMp.js","assets/requiredFields-BLgUUVkB.js","assets/toast-CFowQKth.js","assets/message-square-DbXNbH4b.js","assets/arrow-right-left-CluXXopS.js","assets/key-DvoJFWMt.js","assets/PostgreSQLConfigAdvanced-DOwdsDDQ.js","assets/table-B-oFu_eY.js","assets/MongoDBConfigAdvanced-CAd03sYS.js","assets/RedisConfigAdvanced-CuCCLh6T.js","assets/ElasticsearchConfigAdvanced-DK-MQvRS.js","assets/refresh-ccw-DHaGPCfE.js","assets/code-CsQrT8wV.js","assets/CassandraConfigAdvanced-BRJJaric.js","assets/ClickHouseConfigAdvanced-CrLSrmA1.js","assets/chart-column-CuhAac4D.js","assets/SnowflakeConfigAdvanced-Gmnrxj9i.js","assets/S3DataLakeConfigAdvanced-8acOqtTc.js","assets/folder-DcmWrcEE.js","assets/NginxConfigAdvanced-CJBhVKPw.js","assets/globe-NIN3Xt0B.js","assets/server-j78B0AXC.js","assets/RestApiConfigAdvanced-Bxl25MAh.js","assets/GRPCConfigAdvanced-d_SKJXtw.js","assets/circle-check-big-XTaBX9af.js","assets/WebSocketConfigAdvanced-BQTBQVT2.js","assets/send-CDP_cNKn.js","assets/GraphQLConfigAdvanced-zQzLkp0_.js","assets/SOAPConfigAdvanced-eRQTfGvb.js","assets/WebhookConfigAdvanced-BFAlpIWE.js","assets/webhook-BEqSj2zE.js","assets/clock-DYxsyur0.js","assets/DockerK8sConfigAdvanced-Cs5JFj_A.js","assets/HAProxyConfigAdvanced-BxHp_ZDI.js","assets/trending-up-Bm6Ln2ik.js","assets/TraefikConfigAdvanced-ddiUVNoF.js","assets/route-CFLAwhOO.js","assets/EnvoyConfigAdvanced-DXI6I7LP.js","assets/ActiveMQConfigAdvanced-BfmCbn_A.js","assets/alert-Db6opt8S.js","assets/pen-DnJ13qoP.js","assets/AWSSQSConfigAdvanced-D8m9pfBc.js","assets/cloud-Cg8iNR9j.js","assets/AzureServiceBusConfigAdvanced-BI9iEKQG.js","assets/GCPPubSubConfigAdvanced-D9Ci542V.js","assets/KongConfigAdvanced-D6KXdhHf.js","assets/ApigeeConfigAdvanced-D3JdsgyO.js","assets/MuleSoftConfigAdvanced-CLA9-Ecj.js","assets/GraphQLGatewayConfigAdvanced-B_cDQ_sQ.js","assets/BFFServiceConfigAdvanced-CkQ7i7IP.js","assets/WebhookRelayConfigAdvanced-CE2Z6sFe.js","assets/PrometheusConfigAdvanced-CdR5dwCe.js","assets/GrafanaConfigAdvanced-n1vN_9R5.js","assets/BarChart-CSIuYazv.js","assets/LokiConfigAdvanced-DUgGOxO9.js","assets/JaegerConfigAdvanced-B_HfhaBn.js","assets/git-branch-BRa9iWFO.js","assets/OpenTelemetryCollectorConfigAdvanced-CnlMUG1m.js","assets/PagerDutyConfigAdvanced-CSwKXF_r.js","assets/KeycloakConfigAdvanced-DV5NpNVM.js","assets/use-toast-BJ90xuCM.js","assets/lock-shdaLOJW.js","assets/mail-DrrKaLhU.js","assets/eye-off-CstQTkBc.js","assets/WAFConfigAdvanced-Ca8DZzEl.js","assets/SecretsVaultConfigAdvanced-BUwH4clS.js","assets/IDSIPSConfigAdvanced-Bsm2C3mk.js","assets/ban-CL--L6Wq.js","assets/FirewallConfigAdvanced-CF5NNJtl.js","assets/JenkinsConfigAdvanced-C3F_tzKe.js","assets/package-BbXkFGaz.js","assets/GitLabCIConfigAdvanced-DpMpLd3W.js","assets/ArgoCDConfigAdvanced-CJx3D3MI.js","assets/HarborConfigAdvanced-CZCaD5UU.js","assets/TerraformConfigAdvanced-Zn0Lwsoo.js","assets/AnsibleConfigAdvanced-BOr5NK_j.js","assets/IstioConfigAdvanced-CHdCQo96.js","assets/ServiceMeshConfigAdvanced-CzQkBr69.js","assets/APIGatewayConfigAdvanced-BaVNpRTl.js","assets/VPNConfigAdvanced-Bz2gDeeS.js","assets/CDNConfigAdvanced-CS8y_O7c.js","assets/SparkConfigAdvanced-BSt-ZXF2.js","assets/TensorFlowServingConfigAdvanced-Y1TFfkiA.js","assets/PyTorchServeConfigAdvanced-fKGuXN0f.js","assets/FeatureStoreConfigAdvanced-BqHnHOas.js","assets/MLflowConfigAdvanced-DOXEUe3B.js","assets/CRMConfigAdvanced-CDYSE5Av.js","assets/dollar-sign-BsXYPSvV.js","assets/building-upS_BRe8.js","assets/ERPConfigAdvanced-DZl2l8B1.js","assets/RPABotConfigAdvanced-CUkw1t0S.js","assets/BPMNEngineConfigAdvanced-CNN7SvR0.js","assets/PaymentGatewayConfigAdvanced-Bk2cAOM5.js"])))=>i.map(i=>d[i]);
function JM(o,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in o)){const r=Object.getOwnPropertyDescriptor(n,a);r&&Object.defineProperty(o,a,r.get?r:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();var SO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Th(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Lf={exports:{}},yr={};var x0;function eE(){if(x0)return yr;x0=1;var o=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,a,r){var c=null;if(r!==void 0&&(c=""+r),a.key!==void 0&&(c=""+a.key),"key"in a){r={};for(var l in a)l!=="key"&&(r[l]=a[l])}else r=a;return a=r.ref,{$$typeof:o,type:n,key:c,ref:a!==void 0?a:null,props:r}}return yr.Fragment=e,yr.jsx=t,yr.jsxs=t,yr}var w0;function tE(){return w0||(w0=1,Lf.exports=eE()),Lf.exports}var g=tE(),zf={exports:{}},Pe={};var S0;function nE(){if(S0)return Pe;S0=1;var o=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function b(j){return j===null||typeof j!="object"?null:(j=y&&j[y]||j["@@iterator"],typeof j=="function"?j:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,E={};function M(j,Q,Y){this.props=j,this.context=Q,this.refs=E,this.updater=Y||S}M.prototype.isReactComponent={},M.prototype.setState=function(j,Q){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,Q,"setState")},M.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function k(){}k.prototype=M.prototype;function T(j,Q,Y){this.props=j,this.context=Q,this.refs=E,this.updater=Y||S}var A=T.prototype=new k;A.constructor=T,C(A,M.prototype),A.isPureReactComponent=!0;var N=Array.isArray;function q(){}var O={H:null,A:null,T:null,S:null},H=Object.prototype.hasOwnProperty;function J(j,Q,Y){var ae=Y.ref;return{$$typeof:o,type:j,key:Q,ref:ae!==void 0?ae:null,props:Y}}function se(j,Q){return J(j.type,Q,j.props)}function ce(j){return typeof j=="object"&&j!==null&&j.$$typeof===o}function Z(j){var Q={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(Y){return Q[Y]})}var te=/\/+/g;function le(j,Q){return typeof j=="object"&&j!==null&&j.key!=null?Z(""+j.key):Q.toString(36)}function ue(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(q,q):(j.status="pending",j.then(function(Q){j.status==="pending"&&(j.status="fulfilled",j.value=Q)},function(Q){j.status==="pending"&&(j.status="rejected",j.reason=Q)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function L(j,Q,Y,ae,U){var ie=typeof j;(ie==="undefined"||ie==="boolean")&&(j=null);var $=!1;if(j===null)$=!0;else switch(ie){case"bigint":case"string":case"number":$=!0;break;case"object":switch(j.$$typeof){case o:case e:$=!0;break;case p:return $=j._init,L($(j._payload),Q,Y,ae,U)}}if($)return U=U(j),$=ae===""?"."+le(j,0):ae,N(U)?(Y="",$!=null&&(Y=$.replace(te,"$&/")+"/"),L(U,Q,Y,"",function(me){return me})):U!=null&&(ce(U)&&(U=se(U,Y+(U.key==null||j&&j.key===U.key?"":(""+U.key).replace(te,"$&/")+"/")+$)),Q.push(U)),1;$=0;var V=ae===""?".":ae+":";if(N(j))for(var pe=0;pe<j.length;pe++)ae=j[pe],ie=V+le(ae,pe),$+=L(ae,Q,Y,ie,U);else if(pe=b(j),typeof pe=="function")for(j=pe.call(j),pe=0;!(ae=j.next()).done;)ae=ae.value,ie=V+le(ae,pe++),$+=L(ae,Q,Y,ie,U);else if(ie==="object"){if(typeof j.then=="function")return L(ue(j),Q,Y,ae,U);throw Q=String(j),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return $}function _(j,Q,Y){if(j==null)return j;var ae=[],U=0;return L(j,ae,"","",function(ie){return Q.call(Y,ie,U++)}),ae}function P(j){if(j._status===-1){var Q=j._result;Q=Q(),Q.then(function(Y){(j._status===0||j._status===-1)&&(j._status=1,j._result=Y)},function(Y){(j._status===0||j._status===-1)&&(j._status=2,j._result=Y)}),j._status===-1&&(j._status=0,j._result=Q)}if(j._status===1)return j._result.default;throw j._result}var W=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)},he={map:_,forEach:function(j,Q,Y){_(j,function(){Q.apply(this,arguments)},Y)},count:function(j){var Q=0;return _(j,function(){Q++}),Q},toArray:function(j){return _(j,function(Q){return Q})||[]},only:function(j){if(!ce(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};return Pe.Activity=m,Pe.Children=he,Pe.Component=M,Pe.Fragment=t,Pe.Profiler=a,Pe.PureComponent=T,Pe.StrictMode=n,Pe.Suspense=d,Pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,Pe.__COMPILER_RUNTIME={__proto__:null,c:function(j){return O.H.useMemoCache(j)}},Pe.cache=function(j){return function(){return j.apply(null,arguments)}},Pe.cacheSignal=function(){return null},Pe.cloneElement=function(j,Q,Y){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var ae=C({},j.props),U=j.key;if(Q!=null)for(ie in Q.key!==void 0&&(U=""+Q.key),Q)!H.call(Q,ie)||ie==="key"||ie==="__self"||ie==="__source"||ie==="ref"&&Q.ref===void 0||(ae[ie]=Q[ie]);var ie=arguments.length-2;if(ie===1)ae.children=Y;else if(1<ie){for(var $=Array(ie),V=0;V<ie;V++)$[V]=arguments[V+2];ae.children=$}return J(j.type,U,ae)},Pe.createContext=function(j){return j={$$typeof:c,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:r,_context:j},j},Pe.createElement=function(j,Q,Y){var ae,U={},ie=null;if(Q!=null)for(ae in Q.key!==void 0&&(ie=""+Q.key),Q)H.call(Q,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(U[ae]=Q[ae]);var $=arguments.length-2;if($===1)U.children=Y;else if(1<$){for(var V=Array($),pe=0;pe<$;pe++)V[pe]=arguments[pe+2];U.children=V}if(j&&j.defaultProps)for(ae in $=j.defaultProps,$)U[ae]===void 0&&(U[ae]=$[ae]);return J(j,ie,U)},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(j){return{$$typeof:l,render:j}},Pe.isValidElement=ce,Pe.lazy=function(j){return{$$typeof:p,_payload:{_status:-1,_result:j},_init:P}},Pe.memo=function(j,Q){return{$$typeof:h,type:j,compare:Q===void 0?null:Q}},Pe.startTransition=function(j){var Q=O.T,Y={};O.T=Y;try{var ae=j(),U=O.S;U!==null&&U(Y,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(q,W)}catch(ie){W(ie)}finally{Q!==null&&Y.types!==null&&(Q.types=Y.types),O.T=Q}},Pe.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},Pe.use=function(j){return O.H.use(j)},Pe.useActionState=function(j,Q,Y){return O.H.useActionState(j,Q,Y)},Pe.useCallback=function(j,Q){return O.H.useCallback(j,Q)},Pe.useContext=function(j){return O.H.useContext(j)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(j,Q){return O.H.useDeferredValue(j,Q)},Pe.useEffect=function(j,Q){return O.H.useEffect(j,Q)},Pe.useEffectEvent=function(j){return O.H.useEffectEvent(j)},Pe.useId=function(){return O.H.useId()},Pe.useImperativeHandle=function(j,Q,Y){return O.H.useImperativeHandle(j,Q,Y)},Pe.useInsertionEffect=function(j,Q){return O.H.useInsertionEffect(j,Q)},Pe.useLayoutEffect=function(j,Q){return O.H.useLayoutEffect(j,Q)},Pe.useMemo=function(j,Q){return O.H.useMemo(j,Q)},Pe.useOptimistic=function(j,Q){return O.H.useOptimistic(j,Q)},Pe.useReducer=function(j,Q,Y){return O.H.useReducer(j,Q,Y)},Pe.useRef=function(j){return O.H.useRef(j)},Pe.useState=function(j){return O.H.useState(j)},Pe.useSyncExternalStore=function(j,Q,Y){return O.H.useSyncExternalStore(j,Q,Y)},Pe.useTransition=function(){return O.H.useTransition()},Pe.version="19.2.0",Pe}var C0;function kh(){return C0||(C0=1,zf.exports=nE()),zf.exports}var w=kh();const Et=Th(w),Ah=JM({__proto__:null,default:Et},[w]);var Pf={exports:{}},vr={},Of={exports:{}},If={};var M0;function sE(){return M0||(M0=1,(function(o){function e(L,_){var P=L.length;L.push(_);e:for(;0<P;){var W=P-1>>>1,he=L[W];if(0<a(he,_))L[W]=_,L[P]=he,P=W;else break e}}function t(L){return L.length===0?null:L[0]}function n(L){if(L.length===0)return null;var _=L[0],P=L.pop();if(P!==_){L[0]=P;e:for(var W=0,he=L.length,j=he>>>1;W<j;){var Q=2*(W+1)-1,Y=L[Q],ae=Q+1,U=L[ae];if(0>a(Y,P))ae<he&&0>a(U,Y)?(L[W]=U,L[ae]=P,W=ae):(L[W]=Y,L[Q]=P,W=Q);else if(ae<he&&0>a(U,P))L[W]=U,L[ae]=P,W=ae;else break e}}return _}function a(L,_){var P=L.sortIndex-_.sortIndex;return P!==0?P:L.id-_.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;o.unstable_now=function(){return r.now()}}else{var c=Date,l=c.now();o.unstable_now=function(){return c.now()-l}}var d=[],h=[],p=1,m=null,y=3,b=!1,S=!1,C=!1,E=!1,M=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function A(L){for(var _=t(h);_!==null;){if(_.callback===null)n(h);else if(_.startTime<=L)n(h),_.sortIndex=_.expirationTime,e(d,_);else break;_=t(h)}}function N(L){if(C=!1,A(L),!S)if(t(d)!==null)S=!0,q||(q=!0,Z());else{var _=t(h);_!==null&&ue(N,_.startTime-L)}}var q=!1,O=-1,H=5,J=-1;function se(){return E?!0:!(o.unstable_now()-J<H)}function ce(){if(E=!1,q){var L=o.unstable_now();J=L;var _=!0;try{e:{S=!1,C&&(C=!1,k(O),O=-1),b=!0;var P=y;try{t:{for(A(L),m=t(d);m!==null&&!(m.expirationTime>L&&se());){var W=m.callback;if(typeof W=="function"){m.callback=null,y=m.priorityLevel;var he=W(m.expirationTime<=L);if(L=o.unstable_now(),typeof he=="function"){m.callback=he,A(L),_=!0;break t}m===t(d)&&n(d),A(L)}else n(d);m=t(d)}if(m!==null)_=!0;else{var j=t(h);j!==null&&ue(N,j.startTime-L),_=!1}}break e}finally{m=null,y=P,b=!1}_=void 0}}finally{_?Z():q=!1}}}var Z;if(typeof T=="function")Z=function(){T(ce)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,le=te.port2;te.port1.onmessage=ce,Z=function(){le.postMessage(null)}}else Z=function(){M(ce,0)};function ue(L,_){O=M(function(){L(o.unstable_now())},_)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(L){L.callback=null},o.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<L?Math.floor(1e3/L):5},o.unstable_getCurrentPriorityLevel=function(){return y},o.unstable_next=function(L){switch(y){case 1:case 2:case 3:var _=3;break;default:_=y}var P=y;y=_;try{return L()}finally{y=P}},o.unstable_requestPaint=function(){E=!0},o.unstable_runWithPriority=function(L,_){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var P=y;y=L;try{return _()}finally{y=P}},o.unstable_scheduleCallback=function(L,_,P){var W=o.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?W+P:W):P=W,L){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=P+he,L={id:p++,callback:_,priorityLevel:L,startTime:P,expirationTime:he,sortIndex:-1},P>W?(L.sortIndex=P,e(h,L),t(d)===null&&L===t(h)&&(C?(k(O),O=-1):C=!0,ue(N,P-W))):(L.sortIndex=he,e(d,L),S||b||(S=!0,q||(q=!0,Z()))),L},o.unstable_shouldYield=se,o.unstable_wrapCallback=function(L){var _=y;return function(){var P=y;y=_;try{return L.apply(this,arguments)}finally{y=P}}}})(If)),If}var E0;function aE(){return E0||(E0=1,Of.exports=sE()),Of.exports}var qf={exports:{}},an={};var R0;function iE(){if(R0)return an;R0=1;var o=kh();function e(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function r(d,h,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:m==null?null:""+m,children:d,containerInfo:h,implementation:p}}var c=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(d,h){if(d==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return an.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,an.createPortal=function(d,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return r(d,h,null,p)},an.flushSync=function(d){var h=c.T,p=n.p;try{if(c.T=null,n.p=2,d)return d()}finally{c.T=h,n.p=p,n.d.f()}},an.preconnect=function(d,h){typeof d=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(d,h))},an.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},an.preinit=function(d,h){if(typeof d=="string"&&h&&typeof h.as=="string"){var p=h.as,m=l(p,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,b=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?n.d.S(d,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:b}):p==="script"&&n.d.X(d,{crossOrigin:m,integrity:y,fetchPriority:b,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},an.preinitModule=function(d,h){if(typeof d=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=l(h.as,h.crossOrigin);n.d.M(d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(d)},an.preload=function(d,h){if(typeof d=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,m=l(p,h.crossOrigin);n.d.L(d,p,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},an.preloadModule=function(d,h){if(typeof d=="string")if(h){var p=l(h.as,h.crossOrigin);n.d.m(d,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(d)},an.requestFormReset=function(d){n.d.r(d)},an.unstable_batchedUpdates=function(d,h){return d(h)},an.useFormState=function(d,h,p){return c.H.useFormState(d,h,p)},an.useFormStatus=function(){return c.H.useHostTransitionStatus()},an.version="19.2.0",an}var T0;function Nv(){if(T0)return qf.exports;T0=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(e){console.error(e)}}return o(),qf.exports=iE(),qf.exports}var k0;function oE(){if(k0)return vr;k0=1;var o=aE(),e=kh(),t=Nv();function n(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)i+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function r(s){var i=s,u=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(u=i.return),s=i.return;while(s)}return i.tag===3?u:null}function c(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function l(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function d(s){if(r(s)!==s)throw Error(n(188))}function h(s){var i=s.alternate;if(!i){if(i=r(s),i===null)throw Error(n(188));return i!==s?null:s}for(var u=s,f=i;;){var v=u.return;if(v===null)break;var x=v.alternate;if(x===null){if(f=v.return,f!==null){u=f;continue}break}if(v.child===x.child){for(x=v.child;x;){if(x===u)return d(v),s;if(x===f)return d(v),i;x=x.sibling}throw Error(n(188))}if(u.return!==f.return)u=v,f=x;else{for(var R=!1,D=v.child;D;){if(D===u){R=!0,u=v,f=x;break}if(D===f){R=!0,f=v,u=x;break}D=D.sibling}if(!R){for(D=x.child;D;){if(D===u){R=!0,u=x,f=v;break}if(D===f){R=!0,f=x,u=v;break}D=D.sibling}if(!R)throw Error(n(189))}}if(u.alternate!==f)throw Error(n(190))}if(u.tag!==3)throw Error(n(188));return u.stateNode.current===u?s:i}function p(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=p(s),i!==null)return i;s=s.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),J=Symbol.for("react.activity"),se=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function Z(s){return s===null||typeof s!="object"?null:(s=ce&&s[ce]||s["@@iterator"],typeof s=="function"?s:null)}var te=Symbol.for("react.client.reference");function le(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===te?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case C:return"Fragment";case M:return"Profiler";case E:return"StrictMode";case N:return"Suspense";case q:return"SuspenseList";case J:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case S:return"Portal";case T:return s.displayName||"Context";case k:return(s._context.displayName||"Context")+".Consumer";case A:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case O:return i=s.displayName||null,i!==null?i:le(s.type)||"Memo";case H:i=s._payload,s=s._init;try{return le(s(i))}catch{}}return null}var ue=Array.isArray,L=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},W=[],he=-1;function j(s){return{current:s}}function Q(s){0>he||(s.current=W[he],W[he]=null,he--)}function Y(s,i){he++,W[he]=s.current,s.current=i}var ae=j(null),U=j(null),ie=j(null),$=j(null);function V(s,i){switch(Y(ie,i),Y(U,s),Y(ae,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?Uy(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=Uy(i),s=Qy(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Q(ae),Y(ae,s)}function pe(){Q(ae),Q(U),Q(ie)}function me(s){s.memoizedState!==null&&Y($,s);var i=ae.current,u=Qy(i,s.type);i!==u&&(Y(U,s),Y(ae,u))}function ye(s){U.current===s&&(Q(ae),Q(U)),$.current===s&&(Q($),hr._currentValue=P)}var ve,Le;function $e(s){if(ve===void 0)try{throw Error()}catch(u){var i=u.stack.trim().match(/\n( *(at )?)/);ve=i&&i[1]||"",Le=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ve+s+Le}var at=!1;function Ze(s,i){if(!s||at)return"";at=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(i){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(X){var K=X}Reflect.construct(s,[],re)}else{try{re.call()}catch(X){K=X}s.call(re.prototype)}}else{try{throw Error()}catch(X){K=X}(re=s())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(X){if(X&&K&&typeof X.stack=="string")return[X.stack,K.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=f.DetermineComponentFrameRoot(),R=x[0],D=x[1];if(R&&D){var z=R.split(`
`),G=D.split(`
`);for(v=f=0;f<z.length&&!z[f].includes("DetermineComponentFrameRoot");)f++;for(;v<G.length&&!G[v].includes("DetermineComponentFrameRoot");)v++;if(f===z.length||v===G.length)for(f=z.length-1,v=G.length-1;1<=f&&0<=v&&z[f]!==G[v];)v--;for(;1<=f&&0<=v;f--,v--)if(z[f]!==G[v]){if(f!==1||v!==1)do if(f--,v--,0>v||z[f]!==G[v]){var ne=`
`+z[f].replace(" at new "," at ");return s.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",s.displayName)),ne}while(1<=f&&0<=v);break}}}finally{at=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?$e(u):""}function Nt(s,i){switch(s.tag){case 26:case 27:case 5:return $e(s.type);case 16:return $e("Lazy");case 13:return s.child!==i&&i!==null?$e("Suspense Fallback"):$e("Suspense");case 19:return $e("SuspenseList");case 0:case 15:return Ze(s.type,!1);case 11:return Ze(s.type.render,!1);case 1:return Ze(s.type,!0);case 31:return $e("Activity");default:return""}}function de(s){try{var i="",u=null;do i+=Nt(s,u),u=s,s=s.return;while(s);return i}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var Be=Object.prototype.hasOwnProperty,Ue=o.unstable_scheduleCallback,yt=o.unstable_cancelCallback,pt=o.unstable_shouldYield,qt=o.unstable_requestPaint,Je=o.unstable_now,_t=o.unstable_getCurrentPriorityLevel,vt=o.unstable_ImmediatePriority,gt=o.unstable_UserBlockingPriority,Yt=o.unstable_NormalPriority,Ft=o.unstable_LowPriority,Rs=o.unstable_IdlePriority,Yn=o.log,Dn=o.unstable_setDisableYieldValue,os=null,Wt=null;function Gt(s){if(typeof Yn=="function"&&Dn(s),Wt&&typeof Wt.setStrictMode=="function")try{Wt.setStrictMode(os,s)}catch{}}var jt=Math.clz32?Math.clz32:Fr,$a=Math.log,Nn=Math.LN2;function Fr(s){return s>>>=0,s===0?32:31-($a(s)/Nn|0)|0}var Ts=256,Ua=262144,ia=4194304;function Wn(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ks(s,i,u){var f=s.pendingLanes;if(f===0)return 0;var v=0,x=s.suspendedLanes,R=s.pingedLanes;s=s.warmLanes;var D=f&134217727;return D!==0?(f=D&~x,f!==0?v=Wn(f):(R&=D,R!==0?v=Wn(R):u||(u=D&~s,u!==0&&(v=Wn(u))))):(D=f&~x,D!==0?v=Wn(D):R!==0?v=Wn(R):u||(u=f&~s,u!==0&&(v=Wn(u)))),v===0?0:i!==0&&i!==v&&(i&x)===0&&(x=v&-v,u=i&-i,x>=u||x===32&&(u&4194048)!==0)?i:v}function As(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function Mu(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ee(){var s=ia;return ia<<=1,(ia&62914560)===0&&(ia=4194304),s}function fe(s){for(var i=[],u=0;31>u;u++)i.push(s);return i}function be(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ze(s,i,u,f,v,x){var R=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var D=s.entanglements,z=s.expirationTimes,G=s.hiddenUpdates;for(u=R&~u;0<u;){var ne=31-jt(u),re=1<<ne;D[ne]=0,z[ne]=-1;var K=G[ne];if(K!==null)for(G[ne]=null,ne=0;ne<K.length;ne++){var X=K[ne];X!==null&&(X.lane&=-536870913)}u&=~re}f!==0&&Oe(s,f,0),x!==0&&v===0&&s.tag!==0&&(s.suspendedLanes|=x&~(R&~i))}function Oe(s,i,u){s.pendingLanes|=i,s.suspendedLanes&=~i;var f=31-jt(i);s.entangledLanes|=i,s.entanglements[f]=s.entanglements[f]|1073741824|u&261930}function ct(s,i){var u=s.entangledLanes|=i;for(s=s.entanglements;u;){var f=31-jt(u),v=1<<f;v&i|s[f]&i&&(s[f]|=i),u&=~v}}function Lt(s,i){var u=i&-i;return u=(u&42)!==0?1:Xt(u),(u&(s.suspendedLanes|i))!==0?0:u}function Xt(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Rt(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function cn(){var s=_.p;return s!==0?s:(s=window.event,s===void 0?32:h0(s.type))}function wt(s,i){var u=_.p;try{return _.p=s,i()}finally{_.p=u}}var it=Math.random().toString(36).slice(2),mt="__reactFiber$"+it,Ht="__reactProps$"+it,rs="__reactContainer$"+it,Qe="__reactEvents$"+it,_n="__reactListeners$"+it,Qa="__reactHandles$"+it,xi="__reactResources$"+it,ko="__reactMarker$"+it;function Eu(s){delete s[mt],delete s[Ht],delete s[Qe],delete s[_n],delete s[Qa]}function wi(s){var i=s[mt];if(i)return i;for(var u=s.parentNode;u;){if(i=u[rs]||u[mt]){if(u=i.alternate,i.child!==null||u!==null&&u.child!==null)for(s=Xy(s);s!==null;){if(u=s[mt])return u;s=Xy(s)}return i}s=u,u=s.parentNode}return null}function Si(s){if(s=s[mt]||s[rs]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function Ao(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(n(33))}function Ci(s){var i=s[xi];return i||(i=s[xi]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Vt(s){s[ko]=!0}var Np=new Set,_p={};function Fa(s,i){Mi(s,i),Mi(s+"Capture",i)}function Mi(s,i){for(_p[s]=i,s=0;s<i.length;s++)Np.add(i[s])}var Q1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jp={},Lp={};function F1(s){return Be.call(Lp,s)?!0:Be.call(jp,s)?!1:Q1.test(s)?Lp[s]=!0:(jp[s]=!0,!1)}function Gr(s,i,u){if(F1(i))if(u===null)s.removeAttribute(i);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var f=i.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+u)}}function Vr(s,i,u){if(u===null)s.removeAttribute(i);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+u)}}function Ds(s,i,u,f){if(f===null)s.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(i,u,""+f)}}function jn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function zp(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function G1(s,i,u){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var v=f.get,x=f.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return v.call(this)},set:function(R){u=""+R,x.call(this,R)}}),Object.defineProperty(s,i,{enumerable:f.enumerable}),{getValue:function(){return u},setValue:function(R){u=""+R},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function Ru(s){if(!s._valueTracker){var i=zp(s)?"checked":"value";s._valueTracker=G1(s,i,""+s[i])}}function Pp(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var u=i.getValue(),f="";return s&&(f=zp(s)?s.checked?"true":"false":s.value),s=f,s!==u?(i.setValue(s),!0):!1}function Kr(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var V1=/[\n"\\]/g;function Ln(s){return s.replace(V1,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Tu(s,i,u,f,v,x,R,D){s.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?s.type=R:s.removeAttribute("type"),i!=null?R==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+jn(i)):s.value!==""+jn(i)&&(s.value=""+jn(i)):R!=="submit"&&R!=="reset"||s.removeAttribute("value"),i!=null?ku(s,R,jn(i)):u!=null?ku(s,R,jn(u)):f!=null&&s.removeAttribute("value"),v==null&&x!=null&&(s.defaultChecked=!!x),v!=null&&(s.checked=v&&typeof v!="function"&&typeof v!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?s.name=""+jn(D):s.removeAttribute("name")}function Op(s,i,u,f,v,x,R,D){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.type=x),i!=null||u!=null){if(!(x!=="submit"&&x!=="reset"||i!=null)){Ru(s);return}u=u!=null?""+jn(u):"",i=i!=null?""+jn(i):u,D||i===s.value||(s.value=i),s.defaultValue=i}f=f??v,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=D?s.checked:!!f,s.defaultChecked=!!f,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(s.name=R),Ru(s)}function ku(s,i,u){i==="number"&&Kr(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function Ei(s,i,u,f){if(s=s.options,i){i={};for(var v=0;v<u.length;v++)i["$"+u[v]]=!0;for(u=0;u<s.length;u++)v=i.hasOwnProperty("$"+s[u].value),s[u].selected!==v&&(s[u].selected=v),v&&f&&(s[u].defaultSelected=!0)}else{for(u=""+jn(u),i=null,v=0;v<s.length;v++){if(s[v].value===u){s[v].selected=!0,f&&(s[v].defaultSelected=!0);return}i!==null||s[v].disabled||(i=s[v])}i!==null&&(i.selected=!0)}}function Ip(s,i,u){if(i!=null&&(i=""+jn(i),i!==s.value&&(s.value=i),u==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=u!=null?""+jn(u):""}function qp(s,i,u,f){if(i==null){if(f!=null){if(u!=null)throw Error(n(92));if(ue(f)){if(1<f.length)throw Error(n(93));f=f[0]}u=f}u==null&&(u=""),i=u}u=jn(i),s.defaultValue=u,f=s.textContent,f===u&&f!==""&&f!==null&&(s.value=f),Ru(s)}function Ri(s,i){if(i){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=i;return}}s.textContent=i}var K1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Hp(s,i,u){var f=i.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":f?s.setProperty(i,u):typeof u!="number"||u===0||K1.has(i)?i==="float"?s.cssFloat=u:s[i]=(""+u).trim():s[i]=u+"px"}function Bp(s,i,u){if(i!=null&&typeof i!="object")throw Error(n(62));if(s=s.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||i!=null&&i.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var v in i)f=i[v],i.hasOwnProperty(v)&&u[v]!==f&&Hp(s,v,f)}else for(var x in i)i.hasOwnProperty(x)&&Hp(s,x,i[x])}function Au(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Y1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),W1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Yr(s){return W1.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Ns(){}var Du=null;function Nu(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ti=null,ki=null;function $p(s){var i=Si(s);if(i&&(s=i.stateNode)){var u=s[Ht]||null;e:switch(s=i.stateNode,i.type){case"input":if(Tu(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),i=u.name,u.type==="radio"&&i!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Ln(""+i)+'"][type="radio"]'),i=0;i<u.length;i++){var f=u[i];if(f!==s&&f.form===s.form){var v=f[Ht]||null;if(!v)throw Error(n(90));Tu(f,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(i=0;i<u.length;i++)f=u[i],f.form===s.form&&Pp(f)}break e;case"textarea":Ip(s,u.value,u.defaultValue);break e;case"select":i=u.value,i!=null&&Ei(s,!!u.multiple,i,!1)}}}var _u=!1;function Up(s,i,u){if(_u)return s(i,u);_u=!0;try{var f=s(i);return f}finally{if(_u=!1,(Ti!==null||ki!==null)&&(Pc(),Ti&&(i=Ti,s=ki,ki=Ti=null,$p(i),s)))for(i=0;i<s.length;i++)$p(s[i])}}function Do(s,i){var u=s.stateNode;if(u===null)return null;var f=u[Ht]||null;if(f===null)return null;u=f[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(n(231,i,typeof u));return u}var _s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ju=!1;if(_s)try{var No={};Object.defineProperty(No,"passive",{get:function(){ju=!0}}),window.addEventListener("test",No,No),window.removeEventListener("test",No,No)}catch{ju=!1}var oa=null,Lu=null,Wr=null;function Qp(){if(Wr)return Wr;var s,i=Lu,u=i.length,f,v="value"in oa?oa.value:oa.textContent,x=v.length;for(s=0;s<u&&i[s]===v[s];s++);var R=u-s;for(f=1;f<=R&&i[u-f]===v[x-f];f++);return Wr=v.slice(s,1<f?1-f:void 0)}function Xr(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function Zr(){return!0}function Fp(){return!1}function fn(s){function i(u,f,v,x,R){this._reactName=u,this._targetInst=v,this.type=f,this.nativeEvent=x,this.target=R,this.currentTarget=null;for(var D in s)s.hasOwnProperty(D)&&(u=s[D],this[D]=u?u(x):x[D]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Zr:Fp,this.isPropagationStopped=Fp,this}return m(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Zr)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Zr)},persist:function(){},isPersistent:Zr}),i}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jr=fn(Ga),_o=m({},Ga,{view:0,detail:0}),X1=fn(_o),zu,Pu,jo,ec=m({},_o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Iu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==jo&&(jo&&s.type==="mousemove"?(zu=s.screenX-jo.screenX,Pu=s.screenY-jo.screenY):Pu=zu=0,jo=s),zu)},movementY:function(s){return"movementY"in s?s.movementY:Pu}}),Gp=fn(ec),Z1=m({},ec,{dataTransfer:0}),J1=fn(Z1),eC=m({},_o,{relatedTarget:0}),Ou=fn(eC),tC=m({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),nC=fn(tC),sC=m({},Ga,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),aC=fn(sC),iC=m({},Ga,{data:0}),Vp=fn(iC),oC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lC(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=cC[s])?!!i[s]:!1}function Iu(){return lC}var uC=m({},_o,{key:function(s){if(s.key){var i=oC[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=Xr(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?rC[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Iu,charCode:function(s){return s.type==="keypress"?Xr(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Xr(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),dC=fn(uC),fC=m({},ec,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Kp=fn(fC),hC=m({},_o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Iu}),pC=fn(hC),gC=m({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),mC=fn(gC),yC=m({},ec,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),vC=fn(yC),bC=m({},Ga,{newState:0,oldState:0}),xC=fn(bC),wC=[9,13,27,32],qu=_s&&"CompositionEvent"in window,Lo=null;_s&&"documentMode"in document&&(Lo=document.documentMode);var SC=_s&&"TextEvent"in window&&!Lo,Yp=_s&&(!qu||Lo&&8<Lo&&11>=Lo),Wp=" ",Xp=!1;function Zp(s,i){switch(s){case"keyup":return wC.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jp(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ai=!1;function CC(s,i){switch(s){case"compositionend":return Jp(i);case"keypress":return i.which!==32?null:(Xp=!0,Wp);case"textInput":return s=i.data,s===Wp&&Xp?null:s;default:return null}}function MC(s,i){if(Ai)return s==="compositionend"||!qu&&Zp(s,i)?(s=Qp(),Wr=Lu=oa=null,Ai=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Yp&&i.locale!=="ko"?null:i.data;default:return null}}var EC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eg(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!EC[s.type]:i==="textarea"}function tg(s,i,u,f){Ti?ki?ki.push(f):ki=[f]:Ti=f,i=Uc(i,"onChange"),0<i.length&&(u=new Jr("onChange","change",null,u,f),s.push({event:u,listeners:i}))}var zo=null,Po=null;function RC(s){Oy(s,0)}function tc(s){var i=Ao(s);if(Pp(i))return s}function ng(s,i){if(s==="change")return i}var sg=!1;if(_s){var Hu;if(_s){var Bu="oninput"in document;if(!Bu){var ag=document.createElement("div");ag.setAttribute("oninput","return;"),Bu=typeof ag.oninput=="function"}Hu=Bu}else Hu=!1;sg=Hu&&(!document.documentMode||9<document.documentMode)}function ig(){zo&&(zo.detachEvent("onpropertychange",og),Po=zo=null)}function og(s){if(s.propertyName==="value"&&tc(Po)){var i=[];tg(i,Po,s,Nu(s)),Up(RC,i)}}function TC(s,i,u){s==="focusin"?(ig(),zo=i,Po=u,zo.attachEvent("onpropertychange",og)):s==="focusout"&&ig()}function kC(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return tc(Po)}function AC(s,i){if(s==="click")return tc(i)}function DC(s,i){if(s==="input"||s==="change")return tc(i)}function NC(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var xn=typeof Object.is=="function"?Object.is:NC;function Oo(s,i){if(xn(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var u=Object.keys(s),f=Object.keys(i);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var v=u[f];if(!Be.call(i,v)||!xn(s[v],i[v]))return!1}return!0}function rg(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function cg(s,i){var u=rg(s);s=0;for(var f;u;){if(u.nodeType===3){if(f=s+u.textContent.length,s<=i&&f>=i)return{node:u,offset:i-s};s=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=rg(u)}}function lg(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?lg(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function ug(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=Kr(s.document);i instanceof s.HTMLIFrameElement;){try{var u=typeof i.contentWindow.location.href=="string"}catch{u=!1}if(u)s=i.contentWindow;else break;i=Kr(s.document)}return i}function $u(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var _C=_s&&"documentMode"in document&&11>=document.documentMode,Di=null,Uu=null,Io=null,Qu=!1;function dg(s,i,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Qu||Di==null||Di!==Kr(f)||(f=Di,"selectionStart"in f&&$u(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Io&&Oo(Io,f)||(Io=f,f=Uc(Uu,"onSelect"),0<f.length&&(i=new Jr("onSelect","select",null,i,u),s.push({event:i,listeners:f}),i.target=Di)))}function Va(s,i){var u={};return u[s.toLowerCase()]=i.toLowerCase(),u["Webkit"+s]="webkit"+i,u["Moz"+s]="moz"+i,u}var Ni={animationend:Va("Animation","AnimationEnd"),animationiteration:Va("Animation","AnimationIteration"),animationstart:Va("Animation","AnimationStart"),transitionrun:Va("Transition","TransitionRun"),transitionstart:Va("Transition","TransitionStart"),transitioncancel:Va("Transition","TransitionCancel"),transitionend:Va("Transition","TransitionEnd")},Fu={},fg={};_s&&(fg=document.createElement("div").style,"AnimationEvent"in window||(delete Ni.animationend.animation,delete Ni.animationiteration.animation,delete Ni.animationstart.animation),"TransitionEvent"in window||delete Ni.transitionend.transition);function Ka(s){if(Fu[s])return Fu[s];if(!Ni[s])return s;var i=Ni[s],u;for(u in i)if(i.hasOwnProperty(u)&&u in fg)return Fu[s]=i[u];return s}var hg=Ka("animationend"),pg=Ka("animationiteration"),gg=Ka("animationstart"),jC=Ka("transitionrun"),LC=Ka("transitionstart"),zC=Ka("transitioncancel"),mg=Ka("transitionend"),yg=new Map,Gu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Gu.push("scrollEnd");function Xn(s,i){yg.set(s,i),Fa(i,[s])}var nc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},zn=[],_i=0,Vu=0;function sc(){for(var s=_i,i=Vu=_i=0;i<s;){var u=zn[i];zn[i++]=null;var f=zn[i];zn[i++]=null;var v=zn[i];zn[i++]=null;var x=zn[i];if(zn[i++]=null,f!==null&&v!==null){var R=f.pending;R===null?v.next=v:(v.next=R.next,R.next=v),f.pending=v}x!==0&&vg(u,v,x)}}function ac(s,i,u,f){zn[_i++]=s,zn[_i++]=i,zn[_i++]=u,zn[_i++]=f,Vu|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Ku(s,i,u,f){return ac(s,i,u,f),ic(s)}function Ya(s,i){return ac(s,null,null,i),ic(s)}function vg(s,i,u){s.lanes|=u;var f=s.alternate;f!==null&&(f.lanes|=u);for(var v=!1,x=s.return;x!==null;)x.childLanes|=u,f=x.alternate,f!==null&&(f.childLanes|=u),x.tag===22&&(s=x.stateNode,s===null||s._visibility&1||(v=!0)),s=x,x=x.return;return s.tag===3?(x=s.stateNode,v&&i!==null&&(v=31-jt(u),s=x.hiddenUpdates,f=s[v],f===null?s[v]=[i]:f.push(i),i.lane=u|536870912),x):null}function ic(s){if(50<or)throw or=0,sf=null,Error(n(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var ji={};function PC(s,i,u,f){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wn(s,i,u,f){return new PC(s,i,u,f)}function Yu(s){return s=s.prototype,!(!s||!s.isReactComponent)}function js(s,i){var u=s.alternate;return u===null?(u=wn(s.tag,i,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=i,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&65011712,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,i=s.dependencies,u.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function bg(s,i){s.flags&=65011714;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,i=u.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function oc(s,i,u,f,v,x){var R=0;if(f=s,typeof s=="function")Yu(s)&&(R=1);else if(typeof s=="string")R=BM(s,u,ae.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case J:return s=wn(31,u,i,v),s.elementType=J,s.lanes=x,s;case C:return Wa(u.children,v,x,i);case E:R=8,v|=24;break;case M:return s=wn(12,u,i,v|2),s.elementType=M,s.lanes=x,s;case N:return s=wn(13,u,i,v),s.elementType=N,s.lanes=x,s;case q:return s=wn(19,u,i,v),s.elementType=q,s.lanes=x,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case T:R=10;break e;case k:R=9;break e;case A:R=11;break e;case O:R=14;break e;case H:R=16,f=null;break e}R=29,u=Error(n(130,s===null?"null":typeof s,"")),f=null}return i=wn(R,u,i,v),i.elementType=s,i.type=f,i.lanes=x,i}function Wa(s,i,u,f){return s=wn(7,s,f,i),s.lanes=u,s}function Wu(s,i,u){return s=wn(6,s,null,i),s.lanes=u,s}function xg(s){var i=wn(18,null,null,0);return i.stateNode=s,i}function Xu(s,i,u){return i=wn(4,s.children!==null?s.children:[],s.key,i),i.lanes=u,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var wg=new WeakMap;function Pn(s,i){if(typeof s=="object"&&s!==null){var u=wg.get(s);return u!==void 0?u:(i={value:s,source:i,stack:de(i)},wg.set(s,i),i)}return{value:s,source:i,stack:de(i)}}var Li=[],zi=0,rc=null,qo=0,On=[],In=0,ra=null,cs=1,ls="";function Ls(s,i){Li[zi++]=qo,Li[zi++]=rc,rc=s,qo=i}function Sg(s,i,u){On[In++]=cs,On[In++]=ls,On[In++]=ra,ra=s;var f=cs;s=ls;var v=32-jt(f)-1;f&=~(1<<v),u+=1;var x=32-jt(i)+v;if(30<x){var R=v-v%5;x=(f&(1<<R)-1).toString(32),f>>=R,v-=R,cs=1<<32-jt(i)+v|u<<v|f,ls=x+s}else cs=1<<x|u<<v|f,ls=s}function Zu(s){s.return!==null&&(Ls(s,1),Sg(s,1,0))}function Ju(s){for(;s===rc;)rc=Li[--zi],Li[zi]=null,qo=Li[--zi],Li[zi]=null;for(;s===ra;)ra=On[--In],On[In]=null,ls=On[--In],On[In]=null,cs=On[--In],On[In]=null}function Cg(s,i){On[In++]=cs,On[In++]=ls,On[In++]=ra,cs=i.id,ls=i.overflow,ra=s}var Zt=null,bt=null,Xe=!1,ca=null,qn=!1,ed=Error(n(519));function la(s){var i=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ho(Pn(i,s)),ed}function Mg(s){var i=s.stateNode,u=s.type,f=s.memoizedProps;switch(i[mt]=s,i[Ht]=f,u){case"dialog":Ge("cancel",i),Ge("close",i);break;case"iframe":case"object":case"embed":Ge("load",i);break;case"video":case"audio":for(u=0;u<cr.length;u++)Ge(cr[u],i);break;case"source":Ge("error",i);break;case"img":case"image":case"link":Ge("error",i),Ge("load",i);break;case"details":Ge("toggle",i);break;case"input":Ge("invalid",i),Op(i,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Ge("invalid",i);break;case"textarea":Ge("invalid",i),qp(i,f.value,f.defaultValue,f.children)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||i.textContent===""+u||f.suppressHydrationWarning===!0||By(i.textContent,u)?(f.popover!=null&&(Ge("beforetoggle",i),Ge("toggle",i)),f.onScroll!=null&&Ge("scroll",i),f.onScrollEnd!=null&&Ge("scrollend",i),f.onClick!=null&&(i.onclick=Ns),i=!0):i=!1,i||la(s,!0)}function Eg(s){for(Zt=s.return;Zt;)switch(Zt.tag){case 5:case 31:case 13:qn=!1;return;case 27:case 3:qn=!0;return;default:Zt=Zt.return}}function Pi(s){if(s!==Zt)return!1;if(!Xe)return Eg(s),Xe=!0,!1;var i=s.tag,u;if((u=i!==3&&i!==27)&&((u=i===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||bf(s.type,s.memoizedProps)),u=!u),u&&bt&&la(s),Eg(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));bt=Wy(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));bt=Wy(s)}else i===27?(i=bt,Ca(s.type)?(s=Mf,Mf=null,bt=s):bt=i):bt=Zt?Bn(s.stateNode.nextSibling):null;return!0}function Xa(){bt=Zt=null,Xe=!1}function td(){var s=ca;return s!==null&&(mn===null?mn=s:mn.push.apply(mn,s),ca=null),s}function Ho(s){ca===null?ca=[s]:ca.push(s)}var nd=j(null),Za=null,zs=null;function ua(s,i,u){Y(nd,i._currentValue),i._currentValue=u}function Ps(s){s._currentValue=nd.current,Q(nd)}function sd(s,i,u){for(;s!==null;){var f=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,f!==null&&(f.childLanes|=i)):f!==null&&(f.childLanes&i)!==i&&(f.childLanes|=i),s===u)break;s=s.return}}function ad(s,i,u,f){var v=s.child;for(v!==null&&(v.return=s);v!==null;){var x=v.dependencies;if(x!==null){var R=v.child;x=x.firstContext;e:for(;x!==null;){var D=x;x=v;for(var z=0;z<i.length;z++)if(D.context===i[z]){x.lanes|=u,D=x.alternate,D!==null&&(D.lanes|=u),sd(x.return,u,s),f||(R=null);break e}x=D.next}}else if(v.tag===18){if(R=v.return,R===null)throw Error(n(341));R.lanes|=u,x=R.alternate,x!==null&&(x.lanes|=u),sd(R,u,s),R=null}else R=v.child;if(R!==null)R.return=v;else for(R=v;R!==null;){if(R===s){R=null;break}if(v=R.sibling,v!==null){v.return=R.return,R=v;break}R=R.return}v=R}}function Oi(s,i,u,f){s=null;for(var v=i,x=!1;v!==null;){if(!x){if((v.flags&524288)!==0)x=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var R=v.alternate;if(R===null)throw Error(n(387));if(R=R.memoizedProps,R!==null){var D=v.type;xn(v.pendingProps.value,R.value)||(s!==null?s.push(D):s=[D])}}else if(v===$.current){if(R=v.alternate,R===null)throw Error(n(387));R.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(s!==null?s.push(hr):s=[hr])}v=v.return}s!==null&&ad(i,s,u,f),i.flags|=262144}function cc(s){for(s=s.firstContext;s!==null;){if(!xn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Ja(s){Za=s,zs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Jt(s){return Rg(Za,s)}function lc(s,i){return Za===null&&Ja(s),Rg(s,i)}function Rg(s,i){var u=i._currentValue;if(i={context:i,memoizedValue:u,next:null},zs===null){if(s===null)throw Error(n(308));zs=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else zs=zs.next=i;return u}var OC=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(u,f){s.push(f)}};this.abort=function(){i.aborted=!0,s.forEach(function(u){return u()})}},IC=o.unstable_scheduleCallback,qC=o.unstable_NormalPriority,zt={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function id(){return{controller:new OC,data:new Map,refCount:0}}function Bo(s){s.refCount--,s.refCount===0&&IC(qC,function(){s.controller.abort()})}var $o=null,od=0,Ii=0,qi=null;function HC(s,i){if($o===null){var u=$o=[];od=0,Ii=uf(),qi={status:"pending",value:void 0,then:function(f){u.push(f)}}}return od++,i.then(Tg,Tg),i}function Tg(){if(--od===0&&$o!==null){qi!==null&&(qi.status="fulfilled");var s=$o;$o=null,Ii=0,qi=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function BC(s,i){var u=[],f={status:"pending",value:null,reason:null,then:function(v){u.push(v)}};return s.then(function(){f.status="fulfilled",f.value=i;for(var v=0;v<u.length;v++)(0,u[v])(i)},function(v){for(f.status="rejected",f.reason=v,v=0;v<u.length;v++)(0,u[v])(void 0)}),f}var kg=L.S;L.S=function(s,i){dy=Je(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&HC(s,i),kg!==null&&kg(s,i)};var ei=j(null);function rd(){var s=ei.current;return s!==null?s:ft.pooledCache}function uc(s,i){i===null?Y(ei,ei.current):Y(ei,i.pool)}function Ag(){var s=rd();return s===null?null:{parent:zt._currentValue,pool:s}}var Hi=Error(n(460)),cd=Error(n(474)),dc=Error(n(542)),fc={then:function(){}};function Dg(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Ng(s,i,u){switch(u=s[u],u===void 0?s.push(i):u!==i&&(i.then(Ns,Ns),i=u),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,jg(s),s;default:if(typeof i.status=="string")i.then(Ns,Ns);else{if(s=ft,s!==null&&100<s.shellSuspendCounter)throw Error(n(482));s=i,s.status="pending",s.then(function(f){if(i.status==="pending"){var v=i;v.status="fulfilled",v.value=f}},function(f){if(i.status==="pending"){var v=i;v.status="rejected",v.reason=f}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,jg(s),s}throw ni=i,Hi}}function ti(s){try{var i=s._init;return i(s._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(ni=u,Hi):u}}var ni=null;function _g(){if(ni===null)throw Error(n(459));var s=ni;return ni=null,s}function jg(s){if(s===Hi||s===dc)throw Error(n(483))}var Bi=null,Uo=0;function hc(s){var i=Uo;return Uo+=1,Bi===null&&(Bi=[]),Ng(Bi,s,i)}function Qo(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function pc(s,i){throw i.$$typeof===y?Error(n(525)):(s=Object.prototype.toString.call(i),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function Lg(s){function i(B,I){if(s){var F=B.deletions;F===null?(B.deletions=[I],B.flags|=16):F.push(I)}}function u(B,I){if(!s)return null;for(;I!==null;)i(B,I),I=I.sibling;return null}function f(B){for(var I=new Map;B!==null;)B.key!==null?I.set(B.key,B):I.set(B.index,B),B=B.sibling;return I}function v(B,I){return B=js(B,I),B.index=0,B.sibling=null,B}function x(B,I,F){return B.index=F,s?(F=B.alternate,F!==null?(F=F.index,F<I?(B.flags|=67108866,I):F):(B.flags|=67108866,I)):(B.flags|=1048576,I)}function R(B){return s&&B.alternate===null&&(B.flags|=67108866),B}function D(B,I,F,oe){return I===null||I.tag!==6?(I=Wu(F,B.mode,oe),I.return=B,I):(I=v(I,F),I.return=B,I)}function z(B,I,F,oe){var Te=F.type;return Te===C?ne(B,I,F.props.children,oe,F.key):I!==null&&(I.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===H&&ti(Te)===I.type)?(I=v(I,F.props),Qo(I,F),I.return=B,I):(I=oc(F.type,F.key,F.props,null,B.mode,oe),Qo(I,F),I.return=B,I)}function G(B,I,F,oe){return I===null||I.tag!==4||I.stateNode.containerInfo!==F.containerInfo||I.stateNode.implementation!==F.implementation?(I=Xu(F,B.mode,oe),I.return=B,I):(I=v(I,F.children||[]),I.return=B,I)}function ne(B,I,F,oe,Te){return I===null||I.tag!==7?(I=Wa(F,B.mode,oe,Te),I.return=B,I):(I=v(I,F),I.return=B,I)}function re(B,I,F){if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return I=Wu(""+I,B.mode,F),I.return=B,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case b:return F=oc(I.type,I.key,I.props,null,B.mode,F),Qo(F,I),F.return=B,F;case S:return I=Xu(I,B.mode,F),I.return=B,I;case H:return I=ti(I),re(B,I,F)}if(ue(I)||Z(I))return I=Wa(I,B.mode,F,null),I.return=B,I;if(typeof I.then=="function")return re(B,hc(I),F);if(I.$$typeof===T)return re(B,lc(B,I),F);pc(B,I)}return null}function K(B,I,F,oe){var Te=I!==null?I.key:null;if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return Te!==null?null:D(B,I,""+F,oe);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case b:return F.key===Te?z(B,I,F,oe):null;case S:return F.key===Te?G(B,I,F,oe):null;case H:return F=ti(F),K(B,I,F,oe)}if(ue(F)||Z(F))return Te!==null?null:ne(B,I,F,oe,null);if(typeof F.then=="function")return K(B,I,hc(F),oe);if(F.$$typeof===T)return K(B,I,lc(B,F),oe);pc(B,F)}return null}function X(B,I,F,oe,Te){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return B=B.get(F)||null,D(I,B,""+oe,Te);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case b:return B=B.get(oe.key===null?F:oe.key)||null,z(I,B,oe,Te);case S:return B=B.get(oe.key===null?F:oe.key)||null,G(I,B,oe,Te);case H:return oe=ti(oe),X(B,I,F,oe,Te)}if(ue(oe)||Z(oe))return B=B.get(F)||null,ne(I,B,oe,Te,null);if(typeof oe.then=="function")return X(B,I,F,hc(oe),Te);if(oe.$$typeof===T)return X(B,I,F,lc(I,oe),Te);pc(I,oe)}return null}function xe(B,I,F,oe){for(var Te=null,et=null,Me=I,qe=I=0,Ke=null;Me!==null&&qe<F.length;qe++){Me.index>qe?(Ke=Me,Me=null):Ke=Me.sibling;var tt=K(B,Me,F[qe],oe);if(tt===null){Me===null&&(Me=Ke);break}s&&Me&&tt.alternate===null&&i(B,Me),I=x(tt,I,qe),et===null?Te=tt:et.sibling=tt,et=tt,Me=Ke}if(qe===F.length)return u(B,Me),Xe&&Ls(B,qe),Te;if(Me===null){for(;qe<F.length;qe++)Me=re(B,F[qe],oe),Me!==null&&(I=x(Me,I,qe),et===null?Te=Me:et.sibling=Me,et=Me);return Xe&&Ls(B,qe),Te}for(Me=f(Me);qe<F.length;qe++)Ke=X(Me,B,qe,F[qe],oe),Ke!==null&&(s&&Ke.alternate!==null&&Me.delete(Ke.key===null?qe:Ke.key),I=x(Ke,I,qe),et===null?Te=Ke:et.sibling=Ke,et=Ke);return s&&Me.forEach(function(ka){return i(B,ka)}),Xe&&Ls(B,qe),Te}function De(B,I,F,oe){if(F==null)throw Error(n(151));for(var Te=null,et=null,Me=I,qe=I=0,Ke=null,tt=F.next();Me!==null&&!tt.done;qe++,tt=F.next()){Me.index>qe?(Ke=Me,Me=null):Ke=Me.sibling;var ka=K(B,Me,tt.value,oe);if(ka===null){Me===null&&(Me=Ke);break}s&&Me&&ka.alternate===null&&i(B,Me),I=x(ka,I,qe),et===null?Te=ka:et.sibling=ka,et=ka,Me=Ke}if(tt.done)return u(B,Me),Xe&&Ls(B,qe),Te;if(Me===null){for(;!tt.done;qe++,tt=F.next())tt=re(B,tt.value,oe),tt!==null&&(I=x(tt,I,qe),et===null?Te=tt:et.sibling=tt,et=tt);return Xe&&Ls(B,qe),Te}for(Me=f(Me);!tt.done;qe++,tt=F.next())tt=X(Me,B,qe,tt.value,oe),tt!==null&&(s&&tt.alternate!==null&&Me.delete(tt.key===null?qe:tt.key),I=x(tt,I,qe),et===null?Te=tt:et.sibling=tt,et=tt);return s&&Me.forEach(function(ZM){return i(B,ZM)}),Xe&&Ls(B,qe),Te}function dt(B,I,F,oe){if(typeof F=="object"&&F!==null&&F.type===C&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case b:e:{for(var Te=F.key;I!==null;){if(I.key===Te){if(Te=F.type,Te===C){if(I.tag===7){u(B,I.sibling),oe=v(I,F.props.children),oe.return=B,B=oe;break e}}else if(I.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===H&&ti(Te)===I.type){u(B,I.sibling),oe=v(I,F.props),Qo(oe,F),oe.return=B,B=oe;break e}u(B,I);break}else i(B,I);I=I.sibling}F.type===C?(oe=Wa(F.props.children,B.mode,oe,F.key),oe.return=B,B=oe):(oe=oc(F.type,F.key,F.props,null,B.mode,oe),Qo(oe,F),oe.return=B,B=oe)}return R(B);case S:e:{for(Te=F.key;I!==null;){if(I.key===Te)if(I.tag===4&&I.stateNode.containerInfo===F.containerInfo&&I.stateNode.implementation===F.implementation){u(B,I.sibling),oe=v(I,F.children||[]),oe.return=B,B=oe;break e}else{u(B,I);break}else i(B,I);I=I.sibling}oe=Xu(F,B.mode,oe),oe.return=B,B=oe}return R(B);case H:return F=ti(F),dt(B,I,F,oe)}if(ue(F))return xe(B,I,F,oe);if(Z(F)){if(Te=Z(F),typeof Te!="function")throw Error(n(150));return F=Te.call(F),De(B,I,F,oe)}if(typeof F.then=="function")return dt(B,I,hc(F),oe);if(F.$$typeof===T)return dt(B,I,lc(B,F),oe);pc(B,F)}return typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint"?(F=""+F,I!==null&&I.tag===6?(u(B,I.sibling),oe=v(I,F),oe.return=B,B=oe):(u(B,I),oe=Wu(F,B.mode,oe),oe.return=B,B=oe),R(B)):u(B,I)}return function(B,I,F,oe){try{Uo=0;var Te=dt(B,I,F,oe);return Bi=null,Te}catch(Me){if(Me===Hi||Me===dc)throw Me;var et=wn(29,Me,null,B.mode);return et.lanes=oe,et.return=B,et}finally{}}}var si=Lg(!0),zg=Lg(!1),da=!1;function ld(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ud(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function fa(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function ha(s,i,u){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(nt&2)!==0){var v=f.pending;return v===null?i.next=i:(i.next=v.next,v.next=i),f.pending=i,i=ic(s),vg(s,null,u),i}return ac(s,f,i,u),ic(s)}function Fo(s,i,u){if(i=i.updateQueue,i!==null&&(i=i.shared,(u&4194048)!==0)){var f=i.lanes;f&=s.pendingLanes,u|=f,i.lanes=u,ct(s,u)}}function dd(s,i){var u=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var v=null,x=null;if(u=u.firstBaseUpdate,u!==null){do{var R={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};x===null?v=x=R:x=x.next=R,u=u.next}while(u!==null);x===null?v=x=i:x=x.next=i}else v=x=i;u={baseState:f.baseState,firstBaseUpdate:v,lastBaseUpdate:x,shared:f.shared,callbacks:f.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=i:s.next=i,u.lastBaseUpdate=i}var fd=!1;function Go(){if(fd){var s=qi;if(s!==null)throw s}}function Vo(s,i,u,f){fd=!1;var v=s.updateQueue;da=!1;var x=v.firstBaseUpdate,R=v.lastBaseUpdate,D=v.shared.pending;if(D!==null){v.shared.pending=null;var z=D,G=z.next;z.next=null,R===null?x=G:R.next=G,R=z;var ne=s.alternate;ne!==null&&(ne=ne.updateQueue,D=ne.lastBaseUpdate,D!==R&&(D===null?ne.firstBaseUpdate=G:D.next=G,ne.lastBaseUpdate=z))}if(x!==null){var re=v.baseState;R=0,ne=G=z=null,D=x;do{var K=D.lane&-536870913,X=K!==D.lane;if(X?(Ve&K)===K:(f&K)===K){K!==0&&K===Ii&&(fd=!0),ne!==null&&(ne=ne.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var xe=s,De=D;K=i;var dt=u;switch(De.tag){case 1:if(xe=De.payload,typeof xe=="function"){re=xe.call(dt,re,K);break e}re=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=De.payload,K=typeof xe=="function"?xe.call(dt,re,K):xe,K==null)break e;re=m({},re,K);break e;case 2:da=!0}}K=D.callback,K!==null&&(s.flags|=64,X&&(s.flags|=8192),X=v.callbacks,X===null?v.callbacks=[K]:X.push(K))}else X={lane:K,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ne===null?(G=ne=X,z=re):ne=ne.next=X,R|=K;if(D=D.next,D===null){if(D=v.shared.pending,D===null)break;X=D,D=X.next,X.next=null,v.lastBaseUpdate=X,v.shared.pending=null}}while(!0);ne===null&&(z=re),v.baseState=z,v.firstBaseUpdate=G,v.lastBaseUpdate=ne,x===null&&(v.shared.lanes=0),va|=R,s.lanes=R,s.memoizedState=re}}function Pg(s,i){if(typeof s!="function")throw Error(n(191,s));s.call(i)}function Og(s,i){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)Pg(u[s],i)}var $i=j(null),gc=j(0);function Ig(s,i){s=Fs,Y(gc,s),Y($i,i),Fs=s|i.baseLanes}function hd(){Y(gc,Fs),Y($i,$i.current)}function pd(){Fs=gc.current,Q($i),Q(gc)}var Sn=j(null),Hn=null;function pa(s){var i=s.alternate;Y(Tt,Tt.current&1),Y(Sn,s),Hn===null&&(i===null||$i.current!==null||i.memoizedState!==null)&&(Hn=s)}function gd(s){Y(Tt,Tt.current),Y(Sn,s),Hn===null&&(Hn=s)}function qg(s){s.tag===22?(Y(Tt,Tt.current),Y(Sn,s),Hn===null&&(Hn=s)):ga()}function ga(){Y(Tt,Tt.current),Y(Sn,Sn.current)}function Cn(s){Q(Sn),Hn===s&&(Hn=null),Q(Tt)}var Tt=j(0);function mc(s){for(var i=s;i!==null;){if(i.tag===13){var u=i.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Sf(u)||Cf(u)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Os=0,Ie=null,lt=null,Pt=null,yc=!1,Ui=!1,ai=!1,vc=0,Ko=0,Qi=null,$C=0;function Ct(){throw Error(n(321))}function md(s,i){if(i===null)return!1;for(var u=0;u<i.length&&u<s.length;u++)if(!xn(s[u],i[u]))return!1;return!0}function yd(s,i,u,f,v,x){return Os=x,Ie=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,L.H=s===null||s.memoizedState===null?Sm:_d,ai=!1,x=u(f,v),ai=!1,Ui&&(x=Bg(i,u,f,v)),Hg(s),x}function Hg(s){L.H=Xo;var i=lt!==null&&lt.next!==null;if(Os=0,Pt=lt=Ie=null,yc=!1,Ko=0,Qi=null,i)throw Error(n(300));s===null||Ot||(s=s.dependencies,s!==null&&cc(s)&&(Ot=!0))}function Bg(s,i,u,f){Ie=s;var v=0;do{if(Ui&&(Qi=null),Ko=0,Ui=!1,25<=v)throw Error(n(301));if(v+=1,Pt=lt=null,s.updateQueue!=null){var x=s.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}L.H=Cm,x=i(u,f)}while(Ui);return x}function UC(){var s=L.H,i=s.useState()[0];return i=typeof i.then=="function"?Yo(i):i,s=s.useState()[0],(lt!==null?lt.memoizedState:null)!==s&&(Ie.flags|=1024),i}function vd(){var s=vc!==0;return vc=0,s}function bd(s,i,u){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~u}function xd(s){if(yc){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}yc=!1}Os=0,Pt=lt=Ie=null,Ui=!1,Ko=vc=0,Qi=null}function ln(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?Ie.memoizedState=Pt=s:Pt=Pt.next=s,Pt}function kt(){if(lt===null){var s=Ie.alternate;s=s!==null?s.memoizedState:null}else s=lt.next;var i=Pt===null?Ie.memoizedState:Pt.next;if(i!==null)Pt=i,lt=s;else{if(s===null)throw Ie.alternate===null?Error(n(467)):Error(n(310));lt=s,s={memoizedState:lt.memoizedState,baseState:lt.baseState,baseQueue:lt.baseQueue,queue:lt.queue,next:null},Pt===null?Ie.memoizedState=Pt=s:Pt=Pt.next=s}return Pt}function bc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yo(s){var i=Ko;return Ko+=1,Qi===null&&(Qi=[]),s=Ng(Qi,s,i),i=Ie,(Pt===null?i.memoizedState:Pt.next)===null&&(i=i.alternate,L.H=i===null||i.memoizedState===null?Sm:_d),s}function xc(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Yo(s);if(s.$$typeof===T)return Jt(s)}throw Error(n(438,String(s)))}function wd(s){var i=null,u=Ie.updateQueue;if(u!==null&&(i=u.memoCache),i==null){var f=Ie.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(i={data:f.data.map(function(v){return v.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),u===null&&(u=bc(),Ie.updateQueue=u),u.memoCache=i,u=i.data[i.index],u===void 0)for(u=i.data[i.index]=Array(s),f=0;f<s;f++)u[f]=se;return i.index++,u}function Is(s,i){return typeof i=="function"?i(s):i}function wc(s){var i=kt();return Sd(i,lt,s)}function Sd(s,i,u){var f=s.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=u;var v=s.baseQueue,x=f.pending;if(x!==null){if(v!==null){var R=v.next;v.next=x.next,x.next=R}i.baseQueue=v=x,f.pending=null}if(x=s.baseState,v===null)s.memoizedState=x;else{i=v.next;var D=R=null,z=null,G=i,ne=!1;do{var re=G.lane&-536870913;if(re!==G.lane?(Ve&re)===re:(Os&re)===re){var K=G.revertLane;if(K===0)z!==null&&(z=z.next={lane:0,revertLane:0,gesture:null,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),re===Ii&&(ne=!0);else if((Os&K)===K){G=G.next,K===Ii&&(ne=!0);continue}else re={lane:0,revertLane:G.revertLane,gesture:null,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},z===null?(D=z=re,R=x):z=z.next=re,Ie.lanes|=K,va|=K;re=G.action,ai&&u(x,re),x=G.hasEagerState?G.eagerState:u(x,re)}else K={lane:re,revertLane:G.revertLane,gesture:G.gesture,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},z===null?(D=z=K,R=x):z=z.next=K,Ie.lanes|=re,va|=re;G=G.next}while(G!==null&&G!==i);if(z===null?R=x:z.next=D,!xn(x,s.memoizedState)&&(Ot=!0,ne&&(u=qi,u!==null)))throw u;s.memoizedState=x,s.baseState=R,s.baseQueue=z,f.lastRenderedState=x}return v===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function Cd(s){var i=kt(),u=i.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=s;var f=u.dispatch,v=u.pending,x=i.memoizedState;if(v!==null){u.pending=null;var R=v=v.next;do x=s(x,R.action),R=R.next;while(R!==v);xn(x,i.memoizedState)||(Ot=!0),i.memoizedState=x,i.baseQueue===null&&(i.baseState=x),u.lastRenderedState=x}return[x,f]}function $g(s,i,u){var f=Ie,v=kt(),x=Xe;if(x){if(u===void 0)throw Error(n(407));u=u()}else u=i();var R=!xn((lt||v).memoizedState,u);if(R&&(v.memoizedState=u,Ot=!0),v=v.queue,Rd(Fg.bind(null,f,v,s),[s]),v.getSnapshot!==i||R||Pt!==null&&Pt.memoizedState.tag&1){if(f.flags|=2048,Fi(9,{destroy:void 0},Qg.bind(null,f,v,u,i),null),ft===null)throw Error(n(349));x||(Os&127)!==0||Ug(f,i,u)}return u}function Ug(s,i,u){s.flags|=16384,s={getSnapshot:i,value:u},i=Ie.updateQueue,i===null?(i=bc(),Ie.updateQueue=i,i.stores=[s]):(u=i.stores,u===null?i.stores=[s]:u.push(s))}function Qg(s,i,u,f){i.value=u,i.getSnapshot=f,Gg(i)&&Vg(s)}function Fg(s,i,u){return u(function(){Gg(i)&&Vg(s)})}function Gg(s){var i=s.getSnapshot;s=s.value;try{var u=i();return!xn(s,u)}catch{return!0}}function Vg(s){var i=Ya(s,2);i!==null&&yn(i,s,2)}function Md(s){var i=ln();if(typeof s=="function"){var u=s;if(s=u(),ai){Gt(!0);try{u()}finally{Gt(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:s},i}function Kg(s,i,u,f){return s.baseState=u,Sd(s,lt,typeof f=="function"?f:Is)}function QC(s,i,u,f,v){if(Mc(s))throw Error(n(485));if(s=i.action,s!==null){var x={payload:v,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){x.listeners.push(R)}};L.T!==null?u(!0):x.isTransition=!1,f(x),u=i.pending,u===null?(x.next=i.pending=x,Yg(i,x)):(x.next=u.next,i.pending=u.next=x)}}function Yg(s,i){var u=i.action,f=i.payload,v=s.state;if(i.isTransition){var x=L.T,R={};L.T=R;try{var D=u(v,f),z=L.S;z!==null&&z(R,D),Wg(s,i,D)}catch(G){Ed(s,i,G)}finally{x!==null&&R.types!==null&&(x.types=R.types),L.T=x}}else try{x=u(v,f),Wg(s,i,x)}catch(G){Ed(s,i,G)}}function Wg(s,i,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){Xg(s,i,f)},function(f){return Ed(s,i,f)}):Xg(s,i,u)}function Xg(s,i,u){i.status="fulfilled",i.value=u,Zg(i),s.state=u,i=s.pending,i!==null&&(u=i.next,u===i?s.pending=null:(u=u.next,i.next=u,Yg(s,u)))}function Ed(s,i,u){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do i.status="rejected",i.reason=u,Zg(i),i=i.next;while(i!==f)}s.action=null}function Zg(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function Jg(s,i){return i}function em(s,i){if(Xe){var u=ft.formState;if(u!==null){e:{var f=Ie;if(Xe){if(bt){t:{for(var v=bt,x=qn;v.nodeType!==8;){if(!x){v=null;break t}if(v=Bn(v.nextSibling),v===null){v=null;break t}}x=v.data,v=x==="F!"||x==="F"?v:null}if(v){bt=Bn(v.nextSibling),f=v.data==="F!";break e}}la(f)}f=!1}f&&(i=u[0])}}return u=ln(),u.memoizedState=u.baseState=i,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jg,lastRenderedState:i},u.queue=f,u=bm.bind(null,Ie,f),f.dispatch=u,f=Md(!1),x=Nd.bind(null,Ie,!1,f.queue),f=ln(),v={state:i,dispatch:null,action:s,pending:null},f.queue=v,u=QC.bind(null,Ie,v,x,u),v.dispatch=u,f.memoizedState=s,[i,u,!1]}function tm(s){var i=kt();return nm(i,lt,s)}function nm(s,i,u){if(i=Sd(s,i,Jg)[0],s=wc(Is)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var f=Yo(i)}catch(R){throw R===Hi?dc:R}else f=i;i=kt();var v=i.queue,x=v.dispatch;return u!==i.memoizedState&&(Ie.flags|=2048,Fi(9,{destroy:void 0},FC.bind(null,v,u),null)),[f,x,s]}function FC(s,i){s.action=i}function sm(s){var i=kt(),u=lt;if(u!==null)return nm(i,u,s);kt(),i=i.memoizedState,u=kt();var f=u.queue.dispatch;return u.memoizedState=s,[i,f,!1]}function Fi(s,i,u,f){return s={tag:s,create:u,deps:f,inst:i,next:null},i=Ie.updateQueue,i===null&&(i=bc(),Ie.updateQueue=i),u=i.lastEffect,u===null?i.lastEffect=s.next=s:(f=u.next,u.next=s,s.next=f,i.lastEffect=s),s}function am(){return kt().memoizedState}function Sc(s,i,u,f){var v=ln();Ie.flags|=s,v.memoizedState=Fi(1|i,{destroy:void 0},u,f===void 0?null:f)}function Cc(s,i,u,f){var v=kt();f=f===void 0?null:f;var x=v.memoizedState.inst;lt!==null&&f!==null&&md(f,lt.memoizedState.deps)?v.memoizedState=Fi(i,x,u,f):(Ie.flags|=s,v.memoizedState=Fi(1|i,x,u,f))}function im(s,i){Sc(8390656,8,s,i)}function Rd(s,i){Cc(2048,8,s,i)}function GC(s){Ie.flags|=4;var i=Ie.updateQueue;if(i===null)i=bc(),Ie.updateQueue=i,i.events=[s];else{var u=i.events;u===null?i.events=[s]:u.push(s)}}function om(s){var i=kt().memoizedState;return GC({ref:i,nextImpl:s}),function(){if((nt&2)!==0)throw Error(n(440));return i.impl.apply(void 0,arguments)}}function rm(s,i){return Cc(4,2,s,i)}function cm(s,i){return Cc(4,4,s,i)}function lm(s,i){if(typeof i=="function"){s=s();var u=i(s);return function(){typeof u=="function"?u():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function um(s,i,u){u=u!=null?u.concat([s]):null,Cc(4,4,lm.bind(null,i,s),u)}function Td(){}function dm(s,i){var u=kt();i=i===void 0?null:i;var f=u.memoizedState;return i!==null&&md(i,f[1])?f[0]:(u.memoizedState=[s,i],s)}function fm(s,i){var u=kt();i=i===void 0?null:i;var f=u.memoizedState;if(i!==null&&md(i,f[1]))return f[0];if(f=s(),ai){Gt(!0);try{s()}finally{Gt(!1)}}return u.memoizedState=[f,i],f}function kd(s,i,u){return u===void 0||(Os&1073741824)!==0&&(Ve&261930)===0?s.memoizedState=i:(s.memoizedState=u,s=hy(),Ie.lanes|=s,va|=s,u)}function hm(s,i,u,f){return xn(u,i)?u:$i.current!==null?(s=kd(s,u,f),xn(s,i)||(Ot=!0),s):(Os&42)===0||(Os&1073741824)!==0&&(Ve&261930)===0?(Ot=!0,s.memoizedState=u):(s=hy(),Ie.lanes|=s,va|=s,i)}function pm(s,i,u,f,v){var x=_.p;_.p=x!==0&&8>x?x:8;var R=L.T,D={};L.T=D,Nd(s,!1,i,u);try{var z=v(),G=L.S;if(G!==null&&G(D,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var ne=BC(z,f);Wo(s,i,ne,Rn(s))}else Wo(s,i,f,Rn(s))}catch(re){Wo(s,i,{then:function(){},status:"rejected",reason:re},Rn())}finally{_.p=x,R!==null&&D.types!==null&&(R.types=D.types),L.T=R}}function VC(){}function Ad(s,i,u,f){if(s.tag!==5)throw Error(n(476));var v=gm(s).queue;pm(s,v,i,P,u===null?VC:function(){return mm(s),u(f)})}function gm(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:P},next:null};var u={};return i.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:u},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function mm(s){var i=gm(s);i.next===null&&(i=s.alternate.memoizedState),Wo(s,i.next.queue,{},Rn())}function Dd(){return Jt(hr)}function ym(){return kt().memoizedState}function vm(){return kt().memoizedState}function KC(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var u=Rn();s=fa(u);var f=ha(i,s,u);f!==null&&(yn(f,i,u),Fo(f,i,u)),i={cache:id()},s.payload=i;return}i=i.return}}function YC(s,i,u){var f=Rn();u={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Mc(s)?xm(i,u):(u=Ku(s,i,u,f),u!==null&&(yn(u,s,f),wm(u,i,f)))}function bm(s,i,u){var f=Rn();Wo(s,i,u,f)}function Wo(s,i,u,f){var v={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Mc(s))xm(i,v);else{var x=s.alternate;if(s.lanes===0&&(x===null||x.lanes===0)&&(x=i.lastRenderedReducer,x!==null))try{var R=i.lastRenderedState,D=x(R,u);if(v.hasEagerState=!0,v.eagerState=D,xn(D,R))return ac(s,i,v,0),ft===null&&sc(),!1}catch{}finally{}if(u=Ku(s,i,v,f),u!==null)return yn(u,s,f),wm(u,i,f),!0}return!1}function Nd(s,i,u,f){if(f={lane:2,revertLane:uf(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Mc(s)){if(i)throw Error(n(479))}else i=Ku(s,u,f,2),i!==null&&yn(i,s,2)}function Mc(s){var i=s.alternate;return s===Ie||i!==null&&i===Ie}function xm(s,i){Ui=yc=!0;var u=s.pending;u===null?i.next=i:(i.next=u.next,u.next=i),s.pending=i}function wm(s,i,u){if((u&4194048)!==0){var f=i.lanes;f&=s.pendingLanes,u|=f,i.lanes=u,ct(s,u)}}var Xo={readContext:Jt,use:xc,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useLayoutEffect:Ct,useInsertionEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useSyncExternalStore:Ct,useId:Ct,useHostTransitionStatus:Ct,useFormState:Ct,useActionState:Ct,useOptimistic:Ct,useMemoCache:Ct,useCacheRefresh:Ct};Xo.useEffectEvent=Ct;var Sm={readContext:Jt,use:xc,useCallback:function(s,i){return ln().memoizedState=[s,i===void 0?null:i],s},useContext:Jt,useEffect:im,useImperativeHandle:function(s,i,u){u=u!=null?u.concat([s]):null,Sc(4194308,4,lm.bind(null,i,s),u)},useLayoutEffect:function(s,i){return Sc(4194308,4,s,i)},useInsertionEffect:function(s,i){Sc(4,2,s,i)},useMemo:function(s,i){var u=ln();i=i===void 0?null:i;var f=s();if(ai){Gt(!0);try{s()}finally{Gt(!1)}}return u.memoizedState=[f,i],f},useReducer:function(s,i,u){var f=ln();if(u!==void 0){var v=u(i);if(ai){Gt(!0);try{u(i)}finally{Gt(!1)}}}else v=i;return f.memoizedState=f.baseState=v,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:v},f.queue=s,s=s.dispatch=YC.bind(null,Ie,s),[f.memoizedState,s]},useRef:function(s){var i=ln();return s={current:s},i.memoizedState=s},useState:function(s){s=Md(s);var i=s.queue,u=bm.bind(null,Ie,i);return i.dispatch=u,[s.memoizedState,u]},useDebugValue:Td,useDeferredValue:function(s,i){var u=ln();return kd(u,s,i)},useTransition:function(){var s=Md(!1);return s=pm.bind(null,Ie,s.queue,!0,!1),ln().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,u){var f=Ie,v=ln();if(Xe){if(u===void 0)throw Error(n(407));u=u()}else{if(u=i(),ft===null)throw Error(n(349));(Ve&127)!==0||Ug(f,i,u)}v.memoizedState=u;var x={value:u,getSnapshot:i};return v.queue=x,im(Fg.bind(null,f,x,s),[s]),f.flags|=2048,Fi(9,{destroy:void 0},Qg.bind(null,f,x,u,i),null),u},useId:function(){var s=ln(),i=ft.identifierPrefix;if(Xe){var u=ls,f=cs;u=(f&~(1<<32-jt(f)-1)).toString(32)+u,i="_"+i+"R_"+u,u=vc++,0<u&&(i+="H"+u.toString(32)),i+="_"}else u=$C++,i="_"+i+"r_"+u.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:Dd,useFormState:em,useActionState:em,useOptimistic:function(s){var i=ln();i.memoizedState=i.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=u,i=Nd.bind(null,Ie,!0,u),u.dispatch=i,[s,i]},useMemoCache:wd,useCacheRefresh:function(){return ln().memoizedState=KC.bind(null,Ie)},useEffectEvent:function(s){var i=ln(),u={impl:s};return i.memoizedState=u,function(){if((nt&2)!==0)throw Error(n(440));return u.impl.apply(void 0,arguments)}}},_d={readContext:Jt,use:xc,useCallback:dm,useContext:Jt,useEffect:Rd,useImperativeHandle:um,useInsertionEffect:rm,useLayoutEffect:cm,useMemo:fm,useReducer:wc,useRef:am,useState:function(){return wc(Is)},useDebugValue:Td,useDeferredValue:function(s,i){var u=kt();return hm(u,lt.memoizedState,s,i)},useTransition:function(){var s=wc(Is)[0],i=kt().memoizedState;return[typeof s=="boolean"?s:Yo(s),i]},useSyncExternalStore:$g,useId:ym,useHostTransitionStatus:Dd,useFormState:tm,useActionState:tm,useOptimistic:function(s,i){var u=kt();return Kg(u,lt,s,i)},useMemoCache:wd,useCacheRefresh:vm};_d.useEffectEvent=om;var Cm={readContext:Jt,use:xc,useCallback:dm,useContext:Jt,useEffect:Rd,useImperativeHandle:um,useInsertionEffect:rm,useLayoutEffect:cm,useMemo:fm,useReducer:Cd,useRef:am,useState:function(){return Cd(Is)},useDebugValue:Td,useDeferredValue:function(s,i){var u=kt();return lt===null?kd(u,s,i):hm(u,lt.memoizedState,s,i)},useTransition:function(){var s=Cd(Is)[0],i=kt().memoizedState;return[typeof s=="boolean"?s:Yo(s),i]},useSyncExternalStore:$g,useId:ym,useHostTransitionStatus:Dd,useFormState:sm,useActionState:sm,useOptimistic:function(s,i){var u=kt();return lt!==null?Kg(u,lt,s,i):(u.baseState=s,[s,u.queue.dispatch])},useMemoCache:wd,useCacheRefresh:vm};Cm.useEffectEvent=om;function jd(s,i,u,f){i=s.memoizedState,u=u(f,i),u=u==null?i:m({},i,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var Ld={enqueueSetState:function(s,i,u){s=s._reactInternals;var f=Rn(),v=fa(f);v.payload=i,u!=null&&(v.callback=u),i=ha(s,v,f),i!==null&&(yn(i,s,f),Fo(i,s,f))},enqueueReplaceState:function(s,i,u){s=s._reactInternals;var f=Rn(),v=fa(f);v.tag=1,v.payload=i,u!=null&&(v.callback=u),i=ha(s,v,f),i!==null&&(yn(i,s,f),Fo(i,s,f))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var u=Rn(),f=fa(u);f.tag=2,i!=null&&(f.callback=i),i=ha(s,f,u),i!==null&&(yn(i,s,u),Fo(i,s,u))}};function Mm(s,i,u,f,v,x,R){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,x,R):i.prototype&&i.prototype.isPureReactComponent?!Oo(u,f)||!Oo(v,x):!0}function Em(s,i,u,f){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(u,f),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(u,f),i.state!==s&&Ld.enqueueReplaceState(i,i.state,null)}function ii(s,i){var u=i;if("ref"in i){u={};for(var f in i)f!=="ref"&&(u[f]=i[f])}if(s=s.defaultProps){u===i&&(u=m({},u));for(var v in s)u[v]===void 0&&(u[v]=s[v])}return u}function Rm(s){nc(s)}function Tm(s){console.error(s)}function km(s){nc(s)}function Ec(s,i){try{var u=s.onUncaughtError;u(i.value,{componentStack:i.stack})}catch(f){setTimeout(function(){throw f})}}function Am(s,i,u){try{var f=s.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function zd(s,i,u){return u=fa(u),u.tag=3,u.payload={element:null},u.callback=function(){Ec(s,i)},u}function Dm(s){return s=fa(s),s.tag=3,s}function Nm(s,i,u,f){var v=u.type.getDerivedStateFromError;if(typeof v=="function"){var x=f.value;s.payload=function(){return v(x)},s.callback=function(){Am(i,u,f)}}var R=u.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(s.callback=function(){Am(i,u,f),typeof v!="function"&&(ba===null?ba=new Set([this]):ba.add(this));var D=f.stack;this.componentDidCatch(f.value,{componentStack:D!==null?D:""})})}function WC(s,i,u,f,v){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(i=u.alternate,i!==null&&Oi(i,u,v,!0),u=Sn.current,u!==null){switch(u.tag){case 31:case 13:return Hn===null?Oc():u.alternate===null&&Mt===0&&(Mt=3),u.flags&=-257,u.flags|=65536,u.lanes=v,f===fc?u.flags|=16384:(i=u.updateQueue,i===null?u.updateQueue=new Set([f]):i.add(f),rf(s,f,v)),!1;case 22:return u.flags|=65536,f===fc?u.flags|=16384:(i=u.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=i):(u=i.retryQueue,u===null?i.retryQueue=new Set([f]):u.add(f)),rf(s,f,v)),!1}throw Error(n(435,u.tag))}return rf(s,f,v),Oc(),!1}if(Xe)return i=Sn.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=v,f!==ed&&(s=Error(n(422),{cause:f}),Ho(Pn(s,u)))):(f!==ed&&(i=Error(n(423),{cause:f}),Ho(Pn(i,u))),s=s.current.alternate,s.flags|=65536,v&=-v,s.lanes|=v,f=Pn(f,u),v=zd(s.stateNode,f,v),dd(s,v),Mt!==4&&(Mt=2)),!1;var x=Error(n(520),{cause:f});if(x=Pn(x,u),ir===null?ir=[x]:ir.push(x),Mt!==4&&(Mt=2),i===null)return!0;f=Pn(f,u),u=i;do{switch(u.tag){case 3:return u.flags|=65536,s=v&-v,u.lanes|=s,s=zd(u.stateNode,f,s),dd(u,s),!1;case 1:if(i=u.type,x=u.stateNode,(u.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(ba===null||!ba.has(x))))return u.flags|=65536,v&=-v,u.lanes|=v,v=Dm(v),Nm(v,s,u,f),dd(u,v),!1}u=u.return}while(u!==null);return!1}var Pd=Error(n(461)),Ot=!1;function en(s,i,u,f){i.child=s===null?zg(i,null,u,f):si(i,s.child,u,f)}function _m(s,i,u,f,v){u=u.render;var x=i.ref;if("ref"in f){var R={};for(var D in f)D!=="ref"&&(R[D]=f[D])}else R=f;return Ja(i),f=yd(s,i,u,R,x,v),D=vd(),s!==null&&!Ot?(bd(s,i,v),qs(s,i,v)):(Xe&&D&&Zu(i),i.flags|=1,en(s,i,f,v),i.child)}function jm(s,i,u,f,v){if(s===null){var x=u.type;return typeof x=="function"&&!Yu(x)&&x.defaultProps===void 0&&u.compare===null?(i.tag=15,i.type=x,Lm(s,i,x,f,v)):(s=oc(u.type,null,f,i,i.mode,v),s.ref=i.ref,s.return=i,i.child=s)}if(x=s.child,!Qd(s,v)){var R=x.memoizedProps;if(u=u.compare,u=u!==null?u:Oo,u(R,f)&&s.ref===i.ref)return qs(s,i,v)}return i.flags|=1,s=js(x,f),s.ref=i.ref,s.return=i,i.child=s}function Lm(s,i,u,f,v){if(s!==null){var x=s.memoizedProps;if(Oo(x,f)&&s.ref===i.ref)if(Ot=!1,i.pendingProps=f=x,Qd(s,v))(s.flags&131072)!==0&&(Ot=!0);else return i.lanes=s.lanes,qs(s,i,v)}return Od(s,i,u,f,v)}function zm(s,i,u,f){var v=f.children,x=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((i.flags&128)!==0){if(x=x!==null?x.baseLanes|u:u,s!==null){for(f=i.child=s.child,v=0;f!==null;)v=v|f.lanes|f.childLanes,f=f.sibling;f=v&~x}else f=0,i.child=null;return Pm(s,i,x,u,f)}if((u&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&uc(i,x!==null?x.cachePool:null),x!==null?Ig(i,x):hd(),qg(i);else return f=i.lanes=536870912,Pm(s,i,x!==null?x.baseLanes|u:u,u,f)}else x!==null?(uc(i,x.cachePool),Ig(i,x),ga(),i.memoizedState=null):(s!==null&&uc(i,null),hd(),ga());return en(s,i,v,u),i.child}function Zo(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function Pm(s,i,u,f,v){var x=rd();return x=x===null?null:{parent:zt._currentValue,pool:x},i.memoizedState={baseLanes:u,cachePool:x},s!==null&&uc(i,null),hd(),qg(i),s!==null&&Oi(s,i,f,!0),i.childLanes=v,null}function Rc(s,i){return i=kc({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function Om(s,i,u){return si(i,s.child,null,u),s=Rc(i,i.pendingProps),s.flags|=2,Cn(i),i.memoizedState=null,s}function XC(s,i,u){var f=i.pendingProps,v=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(Xe){if(f.mode==="hidden")return s=Rc(i,f),i.lanes=536870912,Zo(null,s);if(gd(i),(s=bt)?(s=Yy(s,qn),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:ra!==null?{id:cs,overflow:ls}:null,retryLane:536870912,hydrationErrors:null},u=xg(s),u.return=i,i.child=u,Zt=i,bt=null)):s=null,s===null)throw la(i);return i.lanes=536870912,null}return Rc(i,f)}var x=s.memoizedState;if(x!==null){var R=x.dehydrated;if(gd(i),v)if(i.flags&256)i.flags&=-257,i=Om(s,i,u);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(n(558));else if(Ot||Oi(s,i,u,!1),v=(u&s.childLanes)!==0,Ot||v){if(f=ft,f!==null&&(R=Lt(f,u),R!==0&&R!==x.retryLane))throw x.retryLane=R,Ya(s,R),yn(f,s,R),Pd;Oc(),i=Om(s,i,u)}else s=x.treeContext,bt=Bn(R.nextSibling),Zt=i,Xe=!0,ca=null,qn=!1,s!==null&&Cg(i,s),i=Rc(i,f),i.flags|=4096;return i}return s=js(s.child,{mode:f.mode,children:f.children}),s.ref=i.ref,i.child=s,s.return=i,s}function Tc(s,i){var u=i.ref;if(u===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(n(284));(s===null||s.ref!==u)&&(i.flags|=4194816)}}function Od(s,i,u,f,v){return Ja(i),u=yd(s,i,u,f,void 0,v),f=vd(),s!==null&&!Ot?(bd(s,i,v),qs(s,i,v)):(Xe&&f&&Zu(i),i.flags|=1,en(s,i,u,v),i.child)}function Im(s,i,u,f,v,x){return Ja(i),i.updateQueue=null,u=Bg(i,f,u,v),Hg(s),f=vd(),s!==null&&!Ot?(bd(s,i,x),qs(s,i,x)):(Xe&&f&&Zu(i),i.flags|=1,en(s,i,u,x),i.child)}function qm(s,i,u,f,v){if(Ja(i),i.stateNode===null){var x=ji,R=u.contextType;typeof R=="object"&&R!==null&&(x=Jt(R)),x=new u(f,x),i.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Ld,i.stateNode=x,x._reactInternals=i,x=i.stateNode,x.props=f,x.state=i.memoizedState,x.refs={},ld(i),R=u.contextType,x.context=typeof R=="object"&&R!==null?Jt(R):ji,x.state=i.memoizedState,R=u.getDerivedStateFromProps,typeof R=="function"&&(jd(i,u,R,f),x.state=i.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(R=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),R!==x.state&&Ld.enqueueReplaceState(x,x.state,null),Vo(i,f,x,v),Go(),x.state=i.memoizedState),typeof x.componentDidMount=="function"&&(i.flags|=4194308),f=!0}else if(s===null){x=i.stateNode;var D=i.memoizedProps,z=ii(u,D);x.props=z;var G=x.context,ne=u.contextType;R=ji,typeof ne=="object"&&ne!==null&&(R=Jt(ne));var re=u.getDerivedStateFromProps;ne=typeof re=="function"||typeof x.getSnapshotBeforeUpdate=="function",D=i.pendingProps!==D,ne||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(D||G!==R)&&Em(i,x,f,R),da=!1;var K=i.memoizedState;x.state=K,Vo(i,f,x,v),Go(),G=i.memoizedState,D||K!==G||da?(typeof re=="function"&&(jd(i,u,re,f),G=i.memoizedState),(z=da||Mm(i,u,z,f,K,G,R))?(ne||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(i.flags|=4194308)):(typeof x.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=f,i.memoizedState=G),x.props=f,x.state=G,x.context=R,f=z):(typeof x.componentDidMount=="function"&&(i.flags|=4194308),f=!1)}else{x=i.stateNode,ud(s,i),R=i.memoizedProps,ne=ii(u,R),x.props=ne,re=i.pendingProps,K=x.context,G=u.contextType,z=ji,typeof G=="object"&&G!==null&&(z=Jt(G)),D=u.getDerivedStateFromProps,(G=typeof D=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(R!==re||K!==z)&&Em(i,x,f,z),da=!1,K=i.memoizedState,x.state=K,Vo(i,f,x,v),Go();var X=i.memoizedState;R!==re||K!==X||da||s!==null&&s.dependencies!==null&&cc(s.dependencies)?(typeof D=="function"&&(jd(i,u,D,f),X=i.memoizedState),(ne=da||Mm(i,u,ne,f,K,X,z)||s!==null&&s.dependencies!==null&&cc(s.dependencies))?(G||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(f,X,z),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(f,X,z)),typeof x.componentDidUpdate=="function"&&(i.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof x.componentDidUpdate!="function"||R===s.memoizedProps&&K===s.memoizedState||(i.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||R===s.memoizedProps&&K===s.memoizedState||(i.flags|=1024),i.memoizedProps=f,i.memoizedState=X),x.props=f,x.state=X,x.context=z,f=ne):(typeof x.componentDidUpdate!="function"||R===s.memoizedProps&&K===s.memoizedState||(i.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||R===s.memoizedProps&&K===s.memoizedState||(i.flags|=1024),f=!1)}return x=f,Tc(s,i),f=(i.flags&128)!==0,x||f?(x=i.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:x.render(),i.flags|=1,s!==null&&f?(i.child=si(i,s.child,null,v),i.child=si(i,null,u,v)):en(s,i,u,v),i.memoizedState=x.state,s=i.child):s=qs(s,i,v),s}function Hm(s,i,u,f){return Xa(),i.flags|=256,en(s,i,u,f),i.child}var Id={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qd(s){return{baseLanes:s,cachePool:Ag()}}function Hd(s,i,u){return s=s!==null?s.childLanes&~u:0,i&&(s|=En),s}function Bm(s,i,u){var f=i.pendingProps,v=!1,x=(i.flags&128)!==0,R;if((R=x)||(R=s!==null&&s.memoizedState===null?!1:(Tt.current&2)!==0),R&&(v=!0,i.flags&=-129),R=(i.flags&32)!==0,i.flags&=-33,s===null){if(Xe){if(v?pa(i):ga(),(s=bt)?(s=Yy(s,qn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:ra!==null?{id:cs,overflow:ls}:null,retryLane:536870912,hydrationErrors:null},u=xg(s),u.return=i,i.child=u,Zt=i,bt=null)):s=null,s===null)throw la(i);return Cf(s)?i.lanes=32:i.lanes=536870912,null}var D=f.children;return f=f.fallback,v?(ga(),v=i.mode,D=kc({mode:"hidden",children:D},v),f=Wa(f,v,u,null),D.return=i,f.return=i,D.sibling=f,i.child=D,f=i.child,f.memoizedState=qd(u),f.childLanes=Hd(s,R,u),i.memoizedState=Id,Zo(null,f)):(pa(i),Bd(i,D))}var z=s.memoizedState;if(z!==null&&(D=z.dehydrated,D!==null)){if(x)i.flags&256?(pa(i),i.flags&=-257,i=$d(s,i,u)):i.memoizedState!==null?(ga(),i.child=s.child,i.flags|=128,i=null):(ga(),D=f.fallback,v=i.mode,f=kc({mode:"visible",children:f.children},v),D=Wa(D,v,u,null),D.flags|=2,f.return=i,D.return=i,f.sibling=D,i.child=f,si(i,s.child,null,u),f=i.child,f.memoizedState=qd(u),f.childLanes=Hd(s,R,u),i.memoizedState=Id,i=Zo(null,f));else if(pa(i),Cf(D)){if(R=D.nextSibling&&D.nextSibling.dataset,R)var G=R.dgst;R=G,f=Error(n(419)),f.stack="",f.digest=R,Ho({value:f,source:null,stack:null}),i=$d(s,i,u)}else if(Ot||Oi(s,i,u,!1),R=(u&s.childLanes)!==0,Ot||R){if(R=ft,R!==null&&(f=Lt(R,u),f!==0&&f!==z.retryLane))throw z.retryLane=f,Ya(s,f),yn(R,s,f),Pd;Sf(D)||Oc(),i=$d(s,i,u)}else Sf(D)?(i.flags|=192,i.child=s.child,i=null):(s=z.treeContext,bt=Bn(D.nextSibling),Zt=i,Xe=!0,ca=null,qn=!1,s!==null&&Cg(i,s),i=Bd(i,f.children),i.flags|=4096);return i}return v?(ga(),D=f.fallback,v=i.mode,z=s.child,G=z.sibling,f=js(z,{mode:"hidden",children:f.children}),f.subtreeFlags=z.subtreeFlags&65011712,G!==null?D=js(G,D):(D=Wa(D,v,u,null),D.flags|=2),D.return=i,f.return=i,f.sibling=D,i.child=f,Zo(null,f),f=i.child,D=s.child.memoizedState,D===null?D=qd(u):(v=D.cachePool,v!==null?(z=zt._currentValue,v=v.parent!==z?{parent:z,pool:z}:v):v=Ag(),D={baseLanes:D.baseLanes|u,cachePool:v}),f.memoizedState=D,f.childLanes=Hd(s,R,u),i.memoizedState=Id,Zo(s.child,f)):(pa(i),u=s.child,s=u.sibling,u=js(u,{mode:"visible",children:f.children}),u.return=i,u.sibling=null,s!==null&&(R=i.deletions,R===null?(i.deletions=[s],i.flags|=16):R.push(s)),i.child=u,i.memoizedState=null,u)}function Bd(s,i){return i=kc({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function kc(s,i){return s=wn(22,s,null,i),s.lanes=0,s}function $d(s,i,u){return si(i,s.child,null,u),s=Bd(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function $m(s,i,u){s.lanes|=i;var f=s.alternate;f!==null&&(f.lanes|=i),sd(s.return,i,u)}function Ud(s,i,u,f,v,x){var R=s.memoizedState;R===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:v,treeForkCount:x}:(R.isBackwards=i,R.rendering=null,R.renderingStartTime=0,R.last=f,R.tail=u,R.tailMode=v,R.treeForkCount=x)}function Um(s,i,u){var f=i.pendingProps,v=f.revealOrder,x=f.tail;f=f.children;var R=Tt.current,D=(R&2)!==0;if(D?(R=R&1|2,i.flags|=128):R&=1,Y(Tt,R),en(s,i,f,u),f=Xe?qo:0,!D&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&$m(s,u,i);else if(s.tag===19)$m(s,u,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(v){case"forwards":for(u=i.child,v=null;u!==null;)s=u.alternate,s!==null&&mc(s)===null&&(v=u),u=u.sibling;u=v,u===null?(v=i.child,i.child=null):(v=u.sibling,u.sibling=null),Ud(i,!1,v,u,x,f);break;case"backwards":case"unstable_legacy-backwards":for(u=null,v=i.child,i.child=null;v!==null;){if(s=v.alternate,s!==null&&mc(s)===null){i.child=v;break}s=v.sibling,v.sibling=u,u=v,v=s}Ud(i,!0,u,null,x,f);break;case"together":Ud(i,!1,null,null,void 0,f);break;default:i.memoizedState=null}return i.child}function qs(s,i,u){if(s!==null&&(i.dependencies=s.dependencies),va|=i.lanes,(u&i.childLanes)===0)if(s!==null){if(Oi(s,i,u,!1),(u&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(n(153));if(i.child!==null){for(s=i.child,u=js(s,s.pendingProps),i.child=u,u.return=i;s.sibling!==null;)s=s.sibling,u=u.sibling=js(s,s.pendingProps),u.return=i;u.sibling=null}return i.child}function Qd(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&cc(s)))}function ZC(s,i,u){switch(i.tag){case 3:V(i,i.stateNode.containerInfo),ua(i,zt,s.memoizedState.cache),Xa();break;case 27:case 5:me(i);break;case 4:V(i,i.stateNode.containerInfo);break;case 10:ua(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,gd(i),null;break;case 13:var f=i.memoizedState;if(f!==null)return f.dehydrated!==null?(pa(i),i.flags|=128,null):(u&i.child.childLanes)!==0?Bm(s,i,u):(pa(i),s=qs(s,i,u),s!==null?s.sibling:null);pa(i);break;case 19:var v=(s.flags&128)!==0;if(f=(u&i.childLanes)!==0,f||(Oi(s,i,u,!1),f=(u&i.childLanes)!==0),v){if(f)return Um(s,i,u);i.flags|=128}if(v=i.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),Y(Tt,Tt.current),f)break;return null;case 22:return i.lanes=0,zm(s,i,u,i.pendingProps);case 24:ua(i,zt,s.memoizedState.cache)}return qs(s,i,u)}function Qm(s,i,u){if(s!==null)if(s.memoizedProps!==i.pendingProps)Ot=!0;else{if(!Qd(s,u)&&(i.flags&128)===0)return Ot=!1,ZC(s,i,u);Ot=(s.flags&131072)!==0}else Ot=!1,Xe&&(i.flags&1048576)!==0&&Sg(i,qo,i.index);switch(i.lanes=0,i.tag){case 16:e:{var f=i.pendingProps;if(s=ti(i.elementType),i.type=s,typeof s=="function")Yu(s)?(f=ii(s,f),i.tag=1,i=qm(null,i,s,f,u)):(i.tag=0,i=Od(null,i,s,f,u));else{if(s!=null){var v=s.$$typeof;if(v===A){i.tag=11,i=_m(null,i,s,f,u);break e}else if(v===O){i.tag=14,i=jm(null,i,s,f,u);break e}}throw i=le(s)||s,Error(n(306,i,""))}}return i;case 0:return Od(s,i,i.type,i.pendingProps,u);case 1:return f=i.type,v=ii(f,i.pendingProps),qm(s,i,f,v,u);case 3:e:{if(V(i,i.stateNode.containerInfo),s===null)throw Error(n(387));f=i.pendingProps;var x=i.memoizedState;v=x.element,ud(s,i),Vo(i,f,null,u);var R=i.memoizedState;if(f=R.cache,ua(i,zt,f),f!==x.cache&&ad(i,[zt],u,!0),Go(),f=R.element,x.isDehydrated)if(x={element:f,isDehydrated:!1,cache:R.cache},i.updateQueue.baseState=x,i.memoizedState=x,i.flags&256){i=Hm(s,i,f,u);break e}else if(f!==v){v=Pn(Error(n(424)),i),Ho(v),i=Hm(s,i,f,u);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(bt=Bn(s.firstChild),Zt=i,Xe=!0,ca=null,qn=!0,u=zg(i,null,f,u),i.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Xa(),f===v){i=qs(s,i,u);break e}en(s,i,f,u)}i=i.child}return i;case 26:return Tc(s,i),s===null?(u=t0(i.type,null,i.pendingProps,null))?i.memoizedState=u:Xe||(u=i.type,s=i.pendingProps,f=Qc(ie.current).createElement(u),f[mt]=i,f[Ht]=s,tn(f,u,s),Vt(f),i.stateNode=f):i.memoizedState=t0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return me(i),s===null&&Xe&&(f=i.stateNode=Zy(i.type,i.pendingProps,ie.current),Zt=i,qn=!0,v=bt,Ca(i.type)?(Mf=v,bt=Bn(f.firstChild)):bt=v),en(s,i,i.pendingProps.children,u),Tc(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&Xe&&((v=f=bt)&&(f=kM(f,i.type,i.pendingProps,qn),f!==null?(i.stateNode=f,Zt=i,bt=Bn(f.firstChild),qn=!1,v=!0):v=!1),v||la(i)),me(i),v=i.type,x=i.pendingProps,R=s!==null?s.memoizedProps:null,f=x.children,bf(v,x)?f=null:R!==null&&bf(v,R)&&(i.flags|=32),i.memoizedState!==null&&(v=yd(s,i,UC,null,null,u),hr._currentValue=v),Tc(s,i),en(s,i,f,u),i.child;case 6:return s===null&&Xe&&((s=u=bt)&&(u=AM(u,i.pendingProps,qn),u!==null?(i.stateNode=u,Zt=i,bt=null,s=!0):s=!1),s||la(i)),null;case 13:return Bm(s,i,u);case 4:return V(i,i.stateNode.containerInfo),f=i.pendingProps,s===null?i.child=si(i,null,f,u):en(s,i,f,u),i.child;case 11:return _m(s,i,i.type,i.pendingProps,u);case 7:return en(s,i,i.pendingProps,u),i.child;case 8:return en(s,i,i.pendingProps.children,u),i.child;case 12:return en(s,i,i.pendingProps.children,u),i.child;case 10:return f=i.pendingProps,ua(i,i.type,f.value),en(s,i,f.children,u),i.child;case 9:return v=i.type._context,f=i.pendingProps.children,Ja(i),v=Jt(v),f=f(v),i.flags|=1,en(s,i,f,u),i.child;case 14:return jm(s,i,i.type,i.pendingProps,u);case 15:return Lm(s,i,i.type,i.pendingProps,u);case 19:return Um(s,i,u);case 31:return XC(s,i,u);case 22:return zm(s,i,u,i.pendingProps);case 24:return Ja(i),f=Jt(zt),s===null?(v=rd(),v===null&&(v=ft,x=id(),v.pooledCache=x,x.refCount++,x!==null&&(v.pooledCacheLanes|=u),v=x),i.memoizedState={parent:f,cache:v},ld(i),ua(i,zt,v)):((s.lanes&u)!==0&&(ud(s,i),Vo(i,null,null,u),Go()),v=s.memoizedState,x=i.memoizedState,v.parent!==f?(v={parent:f,cache:f},i.memoizedState=v,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=v),ua(i,zt,f)):(f=x.cache,ua(i,zt,f),f!==v.cache&&ad(i,[zt],u,!0))),en(s,i,i.pendingProps.children,u),i.child;case 29:throw i.pendingProps}throw Error(n(156,i.tag))}function Hs(s){s.flags|=4}function Fd(s,i,u,f,v){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(v&335544128)===v)if(s.stateNode.complete)s.flags|=8192;else if(yy())s.flags|=8192;else throw ni=fc,cd}else s.flags&=-16777217}function Fm(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!o0(i))if(yy())s.flags|=8192;else throw ni=fc,cd}function Ac(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?ee():536870912,s.lanes|=i,Yi|=i)}function Jo(s,i){if(!Xe)switch(s.tailMode){case"hidden":i=s.tail;for(var u=null;i!==null;)i.alternate!==null&&(u=i),i=i.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function xt(s){var i=s.alternate!==null&&s.alternate.child===s.child,u=0,f=0;if(i)for(var v=s.child;v!==null;)u|=v.lanes|v.childLanes,f|=v.subtreeFlags&65011712,f|=v.flags&65011712,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)u|=v.lanes|v.childLanes,f|=v.subtreeFlags,f|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=f,s.childLanes=u,i}function JC(s,i,u){var f=i.pendingProps;switch(Ju(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xt(i),null;case 1:return xt(i),null;case 3:return u=i.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),i.memoizedState.cache!==f&&(i.flags|=2048),Ps(zt),pe(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(Pi(i)?Hs(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,td())),xt(i),null;case 26:var v=i.type,x=i.memoizedState;return s===null?(Hs(i),x!==null?(xt(i),Fm(i,x)):(xt(i),Fd(i,v,null,f,u))):x?x!==s.memoizedState?(Hs(i),xt(i),Fm(i,x)):(xt(i),i.flags&=-16777217):(s=s.memoizedProps,s!==f&&Hs(i),xt(i),Fd(i,v,s,f,u)),null;case 27:if(ye(i),u=ie.current,v=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==f&&Hs(i);else{if(!f){if(i.stateNode===null)throw Error(n(166));return xt(i),null}s=ae.current,Pi(i)?Mg(i):(s=Zy(v,f,u),i.stateNode=s,Hs(i))}return xt(i),null;case 5:if(ye(i),v=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==f&&Hs(i);else{if(!f){if(i.stateNode===null)throw Error(n(166));return xt(i),null}if(x=ae.current,Pi(i))Mg(i);else{var R=Qc(ie.current);switch(x){case 1:x=R.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:x=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":x=R.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":x=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":x=R.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof f.is=="string"?R.createElement("select",{is:f.is}):R.createElement("select"),f.multiple?x.multiple=!0:f.size&&(x.size=f.size);break;default:x=typeof f.is=="string"?R.createElement(v,{is:f.is}):R.createElement(v)}}x[mt]=i,x[Ht]=f;e:for(R=i.child;R!==null;){if(R.tag===5||R.tag===6)x.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===i)break e;for(;R.sibling===null;){if(R.return===null||R.return===i)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}i.stateNode=x;e:switch(tn(x,v,f),v){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Hs(i)}}return xt(i),Fd(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,u),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==f&&Hs(i);else{if(typeof f!="string"&&i.stateNode===null)throw Error(n(166));if(s=ie.current,Pi(i)){if(s=i.stateNode,u=i.memoizedProps,f=null,v=Zt,v!==null)switch(v.tag){case 27:case 5:f=v.memoizedProps}s[mt]=i,s=!!(s.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||By(s.nodeValue,u)),s||la(i,!0)}else s=Qc(s).createTextNode(f),s[mt]=i,i.stateNode=s}return xt(i),null;case 31:if(u=i.memoizedState,s===null||s.memoizedState!==null){if(f=Pi(i),u!==null){if(s===null){if(!f)throw Error(n(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(557));s[mt]=i}else Xa(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;xt(i),s=!1}else u=td(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=u),s=!0;if(!s)return i.flags&256?(Cn(i),i):(Cn(i),null);if((i.flags&128)!==0)throw Error(n(558))}return xt(i),null;case 13:if(f=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(v=Pi(i),f!==null&&f.dehydrated!==null){if(s===null){if(!v)throw Error(n(318));if(v=i.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(n(317));v[mt]=i}else Xa(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;xt(i),v=!1}else v=td(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=v),v=!0;if(!v)return i.flags&256?(Cn(i),i):(Cn(i),null)}return Cn(i),(i.flags&128)!==0?(i.lanes=u,i):(u=f!==null,s=s!==null&&s.memoizedState!==null,u&&(f=i.child,v=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(v=f.alternate.memoizedState.cachePool.pool),x=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(x=f.memoizedState.cachePool.pool),x!==v&&(f.flags|=2048)),u!==s&&u&&(i.child.flags|=8192),Ac(i,i.updateQueue),xt(i),null);case 4:return pe(),s===null&&pf(i.stateNode.containerInfo),xt(i),null;case 10:return Ps(i.type),xt(i),null;case 19:if(Q(Tt),f=i.memoizedState,f===null)return xt(i),null;if(v=(i.flags&128)!==0,x=f.rendering,x===null)if(v)Jo(f,!1);else{if(Mt!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(x=mc(s),x!==null){for(i.flags|=128,Jo(f,!1),s=x.updateQueue,i.updateQueue=s,Ac(i,s),i.subtreeFlags=0,s=u,u=i.child;u!==null;)bg(u,s),u=u.sibling;return Y(Tt,Tt.current&1|2),Xe&&Ls(i,f.treeForkCount),i.child}s=s.sibling}f.tail!==null&&Je()>Lc&&(i.flags|=128,v=!0,Jo(f,!1),i.lanes=4194304)}else{if(!v)if(s=mc(x),s!==null){if(i.flags|=128,v=!0,s=s.updateQueue,i.updateQueue=s,Ac(i,s),Jo(f,!0),f.tail===null&&f.tailMode==="hidden"&&!x.alternate&&!Xe)return xt(i),null}else 2*Je()-f.renderingStartTime>Lc&&u!==536870912&&(i.flags|=128,v=!0,Jo(f,!1),i.lanes=4194304);f.isBackwards?(x.sibling=i.child,i.child=x):(s=f.last,s!==null?s.sibling=x:i.child=x,f.last=x)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Je(),s.sibling=null,u=Tt.current,Y(Tt,v?u&1|2:u&1),Xe&&Ls(i,f.treeForkCount),s):(xt(i),null);case 22:case 23:return Cn(i),pd(),f=i.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(i.flags|=8192):f&&(i.flags|=8192),f?(u&536870912)!==0&&(i.flags&128)===0&&(xt(i),i.subtreeFlags&6&&(i.flags|=8192)):xt(i),u=i.updateQueue,u!==null&&Ac(i,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),f=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(f=i.memoizedState.cachePool.pool),f!==u&&(i.flags|=2048),s!==null&&Q(ei),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),i.memoizedState.cache!==u&&(i.flags|=2048),Ps(zt),xt(i),null;case 25:return null;case 30:return null}throw Error(n(156,i.tag))}function eM(s,i){switch(Ju(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Ps(zt),pe(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return ye(i),null;case 31:if(i.memoizedState!==null){if(Cn(i),i.alternate===null)throw Error(n(340));Xa()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(Cn(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(n(340));Xa()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return Q(Tt),null;case 4:return pe(),null;case 10:return Ps(i.type),null;case 22:case 23:return Cn(i),pd(),s!==null&&Q(ei),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Ps(zt),null;case 25:return null;default:return null}}function Gm(s,i){switch(Ju(i),i.tag){case 3:Ps(zt),pe();break;case 26:case 27:case 5:ye(i);break;case 4:pe();break;case 31:i.memoizedState!==null&&Cn(i);break;case 13:Cn(i);break;case 19:Q(Tt);break;case 10:Ps(i.type);break;case 22:case 23:Cn(i),pd(),s!==null&&Q(ei);break;case 24:Ps(zt)}}function er(s,i){try{var u=i.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var v=f.next;u=v;do{if((u.tag&s)===s){f=void 0;var x=u.create,R=u.inst;f=x(),R.destroy=f}u=u.next}while(u!==v)}}catch(D){rt(i,i.return,D)}}function ma(s,i,u){try{var f=i.updateQueue,v=f!==null?f.lastEffect:null;if(v!==null){var x=v.next;f=x;do{if((f.tag&s)===s){var R=f.inst,D=R.destroy;if(D!==void 0){R.destroy=void 0,v=i;var z=u,G=D;try{G()}catch(ne){rt(v,z,ne)}}}f=f.next}while(f!==x)}}catch(ne){rt(i,i.return,ne)}}function Vm(s){var i=s.updateQueue;if(i!==null){var u=s.stateNode;try{Og(i,u)}catch(f){rt(s,s.return,f)}}}function Km(s,i,u){u.props=ii(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(f){rt(s,i,f)}}function tr(s,i){try{var u=s.ref;if(u!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof u=="function"?s.refCleanup=u(f):u.current=f}}catch(v){rt(s,i,v)}}function us(s,i){var u=s.ref,f=s.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(v){rt(s,i,v)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(v){rt(s,i,v)}else u.current=null}function Ym(s){var i=s.type,u=s.memoizedProps,f=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break e;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(v){rt(s,s.return,v)}}function Gd(s,i,u){try{var f=s.stateNode;SM(f,s.type,u,i),f[Ht]=i}catch(v){rt(s,s.return,v)}}function Wm(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Ca(s.type)||s.tag===4}function Vd(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Wm(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Ca(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Kd(s,i,u){var f=s.tag;if(f===5||f===6)s=s.stateNode,i?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(s,i):(i=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,i.appendChild(s),u=u._reactRootContainer,u!=null||i.onclick!==null||(i.onclick=Ns));else if(f!==4&&(f===27&&Ca(s.type)&&(u=s.stateNode,i=null),s=s.child,s!==null))for(Kd(s,i,u),s=s.sibling;s!==null;)Kd(s,i,u),s=s.sibling}function Dc(s,i,u){var f=s.tag;if(f===5||f===6)s=s.stateNode,i?u.insertBefore(s,i):u.appendChild(s);else if(f!==4&&(f===27&&Ca(s.type)&&(u=s.stateNode),s=s.child,s!==null))for(Dc(s,i,u),s=s.sibling;s!==null;)Dc(s,i,u),s=s.sibling}function Xm(s){var i=s.stateNode,u=s.memoizedProps;try{for(var f=s.type,v=i.attributes;v.length;)i.removeAttributeNode(v[0]);tn(i,f,u),i[mt]=s,i[Ht]=u}catch(x){rt(s,s.return,x)}}var Bs=!1,It=!1,Yd=!1,Zm=typeof WeakSet=="function"?WeakSet:Set,Kt=null;function tM(s,i){if(s=s.containerInfo,yf=Xc,s=ug(s),$u(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{u=(u=s.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var v=f.anchorOffset,x=f.focusNode;f=f.focusOffset;try{u.nodeType,x.nodeType}catch{u=null;break e}var R=0,D=-1,z=-1,G=0,ne=0,re=s,K=null;t:for(;;){for(var X;re!==u||v!==0&&re.nodeType!==3||(D=R+v),re!==x||f!==0&&re.nodeType!==3||(z=R+f),re.nodeType===3&&(R+=re.nodeValue.length),(X=re.firstChild)!==null;)K=re,re=X;for(;;){if(re===s)break t;if(K===u&&++G===v&&(D=R),K===x&&++ne===f&&(z=R),(X=re.nextSibling)!==null)break;re=K,K=re.parentNode}re=X}u=D===-1||z===-1?null:{start:D,end:z}}else u=null}u=u||{start:0,end:0}}else u=null;for(vf={focusedElem:s,selectionRange:u},Xc=!1,Kt=i;Kt!==null;)if(i=Kt,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,Kt=s;else for(;Kt!==null;){switch(i=Kt,x=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(u=0;u<s.length;u++)v=s[u],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&x!==null){s=void 0,u=i,v=x.memoizedProps,x=x.memoizedState,f=u.stateNode;try{var xe=ii(u.type,v);s=f.getSnapshotBeforeUpdate(xe,x),f.__reactInternalSnapshotBeforeUpdate=s}catch(De){rt(u,u.return,De)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,u=s.nodeType,u===9)wf(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":wf(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(n(163))}if(s=i.sibling,s!==null){s.return=i.return,Kt=s;break}Kt=i.return}}function Jm(s,i,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:Us(s,u),f&4&&er(5,u);break;case 1:if(Us(s,u),f&4)if(s=u.stateNode,i===null)try{s.componentDidMount()}catch(R){rt(u,u.return,R)}else{var v=ii(u.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(v,i,s.__reactInternalSnapshotBeforeUpdate)}catch(R){rt(u,u.return,R)}}f&64&&Vm(u),f&512&&tr(u,u.return);break;case 3:if(Us(s,u),f&64&&(s=u.updateQueue,s!==null)){if(i=null,u.child!==null)switch(u.child.tag){case 27:case 5:i=u.child.stateNode;break;case 1:i=u.child.stateNode}try{Og(s,i)}catch(R){rt(u,u.return,R)}}break;case 27:i===null&&f&4&&Xm(u);case 26:case 5:Us(s,u),i===null&&f&4&&Ym(u),f&512&&tr(u,u.return);break;case 12:Us(s,u);break;case 31:Us(s,u),f&4&&ny(s,u);break;case 13:Us(s,u),f&4&&sy(s,u),f&64&&(s=u.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(u=uM.bind(null,u),DM(s,u))));break;case 22:if(f=u.memoizedState!==null||Bs,!f){i=i!==null&&i.memoizedState!==null||It,v=Bs;var x=It;Bs=f,(It=i)&&!x?Qs(s,u,(u.subtreeFlags&8772)!==0):Us(s,u),Bs=v,It=x}break;case 30:break;default:Us(s,u)}}function ey(s){var i=s.alternate;i!==null&&(s.alternate=null,ey(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&Eu(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var St=null,hn=!1;function $s(s,i,u){for(u=u.child;u!==null;)ty(s,i,u),u=u.sibling}function ty(s,i,u){if(Wt&&typeof Wt.onCommitFiberUnmount=="function")try{Wt.onCommitFiberUnmount(os,u)}catch{}switch(u.tag){case 26:It||us(u,i),$s(s,i,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:It||us(u,i);var f=St,v=hn;Ca(u.type)&&(St=u.stateNode,hn=!1),$s(s,i,u),ur(u.stateNode),St=f,hn=v;break;case 5:It||us(u,i);case 6:if(f=St,v=hn,St=null,$s(s,i,u),St=f,hn=v,St!==null)if(hn)try{(St.nodeType===9?St.body:St.nodeName==="HTML"?St.ownerDocument.body:St).removeChild(u.stateNode)}catch(x){rt(u,i,x)}else try{St.removeChild(u.stateNode)}catch(x){rt(u,i,x)}break;case 18:St!==null&&(hn?(s=St,Vy(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,u.stateNode),so(s)):Vy(St,u.stateNode));break;case 4:f=St,v=hn,St=u.stateNode.containerInfo,hn=!0,$s(s,i,u),St=f,hn=v;break;case 0:case 11:case 14:case 15:ma(2,u,i),It||ma(4,u,i),$s(s,i,u);break;case 1:It||(us(u,i),f=u.stateNode,typeof f.componentWillUnmount=="function"&&Km(u,i,f)),$s(s,i,u);break;case 21:$s(s,i,u);break;case 22:It=(f=It)||u.memoizedState!==null,$s(s,i,u),It=f;break;default:$s(s,i,u)}}function ny(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{so(s)}catch(u){rt(i,i.return,u)}}}function sy(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{so(s)}catch(u){rt(i,i.return,u)}}function nM(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Zm),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Zm),i;default:throw Error(n(435,s.tag))}}function Nc(s,i){var u=nM(s);i.forEach(function(f){if(!u.has(f)){u.add(f);var v=dM.bind(null,s,f);f.then(v,v)}})}function pn(s,i){var u=i.deletions;if(u!==null)for(var f=0;f<u.length;f++){var v=u[f],x=s,R=i,D=R;e:for(;D!==null;){switch(D.tag){case 27:if(Ca(D.type)){St=D.stateNode,hn=!1;break e}break;case 5:St=D.stateNode,hn=!1;break e;case 3:case 4:St=D.stateNode.containerInfo,hn=!0;break e}D=D.return}if(St===null)throw Error(n(160));ty(x,R,v),St=null,hn=!1,x=v.alternate,x!==null&&(x.return=null),v.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)ay(i,s),i=i.sibling}var Zn=null;function ay(s,i){var u=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:pn(i,s),gn(s),f&4&&(ma(3,s,s.return),er(3,s),ma(5,s,s.return));break;case 1:pn(i,s),gn(s),f&512&&(It||u===null||us(u,u.return)),f&64&&Bs&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var v=Zn;if(pn(i,s),gn(s),f&512&&(It||u===null||us(u,u.return)),f&4){var x=u!==null?u.memoizedState:null;if(f=s.memoizedState,u===null)if(f===null)if(s.stateNode===null){e:{f=s.type,u=s.memoizedProps,v=v.ownerDocument||v;t:switch(f){case"title":x=v.getElementsByTagName("title")[0],(!x||x[ko]||x[mt]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=v.createElement(f),v.head.insertBefore(x,v.querySelector("head > title"))),tn(x,f,u),x[mt]=s,Vt(x),f=x;break e;case"link":var R=a0("link","href",v).get(f+(u.href||""));if(R){for(var D=0;D<R.length;D++)if(x=R[D],x.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&x.getAttribute("rel")===(u.rel==null?null:u.rel)&&x.getAttribute("title")===(u.title==null?null:u.title)&&x.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){R.splice(D,1);break t}}x=v.createElement(f),tn(x,f,u),v.head.appendChild(x);break;case"meta":if(R=a0("meta","content",v).get(f+(u.content||""))){for(D=0;D<R.length;D++)if(x=R[D],x.getAttribute("content")===(u.content==null?null:""+u.content)&&x.getAttribute("name")===(u.name==null?null:u.name)&&x.getAttribute("property")===(u.property==null?null:u.property)&&x.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&x.getAttribute("charset")===(u.charSet==null?null:u.charSet)){R.splice(D,1);break t}}x=v.createElement(f),tn(x,f,u),v.head.appendChild(x);break;default:throw Error(n(468,f))}x[mt]=s,Vt(x),f=x}s.stateNode=f}else i0(v,s.type,s.stateNode);else s.stateNode=s0(v,f,s.memoizedProps);else x!==f?(x===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):x.count--,f===null?i0(v,s.type,s.stateNode):s0(v,f,s.memoizedProps)):f===null&&s.stateNode!==null&&Gd(s,s.memoizedProps,u.memoizedProps)}break;case 27:pn(i,s),gn(s),f&512&&(It||u===null||us(u,u.return)),u!==null&&f&4&&Gd(s,s.memoizedProps,u.memoizedProps);break;case 5:if(pn(i,s),gn(s),f&512&&(It||u===null||us(u,u.return)),s.flags&32){v=s.stateNode;try{Ri(v,"")}catch(xe){rt(s,s.return,xe)}}f&4&&s.stateNode!=null&&(v=s.memoizedProps,Gd(s,v,u!==null?u.memoizedProps:v)),f&1024&&(Yd=!0);break;case 6:if(pn(i,s),gn(s),f&4){if(s.stateNode===null)throw Error(n(162));f=s.memoizedProps,u=s.stateNode;try{u.nodeValue=f}catch(xe){rt(s,s.return,xe)}}break;case 3:if(Vc=null,v=Zn,Zn=Fc(i.containerInfo),pn(i,s),Zn=v,gn(s),f&4&&u!==null&&u.memoizedState.isDehydrated)try{so(i.containerInfo)}catch(xe){rt(s,s.return,xe)}Yd&&(Yd=!1,iy(s));break;case 4:f=Zn,Zn=Fc(s.stateNode.containerInfo),pn(i,s),gn(s),Zn=f;break;case 12:pn(i,s),gn(s);break;case 31:pn(i,s),gn(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Nc(s,f)));break;case 13:pn(i,s),gn(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(jc=Je()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Nc(s,f)));break;case 22:v=s.memoizedState!==null;var z=u!==null&&u.memoizedState!==null,G=Bs,ne=It;if(Bs=G||v,It=ne||z,pn(i,s),It=ne,Bs=G,gn(s),f&8192)e:for(i=s.stateNode,i._visibility=v?i._visibility&-2:i._visibility|1,v&&(u===null||z||Bs||It||oi(s)),u=null,i=s;;){if(i.tag===5||i.tag===26){if(u===null){z=u=i;try{if(x=z.stateNode,v)R=x.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{D=z.stateNode;var re=z.memoizedProps.style,K=re!=null&&re.hasOwnProperty("display")?re.display:null;D.style.display=K==null||typeof K=="boolean"?"":(""+K).trim()}}catch(xe){rt(z,z.return,xe)}}}else if(i.tag===6){if(u===null){z=i;try{z.stateNode.nodeValue=v?"":z.memoizedProps}catch(xe){rt(z,z.return,xe)}}}else if(i.tag===18){if(u===null){z=i;try{var X=z.stateNode;v?Ky(X,!0):Ky(z.stateNode,!1)}catch(xe){rt(z,z.return,xe)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;u===i&&(u=null),i=i.return}u===i&&(u=null),i.sibling.return=i.return,i=i.sibling}f&4&&(f=s.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,Nc(s,u))));break;case 19:pn(i,s),gn(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Nc(s,f)));break;case 30:break;case 21:break;default:pn(i,s),gn(s)}}function gn(s){var i=s.flags;if(i&2){try{for(var u,f=s.return;f!==null;){if(Wm(f)){u=f;break}f=f.return}if(u==null)throw Error(n(160));switch(u.tag){case 27:var v=u.stateNode,x=Vd(s);Dc(s,x,v);break;case 5:var R=u.stateNode;u.flags&32&&(Ri(R,""),u.flags&=-33);var D=Vd(s);Dc(s,D,R);break;case 3:case 4:var z=u.stateNode.containerInfo,G=Vd(s);Kd(s,G,z);break;default:throw Error(n(161))}}catch(ne){rt(s,s.return,ne)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function iy(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;iy(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function Us(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Jm(s,i.alternate,i),i=i.sibling}function oi(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:ma(4,i,i.return),oi(i);break;case 1:us(i,i.return);var u=i.stateNode;typeof u.componentWillUnmount=="function"&&Km(i,i.return,u),oi(i);break;case 27:ur(i.stateNode);case 26:case 5:us(i,i.return),oi(i);break;case 22:i.memoizedState===null&&oi(i);break;case 30:oi(i);break;default:oi(i)}s=s.sibling}}function Qs(s,i,u){for(u=u&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var f=i.alternate,v=s,x=i,R=x.flags;switch(x.tag){case 0:case 11:case 15:Qs(v,x,u),er(4,x);break;case 1:if(Qs(v,x,u),f=x,v=f.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(G){rt(f,f.return,G)}if(f=x,v=f.updateQueue,v!==null){var D=f.stateNode;try{var z=v.shared.hiddenCallbacks;if(z!==null)for(v.shared.hiddenCallbacks=null,v=0;v<z.length;v++)Pg(z[v],D)}catch(G){rt(f,f.return,G)}}u&&R&64&&Vm(x),tr(x,x.return);break;case 27:Xm(x);case 26:case 5:Qs(v,x,u),u&&f===null&&R&4&&Ym(x),tr(x,x.return);break;case 12:Qs(v,x,u);break;case 31:Qs(v,x,u),u&&R&4&&ny(v,x);break;case 13:Qs(v,x,u),u&&R&4&&sy(v,x);break;case 22:x.memoizedState===null&&Qs(v,x,u),tr(x,x.return);break;case 30:break;default:Qs(v,x,u)}i=i.sibling}}function Wd(s,i){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&Bo(u))}function Xd(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Bo(s))}function Jn(s,i,u,f){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)oy(s,i,u,f),i=i.sibling}function oy(s,i,u,f){var v=i.flags;switch(i.tag){case 0:case 11:case 15:Jn(s,i,u,f),v&2048&&er(9,i);break;case 1:Jn(s,i,u,f);break;case 3:Jn(s,i,u,f),v&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Bo(s)));break;case 12:if(v&2048){Jn(s,i,u,f),s=i.stateNode;try{var x=i.memoizedProps,R=x.id,D=x.onPostCommit;typeof D=="function"&&D(R,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(z){rt(i,i.return,z)}}else Jn(s,i,u,f);break;case 31:Jn(s,i,u,f);break;case 13:Jn(s,i,u,f);break;case 23:break;case 22:x=i.stateNode,R=i.alternate,i.memoizedState!==null?x._visibility&2?Jn(s,i,u,f):nr(s,i):x._visibility&2?Jn(s,i,u,f):(x._visibility|=2,Gi(s,i,u,f,(i.subtreeFlags&10256)!==0||!1)),v&2048&&Wd(R,i);break;case 24:Jn(s,i,u,f),v&2048&&Xd(i.alternate,i);break;default:Jn(s,i,u,f)}}function Gi(s,i,u,f,v){for(v=v&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var x=s,R=i,D=u,z=f,G=R.flags;switch(R.tag){case 0:case 11:case 15:Gi(x,R,D,z,v),er(8,R);break;case 23:break;case 22:var ne=R.stateNode;R.memoizedState!==null?ne._visibility&2?Gi(x,R,D,z,v):nr(x,R):(ne._visibility|=2,Gi(x,R,D,z,v)),v&&G&2048&&Wd(R.alternate,R);break;case 24:Gi(x,R,D,z,v),v&&G&2048&&Xd(R.alternate,R);break;default:Gi(x,R,D,z,v)}i=i.sibling}}function nr(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var u=s,f=i,v=f.flags;switch(f.tag){case 22:nr(u,f),v&2048&&Wd(f.alternate,f);break;case 24:nr(u,f),v&2048&&Xd(f.alternate,f);break;default:nr(u,f)}i=i.sibling}}var sr=8192;function Vi(s,i,u){if(s.subtreeFlags&sr)for(s=s.child;s!==null;)ry(s,i,u),s=s.sibling}function ry(s,i,u){switch(s.tag){case 26:Vi(s,i,u),s.flags&sr&&s.memoizedState!==null&&$M(u,Zn,s.memoizedState,s.memoizedProps);break;case 5:Vi(s,i,u);break;case 3:case 4:var f=Zn;Zn=Fc(s.stateNode.containerInfo),Vi(s,i,u),Zn=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=sr,sr=16777216,Vi(s,i,u),sr=f):Vi(s,i,u));break;default:Vi(s,i,u)}}function cy(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function ar(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var u=0;u<i.length;u++){var f=i[u];Kt=f,uy(f,s)}cy(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)ly(s),s=s.sibling}function ly(s){switch(s.tag){case 0:case 11:case 15:ar(s),s.flags&2048&&ma(9,s,s.return);break;case 3:ar(s);break;case 12:ar(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,_c(s)):ar(s);break;default:ar(s)}}function _c(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var u=0;u<i.length;u++){var f=i[u];Kt=f,uy(f,s)}cy(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:ma(8,i,i.return),_c(i);break;case 22:u=i.stateNode,u._visibility&2&&(u._visibility&=-3,_c(i));break;default:_c(i)}s=s.sibling}}function uy(s,i){for(;Kt!==null;){var u=Kt;switch(u.tag){case 0:case 11:case 15:ma(8,u,i);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Bo(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,Kt=f;else e:for(u=s;Kt!==null;){f=Kt;var v=f.sibling,x=f.return;if(ey(f),f===u){Kt=null;break e}if(v!==null){v.return=x,Kt=v;break e}Kt=x}}}var sM={getCacheForType:function(s){var i=Jt(zt),u=i.data.get(s);return u===void 0&&(u=s(),i.data.set(s,u)),u},cacheSignal:function(){return Jt(zt).controller.signal}},aM=typeof WeakMap=="function"?WeakMap:Map,nt=0,ft=null,Fe=null,Ve=0,ot=0,Mn=null,ya=!1,Ki=!1,Zd=!1,Fs=0,Mt=0,va=0,ri=0,Jd=0,En=0,Yi=0,ir=null,mn=null,ef=!1,jc=0,dy=0,Lc=1/0,zc=null,ba=null,Bt=0,xa=null,Wi=null,Gs=0,tf=0,nf=null,fy=null,or=0,sf=null;function Rn(){return(nt&2)!==0&&Ve!==0?Ve&-Ve:L.T!==null?uf():cn()}function hy(){if(En===0)if((Ve&536870912)===0||Xe){var s=Ua;Ua<<=1,(Ua&3932160)===0&&(Ua=262144),En=s}else En=536870912;return s=Sn.current,s!==null&&(s.flags|=32),En}function yn(s,i,u){(s===ft&&(ot===2||ot===9)||s.cancelPendingCommit!==null)&&(Xi(s,0),wa(s,Ve,En,!1)),be(s,u),((nt&2)===0||s!==ft)&&(s===ft&&((nt&2)===0&&(ri|=u),Mt===4&&wa(s,Ve,En,!1)),ds(s))}function py(s,i,u){if((nt&6)!==0)throw Error(n(327));var f=!u&&(i&127)===0&&(i&s.expiredLanes)===0||As(s,i),v=f?rM(s,i):of(s,i,!0),x=f;do{if(v===0){Ki&&!f&&wa(s,i,0,!1);break}else{if(u=s.current.alternate,x&&!iM(u)){v=of(s,i,!1),x=!1;continue}if(v===2){if(x=i,s.errorRecoveryDisabledLanes&x)var R=0;else R=s.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){i=R;e:{var D=s;v=ir;var z=D.current.memoizedState.isDehydrated;if(z&&(Xi(D,R).flags|=256),R=of(D,R,!1),R!==2){if(Zd&&!z){D.errorRecoveryDisabledLanes|=x,ri|=x,v=4;break e}x=mn,mn=v,x!==null&&(mn===null?mn=x:mn.push.apply(mn,x))}v=R}if(x=!1,v!==2)continue}}if(v===1){Xi(s,0),wa(s,i,0,!0);break}e:{switch(f=s,x=v,x){case 0:case 1:throw Error(n(345));case 4:if((i&4194048)!==i)break;case 6:wa(f,i,En,!ya);break e;case 2:mn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((i&62914560)===i&&(v=jc+300-Je(),10<v)){if(wa(f,i,En,!ya),ks(f,0,!0)!==0)break e;Gs=i,f.timeoutHandle=Fy(gy.bind(null,f,u,mn,zc,ef,i,En,ri,Yi,ya,x,"Throttled",-0,0),v);break e}gy(f,u,mn,zc,ef,i,En,ri,Yi,ya,x,null,-0,0)}}break}while(!0);ds(s)}function gy(s,i,u,f,v,x,R,D,z,G,ne,re,K,X){if(s.timeoutHandle=-1,re=i.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ns},ry(i,x,re);var xe=(x&62914560)===x?jc-Je():(x&4194048)===x?dy-Je():0;if(xe=UM(re,xe),xe!==null){Gs=x,s.cancelPendingCommit=xe(Cy.bind(null,s,i,x,u,f,v,R,D,z,ne,re,null,K,X)),wa(s,x,R,!G);return}}Cy(s,i,x,u,f,v,R,D,z)}function iM(s){for(var i=s;;){var u=i.tag;if((u===0||u===11||u===15)&&i.flags&16384&&(u=i.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var v=u[f],x=v.getSnapshot;v=v.value;try{if(!xn(x(),v))return!1}catch{return!1}}if(u=i.child,i.subtreeFlags&16384&&u!==null)u.return=i,i=u;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function wa(s,i,u,f){i&=~Jd,i&=~ri,s.suspendedLanes|=i,s.pingedLanes&=~i,f&&(s.warmLanes|=i),f=s.expirationTimes;for(var v=i;0<v;){var x=31-jt(v),R=1<<x;f[x]=-1,v&=~R}u!==0&&Oe(s,u,i)}function Pc(){return(nt&6)===0?(rr(0),!1):!0}function af(){if(Fe!==null){if(ot===0)var s=Fe.return;else s=Fe,zs=Za=null,xd(s),Bi=null,Uo=0,s=Fe;for(;s!==null;)Gm(s.alternate,s),s=s.return;Fe=null}}function Xi(s,i){var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,EM(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),Gs=0,af(),ft=s,Fe=u=js(s.current,null),Ve=i,ot=0,Mn=null,ya=!1,Ki=As(s,i),Zd=!1,Yi=En=Jd=ri=va=Mt=0,mn=ir=null,ef=!1,(i&8)!==0&&(i|=i&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=i;0<f;){var v=31-jt(f),x=1<<v;i|=s[v],f&=~x}return Fs=i,sc(),u}function my(s,i){Ie=null,L.H=Xo,i===Hi||i===dc?(i=_g(),ot=3):i===cd?(i=_g(),ot=4):ot=i===Pd?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Mn=i,Fe===null&&(Mt=1,Ec(s,Pn(i,s.current)))}function yy(){var s=Sn.current;return s===null?!0:(Ve&4194048)===Ve?Hn===null:(Ve&62914560)===Ve||(Ve&536870912)!==0?s===Hn:!1}function vy(){var s=L.H;return L.H=Xo,s===null?Xo:s}function by(){var s=L.A;return L.A=sM,s}function Oc(){Mt=4,ya||(Ve&4194048)!==Ve&&Sn.current!==null||(Ki=!0),(va&134217727)===0&&(ri&134217727)===0||ft===null||wa(ft,Ve,En,!1)}function of(s,i,u){var f=nt;nt|=2;var v=vy(),x=by();(ft!==s||Ve!==i)&&(zc=null,Xi(s,i)),i=!1;var R=Mt;e:do try{if(ot!==0&&Fe!==null){var D=Fe,z=Mn;switch(ot){case 8:af(),R=6;break e;case 3:case 2:case 9:case 6:Sn.current===null&&(i=!0);var G=ot;if(ot=0,Mn=null,Zi(s,D,z,G),u&&Ki){R=0;break e}break;default:G=ot,ot=0,Mn=null,Zi(s,D,z,G)}}oM(),R=Mt;break}catch(ne){my(s,ne)}while(!0);return i&&s.shellSuspendCounter++,zs=Za=null,nt=f,L.H=v,L.A=x,Fe===null&&(ft=null,Ve=0,sc()),R}function oM(){for(;Fe!==null;)xy(Fe)}function rM(s,i){var u=nt;nt|=2;var f=vy(),v=by();ft!==s||Ve!==i?(zc=null,Lc=Je()+500,Xi(s,i)):Ki=As(s,i);e:do try{if(ot!==0&&Fe!==null){i=Fe;var x=Mn;t:switch(ot){case 1:ot=0,Mn=null,Zi(s,i,x,1);break;case 2:case 9:if(Dg(x)){ot=0,Mn=null,wy(i);break}i=function(){ot!==2&&ot!==9||ft!==s||(ot=7),ds(s)},x.then(i,i);break e;case 3:ot=7;break e;case 4:ot=5;break e;case 7:Dg(x)?(ot=0,Mn=null,wy(i)):(ot=0,Mn=null,Zi(s,i,x,7));break;case 5:var R=null;switch(Fe.tag){case 26:R=Fe.memoizedState;case 5:case 27:var D=Fe;if(R?o0(R):D.stateNode.complete){ot=0,Mn=null;var z=D.sibling;if(z!==null)Fe=z;else{var G=D.return;G!==null?(Fe=G,Ic(G)):Fe=null}break t}}ot=0,Mn=null,Zi(s,i,x,5);break;case 6:ot=0,Mn=null,Zi(s,i,x,6);break;case 8:af(),Mt=6;break e;default:throw Error(n(462))}}cM();break}catch(ne){my(s,ne)}while(!0);return zs=Za=null,L.H=f,L.A=v,nt=u,Fe!==null?0:(ft=null,Ve=0,sc(),Mt)}function cM(){for(;Fe!==null&&!pt();)xy(Fe)}function xy(s){var i=Qm(s.alternate,s,Fs);s.memoizedProps=s.pendingProps,i===null?Ic(s):Fe=i}function wy(s){var i=s,u=i.alternate;switch(i.tag){case 15:case 0:i=Im(u,i,i.pendingProps,i.type,void 0,Ve);break;case 11:i=Im(u,i,i.pendingProps,i.type.render,i.ref,Ve);break;case 5:xd(i);default:Gm(u,i),i=Fe=bg(i,Fs),i=Qm(u,i,Fs)}s.memoizedProps=s.pendingProps,i===null?Ic(s):Fe=i}function Zi(s,i,u,f){zs=Za=null,xd(i),Bi=null,Uo=0;var v=i.return;try{if(WC(s,v,i,u,Ve)){Mt=1,Ec(s,Pn(u,s.current)),Fe=null;return}}catch(x){if(v!==null)throw Fe=v,x;Mt=1,Ec(s,Pn(u,s.current)),Fe=null;return}i.flags&32768?(Xe||f===1?s=!0:Ki||(Ve&536870912)!==0?s=!1:(ya=s=!0,(f===2||f===9||f===3||f===6)&&(f=Sn.current,f!==null&&f.tag===13&&(f.flags|=16384))),Sy(i,s)):Ic(i)}function Ic(s){var i=s;do{if((i.flags&32768)!==0){Sy(i,ya);return}s=i.return;var u=JC(i.alternate,i,Fs);if(u!==null){Fe=u;return}if(i=i.sibling,i!==null){Fe=i;return}Fe=i=s}while(i!==null);Mt===0&&(Mt=5)}function Sy(s,i){do{var u=eM(s.alternate,s);if(u!==null){u.flags&=32767,Fe=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!i&&(s=s.sibling,s!==null)){Fe=s;return}Fe=s=u}while(s!==null);Mt=6,Fe=null}function Cy(s,i,u,f,v,x,R,D,z){s.cancelPendingCommit=null;do qc();while(Bt!==0);if((nt&6)!==0)throw Error(n(327));if(i!==null){if(i===s.current)throw Error(n(177));if(x=i.lanes|i.childLanes,x|=Vu,ze(s,u,x,R,D,z),s===ft&&(Fe=ft=null,Ve=0),Wi=i,xa=s,Gs=u,tf=x,nf=v,fy=f,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,fM(Yt,function(){return ky(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||f){f=L.T,L.T=null,v=_.p,_.p=2,R=nt,nt|=4;try{tM(s,i,u)}finally{nt=R,_.p=v,L.T=f}}Bt=1,My(),Ey(),Ry()}}function My(){if(Bt===1){Bt=0;var s=xa,i=Wi,u=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||u){u=L.T,L.T=null;var f=_.p;_.p=2;var v=nt;nt|=4;try{ay(i,s);var x=vf,R=ug(s.containerInfo),D=x.focusedElem,z=x.selectionRange;if(R!==D&&D&&D.ownerDocument&&lg(D.ownerDocument.documentElement,D)){if(z!==null&&$u(D)){var G=z.start,ne=z.end;if(ne===void 0&&(ne=G),"selectionStart"in D)D.selectionStart=G,D.selectionEnd=Math.min(ne,D.value.length);else{var re=D.ownerDocument||document,K=re&&re.defaultView||window;if(K.getSelection){var X=K.getSelection(),xe=D.textContent.length,De=Math.min(z.start,xe),dt=z.end===void 0?De:Math.min(z.end,xe);!X.extend&&De>dt&&(R=dt,dt=De,De=R);var B=cg(D,De),I=cg(D,dt);if(B&&I&&(X.rangeCount!==1||X.anchorNode!==B.node||X.anchorOffset!==B.offset||X.focusNode!==I.node||X.focusOffset!==I.offset)){var F=re.createRange();F.setStart(B.node,B.offset),X.removeAllRanges(),De>dt?(X.addRange(F),X.extend(I.node,I.offset)):(F.setEnd(I.node,I.offset),X.addRange(F))}}}}for(re=[],X=D;X=X.parentNode;)X.nodeType===1&&re.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<re.length;D++){var oe=re[D];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}Xc=!!yf,vf=yf=null}finally{nt=v,_.p=f,L.T=u}}s.current=i,Bt=2}}function Ey(){if(Bt===2){Bt=0;var s=xa,i=Wi,u=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||u){u=L.T,L.T=null;var f=_.p;_.p=2;var v=nt;nt|=4;try{Jm(s,i.alternate,i)}finally{nt=v,_.p=f,L.T=u}}Bt=3}}function Ry(){if(Bt===4||Bt===3){Bt=0,qt();var s=xa,i=Wi,u=Gs,f=fy;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?Bt=5:(Bt=0,Wi=xa=null,Ty(s,s.pendingLanes));var v=s.pendingLanes;if(v===0&&(ba=null),Rt(u),i=i.stateNode,Wt&&typeof Wt.onCommitFiberRoot=="function")try{Wt.onCommitFiberRoot(os,i,void 0,(i.current.flags&128)===128)}catch{}if(f!==null){i=L.T,v=_.p,_.p=2,L.T=null;try{for(var x=s.onRecoverableError,R=0;R<f.length;R++){var D=f[R];x(D.value,{componentStack:D.stack})}}finally{L.T=i,_.p=v}}(Gs&3)!==0&&qc(),ds(s),v=s.pendingLanes,(u&261930)!==0&&(v&42)!==0?s===sf?or++:(or=0,sf=s):or=0,rr(0)}}function Ty(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,Bo(i)))}function qc(){return My(),Ey(),Ry(),ky()}function ky(){if(Bt!==5)return!1;var s=xa,i=tf;tf=0;var u=Rt(Gs),f=L.T,v=_.p;try{_.p=32>u?32:u,L.T=null,u=nf,nf=null;var x=xa,R=Gs;if(Bt=0,Wi=xa=null,Gs=0,(nt&6)!==0)throw Error(n(331));var D=nt;if(nt|=4,ly(x.current),oy(x,x.current,R,u),nt=D,rr(0,!1),Wt&&typeof Wt.onPostCommitFiberRoot=="function")try{Wt.onPostCommitFiberRoot(os,x)}catch{}return!0}finally{_.p=v,L.T=f,Ty(s,i)}}function Ay(s,i,u){i=Pn(u,i),i=zd(s.stateNode,i,2),s=ha(s,i,2),s!==null&&(be(s,2),ds(s))}function rt(s,i,u){if(s.tag===3)Ay(s,s,u);else for(;i!==null;){if(i.tag===3){Ay(i,s,u);break}else if(i.tag===1){var f=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ba===null||!ba.has(f))){s=Pn(u,s),u=Dm(2),f=ha(i,u,2),f!==null&&(Nm(u,f,i,s),be(f,2),ds(f));break}}i=i.return}}function rf(s,i,u){var f=s.pingCache;if(f===null){f=s.pingCache=new aM;var v=new Set;f.set(i,v)}else v=f.get(i),v===void 0&&(v=new Set,f.set(i,v));v.has(u)||(Zd=!0,v.add(u),s=lM.bind(null,s,i,u),i.then(s,s))}function lM(s,i,u){var f=s.pingCache;f!==null&&f.delete(i),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,ft===s&&(Ve&u)===u&&(Mt===4||Mt===3&&(Ve&62914560)===Ve&&300>Je()-jc?(nt&2)===0&&Xi(s,0):Jd|=u,Yi===Ve&&(Yi=0)),ds(s)}function Dy(s,i){i===0&&(i=ee()),s=Ya(s,i),s!==null&&(be(s,i),ds(s))}function uM(s){var i=s.memoizedState,u=0;i!==null&&(u=i.retryLane),Dy(s,u)}function dM(s,i){var u=0;switch(s.tag){case 31:case 13:var f=s.stateNode,v=s.memoizedState;v!==null&&(u=v.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(n(314))}f!==null&&f.delete(i),Dy(s,u)}function fM(s,i){return Ue(s,i)}var Hc=null,Ji=null,cf=!1,Bc=!1,lf=!1,Sa=0;function ds(s){s!==Ji&&s.next===null&&(Ji===null?Hc=Ji=s:Ji=Ji.next=s),Bc=!0,cf||(cf=!0,pM())}function rr(s,i){if(!lf&&Bc){lf=!0;do for(var u=!1,f=Hc;f!==null;){if(s!==0){var v=f.pendingLanes;if(v===0)var x=0;else{var R=f.suspendedLanes,D=f.pingedLanes;x=(1<<31-jt(42|s)+1)-1,x&=v&~(R&~D),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(u=!0,Ly(f,x))}else x=Ve,x=ks(f,f===ft?x:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(x&3)===0||As(f,x)||(u=!0,Ly(f,x));f=f.next}while(u);lf=!1}}function hM(){Ny()}function Ny(){Bc=cf=!1;var s=0;Sa!==0&&MM()&&(s=Sa);for(var i=Je(),u=null,f=Hc;f!==null;){var v=f.next,x=_y(f,i);x===0?(f.next=null,u===null?Hc=v:u.next=v,v===null&&(Ji=u)):(u=f,(s!==0||(x&3)!==0)&&(Bc=!0)),f=v}Bt!==0&&Bt!==5||rr(s),Sa!==0&&(Sa=0)}function _y(s,i){for(var u=s.suspendedLanes,f=s.pingedLanes,v=s.expirationTimes,x=s.pendingLanes&-62914561;0<x;){var R=31-jt(x),D=1<<R,z=v[R];z===-1?((D&u)===0||(D&f)!==0)&&(v[R]=Mu(D,i)):z<=i&&(s.expiredLanes|=D),x&=~D}if(i=ft,u=Ve,u=ks(s,s===i?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,u===0||s===i&&(ot===2||ot===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&yt(f),s.callbackNode=null,s.callbackPriority=0;if((u&3)===0||As(s,u)){if(i=u&-u,i===s.callbackPriority)return i;switch(f!==null&&yt(f),Rt(u)){case 2:case 8:u=gt;break;case 32:u=Yt;break;case 268435456:u=Rs;break;default:u=Yt}return f=jy.bind(null,s),u=Ue(u,f),s.callbackPriority=i,s.callbackNode=u,i}return f!==null&&f!==null&&yt(f),s.callbackPriority=2,s.callbackNode=null,2}function jy(s,i){if(Bt!==0&&Bt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var u=s.callbackNode;if(qc()&&s.callbackNode!==u)return null;var f=Ve;return f=ks(s,s===ft?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(py(s,f,i),_y(s,Je()),s.callbackNode!=null&&s.callbackNode===u?jy.bind(null,s):null)}function Ly(s,i){if(qc())return null;py(s,i,!0)}function pM(){RM(function(){(nt&6)!==0?Ue(vt,hM):Ny()})}function uf(){if(Sa===0){var s=Ii;s===0&&(s=Ts,Ts<<=1,(Ts&261888)===0&&(Ts=256)),Sa=s}return Sa}function zy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Yr(""+s)}function Py(s,i){var u=i.ownerDocument.createElement("input");return u.name=i.name,u.value=i.value,s.id&&u.setAttribute("form",s.id),i.parentNode.insertBefore(u,i),s=new FormData(s),u.parentNode.removeChild(u),s}function gM(s,i,u,f,v){if(i==="submit"&&u&&u.stateNode===v){var x=zy((v[Ht]||null).action),R=f.submitter;R&&(i=(i=R[Ht]||null)?zy(i.formAction):R.getAttribute("formAction"),i!==null&&(x=i,R=null));var D=new Jr("action","action",null,f,v);s.push({event:D,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Sa!==0){var z=R?Py(v,R):new FormData(v);Ad(u,{pending:!0,data:z,method:v.method,action:x},null,z)}}else typeof x=="function"&&(D.preventDefault(),z=R?Py(v,R):new FormData(v),Ad(u,{pending:!0,data:z,method:v.method,action:x},x,z))},currentTarget:v}]})}}for(var df=0;df<Gu.length;df++){var ff=Gu[df],mM=ff.toLowerCase(),yM=ff[0].toUpperCase()+ff.slice(1);Xn(mM,"on"+yM)}Xn(hg,"onAnimationEnd"),Xn(pg,"onAnimationIteration"),Xn(gg,"onAnimationStart"),Xn("dblclick","onDoubleClick"),Xn("focusin","onFocus"),Xn("focusout","onBlur"),Xn(jC,"onTransitionRun"),Xn(LC,"onTransitionStart"),Xn(zC,"onTransitionCancel"),Xn(mg,"onTransitionEnd"),Mi("onMouseEnter",["mouseout","mouseover"]),Mi("onMouseLeave",["mouseout","mouseover"]),Mi("onPointerEnter",["pointerout","pointerover"]),Mi("onPointerLeave",["pointerout","pointerover"]),Fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vM=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cr));function Oy(s,i){i=(i&4)!==0;for(var u=0;u<s.length;u++){var f=s[u],v=f.event;f=f.listeners;e:{var x=void 0;if(i)for(var R=f.length-1;0<=R;R--){var D=f[R],z=D.instance,G=D.currentTarget;if(D=D.listener,z!==x&&v.isPropagationStopped())break e;x=D,v.currentTarget=G;try{x(v)}catch(ne){nc(ne)}v.currentTarget=null,x=z}else for(R=0;R<f.length;R++){if(D=f[R],z=D.instance,G=D.currentTarget,D=D.listener,z!==x&&v.isPropagationStopped())break e;x=D,v.currentTarget=G;try{x(v)}catch(ne){nc(ne)}v.currentTarget=null,x=z}}}}function Ge(s,i){var u=i[Qe];u===void 0&&(u=i[Qe]=new Set);var f=s+"__bubble";u.has(f)||(Iy(i,s,2,!1),u.add(f))}function hf(s,i,u){var f=0;i&&(f|=4),Iy(u,s,f,i)}var $c="_reactListening"+Math.random().toString(36).slice(2);function pf(s){if(!s[$c]){s[$c]=!0,Np.forEach(function(u){u!=="selectionchange"&&(vM.has(u)||hf(u,!1,s),hf(u,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[$c]||(i[$c]=!0,hf("selectionchange",!1,i))}}function Iy(s,i,u,f){switch(h0(i)){case 2:var v=GM;break;case 8:v=VM;break;default:v=Af}u=v.bind(null,i,u,s),v=void 0,!ju||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(v=!0),f?v!==void 0?s.addEventListener(i,u,{capture:!0,passive:v}):s.addEventListener(i,u,!0):v!==void 0?s.addEventListener(i,u,{passive:v}):s.addEventListener(i,u,!1)}function gf(s,i,u,f,v){var x=f;if((i&1)===0&&(i&2)===0&&f!==null)e:for(;;){if(f===null)return;var R=f.tag;if(R===3||R===4){var D=f.stateNode.containerInfo;if(D===v)break;if(R===4)for(R=f.return;R!==null;){var z=R.tag;if((z===3||z===4)&&R.stateNode.containerInfo===v)return;R=R.return}for(;D!==null;){if(R=wi(D),R===null)return;if(z=R.tag,z===5||z===6||z===26||z===27){f=x=R;continue e}D=D.parentNode}}f=f.return}Up(function(){var G=x,ne=Nu(u),re=[];e:{var K=yg.get(s);if(K!==void 0){var X=Jr,xe=s;switch(s){case"keypress":if(Xr(u)===0)break e;case"keydown":case"keyup":X=dC;break;case"focusin":xe="focus",X=Ou;break;case"focusout":xe="blur",X=Ou;break;case"beforeblur":case"afterblur":X=Ou;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=Gp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=J1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=pC;break;case hg:case pg:case gg:X=nC;break;case mg:X=mC;break;case"scroll":case"scrollend":X=X1;break;case"wheel":X=vC;break;case"copy":case"cut":case"paste":X=aC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=Kp;break;case"toggle":case"beforetoggle":X=xC}var De=(i&4)!==0,dt=!De&&(s==="scroll"||s==="scrollend"),B=De?K!==null?K+"Capture":null:K;De=[];for(var I=G,F;I!==null;){var oe=I;if(F=oe.stateNode,oe=oe.tag,oe!==5&&oe!==26&&oe!==27||F===null||B===null||(oe=Do(I,B),oe!=null&&De.push(lr(I,oe,F))),dt)break;I=I.return}0<De.length&&(K=new X(K,xe,null,u,ne),re.push({event:K,listeners:De}))}}if((i&7)===0){e:{if(K=s==="mouseover"||s==="pointerover",X=s==="mouseout"||s==="pointerout",K&&u!==Du&&(xe=u.relatedTarget||u.fromElement)&&(wi(xe)||xe[rs]))break e;if((X||K)&&(K=ne.window===ne?ne:(K=ne.ownerDocument)?K.defaultView||K.parentWindow:window,X?(xe=u.relatedTarget||u.toElement,X=G,xe=xe?wi(xe):null,xe!==null&&(dt=r(xe),De=xe.tag,xe!==dt||De!==5&&De!==27&&De!==6)&&(xe=null)):(X=null,xe=G),X!==xe)){if(De=Gp,oe="onMouseLeave",B="onMouseEnter",I="mouse",(s==="pointerout"||s==="pointerover")&&(De=Kp,oe="onPointerLeave",B="onPointerEnter",I="pointer"),dt=X==null?K:Ao(X),F=xe==null?K:Ao(xe),K=new De(oe,I+"leave",X,u,ne),K.target=dt,K.relatedTarget=F,oe=null,wi(ne)===G&&(De=new De(B,I+"enter",xe,u,ne),De.target=F,De.relatedTarget=dt,oe=De),dt=oe,X&&xe)t:{for(De=bM,B=X,I=xe,F=0,oe=B;oe;oe=De(oe))F++;oe=0;for(var Te=I;Te;Te=De(Te))oe++;for(;0<F-oe;)B=De(B),F--;for(;0<oe-F;)I=De(I),oe--;for(;F--;){if(B===I||I!==null&&B===I.alternate){De=B;break t}B=De(B),I=De(I)}De=null}else De=null;X!==null&&qy(re,K,X,De,!1),xe!==null&&dt!==null&&qy(re,dt,xe,De,!0)}}e:{if(K=G?Ao(G):window,X=K.nodeName&&K.nodeName.toLowerCase(),X==="select"||X==="input"&&K.type==="file")var et=ng;else if(eg(K))if(sg)et=DC;else{et=kC;var Me=TC}else X=K.nodeName,!X||X.toLowerCase()!=="input"||K.type!=="checkbox"&&K.type!=="radio"?G&&Au(G.elementType)&&(et=ng):et=AC;if(et&&(et=et(s,G))){tg(re,et,u,ne);break e}Me&&Me(s,K,G),s==="focusout"&&G&&K.type==="number"&&G.memoizedProps.value!=null&&ku(K,"number",K.value)}switch(Me=G?Ao(G):window,s){case"focusin":(eg(Me)||Me.contentEditable==="true")&&(Di=Me,Uu=G,Io=null);break;case"focusout":Io=Uu=Di=null;break;case"mousedown":Qu=!0;break;case"contextmenu":case"mouseup":case"dragend":Qu=!1,dg(re,u,ne);break;case"selectionchange":if(_C)break;case"keydown":case"keyup":dg(re,u,ne)}var qe;if(qu)e:{switch(s){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else Ai?Zp(s,u)&&(Ke="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(Ke="onCompositionStart");Ke&&(Yp&&u.locale!=="ko"&&(Ai||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&Ai&&(qe=Qp()):(oa=ne,Lu="value"in oa?oa.value:oa.textContent,Ai=!0)),Me=Uc(G,Ke),0<Me.length&&(Ke=new Vp(Ke,s,null,u,ne),re.push({event:Ke,listeners:Me}),qe?Ke.data=qe:(qe=Jp(u),qe!==null&&(Ke.data=qe)))),(qe=SC?CC(s,u):MC(s,u))&&(Ke=Uc(G,"onBeforeInput"),0<Ke.length&&(Me=new Vp("onBeforeInput","beforeinput",null,u,ne),re.push({event:Me,listeners:Ke}),Me.data=qe)),gM(re,s,G,u,ne)}Oy(re,i)})}function lr(s,i,u){return{instance:s,listener:i,currentTarget:u}}function Uc(s,i){for(var u=i+"Capture",f=[];s!==null;){var v=s,x=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||x===null||(v=Do(s,u),v!=null&&f.unshift(lr(s,v,x)),v=Do(s,i),v!=null&&f.push(lr(s,v,x))),s.tag===3)return f;s=s.return}return[]}function bM(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function qy(s,i,u,f,v){for(var x=i._reactName,R=[];u!==null&&u!==f;){var D=u,z=D.alternate,G=D.stateNode;if(D=D.tag,z!==null&&z===f)break;D!==5&&D!==26&&D!==27||G===null||(z=G,v?(G=Do(u,x),G!=null&&R.unshift(lr(u,G,z))):v||(G=Do(u,x),G!=null&&R.push(lr(u,G,z)))),u=u.return}R.length!==0&&s.push({event:i,listeners:R})}var xM=/\r\n?/g,wM=/\u0000|\uFFFD/g;function Hy(s){return(typeof s=="string"?s:""+s).replace(xM,`
`).replace(wM,"")}function By(s,i){return i=Hy(i),Hy(s)===i}function ut(s,i,u,f,v,x){switch(u){case"children":typeof f=="string"?i==="body"||i==="textarea"&&f===""||Ri(s,f):(typeof f=="number"||typeof f=="bigint")&&i!=="body"&&Ri(s,""+f);break;case"className":Vr(s,"class",f);break;case"tabIndex":Vr(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Vr(s,u,f);break;case"style":Bp(s,f,x);break;case"data":if(i!=="object"){Vr(s,"data",f);break}case"src":case"href":if(f===""&&(i!=="a"||u!=="href")){s.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(u);break}f=Yr(""+f),s.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(u==="formAction"?(i!=="input"&&ut(s,i,"name",v.name,v,null),ut(s,i,"formEncType",v.formEncType,v,null),ut(s,i,"formMethod",v.formMethod,v,null),ut(s,i,"formTarget",v.formTarget,v,null)):(ut(s,i,"encType",v.encType,v,null),ut(s,i,"method",v.method,v,null),ut(s,i,"target",v.target,v,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(u);break}f=Yr(""+f),s.setAttribute(u,f);break;case"onClick":f!=null&&(s.onclick=Ns);break;case"onScroll":f!=null&&Ge("scroll",s);break;case"onScrollEnd":f!=null&&Ge("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(n(61));if(u=f.__html,u!=null){if(v.children!=null)throw Error(n(60));s.innerHTML=u}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}u=Yr(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(u,""+f):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":f===!0?s.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(u,f):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(u,f):s.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(u):s.setAttribute(u,f);break;case"popover":Ge("beforetoggle",s),Ge("toggle",s),Gr(s,"popover",f);break;case"xlinkActuate":Ds(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Ds(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Ds(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Ds(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Ds(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Ds(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Ds(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Ds(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Ds(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Gr(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Y1.get(u)||u,Gr(s,u,f))}}function mf(s,i,u,f,v,x){switch(u){case"style":Bp(s,f,x);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(n(61));if(u=f.__html,u!=null){if(v.children!=null)throw Error(n(60));s.innerHTML=u}}break;case"children":typeof f=="string"?Ri(s,f):(typeof f=="number"||typeof f=="bigint")&&Ri(s,""+f);break;case"onScroll":f!=null&&Ge("scroll",s);break;case"onScrollEnd":f!=null&&Ge("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Ns);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_p.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(v=u.endsWith("Capture"),i=u.slice(2,v?u.length-7:void 0),x=s[Ht]||null,x=x!=null?x[u]:null,typeof x=="function"&&s.removeEventListener(i,x,v),typeof f=="function")){typeof x!="function"&&x!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(i,f,v);break e}u in s?s[u]=f:f===!0?s.setAttribute(u,""):Gr(s,u,f)}}}function tn(s,i,u){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ge("error",s),Ge("load",s);var f=!1,v=!1,x;for(x in u)if(u.hasOwnProperty(x)){var R=u[x];if(R!=null)switch(x){case"src":f=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:ut(s,i,x,R,u,null)}}v&&ut(s,i,"srcSet",u.srcSet,u,null),f&&ut(s,i,"src",u.src,u,null);return;case"input":Ge("invalid",s);var D=x=R=v=null,z=null,G=null;for(f in u)if(u.hasOwnProperty(f)){var ne=u[f];if(ne!=null)switch(f){case"name":v=ne;break;case"type":R=ne;break;case"checked":z=ne;break;case"defaultChecked":G=ne;break;case"value":x=ne;break;case"defaultValue":D=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(n(137,i));break;default:ut(s,i,f,ne,u,null)}}Op(s,x,D,z,G,R,v,!1);return;case"select":Ge("invalid",s),f=R=x=null;for(v in u)if(u.hasOwnProperty(v)&&(D=u[v],D!=null))switch(v){case"value":x=D;break;case"defaultValue":R=D;break;case"multiple":f=D;default:ut(s,i,v,D,u,null)}i=x,u=R,s.multiple=!!f,i!=null?Ei(s,!!f,i,!1):u!=null&&Ei(s,!!f,u,!0);return;case"textarea":Ge("invalid",s),x=v=f=null;for(R in u)if(u.hasOwnProperty(R)&&(D=u[R],D!=null))switch(R){case"value":f=D;break;case"defaultValue":v=D;break;case"children":x=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(n(91));break;default:ut(s,i,R,D,u,null)}qp(s,f,v,x);return;case"option":for(z in u)if(u.hasOwnProperty(z)&&(f=u[z],f!=null))switch(z){case"selected":s.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:ut(s,i,z,f,u,null)}return;case"dialog":Ge("beforetoggle",s),Ge("toggle",s),Ge("cancel",s),Ge("close",s);break;case"iframe":case"object":Ge("load",s);break;case"video":case"audio":for(f=0;f<cr.length;f++)Ge(cr[f],s);break;case"image":Ge("error",s),Ge("load",s);break;case"details":Ge("toggle",s);break;case"embed":case"source":case"link":Ge("error",s),Ge("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(G in u)if(u.hasOwnProperty(G)&&(f=u[G],f!=null))switch(G){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:ut(s,i,G,f,u,null)}return;default:if(Au(i)){for(ne in u)u.hasOwnProperty(ne)&&(f=u[ne],f!==void 0&&mf(s,i,ne,f,u,void 0));return}}for(D in u)u.hasOwnProperty(D)&&(f=u[D],f!=null&&ut(s,i,D,f,u,null))}function SM(s,i,u,f){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,x=null,R=null,D=null,z=null,G=null,ne=null;for(X in u){var re=u[X];if(u.hasOwnProperty(X)&&re!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":z=re;default:f.hasOwnProperty(X)||ut(s,i,X,null,f,re)}}for(var K in f){var X=f[K];if(re=u[K],f.hasOwnProperty(K)&&(X!=null||re!=null))switch(K){case"type":x=X;break;case"name":v=X;break;case"checked":G=X;break;case"defaultChecked":ne=X;break;case"value":R=X;break;case"defaultValue":D=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(n(137,i));break;default:X!==re&&ut(s,i,K,X,f,re)}}Tu(s,R,D,z,G,ne,x,v);return;case"select":X=R=D=K=null;for(x in u)if(z=u[x],u.hasOwnProperty(x)&&z!=null)switch(x){case"value":break;case"multiple":X=z;default:f.hasOwnProperty(x)||ut(s,i,x,null,f,z)}for(v in f)if(x=f[v],z=u[v],f.hasOwnProperty(v)&&(x!=null||z!=null))switch(v){case"value":K=x;break;case"defaultValue":D=x;break;case"multiple":R=x;default:x!==z&&ut(s,i,v,x,f,z)}i=D,u=R,f=X,K!=null?Ei(s,!!u,K,!1):!!f!=!!u&&(i!=null?Ei(s,!!u,i,!0):Ei(s,!!u,u?[]:"",!1));return;case"textarea":X=K=null;for(D in u)if(v=u[D],u.hasOwnProperty(D)&&v!=null&&!f.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:ut(s,i,D,null,f,v)}for(R in f)if(v=f[R],x=u[R],f.hasOwnProperty(R)&&(v!=null||x!=null))switch(R){case"value":K=v;break;case"defaultValue":X=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(n(91));break;default:v!==x&&ut(s,i,R,v,f,x)}Ip(s,K,X);return;case"option":for(var xe in u)if(K=u[xe],u.hasOwnProperty(xe)&&K!=null&&!f.hasOwnProperty(xe))switch(xe){case"selected":s.selected=!1;break;default:ut(s,i,xe,null,f,K)}for(z in f)if(K=f[z],X=u[z],f.hasOwnProperty(z)&&K!==X&&(K!=null||X!=null))switch(z){case"selected":s.selected=K&&typeof K!="function"&&typeof K!="symbol";break;default:ut(s,i,z,K,f,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var De in u)K=u[De],u.hasOwnProperty(De)&&K!=null&&!f.hasOwnProperty(De)&&ut(s,i,De,null,f,K);for(G in f)if(K=f[G],X=u[G],f.hasOwnProperty(G)&&K!==X&&(K!=null||X!=null))switch(G){case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(n(137,i));break;default:ut(s,i,G,K,f,X)}return;default:if(Au(i)){for(var dt in u)K=u[dt],u.hasOwnProperty(dt)&&K!==void 0&&!f.hasOwnProperty(dt)&&mf(s,i,dt,void 0,f,K);for(ne in f)K=f[ne],X=u[ne],!f.hasOwnProperty(ne)||K===X||K===void 0&&X===void 0||mf(s,i,ne,K,f,X);return}}for(var B in u)K=u[B],u.hasOwnProperty(B)&&K!=null&&!f.hasOwnProperty(B)&&ut(s,i,B,null,f,K);for(re in f)K=f[re],X=u[re],!f.hasOwnProperty(re)||K===X||K==null&&X==null||ut(s,i,re,K,f,X)}function $y(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function CM(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,u=performance.getEntriesByType("resource"),f=0;f<u.length;f++){var v=u[f],x=v.transferSize,R=v.initiatorType,D=v.duration;if(x&&D&&$y(R)){for(R=0,D=v.responseEnd,f+=1;f<u.length;f++){var z=u[f],G=z.startTime;if(G>D)break;var ne=z.transferSize,re=z.initiatorType;ne&&$y(re)&&(z=z.responseEnd,R+=ne*(z<D?1:(D-G)/(z-G)))}if(--f,i+=8*(x+R)/(v.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var yf=null,vf=null;function Qc(s){return s.nodeType===9?s:s.ownerDocument}function Uy(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qy(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function bf(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var xf=null;function MM(){var s=window.event;return s&&s.type==="popstate"?s===xf?!1:(xf=s,!0):(xf=null,!1)}var Fy=typeof setTimeout=="function"?setTimeout:void 0,EM=typeof clearTimeout=="function"?clearTimeout:void 0,Gy=typeof Promise=="function"?Promise:void 0,RM=typeof queueMicrotask=="function"?queueMicrotask:typeof Gy<"u"?function(s){return Gy.resolve(null).then(s).catch(TM)}:Fy;function TM(s){setTimeout(function(){throw s})}function Ca(s){return s==="head"}function Vy(s,i){var u=i,f=0;do{var v=u.nextSibling;if(s.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"||u==="/&"){if(f===0){s.removeChild(v),so(i);return}f--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")f++;else if(u==="html")ur(s.ownerDocument.documentElement);else if(u==="head"){u=s.ownerDocument.head,ur(u);for(var x=u.firstChild;x;){var R=x.nextSibling,D=x.nodeName;x[ko]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=R}}else u==="body"&&ur(s.ownerDocument.body);u=v}while(u);so(i)}function Ky(s,i){var u=s;s=0;do{var f=u.nextSibling;if(u.nodeType===1?i?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(i?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),f&&f.nodeType===8)if(u=f.data,u==="/$"){if(s===0)break;s--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||s++;u=f}while(u)}function wf(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var u=i;switch(i=i.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":wf(u),Eu(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function kM(s,i,u,f){for(;s.nodeType===1;){var v=u;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[ko])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(x=s.getAttribute("rel"),x==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(x!==v.rel||s.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||s.getAttribute("title")!==(v.title==null?null:v.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(x=s.getAttribute("src"),(x!==(v.src==null?null:v.src)||s.getAttribute("type")!==(v.type==null?null:v.type)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&x&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var x=v.name==null?null:""+v.name;if(v.type==="hidden"&&s.getAttribute("name")===x)return s}else return s;if(s=Bn(s.nextSibling),s===null)break}return null}function AM(s,i,u){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=Bn(s.nextSibling),s===null))return null;return s}function Yy(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=Bn(s.nextSibling),s===null))return null;return s}function Sf(s){return s.data==="$?"||s.data==="$~"}function Cf(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function DM(s,i){var u=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||u.readyState!=="loading")i();else{var f=function(){i(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function Bn(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var Mf=null;function Wy(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var u=s.data;if(u==="/$"||u==="/&"){if(i===0)return Bn(s.nextSibling);i--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||i++}s=s.nextSibling}return null}function Xy(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(i===0)return s;i--}else u!=="/$"&&u!=="/&"||i++}s=s.previousSibling}return null}function Zy(s,i,u){switch(i=Qc(u),s){case"html":if(s=i.documentElement,!s)throw Error(n(452));return s;case"head":if(s=i.head,!s)throw Error(n(453));return s;case"body":if(s=i.body,!s)throw Error(n(454));return s;default:throw Error(n(451))}}function ur(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);Eu(s)}var $n=new Map,Jy=new Set;function Fc(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Vs=_.d;_.d={f:NM,r:_M,D:jM,C:LM,L:zM,m:PM,X:IM,S:OM,M:qM};function NM(){var s=Vs.f(),i=Pc();return s||i}function _M(s){var i=Si(s);i!==null&&i.tag===5&&i.type==="form"?mm(i):Vs.r(s)}var eo=typeof document>"u"?null:document;function e0(s,i,u){var f=eo;if(f&&typeof i=="string"&&i){var v=Ln(i);v='link[rel="'+s+'"][href="'+v+'"]',typeof u=="string"&&(v+='[crossorigin="'+u+'"]'),Jy.has(v)||(Jy.add(v),s={rel:s,crossOrigin:u,href:i},f.querySelector(v)===null&&(i=f.createElement("link"),tn(i,"link",s),Vt(i),f.head.appendChild(i)))}}function jM(s){Vs.D(s),e0("dns-prefetch",s,null)}function LM(s,i){Vs.C(s,i),e0("preconnect",s,i)}function zM(s,i,u){Vs.L(s,i,u);var f=eo;if(f&&s&&i){var v='link[rel="preload"][as="'+Ln(i)+'"]';i==="image"&&u&&u.imageSrcSet?(v+='[imagesrcset="'+Ln(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(v+='[imagesizes="'+Ln(u.imageSizes)+'"]')):v+='[href="'+Ln(s)+'"]';var x=v;switch(i){case"style":x=to(s);break;case"script":x=no(s)}$n.has(x)||(s=m({rel:"preload",href:i==="image"&&u&&u.imageSrcSet?void 0:s,as:i},u),$n.set(x,s),f.querySelector(v)!==null||i==="style"&&f.querySelector(dr(x))||i==="script"&&f.querySelector(fr(x))||(i=f.createElement("link"),tn(i,"link",s),Vt(i),f.head.appendChild(i)))}}function PM(s,i){Vs.m(s,i);var u=eo;if(u&&s){var f=i&&typeof i.as=="string"?i.as:"script",v='link[rel="modulepreload"][as="'+Ln(f)+'"][href="'+Ln(s)+'"]',x=v;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=no(s)}if(!$n.has(x)&&(s=m({rel:"modulepreload",href:s},i),$n.set(x,s),u.querySelector(v)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(fr(x)))return}f=u.createElement("link"),tn(f,"link",s),Vt(f),u.head.appendChild(f)}}}function OM(s,i,u){Vs.S(s,i,u);var f=eo;if(f&&s){var v=Ci(f).hoistableStyles,x=to(s);i=i||"default";var R=v.get(x);if(!R){var D={loading:0,preload:null};if(R=f.querySelector(dr(x)))D.loading=5;else{s=m({rel:"stylesheet",href:s,"data-precedence":i},u),(u=$n.get(x))&&Ef(s,u);var z=R=f.createElement("link");Vt(z),tn(z,"link",s),z._p=new Promise(function(G,ne){z.onload=G,z.onerror=ne}),z.addEventListener("load",function(){D.loading|=1}),z.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Gc(R,i,f)}R={type:"stylesheet",instance:R,count:1,state:D},v.set(x,R)}}}function IM(s,i){Vs.X(s,i);var u=eo;if(u&&s){var f=Ci(u).hoistableScripts,v=no(s),x=f.get(v);x||(x=u.querySelector(fr(v)),x||(s=m({src:s,async:!0},i),(i=$n.get(v))&&Rf(s,i),x=u.createElement("script"),Vt(x),tn(x,"link",s),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},f.set(v,x))}}function qM(s,i){Vs.M(s,i);var u=eo;if(u&&s){var f=Ci(u).hoistableScripts,v=no(s),x=f.get(v);x||(x=u.querySelector(fr(v)),x||(s=m({src:s,async:!0,type:"module"},i),(i=$n.get(v))&&Rf(s,i),x=u.createElement("script"),Vt(x),tn(x,"link",s),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},f.set(v,x))}}function t0(s,i,u,f){var v=(v=ie.current)?Fc(v):null;if(!v)throw Error(n(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(i=to(u.href),u=Ci(v).hoistableStyles,f=u.get(i),f||(f={type:"style",instance:null,count:0,state:null},u.set(i,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=to(u.href);var x=Ci(v).hoistableStyles,R=x.get(s);if(R||(v=v.ownerDocument||v,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(s,R),(x=v.querySelector(dr(s)))&&!x._p&&(R.instance=x,R.state.loading=5),$n.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},$n.set(s,u),x||HM(v,s,u,R.state))),i&&f===null)throw Error(n(528,""));return R}if(i&&f!==null)throw Error(n(529,""));return null;case"script":return i=u.async,u=u.src,typeof u=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=no(u),u=Ci(v).hoistableScripts,f=u.get(i),f||(f={type:"script",instance:null,count:0,state:null},u.set(i,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,s))}}function to(s){return'href="'+Ln(s)+'"'}function dr(s){return'link[rel="stylesheet"]['+s+"]"}function n0(s){return m({},s,{"data-precedence":s.precedence,precedence:null})}function HM(s,i,u,f){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?f.loading=1:(i=s.createElement("link"),f.preload=i,i.addEventListener("load",function(){return f.loading|=1}),i.addEventListener("error",function(){return f.loading|=2}),tn(i,"link",u),Vt(i),s.head.appendChild(i))}function no(s){return'[src="'+Ln(s)+'"]'}function fr(s){return"script[async]"+s}function s0(s,i,u){if(i.count++,i.instance===null)switch(i.type){case"style":var f=s.querySelector('style[data-href~="'+Ln(u.href)+'"]');if(f)return i.instance=f,Vt(f),f;var v=m({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),Vt(f),tn(f,"style",v),Gc(f,u.precedence,s),i.instance=f;case"stylesheet":v=to(u.href);var x=s.querySelector(dr(v));if(x)return i.state.loading|=4,i.instance=x,Vt(x),x;f=n0(u),(v=$n.get(v))&&Ef(f,v),x=(s.ownerDocument||s).createElement("link"),Vt(x);var R=x;return R._p=new Promise(function(D,z){R.onload=D,R.onerror=z}),tn(x,"link",f),i.state.loading|=4,Gc(x,u.precedence,s),i.instance=x;case"script":return x=no(u.src),(v=s.querySelector(fr(x)))?(i.instance=v,Vt(v),v):(f=u,(v=$n.get(x))&&(f=m({},u),Rf(f,v)),s=s.ownerDocument||s,v=s.createElement("script"),Vt(v),tn(v,"link",f),s.head.appendChild(v),i.instance=v);case"void":return null;default:throw Error(n(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(f=i.instance,i.state.loading|=4,Gc(f,u.precedence,s));return i.instance}function Gc(s,i,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=f.length?f[f.length-1]:null,x=v,R=0;R<f.length;R++){var D=f[R];if(D.dataset.precedence===i)x=D;else if(x!==v)break}x?x.parentNode.insertBefore(s,x.nextSibling):(i=u.nodeType===9?u.head:u,i.insertBefore(s,i.firstChild))}function Ef(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function Rf(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var Vc=null;function a0(s,i,u){if(Vc===null){var f=new Map,v=Vc=new Map;v.set(u,f)}else v=Vc,f=v.get(u),f||(f=new Map,v.set(u,f));if(f.has(s))return f;for(f.set(s,null),u=u.getElementsByTagName(s),v=0;v<u.length;v++){var x=u[v];if(!(x[ko]||x[mt]||s==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var R=x.getAttribute(i)||"";R=s+R;var D=f.get(R);D?D.push(x):f.set(R,[x])}}return f}function i0(s,i,u){s=s.ownerDocument||s,s.head.insertBefore(u,i==="title"?s.querySelector("head > title"):null)}function BM(s,i,u){if(u===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function o0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function $M(s,i,u,f){if(u.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var v=to(f.href),x=i.querySelector(dr(v));if(x){i=x._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=Kc.bind(s),i.then(s,s)),u.state.loading|=4,u.instance=x,Vt(x);return}x=i.ownerDocument||i,f=n0(f),(v=$n.get(v))&&Ef(f,v),x=x.createElement("link"),Vt(x);var R=x;R._p=new Promise(function(D,z){R.onload=D,R.onerror=z}),tn(x,"link",f),u.instance=x}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(u,i),(i=u.state.preload)&&(u.state.loading&3)===0&&(s.count++,u=Kc.bind(s),i.addEventListener("load",u),i.addEventListener("error",u))}}var Tf=0;function UM(s,i){return s.stylesheets&&s.count===0&&Wc(s,s.stylesheets),0<s.count||0<s.imgCount?function(u){var f=setTimeout(function(){if(s.stylesheets&&Wc(s,s.stylesheets),s.unsuspend){var x=s.unsuspend;s.unsuspend=null,x()}},6e4+i);0<s.imgBytes&&Tf===0&&(Tf=62500*CM());var v=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Wc(s,s.stylesheets),s.unsuspend)){var x=s.unsuspend;s.unsuspend=null,x()}},(s.imgBytes>Tf?50:800)+i);return s.unsuspend=u,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(v)}}:null}function Kc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Wc(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Yc=null;function Wc(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Yc=new Map,i.forEach(QM,s),Yc=null,Kc.call(s))}function QM(s,i){if(!(i.state.loading&4)){var u=Yc.get(s);if(u)var f=u.get(null);else{u=new Map,Yc.set(s,u);for(var v=s.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<v.length;x++){var R=v[x];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(u.set(R.dataset.precedence,R),f=R)}f&&u.set(null,f)}v=i.instance,R=v.getAttribute("data-precedence"),x=u.get(R)||f,x===f&&u.set(null,v),u.set(R,v),this.count++,f=Kc.bind(this),v.addEventListener("load",f),v.addEventListener("error",f),x?x.parentNode.insertBefore(v,x.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(v,s.firstChild)),i.state.loading|=4}}var hr={$$typeof:T,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function FM(s,i,u,f,v,x,R,D,z){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fe(0),this.hiddenUpdates=fe(null),this.identifierPrefix=f,this.onUncaughtError=v,this.onCaughtError=x,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function r0(s,i,u,f,v,x,R,D,z,G,ne,re){return s=new FM(s,i,u,R,z,G,ne,re,D),i=1,x===!0&&(i|=24),x=wn(3,null,null,i),s.current=x,x.stateNode=s,i=id(),i.refCount++,s.pooledCache=i,i.refCount++,x.memoizedState={element:f,isDehydrated:u,cache:i},ld(x),s}function c0(s){return s?(s=ji,s):ji}function l0(s,i,u,f,v,x){v=c0(v),f.context===null?f.context=v:f.pendingContext=v,f=fa(i),f.payload={element:u},x=x===void 0?null:x,x!==null&&(f.callback=x),u=ha(s,f,i),u!==null&&(yn(u,s,i),Fo(u,s,i))}function u0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<i?u:i}}function kf(s,i){u0(s,i),(s=s.alternate)&&u0(s,i)}function d0(s){if(s.tag===13||s.tag===31){var i=Ya(s,67108864);i!==null&&yn(i,s,67108864),kf(s,67108864)}}function f0(s){if(s.tag===13||s.tag===31){var i=Rn();i=Xt(i);var u=Ya(s,i);u!==null&&yn(u,s,i),kf(s,i)}}var Xc=!0;function GM(s,i,u,f){var v=L.T;L.T=null;var x=_.p;try{_.p=2,Af(s,i,u,f)}finally{_.p=x,L.T=v}}function VM(s,i,u,f){var v=L.T;L.T=null;var x=_.p;try{_.p=8,Af(s,i,u,f)}finally{_.p=x,L.T=v}}function Af(s,i,u,f){if(Xc){var v=Df(f);if(v===null)gf(s,i,f,Zc,u),p0(s,f);else if(YM(v,s,i,u,f))f.stopPropagation();else if(p0(s,f),i&4&&-1<KM.indexOf(s)){for(;v!==null;){var x=Si(v);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var R=Wn(x.pendingLanes);if(R!==0){var D=x;for(D.pendingLanes|=2,D.entangledLanes|=2;R;){var z=1<<31-jt(R);D.entanglements[1]|=z,R&=~z}ds(x),(nt&6)===0&&(Lc=Je()+500,rr(0))}}break;case 31:case 13:D=Ya(x,2),D!==null&&yn(D,x,2),Pc(),kf(x,2)}if(x=Df(f),x===null&&gf(s,i,f,Zc,u),x===v)break;v=x}v!==null&&f.stopPropagation()}else gf(s,i,f,null,u)}}function Df(s){return s=Nu(s),Nf(s)}var Zc=null;function Nf(s){if(Zc=null,s=wi(s),s!==null){var i=r(s);if(i===null)s=null;else{var u=i.tag;if(u===13){if(s=c(i),s!==null)return s;s=null}else if(u===31){if(s=l(i),s!==null)return s;s=null}else if(u===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return Zc=s,null}function h0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_t()){case vt:return 2;case gt:return 8;case Yt:case Ft:return 32;case Rs:return 268435456;default:return 32}default:return 32}}var _f=!1,Ma=null,Ea=null,Ra=null,pr=new Map,gr=new Map,Ta=[],KM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function p0(s,i){switch(s){case"focusin":case"focusout":Ma=null;break;case"dragenter":case"dragleave":Ea=null;break;case"mouseover":case"mouseout":Ra=null;break;case"pointerover":case"pointerout":pr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":gr.delete(i.pointerId)}}function mr(s,i,u,f,v,x){return s===null||s.nativeEvent!==x?(s={blockedOn:i,domEventName:u,eventSystemFlags:f,nativeEvent:x,targetContainers:[v]},i!==null&&(i=Si(i),i!==null&&d0(i)),s):(s.eventSystemFlags|=f,i=s.targetContainers,v!==null&&i.indexOf(v)===-1&&i.push(v),s)}function YM(s,i,u,f,v){switch(i){case"focusin":return Ma=mr(Ma,s,i,u,f,v),!0;case"dragenter":return Ea=mr(Ea,s,i,u,f,v),!0;case"mouseover":return Ra=mr(Ra,s,i,u,f,v),!0;case"pointerover":var x=v.pointerId;return pr.set(x,mr(pr.get(x)||null,s,i,u,f,v)),!0;case"gotpointercapture":return x=v.pointerId,gr.set(x,mr(gr.get(x)||null,s,i,u,f,v)),!0}return!1}function g0(s){var i=wi(s.target);if(i!==null){var u=r(i);if(u!==null){if(i=u.tag,i===13){if(i=c(u),i!==null){s.blockedOn=i,wt(s.priority,function(){f0(u)});return}}else if(i===31){if(i=l(u),i!==null){s.blockedOn=i,wt(s.priority,function(){f0(u)});return}}else if(i===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Jc(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var u=Df(s.nativeEvent);if(u===null){u=s.nativeEvent;var f=new u.constructor(u.type,u);Du=f,u.target.dispatchEvent(f),Du=null}else return i=Si(u),i!==null&&d0(i),s.blockedOn=u,!1;i.shift()}return!0}function m0(s,i,u){Jc(s)&&u.delete(i)}function WM(){_f=!1,Ma!==null&&Jc(Ma)&&(Ma=null),Ea!==null&&Jc(Ea)&&(Ea=null),Ra!==null&&Jc(Ra)&&(Ra=null),pr.forEach(m0),gr.forEach(m0)}function el(s,i){s.blockedOn===i&&(s.blockedOn=null,_f||(_f=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,WM)))}var tl=null;function y0(s){tl!==s&&(tl=s,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){tl===s&&(tl=null);for(var i=0;i<s.length;i+=3){var u=s[i],f=s[i+1],v=s[i+2];if(typeof f!="function"){if(Nf(f||u)===null)continue;break}var x=Si(u);x!==null&&(s.splice(i,3),i-=3,Ad(x,{pending:!0,data:v,method:u.method,action:f},f,v))}}))}function so(s){function i(z){return el(z,s)}Ma!==null&&el(Ma,s),Ea!==null&&el(Ea,s),Ra!==null&&el(Ra,s),pr.forEach(i),gr.forEach(i);for(var u=0;u<Ta.length;u++){var f=Ta[u];f.blockedOn===s&&(f.blockedOn=null)}for(;0<Ta.length&&(u=Ta[0],u.blockedOn===null);)g0(u),u.blockedOn===null&&Ta.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var v=u[f],x=u[f+1],R=v[Ht]||null;if(typeof x=="function")R||y0(u);else if(R){var D=null;if(x&&x.hasAttribute("formAction")){if(v=x,R=x[Ht]||null)D=R.formAction;else if(Nf(v)!==null)continue}else D=R.action;typeof D=="function"?u[f+1]=D:(u.splice(f,3),f-=3),y0(u)}}}function v0(){function s(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(R){return v=R})},focusReset:"manual",scroll:"manual"})}function i(){v!==null&&(v(),v=null),f||setTimeout(u,20)}function u(){if(!f&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,v=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(u,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),v!==null&&(v(),v=null)}}}function jf(s){this._internalRoot=s}nl.prototype.render=jf.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(n(409));var u=i.current,f=Rn();l0(u,f,s,i,null,null)},nl.prototype.unmount=jf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;l0(s.current,2,null,s,null,null),Pc(),i[rs]=null}};function nl(s){this._internalRoot=s}nl.prototype.unstable_scheduleHydration=function(s){if(s){var i=cn();s={blockedOn:null,target:s,priority:i};for(var u=0;u<Ta.length&&i!==0&&i<Ta[u].priority;u++);Ta.splice(u,0,s),u===0&&g0(s)}};var b0=e.version;if(b0!=="19.2.0")throw Error(n(527,b0,"19.2.0"));_.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=h(i),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var XM={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sl.isDisabled&&sl.supportsFiber)try{os=sl.inject(XM),Wt=sl}catch{}}return vr.createRoot=function(s,i){if(!a(s))throw Error(n(299));var u=!1,f="",v=Rm,x=Tm,R=km;return i!=null&&(i.unstable_strictMode===!0&&(u=!0),i.identifierPrefix!==void 0&&(f=i.identifierPrefix),i.onUncaughtError!==void 0&&(v=i.onUncaughtError),i.onCaughtError!==void 0&&(x=i.onCaughtError),i.onRecoverableError!==void 0&&(R=i.onRecoverableError)),i=r0(s,1,!1,null,null,u,f,null,v,x,R,v0),s[rs]=i.current,pf(s),new jf(i)},vr.hydrateRoot=function(s,i,u){if(!a(s))throw Error(n(299));var f=!1,v="",x=Rm,R=Tm,D=km,z=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(v=u.identifierPrefix),u.onUncaughtError!==void 0&&(x=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&(D=u.onRecoverableError),u.formState!==void 0&&(z=u.formState)),i=r0(s,1,!0,i,u??null,f,v,z,x,R,D,v0),i.context=c0(null),u=i.current,f=Rn(),f=Xt(f),v=fa(f),v.callback=null,ha(u,v,f),u=f,i.current.lanes=u,be(i,u),ds(i),s[rs]=i.current,pf(s),new nl(i)},vr.version="19.2.0",vr}var A0;function rE(){if(A0)return Pf.exports;A0=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(e){console.error(e)}}return o(),Pf.exports=oE(),Pf.exports}var cE=rE();const lE=Th(cE);let uE={data:""},dE=o=>{if(typeof window=="object"){let e=(o?o.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(o||document.head).appendChild(e),e.firstChild}return o||uE},fE=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,hE=/\/\*[^]*?\*\/|  +/g,D0=/\n+/g,_a=(o,e)=>{let t="",n="",a="";for(let r in o){let c=o[r];r[0]=="@"?r[1]=="i"?t=r+" "+c+";":n+=r[1]=="f"?_a(c,r):r+"{"+_a(c,r[1]=="k"?"":e)+"}":typeof c=="object"?n+=_a(c,e?e.replace(/([^,])+/g,l=>r.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,l):l?l+" "+d:d)):r):c!=null&&(r=/^--/.test(r)?r:r.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=_a.p?_a.p(r,c):r+":"+c+";")}return t+(e&&a?e+"{"+a+"}":a)+n},Ks={},_v=o=>{if(typeof o=="object"){let e="";for(let t in o)e+=t+_v(o[t]);return e}return o},pE=(o,e,t,n,a)=>{let r=_v(o),c=Ks[r]||(Ks[r]=(d=>{let h=0,p=11;for(;h<d.length;)p=101*p+d.charCodeAt(h++)>>>0;return"go"+p})(r));if(!Ks[c]){let d=r!==o?o:(h=>{let p,m,y=[{}];for(;p=fE.exec(h.replace(hE,""));)p[4]?y.shift():p[3]?(m=p[3].replace(D0," ").trim(),y.unshift(y[0][m]=y[0][m]||{})):y[0][p[1]]=p[2].replace(D0," ").trim();return y[0]})(o);Ks[c]=_a(a?{["@keyframes "+c]:d}:d,t?"":"."+c)}let l=t&&Ks.g?Ks.g:null;return t&&(Ks.g=Ks[c]),((d,h,p,m)=>{m?h.data=h.data.replace(m,d):h.data.indexOf(d)===-1&&(h.data=p?d+h.data:h.data+d)})(Ks[c],e,n,l),c},gE=(o,e,t)=>o.reduce((n,a,r)=>{let c=e[r];if(c&&c.call){let l=c(t),d=l&&l.props&&l.props.className||/^go/.test(l)&&l;c=d?"."+d:l&&typeof l=="object"?l.props?"":_a(l,""):l===!1?"":l}return n+a+(c??"")},"");function ql(o){let e=this||{},t=o.call?o(e.p):o;return pE(t.unshift?t.raw?gE(t,[].slice.call(arguments,1),e.p):t.reduce((n,a)=>Object.assign(n,a&&a.call?a(e.p):a),{}):t,dE(e.target),e.g,e.o,e.k)}let jv,ih,oh;ql.bind({g:1});let ea=ql.bind({k:1});function mE(o,e,t,n){_a.p=e,jv=o,ih=t,oh=n}function Ia(o,e){let t=this||{};return function(){let n=arguments;function a(r,c){let l=Object.assign({},r),d=l.className||a.className;t.p=Object.assign({theme:ih&&ih()},l),t.o=/ *go\d+/.test(d),l.className=ql.apply(t,n)+(d?" "+d:"");let h=o;return o[0]&&(h=l.as||o,delete l.as),oh&&h[0]&&oh(l),jv(h,l)}return a}}var yE=o=>typeof o=="function",Ml=(o,e)=>yE(o)?o(e):o,vE=(()=>{let o=0;return()=>(++o).toString()})(),Lv=(()=>{let o;return()=>{if(o===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");o=!e||e.matches}return o}})(),bE=20,Dh="default",zv=(o,e)=>{let{toastLimit:t}=o.settings;switch(e.type){case 0:return{...o,toasts:[e.toast,...o.toasts].slice(0,t)};case 1:return{...o,toasts:o.toasts.map(c=>c.id===e.toast.id?{...c,...e.toast}:c)};case 2:let{toast:n}=e;return zv(o,{type:o.toasts.find(c=>c.id===n.id)?1:0,toast:n});case 3:let{toastId:a}=e;return{...o,toasts:o.toasts.map(c=>c.id===a||a===void 0?{...c,dismissed:!0,visible:!1}:c)};case 4:return e.toastId===void 0?{...o,toasts:[]}:{...o,toasts:o.toasts.filter(c=>c.id!==e.toastId)};case 5:return{...o,pausedAt:e.time};case 6:let r=e.time-(o.pausedAt||0);return{...o,pausedAt:void 0,toasts:o.toasts.map(c=>({...c,pauseDuration:c.pauseDuration+r}))}}},yl=[],Pv={toasts:[],pausedAt:void 0,settings:{toastLimit:bE}},ps={},Ov=(o,e=Dh)=>{ps[e]=zv(ps[e]||Pv,o),yl.forEach(([t,n])=>{t===e&&n(ps[e])})},Iv=o=>Object.keys(ps).forEach(e=>Ov(o,e)),xE=o=>Object.keys(ps).find(e=>ps[e].toasts.some(t=>t.id===o)),Hl=(o=Dh)=>e=>{Ov(e,o)},wE={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},SE=(o={},e=Dh)=>{let[t,n]=w.useState(ps[e]||Pv),a=w.useRef(ps[e]);w.useEffect(()=>(a.current!==ps[e]&&n(ps[e]),yl.push([e,n]),()=>{let c=yl.findIndex(([l])=>l===e);c>-1&&yl.splice(c,1)}),[e]);let r=t.toasts.map(c=>{var l,d,h;return{...o,...o[c.type],...c,removeDelay:c.removeDelay||((l=o[c.type])==null?void 0:l.removeDelay)||o?.removeDelay,duration:c.duration||((d=o[c.type])==null?void 0:d.duration)||o?.duration||wE[c.type],style:{...o.style,...(h=o[c.type])==null?void 0:h.style,...c.style}}});return{...t,toasts:r}},CE=(o,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:o,pauseDuration:0,...t,id:t?.id||vE()}),jr=o=>(e,t)=>{let n=CE(e,o,t);return Hl(n.toasterId||xE(n.id))({type:2,toast:n}),n.id},Ut=(o,e)=>jr("blank")(o,e);Ut.error=jr("error");Ut.success=jr("success");Ut.loading=jr("loading");Ut.custom=jr("custom");Ut.dismiss=(o,e)=>{let t={type:3,toastId:o};e?Hl(e)(t):Iv(t)};Ut.dismissAll=o=>Ut.dismiss(void 0,o);Ut.remove=(o,e)=>{let t={type:4,toastId:o};e?Hl(e)(t):Iv(t)};Ut.removeAll=o=>Ut.remove(void 0,o);Ut.promise=(o,e,t)=>{let n=Ut.loading(e.loading,{...t,...t?.loading});return typeof o=="function"&&(o=o()),o.then(a=>{let r=e.success?Ml(e.success,a):void 0;return r?Ut.success(r,{id:n,...t,...t?.success}):Ut.dismiss(n),a}).catch(a=>{let r=e.error?Ml(e.error,a):void 0;r?Ut.error(r,{id:n,...t,...t?.error}):Ut.dismiss(n)}),o};var ME=1e3,EE=(o,e="default")=>{let{toasts:t,pausedAt:n}=SE(o,e),a=w.useRef(new Map).current,r=w.useCallback((m,y=ME)=>{if(a.has(m))return;let b=setTimeout(()=>{a.delete(m),c({type:4,toastId:m})},y);a.set(m,b)},[]);w.useEffect(()=>{if(n)return;let m=Date.now(),y=t.map(b=>{if(b.duration===1/0)return;let S=(b.duration||0)+b.pauseDuration-(m-b.createdAt);if(S<0){b.visible&&Ut.dismiss(b.id);return}return setTimeout(()=>Ut.dismiss(b.id,e),S)});return()=>{y.forEach(b=>b&&clearTimeout(b))}},[t,n,e]);let c=w.useCallback(Hl(e),[e]),l=w.useCallback(()=>{c({type:5,time:Date.now()})},[c]),d=w.useCallback((m,y)=>{c({type:1,toast:{id:m,height:y}})},[c]),h=w.useCallback(()=>{n&&c({type:6,time:Date.now()})},[n,c]),p=w.useCallback((m,y)=>{let{reverseOrder:b=!1,gutter:S=8,defaultPosition:C}=y||{},E=t.filter(T=>(T.position||C)===(m.position||C)&&T.height),M=E.findIndex(T=>T.id===m.id),k=E.filter((T,A)=>A<M&&T.visible).length;return E.filter(T=>T.visible).slice(...b?[k+1]:[0,k]).reduce((T,A)=>T+(A.height||0)+S,0)},[t]);return w.useEffect(()=>{t.forEach(m=>{if(m.dismissed)r(m.id,m.removeDelay);else{let y=a.get(m.id);y&&(clearTimeout(y),a.delete(m.id))}})},[t,r]),{toasts:t,handlers:{updateHeight:d,startPause:l,endPause:h,calculateOffset:p}}},RE=ea`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,TE=ea`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,kE=ea`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,AE=Ia("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${o=>o.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${RE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${TE} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${o=>o.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${kE} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,DE=ea`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,NE=Ia("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${o=>o.secondary||"#e0e0e0"};
  border-right-color: ${o=>o.primary||"#616161"};
  animation: ${DE} 1s linear infinite;
`,_E=ea`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,jE=ea`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,LE=Ia("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${o=>o.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${_E} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${jE} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${o=>o.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,zE=Ia("div")`
  position: absolute;
`,PE=Ia("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,OE=ea`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,IE=Ia("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${OE} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,qE=({toast:o})=>{let{icon:e,type:t,iconTheme:n}=o;return e!==void 0?typeof e=="string"?w.createElement(IE,null,e):e:t==="blank"?null:w.createElement(PE,null,w.createElement(NE,{...n}),t!=="loading"&&w.createElement(zE,null,t==="error"?w.createElement(AE,{...n}):w.createElement(LE,{...n})))},HE=o=>`
0% {transform: translate3d(0,${o*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,BE=o=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${o*-150}%,-1px) scale(.6); opacity:0;}
`,$E="0%{opacity:0;} 100%{opacity:1;}",UE="0%{opacity:1;} 100%{opacity:0;}",QE=Ia("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,FE=Ia("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,GE=(o,e)=>{let t=o.includes("top")?1:-1,[n,a]=Lv()?[$E,UE]:[HE(t),BE(t)];return{animation:e?`${ea(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ea(a)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},VE=w.memo(({toast:o,position:e,style:t,children:n})=>{let a=o.height?GE(o.position||e||"top-center",o.visible):{opacity:0},r=w.createElement(qE,{toast:o}),c=w.createElement(FE,{...o.ariaProps},Ml(o.message,o));return w.createElement(QE,{className:o.className,style:{...a,...t,...o.style}},typeof n=="function"?n({icon:r,message:c}):w.createElement(w.Fragment,null,r,c))});mE(w.createElement);var KE=({id:o,className:e,style:t,onHeightUpdate:n,children:a})=>{let r=w.useCallback(c=>{if(c){let l=()=>{let d=c.getBoundingClientRect().height;n(o,d)};l(),new MutationObserver(l).observe(c,{subtree:!0,childList:!0,characterData:!0})}},[o,n]);return w.createElement("div",{ref:r,className:e,style:t},a)},YE=(o,e)=>{let t=o.includes("top"),n=t?{top:0}:{bottom:0},a=o.includes("center")?{justifyContent:"center"}:o.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Lv()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...n,...a}},WE=ql`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,al=16,XE=({reverseOrder:o,position:e="top-center",toastOptions:t,gutter:n,children:a,toasterId:r,containerStyle:c,containerClassName:l})=>{let{toasts:d,handlers:h}=EE(t,r);return w.createElement("div",{"data-rht-toaster":r||"",style:{position:"fixed",zIndex:9999,top:al,left:al,right:al,bottom:al,pointerEvents:"none",...c},className:l,onMouseEnter:h.startPause,onMouseLeave:h.endPause},d.map(p=>{let m=p.position||e,y=h.calculateOffset(p,{reverseOrder:o,gutter:n,defaultPosition:e}),b=YE(m,y);return w.createElement(KE,{id:p.id,key:p.id,onHeightUpdate:h.updateHeight,className:p.visible?WE:"",style:b},p.type==="custom"?Ml(p.message,p):a?a(p):w.createElement(VE,{toast:p,position:m}))}))},CO=Ut;function N0(o,e){if(typeof o=="function")return o(e);o!=null&&(o.current=e)}function Ss(...o){return e=>{let t=!1;const n=o.map(a=>{const r=N0(a,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let a=0;a<n.length;a++){const r=n[a];typeof r=="function"?r():N0(o[a],null)}}}}function _e(...o){return w.useCallback(Ss(...o),o)}var ZE=Symbol.for("react.lazy"),El=Ah[" use ".trim().toString()];function JE(o){return typeof o=="object"&&o!==null&&"then"in o}function qv(o){return o!=null&&typeof o=="object"&&"$$typeof"in o&&o.$$typeof===ZE&&"_payload"in o&&JE(o._payload)}function Nh(o){const e=tR(o),t=w.forwardRef((n,a)=>{let{children:r,...c}=n;qv(r)&&typeof El=="function"&&(r=El(r._payload));const l=w.Children.toArray(r),d=l.find(sR);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}var eR=Nh("Slot");function tR(o){const e=w.forwardRef((t,n)=>{let{children:a,...r}=t;if(qv(a)&&typeof El=="function"&&(a=El(a._payload)),w.isValidElement(a)){const c=iR(a),l=aR(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var nR=Symbol("radix.slottable");function sR(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===nR}function aR(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function iR(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function Hv(o){var e,t,n="";if(typeof o=="string"||typeof o=="number")n+=o;else if(typeof o=="object")if(Array.isArray(o)){var a=o.length;for(e=0;e<a;e++)o[e]&&(t=Hv(o[e]))&&(n&&(n+=" "),n+=t)}else for(t in o)o[t]&&(n&&(n+=" "),n+=t);return n}function Bv(){for(var o,e,t=0,n="",a=arguments.length;t<a;t++)(o=arguments[t])&&(e=Hv(o))&&(n&&(n+=" "),n+=e);return n}const _0=o=>typeof o=="boolean"?`${o}`:o===0?"0":o,j0=Bv,_h=(o,e)=>t=>{var n;if(e?.variants==null)return j0(o,t?.class,t?.className);const{variants:a,defaultVariants:r}=e,c=Object.keys(a).map(h=>{const p=t?.[h],m=r?.[h];if(p===null)return null;const y=_0(p)||_0(m);return a[h][y]}),l=t&&Object.entries(t).reduce((h,p)=>{let[m,y]=p;return y===void 0||(h[m]=y),h},{}),d=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((h,p)=>{let{class:m,className:y,...b}=p;return Object.entries(b).every(S=>{let[C,E]=S;return Array.isArray(E)?E.includes({...r,...l}[C]):{...r,...l}[C]===E})?[...h,m,y]:h},[]);return j0(o,c,d,t?.class,t?.className)},oR=(o,e)=>{const t=new Array(o.length+e.length);for(let n=0;n<o.length;n++)t[n]=o[n];for(let n=0;n<e.length;n++)t[o.length+n]=e[n];return t},rR=(o,e)=>({classGroupId:o,validator:e}),$v=(o=new Map,e=null,t)=>({nextPart:o,validators:e,classGroupId:t}),Rl="-",L0=[],cR="arbitrary..",lR=o=>{const e=dR(o),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=o;return{getClassGroupId:c=>{if(c.startsWith("[")&&c.endsWith("]"))return uR(c);const l=c.split(Rl),d=l[0]===""&&l.length>1?1:0;return Uv(l,d,e)},getConflictingClassGroupIds:(c,l)=>{if(l){const d=n[c],h=t[c];return d?h?oR(h,d):d:h||L0}return t[c]||L0}}},Uv=(o,e,t)=>{if(o.length-e===0)return t.classGroupId;const a=o[e],r=t.nextPart.get(a);if(r){const h=Uv(o,e+1,r);if(h)return h}const c=t.validators;if(c===null)return;const l=e===0?o.join(Rl):o.slice(e).join(Rl),d=c.length;for(let h=0;h<d;h++){const p=c[h];if(p.validator(l))return p.classGroupId}},uR=o=>o.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=o.slice(1,-1),t=e.indexOf(":"),n=e.slice(0,t);return n?cR+n:void 0})(),dR=o=>{const{theme:e,classGroups:t}=o;return fR(t,e)},fR=(o,e)=>{const t=$v();for(const n in o){const a=o[n];jh(a,t,n,e)}return t},jh=(o,e,t,n)=>{const a=o.length;for(let r=0;r<a;r++){const c=o[r];hR(c,e,t,n)}},hR=(o,e,t,n)=>{if(typeof o=="string"){pR(o,e,t);return}if(typeof o=="function"){gR(o,e,t,n);return}mR(o,e,t,n)},pR=(o,e,t)=>{const n=o===""?e:Qv(e,o);n.classGroupId=t},gR=(o,e,t,n)=>{if(yR(o)){jh(o(n),e,t,n);return}e.validators===null&&(e.validators=[]),e.validators.push(rR(t,o))},mR=(o,e,t,n)=>{const a=Object.entries(o),r=a.length;for(let c=0;c<r;c++){const[l,d]=a[c];jh(d,Qv(e,l),t,n)}},Qv=(o,e)=>{let t=o;const n=e.split(Rl),a=n.length;for(let r=0;r<a;r++){const c=n[r];let l=t.nextPart.get(c);l||(l=$v(),t.nextPart.set(c,l)),t=l}return t},yR=o=>"isThemeGetter"in o&&o.isThemeGetter===!0,vR=o=>{if(o<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),n=Object.create(null);const a=(r,c)=>{t[r]=c,e++,e>o&&(e=0,n=t,t=Object.create(null))};return{get(r){let c=t[r];if(c!==void 0)return c;if((c=n[r])!==void 0)return a(r,c),c},set(r,c){r in t?t[r]=c:a(r,c)}}},rh="!",z0=":",bR=[],P0=(o,e,t,n,a)=>({modifiers:o,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:n,isExternal:a}),xR=o=>{const{prefix:e,experimentalParseClassName:t}=o;let n=a=>{const r=[];let c=0,l=0,d=0,h;const p=a.length;for(let C=0;C<p;C++){const E=a[C];if(c===0&&l===0){if(E===z0){r.push(a.slice(d,C)),d=C+1;continue}if(E==="/"){h=C;continue}}E==="["?c++:E==="]"?c--:E==="("?l++:E===")"&&l--}const m=r.length===0?a:a.slice(d);let y=m,b=!1;m.endsWith(rh)?(y=m.slice(0,-1),b=!0):m.startsWith(rh)&&(y=m.slice(1),b=!0);const S=h&&h>d?h-d:void 0;return P0(r,b,y,S)};if(e){const a=e+z0,r=n;n=c=>c.startsWith(a)?r(c.slice(a.length)):P0(bR,!1,c,void 0,!0)}if(t){const a=n;n=r=>t({className:r,parseClassName:a})}return n},wR=o=>{const e=new Map;return o.orderSensitiveModifiers.forEach((t,n)=>{e.set(t,1e6+n)}),t=>{const n=[];let a=[];for(let r=0;r<t.length;r++){const c=t[r],l=c[0]==="[",d=e.has(c);l||d?(a.length>0&&(a.sort(),n.push(...a),a=[]),n.push(c)):a.push(c)}return a.length>0&&(a.sort(),n.push(...a)),n}},SR=o=>({cache:vR(o.cacheSize),parseClassName:xR(o),sortModifiers:wR(o),...lR(o)}),CR=/\s+/,MR=(o,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:a,sortModifiers:r}=e,c=[],l=o.trim().split(CR);let d="";for(let h=l.length-1;h>=0;h-=1){const p=l[h],{isExternal:m,modifiers:y,hasImportantModifier:b,baseClassName:S,maybePostfixModifierPosition:C}=t(p);if(m){d=p+(d.length>0?" "+d:d);continue}let E=!!C,M=n(E?S.substring(0,C):S);if(!M){if(!E){d=p+(d.length>0?" "+d:d);continue}if(M=n(S),!M){d=p+(d.length>0?" "+d:d);continue}E=!1}const k=y.length===0?"":y.length===1?y[0]:r(y).join(":"),T=b?k+rh:k,A=T+M;if(c.indexOf(A)>-1)continue;c.push(A);const N=a(M,E);for(let q=0;q<N.length;++q){const O=N[q];c.push(T+O)}d=p+(d.length>0?" "+d:d)}return d},ER=(...o)=>{let e=0,t,n,a="";for(;e<o.length;)(t=o[e++])&&(n=Fv(t))&&(a&&(a+=" "),a+=n);return a},Fv=o=>{if(typeof o=="string")return o;let e,t="";for(let n=0;n<o.length;n++)o[n]&&(e=Fv(o[n]))&&(t&&(t+=" "),t+=e);return t},RR=(o,...e)=>{let t,n,a,r;const c=d=>{const h=e.reduce((p,m)=>m(p),o());return t=SR(h),n=t.cache.get,a=t.cache.set,r=l,l(d)},l=d=>{const h=n(d);if(h)return h;const p=MR(d,t);return a(d,p),p};return r=c,(...d)=>r(ER(...d))},TR=[],$t=o=>{const e=t=>t[o]||TR;return e.isThemeGetter=!0,e},Gv=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Vv=/^\((?:(\w[\w-]*):)?(.+)\)$/i,kR=/^\d+\/\d+$/,AR=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,DR=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,NR=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,_R=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,jR=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ao=o=>kR.test(o),He=o=>!!o&&!Number.isNaN(Number(o)),Aa=o=>!!o&&Number.isInteger(Number(o)),Hf=o=>o.endsWith("%")&&He(o.slice(0,-1)),Ys=o=>AR.test(o),LR=()=>!0,zR=o=>DR.test(o)&&!NR.test(o),Kv=()=>!1,PR=o=>_R.test(o),OR=o=>jR.test(o),IR=o=>!we(o)&&!Se(o),qR=o=>xo(o,Xv,Kv),we=o=>Gv.test(o),ci=o=>xo(o,Zv,zR),Bf=o=>xo(o,QR,He),O0=o=>xo(o,Yv,Kv),HR=o=>xo(o,Wv,OR),il=o=>xo(o,Jv,PR),Se=o=>Vv.test(o),br=o=>wo(o,Zv),BR=o=>wo(o,FR),I0=o=>wo(o,Yv),$R=o=>wo(o,Xv),UR=o=>wo(o,Wv),ol=o=>wo(o,Jv,!0),xo=(o,e,t)=>{const n=Gv.exec(o);return n?n[1]?e(n[1]):t(n[2]):!1},wo=(o,e,t=!1)=>{const n=Vv.exec(o);return n?n[1]?e(n[1]):t:!1},Yv=o=>o==="position"||o==="percentage",Wv=o=>o==="image"||o==="url",Xv=o=>o==="length"||o==="size"||o==="bg-size",Zv=o=>o==="length",QR=o=>o==="number",FR=o=>o==="family-name",Jv=o=>o==="shadow",GR=()=>{const o=$t("color"),e=$t("font"),t=$t("text"),n=$t("font-weight"),a=$t("tracking"),r=$t("leading"),c=$t("breakpoint"),l=$t("container"),d=$t("spacing"),h=$t("radius"),p=$t("shadow"),m=$t("inset-shadow"),y=$t("text-shadow"),b=$t("drop-shadow"),S=$t("blur"),C=$t("perspective"),E=$t("aspect"),M=$t("ease"),k=$t("animate"),T=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],N=()=>[...A(),Se,we],q=()=>["auto","hidden","clip","visible","scroll"],O=()=>["auto","contain","none"],H=()=>[Se,we,d],J=()=>[ao,"full","auto",...H()],se=()=>[Aa,"none","subgrid",Se,we],ce=()=>["auto",{span:["full",Aa,Se,we]},Aa,Se,we],Z=()=>[Aa,"auto",Se,we],te=()=>["auto","min","max","fr",Se,we],le=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],ue=()=>["start","end","center","stretch","center-safe","end-safe"],L=()=>["auto",...H()],_=()=>[ao,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...H()],P=()=>[o,Se,we],W=()=>[...A(),I0,O0,{position:[Se,we]}],he=()=>["no-repeat",{repeat:["","x","y","space","round"]}],j=()=>["auto","cover","contain",$R,qR,{size:[Se,we]}],Q=()=>[Hf,br,ci],Y=()=>["","none","full",h,Se,we],ae=()=>["",He,br,ci],U=()=>["solid","dashed","dotted","double"],ie=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$=()=>[He,Hf,I0,O0],V=()=>["","none",S,Se,we],pe=()=>["none",He,Se,we],me=()=>["none",He,Se,we],ye=()=>[He,Se,we],ve=()=>[ao,"full",...H()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ys],breakpoint:[Ys],color:[LR],container:[Ys],"drop-shadow":[Ys],ease:["in","out","in-out"],font:[IR],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ys],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ys],shadow:[Ys],spacing:["px",He],text:[Ys],"text-shadow":[Ys],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",ao,we,Se,E]}],container:["container"],columns:[{columns:[He,we,Se,l]}],"break-after":[{"break-after":T()}],"break-before":[{"break-before":T()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:N()}],overflow:[{overflow:q()}],"overflow-x":[{"overflow-x":q()}],"overflow-y":[{"overflow-y":q()}],overscroll:[{overscroll:O()}],"overscroll-x":[{"overscroll-x":O()}],"overscroll-y":[{"overscroll-y":O()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:J()}],"inset-x":[{"inset-x":J()}],"inset-y":[{"inset-y":J()}],start:[{start:J()}],end:[{end:J()}],top:[{top:J()}],right:[{right:J()}],bottom:[{bottom:J()}],left:[{left:J()}],visibility:["visible","invisible","collapse"],z:[{z:[Aa,"auto",Se,we]}],basis:[{basis:[ao,"full","auto",l,...H()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[He,ao,"auto","initial","none",we]}],grow:[{grow:["",He,Se,we]}],shrink:[{shrink:["",He,Se,we]}],order:[{order:[Aa,"first","last","none",Se,we]}],"grid-cols":[{"grid-cols":se()}],"col-start-end":[{col:ce()}],"col-start":[{"col-start":Z()}],"col-end":[{"col-end":Z()}],"grid-rows":[{"grid-rows":se()}],"row-start-end":[{row:ce()}],"row-start":[{"row-start":Z()}],"row-end":[{"row-end":Z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":te()}],"auto-rows":[{"auto-rows":te()}],gap:[{gap:H()}],"gap-x":[{"gap-x":H()}],"gap-y":[{"gap-y":H()}],"justify-content":[{justify:[...le(),"normal"]}],"justify-items":[{"justify-items":[...ue(),"normal"]}],"justify-self":[{"justify-self":["auto",...ue()]}],"align-content":[{content:["normal",...le()]}],"align-items":[{items:[...ue(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...ue(),{baseline:["","last"]}]}],"place-content":[{"place-content":le()}],"place-items":[{"place-items":[...ue(),"baseline"]}],"place-self":[{"place-self":["auto",...ue()]}],p:[{p:H()}],px:[{px:H()}],py:[{py:H()}],ps:[{ps:H()}],pe:[{pe:H()}],pt:[{pt:H()}],pr:[{pr:H()}],pb:[{pb:H()}],pl:[{pl:H()}],m:[{m:L()}],mx:[{mx:L()}],my:[{my:L()}],ms:[{ms:L()}],me:[{me:L()}],mt:[{mt:L()}],mr:[{mr:L()}],mb:[{mb:L()}],ml:[{ml:L()}],"space-x":[{"space-x":H()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":H()}],"space-y-reverse":["space-y-reverse"],size:[{size:_()}],w:[{w:[l,"screen",..._()]}],"min-w":[{"min-w":[l,"screen","none",..._()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[c]},..._()]}],h:[{h:["screen","lh",..._()]}],"min-h":[{"min-h":["screen","lh","none",..._()]}],"max-h":[{"max-h":["screen","lh",..._()]}],"font-size":[{text:["base",t,br,ci]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,Se,Bf]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Hf,we]}],"font-family":[{font:[BR,we,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,Se,we]}],"line-clamp":[{"line-clamp":[He,"none",Se,Bf]}],leading:[{leading:[r,...H()]}],"list-image":[{"list-image":["none",Se,we]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Se,we]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:P()}],"text-color":[{text:P()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[He,"from-font","auto",Se,ci]}],"text-decoration-color":[{decoration:P()}],"underline-offset":[{"underline-offset":[He,"auto",Se,we]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:H()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Se,we]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Se,we]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:W()}],"bg-repeat":[{bg:he()}],"bg-size":[{bg:j()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Aa,Se,we],radial:["",Se,we],conic:[Aa,Se,we]},UR,HR]}],"bg-color":[{bg:P()}],"gradient-from-pos":[{from:Q()}],"gradient-via-pos":[{via:Q()}],"gradient-to-pos":[{to:Q()}],"gradient-from":[{from:P()}],"gradient-via":[{via:P()}],"gradient-to":[{to:P()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:ae()}],"border-w-x":[{"border-x":ae()}],"border-w-y":[{"border-y":ae()}],"border-w-s":[{"border-s":ae()}],"border-w-e":[{"border-e":ae()}],"border-w-t":[{"border-t":ae()}],"border-w-r":[{"border-r":ae()}],"border-w-b":[{"border-b":ae()}],"border-w-l":[{"border-l":ae()}],"divide-x":[{"divide-x":ae()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ae()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:P()}],"border-color-x":[{"border-x":P()}],"border-color-y":[{"border-y":P()}],"border-color-s":[{"border-s":P()}],"border-color-e":[{"border-e":P()}],"border-color-t":[{"border-t":P()}],"border-color-r":[{"border-r":P()}],"border-color-b":[{"border-b":P()}],"border-color-l":[{"border-l":P()}],"divide-color":[{divide:P()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[He,Se,we]}],"outline-w":[{outline:["",He,br,ci]}],"outline-color":[{outline:P()}],shadow:[{shadow:["","none",p,ol,il]}],"shadow-color":[{shadow:P()}],"inset-shadow":[{"inset-shadow":["none",m,ol,il]}],"inset-shadow-color":[{"inset-shadow":P()}],"ring-w":[{ring:ae()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:P()}],"ring-offset-w":[{"ring-offset":[He,ci]}],"ring-offset-color":[{"ring-offset":P()}],"inset-ring-w":[{"inset-ring":ae()}],"inset-ring-color":[{"inset-ring":P()}],"text-shadow":[{"text-shadow":["none",y,ol,il]}],"text-shadow-color":[{"text-shadow":P()}],opacity:[{opacity:[He,Se,we]}],"mix-blend":[{"mix-blend":[...ie(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ie()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[He]}],"mask-image-linear-from-pos":[{"mask-linear-from":$()}],"mask-image-linear-to-pos":[{"mask-linear-to":$()}],"mask-image-linear-from-color":[{"mask-linear-from":P()}],"mask-image-linear-to-color":[{"mask-linear-to":P()}],"mask-image-t-from-pos":[{"mask-t-from":$()}],"mask-image-t-to-pos":[{"mask-t-to":$()}],"mask-image-t-from-color":[{"mask-t-from":P()}],"mask-image-t-to-color":[{"mask-t-to":P()}],"mask-image-r-from-pos":[{"mask-r-from":$()}],"mask-image-r-to-pos":[{"mask-r-to":$()}],"mask-image-r-from-color":[{"mask-r-from":P()}],"mask-image-r-to-color":[{"mask-r-to":P()}],"mask-image-b-from-pos":[{"mask-b-from":$()}],"mask-image-b-to-pos":[{"mask-b-to":$()}],"mask-image-b-from-color":[{"mask-b-from":P()}],"mask-image-b-to-color":[{"mask-b-to":P()}],"mask-image-l-from-pos":[{"mask-l-from":$()}],"mask-image-l-to-pos":[{"mask-l-to":$()}],"mask-image-l-from-color":[{"mask-l-from":P()}],"mask-image-l-to-color":[{"mask-l-to":P()}],"mask-image-x-from-pos":[{"mask-x-from":$()}],"mask-image-x-to-pos":[{"mask-x-to":$()}],"mask-image-x-from-color":[{"mask-x-from":P()}],"mask-image-x-to-color":[{"mask-x-to":P()}],"mask-image-y-from-pos":[{"mask-y-from":$()}],"mask-image-y-to-pos":[{"mask-y-to":$()}],"mask-image-y-from-color":[{"mask-y-from":P()}],"mask-image-y-to-color":[{"mask-y-to":P()}],"mask-image-radial":[{"mask-radial":[Se,we]}],"mask-image-radial-from-pos":[{"mask-radial-from":$()}],"mask-image-radial-to-pos":[{"mask-radial-to":$()}],"mask-image-radial-from-color":[{"mask-radial-from":P()}],"mask-image-radial-to-color":[{"mask-radial-to":P()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":A()}],"mask-image-conic-pos":[{"mask-conic":[He]}],"mask-image-conic-from-pos":[{"mask-conic-from":$()}],"mask-image-conic-to-pos":[{"mask-conic-to":$()}],"mask-image-conic-from-color":[{"mask-conic-from":P()}],"mask-image-conic-to-color":[{"mask-conic-to":P()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:W()}],"mask-repeat":[{mask:he()}],"mask-size":[{mask:j()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Se,we]}],filter:[{filter:["","none",Se,we]}],blur:[{blur:V()}],brightness:[{brightness:[He,Se,we]}],contrast:[{contrast:[He,Se,we]}],"drop-shadow":[{"drop-shadow":["","none",b,ol,il]}],"drop-shadow-color":[{"drop-shadow":P()}],grayscale:[{grayscale:["",He,Se,we]}],"hue-rotate":[{"hue-rotate":[He,Se,we]}],invert:[{invert:["",He,Se,we]}],saturate:[{saturate:[He,Se,we]}],sepia:[{sepia:["",He,Se,we]}],"backdrop-filter":[{"backdrop-filter":["","none",Se,we]}],"backdrop-blur":[{"backdrop-blur":V()}],"backdrop-brightness":[{"backdrop-brightness":[He,Se,we]}],"backdrop-contrast":[{"backdrop-contrast":[He,Se,we]}],"backdrop-grayscale":[{"backdrop-grayscale":["",He,Se,we]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[He,Se,we]}],"backdrop-invert":[{"backdrop-invert":["",He,Se,we]}],"backdrop-opacity":[{"backdrop-opacity":[He,Se,we]}],"backdrop-saturate":[{"backdrop-saturate":[He,Se,we]}],"backdrop-sepia":[{"backdrop-sepia":["",He,Se,we]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":H()}],"border-spacing-x":[{"border-spacing-x":H()}],"border-spacing-y":[{"border-spacing-y":H()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Se,we]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[He,"initial",Se,we]}],ease:[{ease:["linear","initial",M,Se,we]}],delay:[{delay:[He,Se,we]}],animate:[{animate:["none",k,Se,we]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[C,Se,we]}],"perspective-origin":[{"perspective-origin":N()}],rotate:[{rotate:pe()}],"rotate-x":[{"rotate-x":pe()}],"rotate-y":[{"rotate-y":pe()}],"rotate-z":[{"rotate-z":pe()}],scale:[{scale:me()}],"scale-x":[{"scale-x":me()}],"scale-y":[{"scale-y":me()}],"scale-z":[{"scale-z":me()}],"scale-3d":["scale-3d"],skew:[{skew:ye()}],"skew-x":[{"skew-x":ye()}],"skew-y":[{"skew-y":ye()}],transform:[{transform:[Se,we,"","none","gpu","cpu"]}],"transform-origin":[{origin:N()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ve()}],"translate-x":[{"translate-x":ve()}],"translate-y":[{"translate-y":ve()}],"translate-z":[{"translate-z":ve()}],"translate-none":["translate-none"],accent:[{accent:P()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:P()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Se,we]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":H()}],"scroll-mx":[{"scroll-mx":H()}],"scroll-my":[{"scroll-my":H()}],"scroll-ms":[{"scroll-ms":H()}],"scroll-me":[{"scroll-me":H()}],"scroll-mt":[{"scroll-mt":H()}],"scroll-mr":[{"scroll-mr":H()}],"scroll-mb":[{"scroll-mb":H()}],"scroll-ml":[{"scroll-ml":H()}],"scroll-p":[{"scroll-p":H()}],"scroll-px":[{"scroll-px":H()}],"scroll-py":[{"scroll-py":H()}],"scroll-ps":[{"scroll-ps":H()}],"scroll-pe":[{"scroll-pe":H()}],"scroll-pt":[{"scroll-pt":H()}],"scroll-pr":[{"scroll-pr":H()}],"scroll-pb":[{"scroll-pb":H()}],"scroll-pl":[{"scroll-pl":H()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Se,we]}],fill:[{fill:["none",...P()]}],"stroke-w":[{stroke:[He,br,ci,Bf]}],stroke:[{stroke:["none",...P()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},VR=RR(GR);function Ee(...o){return VR(Bv(o))}function MO(o,e){return o?{...e,...o}:e}const Lh=_h("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ae=w.forwardRef(({className:o,variant:e,size:t,asChild:n=!1,...a},r)=>{const c=n?eR:"button";return g.jsx(c,{className:Ee(Lh({variant:e,size:t,className:o})),ref:r,...a})});Ae.displayName="Button";var Lr=Nv();const KR=Th(Lr);var YR=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],WR=YR.reduce((o,e)=>{const t=Nh(`Primitive.${e}`),n=w.forwardRef((a,r)=>{const{asChild:c,...l}=a,d=c?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:r})});return n.displayName=`Primitive.${e}`,{...o,[e]:n}},{}),XR="Separator",q0="horizontal",ZR=["horizontal","vertical"],eb=w.forwardRef((o,e)=>{const{decorative:t,orientation:n=q0,...a}=o,r=JR(n)?n:q0,l=t?{role:"none"}:{"aria-orientation":r==="vertical"?r:void 0,role:"separator"};return g.jsx(WR.div,{"data-orientation":r,...l,...a,ref:e})});eb.displayName=XR;function JR(o){return ZR.includes(o)}var tb=eb;const vn=w.forwardRef(({className:o,orientation:e="horizontal",decorative:t=!0,...n},a)=>g.jsx(tb,{ref:a,decorative:t,orientation:e,className:Ee("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",o),...n}));vn.displayName=tb.displayName;const H0=o=>{let e;const t=new Set,n=(h,p)=>{const m=typeof h=="function"?h(e):h;if(!Object.is(m,e)){const y=e;e=p??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(b=>b(e,y))}},a=()=>e,l={setState:n,getState:a,getInitialState:()=>d,subscribe:h=>(t.add(h),()=>t.delete(h))},d=e=o(n,a,l);return l},eT=(o=>o?H0(o):H0),tT=o=>o;function nT(o,e=tT){const t=Et.useSyncExternalStore(o.subscribe,Et.useCallback(()=>e(o.getState()),[o,e]),Et.useCallback(()=>e(o.getInitialState()),[o,e]));return Et.useDebugValue(t),t}const B0=o=>{const e=eT(o),t=n=>nT(e,n);return Object.assign(t,e),t},Cs=(o=>o?B0(o):B0);class sT{nodes=[];connections=[];handlers=new Map;postgresQueryEngine=null;messageQueue=new Map;messageHistory=[];isRunning=!1;updateInterval=200;intervalId=null;messageIdCounter=0;MAX_HISTORY=1e3;traceContexts=new Map;traceIdCounter=0;constructor(){this.registerDefaultHandlers()}registerDefaultHandlers(){this.registerHandler("crm",this.createBusinessDataHandler("crm")),this.registerHandler("erp",this.createBusinessDataHandler("erp")),this.registerHandler("payment-gateway",this.createBusinessDataHandler("payment")),this.registerHandler("postgres",this.createDatabaseHandler("postgres")),this.registerHandler("mongodb",this.createDatabaseHandler("mongodb")),this.registerHandler("redis",this.createDatabaseHandler("redis")),this.registerHandler("cassandra",this.createDatabaseHandler("cassandra")),this.registerHandler("clickhouse",this.createDatabaseHandler("clickhouse")),this.registerHandler("snowflake",this.createDatabaseHandler("snowflake")),this.registerHandler("elasticsearch",this.createDatabaseHandler("elasticsearch")),this.registerHandler("s3-datalake",this.createStorageHandler("s3-datalake")),this.registerHandler("kafka",this.createMessageBrokerHandler("kafka")),this.registerHandler("rabbitmq",this.createMessageBrokerHandler("rabbitmq")),this.registerHandler("activemq",this.createMessageBrokerHandler("activemq")),this.registerHandler("aws-sqs",this.createMessageBrokerHandler("aws-sqs")),this.registerHandler("gcp-pubsub",this.createMessageBrokerHandler("gcp-pubsub")),this.registerHandler("rest",this.createAPIHandler("rest")),this.registerHandler("grpc",this.createAPIHandler("grpc")),this.registerHandler("graphql",this.createAPIHandler("graphql")),this.registerHandler("websocket",this.createAPIHandler("websocket")),this.registerHandler("kong",this.createIntegrationHandler("kong")),this.registerHandler("apigee",this.createIntegrationHandler("apigee")),this.registerHandler("mulesoft",this.createIntegrationHandler("mulesoft")),this.registerHandler("graphql-gateway",this.createIntegrationHandler("graphql-gateway")),this.registerHandler("bff-service",this.createIntegrationHandler("bff-service")),this.registerHandler("webhook-relay",this.createIntegrationHandler("webhook-relay")),this.registerHandler("loki",this.createLokiHandler()),this.registerHandler("otel-collector",this.createOpenTelemetryCollectorHandler()),this.registerHandler("keycloak",this.createKeycloakHandler()),this.registerHandler("secrets-vault",this.createVaultHandler()),this.registerHandler("waf",this.createWAFHandler()),this.registerHandler("firewall",this.createFirewallHandler()),this.registerHandler("ids-ips",this.createIDSIPSHandler()),this.registerHandler("jenkins",this.createJenkinsHandler())}registerHandler(e,t){this.handlers.set(e,t)}initialize(e,t){this.nodes=e,this.connections=t,this.messageQueue.clear(),this.messageHistory=[];for(const n of t)this.messageQueue.set(n.id,[])}updateNodesAndConnections(e,t){this.nodes=e,this.connections=t;const n=new Set(t.map(a=>a.id));for(const[a]of this.messageQueue.entries())n.has(a)||this.messageQueue.delete(a);for(const a of t)this.messageQueue.has(a.id)||this.messageQueue.set(a.id,[])}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.processDataFlow()},this.updateInterval))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}processDataFlow(){this.generateSourceData(),this.processInTransitMessages(),this.deliverMessages()}generateSourceData(){for(const e of this.connections){const t=this.nodes.find(c=>c.id===e.source);if(!t)continue;const n=this.handlers.get(t.type);if(!n?.generateData)continue;const a=t.data.config||{},r=n.generateData(t,a);if(r&&r.length>0){const c=this.messageQueue.get(e.id)||[];for(const l of r)l.connectionId=e.id,l.target=e.target,l.status="pending",l.id=`msg-${++this.messageIdCounter}`,l.timestamp=Date.now(),c.push(l);this.messageQueue.set(e.id,c)}}}processInTransitMessages(){for(const[e,t]of this.messageQueue.entries()){const n=this.connections.find(c=>c.id===e);if(!n)continue;const a=this.nodes.find(c=>c.id===n.source),r=this.nodes.find(c=>c.id===n.target);if(!(!a||!r)){for(const c of t)if(c.status==="pending")this.transformMessageIfNeeded(c,a,r,n)&&(c.status="in-transit",c.latency=this.calculateTransitTime(n));else if(c.status==="in-transit"){const l=Date.now()-c.timestamp;c.latency&&l>=c.latency&&(c.status="delivered")}}}}deliverMessages(){for(const[e,t]of this.messageQueue.entries()){const n=this.connections.find(d=>d.id===e);if(!n)continue;const a=this.nodes.find(d=>d.id===n.target);if(!a)continue;const r=this.handlers.get(a.type);if(!r?.processData)continue;const c=a.data.config||{},l=t.filter(d=>d.status==="delivered");for(const d of l)try{const h=this.nodes.find(m=>m.id===n.source),p=r.processData(a,d,c);p&&(h&&this.generateTraceForMessage(d,h,a,n,p),this.addToHistory(d),t.splice(t.indexOf(d),1))}catch(h){d.status="failed",d.error=h instanceof Error?h.message:"Unknown error";const p=this.nodes.find(m=>m.id===n.source);p&&this.generateTraceForMessage(d,p,a,n,d),this.addToHistory(d),t.splice(t.indexOf(d),1)}this.messageQueue.set(e,t)}}transformMessageIfNeeded(e,t,n,a){const r=this.handlers.get(t.type),c=this.handlers.get(n.type),l=r?.getSupportedFormats?.(t)||[e.format],d=c?.getSupportedFormats?.(n)||[e.format];if(d.includes(e.format))return e;const h=d.find(m=>l.includes(m));if(h)return e.format=h,e.status="transformed",e;const p=this.findIntegrationHandler(a);if(p?.transformData){const m=p.transformData(t,e,n.type,t.data.config||{});if(m)return m}if(r?.transformData){const m=r.transformData(t,e,n.type,t.data.config||{});if(m)return m}return e.status="failed",e.error=`Format ${e.format} not supported by target ${n.type}`,null}findIntegrationHandler(e){const t=this.nodes.find(n=>n.id===e.source);return t&&["kong","apigee","mulesoft","bff-service"].includes(t.type)&&this.handlers.get(t.type)||null}calculateTransitTime(e){const t=e.data||{},n=t.latencyMs||10,a=(t.jitterMs||0)*(Math.random()-.5);return Math.max(1,n+a)}generateTraceForMessage(e,t,n,a,r){const c=je.getAllJaegerEngines();if(c.size===0)return;let l=e.metadata?.traceContext;if(!l){const b=this.generateTraceId(),S=this.generateSpanId();l={traceId:b,spanId:S,sampled:!0},this.traceContexts.set(b,l)}const d=e.timestamp*1e3,h=(e.timestamp+(e.latency||0))*1e3,p=h-d,m=this.getOperationName(e,t,n),y={traceId:l.traceId,spanId:l.spanId,parentSpanId:l.parentSpanId,operationName:m,serviceName:t.data.label||t.type,startTime:d,duration:p,tags:[{key:"component.type",value:t.type},{key:"target.component",value:n.data.label||n.type},{key:"target.type",value:n.type},{key:"message.format",value:e.format},{key:"message.size",value:e.size},{key:"connection.id",value:a.id},{key:"status",value:r.status}],logs:[]};if((r.status==="failed"||r.error)&&(y.tags.push({key:"error",value:!0}),y.logs.push({timestamp:h,fields:[{key:"event",value:"error"},{key:"error.message",value:r.error||"Unknown error"}]})),e.metadata)for(const[b,S]of Object.entries(e.metadata))b!=="traceContext"&&S!==void 0&&S!==null&&y.tags.push({key:`metadata.${b}`,value:String(S)});for(const[,b]of c)b.receiveSpan(y);if(r.status==="delivered"&&n){const b=this.generateSpanId(),S={traceId:l.traceId,spanId:b,parentSpanId:l.spanId,sampled:l.sampled};r.metadata||(r.metadata={}),r.metadata.traceContext=S}}generateTraceId(){return`trace-${++this.traceIdCounter}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getOperationName(e,t,n){return e.metadata?.operation?String(e.metadata.operation):t.type==="api-gateway"||t.type==="kong"||t.type==="apigee"?`HTTP ${e.metadata?.method||"REQUEST"}`:t.type.includes("database")||t.type==="postgres"||t.type==="mongodb"?`DB ${e.metadata?.queryType||"QUERY"}`:t.type.includes("queue")||t.type==="rabbitmq"||t.type==="kafka"?`MQ ${e.metadata?.queue||"SEND"}`:`${t.type} -> ${n.type}`}addToHistory(e){this.messageHistory.push(e),this.messageHistory.length>this.MAX_HISTORY&&this.messageHistory.shift()}getConnectionMessages(e){return this.messageQueue.get(e)||[]}getMessageHistory(e){const t=[...this.messageHistory].reverse();return e?t.slice(0,e):t}getComponentMessages(e){const t=[];for(const n of this.messageQueue.values())for(const a of n)(a.source===e||a.target===e)&&t.push(a);return t}createBusinessDataHandler(e){return{generateData:(t,n)=>{const a=[],r=n.generateInterval||2e3,c=t._lastGenerate||0,l=Date.now();if(l-c<r)return null;switch(t._lastGenerate=l,e){case"crm":a.push(this.createCRMDataMessage(t));break;case"erp":a.push(this.createERPDataMessage(t));break;case"payment":a.push(this.createPaymentDataMessage(t));break}return a},getSupportedFormats:()=>["json","xml"]}}validateMongoDBSchema(e,t){if(!t||!t.$jsonSchema)return{valid:!0};const n=t.$jsonSchema;if(n.required&&Array.isArray(n.required)){for(const a of n.required)if(!(a in e)||e[a]===void 0||e[a]===null)return{valid:!1,error:`Required field "${a}" is missing`}}if(n.properties){for(const[a,r]of Object.entries(n.properties))if(a in e){const c=e[a],l=r;if(l.type){const d=l.type,h=Array.isArray(c)?"array":typeof c;if(d==="string"&&h!=="string")return{valid:!1,error:`Field "${a}" must be of type string`};if(d==="number"&&h!=="number")return{valid:!1,error:`Field "${a}" must be of type number`};if(d==="boolean"&&h!=="boolean")return{valid:!1,error:`Field "${a}" must be of type boolean`};if(d==="array"&&h!=="array")return{valid:!1,error:`Field "${a}" must be of type array`};if(d==="object"&&(h!=="object"||Array.isArray(c)))return{valid:!1,error:`Field "${a}" must be of type object`}}}}return{valid:!0}}createDatabaseHandler(e){return{processData:(t,n,a)=>{if(e==="postgres"&&n.payload?.sql)return this.processPostgreSQLQuery(t,n,a);if(e==="redis")return this.processRedisCommand(t,n,a);if(e==="cassandra")return this.processCQLQuery(t,n,a);if(e==="clickhouse")return this.processClickHouseQuery(t,n,a);if(e==="snowflake")return this.processSnowflakeQuery(t,n,a);if(e==="elasticsearch")return this.processElasticsearchOperation(t,n,a);const r=n.payload?.operation||"insert";switch(r){case"insert":case"update":{const l=a.queryLatency||10;if(n.latency=l,e==="mongodb"){const h=t.data.config?.collections||[],p=n.payload;let m=p?.collection;if(!m&&h.length>0&&(p?.type?m=h.find(b=>b.name.toLowerCase().includes(p.type.toLowerCase()))?.name||h[0].name:m=h[0].name),m){const y=h.find(b=>b.name===m);if(y){if(y.validation){const b=y.validation;if(b.validationLevel!=="off"){const C={...p?.document||p?.data||p};delete C._id;const E=this.validateMongoDBSchema(C,b.validator);if(!E.valid){if(b.validationAction==="error")return n.status="failed",n.error=`Schema validation failed for collection "${m}": ${E.error}`,n;b.validationAction==="warn"&&(n.metadata={...n.metadata,validationWarning:E.error,collection:m})}}}r==="insert"?n.metadata={...n.metadata,collection:m,documentStored:!0}:r==="update"&&(n.metadata={...n.metadata,collection:m,documentUpdated:!0})}else return n.status="failed",n.error=`Collection "${m}" not found`,n}}return n.status="delivered",n}case"delete":const c=a.queryLatency||10;return n.latency=c,n.status="delivered",n;case"query":{let l=[];if(e==="mongodb"){const h=t.data.config?.collections||[],p=n.payload,m=p?.collection||h[0]?.name;if(m){const y=h.find(b=>b.name===m);if(y?.documents&&y.documents.length>0){if(l=y.documents.map(S=>({...S})),p?.filter)try{const S=typeof p.filter=="string"?JSON.parse(p.filter):p.filter;l=l.filter(C=>{for(const[E,M]of Object.entries(S))if(C[E]!==M)return!1;return!0})}catch{}const b=p?.limit||100;l=l.slice(0,b)}else l=this.generateQueryResults(e,p?.query)}else l=this.generateQueryResults(e,p?.query)}else l=this.generateQueryResults(e,n.payload?.query);return n.payload={...n.payload,results:l},n.status="delivered",n}default:return n.status="failed",n.error=`Unknown operation: ${r}`,n}},getSupportedFormats:()=>["json","binary"]}}processClickHouseQuery(e,t,n){const a=t.payload,r=je.getClickHouseRoutingEngine(e.id);if(!r)return t.status="failed",t.error="ClickHouse Routing Engine not initialized",t;let c;if(a?.sql)c=a.sql;else if(a?.query)c=a.query;else if(typeof a=="string")c=a;else{const d=a?.operation||"select",h=e.data.config,p=a?.database||h?.database||"default",m=a?.table||"default_table";switch(d.toLowerCase()){case"select":case"read":case"query":c=`SELECT * FROM ${p}.${m}`,a?.where&&(c+=` WHERE ${a.where}`),a?.limit&&(c+=` LIMIT ${a.limit}`);break;case"insert":case"write":const y=a?.columns?Object.keys(a.columns).join(", "):"id, data",b=a?.columns?Object.values(a.columns).map(S=>`'${S}'`).join(", "):`${Date.now()}, 'data'`;c=`INSERT INTO ${p}.${m} (${y}) VALUES (${b})`;break;default:return t.status="failed",t.error=`Unknown ClickHouse operation: ${d}`,t}}const l=r.executeQuery(c);return l.success?(t.status="delivered",t.latency=l.latency||45,t.payload={...t.payload,sql:c,rows:l.rows||[],rowCount:l.rowCount||0,columns:l.columns||[],dataRead:l.dataRead,dataWritten:l.dataWritten,clickHouseResult:l.rows},t.metadata={...t.metadata,clickHouseQuery:c,rowsRead:l.dataRead,rowsWritten:l.dataWritten}):(t.status="failed",t.error=l.error||"ClickHouse query execution failed",t.latency=l.latency||0),t}processSnowflakeQuery(e,t,n){const a=t.payload,r=je.getSnowflakeRoutingEngine(e.id);if(!r)return t.status="failed",t.error="Snowflake Routing Engine not initialized",t;let c,l,d,h;if(a?.sql)c=a.sql,l=a.warehouse,d=a.database,h=a.schema;else if(a?.query)c=a.query,l=a.warehouse,d=a.database,h=a.schema;else if(typeof a=="string")c=a;else{const m=a?.operation||"select",y=e.data.config;d=a?.database||y?.database||"PUBLIC",h=a?.schema||y?.schema||"PUBLIC",l=a?.warehouse||y?.warehouse;const b=a?.table||"default_table";switch(m.toLowerCase()){case"select":case"read":case"query":c=`SELECT * FROM ${d}.${h}.${b}`,a?.where&&(c+=` WHERE ${a.where}`),a?.limit&&(c+=` LIMIT ${a.limit}`);break;case"insert":case"write":const S=a?.columns?Object.keys(a.columns).join(", "):"id, data",C=a?.columns?Object.values(a.columns).map(E=>`'${E}'`).join(", "):`${Date.now()}, 'data'`;c=`INSERT INTO ${d}.${h}.${b} (${S}) VALUES (${C})`;break;default:return t.status="failed",t.error=`Unknown Snowflake operation: ${m}`,t}}const p=r.executeQuery(c,l,d,h);return p.success?(t.status="delivered",t.latency=p.latency||50,t.payload={...t.payload,sql:c,rows:p.rows||[],rowCount:p.rowCount||0,columns:p.columns||[],dataRead:p.dataRead,dataWritten:p.dataWritten,snowflakeResult:p.rows,queryId:p.queryId,warehouse:p.warehouse,resultCacheUsed:p.resultCacheUsed},t.metadata={...t.metadata,snowflakeQuery:c,rowsRead:p.dataRead,rowsWritten:p.dataWritten,warehouse:p.warehouse,queryId:p.queryId,cacheHit:p.resultCacheUsed||!1}):(t.status="failed",t.error=p.error||"Snowflake query execution failed",t.latency=p.latency||0),t}processElasticsearchOperation(e,t,n){const a=t.payload,r=je.getElasticsearchRoutingEngine(e.id);if(!r)return t.status="failed",t.error="Elasticsearch Routing Engine not initialized",t;const c=a?.operation||a?.method||"index",l=a?.index||a?._index||e.data.config?.index||"archiphoenix-index",d=a?.id||a?._id,h=a?.document||a?._source||a?.body||a,p=a?.query,m=a?.routing||a?._routing;let y;switch(c.toLowerCase()){case"index":case"create":case"update":if(!d||!h)return t.status="failed",t.error="Index operation requires id and document",t;y=r.indexDocument(l,d,h,m);break;case"get":case"read":if(!d)return t.status="failed",t.error="Get operation requires id",t;y=r.getDocument(l,d,m);break;case"search":case"query":p?y=r.search(l,p):a?.queryString?y=r.executeQuery(a.queryString):y=r.search(l,{query:{match_all:{}}});break;case"delete":if(!d)return t.status="failed",t.error="Delete operation requires id",t;y=r.deleteDocument(l,d,m);break;default:if(typeof a=="string"||a?.queryString){const b=typeof a=="string"?a:a.queryString;y=r.executeQuery(b)}else return t.status="failed",t.error=`Unsupported Elasticsearch operation: ${c}`,t}return y.success?(t.status="delivered",t.latency=y.latency||y.took||10,t.payload={...t.payload,operation:y.operation,index:y.index,id:y.id,document:y.document,hits:y.hits,took:y.took,elasticsearchResult:y},t.metadata={...t.metadata,elasticsearchOperation:y.operation,index:y.index,hits:y.hits,took:y.took}):(t.status="failed",t.error=y.error||"Elasticsearch operation failed",t.latency=y.latency||y.took||0),t}createStorageHandler(e){return e==="s3-datalake"?{processData:(t,n,a)=>this.processS3Operation(t,n,a),getSupportedFormats:()=>["json","binary","text","xml"]}:{processData:(t,n,a)=>(n.status="delivered",n.latency=50,n),getSupportedFormats:()=>["json","binary","text"]}}processS3Operation(e,t,n){const a=t.payload,r=je.getS3RoutingEngine(e.id);if(!r)return t.status="failed",t.error="S3 Routing Engine not initialized",t;const c=a?.operation||a?.method||"PUT",l=a?.bucket||a?.bucketName||e.data.config?.buckets?.[0]?.name||"default-bucket",d=a?.key||a?.objectKey||t.metadata?.key,h=a?.versionId||t.metadata?.versionId;let p;switch(c.toUpperCase()){case"PUT":case"UPLOAD":if(!d||!t.payload)return t.status="failed",t.error="PUT operation requires key and payload",t;const m=a?.data||a?.body||t.payload,y=a?.contentType||t.metadata?.contentType,b=a?.metadata||t.metadata;p=r.putObject(l,d,m,t.size,b,y);break;case"GET":case"DOWNLOAD":if(!d)return t.status="failed",t.error="GET operation requires key",t;p=r.getObject(l,d,h);break;case"DELETE":if(!d)return t.status="failed",t.error="DELETE operation requires key",t;p=r.deleteObject(l,d,h);break;case"LIST":const S=a?.prefix||t.metadata?.prefix,C=a?.maxKeys||a?.maxKeys||1e3;p=r.listObjects(l,S,C);break;case"HEAD":if(!d)return t.status="failed",t.error="HEAD operation requires key",t;p=r.headObject(l,d);break;default:return t.status="failed",t.error=`Unsupported S3 operation: ${c}`,t}return p.success?(t.status="delivered",t.latency=p.latency||50,p.object?t.payload={...t.payload,operation:c.toUpperCase(),bucket:l,key:d,object:p.object,etag:p.object.etag,versionId:p.versionId||p.object.versionId,size:p.object.size,storageClass:p.object.storageClass}:p.objects?t.payload={...t.payload,operation:"LIST",bucket:l,objects:p.objects,count:p.objects.length}:t.payload={...t.payload,operation:c.toUpperCase(),bucket:l,key:d,success:!0,versionId:p.versionId,deleteMarker:p.deleteMarker},t.metadata={...t.metadata,s3Operation:c.toUpperCase(),bucket:l,key:d,latency:p.latency}):(t.status="failed",t.error=p.error||`S3 ${c} operation failed`,t.latency=p.latency||0),t}processPostgreSQLQuery(e,t,n){if(!this.postgresQueryEngine)return t.status="failed",t.error="PostgreSQL Query Engine not initialized",t;const a=t.payload?.sql;if(!a||typeof a!="string")return t.status="failed",t.error="No SQL query provided",t;const r=e.data.config,c=r.tables||[],l=this.extractIndexesFromConfig(r,c),d=r.views||[],h=this.postgresQueryEngine.execute(a,c,l,d);return h.success?(t.status="delivered",t.latency=h.executionTime||n.queryLatency||10,t.payload={...t.payload,results:h.rows||[],rowCount:h.rowCount||0,queryPlan:h.queryPlan,indexesUsed:h.indexesUsed||[]}):(t.status="failed",t.error=h.error||"Query execution failed",t.latency=h.executionTime||0),t}processRedisCommand(e,t,n){const a=t.payload,r=je.getRedisRoutingEngine(e.id);if(!r)return t.status="failed",t.error="Redis Routing Engine not initialized",t;let c,l;if(a?.command)c=a.command,l=a.args||[];else if(a?.redisCommand){const h=String(a.redisCommand).trim().split(/\s+/);c=h[0],l=h.slice(1)}else if(typeof a=="string"){const h=a.trim().split(/\s+/);c=h[0],l=h.slice(1)}else{const h=a?.operation||"get";switch(h.toLowerCase()){case"get":c="GET",l=[a?.key||"default:key"];break;case"set":c="SET",l=[a?.key||"default:key",typeof a?.value=="string"?a.value:JSON.stringify(a?.value||"")],a?.ttl&&l.push("EX",String(a.ttl));break;case"delete":case"del":c="DEL",l=Array.isArray(a?.keys)?a.keys:[a?.key||"default:key"];break;case"exists":c="EXISTS",l=Array.isArray(a?.keys)?a.keys:[a?.key||"default:key"];break;default:return t.status="failed",t.error=`Unknown Redis operation: ${h}`,t}}const d=r.executeCommand(c,l);return d.success?(t.status="delivered",t.latency=d.latency||1,t.payload={...t.payload,command:c,args:l,result:d.value,redisResult:d.value}):(t.status="failed",t.error=d.error||"Redis command execution failed",t.latency=d.latency||0),t}processCQLQuery(e,t,n){const a=t.payload,r=je.getCassandraRoutingEngine(e.id);if(!r)return t.status="failed",t.error="Cassandra Routing Engine not initialized",t;let c,l;if(a?.cql)c=a.cql,l=a.consistency;else if(a?.query)c=a.query,l=a.consistency;else if(typeof a=="string")c=a;else{const h=a?.operation||"select",p=e.data.config,m=a?.keyspace||p?.keyspace||"system",y=a?.table||"default_table";switch(h.toLowerCase()){case"select":case"read":c=`SELECT * FROM ${m}.${y}`,a?.limit&&(c+=` LIMIT ${a.limit}`);break;case"insert":case"write":const b=a?.columns?Object.keys(a.columns).join(", "):"id, data",S=a?.columns?Object.values(a.columns).map(M=>`'${M}'`).join(", "):`${Date.now()}, 'data'`;c=`INSERT INTO ${m}.${y} (${b}) VALUES (${S})`;break;case"update":const C=a?.columns||{},E=Object.entries(C).map(([M,k])=>`${M} = '${k}'`).join(", ");c=`UPDATE ${m}.${y} SET ${E}`,a?.where&&(c+=` WHERE ${a.where}`);break;case"delete":c=`DELETE FROM ${m}.${y}`,a?.where&&(c+=` WHERE ${a.where}`);break;default:return t.status="failed",t.error=`Unknown CQL operation: ${h}`,t}}l||(l=e.data.config?.consistencyLevel||"QUORUM");const d=r.executeCQL(c,l);return d.success?(t.status="delivered",t.latency=d.latency||5,t.payload={...t.payload,cql:c,consistency:d.consistency,rows:d.rows||[],rowCount:d.rowCount||0,replicasQueried:d.replicasQueried,cqlResult:d.rows},t.metadata={...t.metadata,cassandraConsistency:d.consistency,cassandraReplicasQueried:d.replicasQueried}):(t.status="failed",t.error=d.error||"CQL query execution failed",t.latency=d.latency||0),t}extractIndexesFromConfig(e,t){const n=[];for(const a of t)for(const r of a.indexes||[]){const c=r.match(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+(\w+)\s+ON\s+\w+\s*\(([^)]+)\)/i);c?n.push({name:c[1],table:a.name,schema:a.schema,columns:c[2].split(",").map(l=>l.trim()),unique:r.toUpperCase().includes("UNIQUE")}):n.push({name:r,table:a.name,schema:a.schema,columns:[r.replace(/^idx_|^index_/i,"")]})}return n}createMessageBrokerHandler(e){return e==="rabbitmq"?{processData:(t,n,a)=>{const r=je.getRabbitMQRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=a?.messaging||n.metadata?.messaging||{},l=c.exchange||"amq.topic",d=c.routingKey||n.metadata?.routingKey||"default",h=n.metadata?.headers,p=n.metadata?.priority,m=r.routeMessage(l,d,n.payload,n.size,h,p);return m.length>0?(n.status="delivered",n.metadata={...n.metadata,routedQueues:m,exchange:l,routingKey:d}):(n.status="failed",n.error=`No queues bound to exchange '${l}' with routing key '${d}'`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="activemq"?{processData:(t,n,a)=>{const r=je.getActiveMQRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=a?.messaging||n.metadata?.messaging||{},l=c.queue,d=c.topic,h=n.metadata?.headers,p=n.metadata?.priority;let m=!1,y="";const b=t.data.config||{},S=b.acls||[],E=this.nodes.find(k=>k.id===n.source)?.data.config,M=n.metadata?.principal||E?.username||E?.clientId||b.username||`user-${n.source.slice(0,8)}`;if(l){if(!(je.checkActiveMQACLPermissionPublic?.(S,M,`queue://${l}`,"write")??!0))return n.status="failed",n.error=`Access denied: principal '${M}' does not have write permission for queue '${l}'`,n;r.routeToQueue(l,n.payload,n.size,h,p)&&(m=!0,y=l)}if(d){if(!(je.checkActiveMQACLPermissionPublic?.(S,M,`topic://${d}`,"write")??!0))return n.status="failed",n.error=`Access denied: principal '${M}' does not have write permission for topic '${d}'`,n;r.publishToTopic(d,n.payload,n.size,h,p).length>0&&(m=!0,y=d)}return m?(n.status="delivered",n.metadata={...n.metadata,destination:y,queue:l||void 0,topic:d||void 0}):(n.status="failed",n.error=`No queue or topic found. Queue: '${l||"none"}', Topic: '${d||"none"}'`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="aws-sqs"?{processData:(t,n,a)=>{const r=je.getSQSRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=a?.messaging||n.metadata?.messaging||{},l=c.queueUrl,d=c.queueName||(l?l.split("/").pop():null)||n.metadata?.queueName||"default-queue",h=t.data.config||{},p=h.iamPolicies||[],y=this.nodes.find(T=>T.id===n.source)?.data.config,b=n.metadata?.principal||y?.accessKeyId||y?.clientId||h.accessKeyId||`arn:aws:iam::123456789012:user/${n.source.slice(0,8)}`;if(!(je.checkSQSIAMPolicy?.(p,b,d,"sqs:SendMessage")??!0))return n.status="failed",n.error=`Access denied: principal '${b}' does not have sqs:SendMessage permission for queue '${d}'`,n;const C=n.metadata?.messageGroupId,E=n.metadata?.messageDeduplicationId,M=n.metadata?.attributes,k=r.sendMessage(d,n.payload,n.size,M,C,E);return k?(n.status="delivered",n.metadata={...n.metadata,queueName:d,messageId:k,queueUrl:l||`https://sqs.${h.defaultRegion||"us-east-1"}.amazonaws.com/.../${d}`}):(n.status="failed",n.error=`Queue '${d}' not found`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="azure-service-bus"?{processData:(t,n,a)=>{const r=je.getAzureServiceBusRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=a?.messaging||n.metadata?.messaging||{},l=c.queue,d=c.topic,h=n.metadata?.properties||n.metadata?.headers,p=n.metadata?.sessionId,m=n.metadata?.scheduledEnqueueTime;let y=!1,b="",S=[];if(l){const C=r.sendToQueue(l,n.payload,n.size,h,p,m);C&&(y=!0,b=l,S.push(C))}if(d){const C=r.publishToTopic(d,n.payload,n.size,h,m);C.length>0&&(y=!0,b=d,S=C)}return y?(n.status="delivered",n.metadata={...n.metadata,destination:b,queue:l||void 0,topic:d||void 0,messageIds:S,sessionId:p||void 0}):(n.status="failed",n.error=`No queue or topic found. Queue: '${l||"none"}', Topic: '${d||"none"}'`),n},getSupportedFormats:()=>["json","binary","text"]}:e==="gcp-pubsub"?{processData:(t,n,a)=>{const r=je.getPubSubRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=a?.messaging||n.metadata?.messaging||{},l=c.topic||n.metadata?.topic,d=c.orderingKey||n.metadata?.orderingKey,h=n.metadata?.attributes||n.metadata?.headers,p=t.data.config||{},m=l||p.topics&&p.topics[0]?.name||null;if(!m)return n.status="failed",n.error="No topic specified for Pub/Sub message",n;const y=r.publishToTopic(m,n.payload,n.size,h,d);return y?(n.status="delivered",n.metadata={...n.metadata,topic:m,messageId:y,orderingKey:d||void 0}):(n.status="failed",n.error=`Topic '${m}' not found`),n},getSupportedFormats:()=>["json","binary","text"]}:{processData:(t,n,a)=>(n.status="delivered",n),getSupportedFormats:()=>["json","binary","text"]}}createAPIHandler(e){return{processData:(t,n,a)=>{const r={status:"success",data:n.payload,timestamp:Date.now()};return n.payload=r,n.status="delivered",n},transformData:(t,n,a,r)=>(e==="rest"&&n.format!=="json"?(n.format="json",n.status="transformed"):e==="grpc"&&n.format!=="protobuf"&&(n.format="protobuf",n.status="transformed"),n),getSupportedFormats:()=>{switch(e){case"rest":return["json","xml"];case"grpc":return["protobuf","binary"];case"graphql":return["json"];case"websocket":return["json","text","binary"];default:return["json"]}}}}createIntegrationHandler(e){return e==="kong"?{processData:(t,n,a)=>{const r=je.getKongRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",h=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=h.apikey||h["X-API-Key"]||p.apikey,y=n.metadata?.consumerId,b=r.routeRequest({path:l,method:d,headers:h,query:p,body:c?.body,consumerId:y,apiKey:m});return b.response.status>=200&&b.response.status<300?(n.status="delivered",n.latency=b.response.latency,n.metadata={...n.metadata,kongRoute:b.match?.route.id,kongService:b.match?.service.id,kongTarget:b.target,kongResponseStatus:b.response.status}):(n.status="failed",n.error=b.response.error||`HTTP ${b.response.status}`,n.latency=b.response.latency),n},transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:e==="apigee"?{processData:(t,n,a)=>{const r=je.getApigeeRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",h=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=h.apikey||h["X-API-Key"]||p.apikey,y=h.Authorization||"",b=y.startsWith("OAuth ")?y.replace("OAuth ",""):void 0,S=y.startsWith("Bearer ")?y.replace("Bearer ",""):h["X-JWT-Token"],C=r.routeRequest({path:l,method:d,headers:h,query:p,body:c?.body,apiKey:m,oauthToken:b,jwtToken:S});return C.response.status>=200&&C.response.status<300?(n.status="delivered",n.latency=C.response.latency,n.metadata={...n.metadata,apigeeProxy:C.match?.proxy.name,apigeeTarget:C.target,apigeeResponseStatus:C.response.status,apigeeEnvironment:C.match?.proxy.environment}):(n.status="failed",n.error=C.response.error||`HTTP ${C.response.status}`,n.latency=C.response.latency),n},transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}:e==="graphql-gateway"?{processData:(t,n,a)=>{const r=je.getGraphQLGatewayRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=n.payload,l=c?.query||c?.body||n.metadata?.query,d=c?.variables||n.metadata?.variables,h=c?.operationName||n.metadata?.operationName,p=c?.headers||n.metadata?.headers||{},m=r.routeRequest({query:l||"",variables:d,headers:p,operationName:h});if(n.latency=m.latency,m.status>=200&&m.status<300){n.status="delivered";const S=r.getServiceRegistry().getConnectedServices().map(C=>C.endpoint);n.metadata={...n.metadata,graphqlGatewayStatus:m.status,graphqlGatewayEndpoints:S}}else n.status="failed",n.error=m.error||`HTTP ${m.status}`;return n},transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json"]}:e==="mulesoft"?{processData:(t,n,a)=>{const r=je.getMuleSoftRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=n.payload,l=this.nodes.find(p=>p.id===n.source),d=this.nodes.find(p=>p.id===n.target),h=r.processData({path:c?.path||n.metadata?.path,method:c?.method||n.metadata?.method||"POST",headers:c?.headers||n.metadata?.headers||{},query:c?.query||n.metadata?.query||{},body:c?.body||c||n.payload,format:n.format,sourceComponentType:l?.type,sourceComponentId:l?.id,targetComponentType:d?.type,targetComponentId:d?.id});return h.response.status==="success"?(n.status="delivered",n.latency=h.response.latency,n.payload=h.response.data,h.response.format&&(n.format=h.response.format),n.metadata={...n.metadata,mulesoftApplication:h.response.application,mulesoftFlow:h.response.flow,mulesoftConnector:h.response.connector}):(n.status="failed",n.error=h.response.error||"MuleSoft processing failed",n.latency=h.response.latency||0),n},transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary","text"]}:e==="bff-service"?{processData:(t,n,a)=>{const r=je.getBFFRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=n.payload,l=c?.path||n.metadata?.path||"/",d=c?.method||n.metadata?.method||"GET",h=c?.headers||n.metadata?.headers||{},p=c?.query||n.metadata?.query||{},m=c?.body||c||n.payload,y=r.routeRequest({path:l,method:d,headers:h,query:p,body:m});return y.status>=200&&y.status<300?(n.status="delivered",n.latency=y.latency,n.payload=y.data,n.metadata={...n.metadata,bffCacheHit:y.cacheHit,bffBackendResponses:y.backendResponses.length,bffStatus:y.status}):(n.status="failed",n.error=y.error||`HTTP ${y.status}`,n.latency=y.latency),n},transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json"]}:e==="webhook-relay"?{processData:(t,n,a)=>{const r=je.getWebhookRelayRoutingEngine(t.id);if(!r)return n.status="delivered",n;const c=n.payload,l=c?.url||n.metadata?.url||c?.path||"/",d=c?.method||n.metadata?.method||"POST",h=c?.headers||n.metadata?.headers||{},p=c?.body||c||n.payload,m=c?.ip||n.metadata?.ip||h["x-forwarded-for"]?.split(",")[0]?.trim(),y=c?.event||n.metadata?.event||h["x-event"]||h["x-github-event"]||"",b=r.relayWebhook({url:l,method:d,headers:h,body:p,ip:m,event:y});return b.success?(n.status="delivered",n.latency=b.latency,n.metadata={...n.metadata,webhookRelayId:b.relayId,webhookDeliveryId:b.deliveryId,webhookAttempts:b.attempts,webhookStatus:b.status}):(n.status="failed",n.error=b.error||`Webhook relay failed (HTTP ${b.status})`,n.latency=b.latency,n.metadata={...n.metadata,webhookRelayId:b.relayId,webhookDeliveryId:b.deliveryId,webhookAttempts:b.attempts,webhookStatus:b.status}),n},transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","text","binary"]}:{transformData:(t,n,a,r)=>{const c=this.getTargetFormats(a);return c.length>0&&!c.includes(n.format)&&(n.format=c[0],n.status="transformed"),n},getSupportedFormats:()=>["json","xml","binary"]}}getTargetFormats(e){return this.handlers.get(e)?.getSupportedFormats?.({type:e})||["json"]}createLokiHandler(){return{processData:(e,t,n)=>{const a=je.getLokiEmulationEngine(e.id);if(!a)return t.status="delivered",t;const r=t.payload;if(r?.query||r?.logql){const c=r.query||r.logql,l=r.startTime||r.start,d=r.endTime||r.end,h=r.limit||100,p=a.executeQuery(c,l,d,h);p.success?(t.status="delivered",t.latency=p.latency,t.payload={...t.payload,query:c,results:p.result||[],resultsCount:p.resultsCount}):(t.status="failed",t.error=p.error||"LogQL query execution failed",t.latency=p.latency||0)}else{const c=[],l=r?.stream||r?.labels||t.metadata?.labels||{app:e.data.label?.toLowerCase().replace(/\s+/g,"-")||"unknown",source:t.source.slice(0,8)};let d=[];if(r?.values&&Array.isArray(r.values))d=r.values;else if(r?.logs&&Array.isArray(r.logs)){const h=Date.now()*1e6;d=r.logs.map((p,m)=>[(h+m).toString(),String(p)])}else if(r?.log)d=[[(Date.now()*1e6).toString(),String(r.log)]];else if(typeof r=="string")d=[[(Date.now()*1e6).toString(),r]];else{const h=JSON.stringify(r);d=[[(Date.now()*1e6).toString(),h]]}if(d.length>0){c.push({stream:l,values:d});const h=a.processIngestion(c,t.source);h.success?(t.status="delivered",t.latency=10,t.payload={...t.payload,ingestedLines:h.ingestedLines,ingestedBytes:h.ingestedBytes}):(t.status="failed",t.error=h.error||"Log ingestion failed")}else t.status="failed",t.error="No log entries found in payload"}return t},getSupportedFormats:()=>["json","text"]}}createKeycloakHandler(){return{processData:(e,t,n)=>{const a=je.getKeycloakEmulationEngine(e.id);if(!a)return t.status="failed",t.error="Keycloak engine not initialized",t;const r=t.payload||{},c=t.metadata?.operation||r.operation||r.action||r.grant_type;let l="login";if(typeof c=="string"){const y=c.toLowerCase();y.includes("refresh")||y==="refresh_token"?l="refresh":y.includes("introspect")?l="introspect":y.includes("userinfo")||y.includes("user_info")?l="userinfo":l="login"}const d=r.clientId||r.client_id||t.metadata?.clientId,h=r.username||r.user||t.metadata?.username,p=r.sub||r.subject||t.metadata?.subject||h,m=a.processAuthRequest(l,{clientId:d,username:h,subject:p,grantType:typeof c=="string"?c:void 0});return t.latency=m.latency,m.success?(t.status="delivered",t.payload={...r||{},keycloak:{realm:m.realm,clientId:m.clientId,subject:m.subject,tokenType:m.tokenType,expiresIn:m.expiresIn}},t.metadata={...t.metadata,authRealm:m.realm,authClientId:m.clientId,authSubject:m.subject,authResult:"success"}):(t.status="failed",t.error=m.error||"Keycloak auth failed"),t},getSupportedFormats:()=>["json","text"]}}createJenkinsHandler(){return{processData:(e,t,n)=>{const a=je.getJenkinsEmulationEngine(e.id);if(!a)return t.status="failed",t.error="Jenkins engine not initialized",t;const r=t.payload||{},c=t.metadata?.operation||r.operation||r.action||"webhook";if(c==="webhook"||r.ref||r.branch||r.commit){const l=r.pipelineId||r.pipeline||r.job,d=r.branch||r.ref?.replace("refs/heads/","")||"main",h=r.commit||r.sha||void 0;if(l){const p=a.triggerWebhook(l,d,h);p.success?(t.status="delivered",t.latency=50,t.payload={...r||{},jenkins:{webhookReceived:!0,pipelineId:l,branch:d,commit:h,triggered:!0}}):(t.status="failed",t.error=p.reason||"Failed to trigger build",t.latency=50)}else t.status="delivered",t.latency=50,t.payload={...r||{},jenkins:{webhookReceived:!0,branch:d,commit:h,triggered:!1,reason:"No pipeline ID specified"}}}else if(c==="getBuildStatus"||r.buildId||r.buildNumber){const l=r.buildId||r.buildNumber,d=r.pipelineId||r.pipeline,h=a.getBuildById(l||`${d}-${r.buildNumber}`),p=h?.status||"unknown";t.status="delivered",t.latency=20,t.payload={...r||{},jenkins:{buildId:l,pipelineId:d,status:p,progress:h?.progress,duration:h?.duration}}}else t.status="delivered",t.latency=30,t.payload={...r||{},jenkins:{processed:!0,operation:c}};return a.processRequest(t.status==="delivered"),t},getSupportedFormats:()=>["json","text"]}}createVaultHandler(){return{processData:(e,t,n)=>{const a=je.getVaultEmulationEngine(e.id);if(!a)return t.status="failed",t.error="Vault engine not initialized",t;const r=t.payload||{},c=t.metadata?.operation||r.operation||r.action||"read",l=r?.path||t.metadata?.path||"secret/default",d=r?.token||t.metadata?.token;let h;if(typeof c=="string"){const p=c.toLowerCase();if(p.includes("write")||p==="create"||p==="update"){const m=r?.data||r?.value||{};h=a.processWriteRequest(l,m,d)}else if(p.includes("delete")||p==="remove")h=a.processDeleteRequest(l,d);else if(p.includes("encrypt")){const m=r?.plaintext||r?.data||"",y=r?.key||r?.keyName||"default";h=a.processEncryptRequest(m,y,d)}else if(p.includes("decrypt")){const m=r?.ciphertext||r?.data||"",y=r?.key||r?.keyName||"default";h=a.processDecryptRequest(m,y,d)}else if(p.includes("auth")||p==="login"||p==="authenticate"){const m=r?.method||r?.authMethod||"token";h=a.processAuthRequest(m,r)}else{const m=r?.key;h=a.processReadRequest(l,m,d)}}else{const p=r?.key;h=a.processReadRequest(l,p,d)}return t.latency=(t.latency||0)+h.latency,h.success?(t.status="delivered",t.payload={...r||{},vault:{path:l,data:h.data,token:h.token,policies:h.policies}},h.token&&(t.metadata={...t.metadata,vaultToken:h.token,vaultPolicies:h.policies})):(t.status="failed",t.error=h.error||"Vault operation failed"),t},getSupportedFormats:()=>["json","text"]}}createWAFHandler(){return{processData:(e,t,n)=>{const a=je.getWAFEmulationEngine(e.id);if(!a)return t.status="delivered",t;const r=t.payload||{},c=r?.path||t.metadata?.path||"/",l=r?.method||t.metadata?.method||"GET",d=r?.headers||t.metadata?.headers||{},h=r?.query||t.metadata?.query||{},p=r?.body||r,m=r?.sourceIP||t.metadata?.sourceIP||d["x-forwarded-for"]||d["x-real-ip"],y=r?.country||t.metadata?.country||d["cf-ipcountry"],b=r?.userAgent||t.metadata?.userAgent||d["user-agent"],S=a.processRequest({path:c,method:l,headers:d,query:h,body:p,sourceIP:m,country:y,userAgent:b});return t.latency=(t.latency||0)+S.latency,S.blocked?(t.status="failed",t.error=S.error||`Request blocked by WAF: ${S.threatDetected?"Threat detected":"Rule matched"}`,S.threatDetected&&(t.metadata={...t.metadata,wafBlocked:!0,wafThreatDetected:!0,wafAction:"block"})):!S.success&&S.action==="challenge"?(t.status="pending",t.metadata={...t.metadata,wafChallenge:!0,wafAction:"challenge"}):(t.status="delivered",t.metadata={...t.metadata,wafChecked:!0,wafAllowed:!0,wafLatency:S.latency},S.threatDetected&&(t.metadata.wafThreatDetected=!0,t.metadata.wafAction="log")),t},getSupportedFormats:()=>["json","text","xml"]}}createFirewallHandler(){return{processData:(e,t,n)=>{const a=je.getFirewallEmulationEngine(e.id);if(!a)return t.status="delivered",t;const r=t.payload||{},c=r?.source||t.metadata?.sourceIP||r?.sourceIP||"0.0.0.0",l=r?.destination||t.metadata?.destinationIP||r?.destinationIP||"10.0.0.1",d=r?.protocol||t.metadata?.protocol||"tcp",h=r?.port||t.metadata?.port||r?.destinationPort,p=r?.sourcePort||t.metadata?.sourcePort,m=a.processPacket({source:c,destination:l,protocol:d,port:h,sourcePort:p});return t.latency=(t.latency||0)+m.latency,m.blocked?(t.status="failed",t.error=m.error||`Packet ${m.action} by Firewall: ${m.matchedRule?.name||"Default policy"}`,t.metadata={...t.metadata,firewallBlocked:!0,firewallAction:m.action,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}):(t.status="delivered",t.metadata={...t.metadata,firewallChecked:!0,firewallAllowed:!0,firewallLatency:m.latency,firewallRuleId:m.matchedRule?.id,firewallRuleName:m.matchedRule?.name}),t},getSupportedFormats:()=>["json","text","binary"]}}createIDSIPSHandler(){return{processData:(e,t,n)=>{const a=je.getIDSIPSEmulationEngine(e.id);if(!a)return t.status="delivered",t;const r=t.payload||{},c=r?.source||t.metadata?.sourceIP||r?.sourceIP||"0.0.0.0",l=r?.destination||t.metadata?.destinationIP||r?.destinationIP||"10.0.0.1",d=r?.protocol||t.metadata?.protocol||"tcp",h=r?.port||t.metadata?.port||r?.destinationPort,p=r?.sourcePort||t.metadata?.sourcePort,m=r?.payload||r?.body||(typeof r=="string"?r:JSON.stringify(r)),y=a.processPacket({source:c,destination:l,protocol:d,port:h,sourcePort:p,payload:m});return t.latency=(t.latency||0)+y.latency,y.blocked?(t.status="failed",t.error=y.error||"Packet blocked by IDS/IPS: Intrusion detected",t.metadata={...t.metadata,idsipsBlocked:!0,idsipsAlertGenerated:y.alertGenerated,idsipsAction:"block"},y.alertGenerated&&(t.metadata.idsipsAlertType="intrusion")):(t.status="delivered",t.metadata={...t.metadata,idsipsChecked:!0,idsipsAllowed:!0,idsipsLatency:y.latency,idsipsAlertGenerated:y.alertGenerated},y.alertGenerated&&(t.metadata.idsipsAction="alert",t.metadata.idsipsAlertType="intrusion")),t},getSupportedFormats:()=>["json","text","binary"]}}createOpenTelemetryCollectorHandler(){return{processData:(e,t,n)=>{const a=je.getOpenTelemetryCollectorRoutingEngine(e.id);if(!a)return t.status="delivered",t;const r=this.nodes.find(l=>l.id===t.source),c=a.processMessage(t,r||void 0);return c.success?(t.status="delivered",t.latency=c.latency):(t.status="failed",t.error=c.error||"OpenTelemetry Collector processing failed",t.latency=c.latency),t},getSupportedFormats:()=>["json","protobuf","binary","text"]}}createCRMDataMessage(e){const t=e.data.config||{},n=t.contacts||[],a=t.deals||[],r=Math.random()>.5?"contact":"deal";let c;if(r==="contact"&&n.length>0){const d=n[Math.floor(Math.random()*n.length)];c={operation:"create",type:"contact",data:{name:d.name,email:d.email,company:d.company,status:d.status}}}else if(a.length>0){const d=a[Math.floor(Math.random()*a.length)];c={operation:"update",type:"deal",data:{id:d.id,name:d.name,value:d.value,stage:d.stage}}}else c={operation:"create",type:"contact",data:{name:`Contact ${Date.now()}`,email:`contact${Date.now()}@example.com`}};const l=JSON.stringify(c);return{id:"",timestamp:Date.now(),source:e.id,target:"",connectionId:"",format:"json",payload:c,size:new Blob([l]).size,metadata:{contentType:"application/json",operation:c.operation},status:"pending"}}createERPDataMessage(e){const t=e.data.config||{},n=t.orders||[],a=t.inventory||[],r=Math.random()>.5?"order":"inventory";let c;if(r==="order"&&n.length>0){const d=n[Math.floor(Math.random()*n.length)];c={operation:"create",type:"order",data:{orderNumber:d.orderNumber,customer:d.customer,total:d.total,items:d.items}}}else if(a.length>0){const d=a[Math.floor(Math.random()*a.length)];c={operation:"update",type:"inventory",data:{sku:d.sku,quantity:d.quantity,status:d.status}}}else c={operation:"create",type:"order",data:{orderNumber:`ORD-${Date.now()}`,total:Math.random()*1e3}};const l=JSON.stringify(c);return{id:"",timestamp:Date.now(),source:e.id,target:"",connectionId:"",format:"json",payload:c,size:new Blob([l]).size,metadata:{contentType:"application/json",operation:c.operation},status:"pending"}}createPaymentDataMessage(e){const n=(e.data.config||{}).transactions||[];let a;if(n.length>0){const c=n[Math.floor(Math.random()*n.length)];a={operation:"process",type:"transaction",data:{id:c.id,amount:c.amount,currency:c.currency,status:c.status}}}else a={operation:"process",type:"transaction",data:{amount:Math.random()*1e3,currency:"USD"}};const r=JSON.stringify(a);return{id:"",timestamp:Date.now(),source:e.id,target:"",connectionId:"",format:"json",payload:a,size:new Blob([r]).size,metadata:{contentType:"application/json",operation:a.operation},status:"pending"}}generateQueryResults(e,t){const n=Math.floor(Math.random()*10)+1,a=[];for(let r=0;r<n;r++)a.push({id:r+1,name:`Record ${r+1}`,value:Math.random()*100,timestamp:new Date().toISOString()});return a}}const un=new sT;class aT{componentStates=new Map;setComponentState(e,t,n){const a={nodeId:e,state:t,degradedLevel:n?.degradedLevel||.5,failureRate:n?.failureRate||.1,latencyMultiplier:n?.latencyMultiplier||2,throughputMultiplier:n?.throughputMultiplier||.5};this.componentStates.set(e,a)}getComponentState(e){return this.componentStates.get(e)}isEnabled(e){const t=this.componentStates.get(e);return!t||t.state==="enabled"}applyStateEffects(e,t){const n=this.componentStates.get(e);if(!n||n.state==="enabled")return{...t};if(n.state==="disabled"||n.state==="failed")return{throughput:0,latency:1/0,errorRate:1,utilization:0};if(n.state==="degraded"){const a=n.degradedLevel||.5;return{throughput:t.throughput*(n.throughputMultiplier||.5)*(1-a*.5),latency:t.latency*(n.latencyMultiplier||2)*(1+a),errorRate:Math.min(1,t.errorRate+(n.failureRate||.1)*a),utilization:Math.min(1,t.utilization*(1+a*.3))}}return{...t}}reset(){this.componentStates.clear()}resetComponent(e){this.componentStates.delete(e)}getAllStates(){return Array.from(this.componentStates.values())}}const uo=new aT;class iT{queues=new Map;exchanges=new Map;bindings=new Map;queueMessages=new Map;unackedMessages=new Map;queueState=new Map;initialize(e){if(this.queues.clear(),this.exchanges.clear(),this.bindings.clear(),this.queueMessages.clear(),this.unackedMessages.clear(),this.queueState.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.unackedMessages.set(t.name,[]),this.queueState.set(t.name,{ready:t.ready||0,unacked:t.unacked||0,total:t.messages||0,lastUpdate:Date.now()});if(e.exchanges)for(const t of e.exchanges)this.exchanges.set(t.name,{...t}),this.bindings.set(t.name,[]);if(e.bindings)for(const t of e.bindings){const n=this.bindings.get(t.source)||[];n.push(t),this.bindings.set(t.source,n)}}routeMessage(e,t,n,a,r,c){const l=this.exchanges.get(e);if(!l)return[];const d=this.bindings.get(e)||[],h=[];for(const y of d)this.shouldRouteToQueue(l,y,t,r)&&h.push(y.destination);const p=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,m=Date.now();for(const y of h){const b=this.queues.get(y);if(!b)continue;if(b.maxLength&&(this.queueMessages.get(y)||[]).length>=b.maxLength){b.deadLetterExchange&&this.routeToDeadLetterExchange(b.deadLetterExchange,b.deadLetterRoutingKey||t,n,a,r,c);continue}const S={id:p,timestamp:m,routingKey:t,exchange:e,payload:n,size:a,priority:c||b.maxPriority?c||0:void 0,headers:r,ttl:b.messageTtl?m+b.messageTtl:void 0},C=this.queueMessages.get(y)||[];C.push(S),b.maxPriority&&S.priority!==void 0&&C.sort((E,M)=>(M.priority||0)-(E.priority||0)),this.queueMessages.set(y,C)}return h}shouldRouteToQueue(e,t,n,a){switch(e.type){case"direct":return t.routingKey===n;case"topic":return this.matchTopicPattern(t.routingKey,n);case"fanout":return!0;case"headers":if(!a||!t.arguments)return!1;for(const[r,c]of Object.entries(t.arguments))if(!r.startsWith("x-")&&a[r]!==c)return!1;return!0;default:return!1}}matchTopicPattern(e,t){const n=e.replace(/\./g,"\\.").replace(/\*/g,"[^.]+").replace(/#/g,".*");return new RegExp(`^${n}$`).test(t)}routeToDeadLetterExchange(e,t,n,a,r,c){this.routeMessage(e,t,n,a,r,c)}processConsumption(e){const t=Date.now();for(const[n,a]of this.queues.entries()){let r=this.queueMessages.get(n)||[],c=this.unackedMessages.get(n)||[];const l=this.queueState.get(n)||{ready:0,unacked:0,total:0,lastUpdate:t};r=r.filter(E=>E.ttl&&t>E.ttl?(a.deadLetterExchange&&this.routeToDeadLetterExchange(a.deadLetterExchange,a.deadLetterRoutingKey||E.routingKey,E.payload,E.size,E.headers,E.priority),!1):!0),this.queueMessages.set(n,r);const p=(a.consumers||0)*10*e/1e3,m=Math.min(p,r.length),y=r.splice(0,m);c.push(...y),this.unackedMessages.set(n,c);const S=e/100*c.length,C=Math.min(S,c.length);c.splice(0,Math.floor(C)),this.unackedMessages.set(n,c),l.ready=r.length,l.unacked=c.length,l.total=r.length+c.length,l.lastUpdate=t,this.queueState.set(n,l)}}getQueueMetrics(e){const t=this.queues.get(e);if(!t)return null;const n=this.queueMessages.get(e)||[],a=this.unackedMessages.get(e)||[];this.queueState.get(e);const r=n.length,c=a.length;return{messages:r+c,ready:r,unacked:c,consumers:t.consumers||0}}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getTotalQueueDepth(){let e=0;for(const t of this.queueMessages.values())e+=t.length;for(const t of this.unackedMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.queues.values())t.consumers&&(e+=t.consumers);return e+=this.exchanges.size,Math.max(1,e)}updateQueue(e,t){const n=this.queues.get(e);n&&(Object.assign(n,t),this.queues.set(e,n))}}class oT{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;queueState=new Map;topicState=new Map;initialize(e){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.queueState.clear(),this.topicState.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.queueState.set(t.name,{queueSize:t.queueSize||0,consumerCount:t.consumerCount||0,enqueueCount:t.enqueueCount||0,dequeueCount:t.dequeueCount||0,lastUpdate:Date.now()});if(e.topics)for(const t of e.topics)this.topics.set(t.name,{...t}),this.topicMessages.set(t.name,[]),this.subscriptions.set(t.name,[]),this.topicState.set(t.name,{subscriberCount:t.subscriberCount||0,enqueueCount:t.enqueueCount||0,dequeueCount:t.dequeueCount||0,lastUpdate:Date.now()});if(e.subscriptions)for(const t of e.subscriptions){const n=this.subscriptions.get(t.destination)||[];n.push(t),this.subscriptions.set(t.destination,n),this.subscriptionMessages.set(t.id,[])}}routeToQueue(e,t,n,a,r){if(!this.queues.get(e))return!1;const l=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=Date.now(),h={id:l,timestamp:d,destination:e,payload:t,size:n,headers:a,priority:r},p=this.queueMessages.get(e)||[];p.push(h),r!==void 0&&p.sort((y,b)=>(b.priority||0)-(y.priority||0)),this.queueMessages.set(e,p);const m=this.queueState.get(e)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:d};return m.queueSize=p.length,m.enqueueCount=(m.enqueueCount||0)+1,m.lastUpdate=d,this.queueState.set(e,m),!0}publishToTopic(e,t,n,a,r){if(!this.topics.get(e))return[];const l=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=Date.now(),h=this.subscriptions.get(e)||[],p=[],m={id:l,timestamp:d,destination:e,payload:t,size:n,headers:a,priority:r};for(const b of h){if(b.selector&&!this.matchesSelector(b.selector,a))continue;const S=this.subscriptionMessages.get(b.id)||[];S.push(m),this.subscriptionMessages.set(b.id,S),p.push(b.id),b.pendingQueueSize=(b.pendingQueueSize||0)+1,b.enqueueCounter=(b.enqueueCounter||0)+1}if(h.length===0){const b=this.topicMessages.get(e)||[];b.push(m),this.topicMessages.set(e,b)}const y=this.topicState.get(e)||{subscriberCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:d};return y.enqueueCount=(y.enqueueCount||0)+1,y.lastUpdate=d,this.topicState.set(e,y),p}matchesSelector(e,t){if(!t||!e)return!0;try{const n=e.trim(),a=n.match(/^(\w+)\s*=\s*['"]([^'"]+)['"]$/);if(a){const c=a[1],l=a[2];return t[c]===l}const r=n.match(/^(\w+)\s*([><=]+)\s*(\d+)$/);if(r){const c=r[1],l=r[2],d=Number(r[3]),h=Number(t[c]);if(isNaN(h))return!1;switch(l){case">":return h>d;case"<":return h<d;case">=":return h>=d;case"<=":return h<=d;case"=":return h===d;default:return!1}}for(const c in t)if(n.includes(c))return!0;return!1}catch{return!0}}processConsumption(e){const t=Date.now();for(const[n,a]of this.queues.entries()){let r=this.queueMessages.get(n)||[];const c=this.queueState.get(n)||{queueSize:0,consumerCount:0,enqueueCount:0,dequeueCount:0,lastUpdate:t};r=r.filter(y=>!(y.ttl&&t>y.ttl)),this.queueMessages.set(n,r);const h=(a.consumerCount||c.consumerCount||0)*10*e/1e3,p=Math.min(h,r.length),m=r.splice(0,Math.floor(p));this.queueMessages.set(n,r),c.queueSize=r.length,c.dequeueCount=(c.dequeueCount||0)+m.length,c.lastUpdate=t,this.queueState.set(n,c)}for(const[n,a]of this.subscriptions.entries()){for(const c of a){let l=this.subscriptionMessages.get(c.id)||[];l=l.filter(y=>!(y.ttl&&t>y.ttl));const h=10*e/1e3,p=Math.min(h,l.length),m=l.splice(0,Math.floor(p));c.pendingQueueSize=l.length,c.dispatchedQueueSize=(c.dispatchedQueueSize||0)+m.length,c.dequeueCounter=(c.dequeueCounter||0)+m.length,this.subscriptionMessages.set(c.id,l)}const r=this.topicState.get(n);r&&(r.dequeueCount=a.reduce((c,l)=>c+(l.dequeueCounter||0),0),r.lastUpdate=t)}}getQueueMetrics(e){if(!this.queues.get(e))return null;const n=this.queueState.get(e);return n?{queueSize:n.queueSize,consumerCount:n.consumerCount,enqueueCount:n.enqueueCount,dequeueCount:n.dequeueCount}:null}getTopicMetrics(e){if(!this.topics.get(e))return null;const n=this.topicState.get(e);return n?{subscriberCount:n.subscriberCount,enqueueCount:n.enqueueCount,dequeueCount:n.dequeueCount}:null}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getAllTopicMetrics(){const e=new Map;for(const t of this.topics.keys()){const n=this.getTopicMetrics(t);n&&e.set(t,n)}return e}getTotalQueueDepth(){let e=0;for(const t of this.queueMessages.values())e+=t.length;return e}getTotalTopicMessages(){let e=0;for(const t of this.subscriptionMessages.values())e+=t.length;for(const t of this.topicMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.queues.values())t.consumerCount&&(e+=t.consumerCount);for(const t of this.subscriptions.values())e+=t.length;return Math.max(1,e+1)}updateQueue(e,t){const n=this.queues.get(e);if(n){Object.assign(n,t),this.queues.set(e,n);const a=this.queueState.get(e);a&&t.consumerCount!==void 0&&(a.consumerCount=t.consumerCount)}}updateTopic(e,t){const n=this.topics.get(e);if(n){Object.assign(n,t),this.topics.set(e,n);const a=this.topicState.get(e);a&&t.subscriberCount!==void 0&&(a.subscriberCount=t.subscriberCount)}}}class rT{queues=new Map;queueMessages=new Map;inFlightMessages=new Map;dlqMessages=new Map;queueState=new Map;messageGroups=new Map;deduplicationIds=new Map;initialize(e){if(this.queues.clear(),this.queueMessages.clear(),this.inFlightMessages.clear(),this.dlqMessages.clear(),this.queueState.clear(),this.messageGroups.clear(),this.deduplicationIds.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.inFlightMessages.set(t.name,[]),this.queueState.set(t.name,{approximateMessages:0,approximateMessagesNotVisible:0,approximateMessagesDelayed:0,sentCount:0,receivedCount:0,deletedCount:0,dlqCount:0,lastUpdate:Date.now()}),t.type==="fifo"&&(this.messageGroups.set(t.name,new Map),this.deduplicationIds.set(t.name,new Set))}sendMessage(e,t,n,a,r,c){const l=this.queues.get(e);if(!l)return null;const d=Date.now(),h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=`${e}-${h}`;if(l.type==="fifo"){if(l.contentBasedDedup&&!c){const k=JSON.stringify(t);c=this.hashString(k)}if(c){const k=this.deduplicationIds.get(e);if(k&&k.has(c))return p;k?.add(c)}r||(r="default-group")}const m=l.messageRetention*24*60*60*1e3,y=d+m,b=l.delaySeconds*1e3,S=b>0?d+b:void 0,C={id:h,messageId:p,timestamp:d,queueName:e,payload:t,size:n,attributes:a,messageGroupId:r,messageDeduplicationId:c,receiveCount:0,retentionExpiresAt:y,delayUntil:S},E=this.queueMessages.get(e)||[];if(l.type==="fifo"&&r){const k=this.messageGroups.get(e);if(k){const T=k.get(r)||[];T.push(C),k.set(r,T)}}E.push(C),this.queueMessages.set(e,E);const M=this.queueState.get(e);if(M){const k=this.queueMessages.get(e)||[],T=this.inFlightMessages.get(e)||[],A=k.filter(N=>N.delayUntil&&d<N.delayUntil);M.approximateMessages=k.length,M.approximateMessagesNotVisible=T.length,M.approximateMessagesDelayed=A.length,M.sentCount=(M.sentCount||0)+1,M.lastUpdate=d}return p}receiveMessage(e,t=1,n){const a=this.queues.get(e);if(!a)return[];const r=Date.now(),l=(n!==void 0?n:a.visibilityTimeout)*1e3;let d=(this.queueMessages.get(e)||[]).filter(y=>!(y.delayUntil&&r<y.delayUntil||r>=y.retentionExpiresAt));if(a.type==="fifo"){const y=this.messageGroups.get(e);if(y){d=[];let b=0;for(const[S,C]of y.entries()){if(b>=t)break;if(C.length>0){const E=C[0];(!E.delayUntil||r>=E.delayUntil)&&r<E.retentionExpiresAt&&(d.push(E),b++)}}}}const h=Math.min(t,d.length),p=[];for(let y=0;y<h;y++){const b=d[y],S=`receipt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;b.receiptHandle=S,b.receiveCount=(b.receiveCount||0)+1,b.firstReceivedAt||(b.firstReceivedAt=r);const C={message:b,receivedAt:r,visibilityTimeoutExpiresAt:r+l},E=this.inFlightMessages.get(e)||[];E.push(C),this.inFlightMessages.set(e,E);const M=this.queueMessages.get(e)||[],k=M.indexOf(b);if(k>-1&&M.splice(k,1),this.queueMessages.set(e,M),a.type==="fifo"&&b.messageGroupId){const T=this.messageGroups.get(e);if(T){const A=T.get(b.messageGroupId)||[],N=A.indexOf(b);N>-1&&A.splice(N,1),A.length===0?T.delete(b.messageGroupId):T.set(b.messageGroupId,A)}}p.push(b)}const m=this.queueState.get(e);return m&&(m.receivedCount=(m.receivedCount||0)+p.length,m.lastUpdate=r),p}deleteMessage(e,t){if(!this.queues.get(e))return!1;const a=this.inFlightMessages.get(e)||[],r=a.findIndex(l=>l.message.receiptHandle===t);if(r===-1)return!1;a[r],a.splice(r,1),this.inFlightMessages.set(e,a);const c=this.queueState.get(e);return c&&(c.deletedCount=(c.deletedCount||0)+1,c.lastUpdate=Date.now()),!0}processConsumption(e){const t=Date.now();for(const[n,a]of this.queues.entries()){const r=this.inFlightMessages.get(n)||[],c=[],l=[];for(const m of r)if(t>=m.visibilityTimeoutExpiresAt){const y=m.message;y.receiptHandle=void 0,a.maxReceiveCount&&y.receiveCount>=a.maxReceiveCount?this.sendToDLQ(a,y):c.push(y)}else l.push(m);if(this.inFlightMessages.set(n,l),c.length>0){const m=this.queueMessages.get(n)||[];if(a.type==="fifo"){const y=this.messageGroups.get(n);if(y)for(const b of c){const S=b.messageGroupId||"default-group",C=y.get(S)||[];C.push(b),y.set(S,C)}}m.push(...c),this.queueMessages.set(n,m)}const h=(this.queueMessages.get(n)||[]).filter(m=>t>=m.retentionExpiresAt?(a.deadLetterQueue&&this.sendToDLQ(a,m),!1):!0);if(this.queueMessages.set(n,h),a.type==="fifo"){const m=this.messageGroups.get(n);if(m)for(const[y,b]of m.entries()){const S=b.filter(C=>t>=C.retentionExpiresAt?(a.deadLetterQueue&&this.sendToDLQ(a,C),!1):!0);S.length===0?m.delete(y):m.set(y,S)}}const p=this.queueState.get(n);if(p){const m=this.queueMessages.get(n)||[],y=this.inFlightMessages.get(n)||[],b=m.filter(S=>S.delayUntil&&t<S.delayUntil);p.approximateMessages=m.length,p.approximateMessagesNotVisible=y.length,p.approximateMessagesDelayed=b.length,p.lastUpdate=t}}}sendToDLQ(e,t){if(!e.deadLetterQueue||!this.queues.get(e.deadLetterQueue))return;const a=this.dlqMessages.get(e.deadLetterQueue)||[];a.push(t),this.dlqMessages.set(e.deadLetterQueue,a);const r=this.queueState.get(e.deadLetterQueue);r&&(r.dlqCount=(r.dlqCount||0)+1,r.approximateMessages=a.length);const c=this.queueState.get(e.name);c&&(c.dlqCount=(c.dlqCount||0)+1)}hashString(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t=t&t}return Math.abs(t).toString(36)}getQueueMetrics(e){if(!this.queues.get(e))return null;const n=this.queueState.get(e);return n?{approximateMessages:n.approximateMessages,approximateMessagesNotVisible:n.approximateMessagesNotVisible,approximateMessagesDelayed:n.approximateMessagesDelayed,sentCount:n.sentCount,receivedCount:n.receivedCount,deletedCount:n.deletedCount,dlqCount:n.dlqCount}:null}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getTotalQueueDepth(){let e=0;for(const t of this.queueMessages.values())e+=t.length;for(const t of this.inFlightMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.queueState.values())(t.sentCount>0||t.receivedCount>0)&&(e+=1);return Math.max(1,e)}updateQueue(e,t){const n=this.queues.get(e);n&&(Object.assign(n,t),this.queues.set(e,n))}}class cT{queues=new Map;topics=new Map;subscriptions=new Map;queueMessages=new Map;topicMessages=new Map;subscriptionMessages=new Map;lockedMessages=new Map;deadLetterMessages=new Map;scheduledMessages=new Map;sessionMessages=new Map;queueState=new Map;subscriptionState=new Map;initialize(e){if(this.queues.clear(),this.topics.clear(),this.subscriptions.clear(),this.queueMessages.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.lockedMessages.clear(),this.deadLetterMessages.clear(),this.scheduledMessages.clear(),this.sessionMessages.clear(),this.queueState.clear(),this.subscriptionState.clear(),e.queues)for(const t of e.queues)this.queues.set(t.name,{...t}),this.queueMessages.set(t.name,[]),this.lockedMessages.set(t.name,[]),this.deadLetterMessages.set(t.name,[]),this.scheduledMessages.set(t.name,[]),this.queueState.set(t.name,{activeMessageCount:t.activeMessageCount||0,deadLetterMessageCount:t.deadLetterMessageCount||0,scheduledMessageCount:t.scheduledMessageCount||0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),t.enableSessions&&this.sessionMessages.set(t.name,new Map);if(e.topics){for(const t of e.topics)if(this.topics.set(t.name,{...t}),this.topicMessages.set(t.name,[]),this.scheduledMessages.set(t.name,[]),this.subscriptions.set(t.name,[]),t.subscriptions)for(const n of t.subscriptions){const a=this.subscriptions.get(t.name)||[];a.push(n),this.subscriptions.set(t.name,a);const r=`${t.name}/subscriptions/${n.name}`;this.subscriptionMessages.set(r,[]),this.lockedMessages.set(r,[]),this.deadLetterMessages.set(r,[]),this.subscriptionState.set(r,{activeMessageCount:n.activeMessageCount||0,deadLetterMessageCount:0,sentCount:0,receivedCount:0,completedCount:0,abandonedCount:0,lastUpdate:Date.now()}),this.sessionMessages.set(r,new Map)}}}sendToQueue(e,t,n,a,r,c){const l=this.queues.get(e);if(!l)return null;const d=Date.now(),h=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=`${e}-${h}`,m=l.defaultMessageTimeToLive*1e3,y=d+m,b={id:h,messageId:p,timestamp:d,destination:e,payload:t,size:n,properties:a,sessionId:r,scheduledEnqueueTime:c,expirationTime:y,deliveryCount:0,enqueuedTime:c||d};if(c&&c>d){const C=this.scheduledMessages.get(e)||[];C.push(b),this.scheduledMessages.set(e,C);const E=this.queueState.get(e);return E&&(E.scheduledMessageCount=C.length),p}if(l.enableSessions&&r){const C=this.sessionMessages.get(e);if(C){const E=C.get(r)||[];E.push(b),C.set(r,E)}}else{const C=this.queueMessages.get(e)||[];C.push(b),this.queueMessages.set(e,C)}const S=this.queueState.get(e);if(S){const C=this.getAvailableMessages(e);S.activeMessageCount=C.length,S.sentCount=(S.sentCount||0)+1,S.lastUpdate=d}return p}publishToTopic(e,t,n,a,r){const c=this.topics.get(e);if(!c)return[];const l=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=`${e}-${d}`,p=c.defaultMessageTimeToLive*1e3,m=l+p,y={id:d,messageId:h,timestamp:l,destination:e,payload:t,size:n,properties:a,scheduledEnqueueTime:r,expirationTime:m,deliveryCount:0,enqueuedTime:r||l},b=[];if(r&&r>l){const C=this.scheduledMessages.get(e)||[];return C.push(y),this.scheduledMessages.set(e,C),[h]}const S=this.subscriptions.get(e)||[];if(S.length===0)return[];for(const C of S){const E=`${e}/subscriptions/${C.name}`,M=this.subscriptionMessages.get(E)||[],k={...y,id:`${d}-${C.name}`,messageId:`${h}-${C.name}`,subscriptionName:C.name};M.push(k),this.subscriptionMessages.set(E,M),b.push(k.messageId);const T=this.subscriptionState.get(E);if(T){const A=this.getAvailableSubscriptionMessages(E);T.activeMessageCount=A.length,T.sentCount=(T.sentCount||0)+1,T.lastUpdate=l}}return b}receiveFromQueue(e,t,n){const a=this.queues.get(e);if(!a)return null;const r=Date.now(),c=(t||a.lockDuration)*1e3,l=r+c;let d;if(a.enableSessions&&n){const y=this.sessionMessages.get(e);if(!y)return null;d=y.get(n)||[]}else d=this.getAvailableMessages(e);if(d.length===0)return null;const h=d.shift();h.deliveryCount=(h.deliveryCount||0)+1,h.lockedUntil=l,h.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const p=this.lockedMessages.get(e)||[];if(p.push({message:h,lockedAt:r,lockExpiresAt:l}),this.lockedMessages.set(e,p),a.enableSessions&&n){const y=this.sessionMessages.get(e);if(y){const b=y.get(n)||[],S=b.findIndex(C=>C.id===h.id);S>=0&&(b.splice(S,1),y.set(n,b))}}const m=this.queueState.get(e);if(m){const y=this.getAvailableMessages(e);m.activeMessageCount=y.length,m.receivedCount=(m.receivedCount||0)+1,m.lastUpdate=r}return h}receiveFromSubscription(e,t,n){const a=`${e}/subscriptions/${t}`,r=this.getAvailableSubscriptionMessages(a);if(r.length===0)return null;const c=this.subscriptions.get(e)?.find(b=>b.name===t);if(!c)return null;const l=Date.now(),d=(n||c.lockDuration)*1e3,h=l+d,p=r.shift();p.deliveryCount=(p.deliveryCount||0)+1,p.lockedUntil=h,p.lockToken=`lock_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const m=this.lockedMessages.get(a)||[];m.push({message:p,lockedAt:l,lockExpiresAt:h}),this.lockedMessages.set(a,m);const y=this.subscriptionState.get(a);if(y){const b=this.getAvailableSubscriptionMessages(a);y.activeMessageCount=b.length,y.receivedCount=(y.receivedCount||0)+1,y.lastUpdate=l}return p}completeMessage(e,t){const n=this.lockedMessages.get(e)||[],a=n.findIndex(c=>c.message.lockToken===t);if(a<0)return!1;if(n.splice(a,1),this.lockedMessages.set(e,n),this.queues.has(e)){const c=this.queueState.get(e);c&&(c.completedCount=(c.completedCount||0)+1,c.lastUpdate=Date.now())}else{const c=this.subscriptionState.get(e);c&&(c.completedCount=(c.completedCount||0)+1,c.lastUpdate=Date.now())}return!0}abandonMessage(e,t){const n=this.lockedMessages.get(e)||[],a=n.findIndex(h=>h.message.lockToken===t);if(a<0)return!1;const r=n[a];n.splice(a,1),this.lockedMessages.set(e,n);const c=r.message;c.lockToken=void 0,c.lockedUntil=void 0;const l=this.queues.has(e),d=l?this.queues.get(e)?.maxDeliveryCount||10:this.subscriptions.get(c.destination)?.find(h=>h.name===c.subscriptionName)?.maxDeliveryCount||10;if(c.deliveryCount>=d){const h=this.deadLetterMessages.get(e)||[];if(h.push(c),this.deadLetterMessages.set(e,h),l){const p=this.queueState.get(e);p&&(p.deadLetterMessageCount=h.length,p.abandonedCount=(p.abandonedCount||0)+1,p.lastUpdate=Date.now())}else{const p=this.subscriptionState.get(e);p&&(p.deadLetterMessageCount=h.length,p.abandonedCount=(p.abandonedCount||0)+1,p.lastUpdate=Date.now())}}else{if(l){const h=this.queues.get(e);if(h)if(h.enableSessions&&c.sessionId){const p=this.sessionMessages.get(e);if(p){const m=p.get(c.sessionId)||[];m.push(c),p.set(c.sessionId,m)}}else{const p=this.queueMessages.get(e)||[];p.push(c),this.queueMessages.set(e,p)}}else{const h=this.subscriptionMessages.get(e)||[];h.push(c),this.subscriptionMessages.set(e,h)}if(l){const h=this.queueState.get(e);if(h){const p=this.getAvailableMessages(e);h.activeMessageCount=p.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now()}}else{const h=this.subscriptionState.get(e);if(h){const p=this.getAvailableSubscriptionMessages(e);h.activeMessageCount=p.length,h.abandonedCount=(h.abandonedCount||0)+1,h.lastUpdate=Date.now()}}}return!0}processConsumption(e){const t=Date.now();for(const[n,a]of this.queues.entries()){const r=this.scheduledMessages.get(n)||[],c=this.queueMessages.get(n)||[],l=this.sessionMessages.get(n);for(let m=r.length-1;m>=0;m--){const y=r[m];if(y.scheduledEnqueueTime&&y.scheduledEnqueueTime<=t)if(r.splice(m,1),a.enableSessions&&y.sessionId&&l){const b=l.get(y.sessionId)||[];b.push(y),l.set(y.sessionId,b)}else c.push(y)}this.scheduledMessages.set(n,r),this.queueMessages.set(n,c);const d=this.lockedMessages.get(n)||[];for(let m=d.length-1;m>=0;m--){const y=d[m];y.lockExpiresAt<=t&&(d.splice(m,1),this.abandonMessage(n,y.message.lockToken))}this.lockedMessages.set(n,d);const h=this.getAvailableMessages(n);for(let m=h.length-1;m>=0;m--){const y=h[m];if(y.expirationTime<=t&&(h.splice(m,1),a.enableDeadLetteringOnMessageExpiration)){const b=this.deadLetterMessages.get(n)||[];b.push(y),this.deadLetterMessages.set(n,b)}}this.queueMessages.set(n,h);const p=this.queueState.get(n);p&&(p.activeMessageCount=this.getAvailableMessages(n).length,p.deadLetterMessageCount=(this.deadLetterMessages.get(n)||[]).length,p.scheduledMessageCount=r.length,p.lastUpdate=t)}for(const[n,a]of this.topics.entries()){const r=this.scheduledMessages.get(n)||[];for(let l=r.length-1;l>=0;l--){const d=r[l];d.scheduledEnqueueTime&&d.scheduledEnqueueTime<=t&&(r.splice(l,1),this.publishToTopic(n,d.payload,d.size,d.properties))}this.scheduledMessages.set(n,r);const c=this.subscriptions.get(n)||[];for(const l of c){const d=`${n}/subscriptions/${l.name}`,h=this.lockedMessages.get(d)||[];for(let y=h.length-1;y>=0;y--){const b=h[y];b.lockExpiresAt<=t&&(h.splice(y,1),this.abandonMessage(d,b.message.lockToken))}this.lockedMessages.set(d,h);const p=this.getAvailableSubscriptionMessages(d);for(let y=p.length-1;y>=0;y--){const b=p[y];if(b.expirationTime<=t&&(p.splice(y,1),l.enableDeadLetteringOnMessageExpiration)){const S=this.deadLetterMessages.get(d)||[];S.push(b),this.deadLetterMessages.set(d,S)}}this.subscriptionMessages.set(d,p);const m=this.subscriptionState.get(d);m&&(m.activeMessageCount=this.getAvailableSubscriptionMessages(d).length,m.deadLetterMessageCount=(this.deadLetterMessages.get(d)||[]).length,m.lastUpdate=t)}}}getAvailableMessages(e){if(!this.queues.get(e))return[];const n=Date.now();return(this.queueMessages.get(e)||[]).filter(r=>r.expirationTime>n)}getAvailableSubscriptionMessages(e){const t=Date.now();return(this.subscriptionMessages.get(e)||[]).filter(a=>a.expirationTime>t)}getTotalQueueDepth(){let e=0;for(const t of this.queues.keys())e+=this.getAvailableMessages(t).length;return e}getTotalSubscriptionMessages(){let e=0;for(const t of this.subscriptionMessages.keys())e+=this.getAvailableSubscriptionMessages(t).length;return e}getQueueMetrics(e){const t=this.queueState.get(e);return t?{activeMessageCount:t.activeMessageCount,deadLetterMessageCount:t.deadLetterMessageCount,scheduledMessageCount:t.scheduledMessageCount,sentCount:t.sentCount,receivedCount:t.receivedCount,completedCount:t.completedCount,abandonedCount:t.abandonedCount}:null}getSubscriptionMetrics(e,t){const n=`${e}/subscriptions/${t}`,a=this.subscriptionState.get(n);return a?{activeMessageCount:a.activeMessageCount,deadLetterMessageCount:a.deadLetterMessageCount,sentCount:a.sentCount,receivedCount:a.receivedCount,completedCount:a.completedCount,abandonedCount:a.abandonedCount}:null}getAllQueueMetrics(){const e=new Map;for(const t of this.queues.keys()){const n=this.getQueueMetrics(t);n&&e.set(t,n)}return e}getAllSubscriptionMetrics(){const e=new Map;for(const[t,n]of this.subscriptionState.entries())e.set(t,{activeMessageCount:n.activeMessageCount,deadLetterMessageCount:n.deadLetterMessageCount,sentCount:n.sentCount,receivedCount:n.receivedCount,completedCount:n.completedCount,abandonedCount:n.abandonedCount});return e}getActiveConnections(){return this.queues.size+this.topics.size}}class lT{topics=new Map;subscriptions=new Map;topicSubscriptions=new Map;topicMessages=new Map;subscriptionMessages=new Map;unackedMessages=new Map;orderingKeyQueues=new Map;topicState=new Map;subscriptionState=new Map;initialize(e){if(this.topics.clear(),this.subscriptions.clear(),this.topicSubscriptions.clear(),this.topicMessages.clear(),this.subscriptionMessages.clear(),this.unackedMessages.clear(),this.orderingKeyQueues.clear(),this.topicState.clear(),this.subscriptionState.clear(),e.topics)for(const t of e.topics)this.topics.set(t.name,{...t}),this.topicMessages.set(t.name,[]),this.topicSubscriptions.set(t.name,[]),this.orderingKeyQueues.set(t.name,new Map),this.topicState.set(t.name,{messageCount:t.messageCount||0,byteCount:t.byteCount||0,publishedCount:0,lastUpdate:Date.now()});if(e.subscriptions)for(const t of e.subscriptions){this.subscriptions.set(t.name,{...t}),this.subscriptionMessages.set(t.name,[]),this.unackedMessages.set(t.name,[]);const n=this.topicSubscriptions.get(t.topic)||[];n.includes(t.name)||n.push(t.name),this.topicSubscriptions.set(t.topic,n),this.subscriptionState.set(t.name,{messageCount:t.messageCount||0,unackedMessageCount:t.unackedMessageCount||0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:Date.now()})}}publishToTopic(e,t,n,a,r){if(!this.topics.get(e))return null;const l=Date.now(),d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=l,p={id:`pubsub_${d}`,messageId:d,publishTime:h,data:t,attributes:a,orderingKey:r,size:n},m=this.topicMessages.get(e)||[];if(r){const S=this.orderingKeyQueues.get(e)||new Map,C=S.get(r)||[];C.push(p),S.set(r,C),this.orderingKeyQueues.set(e,S)}else m.push(p),this.topicMessages.set(e,m);const y=this.topicSubscriptions.get(e)||[];for(const S of y){const C=this.subscriptions.get(S);if(!C)continue;const E={...p,id:`${p.id}_${S}`},M=this.subscriptionMessages.get(S)||[];C.enableMessageOrdering,M.push(E),this.subscriptionMessages.set(S,M)}const b=this.topicState.get(e)||{messageCount:0,byteCount:0,publishedCount:0,lastUpdate:l};return b.messageCount=m.length+(r&&this.orderingKeyQueues.get(e)?.get(r)?.length||0),b.byteCount=(b.byteCount||0)+n,b.publishedCount=(b.publishedCount||0)+1,b.lastUpdate=l,this.topicState.set(e,b),d}pullFromSubscription(e,t=100){const n=this.subscriptions.get(e);if(!n)return[];const a=this.subscriptionMessages.get(e)||[];if(a.length===0)return[];const r=Date.now(),c=n.ackDeadlineSeconds*1e3,l=[],d=[];if(n.enableMessageOrdering){const m=new Map;for(const y of a){const b=y.orderingKey||"__no_key__";m.has(b)||m.set(b,[]),m.get(b).push(y)}for(const[y,b]of m.entries()){if(l.length>=t)break;const S=Math.min(b.length,t-l.length),C=b.splice(0,S);l.push(...C),d.push(...b)}for(const[y,b]of m.entries())b.length>0&&d.find(S=>(S.orderingKey||"__no_key__")===y)===void 0&&d.push(...b)}else{const m=Math.min(a.length,t);l.push(...a.splice(0,m)),d.push(...a)}this.subscriptionMessages.set(e,d);const h=this.unackedMessages.get(e)||[];for(const m of l){const y=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;m.ackId=y,h.push({message:m,subscriptionName:e,ackDeadlineExpiresAt:r+c,deliveryAttempt:1,orderingKey:m.orderingKey})}this.unackedMessages.set(e,h);const p=this.subscriptionState.get(e)||{messageCount:0,unackedMessageCount:0,deliveredCount:0,acknowledgedCount:0,nackedCount:0,lastUpdate:r};return p.messageCount=d.length,p.unackedMessageCount=h.length,p.deliveredCount=(p.deliveredCount||0)+l.length,p.lastUpdate=r,this.subscriptionState.set(e,p),l}ackMessage(e,t){if(!this.subscriptions.get(e))return!1;const a=this.unackedMessages.get(e)||[],r=a.length,c=a.filter(l=>l.message.ackId!==t);if(this.unackedMessages.set(e,c),c.length<r){const l=this.subscriptionState.get(e);return l&&(l.unackedMessageCount=c.length,l.acknowledgedCount=(l.acknowledgedCount||0)+1,l.lastUpdate=Date.now()),!0}return!1}nackMessage(e,t){if(!this.subscriptions.get(e))return!1;const a=this.unackedMessages.get(e)||[],r=a.findIndex(p=>p.message.ackId===t);if(r===-1)return!1;const l=a[r].message;a.splice(r,1),this.unackedMessages.set(e,a);const d=this.subscriptionMessages.get(e)||[];l.ackId=void 0,d.push(l),this.subscriptionMessages.set(e,d);const h=this.subscriptionState.get(e);return h&&(h.unackedMessageCount=a.length,h.messageCount=d.length,h.nackedCount=(h.nackedCount||0)+1,h.lastUpdate=Date.now()),!0}processConsumption(e){const t=Date.now();for(const[n,a]of this.unackedMessages.entries()){if(!this.subscriptions.get(n))continue;const c=[],l=[];for(const d of a)t>=d.ackDeadlineExpiresAt?c.push(d):l.push(d);if(c.length>0){const d=this.subscriptionMessages.get(n)||[];for(const p of c){const m=p.message;m.ackId=void 0,d.push(m)}this.subscriptionMessages.set(n,d);const h=this.subscriptionState.get(n);h&&(h.unackedMessageCount=l.length,h.messageCount=d.length)}this.unackedMessages.set(n,l)}for(const[n,a]of this.subscriptions.entries())if(a.pushEndpoint){const r=this.subscriptionMessages.get(n)||[];if(r.length>0){const l=Math.min(r.length,10),d=r.splice(0,l),h=this.unackedMessages.get(n)||[],p=Date.now(),m=a.ackDeadlineSeconds*1e3;for(const b of d){const S=`ack_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;b.ackId=S,h.push({message:b,subscriptionName:n,ackDeadlineExpiresAt:p+m,deliveryAttempt:1,orderingKey:b.orderingKey})}this.subscriptionMessages.set(n,r),this.unackedMessages.set(n,h);const y=this.subscriptionState.get(n);y&&(y.messageCount=r.length,y.unackedMessageCount=h.length,y.deliveredCount=(y.deliveredCount||0)+d.length)}}for(const[n,a]of this.topics.entries()){const c=(a.messageRetentionDuration||604800)*1e3,l=this.topicMessages.get(n)||[],d=Date.now(),h=l.filter(p=>d-p.publishTime<c);if(h.length<l.length){l.length-h.length,this.topicMessages.set(n,h);const p=this.topicState.get(n);p&&(p.messageCount=h.length)}}}getTopicMetrics(e){if(!this.topics.get(e))return null;const n=this.topicState.get(e);return n?{messageCount:n.messageCount,byteCount:n.byteCount,publishedCount:n.publishedCount}:null}getSubscriptionMetrics(e){if(!this.subscriptions.get(e))return null;const n=this.subscriptionState.get(e);return n?{messageCount:n.messageCount,unackedMessageCount:n.unackedMessageCount,deliveredCount:n.deliveredCount,acknowledgedCount:n.acknowledgedCount,nackedCount:n.nackedCount}:null}getAllTopicMetrics(){const e=new Map;for(const t of this.topics.keys()){const n=this.getTopicMetrics(t);n&&e.set(t,n)}return e}getAllSubscriptionMetrics(){const e=new Map;for(const t of this.subscriptions.keys()){const n=this.getSubscriptionMetrics(t);n&&e.set(t,n)}return e}getTotalTopicMessages(){let e=0;for(const t of this.topicMessages.values())e+=t.length;for(const t of this.orderingKeyQueues.values())for(const n of t.values())e+=n.length;return e}getTotalUnackedMessages(){let e=0;for(const t of this.unackedMessages.values())e+=t.length;return e}getActiveConnections(){let e=0;for(const t of this.subscriptions.values())t.pushEndpoint,e+=1;return Math.max(1,e+1)}updateTopic(e,t){const n=this.topics.get(e);n&&(Object.assign(n,t),this.topics.set(e,n))}updateSubscription(e,t){const n=this.subscriptions.get(e);n&&(Object.assign(n,t),this.subscriptions.set(e,n))}}class uT{services=new Map;routes=new Map;upstreams=new Map;consumers=new Map;plugins=[];roundRobinCounters=new Map;connectionCounts=new Map;consistentHashRing=new Map;rateLimitCounters=new Map;initialize(e){if(this.services.clear(),this.routes.clear(),this.upstreams.clear(),this.consumers.clear(),this.plugins=[],this.roundRobinCounters.clear(),this.connectionCounts.clear(),this.consistentHashRing.clear(),this.rateLimitCounters.clear(),e.services)for(const t of e.services)this.services.set(t.id,{...t});if(e.routes)for(const t of e.routes)this.routes.set(t.id,{...t});if(e.upstreams){for(const t of e.upstreams)if(this.upstreams.set(t.name,{...t}),this.roundRobinCounters.set(t.name,0),t.algorithm==="consistent-hashing"&&t.targets){const n=[...t.targets].filter(a=>a.health==="healthy").sort((a,r)=>a.target.localeCompare(r.target));this.consistentHashRing.set(t.name,n.map(a=>a.target))}}if(e.consumers)for(const t of e.consumers)this.consumers.set(t.id,{...t});e.plugins&&(this.plugins=e.plugins.filter(t=>t.enabled))}routeRequest(e){const t=Date.now(),n=this.matchRoute(e);if(!n)return{match:null,response:{status:404,error:"No route matched",latency:Date.now()-t}};const a=this.executePlugins(e,n,"access");if(a.blocked)return{match:n,response:{status:a.status||403,error:a.error||"Request blocked by plugin",latency:Date.now()-t}};const r=this.selectUpstreamTarget(n.service);if(!r)return{match:n,response:{status:503,error:"No healthy upstream target available",latency:Date.now()-t}};this.transformPath(e.path,n);const c={status:200,latency:Date.now()-t};return c.latency=(c.latency||0)+this.simulateUpstreamLatency(r),{match:n,response:c,target:r}}matchRoute(e){const t=Array.from(this.routes.values()).sort((n,a)=>(a.priority||0)-(n.priority||0));for(const n of t){if(n.method&&n.method.toUpperCase()!==e.method.toUpperCase())continue;const a=this.matchPath(n.path,e.path);if(a){const r=this.services.get(n.service);if(!r||!r.enabled)continue;return{route:n,service:r,matchedPath:a.matched,remainingPath:a.remaining}}}return null}matchPath(e,t){if(t.startsWith(e))return{matched:e,remaining:t.substring(e.length)};try{if(new RegExp(`^${e}$`).test(t))return{matched:t,remaining:""}}catch{}return null}selectUpstreamTarget(e){const t=e.upstream||e.name,n=this.upstreams.get(t);if(!n||!n.targets||n.targets.length===0)return e.url;const a=n.targets.filter(c=>c.health==="healthy");if(a.length===0)return null;switch(n.algorithm||"round-robin"){case"round-robin":return this.selectRoundRobin(t,a);case"consistent-hashing":return this.selectConsistentHash(t,a,e.name);case"least-connections":return this.selectLeastConnections(a);default:return a[0].target}}selectRoundRobin(e,t){const n=this.roundRobinCounters.get(e)||0,a=t[n%t.length];return this.roundRobinCounters.set(e,(n+1)%t.length),a.target}selectConsistentHash(e,t,n){const r=this.simpleHash(n)%t.length;return t[r].target}selectLeastConnections(e){let t=1/0,n=e[0].target;for(const r of e){const c=this.connectionCounts.get(r.target)||0;c<t&&(t=c,n=r.target)}const a=this.connectionCounts.get(n)||0;return this.connectionCounts.set(n,a+1),n}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t=t&t}return Math.abs(t)}transformPath(e,t){return t.route.stripPath?t.remainingPath||"/":e}executePlugins(e,t,n){const a=this.plugins.filter(r=>!(r.route&&r.route!==t.route.id||r.service&&r.service!==t.service.id));for(const r of a){const c=this.executePlugin(r,e,t,n);if(c.blocked)return c}return{blocked:!1}}executePlugin(e,t,n,a){const r=e.config||{};switch(e.name){case"rate-limiting":return this.executeRateLimiting(e,t,n,r);case"key-auth":return this.executeKeyAuth(e,t,n,r);case"jwt":return this.executeJWT(e,t,n,r);case"cors":return{blocked:!1};case"ip-restriction":return this.executeIPRestriction(e,t,n,r);default:return{blocked:!1}}}executeRateLimiting(e,t,n,a){const r=t.consumerId||n.service.id||n.route.id,c=Date.now();let l=this.rateLimitCounters.get(e.id);l||(l=new Map,this.rateLimitCounters.set(e.id,l));let d=l.get(r);(!d||d.resetAt<c)&&(d={count:0,resetAt:c+6e4},l.set(r,d));const h=a.minute||1e3;return a.hour,d.count++,d.count>h?{blocked:!0,status:429,error:"Rate limit exceeded (per minute)"}:{blocked:!1}}executeKeyAuth(e,t,n,a){const r=a.key_names||["apikey"],c=t.apiKey||t.headers?.[r[0]]||t.query?.[r[0]];return c?Array.from(this.consumers.values()).find(d=>d.credentials?.some(h=>h.type==="key-auth"&&h.key===c))?{blocked:!1}:{blocked:!0,status:401,error:"Invalid API key"}:{blocked:!0,status:401,error:"API key required"}}executeJWT(e,t,n,a){const r=t.headers?.Authorization;return!r||!r.startsWith("Bearer ")?{blocked:!0,status:401,error:"JWT token required"}:{blocked:!1}}executeIPRestriction(e,t,n,a){const r=t.headers?.["X-Forwarded-For"]||t.headers?.["X-Real-IP"]||"unknown",c=a.whitelist||[];return(a.blacklist||[]).includes(r)?{blocked:!0,status:403,error:"IP address blocked"}:c.length>0&&!c.includes(r)?{blocked:!0,status:403,error:"IP address not whitelisted"}:{blocked:!1}}simulateUpstreamLatency(e){return 10+Math.random()*40}getStats(){return{services:this.services.size,routes:this.routes.size,upstreams:this.upstreams.size,consumers:this.consumers.size,plugins:this.plugins.length}}}class dT{proxies=new Map;policies=[];organization;environment;quotaCounters=new Map;spikeArrestBuckets=new Map;apiKeyCache=new Map;oauthTokenCache=new Map;jwtTokenCache=new Map;proxyMetrics=new Map;initialize(e){if(this.proxies.clear(),this.policies=[],this.quotaCounters.clear(),this.spikeArrestBuckets.clear(),this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear(),this.proxyMetrics.clear(),this.organization=e.organization||"archiphoenix-org",this.environment=e.environment||"prod",e.proxies)for(const t of e.proxies)this.proxies.set(t.name,{...t}),this.proxyMetrics.set(t.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),t.spikeArrest&&t.spikeArrest>0&&this.spikeArrestBuckets.set(t.name,{tokens:t.spikeArrest,lastRefill:Date.now(),rate:t.spikeArrest});e.policies&&(this.policies=e.policies.filter(t=>t.enabled))}routeRequest(e){const t=Date.now(),n=this.matchProxy(e);if(!n)return{match:null,response:{status:404,error:"No API proxy matched for path",latency:Date.now()-t}};if(n.proxy.status==="undeployed")return this.updateProxyMetrics(n.proxy.name,!1,Date.now()-t),{match:n,response:{status:503,error:`Proxy '${n.proxy.name}' is not deployed`,latency:Date.now()-t}};const a=this.policies.filter(b=>b.enabled&&(b.executionFlow==="PreFlow"||!b.executionFlow&&this.isPreFlowPolicy(b.type))),r=this.executePolicies(a,e,n,"PreFlow");if(r.blocked)return this.updateProxyMetrics(n.proxy.name,!0,Date.now()-t),{match:n,response:{status:r.status||401,error:r.error||"Authentication failed",latency:Date.now()-t}};const c=this.policies.filter(b=>b.enabled&&(b.executionFlow==="RequestFlow"||!b.executionFlow&&this.isRequestFlowPolicy(b.type))),l=this.executePolicies(c,e,n,"RequestFlow");if(l.blocked)return this.updateProxyMetrics(n.proxy.name,!0,Date.now()-t),{match:n,response:{status:l.status||429,error:l.error||"Request policy violation",latency:Date.now()-t}};const d=this.buildTargetUrl(n.proxy,n.remainingPath),h=this.simulateUpstreamLatency(d),p=Date.now()-t+h,m=this.policies.filter(b=>b.enabled&&(b.executionFlow==="PostFlow"||!b.executionFlow&&this.isPostFlowPolicy(b.type))),y={status:200,latency:p};return this.executePolicies(m,e,n,"PostFlow",y),this.updateProxyMetrics(n.proxy.name,!1,p),{match:n,response:y,target:d}}matchProxy(e){const t=Array.from(this.proxies.values()).filter(n=>n.status==="deployed"||n.status===void 0).sort((n,a)=>a.basePath.length-n.basePath.length);for(const n of t)if(e.path.startsWith(n.basePath)){const a=e.path.slice(n.basePath.length)||"/";return{proxy:n,matchedPath:n.basePath,remainingPath:a}}return null}isPreFlowPolicy(e){return["verify-api-key","oauth","jwt"].includes(e)}isRequestFlowPolicy(e){return["quota","spike-arrest"].includes(e)}isPostFlowPolicy(e){return["cors","xml-to-json"].includes(e)}evaluateCondition(e,t,n){if(!e)return!0;try{if(e.includes("request.path")){const a=e.match(/request\.path\s*[=!]=\s*['"]([^'"]+)['"]/);if(a)return t.path===a[1]}return e.length>0}catch{return!0}}executePolicies(e,t,n,a,r){for(const c of e)if(this.evaluateCondition(c.condition,t,n))if(a==="PreFlow"){const l=this.executePreFlowPolicy(c,t,n);if(l.blocked)return l}else if(a==="RequestFlow"){const l=this.executeRequestFlowPolicy(c,t,n);if(l.blocked)return l}else a==="PostFlow"&&r&&this.executePostFlowPolicy(c,t,n,r);return{blocked:!1}}executePreFlowPolicy(e,t,n){if(n.proxy,e.type==="verify-api-key"){const a=t.apiKey||t.headers?.["X-API-Key"]||t.headers?.apikey||t.query?.apikey;if(!a)return{blocked:!0,status:401,error:"API key is required"};if(!this.validateApiKey(a))return{blocked:!0,status:401,error:"Invalid API key"}}if(e.type==="oauth"&&n.proxy.enableOAuth){const r=t.oauthToken||t.headers?.Authorization?.replace("Bearer ","")||t.headers?.Authorization?.replace("OAuth ","");if(!r)return{blocked:!0,status:401,error:"OAuth token is required"};if(!this.validateOAuthToken(r))return{blocked:!0,status:401,error:"Invalid or expired OAuth token"}}if(e.type==="jwt"){const a=n.proxy;if(a.jwtIssuer){const r=t.jwtToken||t.headers?.Authorization?.replace("Bearer ","")||t.headers?.["X-JWT-Token"];if(!r)return{blocked:!0,status:401,error:"JWT token is required"};if(!this.validateJWTToken(r,a.jwtIssuer))return{blocked:!0,status:401,error:"Invalid or expired JWT token"}}}return{blocked:!1}}executeRequestFlowPolicy(e,t,n){const a=n.proxy,r=t.headers?.["X-Consumer-ID"]||"default";if(e.type==="quota"){const c=e.config?.quota||a.quota,l=e.config?.interval||a.quotaInterval;if(c&&l&&!this.checkQuota(a.name,r,c,l))return{blocked:!0,status:429,error:`Quota exceeded: ${c} requests per ${l} seconds`}}if(e.type==="spike-arrest"){const c=e.config?.rate||a.spikeArrest;if(c&&c>0&&!this.checkSpikeArrest(a.name,c))return{blocked:!0,status:429,error:`Spike arrest limit exceeded: ${c} requests per second`}}return{blocked:!1}}executePostFlowPolicy(e,t,n,a){e.type==="cors"&&(a.headers||(a.headers={}),a.headers["Access-Control-Allow-Origin"]=e.config?.origins?.[0]||"*",a.headers["Access-Control-Allow-Methods"]=e.config?.methods?.join(", ")||"GET, POST, PUT, DELETE",a.headers["Access-Control-Allow-Headers"]=e.config?.headers?.join(", ")||"Content-Type, Authorization"),e.type==="xml-to-json"&&(a.headers||(a.headers={}),a.headers["Content-Type"]="application/json")}checkQuota(e,t,n,a){const r=Date.now(),c=a*1e3;let l=this.quotaCounters.get(e);l||(l=new Map,this.quotaCounters.set(e,l));let d=l.get(t);return(!d||d.resetAt<r)&&(d={count:0,resetAt:r+c,identifier:t},l.set(t,d)),d.count>=n?!1:(d.count++,!0)}checkSpikeArrest(e,t){const n=Date.now();let a=this.spikeArrestBuckets.get(e);a||(a={tokens:t,lastRefill:n,rate:t},this.spikeArrestBuckets.set(e,a));const c=(n-a.lastRefill)/1e3*a.rate;return a.tokens=Math.min(a.rate,a.tokens+c),a.lastRefill=n,a.tokens<1?!1:(a.tokens-=1,!0)}validateApiKey(e){const t=this.apiKeyCache.get(e);if(t&&t.expiresAt>Date.now())return t.valid;const n=e.length>=10;return this.apiKeyCache.set(e,{valid:n,expiresAt:Date.now()+300*1e3}),n}validateOAuthToken(e){const t=this.oauthTokenCache.get(e);if(t&&t.expiresAt>Date.now())return t.valid;const n=e.length>=20;return this.oauthTokenCache.set(e,{valid:n,expiresAt:Date.now()+3600*1e3}),n}validateJWTToken(e,t){const n=this.jwtTokenCache.get(e);if(n&&n.expiresAt>Date.now())return n.valid&&n.issuer===t;const a=e.length>=20;return this.jwtTokenCache.set(e,{valid:a,issuer:t,expiresAt:Date.now()+3600*1e3}),a}buildTargetUrl(e,t){const n=e.targetEndpoint.replace(/\/$/,""),a=t.startsWith("/")?t:`/${t}`;return`${n}${a}`}simulateUpstreamLatency(e){const t=10+Math.random()*40,n=(Math.random()-.5)*10;return Math.max(1,t+n)}updateProxyMetrics(e,t,n){const a=this.proxyMetrics.get(e);a&&(a.requestCount++,t&&a.errorCount++,a.totalLatency+=n,a.lastRequestTime=Date.now())}getStats(){let e=0,t=0,n=0;for(const r of this.proxyMetrics.values())e+=r.requestCount,t+=r.errorCount,n+=r.totalLatency;const a=e>0?n/e:0;return{proxies:this.proxies.size,policies:this.policies.length,totalRequests:e,totalErrors:t,avgLatency:a}}getProxyMetrics(e){const t=this.proxyMetrics.get(e);return t?{requestCount:t.requestCount,errorCount:t.errorCount,avgResponseTime:t.requestCount>0?t.totalLatency/t.requestCount:0}:null}clearCaches(){this.apiKeyCache.clear(),this.oauthTokenCache.clear(),this.jwtTokenCache.clear()}}class fT{applications=new Map;connectors=new Map;organization;environment;applicationMetrics=new Map;connectorMetrics=new Map;reconnectionState=new Map;initialize(e){if(this.applications.clear(),this.connectors.clear(),this.applicationMetrics.clear(),this.connectorMetrics.clear(),this.reconnectionState.clear(),this.organization=e.organization||"archiphoenix-org",this.environment=e.environment||"production",e.applications)for(const t of e.applications)this.applications.set(t.name,{...t}),this.applicationMetrics.set(t.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0});if(e.connectors)for(const t of e.connectors)this.connectors.set(t.name,{...t}),this.connectorMetrics.set(t.name,{requestCount:0,errorCount:0,totalLatency:0,lastRequestTime:0}),this.reconnectionState.set(t.name,{attempts:0,lastAttempt:0,nextAttempt:0})}processData(e){const t=Date.now(),n=this.matchApplication(e);if(!n)return{match:null,response:{status:"error",error:"No Mule application matched for request",latency:Date.now()-t}};if(n.application.status!=="running")return this.updateApplicationMetrics(n.application.name,!1,Date.now()-t),{match:n,response:{status:"error",error:`Application '${n.application.name}' is not running (status: ${n.application.status})`,latency:Date.now()-t}};let a=0,r;try{a=this.processFlow(n,e)}catch(l){r=l instanceof Error?l.message:"Unknown error"}if(r&&!this.handleError(n.application,r))return this.updateApplicationMetrics(n.application.name,!0,Date.now()-t),{match:n,response:{status:"error",error:r,latency:Date.now()-t,application:n.application.name,flow:n.flow?.name}};const c=this.transformData(e,n);return this.updateApplicationMetrics(n.application.name,!1,Date.now()-t),n.matchedConnector&&this.updateConnectorMetrics(n.matchedConnector.name,!1,Date.now()-t),{match:n,response:{status:"success",data:c.data,format:c.format||e.format,latency:Date.now()-t,application:n.application.name,flow:n.flow?.name,connector:n.matchedConnector?.name}}}matchApplication(e){if(e.sourceComponentType||e.targetComponentType)for(const[t,n]of this.applications.entries()){if(n.status!=="running")continue;const a=this.findMatchingConnector(n,e.sourceComponentType,e.targetComponentType);if(a){const r=n.flows?.find(c=>c.source===a.name||c.target===a.name)||n.flows?.[0];return{application:n,flow:r,matchedConnector:a}}}for(const[t,n]of this.applications.entries())if(n.status==="running")return{application:n,flow:n.flows?.[0]};return null}findMatchingConnector(e,t,n){const a=e.connectors||[];for(const r of a){const c=this.connectors.get(r);if(!(!c||!c.enabled)&&(t&&this.connectorMatchesComponentType(c,t)||n&&this.connectorMatchesComponentType(c,n)))return c}return null}connectorMatchesComponentType(e,t){const n={database:["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],api:["rest","grpc","graphql","soap","websocket","webhook"],messaging:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],file:["s3-datalake"],business:["crm","erp","payment-gateway"]};for(const[a,r]of Object.entries(n))if(e.type===a&&r.includes(t))return!0;return e.targetComponentType===t}processFlow(e,t){if(!e.flow)return this.calculateBaseProcessingTime(e.application);let n=this.calculateBaseProcessingTime(e.application);if(e.flow.processors)for(const a of e.flow.processors)n+=this.processProcessor(a,t);return e.matchedConnector&&(n+=this.calculateConnectorLatency(e.matchedConnector)),n}calculateBaseProcessingTime(e){const t=5+Math.random()*10,n=parseFloat(e.runtimeVersion)>=4.5?.9:1;return t*n}processProcessor(e,t){switch(e.type){case"transform":return 2+Math.random()*6;case"validate":return 1+Math.random()*2;case"filter":return .5+Math.random()*1.5;case"enrich":return 3+Math.random()*7;case"route":return .5+Math.random()*.5;default:return 1}}calculateConnectorLatency(e){const n={database:10,api:20,messaging:5,file:50,custom:15}[e.type]||15,a=n*.5*Math.random();return n+a}transformData(e,t){if(e.targetComponentType){const n=this.getTargetFormat(e.targetComponentType);if(n&&n!==e.format)return{data:e.body,format:n}}return{data:e.body,format:e.format}}getTargetFormat(e){return{postgres:"json",mongodb:"json",redis:"json",rest:"json",graphql:"json",soap:"xml",grpc:"binary",kafka:"json",rabbitmq:"json"}[e]}handleError(e,t){switch(e.errorStrategy||"continue"){case"continue":return!0;case"rollback":return!1;case"propagate":return!1;default:return!1}}updateApplicationMetrics(e,t,n){const a=this.applicationMetrics.get(e);a&&(a.requestCount++,t&&a.errorCount++,a.totalLatency+=n,a.lastRequestTime=Date.now())}updateConnectorMetrics(e,t,n){const a=this.connectorMetrics.get(e);a&&(a.requestCount++,t&&a.errorCount++,a.totalLatency+=n,a.lastRequestTime=Date.now())}getStats(){let e=0,t=0,n=0;for(const c of this.applicationMetrics.values())e+=c.requestCount,t+=c.errorCount,n+=c.totalLatency;const a=Array.from(this.applications.values()).filter(c=>c.status==="running").length,r=Array.from(this.connectors.values()).filter(c=>c.enabled).length;return{applications:this.applications.size,runningApplications:a,connectors:this.connectors.size,enabledConnectors:r,totalRequests:e,totalErrors:t,avgLatency:e>0?n/e:0}}getApplicationMetrics(e){const t=this.applicationMetrics.get(e);return t?{requestCount:t.requestCount,errorCount:t.errorCount,avgLatency:t.requestCount>0?t.totalLatency/t.requestCount:0}:null}getConnectorMetrics(e){const t=this.connectorMetrics.get(e);return t?{requestCount:t.requestCount,errorCount:t.errorCount,avgLatency:t.requestCount>0?t.totalLatency/t.requestCount:0}:null}}class hT{parseQuery(e){const t=e.query.trim(),n=this.extractOperationType(t),a=e.operationName||this.extractOperationName(t),r=this.extractFields(t),c=this.calculateDepth(t),l=this.estimateComplexity(t,a);return{operationName:a,operationType:n,fields:r,depth:c,complexity:l,rawQuery:t}}extractOperationType(e){const t=e.trim();return t.startsWith("mutation")?"mutation":t.startsWith("subscription")?"subscription":"query"}extractOperationName(e){const t=e.match(/(?:query|mutation|subscription)\s+([a-zA-Z0-9_]+)/);return t?t[1]:void 0}extractFields(e){const t=[],n=/([a-zA-Z0-9_]+)\s*(?:\(|\{)/g;let a;for(;(a=n.exec(e))!==null;)t.push(a[1]);return t.length>0?t:["unknown"]}calculateDepth(e){let t=0,n=0;for(const a of e)a==="{"?(t+=1,n=Math.max(n,t)):a==="}"&&(t=Math.max(0,t-1));return n}estimateComplexity(e,t){const n=e.match(/[a-zA-Z0-9_]+(\s*[({])/g),a=n?n.length:5,r=this.calculateDepth(e),c=t?Math.max(1,t.length%5):1;return Math.round(a*(1+r*.5)*c*10)}}class pT{federationConfig;constructor(e){this.federationConfig=e}planQuery(e,t){if(t.length===0)return{subqueries:[],requiresFederation:!1,estimatedLatency:0};const n=this.federationConfig?.enabled??!1,r=this.selectServices(e,t).map(d=>({serviceId:d.id,serviceName:d.name,endpoint:d.endpoint,query:e.rawQuery,fields:e.fields,estimatedLatency:this.estimateServiceLatency(d,e)})),c=r.reduce((d,h)=>d+h.estimatedLatency,0),l=n?3+Math.random()*5:0;return{subqueries:r,requiresFederation:n,estimatedLatency:c+l}}selectServices(e,t){if(this.federationConfig?.enabled&&this.federationConfig.services?.length){const r=t.filter(c=>this.federationConfig.services.includes(c.name));return r.length>0?r:t.slice(0,Math.min(2,t.length))}const n=this.hashString(e.operationName||e.rawQuery),a=Math.abs(n)%t.length;return[t[a]]}estimateServiceLatency(e,t){const n=e.avgLatencyMs,a=Math.sqrt(t.complexity)*.8,r=t.depth*1.5,c=Math.random()*5;return n+a+r+c}hashString(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t|=0}return t}updateFederationConfig(e){this.federationConfig=e}}class gT{serviceRegistry;constructor(e){this.serviceRegistry=e}executePlan(e){if(e.subqueries.length===0)return{success:!1,totalLatency:0,error:"No services available",executedEndpoints:[]};let t=0;const n=[];for(const a of e.subqueries){const r=this.serviceRegistry.getService(a.serviceId);if(!r)return{success:!1,totalLatency:t,error:`Service ${a.serviceId} not found`,failedService:a.serviceId,executedEndpoints:n};const c=a.endpoint||r.endpoint;n.push(c);const d=this.getEndpointLatency(c,r.avgLatencyMs)+(a.estimatedLatency-r.avgLatencyMs);if(t+=d,Math.random()<r.errorRate)return this.serviceRegistry.recordRequest(r.id,d,!1),{success:!1,totalLatency:t,error:`Upstream error at ${r.name} (${c})`,failedService:r.id,executedEndpoints:n};this.serviceRegistry.recordRequest(r.id,d,!0)}return{success:!0,totalLatency:t,executedEndpoints:n}}getEndpointLatency(e,t){return e.includes("localhost")||e.includes("127.0.0.1")?t*.8:e.includes("https://")?t*1.1:t}}class mT{services=new Map;registerService(e){const t=this.services.get(e.id);this.services.set(e.id,{id:e.id,name:e.name,endpoint:e.endpoint,avgLatencyMs:e.avgLatencyMs??20,errorRate:e.errorRate??.01,status:e.status??"connected",rollingLatency:t?.rollingLatency||[],rollingErrors:t?.rollingErrors||[]})}unregisterService(e){this.services.delete(e)}getConnectedServices(){return Array.from(this.services.values()).filter(e=>e.status==="connected")}getService(e){return this.services.get(e)}getServiceByName(e){return Array.from(this.services.values()).find(t=>t.name===e)}recordRequest(e,t,n){const a=this.services.get(e);if(!a)return;a.rollingLatency.push(t),a.rollingLatency.length>50&&a.rollingLatency.shift(),n||(a.rollingErrors.push(t),a.rollingErrors.length>50&&a.rollingErrors.shift());const r=a.rollingLatency.reduce((l,d)=>l+d,0)/a.rollingLatency.length;a.avgLatencyMs=r;const c=a.rollingErrors.length/Math.max(a.rollingLatency.length,1);a.errorRate=c}initialize(e){this.services.clear();for(const t of e)this.registerService(t)}getAllServices(){return Array.from(this.services.values())}}class yT{cache=new Map;ttl;persistQueries;constructor(e=0,t=!1){this.ttl=e,this.persistQueries=t}generateCacheKey(e,t){const n=t?JSON.stringify(t):"";return this.hashString(e+n)}getCached(e,t){if(this.ttl<=0||!this.persistQueries)return{hit:!1,latencyReduction:0};const n=this.generateCacheKey(e,t),a=this.cache.get(n);return a?Date.now()-a.timestamp>a.ttl*1e3?(this.cache.delete(n),{hit:!1,latencyReduction:0}):{hit:!0,latencyReduction:.7}:{hit:!1,latencyReduction:0}}setCached(e,t,n){if(this.ttl<=0||!this.persistQueries)return;const a=this.generateCacheKey(e,n);if(this.cache.set(a,{query:e,response:t,timestamp:Date.now(),ttl:this.ttl}),this.cache.size>1e3){const r=this.cache.keys().next().value;this.cache.delete(r)}}getCacheHitProbability(e){if(this.ttl<=0||!this.persistQueries)return 0;const t=.2,n=Math.min(e.complexity/2e3,.4);return Math.min(t+n,.6)}updateConfig(e,t){e!==void 0&&(this.ttl=e),t!==void 0&&(this.persistQueries=t)}clearCache(){this.cache.clear()}hashString(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t|=0}return Math.abs(t).toString(16)}}class vT{enabled;limits=new Map;defaultLimit=100;windowMs=6e4;constructor(e=!1,t=100){this.enabled=e,this.defaultLimit=t}checkLimit(e,t){if(!this.enabled)return{allowed:!0,remaining:1/0,resetAt:Date.now()+this.windowMs};const n=t||this.defaultLimit,a=Date.now(),r=this.limits.get(e);if(!r||a>=r.resetAt){const c={count:1,resetAt:a+this.windowMs,windowStart:a};return this.limits.set(e,c),{allowed:!0,remaining:n-1,resetAt:c.resetAt}}return r.count>=n?{allowed:!1,remaining:0,resetAt:r.resetAt}:(r.count+=1,{allowed:!0,remaining:n-r.count,resetAt:r.resetAt})}getIdentifier(e){if(!e)return"default";const t=e["x-api-key"]||e.apikey;if(t)return`key:${t}`;const n=e["x-client-id"];return n?`client:${n}`:"default"}setEnabled(e){this.enabled=e}updateDefaultLimit(e){this.defaultLimit=e}clearLimits(){this.limits.clear()}}class bT{maxQueryDepth;maxQueryComplexity;enabled;constructor(e=15,t=1e3,n=!0){this.maxQueryDepth=e,this.maxQueryComplexity=t,this.enabled=n}validateQuery(e){return this.enabled?e.depth>this.maxQueryDepth?{valid:!1,error:`Query depth ${e.depth} exceeds limit ${this.maxQueryDepth}`}:e.complexity>this.maxQueryComplexity?{valid:!1,error:`Query complexity ${e.complexity} exceeds limit ${this.maxQueryComplexity}`}:{valid:!0}:{valid:!0}}updateLimits(e,t){e!==void 0&&(this.maxQueryDepth=e),t!==void 0&&(this.maxQueryComplexity=t)}setEnabled(e){this.enabled=e}}class xT{config;constructor(e){this.config=e}isEnabled(){return this.config?.enabled??!1}getVersion(){return this.config?.version}getFederatedServices(){return this.config?.services||[]}getPlanningOverhead(){return this.isEnabled()?(this.config?.version==="2"?2:4)+Math.random()*3:0}isFederatedService(e){return this.isEnabled()?this.config?.services?.includes(e.name)??!1:!1}getSupergraphSchema(){return this.config?.supergraph}updateConfig(e){this.config=e}}class wT{queryParser;queryPlanner;queryExecutor;serviceRegistry;cacheManager;rateLimiter;complexityAnalyzer;federationComposer;constructor(){this.serviceRegistry=new mT,this.queryParser=new hT,this.queryPlanner=new pT,this.queryExecutor=new gT(this.serviceRegistry),this.cacheManager=new yT,this.rateLimiter=new vT,this.complexityAnalyzer=new bT,this.federationComposer=new xT}initialize(e){e.services&&this.serviceRegistry.initialize(e.services),this.federationComposer.updateConfig(e.federation),this.queryPlanner.updateFederationConfig(e.federation),this.cacheManager.updateConfig(e.cacheTtl??0,e.persistQueries??!1),this.rateLimiter.setEnabled(e.enableRateLimiting??!1),this.complexityAnalyzer.updateLimits(e.maxQueryDepth??15,e.maxQueryComplexity??1e3),this.complexityAnalyzer.setEnabled(e.enableQueryComplexityAnalysis??!0)}routeRequest(e){const t=Date.now();if(!e.query||e.query.trim().length===0)return{status:400,latency:Date.now()-t,error:"Empty query"};const n=this.rateLimiter.getIdentifier(e.headers);if(!this.rateLimiter.checkLimit(n).allowed)return{status:429,latency:Date.now()-t,error:"Rate limit exceeded"};const r=this.queryParser.parseQuery(e),c=this.cacheManager.getCached(e.query,e.variables);if(c.hit)return{status:200,latency:(Date.now()-t)*(1-c.latencyReduction)};const l=this.complexityAnalyzer.validateQuery(r);if(!l.valid)return{status:413,latency:Date.now()-t,error:l.error};const d=this.serviceRegistry.getConnectedServices();if(d.length===0)return{status:503,latency:Date.now()-t,error:"No connected services"};const h=this.queryPlanner.planQuery(r,d),p=this.queryExecutor.executePlan(h);return p.success?(this.cacheManager.setCached(e.query,{success:!0},e.variables),{status:200,latency:p.totalLatency+(Date.now()-t)}):{status:502,latency:p.totalLatency+(Date.now()-t),error:p.error}}getServiceRegistry(){return this.serviceRegistry}getCacheManager(){return this.cacheManager}getRateLimiter(){return this.rateLimiter}}class ST{backends=new Map;endpoints=new Map;config={};circuitBreakers=new Map;cache=new Map;cacheMode="memory";defaultCacheTtl=5;redisEngine=null;redisNodeId="";backendMetrics=new Map;batchQueue=new Map;batchTimer=null;batchSize=10;batchTimeout=50;initialize(e){if(this.config=e,this.backends.clear(),this.endpoints.clear(),this.circuitBreakers.clear(),this.cache.clear(),this.backendMetrics.clear(),this.cacheMode=e.cacheMode||"memory",this.defaultCacheTtl=e.cacheTtl||5,this.redisEngine=e.redisEngine||null,this.redisNodeId=e.redisNodeId||"",e.backends)for(const t of e.backends)this.backends.set(t.id,{...t}),this.initializeCircuitBreaker(t.id,t.circuitBreaker),this.initializeBackendMetrics(t.id);if(e.endpoints)for(const t of e.endpoints)this.endpoints.set(t.id,{...t})}initializeCircuitBreaker(e,t){t?.enabled&&this.circuitBreakers.set(e,{failures:0,successes:0,state:"closed",lastFailureTime:0,nextAttemptTime:0})}initializeBackendMetrics(e){this.backendMetrics.set(e,{requestCount:0,errorCount:0,totalLatency:0,averageLatency:0,lastRequestTime:0,cacheHits:0,cacheMisses:0})}routeRequest(e){const t=Date.now(),n=this.matchEndpoint(e);if(!n)return{status:404,error:"Endpoint not found",latency:Date.now()-t,backendResponses:[],cacheHit:!1};if(this.config.enableCaching&&this.cacheMode!=="off"){const c=this.getCacheKey(n,e),l=this.getCached(c);if(l){const d=this.backendMetrics.get(n.backends[0])||this.initializeBackendMetrics(n.backends[0]);return d&&d.cacheHits++,{status:200,data:l.data,latency:Date.now()-t,backendResponses:[],cacheHit:!0}}}const a=this.aggregateBackends(n,e),r=this.aggregateResponses(n,a);if(this.config.enableCaching&&this.cacheMode!=="off"&&r.status===200){const c=this.getCacheKey(n,e),l=n.cacheTtl||this.defaultCacheTtl;this.setCached(c,r.data,l)}for(const c of a){const l=this.backendMetrics.get(c.backendId);l&&(l.requestCount++,c.status>=400&&l.errorCount++,l.totalLatency+=c.latency,l.averageLatency=l.totalLatency/l.requestCount,l.lastRequestTime=Date.now(),c.cached||l.cacheMisses++)}return{...r,latency:Date.now()-t,backendResponses:a,cacheHit:!1}}matchEndpoint(e){for(const t of this.endpoints.values())if(t.path===e.path&&t.method===e.method)return t;return null}aggregateBackends(e,t){const n=e.backends;switch(e.aggregator){case"parallel":return this.executeBackendsParallel(n,t,e);case"sequential":return this.executeBackendsSequential(n,t,e);case"merge":default:return this.executeBackendsParallel(n,t,e)}}executeBackendsParallel(e,t,n){const a=[];for(const r of e){const c=this.executeBackend(r,t,n);a.push(c)}return a}executeBackendsSequential(e,t,n){const a=[];let r={};for(const c of e){const l={...t,body:{...typeof t.body=="object"?t.body:{},...r}},d=this.executeBackend(c,l,n);if(a.push(d),d.status>=200&&d.status<300&&d.data)typeof d.data=="object"&&(r={...r,...d.data});else break}return a}executeBackend(e,t,n){const a=this.backends.get(e);if(!a)return{backendId:e,status:503,error:"Backend not found",latency:0,cached:!1};const r=this.circuitBreakers.get(e);if(r){const p=Date.now();if(r.state==="open"){if(p<r.nextAttemptTime)return{backendId:e,status:503,error:"Circuit breaker is open",latency:0,cached:!1};r.state="half-open"}}if(this.config.enableCaching&&this.cacheMode!=="off"){const p=`${e}:${n.path}:${JSON.stringify(t.query||{})}`,m=this.getCached(p);if(m)return{backendId:e,status:200,data:m.data,latency:1,cached:!0}}n.timeout||a.timeout||this.config.defaultTimeout;const c=a.retries||0,l=a.retryBackoff||"exponential";let d,h=0;for(let p=0;p<=c;p++){if(p>0){const E=this.calculateBackoff(p,l);h+=E}const m=50+Math.random()*150,y=(Math.random()-.5)*20,b=m+y;h+=b;const S=a.status==="connected"?.95:.5;if(Math.random()<S){r&&(r.state==="half-open"?(r.successes++,r.successes>=(a.circuitBreaker?.successThreshold||2)&&(r.state="closed",r.failures=0,r.successes=0)):r.failures=Math.max(0,r.failures-1));const E=this.generateMockResponse(a,t);return{backendId:e,status:200,data:E,latency:h,cached:!1}}else d=`Backend error (attempt ${p+1}/${c+1})`,r&&(r.failures++,r.lastFailureTime=Date.now(),r.failures>=(a.circuitBreaker?.failureThreshold||5)&&(r.state="open",r.nextAttemptTime=Date.now()+(a.circuitBreaker?.timeout||6e4)))}return{backendId:e,status:503,error:d||"Backend request failed",latency:h,cached:!1}}calculateBackoff(e,t){switch(t){case"exponential":return Math.min(1e3*Math.pow(2,e-1),1e4);case"linear":return 100*e;case"constant":default:return 100}}generateMockResponse(e,t){const n=e.name.toLowerCase();return n.includes("user")||n.includes("profile")?{id:Math.floor(Math.random()*1e3),name:"John Doe",email:"john.doe@example.com",avatar:"https://example.com/avatar.jpg"}:n.includes("order")||n.includes("cart")?{id:Math.floor(Math.random()*1e3),items:[{id:1,name:"Product 1",price:29.99,quantity:2},{id:2,name:"Product 2",price:49.99,quantity:1}],total:109.97}:n.includes("product")||n.includes("catalog")?{products:[{id:1,name:"Product 1",price:29.99,inStock:!0},{id:2,name:"Product 2",price:49.99,inStock:!0}],total:2}:{data:"Mock response",timestamp:Date.now()}}aggregateResponses(e,t){if(t.length===0)return{status:503,error:"No backends configured for endpoint"};if(t.every(r=>r.status>=400))return{status:503,error:"All backends failed"};const a=t.some(r=>r.status>=400);if(e.aggregator==="merge"||e.aggregator==="parallel"){const r={};for(const c of t)if(c.status>=200&&c.status<300&&c.data){const d=this.backends.get(c.backendId)?.name||c.backendId;typeof c.data=="object"&&c.data,r[d]=c.data}return{status:a?207:200,data:r}}else{const r=t[t.length-1];return r.status>=200&&r.status<300?{status:200,data:r.data}:{status:r.status,error:r.error}}}getCacheKey(e,t){return e.cacheKey?e.cacheKey:`${e.path}:${e.method}:${JSON.stringify(t.query||{})}`}getCached(e){if(this.cacheMode==="off")return null;if(this.cacheMode==="redis"&&this.redisEngine){const n=this.getRedisCacheKey(e),a=this.redisEngine.executeCommand("GET",[n]);if(a.success&&a.value!==null)try{const r=typeof a.value=="string"?JSON.parse(a.value):a.value;return{key:e,data:r,expiresAt:Date.now()+this.defaultCacheTtl*1e3,hitCount:1}}catch{return null}return null}const t=this.cache.get(e);return t?Date.now()>t.expiresAt?(this.cache.delete(e),null):(t.hitCount++,t):null}setCached(e,t,n){if(this.cacheMode!=="off"){if(this.cacheMode==="redis"&&this.redisEngine){const a=this.getRedisCacheKey(e),r=typeof t=="string"?t:JSON.stringify(t),c=[a,r];n>0&&c.push("EX",String(n)),this.redisEngine.executeCommand("SET",c);return}this.cache.set(e,{key:e,data:t,expiresAt:Date.now()+n*1e3,hitCount:0}),this.cache.size>1e3&&this.cleanupCache()}}getRedisCacheKey(e){return`${this.redisNodeId?`bff:${this.redisNodeId}:`:"bff:"}${e}`}cleanupCache(){const e=Date.now();for(const[t,n]of this.cache.entries())e>n.expiresAt&&this.cache.delete(t)}getStats(){let e=0,t=0,n=0,a=0,r=0;const c={};for(const[l,d]of this.backendMetrics.entries())e+=d.requestCount,t+=d.errorCount,n+=d.totalLatency,a+=d.cacheHits,r+=d.cacheMisses,c[l]={...d};return{totalRequests:e,totalErrors:t,averageLatency:e>0?n/e:0,cacheHitRate:a+r>0?a/(a+r):0,backendStats:c}}getBackendMetrics(e){return this.backendMetrics.get(e)}getBackends(){return Array.from(this.backends.values())}getEndpoints(){return Array.from(this.endpoints.values())}updateBackendStatus(e,t){const n=this.backends.get(e);n&&(n.status=t)}}class CT{relays=new Map;config={};deliveries=new Map;pendingDeliveries=new Map;relayMetrics=new Map;initialize(e){if(this.config=e,this.relays.clear(),this.deliveries.clear(),this.pendingDeliveries.clear(),this.relayMetrics.clear(),e.relays)for(const t of e.relays)t.enabled&&(this.relays.set(t.id,{...t}),this.initializeRelayMetrics(t.id))}initializeRelayMetrics(e){this.relayMetrics.set(e,{totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0})}relayWebhook(e){const t=Date.now(),n=this.findMatchingRelay(e);if(!n)return{success:!1,status:404,latency:Date.now()-t,attempts:0,error:"No matching relay found"};if(n.allowedIps&&n.allowedIps.length>0&&e.ip&&!this.isIpAllowed(e.ip,n.allowedIps))return this.updateRelayMetrics(n.id,!1,Date.now()-t),{success:!1,status:403,latency:Date.now()-t,attempts:0,error:"IP address not allowed",relayId:n.id};if(this.config.enableSignatureVerification&&n.signatureSecret&&!this.verifySignature(e,n.signatureSecret,n.signatureHeader||"X-Signature"))return this.updateRelayMetrics(n.id,!1,Date.now()-t),{success:!1,status:401,latency:Date.now()-t,attempts:0,error:"Invalid signature",relayId:n.id};let a=e.body;n.transformTemplate&&(a=this.transformPayload(e.body,n.transformTemplate));const r=this.deliverWebhook(n,{...e,body:a});return this.updateRelayMetrics(n.id,r.success,r.latency),{...r,relayId:n.id}}findMatchingRelay(e){for(const t of this.relays.values())if(e.url.startsWith(t.sourceUrl)||t.sourceUrl==="*"||e.url.includes(t.sourceUrl)){if(t.events&&t.events.length>0){const n=e.event||e.headers["x-event"]||e.headers["x-github-event"]||"";if(!t.events.includes(n)&&n!=="")continue}return t}return null}isIpAllowed(e,t){for(const n of t)if(this.matchesCidr(e,n))return!0;return!1}matchesCidr(e,t){if(t==="*"||t===e)return!0;if(t.includes("/")){const[n,a]=t.split("/"),r=parseInt(a,10),c=n.split("."),l=e.split(".");if(c.length!==4||l.length!==4)return!1;const d=Math.floor(r/8);for(let h=0;h<d;h++)if(c[h]!==l[h])return!1;return!0}return e===t}verifySignature(e,t,n){const a=e.headers[n.toLowerCase()]||e.headers[n]||e.headers["x-signature"]||e.headers["x-hub-signature-256"];return a?(typeof e.body=="string"?e.body:JSON.stringify(e.body),a.length>0&&t.length>0):!1}transformPayload(e,t){try{let n=t;if(n.includes("{{raw}}")){const a=typeof e=="string"?e:JSON.stringify(e);n=n.replace(/\{\{raw\}\}/g,a)}if(n.includes("{{json}}")){const a=typeof e=="string"?JSON.parse(e):e;n=n.replace(/\{\{json\}\}/g,JSON.stringify(a))}try{return JSON.parse(n)}catch{return n}}catch{return e}}deliverWebhook(e,t){const n=e.maxRetryAttempts||this.config.maxRetryAttempts||3,a=e.retryDelay||this.config.retryDelay||5,r=e.timeout||this.config.timeout||30,c=this.config.enableRetryOnFailure!==!1,l=e.retryBackoff||"exponential";let d=0,h,p;const m=Date.now();for(;d<n;){d++;const S=this.simulateHttpRequest(e.targetUrl,t,r);if(S.success){const C=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,E={id:C,relayId:e.id,event:t.event||"unknown",payload:typeof t.body=="string"?t.body:JSON.stringify(t.body),status:"success",timestamp:new Date().toISOString(),attempts:d,responseCode:S.statusCode};return this.deliveries.set(C,E),{success:!0,status:S.statusCode||200,latency:Date.now()-m,deliveryId:C,attempts:d}}if(h=S.error,p=S.statusCode,!c||d>=n)break;this.calculateRetryDelay(d,a,l)}const y=`delivery-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,b={id:y,relayId:e.id,event:t.event||"unknown",payload:typeof t.body=="string"?t.body:JSON.stringify(t.body),status:"failed",timestamp:new Date().toISOString(),attempts:d,responseCode:p,error:h};return this.deliveries.set(y,b),{success:!1,status:p||500,latency:Date.now()-m,deliveryId:y,attempts:d,error:h||"Delivery failed after all retry attempts"}}simulateHttpRequest(e,t,n){const a=10+Math.random()*40,r=5+Math.random()*95,c=Math.random()<.05;if(Math.random()<.02)return{success:!1,statusCode:504,error:"Request timeout",latency:n*1e3};if(c){const d=[500,502,503,429],h=d[Math.floor(Math.random()*d.length)];return{success:!1,statusCode:h,error:`HTTP ${h} error`,latency:a+r}}return{success:!0,statusCode:200,latency:a+r}}calculateRetryDelay(e,t,n){switch(n){case"exponential":return t*Math.pow(2,e-1);case"linear":return t*e;case"constant":default:return t}}updateRelayMetrics(e,t,n){let a=this.relayMetrics.get(e);a||(a={totalRequests:0,successfulDeliveries:0,failedDeliveries:0,totalRetries:0,averageLatency:0,totalLatency:0,lastRequestTime:0},this.relayMetrics.set(e,a)),a.totalRequests++,a.totalLatency+=n,a.averageLatency=a.totalLatency/a.totalRequests,a.lastRequestTime=Date.now(),t?a.successfulDeliveries++:a.failedDeliveries++}getDeliveries(e){const t=Array.from(this.deliveries.values());return e?t.filter(n=>n.relayId===e):t}getRelayMetrics(e){return this.relayMetrics.get(e)}getAllRelayMetrics(){return new Map(this.relayMetrics)}getRelay(e){return this.relays.get(e)}getAllRelays(){return Array.from(this.relays.values())}}class MT{keys=new Map;config={};maxMemoryBytes=256*1024*1024;currentMemoryUsage=0;metrics={totalKeys:0,keysByType:{string:0,hash:0,list:0,set:0,zset:0,stream:0},memoryUsage:0,memoryUsagePercent:0,operationsPerSecond:0,hitCount:0,missCount:0,hitRate:0,expiredKeys:0,evictedKeys:0,connectedClients:0};operationCount=0;lastMetricsUpdate=Date.now();operationHistory=[];clusterSlots=new Map;clusterNodes=[];initialize(e){if(this.config={...e},this.keys.clear(),this.currentMemoryUsage=0,this.operationCount=0,this.lastMetricsUpdate=Date.now(),this.operationHistory=[],e.maxMemory&&(this.maxMemoryBytes=this.parseMemorySize(e.maxMemory)),e.enableCluster&&e.clusterNodes&&(this.clusterNodes=[...e.clusterNodes],this.initializeClusterSlots()),e.keys)for(const t of e.keys)this.setKey(t.key,t.type,t.value,t.ttl);this.updateMetrics()}parseMemorySize(e){const t=e.match(/^(\d+)([kmg]?b?)$/i);if(!t)return 256*1024*1024;const n=parseInt(t[1]);switch(t[2].toLowerCase()){case"kb":return n*1024;case"mb":return n*1024*1024;case"gb":return n*1024*1024*1024;default:return n}}initializeClusterSlots(){if(this.clusterNodes.length===0)return;const e=Math.floor(16384/this.clusterNodes.length);let t=0;for(let n=0;n<this.clusterNodes.length;n++){const a=n===this.clusterNodes.length-1?16383:t+e-1;for(let r=t;r<=a;r++)this.clusterSlots.set(r,this.clusterNodes[n]);t=a+1}}getClusterSlot(e){const t=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935];let n=0;for(let a=0;a<e.length;a++){const r=e.charCodeAt(a);n=(n<<8^t[(n>>8^r)&255])&65535}return n%16384}isKeyForThisNode(e){if(!this.config.enableCluster||this.clusterNodes.length===0)return!0;const t=this.getClusterSlot(e);return this.clusterSlots.get(t),!0}executeCommand(e,t){const n=Date.now(),a=e.toUpperCase();try{let r;switch(a){case"GET":r=this.get(t[0]);break;case"SET":r=this.set(t[0],t[1],t[2]?parseInt(t[2]):void 0);break;case"DEL":r=this.del(t);break;case"EXISTS":r=this.exists(t);break;case"EXPIRE":r=this.expire(t[0],parseInt(t[1]));break;case"TTL":r=this.ttl(t[0]);break;case"KEYS":r=this.keys(t[0]||"*");break;case"HGET":r=this.hget(t[0],t[1]);break;case"HSET":r=this.hset(t[0],t.slice(1));break;case"HGETALL":r=this.hgetall(t[0]);break;case"HDEL":r=this.hdel(t[0],t.slice(1));break;case"HKEYS":r=this.hkeys(t[0]);break;case"HVALS":r=this.hvals(t[0]);break;case"LPUSH":r=this.lpush(t[0],t.slice(1));break;case"RPUSH":r=this.rpush(t[0],t.slice(1));break;case"LPOP":r=this.lpop(t[0]);break;case"RPOP":r=this.rpop(t[0]);break;case"LLEN":r=this.llen(t[0]);break;case"LRANGE":r=this.lrange(t[0],parseInt(t[1]),parseInt(t[2]));break;case"SADD":r=this.sadd(t[0],t.slice(1));break;case"SREM":r=this.srem(t[0],t.slice(1));break;case"SMEMBERS":r=this.smembers(t[0]);break;case"SISMEMBER":r=this.sismember(t[0],t[1]);break;case"SCARD":r=this.scard(t[0]);break;case"ZADD":r=this.zadd(t[0],t.slice(1));break;case"ZREM":r=this.zrem(t[0],t.slice(1));break;case"ZRANGE":r=this.zrange(t[0],parseInt(t[1]),parseInt(t[2]));break;case"ZSCORE":r=this.zscore(t[0],t[1]);break;case"ZCARD":r=this.zcard(t[0]);break;case"PING":r="PONG";break;case"INFO":r=this.info(t[0]);break;case"DBSIZE":r=this.dbsize();break;default:return{success:!1,error:`Unknown command: ${e}`,latency:Date.now()-n}}const c=Date.now()-n;return this.recordOperation(),{success:!0,value:r,latency:c}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error",latency:Date.now()-n}}}recordOperation(){this.operationCount++,this.operationHistory.push({timestamp:Date.now()}),this.operationHistory.length>1e3&&this.operationHistory.shift()}get(e){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");const t=this.keys.get(e);return t?this.isExpired(t)?(this.deleteKey(e),this.metrics.missCount++,null):(this.metrics.hitCount++,typeof t.value=="string"?t.value:JSON.stringify(t.value)):(this.metrics.missCount++,null)}set(e,t,n){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();const a=this.keys.get(e);a&&(this.currentMemoryUsage-=this.calculateKeySize(a));const r={key:e,type:"string",value:t,ttl:n!==void 0?n:a?.ttl,expiresAt:n!==void 0&&n>0?Date.now()+n*1e3:a?.expiresAt,size:this.estimateSize(t)};return this.keys.set(e,r),this.currentMemoryUsage+=this.calculateKeySize(r),"OK"}del(e){let t=0;for(const n of e)this.deleteKey(n)&&t++;return t}exists(e){let t=0;for(const n of e){const a=this.keys.get(n);a&&!this.isExpired(a)&&t++}return t}expire(e,t){const n=this.keys.get(e);return n?this.isExpired(n)?(this.deleteKey(e),0):(n.ttl=t,n.expiresAt=t>0?Date.now()+t*1e3:void 0,1):0}ttl(e){const t=this.keys.get(e);if(!t)return-2;if(this.isExpired(t))return this.deleteKey(e),-2;if(!t.expiresAt)return-1;const n=Math.floor((t.expiresAt-Date.now())/1e3);return n>0?n:-2}keys(e){const t=this.patternToRegex(e),n=[];for(const[a,r]of this.keys.entries()){if(this.isExpired(r)){this.deleteKey(a);continue}t.test(a)&&n.push(a)}return n}hget(e,t){const n=this.keys.get(e);return!n||n.type!=="hash"?null:this.isExpired(n)?(this.deleteKey(e),null):n.value[t]||null}hset(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="hash")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"hash",value:{},size:0});const a=n.value;let r=0;for(let c=0;c<t.length;c+=2){const l=t[c],d=t[c+1];a[l]||r++,a[l]=d}return n.size=this.estimateSize(JSON.stringify(a)),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),r}hgetall(e){const t=this.keys.get(e);return!t||t.type!=="hash"?{}:this.isExpired(t)?(this.deleteKey(e),{}):{...t.value}}hdel(e,t){const n=this.keys.get(e);if(!n||n.type!=="hash")return 0;if(this.isExpired(n))return this.deleteKey(e),0;const a=n.value;let r=0;for(const c of t)a[c]&&(delete a[c],r++);return r>0&&(n.size=this.estimateSize(JSON.stringify(a)),this.keys.set(e,n)),r}hkeys(e){const t=this.keys.get(e);return!t||t.type!=="hash"?[]:this.isExpired(t)?(this.deleteKey(e),[]):Object.keys(t.value)}hvals(e){const t=this.keys.get(e);return!t||t.type!=="hash"?[]:this.isExpired(t)?(this.deleteKey(e),[]):Object.values(t.value)}lpush(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="list")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"list",value:[],size:0});const a=n.value;return a.unshift(...t),n.size=this.estimateSize(JSON.stringify(a)),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),a.length}rpush(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="list")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"list",value:[],size:0});const a=n.value;return a.push(...t),n.size=this.estimateSize(JSON.stringify(a)),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),a.length}lpop(e){const t=this.keys.get(e);if(!t||t.type!=="list")return null;if(this.isExpired(t))return this.deleteKey(e),null;const n=t.value;if(n.length===0)return null;const a=n.shift();return t.size=this.estimateSize(JSON.stringify(n)),this.keys.set(e,t),a}rpop(e){const t=this.keys.get(e);if(!t||t.type!=="list")return null;if(this.isExpired(t))return this.deleteKey(e),null;const n=t.value;if(n.length===0)return null;const a=n.pop();return t.size=this.estimateSize(JSON.stringify(n)),this.keys.set(e,t),a}llen(e){const t=this.keys.get(e);return!t||t.type!=="list"?0:this.isExpired(t)?(this.deleteKey(e),0):t.value.length}lrange(e,t,n){const a=this.keys.get(e);if(!a||a.type!=="list")return[];if(this.isExpired(a))return this.deleteKey(e),[];const r=a.value,c=r.length,l=t<0?Math.max(0,c+t):Math.min(t,c),d=n<0?Math.max(0,c+n):Math.min(n,c-1);return r.slice(l,d+1)}sadd(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="set")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"set",value:new Set,size:0});const a=n.value;let r=0;for(const c of t)a.has(c)||(a.add(c),r++);return n.size=this.estimateSize(JSON.stringify(Array.from(a))),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),r}srem(e,t){const n=this.keys.get(e);if(!n||n.type!=="set")return 0;if(this.isExpired(n))return this.deleteKey(e),0;const a=n.value;let r=0;for(const c of t)a.has(c)&&(a.delete(c),r++);return r>0&&(n.size=this.estimateSize(JSON.stringify(Array.from(a))),this.keys.set(e,n)),r}smembers(e){const t=this.keys.get(e);return!t||t.type!=="set"?[]:this.isExpired(t)?(this.deleteKey(e),[]):Array.from(t.value)}sismember(e,t){const n=this.keys.get(e);return!n||n.type!=="set"?0:this.isExpired(n)?(this.deleteKey(e),0):n.value.has(t)?1:0}scard(e){const t=this.keys.get(e);return!t||t.type!=="set"?0:this.isExpired(t)?(this.deleteKey(e),0):t.value.size}zadd(e,t){if(!this.isKeyForThisNode(e))throw new Error("MOVED - key belongs to different node");this.checkMemoryAndEvict();let n=this.keys.get(e);(!n||n.type!=="zset")&&(n&&(this.currentMemoryUsage-=this.calculateKeySize(n)),n={key:e,type:"zset",value:new Map,size:0});const a=n.value;let r=0;for(let c=0;c<t.length;c+=2){const l=parseFloat(t[c]),d=t[c+1];a.has(d)||r++,a.set(d,l)}return n.size=this.estimateSize(JSON.stringify(Array.from(a.entries()))),this.keys.set(e,n),this.currentMemoryUsage+=this.calculateKeySize(n),r}zrem(e,t){const n=this.keys.get(e);if(!n||n.type!=="zset")return 0;if(this.isExpired(n))return this.deleteKey(e),0;const a=n.value;let r=0;for(const c of t)a.has(c)&&(a.delete(c),r++);return r>0&&(n.size=this.estimateSize(JSON.stringify(Array.from(a.entries()))),this.keys.set(e,n)),r}zrange(e,t,n){const a=this.keys.get(e);if(!a||a.type!=="zset")return[];if(this.isExpired(a))return this.deleteKey(e),[];const r=a.value,c=Array.from(r.entries()).sort((p,m)=>p[1]-m[1]),l=c.length,d=t<0?Math.max(0,l+t):Math.min(t,l),h=n<0?Math.max(0,l+n):Math.min(n,l-1);return c.slice(d,h+1).map(p=>p[0])}zscore(e,t){const n=this.keys.get(e);return!n||n.type!=="zset"?null:this.isExpired(n)?(this.deleteKey(e),null):n.value.get(t)??null}zcard(e){const t=this.keys.get(e);return!t||t.type!=="zset"?0:this.isExpired(t)?(this.deleteKey(e),0):t.value.size}info(e){const t=this.getMetrics();return`# Server
redis_version:7.2.0
redis_mode:${this.config.enableCluster?"cluster":"standalone"}

# Memory
used_memory:${t.memoryUsage}
used_memory_human:${this.formatBytes(t.memoryUsage)}
maxmemory:${this.maxMemoryBytes}
maxmemory_human:${this.formatBytes(this.maxMemoryBytes)}
maxmemory_policy:${this.config.maxMemoryPolicy||"noeviction"}
mem_fragmentation_ratio:1.0

# Stats
total_keys:${t.totalKeys}
expired_keys:${t.expiredKeys}
evicted_keys:${t.evictedKeys}
keyspace_hits:${t.hitCount}
keyspace_misses:${t.missCount}

# Cluster
cluster_enabled:${this.config.enableCluster?1:0}
`}dbsize(){return this.cleanupExpiredKeys(),this.keys.size}setKey(e,t,n,a){const r={key:e,type:t,value:n,ttl:a!==void 0?a:-1,expiresAt:a!==void 0&&a>0?Date.now()+a*1e3:void 0,size:this.estimateSize(typeof n=="string"?n:JSON.stringify(n))};this.keys.set(e,r),this.currentMemoryUsage+=this.calculateKeySize(r)}deleteKey(e){const t=this.keys.get(e);return t?(this.currentMemoryUsage-=this.calculateKeySize(t),this.keys.delete(e),!0):!1}isExpired(e){return e.expiresAt?Date.now()>=e.expiresAt:!1}cleanupExpiredKeys(){let e=0;for(const[t,n]of this.keys.entries())this.isExpired(n)&&(this.deleteKey(t),e++);e>0&&(this.metrics.expiredKeys+=e)}checkMemoryAndEvict(){if(this.currentMemoryUsage<=this.maxMemoryBytes)return;const e=this.config.maxMemoryPolicy||"noeviction";if(e==="noeviction")return;const t=this.selectKeysToEvict(e);let n=0;for(const a of t)if(this.deleteKey(a),n++,this.currentMemoryUsage<=this.maxMemoryBytes*.9)break;n>0&&(this.metrics.evictedKeys+=n)}selectKeysToEvict(e){const t=Array.from(this.keys.keys());switch(e){case"allkeys-lru":case"allkeys-lfu":case"allkeys-random":return t;case"volatile-lru":case"volatile-lfu":case"volatile-ttl":case"volatile-random":return t.filter(n=>{const a=this.keys.get(n);return a&&a.expiresAt!==void 0});default:return[]}}calculateKeySize(e){if(e.size)return e.size;let t=0;return typeof e.value=="string"?t=Buffer.byteLength(e.value,"utf8"):t=Buffer.byteLength(JSON.stringify(e.value),"utf8"),Buffer.byteLength(e.key,"utf8")+t+100}estimateSize(e){return Buffer.byteLength(e,"utf8")}patternToRegex(e){const t=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${t}$`)}formatBytes(e){if(e===0)return"0B";const t=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,a)*100)/100+n[a]}getMetrics(){return this.cleanupExpiredKeys(),this.updateMetrics(),{...this.metrics}}updateMetrics(){const e=Date.now();(e-this.lastMetricsUpdate)/1e3;const t={string:0,hash:0,list:0,set:0,zset:0,stream:0};for(const c of this.keys.values())t[c.type]++;const n=this.operationHistory.filter(c=>c.timestamp>e-1e3).length,a=this.metrics.hitCount+this.metrics.missCount,r=a>0?this.metrics.hitCount/a:0;this.metrics={totalKeys:this.keys.size,keysByType:t,memoryUsage:this.currentMemoryUsage,memoryUsagePercent:this.maxMemoryBytes>0?this.currentMemoryUsage/this.maxMemoryBytes*100:0,operationsPerSecond:n,hitCount:this.metrics.hitCount,missCount:this.metrics.missCount,hitRate:r,expiredKeys:this.metrics.expiredKeys,evictedKeys:this.metrics.evictedKeys,connectedClients:1},this.lastMetricsUpdate=e}getAllKeys(){return this.cleanupExpiredKeys(),Array.from(this.keys.values())}getKey(e){const t=this.keys.get(e);if(t&&this.isExpired(t)){this.deleteKey(e);return}return t}syncKeysFromConfig(e){const t=new Map;for(const n of e)t.set(n.key,n);for(const[n,a]of this.keys.entries());for(const n of e){const a=this.keys.get(n.key);if(!a)this.setKey(n.key,n.type,n.value,n.ttl);else if(a.type!==n.type||JSON.stringify(a.value)!==JSON.stringify(n.value)||a.ttl!==n.ttl){this.currentMemoryUsage-=this.calculateKeySize(a);const r={...n,expiresAt:n.ttl!==void 0&&n.ttl>0?Date.now()+n.ttl*1e3:void 0,size:this.estimateSize(typeof n.value=="string"?n.value:JSON.stringify(n.value))};this.keys.set(n.key,r),this.currentMemoryUsage+=this.calculateKeySize(r)}}this.updateMetrics()}}class ET{clusterName="archiphoenix-cluster";nodes=new Map;keyspaces=new Map;tables=new Map;tableData=new Map;defaultConsistencyLevel="QUORUM";defaultReplicationFactor=3;enableCompaction=!0;compactionStrategy="SizeTieredCompactionStrategy";datacenter="dc1";metrics={readLatency:5,writeLatency:10,totalNodes:0,healthyNodes:0,totalKeyspaces:0,totalTables:0,totalRows:0,totalSize:0,readOperationsPerSecond:0,writeOperationsPerSecond:0,readConsistencyViolations:0,writeConsistencyViolations:0,pendingCompactions:0,hintedHandoffs:0};readOperations=[];writeOperations=[];lastMetricsUpdate=Date.now();initialize(e){if(this.clusterName=e.clusterName||"archiphoenix-cluster",this.defaultConsistencyLevel=e.defaultConsistencyLevel||"QUORUM",this.defaultReplicationFactor=e.defaultReplicationFactor||3,this.enableCompaction=e.enableCompaction??!0,this.compactionStrategy=e.compactionStrategy||"SizeTieredCompactionStrategy",this.datacenter=e.datacenter||"dc1",this.nodes.clear(),e.nodes)for(const t of e.nodes)this.nodes.set(t.address,{...t});else this.nodes.set("localhost:9042",{address:"localhost:9042",status:"up",load:.5,tokens:256});if(this.keyspaces.clear(),e.keyspaces)for(const t of e.keyspaces)this.keyspaces.set(t.name,{...t});else this.keyspaces.set("system",{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0});if(this.tables.clear(),this.tableData.clear(),e.tables)for(const t of e.tables){const n=`${t.keyspace}.${t.name}`;this.tables.set(n,{...t}),this.tableData.set(n,[])}this.updateMetrics()}syncFromConfig(e){if(e.clusterName&&(this.clusterName=e.clusterName),e.defaultConsistencyLevel&&(this.defaultConsistencyLevel=e.defaultConsistencyLevel),e.defaultReplicationFactor!==void 0&&(this.defaultReplicationFactor=e.defaultReplicationFactor),e.nodes)for(const t of e.nodes)this.nodes.set(t.address,{...t});if(e.keyspaces){new Set(this.keyspaces.keys());for(const t of e.keyspaces)this.keyspaces.set(t.name,{...t,tables:this.countTablesInKeyspace(t.name)})}if(e.tables)for(const t of e.tables){const n=`${t.keyspace}.${t.name}`,a=this.tables.get(n);if(a){const r=this.tableData.get(n)||[];this.tables.set(n,{...t,rows:a.rows||r.length||0,size:a.size||r.length*1024||0})}else this.tables.set(n,{...t,rows:0,size:0}),this.tableData.has(n)||this.tableData.set(n,[])}this.updateMetrics()}executeCQL(e,t){const n=Date.now(),a=t||this.defaultConsistencyLevel;try{const r=e.trim().replace(/\s+/g," "),c=r.toUpperCase();return c.startsWith("SELECT")?this.executeSelect(r,a,n):c.startsWith("INSERT")?this.executeInsert(r,a,n):c.startsWith("UPDATE")?this.executeUpdate(r,a,n):c.startsWith("DELETE")?this.executeDelete(r,a,n):c.startsWith("CREATE KEYSPACE")?this.executeCreateKeyspace(r,n):c.startsWith("CREATE TABLE")?this.executeCreateTable(r,n):c.startsWith("DROP TABLE")?this.executeDropTable(r,n):c.startsWith("DROP KEYSPACE")?this.executeDropKeyspace(r,n):{success:!1,error:`Unsupported CQL statement: ${r}`,latency:Date.now()-n}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error",latency:Date.now()-n}}}executeSelect(e,t,n){const a=e.match(/FROM\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-n};const r=a[1].trim(),c=this.normalizeTableKey(r),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${r} does not exist`,latency:Date.now()-n};const d=this.tableData.get(c)||[],h=e.match(/LIMIT\s+(\d+)/i),p=h?parseInt(h[1],10):void 0;let m=[...d];const y=e.match(/WHERE\s+(.+?)(?:\s+LIMIT|$)/i);if(y){const M=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(M){const k=M[1],T=M[2];m=d.filter(A=>String(A[k])===T)}}p!==void 0&&p>0&&(m=m.slice(0,p));const b=this.calculateReadLatency(t),S=this.checkConsistencyViolation(t,l.keyspace);this.recordReadOperation(b,S);const C=this.getRequiredReplicas(t,l.keyspace);return{success:!0,latency:b,consistency:t,rows:m,rowCount:m.length,replicasQueried:C}}executeInsert(e,t,n){const a=e.match(/INTO\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-n};const r=a[1].trim(),c=this.normalizeTableKey(r);let l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${r} does not exist`,latency:Date.now()-n};const d=e.match(/\(([^)]+)\)\s*VALUES/i),h=e.match(/VALUES\s*\(([^)]+)\)/i);if(!d||!h)return{success:!1,error:"Invalid INSERT query: missing columns or values",latency:Date.now()-n};const p=d[1].split(",").map(k=>k.trim()),m=h[1],y=this.parseValueList(m);if(p.length!==y.length)return{success:!1,error:"Column count does not match value count",latency:Date.now()-n};const b={};for(let k=0;k<p.length;k++)b[p[k]]=y[k];const S=this.tableData.get(c)||[];S.push(b),this.tableData.set(c,S),l.rows=S.length,l.size=S.length*1024,this.tables.set(c,l);const C=this.calculateWriteLatency(t,l.keyspace),E=this.checkConsistencyViolation(t,l.keyspace);this.recordWriteOperation(C,E);const M=this.getRequiredReplicas(t,l.keyspace);return this.updateMetrics(),{success:!0,latency:C,consistency:t,rowCount:1,replicasQueried:M}}executeUpdate(e,t,n){const a=e.match(/UPDATE\s+([\w.]+)\s+SET/i);if(!a)return{success:!1,error:"Invalid UPDATE query",latency:Date.now()-n};const r=a[1].trim(),c=this.normalizeTableKey(r),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${r} does not exist`,latency:Date.now()-n};const d=e.match(/SET\s+(.+?)(?:\s+WHERE|$)/i);if(!d)return{success:!1,error:"Invalid UPDATE query: missing SET clause",latency:Date.now()-n};const h=d[1].trim(),p={},m=h.split(",").map(q=>q.trim());for(const q of m){const O=q.match(/(\w+)\s*=\s*(.+)/);if(O){const H=O[1].trim(),J=this.parseValue(O[2].trim());p[H]=J}}const y=e.match(/WHERE\s+(.+)/i);if(!y)return{success:!1,error:"UPDATE requires WHERE clause",latency:Date.now()-n};const S=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!S)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-n};const C=S[1],E=S[2],M=this.tableData.get(c)||[];let k=0;for(const q of M)String(q[C])===E&&(Object.assign(q,p),k++);l.rows=M.length,l.size=M.length*1024,this.tables.set(c,l);const T=this.calculateWriteLatency(t,l.keyspace),A=this.checkConsistencyViolation(t,l.keyspace);this.recordWriteOperation(T,A);const N=this.getRequiredReplicas(t,l.keyspace);return this.updateMetrics(),{success:!0,latency:T,consistency:t,rowCount:k,replicasQueried:N}}executeDelete(e,t,n){const a=e.match(/FROM\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid DELETE query: missing FROM clause",latency:Date.now()-n};const r=a[1].trim(),c=this.normalizeTableKey(r),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${r} does not exist`,latency:Date.now()-n};const d=e.match(/WHERE\s+(.+)/i);if(!d)return{success:!1,error:"DELETE requires WHERE clause",latency:Date.now()-n};const p=d[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(!p)return{success:!1,error:"Unsupported WHERE clause format",latency:Date.now()-n};const m=p[1],y=p[2],b=this.tableData.get(c)||[],S=b.length,C=b.filter(A=>String(A[m])!==y);this.tableData.set(c,C),l.rows=C.length,l.size=C.length*1024,this.tables.set(c,l);const E=S-C.length,M=this.calculateWriteLatency(t,l.keyspace),k=this.checkConsistencyViolation(t,l.keyspace);this.recordWriteOperation(M,k);const T=this.getRequiredReplicas(t,l.keyspace);return this.updateMetrics(),{success:!0,latency:M,consistency:t,rowCount:E,replicasQueried:T}}executeCreateKeyspace(e,t){const n=e.match(/KEYSPACE\s+(\w+)/i);if(!n)return{success:!1,error:"Invalid CREATE KEYSPACE query",latency:Date.now()-t};const a=n[1].trim();if(this.keyspaces.has(a))return{success:!1,error:`Keyspace ${a} already exists`,latency:Date.now()-t};let r=this.defaultReplicationFactor;const c=e.match(/replication.*?(\d+)/i);return c&&(r=parseInt(c[1],10)),this.keyspaces.set(a,{name:a,replication:r,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}executeCreateTable(e,t){const n=e.match(/TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a);if(this.tables.has(r))return{success:!1,error:`Table ${a} already exists`,latency:Date.now()-t};let c=e;const l=e.toUpperCase().indexOf(" WITH ");l>0&&(c=e.substring(0,l));const d=c.match(/\(([^)]+)\)/);if(!d)return{success:!1,error:"Invalid CREATE TABLE query: missing column definitions",latency:Date.now()-t};const h=d[1],p=[],m=h.split(",").map(M=>M.trim());for(const M of m){if(M.toUpperCase().includes("PRIMARY KEY"))continue;const k=M.match(/(\w+)\s+(\w+)/);k&&p.push({name:k[1],type:k[2]})}const y=a.split("."),b=y.length>1?y[0]:"system",S=y.length>1?y[1]:y[0];if(!this.keyspaces.has(b))return{success:!1,error:`Keyspace ${b} does not exist`,latency:Date.now()-t};const C={name:S,keyspace:b,columns:p,rows:0,size:0};this.tables.set(r,C),this.tableData.set(r,[]);const E=this.keyspaces.get(b);return E&&(E.tables=this.countTablesInKeyspace(b),this.keyspaces.set(b,E)),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}executeDropTable(e,t){const n=e.match(/TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a);if(!this.tables.has(r))return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-t};const c=this.tables.get(r);this.tables.delete(r),this.tableData.delete(r);const l=this.keyspaces.get(c.keyspace);return l&&(l.tables=this.countTablesInKeyspace(c.keyspace),this.keyspaces.set(c.keyspace,l)),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}executeDropKeyspace(e,t){const n=e.match(/KEYSPACE\s+(\w+)/i);if(!n)return{success:!1,error:"Invalid DROP KEYSPACE query",latency:Date.now()-t};const a=n[1].trim();if(!this.keyspaces.has(a))return{success:!1,error:`Keyspace ${a} does not exist`,latency:Date.now()-t};const r=[];for(const[c,l]of this.tables.entries())l.keyspace===a&&r.push(c);for(const c of r)this.tables.delete(c),this.tableData.delete(c);return this.keyspaces.delete(a),this.updateMetrics(),{success:!0,latency:Date.now()-t,rowCount:0}}getNodes(){return Array.from(this.nodes.values())}getKeyspaces(){return Array.from(this.keyspaces.values())}getTables(){return Array.from(this.tables.values())}getMetrics(){return this.updateMetrics(),{...this.metrics}}calculateReadLatency(e){const n=this.getRequiredReplicas(e,"system"),a=Math.log(n+1)*3,r=Math.random()*2;return Math.round(2+a+r)}calculateWriteLatency(e,t){const r=this.getRequiredReplicas(e,t)*2,c=Math.random()*3;return Math.round(5+r+c)}getRequiredReplicas(e,t){const a=this.keyspaces.get(t)?.replication||this.defaultReplicationFactor;switch(e){case"ONE":case"LOCAL_ONE":return 1;case"TWO":return 2;case"THREE":return 3;case"QUORUM":case"LOCAL_QUORUM":return Math.floor(a/2)+1;case"ALL":case"EACH_QUORUM":return a;case"SERIAL":case"LOCAL_SERIAL":return Math.floor(a/2)+1;default:return Math.floor(a/2)+1}}checkConsistencyViolation(e,t){const n=this.metrics.healthyNodes,a=this.getRequiredReplicas(e,t),r=n<a?.8:.05;return Math.random()<r}recordReadOperation(e,t){const n=Date.now();this.readOperations.push({timestamp:n,latency:e,violated:t}),this.readOperations.length>1e3&&this.readOperations.shift(),t&&this.metrics.readConsistencyViolations++}recordWriteOperation(e,t){const n=Date.now();this.writeOperations.push({timestamp:n,latency:e,violated:t}),this.writeOperations.length>1e3&&this.writeOperations.shift(),t&&this.metrics.writeConsistencyViolations++}updateMetrics(){const e=Date.now();(e-this.lastMetricsUpdate)/1e3,this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(h=>h.status==="up").length,this.metrics.totalKeyspaces=this.keyspaces.size,this.metrics.totalTables=this.tables.size;let t=0,n=0;for(const[h,p]of this.tableData.entries())t+=p.length,n+=p.length*1024;this.metrics.totalRows=t,this.metrics.totalSize=n;const a=e-1e3,r=this.readOperations.filter(h=>h.timestamp>a),c=this.writeOperations.filter(h=>h.timestamp>a);if(this.metrics.readOperationsPerSecond=r.length,this.metrics.writeOperationsPerSecond=c.length,r.length>0){const h=r.reduce((p,m)=>p+m.latency,0)/r.length;this.metrics.readLatency=Math.round(h*10)/10}if(c.length>0){const h=c.reduce((p,m)=>p+m.latency,0)/c.length;this.metrics.writeLatency=Math.round(h*10)/10}this.metrics.pendingCompactions=Math.floor(this.metrics.totalSize/(10*1024*1024));const l=this.metrics.totalNodes-this.metrics.healthyNodes;this.metrics.hintedHandoffs=l>0?l*5:0;const d=this.metrics.readOperationsPerSecond+this.metrics.writeOperationsPerSecond;for(const h of this.nodes.values())if(h.status==="up"){const p=Math.min(.95,.3+d/100*.3);h.load=h.load*.9+p*.1,h.load+=(Math.random()-.5)*.05,h.load=Math.max(.1,Math.min(.95,h.load))}this.lastMetricsUpdate=e}countTablesInKeyspace(e){let t=0;for(const n of this.tables.values())n.keyspace===e&&t++;return t}normalizeTableKey(e){return e.includes(".")?e:`system.${e}`}parseValueList(e){const t=[];let n="",a=!1,r="";for(let c=0;c<e.length;c++){const l=e[c];if((l==='"'||l==="'")&&!a){a=!0,r=l;continue}else if(l===r&&a){a=!1,r="";continue}l===","&&!a?(t.push(this.parseValue(n.trim())),n=""):n+=l}return n.trim()&&t.push(this.parseValue(n.trim())),t}parseValue(e){return e=e.trim(),e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):/^-?\d+$/.test(e)?parseInt(e,10):/^-?\d*\.\d+$/.test(e)?parseFloat(e):e.toUpperCase()==="TRUE"?!0:e.toUpperCase()==="FALSE"?!1:e.toUpperCase()==="NULL"?null:e}}class RT{cluster="archiphoenix-cluster";replication=!1;tables=new Map;tableData=new Map;tableParts=new Map;maxMemoryUsage=10*1024*1024*1024;compression="LZ4";metrics={queryThroughput:0,avgQueryTime:45,queriesPerSecond:0,readRowsPerSecond:0,writtenRowsPerSecond:0,totalRows:0,totalSize:0,compressionRatio:5,activeQueries:0,memoryUsage:0,memoryUsagePercent:0,partsCount:0,pendingMerges:0,totalTables:0,clusterNodes:1,healthyNodes:1};queryOperations=[];lastMetricsUpdate=Date.now();activeQueriesSet=new Set;initialize(e){if(this.cluster=e.cluster||"archiphoenix-cluster",this.replication=e.replication||!1,this.maxMemoryUsage=e.maxMemoryUsage||10*1024*1024*1024,this.compression=e.compression||"LZ4",this.tables.clear(),this.tableData.clear(),this.tableParts.clear(),e.tables)for(const t of e.tables){const n=`${t.database||"default"}.${t.name}`;this.tables.set(n,{...t}),this.tableData.set(n,[]),this.tableParts.set(n,[])}this.updateMetrics()}syncFromConfig(e){if(e.cluster&&(this.cluster=e.cluster),e.replication!==void 0&&(this.replication=e.replication),e.maxMemoryUsage&&(this.maxMemoryUsage=e.maxMemoryUsage),e.compression&&(this.compression=e.compression),e.tables)for(const t of e.tables){const n=`${t.database||"default"}.${t.name}`,a=this.tables.get(n),r=this.tableData.get(n)||[];a?this.tables.set(n,{...t,rows:a.rows||r.length||0,size:a.size||r.length*512||0}):(this.tables.set(n,{...t,rows:0,size:0}),this.tableData.has(n)||(this.tableData.set(n,[]),this.tableParts.set(n,[])))}this.updateMetrics()}executeQuery(e){const t=Date.now(),n=`query-${Date.now()}-${Math.random()}`;try{const a=e.trim().replace(/\s+/g," "),r=a.toUpperCase();this.activeQueriesSet.add(n),this.metrics.activeQueries=this.activeQueriesSet.size;let c;r.startsWith("SELECT")?c=this.executeSelect(a,t):r.startsWith("INSERT")?c=this.executeInsert(a,t):r.startsWith("ALTER")?c=this.executeAlter(a,t):r.startsWith("CREATE TABLE")?c=this.executeCreateTable(a,t):r.startsWith("DROP TABLE")?c=this.executeDropTable(a,t):c={success:!1,error:`Unsupported SQL statement: ${a}`,latency:Date.now()-t};const l=c.latency||Date.now()-t;return this.queryOperations.push({timestamp:Date.now(),latency:l,rowsRead:c.dataRead||0,rowsWritten:c.dataWritten||0}),this.activeQueriesSet.delete(n),this.metrics.activeQueries=this.activeQueriesSet.size,c}catch(a){return this.activeQueriesSet.delete(n),this.metrics.activeQueries=this.activeQueriesSet.size,{success:!1,error:a instanceof Error?a.message:"Unknown error",latency:Date.now()-t}}}executeSelect(e,t){const n=e.match(/FROM\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid SELECT query: missing FROM clause",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a),c=this.tables.get(r);if(!c)return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-t};const l=this.tableData.get(r)||[],d=e.match(/SELECT\s+(.+?)\s+FROM/i),h=d?d[1].trim().split(",").map(k=>k.trim()):["*"];let p=[...l];const m=e.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(m){const T=m[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(T){const A=T[1],N=T[2];p=l.filter(q=>String(q[A])===N)}}const y=e.match(/GROUP\s+BY\s+(\w+)/i);if(y){const k=y[1],T=new Map;p.forEach(A=>{const N=String(A[k]||"null");T.set(N,(T.get(N)||0)+1)}),p=Array.from(T.entries()).map(([A,N])=>({[k]:A,count:N}))}const b=e.match(/ORDER\s+BY\s+(\w+)(?:\s+(ASC|DESC))?/i);if(b){const k=b[1],T=(b[2]||"ASC").toUpperCase();p.sort((A,N)=>{const q=A[k],O=N[k];return T==="DESC"?q>O?-1:q<O?1:0:q<O?-1:q>O?1:0})}const S=e.match(/LIMIT\s+(\d+)/i),C=S?parseInt(S[1],10):void 0;C!==void 0&&C>0&&(p=p.slice(0,C));const E=this.calculateQueryLatency(e,c,p.length);let M=p;return!h.includes("*")&&h.length>0&&(M=p.map(k=>{const T={};return h.forEach(A=>{k.hasOwnProperty(A)&&(T[A]=k[A])}),T})),{success:!0,latency:E,rows:M,rowCount:M.length,columns:h.includes("*")?Object.keys(l[0]||{}):h,dataRead:l.length}}executeInsert(e,t){const n=e.match(/INTO\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid INSERT query: missing INTO clause",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a);let c=this.tables.get(r);if(!c)return{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-t};const l=e.match(/VALUES\s+(.+)/i);if(!l)return{success:!1,error:"Invalid INSERT query: missing VALUES clause",latency:Date.now()-t};const d=l[1].trim(),h=this.parseValues(d),p=this.tableData.get(r)||[],m={},y=e.match(/\(([^)]+)\)\s+VALUES/i),b=y?y[1].split(",").map(C=>C.trim()):[];b.length>0&&b.length===h.length?b.forEach((C,E)=>{m[C]=h[E]}):h.forEach((C,E)=>{m[`column_${E}`]=C}),p.push(m),this.tableData.set(r,p),c.rows=p.length,c.size=p.length*512,this.tables.set(r,c);const S=10+Math.random()*5;return this.simulatePartCreation(r),this.updateMetrics(),{success:!0,latency:S,rowCount:1,dataWritten:1}}executeCreateTable(e,t){const n=e.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid CREATE TABLE query",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a);if(this.tables.has(r))return{success:!1,error:`Table ${a} already exists`,latency:Date.now()-t};const c=e.match(/ENGINE\s*=\s*(\w+)/i),l=c?c[1]:"MergeTree",[d,h]=r.split("."),p={name:h,database:d||"default",engine:l,rows:0,size:0,partitions:0};return this.tables.set(r,p),this.tableData.set(r,[]),this.tableParts.set(r,[]),this.updateMetrics(),{success:!0,latency:Date.now()-t}}executeDropTable(e,t){const n=e.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid DROP TABLE query",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a);return this.tables.has(r)?(this.tables.delete(r),this.tableData.delete(r),this.tableParts.delete(r),this.updateMetrics(),{success:!0,latency:Date.now()-t}):{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-t}}executeAlter(e,t){const n=e.match(/ALTER\s+TABLE\s+([\w.]+)/i);if(!n)return{success:!1,error:"Invalid ALTER TABLE query",latency:Date.now()-t};const a=n[1].trim(),r=this.normalizeTableKey(a);return this.tables.get(r)?{success:!0,latency:Date.now()-t}:{success:!1,error:`Table ${a} does not exist`,latency:Date.now()-t}}calculateQueryLatency(e,t,n){const r=n/1e6*5;let c=1;const l=e.toUpperCase();l.includes("JOIN")&&(c*=2),l.includes("GROUP BY")&&(c*=1.5),l.includes("ORDER BY")&&(c*=1.3),l.includes("COUNT")&&(c*=.8),(l.includes("SUM")||l.includes("AVG"))&&(c*=.9);const d=this.tableParts.get(`${t.database}.${t.name}`)||[],h=Math.min(1.5,1+d.length/100);return 10+r*c*h}parseValues(e){let t=e.trim();t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,-1));const n=[];let a="",r=!1,c="";for(let l=0;l<t.length;l++){const d=t[l];(d==='"'||d==="'")&&!r?(r=!0,c=d):d===c&&r?(r=!1,c=""):d===","&&!r?(n.push(this.parseValue(a.trim())),a=""):a+=d}return a.trim()&&n.push(this.parseValue(a.trim())),n}parseValue(e){const t=e.trim();return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):t.toLowerCase()==="true"?!0:t.toLowerCase()==="false"?!1:t.toLowerCase()==="null"?null:t}normalizeTableKey(e){return e.includes(".")?e:`default.${e}`}simulatePartCreation(e){const t=this.tableParts.get(e)||[],n=new Date().toISOString().split("T")[0],a={name:`${n}_${t.length+1}`,minDate:n,maxDate:n,rows:1e3,size:512*1e3,level:0};if(t.push(a),this.tableParts.set(e,t),t.length>10){const r=t.splice(0,5),c={name:`merged_${Date.now()}`,minDate:r[0].minDate,maxDate:r[r.length-1].maxDate,rows:r.reduce((l,d)=>l+d.rows,0),size:r.reduce((l,d)=>l+d.size,0),level:Math.max(...r.map(l=>l.level))+1};t.unshift(c),this.tableParts.set(e,t)}}updateMetrics(){const e=Date.now(),t=(e-this.lastMetricsUpdate)/1e3;this.metrics.totalTables=this.tables.size;let n=0,a=0,r=0;for(const[h,p]of this.tables.entries()){n+=p.rows,a+=p.size;const m=this.tableParts.get(h)||[];r+=m.length}this.metrics.totalRows=n,this.metrics.totalSize=a,this.metrics.partsCount=r;const c=e-1e3,l=this.queryOperations.filter(h=>h.timestamp>c);if(this.metrics.queriesPerSecond=l.length,this.metrics.queryThroughput=l.length,l.length>0){const h=l.reduce((y,b)=>y+b.latency,0)/l.length;this.metrics.avgQueryTime=Math.round(h*10)/10;const p=l.reduce((y,b)=>y+b.rowsRead,0),m=l.reduce((y,b)=>y+b.rowsWritten,0);this.metrics.readRowsPerSecond=Math.round(p/t),this.metrics.writtenRowsPerSecond=Math.round(m/t)}const d=a/this.metrics.compressionRatio;this.metrics.memoryUsage=d,this.metrics.memoryUsagePercent=d/this.maxMemoryUsage*100,this.metrics.pendingMerges=Math.floor(r/10),this.metrics.clusterNodes=this.replication?3:1,this.metrics.healthyNodes=this.metrics.clusterNodes,this.lastMetricsUpdate=e}getMetrics(){return this.updateMetrics(),{...this.metrics}}insertData(e,t){const n=this.normalizeTableKey(e),a=this.tables.get(n);if(!a)return{success:!1,rowsInserted:0,error:`Table ${e} does not exist`};const r=this.tableData.get(n)||[];return r.push(...t),this.tableData.set(n,r),a.rows=r.length,a.size=r.length*512,this.tables.set(n,a),this.simulatePartCreation(n),this.updateMetrics(),{success:!0,rowsInserted:t.length}}}const io={"X-Small":{servers:1,creditsPerHour:1},Small:{servers:2,creditsPerHour:2},Medium:{servers:4,creditsPerHour:4},Large:{servers:8,creditsPerHour:8},"X-Large":{servers:16,creditsPerHour:16},"2X-Large":{servers:32,creditsPerHour:32},"3X-Large":{servers:64,creditsPerHour:64},"4X-Large":{servers:128,creditsPerHour:128}};class TT{account="archiphoenix";region="us-east-1";warehouses=new Map;databases=new Map;tables=new Map;tableData=new Map;queries=new Map;queryQueue=[];activeQueries=new Map;resultCache=new Map;cacheHits=0;cacheMisses=0;metrics={totalWarehouses:0,runningWarehouses:0,suspendedWarehouses:0,totalQueries:0,runningQueries:0,queuedQueries:0,queriesPerSecond:0,avgQueryTime:0,totalComputeTime:0,totalDataRead:0,totalDataWritten:0,cacheHitRate:0,warehouseUtilization:0,totalCost:0};queryOperations=[];lastMetricsUpdate=Date.now();warehouseLastUpdate=new Map;suspendTimers=new Map;initialize(e){if(this.account=e.account||"archiphoenix",this.region=e.region||"us-east-1",this.warehouses.clear(),e.warehouses&&e.warehouses.length>0)for(const t of e.warehouses)this.warehouses.set(t.name,{...t,status:t.status||"suspended",currentClusterCount:t.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});else this.warehouses.set("COMPUTE_WH",{name:"COMPUTE_WH",size:"Small",status:"suspended",autoSuspend:60,autoResume:!0,minClusterCount:1,maxClusterCount:1,currentClusterCount:1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0});if(this.databases.clear(),this.tables.clear(),this.tableData.clear(),e.databases){for(const t of e.databases)if(this.databases.set(t.name,{...t}),t.schemas){for(const n of t.schemas)if(n.tables)for(const a of n.tables){const r=`${t.name}.${n.name}.${a.name}`;this.tables.set(r,{...a}),this.tableData.set(r,[])}}}this.databases.has("SNOWFLAKE")||this.databases.set("SNOWFLAKE",{name:"SNOWFLAKE",comment:"System database",retentionTime:1,size:0,schemas:[{name:"INFORMATION_SCHEMA",tables:[],views:0,functions:0}]}),this.updateMetrics()}syncFromConfig(e){if(e.account&&(this.account=e.account),e.region&&(this.region=e.region),e.warehouses){for(const n of e.warehouses){const a=this.warehouses.get(n.name);a?(this.warehouses.set(n.name,{...n,status:a.status,currentClusterCount:a.currentClusterCount,runningQueries:a.runningQueries,queuedQueries:a.queuedQueries,totalQueriesExecuted:a.totalQueriesExecuted,totalComputeTime:a.totalComputeTime,lastUsed:a.lastUsed}),this.updateWarehouseAutoSuspend(n.name,n)):this.warehouses.set(n.name,{...n,status:"suspended",currentClusterCount:n.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0})}const t=new Set(e.warehouses.map(n=>n.name));for(const[n]of this.warehouses.entries())if(!t.has(n)){this.warehouses.delete(n);const a=this.suspendTimers.get(n);a&&(clearTimeout(a),this.suspendTimers.delete(n))}}if(e.databases){for(const t of e.databases)if(this.databases.get(t.name),this.databases.set(t.name,{...t}),t.schemas){for(const n of t.schemas)if(n.tables)for(const a of n.tables){const r=`${t.name}.${n.name}.${a.name}`,c=this.tables.get(r),l=this.tableData.get(r)||[];c?this.tables.set(r,{...a,rows:c.rows||l.length||0,size:c.size||l.length*512||0}):(this.tables.set(r,{...a,rows:0,size:0}),this.tableData.set(r,[]))}}}this.updateMetrics()}executeQuery(e,t,n,a){const r=Date.now(),c=`query-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l=this.getCacheKey(e,n,a),d=this.resultCache.get(l);if(d&&Date.now()-d.timestamp<d.ttl)return this.cacheHits++,this.updateMetrics(),{success:!0,latency:10,rows:d.data,rowCount:d.data.length,queryId:c,resultCacheUsed:!0};this.cacheMisses++;let h;if(t?h=this.warehouses.get(t):h=Array.from(this.warehouses.values()).find(m=>m.status==="running")||Array.from(this.warehouses.values())[0],!h)return{success:!1,error:"No warehouse available",latency:Date.now()-r,queryId:c};const p={id:c,queryText:e,status:"queued",warehouse:h.name,database:n,schema:a,startedAt:r};return this.queries.set(c,p),h.status==="suspended"&&h.autoResume&&this.resumeWarehouse(h.name),h.status==="running"?this.executeQueryOnWarehouse(p,h,r):(h.queuedQueries++,this.queryQueue.push(p),p.status="queued",h.autoResume&&this.resumeWarehouse(h.name),h.status==="running"&&this.processQueryQueue(h),{success:!0,latency:50,queryId:c,warehouse:h.name})}executeQueryOnWarehouse(e,t,n){e.status="running",e.startedAt=Date.now(),t.runningQueries++,this.activeQueries.set(e.id,e),1/(io[t.size]||io.Small).servers,this.estimateQueryComplexity(e.queryText);const r=this.executeSQL(e.queryText,e.database,e.schema),c=Date.now();if(e.completedAt=c,e.duration=c-(e.startedAt||n),e.status=r.success?"success":"failed",e.rowsReturned=r.rowCount,e.error=r.error,t.runningQueries--,t.totalQueriesExecuted++,t.totalComputeTime+=e.duration/1e3,t.lastUsed=c,this.activeQueries.delete(e.id),r.success&&r.rows){const l=this.getCacheKey(e.queryText,e.database,e.schema);this.resultCache.set(l,{data:r.rows,timestamp:c,ttl:3e5})}return this.queryOperations.push({timestamp:c,latency:e.duration,rowsRead:r.dataRead||0,rowsWritten:r.dataWritten||0}),t.autoSuspend&&t.runningQueries===0&&t.queuedQueries===0&&this.scheduleWarehouseSuspend(t.name,t.autoSuspend),this.updateMetrics(),{...r,queryId:e.id,warehouse:t.name,latency:e.duration}}executeSQL(e,t,n){const a=e.trim().replace(/\s+/g," "),r=a.toUpperCase();try{return r.startsWith("SELECT")?this.executeSelect(a,t,n):r.startsWith("INSERT")?this.executeInsert(a,t,n):r.startsWith("UPDATE")?this.executeUpdate(a,t,n):r.startsWith("DELETE")?this.executeDelete(a,t,n):r.startsWith("CREATE TABLE")?this.executeCreateTable(a,t,n):r.startsWith("DROP TABLE")?this.executeDropTable(a,t,n):{success:!1,error:`Unsupported SQL statement: ${a}`}}catch(c){return{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}executeSelect(e,t,n){const a=e.match(/FROM\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid SELECT query: missing FROM clause"};const r=a[1].trim(),c=this.normalizeTableKey(r,t,n),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${r} does not exist`};const d=this.tableData.get(c)||[],h=e.match(/SELECT\s+(.+?)\s+FROM/i),p=h?h[1].trim().split(",").map(S=>S.trim()):["*"];let m=[...d];const y=e.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+LIMIT|$)/i);if(y){const C=y[1].trim().match(/(\w+)\s*=\s*['"]?([^'"\s]+)['"]?/);if(C){const E=C[1],M=C[2];m=d.filter(k=>String(k[E])===M)}}const b=e.match(/LIMIT\s+(\d+)/i);if(b){const S=parseInt(b[1],10);m=m.slice(0,S)}return{success:!0,rows:m,rowCount:m.length,columns:p.includes("*")?l.columns?.map(S=>S.name)||[]:p,dataRead:d.length}}executeInsert(e,t,n){const a=e.match(/INTO\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid INSERT query: missing INTO clause"};const r=a[1].trim(),c=this.normalizeTableKey(r,t,n),l=this.tables.get(c);if(!l)return{success:!1,error:`Table ${r} does not exist`};const d=e.match(/VALUES\s*\((.+?)\)/i);if(!d)return{success:!1,error:"Invalid INSERT query: missing VALUES clause"};const h=d[1].split(",").map(b=>b.trim().replace(/^['"]|['"]$/g,"")),p=l.columns||[];if(h.length!==p.length)return{success:!1,error:`Column count mismatch: expected ${p.length}, got ${h.length}`};const m={};p.forEach((b,S)=>{m[b.name]=h[S]});const y=this.tableData.get(c)||[];return y.push(m),this.tableData.set(c,y),l.rows=y.length,l.size=y.length*512,{success:!0,rowCount:1,dataWritten:1}}executeUpdate(e,t,n){return{success:!0,rowCount:0,dataWritten:0}}executeDelete(e,t,n){return{success:!0,rowCount:0,dataWritten:0}}executeCreateTable(e,t,n){const a=e.match(/CREATE\s+TABLE\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid CREATE TABLE query"};const r=a[1].trim(),c=this.normalizeTableKey(r,t,n);if(this.tables.has(c))return{success:!1,error:`Table ${r} already exists`};const l=e.match(/\((.+?)\)/),d=[];if(l){const b=l[1].split(",").map(S=>S.trim());for(const S of b){const C=S.split(/\s+/);C.length>=2&&d.push({name:C[0],type:C[1],nullable:!S.toUpperCase().includes("NOT NULL")})}}const[h,p,m]=this.parseTableName(r,t,n),y={name:m,schema:p,database:h,columns:d,rows:0,size:0,created:Date.now()};return this.tables.set(c,y),this.tableData.set(c,[]),{success:!0,rowCount:0}}executeDropTable(e,t,n){const a=e.match(/DROP\s+TABLE\s+([\w.]+)/i);if(!a)return{success:!1,error:"Invalid DROP TABLE query"};const r=a[1].trim(),c=this.normalizeTableKey(r,t,n);return this.tables.has(c)?(this.tables.delete(c),this.tableData.delete(c),{success:!0,rowCount:0}):{success:!1,error:`Table ${r} does not exist`}}resumeWarehouse(e){const t=this.warehouses.get(e);if(!t)return!1;if(t.status==="running")return!0;const n=this.suspendTimers.get(e);return n&&(clearTimeout(n),this.suspendTimers.delete(e)),t.status="running",t.currentClusterCount=t.minClusterCount,this.processQueryQueue(t),this.updateMetrics(),!0}suspendWarehouse(e){const t=this.warehouses.get(e);return t?t.status==="suspended"?!0:t.runningQueries>0?!1:(t.status="suspended",t.currentClusterCount=0,this.updateMetrics(),!0):!1}scheduleWarehouseSuspend(e,t){const n=this.suspendTimers.get(e);n&&clearTimeout(n);const a=setTimeout(()=>{const r=this.warehouses.get(e);r&&r.runningQueries===0&&r.queuedQueries===0&&this.suspendWarehouse(e),this.suspendTimers.delete(e)},t*1e3);this.suspendTimers.set(e,a)}updateWarehouseAutoSuspend(e,t){const n=this.warehouses.get(e);if(n){if(t.autoSuspend!==void 0||t.autoResume!==void 0){const a=this.suspendTimers.get(e);a&&(clearTimeout(a),this.suspendTimers.delete(e))}n.status==="running"&&n.autoSuspend&&n.runningQueries===0&&n.queuedQueries===0&&this.scheduleWarehouseSuspend(e,n.autoSuspend)}}processQueryQueue(e){if(e.status!=="running")return;const t=this.queryQueue.filter(n=>n.warehouse===e.name&&n.status==="queued");for(const n of t)e.runningQueries<this.getMaxConcurrentQueries(e)&&(e.queuedQueries--,this.queryQueue=this.queryQueue.filter(a=>a.id!==n.id),this.executeQueryOnWarehouse(n,e,n.startedAt||Date.now()))}getMaxConcurrentQueries(e){return(io[e.size]||io.Small).servers*e.currentClusterCount*8}estimateQueryComplexity(e){let t=1;const n=(e.match(/\bJOIN\b/gi)||[]).length;t+=n*.5,e.match(/\bGROUP\s+BY\b/i)&&(t+=.3),e.match(/\bORDER\s+BY\b/i)&&(t+=.2);const a=(e.match(/\b(COUNT|SUM|AVG|MAX|MIN)\s*\(/gi)||[]).length;return t+=a*.2,Math.max(1,t)}normalizeTableKey(e,t,n){const a=e.split(".");return a.length===3?a.join("."):a.length===2?`${t||"PUBLIC"}.${a.join(".")}`:`${t||"PUBLIC"}.${n||"PUBLIC"}.${a[0]}`}parseTableName(e,t,n){const a=e.split(".");return a.length===3?[a[0],a[1],a[2]]:a.length===2?[t||"PUBLIC",a[0],a[1]]:[t||"PUBLIC",n||"PUBLIC",a[0]]}getCacheKey(e,t,n){return`${e}|${t||""}|${n||""}`}updateMetrics(){const e=Date.now(),t=(e-this.lastMetricsUpdate)/1e3;if(this.metrics.totalWarehouses=this.warehouses.size,this.metrics.runningWarehouses=Array.from(this.warehouses.values()).filter(l=>l.status==="running").length,this.metrics.suspendedWarehouses=Array.from(this.warehouses.values()).filter(l=>l.status==="suspended").length,this.metrics.totalQueries=this.queries.size,this.metrics.runningQueries=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.runningQueries,0),this.metrics.queuedQueries=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.queuedQueries,0),t>0){const l=this.queryOperations.filter(d=>d.timestamp>e-1e3);this.metrics.queriesPerSecond=l.length}if(this.queryOperations.length>0){const l=this.queryOperations.slice(-100),d=l.reduce((h,p)=>h+p.latency,0)/l.length;this.metrics.avgQueryTime=d}this.metrics.totalComputeTime=Array.from(this.warehouses.values()).reduce((l,d)=>l+d.totalComputeTime,0);const n=this.queryOperations.slice(-1e3);this.metrics.totalDataRead=n.reduce((l,d)=>l+d.rowsRead,0),this.metrics.totalDataWritten=n.reduce((l,d)=>l+d.rowsWritten,0);const a=this.cacheHits+this.cacheMisses;this.metrics.cacheHitRate=a>0?this.cacheHits/a:0;let r=0;for(const l of this.warehouses.values())if(l.status==="running"){const d=this.getMaxConcurrentQueries(l),h=d>0?l.runningQueries/d:0;r+=h}this.metrics.warehouseUtilization=this.metrics.runningWarehouses>0?r/this.metrics.runningWarehouses:0;let c=0;for(const l of this.warehouses.values())if(l.status==="running"&&l.totalComputeTime>0){const d=io[l.size]||io.Small,h=l.totalComputeTime/3600;c+=d.creditsPerHour*h*l.currentClusterCount}this.metrics.totalCost=c,this.lastMetricsUpdate=e}getMetrics(){return this.updateMetrics(),{...this.metrics}}getWarehouse(e){return this.warehouses.get(e)}getWarehouses(){return Array.from(this.warehouses.values())}getQuery(e){return this.queries.get(e)}getRecentQueries(e=100){return Array.from(this.queries.values()).sort((t,n)=>(n.startedAt||0)-(t.startedAt||0)).slice(0,e)}getTables(e,t){return!e&&!t?Array.from(this.tables.values()):Array.from(this.tables.values()).filter(n=>!(e&&n.database!==e||t&&n.schema!==t))}}class kT{clusterName="archiphoenix-cluster";nodes=new Map;indices=new Map;shards=new Map;documents=new Map;defaultShards=5;defaultReplicas=1;refreshInterval="1s";metrics={clusterHealth:"green",totalNodes:0,healthyNodes:0,totalIndices:0,totalDocs:0,totalSize:0,activeShards:0,relocatingShards:0,initializingShards:0,unassignedShards:0,indexOperationsPerSecond:0,searchOperationsPerSecond:0,averageIndexLatency:5,averageSearchLatency:10,averageGetLatency:2};indexOperations=[];searchOperations=[];getOperations=[];lastMetricsUpdate=Date.now();recentQueries=[];initialize(e){if(this.clusterName=e.clusterName||"archiphoenix-cluster",this.defaultShards=e.defaultShards||5,this.defaultReplicas=e.defaultReplicas||1,this.refreshInterval=e.refreshInterval||"1s",this.nodes.clear(),e.nodes&&e.nodes.length>0)for(const t of e.nodes)this.nodes.set(t,{address:t,status:"up",load:.3+Math.random()*.4,shards:0});else this.nodes.set("localhost:9200",{address:"localhost:9200",status:"up",load:.5,shards:0});if(this.indices.clear(),this.shards.clear(),this.documents.clear(),e.indices&&e.indices.length>0)for(const t of e.indices)this.createIndex(t.name,t.shards||this.defaultShards,t.replicas||this.defaultReplicas,t);else this.createIndex("archiphoenix-index",this.defaultShards,this.defaultReplicas);this.updateMetrics()}syncFromConfig(e){if(e.clusterName&&(this.clusterName=e.clusterName),e.defaultShards!==void 0&&(this.defaultShards=e.defaultShards),e.defaultReplicas!==void 0&&(this.defaultReplicas=e.defaultReplicas),e.refreshInterval&&(this.refreshInterval=e.refreshInterval),e.nodes){new Set(this.nodes.keys());for(const t of e.nodes)this.nodes.has(t)||this.nodes.set(t,{address:t,status:"up",load:.3+Math.random()*.4,shards:0})}if(e.indices){new Set(this.indices.keys());for(const t of e.indices)if(!this.indices.has(t.name))this.createIndex(t.name,t.shards||this.defaultShards,t.replicas||this.defaultReplicas,t);else{const n=this.indices.get(t.name),a=this.getTotalDocsForIndex(t.name),r=this.getTotalSizeForIndex(t.name);this.indices.set(t.name,{...t,docs:n.docs||a,size:n.size||r,health:this.calculateIndexHealth(t.name)})}}this.updateMetrics()}createIndex(e,t=5,n=1,a){const r={name:e,docs:a?.docs||0,size:a?.size||0,shards:t,replicas:n,health:"yellow",mappings:a?.mappings,settings:a?.settings};this.indices.set(e,r);const c=[],l=Array.from(this.nodes.keys());for(let d=0;d<t;d++){const h=l[d%l.length];c.push({index:e,shard:d,primary:!0,node:h,state:"STARTED",docs:0,size:0});for(let p=0;p<n;p++){const m=l[(d+p+1)%l.length];c.push({index:e,shard:d,primary:!1,node:m,state:"STARTED",docs:0,size:0})}}if(this.shards.set(e,c),!this.documents.has(e)){const d=new Map;for(let h=0;h<t;h++)d.set(h,[]);this.documents.set(e,d)}r.health=this.calculateIndexHealth(e),this.updateMetrics()}routeToShard(e,t){const n=this.indices.get(e);if(!n)return 0;let a=0;for(let r=0;r<t.length;r++){const c=t.charCodeAt(r);a=(a<<5)-a+c,a=a&a}return Math.abs(a)%n.shards}indexDocument(e,t,n,a){const r=Date.now(),c=this.indices.get(e);if(!c)return{operation:"index",index:e,id:t,document:n,routing:a,latency:Date.now()-r,success:!1,error:`Index ${e} does not exist`};const l=a||t,d=this.routeToShard(e,l),h={_id:t,_index:e,_source:n,_routing:a},p=this.documents.get(e),m=p.get(d)||[],y=m.findIndex(C=>C._id===t);y>=0?m[y]=h:m.push(h),p.set(d,m),this.documents.set(e,p),c.docs=this.getTotalDocsForIndex(e),c.size=this.getTotalSizeForIndex(e),c.health=this.calculateIndexHealth(e);const b=this.shards.get(e);for(const C of b)C.index===e&&C.shard===d&&C.primary&&(C.docs=m.length,C.size=m.length*1024);const S=this.calculateIndexLatency();return this.recordIndexOperation(S),this.updateMetrics(),{operation:"index",index:e,id:t,document:n,routing:a,latency:S,success:!0,took:S}}getDocument(e,t,n){const a=Date.now();if(!this.indices.get(e))return{operation:"get",index:e,id:t,routing:n,latency:Date.now()-a,success:!1,error:`Index ${e} does not exist`};const c=n||t,l=this.routeToShard(e,c),p=(this.documents.get(e).get(l)||[]).find(y=>y._id===t),m=this.calculateGetLatency();return this.recordGetOperation(m),this.updateMetrics(),p?{operation:"get",index:e,id:t,document:p._source,routing:n,latency:m,success:!0,took:m}:{operation:"get",index:e,id:t,routing:n,latency:m,success:!1,error:`Document ${t} not found`,took:m}}search(e,t){const n=Date.now(),a=this.indices.get(e);if(!a)return{operation:"search",index:e,query:t,latency:Date.now()-n,success:!1,error:`Index ${e} does not exist`};const r=this.documents.get(e);let c=[];for(let m=0;m<a.shards;m++){const y=r.get(m)||[];c=c.concat(y)}let l=c;if(t&&t.query){if(t.query.match_all)l=c;else if(t.query.match){const m=Object.keys(t.query.match)[0],y=t.query.match[m];y&&typeof y=="string"&&(l=c.filter(b=>{const S=b._source[m];return S&&String(S).toLowerCase().includes(y.toLowerCase())}))}}const d=t?.size||10;l=l.slice(0,d);const h=this.calculateSearchLatency(a.shards,l.length);this.recordSearchOperation(h,l.length),this.updateMetrics();const p={operation:"search",index:e,query:t,latency:h,success:!0,hits:l.length,took:h};return this.recentQueries.unshift(p),this.recentQueries.length>100&&(this.recentQueries=this.recentQueries.slice(0,100)),p}deleteDocument(e,t,n){const a=Date.now(),r=this.indices.get(e);if(!r)return{operation:"delete",index:e,id:t,routing:n,latency:Date.now()-a,success:!1,error:`Index ${e} does not exist`};const c=n||t,l=this.routeToShard(e,c),d=this.documents.get(e),h=d.get(l)||[],p=h.length,m=h.filter(S=>S._id!==t);d.set(l,m),this.documents.set(e,d),r.docs=this.getTotalDocsForIndex(e),r.size=this.getTotalSizeForIndex(e),r.health=this.calculateIndexHealth(e);const y=this.shards.get(e);for(const S of y)S.index===e&&S.shard===l&&S.primary&&(S.docs=m.length,S.size=m.length*1024);const b=this.calculateIndexLatency();return this.updateMetrics(),m.length===p?{operation:"delete",index:e,id:t,routing:n,latency:b,success:!1,error:`Document ${t} not found`,took:b}:{operation:"delete",index:e,id:t,routing:n,latency:b,success:!0,took:b}}executeQuery(e){const t=Date.now();try{let n;try{n=JSON.parse(e)}catch{const a=e.split(`
`);if(a.length>=2){const r=a[0].match(/^(GET|POST|PUT|DELETE)\s+(.+)/);if(r){const c=r[1],l=r[2].trim();if(c==="GET"&&l.includes("/_search")){n=a.length>1?JSON.parse(a.slice(1).join(`
`)):{query:{match_all:{}}};const d=l.match(/^\/([^\/]+)\/_search/),h=d?d[1]:"_all";return this.search(h,n)}else if(c==="GET"&&l.match(/\/[^\/]+\/_doc\/[^\/]+/)){const d=l.match(/\/([^\/]+)\/_doc\/([^\/]+)/);if(d)return this.getDocument(d[1],d[2])}}}return{operation:"search",query:e,latency:Date.now()-t,success:!1,error:"Invalid query format"}}return n.query||n.match_all?this.search("_all",n):{operation:"search",query:e,latency:Date.now()-t,success:!1,error:"Unsupported query format"}}catch(n){return{operation:"search",query:e,latency:Date.now()-t,success:!1,error:n instanceof Error?n.message:"Unknown error"}}}getMetrics(){return this.updateMetrics(),{...this.metrics}}getIndices(){return Array.from(this.indices.values())}getShards(e){return this.shards.get(e)||[]}getRecentQueries(e=10){return this.recentQueries.slice(0,e)}calculateIndexHealth(e){const t=this.shards.get(e)||[],n=t.filter(c=>c.state==="UNASSIGNED").length,a=t.filter(c=>c.state==="INITIALIZING").length,r=t.filter(c=>c.state==="RELOCATING").length;return n>0?"red":a>0||r>0?"yellow":"green"}calculateClusterHealth(){let e=!1,t=!1;for(const r of this.indices.values())r.health==="red"?e=!0:r.health==="yellow"&&(t=!0);const n=Array.from(this.nodes.values()).filter(r=>r.status==="up").length,a=this.nodes.size;return n===0||e?"red":n<a||t?"yellow":"green"}getTotalDocsForIndex(e){const t=this.documents.get(e);if(!t)return 0;let n=0;for(const a of t.values())n+=a.length;return n}getTotalSizeForIndex(e){const t=this.documents.get(e);if(!t)return 0;let n=0;for(const a of t.values())n+=a.length*1024;return n}calculateIndexLatency(){const t=this.metrics.totalDocs;return 5+Math.min(20,t/1e4)+Math.random()*5}calculateSearchLatency(e,t){const a=e*2,r=Math.min(50,t/100);return 10+a+r+Math.random()*10}calculateGetLatency(){return 2+Math.random()*3}recordIndexOperation(e){this.indexOperations.push({timestamp:Date.now(),latency:e}),this.indexOperations.length>500&&(this.indexOperations=this.indexOperations.slice(-500))}recordSearchOperation(e,t){this.searchOperations.push({timestamp:Date.now(),latency:e,hits:t}),this.searchOperations.length>500&&(this.searchOperations=this.searchOperations.slice(-500))}recordGetOperation(e){this.getOperations.push({timestamp:Date.now(),latency:e}),this.getOperations.length>500&&(this.getOperations=this.getOperations.slice(-500))}updateMetrics(){const e=Date.now(),t=1e3,n=this.indexOperations.filter(p=>e-p.timestamp<t),a=this.searchOperations.filter(p=>e-p.timestamp<t),r=this.getOperations.filter(p=>e-p.timestamp<t);this.metrics.indexOperationsPerSecond=n.length,this.metrics.searchOperationsPerSecond=a.length,n.length>0&&(this.metrics.averageIndexLatency=n.reduce((p,m)=>p+m.latency,0)/n.length),a.length>0&&(this.metrics.averageSearchLatency=a.reduce((p,m)=>p+m.latency,0)/a.length),r.length>0&&(this.metrics.averageGetLatency=r.reduce((p,m)=>p+m.latency,0)/r.length),this.metrics.totalNodes=this.nodes.size,this.metrics.healthyNodes=Array.from(this.nodes.values()).filter(p=>p.status==="up").length,this.metrics.totalIndices=this.indices.size,this.metrics.totalDocs=Array.from(this.indices.values()).reduce((p,m)=>p+m.docs,0),this.metrics.totalSize=Array.from(this.indices.values()).reduce((p,m)=>p+m.size,0);let c=0,l=0,d=0,h=0;for(const p of this.shards.values())for(const m of p)if(m.primary)switch(m.state){case"STARTED":c++;break;case"RELOCATING":l++;break;case"INITIALIZING":d++;break;case"UNASSIGNED":h++;break}this.metrics.activeShards=c,this.metrics.relocatingShards=l,this.metrics.initializingShards=d,this.metrics.unassignedShards=h,this.metrics.clusterHealth=this.calculateClusterHealth();for(const p of this.indices.values())p.health=this.calculateIndexHealth(p.name);this.lastMetricsUpdate=e}}class AT{buckets=new Map;objects=new Map;versions=new Map;operations=[];metrics=new Map;lifecycleTransitions=new Map;initialize(e){if(this.buckets.clear(),this.objects.clear(),this.versions.clear(),this.operations=[],this.metrics.clear(),this.lifecycleTransitions.clear(),e.buckets)for(const t of e.buckets)this.buckets.set(t.name,{...t}),this.objects.set(t.name,new Map),t.versioning&&this.versions.set(t.name,new Map),this.metrics.set(t.name,{bucket:t.name,objectCount:0,totalSize:0,versionsCount:0,putCount:0,getCount:0,deleteCount:0,listCount:0,errorCount:0,averageLatency:0}),this.lifecycleTransitions.set(t.name,new Map)}putObject(e,t,n,a,r,c){const l=Date.now(),d=this.buckets.get(e);if(!d)return{success:!1,etag:"",latency:Date.now()-l,error:`Bucket '${e}' does not exist`};const h=this.generateETag(t,a),p=d.versioning?`${Date.now()}-${Math.random().toString(36).substr(2,9)}`:void 0,m={key:t,bucket:e,size:a,lastModified:Date.now(),storageClass:"STANDARD",etag:h,contentType:c||"application/octet-stream",metadata:r||{},versionId:p,encryption:d.encryption},y=this.objects.get(e);if(d.versioning&&p){const M=this.versions.get(e),k=M.get(t)||[];k.push({versionId:p,object:m,isDeleteMarker:!1}),M.set(t,k),this.versions.set(e,M);const T=this.metrics.get(e);T.versionsCount=this.getTotalVersionsCount(e)}y.set(t,m),this.objects.set(e,y);const b=this.findMatchingLifecycleRule(d,t);if(b&&b.transitions&&b.transitions.length>0){const M=this.lifecycleTransitions.get(e),k=b.transitions[0],T=Date.now()+k.days*24*60*60*1e3;M.set(t,{currentClass:"STANDARD",transitionScheduled:T,targetClass:k.storageClass,ruleId:b.id,transitionIndex:0,allTransitions:b.transitions}),this.lifecycleTransitions.set(e,M)}else if(d.lifecycleEnabled&&d.lifecycleDays){const M=this.lifecycleTransitions.get(e),k=Date.now()+d.lifecycleDays*24*60*60*1e3;M.set(t,{currentClass:"STANDARD",transitionScheduled:k,targetClass:d.glacierEnabled?"GLACIER":"STANDARD_IA"}),this.lifecycleTransitions.set(e,M)}const S=this.metrics.get(e),C=y.get(t);C?S.totalSize-=C.size:S.objectCount++,S.totalSize+=a,S.putCount++;const E=this.calculatePutLatency(a);return this.recordOperation("PUT",e,t,!0,E),this.updateMetrics(e,E,!0),{success:!0,versionId:p,etag:h,latency:E}}getObject(e,t,n){const a=Date.now(),r=this.buckets.get(e);if(!r)return{success:!1,latency:Date.now()-a,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e);if(r.versioning&&n){const m=(this.versions.get(e).get(t)||[]).find(b=>b.versionId===n);if(!m||m.isDeleteMarker){const b=this.calculateGetLatency(0);return this.recordOperation("GET",e,t,!1,b),this.updateMetrics(e,b,!1),{success:!1,latency:b,error:m?.isDeleteMarker?"Object version is a delete marker":`Object version '${n}' not found`}}if(m.object.storageClass==="GLACIER"||m.object.storageClass==="DEEP_ARCHIVE"){const b=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",e,t,!1,b),this.updateMetrics(e,b,!1),{success:!1,latency:b,error:`Object is archived in ${m.object.storageClass}. Restore operation required.`}}const y=this.calculateGetLatency(m.object.size);return this.recordOperation("GET",e,t,!0,y),this.updateMetrics(e,y,!0),{success:!0,object:m.object,latency:y}}const l=c.get(t);if(!l){const h=this.calculateGetLatency(0);return this.recordOperation("GET",e,t,!1,h),this.updateMetrics(e,h,!1),{success:!1,latency:h,error:`Object '${t}' not found`}}if(l.storageClass==="GLACIER"||l.storageClass==="DEEP_ARCHIVE"){const h=this.calculateGlacierRestoreLatency();return this.recordOperation("GET",e,t,!1,h),this.updateMetrics(e,h,!1),{success:!1,latency:h,error:`Object is archived in ${l.storageClass}. Restore operation required.`}}const d=this.calculateGetLatency(l.size);return this.recordOperation("GET",e,t,!0,d),this.updateMetrics(e,d,!0),{success:!0,object:l,latency:d}}deleteObject(e,t,n){const a=Date.now(),r=this.buckets.get(e);if(!r)return{success:!1,latency:Date.now()-a,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e),l=c.get(t);if(!l){const m=this.calculateDeleteLatency();return this.recordOperation("DELETE",e,t,!1,m),this.updateMetrics(e,m,!1),{success:!1,latency:m,error:`Object '${t}' not found`}}if(r.versioning){const m=this.versions.get(e),y=m.get(t)||[],b=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;y.push({versionId:b,object:{...l},isDeleteMarker:!0}),m.set(t,y),this.versions.set(e,m),c.delete(t),this.objects.set(e,c);const S=this.metrics.get(e);S.versionsCount=this.getTotalVersionsCount(e),S.deleteCount++;const C=this.calculateDeleteLatency();return this.recordOperation("DELETE",e,t,!0,C),this.updateMetrics(e,C,!0),{success:!0,deleteMarker:!0,latency:C}}const d=l.size;c.delete(t),this.objects.set(e,c);const h=this.metrics.get(e);h.objectCount--,h.totalSize-=d,h.deleteCount++;const p=this.calculateDeleteLatency();return this.recordOperation("DELETE",e,t,!0,p),this.updateMetrics(e,p,!0),{success:!0,latency:p}}listObjects(e,t,n){const a=Date.now();if(!this.buckets.get(e))return{success:!1,objects:[],latency:Date.now()-a,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e);let l=Array.from(c.values());t&&(l=l.filter(p=>p.key.startsWith(t))),l.sort((p,m)=>p.key.localeCompare(m.key)),n&&(l=l.slice(0,n));const d=this.calculateListLatency(l.length);this.recordOperation("LIST",e,void 0,!0,d);const h=this.metrics.get(e);return h.listCount++,this.updateMetrics(e,d,!0),{success:!0,objects:l,latency:d}}headObject(e,t){const n=Date.now();if(!this.buckets.get(e))return{success:!1,latency:Date.now()-n,error:`Bucket '${e}' does not exist`};const c=this.objects.get(e).get(t);if(!c){const d=this.calculateHeadLatency();return this.recordOperation("HEAD",e,t,!1,d),this.updateMetrics(e,d,!1),{success:!1,latency:d,error:`Object '${t}' not found`}}const l=this.calculateHeadLatency();return this.recordOperation("HEAD",e,t,!0,l),this.updateMetrics(e,l,!0),{success:!0,object:c,latency:l}}processLifecycleTransitions(e=Date.now()){for(const[t,n]of this.lifecycleTransitions.entries()){const a=this.buckets.get(t);if(!(a&&(a.lifecycleEnabled||a.lifecycleRules&&a.lifecycleRules.some(l=>l.status==="Enabled"))))continue;const c=this.objects.get(t);for(const[l,d]of n.entries())if(e>=d.transitionScheduled){const h=c.get(l);if(h&&h.storageClass===d.currentClass)if(h.storageClass=d.targetClass,c.set(l,h),this.objects.set(t,c),d.ruleId&&d.allTransitions&&d.transitionIndex!==void 0){const p=d.transitionIndex+1;if(p<d.allTransitions.length){const m=d.allTransitions[p],y=e+m.days*24*60*60*1e3;n.set(l,{currentClass:d.targetClass,transitionScheduled:y,targetClass:m.storageClass,ruleId:d.ruleId,transitionIndex:p,allTransitions:d.allTransitions})}else{const m=this.findLifecycleRuleById(a,d.ruleId);if(m?.expiration?.days){const y=e+m.expiration.days*24*60*60*1e3;n.set(l,{currentClass:d.targetClass,transitionScheduled:y,targetClass:d.targetClass,ruleId:d.ruleId,expiration:!0})}else n.delete(l)}}else if(a.glacierEnabled&&a.glacierDays&&d.targetClass==="STANDARD_IA"){const p=e+a.glacierDays*24*60*60*1e3;n.set(l,{currentClass:"STANDARD_IA",transitionScheduled:p,targetClass:"GLACIER"})}else n.delete(l);else h||n.delete(l)}this.lifecycleTransitions.set(t,n)}this.processExpirations(e)}processExpirations(e){for(const[t,n]of this.lifecycleTransitions.entries()){if(!this.buckets.get(t))continue;const r=this.objects.get(t),c=[];for(const[l,d]of n.entries())d.expiration&&e>=d.transitionScheduled&&r.has(l)&&c.push(l);for(const l of c){const d=r.get(l);if(d){const h=this.metrics.get(t);h&&(h.objectCount=Math.max(0,h.objectCount-1),h.totalSize=Math.max(0,h.totalSize-d.size))}r.delete(l),n.delete(l)}this.objects.set(t,r),this.lifecycleTransitions.set(t,n)}}findMatchingLifecycleRule(e,t){return!e.lifecycleRules||e.lifecycleRules.length===0?void 0:e.lifecycleRules.filter(a=>a.status==="Enabled").filter(a=>!a.prefix||t.startsWith(a.prefix)).sort((a,r)=>{const c=a.prefix||"";return(r.prefix||"").length-c.length})[0]}findLifecycleRuleById(e,t){if(e.lifecycleRules)return e.lifecycleRules.find(n=>n.id===t)}findLifecycleRuleById(e,t){if(e.lifecycleRules)return e.lifecycleRules.find(n=>n.id===t)}getBucketMetrics(e){return this.metrics.get(e)}getAllBucketMetrics(){return new Map(this.metrics)}getTotalStorageSize(){let e=0;for(const t of this.metrics.values())e+=t.totalSize;return e}getTotalObjectCount(){let e=0;for(const t of this.metrics.values())e+=t.objectCount;return e}generateETag(e,t){const n=`${e}_${t}_${Date.now()}`;let a=0;for(let r=0;r<n.length;r++){const c=n.charCodeAt(r);a=(a<<5)-a+c,a=a&a}return Math.abs(a).toString(16)}calculatePutLatency(e){const n=e/1024*.1,a=(Math.random()-.5)*10;return Math.max(10,50+n+a)}calculateGetLatency(e){const n=e/1024*.15,a=(Math.random()-.5)*10;return Math.max(10,30+n+a)}calculateDeleteLatency(){const t=(Math.random()-.5)*5;return Math.max(5,20+t)}calculateListLatency(e){const n=e*.01,a=(Math.random()-.5)*10;return Math.max(20,40+n+a)}calculateHeadLatency(){const t=(Math.random()-.5)*5;return Math.max(5,15+t)}calculateGlacierRestoreLatency(){return 5e3}recordOperation(e,t,n,a,r){this.operations.push({operation:e,bucket:t,key:n,success:a,latency:r,timestamp:Date.now()}),this.operations.length>1e3&&this.operations.shift()}updateMetrics(e,t,n){const a=this.metrics.get(e);if(!a)return;const r=a.putCount+a.getCount+a.deleteCount+a.listCount;r>0?a.averageLatency=(a.averageLatency*(r-1)+t)/r:a.averageLatency=t,n||a.errorCount++,a.lastOperation=Date.now()}getTotalVersionsCount(e){const t=this.versions.get(e);if(!t)return 0;let n=0;for(const a of t.values())n+=a.length;return n}}class DT{connections=new Map;config;connectionCounter=0;queryHistory=[];MAX_HISTORY=1e3;constructor(e){this.config={maxConnections:e.maxConnections||100,minConnections:e.minConnections||0,idleTimeout:e.idleTimeout||3e5,maxLifetime:e.maxLifetime||36e5,connectionTimeout:e.connectionTimeout||5e3}}acquireConnection(e){const t=Date.now();this.cleanupIdleConnections(t);for(const[n,a]of this.connections.entries())if(a.status==="idle")return a.status="active",a.lastActivity=t,a.currentQuery=e,a.queryCount++,n;return this.connections.size<this.config.maxConnections?this.createConnection(e,t):null}releaseConnection(e,t){const n=this.connections.get(e);n&&(n.status="idle",n.lastActivity=Date.now(),n.currentQuery=void 0,t!==void 0&&this.recordQuery(t))}terminateConnection(e){const t=this.connections.get(e);t&&(t.status="terminated",this.connections.delete(e))}createConnection(e,t){const n=`conn_${++this.connectionCounter}_${t}`,a={id:n,status:"active",createdAt:t,lastActivity:t,queryCount:1,currentQuery:e};return this.connections.set(n,a),n}cleanupIdleConnections(e){const t=[];for(const[n,a]of this.connections.entries())a.status==="idle"&&(e-a.lastActivity>this.config.idleTimeout||e-a.createdAt>this.config.maxLifetime)&&t.push(n);for(const n of t)this.connections.delete(n)}recordQuery(e){const t=Date.now();this.queryHistory.push({timestamp:t,duration:e}),this.queryHistory.length>this.MAX_HISTORY&&this.queryHistory.shift()}getMetrics(){const e=Date.now();let t=0,n=0,a=0;for(const y of this.connections.values())switch(y.status){case"active":t++;break;case"idle":n++;break;case"waiting":a++;break}const r=this.connections.size,c=r>0?t/this.config.maxConnections:0,l=this.queryHistory.filter(y=>e-y.timestamp<6e4),d=l.length>0?l.reduce((y,b)=>y+b.duration,0)/l.length:0,p=this.queryHistory.filter(y=>e-y.timestamp<1e3).length,m=r>=this.config.maxConnections?this.config.connectionTimeout/2:0;return{totalConnections:r,activeConnections:t,idleConnections:n,waitingConnections:a,utilization:c,averageQueryTime:d,queriesPerSecond:p,connectionWaitTime:m}}getConnection(e){return this.connections.get(e)}getAllConnections(){return Array.from(this.connections.values())}updateConfig(e){if(this.config={...this.config,...e},e.maxConnections!==void 0&&e.maxConnections<this.connections.size){const t=this.connections.size-e.maxConnections,n=Array.from(this.connections.entries()).filter(([a,r])=>r.status==="idle").slice(0,t);for(const[a]of n)this.terminateConnection(a)}}reset(){this.connections.clear(),this.connectionCounter=0,this.queryHistory=[]}}class NT{static exportMetrics(e,t){const n=[],a=this.buildLabels(e,t),r=t.timestamp||Date.now();if(n.push("# HELP component_throughput_total Component throughput in operations per second"),n.push("# TYPE component_throughput_total gauge"),n.push(`component_throughput_total{${a}} ${t.throughput||0} ${r}`),n.push("# HELP component_latency_ms Component latency in milliseconds"),n.push("# TYPE component_latency_ms gauge"),n.push(`component_latency_ms{${a}} ${t.latency||0} ${r}`),t.latencyP50!==void 0&&(n.push("# HELP component_latency_p50_ms Component 50th percentile latency in milliseconds"),n.push("# TYPE component_latency_p50_ms gauge"),n.push(`component_latency_p50_ms{${a}} ${t.latencyP50} ${r}`)),t.latencyP99!==void 0&&(n.push("# HELP component_latency_p99_ms Component 99th percentile latency in milliseconds"),n.push("# TYPE component_latency_p99_ms gauge"),n.push(`component_latency_p99_ms{${a}} ${t.latencyP99} ${r}`)),n.push("# HELP component_error_rate Component error rate (0-1)"),n.push("# TYPE component_error_rate gauge"),n.push(`component_error_rate{${a}} ${t.errorRate||0} ${r}`),n.push("# HELP component_utilization Component utilization (0-1)"),n.push("# TYPE component_utilization gauge"),n.push(`component_utilization{${a}} ${t.utilization||0} ${r}`),t.customMetrics)for(const[c,l]of Object.entries(t.customMetrics)){const d=this.sanitizeMetricName(c);n.push(`# HELP component_${d} Component custom metric: ${c}`),n.push(`# TYPE component_${d} gauge`),n.push(`component_${d}{${a}} ${l} ${r}`)}return n.join(`
`)+`
`}static buildLabels(e,t){const n=[];n.push(`component_id="${this.escapeLabelValue(e.id)}"`),n.push(`component_type="${this.escapeLabelValue(e.type)}"`),e.data.label&&n.push(`component_name="${this.escapeLabelValue(e.data.label)}"`);const a=e.data.config||{};return a.environment&&n.push(`environment="${this.escapeLabelValue(String(a.environment))}"`),a.namespace&&n.push(`namespace="${this.escapeLabelValue(String(a.namespace))}"`),n.join(",")}static escapeLabelValue(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}static sanitizeMetricName(e){return e.replace(/[^a-zA-Z0-9_:]/g,"_").replace(/^[^a-zA-Z]/,"_")}static exportAllMetrics(e,t){const n=[];for(const a of e){const r=t.get(a.id);r&&n.push(this.exportMetrics(a,r))}return n.join(`
`)}static exportEndpointMetrics(e,t){return t?this.exportMetrics(e,t):""}}class _T{config=null;targetStatuses=new Map;scrapedMetrics=new Map;lastScrapeTimes=new Map;prometheusMetrics={scrapeRequestsTotal:0,scrapeErrorsTotal:0,scrapeDurationTotal:0,targetsUp:0,targetsDown:0,samplesScraped:0};initializeConfig(e){const t=e.data.config||{};this.config={global:{scrape_interval:t.scrapeInterval||"15s",evaluation_interval:t.evaluationInterval||"15s",external_labels:{prometheus:"archiphoenix"}},scrape_configs:this.buildScrapeConfigs(t),alerting:t.enableAlertmanager?{alertmanagers:[{static_configs:[{targets:[t.alertmanagerUrl||"http://alertmanager:9093"].map(n=>{const a=n.match(/^https?:\/\/([^\/]+)/);return a?a[1]:n})}]}]}:void 0,remote_write:t.enableRemoteWrite&&t.remoteWrite?t.remoteWrite.map(n=>({url:n.url})):void 0},this.initializeTargetStatuses()}buildScrapeConfigs(e){if(e.scrape_configs&&Array.isArray(e.scrape_configs))return e.scrape_configs.map(a=>({job_name:a.job_name,scrape_interval:a.scrape_interval,scrape_timeout:a.scrape_timeout,metrics_path:a.metrics_path,static_configs:a.static_configs||[]}));const t=[],n=e.scrapeInterval||"15s";if(e.targets&&Array.isArray(e.targets)){const a=new Map;for(const r of e.targets){const c=r.job||"default";a.has(c)||a.set(c,[]),a.get(c).push(r)}for(const[r,c]of a.entries()){const l=c[0],d=l.interval||n,h=l.metricsPath||"/metrics",p=c.map(m=>{try{const y=new URL(m.endpoint);return`${y.hostname}${y.port?":"+y.port:""}`}catch{const y=m.endpoint.match(/^https?:\/\/([^\/]+)/);return y?y[1]:m.endpoint}});t.push({job_name:r,scrape_interval:d,metrics_path:h,static_configs:[{targets:p,labels:l.labels||{}}]})}}return t}initializeTargetStatuses(){if(this.targetStatuses.clear(),!!this.config){for(const e of this.config.scrape_configs)if(e.static_configs)for(const t of e.static_configs)for(const n of t.targets){const a=e.metrics_path?`http://${n}${e.metrics_path}`:`http://${n}/metrics`,r=`${e.job_name}:${n}`;this.targetStatuses.set(r,{job:e.job_name,endpoint:a,lastScrape:0,lastSuccess:null,lastError:null,scrapeDuration:null,up:!1,labels:t.labels})}}}performScraping(e,t,n){if(this.config){this.parseDuration(this.config.global.scrape_interval||"15s"),this.prometheusMetrics.targetsUp=0,this.prometheusMetrics.targetsDown=0;for(const[a,r]of this.targetStatuses.entries()){const c=this.lastScrapeTimes.get(a)||0,l=this.getScrapeIntervalForTarget(r.job),d=this.parseDuration(l);e-c>=d&&(this.scrapeTarget(a,r,e,t,n),this.lastScrapeTimes.set(a,e)),r.up?this.prometheusMetrics.targetsUp++:this.prometheusMetrics.targetsDown++}}}scrapeTarget(e,t,n,a,r){const c=performance.now();this.prometheusMetrics.scrapeRequestsTotal++;try{const l=this.findNodeByEndpoint(t.endpoint,a);if(!l)throw new Error(`Target not found: ${t.endpoint}`);const d=r.get(l.id);if(!d)throw new Error(`Metrics not available for component: ${l.id}`);const h=NT.exportMetrics(l,d);t.lastScrape=n,t.lastSuccess=n,t.lastError=null,t.up=!0;const p=performance.now()-c;t.scrapeDuration=p,this.prometheusMetrics.scrapeDurationTotal+=p,this.prometheusMetrics.samplesScraped+=this.countSamples(h),this.scrapedMetrics.set(e,d)}catch(l){const d=performance.now()-c;t.lastScrape=n,t.lastSuccess=null,t.lastError=l instanceof Error?l.message:String(l),t.up=!1,t.scrapeDuration=d,this.prometheusMetrics.scrapeErrorsTotal++}}findNodeByEndpoint(e,t){try{const n=new URL(e),a=n.hostname,r=n.port?parseInt(n.port):null;for(const c of t){const l=c.data.config||{},d=l.port||l.metricsPort||l.metrics?.port;if(c.data.label?.toLowerCase().replace(/\s+/g,"-")===a||r&&d===r)return c}}catch{}return null}getScrapeIntervalForTarget(e){return this.config&&(this.config.scrape_configs.find(n=>n.job_name===e)?.scrape_interval||this.config.global.scrape_interval)||"15s"}parseDuration(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 15e3;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 15e3}}countSamples(e){return e.split(`
`).filter(t=>t.trim()&&!t.startsWith("#")).length}getTargetStatuses(){return Array.from(this.targetStatuses.values())}getPrometheusMetrics(){return{...this.prometheusMetrics}}calculateLoad(){const e=this.prometheusMetrics.scrapeRequestsTotal,t=this.prometheusMetrics.scrapeErrorsTotal,n=this.prometheusMetrics.scrapeDurationTotal,a=this.prometheusMetrics.samplesScraped,r=this.targetStatuses.size,c=this.parseDuration(this.config?.global.scrape_interval||"15s"),l=r>0?1e3/c*r:0,d=e>0?n/e:0,h=e>0?t/e:0,p=l*(a/e||0);return{scrapeRequestsPerSecond:l,averageScrapeDuration:d,errorRate:h,samplesPerSecond:p}}}class jT{config=null;lastRefreshTimes=new Map;lastAlertEvaluationTimes=new Map;grafanaMetrics={queriesPerSecond:0,dashboardRefreshesPerSecond:0,alertEvaluationsPerSecond:0,datasourceErrors:0,activeDashboards:0,activePanels:0,totalQueries:0,cachedQueries:0,queryLatency:0,renderingLatency:0};queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(e){const t=e.data.config||{};this.config=t,this.initializeRefreshTimes(),this.initializeAlertEvaluationTimes()}initializeRefreshTimes(){if(this.lastRefreshTimes.clear(),!this.config?.dashboards)return;const e=this.normalizeDashboards(this.config.dashboards);for(const t of e)this.lastRefreshTimes.set(t.id,0)}initializeAlertEvaluationTimes(){if(this.lastAlertEvaluationTimes.clear(),!(!this.config?.alerts||!this.config.enableAlerting))for(const e of this.config.alerts)this.lastAlertEvaluationTimes.set(e.id,0)}normalizeDashboards(e){return!e||!Array.isArray(e)?[]:e.map(t=>{if(t&&typeof t=="object"){if(typeof t.panels=="number")return{id:t.id||String(Date.now()),name:t.name||"Dashboard",panels:[],tags:Array.isArray(t.tags)?t.tags:[],refresh:t.refresh||"30s"};if(Array.isArray(t.panels))return{id:t.id||String(Date.now()),name:t.name||"Dashboard",panels:t.panels.map(n=>({id:n.id||`panel-${Date.now()}`,title:n.title||"Panel",type:n.type||"graph",datasource:n.datasource||"Prometheus",queries:Array.isArray(n.queries)?n.queries:[{refId:"A",expr:"up"}],gridPos:n.gridPos||{x:0,y:0,w:12,h:8}})),tags:Array.isArray(t.tags)?t.tags:[],variables:t.variables,refresh:t.refresh||"30s",timeRange:t.timeRange}}return t}).filter(t=>t&&typeof t=="object"&&t.id)}performUpdate(e,t=!0,n){this.config&&(this.updateDashboards(e,t,n),this.config.enableAlerting&&this.evaluateAlerts(e,t),this.updateMetrics())}updateDashboards(e,t,n){if(!this.config?.dashboards)return;const a=this.normalizeDashboards(this.config.dashboards);let r=0,c=0;for(const l of a){const d=this.parseDuration(l.refresh||"30s"),h=this.lastRefreshTimes.get(l.id)||0;if(e-h>=d){this.lastRefreshTimes.set(l.id,e);for(const p of l.panels){const m=p.datasource,y=m&&this.isLokiDatasource(m);for(const C of p.queries){r++;const E=this.simulateQueryExecution(C,t,y,n);c+=E,this.queryLatencyHistory.push(E),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift()}const b=this.simulatePanelRendering(p),S=this.grafanaMetrics.renderingLatency;this.grafanaMetrics.renderingLatency=S*.9+b*.1}}}this.grafanaMetrics.totalQueries+=r,r>0&&(this.grafanaMetrics.queryLatency=c/r)}isLokiDatasource(e){if(!this.config?.datasources)return!1;const n=(Array.isArray(this.config.datasources)?this.config.datasources:[]).find(a=>typeof a=="string"?a===e:a.name===e);return typeof n=="object"&&n.type?n.type==="loki":!1}evaluateAlerts(e,t){if(this.config?.alerts)for(const n of this.config.alerts){const a=this.parseDuration(n.for||"1m"),r=this.lastAlertEvaluationTimes.get(n.id)||0;e-r>=a&&(this.lastAlertEvaluationTimes.set(n.id,e),this.simulateQueryExecution({refId:"A",expr:n.condition.query},t),t||this.grafanaMetrics.datasourceErrors++)}}simulateQueryExecution(e,t,n=!1,a){if(n&&a)try{const d=Date.now()-36e5,h=Date.now(),p=a(e.expr,d,h,100);return p.success||this.grafanaMetrics.datasourceErrors++,p.latency}catch{return this.grafanaMetrics.datasourceErrors++,1e3}if(!t)return this.grafanaMetrics.datasourceErrors++,1e3;let r=50;const c=this.estimateQueryComplexity(e.expr);r+=c*10;const l=(Math.random()-.5)*20;return Math.max(10,r+l)}estimateQueryComplexity(e){if(!e)return 0;let t=1;e.includes("[")&&(t+=2);const n=["sum","avg","max","min","count","rate","irate","increase"];for(const r of n)e.toLowerCase().includes(r)&&(t+=1);const a=(e.match(/\|/g)||[]).length;return t+=a,t}simulatePanelRendering(e){const n={stat:5,gauge:10,piechart:15,bargraph:20,table:25,graph:30}[e.type]||20,a=Math.sqrt(e.queries.length);return n*a}updateMetrics(){if(!this.config)return;const e=this.normalizeDashboards(this.config.dashboards);this.grafanaMetrics.activeDashboards=e.length,this.grafanaMetrics.activePanels=e.reduce((a,r)=>a+r.panels.length,0);let t=0,n=0;for(const a of e){const c=1e3/this.parseDuration(a.refresh||"30s");n+=c;const l=a.panels.reduce((d,h)=>d+h.queries.length,0);t+=c*l}if(this.grafanaMetrics.queriesPerSecond=t,this.grafanaMetrics.dashboardRefreshesPerSecond=n,this.config.enableAlerting&&this.config.alerts){let a=0;for(const r of this.config.alerts){const l=1e3/this.parseDuration(r.for||"1m");a+=l}this.grafanaMetrics.alertEvaluationsPerSecond=a}else this.grafanaMetrics.alertEvaluationsPerSecond=0;if(this.queryLatencyHistory.length>0){const a=this.queryLatencyHistory.reduce((r,c)=>r+c,0)/this.queryLatencyHistory.length;this.grafanaMetrics.queryLatency=a}}parseDuration(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 3e4;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 3e4}}getGrafanaMetrics(){return{...this.grafanaMetrics}}calculateLoad(){const e=this.grafanaMetrics,t=.1,n=Math.min(.7,e.queriesPerSecond/100),a=Math.min(.1,e.alertEvaluationsPerSecond/10),r=Math.min(.1,e.activePanels/100),c=Math.min(.95,t+n+a+r),l=.2,d=Math.min(.4,e.activeDashboards/50),h=Math.min(.3,e.cachedQueries/1e3),p=Math.min(.95,l+d+h),m=e.totalQueries+e.alertEvaluationsPerSecond,y=m>0?e.datasourceErrors/m:0;return{queriesPerSecond:e.queriesPerSecond,dashboardRefreshesPerSecond:e.dashboardRefreshesPerSecond,alertEvaluationsPerSecond:e.alertEvaluationsPerSecond,averageQueryLatency:e.queryLatency,averageRenderingLatency:e.renderingLatency,errorRate:y,cpuUtilization:c,memoryUtilization:p}}getActiveDatasources(){return this.config?.datasources?this.config.datasources.length>0&&typeof this.config.datasources[0]=="string"?this.config.datasources.map(e=>({name:e,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:e===this.config.datasources[0]})):this.config.datasources.filter(e=>e&&typeof e=="object"&&e.name):[]}isPrometheusAvailable(e){return!(!e||!this.getActiveDatasources().find(a=>a.type==="prometheus"))}}class LT{config=null;streams=new Map;queryStatuses=new Map;lastIngestionTimes=new Map;lokiMetrics={ingestionRequestsTotal:0,ingestionErrorsTotal:0,ingestionLinesTotal:0,ingestionBytesTotal:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,activeStreams:0,totalStorageSize:0,retentionDeletions:0};ingestionLatencyHistory=[];queryLatencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(e){const t=e.data.config||{};this.config={serverUrl:t.serverUrl||"http://loki:3100",retentionPeriod:t.retentionPeriod||"168h",maxStreams:t.maxStreams||1e4,maxLineSize:t.maxLineSize||256e3,enableCompression:t.enableCompression??!0,compressionType:t.compressionType||"gzip",enableAuth:t.enableAuth??!1,enableMultiTenancy:t.enableMultiTenancy??!1,tenants:t.tenants||[],ingestionRateLimit:t.ingestionRateLimit,queryRateLimit:t.queryRateLimit},this.initializeStreamsFromConfig(t),this.initializeQueriesFromConfig(t)}initializeStreamsFromConfig(e){if(e.streams&&Array.isArray(e.streams))for(const t of e.streams){const n=this.getStreamKey(t.labels||{}),a=[];if(t.entries&&Array.isArray(t.entries))for(const c of t.entries)a.push({timestamp:c.timestamp||Date.now().toString()+"000000",line:c.line||""});const r=t.size?t.size*1024*1024*1024:0;this.streams.set(n,{labels:t.labels||{},entries:a,size:r,lastEntryTime:Date.now()})}}initializeQueriesFromConfig(e){if(e.queries&&Array.isArray(e.queries))for(const t of e.queries){const n=t.id||`query-${Date.now()}-${Math.random()}`;this.queryStatuses.set(n,{id:n,query:t.query||"",lastExecution:0,lastSuccess:null,lastError:null,executionDuration:null,resultsCount:t.results||0,success:!0})}}processIngestion(e,t){if(!this.config)return{success:!1,error:"Loki not configured",ingestedLines:0,ingestedBytes:0};const n=performance.now();this.lokiMetrics.ingestionRequestsTotal++;try{if(this.config.ingestionRateLimit){const l=t||"default",d=this.lastIngestionTimes.get(l)||0,h=Date.now();h-d<1e3,this.lastIngestionTimes.set(l,h)}let a=0,r=0;for(const l of e){const d=this.getStreamKey(l.stream);if(!this.streams.has(d)&&this.streams.size>=(this.config.maxStreams||1e4)){this.lokiMetrics.ingestionErrorsTotal++;continue}let h=this.streams.get(d);h||(h={labels:l.stream,entries:[],size:0,lastEntryTime:Date.now()},this.streams.set(d,h));for(const[p,m]of l.values){const y=new Blob([m]).size;if(y>(this.config.maxLineSize||256e3)){this.lokiMetrics.ingestionErrorsTotal++;continue}h.entries.push({timestamp:p,line:m}),h.size+=y,h.lastEntryTime=Math.max(h.lastEntryTime,this.parseTimestamp(p)),a++,r+=y}if(this.config.enableCompression){const p=this.getCompressionRatio(this.config.compressionType||"gzip");h.size=Math.floor(h.size*p)}}this.lokiMetrics.ingestionLinesTotal+=a,this.lokiMetrics.ingestionBytesTotal+=r,this.lokiMetrics.totalStorageSize+=r,this.lokiMetrics.activeStreams=this.streams.size;const c=performance.now()-n;return this.ingestionLatencyHistory.push(c),this.ingestionLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.ingestionLatencyHistory.shift(),{success:!0,ingestedLines:a,ingestedBytes:r}}catch(a){return performance.now()-n,this.lokiMetrics.ingestionErrorsTotal++,{success:!1,error:a instanceof Error?a.message:String(a),ingestedLines:0,ingestedBytes:0}}}executeQuery(e,t,n,a){if(!this.config)return{success:!1,error:"Loki not configured",latency:0,resultsCount:0};const r=performance.now();this.lokiMetrics.queryRequestsTotal++;try{this.config.queryRateLimit;const c=this.parseLogQL(e),l=this.executeLogQLQuery(c,t,n,a),d=performance.now()-r;return this.lokiMetrics.queryDurationTotal+=d,this.queryLatencyHistory.push(d),this.queryLatencyHistory.length>this.MAX_LATENCY_HISTORY&&this.queryLatencyHistory.shift(),{success:!0,result:l,latency:d,resultsCount:l.reduce((h,p)=>h+p.values.length,0)}}catch(c){const l=performance.now()-r;return this.lokiMetrics.queryErrorsTotal++,{success:!1,error:c instanceof Error?c.message:String(c),latency:l,resultsCount:0}}}parseLogQL(e){const t={},n=[],a=[],r=e.match(/^\{([^}]+)\}/);if(r){const b=r[1].matchAll(/(\w+)=["']([^"']+)["']/g);for(const S of b)t[S[1]]=S[2]}const c=e.match(/\|\s*=\s*["']([^"']+)["']/);c&&n.push({type:"contains",pattern:c[1]});const l=e.match(/!\s*=\s*["']([^"']+)["']/);l&&n.push({type:"not_contains",pattern:l[1]});const d=e.match(/\|\s*~\s*["']([^"']+)["']/);d&&n.push({type:"regex",pattern:d[1]});const h=e.matchAll(/\|\s*(\w+)\s*(=|=~|!=|!~)\s*["']([^"']+)["']/g);for(const y of h)a.push({label:y[1],operator:y[2],value:y[3]});let p;const m=e.match(/\|\s*(\w+)\(([^)]*)\)/);return m&&(p={function:m[1],params:m[2]?m[2].split(",").map(y=>y.trim()):[]}),{streamSelector:t,lineFilters:n,labelFilters:a,aggregation:p}}executeLogQLQuery(e,t,n,a){const r=[],c=Date.now(),l=t||c-36e5,d=n||c;for(const[h,p]of this.streams.entries()){let m=!0;for(const[S,C]of Object.entries(e.streamSelector))if(p.labels[S]!==C){m=!1;break}if(!m)continue;let b=p.entries.filter(S=>{const C=this.parseTimestamp(S.timestamp);return C>=l&&C<=d});for(const S of e.lineFilters)b=b.filter(C=>{switch(S.type){case"contains":return C.line.includes(S.pattern);case"not_contains":return!C.line.includes(S.pattern);case"regex":try{return new RegExp(S.pattern).test(C.line)}catch{return!1}}});for(const S of e.labelFilters){const C=p.labels[S.label];if(C===void 0){b=[];break}switch(S.operator){case"=":C!==S.value&&(b=[]);break;case"!=":C===S.value&&(b=[]);break;case"=~":try{new RegExp(S.value).test(C)||(b=[])}catch{b=[]}break;case"!~":try{new RegExp(S.value).test(C)&&(b=[])}catch{}break}}if(a&&b.length>a&&(b=b.slice(0,a)),e.aggregation){const S=this.applyAggregation(e.aggregation,b);r.push({stream:p.labels,values:[[Date.now().toString()+"000000",S.toString()]]})}else b.length>0&&r.push({stream:p.labels,values:b.map(S=>[S.timestamp,S.line])})}return r}applyAggregation(e,t){switch(e.function.toLowerCase()){case"rate":if(t.length<2)return 0;const n=this.parseTimestamp(t[0].timestamp),r=(this.parseTimestamp(t[t.length-1].timestamp)-n)/1e3;return r>0?t.length/r:0;case"count_over_time":return t.length;case"sum":return t.reduce((l,d)=>{const h=parseFloat(d.line);return l+(isNaN(h)?0:h)},0);case"avg":case"average":const c=t.map(l=>parseFloat(l.line)).filter(l=>!isNaN(l));return c.length>0?c.reduce((l,d)=>l+d,0)/c.length:0;default:return t.length}}performRetention(e){if(!this.config)return;const t=this.parseDuration(this.config.retentionPeriod||"168h"),n=e-t;let a=0,r=0;for(const[c,l]of this.streams.entries()){const d=l.entries.length;l.entries=l.entries.filter(h=>this.parseTimestamp(h.timestamp)>n),l.entries.length<d&&(a+=d-l.entries.length,l.size=l.entries.reduce((h,p)=>h+new Blob([p.line]).size,0),r+=l.size),l.entries.length===0&&this.streams.delete(c)}this.lokiMetrics.retentionDeletions+=a,this.lokiMetrics.totalStorageSize=Math.max(0,this.lokiMetrics.totalStorageSize-r),this.lokiMetrics.activeStreams=this.streams.size}getStreams(){return Array.from(this.streams.values())}getLokiMetrics(){return{...this.lokiMetrics}}calculateLoad(){const e=this.lokiMetrics.ingestionRequestsTotal,t=this.lokiMetrics.ingestionErrorsTotal,n=this.lokiMetrics.ingestionLinesTotal,a=this.lokiMetrics.ingestionBytesTotal,r=this.lokiMetrics.queryRequestsTotal,c=this.lokiMetrics.queryErrorsTotal,l=this.lokiMetrics.queryDurationTotal,d=this.ingestionLatencyHistory.length>0?this.ingestionLatencyHistory.reduce((M,k)=>M+k,0)/this.ingestionLatencyHistory.length:0,h=this.queryLatencyHistory.length>0?this.queryLatencyHistory.reduce((M,k)=>M+k,0)/this.queryLatencyHistory.length:r>0?l/r:0,p=e>0?t/e:0,m=r>0?c/r:0,y=n>0?n/100:0,b=a>0?a/100:0,S=r>0?r/100:0,C=(this.config?.maxStreams||1e4)*100*1024*1024,E=Math.min(1,this.lokiMetrics.totalStorageSize/C);return{ingestionLinesPerSecond:y,ingestionBytesPerSecond:b,averageIngestionLatency:d,ingestionErrorRate:p,queriesPerSecond:S,averageQueryLatency:h,queryErrorRate:m,storageUtilization:E,streamCount:this.streams.size}}getStreamKey(e){return Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join(",")}parseTimestamp(e){const t=BigInt(e);return Number(t/BigInt(1e6))}parseDuration(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 10080*60*1e3;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 10080*60*1e3}}getCompressionRatio(e){switch(e){case"gzip":return .3;case"snappy":return .5;case"lz4":return .4;default:return .3}}}class zT{config=null;traces=new Map;serviceStats=new Map;jaegerMetrics={spansReceivedTotal:0,spansDroppedTotal:0,spansProcessedTotal:0,samplingDecisionsTotal:0,samplingErrorsTotal:0,tracesStoredTotal:0,tracesDroppedTotal:0,storageSizeBytes:0,queryRequestsTotal:0,queryErrorsTotal:0,queryDurationTotal:0,spansSentTotal:0,spansFailedTotal:0};samplingState={};queryHistory=[];MAX_QUERY_HISTORY=100;lastCleanupTime=0;CLEANUP_INTERVAL=6e4;initializeConfig(e){const t=e.data.config||{};this.config={serverUrl:t.serverUrl||"http://jaeger:16686",agentEndpoint:t.agentEndpoint||"http://jaeger-agent:6831",collectorEndpoint:t.collectorEndpoint||"http://jaeger-collector:14268",queryEndpoint:t.queryEndpoint||"http://jaeger-query:16686",samplingType:t.samplingType||"probabilistic",samplingParam:t.samplingParam??.001,storageBackend:t.storageBackend||"elasticsearch",storageUrl:t.storageUrl||"http://elasticsearch:9200",enableUIGraphQL:t.enableUIGraphQL??!0,enableMetrics:t.enableMetrics??!0,metricsBackend:t.metricsBackend||"prometheus",metricsUrl:t.metricsUrl||"http://prometheus:9090",maxTraces:t.maxTraces||1e4,traceTTL:t.traceTTL||864e5},this.initializeSampling()}initializeSampling(){if(!this.config)return;const{samplingType:e,samplingParam:t}=this.config;switch(e){case"probabilistic":this.samplingState.probabilistic={probability:Math.max(0,Math.min(1,t||.001))};break;case"ratelimiting":this.samplingState.rateLimiting={maxTracesPerSecond:Math.max(1,t||10),bucket:{tokens:t||10,lastRefill:Date.now()}};break;case"peroperation":this.samplingState.perOperation=new Map;break}}receiveSpan(e){if(!this.config)return{sample:!1};this.jaegerMetrics.spansReceivedTotal++;const t=this.makeSamplingDecision(e);return this.jaegerMetrics.samplingDecisionsTotal++,t.sample?(this.processSpan(e),t):(this.jaegerMetrics.spansDroppedTotal++,t)}receiveSpansFromDataFlow(e){for(const t of e)this.receiveSpan(t)}makeSamplingDecision(e){if(!this.config)return{sample:!1};const{samplingType:t}=this.config;try{switch(t){case"probabilistic":return this.probabilisticSampling(e);case"ratelimiting":return this.rateLimitingSampling(e);case"peroperation":return this.perOperationSampling(e);default:return{sample:!0}}}catch{return this.jaegerMetrics.samplingErrorsTotal++,{sample:!1}}}probabilisticSampling(e){const t=this.samplingState.probabilistic;if(!t)return{sample:!0};const n=Math.random()<t.probability;return{sample:n,tags:n?[{key:"sampler.type",value:"probabilistic"},{key:"sampler.param",value:t.probability.toString()}]:void 0}}rateLimitingSampling(e){const t=this.samplingState.rateLimiting;if(!t)return{sample:!0};const n=Date.now(),a=n-t.bucket.lastRefill,r=1e3/t.maxTracesPerSecond,c=Math.floor(a/r);return c>0&&(t.bucket.tokens=Math.min(t.maxTracesPerSecond,t.bucket.tokens+c),t.bucket.lastRefill=n),t.bucket.tokens>0?(t.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"ratelimiting"},{key:"sampler.param",value:t.maxTracesPerSecond.toString()}]}):{sample:!1}}perOperationSampling(e){this.samplingState.perOperation||(this.samplingState.perOperation=new Map);const t=`${e.serviceName}:${e.operationName}`;let n=this.samplingState.perOperation.get(t);if(!n){const d=this.config?.samplingParam||10;n={maxTracesPerSecond:d,bucket:{tokens:d,lastRefill:Date.now()}},this.samplingState.perOperation.set(t,n)}const a=Date.now(),r=a-n.bucket.lastRefill,c=1e3/n.maxTracesPerSecond,l=Math.floor(r/c);return l>0&&(n.bucket.tokens=Math.min(n.maxTracesPerSecond,n.bucket.tokens+l),n.bucket.lastRefill=a),n.bucket.tokens>0?(n.bucket.tokens--,{sample:!0,tags:[{key:"sampler.type",value:"peroperation"},{key:"sampler.param",value:n.maxTracesPerSecond.toString()}]}):{sample:!1}}processSpan(e){this.jaegerMetrics.spansProcessedTotal++;let t=this.traces.get(e.traceId);t||(t={traceId:e.traceId,spans:[],startTime:e.startTime,duration:e.duration,serviceCount:0,spanCount:0,hasErrors:!1},this.traces.set(e.traceId,t),this.jaegerMetrics.tracesStoredTotal++),t.spans.push(e),t.spanCount=t.spans.length,e.startTime<t.startTime&&(t.startTime=e.startTime);const n=Math.max(...t.spans.map(r=>r.startTime+r.duration));t.duration=n-t.startTime,!e.parentSpanId&&!t.rootService&&(t.rootService=e.serviceName,t.rootOperation=e.operationName),(e.tags.some(r=>r.key==="error"&&r.value===!0)||e.logs.some(r=>r.fields.some(c=>c.key==="error")))&&(t.hasErrors=!0),this.updateServiceStats(e,t),this.config&&this.traces.size>this.config.maxTraces&&this.evictOldestTraces()}updateServiceStats(e,t){let n=this.serviceStats.get(e.serviceName);n||(n={name:e.serviceName,tracesTotal:0,errorsTotal:0,avgDuration:0,spansTotal:0,lastTraceTime:0},this.serviceStats.set(e.serviceName,n)),n.spansTotal++,n.lastTraceTime=Math.max(n.lastTraceTime,e.startTime/1e3);const a=n.avgDuration*(n.spansTotal-1)+e.duration;n.avgDuration=a/n.spansTotal,(t.spans.length===1||t.spans[0].serviceName===e.serviceName)&&(n.tracesTotal++,t.hasErrors&&n.errorsTotal++)}evictOldestTraces(){if(!this.config)return;const e=Date.now()*1e3,t=this.config.traceTTL*1e3,n=this.config.maxTraces,a=[];for(const[r,c]of this.traces.entries())e-c.startTime>t&&a.push(r);if(this.traces.size-a.length>n){const c=Array.from(this.traces.entries()).filter(([l])=>!a.includes(l)).sort(([,l],[,d])=>l.startTime-d.startTime).slice(0,this.traces.size-a.length-n);a.push(...c.map(([l])=>l))}for(const r of a){const c=this.traces.get(r);if(c){for(const d of c.spans){const h=this.serviceStats.get(d.serviceName);h&&(h.tracesTotal=Math.max(0,h.tracesTotal-1),c.hasErrors&&(h.errorsTotal=Math.max(0,h.errorsTotal-1)))}const l=this.calculateTraceSize(c);this.jaegerMetrics.storageSizeBytes=Math.max(0,this.jaegerMetrics.storageSizeBytes-l),this.jaegerMetrics.tracesDroppedTotal++,this.traces.delete(r)}}}performCleanup(e){e-this.lastCleanupTime<this.CLEANUP_INTERVAL||(this.lastCleanupTime=e,this.evictOldestTraces())}queryTraces(e){const t=performance.now();this.jaegerMetrics.queryRequestsTotal++;try{let n=Array.from(this.traces.values());if(e.service&&(n=n.filter(l=>l.spans.some(d=>d.serviceName===e.service))),e.operation&&(n=n.filter(l=>l.spans.some(d=>d.operationName===e.operation))),e.tags&&(n=n.filter(l=>l.spans.some(d=>Object.entries(e.tags).every(([h,p])=>d.tags.some(m=>m.key===h&&String(m.value)===String(p)))))),e.startTime){const l=e.startTime*1e3;n=n.filter(d=>d.startTime>=l)}if(e.endTime){const l=e.endTime*1e3;n=n.filter(d=>d.startTime+d.duration<=l)}n.sort((l,d)=>d.startTime-l.startTime);const a=e.limit||20,r=n.length;n=n.slice(0,a);const c=performance.now()-t;return this.jaegerMetrics.queryDurationTotal+=c,this.queryHistory.push({params:e,timestamp:Date.now(),duration:c,resultsCount:n.length}),this.queryHistory.length>this.MAX_QUERY_HISTORY&&this.queryHistory.shift(),{traces:n,total:r,limit:a}}catch(n){return this.jaegerMetrics.queryErrorsTotal++,{traces:[],total:0,limit:e.limit||20,errors:[n instanceof Error?n.message:String(n)]}}}getServiceStats(){return Array.from(this.serviceStats.values())}getRecentTraces(e=20){const t=Array.from(this.traces.values());return t.sort((n,a)=>a.startTime-n.startTime),t.slice(0,e)}getTraceById(e){return this.traces.get(e)}getJaegerMetrics(){return{...this.jaegerMetrics}}calculateTraceSize(e){let t=0;for(const n of e.spans)t+=100,t+=n.operationName.length,t+=n.serviceName.length,t+=n.tags.length*50,t+=n.logs.length*100;return t}calculateLoad(){const e=this.jaegerMetrics.spansReceivedTotal,t=this.jaegerMetrics.tracesStoredTotal,n=this.jaegerMetrics.spansDroppedTotal,a=this.jaegerMetrics.queryRequestsTotal,r=this.jaegerMetrics.queryDurationTotal,c=this.jaegerMetrics.queryErrorsTotal,l=e>0?1-n/e:0,d=a>0?r/a:0,h=a>0?c/a:0,p=this.config?.maxTraces||1e4,m=this.traces.size/p,y=e/60,b=t/60;return{spansPerSecond:y,tracesPerSecond:b,samplingRate:l,storageUtilization:m,queryLatency:d,errorRate:h}}getConfig(){return this.config?{...this.config}:null}}class PT{config=null;node=null;receiversMap=new Map;processorsMap=new Map;exportersMap=new Map;pipelinesByType=new Map;batchStates=new Map;memoryState={currentUsage:0,limitBytes:512*1024*1024,droppedCount:0};metrics={tracesReceivedTotal:0,metricsReceivedTotal:0,logsReceivedTotal:0,tracesProcessedTotal:0,metricsProcessedTotal:0,logsProcessedTotal:0,tracesDroppedByMemoryLimiter:0,metricsDroppedByMemoryLimiter:0,logsDroppedByMemoryLimiter:0,batchesCreated:0,tracesExportedTotal:0,metricsExportedTotal:0,logsExportedTotal:0,exportErrorsTotal:0,pipelineLatencyMs:0,currentMemoryUsage:0};latencyHistory=[];MAX_LATENCY_HISTORY=100;initializeConfig(e){this.node=e;const t=e.data.config||{};this.config={receivers:t.receivers||[],processors:t.processors||[],exporters:t.exporters||[],pipelines:t.pipelines||[]},this.buildMaps(),this.initializeMemoryLimiter(),this.initializeBatchProcessors()}buildMaps(){if(this.config){if(this.receiversMap.clear(),this.config.receivers)for(const e of this.config.receivers)this.receiversMap.set(e.id,e);if(this.processorsMap.clear(),this.config.processors)for(const e of this.config.processors)this.processorsMap.set(e.id,e);if(this.exportersMap.clear(),this.config.exporters)for(const e of this.config.exporters)this.exportersMap.set(e.id,e);if(this.pipelinesByType.clear(),this.config.pipelines)for(const e of this.config.pipelines)this.pipelinesByType.has(e.type)||this.pipelinesByType.set(e.type,[]),this.pipelinesByType.get(e.type).push(e)}}initializeMemoryLimiter(){if(!this.config?.processors)return;const e=this.config.processors.find(t=>t.type==="memory_limiter"&&t.enabled);e?.config?.limit_mib?this.memoryState.limitBytes=e.config.limit_mib*1024*1024:e?.config?.limit_bytes&&(this.memoryState.limitBytes=e.config.limit_bytes)}initializeBatchProcessors(){if(this.config?.pipelines){this.batchStates.clear();for(const e of this.config.pipelines)e.processors.some(t=>{const n=this.processorsMap.get(t);return n?.type==="batch"&&n.enabled})&&this.batchStates.set(e.id,{traces:[],metrics:[],logs:[],lastBatchTime:Date.now(),count:0})}}processMessage(e,t){const n=performance.now();try{const a=this.detectDataType(e);if(!a)return{success:!1,error:"Unknown telemetry data type",latency:performance.now()-n};const r=this.pipelinesByType.get(a)||[];if(r.length===0)return{success:!1,error:`No pipelines configured for type: ${a}`,latency:performance.now()-n};const c=this.extractTelemetryData(e,a);if(!c)return{success:!1,error:"Failed to extract telemetry data",latency:performance.now()-n};let l=!1;for(const h of r)this.isReceiverEnabled(h,t)&&this.processPipeline(c,h,a).success&&(l=!0);this.updateReceiveMetrics(a);const d=performance.now()-n;return this.recordLatency(d),{success:l,latency:d}}catch(a){return{success:!1,error:a instanceof Error?a.message:String(a),latency:performance.now()-n}}}detectDataType(e){const t=e.payload;if(e.metadata?.telemetryType){const n=e.metadata.telemetryType;if(["traces","metrics","logs"].includes(n))return n}return t?.traces||t?.spans||t?.traceId?"traces":t?.metrics||t?.metric||t?.dataPoints?"metrics":t?.logs||t?.log||t?.entries||t?.values?"logs":e.format==="protobuf"?"traces":null}extractTelemetryData(e,t){const n=e.payload;switch(t){case"traces":return this.extractTraces(n);case"metrics":return this.extractMetrics(n);case"logs":return this.extractLogs(n);default:return null}}extractTraces(e){if(e?.resourceSpans)return e.resourceSpans.map(t=>({traceId:t.traceId||this.generateTraceId(),spans:(t.spans||[]).map(n=>this.convertToOtelSpan(n)),resource:t.resource?.attributes||{}}));if(e?.spans&&Array.isArray(e.spans)){const t=new Map;for(const n of e.spans){const a=n.traceId;t.has(a)||t.set(a,[]),t.get(a).push(this.convertJaegerSpanToOtel(n))}return Array.from(t.entries()).map(([n,a])=>({traceId:n,spans:a,resource:{}}))}return e?.traceId&&e?.spanId?[{traceId:e.traceId,spans:[this.convertToOtelSpan(e)],resource:e.resource||{}}]:null}extractMetrics(e){return e?.resourceMetrics?e.resourceMetrics.flatMap(t=>(t.metrics||[]).map(n=>this.convertToOtelMetric(n,t.resource?.attributes))):typeof e=="string"&&e.includes("HELP")?this.parsePrometheusMetrics(e):e?.name&&e?.dataPoints?[this.convertToOtelMetric(e)]:null}extractLogs(e){return e?.resourceLogs?e.resourceLogs.flatMap(t=>(t.logs||[]).map(n=>this.convertToOtelLog(n,t.resource?.attributes))):e?.streams||e?.values?this.convertLokiToOtelLogs(e):e?.timestamp||e?.body?[this.convertToOtelLog(e)]:null}convertJaegerSpanToOtel(e){return{traceId:e.traceId,spanId:e.spanId,parentSpanId:e.parentSpanId,name:e.operationName,startTime:e.startTime*1e3,duration:e.duration*1e3,attributes:this.convertTagsToAttributes(e.tags),events:e.logs.map(t=>({time:t.timestamp*1e3,name:t.fields.find(n=>n.key==="event")?.value||"log",attributes:this.convertLogFieldsToAttributes(t.fields)})),status:{code:e.tags.some(t=>t.key==="error"&&t.value===!0)?2:1}}}convertTagsToAttributes(e){const t={};for(const n of e)t[n.key]=n.value;return t}convertLogFieldsToAttributes(e){const t={};for(const n of e)t[n.key]=n.value;return t}convertToOtelSpan(e){return{traceId:e.traceId||this.generateTraceId(),spanId:e.spanId||this.generateSpanId(),parentSpanId:e.parentSpanId,name:e.name||e.operationName||"unknown",kind:e.kind,startTime:e.startTime||Date.now()*1e6,endTime:e.endTime,duration:e.duration,attributes:e.attributes||e.tags||{},events:e.events||e.logs||[],status:e.status,resource:e.resource||{}}}convertToOtelMetric(e,t){return{name:e.name||"unknown",description:e.description,unit:e.unit,type:e.type||"gauge",dataPoints:e.dataPoints||[],resource:t||e.resource||{}}}parsePrometheusMetrics(e){const t=[],n=e.split(`
`);let a=null;for(const r of n){if(r.startsWith("# HELP")){const c=r.match(/# HELP\s+(\w+)\s+(.+)/);c&&(a={name:c[1],description:c[2],type:"gauge",dataPoints:[]})}else if(r.startsWith("# TYPE")){const c=r.match(/# TYPE\s+(\w+)\s+(\w+)/);c&&a&&(a.type=this.mapPrometheusTypeToOtel(c[2]))}else if(r&&!r.startsWith("#")&&a){const c=r.match(/^(\w+)(?:\{([^}]+)\})?\s+([\d.]+)/);if(c){const l=parseFloat(c[3]),d=this.parsePrometheusLabels(c[2]);a.dataPoints.push({time:Date.now()*1e6,value:l,attributes:d})}}a&&r===""&&(t.push(a),a=null)}return a&&t.push(a),t}mapPrometheusTypeToOtel(e){switch(e.toLowerCase()){case"counter":return"sum";case"gauge":return"gauge";case"histogram":return"histogram";case"summary":return"summary";default:return"gauge"}}parsePrometheusLabels(e){if(!e)return{};const t={},n=e.matchAll(/(\w+)="([^"]+)"/g);for(const a of n)t[a[1]]=a[2];return t}convertLokiToOtelLogs(e){const t=[],n=e.streams||(e.values?[{values:e.values,stream:e.stream||{}}]:[]);for(const a of n){const r=a.stream||a.labels||{},c=a.values||[];for(const[l,d]of c)t.push({timestamp:parseInt(l),body:String(d),attributes:r})}return t}convertToOtelLog(e,t){return{timestamp:e.timestamp||Date.now()*1e6,severity:e.severity||e.level,severityNumber:e.severityNumber,body:e.body||e.line||e.message,attributes:e.attributes||e.labels||{},resource:t||e.resource||{},traceId:e.traceId,spanId:e.spanId}}isReceiverEnabled(e,t){if(!this.config)return!1;for(const n of e.receivers){const a=this.receiversMap.get(n);if(a?.enabled)return a.type==="otlp",!0}return!1}processPipeline(e,t,n){try{let a=e,r=!1;for(const l of t.processors){const d=this.processorsMap.get(l);if(d?.enabled){if(d.type==="batch"&&(r=!0),a=this.applyProcessor(a,d,t.id,n),!a&&d.type!=="batch")return{success:!1,error:`Processor ${d.type} dropped data`};if(!a&&d.type==="batch")return this.updateProcessMetrics(n),{success:!0}}}let c=!1;for(const l of t.exporters){const d=this.exportersMap.get(l);if(!d?.enabled)continue;this.sendToExporter(a,d,n).success?(c=!0,this.updateExportMetrics(n)):this.metrics.exportErrorsTotal++}return this.updateProcessMetrics(n),{success:c}}catch(a){return{success:!1,error:a instanceof Error?a.message:String(a)}}}applyProcessor(e,t,n,a){switch(t.type){case"batch":return this.applyBatchProcessor(e,t,n,a);case"memory_limiter":return this.applyMemoryLimiter(e,a);case"filter":return this.applyFilterProcessor(e,t);case"transform":return this.applyTransformProcessor(e,t);case"resource":return this.applyResourceProcessor(e,t);case"attributes":return this.applyAttributesProcessor(e,t);default:return e}}applyBatchProcessor(e,t,n,a){const r=this.batchStates.get(n);if(!r){const m={traces:[],metrics:[],logs:[],lastBatchTime:Date.now(),count:0};return this.batchStates.set(n,m),this.applyBatchProcessor(e,t,n,a)}const c=t.config||{},l=this.parseDuration(c.timeout||c.batchTimeout||"1s"),d=c.send_batch_size||c.batchSize||8192,h=Date.now();if(a==="traces"){const m=Array.isArray(e)?e:[e];r.traces.push(...m)}else if(a==="metrics"){const m=Array.isArray(e)?e:[e];r.metrics.push(...m)}else if(a==="logs"){const m=Array.isArray(e)?e:[e];r.logs.push(...m)}if(r.count++,r.count>=d||h-r.lastBatchTime>=l){const m={traces:r.traces,metrics:r.metrics,logs:r.logs};return r.traces=[],r.metrics=[],r.logs=[],r.lastBatchTime=h,r.count=0,this.metrics.batchesCreated++,m}return null}applyMemoryLimiter(e,t){const n=this.estimateDataSize(e);return this.memoryState.currentUsage+n>this.memoryState.limitBytes?(this.memoryState.droppedCount++,this.updateDroppedMetrics(t),null):(this.memoryState.currentUsage+=n,this.metrics.currentMemoryUsage=this.memoryState.currentUsage,e)}estimateDataSize(e){return JSON.stringify(e).length}applyFilterProcessor(e,t){const n=t.config||{};return n.spans&&n.spans.include,e}applyTransformProcessor(e,t){return(t.config||{}).transforms,e}applyResourceProcessor(e,t){const a=(t.config||{}).attributes||{};return Array.isArray(e)?e.map(r=>({...r,resource:{...r.resource,...a}})):{...e,resource:{...e.resource||{},...a}}}applyAttributesProcessor(e,t){return e}sendToExporter(e,t,n){return{success:!0}}parseDuration(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 1e3;const n=parseInt(t[1]);switch(t[2]){case"s":return n*1e3;case"m":return n*60*1e3;case"h":return n*60*60*1e3;case"d":return n*24*60*60*1e3;default:return 1e3}}updateReceiveMetrics(e){switch(e){case"traces":this.metrics.tracesReceivedTotal++;break;case"metrics":this.metrics.metricsReceivedTotal++;break;case"logs":this.metrics.logsReceivedTotal++;break}}updateProcessMetrics(e){switch(e){case"traces":this.metrics.tracesProcessedTotal++;break;case"metrics":this.metrics.metricsProcessedTotal++;break;case"logs":this.metrics.logsProcessedTotal++;break}}updateExportMetrics(e){switch(e){case"traces":this.metrics.tracesExportedTotal++;break;case"metrics":this.metrics.metricsExportedTotal++;break;case"logs":this.metrics.logsExportedTotal++;break}}updateDroppedMetrics(e){switch(e){case"traces":this.metrics.tracesDroppedByMemoryLimiter++;break;case"metrics":this.metrics.metricsDroppedByMemoryLimiter++;break;case"logs":this.metrics.logsDroppedByMemoryLimiter++;break}}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const t=this.latencyHistory.reduce((n,a)=>n+a,0);this.metrics.pipelineLatencyMs=t/this.latencyHistory.length}processBatchFlush(){const e=Date.now();for(const[t,n]of this.batchStates.entries()){const a=this.config?.pipelines?.find(d=>d.id===t);if(!a)continue;const r=a.processors.map(d=>this.processorsMap.get(d)).find(d=>d?.type==="batch"&&d.enabled);if(!r)continue;const c=r.config||{},l=this.parseDuration(c.timeout||c.batchTimeout||"1s");if(e-n.lastBatchTime>=l&&n.count>0){const d={traces:n.traces,metrics:n.metrics,logs:n.logs};this.processBatchData(d,a),n.traces=[],n.metrics=[],n.logs=[],n.lastBatchTime=e,n.count=0,this.metrics.batchesCreated++}}}processBatchData(e,t){const n=t.processors.findIndex(r=>{const c=this.processorsMap.get(r);return c?.type==="batch"&&c.enabled});let a=e;for(let r=n+1;r<t.processors.length;r++){const c=t.processors[r],l=this.processorsMap.get(c);l?.enabled&&(a.traces?.length>0&&(a.traces=this.applyProcessor(a.traces,l,t.id,"traces")),a.metrics?.length>0&&(a.metrics=this.applyProcessor(a.metrics,l,t.id,"metrics")),a.logs?.length>0&&(a.logs=this.applyProcessor(a.logs,l,t.id,"logs")))}for(const r of t.exporters){const c=this.exportersMap.get(r);c?.enabled&&(a.traces?.length>0&&(this.sendToExporter(a.traces,c,"traces"),this.updateExportMetrics("traces")),a.metrics?.length>0&&(this.sendToExporter(a.metrics,c,"metrics"),this.updateExportMetrics("metrics")),a.logs?.length>0&&(this.sendToExporter(a.logs,c,"logs"),this.updateExportMetrics("logs")))}}generateTraceId(){return`trace-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateSpanId(){return`span-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getMetrics(){return{...this.metrics}}getConfig(){return this.config}releaseMemory(e){this.memoryState.currentUsage=Math.max(0,this.memoryState.currentUsage-e),this.metrics.currentMemoryUsage=this.memoryState.currentUsage}}class OT{config=null;incidents=new Map;incidentState=new Map;metrics={notificationsSent:0,escalationsTriggered:0,acknowledgements:0,totalAckLatency:0,totalAckCount:0,totalResolveLatency:0,totalResolveCount:0,apiRequests:0,webhookCalls:0,errors:0};initializeFromNode(e){const t=e.data.config||{},n=(t.services||[]).map(c=>({id:String(c.id??c.name??"service"),name:String(c.name??"service"),integrationKey:c.integrationKey,status:c.status??"active",escalationPolicy:c.escalationPolicy??t.escalationPolicy??"default-policy",autoResolve:c.autoResolve??t.enableAutoResolve??!0,resolveTimeout:c.resolveTimeout??t.resolveTimeout??300})),a=(t.escalationPolicies||[]).map(c=>({id:String(c.id??c.name??"policy"),name:String(c.name??"policy"),levels:Array.isArray(c.levels)?c.levels.map((l,d)=>({level:typeof l.level=="number"?l.level:d+1,timeout:typeof l.timeout=="number"?l.timeout:5,targets:Array.isArray(l.targets)?l.targets.map(h=>String(h)):[]})):[]})),r=(t.onCallUsers||[]).map(c=>({id:String(c.id??c.email??c.name??"user"),name:String(c.name??"On-Call User"),email:String(c.email??"user@example.com"),status:c.status==="off-call"?"off-call":"on-call"}));this.config={services:n,escalationPolicies:a,onCallUsers:r,severityMapping:t.severityMapping??"standard",enableAutoResolve:t.enableAutoResolve??!0,resolveTimeout:t.resolveTimeout??300}}processAlerts(e,t){if(!(!this.config||t.length===0))for(const n of t){const a=this.findServiceForAlert(n);if(!a||a.status==="disabled")continue;const r=this.mapSeverity(n),c=this.findExistingIncident(n,a);if(c)c.lastSignalAt=e,c.alertIds=Array.from(new Set([...c.alertIds||[],n.id])),this.incidents.set(c.id,c),this.metrics.apiRequests++;else{const l=`inc-${Date.now()}-${Math.floor(Math.random()*1e3)}`,d={id:l,title:n.title,serviceId:a.id,status:"triggered",severity:r,createdAt:e,lastSignalAt:e,alertIds:[n.id]};this.incidents.set(l,d),this.incidentState.set(l,{escalationLevelIndex:0,lastEscalationAt:e}),this.metrics.apiRequests++,this.triggerEscalation(e,d,a)}}}advanceTime(e){if(this.config)for(const[t,n]of this.incidents.entries()){if(n.status==="resolved")continue;const a=this.config.services.find(y=>y.id===n.serviceId);if(!a)continue;const r=a.autoResolve??this.config.enableAutoResolve,c=(a.resolveTimeout??this.config.resolveTimeout)*1e3;if(r&&n.status!=="resolved"&&n.lastSignalAt&&e-n.lastSignalAt>=c){this.resolveIncident(e,n),this.incidents.set(t,n);continue}const l=this.findEscalationPolicy(a);if(!l||l.levels.length===0)continue;const d=this.incidentState.get(t);if(!d)continue;const h=l.levels[d.escalationLevelIndex];if(!h)continue;const p=h.timeout*60*1e3;n.status==="triggered"&&e-d.lastEscalationAt>=p&&d.escalationLevelIndex<l.levels.length-1&&(d.escalationLevelIndex+=1,d.lastEscalationAt=e,this.incidentState.set(t,d),this.triggerEscalation(e,n,a,d.escalationLevelIndex))}}acknowledgeIncident(e,t){const n=this.incidents.get(t);!n||n.status!=="triggered"||(n.status="acknowledged",n.acknowledgedAt=e,this.incidents.set(t,n),this.metrics.acknowledgements++,this.metrics.totalAckCount++,this.metrics.totalAckLatency+=e-n.createdAt)}resolveIncidentManually(e,t){const n=this.incidents.get(t);!n||n.status==="resolved"||(this.resolveIncident(e,n),this.incidents.set(t,n))}getIncidents(){return Array.from(this.incidents.values())}getMetrics(){const e=Array.from(this.incidents.values()),t=e.length,n=e.filter(C=>C.status!=="resolved").length,a=e.filter(C=>C.status==="resolved").length,r=this.metrics.totalAckCount>0?this.metrics.totalAckLatency/this.metrics.totalAckCount:0,c=this.metrics.totalResolveCount>0?this.metrics.totalResolveLatency/this.metrics.totalResolveCount:0,l=300,d=this.metrics.apiRequests/l,h=this.metrics.webhookCalls/l,p=d+h+n*.1+this.metrics.notificationsSent/l,m=Math.min(.95,.1+p/200),y=Math.min(.95,.2+t/1e3),b=this.metrics.apiRequests+this.metrics.webhookCalls+1,S=this.metrics.errors/b;return{incidentsTotal:t,incidentsActive:n,incidentsResolved:a,notificationsSent:this.metrics.notificationsSent,escalationsTriggered:this.metrics.escalationsTriggered,acknowledgements:this.metrics.acknowledgements,averageAckLatency:r,averageResolveLatency:c,apiRequestsPerSecond:d,webhooksPerSecond:h,errorRate:S,cpuUtilization:m,memoryUtilization:y}}calculateLoad(){const e=this.getMetrics(),t=e.apiRequestsPerSecond+e.webhooksPerSecond+e.incidentsActive/60+e.notificationsSent/300,a=100+(e.averageAckLatency||0)*.01+(e.averageResolveLatency||0)*.005,r=(e.cpuUtilization+e.memoryUtilization)/2;return{throughput:t,latency:a,errorRate:e.errorRate,utilization:r}}findServiceForAlert(e){if(this.config){if(e.nodeLabel){const t=e.nodeLabel.toLowerCase(),n=this.config.services.find(a=>a.name.toLowerCase()===t||t.includes(a.name.toLowerCase()));if(n)return n}if(e.nodeId){const t=this.config.services.find(n=>n.id===e.nodeId);if(t)return t}return this.config.services[0]}}mapSeverity(e){if(!this.config)return"warning";const t=e.type==="critical"?"critical":e.type==="warning"?"warning":"info";switch(this.config.severityMapping){case"error-focused":return t==="warning"?"error":t;case"warning-demoted":return t==="warning"?"info":t;default:return t}}findExistingIncident(e,t){for(const n of this.incidents.values())if(n.serviceId===t.id&&n.status!=="resolved"&&n.title===e.title)return n}findEscalationPolicy(e){if(this.config)return e.escalationPolicy?this.config.escalationPolicies.find(t=>t.id===e.escalationPolicy||t.name===e.escalationPolicy)??this.config.escalationPolicies[0]:this.config.escalationPolicies[0]}resolveIncident(e,t){t.status!=="resolved"&&(t.status="resolved",t.resolvedAt=e,this.metrics.totalResolveCount++,this.metrics.totalResolveLatency+=e-t.createdAt)}triggerEscalation(e,t,n,a=0){if(!this.config)return;const r=this.findEscalationPolicy(n);if(!r)return;const c=r.levels[a];if(!c)return;const l=this.config.onCallUsers.filter(p=>p.status==="on-call"&&c.targets.includes(p.id)),d=l.length>0?l:this.config.onCallUsers,h=Math.max(1,d.length);this.metrics.notificationsSent+=h,this.metrics.escalationsTriggered++,this.metrics.webhookCalls+=1}}class IT{alerts=new Map;alertCallbacks=[];onAlert(e){this.alertCallbacks.push(e)}analyze(e,t,n,a){const r=[];for(const c of e){const l=t.get(c.id),d=a.find(h=>h.nodeId===c.id);if(!(!l||!d)){if(d.health==="down"){const h=`down-${c.id}`;if(!this.alerts.has(h)){const p={id:h,type:"critical",title:"Component Down",message:`${c.data.label} is down and not responding`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:1};this.addAlert(p),r.push(p)}}if(l.errorRate>.1){const h=`error-${c.id}`,p=this.alerts.get(h);if(!p||p.acknowledged){const m={id:h,type:"critical",title:"High Error Rate",message:`${c.data.label} has ${(l.errorRate*100).toFixed(1)}% error rate`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:.9};this.addAlert(m),r.push(m)}}if(l.latency>2e3){const h=`latency-${c.id}`,p=this.alerts.get(h);if(!p||p.acknowledged){const m={id:h,type:"warning",title:"High Latency",message:`${c.data.label} has latency of ${l.latency.toFixed(0)}ms`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:.7};this.addAlert(m),r.push(m)}}if(l.utilization>.9){const h=`utilization-${c.id}`,p=this.alerts.get(h);if(!p||p.acknowledged){const m={id:h,type:"warning",title:"High Utilization",message:`${c.data.label} is at ${(l.utilization*100).toFixed(0)}% capacity`,nodeId:c.id,nodeLabel:c.data.label,timestamp:Date.now(),acknowledged:!1,severity:.6};this.addAlert(m),r.push(m)}}}}for(const[c,l]of n.entries())if(l.bottleneck){const d=`bottleneck-${c}`,h=this.alerts.get(d);if(!h||h.acknowledged){const p={id:d,type:"critical",title:"Connection Bottleneck",message:"Bottleneck detected in connection",timestamp:Date.now(),acknowledged:!1,severity:.85};this.addAlert(p),r.push(p)}}return this.cleanupResolvedAlerts(e,t,n,a),r}addAlert(e){this.alerts.set(e.id,e),this.alertCallbacks.forEach(t=>t(e))}cleanupResolvedAlerts(e,t,n,a){new Set(e.map(r=>r.id)),new Set(n.keys());for(const[r,c]of this.alerts.entries()){if(c.acknowledged)continue;let l=!1;if(c.nodeId)if(!e.find(h=>h.id===c.nodeId))l=!0;else{const h=t.get(c.nodeId),p=a.find(m=>m.nodeId===c.nodeId);(r.startsWith("down-")&&p&&p.health!=="down"||r.startsWith("error-")&&h&&h.errorRate<=.1||r.startsWith("latency-")&&h&&h.latency<=2e3||r.startsWith("utilization-")&&h&&h.utilization<=.9)&&(l=!0)}else if(r.startsWith("bottleneck-")){const d=r.replace("bottleneck-",""),h=n.get(d);(!h||!h.bottleneck)&&(l=!0)}l&&this.alerts.delete(r)}}acknowledge(e){const t=this.alerts.get(e);t&&(t.acknowledged=!0,this.alerts.set(e,t))}getAlerts(){return Array.from(this.alerts.values()).filter(e=>!e.acknowledged).sort((e,t)=>t.severity-e.severity)}getAlertsByType(e){return this.getAlerts().filter(t=>t.type===e)}clear(){this.alerts.clear()}}const Na=new IT;class qT{config=null;metrics={loginRequestsTotal:0,loginErrorsTotal:0,tokenRefreshTotal:0,introspectionRequestsTotal:0,userInfoRequestsTotal:0,sessionsCreatedTotal:0,sessionsExpiredTotal:0,activeSessions:0};sessions=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(e){const t=e.data.config||{},n=Array.isArray(t.clients)?t.clients.map(r=>({id:String(r.id??r.clientId??"client"),name:String(r.name??r.id??"Client"),type:r.type??"public",enabled:r.enabled??!0,protocol:r.protocol??"openid-connect"})):[{id:"archiphoenix-app",name:"ArchiPhoenix App",type:"public",enabled:!0,protocol:"openid-connect"}],a=Array.isArray(t.users)?t.users.map(r=>({id:String(r.id??r.username??"user"),username:String(r.username??`user-${r.id??"1"}`),email:r.email?String(r.email):void 0,enabled:r.enabled??!0,roles:Array.isArray(r.roles)?r.roles.map(c=>String(c)):[]})):[{id:"1",username:"admin",email:"admin@archiphoenix.com",enabled:!0,roles:["admin","user"]}];this.config={realm:String(t.realm||"archiphoenix"),adminUrl:String(t.adminUrl||"http://keycloak:8080"),enableSSL:t.enableSSL??!1,sslRequired:t.sslRequired||"external",accessTokenLifespan:Number(t.accessTokenLifespan||300),ssoSessionIdle:Number(t.ssoSessionIdle||1800),ssoSessionMax:Number(t.ssoSessionMax||36e3),enableOAuth2:t.enableOAuth2??!0,enableSAML:t.enableSAML??!1,enableLDAP:t.enableLDAP??!1,passwordPolicy:String(t.passwordPolicy||"length(8)"),clients:n,users:a}}processAuthRequest(e,t){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredSessions(n);const a=this.config;if(!a)return this.recordLatency(50),this.metrics.loginErrorsTotal++,{success:!1,latency:50,error:"Keycloak not configured"};const r=t.clientId||this.inferDefaultClientId(),c=a.clients.find(m=>m.id===r&&m.enabled);let l=e==="login"?80:e==="refresh"?40:e==="introspect"?60:40;e==="login"&&(l+=this.estimatePasswordPolicyCost(a.passwordPolicy)),a.enableLDAP&&(l*=1.3);const d=(Math.random()-.5)*20,h=Math.max(10,l+d);if(this.recordLatency(h),!c)return this.metrics.loginErrorsTotal++,this.bumpCounter(e),{success:!1,latency:h,error:`Client ${r} not found or disabled`,clientId:r,realm:a.realm};let p;if(e==="login"||e==="userinfo"){const m=t.username||t.subject;if(m&&(p=a.users.find(y=>y.username===m)),!p||!p.enabled)return this.metrics.loginErrorsTotal++,this.bumpCounter(e),{success:!1,latency:h,error:`User ${m||"unknown"} not found or disabled`,clientId:r,realm:a.realm}}switch(e){case"login":return this.metrics.loginRequestsTotal++,this.createOrUpdateSession(n,a,r,p),{success:!0,latency:h,tokenType:"access",expiresIn:a.accessTokenLifespan,subject:p.username,clientId:r,realm:a.realm};case"refresh":return this.metrics.tokenRefreshTotal++,t.subject&&this.touchUserSessions(n,t.subject),{success:!0,latency:h,tokenType:"access",expiresIn:a.accessTokenLifespan,subject:t.subject,clientId:r,realm:a.realm};case"introspect":return this.metrics.introspectionRequestsTotal++,{success:!0,latency:h,tokenType:"access",expiresIn:a.accessTokenLifespan,subject:t.subject,clientId:r,realm:a.realm};case"userinfo":return this.metrics.userInfoRequestsTotal++,{success:!0,latency:h,tokenType:"id",expiresIn:a.accessTokenLifespan,subject:p?.username??t.subject,clientId:r,realm:a.realm}}}calculateLoad(){const e=this.metrics,t=e.loginRequestsTotal+e.tokenRefreshTotal+e.introspectionRequestsTotal+e.userInfoRequestsTotal,n=t>0?Math.min(1,e.loginErrorsTotal/t):0,a=this.latencyHistory.length>0?this.latencyHistory.reduce((l,d)=>l+d,0)/this.latencyHistory.length:0;let r=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const l=(this.lastRequestTime-this.firstRequestTime)/1e3;r=t/Math.max(l,1)}const c=e.loginRequestsTotal>0?1-e.loginErrorsTotal/e.loginRequestsTotal:1;return{requestsPerSecond:r,averageLatency:a,errorRate:n,activeSessions:this.metrics.activeSessions,authSuccessRate:c}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}inferDefaultClientId(){return this.config?.clients.length?(this.config.clients.filter(t=>t.enabled)[0]||this.config.clients[0]).id:"default-client"}estimatePasswordPolicyCost(e){if(!e)return 0;let t=0;const n=e.toLowerCase();n.includes("length(")&&(t+=10),n.includes("digits(")&&(t+=15),n.includes("special(")&&(t+=20),n.includes("uppercase(")&&(t+=10),n.includes("lowercase(")&&(t+=5);const a=(e.match(/\)/g)||[]).length;return t+=a*5,t}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}bumpCounter(e){switch(e){case"login":this.metrics.loginRequestsTotal++;break;case"refresh":this.metrics.tokenRefreshTotal++;break;case"introspect":this.metrics.introspectionRequestsTotal++;break;case"userinfo":this.metrics.userInfoRequestsTotal++;break}}createOrUpdateSession(e,t,n,a){for(const h of this.sessions.values())if(h.userId===a.id&&h.clientId===n)return h.lastAccess=e,h.sessionId;const r=`sess-${e}-${Math.random().toString(36).slice(2,8)}`,c=t.ssoSessionIdle*1e3,l=t.ssoSessionMax*1e3,d={sessionId:r,userId:a.id,clientId:n,realm:t.realm,createdAt:e,lastAccess:e,idleTimeoutMs:c,maxLifespanMs:l};return this.sessions.set(r,d),this.metrics.sessionsCreatedTotal++,this.metrics.activeSessions=this.sessions.size,r}touchUserSessions(e,t){if(!this.config)return;const n=this.config.users.find(a=>a.username===t);if(n)for(const a of this.sessions.values())a.userId===n.id&&(a.lastAccess=e)}cleanupExpiredSessions(e){let t=0;for(const[n,a]of this.sessions.entries()){const r=e-a.lastAccess>a.idleTimeoutMs,c=e-a.createdAt>a.maxLifespanMs;(r||c)&&(this.sessions.delete(n),t++)}t>0&&(this.metrics.sessionsExpiredTotal+=t,this.metrics.activeSessions=this.sessions.size)}}class HT{config=null;rules=new Map;threats=[];stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0};rateLimitTracker=new Map;RATE_LIMIT_WINDOW_MS=6e4;ddosTracker=new Map;DDOS_WINDOW_MS=1e3;MAX_THREATS=1e3;initializeConfig(e){const t=e.data.config||{};if(this.config={mode:t.mode||"detection",enableOWASP:t.enableOWASP??!0,owaspRuleset:t.owaspRuleset||"3.3",enableRateLimiting:t.enableRateLimiting??!0,rateLimitPerMinute:t.rateLimitPerMinute||100,enableGeoBlocking:t.enableGeoBlocking??!1,blockedCountries:Array.isArray(t.blockedCountries)?t.blockedCountries:[],enableIPWhitelist:t.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(t.whitelistedIPs)?t.whitelistedIPs:[],enableDDoSProtection:t.enableDDoSProtection??!0,ddosThreshold:t.ddosThreshold||1e3,rules:Array.isArray(t.rules)?t.rules:[]},this.rules.clear(),this.config.rules)for(const n of this.config.rules)n.id&&this.rules.set(n.id,n);this.stats.activeRules=Array.from(this.rules.values()).filter(n=>n.enabled).length}processRequest(e){const t=performance.now(),n=e.timestamp||Date.now(),a=e.sourceIP||"0.0.0.0";if(this.stats.totalRequests++,this.config?.enableIPWhitelist&&this.config.whitelistedIPs?.includes(a))return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-t};if(this.config?.enableGeoBlocking&&e.country&&this.config.blockedCountries?.includes(e.country)){const c={id:`threat-${Date.now()}-${Math.random()}`,type:"geo-block",sourceIP:a,target:e.path,timestamp:n,severity:"medium",blocked:!0,details:{country:e.country}};if(this.addThreat(c),this.stats.geoBlockHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:c}}if(this.config?.enableDDoSProtection){const c=this.checkDDoS(a,n);if(c.blocked){const l={id:`threat-${Date.now()}-${Math.random()}`,type:"ddos",sourceIP:a,target:e.path,timestamp:n,severity:"critical",blocked:!0,details:{requestCount:c.count}};if(this.addThreat(l),this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:l}}}if(this.config?.enableRateLimiting){const c=this.checkRateLimit(a,n);if(c.blocked){const l={id:`threat-${Date.now()}-${Math.random()}`,type:"rate-limit",sourceIP:a,target:e.path,timestamp:n,severity:"medium",blocked:!0,details:{requestCount:c.count}};if(this.addThreat(l),this.stats.rateLimitHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:l}}}if(this.config?.enableOWASP){const c=this.checkOWASPRules(e);if(c.detected){const l={id:`threat-${Date.now()}-${Math.random()}`,type:c.threatType||"custom",sourceIP:a,target:e.path,timestamp:n,severity:c.severity||"high",blocked:!0,details:c.details};if(this.addThreat(l),this.stats.owaspHits++,this.stats.blockedRequests++,this.stats.threatsDetected++,this.config.mode==="prevention")return{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:l}}}const r=Array.from(this.rules.values()).filter(c=>c.enabled).sort((c,l)=>c.priority-l.priority);for(const c of r){const l=this.matchRule(c,e);if(l.matched){const d={id:`threat-${Date.now()}-${Math.random()}`,type:"custom",sourceIP:a,target:e.path,timestamp:n,severity:l.severity||"medium",blocked:c.action==="block",ruleId:c.id,ruleName:c.name,details:l.details};if(this.addThreat(d),this.stats.threatsDetected++,c.action==="block"&&this.config?.mode==="prevention")return this.stats.blockedRequests++,{allowed:!1,blocked:!0,action:"block",latency:performance.now()-t,threatDetected:d,matchedRule:c};if(c.action==="log")continue;if(c.action==="challenge")return{allowed:!1,blocked:!1,action:"challenge",latency:performance.now()-t,threatDetected:d,matchedRule:c}}}return this.stats.allowedRequests++,{allowed:!0,blocked:!1,action:"allow",latency:performance.now()-t}}matchRule(e,t){if(!e.conditions||e.conditions.length===0)return{matched:!1};for(const n of e.conditions){let a,r=!1;switch(n.type){case"ip":a=t.sourceIP;break;case"uri":a=t.path;break;case"method":a=t.method;break;case"header":a=t.headers?.[n.value]||"";break;case"body":a=typeof t.body=="string"?t.body:JSON.stringify(t.body||"");break;case"country":a=t.country;break;case"user-agent":a=t.userAgent;break}if(a===void 0)return{matched:!1};switch(n.operator){case"equals":r=a===n.value;break;case"contains":r=a.toLowerCase().includes(n.value.toLowerCase());break;case"startsWith":r=a.toLowerCase().startsWith(n.value.toLowerCase());break;case"endsWith":r=a.toLowerCase().endsWith(n.value.toLowerCase());break;case"regex":try{r=new RegExp(n.value,"i").test(a)}catch{r=!1}break;case"in":r=n.value.split(",").map(d=>d.trim()).includes(a);break;case"not-in":r=!n.value.split(",").map(d=>d.trim()).includes(a);break}if(!r)return{matched:!1}}return{matched:!0,severity:"medium",details:{matchedConditions:e.conditions.length}}}checkOWASPRules(e){const t=typeof e.body=="string"?e.body:JSON.stringify(e.body||""),n=e.path||"",a=JSON.stringify(e.query||""),r=`${t} ${n} ${a}`.toLowerCase(),c=[/(\bunion\b.*\bselect\b)/i,/(\bselect\b.*\bfrom\b)/i,/(\bdrop\b.*\btable\b)/i,/(\binsert\b.*\binto\b)/i,/(\bdelete\b.*\bfrom\b)/i,/('.*--)/,/(\bor\b.*=.*)/i,/(\band\b.*=.*)/i];for(const p of c)if(p.test(r))return{detected:!0,threatType:"sql-injection",severity:"critical",details:{pattern:p.toString()}};const l=[/<script[^>]*>/i,/javascript:/i,/on\w+\s*=/i,/<iframe[^>]*>/i,/eval\s*\(/i,/expression\s*\(/i];for(const p of l)if(p.test(r))return{detected:!0,threatType:"xss",severity:"high",details:{pattern:p.toString()}};const d=[/\.\.\//,/\.\.\\/,/\.\.%2f/i,/\.\.%5c/i];for(const p of d)if(p.test(r))return{detected:!0,threatType:"path-traversal",severity:"high",details:{pattern:p.toString()}};const h=[/\$\{[^}]*\}/,/\$\([^)]*\)/,/`[^`]*`/,/\|\s*\w+.*\s*\|/];for(const p of h)if(p.test(r))return{detected:!0,threatType:"rce",severity:"critical",details:{pattern:p.toString()}};return{detected:!1}}checkRateLimit(e,t){if(!this.config?.enableRateLimiting||!this.config.rateLimitPerMinute)return{blocked:!1,count:0};const n=t-this.RATE_LIMIT_WINDOW_MS,a=this.rateLimitTracker.get(e)||[],r=a.filter(c=>c>n);return r.length>=this.config.rateLimitPerMinute?{blocked:!0,count:r.length}:(r.push(t),this.rateLimitTracker.set(e,r),a.length>this.config.rateLimitPerMinute*2&&this.rateLimitTracker.set(e,r),{blocked:!1,count:r.length})}checkDDoS(e,t){if(!this.config?.enableDDoSProtection||!this.config.ddosThreshold)return{blocked:!1,count:0};const n=this.ddosTracker.get(e),a=t-this.DDOS_WINDOW_MS;return!n||n.windowStart<a?(this.ddosTracker.set(e,{count:1,windowStart:t}),{blocked:!1,count:1}):(n.count++,this.ddosTracker.set(e,n),n.count>=this.config.ddosThreshold?{blocked:!0,count:n.count}:{blocked:!1,count:n.count})}addThreat(e){this.threats.push(e),this.threats.length>this.MAX_THREATS&&this.threats.shift()}getThreats(e=100){return this.threats.slice(-e).reverse()}getStats(){return{...this.stats}}resetStats(){this.stats={totalRequests:0,allowedRequests:0,blockedRequests:0,threatsDetected:0,activeRules:this.stats.activeRules,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0},this.threats=[],this.rateLimitTracker.clear(),this.ddosTracker.clear()}}class BT{config=null;routingEngine;metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:0,averageLatency:0};firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedRequestRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new HT}initializeConfig(e){const t=e.data.config||{};this.config={mode:t.mode||"detection",enableOWASP:t.enableOWASP??!0,owaspRuleset:t.owaspRuleset||"3.3",enableRateLimiting:t.enableRateLimiting??!0,rateLimitPerMinute:t.rateLimitPerMinute||100,enableGeoBlocking:t.enableGeoBlocking??!1,blockedCountries:Array.isArray(t.blockedCountries)?t.blockedCountries:[],enableIPWhitelist:t.enableIPWhitelist??!1,whitelistedIPs:Array.isArray(t.whitelistedIPs)?t.whitelistedIPs:[],enableDDoSProtection:t.enableDDoSProtection??!0,ddosThreshold:t.ddosThreshold||1e3,rules:Array.isArray(t.rules)?t.rules:[]},this.routingEngine.initializeConfig(e),this.updateMetricsFromStats()}processRequest(e){const t=performance.now(),n={path:e.path||"/",method:e.method||"GET",headers:e.headers,query:e.query,body:e.body,sourceIP:e.sourceIP||this.generateRandomIP(),country:e.country||this.generateRandomCountry(),userAgent:e.userAgent||"Mozilla/5.0",timestamp:Date.now()},a=this.routingEngine.processRequest(n),r=performance.now()-t+a.latency;if(this.recordLatency(r),this.metrics.requestsTotal++,a.allowed?this.metrics.requestsAllowed++:(this.metrics.requestsBlocked++,a.blocked&&this.metrics.threatsBlocked++),a.threatDetected){this.metrics.threatsDetected++;const l=this.routingEngine.getStats();this.metrics.rateLimitHits=l.rateLimitHits,this.metrics.geoBlockHits=l.geoBlockHits,this.metrics.ipBlockHits=l.ipBlockHits,this.metrics.owaspHits=l.owaspHits,this.metrics.customRuleHits=l.threatsDetected-l.owaspHits-l.rateLimitHits-l.geoBlockHits-l.ipBlockHits}const c=Date.now();return this.firstRequestTime||(this.firstRequestTime=c),this.lastRequestTime=c,{success:a.allowed,blocked:a.blocked,latency:r,threatDetected:!!a.threatDetected,error:a.error}}simulateRequests(e){const t=Date.now(),n=t-this.lastSimulationTime;if(this.lastSimulationTime=t,n<=0||e<=0)return;const a=Math.floor(e*n/1e3);if(a!==0){for(let r=0;r<a;r++){const c=this.generateRandomRequest();this.processRequest(c)}this.updateMetricsFromStats()}}generateRandomRequest(){const e=["GET","POST","PUT","DELETE","PATCH"],t=["/api/users","/api/products","/api/orders","/api/auth","/api/data"],n=["US","GB","DE","FR","CN","RU","JP"],a=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"],r=Math.random()<.05;let c=t[Math.floor(Math.random()*t.length)],l=null;return r?Math.random()<.5?(c+="?id=1' OR '1'='1",l={query:"SELECT * FROM users WHERE id = '1' OR '1'='1'"}):l={content:'<script>alert("XSS")<\/script>'}:Math.random()<.3&&(l={data:Math.random().toString(36).substring(7)}),{path:c,method:e[Math.floor(Math.random()*e.length)],headers:{"Content-Type":"application/json","User-Agent":a[Math.floor(Math.random()*a.length)]},body:l,sourceIP:this.generateRandomIP(),country:n[Math.floor(Math.random()*n.length)],userAgent:a[Math.floor(Math.random()*a.length)]}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}generateRandomCountry(){const e=["US","GB","DE","FR","CN","RU","JP","BR","IN","AU"];return e[Math.floor(Math.random()*e.length)]}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const t=this.latencyHistory.reduce((n,a)=>n+a,0);this.metrics.averageLatency=t/this.latencyHistory.length}updateMetricsFromStats(){const e=this.routingEngine.getStats();this.metrics.requestsTotal=e.totalRequests,this.metrics.requestsAllowed=e.allowedRequests,this.metrics.requestsBlocked=e.blockedRequests,this.metrics.threatsDetected=e.threatsDetected,this.metrics.rateLimitHits=e.rateLimitHits,this.metrics.geoBlockHits=e.geoBlockHits,this.metrics.ipBlockHits=e.ipBlockHits,this.metrics.owaspHits=e.owaspHits,this.metrics.activeRules=e.activeRules,this.metrics.customRuleHits=e.threatsDetected-e.owaspHits-e.rateLimitHits-e.geoBlockHits-e.ipBlockHits}calculateLoad(){let e=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const c=(this.lastRequestTime-this.firstRequestTime)/1e3;c>0&&(e=this.metrics.requestsTotal/c)}e===0&&this.simulatedRequestRate>0&&(e=this.simulatedRequestRate);const t=this.metrics.averageLatency||5,n=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,a=this.metrics.requestsTotal>0?this.metrics.requestsBlocked/this.metrics.requestsTotal:0,r=this.metrics.requestsTotal>0?this.metrics.threatsDetected/this.metrics.requestsTotal:0;return{requestsPerSecond:e,averageLatency:t,errorRate:n,blockRate:a,threatDetectionRate:r}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getThreats(e=100){return this.routingEngine.getThreats(e)}getStats(){return this.routingEngine.getStats()}setSimulatedRequestRate(e){this.simulatedRequestRate=e}resetMetrics(){this.metrics={requestsTotal:0,requestsAllowed:0,requestsBlocked:0,threatsDetected:0,threatsBlocked:0,rateLimitHits:0,geoBlockHits:0,ipBlockHits:0,owaspHits:0,customRuleHits:0,activeRules:this.metrics.activeRules,averageLatency:0},this.latencyHistory=[],this.firstRequestTime=null,this.lastRequestTime=null,this.routingEngine.resetStats()}}class $T{config=null;signatures=new Map;alerts=[];stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0};blockedIPs=new Map;behavioralPatterns=new Map;MAX_BEHAVIORAL_PATTERNS=1e4;BEHAVIORAL_WINDOW_MS=3e5;MAX_ALERTS=1e4;initializeConfig(e){const t=e.data.config||{};if(this.config={mode:t.mode||"ids",enableSignatureDetection:t.enableSignatureDetection??!0,enableAnomalyDetection:t.enableAnomalyDetection??!0,enableBehavioralAnalysis:t.enableBehavioralAnalysis??!1,alertThreshold:t.alertThreshold||"medium",enableAutoBlock:t.enableAutoBlock??!1,blockDuration:t.blockDuration||3600,enableLogging:t.enableLogging??!0,logRetention:t.logRetention||30,signatures:Array.isArray(t.signatures)?t.signatures:[]},this.signatures.clear(),this.config.signatures)for(const n of this.config.signatures)n.id&&n.enabled&&this.signatures.set(n.id,n);if(Array.isArray(t.blockedIPs)){this.blockedIPs.clear();for(const n of t.blockedIPs)if(n.ip){const a=n.expiresAt?new Date(n.expiresAt).getTime():Date.now()+(this.config.blockDuration||3600)*1e3;this.blockedIPs.set(n.ip,{ip:n.ip,reason:n.reason||"Intrusion detected",blockedAt:n.blockedAt?new Date(n.blockedAt).getTime():Date.now(),expiresAt:a})}}this.stats.activeSignatures=Array.from(this.signatures.values()).filter(n=>n.enabled).length,this.stats.blockedIPs=this.blockedIPs.size,this.cleanExpiredBlocks()}processPacket(e){const t=performance.now();if(this.stats.totalPackets++,this.isIPBlocked(e.source))return this.stats.alertsBlocked++,{allowed:!1,blocked:!0,alertGenerated:!1,latency:performance.now()-t,error:`IP ${e.source} is blocked`};this.stats.packetsAnalyzed++;let n,a=!1;if(this.config?.enableSignatureDetection){const c=this.detectSignature(e);if(c&&(n=c,this.stats.signatureMatches++,this.stats.alertsGenerated++,c.signatureId)){const l=this.signatures.get(c.signatureId);l&&l.action==="block"&&this.config.mode==="ips"&&(a=!0)}}if(!n&&this.config?.enableAnomalyDetection){const c=this.detectAnomaly(e);c&&(n=c,this.stats.anomalyDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&c.anomalyScore&&c.anomalyScore>.8&&(a=!0))}if(!n&&this.config?.enableBehavioralAnalysis){const c=this.detectBehavioral(e);c&&(n=c,this.stats.behavioralDetections++,this.stats.alertsGenerated++,this.config.enableAutoBlock&&c.behavioralPattern==="suspicious"&&(a=!0))}a&&this.config?.mode==="ips"&&(this.blockIP(e.source,n?.description||"Intrusion detected",n?.signatureId),this.stats.alertsBlocked++,n=n?{...n,blocked:!0}:void 0),n&&this.shouldGenerateAlert(n.severity)&&this.addAlert(n);const r=performance.now()-t;return{allowed:!a,blocked:a,alertGenerated:!!n,latency:r,alert:n}}detectSignature(e){const t=Array.from(this.signatures.values()).filter(n=>n.enabled).sort((n,a)=>{const r={critical:4,high:3,medium:2,low:1};return r[a.severity]-r[n.severity]});for(const n of t)if(!(n.protocol&&n.protocol!=="all"&&n.protocol!==e.protocol)&&!(n.sourceIP&&!this.matchIP(e.source,n.sourceIP))&&!(n.destinationIP&&!this.matchIP(e.destination,n.destinationIP))&&!(n.port!==void 0&&e.port!==void 0&&n.port!==e.port)&&!(n.sourcePort!==void 0&&e.sourcePort!==void 0&&n.sourcePort!==e.sourcePort)){if(n.pattern&&e.payload)try{if(new RegExp(n.pattern,"i").test(e.payload))return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:n.severity,timestamp:e.timestamp||Date.now(),description:n.description||`Signature match: ${n.name}`,blocked:!1,signature:n.name,signatureId:n.id}}catch{}else if(!n.pattern)return{id:`alert-${Date.now()}-${Math.random()}`,type:"signature",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:n.severity,timestamp:e.timestamp||Date.now(),description:n.description||`Signature match: ${n.name}`,blocked:!1,signature:n.name,signatureId:n.id}}return null}detectAnomaly(e){let t=0;const n=[22,23,80,443,3306,5432,27017,6379,8080];if(e.port&&n.includes(e.port)&&(t+=.2),e.protocol==="icmp"&&(t+=.1),e.payload){const r=e.payload.length;(r>1e4||r<10)&&(t+=.3)}if(e.payload){const r=["SELECT","UNION","DROP","DELETE","INSERT","UPDATE","<script","eval(","base64"];for(const c of r)if(e.payload.toLowerCase().includes(c.toLowerCase())){t+=.4;break}}const a=this.getAnomalyThreshold();if(t>=a){const r=t>=.8?"critical":t>=.6?"high":"medium";return{id:`alert-${Date.now()}-${Math.random()}`,type:"anomaly",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:r,timestamp:e.timestamp||Date.now(),description:`Anomaly detected: unusual network activity (score: ${t.toFixed(2)})`,blocked:!1,anomalyScore:t}}return null}detectBehavioral(e){const t=`${e.source}-${e.destination}-${e.protocol}-${e.port||"any"}`,n=Date.now();let a=this.behavioralPatterns.get(t);a||(a={sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,requestCount:0,firstSeen:n,lastSeen:n,suspiciousScore:0},this.behavioralPatterns.set(t,a)),a.requestCount++,a.lastSeen=n,this.behavioralPatterns.size>this.MAX_BEHAVIORAL_PATTERNS&&this.cleanOldBehavioralPatterns();const r=(n-a.firstSeen)/1e3,c=r>0?a.requestCount/r:a.requestCount;return c>10&&(a.suspiciousScore=Math.min(1,c/100)),a.suspiciousScore>.7?{id:`alert-${Date.now()}-${Math.random()}`,type:"behavioral",sourceIP:e.source,destinationIP:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,severity:a.suspiciousScore>.9?"critical":"high",timestamp:n,description:`Behavioral pattern detected: high request rate (${c.toFixed(2)} req/s)`,blocked:!1,behavioralPattern:"suspicious"}:null}isIPBlocked(e){return this.cleanExpiredBlocks(),this.blockedIPs.has(e)}blockIP(e,t,n){const a=Date.now()+(this.config?.blockDuration||3600)*1e3;this.blockedIPs.set(e,{ip:e,reason:t,blockedAt:Date.now(),expiresAt:a}),this.stats.blockedIPs=this.blockedIPs.size}cleanExpiredBlocks(){const e=Date.now();for(const[t,n]of this.blockedIPs.entries())n.expiresAt<e&&this.blockedIPs.delete(t);this.stats.blockedIPs=this.blockedIPs.size}cleanOldBehavioralPatterns(){const e=Date.now();for(const[t,n]of this.behavioralPatterns.entries())e-n.lastSeen>this.BEHAVIORAL_WINDOW_MS&&this.behavioralPatterns.delete(t)}shouldGenerateAlert(e){const t=this.config?.alertThreshold||"medium",n={critical:4,high:3,medium:2,low:1},a={critical:4,high:3,medium:2,low:1};return n[e]>=a[t]}getAnomalyThreshold(){const e=this.config?.alertThreshold||"medium";return{low:.9,medium:.7,high:.5,critical:.3}[e]}matchIP(e,t){if(e===t)return!0;if(t.includes("/")){const[n,a]=t.split("/"),r=parseInt(a,10);return e.startsWith(n.split(".").slice(0,Math.floor(r/8)).join("."))}return!1}addAlert(e){this.alerts.push(e),this.alerts.length>this.MAX_ALERTS&&this.alerts.shift()}getAlerts(e=100){return this.alerts.slice(-e).reverse()}getBlockedIPs(){return this.cleanExpiredBlocks(),Array.from(this.blockedIPs.values())}unblockIP(e){this.blockedIPs.delete(e),this.stats.blockedIPs=this.blockedIPs.size}getStats(){return{...this.stats}}getSignatures(){return Array.from(this.signatures.values())}resetStats(){this.stats={totalPackets:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.stats.activeSignatures,blockedIPs:this.blockedIPs.size}}}class UT{config=null;routingEngine;metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:0,blockedIPs:0,averageLatency:0};firstPacketTime=null;lastPacketTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;simulatedPacketRate=0;lastSimulationTime=Date.now();constructor(){this.routingEngine=new $T}initializeConfig(e){const t=e.data.config||{};this.config={mode:t.mode||"ids",enableSignatureDetection:t.enableSignatureDetection??!0,enableAnomalyDetection:t.enableAnomalyDetection??!0,enableBehavioralAnalysis:t.enableBehavioralAnalysis??!1,alertThreshold:t.alertThreshold||"medium",enableAutoBlock:t.enableAutoBlock??!1,blockDuration:t.blockDuration||3600,enableLogging:t.enableLogging??!0,logRetention:t.logRetention||30,signatures:Array.isArray(t.signatures)?t.signatures:[],blockedIPs:Array.isArray(t.blockedIPs)?t.blockedIPs:[]},this.routingEngine.initializeConfig(e),this.updateMetricsFromStats()}processPacket(e){const t=performance.now(),n={source:e.source,destination:e.destination,protocol:e.protocol,port:e.port,sourcePort:e.sourcePort,payload:e.payload,timestamp:Date.now()},a=this.routingEngine.processPacket(n),r=performance.now()-t+a.latency;this.recordLatency(r),this.metrics.packetsTotal++,a.alertGenerated&&this.metrics.alertsGenerated++,a.blocked&&this.metrics.alertsBlocked++;const c=Date.now();return this.firstPacketTime||(this.firstPacketTime=c),this.lastPacketTime=c,this.updateMetricsFromStats(),{success:a.allowed,blocked:a.blocked,latency:r,alertGenerated:a.alertGenerated,error:a.error}}simulatePackets(e){const t=Date.now(),n=t-this.lastSimulationTime;if(this.lastSimulationTime=t,n<=0||e<=0)return;const a=Math.floor(e*n/1e3);if(a!==0){for(let r=0;r<a;r++){const c=this.generateRandomPacket();this.processPacket(c)}this.updateMetricsFromStats()}}generateRandomPacket(){const e=["tcp","udp","icmp"],t=e[Math.floor(Math.random()*e.length)],n=`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,a=`10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,r=t==="icmp"?void 0:Math.floor(Math.random()*65535),c=t==="icmp"?void 0:Math.floor(Math.random()*65535),l=Math.random()<.05;let d;if(l){const h=["SELECT * FROM users WHERE id = 1 OR 1=1",'<script>alert("XSS")<\/script>',"DROP TABLE users","UNION SELECT password FROM users","../../../etc/passwd","eval(base64_decode("];d=h[Math.floor(Math.random()*h.length)]}else Math.random()<.3&&(d=`GET /api/data HTTP/1.1\r
Host: example.com\r
User-Agent: Mozilla/5.0`);return{source:n,destination:a,protocol:t,port:r,sourcePort:c,payload:d}}generateRandomIP(){return`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift();const t=this.latencyHistory.reduce((n,a)=>n+a,0);this.metrics.averageLatency=t/this.latencyHistory.length}updateMetricsFromStats(){const e=this.routingEngine.getStats();this.metrics.packetsTotal=e.totalPackets,this.metrics.packetsAnalyzed=e.packetsAnalyzed,this.metrics.alertsGenerated=e.alertsGenerated,this.metrics.alertsBlocked=e.alertsBlocked,this.metrics.signatureMatches=e.signatureMatches,this.metrics.anomalyDetections=e.anomalyDetections,this.metrics.behavioralDetections=e.behavioralDetections,this.metrics.activeSignatures=e.activeSignatures,this.metrics.blockedIPs=e.blockedIPs}calculateLoad(){let e=0;if(this.firstPacketTime&&this.lastPacketTime&&this.lastPacketTime>this.firstPacketTime){const c=(this.lastPacketTime-this.firstPacketTime)/1e3;c>0&&(e=this.metrics.packetsTotal/c)}e===0&&this.simulatedPacketRate>0&&(e=this.simulatedPacketRate);const t=this.metrics.averageLatency||5,n=this.config?.mode==="ips"&&this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,a=this.metrics.packetsTotal>0?this.metrics.alertsBlocked/this.metrics.packetsTotal:0,r=this.metrics.packetsTotal>0?this.metrics.alertsGenerated/this.metrics.packetsTotal:0;return{packetsPerSecond:e,averageLatency:t,errorRate:n,blockRate:a,alertRate:r}}getMetrics(){return{...this.metrics}}getConfig(){return this.config}getAlerts(e=100){return this.routingEngine.getAlerts(e)}getStats(){return this.routingEngine.getStats()}getBlockedIPs(){return this.routingEngine.getBlockedIPs()}unblockIP(e){this.routingEngine.unblockIP(e),this.updateMetricsFromStats()}setSimulatedPacketRate(e){this.simulatedPacketRate=e}resetMetrics(){this.metrics={packetsTotal:0,packetsAnalyzed:0,alertsGenerated:0,alertsBlocked:0,signatureMatches:0,anomalyDetections:0,behavioralDetections:0,activeSignatures:this.metrics.activeSignatures,blockedIPs:this.metrics.blockedIPs,averageLatency:0},this.latencyHistory=[],this.firstPacketTime=null,this.lastPacketTime=null,this.routingEngine.resetStats()}}class QT{config=null;metrics={readRequestsTotal:0,writeRequestsTotal:0,deleteRequestsTotal:0,listRequestsTotal:0,authRequestsTotal:0,authErrorsTotal:0,tokenIssuedTotal:0,tokenRenewedTotal:0,tokenRevokedTotal:0,encryptionOperationsTotal:0,decryptionOperationsTotal:0,activeTokens:0,secretsTotal:0};tokens=new Map;secrets=new Map;firstRequestTime=null;lastRequestTime=null;latencyHistory=[];MAX_LATENCY_HISTORY=200;initializeConfig(e){const t=e.data.config||{},n=Array.isArray(t.secrets)?t.secrets.map(l=>({id:String(l.id??`secret-${Date.now()}`),path:String(l.path??"secret/default"),key:String(l.key??"key"),value:String(l.value??""),version:Number(l.version??1),created:l.created?String(l.created):new Date().toISOString(),updated:l.updated?String(l.updated):new Date().toISOString(),visible:l.visible??!1})):[],a=Array.isArray(t.engines)?t.engines.map(l=>({id:String(l.id??`engine-${Date.now()}`),name:String(l.name??"secret/"),type:l.type??"kv",enabled:l.enabled??!0,version:l.version?Number(l.version):void 0,description:l.description?String(l.description):void 0})):[{id:"1",name:"secret/",type:"kv",enabled:t.enableKV??!0,version:t.kvVersion==="1"?1:2,description:"Key-Value secrets"}],r=Array.isArray(t.policies)?t.policies.map(l=>({id:String(l.id??`policy-${Date.now()}`),name:String(l.name??"default"),rules:String(l.rules??'path "*" { capabilities = ["read"] }'),enabled:l.enabled??!0})):[{id:"1",name:"default",rules:'path "*" { capabilities = ["read", "list"] }',enabled:!0}],c=String(t.tokenTTL||"24h");this.parseTTL(c),this.config={vaultType:t.vaultType||"hashicorp",address:String(t.address||"http://vault:8200"),enableTLS:t.enableTLS??!1,enableTransit:t.enableTransit??!0,enableKV:t.enableKV??!0,kvVersion:String(t.kvVersion||"2"),enablePKI:t.enablePKI??!1,enableAuth:t.enableAuth??!0,authMethod:t.authMethod||"token",tokenTTL:c,secrets:n,engines:a,policies:r},this.secrets.clear(),n.forEach(l=>{this.secrets.set(l.id,l)}),this.metrics.secretsTotal=n.length,this.cleanupExpiredTokens(Date.now())}processReadRequest(e,t,n){const a=Date.now();this.firstRequestTime??=a,this.lastRequestTime=a,this.cleanupExpiredTokens(a);const r=this.config;if(!r)return this.recordLatency(50),this.metrics.readRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(r.enableAuth&&n&&!this.validateToken(n,a))return this.recordLatency(30),this.metrics.readRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const c=Array.from(this.secrets.values()).find(p=>p.path===e&&(!t||p.key===t)),l=15,d=(Math.random()-.5)*10,h=Math.max(5,l+d);return this.recordLatency(h),this.metrics.readRequestsTotal++,c?{success:!0,latency:h,data:{[c.key]:c.value,version:c.version}}:{success:!1,latency:h,error:`Secret not found at path: ${e}`}}processWriteRequest(e,t,n){const a=Date.now();this.firstRequestTime??=a,this.lastRequestTime=a,this.cleanupExpiredTokens(a);const r=this.config;if(!r)return this.recordLatency(60),this.metrics.writeRequestsTotal++,{success:!1,latency:60,error:"Vault not configured"};if(r.enableAuth&&n&&!this.validateToken(n,a))return this.recordLatency(30),this.metrics.writeRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};if(!r.enableKV)return this.recordLatency(20),this.metrics.writeRequestsTotal++,{success:!1,latency:20,error:"KV engine is not enabled"};const c=25,l=(Math.random()-.5)*15,d=Math.max(10,c+l);this.recordLatency(d),this.metrics.writeRequestsTotal++;const h=Array.from(this.secrets.values()).find(p=>p.path===e&&p.key===Object.keys(t)[0]);if(h)h.value=Object.values(t)[0],h.version=(h.version||1)+1,h.updated=new Date().toISOString(),this.secrets.set(h.id,h);else{const p={id:`secret-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,path:e,key:Object.keys(t)[0],value:Object.values(t)[0],version:1,created:new Date().toISOString(),updated:new Date().toISOString(),visible:!1};this.secrets.set(p.id,p),this.metrics.secretsTotal=this.secrets.size}return{success:!0,latency:d,data:{path:e,version:h?.version||1}}}processDeleteRequest(e,t){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const a=this.config;if(!a)return this.recordLatency(50),this.metrics.deleteRequestsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(a.enableAuth&&t&&!this.validateToken(t,n))return this.recordLatency(30),this.metrics.deleteRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const r=20,c=(Math.random()-.5)*10,l=Math.max(8,r+c);this.recordLatency(l),this.metrics.deleteRequestsTotal++;const d=Array.from(this.secrets.values()).find(h=>h.path===e);return d?(this.secrets.delete(d.id),this.metrics.secretsTotal=this.secrets.size,{success:!0,latency:l}):{success:!1,latency:l,error:`Secret not found at path: ${e}`}}processAuthRequest(e,t){const n=Date.now();this.firstRequestTime??=n,this.lastRequestTime=n,this.cleanupExpiredTokens(n);const a=this.config;if(!a)return this.recordLatency(50),this.metrics.authRequestsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!a.enableAuth)return this.recordLatency(20),this.metrics.authRequestsTotal++,{success:!1,latency:20,error:"Authentication is not enabled"};let r=40;e==="ldap"?r=80:e==="approle"?r=50:e==="aws"&&(r=60);const c=(Math.random()-.5)*20,l=Math.max(15,r+c);this.recordLatency(l),this.metrics.authRequestsTotal++;const d=this.parseTTL(a.tokenTTL),h=`vault-token-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,p={id:h,token:h,policies:a.policies.filter(m=>m.enabled).map(m=>m.name),ttl:d,renewable:!0,createdAt:n,expiresAt:n+d*1e3};return this.tokens.set(h,p),this.metrics.tokenIssuedTotal++,this.metrics.activeTokens=this.tokens.size,{success:!0,latency:l,token:h,policies:p.policies}}processEncryptRequest(e,t="default",n){const a=Date.now();this.firstRequestTime??=a,this.lastRequestTime=a,this.cleanupExpiredTokens(a);const r=this.config;if(!r)return this.recordLatency(50),this.metrics.encryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!r.enableTransit)return this.recordLatency(20),this.metrics.encryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(r.enableAuth&&n&&!this.validateToken(n,a))return this.recordLatency(30),this.metrics.encryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const c=e.length,l=30+Math.min(100,c/100),d=(Math.random()-.5)*15,h=Math.max(15,l+d);this.recordLatency(h),this.metrics.encryptionOperationsTotal++;const p=Buffer.from(e).toString("base64");return{success:!0,latency:h,data:{ciphertext:`vault:v1:${p}`,key:t}}}processDecryptRequest(e,t="default",n){const a=Date.now();this.firstRequestTime??=a,this.lastRequestTime=a,this.cleanupExpiredTokens(a);const r=this.config;if(!r)return this.recordLatency(50),this.metrics.decryptionOperationsTotal++,{success:!1,latency:50,error:"Vault not configured"};if(!r.enableTransit)return this.recordLatency(20),this.metrics.decryptionOperationsTotal++,{success:!1,latency:20,error:"Transit engine is not enabled"};if(r.enableAuth&&n&&!this.validateToken(n,a))return this.recordLatency(30),this.metrics.decryptionOperationsTotal++,this.metrics.authErrorsTotal++,{success:!1,latency:30,error:"Invalid or expired token"};const c=25+Math.min(80,e.length/150),l=(Math.random()-.5)*12,d=Math.max(12,c+l);this.recordLatency(d),this.metrics.decryptionOperationsTotal++;const h=e.replace(/^vault:v1:/,"");let p;try{p=Buffer.from(h,"base64").toString("utf-8")}catch{return{success:!1,latency:d,error:"Invalid ciphertext format"}}return{success:!0,latency:d,data:{plaintext:p,key:t}}}calculateLoad(){const e=this.metrics,t=e.readRequestsTotal+e.writeRequestsTotal+e.deleteRequestsTotal+e.listRequestsTotal+e.authRequestsTotal+e.encryptionOperationsTotal+e.decryptionOperationsTotal,n=t>0?Math.min(1,e.authErrorsTotal/t):0,a=this.latencyHistory.length>0?this.latencyHistory.reduce((l,d)=>l+d,0)/this.latencyHistory.length:0;let r=0;if(this.firstRequestTime&&this.lastRequestTime&&this.lastRequestTime>this.firstRequestTime){const l=(this.lastRequestTime-this.firstRequestTime)/1e3;r=t/Math.max(l,1)}const c=this.config?.engines.filter(l=>l.enabled).length||0;return{requestsPerSecond:r,averageLatency:a,errorRate:n,activeTokens:this.metrics.activeTokens,secretsCount:this.metrics.secretsTotal,enginesEnabled:c}}getMetrics(){return{...this.metrics}}getConfig(){return this.config?{...this.config}:null}getSecrets(){return Array.from(this.secrets.values())}getActiveTokens(){const e=Date.now();return this.cleanupExpiredTokens(e),Array.from(this.tokens.values())}parseTTL(e){const t=e.match(/^(\d+)([smhd])$/);if(!t)return 86400;const n=parseInt(t[1],10);switch(t[2]){case"s":return n;case"m":return n*60;case"h":return n*3600;case"d":return n*86400;default:return 86400}}validateToken(e,t){const n=this.tokens.get(e);return n?t>n.expiresAt?(this.tokens.delete(e),this.metrics.activeTokens=this.tokens.size,!1):!0:!1}recordLatency(e){this.latencyHistory.push(e),this.latencyHistory.length>this.MAX_LATENCY_HISTORY&&this.latencyHistory.shift()}cleanupExpiredTokens(e){let t=0;for(const[n,a]of this.tokens.entries())e>a.expiresAt&&(this.tokens.delete(n),t++);t>0&&(this.metrics.tokenRevokedTotal+=t,this.metrics.activeTokens=this.tokens.size)}}class FT{config=null;pipelines=new Map;activeBuilds=new Map;nodes=new Map;plugins=new Map;jenkinsMetrics={buildsTotal:0,buildsSuccess:0,buildsFailed:0,buildsRunning:0,buildsPending:0,buildsPerMinute:0,averageBuildDuration:0,executorUtilization:0,executorIdle:0,executorBusy:0,pipelinesTotal:0,pipelinesEnabled:0,nodesTotal:0,nodesOnline:0,pluginsTotal:0,pluginsActive:0,artifactStorageBytes:0,requestsTotal:0,requestsErrors:0};processRequest(e=!0){this.jenkinsMetrics.requestsTotal++,e||this.jenkinsMetrics.requestsErrors++}buildHistory=[];MAX_BUILD_HISTORY=1e3;lastBuildTrigger=new Map;buildTriggerCounter=0;artifacts=new Map;initializeConfig(e){const t=e.data.config||{};this.config={jenkinsUrl:t.jenkinsUrl||"http://jenkins:8080",enableCSRF:t.enableCSRF??!0,executorCount:t.executorCount||2,enablePlugins:t.enablePlugins??!0,plugins:t.plugins||["git","docker","kubernetes"],enablePipeline:t.enablePipeline??!0,enableBlueOcean:t.enableBlueOcean??!1,enableArtifactArchiving:t.enableArtifactArchiving??!0,retentionDays:t.retentionDays||30,pipelines:t.pipelines||[],nodes:t.nodes||[],buildTriggerRate:t.buildTriggerRate||.5,averageBuildDuration:t.averageBuildDuration||12e4,failureRate:t.failureRate||.1},this.initializePipelines(),this.initializeNodes(),this.initializePlugins()}initializePipelines(){if(this.pipelines.clear(),!this.config||!this.config.enablePipeline)return;const e=this.config.pipelines||[];for(const t of e){const n=t.lastBuild||0,a={id:t.id,name:t.name,status:"pending",lastBuild:n,lastSuccessfulBuild:void 0,lastFailedBuild:void 0,duration:void 0,branch:t.branch||"main",enabled:t.enabled!==!1,builds:[],nextBuildNumber:n+1};a.config={triggers:t.triggers||[],parameters:t.parameters||[],environmentVariables:t.environmentVariables||{},postBuildActions:t.postBuildActions||[]},this.pipelines.set(a.id,a)}}calculatePipelineStatus(e){return e.builds.length===0?Array.from(this.activeBuilds.values()).find(a=>a.pipelineId===e.id&&a.status==="running")?"running":"pending":e.builds[e.builds.length-1].status}initializeNodes(){this.nodes.clear();const e={id:"master",name:"master",status:"online",numExecutors:this.config?.executorCount||2,busyExecutors:0,idleExecutors:this.config?.executorCount||2,labels:["master"]};this.nodes.set("master",e);const t=this.config?.nodes||[];for(const n of t){const a={id:n.id,name:n.name,status:"online",numExecutors:n.numExecutors||1,busyExecutors:0,idleExecutors:n.numExecutors||1,labels:n.labels||[]};this.nodes.set(a.id,a)}}initializePlugins(){if(this.plugins.clear(),!this.config||!this.config.enablePlugins)return;const e={git:{version:"4.11.0",description:"Git integration plugin"},docker:{version:"1.2.9",description:"Docker pipeline plugin",dependencies:["workflow-aggregator"]},kubernetes:{version:"1.31.1",description:"Kubernetes plugin for dynamic agent provisioning"},"workflow-aggregator":{version:"2.6",description:"Pipeline plugin aggregator"},"blue-ocean":{version:"1.25.3",description:"Blue Ocean UI for Jenkins",dependencies:["workflow-aggregator"]},credentials:{version:"2.6.1",description:"Credentials management plugin"},"ssh-slaves":{version:"1.32.0",description:"SSH agent plugin"},junit:{version:"1.53",description:"JUnit test result publisher"},"maven-plugin":{version:"3.20",description:"Maven integration plugin"},gradle:{version:"1.36.1",description:"Gradle plugin"}},t=this.config.plugins||[];for(const n of t){let a,r=!0;typeof n=="string"?a=n:(a=n.name||n,r=n.enabled!==!1);const c=e[a]||{version:"1.0.0",description:`${a} plugin`},l={name:a,version:c.version,description:c.description,enabled:r,active:r,dependencies:c.dependencies};this.plugins.set(a,l)}this.updatePluginActiveStatus()}updatePluginActiveStatus(){for(const e of this.plugins.values()){if(!e.enabled){e.active=!1;continue}if(e.dependencies&&e.dependencies.length>0){const t=e.dependencies.every(n=>{const a=this.plugins.get(n);return a&&a.enabled&&a.active});e.active=t}else e.active=e.enabled}}addPlugin(e,t,n){if(this.plugins.has(e))return!1;const a={name:e,version:t||"1.0.0",description:n||`${e} plugin`,enabled:!0,active:!0};return this.plugins.set(e,a),this.updatePluginActiveStatus(),!0}removePlugin(e){if(!this.plugins.get(e))return{success:!1,reason:"Plugin not found"};const n=Array.from(this.plugins.values()).filter(a=>a.dependencies?.includes(e));return n.length>0?{success:!1,reason:`Cannot remove plugin. It is required by: ${n.map(a=>a.name).join(", ")}`}:(this.plugins.delete(e),this.updatePluginActiveStatus(),{success:!0})}setPluginEnabled(e,t){const n=this.plugins.get(e);return n?(n.enabled=t,this.updatePluginActiveStatus(),!0):!1}performUpdate(e){this.config&&(this.updateActiveBuilds(e),this.config.enablePipeline&&this.triggerBuilds(e),this.config.enableArtifactArchiving&&this.cleanupArtifacts(e),this.updateMetrics())}updateActiveBuilds(e){const t=Array.from(this.activeBuilds.entries());for(const[n,a]of t)if(a.status==="running")try{a.startTime&&(e-a.startTime)%5e3<100&&this.updateBuildLogs(a,e);const r=e-a.startTime,c=a.estimatedDuration||this.config?.averageBuildDuration||12e4;if(r<0)continue;if(a.progress=Math.min(100,Math.max(0,Math.floor(r/c*100))),r>=c){const l=Math.random()<(this.config?.failureRate||.1);if(a.status=l?"failed":"success",a.duration=r,a.progress=100,a.logs&&(l?(a.logs.push("[Pipeline] FAILED"),a.logs.push(`Build failed after ${(r/1e3).toFixed(1)}s`)):(a.logs.push("[Pipeline] SUCCESS"),a.logs.push(`Build completed successfully in ${(r/1e3).toFixed(1)}s`)),a.logs.push(`Finished: ${a.status}`)),a.stages)for(const h of a.stages)(h.status==="running"||h.status==="pending")&&(h.status=a.status,h.startTime&&(h.duration=e-h.startTime));this.executePostBuildActions(a,a.status==="success");const d=this.pipelines.get(a.pipelineId);d&&(d.lastBuild=a.number,a.status==="success"?d.lastSuccessfulBuild=a.number:a.status==="failed"&&(d.lastFailedBuild=a.number),d.duration=a.duration,d.builds.push(a),d.builds.length>50&&d.builds.shift(),d.status=this.calculatePipelineStatus(d)),this.freeExecutor(n),this.addBuildToHistory(a),this.activeBuilds.delete(n)}}catch(r){console.error(`Error updating build ${n}:`,r),a.status="failed",this.activeBuilds.delete(n),this.freeExecutor(n)}}triggerBuilds(e){if(!(!this.config||!this.config.enablePipeline))for(const[t,n]of this.pipelines.entries()){if(!n.enabled)continue;const r=(n.config||{}).triggers||[];let c=!1;if(r.length===0){const l=this.config.buildTriggerRate||0;if(l>0){const d=6e4/l,h=this.lastBuildTrigger.get(t)||0;e-h>=d&&(c=!0)}}else for(const l of r)if(l.enabled){if(l.type==="cron"&&l.config?.schedule)c=this.shouldTriggerCron(l.config.schedule,t,e);else if(l.type==="scm"&&l.config?.pollInterval){const d=l.config.pollInterval*60*1e3,h=this.lastBuildTrigger.get(`${t}-scm`)||0;e-h>=d&&(c=!0,this.lastBuildTrigger.set(`${t}-scm`,e))}}c&&this.hasAvailableExecutor()&&(this.startBuild(t,e),this.lastBuildTrigger.set(t,e))}}shouldTriggerCron(e,t,n){const a=this.lastBuildTrigger.get(`${t}-cron`)||0,r=60*1e3;return n-a>=r?(this.lastBuildTrigger.set(`${t}-cron`,n),!0):!1}triggerWebhook(e,t,n){const a=this.pipelines.get(e);if(!a)return{success:!1,reason:"Pipeline not found"};if(!a.enabled)return{success:!1,reason:"Pipeline is disabled"};const c=(a.config||{}).triggers||[],l=c.find(h=>h.type==="webhook"&&h.enabled);if(!l&&c.length>0)return{success:!1,reason:"Webhook trigger not configured or disabled"};if(l?.config?.branches&&t&&!l.config.branches.includes(t))return{success:!1,reason:`Branch ${t} not in allowed branches`};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const d=Date.now();return this.startBuild(e,d,{branch:t,commit:n,triggeredBy:"webhook"}),{success:!0}}triggerBuildManually(e){const t=this.pipelines.get(e);if(!t)return{success:!1,reason:"Pipeline not found"};if(!t.enabled)return{success:!1,reason:"Pipeline is disabled"};if(!this.hasAvailableExecutor())return{success:!1,reason:"No available executors"};const n=Date.now();return this.startBuild(e,n),{success:!0,buildId:`${e}-${t.nextBuildNumber-1}`}}startBuild(e,t,n){const a=this.pipelines.get(e);if(!a)return;const r=a.nextBuildNumber++,c=`${e}-${r}`,l=this.config?.averageBuildDuration||12e4,d=l*.3,h=l+(Math.random()*2-1)*d,p=this.generateBuildLogs(r,a.name,a.branch||"main"),m=this.generateArtifacts(a.name,r),y=a.config||{},b=n?.parameters||{},S=y.parameters||[],C={};for(const k of S)k.defaultValue!==void 0&&(C[k.name]=k.defaultValue);Object.assign(C,b);const E={...y.environmentVariables||{},...C},M={id:c,number:r,pipelineId:e,status:"running",startTime:t,estimatedDuration:h,progress:0,branch:n?.branch||a.branch,commit:n?.commit,logs:p,artifacts:m.map(k=>k.name),triggeredBy:n?.triggeredBy||"system",stages:[{name:"Checkout",status:"running",startTime:t},{name:"Build",status:"pending"},{name:"Test",status:"pending"},{name:"Deploy",status:"pending"}]};M.parameters=C,M.environmentVariables=E,M.postBuildActions=y.postBuildActions||[];for(const k of m)this.artifacts.set(`${c}-${k.name}`,{size:k.size,created:t});this.activeBuilds.set(c,M),a.status=this.calculatePipelineStatus(a),this.allocateExecutor(c),this.jenkinsMetrics.buildsTotal++,this.jenkinsMetrics.buildsRunning++}generateBuildLogs(e,t,n){const a=[];return a.push("Started by system"),a.push(`Building on master in workspace /var/jenkins_home/workspace/${t}`),a.push(`[${t}] $ /usr/bin/git rev-parse --is-inside-work-tree`),a.push("true"),a.push(`[${t}] $ /usr/bin/git config remote.origin.url https://github.com/example/${t}.git`),a.push(`[${t}] $ /usr/bin/git --version`),a.push("git version 2.39.0"),a.push(`[${t}] $ /usr/bin/git fetch --tags --force --progress -- https://github.com/example/${t}.git +refs/heads/${n}:refs/remotes/origin/${n}`),a.push(`From https://github.com/example/${t}`),a.push(` * [new branch]      ${n}       -> origin/${n}`),a.push(`[${t}] $ /usr/bin/git rev-parse "refs/remotes/origin/${n}^{commit}"`),a.push("abc123def456789"),a.push(`[${t}] $ /usr/bin/git checkout -f abc123def456789`),a.push(`HEAD is now at abc123def456789 Commit message for build #${e}`),a.push(`[${t}] $ /usr/bin/git clean -fdx`),a.push("Removing .gradle/"),a.push("Removing build/"),a.push("[Pipeline] Start of Pipeline"),a.push("[Pipeline] node"),a.push(`Running on Jenkins in /var/jenkins_home/workspace/${t}`),a.push("[Pipeline] {"),a.push("[Pipeline] stage"),a.push("[Pipeline] { (Checkout)"),a.push("[Pipeline] checkout"),a.push(`Checking out abc123def456789 from ${n}`),a.push("[Pipeline] }"),a.push("[Pipeline] // stage"),a.push("[Pipeline] stage"),a.push("[Pipeline] { (Build)"),a.push("[Pipeline] sh"),a.push('+ echo "Building application..."'),a.push("Building application..."),a.push("[Pipeline] sh"),a.push("+ ./gradlew build -x test"),a.push("> Task :compileJava"),a.push("> Task :processResources"),a.push("> Task :classes"),a.push("> Task :jar"),a.push("BUILD SUCCESSFUL in 45s"),a.push("[Pipeline] }"),a.push("[Pipeline] // stage"),a.push("[Pipeline] stage"),a.push("[Pipeline] { (Test)"),a.push("[Pipeline] sh"),a.push('+ echo "Running tests..."'),a.push("Running tests..."),a.push("[Pipeline] sh"),a.push("+ ./gradlew test"),a.push("> Task :test"),a.push("Test results: 127 passed, 0 failed"),a.push("BUILD SUCCESSFUL in 30s"),a.push("[Pipeline] }"),a.push("[Pipeline] // stage"),a.push("[Pipeline] stage"),a.push("[Pipeline] { (Deploy)"),a.push("[Pipeline] sh"),a.push('+ echo "Deploying to staging..."'),a.push("Deploying to staging..."),a.push("[Pipeline] }"),a.push("[Pipeline] // stage"),a.push("[Pipeline] }"),a.push("[Pipeline] // node"),a.push("[Pipeline] End of Pipeline"),a}generateArtifacts(e,t){const n=[];return n.push({name:`app-${t}.jar`,size:15*1024*1024}),n.push({name:`app-${t}-sources.jar`,size:3*1024*1024}),n.push({name:`test-results-${t}.xml`,size:512*1024}),n.push({name:`coverage-report-${t}.html`,size:2*1024*1024}),n}cancelBuild(e){const t=this.activeBuilds.get(e);if(!t)return{success:!1,reason:"Build not found or already completed"};if(t.status!=="running"&&t.status!=="pending")return{success:!1,reason:"Build is not running"};if(t.status="aborted",t.duration=Date.now()-t.startTime,t.progress=0,t.logs&&(t.logs.push("[Pipeline] Aborted by user"),t.logs.push("[Pipeline] Terminated")),t.stages)for(const a of t.stages)(a.status==="running"||a.status==="pending")&&(a.status="aborted");this.freeExecutor(e);const n=this.pipelines.get(t.pipelineId);return n&&(n.builds.push(t),n.builds.length>50&&n.builds.shift(),n.status=this.calculatePipelineStatus(n),!n.builds.some(r=>r.status==="success")&&n.builds.every(r=>r.status==="aborted"||r.status==="failed")&&(n.status="pending")),this.activeBuilds.delete(e),this.jenkinsMetrics.buildsRunning--,{success:!0}}updateBuildLogs(e,t){if(!e.logs||e.status!=="running")return;const n=t-e.startTime,a=e.estimatedDuration||12e4,r=Math.min(100,Math.floor(n/a*100)),c=[10,30,50,70,90];for(const l of c)r>=l&&!e.logs.some(d=>d.includes(`Progress: ${l}%`))&&e.logs.push(`[Pipeline] Progress: ${l}% completed`);if(e.stages){const l=Math.floor(r/(100/e.stages.length));for(let d=0;d<e.stages.length;d++)(d<l&&e.stages[d].status==="pending"||d===l&&e.stages[d].status==="pending")&&(e.stages[d].status="running",e.stages[d].startTime=t)}}getBuildLogs(e){return this.getBuildById(e)?.logs}getBuildArtifacts(e){const t=this.getBuildById(e);if(!t||!t.artifacts)return[];const n=[];for(const a of t.artifacts){const r=`${e}-${a}`,c=this.artifacts.get(r);c&&n.push({name:a,size:c.size})}return n}executePostBuildActions(e,t){const n=e.postBuildActions||[];for(const a of n)if(a.enabled)switch(a.type){case"email":if(e.logs){const r=a.config?.recipients||["default@example.com"];e.logs.push(`[Post-Build] Sending email notification to: ${r.join(", ")}`),e.logs.push(`[Post-Build] Email subject: Build ${e.status==="success"?"SUCCESS":"FAILED"} - ${e.pipelineId} #${e.number}`)}break;case"archive":if(e.logs){const r=a.config?.archivePattern||"**/*";e.logs.push(`[Post-Build] Archiving artifacts matching pattern: ${r}`),e.artifacts&&e.artifacts.length>0&&e.logs.push(`[Post-Build] Archived ${e.artifacts.length} artifact(s)`)}break;case"publish":if(e.logs){const r=a.config?.publishTarget||"default";e.logs.push(`[Post-Build] Publishing test results to: ${r}`),e.logs.push("[Post-Build] Published build metrics and artifacts")}break;case"deploy":if(t&&a.config?.deployEnv){if(e.logs){const r=a.config.deployEnv;e.logs.push(`[Post-Build] Deploying to environment: ${r}`),e.logs.push(`[Post-Build] Deployment initiated for build #${e.number}`),e.logs.push(`[Post-Build] Deployment to ${r} completed successfully`)}}else t||e.logs&&e.logs.push("[Post-Build] Skipping deployment - build failed");break}}getPipelineConfig(e){const t=this.pipelines.get(e);return t?t.config||{}:null}updatePipelineConfig(e,t){const n=this.pipelines.get(e);return n?(n.config={...n.config||{},...t},!0):!1}hasAvailableExecutor(){for(const e of this.nodes.values())if(e.idleExecutors>0)return!0;return!1}allocateExecutor(e){for(const t of this.nodes.values())if(t.idleExecutors>0){t.idleExecutors--,t.busyExecutors++;return}}freeExecutor(e){for(const t of this.nodes.values())if(t.busyExecutors>0){t.busyExecutors--,t.idleExecutors++;return}}addBuildToHistory(e){e.duration&&(this.buildHistory.push({timestamp:e.startTime,duration:e.duration,status:e.status}),this.buildHistory.length>this.MAX_BUILD_HISTORY&&this.buildHistory.shift(),e.status==="success"?this.jenkinsMetrics.buildsSuccess++:e.status==="failed"&&this.jenkinsMetrics.buildsFailed++,this.jenkinsMetrics.buildsRunning--)}cleanupArtifacts(e){if(!this.config)return;const t=(this.config.retentionDays||30)*24*60*60*1e3;for(const[n,a]of this.artifacts.entries())e-a.created>t&&this.artifacts.delete(n)}updateMetrics(){this.jenkinsMetrics.buildsRunning=this.activeBuilds.size,this.jenkinsMetrics.buildsPending=Array.from(this.activeBuilds.values()).filter(l=>l.status==="pending").length;const e=Date.now()-6e4,t=this.buildHistory.filter(l=>l.timestamp>e);if(this.jenkinsMetrics.buildsPerMinute=t.length,this.buildHistory.length>0){const l=this.buildHistory.slice(-100),d=l.reduce((h,p)=>h+p.duration,0)/l.length;this.jenkinsMetrics.averageBuildDuration=d}let n=0,a=0,r=0;for(const l of this.nodes.values())n+=l.numExecutors,a+=l.busyExecutors,r+=l.idleExecutors;this.jenkinsMetrics.executorBusy=a,this.jenkinsMetrics.executorIdle=r,this.jenkinsMetrics.executorUtilization=n>0?a/n*100:0,this.jenkinsMetrics.pipelinesTotal=this.pipelines.size,this.jenkinsMetrics.pipelinesEnabled=Array.from(this.pipelines.values()).filter(l=>l.enabled).length,this.jenkinsMetrics.nodesTotal=this.nodes.size,this.jenkinsMetrics.nodesOnline=Array.from(this.nodes.values()).filter(l=>l.status==="online").length,this.jenkinsMetrics.pluginsTotal=this.plugins.size,this.jenkinsMetrics.pluginsActive=Array.from(this.plugins.values()).filter(l=>l.active).length;let c=0;for(const l of this.artifacts.values())c+=l.size;this.jenkinsMetrics.artifactStorageBytes=c}getJenkinsMetrics(){return{...this.jenkinsMetrics}}getPipelines(){for(const e of this.pipelines.values())e.status=this.calculatePipelineStatus(e);return Array.from(this.pipelines.values())}getActiveBuilds(){return Array.from(this.activeBuilds.values())}getNodes(){return Array.from(this.nodes.values())}getPlugins(){return Array.from(this.plugins.values())}getPipelineBuilds(e){const t=this.pipelines.get(e);return t?t.builds:[]}getAllBuilds(){const e=[];e.push(...Array.from(this.activeBuilds.values()));for(const t of this.pipelines.values()){const n=t.builds.slice(-50);e.push(...n)}return e.sort((t,n)=>{const a=t.startTime||0;return(n.startTime||0)-a})}getBuildById(e){if(this.activeBuilds.has(e))return this.activeBuilds.get(e);for(const t of this.pipelines.values()){const n=t.builds.find(a=>a.id===e);if(n)return n}}updateConfig(e){const t=this.config,n=new Set(this.pipelines.keys());this.initializeConfig(e);const a=this.config?.executorCount||2;t&&t.executorCount!==a&&this.updateExecutorCount(a);const r=new Set(this.pipelines.keys());for(const h of n)if(!r.has(h)){for(const[p,m]of this.activeBuilds.entries())m.pipelineId===h&&(m.status="aborted",this.freeExecutor(p),this.activeBuilds.delete(p));this.pipelines.delete(h)}const c=this.config?.pipelines||[];for(const h of c){const p=this.pipelines.get(h.id);p&&(p.name=h.name,p.branch=h.branch||"main",p.enabled=h.enabled!==!1,p.config={triggers:h.triggers||[],parameters:h.parameters||[],environmentVariables:h.environmentVariables||{},postBuildActions:h.postBuildActions||[]})}const l=this.config?.nodes||[],d=new Set(this.nodes.keys());for(const h of d)h!=="master"&&!l.find(p=>p.id===h)&&this.nodes.delete(h);for(const h of l){const p=this.nodes.get(h.id);if(p)p.name=h.name,p.numExecutors=h.numExecutors||1,p.labels=h.labels||[],p.idleExecutors=p.numExecutors-p.busyExecutors;else{const m={id:h.id,name:h.name,status:"online",numExecutors:h.numExecutors||1,busyExecutors:0,idleExecutors:h.numExecutors||1,labels:h.labels||[]};this.nodes.set(h.id,m)}}}setPipelineEnabled(e,t){const n=this.pipelines.get(e);return n?(n.enabled=t,!0):!1}updateExecutorCount(e){const t=this.nodes.get("master");return!t||e<t.busyExecutors?!1:(t.numExecutors,t.numExecutors=e,t.idleExecutors=e-t.busyExecutors,!0)}canUpdateExecutorCount(e){const t=this.nodes.get("master");return t?e<1||e>100?{can:!1,reason:"Executor count must be between 1 and 100"}:e<t.busyExecutors?{can:!1,reason:`Cannot reduce executors to ${e}. Currently ${t.busyExecutors} executors are busy.`}:{can:!0}:{can:!1,reason:"Master node not found"}}setPipelineEnabled(e,t){const n=this.pipelines.get(e);return n?(n.enabled=t,!0):!1}calculateComponentMetrics(){const e=this.getJenkinsMetrics(),t=e.buildsPerMinute/60,n=e.averageBuildDuration,a=e.executorUtilization,r=e.buildsSuccess+e.buildsFailed,c=r>0?e.buildsFailed/r*100:0;return{throughput:t,latency:n,utilization:a,errorRate:c}}}class GT{nodes=[];connections=[];metrics=new Map;connectionMetrics=new Map;isRunning=!1;simulationTime=0;baseTime=Date.now();pausedTime=0;updateInterval=100;intervalId=null;latencyHistory=new Map;connectionLatencyHistory=new Map;HISTORY_SIZE=500;rabbitMQRoutingEngines=new Map;lastRabbitMQUpdate=new Map;activeMQRoutingEngines=new Map;lastActiveMQUpdate=new Map;sqsRoutingEngines=new Map;lastSQSUpdate=new Map;azureServiceBusRoutingEngines=new Map;lastAzureServiceBusUpdate=new Map;pubSubRoutingEngines=new Map;lastPubSubUpdate=new Map;kongRoutingEngines=new Map;apigeeRoutingEngines=new Map;mulesoftRoutingEngines=new Map;graphQLGatewayRoutingEngines=new Map;lastGraphQLGatewayUpdate=new Map;bffRoutingEngines=new Map;webhookRelayRoutingEngines=new Map;redisRoutingEngines=new Map;cassandraRoutingEngines=new Map;clickHouseRoutingEngines=new Map;snowflakeRoutingEngines=new Map;elasticsearchRoutingEngines=new Map;s3RoutingEngines=new Map;postgresConnectionPools=new Map;prometheusEngines=new Map;grafanaEngines=new Map;lokiEngines=new Map;jaegerEngines=new Map;otelCollectorEngines=new Map;pagerDutyEngines=new Map;keycloakEngines=new Map;vaultEngines=new Map;wafEngines=new Map;firewallEngines=new Map;idsIpsEngines=new Map;jenkinsEngines=new Map;constructor(){this.initializeMetrics()}calculatePercentile(e,t){if(e.length===0)return 0;const n=t/100*(e.length-1),a=Math.floor(n),r=Math.ceil(n),c=n-a;return a===r?e[a]:e[a]*(1-c)+e[r]*c}updateLatencyPercentiles(e,t,n){let a=this.latencyHistory.get(e);if(a||(a=[],this.latencyHistory.set(e,a)),a.push(t),a.length>this.HISTORY_SIZE&&a.shift(),a.length>0){const r=[...a].sort((c,l)=>c-l);n.latencyP50=this.calculatePercentile(r,50),n.latencyP99=this.calculatePercentile(r,99)}}updateConnectionLatencyPercentiles(e,t,n){let a=this.connectionLatencyHistory.get(e);if(a||(a=[],this.connectionLatencyHistory.set(e,a)),a.push(t),a.length>this.HISTORY_SIZE&&a.shift(),a.length>0){const r=[...a].sort((c,l)=>c-l);n.latencyP50=this.calculatePercentile(r,50),n.latencyP99=this.calculatePercentile(r,99)}}initialize(e,t){this.nodes=e,this.connections=t,this.initializeMetrics();for(const n of e)n.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(n),n.type==="activemq"&&this.initializeActiveMQRoutingEngine(n),n.type==="aws-sqs"&&this.initializeSQSRoutingEngine(n),n.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(n),n.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(n),n.type==="kong"&&this.initializeKongRoutingEngine(n),n.type==="apigee"&&this.initializeApigeeRoutingEngine(n),n.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(n),n.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(n),n.type==="bff-service"&&this.initializeBFFRoutingEngine(n),n.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(n),n.type==="postgres"&&this.initializePostgreSQLConnectionPool(n),n.type==="redis"&&this.initializeRedisRoutingEngine(n),n.type==="cassandra"&&this.initializeCassandraRoutingEngine(n),n.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(n),n.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(n),n.type==="elasticsearch"&&this.initializeElasticsearchRoutingEngine(n),n.type==="s3-datalake"&&this.initializeS3RoutingEngine(n),n.type==="prometheus"&&this.initializePrometheusEngine(n),n.type==="grafana"&&this.initializeGrafanaEngine(n),n.type==="jaeger"&&this.initializeJaegerEngine(n),n.type==="otel-collector"&&this.initializeOpenTelemetryCollectorEngine(n),n.type==="pagerduty"&&this.initializePagerDutyEngine(n),n.type==="keycloak"&&this.initializeKeycloakEngine(n),n.type==="secrets-vault"&&this.initializeVaultEngine(n),n.type==="waf"&&this.initializeWAFEngine(n),n.type==="firewall"&&this.initializeFirewallEngine(n),n.type==="ids-ips"&&this.initializeIDSIPSEngine(n),n.type==="jenkins"&&this.initializeJenkinsEngine(n);for(const n of e)if(n.type==="postgres"){const a=this.postgresConnectionPools.get(n.id);if(a){const r=n.data.config;a.updateConfig({maxConnections:r.maxConnections||100,minConnections:r.minConnections||0,idleTimeout:r.idleTimeout||3e5,maxLifetime:r.maxLifetime||36e5,connectionTimeout:r.connectionTimeout||5e3})}}un.initialize(e,t)}updateNodesAndConnections(e,t){this.nodes=e,this.connections=t;for(const r of e)this.metrics.has(r.id)||this.metrics.set(r.id,this.createDefaultMetrics(r.id,r.type)),r.type==="rabbitmq"&&this.initializeRabbitMQRoutingEngine(r),r.type==="activemq"&&this.initializeActiveMQRoutingEngine(r),r.type==="aws-sqs"&&this.initializeSQSRoutingEngine(r),r.type==="azure-service-bus"&&this.initializeAzureServiceBusRoutingEngine(r),r.type==="gcp-pubsub"&&this.initializePubSubRoutingEngine(r),r.type==="kong"&&this.initializeKongRoutingEngine(r),r.type==="apigee"&&this.initializeApigeeRoutingEngine(r),r.type==="mulesoft"&&this.initializeMuleSoftRoutingEngine(r),r.type==="graphql-gateway"&&this.initializeGraphQLGatewayRoutingEngine(r),r.type==="bff-service"&&this.initializeBFFRoutingEngine(r),r.type==="webhook-relay"&&this.initializeWebhookRelayRoutingEngine(r),r.type==="clickhouse"&&this.initializeClickHouseRoutingEngine(r),r.type==="snowflake"&&this.initializeSnowflakeRoutingEngine(r),r.type==="waf"&&this.initializeWAFEngine(r),r.type==="firewall"&&this.initializeFirewallEngine(r),r.type==="ids-ips"&&this.initializeIDSIPSEngine(r),r.type==="jenkins"&&(this.jenkinsEngines.has(r.id)?this.jenkinsEngines.get(r.id).updateConfig(r):this.initializeJenkinsEngine(r));const n=new Set(e.map(r=>r.id));for(const[r]of this.metrics.entries())n.has(r)||(this.metrics.delete(r),this.rabbitMQRoutingEngines.delete(r),this.activeMQRoutingEngines.delete(r),this.sqsRoutingEngines.delete(r),this.azureServiceBusRoutingEngines.delete(r),this.pubSubRoutingEngines.delete(r),this.kongRoutingEngines.delete(r),this.apigeeRoutingEngines.delete(r),this.mulesoftRoutingEngines.delete(r),this.graphQLGatewayRoutingEngines.delete(r),this.bffRoutingEngines.delete(r),this.webhookRelayRoutingEngines.delete(r),this.redisRoutingEngines.delete(r),this.cassandraRoutingEngines.delete(r),this.clickHouseRoutingEngines.delete(r),this.snowflakeRoutingEngines.delete(r),this.elasticsearchRoutingEngines.delete(r),this.s3RoutingEngines.delete(r),this.graphQLGatewayRoutingEngines.delete(r),this.keycloakEngines.delete(r),this.vaultEngines.delete(r),this.wafEngines.delete(r),this.firewallEngines.delete(r),this.idsIpsEngines.delete(r),this.lastRabbitMQUpdate.delete(r),this.lastActiveMQUpdate.delete(r),this.lastSQSUpdate.delete(r),this.lastAzureServiceBusUpdate.delete(r),this.lastPubSubUpdate.delete(r),this.lastGraphQLGatewayUpdate.delete(r));for(const r of t)this.connectionMetrics.has(r.id)||this.connectionMetrics.set(r.id,this.createDefaultConnectionMetrics(r));const a=new Set(t.map(r=>r.id));for(const[r]of this.connectionMetrics.entries())a.has(r)||this.connectionMetrics.delete(r);un.updateNodesAndConnections(e,t)}start(){if(console.log("EmulationEngine.start() called",{isRunning:this.isRunning,hasInterval:!!this.intervalId}),this.isRunning&&!this.intervalId&&(console.log("Inconsistent state detected: isRunning=true but no interval, stopping first..."),this.stop()),this.isRunning){console.log("Already running, returning early");return}console.log("Setting isRunning to true and creating interval..."),this.isRunning=!0,this.baseTime=Date.now()-this.pausedTime,console.log("Starting data flow engine..."),un.start(),console.log("Creating simulation interval..."),this.intervalId=setInterval(()=>{try{this.simulate()}catch(e){console.error("Error in simulation step:",e)}},this.updateInterval),console.log("EmulationEngine.start() complete",{intervalId:!!this.intervalId})}stop(){this.isRunning&&(this.isRunning=!1,this.pausedTime=this.simulationTime,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),un.stop())}resetSimulation(){this.stop(),this.simulationTime=0,this.pausedTime=0,this.baseTime=Date.now(),this.initializeMetrics()}simulate(){this.simulationTime=Date.now()-this.baseTime;const e=Date.now();for(const[n,a]of this.rabbitMQRoutingEngines.entries()){const r=this.lastRabbitMQUpdate.get(n)||e,c=e-r;c>0&&(a.processConsumption(c),this.lastRabbitMQUpdate.set(n,e))}for(const[n,a]of this.activeMQRoutingEngines.entries()){const r=this.lastActiveMQUpdate.get(n)||e,c=e-r;c>0&&(a.processConsumption(c),this.lastActiveMQUpdate.set(n,e))}for(const[n,a]of this.sqsRoutingEngines.entries()){const r=this.lastSQSUpdate.get(n)||e,c=e-r;c>0&&(a.processConsumption(c),this.lastSQSUpdate.set(n,e))}for(const[n,a]of this.azureServiceBusRoutingEngines.entries()){const r=this.lastAzureServiceBusUpdate.get(n)||e,c=e-r;c>0&&(a.processConsumption(c),this.lastAzureServiceBusUpdate.set(n,e))}for(const[n,a]of this.pubSubRoutingEngines.entries()){const r=this.lastPubSubUpdate.get(n)||e,c=e-r;c>0&&(a.processConsumption(c),this.lastPubSubUpdate.set(n,e))}for(const n of this.nodes)this.updateComponentMetrics(n);Na.analyze(this.nodes,this.metrics,this.connectionMetrics,[]);const t=Na.getAlerts();for(const[n,a]of this.pagerDutyEngines.entries())a.processAlerts(e,t),a.advanceTime(e);for(const[n,a]of this.prometheusEngines.entries())a.performScraping(e,this.nodes,this.metrics);for(const[n,a]of this.grafanaEngines.entries()){const r=this.nodes.find(c=>c.id===n);if(r){const c=this.isPrometheusAvailableForGrafana(r),l=this.createLokiQueryExecutor(r);a.performUpdate(e,c,l)}}for(const[n,a]of this.lokiEngines.entries())a.performRetention(e);for(const[n,a]of this.jaegerEngines.entries())a.performCleanup(e);for(const[n,a]of this.jenkinsEngines.entries()){a.performUpdate(e);const r=a.calculateComponentMetrics(),c=this.metrics.get(n);c&&r&&(c.throughput=r.throughput||c.throughput,c.latency=r.latency||c.latency,c.utilization=(r.utilization||0)/100,c.errorRate=(r.errorRate||0)/100,c.timestamp=e)}for(const[n,a]of this.otelCollectorEngines.entries())a.processBatchFlush();for(const n of this.connections)this.updateConnectionMetrics(n)}updateComponentMetrics(e){const t=e.data.config||{},n=this.metrics.get(e.id)||this.createDefaultMetrics(e.id,e.type),a=this.connections.some(d=>d.target===e.id),r=this.connections.some(d=>d.source===e.id);if(!(a||r))n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,n.customMetrics={};else switch(e.type){case"kafka":this.simulateKafka(e,t,n,a);break;case"rabbitmq":this.simulateRabbitMQ(e,t,n,a);break;case"activemq":this.simulateActiveMQ(e,t,n,a);break;case"aws-sqs":this.simulateSQS(e,t,n,a);break;case"azure-service-bus":this.simulateAzureServiceBus(e,t,n,a);break;case"gcp-pubsub":this.simulatePubSub(e,t,n,a);break;case"postgres":case"mongodb":case"redis":case"cassandra":this.simulateDatabase(e,t,n,a);break;case"nginx":this.simulateNginx(e,t,n,a);break;case"docker":case"kubernetes":this.simulateInfrastructure(e,t,n,a);break;case"rest":case"grpc":case"websocket":this.simulateAPI(e,t,n,a);break;case"kong":this.simulateKong(e,t,n,a);break;case"apigee":this.simulateApigee(e,t,n,a);break;case"mulesoft":this.simulateMuleSoft(e,t,n,a);break;case"bff-service":this.simulateBFF(e,t,n,a);break;case"prometheus":this.simulatePrometheus(e,t,n,a);break;case"grafana":this.simulateGrafana(e,t,n,a);break;case"loki":this.simulateLoki(e,t,n,a);break;case"keycloak":this.simulateKeycloak(e,t,n,a);break;case"secrets-vault":this.simulateVault(e,t,n,a);break;case"pagerduty":this.simulatePagerDuty(e,t,n,a);break;case"waf":this.simulateWAF(e,t,n,a);break;case"firewall":this.simulateFirewall(e,t,n,a);break;case"ids-ips":this.simulateIDSIPS(e,t,n,a);break}this.applyCascadeEffects(e,n);const l=uo.applyStateEffects(e.id,{throughput:n.throughput,latency:n.latency,errorRate:n.errorRate,utilization:n.utilization});n.throughput=l.throughput,n.latency=l.latency,n.errorRate=l.errorRate,n.utilization=l.utilization,this.updateLatencyPercentiles(e.id,n.latency,n),n.timestamp=Date.now(),this.metrics.set(e.id,n)}applyCascadeEffects(e,t){const n=this.connections.filter(p=>p.target===e.id);if(n.length===0)return;let a=0,r=0,c=0;const l=t.latency;for(const p of n){const m=this.metrics.get(p.source),y=this.connectionMetrics.get(p.id);if(!m||!y)continue;const b=y.throughputDependency||.5;c+=b;const S=m.errorRate*b*.3;a+=S*b;const E=Math.min(m.latency,500)*b*.2;r+=E*b,(m.errorRate>.5||m.utilization>.95)&&(a+=.1*b,r+=100*b)}c>0&&(a/=c,r/=c),r=Math.min(r,500),t.errorRate=Math.min(1,t.errorRate+a),t.latency=l+r;const h=1e4;t.latency=Math.min(t.latency,h),r>50&&(t.utilization=Math.min(1,t.utilization+.1)),a>.1&&(t.throughput=t.throughput*(1-a*.5))}updateConnectionMetrics(e){const t=this.metrics.get(e.source),n=this.metrics.get(e.target);if(!t||!n)return;const a=this.connectionMetrics.get(e.id)||{id:e.id,source:e.source,target:e.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0},r=this.nodes.find(d=>d.id===e.source),c=this.nodes.find(d=>d.id===e.target),l=r?.data.config?.avgPayloadSize||1024;a.traffic=t.throughput*l/1024,a.latency=this.calculateConnectionLatency(e,t,n),a.errorRate=t.errorRate*.1,this.calculateInteractionMetrics(e,a,t,n,r,c),this.updateConnectionLatencyPercentiles(e.id,a.latency,a),a.timestamp=Date.now(),this.connectionMetrics.set(e.id,a)}calculateInteractionMetrics(e,t,n,a,r,c){const l=e.data||{},h=(l.bandwidthMbps||1e3)*1024*1024/8;this.getComponentCapacity(r);const p=this.getComponentCapacity(c),m=n.throughput,y=r?.data.config?.avgPayloadSize||1024,b=m*y,S=Math.min(b,h),C=p*y,E=Math.min(S,C);t.effectiveThroughput=E/y;const k=this.connections.filter(Z=>Z.target===e.target).reduce((Z,te)=>{const le=this.metrics.get(te.source);return Z+(le?.throughput||0)},0);t.throughputDependency=k>0?m/k:0;const T=a.utilization,A=b/h,N=m/p,q=(l.packetLossPercent||0)/100;t.backpressure=Math.min(1,T*.4+A*.3+N*.2+q*.1);const O=b>h*.8,H=m>p*.8,J=t.backpressure>.7;t.bottleneck=O||H||J;const se=this.getBaseLatency(e.type),ce=Math.max(0,t.latency-se)/se;t.congestion=Math.min(1,A*.4+ce*.3+q*.3),t.utilization=Math.min(1,t.effectiveThroughput/p)}getComponentCapacity(e){if(!e)return 1e3;const t=e.data.config||{};switch(e.type){case"kafka":case"rabbitmq":case"activemq":return t.throughputMsgs||1e3;case"postgres":case"mongodb":case"redis":return t.maxConnections?t.maxConnections*10:1e3;case"nginx":case"rest":case"grpc":case"websocket":return t.requestsPerSecond||1e3;case"docker":case"kubernetes":return(t.workerThreads||1)*500;default:return 1e3}}getBaseLatency(e){return{sync:5,async:2,http:10,grpc:5,websocket:3}[e]||10}simulateKafka(e,t,n,a){const r=e.data.config,c=r?.brokers||["localhost:9092"],l=r?.topics||[],d=r?.consumerGroups||[],h=l.length||t.topicCount||5,p=l.reduce((_,P)=>_+(P.partitions||3),0)||t.partitions||3,m=l.length>0?l.reduce((_,P)=>_+(P.replication||1),0)/l.length:t.replicationFactor||1,y=this.connections.filter(_=>_.target===e.id);let b=0;for(const _ of y){const P=this.metrics.get(_.source);P&&(b+=P.throughput||0)}const S=t.throughputMsgs||Math.max(1e3,b);if(!a&&S<=0){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,l.length>0)for(const _ of l)_.messages=_.messages||0,_.size=_.size||0;for(const _ of d)_.lag=0;n.customMetrics={topics:h,partitions:p,replication:Math.round(m*10)/10,brokers:c.length,consumer_groups:d.length,total_lag:0};return}const C=.2*Math.sin(this.simulationTime/1e3);n.throughput=S*(1+C);const E=3,M=Math.min(p/10,10),k=Math.max(1,(m-1)*2),T=Math.max(0,(m-1)*1),A=this.calculateCompressionOverhead(l);if(n.latency=E+M+k+T+A,c.length>1){const _=Math.min(5,c.length*.5);n.latency+=_}const N=this.calculateUnderReplicatedPartitions(l,c.length),q=m>1?(m-1)*5e-4:0,O=N>0?N*.001:0,H=r?.acls||[];let J=0,se=0;for(const _ of y){const P=this.nodes.find(Y=>Y.id===_.source);if(!P)continue;const W=P.data.config||{},he=W.messaging?.producerId||W.clientId||`User:${P.id.slice(0,8)}`,j=W.messaging?.topic||l[0]?.name||"default-topic";if(!this.checkACLPermission(H,he,"Topic",j,"Write")){const Y=this.metrics.get(_.source);Y&&(se+=Y.throughput*.9,J+=.45)}}se>0&&(n.throughput=Math.max(0,n.throughput-se)),n.errorRate=Math.max(0,Math.min(.1,q+O+J+1e-4));const Z=Math.min(1,n.throughput/1e4),te=Math.min(1,p/200);n.utilization=Math.min(1,Z*.7+te*.3);const le=t.avgPayloadSize||1024,ue=this.updateInterval/1e3;for(const _ of l){const P=n.throughput/h,W=P*ue;_.messages=(_.messages||0)+W;const he=this.getCompressionRatio(_.config?.compressionType),j=W*le*he;if(_.size=(_.size||0)+j,_.config?.retentionMs&&_.config.retentionMs>0){const Q=_.config.retentionMs/1e3,ae=P*Q;if(_.messages>ae){const U=_.messages-ae;_.messages=ae,_.size=Math.max(0,_.size-U*le*he)}}if(_.config?.retentionBytes&&_.config.retentionBytes>0&&_.size>_.config.retentionBytes){const Q=1-_.config.retentionBytes/_.size;_.size=_.config.retentionBytes,_.messages=Math.max(0,_.messages*(1-Q))}if((_.config?.cleanupPolicy==="compact"||_.config?.cleanupPolicy==="delete,compact")&&this.simulationTime%3e5<this.updateInterval){const ae=Math.round(_.messages*.85),U=_.messages-ae;_.messages=ae,_.size=Math.max(0,_.size-U*le*he)}if(_.config?.minInsyncReplicas){const Q=_.config.minInsyncReplicas,Y=this.getAverageISRCount(_,c.length);if(Y<Q){const ae=Q-Y;n.errorRate+=ae*.01}}if(_.config?.maxMessageBytes&&le>_.config.maxMessageBytes){const Q=Math.min(.1,(le-_.config.maxMessageBytes)/_.config.maxMessageBytes);n.errorRate+=Q*.5}}let L=0;for(const _ of d){const P=l.find(at=>at.name===_.topic);if(!P)continue;const W=_.members||1,he=P.partitions||1,j=this.assignPartitionsToConsumers(W,he),Q=300;let Y=0;for(const at of j){const Ze=at.partitions.length;Y+=Ze*Q}const ae=Math.min(Y,W*Q),U=n.throughput/h||0,ie=_.id||`Group:${_.id}`,$=this.checkACLPermission(H,ie,"Topic",_.topic,"Read"),V=this.checkACLPermission(H,ie,"Group",_.id,"Read");let pe=ae;(!$||!V)&&(pe=0);const me=U,ye=pe,ve=Math.max(0,(me-ye)*ue),Le=_.lag||0,$e=Math.max(0,Le+ve-ye*ue);_.lag=$e,L+=$e,this.isRebalancing(e.id,_.id)&&(_.lag=Math.min($e*1.2,$e+me*ue*.3),L+=$e*.2)}n.customMetrics={topics:h,partitions:p,replication:Math.round(m*10)/10,brokers:c.length,consumer_groups:d.length,total_lag:Math.round(L),avg_topic_messages:h>0?Math.round(l.reduce((_,P)=>_+(P.messages||0),0)/h):0,total_topic_size_mb:Math.round(l.reduce((_,P)=>_+(P.size||0),0)/1024/1024*100)/100,under_replicated_partitions:N}}calculateCompressionOverhead(e){if(e.length===0)return 0;const t={uncompressed:0,gzip:2,snappy:.5,lz4:.3,zstd:1};let n=0,a=0;for(const r of e){const c=r.config?.compressionType||"gzip",l=t[c]||0;l>0&&(n+=l,a++)}return a>0?n/a:0}getCompressionRatio(e){return{uncompressed:1,gzip:.3,snappy:.5,lz4:.4,zstd:.25}[e||"gzip"]||.3}calculateUnderReplicatedPartitions(e,t){let n=0;for(const a of e){const r=a.replication||1,c=a.partitions||1;if(a.partitionInfo&&Array.isArray(a.partitionInfo))for(const l of a.partitionInfo){const d=r;(l.isr?.length||l.replicas?.length||1)<d&&n++}else r>t&&(n+=c*Math.max(0,1-t/r)),Math.random()<.05&&r>1&&(n+=c*.1)}return Math.round(n)}assignPartitionsToConsumers(e,t){if(e===0||t===0)return[];const n=[],a=Math.floor(t/e),r=t%e;let c=0;for(let l=0;l<e;l++){const d=[],h=a+(l<r?1:0);for(let p=0;p<h;p++)c<t&&(d.push(c),c++);n.push({consumerId:l,partitions:d})}return n}consumerGroupMemberCounts=new Map;rebalancingGroups=new Map;isRebalancing(e,t){const n=`${e}:${t}`,a=this.rebalancingGroups.get(n);if(a&&Date.now()<a)return!0;const r=this.getCurrentGroupMembers(e,t),c=this.consumerGroupMemberCounts.get(n);return c!==void 0&&r!==c?(this.rebalancingGroups.set(n,Date.now()+2e3),this.consumerGroupMemberCounts.set(n,r),!0):((c===void 0||r!==c)&&this.consumerGroupMemberCounts.set(n,r),!1)}getCurrentGroupMembers(e,t){const n=this.nodes.find(l=>l.id===e);return n&&(n.data.config?.consumerGroups||[]).find(l=>l.id===t)?.members||0}getAverageISRCount(e,t){if(!e.partitionInfo||!Array.isArray(e.partitionInfo)||e.partitionInfo.length===0){const r=e.replication||1;return Math.min(r,t)*.95}let n=0,a=0;for(const r of e.partitionInfo){const c=r.isr?.length||r.replicas?.length||1;n+=c,a++}return a>0?n/a:1}checkACLPermission(e,t,n,a,r,c){if(!e||e.length===0)return!0;const l=t.includes(":")?t:`User:${t}`,d=e.filter(m=>{const y=m.principal||"";if(y!==l&&y!=="*"&&!l.includes(y)||m.resourceType!==n)return!1;const b=m.resourcePatternType||"Literal",S=m.resourceName||"";let C=!1;switch(b){case"Literal":C=S===a||S==="*";break;case"Prefixed":if(S==="*")C=!0;else if(S.endsWith("*")){const E=S.slice(0,-1);C=a.startsWith(E)}else C=a.startsWith(S);break;case"Match":if(S==="*")C=!0;else{const E=S.replace(/\./g,"\\.").replace(/\*/g,".*");C=new RegExp(`^${E}$`).test(a)}break;default:C=S===a||S==="*"}return!(!C||m.operation!==r&&m.operation!=="All"||m.host&&m.host!=="*"&&c&&m.host!==c)});return d.length===0||d.filter(m=>m.permission==="Deny").length>0?!1:d.filter(m=>m.permission==="Allow").length>0}simulateRabbitMQ(e,t,n,a){this.rabbitMQRoutingEngines.has(e.id)||this.initializeRabbitMQRoutingEngine(e);const r=this.rabbitMQRoutingEngines.get(e.id);if(e.data.config,!a){n.throughput=0,n.latency=2,n.errorRate=0;const T=r.getTotalQueueDepth();n.utilization=Math.min(1,T/1e5);const A=r.getAllQueueMetrics(),N=r.getActiveConnections();n.customMetrics={queue_depth:T,connections:N,replication:t.replicationFactor||1},this.updateQueueMetricsInConfig(e,A);return}const c=this.connections.filter(T=>T.target===e.id);let l=0;for(const T of c){const A=this.connectionMetrics.get(T.id);if(A){const q=A.traffic/1024;l+=q}}const d=t.throughputMsgs||l||1e3,h=t.replicationFactor||1,p=(Math.random()-.5)*.1;n.throughput=d*(1+p);const m=r.getTotalQueueDepth(),y=2,b=Math.min(50,m/1e3);n.latency=y+h*5+b+Math.random()*5;const S=5e-4,C=Math.min(.01,m/1e6);n.errorRate=S+C,n.utilization=Math.min(1,m/1e5);const E=r.getAllQueueMetrics(),M=r.getActiveConnections();let k=0;for(const T of E.values())k+=T.consumers;n.customMetrics={queue_depth:m,connections:M,replication:h,queues:E.size,consumers:k},this.updateQueueMetricsInConfig(e,E)}initializeRabbitMQRoutingEngine(e){const t=e.data.config||{},n=new iT;n.initialize({queues:t.queues||[],exchanges:t.exchanges||[{name:"amq.direct",type:"direct",durable:!0,autoDelete:!1,internal:!1},{name:"amq.topic",type:"topic",durable:!0,autoDelete:!1,internal:!1},{name:"amq.fanout",type:"fanout",durable:!0,autoDelete:!1,internal:!1}],bindings:t.bindings||[]}),this.rabbitMQRoutingEngines.set(e.id,n),this.lastRabbitMQUpdate.set(e.id,Date.now())}updateQueueMetricsInConfig(e,t){const n=e.data.config||{},a=n.queues||[];for(let r=0;r<a.length;r++){const c=a[r],l=t.get(c.name);l&&(a[r]={...c,messages:l.messages,ready:l.ready,unacked:l.unacked,consumers:l.consumers})}n.queues=a}simulateActiveMQ(e,t,n,a){this.activeMQRoutingEngines.has(e.id)||this.initializeActiveMQRoutingEngine(e);const r=this.activeMQRoutingEngines.get(e.id),c=e.data.config||{},l=c.protocol||"openwire",d=c.persistenceEnabled??!0,h=c.maxConnections||1e3,p=c.memoryLimit||1024,m=c.storeUsage||0,y=c.tempUsage||0,b=c.connections||[];if(!a){n.throughput=0,n.latency=this.getProtocolBaseLatency(l),n.errorRate=0;const U=r.getTotalQueueDepth(),ie=r.getTotalTopicMessages(),$=U+ie;n.utilization=Math.min(1,$/1e5);const V=r.getAllQueueMetrics(),pe=r.getAllTopicMetrics(),me=r.getActiveConnections();let ye=0;for(const Le of V.values())ye+=Le.consumerCount;let ve=0;for(const Le of pe.values())ve+=Le.subscriberCount;n.customMetrics={queue_depth:U,topic_messages:ie,connections:me,queues:V.size,topics:pe.size,consumers:ye,subscribers:ve,memory_usage:m+y,memory_percent:p>0?(m+y)/p*100:0},this.updateActiveMQMetricsInConfig(e,V,pe);return}const S=this.connections.filter(U=>U.target===e.id);let C=0;for(const U of S){const ie=this.connectionMetrics.get(U.id);if(ie){const V=ie.traffic/1024;C+=V}}const E=t.throughputMsgs||C||1e3,M=(Math.random()-.5)*.1;n.throughput=E*(1+M);const k=r.getTotalQueueDepth(),T=r.getTotalTopicMessages(),A=k+T,N=this.getProtocolBaseLatency(l),q=d?5:0,O=Math.min(50,A/1e3),H=p>0&&m+y>p*.8?10:0;n.latency=N+q+O+H+Math.random()*5;const J=c.acls||[];let se=0,ce=0;for(const U of S){const ie=this.nodes.find(me=>me.id===U.source);if(!ie)continue;const $=ie.data.config,V=$?.messaging||{},pe=$?.username||$?.clientId||c.username||`user-${U.source.slice(0,8)}`;if(V.queue&&!this.checkActiveMQACLPermission(J,pe,`queue://${V.queue}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,se+=.45)}if(V.topic&&!this.checkActiveMQACLPermission(J,pe,`topic://${V.topic}`,"write")){const ye=this.metrics.get(U.source);ye&&(ce+=ye.throughput*.9,se+=.45)}}const Z=c.queues||[];for(const U of Z)U.consumerCount&&U.consumerCount>0&&(this.checkActiveMQACLPermission(J,c.username||"admin",`queue://${U.name}`,"read")||(se+=.1));const te=5e-4,le=Math.min(.01,A/1e6),ue=p>0&&m+y>p?.01:0,L=b.length>=h?.005:0;ce>0&&(n.throughput=Math.max(0,n.throughput-ce)),n.errorRate=Math.min(1,te+le+ue+L+se);const _=Math.min(1,A/1e5),P=p>0?Math.min(1,(m+y)/p):0,W=Math.min(1,b.length/h);n.utilization=Math.max(_,P,W);const he=r.getAllQueueMetrics(),j=r.getAllTopicMetrics(),Q=r.getActiveConnections();let Y=0;for(const U of he.values())Y+=U.consumerCount;let ae=0;for(const U of j.values())ae+=U.subscriberCount;n.customMetrics={queue_depth:k,topic_messages:T,connections:Q,queues:he.size,topics:j.size,consumers:Y,subscribers:ae,memory_usage:m+y,memory_percent:p>0?(m+y)/p*100:0,protocol:l},this.updateActiveMQMetricsInConfig(e,he,j)}checkActiveMQACLPermission(e,t,n,a){if(!e||e.length===0)return!0;const r=e.filter(d=>{const h=d.principal||"";if(h!==t&&h!=="*"&&!t.includes(h))return!1;const p=d.resource||"";let m=!1;if(p==="*"||p===n)m=!0;else if(p.endsWith("*")){const S=p.slice(0,-1);m=n.startsWith(S)}else p.includes("://")?m=p===n:m=n.includes(p);if(!m)return!1;const y=(d.operation||"").toLowerCase(),b=a.toLowerCase();return!(y!==b&&y!=="all"&&y!=="*")});return r.length===0?!0:r.filter(d=>d.permission==="deny").length>0?!1:(r.filter(d=>d.permission==="allow").length>0,!0)}getProtocolBaseLatency(e){return{openwire:2,amqp:5,mqtt:8,stomp:10,ws:12}[e]||5}initializeActiveMQRoutingEngine(e){const t=e.data.config||{},n=new oT;n.initialize({queues:t.queues||[],topics:t.topics||[],subscriptions:t.subscriptions||[]}),this.activeMQRoutingEngines.set(e.id,n),this.lastActiveMQUpdate.set(e.id,Date.now())}updateActiveMQMetricsInConfig(e,t,n){const a=e.data.config||{},r=a,c=a.queues||[];for(let m=0;m<c.length;m++){const y=c[m],b=t.get(y.name);b&&(c[m]={...y,queueSize:b.queueSize,consumerCount:b.consumerCount,enqueueCount:b.enqueueCount,dequeueCount:b.dequeueCount})}a.queues=c;const l=a.topics||[];for(let m=0;m<l.length;m++){const y=l[m],b=n.get(y.name);b&&(l[m]={...y,subscriberCount:b.subscriberCount,enqueueCount:b.enqueueCount,dequeueCount:b.dequeueCount})}a.topics=l;const d=this.connections.filter(m=>m.target===e.id),h=[];for(const m of d){const y=this.nodes.find(M=>M.id===m.source);if(!y)continue;y.data.config?.messaging;const S=r.protocol||"openwire",C=this.connectionMetrics.get(m.id),E=C?Math.floor(C.traffic/1024):0;h.push({id:m.id,remoteAddress:`${y.data.label||y.id}`,clientId:`client-${m.source.slice(0,8)}`,userName:r.username||"admin",connectedSince:new Date().toISOString(),messageCount:E,protocol:S==="openwire"?"OpenWire":S==="amqp"?"AMQP":S==="mqtt"?"MQTT":S==="stomp"?"STOMP":S==="ws"?"WebSocket":"OpenWire"})}a.connections=h;const p=[];for(const m of l)for(const y of d){const b=this.nodes.find(E=>E.id===y.source);if(!b)continue;const C=b.data.config?.messaging||{};if(C.topic===m.name||!C.queue){const E=n.get(m.name);p.push({id:`sub-${y.id}-${m.name}`,destination:m.name,clientId:`client-${y.source.slice(0,8)}`,pendingQueueSize:0,dispatchedQueueSize:0,dispatchedCounter:E?.enqueueCount||0,enqueueCounter:E?.enqueueCount||0,dequeueCounter:E?.dequeueCount||0})}}a.subscriptions=p}simulateAzureServiceBus(e,t,n,a){this.azureServiceBusRoutingEngines.has(e.id)||this.initializeAzureServiceBusRoutingEngine(e);const r=this.azureServiceBusRoutingEngines.get(e.id),c=e.data.config||{};if(!a){n.throughput=0,n.latency=5,n.errorRate=0;const se=r.getTotalQueueDepth(),ce=r.getTotalSubscriptionMessages(),Z=se+ce;n.utilization=Math.min(1,Z/1e5);const te=r.getAllQueueMetrics(),le=r.getAllSubscriptionMetrics(),ue=r.getActiveConnections();n.customMetrics={queue_depth:se,subscription_messages:ce,connections:ue,queues:c.queues?.length||0,topics:c.topics?.length||0},this.updateAzureServiceBusMetricsInConfig(e,te,le);return}const l=this.connections.filter(se=>se.target===e.id);let d=0;for(const se of l){const ce=this.connectionMetrics.get(se.id);if(ce){const te=ce.traffic/1024;d+=te}}const h=t.throughputMsgs||d||1e3,p=(Math.random()-.5)*.1;n.throughput=h*(1+p);const m=r.getTotalQueueDepth(),y=r.getTotalSubscriptionMessages(),b=m+y,S=5,C=Math.min(50,b/1e3),E=2;n.latency=S+C+E+Math.random()*5;const M=r.getAllQueueMetrics(),k=r.getAllSubscriptionMetrics(),T=r.getActiveConnections(),A=5e-4,N=Math.min(.01,b/1e6);let q=0;for(const se of M.values())q+=se.deadLetterMessageCount||0;for(const se of k.values())q+=se.deadLetterMessageCount||0;const O=q>0?Math.min(.05,q/1e4):0;n.errorRate=Math.min(1,A+N+O),n.utilization=Math.min(1,b/1e5);let H=0;const J=c.topics||[];for(const se of J)H+=(se.subscriptions||[]).length;n.customMetrics={queue_depth:m,subscription_messages:y,dead_letter_messages:q,connections:T,queues:c.queues?.length||0,topics:c.topics?.length||0,subscriptions:H},this.updateAzureServiceBusMetricsInConfig(e,M,k)}initializeAzureServiceBusRoutingEngine(e){const t=e.data.config||{},n=new cT,a=(t.queues||[]).map(c=>({name:c.name,namespace:c.namespace||t.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:c.maxSizeInMegabytes||1024,defaultMessageTimeToLive:c.defaultMessageTimeToLive||2592e3,lockDuration:c.lockDuration||30,maxDeliveryCount:c.maxDeliveryCount||10,enablePartitioning:c.enablePartitioning||!1,enableDeadLetteringOnMessageExpiration:c.enableDeadLetteringOnMessageExpiration!==void 0?c.enableDeadLetteringOnMessageExpiration:!0,enableSessions:c.enableSessions||!1,activeMessageCount:c.activeMessageCount||0,deadLetterMessageCount:c.deadLetterMessageCount||0,scheduledMessageCount:c.scheduledMessageCount||0})),r=(t.topics||[]).map(c=>({name:c.name,namespace:c.namespace||t.namespace||"archiphoenix.servicebus.windows.net",maxSizeInMegabytes:c.maxSizeInMegabytes||1024,defaultMessageTimeToLive:c.defaultMessageTimeToLive||2592e3,enablePartitioning:c.enablePartitioning||!1,subscriptions:(c.subscriptions||[]).map(l=>({name:l.name,maxDeliveryCount:l.maxDeliveryCount||10,lockDuration:l.lockDuration||30,enableDeadLetteringOnMessageExpiration:l.enableDeadLetteringOnMessageExpiration!==void 0?l.enableDeadLetteringOnMessageExpiration:!0,activeMessageCount:l.activeMessageCount||0}))}));n.initialize({queues:a,topics:r}),this.azureServiceBusRoutingEngines.set(e.id,n),this.lastAzureServiceBusUpdate.set(e.id,Date.now())}updateAzureServiceBusMetricsInConfig(e,t,n){const a=e.data.config||{},r=a.queues||[];for(let l=0;l<r.length;l++){const d=r[l],h=t.get(d.name);h&&(r[l]={...d,activeMessageCount:h.activeMessageCount,deadLetterMessageCount:h.deadLetterMessageCount,scheduledMessageCount:h.scheduledMessageCount})}a.queues=r;const c=a.topics||[];for(let l=0;l<c.length;l++){const d=c[l],h=d.subscriptions||[];for(let p=0;p<h.length;p++){const m=h[p],y=`${d.name}/subscriptions/${m.name}`,b=n.get(y);b&&(h[p]={...m,activeMessageCount:b.activeMessageCount})}c[l]={...d,subscriptions:h}}a.topics=c}simulatePubSub(e,t,n,a){this.pubSubRoutingEngines.has(e.id)||this.initializePubSubRoutingEngine(e);const r=this.pubSubRoutingEngines.get(e.id),c=e.data.config||{},l=c.topics||[],d=c.subscriptions||[];if(!a){n.throughput=0,n.latency=3,n.errorRate=0;const L=r.getTotalTopicMessages(),_=r.getTotalUnackedMessages(),P=L+_;n.utilization=Math.min(1,P/1e5);const W=r.getAllTopicMetrics(),he=r.getAllSubscriptionMetrics(),j=r.getActiveConnections();n.customMetrics={topic_messages:L,unacked_messages:_,connections:j,topics:l.length,subscriptions:d.length},this.updatePubSubMetricsInConfig(e,W,he);return}const h=this.connections.filter(L=>L.target===e.id);let p=0;for(const L of h){const _=this.connectionMetrics.get(L.id);if(_){const W=_.traffic/1024;p+=W}}const m=t.throughputMsgs||p||1e3,y=(Math.random()-.5)*.1;n.throughput=m*(1+y);const b=r.getTotalTopicMessages(),S=r.getTotalUnackedMessages(),C=b+S,E=3,M=Math.min(15,C/1e4),k=d.filter(L=>L.pushEndpoint).length,T=k>0?2:0,A=S>0?.5:0;n.latency=E+M+T+A+Math.random()*2;const N=r.getAllTopicMetrics(),q=r.getAllSubscriptionMetrics(),O=r.getActiveConnections(),H=1e-4,J=Math.min(.001,C/5e6),se=k>0&&S>0?Math.min(.002,S/1e5):0,ce=d.length>0?d.reduce((L,_)=>L+(_.ackDeadlineSeconds||10),0)/d.length:10,Z=S>0&&ce<60?Math.min(.005,S/1e5):0;n.errorRate=Math.min(1,H+J+se+Z);const te=Math.min(1,n.throughput/1e5),le=Math.min(.3,C/5e5);n.utilization=Math.min(1,te*.7+le*.3);const ue=d.length-k;n.customMetrics={topic_messages:b,unacked_messages:S,connections:O,topics:l.length,subscriptions:d.length,push_subscriptions:k,pull_subscriptions:ue,total_bytes:Array.from(N.values()).reduce((L,_)=>L+_.byteCount,0)},this.updatePubSubMetricsInConfig(e,N,q)}initializePubSubRoutingEngine(e){const t=e.data.config||{},n=new lT,a=(t.topics||[]).map(c=>({name:c.name,projectId:c.projectId||t.projectId||"archiphoenix-lab",messageRetentionDuration:c.messageRetentionDuration||604800,labels:c.labels||{},messageCount:c.messageCount||0,byteCount:c.byteCount||0})),r=(t.subscriptions||[]).map(c=>({name:c.name,topic:c.topic,projectId:c.projectId||t.projectId||"archiphoenix-lab",ackDeadlineSeconds:c.ackDeadlineSeconds||10,messageRetentionDuration:c.messageRetentionDuration,enableMessageOrdering:c.enableMessageOrdering||!1,pushEndpoint:c.pushEndpoint,pushAttributes:c.pushAttributes||{},messageCount:c.messageCount||0,unackedMessageCount:c.unackedMessageCount||0}));n.initialize({topics:a,subscriptions:r}),this.pubSubRoutingEngines.set(e.id,n),this.lastPubSubUpdate.set(e.id,Date.now())}updatePubSubMetricsInConfig(e,t,n){const a=e.data.config||{},r=a.topics||[];for(let l=0;l<r.length;l++){const d=r[l],h=t.get(d.name);h&&(r[l]={...d,messageCount:h.messageCount,byteCount:h.byteCount})}a.topics=r;const c=a.subscriptions||[];for(let l=0;l<c.length;l++){const d=c[l],h=n.get(d.name);h&&(c[l]={...d,messageCount:h.messageCount,unackedMessageCount:h.unackedMessageCount})}a.subscriptions=c}simulateSQS(e,t,n,a){this.sqsRoutingEngines.has(e.id)||this.initializeSQSRoutingEngine(e);const r=this.sqsRoutingEngines.get(e.id);if(e.data.config,!a){n.throughput=0,n.latency=5,n.errorRate=0;const M=r.getTotalQueueDepth();n.utilization=Math.min(1,M/1e5);const k=r.getAllQueueMetrics(),T=r.getActiveConnections();n.customMetrics={queue_depth:M,connections:T,queues:k.size},this.updateSQSQueueMetricsInConfig(e,k);return}const c=this.connections.filter(M=>M.target===e.id);let l=0;for(const M of c){const k=this.connectionMetrics.get(M.id);if(k){const A=k.traffic/1024;l+=A}}const d=t.throughputMsgs||l||1e3,h=(Math.random()-.5)*.1;n.throughput=d*(1+h);const p=r.getTotalQueueDepth(),m=5,y=Math.min(50,p/1e3);n.latency=m+y+Math.random()*5;const b=5e-4,S=Math.min(.01,p/1e6);n.errorRate=b+S,n.utilization=Math.min(1,p/1e5);const C=r.getAllQueueMetrics(),E=r.getActiveConnections();n.customMetrics={queue_depth:p,connections:E,queues:C.size},this.updateSQSQueueMetricsInConfig(e,C)}initializeSQSRoutingEngine(e){const t=e.data.config||{},n=new rT,a=(t.queues||[]).map(r=>({name:r.name,type:r.type||"standard",region:r.region||t.defaultRegion||"us-east-1",visibilityTimeout:r.visibilityTimeout||30,messageRetention:r.messageRetention||4,delaySeconds:r.delaySeconds||0,maxReceiveCount:r.maxReceiveCount,deadLetterQueue:r.deadLetterQueue,contentBasedDedup:r.contentBasedDedup,fifoThroughputLimit:r.fifoThroughputLimit||"perQueue"}));n.initialize({queues:a}),this.sqsRoutingEngines.set(e.id,n),this.lastSQSUpdate.set(e.id,Date.now())}updateSQSQueueMetricsInConfig(e,t){const n=e.data.config||{},a=n.queues||[];for(let r=0;r<a.length;r++){const c=a[r],l=t.get(c.name);l&&(a[r]={...c,approximateMessages:l.approximateMessages,approximateMessagesNotVisible:l.approximateMessagesNotVisible,approximateMessagesDelayed:l.approximateMessagesDelayed})}n.queues=a}simulateDatabase(e,t,n,a){if(!a){if(n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0,n.customMetrics={},e.type==="postgres"){const y=this.postgresConnectionPools.get(e.id);y&&y.reset()}return}const r=t.maxConnections||100,c=t.queryLatency||10;if(e.type==="postgres"){const y=this.postgresConnectionPools.get(e.id);if(y){const S=this.connections.filter(q=>q.target===e.id).reduce((q,O)=>{const H=this.metrics.get(O.source);return q+(H?.throughput||0)},0),E=Math.min(S,r*10)*this.updateInterval/1e3;for(let q=0;q<Math.floor(E);q++){const O=y.acquireConnection("SELECT");if(O){const H=c+Math.random()*20;setTimeout(()=>{y.releaseConnection(O,H)},H)}}const M=y.getMetrics();n.throughput=M.queriesPerSecond,n.latency=M.averageQueryTime||c,n.utilization=M.utilization,n.errorRate=M.waitingConnections>0?.01:.001;const T=e.data.config.tables||[];let A=0;for(const q of T)A+=(q.indexes||[]).length;A===0&&(A=5);const N=this.calculateCacheHitRatio(e,M.queriesPerSecond);n.customMetrics={active_connections:M.activeConnections,idle_connections:M.idleConnections,waiting_connections:M.waitingConnections,total_connections:M.totalConnections,max_connections:r,indexes:A,cache_hit_ratio:N,connection_wait_time:M.connectionWaitTime};return}}if(e.type==="redis"){this.redisRoutingEngines.has(e.id)||this.initializeRedisRoutingEngine(e);const y=this.redisRoutingEngines.get(e.id),b=e.data.config;b?.keys&&y.syncKeysFromConfig(b.keys);const S=y.getMetrics(),E=this.connections.filter(A=>A.target===e.id).reduce((A,N)=>{const q=this.metrics.get(N.source);return A+(q?.throughput||0)},0);n.throughput=Math.max(S.operationsPerSecond,E);const M=.5,k=S.memoryUsagePercent/100,T=Math.min(1,S.totalKeys/1e5);n.latency=M+k*2+T*1,n.errorRate=k>.95?.01:.001,n.utilization=S.memoryUsagePercent/100,n.customMetrics={total_keys:S.totalKeys,keys_string:S.keysByType.string,keys_hash:S.keysByType.hash,keys_list:S.keysByType.list,keys_set:S.keysByType.set,keys_zset:S.keysByType.zset,keys_stream:S.keysByType.stream,memory_usage:S.memoryUsage,memory_usage_percent:S.memoryUsagePercent,operations_per_second:S.operationsPerSecond,hit_count:S.hitCount,miss_count:S.missCount,hit_rate:S.hitRate,expired_keys:S.expiredKeys,evicted_keys:S.evictedKeys,connected_clients:S.connectedClients};return}if(e.type==="cassandra"){this.cassandraRoutingEngines.has(e.id)||this.initializeCassandraRoutingEngine(e);const y=this.cassandraRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({clusterName:b.clusterName,nodes:b.nodes,keyspaces:b.keyspaces,tables:b.tables,defaultConsistencyLevel:b.consistencyLevel,defaultReplicationFactor:b.replicationFactor});const S=y.getMetrics(),E=this.connections.filter(N=>N.target===e.id).reduce((N,q)=>{const O=this.metrics.get(q.source);return N+(O?.throughput||0)},0);n.throughput=Math.max(S.readOperationsPerSecond+S.writeOperationsPerSecond,E);const M=S.readOperationsPerSecond+S.writeOperationsPerSecond;if(M>0){const N=S.readOperationsPerSecond/M,q=S.writeOperationsPerSecond/M;n.latency=S.readLatency*N+S.writeLatency*q}else n.latency=(S.readLatency+S.writeLatency)/2;const k=S.readConsistencyViolations+S.writeConsistencyViolations;n.errorRate=Math.min(.1,k/Math.max(1,M))||.001;const T=S.totalNodes>0?(S.totalNodes-S.healthyNodes)/S.totalNodes:0,A=Math.min(1,S.pendingCompactions/100);n.utilization=Math.min(1,T*.7+A*.3),n.customMetrics={total_nodes:S.totalNodes,healthy_nodes:S.healthyNodes,total_keyspaces:S.totalKeyspaces,total_tables:S.totalTables,total_rows:S.totalRows,total_size_gb:S.totalSize/(1024*1024*1024),read_latency_ms:S.readLatency,write_latency_ms:S.writeLatency,read_ops_per_sec:S.readOperationsPerSecond,write_ops_per_sec:S.writeOperationsPerSecond,pending_compactions:S.pendingCompactions,read_consistency_violations:S.readConsistencyViolations,write_consistency_violations:S.writeConsistencyViolations,hinted_handoffs:S.hintedHandoffs};return}if(e.type==="clickhouse"){this.clickHouseRoutingEngines.has(e.id)||this.initializeClickHouseRoutingEngine(e);const y=this.clickHouseRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({cluster:b.cluster,replication:b.replication,tables:b.tables?.map(A=>({name:A.name,database:b.database||"default",engine:A.engine||"MergeTree",rows:A.rows||0,size:A.size||0,partitions:A.partitions||0,columns:A.columns||[]})),maxMemoryUsage:b.maxMemoryUsage,compression:b.compression});const S=y.getMetrics(),E=this.connections.filter(A=>A.target===e.id).reduce((A,N)=>{const q=this.metrics.get(N.source);return A+(q?.throughput||0)},0);n.throughput=Math.max(S.queriesPerSecond,E),n.latency=S.avgQueryTime;const M=S.memoryUsagePercent/100;n.errorRate=M>.95?.01:.001;const k=Math.min(1,S.activeQueries/10),T=M;n.utilization=Math.max(k,T),n.customMetrics={total_tables:S.totalTables,total_rows:S.totalRows,total_size_gb:S.totalSize/(1024*1024*1024),queries_per_sec:S.queriesPerSecond,read_rows_per_sec:S.readRowsPerSecond,written_rows_per_sec:S.writtenRowsPerSecond,avg_query_time_ms:S.avgQueryTime,active_queries:S.activeQueries,memory_usage_bytes:S.memoryUsage,memory_usage_percent:S.memoryUsagePercent,parts_count:S.partsCount,pending_merges:S.pendingMerges,compression_ratio:S.compressionRatio,cluster_nodes:S.clusterNodes,healthy_nodes:S.healthyNodes};return}if(e.type==="snowflake"){this.snowflakeRoutingEngines.has(e.id)||this.initializeSnowflakeRoutingEngine(e);const y=this.snowflakeRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({account:b.account,region:b.region,warehouses:b.warehouses,databases:b.databases,role:b.role,enableAutoSuspend:b.enableAutoSuspend,autoSuspendSeconds:b.autoSuspendSeconds,enableAutoResume:b.enableAutoResume});const S=y.getMetrics(),E=this.connections.filter(M=>M.target===e.id).reduce((M,k)=>{const T=this.metrics.get(k.source);return M+(T?.throughput||0)},0);n.throughput=Math.max(S.queriesPerSecond,E),n.latency=S.avgQueryTime,n.errorRate=.001,n.utilization=S.warehouseUtilization,n.customMetrics={total_warehouses:S.totalWarehouses,running_warehouses:S.runningWarehouses,suspended_warehouses:S.suspendedWarehouses,total_queries:S.totalQueries,running_queries:S.runningQueries,queued_queries:S.queuedQueries,queries_per_sec:S.queriesPerSecond,avg_query_time_ms:S.avgQueryTime,total_compute_time_sec:S.totalComputeTime,total_data_read:S.totalDataRead,total_data_written:S.totalDataWritten,cache_hit_rate:S.cacheHitRate,warehouse_utilization:S.warehouseUtilization,total_cost_credits:S.totalCost};return}if(e.type==="elasticsearch"){this.elasticsearchRoutingEngines.has(e.id)||this.initializeElasticsearchRoutingEngine(e);const y=this.elasticsearchRoutingEngines.get(e.id),b=e.data.config;b&&y.syncFromConfig({clusterName:b.clusterName,nodes:b.nodes,indices:b.indices,defaultShards:b.shards,defaultReplicas:b.replicas,refreshInterval:b.refreshInterval});const S=y.getMetrics(),E=this.connections.filter(N=>N.target===e.id).reduce((N,q)=>{const O=this.metrics.get(q.source);return N+(O?.throughput||0)},0);n.throughput=Math.max(S.indexOperationsPerSecond+S.searchOperationsPerSecond,E);const M=S.indexOperationsPerSecond+S.searchOperationsPerSecond;if(M>0){const N=S.indexOperationsPerSecond/M,q=S.searchOperationsPerSecond/M;n.latency=S.averageIndexLatency*N+S.averageSearchLatency*q}else n.latency=S.averageSearchLatency||10;const k=S.clusterHealth==="red"?.01:S.clusterHealth==="yellow"?.002:.001;n.errorRate=k;const T=S.unassignedShards>0?1:S.relocatingShards>0?.7:S.initializingShards>0?.5:.3,A=S.healthyNodes/S.totalNodes;n.utilization=Math.max(T,1-A),this.updateElasticsearchMetricsInConfig(e,S),n.customMetrics={cluster_health:S.clusterHealth==="green"?1:S.clusterHealth==="yellow"?.5:0,total_nodes:S.totalNodes,healthy_nodes:S.healthyNodes,total_indices:S.totalIndices,total_docs:S.totalDocs,total_size_gb:S.totalSize/(1024*1024*1024),active_shards:S.activeShards,relocating_shards:S.relocatingShards,initializing_shards:S.initializingShards,unassigned_shards:S.unassignedShards,index_ops_per_sec:S.indexOperationsPerSecond,search_ops_per_sec:S.searchOperationsPerSecond,avg_index_latency_ms:S.averageIndexLatency,avg_search_latency_ms:S.averageSearchLatency,avg_get_latency_ms:S.averageGetLatency};return}if(e.type==="s3-datalake"){this.s3RoutingEngines.has(e.id)||this.initializeS3RoutingEngine(e);const y=this.s3RoutingEngines.get(e.id);if(y.processLifecycleTransitions(),!a){n.throughput=0,n.latency=50,n.errorRate=0;const Z=y.getAllBucketMetrics(),te=y.getTotalStorageSize(),le=y.getTotalObjectCount(),ue=1024*1024*1024*1024,L=Z.size,_=ue*L;n.utilization=_>0?Math.min(1,te/_):0,n.customMetrics={buckets:L,total_objects:le,total_size:te,total_size_mb:Math.round(te/(1024*1024)*100)/100},this.updateS3BucketMetricsInConfig(e,Z);return}const b=this.connections.filter(Z=>Z.target===e.id);let S=0,C=0;for(const Z of b){const te=this.connectionMetrics.get(Z.id);te&&(S+=te.traffic/1024,C+=te.traffic)}const E=1024*1024,M=C>0?C/E:0;n.throughput=Math.max(0,M),n.latency=50+(M>100?(M-100)*.1:0),n.errorRate=.001;const k=y.getAllBucketMetrics(),T=y.getTotalStorageSize(),A=y.getTotalObjectCount(),N=k.size,O=1024*1024*1024*1024*N,H=O>0?Math.min(1,T/O):0,se=3500*N,ce=se>0?Math.min(1,M/se):0;n.utilization=Math.max(H,ce),n.customMetrics={buckets:N,total_objects:A,total_size:T,total_size_mb:Math.round(T/(1024*1024)*100)/100,total_size_gb:Math.round(T/(1024*1024*1024)*100)/100,estimated_ops_per_sec:Math.round(M*100)/100,storage_utilization:Math.round(H*1e3)/10,ops_utilization:Math.round(ce*1e3)/10},this.updateS3BucketMetricsInConfig(e,k);return}let l=t.indexCount||5;e.type==="mongodb"&&(l=(e.data.config?.collections||[]).reduce((S,C)=>S+(C.indexes?.length||0),0),l===0&&(l=1));const h=this.connections.filter(y=>y.target===e.id).reduce((y,b)=>{const S=this.metrics.get(b.source);return y+(S?.throughput||0)},0),p=Math.min(r,Math.floor(h/10)||Math.floor(r*.3));n.throughput=p*(1e3/(c+Math.random()*20));const m=Math.min(.3,l*.02);if(n.latency=c+p/r*50*(1-m),n.errorRate=.001,n.utilization=p/r,n.customMetrics={active_connections:p,max_connections:r,indexes:l,cache_hit_ratio:Math.random()*.8+.2},e.type==="mongodb"){const y=e.data.config,b=y?.collections||[],S=b.filter(T=>T.validation&&T.validation.validationLevel!=="off").length;if(S>0){const T=Math.min(.05,S*.01);n.errorRate=Math.max(n.errorRate,T)}const C=y?.enableReplicaSet||!1,E=y?.replicaSetMembers||[];if(C&&E.length>1){const T=E.length,A=Math.min(.3,(T-1)*.1);n.errorRate=Math.max(0,n.errorRate*(1-A)),n.latency=n.latency*(1+.05*(T-1))}const M=y?.enableSharding||!1,k=y?.shardConfig;if(M&&k?.shards){const T=k.shards.length,A=1+(T-1)*.3;n.throughput=n.throughput*A,n.latency=n.latency*(1+.02*(T-1))}n.customMetrics={...n.customMetrics,collections:b.length,collections_with_validation:S,total_documents:b.reduce((T,A)=>T+(A.documentCount||0),0),replica_set_enabled:C,replica_members:C?E.length:0,sharding_enabled:M,shard_count:M&&k?.shards?.length||0}}}simulateNginx(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=t.workerThreads||4,c=t.requestsPerSecond||1e4,l=.5*Math.sin(this.simulationTime/2e3)+.5;n.throughput=c*l,n.latency=1+(1-l)*4,n.errorRate=1e-5,n.utilization=Math.min(1,n.throughput/c*(r/4)),n.customMetrics={worker_threads:r,active_connections:Math.floor(n.throughput*.1),cache_hits:Math.floor(Math.random()*1e4),cache_misses:Math.floor(Math.random()*1e3)}}simulateInfrastructure(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=t.workerThreads||1;n.throughput=100*r+Math.random()*50,n.latency=50+Math.random()*100,n.errorRate=1e-4,n.utilization=Math.random()*.8,n.customMetrics={replicas:r,cpu_percent:Math.random()*80,memory_percent:Math.random()*70}}simulateAPI(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=t.requestsPerSecond||100,c=t.responseLatency||50,l=Math.sin(this.simulationTime/1500)*.1+1;n.throughput=r*l,n.latency=c+Math.random()*30,n.errorRate=.005,n.utilization=n.throughput/r*Math.random(),n.customMetrics={rps:r,p50_latency:Math.round(c*.5),p99_latency:Math.round(c*2),errors:Math.round(n.throughput*n.errorRate)}}simulateKong(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=this.kongRoutingEngines.get(e.id);if(!r){this.simulateAPI(e,t,n,a);return}const c=t||{},l=c.requestsPerSecond||t.requestsPerSecond||450,d=r.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=l*h;const m=(c.plugins||[]).filter(M=>M.name==="rate-limiting"&&M.enabled);if(m.length>0){const M=Math.min(...m.map(k=>k.config?.minute||1e3));p=Math.min(p,M*h)}n.throughput=p;const y=2+Math.random()*3,b=d.plugins*.5,S=10+Math.random()*40;n.latency=y+b+S;const C=.001,E=d.consumers>0?.02:0;n.errorRate=Math.min(1,C+E),n.utilization=Math.min(1,n.throughput/l),n.customMetrics={services:d.services,routes:d.routes,upstreams:d.upstreams,consumers:d.consumers,plugins:d.plugins,requests_per_second:l,gateway_latency:y+b,upstream_latency:S}}simulateApigee(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=this.apigeeRoutingEngines.get(e.id);if(!r){this.simulateAPI(e,t,n,a);return}const c=t||{},l=c.proxies||[],d=c.requestsPerSecond||t.requestsPerSecond||500,h=r.getStats(),p=.5*Math.sin(this.simulationTime/2e3)+.5;let m=d*p;const y=l.filter(T=>T.status!=="undeployed");if(y.length>0){const T=y.filter(N=>N.quota&&N.quotaInterval).map(N=>N.quota/N.quotaInterval*p);if(T.length>0){const N=Math.min(...T);m=Math.min(m,N)}const A=y.filter(N=>N.spikeArrest&&N.spikeArrest>0).map(N=>N.spikeArrest);if(A.length>0){const N=Math.min(...A);m=Math.min(m,N*p)}}n.throughput=m;const b=3+Math.random()*2,S=h.policies*.8,C=15+Math.random()*35;n.latency=b+S+C;const E=.001,M=h.policies>0?.015:0,k=h.totalErrors>0?h.totalErrors/Math.max(h.totalRequests,1)*.1:0;n.errorRate=Math.min(1,E+M+k),n.utilization=Math.min(1,n.throughput/d),n.customMetrics={proxies:h.proxies,policies:h.policies,total_requests:h.totalRequests,total_errors:h.totalErrors,avg_latency:Math.round(h.avgLatency),requests_per_second:d,gateway_latency:b+S,upstream_latency:C}}simulateMuleSoft(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=this.mulesoftRoutingEngines.get(e.id);if(!r){this.simulateAPI(e,t,n,a);return}const l=(t||{}).applications||[],d=r.getStats(),h=.5*Math.sin(this.simulationTime/2e3)+.5;let p=0,m=0;for(const N of l)if(N.status==="running"){const q=N.workerCount||2;m+=q,p+=q*75}p===0&&(p=100);let y=p*h;n.throughput=y;const b=5+Math.random()*10,S=d.enabledConnectors*2,C=3+Math.random()*5,E=15+Math.random()*25;n.latency=b+S+C+E;const M=.002,k=d.totalErrors>0?d.totalErrors/Math.max(d.totalRequests,1)*.15:0,T=d.runningApplications>0?.005:.01;n.errorRate=Math.min(1,M+k+T);const A=m>0?Math.min(1,n.throughput/(m*75)):.5;n.utilization=Math.min(1,A),n.customMetrics={applications:d.applications,running_applications:d.runningApplications,connectors:d.connectors,enabled_connectors:d.enabledConnectors,total_requests:d.totalRequests,total_errors:d.totalErrors,avg_latency:Math.round(d.avgLatency),total_workers:m,runtime_latency:b,connector_latency:E,transformation_latency:C}}simulateGrafana(e,t,n,a){const r=this.grafanaEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.getGrafanaMetrics(),l=r.calculateLoad();n.throughput=l.queriesPerSecond+l.alertEvaluationsPerSecond,n.latency=l.averageQueryLatency+l.averageRenderingLatency,n.errorRate=l.errorRate,n.utilization=(l.cpuUtilization+l.memoryUtilization)/2,n.customMetrics={queries_per_second:l.queriesPerSecond,dashboard_refreshes_per_second:l.dashboardRefreshesPerSecond,alert_evaluations_per_second:l.alertEvaluationsPerSecond,average_query_latency:l.averageQueryLatency,average_rendering_latency:l.averageRenderingLatency,datasource_errors:c.datasourceErrors,active_dashboards:c.activeDashboards,active_panels:c.activePanels,total_queries:c.totalQueries,cpu_utilization:l.cpuUtilization,memory_utilization:l.memoryUtilization}}simulateKeycloak(e,t,n,a){const r=this.keycloakEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.calculateLoad(),l=r.getMetrics(),d=r.getConfig();n.throughput=c.requestsPerSecond,n.latency=c.averageLatency,n.errorRate=c.errorRate;const h=Math.min(.6,(c.activeSessions||0)/500),p=Math.min(.3,c.requestsPerSecond/200),m=d?.passwordPolicy?this.estimateKeycloakPolicyComplexity(d.passwordPolicy):0,y=Math.min(.2,m/100);n.utilization=Math.min(.95,.1+h+p+y),n.customMetrics={...n.customMetrics||{},keycloak_login_requests_total:l.loginRequestsTotal,keycloak_login_errors_total:l.loginErrorsTotal,keycloak_token_refresh_total:l.tokenRefreshTotal,keycloak_introspection_requests_total:l.introspectionRequestsTotal,keycloak_userinfo_requests_total:l.userInfoRequestsTotal,keycloak_sessions_active:l.activeSessions,keycloak_sessions_created_total:l.sessionsCreatedTotal,keycloak_sessions_expired_total:l.sessionsExpiredTotal,keycloak_auth_success_rate:c.authSuccessRate,keycloak_clients_configured:d?.clients.length??0,keycloak_users_configured:d?.users.length??0}}simulateVault(e,t,n,a){const r=this.vaultEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.calculateLoad(),l=r.getMetrics();r.getConfig(),n.throughput=c.requestsPerSecond,n.latency=c.averageLatency,n.errorRate=c.errorRate;const d=Math.min(.4,(c.secretsCount||0)/1e3),h=Math.min(.3,(c.activeTokens||0)/500),p=Math.min(.2,c.requestsPerSecond/300),m=Math.min(.1,(c.enginesEnabled||0)/10);n.utilization=Math.min(.95,.1+d+h+p+m),n.customMetrics={...n.customMetrics||{},vault_read_requests_total:l.readRequestsTotal,vault_write_requests_total:l.writeRequestsTotal,vault_delete_requests_total:l.deleteRequestsTotal,vault_list_requests_total:l.listRequestsTotal,vault_auth_requests_total:l.authRequestsTotal,vault_auth_errors_total:l.authErrorsTotal,vault_token_issued_total:l.tokenIssuedTotal,vault_token_renewed_total:l.tokenRenewedTotal,vault_token_revoked_total:l.tokenRevokedTotal,vault_tokens_active:l.activeTokens,vault_secrets_total:l.secretsTotal,vault_encryption_operations_total:l.encryptionOperationsTotal,vault_decryption_operations_total:l.decryptionOperationsTotal,vault_engines_enabled:c.enginesEnabled}}estimateKeycloakPolicyComplexity(e){if(!e)return 0;let t=0;const n=e.toLowerCase();n.includes("length(")&&(t+=20),n.includes("digits(")&&(t+=25),n.includes("special(")&&(t+=30),n.includes("uppercase(")&&(t+=15),n.includes("lowercase(")&&(t+=10);const a=(e.match(/\)/g)||[]).length;return t+=a*5,t}simulatePrometheus(e,t,n,a){const r=this.prometheusEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.getPrometheusMetrics(),l=r.calculateLoad();n.throughput=l.scrapeRequestsPerSecond,n.latency=l.averageScrapeDuration,n.errorRate=l.errorRate;const d=r.getTargetStatuses().length,h=Math.min(.95,.1+d/100*.5+l.scrapeRequestsPerSecond/10*.2);n.utilization=h,n.customMetrics={scrape_requests_total:c.scrapeRequestsTotal,scrape_errors_total:c.scrapeErrorsTotal,targets_up:c.targetsUp,targets_down:c.targetsDown,samples_scraped:c.samplesScraped,scrape_requests_per_second:l.scrapeRequestsPerSecond,samples_per_second:l.samplesPerSecond}}simulateWAF(e,t,n,a){const r=this.wafEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.calculateLoad(),l=r.getMetrics();r.getStats(),n.throughput=c.requestsPerSecond,n.latency=c.averageLatency;const d=r.getConfig();d?.mode==="prevention"?n.errorRate=c.blockRate:n.errorRate=0;const h=Math.min(.4,(l.activeRules||0)/50),p=Math.min(.3,c.requestsPerSecond/1e3),m=d?.enableOWASP?.15:0,y=d?.enableRateLimiting?.1:0,b=d?.enableGeoBlocking?.05:0;if(n.utilization=Math.min(.95,.1+h+p+m+y+b),n.customMetrics={...n.customMetrics||{},waf_requests_total:l.requestsTotal,waf_requests_allowed:l.requestsAllowed,waf_requests_blocked:l.requestsBlocked,waf_threats_detected:l.threatsDetected,waf_threats_blocked:l.threatsBlocked,waf_rate_limit_hits:l.rateLimitHits,waf_geo_block_hits:l.geoBlockHits,waf_ip_block_hits:l.ipBlockHits,waf_owasp_hits:l.owaspHits,waf_custom_rule_hits:l.customRuleHits,waf_active_rules:l.activeRules,waf_block_rate:c.blockRate,waf_threat_detection_rate:c.threatDetectionRate,waf_average_latency:c.averageLatency},a){const S=this.connections.filter(E=>E.target===e.id);let C=0;for(const E of S){const M=this.metrics.get(E.source);M&&(C+=M.throughput||0)}C>0&&(r.setSimulatedRequestRate(C),r.simulateRequests(C))}}simulateFirewall(e,t,n,a){const r=this.firewallEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.calculateLoad(),l=r.getMetrics();r.getStats(),n.throughput=c.packetsPerSecond,n.latency=c.averageLatency,n.errorRate=c.blockRate+c.rejectionRate;const d=Math.min(.3,(l.activeRules||0)/100),h=Math.min(.3,c.packetsPerSecond/1e4),p=r.getConfig()?.enableStatefulInspection?.2:0,m=r.getConfig()?.enableIntrusionDetection?.2:0;if(n.utilization=Math.min(.95,.1+d+h+p+m),n.customMetrics={...n.customMetrics||{},firewall_packets_total:l.packetsTotal,firewall_packets_allowed:l.packetsAllowed,firewall_packets_blocked:l.packetsBlocked,firewall_packets_rejected:l.packetsRejected,firewall_active_rules:l.activeRules,firewall_total_connections:l.totalConnections,firewall_active_connections:l.activeConnections,firewall_block_rate:c.blockRate,firewall_rejection_rate:c.rejectionRate,firewall_average_latency:c.averageLatency},a){const y=this.connections.filter(S=>S.target===e.id);let b=0;for(const S of y){const C=this.metrics.get(S.source);C&&(b+=C.throughput||0)}b>0&&(r.setSimulatedPacketRate(b),r.simulatePackets(b))}r.cleanup()}simulateIDSIPS(e,t,n,a){const r=this.idsIpsEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.calculateLoad(),l=r.getMetrics();r.getStats(),n.throughput=c.packetsPerSecond,n.latency=c.averageLatency;const d=r.getConfig();d?.mode==="ips"?n.errorRate=c.blockRate:n.errorRate=0;const h=Math.min(.3,(l.activeSignatures||0)/100),p=Math.min(.3,c.packetsPerSecond/1e4),m=d?.enableSignatureDetection?.15:0,y=d?.enableAnomalyDetection?.15:0,b=d?.enableBehavioralAnalysis?.1:0;if(n.utilization=Math.min(.95,.1+h+p+m+y+b),n.customMetrics={...n.customMetrics||{},idsips_packets_total:l.packetsTotal,idsips_packets_analyzed:l.packetsAnalyzed,idsips_alerts_generated:l.alertsGenerated,idsips_alerts_blocked:l.alertsBlocked,idsips_signature_matches:l.signatureMatches,idsips_anomaly_detections:l.anomalyDetections,idsips_behavioral_detections:l.behavioralDetections,idsips_active_signatures:l.activeSignatures,idsips_blocked_ips:l.blockedIPs,idsips_alert_rate:c.alertRate,idsips_block_rate:c.blockRate},this.updateLatencyPercentiles(e.id,n.latency,n),!a){const S=this.connections.filter(E=>E.target===e.id);let C=0;for(const E of S){const M=this.metrics.get(E.source);M&&(C+=M.throughput||0)}C>0&&(r.setSimulatedPacketRate(C),r.simulatePackets(C))}}simulatePagerDuty(e,t,n,a){const r=this.pagerDutyEngines.get(e.id);if(!r){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=.1;return}const c=r.calculateLoad(),l=r.getMetrics();n.throughput=c.throughput,n.latency=c.latency,n.errorRate=c.errorRate,n.utilization=c.utilization,n.customMetrics={incidents_total:l.incidentsTotal,incidents_active:l.incidentsActive,incidents_resolved:l.incidentsResolved,notifications_sent:l.notificationsSent,escalations_triggered:l.escalationsTriggered,acknowledgements:l.acknowledgements,average_ack_latency_ms:l.averageAckLatency,average_resolve_latency_ms:l.averageResolveLatency,api_requests_per_second:l.apiRequestsPerSecond,webhooks_per_second:l.webhooksPerSecond,cpu_utilization:l.cpuUtilization,memory_utilization:l.memoryUtilization}}simulateLoki(e,t,n,a){if(!this.lokiEngines.has(e.id)){const m=new LT;m.initializeConfig(e),this.lokiEngines.set(e.id,m)}const r=this.lokiEngines.get(e.id);a&&this.processLokiIngestion(e,r);const c=r.getLokiMetrics(),l=r.calculateLoad();n.throughput=l.ingestionLinesPerSecond+l.queriesPerSecond;const d=l.ingestionLinesPerSecond/(l.ingestionLinesPerSecond+l.queriesPerSecond||1),h=1-d;n.latency=l.averageIngestionLatency*d+l.averageQueryLatency*h,n.errorRate=l.ingestionErrorRate*d+l.queryErrorRate*h;const p=Math.min(1,l.streamCount/(t.maxStreams||1e4));n.utilization=Math.max(l.storageUtilization,p),n.customMetrics={ingestion_lines_per_second:l.ingestionLinesPerSecond,ingestion_bytes_per_second:l.ingestionBytesPerSecond,ingestion_requests_total:c.ingestionRequestsTotal,ingestion_errors_total:c.ingestionErrorsTotal,ingestion_lines_total:c.ingestionLinesTotal,ingestion_bytes_total:c.ingestionBytesTotal,queries_per_second:l.queriesPerSecond,query_requests_total:c.queryRequestsTotal,query_errors_total:c.queryErrorsTotal,average_query_latency:l.averageQueryLatency,average_ingestion_latency:l.averageIngestionLatency,active_streams:l.streamCount,total_storage_size:c.totalStorageSize,storage_utilization:l.storageUtilization,retention_deletions:c.retentionDeletions}}processLokiIngestion(e,t){const n=this.connections.filter(a=>a.target===e.id);for(const a of n){const r=this.nodes.find(p=>p.id===a.source);if(!r)continue;const c=this.connectionMetrics.get(a.id);if(!c||c.traffic===0)continue;const d=c.traffic/200,h=this.generateLogsFromComponent(r,d);h.length>0&&t.processIngestion(h,r.id)}}generateLogsFromComponent(e,t){const n=[],a=e.type,r=e.data.label||e.id,c={app:r.toLowerCase().replace(/\s+/g,"-"),component:a,source:e.id.slice(0,8)},l=this.metrics.get(e.id),d=Math.ceil(t/100),h=Math.floor(t/d)||1;for(let p=0;p<d&&p<10;p++){const m=[];for(let y=0;y<h;y++){const b=Date.now()*1e6+y,S=this.getLogLevel(l),C=this.generateLogMessage(a,r,S,l);m.push([b.toString(),C])}m.length>0&&n.push({stream:{...c,level:this.getLogLevel(l)},values:m})}return n}getLogLevel(e){return e?e.errorRate>.1?"error":e.errorRate>.05||e.utilization>.9?"warn":"info":"info"}generateLogMessage(e,t,n,a){const r=new Date().toISOString();return n==="error"&&a?`[${r}] ERROR ${e}: Request failed, error rate: ${(a.errorRate*100).toFixed(2)}%`:n==="warn"&&a?`[${r}] WARN ${e}: High utilization: ${(a.utilization*100).toFixed(2)}%`:`[${r}] INFO ${e}: ${t} processing requests, throughput: ${a?.throughput.toFixed(2)||0}/s`}simulateBFF(e,t,n,a){if(!a){n.throughput=0,n.latency=0,n.errorRate=0,n.utilization=0;return}const r=this.bffRoutingEngines.get(e.id);if(!r){this.simulateAPI(e,t,n,a);return}const c=t||{},l=c.endpoints||[],d=c.backends||[],h=this.connections.filter(J=>J.target===e.id);let p=0;for(const J of h){const se=this.connectionMetrics.get(J.id);if(se){const Z=se.traffic/2048;p+=Z}}const m=t.requestsPerSecond||p||100,y=r.getStats(),b=.3*Math.sin(this.simulationTime/2e3)+.7;n.throughput=m*b;let S=y.averageLatency||100;const C=5+Math.random()*10,E=y.cacheHitRate||0,M=E*.8,k=S*(1-M)+C;n.latency=k+Math.random()*20;const T=y.totalRequests>0?y.totalErrors/y.totalRequests:.005,A=.001;n.errorRate=Math.min(1,T+A);const N=c.maxConcurrentRequests||100,q=n.throughput*(n.latency/1e3);n.utilization=Math.min(1,q/N);const O=l.reduce((J,se)=>J+(se.requests||0),0),H=d.filter(J=>J.status==="connected").length;n.customMetrics={endpoints:l.length,backends:d.length,connected_backends:H,total_requests:y.totalRequests,total_errors:y.totalErrors,avg_latency:Math.round(y.averageLatency),cache_hit_rate:Math.round(E*100)/100,endpoint_requests:O,aggregation_overhead:Math.round(C),concurrent_requests:Math.round(q)}}initializeKongRoutingEngine(e){const t=e.data.config||{},n=new uT;n.initialize({services:t.services||[],routes:t.routes||[],upstreams:t.upstreams||[],consumers:t.consumers||[],plugins:t.plugins||[]}),this.kongRoutingEngines.set(e.id,n)}initializeApigeeRoutingEngine(e){const t=e.data.config||{},n=new dT;n.initialize({organization:t.organization,environment:t.environment,proxies:t.proxies||[],policies:t.policies||[]}),this.apigeeRoutingEngines.set(e.id,n)}initializeMuleSoftRoutingEngine(e){const t=e.data.config||{},n=new fT,a=(t.applications||[]).map(c=>({name:c.name,runtimeVersion:c.runtimeVersion||"4.6.0",workerCount:c.workerCount||2,status:c.status||"stopped",connectors:c.connectors||[],errorStrategy:c.errorStrategy||"continue",reconnectionStrategy:c.reconnectionStrategy||"exponential",auditLogging:c.auditLogging||!1,flows:c.flows||[]})),r=(t.connectors||[]).map(c=>({name:c.name,type:c.type||"api",enabled:c.enabled!==!1,config:c.config||{},targetComponentType:c.targetComponentType,targetComponentId:c.targetComponentId}));n.initialize({organization:t.organization,environment:t.environment,applications:a,connectors:r}),this.mulesoftRoutingEngines.set(e.id,n)}initializeGraphQLGatewayRoutingEngine(e){const t=e.data.config||{},n=new wT;n.initialize({services:t.services||[],federation:t.federation,cacheTtl:t.cacheTtl,persistQueries:t.persistQueries,subscriptions:t.subscriptions,enableIntrospection:t.enableIntrospection,enableQueryComplexityAnalysis:t.enableQueryComplexityAnalysis,enableRateLimiting:t.enableRateLimiting,maxQueryDepth:t.maxQueryDepth,maxQueryComplexity:t.maxQueryComplexity,endpoint:t.endpoint}),this.graphQLGatewayRoutingEngines.set(e.id,n),this.lastGraphQLGatewayUpdate.set(e.id,Date.now())}initializeBFFRoutingEngine(e){const t=e.data.config||{},n=new ST;let a=null,r="";if(t.cacheMode==="redis"){const c=this.connections.find(l=>(l.source===e.id||l.target===e.id)&&this.nodes.find(d=>d.id===(l.source===e.id?l.target:l.source))?.type==="redis");if(c){const l=this.nodes.find(d=>d.id===(c.source===e.id?c.target:c.source));l&&l.type==="redis"&&(this.redisRoutingEngines.has(l.id)||this.initializeRedisRoutingEngine(l),a=this.redisRoutingEngines.get(l.id),r=l.id)}}n.initialize({backends:t.backends||[],endpoints:t.endpoints||[],enableCaching:t.enableCaching??!0,enableRequestBatching:t.enableRequestBatching??!1,enableResponseCompression:t.enableResponseCompression??!0,defaultTimeout:t.defaultTimeout||5e3,maxConcurrentRequests:t.maxConcurrentRequests||100,cacheMode:t.cacheMode||"memory",cacheTtl:t.cacheTtl||5,fallbackEnabled:t.fallbackEnabled??!0,fallbackComponent:t.fallbackComponent,redisEngine:a||void 0,redisNodeId:r||void 0}),this.bffRoutingEngines.set(e.id,n)}initializeWebhookRelayRoutingEngine(e){const t=e.data.config||{},n=new CT;n.initialize({relays:t.relays||[],enableRetryOnFailure:t.enableRetryOnFailure??!0,enableSignatureVerification:t.enableSignatureVerification??!0,enableRequestLogging:t.enableRequestLogging??!0,maxRetryAttempts:t.maxRetryAttempts||3,retryDelay:t.retryDelay||5,timeout:t.timeout||30}),this.webhookRelayRoutingEngines.set(e.id,n)}initializeRedisRoutingEngine(e){const t=e.data.config||{},n=new MT;n.initialize({host:t.host||"localhost",port:t.port||6379,password:t.password||"",database:t.database||0,maxMemory:t.maxMemory||"256mb",maxMemoryPolicy:t.maxMemoryPolicy||"noeviction",enablePersistence:t.enablePersistence??!0,persistenceType:t.persistenceType||"rdb",enableCluster:t.enableCluster??!1,clusterNodes:t.clusterNodes||[],keys:t.keys||[]}),this.redisRoutingEngines.set(e.id,n)}initializeCassandraRoutingEngine(e){const t=e.data.config||{},n=new ET;n.initialize({clusterName:t.clusterName||"archiphoenix-cluster",nodes:t.nodes||[],keyspaces:t.keyspaces||[],tables:t.tables||[],defaultConsistencyLevel:t.consistencyLevel||"QUORUM",defaultReplicationFactor:t.replicationFactor||3,datacenter:t.datacenter||"dc1"}),this.cassandraRoutingEngines.set(e.id,n)}initializeClickHouseRoutingEngine(e){const t=e.data.config||{},n=new RT;n.initialize({cluster:t.cluster||"archiphoenix-cluster",replication:t.replication||!1,tables:t.tables?.map(a=>({name:a.name,database:t.database||"default",engine:a.engine||"MergeTree",rows:a.rows||0,size:a.size||0,partitions:a.partitions||0,columns:a.columns||[]}))||[],maxMemoryUsage:t.maxMemoryUsage||10*1024*1024*1024,compression:t.compression||"LZ4"}),this.clickHouseRoutingEngines.set(e.id,n)}initializeSnowflakeRoutingEngine(e){const t=e.data.config||{},n=new TT;n.initialize({account:t.account||"archiphoenix",region:t.region||"us-east-1",warehouses:t.warehouses?.map(a=>({name:a.name,size:a.size||"Small",status:a.status||"suspended",autoSuspend:a.autoSuspend||(t.enableAutoSuspend?t.autoSuspendSeconds:void 0),autoResume:a.autoResume!==void 0?a.autoResume:t.enableAutoResume!==!1,minClusterCount:a.minClusterCount||1,maxClusterCount:a.maxClusterCount||1,currentClusterCount:a.minClusterCount||1,runningQueries:0,queuedQueries:0,totalQueriesExecuted:0,totalComputeTime:0}))||[],databases:t.databases?.map(a=>({name:a.name,comment:a.comment,retentionTime:a.retentionTime,size:a.size,schemas:a.schemas?.map(r=>({name:r.name,tables:r.tables||[],views:r.views||0,functions:r.functions||0}))||[]}))||[],role:t.role||"ACCOUNTADMIN",enableAutoSuspend:t.enableAutoSuspend,autoSuspendSeconds:t.autoSuspendSeconds,enableAutoResume:t.enableAutoResume}),this.snowflakeRoutingEngines.set(e.id,n)}initializeElasticsearchRoutingEngine(e){const t=e.data.config||{},n=new kT;n.initialize({clusterName:t.clusterName||"archiphoenix-cluster",nodes:t.nodes||["localhost:9200"],indices:t.indices||[],defaultShards:t.shards||5,defaultReplicas:t.replicas||1,refreshInterval:t.refreshInterval||"1s",enableSSL:t.enableSSL??!1,enableAuth:t.enableAuth??!1,username:t.username||"elastic",password:t.password||""}),this.elasticsearchRoutingEngines.set(e.id,n)}initializeS3RoutingEngine(e){const t=e.data.config||{},n=new AT,a=(t.buckets||[]).map(r=>({name:r.name,region:r.region||t.defaultRegion||"us-east-1",versioning:r.versioning||!1,encryption:r.encryption||"AES256",lifecycleEnabled:r.lifecycleEnabled||!1,lifecycleDays:r.lifecycleDays,glacierEnabled:r.glacierEnabled||!1,glacierDays:r.glacierDays,publicAccess:r.publicAccess||!1,lifecycleRules:t.lifecycleRules||[]}));n.initialize({buckets:a,defaultRegion:t.defaultRegion||"us-east-1"}),this.s3RoutingEngines.set(e.id,n)}initializePrometheusEngine(e){const t=new _T;t.initializeConfig(e),this.prometheusEngines.set(e.id,t)}initializeGrafanaEngine(e){const t=new jT;t.initializeConfig(e),this.grafanaEngines.set(e.id,t)}initializeJaegerEngine(e){const t=new zT;t.initializeConfig(e),this.jaegerEngines.set(e.id,t)}initializeOpenTelemetryCollectorEngine(e){if(this.otelCollectorEngines.has(e.id))this.otelCollectorEngines.get(e.id).initializeConfig(e);else{const t=new PT;t.initializeConfig(e),this.otelCollectorEngines.set(e.id,t)}}initializePagerDutyEngine(e){const t=new OT;t.initializeFromNode(e),this.pagerDutyEngines.set(e.id,t)}initializeKeycloakEngine(e){const t=new qT;t.initializeConfig(e),this.keycloakEngines.set(e.id,t)}initializeVaultEngine(e){const t=new QT;t.initializeConfig(e),this.vaultEngines.set(e.id,t)}initializeWAFEngine(e){const t=new BT;t.initializeConfig(e),this.wafEngines.set(e.id,t)}initializeIDSIPSEngine(e){const t=new UT;t.initializeConfig(e),this.idsIpsEngines.set(e.id,t)}initializeJenkinsEngine(e){const t=new FT;t.initializeConfig(e),this.jenkinsEngines.set(e.id,t)}createLokiQueryExecutor(e){const a=((e.data.config||{}).datasources||[]).find(d=>typeof d=="string"?!1:d.type==="loki");if(!a||typeof a=="string")return;const r=a.url||"",c=this.nodes.find(d=>d.type!=="loki"?!1:((d.data.config||{}).serverUrl||"http://loki:3100")===r||r.includes(d.id)||r.includes(d.data.label||""));if(!c)return;const l=this.lokiEngines.get(c.id);if(l)return(d,h,p,m)=>{const y=l.executeQuery(d,h,p,m);return{success:y.success,latency:y.latency,resultsCount:y.resultsCount,error:y.error}}}isPrometheusAvailableForGrafana(e){const t=this.connections.find(c=>c.source===e.id&&this.nodes.find(l=>l.id===c.target)?.type==="prometheus");if(!t)return!1;const n=this.nodes.find(c=>c.id===t.target);if(!n||!this.prometheusEngines.get(n.id))return!1;const r=this.metrics.get(n.id);return!(r&&r.errorRate>.5)}initializePostgreSQLConnectionPool(e){const t=e.data.config||{},n={maxConnections:t.maxConnections||100,minConnections:t.minConnections||0,idleTimeout:t.idleTimeout||3e5,maxLifetime:t.maxLifetime||36e5,connectionTimeout:t.connectionTimeout||5e3},a=new DT(n);this.postgresConnectionPools.set(e.id,a)}updateElasticsearchMetricsInConfig(e,t){const n=e.data.config||{};n.clusterHealth=t.clusterHealth,n.activeShards=t.activeShards,n.relocatingShards=t.relocatingShards,n.initializingShards=t.initializingShards;const a=n.indices||[],r=this.elasticsearchRoutingEngines.get(e.id)?.getIndices()||[];for(let c=0;c<a.length;c++){const l=a[c],d=r.find(h=>h.name===l.name);d&&(a[c]={...l,docs:d.docs,size:d.size,health:d.health})}n.indices=a,n.totalDocs=t.totalDocs,n.totalSize=t.totalSize}updateS3BucketMetricsInConfig(e,t){const n=e.data.config||{},a=n.buckets||[];for(let r=0;r<a.length;r++){const c=a[r],l=t.get(c.name);l&&(a[r]={...c,objectCount:l.objectCount,totalSize:l.totalSize})}n.buckets=a}calculateConnectionLatency(e,t,n){const r={sync:5,async:2,http:10,grpc:5,websocket:3}[e.type]||10,c=t.latency||0,l=n.latency||0,d=e.data||{},h=d.latencyMs||0,p=(d.jitterMs||0)*(Math.random()-.5),m=2+Math.random()*8+h+p;return r+(c+l)/2+m}calculateCacheHitRatio(e,t){let n=.95;t>0&&t<100?n=.9+Math.random()*.05:t>=100&&t<1e3?n=.95+Math.random()*.04:t>=1e3&&(n=.92+Math.random()*.05);const a=Math.sin(this.simulationTime/1e4)*.02;return Math.max(.85,Math.min(.99,n+a))}createDefaultMetrics(e,t){return{id:e,type:t,throughput:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now()}}createDefaultConnectionMetrics(e){return{id:e.id,source:e.source,target:e.target,traffic:0,latency:0,errorRate:0,utilization:0,timestamp:Date.now(),throughputDependency:0,backpressure:0,bottleneck:!1,effectiveThroughput:0,congestion:0}}initializeMetrics(){this.metrics.clear(),this.connectionMetrics.clear(),this.latencyHistory.clear(),this.connectionLatencyHistory.clear();for(const e of this.nodes)this.metrics.set(e.id,this.createDefaultMetrics(e.id,e.type))}getComponentMetrics(e){return this.metrics.get(e)}getRabbitMQRoutingEngine(e){return this.rabbitMQRoutingEngines.get(e)}getActiveMQRoutingEngine(e){return this.activeMQRoutingEngines.get(e)}getSQSRoutingEngine(e){return this.sqsRoutingEngines.get(e)}getAzureServiceBusRoutingEngine(e){return this.azureServiceBusRoutingEngines.get(e)}getPubSubRoutingEngine(e){return this.pubSubRoutingEngines.get(e)}getRedisRoutingEngine(e){return this.redisRoutingEngines.get(e)}getCassandraRoutingEngine(e){return this.cassandraRoutingEngines.get(e)}getClickHouseRoutingEngine(e){return this.clickHouseRoutingEngines.get(e)}getSnowflakeRoutingEngine(e){return this.snowflakeRoutingEngines.get(e)}getElasticsearchRoutingEngine(e){return this.elasticsearchRoutingEngines.get(e)}getKongRoutingEngine(e){return this.kongRoutingEngines.get(e)}getApigeeRoutingEngine(e){return this.apigeeRoutingEngines.get(e)}getMuleSoftRoutingEngine(e){return this.mulesoftRoutingEngines.get(e)}getGraphQLGatewayRoutingEngine(e){return this.graphQLGatewayRoutingEngines.get(e)}getBFFRoutingEngine(e){return this.bffRoutingEngines.get(e)}getWebhookRelayRoutingEngine(e){return this.webhookRelayRoutingEngines.get(e)}getLokiEmulationEngine(e){return this.lokiEngines.get(e)}getKeycloakEmulationEngine(e){return this.keycloakEngines.get(e)}getJenkinsEmulationEngine(e){return this.jenkinsEngines.get(e)}getVaultEmulationEngine(e){return this.vaultEngines.get(e)}getWAFEmulationEngine(e){return this.wafEngines.get(e)}getFirewallEmulationEngine(e){return this.firewallEngines.get(e)}getIDSIPSEmulationEngine(e){return this.idsIpsEngines.get(e)}getJaegerEmulationEngine(e){return this.jaegerEngines.get(e)}getAllJaegerEngines(){return new Map(this.jaegerEngines)}getOpenTelemetryCollectorRoutingEngine(e){return this.otelCollectorEngines.get(e)}checkSQSIAMPolicy(e,t,n,a){if(!e||e.length===0)return!0;const r=e.filter(d=>{const h=d.principal||"";if(h!==t&&h!=="*"&&!t.includes(h))return!1;const p=d.resource||"";let m=!1;if(p==="*"||p===n)m=!0;else if(p.endsWith("*")){const b=p.slice(0,-1);m=n.startsWith(b.replace(/.*:/,""))}else if(p.includes("sqs:")||p.includes("arn:aws:sqs")){const b=p.split(":").pop()||p.split("/").pop()||"";m=b===n||b==="*"||n.includes(b)}else m=n.includes(p)||p==="*";if(!m)return!1;const y=d.action||"";return!(y!==a&&y!=="*"&&!y.includes(a))});return r.length===0?!0:r.filter(d=>d.effect==="Deny").length>0?!1:(r.filter(d=>d.effect==="Allow").length>0,!0)}checkActiveMQACLPermissionPublic(e,t,n,a){return this.checkActiveMQACLPermission(e,t,n,a)}getConnectionMetrics(e){return this.connectionMetrics.get(e)}getAllComponentMetrics(){return Array.from(this.metrics.values())}getAllConnectionMetrics(){return Array.from(this.connectionMetrics.values())}getPagerDutyIncidents(e){const t=this.pagerDutyEngines.get(e);return t?t.getIncidents():[]}getPagerDutyMetrics(e){const t=this.pagerDutyEngines.get(e);return t?t.getMetrics():null}acknowledgePagerDutyIncident(e,t){const n=this.pagerDutyEngines.get(e);n&&n.acknowledgeIncident(Date.now(),t)}resolvePagerDutyIncident(e,t){const n=this.pagerDutyEngines.get(e);n&&n.resolveIncidentManually(Date.now(),t)}getIsRunning(){return this.isRunning}getSimulationTime(){return this.simulationTime}}const je=new GT;function VT(o,e){let t=null;return function(...a){const r=()=>{t=null,o(...a)};t!==null&&clearTimeout(t),t=setTimeout(r,e)}}class KT{logLevel;logs=[];maxLogs=100;constructor(){this.logLevel=2}debug(e,t){this.log(0,e,void 0,t)}info(e,t){this.log(1,e,void 0,t)}warn(e,t,n){this.log(2,e,t,n)}error(e,t,n){this.log(3,e,t,n)}log(e,t,n,a){if(e<this.logLevel)return;const r={level:e,message:t,error:n,timestamp:Date.now(),context:a};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const c=`[${this.getLevelName(e)}] ${t}`,l=a?{...a,error:n}:n;switch(e){case 0:console.debug(c,l||"");break;case 1:console.info(c,l||"");break;case 2:console.warn(c,l||"");break;case 3:console.error(c,l||"");break}}getLevelName(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARN";case 3:return"ERROR";default:return"UNKNOWN"}}getRecentLogs(e,t=50){let n=this.logs;return e!==void 0&&(n=this.logs.filter(a=>a.level>=e)),n.slice(-t)}clearLogs(){this.logs=[]}setLogLevel(e){this.logLevel=e}}const nb=new KT,sb=(o,e,t)=>nb.warn(o,e,t),ta=(o,e,t)=>nb.error(o,e,t),vl="archiphoenix_diagram",zh=1,YT=500,WT=()=>{try{const o=localStorage.getItem(vl);if(!o)return null;const e=JSON.parse(o);return e.version!==zh?(sb("Diagram version mismatch, using defaults"),null):e}catch(o){return ta("Failed to load diagram from storage",o instanceof Error?o:new Error(String(o))),null}},XT=(o,e="My Diagram")=>{try{const t={...o,version:zh,name:e,createdAt:localStorage.getItem(`${vl}_createdAt`)||new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem(vl,JSON.stringify(t)),localStorage.setItem(`${vl}_createdAt`,t.createdAt)}catch(t){ta("Failed to save diagram to storage",t instanceof Error?t:new Error(String(t)))}},ht=VT(XT,YT),ZT=(o,e="diagram.json")=>{try{const t={...o,version:zh,name:e.replace(".json",""),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},n=JSON.stringify(t,null,2),a=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(a),c=document.createElement("a");c.href=r,c.download=e,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)}catch(t){ta("Failed to export diagram",t instanceof Error?t:new Error(String(t)))}},JT=o=>new Promise(e=>{try{const t=new FileReader;t.onload=n=>{try{const a=n.target?.result,r=JSON.parse(a);if(!r.nodes||!r.connections||typeof r.zoom!="number"||!r.pan)throw new Error("Invalid diagram format");r.groups||(r.groups=[]),e(r)}catch(a){ta("Failed to parse diagram file",a instanceof Error?a:new Error(String(a))),e(null)}},t.readAsText(o)}catch(t){ta("Failed to import diagram",t instanceof Error?t:new Error(String(t))),e(null)}}),ek=50,Mr=Cs((o,e)=>({past:[],future:[],canUndo:!1,canRedo:!1,pushState:t=>{o(n=>{const a=[...n.past,t];return a.length>ek&&a.shift(),{past:a,future:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{past:t,future:n}=e();if(t.length===0)return null;const a=t[t.length-1],r=t.slice(0,-1);return o({past:r,future:[a,...n],canUndo:r.length>0,canRedo:!0}),a},redo:()=>{const{past:t,future:n}=e();if(n.length===0)return null;const a=n[0],r=n.slice(1);return o({past:[...t,a],future:r,canUndo:!0,canRedo:r.length>0}),a},clearHistory:()=>{o({past:[],future:[],canUndo:!1,canRedo:!1})}}));class tk{rules=new Map;allRules=[];register(e){const t=e.sourceType;this.rules.has(t)||this.rules.set(t,[]);const n=this.rules.get(t);n&&(n.push(e),this.allRules.push(e),n.sort((a,r)=>(r.priority||0)-(a.priority||0)))}registerMany(e){e.forEach(t=>this.register(t))}findRules(e,t){const n=[],a=this.rules.get(e)||[];for(const c of a)(c.targetTypes==="*"||Array.isArray(c.targetTypes)&&c.targetTypes.includes(t))&&n.push(c);const r=this.rules.get("*")||[];for(const c of r)(c.targetTypes==="*"||Array.isArray(c.targetTypes)&&c.targetTypes.includes(t))&&n.push(c);return n.sort((c,l)=>(l.priority||0)-(c.priority||0))}getAllRules(){return[...this.allRules]}getRulesForSource(e){return this.rules.get(e)||[]}clear(){this.rules.clear(),this.allRules=[]}}const nk={postgres:5432,mongodb:27017,redis:6379,cassandra:9042,clickhouse:8123,elasticsearch:9200,rest:8080,grpc:50051,graphql:4e3,websocket:8080,webhook:8080,soap:8080,nginx:80,envoy:80,haproxy:80,traefik:80,docker:2375,kubernetes:6443,kafka:9092,rabbitmq:5672,activemq:61616,"aws-sqs":9324,prometheus:9090,grafana:3e3,loki:3100,jaeger:16686,keycloak:8080,"secrets-vault":8200,crm:8080,erp:8080,"payment-gateway":443},sk={"api-gateway":9100,postgres:9187,redis:9121,"service-mesh":15014,istio:15014,envoy:9901,cdn:9101,"aws-sqs":9102};class ab{getHost(e){return e.data.label?e.data.label.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):e.id.slice(0,8)}getPort(e,t){const n=e.data.config||{};switch(t){case"main":return n.port||n.host?.split(":")[1]||nk[e.type];case"metrics":return n.metricsPort||n.metrics?.port||sk[e.type];case"admin":return n.adminPort||n.admin?.port}}getEndpoint(e,t="main"){const n=this.getHost(e),a=this.getPort(e,t);if(!a)throw new Error(`Port not found for ${e.type}:${t}`);return`${n}:${a}`}getURL(e,t="main",n="http"){const a=this.getEndpoint(e,t);return`${n}://${a}`}getConnectionMetadata(e,t,n){const a=this.getHost(e),r=this.getHost(t),c=this.getPort(e,"main"),l=this.getPort(t,"main");let d="http";return n.type==="grpc"?d="grpc":n.type==="websocket"?d="websocket":t.type==="kafka"?d="kafka":t.type==="rabbitmq"||t.type==="activemq"?d="rabbitmq":n.type==="async"?d="async":n.type==="sync"&&(d="sync"),{protocol:d,sourceHost:a,targetHost:r,sourcePort:c,targetPort:l,endpoint:l?`${r}:${l}`:void 0}}getCapabilities(e){return{defaultPort:this.getPort(e,"main"),metricsPort:this.getPort(e,"metrics"),adminPort:this.getPort(e,"admin"),getHost:t=>this.getHost(t),getPort:(t,n)=>this.getPort(t,n)}}}class ak{registry;discovery;constructor(){this.registry=new tk,this.discovery=new ab}initialize(e){this.registry.registerMany(e)}handleConnectionCreated(e,t,n,a){const r=this.registry.findRules(e.type,t.type);if(r.length===0)return{sourceUpdated:!1,targetUpdated:!1};let c=!1,l=!1;const d=this.discovery.getConnectionMetadata(e,t,n);for(const h of r)try{const p=h.updateSourceConfig(e,t,n,d);if(p&&Object.keys(p).length>0&&(a(e.id,{data:{...e.data,config:{...e.data.config,...p}}}),c=!0),h.updateTargetConfig){const m=h.updateTargetConfig(e,t,n,d);m&&Object.keys(m).length>0&&(a(t.id,{data:{...t.data,config:{...t.data.config,...m}}}),l=!0)}}catch(p){ta(`Error applying rule for ${e.type} -> ${t.type}`,p instanceof Error?p:new Error(String(p)),{sourceType:e.type,targetType:t.type})}return{sourceUpdated:c,targetUpdated:l}}handleConnectionDeleted(e,t,n,a){const r=this.registry.findRules(e.type,t.type);if(r.length===0)return{sourceUpdated:!1,targetUpdated:!1};let c=!1,l=!1;const d=this.discovery.getConnectionMetadata(e,t,n);for(const h of r)try{if(h.cleanupSourceConfig){const p=h.cleanupSourceConfig(e,t,n,d);p&&Object.keys(p).length>0&&(a(e.id,{data:{...e.data,config:{...e.data.config,...p}}}),c=!0)}if(h.cleanupTargetConfig){const p=h.cleanupTargetConfig(e,t,n,d);p&&Object.keys(p).length>0&&(a(t.id,{data:{...t.data,config:{...t.data.config,...p}}}),l=!0)}}catch(p){ta(`Error cleaning up rule for ${e.type} -> ${t.type}`,p instanceof Error?p:new Error(String(p)),{sourceType:e.type,targetType:t.type})}return{sourceUpdated:c,targetUpdated:l}}getDiscovery(){return this.discovery}getRegistry(){return this.registry}}function ik(o){return{sourceType:"envoy",targetTypes:["rest","grpc","graphql","websocket","soap","webhook","postgres","mongodb","redis","cassandra","clickhouse","crm","erp","payment-gateway","bpmn-engine"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).clusters||[],l=c.find(m=>!m.hosts||!Array.isArray(m.hosts)?!1:m.hosts.some(y=>y.address===a.targetHost&&y.port===a.targetPort));if(l)return l.hosts.some(y=>y.address===a.targetHost&&y.port===a.targetPort)?null:{clusters:c.map(y=>y===l?{...y,hosts:[...y.hosts||[],{address:a.targetHost,port:a.targetPort}]}:y)};t.data.label||t.type;const d=`${t.type}-${t.id.slice(0,8)}-cluster`;let h="STRICT_DNS";a.protocol==="grpc"?h="STRICT_DNS":(t.type==="postgres"||t.type==="mongodb"||t.type==="redis")&&(h="STATIC_DNS");const p={name:d,type:h,hosts:[{address:a.targetHost,port:a.targetPort}],healthChecks:!0,connectTimeout:5e3,requests:0,errors:0};return{clusters:[...c,p],totalClusters:c.length+1}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function ok(o){return{sourceType:"api-gateway",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).apis||[];if(c.find(C=>C.backendUrl===`http://${a.targetHost}:${a.targetPort}`||C.backendUrl===`https://${a.targetHost}:${a.targetPort}`))return null;const h=`${t.data.label||t.type}-api`,p=`/api/${t.type}`;let m="GET";t.type==="grpc"?m="POST":t.type==="websocket"&&(m="GET");const b=`${a.protocol==="grpc","http"}://${a.targetHost}:${a.targetPort}`,S={name:h,path:p,method:m,backendUrl:b,enabled:!0,requests:0,errors:0};return{apis:[...c,S]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function rk(o){return{sourceType:"kong",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const r=e.data.config||{},c=r.services||[],l=r.routes||[],h=`${a.protocol==="grpc","http"}://${a.targetHost}:${a.targetPort}`,m=`${t.data.label||t.type}-service`;let y=c.find(M=>M.name===m||M.url===h);y||(y={id:String(c.length+1),name:m,url:h,routes:0,enabled:!0},c.push(y));const b=`/api/${t.type}`;if(l.find(M=>M.service===y.name&&M.path===b))return null;let C="GET";t.type==="grpc"?C="POST":(t.type==="websocket"||t.type==="rest"||t.type==="graphql")&&(C="GET");const E={id:String(l.length+1),path:b,method:C,service:y.name,stripPath:!0,protocols:["http","https"]};return y.routes=(y.routes||0)+1,{services:c,routes:[...l,E]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function ck(o){return{sourceType:"service-mesh",targetTypes:"*",priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).services||[];if(c.find(y=>y.host===a.targetHost&&y.port===a.targetPort))return null;const h=(t.data.label||t.type).toLowerCase().replace(/\s+/g,"-");let p="http";a.protocol==="grpc"?p="grpc":(t.type==="postgres"||t.type==="mongodb"||t.type==="redis")&&(p="tcp");const m={name:h,namespace:"default",host:a.targetHost,port:a.targetPort,protocol:p,enabled:!0};return{services:[...c,m]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function lk(o){return{sourceType:"istio",targetTypes:"*",priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).services||[];if(c.find(y=>y.host===a.targetHost&&y.port===a.targetPort))return null;const h=(t.data.label||t.type).toLowerCase().replace(/\s+/g,"-");let p="http";a.protocol==="grpc"?p="grpc":(t.type==="postgres"||t.type==="mongodb"||t.type==="redis")&&(p="tcp");const m={name:h,namespace:"default",host:a.targetHost,port:a.targetPort,protocol:p,enabled:!0};return{services:[...c,m]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function uk(o){return{sourceType:"nginx",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).upstreams||[],l=`${t.type}-upstream`;let d=c.find(p=>p.name===l);if(d)return d.servers?.some(m=>(m.host===a.targetHost||m.address===`${a.targetHost}:${a.targetPort}`)&&(m.port===a.targetPort||m.address?.includes(`:${a.targetPort}`)))?null:{upstreams:c.map(m=>m.name===l?{...m,servers:[...m.servers||[],{host:a.targetHost,port:a.targetPort}]}:m)};const h={name:l,servers:[{host:a.targetHost,port:a.targetPort}],loadBalancing:"round-robin"};return{upstreams:[...c,h]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function dk(o){return{sourceType:"haproxy",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).backends||[],l=`${t.type}-backend`;let d=c.find(p=>p.name===l);if(d)return d.servers?.some(m=>(m.host===a.targetHost||m.address===`${a.targetHost}:${a.targetPort}`)&&(m.port===a.targetPort||m.address?.includes(`:${a.targetPort}`)))?null:{backends:c.map(m=>m.name===l?{...m,servers:[...m.servers||[],{host:a.targetHost,port:a.targetPort}]}:m)};const h={name:l,servers:[{host:a.targetHost,port:a.targetPort}],balance:"roundrobin"};return{backends:[...c,h]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function fk(o){return{sourceType:"traefik",targetTypes:["rest","grpc","graphql","websocket","postgres","mongodb","redis","crm","erp","payment-gateway"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const r=e.data.config||{},c=r.services||{},l=r.routers||{},d=`${t.type}-service`,h=`${t.type}-router`;if(c[d])return c[d].servers?.some(b=>b.url===`http://${a.targetHost}:${a.targetPort}`)?null:{services:{...c,[d]:{...c[d],servers:[...c[d].servers||[],{url:`http://${a.targetHost}:${a.targetPort}`}]}}};const m=`Host(\`${(t.data.label||t.type).toLowerCase()}.local\`)`;return{services:{...c,[d]:{loadBalancer:{servers:[{url:`http://${a.targetHost}:${a.targetPort}`}]}}},routers:{...l,[h]:{rule:m,service:d}}}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function hk(o){return{sourceType:"*",targetTypes:["postgres","mongodb","redis","cassandra","clickhouse","elasticsearch"],priority:5,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const r=e.data.config||{},c=t.type;let l={};switch(c){case"postgres":l={database:{host:a.targetHost,port:a.targetPort,database:r.database?.database||"postgres",username:r.database?.username||"postgres",password:r.database?.password||""}};break;case"mongodb":l={database:{connectionString:`mongodb://${a.targetHost}:${a.targetPort}`,database:r.database?.database||"admin"}};break;case"redis":l={database:{host:a.targetHost,port:a.targetPort,password:r.database?.password||""}};break;case"cassandra":l={database:{hosts:[`${a.targetHost}:${a.targetPort}`],keyspace:r.database?.keyspace||"system"}};break;case"clickhouse":l={database:{host:a.targetHost,port:a.targetPort,database:r.database?.database||"default"}};break;case"elasticsearch":l={database:{hosts:[`http://${a.targetHost}:${a.targetPort}`]}};break;default:return null}return l},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function pk(o){return{sourceType:"*",targetTypes:["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],priority:5,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const r=e.data.config||{},c=t.type;let l={};switch(c){case"kafka":l={messaging:{broker:`${a.targetHost}:${a.targetPort}`,topic:r.messaging?.topic||t.data.config?.defaultTopic||"default-topic",producerId:r.messaging?.producerId||e.id.slice(0,8)}};break;case"rabbitmq":l={messaging:{broker:`${a.targetHost}:${a.targetPort}`,exchange:r.messaging?.exchange||t.data.config?.defaultExchange||"amq.topic",routingKey:r.messaging?.routingKey||"default"}};break;case"activemq":const d=t.data.config?.queues||[],h=d.length>0&&typeof d[0]=="object"?d[0].name:d.length>0?d[0]:null;l={messaging:{broker:`${a.targetHost}:${a.targetPort}`,queue:r.messaging?.queue||h||"default-queue"}};break;case"aws-sqs":{const p=t.data.config?.queues||[],m=p.length>0&&typeof p[0]=="object"?p[0].name:p.length>0?p[0]:null,y=p.length>0&&typeof p[0]=="object"?p[0].region:t.data.config?.defaultRegion||"us-east-1";l={messaging:{queueUrl:`https://sqs.${y}.amazonaws.com/account/${m||"default-queue"}`,queueName:m||"default-queue",region:r.messaging?.region||y}};break}case"azure-service-bus":{const p=t.data.config||{},m=p.namespace||"archiphoenix.servicebus.windows.net";p.connectionString||`${m}`;const y=r.messaging?.entityType||p.entityType||"queue",b=r.messaging?.entityName||r.messaging?.queue||r.messaging?.topic||p.entityName||(y==="queue"?"events":"events-topic"),S=r.messaging?.subscriptionName||p.subscriptionName;l={messaging:{connectionString:p.connectionString||`Endpoint=sb://${m}/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=...`,namespace:m,entityType:y,queue:y==="queue"?b:void 0,topic:y==="topic"?b:void 0,subscriptionName:y==="topic"&&S?S:void 0}};break}case"gcp-pubsub":l={messaging:{projectId:r.messaging?.projectId||"default-project",topic:r.messaging?.topic||t.data.config?.defaultTopic||"default-topic"}};break;default:return null}return l},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function gk(o,e){const t=o.data.config||{};return t.metrics?.port?t.metrics.port:t.metricsPort?t.metricsPort:(o.type==="service-mesh"||o.type==="istio")&&t.metrics?.controlPlanePort?t.metrics.controlPlanePort:e.getPort(o,"metrics")}function mk(o){const e=o.data.config||{};return e.metrics?.path?e.metrics.path:e.metricsPath?e.metricsPath:o.type==="envoy"?e.metrics?.prometheusPath||"/stats/prometheus":"/metrics"}function $0(o){return o.data.label?o.data.label.toLowerCase().replace(/\s+/g,"-"):`${o.type}-${o.id.slice(0,8)}`}function U0(o,e){const t=e.getHost(o),n=gk(o,e);if(!n){const a=e.getPort(o,"main");return a?`${t}:${a}`:null}return`${t}:${n}`}function yk(o){return{sourceType:"*",targetTypes:["prometheus"],priority:5,updateTargetConfig:(e,t,n,a)=>{const r=t.data.config||{},c=r.scrape_configs||[],l=r.scrapeInterval||"15s",d=mk(e),h=U0(e,o);if(!h)return null;const p=$0(e),m={component:e.type,componentId:e.id},y=c.findIndex(S=>S.job_name===p);if(y>=0){const S=c[y];let C=!1;for(const E of S.static_configs||[]){if(E.targets&&E.targets.includes(h)){C=!0;break}if(E.labels?.componentId===e.id){E.targets.includes(h)||E.targets.push(h),C=!0;break}}if(!C){const E=[...c],M=[...S.static_configs||[]];return M.push({targets:[h],labels:m}),E[y]={...S,static_configs:M},{scrape_configs:E}}return null}const b={job_name:p,scrape_interval:l!=="15s"?l:void 0,metrics_path:d!=="/metrics"?d:void 0,static_configs:[{targets:[h],labels:m}]};return{scrape_configs:[...c,b]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n),cleanupTargetConfig:(e,t,n,a)=>{const c=(t.data.config||{}).scrape_configs||[];if(!c||c.length===0)return null;const l=U0(e,o),d=$0(e),h=e.id;let p=!1;const m=c.map(y=>{if(y.job_name!==d)return y;const b=(y.static_configs||[]).map(S=>{if(S.labels?.componentId===h)return p=!0,null;if(l&&S.targets&&S.targets.includes(l)){const C=S.targets.filter(E=>E!==l);return C.length===0?(p=!0,null):(p=!0,{...S,targets:C})}return S}).filter(S=>S!==null);return b.length===0?(p=!0,null):{...y,static_configs:b}}).filter(y=>y!==null);return p?{scrape_configs:m}:null}}}function vk(o){return{sourceType:"grafana",targetTypes:["prometheus"],priority:10,updateSourceConfig:(e,t,n,a)=>{let c=(e.data.config||{}).datasources||[];c.length>0&&typeof c[0]=="string"&&(c=c.map(y=>({name:y,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:y===c[0]})));const l=o.getURL(t,"main"),d=a.targetHost||o.getHost(t),h=a.targetPort||o.getPort(t,"main")||9090,p=h===9090?`http://${d}:${h}`:l,m=c.findIndex(y=>y&&typeof y=="object"&&(y.type==="prometheus"||y.name?.toLowerCase().includes("prometheus")));if(m>=0){const y=[...c];return y[m]={...y[m],url:p,type:"prometheus",isDefault:y[m].isDefault??!0},{datasources:y}}else{const y={name:"Prometheus",type:"prometheus",url:p,access:"proxy",isDefault:c.length===0};return{datasources:[...c,y]}}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n),cleanupSourceConfig:(e,t,n,a)=>{let c=(e.data.config||{}).datasources||[];if(c.length>0&&typeof c[0]=="string")return null;const l=o.getURL(t,"main"),d=a.targetHost||o.getHost(t),h=a.targetPort||o.getPort(t,"main")||9090,p=h===9090?`http://${d}:${h}`:l,m=c.filter(y=>!(y&&typeof y=="object"&&y.url===p&&y.type==="prometheus"));return m.length!==c.length?{datasources:m}:null}}}function ib(o){const e=["postgres","mongodb","redis","cassandra","clickhouse","snowflake","elasticsearch"],t=["rest","grpc","graphql","soap","websocket","webhook"],n=["kafka","rabbitmq","activemq","aws-sqs","azure-service-bus","gcp-pubsub"],a=["s3-datalake"],r=["crm","erp","payment-gateway"];return e.includes(o)?"database":t.includes(o)?"api":n.includes(o)?"messaging":a.includes(o)?"file":r.includes(o)?"api":"custom"}function Tl(o,e,t){const n=t?o.label||o.type:e.label||e.type,a=t?o.id.slice(0,8):e.id.slice(0,8);return`${n}-${a}`.toLowerCase().replace(/\s+/g,"-")}function bk(o){return{sourceType:"*",targetTypes:["mulesoft"],priority:5,updateTargetConfig:(e,t,n,a)=>{const c=(t.data.config||{}).connectors||[];if(c.find(m=>m.targetComponentId===e.id||m.name===Tl(e,t,!0)))return null;const d=ib(e.type),p={name:Tl(e,t,!0),type:d,enabled:!0,config:{},targetComponentType:e.type,targetComponentId:e.id};return d==="database"&&a.targetHost&&a.targetPort?p.config={host:a.targetHost,port:a.targetPort}:d==="api"&&a.targetHost&&a.targetPort?p.config={baseUrl:`http://${a.targetHost}:${a.targetPort}`}:d==="messaging"&&(p.config={broker:a.targetHost&&a.targetPort?`${a.targetHost}:${a.targetPort}`:void 0}),{connectors:[...c,p]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function xk(o){return{sourceType:"mulesoft",targetTypes:"*",priority:5,updateSourceConfig:(e,t,n,a)=>{const c=(e.data.config||{}).connectors||[];if(c.find(m=>m.targetComponentId===t.id||m.name===Tl(e,t,!1)))return null;const d=ib(t.type),p={name:Tl(e,t,!1),type:d,enabled:!0,config:{},targetComponentType:t.type,targetComponentId:t.id};return d==="database"&&a.targetHost&&a.targetPort?p.config={host:a.targetHost,port:a.targetPort}:d==="api"&&a.targetHost&&a.targetPort?p.config={baseUrl:`http://${a.targetHost}:${a.targetPort}`}:d==="messaging"&&a.targetHost&&a.targetPort&&(p.config={broker:`${a.targetHost}:${a.targetPort}`}),{connectors:[...c,p]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function wk(o){return{sourceType:"graphql-gateway",targetTypes:["graphql"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).services||[],l=`http://${a.targetHost}:${a.targetPort}/graphql`;if(c.find(m=>m.endpoint===l||m.name===t.data.label))return null;const h=t.data.label||t.type,p={id:`svc-${c.length+1}`,name:h,endpoint:l,status:"connected",requests:0,errors:0};return{services:[...c,p]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function Sk(o){return{sourceType:"bff-service",targetTypes:["rest","grpc","graphql","websocket","soap","webhook"],priority:10,updateSourceConfig:(e,t,n,a)=>{if(!a.targetHost||!a.targetPort)return null;const c=(e.data.config||{}).backends||[],l=t.data.label||t.type;if(c.find(m=>m.name===l||m.endpoint===`http://${a.targetHost}:${a.targetPort}`||m.id===t.id))return null;let h="http";t.type==="grpc"?h="grpc":t.type==="graphql"&&(h="graphql");const p={id:t.id||`backend-${Date.now()}`,name:l,endpoint:`http://${a.targetHost}:${a.targetPort}`,protocol:h,status:"connected",timeout:5e3,retries:3,retryBackoff:"exponential",circuitBreaker:{enabled:!0,failureThreshold:5,successThreshold:2,timeout:6e4}};return{backends:[...c,p]}},extractMetadata:(e,t,n)=>o.getConnectionMetadata(e,t,n)}}function Ck(o){return[ik(o),uk(o),dk(o),fk(o),ok(o),rk(o),wk(o),Sk(o),ck(o),lk(o),hk(o),pk(o),yk(o),vk(o),bk(o),xk(o)]}let $f=null;function Q0(){if(!$f){const o=new ab,e=new ak,t=Ck(o);e.initialize(t),$f=e}return $f}const Gn=2e3,F0=140,G0=200,rl=(o,e)=>({x:Math.floor(o/Gn),y:Math.floor(e/Gn)}),Mk=(o,e,t,n,a,r)=>{const c=a*Gn,l=(a+1)*Gn,d=r*Gn,h=(r+1)*Gn,p=o,m=o+t,y=e,b=e+n;return!(m<c||p>l||b<d||y>h)},Uf=o=>{const e=new Set,t=F0+G0,n=F0+G0,a=o.position.x,r=a+t,c=o.position.y,l=c+n,d=rl(a,c).x,h=rl(r,l).x,p=rl(a,c).y,m=rl(r,l).y;for(let y=d;y<=h;y++)for(let b=p;b<=m;b++)Mk(a,c,t,n,y,b)&&e.add(`${y},${b}`);return e},Un=(o,e=[])=>{if(o.length===0)return[];const t=new Set,n=new Map(o.map(a=>[a.id,a]));return o.forEach(a=>{Uf(a).forEach(c=>t.add(c))}),e.forEach(a=>{const r=n.get(a.source),c=n.get(a.target);r&&Uf(r).forEach(d=>t.add(d)),c&&Uf(c).forEach(d=>t.add(d))}),Array.from(t).map(a=>{const[r,c]=a.split(",").map(Number);return{x:r,y:c}})},Qn=o=>{if(o.length===0)return{minX:0,minY:0,maxX:Gn,maxY:Gn};const e=o.map(l=>l.x),t=o.map(l=>l.y),n=Math.min(...e),a=Math.min(...t),r=Math.max(...e),c=Math.max(...t);return{minX:n*Gn,minY:a*Gn,maxX:(r+1)*Gn,maxY:(c+1)*Gn}},Qf={nodes:[],connections:[],groups:[],zoom:1,pan:{x:0,y:0}},Re=Cs((o,e)=>{const t=WT(),n=t?{...Qf,...t,groups:t.groups||[]}:Qf;let a=!1,r=!1;const c=()=>{const p=e();return{nodes:p.nodes,connections:p.connections,groups:p.groups||[],zoom:p.zoom,pan:p.pan}},l=()=>{Mr.getState().pushState(c())},d=Un(n.nodes,n.connections||[]),h=Qn(d);return{...n,selectedNodeId:null,selectedConnectionId:null,diagramName:t?.name||"Untitled Diagram",viewportWidth:0,viewportHeight:0,canvasBounds:h,canvasChunks:d,getDiagramState:c,updateCanvasBounds:()=>o(p=>{const m=Un(p.nodes,p.connections);return{canvasChunks:m,canvasBounds:Qn(m)}}),addNode:p=>o(m=>{l();const y=[...m.nodes,p],b=Un(y,m.connections),S={nodes:y,canvasChunks:b,canvasBounds:Qn(b)};return ht({...m,...S},m.diagramName),S}),updateNode:(p,m,y=!1)=>o(b=>{!y&&!a&&l();const S=b.nodes.map(M=>M.id===p?{...M,...m}:M),C=Un(S,b.connections),E={nodes:S,canvasChunks:C,canvasBounds:Qn(C)};return(!a||!y)&&ht({...b,...E},b.diagramName),E}),updateNodes:(p,m=!1)=>o(y=>{!m&&!a&&!r&&l();const b=new Map(p.map(M=>[M.id,M.updates])),S=y.nodes.map(M=>{const k=b.get(M.id);return k?{...M,...k}:M}),C=Un(S,y.connections),E={nodes:S,canvasChunks:C,canvasBounds:Qn(C)};return(!r||!m)&&ht({...y,...E},y.diagramName),E}),deleteNode:p=>o(m=>{l();const y=m.nodes.filter(E=>E.id!==p),b=m.connections.filter(E=>E.source!==p&&E.target!==p),S=Un(y,b),C={nodes:y,connections:b,selectedNodeId:m.selectedNodeId===p?null:m.selectedNodeId,canvasChunks:S,canvasBounds:Qn(S)};return ht({...m,...C},m.diagramName),C}),selectNode:(p,m=!1)=>o(y=>m&&p&&y.nodes.find(S=>S.id===p)?{selectedNodeId:p,nodes:y.nodes.map(S=>({...S,selected:S.id===p?!S.selected:S.selected||!1}))}:{selectedNodeId:p,nodes:y.nodes.map(b=>({...b,selected:b.id===p}))}),selectNodesByIds:p=>o(m=>({selectedNodeId:p.length>0?p[0]:null,nodes:m.nodes.map(y=>({...y,selected:p.includes(y.id)}))})),addConnection:p=>o(m=>{l();const y={...p,type:p.type||"async"},b=m.nodes.find(T=>T.id===y.source),S=m.nodes.find(T=>T.id===y.target);let C=[...m.nodes];if(b&&S){const T=Q0(),A=(N,q)=>{const O=C.findIndex(H=>H.id===N);O!==-1&&(C[O]={...C[O],...q})};T.handleConnectionCreated(b,S,y,A)}const E=[...m.connections,y],M=Un(C,E),k={nodes:C,connections:E,canvasChunks:M,canvasBounds:Qn(M)};return ht({...m,...k},m.diagramName),k}),updateConnection:(p,m)=>o(y=>{l();const b={connections:y.connections.map(S=>S.id===p?{...S,...m}:S)};return ht({...y,...b},y.diagramName),b}),deleteConnection:p=>o(m=>{l();const y=m.connections.find(M=>M.id===p);let b=[...m.nodes];if(y){const M=m.nodes.find(T=>T.id===y.source),k=m.nodes.find(T=>T.id===y.target);if(M&&k){const T=Q0(),A=(N,q)=>{const O=b.findIndex(H=>H.id===N);O!==-1&&(b[O]={...b[O],...q})};T.handleConnectionDeleted(M,k,y,A)}}const S=m.connections.filter(M=>M.id!==p),C=Un(b,S),E={nodes:b,connections:S,selectedConnectionId:m.selectedConnectionId===p?null:m.selectedConnectionId,canvasChunks:C,canvasBounds:Qn(C)};return ht({...m,...E},m.diagramName),E}),selectConnection:p=>o(m=>({selectedConnectionId:p,selectedNodeId:null,selectedGroupId:null,connections:m.connections.map(y=>({...y,selected:y.id===p}))})),addGroup:p=>o(m=>{l();const y={groups:[...m.groups,p]};return ht({...m,...y},m.diagramName),y}),updateGroup:(p,m)=>o(y=>{l();const b={groups:y.groups.map(S=>S.id===p?{...S,...m}:S)};return ht({...y,...b},y.diagramName),b}),deleteGroup:p=>o(m=>{l();const y={groups:m.groups.filter(b=>b.id!==p)};return ht({...m,...y},m.diagramName),y}),addNodeToGroup:(p,m)=>o(y=>{l();const b={groups:y.groups.map(S=>S.id===p&&!S.nodeIds.includes(m)?{...S,nodeIds:[...S.nodeIds,m]}:S)};return ht({...y,...b},y.diagramName),b}),removeNodeFromGroup:(p,m)=>o(y=>{l();const b={groups:y.groups.map(S=>S.id===p?{...S,nodeIds:S.nodeIds.filter(C=>C!==m)}:S)};return ht({...y,...b},y.diagramName),b}),selectGroup:p=>o(m=>({selectedGroupId:p,selectedNodeId:null,selectedConnectionId:null})),createGroupFromSelection:p=>o(m=>{l();const y=m.nodes.filter(C=>C.selected||C.id===m.selectedNodeId).map(C=>C.id);if(y.length===0)return m;const b={id:`group-${Date.now()}`,name:p,nodeIds:y,color:`hsl(${Math.random()*360}, 70%, 50%)`},S={groups:[...m.groups,b],nodes:m.nodes.map(C=>({...C,selected:!1})),selectedNodeId:null};return ht({...m,...S},m.diagramName),S}),autoGroupByConnections:()=>o(p=>{l();const m=new Set;p.groups.forEach(T=>{T.nodeIds.forEach(A=>m.add(A))});const y=new Map,b=T=>{y.has(T)||y.set(T,T);const A=y.get(T);if(A!==void 0&&A!==T){const N=b(A);return y.set(T,N),N}return A??T},S=(T,A)=>{const N=b(T),q=b(A);N!==q&&y.set(N,q)};p.connections.forEach(T=>{!m.has(T.source)&&!m.has(T.target)&&S(T.source,T.target)});const C=new Map;p.nodes.forEach(T=>{if(!m.has(T.id)){const A=b(T.id);C.has(A)||C.set(A,[]);const N=C.get(A);N&&N.push(T.id)}});const E=[];let M=p.groups.length+1;C.forEach((T,A)=>{T.length>=2&&E.push({id:`group-${Date.now()}-${E.length}`,name:`Group ${M++}`,nodeIds:T,color:`hsl(${Math.random()*360}, 70%, 50%)`})});const k={groups:[...p.groups,...E]};return ht({...p,...k},p.diagramName),k}),setZoom:p=>o(m=>(ht({...m,zoom:p},m.diagramName),{zoom:p})),setPan:p=>o(m=>(ht({...m,pan:p},m.diagramName),{pan:p})),setViewportSize:p=>o(()=>({viewportWidth:p.width,viewportHeight:p.height})),setDiagramName:p=>o(m=>(ht(m,p),{diagramName:p})),loadDiagramState:(p,m=!1)=>o(()=>{m||l();const y=Un(p.nodes||[],p.connections||[]),b={...p,canvasChunks:y,canvasBounds:Qn(y)};return ht(b,e().diagramName),b}),saveDiagram:()=>{const p=e();ht(p,p.diagramName)},resetCanvas:()=>{l();const p=Un([],[]);o({...Qf,canvasChunks:p,canvasBounds:Qn(p)})},undo:()=>{const p=Mr.getState().undo();p&&o(()=>{const m=Un(p.nodes||[],p.connections||[]),y={...p,canvasChunks:m,canvasBounds:Qn(m)};return ht(y,e().diagramName),y})},redo:()=>{const p=Mr.getState().redo();p&&o(()=>{const m=Un(p.nodes||[],p.connections||[]),y={...p,canvasChunks:m,canvasBounds:Qn(m)};return ht(y,e().diagramName),y})},startDragOperation:p=>{const m=e();a=!0,m.nodes.find(y=>y.id===p),l()},endDragOperation:()=>{a=!1;const p=e();ht(p,p.diagramName)},setGroupDragging:p=>{r=p},getIsGroupDragging:()=>r,bringToFront:p=>o(m=>{l();const y=m.nodes.findIndex(E=>E.id===p);if(y===-1)return m;const b=[...m.nodes],[S]=b.splice(y,1);b.push(S);const C={nodes:b};return ht({...m,...C},m.diagramName),C}),sendToBack:p=>o(m=>{l();const y=m.nodes.findIndex(E=>E.id===p);if(y===-1)return m;const b=[...m.nodes],[S]=b.splice(y,1);b.unshift(S);const C={nodes:b};return ht({...m,...C},m.diagramName),C}),bringForward:p=>o(m=>{l();const y=m.nodes.findIndex(C=>C.id===p);if(y===-1||y===m.nodes.length-1)return m;const b=[...m.nodes];[b[y],b[y+1]]=[b[y+1],b[y]];const S={nodes:b};return ht({...m,...S},m.diagramName),S}),sendBackward:p=>o(m=>{l();const y=m.nodes.findIndex(C=>C.id===p);if(y===-1||y===0)return m;const b=[...m.nodes];[b[y],b[y-1]]=[b[y-1],b[y]];const S={nodes:b};return ht({...m,...S},m.diagramName),S})}}),ja=Cs((o,e)=>({isRunning:!1,messages:new Map,messageHistory:[],initialize:(t,n)=>{un.initialize(t,n),e().updateMessages(t,n)},start:()=>{un.start(),o({isRunning:!0});const t=setInterval(()=>{const{nodes:n,connections:a}=Re.getState();e().updateMessages(n,a)},200);un._pollInterval=t},stop:()=>{un.stop();const t=un._pollInterval;t&&clearInterval(t),o({isRunning:!1})},updateMessages:(t,n)=>{un.updateNodesAndConnections(t,n);const a=new Map;for(const c of n)a.set(c.id,un.getConnectionMessages(c.id));const r=un.getMessageHistory(100);o({messages:a,messageHistory:r})},getConnectionMessages:t=>un.getConnectionMessages(t),getComponentMessages:t=>un.getComponentMessages(t),getMessageHistory:t=>un.getMessageHistory(t)}));class Ek{nodes=[];connections=[];componentMetrics=new Map;connectionMetrics=new Map;dependencyGraph=new Map;componentStatuses=new Map;update(e,t,n,a){this.nodes=e,this.connections=t,this.componentMetrics=n,this.connectionMetrics=a,this.buildDependencyGraph(),this.analyzeComponentHealth(),this.identifyCriticalPaths(),this.calculateImpactScores()}buildDependencyGraph(){this.dependencyGraph.clear();for(const e of this.nodes){const t=[],n=this.connections.filter(a=>a.target===e.id);for(const a of n){const r=this.connectionMetrics.get(a.id),c=this.componentMetrics.get(a.source);if(!r||!c)continue;const l=Math.max(r.throughputDependency,r.utilization,r.backpressure);let d="direct";r.bottleneck?d="critical":l>.7&&(d="indirect"),t.push({sourceId:a.source,targetId:e.id,connectionId:a.id,type:d,strength:l,impact:this.calculateDependencyImpact(a,c)})}this.dependencyGraph.set(e.id,t)}}calculateDependencyImpact(e,t){const n=this.connectionMetrics.get(e.id);if(!n)return 0;const a=t.errorRate,r=Math.min(1,n.latency/1e3),c=n.backpressure,l=t.utilization>.8?.5:0;return Math.min(1,a*.4+r*.2+c*.3+l*.1)}analyzeComponentHealth(){this.componentStatuses.clear();for(const e of this.nodes){const t=this.componentMetrics.get(e.id),n=this.dependencyGraph.get(e.id)||[];if(!t){this.componentStatuses.set(e.id,{nodeId:e.id,health:"down",dependencies:n,dependents:[],criticalPath:!1,impactScore:0,failureRisk:1});continue}let a="healthy",r=0;t.errorRate>.1?(a="critical",r+=.4):t.errorRate>.05&&(a="degraded",r+=.2),t.utilization>.9?(a==="healthy"&&(a="degraded"),r+=.3):t.utilization>.8&&(r+=.15),t.latency>1e3?(a==="healthy"&&(a="degraded"),r+=.2):t.latency>500&&(r+=.1);for(const l of n){const d=this.componentStatuses.get(l.sourceId);d&&(d.health==="critical"||d.health==="down"?(a==="healthy"&&(a="degraded"),r+=l.impact*.3):d.health==="degraded"&&(r+=l.impact*.15))}r=Math.min(1,r);const c=[];for(const l of this.connections)if(l.source===e.id){const d=this.connectionMetrics.get(l.id);d&&c.push({sourceId:e.id,targetId:l.target,connectionId:l.id,type:d.bottleneck?"critical":"direct",strength:d.throughputDependency,impact:this.calculateDependencyImpact(l,t)})}this.componentStatuses.set(e.id,{nodeId:e.id,health:a,dependencies:n,dependents:c,criticalPath:!1,impactScore:0,failureRisk:r})}}identifyCriticalPaths(){const e=this.nodes.filter(n=>!this.connections.some(a=>a.target===n.id)),t=this.nodes.filter(n=>!this.connections.some(a=>a.source===n.id));for(const n of e)for(const a of t){const r=this.findPath(n.id,a.id);r&&r.length>1&&r.some(l=>{const d=this.componentStatuses.get(l),h=this.connections.find(p=>r.includes(p.source)&&r.includes(p.target)&&r.indexOf(p.source)<r.indexOf(p.target));if(h){const p=this.connectionMetrics.get(h.id);return p?.bottleneck||(p?.backpressure||0)>.7}return d?.health==="critical"||d?.health==="down"})&&r.forEach(l=>{const d=this.componentStatuses.get(l);d&&(d.criticalPath=!0)})}}findPath(e,t){if(e===t)return[e];const n=[{nodeId:e,path:[e]}],a=new Set([e]);for(;n.length>0;){const{nodeId:r,path:c}=n.shift(),l=this.connections.filter(d=>d.source===r);for(const d of l){if(d.target===t)return[...c,t];a.has(d.target)||(a.add(d.target),n.push({nodeId:d.target,path:[...c,d.target]}))}}return null}calculateImpactScores(){for(const[e,t]of this.componentStatuses.entries()){let n=0;n+=Math.min(1,t.dependents.length/5)*.3,t.health==="critical"||t.health==="down"?n+=.4:t.health==="degraded"&&(n+=.2),t.criticalPath&&(n+=.2),n+=t.failureRisk*.1,t.impactScore=Math.min(1,n),this.componentStatuses.set(e,t)}}analyzeSystem(){const e=[],t=[],n=[],a=[];for(const[d,h]of this.componentStatuses.entries())if(h.criticalPath){const p=this.findPathToSink(d);p&&!e.some(m=>JSON.stringify(m)===JSON.stringify(p))&&e.push(p)}for(const[d,h]of this.connectionMetrics.entries())if(h.bottleneck){const p=this.connections.find(m=>m.id===d);p&&(t.includes(p.source)||t.push(p.source),t.includes(p.target)||t.push(p.target))}for(const[d,h]of this.componentStatuses.entries())(h.failureRisk>.6||h.health==="critical"||h.health==="down")&&n.push(d);this.generateRecommendations(a);const r=Array.from(this.componentStatuses.values()).map(d=>{switch(d.health){case"down":return 0;case"critical":return .25;case"degraded":return .5;case"healthy":return 1}}),c=r.length>0?r.reduce((d,h)=>d+h,0)/r.length:1;let l="healthy";return c<.25?l="down":c<.5?l="critical":c<.75&&(l="degraded"),{criticalPaths:e,bottlenecks:t,riskComponents:n,recommendations:a,overallHealth:l}}findPathToSink(e){const t=this.nodes.filter(n=>!this.connections.some(a=>a.source===n.id));for(const n of t){const a=this.findPath(e,n.id);if(a)return a}return null}generateRecommendations(e){for(const[n,a]of this.componentStatuses.entries()){const r=this.nodes.find(l=>l.id===n),c=this.componentMetrics.get(n);!r||!c||(c.utilization>.85&&e.push({type:"scaling",priority:c.utilization>.95?"critical":"high",componentId:n,message:`${r.data.label} is highly utilized (${(c.utilization*100).toFixed(0)}%)`,impact:"May cause performance degradation and increased latency",suggestion:`Consider scaling ${r.data.label} horizontally or vertically`}),c.errorRate>.05&&e.push({type:"monitoring",priority:c.errorRate>.1?"critical":"high",componentId:n,message:`${r.data.label} has high error rate (${(c.errorRate*100).toFixed(1)}%)`,impact:"Affects system reliability and user experience",suggestion:`Investigate error logs and implement error handling for ${r.data.label}`}),c.latency>500&&e.push({type:"optimization",priority:c.latency>1e3?"high":"medium",componentId:n,message:`${r.data.label} has high latency (${c.latency.toFixed(0)}ms)`,impact:"Affects end-to-end response time",suggestion:`Optimize ${r.data.label} performance or add caching`}),a.criticalPath&&a.failureRisk>.5&&e.push({type:"redundancy",priority:"high",componentId:n,message:`${r.data.label} is on a critical path and at risk`,impact:"Failure would significantly impact system",suggestion:`Add redundancy or failover for ${r.data.label}`}))}for(const[n,a]of this.connectionMetrics.entries()){const r=this.connections.find(d=>d.id===n);if(!r)continue;const c=this.nodes.find(d=>d.id===r.source),l=this.nodes.find(d=>d.id===r.target);a.bottleneck&&e.push({type:"optimization",priority:"critical",connectionId:n,message:`Connection between ${c?.data.label||"source"} and ${l?.data.label||"target"} is a bottleneck`,impact:"Limiting overall system throughput",suggestion:"Increase bandwidth or optimize data transfer between these components"}),a.backpressure>.7&&e.push({type:"optimization",priority:"high",connectionId:n,message:`High backpressure (${(a.backpressure*100).toFixed(0)}%) on connection`,impact:"Target component cannot process data fast enough",suggestion:"Scale target component or implement buffering/queuing"})}const t={critical:0,high:1,medium:2,low:3};e.sort((n,a)=>t[n.priority]-t[a.priority])}getComponentStatus(e){return this.componentStatuses.get(e)}getAllComponentStatuses(){return Array.from(this.componentStatuses.values())}getDependencies(e){return this.dependencyGraph.get(e)||[]}}const Ff=new Ek,fi=Cs((o,e)=>({componentStatuses:new Map,systemAnalysis:null,updateAnalysis:()=>{const{nodes:t,connections:n}=Re.getState(),{componentMetrics:a,connectionMetrics:r}=Dt.getState();Ff.update(t,n,a,r);const c=Ff.analyzeSystem(),l=new Map(Ff.getAllComponentStatuses().map(d=>[d.nodeId,d]));o({componentStatuses:l,systemAnalysis:c})},getComponentStatus:t=>e().componentStatuses.get(t),getAllComponentStatuses:()=>Array.from(e().componentStatuses.values()),getSystemAnalysis:()=>e().systemAnalysis})),Ph=Cs((o,e)=>(Na.onAlert(t=>{e().updateAlerts()}),{alerts:[],updateAlerts:()=>{const{nodes:t,connections:n}=Re.getState(),{componentMetrics:a,connectionMetrics:r}=Dt.getState(),c=fi.getState().getAllComponentStatuses();Na.analyze(t,a,r,c);const l=Na.getAlerts();o({alerts:l})},acknowledgeAlert:t=>{Na.acknowledge(t);const n=Na.getAlerts();o({alerts:n})},clearAlerts:()=>{Na.clear(),o({alerts:[]})},getCriticalAlerts:()=>e().alerts.filter(t=>t.type==="critical"),getWarningAlerts:()=>e().alerts.filter(t=>t.type==="warning")})),Dt=Cs((o,e)=>({isRunning:!1,simulationTime:0,updateInterval:100,componentMetrics:new Map,connectionMetrics:new Map,initialize:(t,n)=>{je.initialize(t,n),o({componentMetrics:new Map(je.getAllComponentMetrics().map(a=>[a.id,a])),connectionMetrics:new Map(je.getAllConnectionMetrics().map(a=>[a.id,a]))}),ja.getState().initialize(t,n)},start:()=>{console.log("useEmulationStore.start() called");try{const t=je.getIsRunning();console.log("Engine running state:",t),t&&(console.log("Stopping engine first..."),je.stop()),console.log("Calling emulationEngine.start()..."),je.start(),console.log("Engine started, setting store isRunning to true"),o({isRunning:!0}),console.log("Starting data flow..."),ja.getState().start(),console.log("Setting up polling interval...");const n=setInterval(()=>{e().updateMetrics()},e().updateInterval);je._pollInterval=n,console.log("Start complete, polling interval set")}catch(t){throw console.error("Error in useEmulationStore.start():",t),t}},stop:()=>{je.stop();const t=je._pollInterval;t&&clearInterval(t),ja.getState().stop(),o({isRunning:!1})},reset:()=>{je.resetSimulation();const t=je._pollInterval;t&&clearInterval(t),ja.getState().stop(),o({isRunning:!1,simulationTime:0,componentMetrics:new Map,connectionMetrics:new Map})},setUpdateInterval:t=>{o({updateInterval:t})},updateMetrics:()=>{const{nodes:t,connections:n}=Re.getState();je.updateNodesAndConnections(t,n),o(a=>({simulationTime:je.getSimulationTime(),componentMetrics:new Map(je.getAllComponentMetrics().map(r=>[r.id,r])),connectionMetrics:new Map(je.getAllConnectionMetrics().map(r=>[r.id,r]))})),ja.getState().updateMessages(t,n),fi.getState().updateAnalysis(),Ph.getState().updateAlerts()},getComponentMetrics:t=>e().componentMetrics.get(t),getConnectionMetrics:t=>e().connectionMetrics.get(t)}));const Rk=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Tk=o=>o.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),V0=o=>{const e=Tk(o);return e.charAt(0).toUpperCase()+e.slice(1)},ob=(...o)=>o.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),kk=o=>{for(const e in o)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var Ak={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Dk=w.forwardRef(({color:o="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:a="",children:r,iconNode:c,...l},d)=>w.createElement("svg",{ref:d,...Ak,width:e,height:e,stroke:o,strokeWidth:n?Number(t)*24/Number(e):t,className:ob("lucide",a),...!r&&!kk(l)&&{"aria-hidden":"true"},...l},[...c.map(([h,p])=>w.createElement(h,p)),...Array.isArray(r)?r:[r]]));const Ne=(o,e)=>{const t=w.forwardRef(({className:n,...a},r)=>w.createElement(Dk,{ref:r,iconNode:e,className:ob(`lucide-${Rk(V0(o))}`,`lucide-${o}`,n),...a}));return t.displayName=V0(o),t};const Nk=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],hi=Ne("activity",Nk);const _k=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],jk=Ne("arrow-down",_k);const Lk=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],zk=Ne("arrow-right",Lk);const Pk=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Ok=Ne("arrow-up",Pk);const Ik=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Oh=Ne("check",Ik);const qk=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Bl=Ne("chevron-down",qk);const Hk=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ih=Ne("chevron-right",Hk);const Bk=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],rb=Ne("chevron-up",Bk);const $k=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Rr=Ne("circle-alert",$k);const Uk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],qh=Ne("circle-check",Uk);const Qk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Fk=Ne("circle-question-mark",Qk);const Gk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],di=Ne("circle-x",Gk);const Vk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Kk=Ne("circle",Vk);const Yk=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],cb=Ne("copy",Yk);const Wk=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Xk=Ne("download",Wk);const Zk=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Jk=Ne("eye",Zk);const eA=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],K0=Ne("file-text",eA);const tA=[["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],nA=Ne("folder-minus",tA);const sA=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],ch=Ne("folder-plus",sA);const aA=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],iA=Ne("funnel",aA);const oA=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],rA=Ne("grip-vertical",oA);const cA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],lA=Ne("info",cA);const uA=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],lb=Ne("layers",uA);const dA=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],fA=Ne("map",dA);const hA=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],pA=Ne("maximize-2",hA);const gA=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],mA=Ne("network",gA);const yA=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],vA=Ne("pause",yA);const bA=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],xA=Ne("play",bA);const wA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],kl=Ne("plus",wA);const SA=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],bl=Ne("power-off",SA);const CA=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Gf=Ne("power",CA);const MA=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],EA=Ne("redo-2",MA);const RA=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],TA=Ne("refresh-cw",RA);const kA=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ub=Ne("rotate-ccw",kA);const AA=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],DA=Ne("ruler",AA);const NA=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],_A=Ne("save",NA);const jA=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$l=Ne("search",jA);const LA=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Vf=Ne("settings-2",LA);const zA=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],PA=Ne("settings",zA);const OA=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],IA=Ne("sparkles",OA);const qA=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],HA=Ne("square-pen",qA);const BA=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],$A=Ne("star",BA);const UA=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Hh=Ne("trash-2",UA);const QA=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],db=Ne("trending-down",QA);const FA=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ys=Ne("triangle-alert",FA);const GA=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],VA=Ne("undo-2",GA);const KA=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],YA=Ne("upload",KA);const WA=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],vs=Ne("x",WA);const XA=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],fb=Ne("zap",XA);const ZA=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],JA=Ne("zoom-in",ZA);const e2=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],t2=Ne("zoom-out",e2);function n2(){const{isRunning:o,simulationTime:e,initialize:t,start:n,stop:a,reset:r}=Dt(),{nodes:c,connections:l}=Re();w.useEffect(()=>{const y=je.getIsRunning();console.log("EmulationPanel mounted/updated",{storeIsRunning:o,engineIsRunning:y,simulationTime:e,nodesCount:c.length,connectionsCount:l.length}),o!==y&&(console.warn("State mismatch detected!",{storeIsRunning:o,engineIsRunning:y}),o&&!y?(console.log("Fixing: stopping store"),a()):!o&&y&&(console.log("Fixing: stopping engine"),je.stop()))},[o,e,c.length,l.length,a]);const d=()=>{console.log("handleStart called",{isRunning:o,simulationTime:e,nodesCount:c.length,connectionsCount:l.length});try{e===0&&(console.log("Initializing emulation..."),t(c,l),console.log("Initialization complete")),console.log("Starting emulation..."),n(),console.log("Start called, isRunning should be true now")}catch(y){console.error("Error starting emulation:",y)}},h=()=>{a()},p=()=>{r()},m=y=>{const b=Math.floor(y/1e3),S=Math.floor(b/60),C=b%60;return`${S}:${C.toString().padStart(2,"0")}`};return g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-sm text-muted-foreground w-12",children:m(e)}),g.jsx(Ae,{size:"sm",variant:o?"default":"outline",onClick:y=>{console.log("Button clicked!",{isRunning:o,simulationTime:e,disabled:o}),y.preventDefault(),y.stopPropagation(),o?console.warn("Button clicked but isRunning is true, button should be disabled"):d()},disabled:o,title:"Start emulation",style:{pointerEvents:o?"none":"auto"},children:g.jsx(xA,{className:"w-4 h-4"})}),g.jsx(Ae,{size:"sm",variant:o?"default":"outline",onClick:h,disabled:!o,title:"Stop emulation",children:g.jsx(vA,{className:"w-4 h-4"})}),g.jsx(Ae,{size:"sm",variant:"outline",onClick:p,title:"Reset simulation",children:g.jsx(ub,{className:"w-4 h-4"})})]})}const At=w.forwardRef(({className:o,type:e,...t},n)=>g.jsx("input",{type:e,className:Ee("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),ref:n,...t}));At.displayName="Input";function s2(o){const e=a2(o),t=w.forwardRef((n,a)=>{const{children:r,...c}=n,l=w.Children.toArray(r),d=l.find(o2);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}function a2(o){const e=w.forwardRef((t,n)=>{const{children:a,...r}=t;if(w.isValidElement(a)){const c=c2(a),l=r2(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var i2=Symbol("radix.slottable");function o2(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===i2}function r2(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function c2(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}var l2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ke=l2.reduce((o,e)=>{const t=s2(`Primitive.${e}`),n=w.forwardRef((a,r)=>{const{asChild:c,...l}=a,d=c?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:r})});return n.displayName=`Primitive.${e}`,{...o,[e]:n}},{});function hb(o,e){o&&Lr.flushSync(()=>o.dispatchEvent(e))}var sn=globalThis?.document?w.useLayoutEffect:()=>{};function u2(o,e){return w.useReducer((t,n)=>e[t][n]??t,o)}var rn=o=>{const{present:e,children:t}=o,n=d2(e),a=typeof t=="function"?t({present:n.isPresent}):w.Children.only(t),r=_e(n.ref,f2(a));return typeof t=="function"||n.isPresent?w.cloneElement(a,{ref:r}):null};rn.displayName="Presence";function d2(o){const[e,t]=w.useState(),n=w.useRef(null),a=w.useRef(o),r=w.useRef("none"),c=o?"mounted":"unmounted",[l,d]=u2(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return w.useEffect(()=>{const h=cl(n.current);r.current=l==="mounted"?h:"none"},[l]),sn(()=>{const h=n.current,p=a.current;if(p!==o){const y=r.current,b=cl(h);o?d("MOUNT"):b==="none"||h?.display==="none"?d("UNMOUNT"):d(p&&y!==b?"ANIMATION_OUT":"UNMOUNT"),a.current=o}},[o,d]),sn(()=>{if(e){let h;const p=e.ownerDocument.defaultView??window,m=b=>{const C=cl(n.current).includes(CSS.escape(b.animationName));if(b.target===e&&C&&(d("ANIMATION_END"),!a.current)){const E=e.style.animationFillMode;e.style.animationFillMode="forwards",h=p.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=E)})}},y=b=>{b.target===e&&(r.current=cl(n.current))};return e.addEventListener("animationstart",y),e.addEventListener("animationcancel",m),e.addEventListener("animationend",m),()=>{p.clearTimeout(h),e.removeEventListener("animationstart",y),e.removeEventListener("animationcancel",m),e.removeEventListener("animationend",m)}}else d("ANIMATION_END")},[e,d]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:w.useCallback(h=>{n.current=h?getComputedStyle(h):null,t(h)},[])}}function cl(o){return o?.animationName||"none"}function f2(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function h2(o,e){const t=w.createContext(e),n=r=>{const{children:c,...l}=r,d=w.useMemo(()=>l,Object.values(l));return g.jsx(t.Provider,{value:d,children:c})};n.displayName=o+"Provider";function a(r){const c=w.useContext(t);if(c)return c;if(e!==void 0)return e;throw new Error(`\`${r}\` must be used within \`${o}\``)}return[n,a]}function bn(o,e=[]){let t=[];function n(r,c){const l=w.createContext(c),d=t.length;t=[...t,c];const h=m=>{const{scope:y,children:b,...S}=m,C=y?.[o]?.[d]||l,E=w.useMemo(()=>S,Object.values(S));return g.jsx(C.Provider,{value:E,children:b})};h.displayName=r+"Provider";function p(m,y){const b=y?.[o]?.[d]||l,S=w.useContext(b);if(S)return S;if(c!==void 0)return c;throw new Error(`\`${m}\` must be used within \`${r}\``)}return[h,p]}const a=()=>{const r=t.map(c=>w.createContext(c));return function(l){const d=l?.[o]||r;return w.useMemo(()=>({[`__scope${o}`]:{...l,[o]:d}}),[l,d])}};return a.scopeName=o,[n,p2(a,...e)]}function p2(...o){const e=o[0];if(o.length===1)return e;const t=()=>{const n=o.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(r){const c=n.reduce((l,{useScope:d,scopeName:h})=>{const m=d(r)[`__scope${h}`];return{...l,...m}},{});return w.useMemo(()=>({[`__scope${e.scopeName}`]:c}),[c])}};return t.scopeName=e.scopeName,t}function nn(o){const e=w.useRef(o);return w.useEffect(()=>{e.current=o}),w.useMemo(()=>(...t)=>e.current?.(...t),[])}var g2=w.createContext(void 0);function So(o){const e=w.useContext(g2);return o||e||"ltr"}function Tr(o,[e,t]){return Math.min(t,Math.max(e,o))}function ge(o,e,{checkForDefaultPrevented:t=!0}={}){return function(a){if(o?.(a),t===!1||!a.defaultPrevented)return e?.(a)}}function m2(o,e){return w.useReducer((t,n)=>e[t][n]??t,o)}var Bh="ScrollArea",[pb]=bn(Bh),[y2,Kn]=pb(Bh),gb=w.forwardRef((o,e)=>{const{__scopeScrollArea:t,type:n="hover",dir:a,scrollHideDelay:r=600,...c}=o,[l,d]=w.useState(null),[h,p]=w.useState(null),[m,y]=w.useState(null),[b,S]=w.useState(null),[C,E]=w.useState(null),[M,k]=w.useState(0),[T,A]=w.useState(0),[N,q]=w.useState(!1),[O,H]=w.useState(!1),J=_e(e,ce=>d(ce)),se=So(a);return g.jsx(y2,{scope:t,type:n,dir:se,scrollHideDelay:r,scrollArea:l,viewport:h,onViewportChange:p,content:m,onContentChange:y,scrollbarX:b,onScrollbarXChange:S,scrollbarXEnabled:N,onScrollbarXEnabledChange:q,scrollbarY:C,onScrollbarYChange:E,scrollbarYEnabled:O,onScrollbarYEnabledChange:H,onCornerWidthChange:k,onCornerHeightChange:A,children:g.jsx(ke.div,{dir:se,...c,ref:J,style:{position:"relative","--radix-scroll-area-corner-width":M+"px","--radix-scroll-area-corner-height":T+"px",...o.style}})})});gb.displayName=Bh;var mb="ScrollAreaViewport",yb=w.forwardRef((o,e)=>{const{__scopeScrollArea:t,children:n,nonce:a,...r}=o,c=Kn(mb,t),l=w.useRef(null),d=_e(e,l,c.onViewportChange);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),g.jsx(ke.div,{"data-radix-scroll-area-viewport":"",...r,ref:d,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...o.style},children:g.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});yb.displayName=mb;var Ms="ScrollAreaScrollbar",$h=w.forwardRef((o,e)=>{const{forceMount:t,...n}=o,a=Kn(Ms,o.__scopeScrollArea),{onScrollbarXEnabledChange:r,onScrollbarYEnabledChange:c}=a,l=o.orientation==="horizontal";return w.useEffect(()=>(l?r(!0):c(!0),()=>{l?r(!1):c(!1)}),[l,r,c]),a.type==="hover"?g.jsx(v2,{...n,ref:e,forceMount:t}):a.type==="scroll"?g.jsx(b2,{...n,ref:e,forceMount:t}):a.type==="auto"?g.jsx(vb,{...n,ref:e,forceMount:t}):a.type==="always"?g.jsx(Uh,{...n,ref:e}):null});$h.displayName=Ms;var v2=w.forwardRef((o,e)=>{const{forceMount:t,...n}=o,a=Kn(Ms,o.__scopeScrollArea),[r,c]=w.useState(!1);return w.useEffect(()=>{const l=a.scrollArea;let d=0;if(l){const h=()=>{window.clearTimeout(d),c(!0)},p=()=>{d=window.setTimeout(()=>c(!1),a.scrollHideDelay)};return l.addEventListener("pointerenter",h),l.addEventListener("pointerleave",p),()=>{window.clearTimeout(d),l.removeEventListener("pointerenter",h),l.removeEventListener("pointerleave",p)}}},[a.scrollArea,a.scrollHideDelay]),g.jsx(rn,{present:t||r,children:g.jsx(vb,{"data-state":r?"visible":"hidden",...n,ref:e})})}),b2=w.forwardRef((o,e)=>{const{forceMount:t,...n}=o,a=Kn(Ms,o.__scopeScrollArea),r=o.orientation==="horizontal",c=Ql(()=>d("SCROLL_END"),100),[l,d]=m2("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return w.useEffect(()=>{if(l==="idle"){const h=window.setTimeout(()=>d("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(h)}},[l,a.scrollHideDelay,d]),w.useEffect(()=>{const h=a.viewport,p=r?"scrollLeft":"scrollTop";if(h){let m=h[p];const y=()=>{const b=h[p];m!==b&&(d("SCROLL"),c()),m=b};return h.addEventListener("scroll",y),()=>h.removeEventListener("scroll",y)}},[a.viewport,r,d,c]),g.jsx(rn,{present:t||l!=="hidden",children:g.jsx(Uh,{"data-state":l==="hidden"?"hidden":"visible",...n,ref:e,onPointerEnter:ge(o.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:ge(o.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),vb=w.forwardRef((o,e)=>{const t=Kn(Ms,o.__scopeScrollArea),{forceMount:n,...a}=o,[r,c]=w.useState(!1),l=o.orientation==="horizontal",d=Ql(()=>{if(t.viewport){const h=t.viewport.offsetWidth<t.viewport.scrollWidth,p=t.viewport.offsetHeight<t.viewport.scrollHeight;c(l?h:p)}},10);return mo(t.viewport,d),mo(t.content,d),g.jsx(rn,{present:n||r,children:g.jsx(Uh,{"data-state":r?"visible":"hidden",...a,ref:e})})}),Uh=w.forwardRef((o,e)=>{const{orientation:t="vertical",...n}=o,a=Kn(Ms,o.__scopeScrollArea),r=w.useRef(null),c=w.useRef(0),[l,d]=w.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),h=Cb(l.viewport,l.content),p={...n,sizes:l,onSizesChange:d,hasThumb:h>0&&h<1,onThumbChange:y=>r.current=y,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:y=>c.current=y};function m(y,b){return E2(y,c.current,l,b)}return t==="horizontal"?g.jsx(x2,{...p,ref:e,onThumbPositionChange:()=>{if(a.viewport&&r.current){const y=a.viewport.scrollLeft,b=Y0(y,l,a.dir);r.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:y=>{a.viewport&&(a.viewport.scrollLeft=y)},onDragScroll:y=>{a.viewport&&(a.viewport.scrollLeft=m(y,a.dir))}}):t==="vertical"?g.jsx(w2,{...p,ref:e,onThumbPositionChange:()=>{if(a.viewport&&r.current){const y=a.viewport.scrollTop,b=Y0(y,l);r.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:y=>{a.viewport&&(a.viewport.scrollTop=y)},onDragScroll:y=>{a.viewport&&(a.viewport.scrollTop=m(y))}}):null}),x2=w.forwardRef((o,e)=>{const{sizes:t,onSizesChange:n,...a}=o,r=Kn(Ms,o.__scopeScrollArea),[c,l]=w.useState(),d=w.useRef(null),h=_e(e,d,r.onScrollbarXChange);return w.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),g.jsx(xb,{"data-orientation":"horizontal",...a,ref:h,sizes:t,style:{bottom:0,left:r.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:r.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Ul(t)+"px",...o.style},onThumbPointerDown:p=>o.onThumbPointerDown(p.x),onDragScroll:p=>o.onDragScroll(p.x),onWheelScroll:(p,m)=>{if(r.viewport){const y=r.viewport.scrollLeft+p.deltaX;o.onWheelScroll(y),Eb(y,m)&&p.preventDefault()}},onResize:()=>{d.current&&r.viewport&&c&&n({content:r.viewport.scrollWidth,viewport:r.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:Dl(c.paddingLeft),paddingEnd:Dl(c.paddingRight)}})}})}),w2=w.forwardRef((o,e)=>{const{sizes:t,onSizesChange:n,...a}=o,r=Kn(Ms,o.__scopeScrollArea),[c,l]=w.useState(),d=w.useRef(null),h=_e(e,d,r.onScrollbarYChange);return w.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),g.jsx(xb,{"data-orientation":"vertical",...a,ref:h,sizes:t,style:{top:0,right:r.dir==="ltr"?0:void 0,left:r.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Ul(t)+"px",...o.style},onThumbPointerDown:p=>o.onThumbPointerDown(p.y),onDragScroll:p=>o.onDragScroll(p.y),onWheelScroll:(p,m)=>{if(r.viewport){const y=r.viewport.scrollTop+p.deltaY;o.onWheelScroll(y),Eb(y,m)&&p.preventDefault()}},onResize:()=>{d.current&&r.viewport&&c&&n({content:r.viewport.scrollHeight,viewport:r.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:Dl(c.paddingTop),paddingEnd:Dl(c.paddingBottom)}})}})}),[S2,bb]=pb(Ms),xb=w.forwardRef((o,e)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:a,onThumbChange:r,onThumbPointerUp:c,onThumbPointerDown:l,onThumbPositionChange:d,onDragScroll:h,onWheelScroll:p,onResize:m,...y}=o,b=Kn(Ms,t),[S,C]=w.useState(null),E=_e(e,J=>C(J)),M=w.useRef(null),k=w.useRef(""),T=b.viewport,A=n.content-n.viewport,N=nn(p),q=nn(d),O=Ql(m,10);function H(J){if(M.current){const se=J.clientX-M.current.left,ce=J.clientY-M.current.top;h({x:se,y:ce})}}return w.useEffect(()=>{const J=se=>{const ce=se.target;S?.contains(ce)&&N(se,A)};return document.addEventListener("wheel",J,{passive:!1}),()=>document.removeEventListener("wheel",J,{passive:!1})},[T,S,A,N]),w.useEffect(q,[n,q]),mo(S,O),mo(b.content,O),g.jsx(S2,{scope:t,scrollbar:S,hasThumb:a,onThumbChange:nn(r),onThumbPointerUp:nn(c),onThumbPositionChange:q,onThumbPointerDown:nn(l),children:g.jsx(ke.div,{...y,ref:E,style:{position:"absolute",...y.style},onPointerDown:ge(o.onPointerDown,J=>{J.button===0&&(J.target.setPointerCapture(J.pointerId),M.current=S.getBoundingClientRect(),k.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),H(J))}),onPointerMove:ge(o.onPointerMove,H),onPointerUp:ge(o.onPointerUp,J=>{const se=J.target;se.hasPointerCapture(J.pointerId)&&se.releasePointerCapture(J.pointerId),document.body.style.webkitUserSelect=k.current,b.viewport&&(b.viewport.style.scrollBehavior=""),M.current=null})})})}),Al="ScrollAreaThumb",wb=w.forwardRef((o,e)=>{const{forceMount:t,...n}=o,a=bb(Al,o.__scopeScrollArea);return g.jsx(rn,{present:t||a.hasThumb,children:g.jsx(C2,{ref:e,...n})})}),C2=w.forwardRef((o,e)=>{const{__scopeScrollArea:t,style:n,...a}=o,r=Kn(Al,t),c=bb(Al,t),{onThumbPositionChange:l}=c,d=_e(e,m=>c.onThumbChange(m)),h=w.useRef(void 0),p=Ql(()=>{h.current&&(h.current(),h.current=void 0)},100);return w.useEffect(()=>{const m=r.viewport;if(m){const y=()=>{if(p(),!h.current){const b=R2(m,l);h.current=b,l()}};return l(),m.addEventListener("scroll",y),()=>m.removeEventListener("scroll",y)}},[r.viewport,p,l]),g.jsx(ke.div,{"data-state":c.hasThumb?"visible":"hidden",...a,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:ge(o.onPointerDownCapture,m=>{const b=m.target.getBoundingClientRect(),S=m.clientX-b.left,C=m.clientY-b.top;c.onThumbPointerDown({x:S,y:C})}),onPointerUp:ge(o.onPointerUp,c.onThumbPointerUp)})});wb.displayName=Al;var Qh="ScrollAreaCorner",Sb=w.forwardRef((o,e)=>{const t=Kn(Qh,o.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?g.jsx(M2,{...o,ref:e}):null});Sb.displayName=Qh;var M2=w.forwardRef((o,e)=>{const{__scopeScrollArea:t,...n}=o,a=Kn(Qh,t),[r,c]=w.useState(0),[l,d]=w.useState(0),h=!!(r&&l);return mo(a.scrollbarX,()=>{const p=a.scrollbarX?.offsetHeight||0;a.onCornerHeightChange(p),d(p)}),mo(a.scrollbarY,()=>{const p=a.scrollbarY?.offsetWidth||0;a.onCornerWidthChange(p),c(p)}),h?g.jsx(ke.div,{...n,ref:e,style:{width:r,height:l,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...o.style}}):null});function Dl(o){return o?parseInt(o,10):0}function Cb(o,e){const t=o/e;return isNaN(t)?0:t}function Ul(o){const e=Cb(o.viewport,o.content),t=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,n=(o.scrollbar.size-t)*e;return Math.max(n,18)}function E2(o,e,t,n="ltr"){const a=Ul(t),r=a/2,c=e||r,l=a-c,d=t.scrollbar.paddingStart+c,h=t.scrollbar.size-t.scrollbar.paddingEnd-l,p=t.content-t.viewport,m=n==="ltr"?[0,p]:[p*-1,0];return Mb([d,h],m)(o)}function Y0(o,e,t="ltr"){const n=Ul(e),a=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,r=e.scrollbar.size-a,c=e.content-e.viewport,l=r-n,d=t==="ltr"?[0,c]:[c*-1,0],h=Tr(o,d);return Mb([0,c],[0,l])(h)}function Mb(o,e){return t=>{if(o[0]===o[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(o[1]-o[0]);return e[0]+n*(t-o[0])}}function Eb(o,e){return o>0&&o<e}var R2=(o,e=()=>{})=>{let t={left:o.scrollLeft,top:o.scrollTop},n=0;return(function a(){const r={left:o.scrollLeft,top:o.scrollTop},c=t.left!==r.left,l=t.top!==r.top;(c||l)&&e(),t=r,n=window.requestAnimationFrame(a)})(),()=>window.cancelAnimationFrame(n)};function Ql(o,e){const t=nn(o),n=w.useRef(0);return w.useEffect(()=>()=>window.clearTimeout(n.current),[]),w.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,e)},[t,e])}function mo(o,e){const t=nn(e);sn(()=>{let n=0;if(o){const a=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return a.observe(o),()=>{window.cancelAnimationFrame(n),a.unobserve(o)}}},[o,t])}var Rb=gb,T2=yb,k2=Sb;const on=w.forwardRef(({className:o,children:e,...t},n)=>g.jsxs(Rb,{ref:n,className:Ee("relative overflow-hidden",o),scrollHideDelay:0,...t,children:[g.jsx(T2,{className:"h-full w-full rounded-[inherit]",children:e}),g.jsx(Fl,{}),g.jsx(k2,{})]}));on.displayName=Rb.displayName;const Fl=w.forwardRef(({className:o,orientation:e="vertical",...t},n)=>g.jsx($h,{ref:n,orientation:e,className:Ee("flex touch-none select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]","data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30","[&[data-state=hidden]]:opacity-0 [&[data-state=visible]]:opacity-100",o),style:{transition:"none !important",transitionDelay:"0ms !important",transitionDuration:"0ms !important"},...t,children:g.jsx(wb,{className:"relative flex-1 rounded-full bg-accent/80 hover:bg-accent",style:{transition:"none !important"}})}));Fl.displayName=$h.displayName;const zr=Cs(o=>({showMinimap:!0,setShowMinimap:e=>o({showMinimap:e}),toggleMinimap:()=>o(e=>({showMinimap:!e.showMinimap})),showHeatMapLegend:!0,setShowHeatMapLegend:e=>o({showHeatMapLegend:e}),toggleHeatMapLegend:()=>o(e=>({showHeatMapLegend:!e.showHeatMapLegend})),showRuler:!1,setShowRuler:e=>o({showRuler:e}),toggleRuler:()=>o(e=>({showRuler:!e.showRuler})),autoCenterOnSelect:!0,setAutoCenterOnSelect:e=>o({autoCenterOnSelect:e}),searchQuery:"",setSearchQuery:e=>o({searchQuery:e}),highlightedNodeId:null,setHighlightedNodeId:e=>o({highlightedNodeId:e})})),kr=[{id:"kafka",type:"kafka",label:"Apache Kafka",icon:"",color:"#000000",category:"messaging"},{id:"rabbitmq",type:"rabbitmq",label:"RabbitMQ",icon:"",color:"#FF6600",category:"messaging"},{id:"activemq",type:"activemq",label:"ActiveMQ",icon:"",color:"#A1005A",category:"messaging"},{id:"aws-sqs",type:"aws-sqs",label:"AWS SQS",icon:"",color:"#FF9900",category:"messaging"},{id:"azure-service-bus",type:"azure-service-bus",label:"Azure Service Bus",icon:"",color:"#0078D7",category:"messaging"},{id:"gcp-pubsub",type:"gcp-pubsub",label:"Google Pub/Sub",icon:"",color:"#4285F4",category:"messaging"},{id:"kong",type:"kong",label:"Kong Gateway",icon:"",color:"#003459",category:"integration"},{id:"apigee",type:"apigee",label:"Apigee",icon:"",color:"#F26522",category:"integration"},{id:"mulesoft",type:"mulesoft",label:"MuleSoft",icon:"",color:"#00A0DF",category:"integration"},{id:"graphql-gateway",type:"graphql-gateway",label:"GraphQL Gateway",icon:"",color:"#E10098",category:"integration"},{id:"bff-service",type:"bff-service",label:"BFF Service",icon:"",color:"#6C5CE7",category:"integration"},{id:"webhook-relay",type:"webhook-relay",label:"Webhook Relay",icon:"",color:"#1ABC9C",category:"integration"},{id:"postgres",type:"postgres",label:"PostgreSQL",icon:"",color:"#336791",category:"data"},{id:"mongodb",type:"mongodb",label:"MongoDB",icon:"",color:"#47A248",category:"data"},{id:"redis",type:"redis",label:"Redis",icon:"",color:"#DC382D",category:"data"},{id:"cassandra",type:"cassandra",label:"Apache Cassandra",icon:"",color:"#1287B1",category:"data"},{id:"clickhouse",type:"clickhouse",label:"ClickHouse",icon:"",color:"#FFCC00",category:"data"},{id:"snowflake",type:"snowflake",label:"Snowflake",icon:"",color:"#29B5E8",category:"data"},{id:"elasticsearch",type:"elasticsearch",label:"Elasticsearch",icon:"",color:"#00A79D",category:"data"},{id:"s3-datalake",type:"s3-datalake",label:"S3 Data Lake",icon:"",color:"#FF9900",category:"data"},{id:"prometheus",type:"prometheus",label:"Prometheus",icon:"",color:"#E6522C",category:"observability"},{id:"grafana",type:"grafana",label:"Grafana",icon:"",color:"#F56815",category:"observability"},{id:"loki",type:"loki",label:"Loki",icon:"",color:"#7CBA3C",category:"observability"},{id:"jaeger",type:"jaeger",label:"Jaeger",icon:"",color:"#65D6AD",category:"observability"},{id:"otel-collector",type:"otel-collector",label:"OpenTelemetry Collector",icon:"",color:"#6E56CF",category:"observability"},{id:"pagerduty",type:"pagerduty",label:"PagerDuty",icon:"",color:"#06AC38",category:"observability"},{id:"keycloak",type:"keycloak",label:"Keycloak",icon:"",color:"#5C6BC0",category:"security"},{id:"waf",type:"waf",label:"WAF / API Shield",icon:"",color:"#F44336",category:"security"},{id:"firewall",type:"firewall",label:"Firewall",icon:"",color:"#FF7043",category:"security"},{id:"secrets-vault",type:"secrets-vault",label:"Secrets Vault",icon:"",color:"#009688",category:"security"},{id:"ids-ips",type:"ids-ips",label:"IDS / IPS",icon:"",color:"#512DA8",category:"security"},{id:"jenkins",type:"jenkins",label:"Jenkins",icon:"",color:"#D24939",category:"devops"},{id:"gitlab-ci",type:"gitlab-ci",label:"GitLab CI",icon:"",color:"#FC6D26",category:"devops"},{id:"argo-cd",type:"argo-cd",label:"Argo CD",icon:"",color:"#EF7B45",category:"devops"},{id:"terraform",type:"terraform",label:"Terraform",icon:"",color:"#7B42BC",category:"devops"},{id:"ansible",type:"ansible",label:"Ansible",icon:"",color:"#000000",category:"devops"},{id:"harbor",type:"harbor",label:"Harbor Registry",icon:"",color:"#3BC1C4",category:"devops"},{id:"nginx",type:"nginx",label:"NGINX",icon:"",color:"#009639",category:"infrastructure"},{id:"docker",type:"docker",label:"Docker",icon:"",color:"#2496ED",category:"infrastructure"},{id:"kubernetes",type:"kubernetes",label:"Kubernetes",icon:"",color:"#326CE5",category:"infrastructure"},{id:"haproxy",type:"haproxy",label:"HAProxy",icon:"",color:"#009FDF",category:"infrastructure"},{id:"envoy",type:"envoy",label:"Envoy Proxy",icon:"",color:"#D63384",category:"infrastructure"},{id:"traefik",type:"traefik",label:"Traefik",icon:"",color:"#24A1DE",category:"infrastructure"},{id:"istio",type:"istio",label:"Istio Mesh",icon:"",color:"#466BB0",category:"edge"},{id:"service-mesh",type:"service-mesh",label:"Service Mesh",icon:"",color:"#5E81AC",category:"edge"},{id:"api-gateway",type:"api-gateway",label:"Cloud API Gateway",icon:"",color:"#FFB300",category:"edge"},{id:"vpn",type:"vpn",label:"VPN Concentrator",icon:"",color:"#2D9CDB",category:"edge"},{id:"cdn",type:"cdn",label:"CDN Edge",icon:"",color:"#FF5A5F",category:"edge"},{id:"rest",type:"rest",label:"REST API",icon:"",color:"#61DAFB",category:"api"},{id:"grpc",type:"grpc",label:"gRPC",icon:"",color:"#244C5A",category:"api"},{id:"graphql",type:"graphql",label:"GraphQL",icon:"",color:"#DE33A6",category:"api"},{id:"soap",type:"soap",label:"SOAP",icon:"",color:"#2196F3",category:"api"},{id:"websocket",type:"websocket",label:"WebSocket",icon:"",color:"#010101",category:"api"},{id:"webhook",type:"webhook",label:"Webhook Endpoint",icon:"",color:"#0FA3B1",category:"api"},{id:"spark",type:"spark",label:"Apache Spark",icon:"",color:"#E25A1C",category:"ml"},{id:"tensorflow-serving",type:"tensorflow-serving",label:"TensorFlow Serving",icon:"",color:"#FF6F00",category:"ml"},{id:"pytorch-serve",type:"pytorch-serve",label:"PyTorch Serve",icon:"",color:"#EE4C2C",category:"ml"},{id:"mlflow",type:"mlflow",label:"MLflow",icon:"",color:"#4285F4",category:"ml"},{id:"feature-store",type:"feature-store",label:"Feature Store",icon:"",color:"#8E44AD",category:"ml"},{id:"crm",type:"crm",label:"CRM System",icon:"",color:"#F39C12",category:"business"},{id:"erp",type:"erp",label:"ERP / SAP",icon:"",color:"#1B75BC",category:"business"},{id:"payment-gateway",type:"payment-gateway",label:"Payment Gateway",icon:"",color:"#4CAF50",category:"business"},{id:"bpmn-engine",type:"bpmn-engine",label:"BPMN Engine",icon:"",color:"#34495E",category:"business"},{id:"rpa-bot",type:"rpa-bot",label:"RPA Bot",icon:"",color:"#9B59B6",category:"business"}],xr=[{id:"messaging",label:"Messaging & Event Bus",icon:""},{id:"integration",label:"Integration & API",icon:""},{id:"data",label:"Data & Storage",icon:""},{id:"observability",label:"Observability",icon:""},{id:"security",label:"Security & IAM",icon:""},{id:"devops",label:"DevOps & Platform",icon:""},{id:"infrastructure",label:"Runtime & Infra",icon:""},{id:"edge",label:"Edge & Networking",icon:""},{id:"api",label:"Protocols & APIs",icon:""},{id:"ml",label:"ML & Analytics",icon:""},{id:"business",label:"Business Systems",icon:""}];function A2(){const{nodes:o,selectNode:e,zoom:t,pan:n,setPan:a,setZoom:r}=Re(),{searchQuery:c,setSearchQuery:l,highlightedNodeId:d,setHighlightedNodeId:h}=zr(),[p,m]=w.useState(!1),y=w.useRef(null);w.useEffect(()=>{const C=E=>{y.current&&!y.current.contains(E.target)&&m(!1)};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[]);const b=w.useMemo(()=>{if(!c.trim())return[];const C=c.toLowerCase();return o.filter(E=>{const M=kr.find(N=>N.type===E.type),k=E.data?.label||"",T=E.type||"",A=M?.category||"";return k.toLowerCase().includes(C)||T.toLowerCase().includes(C)||A.toLowerCase().includes(C)})},[o,c]),S=C=>{e(C),h(C);const E=o.find(M=>M.id===C);if(E&&p){const M=window.innerWidth/2,k=window.innerHeight/2,T=E.position.x+70,A=E.position.y+70,N=M-T*t,q=k-A*t;a({x:N,y:q}),t<.8&&r(1)}setTimeout(()=>h(null),2e3)};return g.jsxs("div",{className:"relative",ref:y,children:[g.jsxs("div",{className:"relative",children:[g.jsx($l,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),g.jsx(At,{type:"text",placeholder:"Search components...",value:c,onChange:C=>{l(C.target.value),m(!0)},onFocus:()=>m(!0),className:"pl-8 pr-8 w-64"}),c&&g.jsx(Ae,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>{l(""),m(!1),h(null)},children:g.jsx(vs,{className:"h-3 w-3"})})]}),p&&c&&g.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-card border border-border rounded-md shadow-lg z-50 max-h-80 overflow-hidden",children:b.length>0?g.jsx(on,{className:"max-h-80",children:g.jsx("div",{className:"p-1",children:b.map(C=>{const E=kr.find(k=>k.type===C.type),M=d===C.id;return g.jsxs("button",{onClick:()=>S(C.id),className:Ee("w-full text-left px-3 py-2 rounded-sm hover:bg-accent transition-colors flex items-center justify-between",M&&"bg-accent"),children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:C.data?.label||C.type}),g.jsxs("div",{className:"text-xs text-muted-foreground truncate",children:[E?.category||"Unknown","  ",C.type]})]}),g.jsx(Ih,{className:"h-4 w-4 text-muted-foreground flex-shrink-0 ml-2"})]},C.id)})})}):g.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No components found"})})]})}function D2(o){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.appendChild(t),t.styleSheet?t.styleSheet.cssText=o:t.appendChild(document.createTextNode(o))}Array(12).fill(0);let lh=1;class N2{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;const{message:n,...a}=e,r=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:lh++,c=this.toasts.find(d=>d.id===r),l=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(r)&&this.dismissedToasts.delete(r),c?this.toasts=this.toasts.map(d=>d.id===r?(this.publish({...d,...e,id:r,title:n}),{...d,...e,id:r,dismissible:l,title:n}):d):this.addToast({title:n,...a,dismissible:l,id:r}),r},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(t=>t({id:e,dismiss:!0})))):this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));const a=Promise.resolve(e instanceof Function?e():e);let r=n!==void 0,c;const l=a.then(async h=>{if(c=["resolve",h],Et.isValidElement(h))r=!1,this.create({id:n,type:"default",message:h});else if(j2(h)&&!h.ok){r=!1;const m=typeof t.error=="function"?await t.error(`HTTP error! status: ${h.status}`):t.error,y=typeof t.description=="function"?await t.description(`HTTP error! status: ${h.status}`):t.description,S=typeof m=="object"&&!Et.isValidElement(m)?m:{message:m};this.create({id:n,type:"error",description:y,...S})}else if(h instanceof Error){r=!1;const m=typeof t.error=="function"?await t.error(h):t.error,y=typeof t.description=="function"?await t.description(h):t.description,S=typeof m=="object"&&!Et.isValidElement(m)?m:{message:m};this.create({id:n,type:"error",description:y,...S})}else if(t.success!==void 0){r=!1;const m=typeof t.success=="function"?await t.success(h):t.success,y=typeof t.description=="function"?await t.description(h):t.description,S=typeof m=="object"&&!Et.isValidElement(m)?m:{message:m};this.create({id:n,type:"success",description:y,...S})}}).catch(async h=>{if(c=["reject",h],t.error!==void 0){r=!1;const p=typeof t.error=="function"?await t.error(h):t.error,m=typeof t.description=="function"?await t.description(h):t.description,b=typeof p=="object"&&!Et.isValidElement(p)?p:{message:p};this.create({id:n,type:"error",description:m,...b})}}).finally(()=>{r&&(this.dismiss(n),n=void 0),t.finally==null||t.finally.call(t)}),d=()=>new Promise((h,p)=>l.then(()=>c[0]==="reject"?p(c[1]):h(c[1])).catch(p));return typeof n!="string"&&typeof n!="number"?{unwrap:d}:Object.assign(n,{unwrap:d})},this.custom=(e,t)=>{const n=t?.id||lh++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Fn=new N2,_2=(o,e)=>{const t=e?.id||lh++;return Fn.addToast({title:o,...e,id:t}),t},j2=o=>o&&typeof o=="object"&&"ok"in o&&typeof o.ok=="boolean"&&"status"in o&&typeof o.status=="number",L2=_2,z2=()=>Fn.toasts,P2=()=>Fn.getActiveToasts(),Ye=Object.assign(L2,{success:Fn.success,info:Fn.info,warning:Fn.warning,error:Fn.error,custom:Fn.custom,message:Fn.message,promise:Fn.promise,dismiss:Fn.dismiss,loading:Fn.loading},{getHistory:z2,getToasts:P2});D2("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");var O2=Ah[" useId ".trim().toString()]||(()=>{}),I2=0;function ns(o){const[e,t]=w.useState(O2());return sn(()=>{t(n=>n??String(I2++))},[o]),e?`radix-${e}`:""}var q2=Ah[" useInsertionEffect ".trim().toString()]||sn;function xs({prop:o,defaultProp:e,onChange:t=()=>{},caller:n}){const[a,r,c]=H2({defaultProp:e,onChange:t}),l=o!==void 0,d=l?o:a;{const p=w.useRef(o!==void 0);w.useEffect(()=>{const m=p.current;m!==l&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=l},[l,n])}const h=w.useCallback(p=>{if(l){const m=B2(p)?p(o):p;m!==o&&c.current?.(m)}else r(p)},[l,o,r,c]);return[d,h]}function H2({defaultProp:o,onChange:e}){const[t,n]=w.useState(o),a=w.useRef(t),r=w.useRef(e);return q2(()=>{r.current=e},[e]),w.useEffect(()=>{a.current!==t&&(r.current?.(t),a.current=t)},[t,a]),[t,n,r]}function B2(o){return typeof o=="function"}function $2(o,e=globalThis?.document){const t=nn(o);w.useEffect(()=>{const n=a=>{a.key==="Escape"&&t(a)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var U2="DismissableLayer",uh="dismissableLayer.update",Q2="dismissableLayer.pointerDownOutside",F2="dismissableLayer.focusOutside",W0,Tb=w.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Pr=w.forwardRef((o,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:a,onFocusOutside:r,onInteractOutside:c,onDismiss:l,...d}=o,h=w.useContext(Tb),[p,m]=w.useState(null),y=p?.ownerDocument??globalThis?.document,[,b]=w.useState({}),S=_e(e,O=>m(O)),C=Array.from(h.layers),[E]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),M=C.indexOf(E),k=p?C.indexOf(p):-1,T=h.layersWithOutsidePointerEventsDisabled.size>0,A=k>=M,N=K2(O=>{const H=O.target,J=[...h.branches].some(se=>se.contains(H));!A||J||(a?.(O),c?.(O),O.defaultPrevented||l?.())},y),q=Y2(O=>{const H=O.target;[...h.branches].some(se=>se.contains(H))||(r?.(O),c?.(O),O.defaultPrevented||l?.())},y);return $2(O=>{k===h.layers.size-1&&(n?.(O),!O.defaultPrevented&&l&&(O.preventDefault(),l()))},y),w.useEffect(()=>{if(p)return t&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(W0=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(p)),h.layers.add(p),X0(),()=>{t&&h.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=W0)}},[p,y,t,h]),w.useEffect(()=>()=>{p&&(h.layers.delete(p),h.layersWithOutsidePointerEventsDisabled.delete(p),X0())},[p,h]),w.useEffect(()=>{const O=()=>b({});return document.addEventListener(uh,O),()=>document.removeEventListener(uh,O)},[]),g.jsx(ke.div,{...d,ref:S,style:{pointerEvents:T?A?"auto":"none":void 0,...o.style},onFocusCapture:ge(o.onFocusCapture,q.onFocusCapture),onBlurCapture:ge(o.onBlurCapture,q.onBlurCapture),onPointerDownCapture:ge(o.onPointerDownCapture,N.onPointerDownCapture)})});Pr.displayName=U2;var G2="DismissableLayerBranch",V2=w.forwardRef((o,e)=>{const t=w.useContext(Tb),n=w.useRef(null),a=_e(e,n);return w.useEffect(()=>{const r=n.current;if(r)return t.branches.add(r),()=>{t.branches.delete(r)}},[t.branches]),g.jsx(ke.div,{...o,ref:a})});V2.displayName=G2;function K2(o,e=globalThis?.document){const t=nn(o),n=w.useRef(!1),a=w.useRef(()=>{});return w.useEffect(()=>{const r=l=>{if(l.target&&!n.current){let d=function(){kb(Q2,t,h,{discrete:!0})};const h={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",a.current),a.current=d,e.addEventListener("click",a.current,{once:!0})):d()}else e.removeEventListener("click",a.current);n.current=!1},c=window.setTimeout(()=>{e.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(c),e.removeEventListener("pointerdown",r),e.removeEventListener("click",a.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function Y2(o,e=globalThis?.document){const t=nn(o),n=w.useRef(!1);return w.useEffect(()=>{const a=r=>{r.target&&!n.current&&kb(F2,t,{originalEvent:r},{discrete:!1})};return e.addEventListener("focusin",a),()=>e.removeEventListener("focusin",a)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function X0(){const o=new CustomEvent(uh);document.dispatchEvent(o)}function kb(o,e,t,{discrete:n}){const a=t.originalEvent.target,r=new CustomEvent(o,{bubbles:!1,cancelable:!0,detail:t});e&&a.addEventListener(o,e,{once:!0}),n?hb(a,r):a.dispatchEvent(r)}var Kf="focusScope.autoFocusOnMount",Yf="focusScope.autoFocusOnUnmount",Z0={bubbles:!1,cancelable:!0},W2="FocusScope",Or=w.forwardRef((o,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:r,...c}=o,[l,d]=w.useState(null),h=nn(a),p=nn(r),m=w.useRef(null),y=_e(e,C=>d(C)),b=w.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;w.useEffect(()=>{if(n){let C=function(T){if(b.paused||!l)return;const A=T.target;l.contains(A)?m.current=A:Da(m.current,{select:!0})},E=function(T){if(b.paused||!l)return;const A=T.relatedTarget;A!==null&&(l.contains(A)||Da(m.current,{select:!0}))},M=function(T){if(document.activeElement===document.body)for(const N of T)N.removedNodes.length>0&&Da(l)};document.addEventListener("focusin",C),document.addEventListener("focusout",E);const k=new MutationObserver(M);return l&&k.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",C),document.removeEventListener("focusout",E),k.disconnect()}}},[n,l,b.paused]),w.useEffect(()=>{if(l){ev.add(b);const C=document.activeElement;if(!l.contains(C)){const M=new CustomEvent(Kf,Z0);l.addEventListener(Kf,h),l.dispatchEvent(M),M.defaultPrevented||(X2(nD(Ab(l)),{select:!0}),document.activeElement===C&&Da(l))}return()=>{l.removeEventListener(Kf,h),setTimeout(()=>{const M=new CustomEvent(Yf,Z0);l.addEventListener(Yf,p),l.dispatchEvent(M),M.defaultPrevented||Da(C??document.body,{select:!0}),l.removeEventListener(Yf,p),ev.remove(b)},0)}}},[l,h,p,b]);const S=w.useCallback(C=>{if(!t&&!n||b.paused)return;const E=C.key==="Tab"&&!C.altKey&&!C.ctrlKey&&!C.metaKey,M=document.activeElement;if(E&&M){const k=C.currentTarget,[T,A]=Z2(k);T&&A?!C.shiftKey&&M===A?(C.preventDefault(),t&&Da(T,{select:!0})):C.shiftKey&&M===T&&(C.preventDefault(),t&&Da(A,{select:!0})):M===k&&C.preventDefault()}},[t,n,b.paused]);return g.jsx(ke.div,{tabIndex:-1,...c,ref:y,onKeyDown:S})});Or.displayName=W2;function X2(o,{select:e=!1}={}){const t=document.activeElement;for(const n of o)if(Da(n,{select:e}),document.activeElement!==t)return}function Z2(o){const e=Ab(o),t=J0(e,o),n=J0(e.reverse(),o);return[t,n]}function Ab(o){const e=[],t=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function J0(o,e){for(const t of o)if(!J2(t,{upTo:e}))return t}function J2(o,{upTo:e}){if(getComputedStyle(o).visibility==="hidden")return!0;for(;o;){if(e!==void 0&&o===e)return!1;if(getComputedStyle(o).display==="none")return!0;o=o.parentElement}return!1}function eD(o){return o instanceof HTMLInputElement&&"select"in o}function Da(o,{select:e=!1}={}){if(o&&o.focus){const t=document.activeElement;o.focus({preventScroll:!0}),o!==t&&eD(o)&&e&&o.select()}}var ev=tD();function tD(){let o=[];return{add(e){const t=o[0];e!==t&&t?.pause(),o=tv(o,e),o.unshift(e)},remove(e){o=tv(o,e),o[0]?.resume()}}}function tv(o,e){const t=[...o],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function nD(o){return o.filter(e=>e.tagName!=="A")}var sD="Portal",Ir=w.forwardRef((o,e)=>{const{container:t,...n}=o,[a,r]=w.useState(!1);sn(()=>r(!0),[]);const c=t||a&&globalThis?.document?.body;return c?KR.createPortal(g.jsx(ke.div,{...n,ref:e}),c):null});Ir.displayName=sD;var Wf=0;function Gl(){w.useEffect(()=>{const o=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",o[0]??nv()),document.body.insertAdjacentElement("beforeend",o[1]??nv()),Wf++,()=>{Wf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Wf--}},[])}function nv(){const o=document.createElement("span");return o.setAttribute("data-radix-focus-guard",""),o.tabIndex=0,o.style.outline="none",o.style.opacity="0",o.style.position="fixed",o.style.pointerEvents="none",o}var fs=function(){return fs=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},fs.apply(this,arguments)};function Db(o,e){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function aD(o,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,r;n<a;n++)(r||!(n in e))&&(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return o.concat(r||Array.prototype.slice.call(e))}var xl="right-scroll-bar-position",wl="width-before-scroll-bar",iD="with-scroll-bars-hidden",oD="--removed-body-scroll-bar-size";function Xf(o,e){return typeof o=="function"?o(e):o&&(o.current=e),o}function rD(o,e){var t=w.useState(function(){return{value:o,callback:e,facade:{get current(){return t.value},set current(n){var a=t.value;a!==n&&(t.value=n,t.callback(n,a))}}}})[0];return t.callback=e,t.facade}var cD=typeof window<"u"?w.useLayoutEffect:w.useEffect,sv=new WeakMap;function lD(o,e){var t=rD(null,function(n){return o.forEach(function(a){return Xf(a,n)})});return cD(function(){var n=sv.get(t);if(n){var a=new Set(n),r=new Set(o),c=t.current;a.forEach(function(l){r.has(l)||Xf(l,null)}),r.forEach(function(l){a.has(l)||Xf(l,c)})}sv.set(t,o)},[o]),t}function uD(o){return o}function dD(o,e){e===void 0&&(e=uD);var t=[],n=!1,a={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:o},useMedium:function(r){var c=e(r,n);return t.push(c),function(){t=t.filter(function(l){return l!==c})}},assignSyncMedium:function(r){for(n=!0;t.length;){var c=t;t=[],c.forEach(r)}t={push:function(l){return r(l)},filter:function(){return t}}},assignMedium:function(r){n=!0;var c=[];if(t.length){var l=t;t=[],l.forEach(r),c=t}var d=function(){var p=c;c=[],p.forEach(r)},h=function(){return Promise.resolve().then(d)};h(),t={push:function(p){c.push(p),h()},filter:function(p){return c=c.filter(p),t}}}};return a}function fD(o){o===void 0&&(o={});var e=dD(null);return e.options=fs({async:!0,ssr:!1},o),e}var Nb=function(o){var e=o.sideCar,t=Db(o,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return w.createElement(n,fs({},t))};Nb.isSideCarExport=!0;function hD(o,e){return o.useMedium(e),Nb}var _b=fD(),Zf=function(){},Vl=w.forwardRef(function(o,e){var t=w.useRef(null),n=w.useState({onScrollCapture:Zf,onWheelCapture:Zf,onTouchMoveCapture:Zf}),a=n[0],r=n[1],c=o.forwardProps,l=o.children,d=o.className,h=o.removeScrollBar,p=o.enabled,m=o.shards,y=o.sideCar,b=o.noRelative,S=o.noIsolation,C=o.inert,E=o.allowPinchZoom,M=o.as,k=M===void 0?"div":M,T=o.gapMode,A=Db(o,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),N=y,q=lD([t,e]),O=fs(fs({},A),a);return w.createElement(w.Fragment,null,p&&w.createElement(N,{sideCar:_b,removeScrollBar:h,shards:m,noRelative:b,noIsolation:S,inert:C,setCallbacks:r,allowPinchZoom:!!E,lockRef:t,gapMode:T}),c?w.cloneElement(w.Children.only(l),fs(fs({},O),{ref:q})):w.createElement(k,fs({},O,{className:d,ref:q}),l))});Vl.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Vl.classNames={fullWidth:wl,zeroRight:xl};var pD=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function gD(){if(!document)return null;var o=document.createElement("style");o.type="text/css";var e=pD();return e&&o.setAttribute("nonce",e),o}function mD(o,e){o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}function yD(o){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(o)}var vD=function(){var o=0,e=null;return{add:function(t){o==0&&(e=gD())&&(mD(e,t),yD(e)),o++},remove:function(){o--,!o&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},bD=function(){var o=vD();return function(e,t){w.useEffect(function(){return o.add(e),function(){o.remove()}},[e&&t])}},jb=function(){var o=bD(),e=function(t){var n=t.styles,a=t.dynamic;return o(n,a),null};return e},xD={left:0,top:0,right:0,gap:0},Jf=function(o){return parseInt(o||"",10)||0},wD=function(o){var e=window.getComputedStyle(document.body),t=e[o==="padding"?"paddingLeft":"marginLeft"],n=e[o==="padding"?"paddingTop":"marginTop"],a=e[o==="padding"?"paddingRight":"marginRight"];return[Jf(t),Jf(n),Jf(a)]},SD=function(o){if(o===void 0&&(o="margin"),typeof window>"u")return xD;var e=wD(o),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},CD=jb(),fo="data-scroll-locked",MD=function(o,e,t,n){var a=o.left,r=o.top,c=o.right,l=o.gap;return t===void 0&&(t="margin"),`
  .`.concat(iD,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(l,"px ").concat(n,`;
  }
  body[`).concat(fo,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(r,`px;
    padding-right: `).concat(c,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(l,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(xl,` {
    right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(wl,` {
    margin-right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(xl," .").concat(xl,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(wl," .").concat(wl,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(fo,`] {
    `).concat(oD,": ").concat(l,`px;
  }
`)},av=function(){var o=parseInt(document.body.getAttribute(fo)||"0",10);return isFinite(o)?o:0},ED=function(){w.useEffect(function(){return document.body.setAttribute(fo,(av()+1).toString()),function(){var o=av()-1;o<=0?document.body.removeAttribute(fo):document.body.setAttribute(fo,o.toString())}},[])},RD=function(o){var e=o.noRelative,t=o.noImportant,n=o.gapMode,a=n===void 0?"margin":n;ED();var r=w.useMemo(function(){return SD(a)},[a]);return w.createElement(CD,{styles:MD(r,!e,a,t?"":"!important")})},dh=!1;if(typeof window<"u")try{var ll=Object.defineProperty({},"passive",{get:function(){return dh=!0,!0}});window.addEventListener("test",ll,ll),window.removeEventListener("test",ll,ll)}catch{dh=!1}var oo=dh?{passive:!1}:!1,TD=function(o){return o.tagName==="TEXTAREA"},Lb=function(o,e){if(!(o instanceof Element))return!1;var t=window.getComputedStyle(o);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!TD(o)&&t[e]==="visible")},kD=function(o){return Lb(o,"overflowY")},AD=function(o){return Lb(o,"overflowX")},iv=function(o,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var a=zb(o,n);if(a){var r=Pb(o,n),c=r[1],l=r[2];if(c>l)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},DD=function(o){var e=o.scrollTop,t=o.scrollHeight,n=o.clientHeight;return[e,t,n]},ND=function(o){var e=o.scrollLeft,t=o.scrollWidth,n=o.clientWidth;return[e,t,n]},zb=function(o,e){return o==="v"?kD(e):AD(e)},Pb=function(o,e){return o==="v"?DD(e):ND(e)},_D=function(o,e){return o==="h"&&e==="rtl"?-1:1},jD=function(o,e,t,n,a){var r=_D(o,window.getComputedStyle(e).direction),c=r*n,l=t.target,d=e.contains(l),h=!1,p=c>0,m=0,y=0;do{if(!l)break;var b=Pb(o,l),S=b[0],C=b[1],E=b[2],M=C-E-r*S;(S||M)&&zb(o,l)&&(m+=M,y+=S);var k=l.parentNode;l=k&&k.nodeType===Node.DOCUMENT_FRAGMENT_NODE?k.host:k}while(!d&&l!==document.body||d&&(e.contains(l)||e===l));return(p&&Math.abs(m)<1||!p&&Math.abs(y)<1)&&(h=!0),h},ul=function(o){return"changedTouches"in o?[o.changedTouches[0].clientX,o.changedTouches[0].clientY]:[0,0]},ov=function(o){return[o.deltaX,o.deltaY]},rv=function(o){return o&&"current"in o?o.current:o},LD=function(o,e){return o[0]===e[0]&&o[1]===e[1]},zD=function(o){return`
  .block-interactivity-`.concat(o,` {pointer-events: none;}
  .allow-interactivity-`).concat(o,` {pointer-events: all;}
`)},PD=0,ro=[];function OD(o){var e=w.useRef([]),t=w.useRef([0,0]),n=w.useRef(),a=w.useState(PD++)[0],r=w.useState(jb)[0],c=w.useRef(o);w.useEffect(function(){c.current=o},[o]),w.useEffect(function(){if(o.inert){document.body.classList.add("block-interactivity-".concat(a));var C=aD([o.lockRef.current],(o.shards||[]).map(rv),!0).filter(Boolean);return C.forEach(function(E){return E.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),C.forEach(function(E){return E.classList.remove("allow-interactivity-".concat(a))})}}},[o.inert,o.lockRef.current,o.shards]);var l=w.useCallback(function(C,E){if("touches"in C&&C.touches.length===2||C.type==="wheel"&&C.ctrlKey)return!c.current.allowPinchZoom;var M=ul(C),k=t.current,T="deltaX"in C?C.deltaX:k[0]-M[0],A="deltaY"in C?C.deltaY:k[1]-M[1],N,q=C.target,O=Math.abs(T)>Math.abs(A)?"h":"v";if("touches"in C&&O==="h"&&q.type==="range")return!1;var H=iv(O,q);if(!H)return!0;if(H?N=O:(N=O==="v"?"h":"v",H=iv(O,q)),!H)return!1;if(!n.current&&"changedTouches"in C&&(T||A)&&(n.current=N),!N)return!0;var J=n.current||N;return jD(J,E,C,J==="h"?T:A)},[]),d=w.useCallback(function(C){var E=C;if(!(!ro.length||ro[ro.length-1]!==r)){var M="deltaY"in E?ov(E):ul(E),k=e.current.filter(function(N){return N.name===E.type&&(N.target===E.target||E.target===N.shadowParent)&&LD(N.delta,M)})[0];if(k&&k.should){E.cancelable&&E.preventDefault();return}if(!k){var T=(c.current.shards||[]).map(rv).filter(Boolean).filter(function(N){return N.contains(E.target)}),A=T.length>0?l(E,T[0]):!c.current.noIsolation;A&&E.cancelable&&E.preventDefault()}}},[]),h=w.useCallback(function(C,E,M,k){var T={name:C,delta:E,target:M,should:k,shadowParent:ID(M)};e.current.push(T),setTimeout(function(){e.current=e.current.filter(function(A){return A!==T})},1)},[]),p=w.useCallback(function(C){t.current=ul(C),n.current=void 0},[]),m=w.useCallback(function(C){h(C.type,ov(C),C.target,l(C,o.lockRef.current))},[]),y=w.useCallback(function(C){h(C.type,ul(C),C.target,l(C,o.lockRef.current))},[]);w.useEffect(function(){return ro.push(r),o.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:y}),document.addEventListener("wheel",d,oo),document.addEventListener("touchmove",d,oo),document.addEventListener("touchstart",p,oo),function(){ro=ro.filter(function(C){return C!==r}),document.removeEventListener("wheel",d,oo),document.removeEventListener("touchmove",d,oo),document.removeEventListener("touchstart",p,oo)}},[]);var b=o.removeScrollBar,S=o.inert;return w.createElement(w.Fragment,null,S?w.createElement(r,{styles:zD(a)}):null,b?w.createElement(RD,{noRelative:o.noRelative,gapMode:o.gapMode}):null)}function ID(o){for(var e=null;o!==null;)o instanceof ShadowRoot&&(e=o.host,o=o.host),o=o.parentNode;return e}const qD=hD(_b,OD);var qr=w.forwardRef(function(o,e){return w.createElement(Vl,fs({},o,{ref:e,sideCar:qD}))});qr.classNames=Vl.classNames;var HD=function(o){if(typeof document>"u")return null;var e=Array.isArray(o)?o[0]:o;return e.ownerDocument.body},co=new WeakMap,dl=new WeakMap,fl={},eh=0,Ob=function(o){return o&&(o.host||Ob(o.parentNode))},BD=function(o,e){return e.map(function(t){if(o.contains(t))return t;var n=Ob(t);return n&&o.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",o,". Doing nothing"),null)}).filter(function(t){return!!t})},$D=function(o,e,t,n){var a=BD(e,Array.isArray(o)?o:[o]);fl[t]||(fl[t]=new WeakMap);var r=fl[t],c=[],l=new Set,d=new Set(a),h=function(m){!m||l.has(m)||(l.add(m),h(m.parentNode))};a.forEach(h);var p=function(m){!m||d.has(m)||Array.prototype.forEach.call(m.children,function(y){if(l.has(y))p(y);else try{var b=y.getAttribute(n),S=b!==null&&b!=="false",C=(co.get(y)||0)+1,E=(r.get(y)||0)+1;co.set(y,C),r.set(y,E),c.push(y),C===1&&S&&dl.set(y,!0),E===1&&y.setAttribute(t,"true"),S||y.setAttribute(n,"true")}catch(M){console.error("aria-hidden: cannot operate on ",y,M)}})};return p(e),l.clear(),eh++,function(){c.forEach(function(m){var y=co.get(m)-1,b=r.get(m)-1;co.set(m,y),r.set(m,b),y||(dl.has(m)||m.removeAttribute(n),dl.delete(m)),b||m.removeAttribute(t)}),eh--,eh||(co=new WeakMap,co=new WeakMap,dl=new WeakMap,fl={})}},Kl=function(o,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(o)?o:[o]),a=HD(o);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live], script"))),$D(n,a,t,"aria-hidden")):function(){return null}};function UD(o){const e=QD(o),t=w.forwardRef((n,a)=>{const{children:r,...c}=n,l=w.Children.toArray(r),d=l.find(GD);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}function QD(o){const e=w.forwardRef((t,n)=>{const{children:a,...r}=t;if(w.isValidElement(a)){const c=KD(a),l=VD(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var FD=Symbol("radix.slottable");function GD(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===FD}function VD(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function KD(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}var Yl="Dialog",[Ib,qb]=bn(Yl),[YD,is]=Ib(Yl),Hb=o=>{const{__scopeDialog:e,children:t,open:n,defaultOpen:a,onOpenChange:r,modal:c=!0}=o,l=w.useRef(null),d=w.useRef(null),[h,p]=xs({prop:n,defaultProp:a??!1,onChange:r,caller:Yl});return g.jsx(YD,{scope:e,triggerRef:l,contentRef:d,contentId:ns(),titleId:ns(),descriptionId:ns(),open:h,onOpenChange:p,onOpenToggle:w.useCallback(()=>p(m=>!m),[p]),modal:c,children:t})};Hb.displayName=Yl;var Bb="DialogTrigger",$b=w.forwardRef((o,e)=>{const{__scopeDialog:t,...n}=o,a=is(Bb,t),r=_e(e,a.triggerRef);return g.jsx(ke.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Vh(a.open),...n,ref:r,onClick:ge(o.onClick,a.onOpenToggle)})});$b.displayName=Bb;var Fh="DialogPortal",[WD,Ub]=Ib(Fh,{forceMount:void 0}),Qb=o=>{const{__scopeDialog:e,forceMount:t,children:n,container:a}=o,r=is(Fh,e);return g.jsx(WD,{scope:e,forceMount:t,children:w.Children.map(n,c=>g.jsx(rn,{present:t||r.open,children:g.jsx(Ir,{asChild:!0,container:a,children:c})}))})};Qb.displayName=Fh;var Nl="DialogOverlay",Fb=w.forwardRef((o,e)=>{const t=Ub(Nl,o.__scopeDialog),{forceMount:n=t.forceMount,...a}=o,r=is(Nl,o.__scopeDialog);return r.modal?g.jsx(rn,{present:n||r.open,children:g.jsx(ZD,{...a,ref:e})}):null});Fb.displayName=Nl;var XD=UD("DialogOverlay.RemoveScroll"),ZD=w.forwardRef((o,e)=>{const{__scopeDialog:t,...n}=o,a=is(Nl,t);return g.jsx(qr,{as:XD,allowPinchZoom:!0,shards:[a.contentRef],children:g.jsx(ke.div,{"data-state":Vh(a.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),pi="DialogContent",Gb=w.forwardRef((o,e)=>{const t=Ub(pi,o.__scopeDialog),{forceMount:n=t.forceMount,...a}=o,r=is(pi,o.__scopeDialog);return g.jsx(rn,{present:n||r.open,children:r.modal?g.jsx(JD,{...a,ref:e}):g.jsx(eN,{...a,ref:e})})});Gb.displayName=pi;var JD=w.forwardRef((o,e)=>{const t=is(pi,o.__scopeDialog),n=w.useRef(null),a=_e(e,t.contentRef,n);return w.useEffect(()=>{const r=n.current;if(r)return Kl(r)},[]),g.jsx(Vb,{...o,ref:a,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(o.onCloseAutoFocus,r=>{r.preventDefault(),t.triggerRef.current?.focus()}),onPointerDownOutside:ge(o.onPointerDownOutside,r=>{const c=r.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0;(c.button===2||l)&&r.preventDefault()}),onFocusOutside:ge(o.onFocusOutside,r=>r.preventDefault())})}),eN=w.forwardRef((o,e)=>{const t=is(pi,o.__scopeDialog),n=w.useRef(!1),a=w.useRef(!1);return g.jsx(Vb,{...o,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{o.onCloseAutoFocus?.(r),r.defaultPrevented||(n.current||t.triggerRef.current?.focus(),r.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:r=>{o.onInteractOutside?.(r),r.defaultPrevented||(n.current=!0,r.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const c=r.target;t.triggerRef.current?.contains(c)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&a.current&&r.preventDefault()}})}),Vb=w.forwardRef((o,e)=>{const{__scopeDialog:t,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:r,...c}=o,l=is(pi,t),d=w.useRef(null),h=_e(e,d);return Gl(),g.jsxs(g.Fragment,{children:[g.jsx(Or,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:r,children:g.jsx(Pr,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Vh(l.open),...c,ref:h,onDismiss:()=>l.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(nN,{titleId:l.titleId}),g.jsx(aN,{contentRef:d,descriptionId:l.descriptionId})]})]})}),Gh="DialogTitle",Kb=w.forwardRef((o,e)=>{const{__scopeDialog:t,...n}=o,a=is(Gh,t);return g.jsx(ke.h2,{id:a.titleId,...n,ref:e})});Kb.displayName=Gh;var Yb="DialogDescription",Wb=w.forwardRef((o,e)=>{const{__scopeDialog:t,...n}=o,a=is(Yb,t);return g.jsx(ke.p,{id:a.descriptionId,...n,ref:e})});Wb.displayName=Yb;var Xb="DialogClose",Zb=w.forwardRef((o,e)=>{const{__scopeDialog:t,...n}=o,a=is(Xb,t);return g.jsx(ke.button,{type:"button",...n,ref:e,onClick:ge(o.onClick,()=>a.onOpenChange(!1))})});Zb.displayName=Xb;function Vh(o){return o?"open":"closed"}var Jb="DialogTitleWarning",[tN,ex]=h2(Jb,{contentName:pi,titleName:Gh,docsSlug:"dialog"}),nN=({titleId:o})=>{const e=ex(Jb),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return w.useEffect(()=>{o&&(document.getElementById(o)||console.error(t))},[t,o]),null},sN="DialogDescriptionWarning",aN=({contentRef:o,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ex(sN).contentName}}.`;return w.useEffect(()=>{const a=o.current?.getAttribute("aria-describedby");e&&a&&(document.getElementById(e)||console.warn(n))},[n,o,e]),null},tx=Hb,nx=$b,sx=Qb,Kh=Fb,Yh=Gb,Wh=Kb,Xh=Wb,Zh=Zb,iN=Symbol("radix.slottable");function oN(o){const e=({children:t})=>g.jsx(g.Fragment,{children:t});return e.displayName=`${o}.Slottable`,e.__radixId=iN,e}var ax="AlertDialog",[rN]=bn(ax,[qb]),aa=qb(),ix=o=>{const{__scopeAlertDialog:e,...t}=o,n=aa(e);return g.jsx(tx,{...n,...t,modal:!0})};ix.displayName=ax;var cN="AlertDialogTrigger",lN=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,...n}=o,a=aa(t);return g.jsx(nx,{...a,...n,ref:e})});lN.displayName=cN;var uN="AlertDialogPortal",ox=o=>{const{__scopeAlertDialog:e,...t}=o,n=aa(e);return g.jsx(sx,{...n,...t})};ox.displayName=uN;var dN="AlertDialogOverlay",rx=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,...n}=o,a=aa(t);return g.jsx(Kh,{...a,...n,ref:e})});rx.displayName=dN;var ho="AlertDialogContent",[fN,hN]=rN(ho),pN=oN("AlertDialogContent"),cx=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,children:n,...a}=o,r=aa(t),c=w.useRef(null),l=_e(e,c),d=w.useRef(null);return g.jsx(tN,{contentName:ho,titleName:lx,docsSlug:"alert-dialog",children:g.jsx(fN,{scope:t,cancelRef:d,children:g.jsxs(Yh,{role:"alertdialog",...r,...a,ref:l,onOpenAutoFocus:ge(a.onOpenAutoFocus,h=>{h.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[g.jsx(pN,{children:n}),g.jsx(mN,{contentRef:c})]})})})});cx.displayName=ho;var lx="AlertDialogTitle",ux=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,...n}=o,a=aa(t);return g.jsx(Wh,{...a,...n,ref:e})});ux.displayName=lx;var dx="AlertDialogDescription",fx=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,...n}=o,a=aa(t);return g.jsx(Xh,{...a,...n,ref:e})});fx.displayName=dx;var gN="AlertDialogAction",hx=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,...n}=o,a=aa(t);return g.jsx(Zh,{...a,...n,ref:e})});hx.displayName=gN;var px="AlertDialogCancel",gx=w.forwardRef((o,e)=>{const{__scopeAlertDialog:t,...n}=o,{cancelRef:a}=hN(px,t),r=aa(t),c=_e(e,a);return g.jsx(Zh,{...r,...n,ref:c})});gx.displayName=px;var mN=({contentRef:o})=>{const e=`\`${ho}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${ho}\` by passing a \`${dx}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${ho}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return w.useEffect(()=>{document.getElementById(o.current?.getAttribute("aria-describedby"))||console.warn(e)},[e,o]),null},yN=ix,vN=ox,mx=rx,yx=cx,vx=hx,bx=gx,xx=ux,wx=fx;const Sx=yN,bN=vN,Cx=w.forwardRef(({className:o,...e},t)=>g.jsx(mx,{className:Ee("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...e,ref:t}));Cx.displayName=mx.displayName;const Jh=w.forwardRef(({className:o,...e},t)=>g.jsxs(bN,{children:[g.jsx(Cx,{}),g.jsx(yx,{ref:t,className:Ee("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...e})]}));Jh.displayName=yx.displayName;const Mx=({className:o,...e})=>g.jsx("div",{className:Ee("flex flex-col space-y-2 text-center sm:text-left",o),...e});Mx.displayName="AlertDialogHeader";const Ex=({className:o,...e})=>g.jsx("div",{className:Ee("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",o),...e});Ex.displayName="AlertDialogFooter";const ep=w.forwardRef(({className:o,...e},t)=>g.jsx(xx,{ref:t,className:Ee("text-lg font-semibold",o),...e}));ep.displayName=xx.displayName;const tp=w.forwardRef(({className:o,...e},t)=>g.jsx(wx,{ref:t,className:Ee("text-sm text-muted-foreground",o),...e}));tp.displayName=wx.displayName;const np=w.forwardRef(({className:o,...e},t)=>g.jsx(vx,{ref:t,className:Ee(Lh(),o),...e}));np.displayName=vx.displayName;const sp=w.forwardRef(({className:o,...e},t)=>g.jsx(bx,{ref:t,className:Ee(Lh({variant:"outline"}),"mt-2 sm:mt-0",o),...e}));sp.displayName=bx.displayName;const ap=tx,EO=nx,xN=sx,Rx=w.forwardRef(({className:o,...e},t)=>g.jsx(Kh,{ref:t,className:Ee("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...e}));Rx.displayName=Kh.displayName;const Wl=w.forwardRef(({className:o,children:e,...t},n)=>g.jsxs(xN,{children:[g.jsx(Rx,{}),g.jsxs(Yh,{ref:n,className:Ee("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...t,children:[e,g.jsxs(Zh,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[g.jsx(vs,{className:"h-4 w-4"}),g.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Wl.displayName=Yh.displayName;const Xl=({className:o,...e})=>g.jsx("div",{className:Ee("flex flex-col space-y-1.5 text-center sm:text-left",o),...e});Xl.displayName="DialogHeader";const Zl=({className:o,...e})=>g.jsx("div",{className:Ee("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",o),...e});Zl.displayName="DialogFooter";const Jl=w.forwardRef(({className:o,...e},t)=>g.jsx(Wh,{ref:t,className:Ee("text-lg font-semibold leading-none tracking-tight",o),...e}));Jl.displayName=Wh.displayName;const eu=w.forwardRef(({className:o,...e},t)=>g.jsx(Xh,{ref:t,className:Ee("text-sm text-muted-foreground",o),...e}));eu.displayName=Xh.displayName;var wN=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],SN=wN.reduce((o,e)=>{const t=Nh(`Primitive.${e}`),n=w.forwardRef((a,r)=>{const{asChild:c,...l}=a,d=c?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(d,{...l,ref:r})});return n.displayName=`Primitive.${e}`,{...o,[e]:n}},{}),CN="Label",Tx=w.forwardRef((o,e)=>g.jsx(SN.label,{...o,ref:e,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(o.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Tx.displayName=CN;var kx=Tx;const MN=_h("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),st=w.forwardRef(({className:o,...e},t)=>g.jsx(kx,{ref:t,className:Ee(MN(),o),...e}));st.displayName=kx.displayName;function ip({open:o,initialName:e="",onConfirm:t,onCancel:n}){const[a,r]=w.useState(e);w.useEffect(()=>{o&&r(e)},[o,e]);const c=()=>{a.trim()&&t(a.trim())};return g.jsx(ap,{open:o,onOpenChange:l=>!l&&n(),children:g.jsxs(Wl,{children:[g.jsxs(Xl,{children:[g.jsx(Jl,{children:e?"Rename Group":"Create Group"}),g.jsx(eu,{children:e?"Enter a new name for the group":"Enter a name for the new group"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(st,{htmlFor:"group-name",children:"Group Name"}),g.jsx(At,{id:"group-name",value:a,onChange:l=>r(l.target.value),onKeyDown:l=>{l.key==="Enter"&&c()},className:"mt-2",autoFocus:!0})]}),g.jsxs(Zl,{children:[g.jsx(Ae,{variant:"outline",onClick:n,children:"Cancel"}),g.jsx(Ae,{onClick:c,disabled:!a.trim(),children:e?"Save":"Create"})]})]})})}function EN(){const{zoom:o,setZoom:e,diagramName:t,setDiagramName:n,saveDiagram:a,loadDiagramState:r,undo:c,redo:l,selectedNodeId:d,createGroupFromSelection:h,autoGroupByConnections:p,nodes:m,pan:y,setPan:b,viewportWidth:S,viewportHeight:C}=Re(),{canUndo:E,canRedo:M}=Mr(),k=w.useRef(null),[T,A]=w.useState(!1),[N,q]=w.useState(t),[O,H]=w.useState(!1),{showMinimap:J,toggleMinimap:se,showHeatMapLegend:ce,toggleHeatMapLegend:Z,showRuler:te,toggleRuler:le}=zr(),ue=()=>e(Math.min(o+.1,2)),L=()=>e(o-.1),_=()=>{const ie=m;if(!ie.length){e(1),b({x:0,y:0});return}const $=100,V=ie.map(Ft=>Ft.position.x),pe=ie.map(Ft=>Ft.position.y),me=ie.map(Ft=>Ft.position.x+140),ye=ie.map(Ft=>Ft.position.y+140),ve=Math.min(...V)-$,Le=Math.min(...pe)-$,$e=Math.max(...me)+$,at=Math.max(...ye)+$,Ze=$e-ve,Nt=at-Le,de=S||window.innerWidth,Be=C||window.innerHeight-56,Ue=de/Ze,yt=Be/Nt;let pt=Math.min(Ue,yt);pt=Math.min(Math.max(pt,.2),2.5);const qt=ve+Ze/2,Je=Le+Nt/2,_t=de/2,vt=Be/2,gt=_t-qt*pt,Yt=vt-Je*pt;e(pt),b({x:gt,y:Yt})},P=()=>{a(),Ye.success("Diagram saved to browser storage")},W=()=>{const ie=`${t.replace(/\s+/g,"_")}_${Date.now()}.json`;ZT(Re.getState(),ie),Ye.success("Diagram exported as JSON")},he=()=>{k.current?.click()},j=async ie=>{const $=ie.target.files?.[0];if($){try{const V=await JT($);if(!V){Ye.error("Failed to import diagram: Invalid file format");return}r({nodes:V.nodes||[],connections:V.connections||[],groups:V.groups||[],zoom:V.zoom||1,pan:V.pan||{x:0,y:0}}),n(V.name),Ye.success(`Diagram "${V.name}" imported successfully`)}catch(V){Ye.error("Failed to import diagram"),ta("Failed to import diagram",V instanceof Error?V:new Error(String(V)))}k.current&&(k.current.value="")}},Q=()=>{N.trim()&&(n(N.trim()),Ye.success("Diagram renamed")),A(!1)},Y=()=>{const{nodes:ie}=Re.getState();if(ie.filter(V=>V.selected||V.id===d).length===0){Ye.error("Select at least one component to create a group");return}H(!0)},ae=ie=>{h(ie),Ye.success(`Group "${ie}" created`),H(!1)},U=()=>{p(),Ye.success("Groups created automatically from connections")};return g.jsxs(g.Fragment,{children:[g.jsx(ip,{open:O,onConfirm:ae,onCancel:()=>H(!1)}),g.jsxs("div",{className:"h-14 bg-toolbar-bg border-b border-border flex items-center justify-between px-4",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("button",{onClick:()=>A(!0),className:"text-lg font-semibold text-foreground hover:text-primary transition-colors cursor-pointer",title:"Click to rename diagram",children:[g.jsx("span",{className:"text-primary",children:"Archi"}),"Phoenix",g.jsxs("span",{className:"text-xs text-secondary-foreground ml-2",children:[" ",t]})]}),g.jsx(vn,{orientation:"vertical",className:"h-6 mx-2"}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:c,disabled:!E,title:"Undo (Ctrl/Cmd+Z)",children:g.jsx(VA,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:l,disabled:!M,title:"Redo (Ctrl/Cmd+Shift+Z or Ctrl/Cmd+Y)",children:g.jsx(EA,{className:"h-4 w-4"})})]}),g.jsx(vn,{orientation:"vertical",className:"h-6 mx-2"}),g.jsx(A2,{})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"flex items-center gap-1 bg-secondary/50 rounded-md p-1",children:[g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ue,title:"Zoom In",children:g.jsx(JA,{className:"h-4 w-4"})}),g.jsxs("span",{className:"text-sm font-mono px-2 min-w-[60px] text-center",children:[Math.round(o*100),"%"]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:L,title:"Zoom Out",children:g.jsx(t2,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:_,title:"Fit to View",children:g.jsx(pA,{className:"h-4 w-4"})})]}),g.jsx(vn,{orientation:"vertical",className:"h-6"}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:P,title:"Save diagram to browser storage (auto-saves on changes)",children:g.jsx(_A,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:W,title:"Export diagram as JSON file",children:g.jsx(Xk,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:he,title:"Import diagram from JSON file",children:g.jsx(YA,{className:"h-4 w-4"})}),g.jsx(vn,{orientation:"vertical",className:"h-6"}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Create group from selection",onClick:Y,disabled:!d,children:g.jsx(lb,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Auto-group by connections",onClick:U,children:g.jsx(IA,{className:"h-4 w-4"})}),g.jsx(vn,{orientation:"vertical",className:"h-6"}),g.jsx(n2,{}),g.jsx(Ae,{variant:J?"default":"ghost",size:"icon",className:"h-9 w-9",title:J?"Hide minimap":"Show minimap",onClick:se,children:g.jsx(fA,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:ce?"default":"ghost",size:"icon",className:"h-9 w-9",title:ce?"Hide heat map legend":"Show heat map legend",onClick:Z,children:g.jsx(hi,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:te?"default":"ghost",size:"icon",className:"h-9 w-9",title:te?"Hide ruler":"Show ruler",onClick:le,children:g.jsx(DA,{className:"h-4 w-4"})}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"Settings",children:g.jsx(PA,{className:"h-4 w-4"})})]})]}),g.jsx("input",{ref:k,type:"file",accept:".json",onChange:j,className:"hidden","aria-label":"Import diagram from file"}),g.jsx(Sx,{open:T,onOpenChange:A,children:g.jsxs(Jh,{children:[g.jsx(ep,{children:"Rename Diagram"}),g.jsx(tp,{children:"Enter a new name for your diagram"}),g.jsx("div",{className:"py-4",children:g.jsx(At,{value:N,onChange:ie=>q(ie.target.value),placeholder:"Diagram name",onKeyDown:ie=>{ie.key==="Enter"&&Q()},autoFocus:!0})}),g.jsxs("div",{className:"flex gap-2 justify-end",children:[g.jsx(sp,{children:"Cancel"}),g.jsx(np,{onClick:Q,children:"Save"})]})]})})]})}function cv(o){const e=RN(o),t=w.forwardRef((n,a)=>{const{children:r,...c}=n,l=w.Children.toArray(r),d=l.find(kN);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}function RN(o){const e=w.forwardRef((t,n)=>{const{children:a,...r}=t;if(w.isValidElement(a)){const c=DN(a),l=AN(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var TN=Symbol("radix.slottable");function kN(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===TN}function AN(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function DN(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function tu(o){const e=o+"CollectionProvider",[t,n]=bn(e),[a,r]=t(e,{collectionRef:{current:null},itemMap:new Map}),c=C=>{const{scope:E,children:M}=C,k=Et.useRef(null),T=Et.useRef(new Map).current;return g.jsx(a,{scope:E,itemMap:T,collectionRef:k,children:M})};c.displayName=e;const l=o+"CollectionSlot",d=cv(l),h=Et.forwardRef((C,E)=>{const{scope:M,children:k}=C,T=r(l,M),A=_e(E,T.collectionRef);return g.jsx(d,{ref:A,children:k})});h.displayName=l;const p=o+"CollectionItemSlot",m="data-radix-collection-item",y=cv(p),b=Et.forwardRef((C,E)=>{const{scope:M,children:k,...T}=C,A=Et.useRef(null),N=_e(E,A),q=r(p,M);return Et.useEffect(()=>(q.itemMap.set(A,{ref:A,...T}),()=>void q.itemMap.delete(A))),g.jsx(y,{[m]:"",ref:N,children:k})});b.displayName=p;function S(C){const E=r(o+"CollectionConsumer",C);return Et.useCallback(()=>{const k=E.collectionRef.current;if(!k)return[];const T=Array.from(k.querySelectorAll(`[${m}]`));return Array.from(E.itemMap.values()).sort((q,O)=>T.indexOf(q.ref.current)-T.indexOf(O.ref.current))},[E.collectionRef,E.itemMap])}return[{Provider:c,Slot:h,ItemSlot:b},S,n]}var th="rovingFocusGroup.onEntryFocus",NN={bubbles:!1,cancelable:!0},Hr="RovingFocusGroup",[fh,Ax,_N]=tu(Hr),[jN,nu]=bn(Hr,[_N]),[LN,zN]=jN(Hr),Dx=w.forwardRef((o,e)=>g.jsx(fh.Provider,{scope:o.__scopeRovingFocusGroup,children:g.jsx(fh.Slot,{scope:o.__scopeRovingFocusGroup,children:g.jsx(PN,{...o,ref:e})})}));Dx.displayName=Hr;var PN=w.forwardRef((o,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:a=!1,dir:r,currentTabStopId:c,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:d,onEntryFocus:h,preventScrollOnEntryFocus:p=!1,...m}=o,y=w.useRef(null),b=_e(e,y),S=So(r),[C,E]=xs({prop:c,defaultProp:l??null,onChange:d,caller:Hr}),[M,k]=w.useState(!1),T=nn(h),A=Ax(t),N=w.useRef(!1),[q,O]=w.useState(0);return w.useEffect(()=>{const H=y.current;if(H)return H.addEventListener(th,T),()=>H.removeEventListener(th,T)},[T]),g.jsx(LN,{scope:t,orientation:n,dir:S,loop:a,currentTabStopId:C,onItemFocus:w.useCallback(H=>E(H),[E]),onItemShiftTab:w.useCallback(()=>k(!0),[]),onFocusableItemAdd:w.useCallback(()=>O(H=>H+1),[]),onFocusableItemRemove:w.useCallback(()=>O(H=>H-1),[]),children:g.jsx(ke.div,{tabIndex:M||q===0?-1:0,"data-orientation":n,...m,ref:b,style:{outline:"none",...o.style},onMouseDown:ge(o.onMouseDown,()=>{N.current=!0}),onFocus:ge(o.onFocus,H=>{const J=!N.current;if(H.target===H.currentTarget&&J&&!M){const se=new CustomEvent(th,NN);if(H.currentTarget.dispatchEvent(se),!se.defaultPrevented){const ce=A().filter(L=>L.focusable),Z=ce.find(L=>L.active),te=ce.find(L=>L.id===C),ue=[Z,te,...ce].filter(Boolean).map(L=>L.ref.current);jx(ue,p)}}N.current=!1}),onBlur:ge(o.onBlur,()=>k(!1))})})}),Nx="RovingFocusGroupItem",_x=w.forwardRef((o,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:a=!1,tabStopId:r,children:c,...l}=o,d=ns(),h=r||d,p=zN(Nx,t),m=p.currentTabStopId===h,y=Ax(t),{onFocusableItemAdd:b,onFocusableItemRemove:S,currentTabStopId:C}=p;return w.useEffect(()=>{if(n)return b(),()=>S()},[n,b,S]),g.jsx(fh.ItemSlot,{scope:t,id:h,focusable:n,active:a,children:g.jsx(ke.span,{tabIndex:m?0:-1,"data-orientation":p.orientation,...l,ref:e,onMouseDown:ge(o.onMouseDown,E=>{n?p.onItemFocus(h):E.preventDefault()}),onFocus:ge(o.onFocus,()=>p.onItemFocus(h)),onKeyDown:ge(o.onKeyDown,E=>{if(E.key==="Tab"&&E.shiftKey){p.onItemShiftTab();return}if(E.target!==E.currentTarget)return;const M=qN(E,p.orientation,p.dir);if(M!==void 0){if(E.metaKey||E.ctrlKey||E.altKey||E.shiftKey)return;E.preventDefault();let T=y().filter(A=>A.focusable).map(A=>A.ref.current);if(M==="last")T.reverse();else if(M==="prev"||M==="next"){M==="prev"&&T.reverse();const A=T.indexOf(E.currentTarget);T=p.loop?HN(T,A+1):T.slice(A+1)}setTimeout(()=>jx(T))}}),children:typeof c=="function"?c({isCurrentTabStop:m,hasTabStop:C!=null}):c})})});_x.displayName=Nx;var ON={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function IN(o,e){return e!=="rtl"?o:o==="ArrowLeft"?"ArrowRight":o==="ArrowRight"?"ArrowLeft":o}function qN(o,e,t){const n=IN(o.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return ON[n]}function jx(o,e=!1){const t=document.activeElement;for(const n of o)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function HN(o,e){return o.map((t,n)=>o[(e+n)%o.length])}var Lx=Dx,zx=_x,su="Tabs",[BN]=bn(su,[nu]),Px=nu(),[$N,op]=BN(su),Ox=w.forwardRef((o,e)=>{const{__scopeTabs:t,value:n,onValueChange:a,defaultValue:r,orientation:c="horizontal",dir:l,activationMode:d="automatic",...h}=o,p=So(l),[m,y]=xs({prop:n,onChange:a,defaultProp:r??"",caller:su});return g.jsx($N,{scope:t,baseId:ns(),value:m,onValueChange:y,orientation:c,dir:p,activationMode:d,children:g.jsx(ke.div,{dir:p,"data-orientation":c,...h,ref:e})})});Ox.displayName=su;var Ix="TabsList",qx=w.forwardRef((o,e)=>{const{__scopeTabs:t,loop:n=!0,...a}=o,r=op(Ix,t),c=Px(t);return g.jsx(Lx,{asChild:!0,...c,orientation:r.orientation,dir:r.dir,loop:n,children:g.jsx(ke.div,{role:"tablist","aria-orientation":r.orientation,...a,ref:e})})});qx.displayName=Ix;var Hx="TabsTrigger",Bx=w.forwardRef((o,e)=>{const{__scopeTabs:t,value:n,disabled:a=!1,...r}=o,c=op(Hx,t),l=Px(t),d=Qx(c.baseId,n),h=Fx(c.baseId,n),p=n===c.value;return g.jsx(zx,{asChild:!0,...l,focusable:!a,active:p,children:g.jsx(ke.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":h,"data-state":p?"active":"inactive","data-disabled":a?"":void 0,disabled:a,id:d,...r,ref:e,onMouseDown:ge(o.onMouseDown,m=>{!a&&m.button===0&&m.ctrlKey===!1?c.onValueChange(n):m.preventDefault()}),onKeyDown:ge(o.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&c.onValueChange(n)}),onFocus:ge(o.onFocus,()=>{const m=c.activationMode!=="manual";!p&&!a&&m&&c.onValueChange(n)})})})});Bx.displayName=Hx;var $x="TabsContent",Ux=w.forwardRef((o,e)=>{const{__scopeTabs:t,value:n,forceMount:a,children:r,...c}=o,l=op($x,t),d=Qx(l.baseId,n),h=Fx(l.baseId,n),p=n===l.value,m=w.useRef(p);return w.useEffect(()=>{const y=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(y)},[]),g.jsx(rn,{present:a||p,children:({present:y})=>g.jsx(ke.div,{"data-state":p?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":d,hidden:!y,id:h,tabIndex:0,...c,ref:e,style:{...o.style,animationDuration:m.current?"0s":void 0},children:y&&r})})});Ux.displayName=$x;function Qx(o,e){return`${o}-trigger-${e}`}function Fx(o,e){return`${o}-content-${e}`}var UN=Ox,Gx=qx,Vx=Bx,Kx=Ux;const rp=UN,au=w.forwardRef(({className:o,...e},t)=>g.jsx(Gx,{ref:t,className:Ee("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",o),...e}));au.displayName=Gx.displayName;const hs=w.forwardRef(({className:o,...e},t)=>g.jsx(Vx,{ref:t,className:Ee("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",o),...e}));hs.displayName=Vx.displayName;const La=w.forwardRef(({className:o,...e},t)=>g.jsx(Kx,{ref:t,className:Ee("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",o),...e}));La.displayName=Kx.displayName;const QN=["top","right","bottom","left"],Pa=Math.min,Tn=Math.max,_l=Math.round,hl=Math.floor,bs=o=>({x:o,y:o}),FN={left:"right",right:"left",bottom:"top",top:"bottom"},GN={start:"end",end:"start"};function hh(o,e,t){return Tn(o,Pa(e,t))}function na(o,e){return typeof o=="function"?o(e):o}function sa(o){return o.split("-")[0]}function Co(o){return o.split("-")[1]}function cp(o){return o==="x"?"y":"x"}function lp(o){return o==="y"?"height":"width"}const VN=new Set(["top","bottom"]);function gs(o){return VN.has(sa(o))?"y":"x"}function up(o){return cp(gs(o))}function KN(o,e,t){t===void 0&&(t=!1);const n=Co(o),a=up(o),r=lp(a);let c=a==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(c=jl(c)),[c,jl(c)]}function YN(o){const e=jl(o);return[ph(o),e,ph(e)]}function ph(o){return o.replace(/start|end/g,e=>GN[e])}const lv=["left","right"],uv=["right","left"],WN=["top","bottom"],XN=["bottom","top"];function ZN(o,e,t){switch(o){case"top":case"bottom":return t?e?uv:lv:e?lv:uv;case"left":case"right":return e?WN:XN;default:return[]}}function JN(o,e,t,n){const a=Co(o);let r=ZN(sa(o),t==="start",n);return a&&(r=r.map(c=>c+"-"+a),e&&(r=r.concat(r.map(ph)))),r}function jl(o){return o.replace(/left|right|bottom|top/g,e=>FN[e])}function e_(o){return{top:0,right:0,bottom:0,left:0,...o}}function Yx(o){return typeof o!="number"?e_(o):{top:o,right:o,bottom:o,left:o}}function Ll(o){const{x:e,y:t,width:n,height:a}=o;return{width:n,height:a,top:t,left:e,right:e+n,bottom:t+a,x:e,y:t}}function dv(o,e,t){let{reference:n,floating:a}=o;const r=gs(e),c=up(e),l=lp(c),d=sa(e),h=r==="y",p=n.x+n.width/2-a.width/2,m=n.y+n.height/2-a.height/2,y=n[l]/2-a[l]/2;let b;switch(d){case"top":b={x:p,y:n.y-a.height};break;case"bottom":b={x:p,y:n.y+n.height};break;case"right":b={x:n.x+n.width,y:m};break;case"left":b={x:n.x-a.width,y:m};break;default:b={x:n.x,y:n.y}}switch(Co(e)){case"start":b[c]-=y*(t&&h?-1:1);break;case"end":b[c]+=y*(t&&h?-1:1);break}return b}const t_=async(o,e,t)=>{const{placement:n="bottom",strategy:a="absolute",middleware:r=[],platform:c}=t,l=r.filter(Boolean),d=await(c.isRTL==null?void 0:c.isRTL(e));let h=await c.getElementRects({reference:o,floating:e,strategy:a}),{x:p,y:m}=dv(h,n,d),y=n,b={},S=0;for(let C=0;C<l.length;C++){const{name:E,fn:M}=l[C],{x:k,y:T,data:A,reset:N}=await M({x:p,y:m,initialPlacement:n,placement:y,strategy:a,middlewareData:b,rects:h,platform:c,elements:{reference:o,floating:e}});p=k??p,m=T??m,b={...b,[E]:{...b[E],...A}},N&&S<=50&&(S++,typeof N=="object"&&(N.placement&&(y=N.placement),N.rects&&(h=N.rects===!0?await c.getElementRects({reference:o,floating:e,strategy:a}):N.rects),{x:p,y:m}=dv(h,y,d)),C=-1)}return{x:p,y:m,placement:y,strategy:a,middlewareData:b}};async function Ar(o,e){var t;e===void 0&&(e={});const{x:n,y:a,platform:r,rects:c,elements:l,strategy:d}=o,{boundary:h="clippingAncestors",rootBoundary:p="viewport",elementContext:m="floating",altBoundary:y=!1,padding:b=0}=na(e,o),S=Yx(b),E=l[y?m==="floating"?"reference":"floating":m],M=Ll(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(E)))==null||t?E:E.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(l.floating)),boundary:h,rootBoundary:p,strategy:d})),k=m==="floating"?{x:n,y:a,width:c.floating.width,height:c.floating.height}:c.reference,T=await(r.getOffsetParent==null?void 0:r.getOffsetParent(l.floating)),A=await(r.isElement==null?void 0:r.isElement(T))?await(r.getScale==null?void 0:r.getScale(T))||{x:1,y:1}:{x:1,y:1},N=Ll(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:k,offsetParent:T,strategy:d}):k);return{top:(M.top-N.top+S.top)/A.y,bottom:(N.bottom-M.bottom+S.bottom)/A.y,left:(M.left-N.left+S.left)/A.x,right:(N.right-M.right+S.right)/A.x}}const n_=o=>({name:"arrow",options:o,async fn(e){const{x:t,y:n,placement:a,rects:r,platform:c,elements:l,middlewareData:d}=e,{element:h,padding:p=0}=na(o,e)||{};if(h==null)return{};const m=Yx(p),y={x:t,y:n},b=up(a),S=lp(b),C=await c.getDimensions(h),E=b==="y",M=E?"top":"left",k=E?"bottom":"right",T=E?"clientHeight":"clientWidth",A=r.reference[S]+r.reference[b]-y[b]-r.floating[S],N=y[b]-r.reference[b],q=await(c.getOffsetParent==null?void 0:c.getOffsetParent(h));let O=q?q[T]:0;(!O||!await(c.isElement==null?void 0:c.isElement(q)))&&(O=l.floating[T]||r.floating[S]);const H=A/2-N/2,J=O/2-C[S]/2-1,se=Pa(m[M],J),ce=Pa(m[k],J),Z=se,te=O-C[S]-ce,le=O/2-C[S]/2+H,ue=hh(Z,le,te),L=!d.arrow&&Co(a)!=null&&le!==ue&&r.reference[S]/2-(le<Z?se:ce)-C[S]/2<0,_=L?le<Z?le-Z:le-te:0;return{[b]:y[b]+_,data:{[b]:ue,centerOffset:le-ue-_,...L&&{alignmentOffset:_}},reset:L}}}),s_=function(o){return o===void 0&&(o={}),{name:"flip",options:o,async fn(e){var t,n;const{placement:a,middlewareData:r,rects:c,initialPlacement:l,platform:d,elements:h}=e,{mainAxis:p=!0,crossAxis:m=!0,fallbackPlacements:y,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:S="none",flipAlignment:C=!0,...E}=na(o,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const M=sa(a),k=gs(l),T=sa(l)===l,A=await(d.isRTL==null?void 0:d.isRTL(h.floating)),N=y||(T||!C?[jl(l)]:YN(l)),q=S!=="none";!y&&q&&N.push(...JN(l,C,S,A));const O=[l,...N],H=await Ar(e,E),J=[];let se=((n=r.flip)==null?void 0:n.overflows)||[];if(p&&J.push(H[M]),m){const le=KN(a,c,A);J.push(H[le[0]],H[le[1]])}if(se=[...se,{placement:a,overflows:J}],!J.every(le=>le<=0)){var ce,Z;const le=(((ce=r.flip)==null?void 0:ce.index)||0)+1,ue=O[le];if(ue&&(!(m==="alignment"?k!==gs(ue):!1)||se.every(P=>gs(P.placement)===k?P.overflows[0]>0:!0)))return{data:{index:le,overflows:se},reset:{placement:ue}};let L=(Z=se.filter(_=>_.overflows[0]<=0).sort((_,P)=>_.overflows[1]-P.overflows[1])[0])==null?void 0:Z.placement;if(!L)switch(b){case"bestFit":{var te;const _=(te=se.filter(P=>{if(q){const W=gs(P.placement);return W===k||W==="y"}return!0}).map(P=>[P.placement,P.overflows.filter(W=>W>0).reduce((W,he)=>W+he,0)]).sort((P,W)=>P[1]-W[1])[0])==null?void 0:te[0];_&&(L=_);break}case"initialPlacement":L=l;break}if(a!==L)return{reset:{placement:L}}}return{}}}};function fv(o,e){return{top:o.top-e.height,right:o.right-e.width,bottom:o.bottom-e.height,left:o.left-e.width}}function hv(o){return QN.some(e=>o[e]>=0)}const a_=function(o){return o===void 0&&(o={}),{name:"hide",options:o,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...a}=na(o,e);switch(n){case"referenceHidden":{const r=await Ar(e,{...a,elementContext:"reference"}),c=fv(r,t.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:hv(c)}}}case"escaped":{const r=await Ar(e,{...a,altBoundary:!0}),c=fv(r,t.floating);return{data:{escapedOffsets:c,escaped:hv(c)}}}default:return{}}}}},Wx=new Set(["left","top"]);async function i_(o,e){const{placement:t,platform:n,elements:a}=o,r=await(n.isRTL==null?void 0:n.isRTL(a.floating)),c=sa(t),l=Co(t),d=gs(t)==="y",h=Wx.has(c)?-1:1,p=r&&d?-1:1,m=na(e,o);let{mainAxis:y,crossAxis:b,alignmentAxis:S}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return l&&typeof S=="number"&&(b=l==="end"?S*-1:S),d?{x:b*p,y:y*h}:{x:y*h,y:b*p}}const o_=function(o){return o===void 0&&(o=0),{name:"offset",options:o,async fn(e){var t,n;const{x:a,y:r,placement:c,middlewareData:l}=e,d=await i_(e,o);return c===((t=l.offset)==null?void 0:t.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:a+d.x,y:r+d.y,data:{...d,placement:c}}}}},r_=function(o){return o===void 0&&(o={}),{name:"shift",options:o,async fn(e){const{x:t,y:n,placement:a}=e,{mainAxis:r=!0,crossAxis:c=!1,limiter:l={fn:E=>{let{x:M,y:k}=E;return{x:M,y:k}}},...d}=na(o,e),h={x:t,y:n},p=await Ar(e,d),m=gs(sa(a)),y=cp(m);let b=h[y],S=h[m];if(r){const E=y==="y"?"top":"left",M=y==="y"?"bottom":"right",k=b+p[E],T=b-p[M];b=hh(k,b,T)}if(c){const E=m==="y"?"top":"left",M=m==="y"?"bottom":"right",k=S+p[E],T=S-p[M];S=hh(k,S,T)}const C=l.fn({...e,[y]:b,[m]:S});return{...C,data:{x:C.x-t,y:C.y-n,enabled:{[y]:r,[m]:c}}}}}},c_=function(o){return o===void 0&&(o={}),{options:o,fn(e){const{x:t,y:n,placement:a,rects:r,middlewareData:c}=e,{offset:l=0,mainAxis:d=!0,crossAxis:h=!0}=na(o,e),p={x:t,y:n},m=gs(a),y=cp(m);let b=p[y],S=p[m];const C=na(l,e),E=typeof C=="number"?{mainAxis:C,crossAxis:0}:{mainAxis:0,crossAxis:0,...C};if(d){const T=y==="y"?"height":"width",A=r.reference[y]-r.floating[T]+E.mainAxis,N=r.reference[y]+r.reference[T]-E.mainAxis;b<A?b=A:b>N&&(b=N)}if(h){var M,k;const T=y==="y"?"width":"height",A=Wx.has(sa(a)),N=r.reference[m]-r.floating[T]+(A&&((M=c.offset)==null?void 0:M[m])||0)+(A?0:E.crossAxis),q=r.reference[m]+r.reference[T]+(A?0:((k=c.offset)==null?void 0:k[m])||0)-(A?E.crossAxis:0);S<N?S=N:S>q&&(S=q)}return{[y]:b,[m]:S}}}},l_=function(o){return o===void 0&&(o={}),{name:"size",options:o,async fn(e){var t,n;const{placement:a,rects:r,platform:c,elements:l}=e,{apply:d=()=>{},...h}=na(o,e),p=await Ar(e,h),m=sa(a),y=Co(a),b=gs(a)==="y",{width:S,height:C}=r.floating;let E,M;m==="top"||m==="bottom"?(E=m,M=y===(await(c.isRTL==null?void 0:c.isRTL(l.floating))?"start":"end")?"left":"right"):(M=m,E=y==="end"?"top":"bottom");const k=C-p.top-p.bottom,T=S-p.left-p.right,A=Pa(C-p[E],k),N=Pa(S-p[M],T),q=!e.middlewareData.shift;let O=A,H=N;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(H=T),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(O=k),q&&!y){const se=Tn(p.left,0),ce=Tn(p.right,0),Z=Tn(p.top,0),te=Tn(p.bottom,0);b?H=S-2*(se!==0||ce!==0?se+ce:Tn(p.left,p.right)):O=C-2*(Z!==0||te!==0?Z+te:Tn(p.top,p.bottom))}await d({...e,availableWidth:H,availableHeight:O});const J=await c.getDimensions(l.floating);return S!==J.width||C!==J.height?{reset:{rects:!0}}:{}}}};function iu(){return typeof window<"u"}function Mo(o){return Xx(o)?(o.nodeName||"").toLowerCase():"#document"}function kn(o){var e;return(o==null||(e=o.ownerDocument)==null?void 0:e.defaultView)||window}function Es(o){var e;return(e=(Xx(o)?o.ownerDocument:o.document)||window.document)==null?void 0:e.documentElement}function Xx(o){return iu()?o instanceof Node||o instanceof kn(o).Node:!1}function ss(o){return iu()?o instanceof Element||o instanceof kn(o).Element:!1}function ws(o){return iu()?o instanceof HTMLElement||o instanceof kn(o).HTMLElement:!1}function pv(o){return!iu()||typeof ShadowRoot>"u"?!1:o instanceof ShadowRoot||o instanceof kn(o).ShadowRoot}const u_=new Set(["inline","contents"]);function Br(o){const{overflow:e,overflowX:t,overflowY:n,display:a}=as(o);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!u_.has(a)}const d_=new Set(["table","td","th"]);function f_(o){return d_.has(Mo(o))}const h_=[":popover-open",":modal"];function ou(o){return h_.some(e=>{try{return o.matches(e)}catch{return!1}})}const p_=["transform","translate","scale","rotate","perspective"],g_=["transform","translate","scale","rotate","perspective","filter"],m_=["paint","layout","strict","content"];function dp(o){const e=fp(),t=ss(o)?as(o):o;return p_.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||g_.some(n=>(t.willChange||"").includes(n))||m_.some(n=>(t.contain||"").includes(n))}function y_(o){let e=Oa(o);for(;ws(e)&&!yo(e);){if(dp(e))return e;if(ou(e))return null;e=Oa(e)}return null}function fp(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const v_=new Set(["html","body","#document"]);function yo(o){return v_.has(Mo(o))}function as(o){return kn(o).getComputedStyle(o)}function ru(o){return ss(o)?{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}:{scrollLeft:o.scrollX,scrollTop:o.scrollY}}function Oa(o){if(Mo(o)==="html")return o;const e=o.assignedSlot||o.parentNode||pv(o)&&o.host||Es(o);return pv(e)?e.host:e}function Zx(o){const e=Oa(o);return yo(e)?o.ownerDocument?o.ownerDocument.body:o.body:ws(e)&&Br(e)?e:Zx(e)}function Dr(o,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const a=Zx(o),r=a===((n=o.ownerDocument)==null?void 0:n.body),c=kn(a);if(r){const l=gh(c);return e.concat(c,c.visualViewport||[],Br(a)?a:[],l&&t?Dr(l):[])}return e.concat(a,Dr(a,[],t))}function gh(o){return o.parent&&Object.getPrototypeOf(o.parent)?o.frameElement:null}function Jx(o){const e=as(o);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const a=ws(o),r=a?o.offsetWidth:t,c=a?o.offsetHeight:n,l=_l(t)!==r||_l(n)!==c;return l&&(t=r,n=c),{width:t,height:n,$:l}}function hp(o){return ss(o)?o:o.contextElement}function po(o){const e=hp(o);if(!ws(e))return bs(1);const t=e.getBoundingClientRect(),{width:n,height:a,$:r}=Jx(e);let c=(r?_l(t.width):t.width)/n,l=(r?_l(t.height):t.height)/a;return(!c||!Number.isFinite(c))&&(c=1),(!l||!Number.isFinite(l))&&(l=1),{x:c,y:l}}const b_=bs(0);function ew(o){const e=kn(o);return!fp()||!e.visualViewport?b_:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function x_(o,e,t){return e===void 0&&(e=!1),!t||e&&t!==kn(o)?!1:e}function gi(o,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const a=o.getBoundingClientRect(),r=hp(o);let c=bs(1);e&&(n?ss(n)&&(c=po(n)):c=po(o));const l=x_(r,t,n)?ew(r):bs(0);let d=(a.left+l.x)/c.x,h=(a.top+l.y)/c.y,p=a.width/c.x,m=a.height/c.y;if(r){const y=kn(r),b=n&&ss(n)?kn(n):n;let S=y,C=gh(S);for(;C&&n&&b!==S;){const E=po(C),M=C.getBoundingClientRect(),k=as(C),T=M.left+(C.clientLeft+parseFloat(k.paddingLeft))*E.x,A=M.top+(C.clientTop+parseFloat(k.paddingTop))*E.y;d*=E.x,h*=E.y,p*=E.x,m*=E.y,d+=T,h+=A,S=kn(C),C=gh(S)}}return Ll({width:p,height:m,x:d,y:h})}function cu(o,e){const t=ru(o).scrollLeft;return e?e.left+t:gi(Es(o)).left+t}function tw(o,e){const t=o.getBoundingClientRect(),n=t.left+e.scrollLeft-cu(o,t),a=t.top+e.scrollTop;return{x:n,y:a}}function w_(o){let{elements:e,rect:t,offsetParent:n,strategy:a}=o;const r=a==="fixed",c=Es(n),l=e?ou(e.floating):!1;if(n===c||l&&r)return t;let d={scrollLeft:0,scrollTop:0},h=bs(1);const p=bs(0),m=ws(n);if((m||!m&&!r)&&((Mo(n)!=="body"||Br(c))&&(d=ru(n)),ws(n))){const b=gi(n);h=po(n),p.x=b.x+n.clientLeft,p.y=b.y+n.clientTop}const y=c&&!m&&!r?tw(c,d):bs(0);return{width:t.width*h.x,height:t.height*h.y,x:t.x*h.x-d.scrollLeft*h.x+p.x+y.x,y:t.y*h.y-d.scrollTop*h.y+p.y+y.y}}function S_(o){return Array.from(o.getClientRects())}function C_(o){const e=Es(o),t=ru(o),n=o.ownerDocument.body,a=Tn(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=Tn(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let c=-t.scrollLeft+cu(o);const l=-t.scrollTop;return as(n).direction==="rtl"&&(c+=Tn(e.clientWidth,n.clientWidth)-a),{width:a,height:r,x:c,y:l}}const gv=25;function M_(o,e){const t=kn(o),n=Es(o),a=t.visualViewport;let r=n.clientWidth,c=n.clientHeight,l=0,d=0;if(a){r=a.width,c=a.height;const p=fp();(!p||p&&e==="fixed")&&(l=a.offsetLeft,d=a.offsetTop)}const h=cu(n);if(h<=0){const p=n.ownerDocument,m=p.body,y=getComputedStyle(m),b=p.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,S=Math.abs(n.clientWidth-m.clientWidth-b);S<=gv&&(r-=S)}else h<=gv&&(r+=h);return{width:r,height:c,x:l,y:d}}const E_=new Set(["absolute","fixed"]);function R_(o,e){const t=gi(o,!0,e==="fixed"),n=t.top+o.clientTop,a=t.left+o.clientLeft,r=ws(o)?po(o):bs(1),c=o.clientWidth*r.x,l=o.clientHeight*r.y,d=a*r.x,h=n*r.y;return{width:c,height:l,x:d,y:h}}function mv(o,e,t){let n;if(e==="viewport")n=M_(o,t);else if(e==="document")n=C_(Es(o));else if(ss(e))n=R_(e,t);else{const a=ew(o);n={x:e.x-a.x,y:e.y-a.y,width:e.width,height:e.height}}return Ll(n)}function nw(o,e){const t=Oa(o);return t===e||!ss(t)||yo(t)?!1:as(t).position==="fixed"||nw(t,e)}function T_(o,e){const t=e.get(o);if(t)return t;let n=Dr(o,[],!1).filter(l=>ss(l)&&Mo(l)!=="body"),a=null;const r=as(o).position==="fixed";let c=r?Oa(o):o;for(;ss(c)&&!yo(c);){const l=as(c),d=dp(c);!d&&l.position==="fixed"&&(a=null),(r?!d&&!a:!d&&l.position==="static"&&!!a&&E_.has(a.position)||Br(c)&&!d&&nw(o,c))?n=n.filter(p=>p!==c):a=l,c=Oa(c)}return e.set(o,n),n}function k_(o){let{element:e,boundary:t,rootBoundary:n,strategy:a}=o;const c=[...t==="clippingAncestors"?ou(e)?[]:T_(e,this._c):[].concat(t),n],l=c[0],d=c.reduce((h,p)=>{const m=mv(e,p,a);return h.top=Tn(m.top,h.top),h.right=Pa(m.right,h.right),h.bottom=Pa(m.bottom,h.bottom),h.left=Tn(m.left,h.left),h},mv(e,l,a));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function A_(o){const{width:e,height:t}=Jx(o);return{width:e,height:t}}function D_(o,e,t){const n=ws(e),a=Es(e),r=t==="fixed",c=gi(o,!0,r,e);let l={scrollLeft:0,scrollTop:0};const d=bs(0);function h(){d.x=cu(a)}if(n||!n&&!r)if((Mo(e)!=="body"||Br(a))&&(l=ru(e)),n){const b=gi(e,!0,r,e);d.x=b.x+e.clientLeft,d.y=b.y+e.clientTop}else a&&h();r&&!n&&a&&h();const p=a&&!n&&!r?tw(a,l):bs(0),m=c.left+l.scrollLeft-d.x-p.x,y=c.top+l.scrollTop-d.y-p.y;return{x:m,y,width:c.width,height:c.height}}function nh(o){return as(o).position==="static"}function yv(o,e){if(!ws(o)||as(o).position==="fixed")return null;if(e)return e(o);let t=o.offsetParent;return Es(o)===t&&(t=t.ownerDocument.body),t}function sw(o,e){const t=kn(o);if(ou(o))return t;if(!ws(o)){let a=Oa(o);for(;a&&!yo(a);){if(ss(a)&&!nh(a))return a;a=Oa(a)}return t}let n=yv(o,e);for(;n&&f_(n)&&nh(n);)n=yv(n,e);return n&&yo(n)&&nh(n)&&!dp(n)?t:n||y_(o)||t}const N_=async function(o){const e=this.getOffsetParent||sw,t=this.getDimensions,n=await t(o.floating);return{reference:D_(o.reference,await e(o.floating),o.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function __(o){return as(o).direction==="rtl"}const j_={convertOffsetParentRelativeRectToViewportRelativeRect:w_,getDocumentElement:Es,getClippingRect:k_,getOffsetParent:sw,getElementRects:N_,getClientRects:S_,getDimensions:A_,getScale:po,isElement:ss,isRTL:__};function aw(o,e){return o.x===e.x&&o.y===e.y&&o.width===e.width&&o.height===e.height}function L_(o,e){let t=null,n;const a=Es(o);function r(){var l;clearTimeout(n),(l=t)==null||l.disconnect(),t=null}function c(l,d){l===void 0&&(l=!1),d===void 0&&(d=1),r();const h=o.getBoundingClientRect(),{left:p,top:m,width:y,height:b}=h;if(l||e(),!y||!b)return;const S=hl(m),C=hl(a.clientWidth-(p+y)),E=hl(a.clientHeight-(m+b)),M=hl(p),T={rootMargin:-S+"px "+-C+"px "+-E+"px "+-M+"px",threshold:Tn(0,Pa(1,d))||1};let A=!0;function N(q){const O=q[0].intersectionRatio;if(O!==d){if(!A)return c();O?c(!1,O):n=setTimeout(()=>{c(!1,1e-7)},1e3)}O===1&&!aw(h,o.getBoundingClientRect())&&c(),A=!1}try{t=new IntersectionObserver(N,{...T,root:a.ownerDocument})}catch{t=new IntersectionObserver(N,T)}t.observe(o)}return c(!0),r}function z_(o,e,t,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:r=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:d=!1}=n,h=hp(o),p=a||r?[...h?Dr(h):[],...Dr(e)]:[];p.forEach(M=>{a&&M.addEventListener("scroll",t,{passive:!0}),r&&M.addEventListener("resize",t)});const m=h&&l?L_(h,t):null;let y=-1,b=null;c&&(b=new ResizeObserver(M=>{let[k]=M;k&&k.target===h&&b&&(b.unobserve(e),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var T;(T=b)==null||T.observe(e)})),t()}),h&&!d&&b.observe(h),b.observe(e));let S,C=d?gi(o):null;d&&E();function E(){const M=gi(o);C&&!aw(C,M)&&t(),C=M,S=requestAnimationFrame(E)}return t(),()=>{var M;p.forEach(k=>{a&&k.removeEventListener("scroll",t),r&&k.removeEventListener("resize",t)}),m?.(),(M=b)==null||M.disconnect(),b=null,d&&cancelAnimationFrame(S)}}const P_=o_,O_=r_,I_=s_,q_=l_,H_=a_,vv=n_,B_=c_,$_=(o,e,t)=>{const n=new Map,a={platform:j_,...t},r={...a.platform,_c:n};return t_(o,e,{...a,platform:r})};var U_=typeof document<"u",Q_=function(){},Sl=U_?w.useLayoutEffect:Q_;function zl(o,e){if(o===e)return!0;if(typeof o!=typeof e)return!1;if(typeof o=="function"&&o.toString()===e.toString())return!0;let t,n,a;if(o&&e&&typeof o=="object"){if(Array.isArray(o)){if(t=o.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!zl(o[n],e[n]))return!1;return!0}if(a=Object.keys(o),t=a.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,a[n]))return!1;for(n=t;n--!==0;){const r=a[n];if(!(r==="_owner"&&o.$$typeof)&&!zl(o[r],e[r]))return!1}return!0}return o!==o&&e!==e}function iw(o){return typeof window>"u"?1:(o.ownerDocument.defaultView||window).devicePixelRatio||1}function bv(o,e){const t=iw(o);return Math.round(e*t)/t}function sh(o){const e=w.useRef(o);return Sl(()=>{e.current=o}),e}function F_(o){o===void 0&&(o={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:a,elements:{reference:r,floating:c}={},transform:l=!0,whileElementsMounted:d,open:h}=o,[p,m]=w.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[y,b]=w.useState(n);zl(y,n)||b(n);const[S,C]=w.useState(null),[E,M]=w.useState(null),k=w.useCallback(P=>{P!==q.current&&(q.current=P,C(P))},[]),T=w.useCallback(P=>{P!==O.current&&(O.current=P,M(P))},[]),A=r||S,N=c||E,q=w.useRef(null),O=w.useRef(null),H=w.useRef(p),J=d!=null,se=sh(d),ce=sh(a),Z=sh(h),te=w.useCallback(()=>{if(!q.current||!O.current)return;const P={placement:e,strategy:t,middleware:y};ce.current&&(P.platform=ce.current),$_(q.current,O.current,P).then(W=>{const he={...W,isPositioned:Z.current!==!1};le.current&&!zl(H.current,he)&&(H.current=he,Lr.flushSync(()=>{m(he)}))})},[y,e,t,ce,Z]);Sl(()=>{h===!1&&H.current.isPositioned&&(H.current.isPositioned=!1,m(P=>({...P,isPositioned:!1})))},[h]);const le=w.useRef(!1);Sl(()=>(le.current=!0,()=>{le.current=!1}),[]),Sl(()=>{if(A&&(q.current=A),N&&(O.current=N),A&&N){if(se.current)return se.current(A,N,te);te()}},[A,N,te,se,J]);const ue=w.useMemo(()=>({reference:q,floating:O,setReference:k,setFloating:T}),[k,T]),L=w.useMemo(()=>({reference:A,floating:N}),[A,N]),_=w.useMemo(()=>{const P={position:t,left:0,top:0};if(!L.floating)return P;const W=bv(L.floating,p.x),he=bv(L.floating,p.y);return l?{...P,transform:"translate("+W+"px, "+he+"px)",...iw(L.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:W,top:he}},[t,l,L.floating,p.x,p.y]);return w.useMemo(()=>({...p,update:te,refs:ue,elements:L,floatingStyles:_}),[p,te,ue,L,_])}const G_=o=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:o,fn(t){const{element:n,padding:a}=typeof o=="function"?o(t):o;return n&&e(n)?n.current!=null?vv({element:n.current,padding:a}).fn(t):{}:n?vv({element:n,padding:a}).fn(t):{}}}},V_=(o,e)=>({...P_(o),options:[o,e]}),K_=(o,e)=>({...O_(o),options:[o,e]}),Y_=(o,e)=>({...B_(o),options:[o,e]}),W_=(o,e)=>({...I_(o),options:[o,e]}),X_=(o,e)=>({...q_(o),options:[o,e]}),Z_=(o,e)=>({...H_(o),options:[o,e]}),J_=(o,e)=>({...G_(o),options:[o,e]});var ej="Arrow",ow=w.forwardRef((o,e)=>{const{children:t,width:n=10,height:a=5,...r}=o;return g.jsx(ke.svg,{...r,ref:e,width:n,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:o.asChild?t:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});ow.displayName=ej;var tj=ow;function lu(o){const[e,t]=w.useState(void 0);return sn(()=>{if(o){t({width:o.offsetWidth,height:o.offsetHeight});const n=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const r=a[0];let c,l;if("borderBoxSize"in r){const d=r.borderBoxSize,h=Array.isArray(d)?d[0]:d;c=h.inlineSize,l=h.blockSize}else c=o.offsetWidth,l=o.offsetHeight;t({width:c,height:l})});return n.observe(o,{box:"border-box"}),()=>n.unobserve(o)}else t(void 0)},[o]),e}var pp="Popper",[rw,Eo]=bn(pp),[nj,cw]=rw(pp),lw=o=>{const{__scopePopper:e,children:t}=o,[n,a]=w.useState(null);return g.jsx(nj,{scope:e,anchor:n,onAnchorChange:a,children:t})};lw.displayName=pp;var uw="PopperAnchor",dw=w.forwardRef((o,e)=>{const{__scopePopper:t,virtualRef:n,...a}=o,r=cw(uw,t),c=w.useRef(null),l=_e(e,c),d=w.useRef(null);return w.useEffect(()=>{const h=d.current;d.current=n?.current||c.current,h!==d.current&&r.onAnchorChange(d.current)}),n?null:g.jsx(ke.div,{...a,ref:l})});dw.displayName=uw;var gp="PopperContent",[sj,aj]=rw(gp),fw=w.forwardRef((o,e)=>{const{__scopePopper:t,side:n="bottom",sideOffset:a=0,align:r="center",alignOffset:c=0,arrowPadding:l=0,avoidCollisions:d=!0,collisionBoundary:h=[],collisionPadding:p=0,sticky:m="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:S,...C}=o,E=cw(gp,t),[M,k]=w.useState(null),T=_e(e,$=>k($)),[A,N]=w.useState(null),q=lu(A),O=q?.width??0,H=q?.height??0,J=n+(r!=="center"?"-"+r:""),se=typeof p=="number"?p:{top:0,right:0,bottom:0,left:0,...p},ce=Array.isArray(h)?h:[h],Z=ce.length>0,te={padding:se,boundary:ce.filter(oj),altBoundary:Z},{refs:le,floatingStyles:ue,placement:L,isPositioned:_,middlewareData:P}=F_({strategy:"fixed",placement:J,whileElementsMounted:(...$)=>z_(...$,{animationFrame:b==="always"}),elements:{reference:E.anchor},middleware:[V_({mainAxis:a+H,alignmentAxis:c}),d&&K_({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?Y_():void 0,...te}),d&&W_({...te}),X_({...te,apply:({elements:$,rects:V,availableWidth:pe,availableHeight:me})=>{const{width:ye,height:ve}=V.reference,Le=$.floating.style;Le.setProperty("--radix-popper-available-width",`${pe}px`),Le.setProperty("--radix-popper-available-height",`${me}px`),Le.setProperty("--radix-popper-anchor-width",`${ye}px`),Le.setProperty("--radix-popper-anchor-height",`${ve}px`)}}),A&&J_({element:A,padding:l}),rj({arrowWidth:O,arrowHeight:H}),y&&Z_({strategy:"referenceHidden",...te})]}),[W,he]=gw(L),j=nn(S);sn(()=>{_&&j?.()},[_,j]);const Q=P.arrow?.x,Y=P.arrow?.y,ae=P.arrow?.centerOffset!==0,[U,ie]=w.useState();return sn(()=>{M&&ie(window.getComputedStyle(M).zIndex)},[M]),g.jsx("div",{ref:le.setFloating,"data-radix-popper-content-wrapper":"",style:{...ue,transform:_?ue.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:U,"--radix-popper-transform-origin":[P.transformOrigin?.x,P.transformOrigin?.y].join(" "),...P.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:o.dir,children:g.jsx(sj,{scope:t,placedSide:W,onArrowChange:N,arrowX:Q,arrowY:Y,shouldHideArrow:ae,children:g.jsx(ke.div,{"data-side":W,"data-align":he,...C,ref:T,style:{...C.style,animation:_?void 0:"none"}})})})});fw.displayName=gp;var hw="PopperArrow",ij={top:"bottom",right:"left",bottom:"top",left:"right"},pw=w.forwardRef(function(e,t){const{__scopePopper:n,...a}=e,r=aj(hw,n),c=ij[r.placedSide];return g.jsx("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[c]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:g.jsx(tj,{...a,ref:t,style:{...a.style,display:"block"}})})});pw.displayName=hw;function oj(o){return o!==null}var rj=o=>({name:"transformOrigin",options:o,fn(e){const{placement:t,rects:n,middlewareData:a}=e,c=a.arrow?.centerOffset!==0,l=c?0:o.arrowWidth,d=c?0:o.arrowHeight,[h,p]=gw(t),m={start:"0%",center:"50%",end:"100%"}[p],y=(a.arrow?.x??0)+l/2,b=(a.arrow?.y??0)+d/2;let S="",C="";return h==="bottom"?(S=c?m:`${y}px`,C=`${-d}px`):h==="top"?(S=c?m:`${y}px`,C=`${n.floating.height+d}px`):h==="right"?(S=`${-d}px`,C=c?m:`${b}px`):h==="left"&&(S=`${n.floating.width+d}px`,C=c?m:`${b}px`),{data:{x:S,y:C}}}});function gw(o){const[e,t="center"]=o.split("-");return[e,t]}var mp=lw,uu=dw,yp=fw,vp=pw;function cj(o){const e=lj(o),t=w.forwardRef((n,a)=>{const{children:r,...c}=n,l=w.Children.toArray(r),d=l.find(dj);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}function lj(o){const e=w.forwardRef((t,n)=>{const{children:a,...r}=t;if(w.isValidElement(a)){const c=hj(a),l=fj(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var uj=Symbol("radix.slottable");function dj(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===uj}function fj(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function hj(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}var mh=["Enter"," "],pj=["ArrowDown","PageUp","Home"],mw=["ArrowUp","PageDown","End"],gj=[...pj,...mw],mj={ltr:[...mh,"ArrowRight"],rtl:[...mh,"ArrowLeft"]},yj={ltr:["ArrowLeft"],rtl:["ArrowRight"]},$r="Menu",[Nr,vj,bj]=tu($r),[vi,yw]=bn($r,[bj,Eo,nu]),du=Eo(),vw=nu(),[xj,bi]=vi($r),[wj,Ur]=vi($r),bw=o=>{const{__scopeMenu:e,open:t=!1,children:n,dir:a,onOpenChange:r,modal:c=!0}=o,l=du(e),[d,h]=w.useState(null),p=w.useRef(!1),m=nn(r),y=So(a);return w.useEffect(()=>{const b=()=>{p.current=!0,document.addEventListener("pointerdown",S,{capture:!0,once:!0}),document.addEventListener("pointermove",S,{capture:!0,once:!0})},S=()=>p.current=!1;return document.addEventListener("keydown",b,{capture:!0}),()=>{document.removeEventListener("keydown",b,{capture:!0}),document.removeEventListener("pointerdown",S,{capture:!0}),document.removeEventListener("pointermove",S,{capture:!0})}},[]),g.jsx(mp,{...l,children:g.jsx(xj,{scope:e,open:t,onOpenChange:m,content:d,onContentChange:h,children:g.jsx(wj,{scope:e,onClose:w.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:p,dir:y,modal:c,children:n})})})};bw.displayName=$r;var Sj="MenuAnchor",bp=w.forwardRef((o,e)=>{const{__scopeMenu:t,...n}=o,a=du(t);return g.jsx(uu,{...a,...n,ref:e})});bp.displayName=Sj;var xp="MenuPortal",[Cj,xw]=vi(xp,{forceMount:void 0}),ww=o=>{const{__scopeMenu:e,forceMount:t,children:n,container:a}=o,r=bi(xp,e);return g.jsx(Cj,{scope:e,forceMount:t,children:g.jsx(rn,{present:t||r.open,children:g.jsx(Ir,{asChild:!0,container:a,children:n})})})};ww.displayName=xp;var Vn="MenuContent",[Mj,wp]=vi(Vn),Sw=w.forwardRef((o,e)=>{const t=xw(Vn,o.__scopeMenu),{forceMount:n=t.forceMount,...a}=o,r=bi(Vn,o.__scopeMenu),c=Ur(Vn,o.__scopeMenu);return g.jsx(Nr.Provider,{scope:o.__scopeMenu,children:g.jsx(rn,{present:n||r.open,children:g.jsx(Nr.Slot,{scope:o.__scopeMenu,children:c.modal?g.jsx(Ej,{...a,ref:e}):g.jsx(Rj,{...a,ref:e})})})})}),Ej=w.forwardRef((o,e)=>{const t=bi(Vn,o.__scopeMenu),n=w.useRef(null),a=_e(e,n);return w.useEffect(()=>{const r=n.current;if(r)return Kl(r)},[]),g.jsx(Sp,{...o,ref:a,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ge(o.onFocusOutside,r=>r.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Rj=w.forwardRef((o,e)=>{const t=bi(Vn,o.__scopeMenu);return g.jsx(Sp,{...o,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),Tj=cj("MenuContent.ScrollLock"),Sp=w.forwardRef((o,e)=>{const{__scopeMenu:t,loop:n=!1,trapFocus:a,onOpenAutoFocus:r,onCloseAutoFocus:c,disableOutsidePointerEvents:l,onEntryFocus:d,onEscapeKeyDown:h,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:y,onDismiss:b,disableOutsideScroll:S,...C}=o,E=bi(Vn,t),M=Ur(Vn,t),k=du(t),T=vw(t),A=vj(t),[N,q]=w.useState(null),O=w.useRef(null),H=_e(e,O,E.onContentChange),J=w.useRef(0),se=w.useRef(""),ce=w.useRef(0),Z=w.useRef(null),te=w.useRef("right"),le=w.useRef(0),ue=S?qr:w.Fragment,L=S?{as:Tj,allowPinchZoom:!0}:void 0,_=W=>{const he=se.current+W,j=A().filter($=>!$.disabled),Q=document.activeElement,Y=j.find($=>$.ref.current===Q)?.textValue,ae=j.map($=>$.textValue),U=qj(ae,he,Y),ie=j.find($=>$.textValue===U)?.ref.current;(function $(V){se.current=V,window.clearTimeout(J.current),V!==""&&(J.current=window.setTimeout(()=>$(""),1e3))})(he),ie&&setTimeout(()=>ie.focus())};w.useEffect(()=>()=>window.clearTimeout(J.current),[]),Gl();const P=w.useCallback(W=>te.current===Z.current?.side&&Bj(W,Z.current?.area),[]);return g.jsx(Mj,{scope:t,searchRef:se,onItemEnter:w.useCallback(W=>{P(W)&&W.preventDefault()},[P]),onItemLeave:w.useCallback(W=>{P(W)||(O.current?.focus(),q(null))},[P]),onTriggerLeave:w.useCallback(W=>{P(W)&&W.preventDefault()},[P]),pointerGraceTimerRef:ce,onPointerGraceIntentChange:w.useCallback(W=>{Z.current=W},[]),children:g.jsx(ue,{...L,children:g.jsx(Or,{asChild:!0,trapped:a,onMountAutoFocus:ge(r,W=>{W.preventDefault(),O.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:c,children:g.jsx(Pr,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:h,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:y,onDismiss:b,children:g.jsx(Lx,{asChild:!0,...T,dir:M.dir,orientation:"vertical",loop:n,currentTabStopId:N,onCurrentTabStopIdChange:q,onEntryFocus:ge(d,W=>{M.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(yp,{role:"menu","aria-orientation":"vertical","data-state":Iw(E.open),"data-radix-menu-content":"",dir:M.dir,...k,...C,ref:H,style:{outline:"none",...C.style},onKeyDown:ge(C.onKeyDown,W=>{const j=W.target.closest("[data-radix-menu-content]")===W.currentTarget,Q=W.ctrlKey||W.altKey||W.metaKey,Y=W.key.length===1;j&&(W.key==="Tab"&&W.preventDefault(),!Q&&Y&&_(W.key));const ae=O.current;if(W.target!==ae||!gj.includes(W.key))return;W.preventDefault();const ie=A().filter($=>!$.disabled).map($=>$.ref.current);mw.includes(W.key)&&ie.reverse(),Oj(ie)}),onBlur:ge(o.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(J.current),se.current="")}),onPointerMove:ge(o.onPointerMove,_r(W=>{const he=W.target,j=le.current!==W.clientX;if(W.currentTarget.contains(he)&&j){const Q=W.clientX>le.current?"right":"left";te.current=Q,le.current=W.clientX}}))})})})})})})});Sw.displayName=Vn;var kj="MenuGroup",Cp=w.forwardRef((o,e)=>{const{__scopeMenu:t,...n}=o;return g.jsx(ke.div,{role:"group",...n,ref:e})});Cp.displayName=kj;var Aj="MenuLabel",Cw=w.forwardRef((o,e)=>{const{__scopeMenu:t,...n}=o;return g.jsx(ke.div,{...n,ref:e})});Cw.displayName=Aj;var Pl="MenuItem",xv="menu.itemSelect",fu=w.forwardRef((o,e)=>{const{disabled:t=!1,onSelect:n,...a}=o,r=w.useRef(null),c=Ur(Pl,o.__scopeMenu),l=wp(Pl,o.__scopeMenu),d=_e(e,r),h=w.useRef(!1),p=()=>{const m=r.current;if(!t&&m){const y=new CustomEvent(xv,{bubbles:!0,cancelable:!0});m.addEventListener(xv,b=>n?.(b),{once:!0}),hb(m,y),y.defaultPrevented?h.current=!1:c.onClose()}};return g.jsx(Mw,{...a,ref:d,disabled:t,onClick:ge(o.onClick,p),onPointerDown:m=>{o.onPointerDown?.(m),h.current=!0},onPointerUp:ge(o.onPointerUp,m=>{h.current||m.currentTarget?.click()}),onKeyDown:ge(o.onKeyDown,m=>{const y=l.searchRef.current!=="";t||y&&m.key===" "||mh.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});fu.displayName=Pl;var Mw=w.forwardRef((o,e)=>{const{__scopeMenu:t,disabled:n=!1,textValue:a,...r}=o,c=wp(Pl,t),l=vw(t),d=w.useRef(null),h=_e(e,d),[p,m]=w.useState(!1),[y,b]=w.useState("");return w.useEffect(()=>{const S=d.current;S&&b((S.textContent??"").trim())},[r.children]),g.jsx(Nr.ItemSlot,{scope:t,disabled:n,textValue:a??y,children:g.jsx(zx,{asChild:!0,...l,focusable:!n,children:g.jsx(ke.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...r,ref:h,onPointerMove:ge(o.onPointerMove,_r(S=>{n?c.onItemLeave(S):(c.onItemEnter(S),S.defaultPrevented||S.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ge(o.onPointerLeave,_r(S=>c.onItemLeave(S))),onFocus:ge(o.onFocus,()=>m(!0)),onBlur:ge(o.onBlur,()=>m(!1))})})})}),Dj="MenuCheckboxItem",Ew=w.forwardRef((o,e)=>{const{checked:t=!1,onCheckedChange:n,...a}=o;return g.jsx(Dw,{scope:o.__scopeMenu,checked:t,children:g.jsx(fu,{role:"menuitemcheckbox","aria-checked":Ol(t)?"mixed":t,...a,ref:e,"data-state":Ep(t),onSelect:ge(a.onSelect,()=>n?.(Ol(t)?!0:!t),{checkForDefaultPrevented:!1})})})});Ew.displayName=Dj;var Rw="MenuRadioGroup",[Nj,_j]=vi(Rw,{value:void 0,onValueChange:()=>{}}),Tw=w.forwardRef((o,e)=>{const{value:t,onValueChange:n,...a}=o,r=nn(n);return g.jsx(Nj,{scope:o.__scopeMenu,value:t,onValueChange:r,children:g.jsx(Cp,{...a,ref:e})})});Tw.displayName=Rw;var kw="MenuRadioItem",Aw=w.forwardRef((o,e)=>{const{value:t,...n}=o,a=_j(kw,o.__scopeMenu),r=t===a.value;return g.jsx(Dw,{scope:o.__scopeMenu,checked:r,children:g.jsx(fu,{role:"menuitemradio","aria-checked":r,...n,ref:e,"data-state":Ep(r),onSelect:ge(n.onSelect,()=>a.onValueChange?.(t),{checkForDefaultPrevented:!1})})})});Aw.displayName=kw;var Mp="MenuItemIndicator",[Dw,jj]=vi(Mp,{checked:!1}),Nw=w.forwardRef((o,e)=>{const{__scopeMenu:t,forceMount:n,...a}=o,r=jj(Mp,t);return g.jsx(rn,{present:n||Ol(r.checked)||r.checked===!0,children:g.jsx(ke.span,{...a,ref:e,"data-state":Ep(r.checked)})})});Nw.displayName=Mp;var Lj="MenuSeparator",_w=w.forwardRef((o,e)=>{const{__scopeMenu:t,...n}=o;return g.jsx(ke.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});_w.displayName=Lj;var zj="MenuArrow",jw=w.forwardRef((o,e)=>{const{__scopeMenu:t,...n}=o,a=du(t);return g.jsx(vp,{...a,...n,ref:e})});jw.displayName=zj;var Pj="MenuSub",[RO,Lw]=vi(Pj),wr="MenuSubTrigger",zw=w.forwardRef((o,e)=>{const t=bi(wr,o.__scopeMenu),n=Ur(wr,o.__scopeMenu),a=Lw(wr,o.__scopeMenu),r=wp(wr,o.__scopeMenu),c=w.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:d}=r,h={__scopeMenu:o.__scopeMenu},p=w.useCallback(()=>{c.current&&window.clearTimeout(c.current),c.current=null},[]);return w.useEffect(()=>p,[p]),w.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),d(null)}},[l,d]),g.jsx(bp,{asChild:!0,...h,children:g.jsx(Mw,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":a.contentId,"data-state":Iw(t.open),...o,ref:Ss(e,a.onTriggerChange),onClick:m=>{o.onClick?.(m),!(o.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ge(o.onPointerMove,_r(m=>{r.onItemEnter(m),!m.defaultPrevented&&!o.disabled&&!t.open&&!c.current&&(r.onPointerGraceIntentChange(null),c.current=window.setTimeout(()=>{t.onOpenChange(!0),p()},100))})),onPointerLeave:ge(o.onPointerLeave,_r(m=>{p();const y=t.content?.getBoundingClientRect();if(y){const b=t.content?.dataset.side,S=b==="right",C=S?-5:5,E=y[S?"left":"right"],M=y[S?"right":"left"];r.onPointerGraceIntentChange({area:[{x:m.clientX+C,y:m.clientY},{x:E,y:y.top},{x:M,y:y.top},{x:M,y:y.bottom},{x:E,y:y.bottom}],side:b}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>r.onPointerGraceIntentChange(null),300)}else{if(r.onTriggerLeave(m),m.defaultPrevented)return;r.onPointerGraceIntentChange(null)}})),onKeyDown:ge(o.onKeyDown,m=>{const y=r.searchRef.current!=="";o.disabled||y&&m.key===" "||mj[n.dir].includes(m.key)&&(t.onOpenChange(!0),t.content?.focus(),m.preventDefault())})})})});zw.displayName=wr;var Pw="MenuSubContent",Ow=w.forwardRef((o,e)=>{const t=xw(Vn,o.__scopeMenu),{forceMount:n=t.forceMount,...a}=o,r=bi(Vn,o.__scopeMenu),c=Ur(Vn,o.__scopeMenu),l=Lw(Pw,o.__scopeMenu),d=w.useRef(null),h=_e(e,d);return g.jsx(Nr.Provider,{scope:o.__scopeMenu,children:g.jsx(rn,{present:n||r.open,children:g.jsx(Nr.Slot,{scope:o.__scopeMenu,children:g.jsx(Sp,{id:l.contentId,"aria-labelledby":l.triggerId,...a,ref:h,align:"start",side:c.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:p=>{c.isUsingKeyboardRef.current&&d.current?.focus(),p.preventDefault()},onCloseAutoFocus:p=>p.preventDefault(),onFocusOutside:ge(o.onFocusOutside,p=>{p.target!==l.trigger&&r.onOpenChange(!1)}),onEscapeKeyDown:ge(o.onEscapeKeyDown,p=>{c.onClose(),p.preventDefault()}),onKeyDown:ge(o.onKeyDown,p=>{const m=p.currentTarget.contains(p.target),y=yj[c.dir].includes(p.key);m&&y&&(r.onOpenChange(!1),l.trigger?.focus(),p.preventDefault())})})})})})});Ow.displayName=Pw;function Iw(o){return o?"open":"closed"}function Ol(o){return o==="indeterminate"}function Ep(o){return Ol(o)?"indeterminate":o?"checked":"unchecked"}function Oj(o){const e=document.activeElement;for(const t of o)if(t===e||(t.focus(),document.activeElement!==e))return}function Ij(o,e){return o.map((t,n)=>o[(e+n)%o.length])}function qj(o,e,t){const a=e.length>1&&Array.from(e).every(h=>h===e[0])?e[0]:e,r=t?o.indexOf(t):-1;let c=Ij(o,Math.max(r,0));a.length===1&&(c=c.filter(h=>h!==t));const d=c.find(h=>h.toLowerCase().startsWith(a.toLowerCase()));return d!==t?d:void 0}function Hj(o,e){const{x:t,y:n}=o;let a=!1;for(let r=0,c=e.length-1;r<e.length;c=r++){const l=e[r],d=e[c],h=l.x,p=l.y,m=d.x,y=d.y;p>n!=y>n&&t<(m-h)*(n-p)/(y-p)+h&&(a=!a)}return a}function Bj(o,e){if(!e)return!1;const t={x:o.clientX,y:o.clientY};return Hj(t,e)}function _r(o){return e=>e.pointerType==="mouse"?o(e):void 0}var $j=bw,Uj=bp,Qj=ww,Fj=Sw,Gj=Cp,Vj=Cw,Kj=fu,Yj=Ew,Wj=Tw,Xj=Aw,Zj=Nw,Jj=_w,eL=jw,tL=zw,nL=Ow,hu="DropdownMenu",[sL]=bn(hu,[yw]),dn=yw(),[aL,qw]=sL(hu),Hw=o=>{const{__scopeDropdownMenu:e,children:t,dir:n,open:a,defaultOpen:r,onOpenChange:c,modal:l=!0}=o,d=dn(e),h=w.useRef(null),[p,m]=xs({prop:a,defaultProp:r??!1,onChange:c,caller:hu});return g.jsx(aL,{scope:e,triggerId:ns(),triggerRef:h,contentId:ns(),open:p,onOpenChange:m,onOpenToggle:w.useCallback(()=>m(y=>!y),[m]),modal:l,children:g.jsx($j,{...d,open:p,onOpenChange:m,dir:n,modal:l,children:t})})};Hw.displayName=hu;var Bw="DropdownMenuTrigger",$w=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,disabled:n=!1,...a}=o,r=qw(Bw,t),c=dn(t);return g.jsx(Uj,{asChild:!0,...c,children:g.jsx(ke.button,{type:"button",id:r.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":r.open?r.contentId:void 0,"data-state":r.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:Ss(e,r.triggerRef),onPointerDown:ge(o.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(r.onOpenToggle(),r.open||l.preventDefault())}),onKeyDown:ge(o.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&r.onOpenToggle(),l.key==="ArrowDown"&&r.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});$w.displayName=Bw;var iL="DropdownMenuPortal",Uw=o=>{const{__scopeDropdownMenu:e,...t}=o,n=dn(e);return g.jsx(Qj,{...n,...t})};Uw.displayName=iL;var Qw="DropdownMenuContent",Fw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=qw(Qw,t),r=dn(t),c=w.useRef(!1);return g.jsx(Fj,{id:a.contentId,"aria-labelledby":a.triggerId,...r,...n,ref:e,onCloseAutoFocus:ge(o.onCloseAutoFocus,l=>{c.current||a.triggerRef.current?.focus(),c.current=!1,l.preventDefault()}),onInteractOutside:ge(o.onInteractOutside,l=>{const d=l.detail.originalEvent,h=d.button===0&&d.ctrlKey===!0,p=d.button===2||h;(!a.modal||p)&&(c.current=!0)}),style:{...o.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Fw.displayName=Qw;var oL="DropdownMenuGroup",rL=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Gj,{...a,...n,ref:e})});rL.displayName=oL;var cL="DropdownMenuLabel",Gw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Vj,{...a,...n,ref:e})});Gw.displayName=cL;var lL="DropdownMenuItem",Vw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Kj,{...a,...n,ref:e})});Vw.displayName=lL;var uL="DropdownMenuCheckboxItem",Kw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Yj,{...a,...n,ref:e})});Kw.displayName=uL;var dL="DropdownMenuRadioGroup",fL=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Wj,{...a,...n,ref:e})});fL.displayName=dL;var hL="DropdownMenuRadioItem",Yw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Xj,{...a,...n,ref:e})});Yw.displayName=hL;var pL="DropdownMenuItemIndicator",Ww=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Zj,{...a,...n,ref:e})});Ww.displayName=pL;var gL="DropdownMenuSeparator",Xw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(Jj,{...a,...n,ref:e})});Xw.displayName=gL;var mL="DropdownMenuArrow",yL=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(eL,{...a,...n,ref:e})});yL.displayName=mL;var vL="DropdownMenuSubTrigger",Zw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(tL,{...a,...n,ref:e})});Zw.displayName=vL;var bL="DropdownMenuSubContent",Jw=w.forwardRef((o,e)=>{const{__scopeDropdownMenu:t,...n}=o,a=dn(t);return g.jsx(nL,{...a,...n,ref:e,style:{...o.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Jw.displayName=bL;var xL=Hw,wL=$w,SL=Uw,eS=Fw,tS=Gw,nS=Vw,sS=Kw,aS=Yw,iS=Ww,oS=Xw,rS=Zw,cS=Jw;const CL=xL,ML=wL,EL=w.forwardRef(({className:o,inset:e,children:t,...n},a)=>g.jsxs(rS,{ref:a,className:Ee("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",o),...n,children:[t,g.jsx(Ih,{className:"ml-auto"})]}));EL.displayName=rS.displayName;const RL=w.forwardRef(({className:o,...e},t)=>g.jsx(cS,{ref:t,className:Ee("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",o),...e}));RL.displayName=cS.displayName;const lS=w.forwardRef(({className:o,sideOffset:e=4,...t},n)=>g.jsx(SL,{children:g.jsx(eS,{ref:n,sideOffset:e,className:Ee("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",o),...t})}));lS.displayName=eS.displayName;const Cl=w.forwardRef(({className:o,inset:e,...t},n)=>g.jsx(nS,{ref:n,className:Ee("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",e&&"pl-8",o),...t}));Cl.displayName=nS.displayName;const TL=w.forwardRef(({className:o,children:e,checked:t,...n},a)=>g.jsxs(sS,{ref:a,className:Ee("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",o),checked:t,...n,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(iS,{children:g.jsx(Oh,{className:"h-4 w-4"})})}),e]}));TL.displayName=sS.displayName;const kL=w.forwardRef(({className:o,children:e,...t},n)=>g.jsxs(aS,{ref:n,className:Ee("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",o),...t,children:[g.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(iS,{children:g.jsx(Kk,{className:"h-2 w-2 fill-current"})})}),e]}));kL.displayName=aS.displayName;const yh=w.forwardRef(({className:o,inset:e,...t},n)=>g.jsx(tS,{ref:n,className:Ee("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",o),...t}));yh.displayName=tS.displayName;const uS=w.forwardRef(({className:o,...e},t)=>g.jsx(oS,{ref:t,className:Ee("-mx-1 my-1 h-px bg-muted",o),...e}));uS.displayName=oS.displayName;const dS="archiphoenix_component_library",wv=()=>{if(typeof window>"u")return{favorites:[],collections:[]};try{const o=window.localStorage.getItem(dS);if(!o)return{favorites:[],collections:[]};const e=JSON.parse(o);return{favorites:Array.isArray(e.favorites)?e.favorites:[],collections:Array.isArray(e.collections)?e.collections:[]}}catch(o){return sb("Failed to load component library state",o instanceof Error?o:new Error(String(o))),{favorites:[],collections:[]}}},lo=o=>{typeof window>"u"||window.localStorage.setItem(dS,JSON.stringify(o))},AL=Cs((o,e)=>({favorites:wv().favorites,collections:wv().collections,toggleFavorite:t=>{o(n=>{const r=n.favorites.includes(t)?n.favorites.filter(c=>c!==t):[...n.favorites,t];return lo({favorites:r,collections:n.collections}),{favorites:r}})},createCollection:t=>{const n=t.trim();if(!n)return null;const a={id:`collection-${Date.now()}`,name:n,componentIds:[]};return o(r=>{const c=[...r.collections,a];return lo({favorites:r.favorites,collections:c}),{collections:c}}),a.id},renameCollection:(t,n)=>{o(a=>{const r=a.collections.map(c=>c.id===t?{...c,name:n}:c);return lo({favorites:a.favorites,collections:r}),{collections:r}})},deleteCollection:t=>{o(n=>{const a=n.collections.filter(r=>r.id!==t);return lo({favorites:n.favorites,collections:a}),{collections:a}})},addComponentToCollection:(t,n)=>{o(a=>{const r=a.collections.map(c=>c.id!==t||c.componentIds.includes(n)?c:{...c,componentIds:[...c.componentIds,n]});return lo({favorites:a.favorites,collections:r}),{collections:r}})},removeComponentFromCollection:(t,n)=>{o(a=>{const r=a.collections.map(c=>c.id!==t?c:{...c,componentIds:c.componentIds.filter(l=>l!==n)});return lo({favorites:a.favorites,collections:r}),{collections:r}})}}));function Sv({open:o,initialName:e="",onConfirm:t,onCancel:n}){const[a,r]=w.useState(e);w.useEffect(()=>{o&&r(e)},[o,e]);const c=()=>{a.trim()&&t(a.trim())};return g.jsx(ap,{open:o,onOpenChange:l=>!l&&n(),children:g.jsxs(Wl,{children:[g.jsxs(Xl,{children:[g.jsx(Jl,{children:e?"Rename Collection":"Create Collection"}),g.jsx(eu,{children:e?"Enter a new name for the collection":"Enter a name for the new collection"})]}),g.jsxs("div",{className:"py-4",children:[g.jsx(st,{htmlFor:"collection-name",children:"Collection Name"}),g.jsx(At,{id:"collection-name",value:a,onChange:l=>r(l.target.value),onKeyDown:l=>{l.key==="Enter"&&c()},className:"mt-2",autoFocus:!0})]}),g.jsxs(Zl,{children:[g.jsx(Ae,{variant:"outline",onClick:n,children:"Cancel"}),g.jsx(Ae,{onClick:c,disabled:!a.trim(),children:e?"Save":"Create"})]})]})})}function DL(){const[o,e]=w.useState(""),[t,n]=w.useState("all"),[a,r]=w.useState(!1),[c,l]=w.useState(!1),[d,h]=w.useState(null),[p,m]=w.useState(null),[y,b]=w.useState(180),[S,C]=w.useState(!1),E=w.useRef(null),[M,k]=w.useState(()=>{const U=localStorage.getItem("sidebar-expanded-categories");if(U)try{const ie=JSON.parse(U);return xr.reduce(($,V)=>($[V.id]=ie[V.id]!==void 0?ie[V.id]:!0,$),{})}catch{}return xr.reduce((ie,$)=>(ie[$.id]=!0,ie),{})}),{favorites:T,collections:A,toggleFavorite:N,createCollection:q,renameCollection:O,deleteCollection:H,addComponentToCollection:J,removeComponentFromCollection:se}=AL(),ce=U=>{k(ie=>({...ie,[U]:!ie[U]}))},Z=o.toLowerCase(),te=w.useMemo(()=>kr.filter(U=>U.label.toLowerCase().includes(Z)),[Z]),le=w.useMemo(()=>te.filter(U=>T.includes(U.id)),[T,te]),ue=(U,ie)=>{U.dataTransfer.setData("application/json",JSON.stringify(ie)),U.dataTransfer.effectAllowed="copy"},L=()=>{h(null),r(!0)},_=U=>{if(d)O(d.id,U),h(null);else{if(A.some(V=>V.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}q(U)||alert("Failed to create collection")}r(!1)},P=()=>{r(!1),h(null)},W=U=>{m(U),h(null),l(!0)},he=U=>{if(!p)return;if(A.some(V=>V.name.toLowerCase()===U.toLowerCase())){alert("A collection with this name already exists");return}const $=q(U);$?J($,p):alert("Failed to create collection"),l(!1),m(null)},j=()=>{l(!1),m(null)},Q=U=>{h(U),r(!0)};w.useEffect(()=>{localStorage.setItem("sidebar-expanded-categories",JSON.stringify(M))},[M]),w.useEffect(()=>{if(!S)return;const U=$=>{if(!E.current)return;const V=E.current.closest(".h-full");if(!V)return;const pe=V.getBoundingClientRect();E.current.getBoundingClientRect();const me=pe.bottom-$.clientY,ye=70,ve=pe.height*.8;b(Math.max(ye,Math.min(ve,me)))},ie=()=>{C(!1)};return document.addEventListener("mousemove",U),document.addEventListener("mouseup",ie),()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",ie)}},[S]);const Y=(U,ie)=>{const $=T.includes(U.id);return g.jsxs("div",{draggable:!0,onDragStart:V=>ue(V,U),className:`flex items-center gap-1 px-1 ${ie?.compact?"py-0.5 text-[10px]":"py-1 text-xs"} rounded-md bg-secondary/50 hover:bg-secondary cursor-move transition-colors border border-border/50`,children:[g.jsxs("div",{className:"flex items-center gap-0.5 flex-1 min-w-0",children:[g.jsx("span",{className:"text-sm flex-shrink-0",children:U.icon}),g.jsx("span",{className:"text-foreground truncate min-w-0",children:U.label})]}),g.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[g.jsx("button",{type:"button",onClick:V=>{V.preventDefault(),V.stopPropagation(),N(U.id)},onMouseDown:V=>V.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:$?"Remove from favorites":"Add to favorites",children:g.jsx($A,{className:`h-4 w-4 ${$?"text-yellow-400":"text-muted-foreground"}`,fill:$?"currentColor":"none"})}),g.jsxs(CL,{children:[g.jsx(ML,{asChild:!0,children:g.jsx("button",{type:"button",onMouseDown:V=>V.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Add to collection",children:g.jsx(kl,{className:"h-4 w-4 text-muted-foreground"})})}),g.jsxs(lS,{align:"end",className:"w-48",children:[A.length===0&&g.jsxs(g.Fragment,{children:[g.jsx(yh,{children:"No collections"}),g.jsxs(Cl,{onSelect:V=>{V.preventDefault(),W(U.id)},children:[g.jsx(ch,{className:"h-4 w-4 mr-2"}),"Create and add"]})]}),A.length>0&&g.jsxs(g.Fragment,{children:[g.jsx(yh,{children:"Add to collection"}),A.map(V=>g.jsx(Cl,{onSelect:pe=>{pe.preventDefault(),J(V.id,U.id)},children:V.name},V.id)),g.jsx(uS,{}),g.jsxs(Cl,{onSelect:V=>{V.preventDefault(),W(U.id)},children:[g.jsx(ch,{className:"h-4 w-4 mr-2"}),"New collection"]})]})]})]}),ie?.onRemove&&g.jsx("button",{type:"button",onClick:V=>{V.preventDefault(),V.stopPropagation(),ie.onRemove?.()},onMouseDown:V=>V.stopPropagation(),className:"p-1 rounded-md hover:bg-muted transition-colors",title:"Remove from collection",children:g.jsx(vs,{className:"h-4 w-4 text-muted-foreground"})})]})]},`${U.id}-${ie?.compact?"compact":"default"}`)},ae=t==="all"?xr:xr.filter(U=>U.id===t);return g.jsxs("div",{className:"w-60 h-full bg-sidebar-bg border-r border-border flex flex-col",children:[g.jsxs("div",{className:"p-3 border-b border-border",children:[g.jsx("h2",{className:"text-xs font-semibold text-foreground mb-2",children:"Components"}),g.jsxs("div",{className:"relative",children:[g.jsx($l,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),g.jsx(At,{type:"text",placeholder:"Search...",value:o,onChange:U=>e(U.target.value),className:"pl-7 h-8 text-xs"})]})]}),g.jsx("div",{className:"px-3 py-1.5 border-b border-border pb-2",children:g.jsx(rp,{value:t,onValueChange:n,children:g.jsxs(on,{orientation:"horizontal",className:"w-full",children:[g.jsxs(au,{className:"flex w-max gap-0.5",children:[g.jsx(hs,{value:"all",className:"text-xs px-2 py-1",children:"All"}),xr.map(U=>g.jsx(hs,{value:U.id,className:"text-xs px-2 py-1",children:U.icon},U.id))]}),g.jsx(Fl,{orientation:"horizontal",className:"data-[state=visible]:bg-accent/20 data-[state=visible]:hover:bg-accent/30 [&>[data-radix-scroll-area-thumb]]:bg-accent/80 hover:[&>[data-radix-scroll-area-thumb]]:bg-accent rounded-full",style:{transition:"none"}})]})})}),le.length>0&&g.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsx("span",{className:"text-[10px] font-semibold uppercase text-muted-foreground",children:"Favorites"}),g.jsx("span",{className:"text-[10px] text-muted-foreground",children:le.length})]}),g.jsx("div",{className:"space-y-1",children:le.map(U=>Y(U,{compact:!0}))})]}),g.jsx(on,{className:"flex-1",children:g.jsx("div",{className:"pl-3 pr-6 py-2",children:ae.map(U=>{const ie=te.filter($=>$.category===U.id);return ie.length===0&&o?null:g.jsxs("div",{className:"mb-1.5",children:[g.jsxs(Ae,{variant:"ghost",className:"w-full justify-start px-1 h-7 text-xs",onClick:()=>ce(U.id),children:[M[U.id]?g.jsx(Bl,{className:"h-3.5 w-3.5 mr-0.5"}):g.jsx(Ih,{className:"h-3.5 w-3.5 mr-0.5"}),g.jsx("span",{className:"mr-1",children:U.icon}),g.jsx("span",{className:"flex-1 text-left truncate min-w-0 mr-1",children:U.label}),g.jsx("span",{className:"text-[10px] text-muted-foreground flex-shrink-0",children:ie.length})]}),M[U.id]&&g.jsx("div",{className:"ml-1.5 mt-1 space-y-1",children:ie.map($=>Y($,{compact:!0}))})]},U.id)})})}),g.jsx("div",{ref:E,className:"h-2 border-t border-border cursor-row-resize hover:bg-accent/50 transition-colors relative group flex items-center justify-center",onMouseDown:U=>{U.preventDefault(),C(!0)},style:{userSelect:"none"},children:g.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:g.jsx(rA,{className:"h-3 w-3 text-muted-foreground"})})}),g.jsxs("div",{className:"border-t border-border overflow-hidden flex flex-col",style:{height:`${y}px`},children:[g.jsx("div",{className:"p-2 pb-1.5 flex-shrink-0",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-[10px] uppercase font-semibold text-muted-foreground",children:"Collections"}),g.jsxs(Ae,{size:"xs",variant:"outline",className:"h-6 text-[10px] px-2",onClick:U=>{U.preventDefault(),U.stopPropagation(),L()},type:"button",children:[g.jsx(kl,{className:"h-3 w-3 mr-0.5"}),"New"]})]})}),g.jsx(on,{className:"flex-1",children:g.jsx("div",{className:"pl-1.5 pr-4 pb-2 space-y-1.5",children:A.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground px-0.5",children:"Create collections to quickly build typical architectures."}):A.map(U=>{const ie=U.componentIds.map($=>kr.find(V=>V.id===$)).filter($=>!!$).filter($=>$.label.toLowerCase().includes(Z));return g.jsxs("div",{className:"rounded-md border border-border/60 p-1.5",children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:U.name}),g.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[ie.length," items"]})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Ae,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Rename",onClick:()=>Q(U),children:""}),g.jsx(Ae,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Delete collection",onClick:()=>H(U.id),children:g.jsx(vs,{className:"h-4 w-4"})})]})]}),ie.length===0?g.jsx("p",{className:"text-[10px] text-muted-foreground",children:'Add components via "+" menu.'}):g.jsx("div",{className:"space-y-1",children:ie.map($=>Y($,{compact:!0,onRemove:()=>se(U.id,$.id)}))})]},U.id)})})})]}),g.jsx(Sv,{open:a,initialName:d?.name||"",onConfirm:_,onCancel:P}),g.jsx(Sv,{open:c,initialName:"",onConfirm:he,onCancel:j})]})}const pu=Cs(o=>({tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}],addTab:e=>o(t=>{if(e.componentId){const a=t.tabs.find(r=>r.componentId===e.componentId);if(a)return{tabs:t.tabs.map(r=>({...r,active:r.id===a.id}))}}const n={...e,id:`${e.type}-${Date.now()}`,active:!0};return{tabs:[...t.tabs.map(a=>({...a,active:!1})),n]}}),closeTab:e=>o(t=>{const n=t.tabs.filter(c=>c.id!==e);if(n.length===0)return{tabs:[{id:"diagram-1",title:"Untitled Diagram",type:"diagram",active:!0}]};const a=t.tabs.findIndex(c=>c.id===e);if(t.tabs[a]?.active&&n.length>0){const c=Math.min(a,n.length-1);n[c].active=!0}return{tabs:n}}),setActiveTab:e=>o(t=>({tabs:t.tabs.map(n=>({...n,active:n.id===e}))})),updateTab:(e,t)=>o(n=>({tabs:n.tabs.map(a=>a.id===e?{...a,...t}:a)}))}));function NL(o){const e=_L(o),t=w.forwardRef((n,a)=>{const{children:r,...c}=n,l=w.Children.toArray(r),d=l.find(LL);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}function _L(o){const e=w.forwardRef((t,n)=>{const{children:a,...r}=t;if(w.isValidElement(a)){const c=PL(a),l=zL(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var jL=Symbol("radix.slottable");function LL(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===jL}function zL(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function PL(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function gu(o){const e=w.useRef({value:o,previous:o});return w.useMemo(()=>(e.current.value!==o&&(e.current.previous=e.current.value,e.current.value=o),e.current.previous),[o])}var fS=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),OL="VisuallyHidden",IL=w.forwardRef((o,e)=>g.jsx(ke.span,{...o,ref:e,style:{...fS,...o.style}}));IL.displayName=OL;var qL=[" ","Enter","ArrowUp","ArrowDown"],HL=[" ","Enter"],mi="Select",[mu,yu,BL]=tu(mi),[Ro]=bn(mi,[BL,Eo]),vu=Eo(),[$L,qa]=Ro(mi),[UL,QL]=Ro(mi),hS=o=>{const{__scopeSelect:e,children:t,open:n,defaultOpen:a,onOpenChange:r,value:c,defaultValue:l,onValueChange:d,dir:h,name:p,autoComplete:m,disabled:y,required:b,form:S}=o,C=vu(e),[E,M]=w.useState(null),[k,T]=w.useState(null),[A,N]=w.useState(!1),q=So(h),[O,H]=xs({prop:n,defaultProp:a??!1,onChange:r,caller:mi}),[J,se]=xs({prop:c,defaultProp:l,onChange:d,caller:mi}),ce=w.useRef(null),Z=E?S||!!E.closest("form"):!0,[te,le]=w.useState(new Set),ue=Array.from(te).map(L=>L.props.value).join(";");return g.jsx(mp,{...C,children:g.jsxs($L,{required:b,scope:e,trigger:E,onTriggerChange:M,valueNode:k,onValueNodeChange:T,valueNodeHasChildren:A,onValueNodeHasChildrenChange:N,contentId:ns(),value:J,onValueChange:se,open:O,onOpenChange:H,dir:q,triggerPointerDownPosRef:ce,disabled:y,children:[g.jsx(mu.Provider,{scope:e,children:g.jsx(UL,{scope:o.__scopeSelect,onNativeOptionAdd:w.useCallback(L=>{le(_=>new Set(_).add(L))},[]),onNativeOptionRemove:w.useCallback(L=>{le(_=>{const P=new Set(_);return P.delete(L),P})},[]),children:t})}),Z?g.jsxs(OS,{"aria-hidden":!0,required:b,tabIndex:-1,name:p,autoComplete:m,value:J,onChange:L=>se(L.target.value),disabled:y,form:S,children:[J===void 0?g.jsx("option",{value:""}):null,Array.from(te)]},ue):null]})})};hS.displayName=mi;var pS="SelectTrigger",gS=w.forwardRef((o,e)=>{const{__scopeSelect:t,disabled:n=!1,...a}=o,r=vu(t),c=qa(pS,t),l=c.disabled||n,d=_e(e,c.onTriggerChange),h=yu(t),p=w.useRef("touch"),[m,y,b]=qS(C=>{const E=h().filter(T=>!T.disabled),M=E.find(T=>T.value===c.value),k=HS(E,C,M);k!==void 0&&c.onValueChange(k.value)}),S=C=>{l||(c.onOpenChange(!0),b()),C&&(c.triggerPointerDownPosRef.current={x:Math.round(C.pageX),y:Math.round(C.pageY)})};return g.jsx(uu,{asChild:!0,...r,children:g.jsx(ke.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":IS(c.value)?"":void 0,...a,ref:d,onClick:ge(a.onClick,C=>{C.currentTarget.focus(),p.current!=="mouse"&&S(C)}),onPointerDown:ge(a.onPointerDown,C=>{p.current=C.pointerType;const E=C.target;E.hasPointerCapture(C.pointerId)&&E.releasePointerCapture(C.pointerId),C.button===0&&C.ctrlKey===!1&&C.pointerType==="mouse"&&(S(C),C.preventDefault())}),onKeyDown:ge(a.onKeyDown,C=>{const E=m.current!=="";!(C.ctrlKey||C.altKey||C.metaKey)&&C.key.length===1&&y(C.key),!(E&&C.key===" ")&&qL.includes(C.key)&&(S(),C.preventDefault())})})})});gS.displayName=pS;var mS="SelectValue",yS=w.forwardRef((o,e)=>{const{__scopeSelect:t,className:n,style:a,children:r,placeholder:c="",...l}=o,d=qa(mS,t),{onValueNodeHasChildrenChange:h}=d,p=r!==void 0,m=_e(e,d.onValueNodeChange);return sn(()=>{h(p)},[h,p]),g.jsx(ke.span,{...l,ref:m,style:{pointerEvents:"none"},children:IS(d.value)?g.jsx(g.Fragment,{children:c}):r})});yS.displayName=mS;var FL="SelectIcon",vS=w.forwardRef((o,e)=>{const{__scopeSelect:t,children:n,...a}=o;return g.jsx(ke.span,{"aria-hidden":!0,...a,ref:e,children:n||""})});vS.displayName=FL;var GL="SelectPortal",bS=o=>g.jsx(Ir,{asChild:!0,...o});bS.displayName=GL;var yi="SelectContent",xS=w.forwardRef((o,e)=>{const t=qa(yi,o.__scopeSelect),[n,a]=w.useState();if(sn(()=>{a(new DocumentFragment)},[]),!t.open){const r=n;return r?Lr.createPortal(g.jsx(wS,{scope:o.__scopeSelect,children:g.jsx(mu.Slot,{scope:o.__scopeSelect,children:g.jsx("div",{children:o.children})})}),r):null}return g.jsx(SS,{...o,ref:e})});xS.displayName=yi;var es=10,[wS,Ha]=Ro(yi),VL="SelectContentImpl",KL=NL("SelectContent.RemoveScroll"),SS=w.forwardRef((o,e)=>{const{__scopeSelect:t,position:n="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:r,onPointerDownOutside:c,side:l,sideOffset:d,align:h,alignOffset:p,arrowPadding:m,collisionBoundary:y,collisionPadding:b,sticky:S,hideWhenDetached:C,avoidCollisions:E,...M}=o,k=qa(yi,t),[T,A]=w.useState(null),[N,q]=w.useState(null),O=_e(e,$=>A($)),[H,J]=w.useState(null),[se,ce]=w.useState(null),Z=yu(t),[te,le]=w.useState(!1),ue=w.useRef(!1);w.useEffect(()=>{if(T)return Kl(T)},[T]),Gl();const L=w.useCallback($=>{const[V,...pe]=Z().map(ve=>ve.ref.current),[me]=pe.slice(-1),ye=document.activeElement;for(const ve of $)if(ve===ye||(ve?.scrollIntoView({block:"nearest"}),ve===V&&N&&(N.scrollTop=0),ve===me&&N&&(N.scrollTop=N.scrollHeight),ve?.focus(),document.activeElement!==ye))return},[Z,N]),_=w.useCallback(()=>L([H,T]),[L,H,T]);w.useEffect(()=>{te&&_()},[te,_]);const{onOpenChange:P,triggerPointerDownPosRef:W}=k;w.useEffect(()=>{if(T){let $={x:0,y:0};const V=me=>{$={x:Math.abs(Math.round(me.pageX)-(W.current?.x??0)),y:Math.abs(Math.round(me.pageY)-(W.current?.y??0))}},pe=me=>{$.x<=10&&$.y<=10?me.preventDefault():T.contains(me.target)||P(!1),document.removeEventListener("pointermove",V),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",V),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",V),document.removeEventListener("pointerup",pe,{capture:!0})}}},[T,P,W]),w.useEffect(()=>{const $=()=>P(!1);return window.addEventListener("blur",$),window.addEventListener("resize",$),()=>{window.removeEventListener("blur",$),window.removeEventListener("resize",$)}},[P]);const[he,j]=qS($=>{const V=Z().filter(ye=>!ye.disabled),pe=V.find(ye=>ye.ref.current===document.activeElement),me=HS(V,$,pe);me&&setTimeout(()=>me.ref.current.focus())}),Q=w.useCallback(($,V,pe)=>{const me=!ue.current&&!pe;(k.value!==void 0&&k.value===V||me)&&(J($),me&&(ue.current=!0))},[k.value]),Y=w.useCallback(()=>T?.focus(),[T]),ae=w.useCallback(($,V,pe)=>{const me=!ue.current&&!pe;(k.value!==void 0&&k.value===V||me)&&ce($)},[k.value]),U=n==="popper"?vh:CS,ie=U===vh?{side:l,sideOffset:d,align:h,alignOffset:p,arrowPadding:m,collisionBoundary:y,collisionPadding:b,sticky:S,hideWhenDetached:C,avoidCollisions:E}:{};return g.jsx(wS,{scope:t,content:T,viewport:N,onViewportChange:q,itemRefCallback:Q,selectedItem:H,onItemLeave:Y,itemTextRefCallback:ae,focusSelectedItem:_,selectedItemText:se,position:n,isPositioned:te,searchRef:he,children:g.jsx(qr,{as:KL,allowPinchZoom:!0,children:g.jsx(Or,{asChild:!0,trapped:k.open,onMountAutoFocus:$=>{$.preventDefault()},onUnmountAutoFocus:ge(a,$=>{k.trigger?.focus({preventScroll:!0}),$.preventDefault()}),children:g.jsx(Pr,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:r,onPointerDownOutside:c,onFocusOutside:$=>$.preventDefault(),onDismiss:()=>k.onOpenChange(!1),children:g.jsx(U,{role:"listbox",id:k.contentId,"data-state":k.open?"open":"closed",dir:k.dir,onContextMenu:$=>$.preventDefault(),...M,...ie,onPlaced:()=>le(!0),ref:O,style:{display:"flex",flexDirection:"column",outline:"none",...M.style},onKeyDown:ge(M.onKeyDown,$=>{const V=$.ctrlKey||$.altKey||$.metaKey;if($.key==="Tab"&&$.preventDefault(),!V&&$.key.length===1&&j($.key),["ArrowUp","ArrowDown","Home","End"].includes($.key)){let me=Z().filter(ye=>!ye.disabled).map(ye=>ye.ref.current);if(["ArrowUp","End"].includes($.key)&&(me=me.slice().reverse()),["ArrowUp","ArrowDown"].includes($.key)){const ye=$.target,ve=me.indexOf(ye);me=me.slice(ve+1)}setTimeout(()=>L(me)),$.preventDefault()}})})})})})})});SS.displayName=VL;var YL="SelectItemAlignedPosition",CS=w.forwardRef((o,e)=>{const{__scopeSelect:t,onPlaced:n,...a}=o,r=qa(yi,t),c=Ha(yi,t),[l,d]=w.useState(null),[h,p]=w.useState(null),m=_e(e,O=>p(O)),y=yu(t),b=w.useRef(!1),S=w.useRef(!0),{viewport:C,selectedItem:E,selectedItemText:M,focusSelectedItem:k}=c,T=w.useCallback(()=>{if(r.trigger&&r.valueNode&&l&&h&&C&&E&&M){const O=r.trigger.getBoundingClientRect(),H=h.getBoundingClientRect(),J=r.valueNode.getBoundingClientRect(),se=M.getBoundingClientRect();if(r.dir!=="rtl"){const ye=se.left-H.left,ve=J.left-ye,Le=O.left-ve,$e=O.width+Le,at=Math.max($e,H.width),Ze=window.innerWidth-es,Nt=Tr(ve,[es,Math.max(es,Ze-at)]);l.style.minWidth=$e+"px",l.style.left=Nt+"px"}else{const ye=H.right-se.right,ve=window.innerWidth-J.right-ye,Le=window.innerWidth-O.right-ve,$e=O.width+Le,at=Math.max($e,H.width),Ze=window.innerWidth-es,Nt=Tr(ve,[es,Math.max(es,Ze-at)]);l.style.minWidth=$e+"px",l.style.right=Nt+"px"}const ce=y(),Z=window.innerHeight-es*2,te=C.scrollHeight,le=window.getComputedStyle(h),ue=parseInt(le.borderTopWidth,10),L=parseInt(le.paddingTop,10),_=parseInt(le.borderBottomWidth,10),P=parseInt(le.paddingBottom,10),W=ue+L+te+P+_,he=Math.min(E.offsetHeight*5,W),j=window.getComputedStyle(C),Q=parseInt(j.paddingTop,10),Y=parseInt(j.paddingBottom,10),ae=O.top+O.height/2-es,U=Z-ae,ie=E.offsetHeight/2,$=E.offsetTop+ie,V=ue+L+$,pe=W-V;if(V<=ae){const ye=ce.length>0&&E===ce[ce.length-1].ref.current;l.style.bottom="0px";const ve=h.clientHeight-C.offsetTop-C.offsetHeight,Le=Math.max(U,ie+(ye?Y:0)+ve+_),$e=V+Le;l.style.height=$e+"px"}else{const ye=ce.length>0&&E===ce[0].ref.current;l.style.top="0px";const Le=Math.max(ae,ue+C.offsetTop+(ye?Q:0)+ie)+pe;l.style.height=Le+"px",C.scrollTop=V-ae+C.offsetTop}l.style.margin=`${es}px 0`,l.style.minHeight=he+"px",l.style.maxHeight=Z+"px",n?.(),requestAnimationFrame(()=>b.current=!0)}},[y,r.trigger,r.valueNode,l,h,C,E,M,r.dir,n]);sn(()=>T(),[T]);const[A,N]=w.useState();sn(()=>{h&&N(window.getComputedStyle(h).zIndex)},[h]);const q=w.useCallback(O=>{O&&S.current===!0&&(T(),k?.(),S.current=!1)},[T,k]);return g.jsx(XL,{scope:t,contentWrapper:l,shouldExpandOnScrollRef:b,onScrollButtonChange:q,children:g.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:g.jsx(ke.div,{...a,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});CS.displayName=YL;var WL="SelectPopperPosition",vh=w.forwardRef((o,e)=>{const{__scopeSelect:t,align:n="start",collisionPadding:a=es,...r}=o,c=vu(t);return g.jsx(yp,{...c,...r,ref:e,align:n,collisionPadding:a,style:{boxSizing:"border-box",...r.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});vh.displayName=WL;var[XL,Rp]=Ro(yi,{}),bh="SelectViewport",MS=w.forwardRef((o,e)=>{const{__scopeSelect:t,nonce:n,...a}=o,r=Ha(bh,t),c=Rp(bh,t),l=_e(e,r.onViewportChange),d=w.useRef(0);return g.jsxs(g.Fragment,{children:[g.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),g.jsx(mu.Slot,{scope:t,children:g.jsx(ke.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:ge(a.onScroll,h=>{const p=h.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:y}=c;if(y?.current&&m){const b=Math.abs(d.current-p.scrollTop);if(b>0){const S=window.innerHeight-es*2,C=parseFloat(m.style.minHeight),E=parseFloat(m.style.height),M=Math.max(C,E);if(M<S){const k=M+b,T=Math.min(S,k),A=k-T;m.style.height=T+"px",m.style.bottom==="0px"&&(p.scrollTop=A>0?A:0,m.style.justifyContent="flex-end")}}}d.current=p.scrollTop})})})]})});MS.displayName=bh;var ES="SelectGroup",[ZL,JL]=Ro(ES),ez=w.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o,a=ns();return g.jsx(ZL,{scope:t,id:a,children:g.jsx(ke.div,{role:"group","aria-labelledby":a,...n,ref:e})})});ez.displayName=ES;var RS="SelectLabel",TS=w.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o,a=JL(RS,t);return g.jsx(ke.div,{id:a.id,...n,ref:e})});TS.displayName=RS;var Il="SelectItem",[tz,kS]=Ro(Il),AS=w.forwardRef((o,e)=>{const{__scopeSelect:t,value:n,disabled:a=!1,textValue:r,...c}=o,l=qa(Il,t),d=Ha(Il,t),h=l.value===n,[p,m]=w.useState(r??""),[y,b]=w.useState(!1),S=_e(e,k=>d.itemRefCallback?.(k,n,a)),C=ns(),E=w.useRef("touch"),M=()=>{a||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return g.jsx(tz,{scope:t,value:n,disabled:a,textId:C,isSelected:h,onItemTextChange:w.useCallback(k=>{m(T=>T||(k?.textContent??"").trim())},[]),children:g.jsx(mu.ItemSlot,{scope:t,value:n,disabled:a,textValue:p,children:g.jsx(ke.div,{role:"option","aria-labelledby":C,"data-highlighted":y?"":void 0,"aria-selected":h&&y,"data-state":h?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...c,ref:S,onFocus:ge(c.onFocus,()=>b(!0)),onBlur:ge(c.onBlur,()=>b(!1)),onClick:ge(c.onClick,()=>{E.current!=="mouse"&&M()}),onPointerUp:ge(c.onPointerUp,()=>{E.current==="mouse"&&M()}),onPointerDown:ge(c.onPointerDown,k=>{E.current=k.pointerType}),onPointerMove:ge(c.onPointerMove,k=>{E.current=k.pointerType,a?d.onItemLeave?.():E.current==="mouse"&&k.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ge(c.onPointerLeave,k=>{k.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:ge(c.onKeyDown,k=>{d.searchRef?.current!==""&&k.key===" "||(HL.includes(k.key)&&M(),k.key===" "&&k.preventDefault())})})})})});AS.displayName=Il;var Sr="SelectItemText",DS=w.forwardRef((o,e)=>{const{__scopeSelect:t,className:n,style:a,...r}=o,c=qa(Sr,t),l=Ha(Sr,t),d=kS(Sr,t),h=QL(Sr,t),[p,m]=w.useState(null),y=_e(e,M=>m(M),d.onItemTextChange,M=>l.itemTextRefCallback?.(M,d.value,d.disabled)),b=p?.textContent,S=w.useMemo(()=>g.jsx("option",{value:d.value,disabled:d.disabled,children:b},d.value),[d.disabled,d.value,b]),{onNativeOptionAdd:C,onNativeOptionRemove:E}=h;return sn(()=>(C(S),()=>E(S)),[C,E,S]),g.jsxs(g.Fragment,{children:[g.jsx(ke.span,{id:d.textId,...r,ref:y}),d.isSelected&&c.valueNode&&!c.valueNodeHasChildren?Lr.createPortal(r.children,c.valueNode):null]})});DS.displayName=Sr;var NS="SelectItemIndicator",_S=w.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o;return kS(NS,t).isSelected?g.jsx(ke.span,{"aria-hidden":!0,...n,ref:e}):null});_S.displayName=NS;var xh="SelectScrollUpButton",jS=w.forwardRef((o,e)=>{const t=Ha(xh,o.__scopeSelect),n=Rp(xh,o.__scopeSelect),[a,r]=w.useState(!1),c=_e(e,n.onScrollButtonChange);return sn(()=>{if(t.viewport&&t.isPositioned){let l=function(){const h=d.scrollTop>0;r(h)};const d=t.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[t.viewport,t.isPositioned]),a?g.jsx(zS,{...o,ref:c,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=t;l&&d&&(l.scrollTop=l.scrollTop-d.offsetHeight)}}):null});jS.displayName=xh;var wh="SelectScrollDownButton",LS=w.forwardRef((o,e)=>{const t=Ha(wh,o.__scopeSelect),n=Rp(wh,o.__scopeSelect),[a,r]=w.useState(!1),c=_e(e,n.onScrollButtonChange);return sn(()=>{if(t.viewport&&t.isPositioned){let l=function(){const h=d.scrollHeight-d.clientHeight,p=Math.ceil(d.scrollTop)<h;r(p)};const d=t.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[t.viewport,t.isPositioned]),a?g.jsx(zS,{...o,ref:c,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=t;l&&d&&(l.scrollTop=l.scrollTop+d.offsetHeight)}}):null});LS.displayName=wh;var zS=w.forwardRef((o,e)=>{const{__scopeSelect:t,onAutoScroll:n,...a}=o,r=Ha("SelectScrollButton",t),c=w.useRef(null),l=yu(t),d=w.useCallback(()=>{c.current!==null&&(window.clearInterval(c.current),c.current=null)},[]);return w.useEffect(()=>()=>d(),[d]),sn(()=>{l().find(p=>p.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),g.jsx(ke.div,{"aria-hidden":!0,...a,ref:e,style:{flexShrink:0,...a.style},onPointerDown:ge(a.onPointerDown,()=>{c.current===null&&(c.current=window.setInterval(n,50))}),onPointerMove:ge(a.onPointerMove,()=>{r.onItemLeave?.(),c.current===null&&(c.current=window.setInterval(n,50))}),onPointerLeave:ge(a.onPointerLeave,()=>{d()})})}),nz="SelectSeparator",PS=w.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o;return g.jsx(ke.div,{"aria-hidden":!0,...n,ref:e})});PS.displayName=nz;var Sh="SelectArrow",sz=w.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o,a=vu(t),r=qa(Sh,t),c=Ha(Sh,t);return r.open&&c.position==="popper"?g.jsx(vp,{...a,...n,ref:e}):null});sz.displayName=Sh;var az="SelectBubbleInput",OS=w.forwardRef(({__scopeSelect:o,value:e,...t},n)=>{const a=w.useRef(null),r=_e(n,a),c=gu(e);return w.useEffect(()=>{const l=a.current;if(!l)return;const d=window.HTMLSelectElement.prototype,p=Object.getOwnPropertyDescriptor(d,"value").set;if(c!==e&&p){const m=new Event("change",{bubbles:!0});p.call(l,e),l.dispatchEvent(m)}},[c,e]),g.jsx(ke.select,{...t,style:{...fS,...t.style},ref:r,defaultValue:e})});OS.displayName=az;function IS(o){return o===""||o===void 0}function qS(o){const e=nn(o),t=w.useRef(""),n=w.useRef(0),a=w.useCallback(c=>{const l=t.current+c;e(l),(function d(h){t.current=h,window.clearTimeout(n.current),h!==""&&(n.current=window.setTimeout(()=>d(""),1e3))})(l)},[e]),r=w.useCallback(()=>{t.current="",window.clearTimeout(n.current)},[]);return w.useEffect(()=>()=>window.clearTimeout(n.current),[]),[t,a,r]}function HS(o,e,t){const a=e.length>1&&Array.from(e).every(h=>h===e[0])?e[0]:e,r=t?o.indexOf(t):-1;let c=iz(o,Math.max(r,0));a.length===1&&(c=c.filter(h=>h!==t));const d=c.find(h=>h.textValue.toLowerCase().startsWith(a.toLowerCase()));return d!==t?d:void 0}function iz(o,e){return o.map((t,n)=>o[(e+n)%o.length])}var oz=hS,BS=gS,rz=yS,cz=vS,lz=bS,$S=xS,uz=MS,US=TS,QS=AS,dz=DS,fz=_S,FS=jS,GS=LS,VS=PS;const hz=oz,pz=rz,KS=w.forwardRef(({className:o,children:e,...t},n)=>g.jsxs(BS,{ref:n,className:Ee("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",o),...t,children:[e,g.jsx(cz,{asChild:!0,children:g.jsx(Bl,{className:"h-4 w-4 opacity-50"})})]}));KS.displayName=BS.displayName;const YS=w.forwardRef(({className:o,...e},t)=>g.jsx(FS,{ref:t,className:Ee("flex cursor-default items-center justify-center py-1",o),...e,children:g.jsx(rb,{className:"h-4 w-4"})}));YS.displayName=FS.displayName;const WS=w.forwardRef(({className:o,...e},t)=>g.jsx(GS,{ref:t,className:Ee("flex cursor-default items-center justify-center py-1",o),...e,children:g.jsx(Bl,{className:"h-4 w-4"})}));WS.displayName=GS.displayName;const XS=w.forwardRef(({className:o,children:e,position:t="popper",...n},a)=>g.jsx(lz,{children:g.jsxs($S,{ref:a,className:Ee("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",o),position:t,...n,children:[g.jsx(YS,{}),g.jsx(uz,{className:Ee("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),g.jsx(WS,{})]})}));XS.displayName=$S.displayName;const gz=w.forwardRef(({className:o,...e},t)=>g.jsx(US,{ref:t,className:Ee("px-2 py-1.5 text-sm font-semibold",o),...e}));gz.displayName=US.displayName;const Cr=w.forwardRef(({className:o,children:e,...t},n)=>g.jsxs(QS,{ref:n,className:Ee("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",o),...t,children:[g.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:g.jsx(fz,{children:g.jsx(Oh,{className:"h-4 w-4"})})}),g.jsx(dz,{children:e})]}));Cr.displayName=QS.displayName;const mz=w.forwardRef(({className:o,...e},t)=>g.jsx(VS,{ref:t,className:Ee("-mx-1 my-1 h-px bg-muted",o),...e}));mz.displayName=VS.displayName;var ZS=["PageUp","PageDown"],JS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],e1={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},To="Slider",[Ch,yz,vz]=tu(To),[t1]=bn(To,[vz]),[bz,bu]=t1(To),n1=w.forwardRef((o,e)=>{const{name:t,min:n=0,max:a=100,step:r=1,orientation:c="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:h=[n],value:p,onValueChange:m=()=>{},onValueCommit:y=()=>{},inverted:b=!1,form:S,...C}=o,E=w.useRef(new Set),M=w.useRef(0),T=c==="horizontal"?xz:wz,[A=[],N]=xs({prop:p,defaultProp:h,onChange:ce=>{[...E.current][M.current]?.focus(),m(ce)}}),q=w.useRef(A);function O(ce){const Z=Rz(A,ce);se(ce,Z)}function H(ce){se(ce,M.current)}function J(){const ce=q.current[M.current];A[M.current]!==ce&&y(A)}function se(ce,Z,{commit:te}={commit:!1}){const le=Dz(r),ue=Nz(Math.round((ce-n)/r)*r+n,le),L=Tr(ue,[n,a]);N((_=[])=>{const P=Mz(_,L,Z);if(Az(P,d*r)){M.current=P.indexOf(L);const W=String(P)!==String(_);return W&&te&&y(P),W?P:_}else return _})}return g.jsx(bz,{scope:o.__scopeSlider,name:t,disabled:l,min:n,max:a,valueIndexToChangeRef:M,thumbs:E.current,values:A,orientation:c,form:S,children:g.jsx(Ch.Provider,{scope:o.__scopeSlider,children:g.jsx(Ch.Slot,{scope:o.__scopeSlider,children:g.jsx(T,{"aria-disabled":l,"data-disabled":l?"":void 0,...C,ref:e,onPointerDown:ge(C.onPointerDown,()=>{l||(q.current=A)}),min:n,max:a,inverted:b,onSlideStart:l?void 0:O,onSlideMove:l?void 0:H,onSlideEnd:l?void 0:J,onHomeKeyDown:()=>!l&&se(n,0,{commit:!0}),onEndKeyDown:()=>!l&&se(a,A.length-1,{commit:!0}),onStepKeyDown:({event:ce,direction:Z})=>{if(!l){const ue=ZS.includes(ce.key)||ce.shiftKey&&JS.includes(ce.key)?10:1,L=M.current,_=A[L],P=r*ue*Z;se(_+P,L,{commit:!0})}}})})})})});n1.displayName=To;var[s1,a1]=t1(To,{startEdge:"left",endEdge:"right",size:"width",direction:1}),xz=w.forwardRef((o,e)=>{const{min:t,max:n,dir:a,inverted:r,onSlideStart:c,onSlideMove:l,onSlideEnd:d,onStepKeyDown:h,...p}=o,[m,y]=w.useState(null),b=_e(e,T=>y(T)),S=w.useRef(void 0),C=So(a),E=C==="ltr",M=E&&!r||!E&&r;function k(T){const A=S.current||m.getBoundingClientRect(),N=[0,A.width],O=Tp(N,M?[t,n]:[n,t]);return S.current=A,O(T-A.left)}return g.jsx(s1,{scope:o.__scopeSlider,startEdge:M?"left":"right",endEdge:M?"right":"left",direction:M?1:-1,size:"width",children:g.jsx(i1,{dir:C,"data-orientation":"horizontal",...p,ref:b,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:T=>{const A=k(T.clientX);c?.(A)},onSlideMove:T=>{const A=k(T.clientX);l?.(A)},onSlideEnd:()=>{S.current=void 0,d?.()},onStepKeyDown:T=>{const N=e1[M?"from-left":"from-right"].includes(T.key);h?.({event:T,direction:N?-1:1})}})})}),wz=w.forwardRef((o,e)=>{const{min:t,max:n,inverted:a,onSlideStart:r,onSlideMove:c,onSlideEnd:l,onStepKeyDown:d,...h}=o,p=w.useRef(null),m=_e(e,p),y=w.useRef(void 0),b=!a;function S(C){const E=y.current||p.current.getBoundingClientRect(),M=[0,E.height],T=Tp(M,b?[n,t]:[t,n]);return y.current=E,T(C-E.top)}return g.jsx(s1,{scope:o.__scopeSlider,startEdge:b?"bottom":"top",endEdge:b?"top":"bottom",size:"height",direction:b?1:-1,children:g.jsx(i1,{"data-orientation":"vertical",...h,ref:m,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:C=>{const E=S(C.clientY);r?.(E)},onSlideMove:C=>{const E=S(C.clientY);c?.(E)},onSlideEnd:()=>{y.current=void 0,l?.()},onStepKeyDown:C=>{const M=e1[b?"from-bottom":"from-top"].includes(C.key);d?.({event:C,direction:M?-1:1})}})})}),i1=w.forwardRef((o,e)=>{const{__scopeSlider:t,onSlideStart:n,onSlideMove:a,onSlideEnd:r,onHomeKeyDown:c,onEndKeyDown:l,onStepKeyDown:d,...h}=o,p=bu(To,t);return g.jsx(ke.span,{...h,ref:e,onKeyDown:ge(o.onKeyDown,m=>{m.key==="Home"?(c(m),m.preventDefault()):m.key==="End"?(l(m),m.preventDefault()):ZS.concat(JS).includes(m.key)&&(d(m),m.preventDefault())}),onPointerDown:ge(o.onPointerDown,m=>{const y=m.target;y.setPointerCapture(m.pointerId),m.preventDefault(),p.thumbs.has(y)?y.focus():n(m)}),onPointerMove:ge(o.onPointerMove,m=>{m.target.hasPointerCapture(m.pointerId)&&a(m)}),onPointerUp:ge(o.onPointerUp,m=>{const y=m.target;y.hasPointerCapture(m.pointerId)&&(y.releasePointerCapture(m.pointerId),r(m))})})}),o1="SliderTrack",r1=w.forwardRef((o,e)=>{const{__scopeSlider:t,...n}=o,a=bu(o1,t);return g.jsx(ke.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...n,ref:e})});r1.displayName=o1;var Mh="SliderRange",c1=w.forwardRef((o,e)=>{const{__scopeSlider:t,...n}=o,a=bu(Mh,t),r=a1(Mh,t),c=w.useRef(null),l=_e(e,c),d=a.values.length,h=a.values.map(y=>d1(y,a.min,a.max)),p=d>1?Math.min(...h):0,m=100-Math.max(...h);return g.jsx(ke.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...n,ref:l,style:{...o.style,[r.startEdge]:p+"%",[r.endEdge]:m+"%"}})});c1.displayName=Mh;var Eh="SliderThumb",l1=w.forwardRef((o,e)=>{const t=yz(o.__scopeSlider),[n,a]=w.useState(null),r=_e(e,l=>a(l)),c=w.useMemo(()=>n?t().findIndex(l=>l.ref.current===n):-1,[t,n]);return g.jsx(Sz,{...o,ref:r,index:c})}),Sz=w.forwardRef((o,e)=>{const{__scopeSlider:t,index:n,name:a,...r}=o,c=bu(Eh,t),l=a1(Eh,t),[d,h]=w.useState(null),p=_e(e,k=>h(k)),m=d?c.form||!!d.closest("form"):!0,y=lu(d),b=c.values[n],S=b===void 0?0:d1(b,c.min,c.max),C=Ez(n,c.values.length),E=y?.[l.size],M=E?Tz(E,S,l.direction):0;return w.useEffect(()=>{if(d)return c.thumbs.add(d),()=>{c.thumbs.delete(d)}},[d,c.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${S}% + ${M}px)`},children:[g.jsx(Ch.ItemSlot,{scope:o.__scopeSlider,children:g.jsx(ke.span,{role:"slider","aria-label":o["aria-label"]||C,"aria-valuemin":c.min,"aria-valuenow":b,"aria-valuemax":c.max,"aria-orientation":c.orientation,"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,tabIndex:c.disabled?void 0:0,...r,ref:p,style:b===void 0?{display:"none"}:o.style,onFocus:ge(o.onFocus,()=>{c.valueIndexToChangeRef.current=n})})}),m&&g.jsx(u1,{name:a??(c.name?c.name+(c.values.length>1?"[]":""):void 0),form:c.form,value:b},n)]})});l1.displayName=Eh;var Cz="RadioBubbleInput",u1=w.forwardRef(({__scopeSlider:o,value:e,...t},n)=>{const a=w.useRef(null),r=_e(a,n),c=gu(e);return w.useEffect(()=>{const l=a.current;if(!l)return;const d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"value").set;if(c!==e&&p){const m=new Event("input",{bubbles:!0});p.call(l,e),l.dispatchEvent(m)}},[c,e]),g.jsx(ke.input,{style:{display:"none"},...t,ref:r,defaultValue:e})});u1.displayName=Cz;function Mz(o=[],e,t){const n=[...o];return n[t]=e,n.sort((a,r)=>a-r)}function d1(o,e,t){const r=100/(t-e)*(o-e);return Tr(r,[0,100])}function Ez(o,e){return e>2?`Value ${o+1} of ${e}`:e===2?["Minimum","Maximum"][o]:void 0}function Rz(o,e){if(o.length===1)return 0;const t=o.map(a=>Math.abs(a-e)),n=Math.min(...t);return t.indexOf(n)}function Tz(o,e,t){const n=o/2,r=Tp([0,50],[0,n]);return(n-r(e)*t)*t}function kz(o){return o.slice(0,-1).map((e,t)=>o[t+1]-e)}function Az(o,e){if(e>0){const t=kz(o);return Math.min(...t)>=e}return!0}function Tp(o,e){return t=>{if(o[0]===o[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(o[1]-o[0]);return e[0]+n*(t-o[0])}}function Dz(o){return(String(o).split(".")[1]||"").length}function Nz(o,e){const t=Math.pow(10,e);return Math.round(o*t)/t}var f1=n1,_z=r1,jz=c1,Lz=l1;const ts=w.forwardRef(({className:o,...e},t)=>g.jsxs(f1,{ref:t,className:Ee("relative flex w-full touch-none select-none items-center",o),...e,children:[g.jsx(_z,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:g.jsx(jz,{className:"absolute h-full bg-primary"})}),g.jsx(Lz,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));ts.displayName=f1.displayName;var xu="Switch",[zz]=bn(xu),[Pz,Oz]=zz(xu),h1=w.forwardRef((o,e)=>{const{__scopeSwitch:t,name:n,checked:a,defaultChecked:r,required:c,disabled:l,value:d="on",onCheckedChange:h,form:p,...m}=o,[y,b]=w.useState(null),S=_e(e,T=>b(T)),C=w.useRef(!1),E=y?p||!!y.closest("form"):!0,[M,k]=xs({prop:a,defaultProp:r??!1,onChange:h,caller:xu});return g.jsxs(Pz,{scope:t,checked:M,disabled:l,children:[g.jsx(ke.button,{type:"button",role:"switch","aria-checked":M,"aria-required":c,"data-state":y1(M),"data-disabled":l?"":void 0,disabled:l,value:d,...m,ref:S,onClick:ge(o.onClick,T=>{k(A=>!A),E&&(C.current=T.isPropagationStopped(),C.current||T.stopPropagation())})}),E&&g.jsx(m1,{control:y,bubbles:!C.current,name:n,value:d,checked:M,required:c,disabled:l,form:p,style:{transform:"translateX(-100%)"}})]})});h1.displayName=xu;var p1="SwitchThumb",g1=w.forwardRef((o,e)=>{const{__scopeSwitch:t,...n}=o,a=Oz(p1,t);return g.jsx(ke.span,{"data-state":y1(a.checked),"data-disabled":a.disabled?"":void 0,...n,ref:e})});g1.displayName=p1;var Iz="SwitchBubbleInput",m1=w.forwardRef(({__scopeSwitch:o,control:e,checked:t,bubbles:n=!0,...a},r)=>{const c=w.useRef(null),l=_e(c,r),d=gu(t),h=lu(e);return w.useEffect(()=>{const p=c.current;if(!p)return;const m=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(m,"checked").set;if(d!==t&&b){const S=new Event("click",{bubbles:n});b.call(p,t),p.dispatchEvent(S)}},[d,t,n]),g.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...a,tabIndex:-1,ref:l,style:{...a.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});m1.displayName=Iz;function y1(o){return o?"checked":"unchecked"}var v1=h1,qz=g1;const ui=w.forwardRef(({className:o,...e},t)=>g.jsx(v1,{className:Ee("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",o),...e,ref:t,children:g.jsx(qz,{className:Ee("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));ui.displayName=v1.displayName;const An=w.forwardRef(({className:o,...e},t)=>g.jsx("div",{ref:t,className:Ee("rounded-xl border bg-card text-card-foreground shadow",o),...e}));An.displayName="Card";const Xs=w.forwardRef(({className:o,...e},t)=>g.jsx("div",{ref:t,className:Ee("flex flex-col space-y-1.5 p-6",o),...e}));Xs.displayName="CardHeader";const Zs=w.forwardRef(({className:o,...e},t)=>g.jsx("div",{ref:t,className:Ee("font-semibold leading-none tracking-tight",o),...e}));Zs.displayName="CardTitle";const go=w.forwardRef(({className:o,...e},t)=>g.jsx("div",{ref:t,className:Ee("text-sm text-muted-foreground",o),...e}));go.displayName="CardDescription";const Js=w.forwardRef(({className:o,...e},t)=>g.jsx("div",{ref:t,className:Ee("p-6 pt-0",o),...e}));Js.displayName="CardContent";const Hz=w.forwardRef(({className:o,...e},t)=>g.jsx("div",{ref:t,className:Ee("flex items-center p-6 pt-0",o),...e}));Hz.displayName="CardFooter";const Bz=_h("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Qt({className:o,variant:e,...t}){return g.jsx("div",{className:Ee(Bz({variant:e}),o),...t})}const Er={heading:{h1:"text-2xl font-bold text-foreground",h2:"text-lg font-semibold text-foreground",h3:"text-sm font-semibold text-foreground",h4:"text-xs font-semibold text-foreground",h5:"text-[10px] font-semibold text-muted-foreground uppercase"},body:{base:"text-sm text-foreground",small:"text-xs text-foreground",micro:"text-[10px] text-foreground"},muted:{base:"text-sm text-muted-foreground",small:"text-xs text-muted-foreground",micro:"text-[10px] text-muted-foreground"},mono:{base:"font-mono text-sm text-foreground",small:"font-mono text-xs text-foreground",micro:"font-mono text-[10px] text-foreground"},status:{success:"text-success",warning:"text-warning",error:"text-destructive",info:"text-primary"}},ms=w.forwardRef(({level:o,as:e,className:t,children:n,...a},r)=>{const c=e||`h${o}`,l=`h${o}`;return g.jsx(c,{ref:r,className:Ee(Er.heading[l],t),...a,children:n})});ms.displayName="Heading";const We=w.forwardRef(({size:o="base",muted:e=!1,mono:t=!1,as:n="p",className:a,children:r,...c},l)=>{const d=n;let h;return t?h=Er.mono[o]:e?h=Er.muted[o]:h=Er.body[o],g.jsx(d,{ref:l,className:Ee(h,a),...c,children:r})});We.displayName="Text";const li=w.forwardRef(({status:o,size:e="base",weight:t="normal",as:n="span",className:a,children:r,...c},l)=>{const d=n,h={base:"text-sm",small:"text-xs",micro:"text-[10px]"},p={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};return g.jsx(d,{ref:l,className:Ee(h[e],p[t],Er.status[o],a),...c,children:r})});li.displayName="StatusText";const $z=w.forwardRef(({as:o="h2",className:e,children:t,...n},a)=>g.jsx(ms,{ref:a,level:1,as:o,className:e,...n,children:t}));$z.displayName="PageTitle";const Uz=w.forwardRef(({as:o="h3",className:e,children:t,...n},a)=>g.jsx(ms,{ref:a,level:2,as:o,className:e,...n,children:t}));Uz.displayName="SectionTitle";const Ws=w.forwardRef(({as:o="h3",className:e,children:t,...n},a)=>g.jsx(ms,{ref:a,level:3,as:o,className:e,...n,children:t}));Ws.displayName="PanelTitle";const Qz=w.forwardRef(({as:o="p",className:e,children:t,...n},a)=>g.jsx(We,{ref:a,size:"base",muted:!0,as:o,className:Ee("mt-1",e),...n,children:t}));Qz.displayName="Description";function Fz({connection:o,onUpdate:e}){const t=o.data||{},{isRunning:n}=Dt(),{getConnectionMessages:a,getMessageHistory:r}=ja(),[c,l]=w.useState([]),[d,h]=w.useState([]);w.useEffect(()=>{if(!n){l([]),h([]);return}const M=setInterval(()=>{const k=a(o.id),T=r(50).filter(A=>A.connectionId===o.id);l(k),h(T)},200);return()=>clearInterval(M)},[n,o.id,a,r]);const p=M=>{const k={...t,...M};e(o.id,{data:k})},m=M=>{p({latencyMs:Math.max(0,M)})},y=M=>{p({bandwidthMbps:Math.max(1,M)})},b=M=>{p({packetLossPercent:Math.max(0,Math.min(100,M))})},S=M=>{p({jitterMs:Math.max(0,M)})},C=M=>{p({retryCount:Math.max(0,M)})},E=M=>{p({timeoutMs:Math.max(1e3,M)})};return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx(Ws,{children:"Connection"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs(We,{size:"micro",muted:!0,children:["From: ",o.source]}),g.jsxs(We,{size:"micro",muted:!0,children:["To: ",o.target]}),g.jsxs(We,{size:"micro",muted:!0,children:["Type: ",o.type]})]})]}),g.jsxs("div",{className:"border-t border-border pt-2 space-y-2",children:[g.jsxs("div",{children:[g.jsx(ms,{level:5,className:"mb-1.5 opacity-70",children:"Network Parameters"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Latency (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.latencyMs??0})]}),g.jsx(ts,{value:[t.latencyMs??0],onValueChange:M=>m(M[0]),min:0,max:5e3,step:10,className:"w-full"}),g.jsx(At,{type:"number",value:t.latencyMs??0,onChange:M=>m(parseInt(M.target.value)||0),placeholder:"0-5000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Bandwidth (Mbps)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.bandwidthMbps??1e3})]}),g.jsx(ts,{value:[t.bandwidthMbps??1e3],onValueChange:M=>y(M[0]),min:1,max:1e5,step:10,className:"w-full"}),g.jsx(At,{type:"number",value:t.bandwidthMbps??1e3,onChange:M=>y(parseInt(M.target.value)||1e3),placeholder:"1-100000",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Packet Loss (%)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.packetLossPercent??0})]}),g.jsx(ts,{value:[t.packetLossPercent??0],onValueChange:M=>b(M[0]),min:0,max:100,step:.1,className:"w-full"}),g.jsx(At,{type:"number",step:"0.1",value:t.packetLossPercent??0,onChange:M=>b(parseFloat(M.target.value)||0),placeholder:"0-100",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Jitter (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.jitterMs??0})]}),g.jsx(ts,{value:[t.jitterMs??0],onValueChange:M=>S(M[0]),min:0,max:1e3,step:5,className:"w-full"}),g.jsx(At,{type:"number",value:t.jitterMs??0,onChange:M=>S(parseInt(M.target.value)||0),placeholder:"0-1000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx("h4",{className:"text-[9px] font-semibold text-foreground mb-1.5 uppercase opacity-70",children:"Traffic Characteristics"}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsx(st,{className:"text-xs",children:"Priority Level"}),g.jsxs(hz,{value:t.priorityLevel||"medium",onValueChange:M=>p({priorityLevel:M}),children:[g.jsx(KS,{className:"h-7 text-[11px]",children:g.jsx(pz,{})}),g.jsxs(XS,{children:[g.jsx(Cr,{value:"low",children:"Low"}),g.jsx(Cr,{value:"medium",children:"Medium"}),g.jsx(Cr,{value:"high",children:"High"}),g.jsx(Cr,{value:"critical",children:"Critical"})]})]})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Retry Count"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.retryCount??3})]}),g.jsx(ts,{value:[t.retryCount??3],onValueChange:M=>C(M[0]),min:0,max:10,step:1,className:"w-full"}),g.jsx(At,{type:"number",value:t.retryCount??3,onChange:M=>C(parseInt(M.target.value)||0),placeholder:"0-10",className:"h-7 text-xs"})]}),g.jsxs("div",{className:"space-y-1 mb-2",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx(st,{className:"text-xs",children:"Timeout (ms)"}),g.jsx(We,{mono:!0,size:"micro",className:"text-primary",children:t.timeoutMs??3e4})]}),g.jsx(ts,{value:[t.timeoutMs??3e4],onValueChange:M=>E(M[0]),min:1e3,max:12e4,step:1e3,className:"w-full"}),g.jsx(At,{type:"number",value:t.timeoutMs??3e4,onChange:M=>E(parseInt(M.target.value)||3e4),placeholder:"1000-120000",className:"h-7 text-xs"})]})]}),g.jsxs("div",{className:"border-t border-border pt-2",children:[g.jsx(ms,{level:5,className:"mb-1.5 opacity-70",children:"Monitoring"}),g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-accent/20 rounded-md",children:[g.jsx(st,{className:"text-xs cursor-pointer",children:"Enable Monitoring"}),g.jsx(ui,{checked:t.enableMonitoring??!1,onCheckedChange:M=>p({enableMonitoring:M})})]})]}),g.jsx(An,{className:"bg-card/50 border-border/50 p-1.5 mt-2",children:g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Bandwidth:"}),g.jsxs(We,{mono:!0,size:"micro",children:[Math.max(1,(t.bandwidthMbps??1e3)*(1-(t.packetLossPercent??0)/100)).toFixed(2)," Mbps"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx(We,{size:"micro",muted:!0,children:"Effective Latency:"}),g.jsxs(We,{mono:!0,size:"micro",children:[((t.latencyMs??0)+(t.jitterMs??0)/2).toFixed(0)," ms"]})]})]})}),n&&g.jsx("div",{className:"border-t border-border pt-2 mt-2",children:g.jsxs(rp,{defaultValue:"active",className:"w-full",children:[g.jsxs(au,{className:"grid w-full grid-cols-2 h-7",children:[g.jsxs(hs,{value:"active",className:"text-xs px-2",children:[g.jsx(hi,{className:"h-3 w-3 mr-1"}),"Active (",c.length,")"]}),g.jsxs(hs,{value:"history",className:"text-xs px-2",children:[g.jsx(K0,{className:"h-3 w-3 mr-1"}),"History (",d.length,")"]})]}),g.jsx(La,{value:"active",className:"mt-1.5 space-y-1",children:c.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(hi,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"No active messages"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:c.map((M,k)=>g.jsxs(An,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(Qt,{variant:"outline",className:"text-xs px-0.5 py-0",children:M.format}),g.jsx(Qt,{variant:M.status==="delivered"?"default":M.status==="failed"?"destructive":M.status==="transformed"?"secondary":"outline",className:"text-xs px-0.5 py-0",children:M.status})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(M.size/1024).toFixed(2)," KB"]}),M.latency&&g.jsxs("div",{children:["Latency: ",M.latency.toFixed(0)," ms"]})]}),M.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(Rr,{className:"h-2.5 w-2.5"}),M.error]})]})}),M.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(M.payload,null,2)})]})]},M.id||k))})}),g.jsx(La,{value:"history",className:"mt-1.5 space-y-1",children:d.length===0?g.jsxs("div",{className:"text-center py-3",children:[g.jsx(K0,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),g.jsx(We,{size:"micro",muted:!0,children:"History is empty"})]}):g.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:d.map((M,k)=>g.jsxs(An,{className:"p-1 border-border/50",children:[g.jsx("div",{className:"flex items-start justify-between gap-1.5",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[g.jsx(Qt,{variant:"outline",className:"text-xs px-0.5 py-0",children:M.format}),g.jsx(Qt,{variant:M.status==="delivered"?"default":M.status==="failed"?"destructive":"outline",className:"text-xs px-0.5 py-0",children:M.status}),g.jsx("span",{className:"text-[9px] text-muted-foreground",children:new Date(M.timestamp).toLocaleTimeString()})]}),g.jsxs("div",{className:"text-[9px] text-muted-foreground space-y-0.5",children:[g.jsxs("div",{children:["Size: ",(M.size/1024).toFixed(2)," KB"]}),M.latency&&g.jsxs("div",{children:["Latency: ",M.latency.toFixed(0)," ms"]})]}),M.error&&g.jsxs("div",{className:"text-[10px] text-destructive mt-0.5 flex items-center gap-0.5",children:[g.jsx(Rr,{className:"h-2.5 w-2.5"}),M.error]})]})}),M.payload&&g.jsxs("details",{className:"mt-1",children:[g.jsx("summary",{className:"text-[9px] cursor-pointer text-muted-foreground hover:text-foreground",children:"Show Data"}),g.jsx("pre",{className:"mt-1 p-1 bg-muted rounded text-[9px] overflow-x-auto max-h-32 overflow-y-auto",children:JSON.stringify(M.payload,null,2)})]})]},M.id||k))})})]})})]})]})}function Gz(o){const e=Vz(o),t=w.forwardRef((n,a)=>{const{children:r,...c}=n,l=w.Children.toArray(r),d=l.find(Yz);if(d){const h=d.props.children,p=l.map(m=>m===d?w.Children.count(h)>1?w.Children.only(null):w.isValidElement(h)?h.props.children:null:m);return g.jsx(e,{...c,ref:a,children:w.isValidElement(h)?w.cloneElement(h,void 0,p):null})}return g.jsx(e,{...c,ref:a,children:r})});return t.displayName=`${o}.Slot`,t}function Vz(o){const e=w.forwardRef((t,n)=>{const{children:a,...r}=t;if(w.isValidElement(a)){const c=Xz(a),l=Wz(r,a.props);return a.type!==w.Fragment&&(l.ref=n?Ss(n,c):c),w.cloneElement(a,l)}return w.Children.count(a)>1?w.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var Kz=Symbol("radix.slottable");function Yz(o){return w.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===Kz}function Wz(o,e){const t={...e};for(const n in e){const a=o[n],r=e[n];/^on[A-Z]/.test(n)?a&&r?t[n]=(...l)=>{const d=r(...l);return a(...l),d}:a&&(t[n]=a):n==="style"?t[n]={...a,...r}:n==="className"&&(t[n]=[a,r].filter(Boolean).join(" "))}return{...o,...t}}function Xz(o){let e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=Object.getOwnPropertyDescriptor(o,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}var wu="Popover",[b1]=bn(wu,[Eo]),Qr=Eo(),[Zz,Ba]=b1(wu),x1=o=>{const{__scopePopover:e,children:t,open:n,defaultOpen:a,onOpenChange:r,modal:c=!1}=o,l=Qr(e),d=w.useRef(null),[h,p]=w.useState(!1),[m,y]=xs({prop:n,defaultProp:a??!1,onChange:r,caller:wu});return g.jsx(mp,{...l,children:g.jsx(Zz,{scope:e,contentId:ns(),triggerRef:d,open:m,onOpenChange:y,onOpenToggle:w.useCallback(()=>y(b=>!b),[y]),hasCustomAnchor:h,onCustomAnchorAdd:w.useCallback(()=>p(!0),[]),onCustomAnchorRemove:w.useCallback(()=>p(!1),[]),modal:c,children:t})})};x1.displayName=wu;var w1="PopoverAnchor",Jz=w.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,a=Ba(w1,t),r=Qr(t),{onCustomAnchorAdd:c,onCustomAnchorRemove:l}=a;return w.useEffect(()=>(c(),()=>l()),[c,l]),g.jsx(uu,{...r,...n,ref:e})});Jz.displayName=w1;var S1="PopoverTrigger",C1=w.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,a=Ba(S1,t),r=Qr(t),c=_e(e,a.triggerRef),l=g.jsx(ke.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":k1(a.open),...n,ref:c,onClick:ge(o.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:g.jsx(uu,{asChild:!0,...r,children:l})});C1.displayName=S1;var kp="PopoverPortal",[e5,t5]=b1(kp,{forceMount:void 0}),M1=o=>{const{__scopePopover:e,forceMount:t,children:n,container:a}=o,r=Ba(kp,e);return g.jsx(e5,{scope:e,forceMount:t,children:g.jsx(rn,{present:t||r.open,children:g.jsx(Ir,{asChild:!0,container:a,children:n})})})};M1.displayName=kp;var vo="PopoverContent",E1=w.forwardRef((o,e)=>{const t=t5(vo,o.__scopePopover),{forceMount:n=t.forceMount,...a}=o,r=Ba(vo,o.__scopePopover);return g.jsx(rn,{present:n||r.open,children:r.modal?g.jsx(s5,{...a,ref:e}):g.jsx(a5,{...a,ref:e})})});E1.displayName=vo;var n5=Gz("PopoverContent.RemoveScroll"),s5=w.forwardRef((o,e)=>{const t=Ba(vo,o.__scopePopover),n=w.useRef(null),a=_e(e,n),r=w.useRef(!1);return w.useEffect(()=>{const c=n.current;if(c)return Kl(c)},[]),g.jsx(qr,{as:n5,allowPinchZoom:!0,children:g.jsx(R1,{...o,ref:a,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(o.onCloseAutoFocus,c=>{c.preventDefault(),r.current||t.triggerRef.current?.focus()}),onPointerDownOutside:ge(o.onPointerDownOutside,c=>{const l=c.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0,h=l.button===2||d;r.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:ge(o.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),a5=w.forwardRef((o,e)=>{const t=Ba(vo,o.__scopePopover),n=w.useRef(!1),a=w.useRef(!1);return g.jsx(R1,{...o,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{o.onCloseAutoFocus?.(r),r.defaultPrevented||(n.current||t.triggerRef.current?.focus(),r.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:r=>{o.onInteractOutside?.(r),r.defaultPrevented||(n.current=!0,r.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const c=r.target;t.triggerRef.current?.contains(c)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&a.current&&r.preventDefault()}})}),R1=w.forwardRef((o,e)=>{const{__scopePopover:t,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:r,disableOutsidePointerEvents:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,...m}=o,y=Ba(vo,t),b=Qr(t);return Gl(),g.jsx(Or,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:r,children:g.jsx(Pr,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:p,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onDismiss:()=>y.onOpenChange(!1),children:g.jsx(yp,{"data-state":k1(y.open),role:"dialog",id:y.contentId,...b,...m,ref:e,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),T1="PopoverClose",i5=w.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,a=Ba(T1,t);return g.jsx(ke.button,{type:"button",...n,ref:e,onClick:ge(o.onClick,()=>a.onOpenChange(!1))})});i5.displayName=T1;var o5="PopoverArrow",r5=w.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,a=Qr(t);return g.jsx(vp,{...a,...n,ref:e})});r5.displayName=o5;function k1(o){return o?"open":"closed"}var c5=x1,l5=C1,u5=M1,A1=E1;const d5=c5,f5=l5,D1=w.forwardRef(({className:o,align:e="center",sideOffset:t=4,...n},a)=>g.jsx(u5,{children:g.jsx(A1,{ref:a,align:e,sideOffset:t,className:Ee("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",o),...n})}));D1.displayName=A1.displayName;const N1=Cs((o,e)=>({componentStates:new Map,setComponentState:(t,n,a)=>{uo.setComponentState(t,n,a);const r=uo.getComponentState(t);r&&o(c=>({componentStates:new Map(c.componentStates).set(t,r)}))},resetComponent:t=>{uo.resetComponent(t),o(n=>{const a=new Map(n.componentStates);return a.delete(t),{componentStates:a}})},resetAll:()=>{uo.reset(),o({componentStates:new Map})},getComponentState:t=>e().componentStates.get(t),isEnabled:t=>uo.isEnabled(t),getAllStates:()=>Array.from(e().componentStates.values())}));function h5({componentId:o,componentLabel:e}){const{isRunning:t}=Dt(),{getComponentState:n,setComponentState:a,resetComponent:r}=N1(),c=n(o),l=c?.state||"enabled",[d,h]=w.useState(c?.degradedLevel||.5),[p,m]=w.useState(c?.failureRate||.1),[y,b]=w.useState(c?.latencyMultiplier||2),[S,C]=w.useState(c?.throughputMultiplier||.5),E=A=>{A==="degraded"?a(o,A,{degradedLevel:d,failureRate:p,latencyMultiplier:y,throughputMultiplier:S}):a(o,A)},M=()=>{r(o),h(.5),m(.1),b(2),C(.5)},k=A=>{switch(A){case"enabled":return"bg-green-500/20 text-green-500 border-green-500/50";case"disabled":return"bg-gray-500/20 text-gray-500 border-gray-500/50";case"degraded":return"bg-yellow-500/20 text-yellow-500 border-yellow-500/50";case"failed":return"bg-red-500/20 text-red-500 border-red-500/50"}},T=A=>{switch(A){case"enabled":return g.jsx(Gf,{className:"w-4 h-4"});case"disabled":return g.jsx(bl,{className:"w-4 h-4"});case"degraded":return g.jsx(ys,{className:"w-4 h-4"});case"failed":return g.jsx(di,{className:"w-4 h-4"})}};return g.jsxs(An,{className:"border",children:[g.jsx(Xs,{className:"p-2 pb-1.5",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsxs(Zs,{className:"text-[11px] flex items-center gap-1",children:[g.jsx(hi,{className:"w-3 h-3"}),"Component State",g.jsxs(d5,{children:[g.jsx(f5,{asChild:!0,children:g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-3.5 w-3.5 rounded-full",children:g.jsx(Fk,{className:"w-2.5 h-2.5 text-muted-foreground"})})}),g.jsx(D1,{className:"w-72 text-xs",align:"start",children:g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"font-semibold text-sm",children:"Component States"}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(Gf,{className:"w-3.5 h-3.5 text-green-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-green-500",children:"Enabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  normal operation"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(bl,{className:"w-3.5 h-3.5 text-gray-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-gray-500",children:"Disabled"}),g.jsx("span",{className:"text-muted-foreground",children:"  turned off. Throughput=0, Errors=100%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(ys,{className:"w-3.5 h-3.5 text-yellow-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-yellow-500",children:"Degraded"}),g.jsx("span",{className:"text-muted-foreground",children:"  partial failure. Throughput 50%, Latency 2x, Errors 10%"})]})]}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx(di,{className:"w-3.5 h-3.5 text-red-500 mt-0.5 flex-shrink-0"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-medium text-red-500",children:"Failed"}),g.jsx("span",{className:"text-muted-foreground",children:"  crashed. Same as Disabled but indicates failure"})]})]})]}),g.jsx("p",{className:"text-muted-foreground pt-1 border-t border-border",children:"Use to simulate failures and test architecture resilience."})]})})]})]}),g.jsx(go,{className:"text-[9px] mt-0.5",children:"Control operational state"})]}),c&&g.jsxs(Qt,{variant:"outline",className:`${k(l)} text-xs px-1 py-0.5`,children:[T(l),g.jsx("span",{className:"ml-0.5",children:l.toUpperCase()})]})]})}),g.jsxs(Js,{className:"p-2 pt-1.5 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[g.jsxs(Ae,{variant:l==="enabled"?"default":"outline",size:"sm",onClick:()=>E("enabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(Gf,{className:"w-3.5 h-3.5"}),"Enabled"]}),g.jsxs(Ae,{variant:l==="disabled"?"destructive":"outline",size:"sm",onClick:()=>E("disabled"),className:"flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(bl,{className:"w-3.5 h-3.5"}),"Disabled"]}),g.jsxs(Ae,{variant:l==="degraded"?"default":"outline",size:"sm",onClick:()=>E("degraded"),className:"flex items-center gap-1 h-7 text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-600 dark:text-yellow-400",disabled:!t,children:[g.jsx(ys,{className:"w-3.5 h-3.5"}),"Degraded"]}),g.jsxs(Ae,{variant:l==="failed"?"destructive":"outline",size:"sm",onClick:()=>E("failed"),className:"flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(di,{className:"w-3.5 h-3.5"}),"Failed"]})]}),l==="degraded"&&g.jsxs("div",{className:"space-y-2 p-2 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:[g.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[g.jsx(db,{className:"w-3 h-3 text-yellow-600 dark:text-yellow-400"}),g.jsx(st,{className:"text-[11px] font-semibold text-yellow-600 dark:text-yellow-400",children:"Degradation Settings"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Degradation Level"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(d*100).toFixed(0),"%"]})]}),g.jsx(ts,{value:[d],onValueChange:A=>{h(A[0]),E("degraded")},min:0,max:1,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Failure Rate"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(p*100).toFixed(0),"%"]})]}),g.jsx(ts,{value:[p],onValueChange:A=>{m(A[0]),E("degraded")},min:0,max:1,step:.05,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Latency Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[y.toFixed(1),"x"]})]}),g.jsx(ts,{value:[y],onValueChange:A=>{b(A[0]),E("degraded")},min:1,max:5,step:.1,className:"w-full"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[g.jsx(st,{className:"text-[10px]",children:"Throughput Multiplier"}),g.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[(S*100).toFixed(0),"%"]})]}),g.jsx(ts,{value:[S],onValueChange:A=>{C(A[0]),E("degraded")},min:0,max:1,step:.05,className:"w-full"})]})]})]}),c&&g.jsxs(Ae,{variant:"outline",size:"sm",onClick:M,className:"w-full flex items-center gap-1 h-7 text-xs",disabled:!t,children:[g.jsx(ub,{className:"w-3.5 h-3.5"}),"Reset to Normal"]}),!t&&g.jsxs("div",{className:"flex items-center gap-1 p-1 bg-muted rounded text-[9px] text-muted-foreground",children:[g.jsx(Rr,{className:"w-3 h-3"}),"Start emulation to control component state"]})]})]})}function p5({onFilterChange:o}){const{nodes:e,connections:t,selectNode:n}=Re(),{isRunning:a,getComponentMetrics:r}=Dt(),{getAllComponentStatuses:c}=fi(),[l,d]=w.useState(""),[h,p]=w.useState(!1),[m,y]=w.useState(!0),[b,S]=w.useState(!0),[C,E]=w.useState(!0),[M,k]=w.useState(!0),[T,A]=w.useState(100),[N,q]=w.useState(5),[O,H]=w.useState(new Set),J=Et.useMemo(()=>a?e.filter(te=>{if(l&&!te.data.label.toLowerCase().includes(l.toLowerCase()))return!1;if(!h)return!0;const le=r(te.id),L=c().find(_=>_.nodeId===te.id);return!!(m&&t.some(P=>P.source===te.id||P.target===te.id?Dt.getState().getConnectionMetrics(P.id)?.bottleneck:!1)||b&&le&&le.errorRate*100>=N||M&&le&&le.latency>=T||C&&L?.criticalPath||L&&(L.health==="critical"||L.health==="down"))}):e,[l,h,m,b,M,C,T,N,a,e,t]);Et.useEffect(()=>{if(h){const te=new Set(J.map(le=>le.id));H(te),o?.(Array.from(te))}else H(new Set),o?.(e.map(te=>te.id))},[h,J,e,o]);const se=te=>{n(te)},ce=J.length,Z=e.filter(te=>{if(!a)return!1;const le=r(te.id),L=c().find(_=>_.nodeId===te.id);return le&&(le.errorRate*100>=N||le.latency>=T)||L?.criticalPath||L&&(L.health==="critical"||L.health==="down")||t.some(_=>_.source===te.id||_.target===te.id?Dt.getState().getConnectionMetrics(_.id)?.bottleneck:!1)}).length;return g.jsxs(An,{className:"h-full border-2",children:[g.jsx(Xs,{className:"pb-3",children:g.jsxs(Zs,{className:"text-sm flex items-center gap-2",children:[g.jsx(iA,{className:"w-4 h-4"}),"Problem Filters",ce>0&&g.jsx(Qt,{variant:"destructive",className:"ml-auto",children:ce})]})}),g.jsxs(Js,{className:"space-y-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(st,{className:"text-xs",children:"Search Components"}),g.jsxs("div",{className:"relative",children:[g.jsx($l,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(At,{placeholder:"Search by name...",value:l,onChange:te=>d(te.target.value),className:"pl-8 h-8 text-xs"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(Jk,{className:"w-4 h-4"}),"Show Only Problems"]}),g.jsx(ui,{checked:h,onCheckedChange:p})]}),h&&g.jsxs("div",{className:"pl-6 space-y-2 border-l-2 border-border",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(db,{className:"w-4 h-4 text-red-500"}),"Bottlenecks"]}),g.jsx(ui,{checked:m,onCheckedChange:y})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(di,{className:"w-4 h-4 text-orange-500"}),"High Error Rate (>",N,"%)"]}),g.jsx(ui,{checked:b,onCheckedChange:S})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(fb,{className:"w-4 h-4 text-yellow-500"}),"High Latency (>",T,"ms)"]}),g.jsx(ui,{checked:M,onCheckedChange:k})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(st,{className:"text-xs flex items-center gap-2",children:[g.jsx(hi,{className:"w-4 h-4 text-purple-500"}),"Critical Paths"]}),g.jsx(ui,{checked:C,onCheckedChange:E})]})]})]}),h&&g.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[g.jsxs("div",{children:[g.jsx(st,{className:"text-xs",children:"Min Latency (ms)"}),g.jsx(At,{type:"number",value:T,onChange:te=>A(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0})]}),g.jsxs("div",{children:[g.jsx(st,{className:"text-xs",children:"Min Error Rate (%)"}),g.jsx(At,{type:"number",value:N,onChange:te=>q(Number(te.target.value)),className:"h-8 text-xs mt-1",min:0,max:100})]})]}),a&&g.jsx("div",{className:"pt-2 border-t border-border",children:g.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total problems detected: ",g.jsx("span",{className:"font-semibold text-foreground",children:Z})]})}),h&&J.length>0&&g.jsx(on,{className:"h-48 border border-border rounded p-2",children:g.jsx("div",{className:"space-y-1",children:J.map(te=>{const le=r(te.id),L=c().find(_=>_.nodeId===te.id);return g.jsx(Ae,{variant:"ghost",size:"sm",className:"w-full justify-start text-xs h-auto py-1.5",onClick:()=>se(te.id),children:g.jsxs("div",{className:"flex items-center gap-2 w-full",children:[L?.criticalPath&&g.jsx(Qt,{variant:"outline",className:"bg-purple-500/20 text-purple-500 border-purple-500/50 text-xs px-1",children:"Critical"}),g.jsx("span",{className:"flex-1 text-left truncate",children:te.data.label}),le&&le.errorRate*100>=N&&g.jsxs(Qt,{variant:"destructive",className:"text-xs px-1",children:[(le.errorRate*100).toFixed(0),"%"]})]})},te.id)})})}),!a&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-4",children:"Start emulation to see problems"})]})]})}function g5(){const{nodes:o,connections:e}=Re(),{isRunning:t,getComponentMetrics:n,getConnectionMetrics:a}=Dt(),{getAllComponentStatuses:r,getSystemAnalysis:c}=fi(),[l,d]=w.useState(""),[h,p]=w.useState("all");if(!t)return g.jsx(An,{className:"h-full",children:g.jsxs(Xs,{children:[g.jsx(Zs,{children:"Diagnostics"}),g.jsx(go,{children:"Start emulation to see diagnostics"})]})});const m=[],y=r();c(),o.forEach(E=>{const M=n(E.id),k=y.find(N=>N.nodeId===E.id);if(!M||!k)return;const T={nodeId:E.id,nodeLabel:E.data.label,problem:"",severity:"info",metrics:{throughput:M.throughput,latency:M.latency,errorRate:M.errorRate,utilization:M.utilization},affectedConnections:[],recommendations:[]},A=e.filter(N=>N.source===E.id||N.target===E.id?a(N.id)?.bottleneck:!1);if(A.length>0){T.problem=`Bottleneck detected in ${A.length} connection(s)`,T.severity="critical",T.affectedConnections=A.map(N=>N.id),T.rootCause="High throughput dependency or backpressure",T.recommendations=["Consider scaling this component horizontally","Optimize data processing logic","Check for connection bandwidth limits"],m.push(T);return}if(M.errorRate>.05){T.problem=`High error rate: ${(M.errorRate*100).toFixed(1)}%`,T.severity=M.errorRate>.1?"critical":"warning",T.rootCause="Component is experiencing failures",T.recommendations=["Check component logs for error details","Verify input data format and validation","Review retry and error handling logic"],m.push(T);return}if(M.latency>1e3){T.problem=`High latency: ${M.latency.toFixed(0)}ms`,T.severity=M.latency>2e3?"critical":"warning",T.rootCause="Component processing is slow",T.recommendations=["Optimize database queries or data processing","Consider caching frequently accessed data","Review component configuration for performance"],m.push(T);return}if(M.utilization>.9){T.problem=`High utilization: ${(M.utilization*100).toFixed(0)}%`,T.severity="warning",T.rootCause="Component is near capacity",T.recommendations=["Consider scaling this component","Optimize resource usage","Monitor for potential failures"],m.push(T);return}(k.health==="critical"||k.health==="down")&&(T.problem=`Component health: ${k.health}`,T.severity="critical",T.rootCause="Component is in critical state or down",T.recommendations=["Immediately check component status","Review error logs and metrics","Consider failover or restart"],m.push(T))});const b=m.filter(E=>!(h!=="all"&&E.severity!==h||l&&!E.nodeLabel.toLowerCase().includes(l.toLowerCase()))),S=E=>{switch(E){case"critical":return g.jsx(di,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(ys,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(Rr,{className:"w-4 h-4 text-blue-500"})}},C=E=>{switch(E){case"critical":return g.jsx(Qt,{variant:"destructive",className:"text-xs",children:"Critical"});case"warning":return g.jsx(Qt,{variant:"outline",className:"border-yellow-500 text-yellow-600 text-xs",children:"Warning"});default:return g.jsx(Qt,{variant:"outline",className:"text-xs",children:"Info"})}};return g.jsxs(An,{className:"h-full flex flex-col",children:[g.jsxs(Xs,{className:"pb-3",children:[g.jsx(Zs,{className:"text-sm font-semibold",children:"Diagnostics"}),g.jsxs(go,{className:"text-xs text-muted-foreground",children:[b.length," problem",b.length!==1?"s":""," detected"]})]}),g.jsxs(Js,{className:"flex-1 flex flex-col overflow-hidden p-0",children:[g.jsxs("div",{className:"p-4 border-b border-border space-y-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx($l,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),g.jsx(At,{placeholder:"Search components...",value:l,onChange:E=>d(E.target.value),className:"pl-8 h-8 text-xs"})]}),g.jsxs("div",{className:"flex gap-1",children:[g.jsx(Ae,{variant:h==="all"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>p("all"),children:"All"}),g.jsx(Ae,{variant:h==="critical"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>p("critical"),children:"Critical"}),g.jsx(Ae,{variant:h==="warning"?"default":"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>p("warning"),children:"Warning"})]})]}),g.jsx(on,{className:"flex-1",children:g.jsx("div",{className:"p-4 space-y-2",children:b.length===0?g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-6",children:[g.jsx(hi,{className:"w-6 h-6 mx-auto mb-1.5 opacity-50"}),g.jsx("p",{children:"No problems detected"})]}):b.map((E,M)=>g.jsxs(An,{className:`border-l-4 ${E.severity==="critical"?"border-l-red-500":E.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:[g.jsxs(Xs,{className:"pb-2 p-3",children:[g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[S(E.severity),g.jsx(Zs,{className:"text-xs font-semibold",children:E.nodeLabel}),C(E.severity)]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{o.find(T=>T.id===E.nodeId)&&Re.getState().selectNode(E.nodeId)},children:g.jsx(zk,{className:"w-3.5 h-3.5"})})]}),g.jsx(go,{className:"text-xs mt-0.5",children:E.problem})]}),g.jsxs(Js,{className:"pt-0 p-3 space-y-2",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[E.metrics.throughput!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Throughput: "}),g.jsxs("span",{className:"font-mono",children:[E.metrics.throughput.toFixed(0)," ops/s"]})]}),E.metrics.latency!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Latency: "}),g.jsxs("span",{className:"font-mono",children:[E.metrics.latency.toFixed(0),"ms"]})]}),E.metrics.errorRate!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Error Rate: "}),g.jsxs("span",{className:"font-mono",children:[(E.metrics.errorRate*100).toFixed(1),"%"]})]}),E.metrics.utilization!==void 0&&g.jsxs("div",{children:[g.jsx("span",{className:"text-muted-foreground",children:"Utilization: "}),g.jsxs("span",{className:"font-mono",children:[(E.metrics.utilization*100).toFixed(0),"%"]})]})]}),E.rootCause&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Root Cause:"}),g.jsx("div",{className:"text-xs",children:E.rootCause})]}),E.recommendations.length>0&&g.jsxs("div",{children:[g.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-0.5",children:"Recommendations:"}),g.jsx("ul",{className:"text-xs space-y-0.5 list-disc list-inside",children:E.recommendations.map((k,T)=>g.jsx("li",{className:"text-muted-foreground",children:k},T))})]})]})]},M))})})]})]})}function m5(){const{alerts:o,acknowledgeAlert:e,clearAlerts:t,getCriticalAlerts:n,getWarningAlerts:a}=Ph(),{selectNode:r}=Re(),c=n(),l=a();o.filter(p=>p.type==="info");const d=p=>{switch(p){case"critical":return g.jsx(di,{className:"w-4 h-4 text-red-500"});case"warning":return g.jsx(ys,{className:"w-4 h-4 text-yellow-500"});default:return g.jsx(lA,{className:"w-4 h-4 text-blue-500"})}},h=p=>{r(p)};return o.length===0?g.jsxs(An,{className:"h-full",children:[g.jsx(Xs,{children:g.jsx(Zs,{className:"text-sm",children:"Alerts"})}),g.jsx(Js,{children:g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(qh,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),g.jsx("p",{children:"No active alerts"})]})})]}):g.jsxs(An,{className:"h-full flex flex-col",children:[g.jsx(Xs,{className:"pb-3",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx(Zs,{className:"text-sm",children:"Alerts"}),g.jsxs("div",{className:"flex gap-2 mt-1",children:[c.length>0&&g.jsxs(Qt,{variant:"destructive",className:"text-xs",children:[c.length," Critical"]}),l.length>0&&g.jsxs(Qt,{variant:"outline",className:"text-xs border-yellow-500 text-yellow-600",children:[l.length," Warning"]})]})]}),g.jsx(Ae,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:t,children:"Clear All"})]})}),g.jsx(Js,{className:"flex-1 overflow-hidden p-0",children:g.jsx(on,{className:"h-full",children:g.jsx("div",{className:"p-4 space-y-2",children:o.map(p=>g.jsx(An,{className:`border-l-4 ${p.type==="critical"?"border-l-red-500 bg-red-500/5":p.type==="warning"?"border-l-yellow-500 bg-yellow-500/5":"border-l-blue-500 bg-blue-500/5"}`,children:g.jsx(Js,{className:"p-3",children:g.jsxs("div",{className:"flex items-start justify-between gap-2",children:[g.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[d(p.type),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("h4",{className:"text-xs font-semibold",children:p.title}),g.jsx(Qt,{variant:p.type==="critical"?"destructive":p.type==="warning"?"outline":"secondary",className:"text-xs",children:p.type})]}),g.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:p.message}),p.nodeLabel&&g.jsxs(Ae,{variant:"ghost",size:"sm",className:"h-6 text-xs p-1",onClick:()=>p.nodeId&&h(p.nodeId),children:["View: ",p.nodeLabel]}),g.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(p.timestamp).toLocaleTimeString()})]})]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>e(p.id),children:g.jsx(vs,{className:"w-3 h-3"})})]})})},p.id))})})})]})}function y5(){const{nodes:o,connections:e}=Re(),{isRunning:t,componentMetrics:n,connectionMetrics:a}=Dt(),{getSystemAnalysis:r}=fi(),{getCriticalAlerts:c,getWarningAlerts:l}=Ph(),d=w.useMemo(()=>{if(!t)return{totalThroughput:0,averageLatency:0,totalErrorRate:0,activeComponents:0,activeConnections:0,bottlenecks:0,healthyComponents:0,degradedComponents:0,criticalComponents:0};let m=0,y=0,b=0,S=0,C=0,E=0,M=0,k=0,T=0;n.forEach(O=>{(O.throughput>.1||O.errorRate>.001)&&(S++,m+=O.throughput||0,y+=O.latency||0,b+=O.errorRate||0)}),a.forEach(O=>{(O.effectiveThroughput>0||O.traffic>0)&&(C++,O.bottleneck&&E++)});const A=fi.getState();o.forEach(O=>{const H=A.getComponentStatus(O.id);if(H)switch(H.health){case"healthy":M++;break;case"degraded":k++;break;case"critical":case"down":T++;break}});const N=S>0?y/S:0,q=S>0?b/S:0;return{totalThroughput:m,averageLatency:N,totalErrorRate:q,activeComponents:S,activeConnections:C,bottlenecks:E,healthyComponents:M,degradedComponents:k,criticalComponents:T}},[t,n,a,o]),h=c(),p=l();return t?g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ms,{level:5,children:"Performance"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Total Throughput"}),g.jsxs(li,{status:"success",size:"base",weight:"bold",children:[d.totalThroughput.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ops/s"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Avg Latency"}),g.jsxs(li,{status:"warning",size:"base",weight:"bold",children:[d.averageLatency.toFixed(0),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"ms"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Error Rate"}),g.jsxs(li,{status:"error",size:"base",weight:"bold",children:[(d.totalErrorRate*100).toFixed(2),g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"%"})]})]}),g.jsxs("div",{className:"p-1.5 bg-card border border-border rounded",children:[g.jsx(We,{size:"micro",muted:!0,className:"mb-0.5",children:"Bottlenecks"}),g.jsxs(li,{status:"warning",size:"base",weight:"bold",children:[d.bottlenecks,g.jsx(We,{size:"micro",muted:!0,className:"ml-0.5",children:"conn"})]})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ms,{level:5,children:"Component Health"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(qh,{className:"w-4 h-4 text-success"}),g.jsx(We,{size:"micro",children:"Healthy"})]}),g.jsx(Qt,{variant:"outline",className:"bg-success/20 border-success/50 text-success text-xs px-1 py-0",children:d.healthyComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(ys,{className:"w-4 h-4 text-warning"}),g.jsx(We,{size:"micro",children:"Degraded"})]}),g.jsx(Qt,{variant:"outline",className:"bg-warning/20 border-warning/50 text-warning text-xs px-1 py-0",children:d.degradedComponents})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(ys,{className:"w-4 h-4 text-destructive"}),g.jsx(We,{size:"micro",children:"Critical/Down"})]}),g.jsx(Qt,{variant:"outline",className:"bg-destructive/20 border-destructive/50 text-destructive text-xs px-1 py-0",children:d.criticalComponents})]})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ms,{level:5,children:"Activity"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(mA,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Components"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[d.activeComponents," / ",o.length]})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(fb,{className:"w-4 h-4 text-muted-foreground"}),g.jsx(We,{size:"micro",children:"Active Connections"})]}),g.jsxs(We,{mono:!0,size:"micro",children:[d.activeConnections," / ",e.length]})]})]})]}),(h.length>0||p.length>0)&&g.jsxs("div",{className:"space-y-1.5",children:[g.jsx(ms,{level:5,children:"Alerts"}),g.jsxs("div",{className:"space-y-0.5",children:[h.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(li,{status:"error",size:"micro",children:"Critical"}),g.jsx(Qt,{variant:"destructive",className:"text-xs px-1 py-0",children:h.length})]}),p.length>0&&g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(li,{status:"warning",size:"micro",children:"Warnings"}),g.jsx(Qt,{variant:"outline",className:"border-warning text-warning text-xs px-1 py-0",children:p.length})]})]})]})]}):g.jsxs("div",{className:"text-center text-sm text-muted-foreground py-8",children:[g.jsx(hi,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),g.jsx("p",{children:"Start emulation to see system statistics"})]})}var Su="Checkbox",[v5]=bn(Su),[b5,Ap]=v5(Su);function x5(o){const{__scopeCheckbox:e,checked:t,children:n,defaultChecked:a,disabled:r,form:c,name:l,onCheckedChange:d,required:h,value:p="on",internal_do_not_use_render:m}=o,[y,b]=xs({prop:t,defaultProp:a??!1,onChange:d,caller:Su}),[S,C]=w.useState(null),[E,M]=w.useState(null),k=w.useRef(!1),T=S?!!c||!!S.closest("form"):!0,A={checked:y,disabled:r,setChecked:b,control:S,setControl:C,name:l,form:c,value:p,hasConsumerStoppedPropagationRef:k,required:h,defaultChecked:za(a)?!1:a,isFormControl:T,bubbleInput:E,setBubbleInput:M};return g.jsx(b5,{scope:e,...A,children:w5(m)?m(A):n})}var _1="CheckboxTrigger",j1=w.forwardRef(({__scopeCheckbox:o,onKeyDown:e,onClick:t,...n},a)=>{const{control:r,value:c,disabled:l,checked:d,required:h,setControl:p,setChecked:m,hasConsumerStoppedPropagationRef:y,isFormControl:b,bubbleInput:S}=Ap(_1,o),C=_e(a,p),E=w.useRef(d);return w.useEffect(()=>{const M=r?.form;if(M){const k=()=>m(E.current);return M.addEventListener("reset",k),()=>M.removeEventListener("reset",k)}},[r,m]),g.jsx(ke.button,{type:"button",role:"checkbox","aria-checked":za(d)?"mixed":d,"aria-required":h,"data-state":I1(d),"data-disabled":l?"":void 0,disabled:l,value:c,...n,ref:C,onKeyDown:ge(e,M=>{M.key==="Enter"&&M.preventDefault()}),onClick:ge(t,M=>{m(k=>za(k)?!0:!k),S&&b&&(y.current=M.isPropagationStopped(),y.current||M.stopPropagation())})})});j1.displayName=_1;var Dp=w.forwardRef((o,e)=>{const{__scopeCheckbox:t,name:n,checked:a,defaultChecked:r,required:c,disabled:l,value:d,onCheckedChange:h,form:p,...m}=o;return g.jsx(x5,{__scopeCheckbox:t,checked:a,defaultChecked:r,disabled:l,required:c,onCheckedChange:h,name:n,form:p,value:d,internal_do_not_use_render:({isFormControl:y})=>g.jsxs(g.Fragment,{children:[g.jsx(j1,{...m,ref:e,__scopeCheckbox:t}),y&&g.jsx(O1,{__scopeCheckbox:t})]})})});Dp.displayName=Su;var L1="CheckboxIndicator",z1=w.forwardRef((o,e)=>{const{__scopeCheckbox:t,forceMount:n,...a}=o,r=Ap(L1,t);return g.jsx(rn,{present:n||za(r.checked)||r.checked===!0,children:g.jsx(ke.span,{"data-state":I1(r.checked),"data-disabled":r.disabled?"":void 0,...a,ref:e,style:{pointerEvents:"none",...o.style}})})});z1.displayName=L1;var P1="CheckboxBubbleInput",O1=w.forwardRef(({__scopeCheckbox:o,...e},t)=>{const{control:n,hasConsumerStoppedPropagationRef:a,checked:r,defaultChecked:c,required:l,disabled:d,name:h,value:p,form:m,bubbleInput:y,setBubbleInput:b}=Ap(P1,o),S=_e(t,b),C=gu(r),E=lu(n);w.useEffect(()=>{const k=y;if(!k)return;const T=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(T,"checked").set,q=!a.current;if(C!==r&&N){const O=new Event("click",{bubbles:q});k.indeterminate=za(r),N.call(k,za(r)?!1:r),k.dispatchEvent(O)}},[y,C,r,a]);const M=w.useRef(za(r)?!1:r);return g.jsx(ke.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??M.current,required:l,disabled:d,name:h,value:p,form:m,...e,tabIndex:-1,ref:S,style:{...e.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});O1.displayName=P1;function w5(o){return typeof o=="function"}function za(o){return o==="indeterminate"}function I1(o){return za(o)?"indeterminate":o?"checked":"unchecked"}const Rh=w.forwardRef(({className:o,...e},t)=>g.jsx(Dp,{ref:t,className:Ee("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",o),...e,children:g.jsx(z1,{className:Ee("grid place-content-center text-current"),children:g.jsx(Oh,{className:"h-4 w-4"})})}));Rh.displayName=Dp.displayName;function q1({open:o,groupName:e,onConfirm:t,onCancel:n}){return g.jsx(Sx,{open:o,onOpenChange:a=>!a&&n(),children:g.jsxs(Jh,{children:[g.jsxs(Mx,{children:[g.jsx(ep,{children:"Delete Group?"}),g.jsxs(tp,{children:['Are you sure you want to delete the group "',e,'"? This action cannot be undone.']})]}),g.jsxs(Ex,{children:[g.jsx(sp,{onClick:n,children:"Cancel"}),g.jsx(np,{onClick:t,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}function S5({group:o}){const{nodes:e,updateGroup:t,deleteGroup:n,removeNodeFromGroup:a,addNodeToGroup:r,selectGroup:c}=Re(),[l,d]=w.useState(!1),[h,p]=w.useState(!1),[m,y]=w.useState(!1),[b,S]=w.useState(new Set),C=A=>{t(o.id,{name:A}),Ye.success("Group renamed"),p(!1)},E=()=>{d(!0)},M=()=>{n(o.id),c(null),Ye.success("Group deleted"),d(!1)},k=A=>{a(o.id,A),Ye.success("Component removed from group")},T=e.filter(A=>o.nodeIds.includes(A.id));return g.jsxs("div",{className:"space-y-2.5",children:[g.jsxs("div",{children:[g.jsx(st,{htmlFor:"group-name",className:"text-xs font-medium",children:"Group Name"}),g.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[g.jsx(At,{id:"group-name",value:o.name,onChange:A=>t(o.id,{name:A.target.value}),className:"flex-1 h-8 text-xs"}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:E,children:g.jsx(Hh,{className:"h-3.5 w-3.5 text-destructive"})})]})]}),g.jsx(q1,{open:l,groupName:o.name,onConfirm:M,onCancel:()=>d(!1)}),g.jsx(ip,{open:h,initialName:o.name,onConfirm:C,onCancel:()=>p(!1)}),g.jsx(vn,{}),g.jsxs("div",{className:"flex items-center space-x-2",children:[g.jsx(Rh,{id:"show-name",checked:o.showName!==!1,onCheckedChange:A=>t(o.id,{showName:A!==!1})}),g.jsx(st,{htmlFor:"show-name",className:"text-xs font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show name on canvas"})]}),g.jsx(vn,{}),g.jsxs("div",{children:[g.jsx(st,{className:"text-xs font-medium mb-1.5 block",children:"Color"}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("input",{type:"color",value:o.color||"#3b82f6",onChange:A=>t(o.id,{color:A.target.value}),className:"w-10 h-8 rounded border border-border cursor-pointer"}),g.jsx(At,{value:o.color||"#3b82f6",onChange:A=>t(o.id,{color:A.target.value}),className:"flex-1 font-mono text-xs h-8",placeholder:"#3b82f6"})]})]}),g.jsx(vn,{}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[g.jsxs(st,{className:"text-xs font-medium",children:["Components (",o.nodeIds.length,")"]}),g.jsxs(Ae,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{if(Re.getState().nodes.filter(q=>!o.nodeIds.includes(q.id)).length===0){Ye.info("All components are already in this group");return}S(new Set),y(!0)},children:[g.jsx(kl,{className:"h-3 w-3 mr-1"}),"Add"]})]}),g.jsxs("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[T.map(A=>g.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-secondary/50 rounded border border-border",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-xs font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:A.type})]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>k(A.id),title:"Remove from group",children:g.jsx(vs,{className:"h-3 w-3"})})]},A.id)),T.length===0&&g.jsx("div",{className:"text-xs text-muted-foreground text-center py-3",children:"No components in group"})]})]}),g.jsx(vn,{}),g.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[g.jsx("span",{children:"Group ID:"}),g.jsx("code",{className:"font-mono bg-secondary/50 px-1.5 py-0.5 rounded text-[10px]",children:o.id})]}),g.jsx(ap,{open:m,onOpenChange:y,children:g.jsxs(Wl,{className:"max-w-md",children:[g.jsxs(Xl,{children:[g.jsx(Jl,{children:"Add Components to Group"}),g.jsxs(eu,{children:['Select components to add to "',o.name,'"']})]}),g.jsx(on,{className:"max-h-96",children:g.jsxs("div",{className:"space-y-2 py-2",children:[e.filter(A=>!o.nodeIds.includes(A.id)).map(A=>g.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border border-border hover:bg-secondary/50 cursor-pointer",onClick:()=>{const N=new Set(b);N.has(A.id)?N.delete(A.id):N.add(A.id),S(N)},children:[g.jsx(Rh,{checked:b.has(A.id),onCheckedChange:N=>{const q=new Set(b);N?q.add(A.id):q.delete(A.id),S(q)}}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium truncate",children:A.data?.label||A.type}),g.jsx("div",{className:"text-xs text-muted-foreground truncate",children:A.type})]})]},A.id)),e.filter(A=>!o.nodeIds.includes(A.id)).length===0&&g.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"All components are already in this group"})]})}),g.jsxs(Zl,{children:[g.jsx(Ae,{variant:"outline",onClick:()=>{y(!1),S(new Set)},children:"Cancel"}),g.jsxs(Ae,{onClick:()=>{if(b.size===0){Ye.error("Select at least one component");return}b.forEach(A=>{r(o.id,A)}),Ye.success(`${b.size} component(s) added to group`),y(!1),S(new Set)},children:["Add Selected (",b.size,")"]})]})]})})]})}function C5(){const{selectedNodeId:o,nodes:e,updateNode:t,selectNode:n,connections:a,updateConnection:r,selectedConnectionId:c,selectConnection:l,selectedGroupId:d,groups:h,selectGroup:p}=Re(),{addTab:m}=pu(),y=e.find(C=>C.id===o),b=a.find(C=>C.id===c),S=h.find(C=>C.id===d);return S?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Vf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(Ws,{children:"Group Properties"})]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>p(null),children:g.jsx(vs,{className:"h-3 w-3"})})]}),g.jsx(on,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(S5,{group:S})})})]}):!y&&!b?g.jsx("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:g.jsxs(rp,{defaultValue:"stats",className:"h-full flex flex-col",children:[g.jsx("div",{className:"p-1 border-b border-border",children:g.jsxs(au,{className:"grid w-full grid-cols-5 h-6 gap-0.5 p-0.5",children:[g.jsx(hs,{value:"stats",className:"text-xs px-1 py-0.5",children:"Stats"}),g.jsx(hs,{value:"diagnostics",className:"text-xs px-1 py-0.5",children:"Diag"}),g.jsx(hs,{value:"alerts",className:"text-xs px-1 py-0.5",children:"Alerts"}),g.jsx(hs,{value:"filters",className:"text-xs px-1 py-0.5",children:"Filter"}),g.jsx(hs,{value:"properties",className:"text-xs px-1 py-0.5",children:"Groups"})]})}),g.jsx(La,{value:"stats",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(on,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(y5,{})})})}),g.jsx(La,{value:"diagnostics",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(g5,{})}),g.jsx(La,{value:"alerts",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(m5,{})}),g.jsx(La,{value:"filters",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(on,{className:"h-full",children:g.jsx("div",{className:"p-1.5",children:g.jsx(p5,{})})})}),g.jsx(La,{value:"properties",className:"flex-1 m-0 p-0 overflow-hidden",children:g.jsx(on,{className:"h-full",children:g.jsx("div",{className:"p-1.5 space-y-1.5",children:g.jsxs("div",{children:[g.jsxs(Ws,{as:"h4",className:"mb-1",children:["Groups (",h.length,")"]}),h.length>0?g.jsx("div",{className:"space-y-1",children:h.map(C=>g.jsx("div",{className:"p-1.5 bg-secondary/50 rounded border border-border cursor-pointer hover:bg-secondary transition-colors",onClick:()=>p(C.id),children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx(We,{size:"small",className:"font-medium truncate",children:C.name}),g.jsxs(We,{size:"micro",muted:!0,children:[C.nodeIds.length," component",C.nodeIds.length!==1?"s":""]})]}),g.jsx("div",{className:"w-2.5 h-2.5 rounded border-2 border-border flex-shrink-0 ml-1",style:{backgroundColor:C.color||"hsl(var(--primary))"}})]})},C.id))}):g.jsx(We,{size:"micro",muted:!0,className:"text-center py-2",children:"No groups created yet"})]})})})})]})}):b?g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Vf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(Ws,{children:"Connection"})]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>l(null),children:g.jsx(vs,{className:"h-3 w-3"})})]}),g.jsx(on,{className:"flex-1",children:g.jsx("div",{className:"p-1.5",children:g.jsx(Fz,{connection:b,onUpdate:(C,E)=>r(C,E)})})})]}):g.jsxs("div",{className:"w-60 h-full bg-card border-l border-border flex flex-col",children:[g.jsxs("div",{className:"p-1.5 border-b border-border flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Vf,{className:"h-3 w-3 text-muted-foreground"}),g.jsx(Ws,{children:"Properties"})]}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>n(null),children:g.jsx(vs,{className:"h-3 w-3"})})]}),g.jsx(on,{className:"flex-1",children:g.jsxs("div",{className:"p-1.5 space-y-1.5",children:[g.jsx(h5,{componentId:y.id,componentLabel:y.data.label}),g.jsx(vn,{}),g.jsxs("div",{children:[g.jsx(st,{htmlFor:"label",className:"text-xs font-medium",children:"Label"}),g.jsx(At,{id:"label",value:y.data.label,onChange:C=>t(y.id,{data:{...y.data,label:C.target.value}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsx(vn,{}),g.jsxs("div",{children:[g.jsx(Ws,{as:"h4",className:"mb-1",children:"Position"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsxs("div",{children:[g.jsx(st,{htmlFor:"pos-x",className:"text-xs text-muted-foreground",children:"X"}),g.jsx(At,{id:"pos-x",type:"number",value:Math.round(y.position.x),onChange:C=>t(y.id,{position:{...y.position,x:parseInt(C.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]}),g.jsxs("div",{children:[g.jsx(st,{htmlFor:"pos-y",className:"text-xs text-muted-foreground",children:"Y"}),g.jsx(At,{id:"pos-y",type:"number",value:Math.round(y.position.y),onChange:C=>t(y.id,{position:{...y.position,y:parseInt(C.target.value)||0}}),className:"mt-0.5 h-7 text-xs"})]})]})]}),g.jsx(vn,{}),g.jsxs("div",{children:[g.jsx(Ws,{as:"h4",className:"mb-1",children:"Component Type"}),g.jsx("div",{className:"bg-secondary/50 rounded-md p-1.5 border border-border",children:g.jsx(We,{mono:!0,size:"small",children:y.type})})]}),g.jsx(vn,{}),g.jsxs("div",{children:[g.jsx(Ws,{as:"h4",className:"mb-1",children:"Configuration"}),g.jsx(Ae,{variant:"outline",size:"sm",className:"w-full h-7 text-xs",onClick:()=>{m({title:`${y.data.label} Config`,type:"component",componentId:y.id,componentType:y.type})},children:"Open Configuration Panel"})]})]})})]})}function M5(){const{tabs:o,setActiveTab:e,closeTab:t,addTab:n}=pu(),a=()=>{n({title:"Untitled Diagram",type:"diagram"})};return g.jsx("div",{className:"h-10 bg-secondary/30 border-b border-border flex items-center",children:g.jsxs(on,{className:"flex-1",children:[g.jsxs("div",{className:"flex items-center",children:[o.map(r=>g.jsxs("div",{className:`
                flex items-center gap-2 px-4 h-10 border-r border-border cursor-pointer group
                transition-colors
                ${r.active?"bg-canvas-bg text-foreground":"text-muted-foreground hover:bg-secondary/50"}
              `,onClick:()=>e(r.id),children:[g.jsx("span",{className:"text-sm",children:r.title}),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:bg-destructive/10",onClick:c=>{c.stopPropagation(),t(r.id)},children:g.jsx(vs,{className:"h-3 w-3"})})]},r.id)),g.jsx(Ae,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-none",onClick:a,children:g.jsx(kl,{className:"h-4 w-4"})})]}),g.jsx(Fl,{orientation:"horizontal"})]})})}const Cv=o=>Symbol.iterator in o,Mv=o=>"entries"in o,Ev=(o,e)=>{const t=o instanceof Map?o:new Map(o.entries()),n=e instanceof Map?e:new Map(e.entries());if(t.size!==n.size)return!1;for(const[a,r]of t)if(!n.has(a)||!Object.is(r,n.get(a)))return!1;return!0},E5=(o,e)=>{const t=o[Symbol.iterator](),n=e[Symbol.iterator]();let a=t.next(),r=n.next();for(;!a.done&&!r.done;){if(!Object.is(a.value,r.value))return!1;a=t.next(),r=n.next()}return!!a.done&&!!r.done};function R5(o,e){return Object.is(o,e)?!0:typeof o!="object"||o===null||typeof e!="object"||e===null||Object.getPrototypeOf(o)!==Object.getPrototypeOf(e)?!1:Cv(o)&&Cv(e)?Mv(o)&&Mv(e)?Ev(o,e):E5(o,e):Ev({entries:()=>Object.entries(o)},{entries:()=>Object.entries(e)})}function H1(o){const e=Et.useRef(void 0);return t=>{const n=o(t);return R5(e.current,n)?e.current:e.current=n}}const Rv=globalThis;function pl(o){try{if(typeof Rv.structuredClone=="function")return Rv.structuredClone(o)}catch{}return JSON.parse(JSON.stringify(o))}function bo(o,e,t=140,n=100,a=16){const r=[],c=t/2,l=n/2,d=o+c,h=e+l;for(let p=0;p<a;p++){const m=p/a*2*Math.PI-Math.PI/2;let y,b;const S=(m%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(S>=0&&S<Math.PI/2){const C=S/(Math.PI/2);y=d+c,b=h-l+C*n}else if(S>=Math.PI/2&&S<Math.PI){const C=(S-Math.PI/2)/(Math.PI/2);y=d+c-C*t,b=h+l}else if(S>=Math.PI&&S<3*Math.PI/2){const C=(S-Math.PI)/(Math.PI/2);y=d-c,b=h+l-C*n}else{const C=(S-3*Math.PI/2)/(Math.PI/2);y=d-c+C*t,b=h-l}r.push({x:y,y:b,index:p})}return r}function T5(o,e,t){let n=1/0,a=0;for(let r=0;r<o.length;r++){const c=o[r],l=Math.sqrt(Math.pow(e-c.x,2)+Math.pow(t-c.y,2));l<n&&(n=l,a=r)}return a}function Tv(o,e,t,n,a,r,c,l=140,d=100){const h=bo(r,c,l,d),p=T5(h,t,n);if(a.filter(y=>y.source===o&&y.target===e&&y.sourcePort===p||y.target===o&&y.source===e&&y.targetPort===p).length===0)return p;for(let y=1;y<h.length;y++){const b=(p+y)%h.length,S=(p-y+h.length)%h.length;if(a.filter(M=>M.source===o&&M.target===e&&M.sourcePort===b||M.target===o&&M.source===e&&M.targetPort===b).length===0)return b;if(a.filter(M=>M.source===o&&M.target===e&&M.sourcePort===S||M.target===o&&M.source===e&&M.targetPort===S).length===0)return S}return p}const B1=w.createContext(null);function k5({children:o}){const e=w.useRef(new Map),t=w.useCallback((c,l)=>{l?e.current.set(c,l):e.current.delete(c)},[]),n=w.useCallback(c=>e.current.get(c)||null,[]),a=w.useCallback(c=>{e.current.delete(c)},[]),r={registerNodeRef:t,getNodeRef:n,unregisterNodeRef:a};return g.jsx(B1.Provider,{value:r,children:o})}function Cu(){const o=w.useContext(B1);if(!o)throw new Error("useNodeRefs must be used within NodeRefsProvider");return o}function A5({node:o,onConnectionStart:e,onConnectionEnd:t,isConnecting:n=!1,onContextMenu:a}){const{registerNodeRef:r,unregisterNodeRef:c}=Cu(),l=w.useRef(null);w.useEffect(()=>(l.current&&r(o.id,l.current),()=>{c(o.id)}),[o.id,r,c]);const d=Re(de=>de.selectNode),h=Re(de=>de.updateNode),p=Re(de=>de.updateNodes),m=Re(de=>de.deleteNode);Re(de=>de.addNode);const y=Re(de=>de.startDragOperation),b=Re(de=>de.endDragOperation);Re(de=>de.bringToFront),Re(de=>de.sendToBack),Re(de=>de.bringForward),Re(de=>de.sendBackward);const{connections:S,zoom:C,pan:E,nodes:M}=Re(H1(de=>({connections:de.connections,zoom:de.zoom,pan:de.pan,nodes:de.nodes}))),{addTab:k}=pu(),[T,A]=w.useState(!1),[N,q]=w.useState(!1),O=w.useRef({x:0,y:0}),H=w.useRef({x:0,y:0}),J=w.useRef({x:0,y:0}),se=w.useRef({x:0,y:0}),ce=w.useRef(null),Z=w.useRef(null),te=w.useRef(!1),le=w.useRef(!1),ue=w.useRef({}),L=w.useMemo(()=>kr.find(de=>de.type===o.type),[o.type]),{isRunning:_,getComponentMetrics:P}=Dt(),W=fi(de=>de.getComponentStatus(o.id)),he=N1(de=>de.getComponentState(o.id)),j=_?P(o.id):void 0,Y=zr(de=>de.highlightedNodeId)===o.id,ae=w.useMemo(()=>S.some(de=>de.source===o.id||de.target===o.id),[S,o.id]),U=j&&(j.throughput&&j.throughput>.1||j.errorRate&&j.errorRate>.001||j.utilization&&j.utilization>.01),ie=()=>{if(!_||!j||!ae||!U)return"";const de=j.utilization||0,Be=j.errorRate||0,Ue=Math.min(1,de*.7+Be*.3);return Ue>.8?"border-red-500":Ue>.6?"border-orange-500":Ue>.4?"border-yellow-500":Ue>.2?"border-green-500":""},$=()=>{if(!_)return null;if(he)switch(he.state){case"disabled":case"failed":return g.jsx(bl,{className:"text-red-500",size:16});case"degraded":return g.jsx(ys,{className:"text-yellow-500",size:16})}if(!ae||!U||!W)return null;const de=W.health,Be=16;switch(de){case"healthy":return g.jsx(qh,{className:"text-green-500",size:Be});case"degraded":return g.jsx(ys,{className:"text-yellow-500",size:Be});case"critical":return g.jsx(Rr,{className:"text-orange-500",size:Be});case"down":return g.jsx(di,{className:"text-red-500",size:Be});default:return null}},V=()=>{if(!_)return o.selected?"border-primary":"border-border";if(he)switch(he.state){case"disabled":case"failed":return"border-red-500 border-2";case"degraded":return"border-yellow-500 border-2"}if(!W)return o.selected?"border-primary":"border-border";if(W.criticalPath)return"border-purple-500 border-2";switch(W.health){case"down":return"border-red-500 border-2";case"critical":return"border-orange-500";case"degraded":return"border-yellow-500";default:return o.selected?"border-primary":"border-border"}},pe=w.useRef(C),me=w.useRef(E);w.useEffect(()=>{pe.current=C,me.current=E},[C,E]),w.useEffect(()=>{const de=Ue=>{if(!te.current)return;if(Re.getState().getIsGroupDragging()){te.current=!1,le.current=!1,A(!1);return}const pt=Ue.clientX-H.current.x,qt=Ue.clientY-H.current.y,Je=Math.sqrt(pt*pt+qt*qt);if(!le.current&&Je>3){le.current=!0,A(!0),y(o.id);const vt=Re.getState().nodes.filter(gt=>gt.selected);ue.current={},vt.forEach(gt=>{ue.current[gt.id]={x:gt.position.x,y:gt.position.y}})}if(le.current&&ce.current){const _t=pe.current,vt=me.current,gt=ce.current.getBoundingClientRect(),Yt=(Ue.clientX-gt.left-vt.x)/_t,Ft=(Ue.clientY-gt.top-vt.y)/_t,Rs=Yt-J.current.x,Yn=Ft-J.current.y,os=Re.getState().nodes.filter(Gt=>Gt.selected),Wt=Object.keys(ue.current).length>0;if(os.length>1&&Wt){const Gt=[];os.forEach(jt=>{const $a=ue.current[jt.id];$a&&Gt.push({id:jt.id,updates:{position:{x:$a.x+Rs,y:$a.y+Yn}}})}),Gt.length>0&&p(Gt,!0)}else{const Gt=se.current.x+Rs,jt=se.current.y+Yn;h(o.id,{position:{x:Gt,y:jt}},!0)}}},Be=()=>{te.current&&(te.current=!1,le.current&&(le.current=!1,A(!1),b()))};return document.addEventListener("mousemove",de),document.addEventListener("mouseup",Be),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",Be)}},[o.id,h,p,y,b]);const ye=de=>{if(de.button!==0)return;const Ue=Re.getState().nodes.filter(Dn=>Dn.selected),yt=o.selected,pt=Ue.some(Dn=>Dn.id!==o.id);if(!(yt&&pt&&!de.ctrlKey&&!de.metaKey)){const Dn=de.ctrlKey||de.metaKey;d(o.id,Dn)}const qt=document.querySelector(".flex-1.overflow-hidden.relative");if(!qt){O.current={x:0,y:0},J.current={x:0,y:0},se.current={x:0,y:0},ce.current=null,Z.current=null;return}ce.current=qt;const Je=pe.current,_t=me.current,vt=qt.getBoundingClientRect();Z.current=vt;const gt=(de.clientX-vt.left-_t.x)/Je,Yt=(de.clientY-vt.top-_t.y)/Je;J.current={x:gt,y:Yt};const Yn=Re.getState().nodes.find(Dn=>Dn.id===o.id)?.position||o.position;se.current={x:Yn.x,y:Yn.y},O.current={x:gt-Yn.x,y:Yt-Yn.y},H.current={x:de.clientX,y:de.clientY},te.current=!0,le.current=!1,de.stopPropagation()},ve=de=>{de.stopPropagation(),de.preventDefault(),T&&(A(!1),b()),k({title:`${o.data.label} Config`,type:"component",componentId:o.id,componentType:o.type})},Le=de=>{de.key==="Delete"&&o.selected&&m(o.id)},$e=de=>{if(de.preventDefault(),de.stopPropagation(),!o.selected){const Be=M.some(Ue=>Ue.id!==o.id&&Ue.selected);d(o.id,Be)}a?.(de.clientX,de.clientY)},at=(de,Be)=>{de.stopPropagation(),e?.(Be)},Ze=w.useCallback(()=>{if(!l.current)return{width:140,height:100};const Ue=(l.current.querySelector(".bg-card")||l.current).getBoundingClientRect();return{width:Ue.width/C,height:Ue.height/C}},[C]),Nt=de=>{if(n){de.stopPropagation();const Be=Ze(),Ue=bo(o.position.x,o.position.y,Be.width,Be.height,16),yt=document.querySelector(".flex-1.overflow-hidden.relative");if(yt){const pt=yt.getBoundingClientRect(),qt=(de.clientX-pt.left-E.x)/C,Je=(de.clientY-pt.top-E.y)/C;let _t=1/0,vt=0;for(let gt=0;gt<Ue.length;gt++){const Yt=Ue[gt],Ft=Math.sqrt(Math.pow(qt-Yt.x,2)+Math.pow(Je-Yt.y,2));Ft<_t&&(_t=Ft,vt=gt)}t?.(vt)}else t?.()}};return g.jsx(g.Fragment,{children:g.jsx("div",{ref:l,"data-node-id":o.id,className:`
          absolute cursor-move select-none
          transition-shadow
          ${o.selected?"glow-primary":""}
          ${T?"pointer-events-none":""}
        `,style:{left:`${o.position.x}px`,top:`${o.position.y}px`},onMouseDown:ye,onMouseUp:Nt,onDoubleClick:ve,onContextMenu:$e,onKeyDown:Le,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),tabIndex:0,children:g.jsxs("div",{className:Ee("bg-card border-2 rounded-lg p-4 min-w-[140px] relative",V(),ie(),"hover:border-primary/50 transition-colors",W?.criticalPath&&"shadow-lg shadow-purple-500/20",Y&&"ring-4 ring-yellow-400 ring-offset-2 animate-pulse"),children:[_&&W&&g.jsx("div",{className:"absolute -top-2 -right-2 bg-card rounded-full p-0.5 border border-border",children:$()}),_&&W?.criticalPath&&g.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 bg-purple-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-semibold",children:"CRITICAL"}),g.jsxs("div",{className:"flex flex-col items-center gap-2 select-none",children:[g.jsx("div",{className:"text-3xl select-none pointer-events-none",children:L?.icon}),g.jsx("div",{className:"text-sm font-medium text-center text-foreground select-none pointer-events-none",children:o.data.label})]}),(N||n)&&(()=>{const de=l.current?(()=>{const pt=(l.current.querySelector(".bg-card")||l.current).getBoundingClientRect();return{width:pt.width/C,height:pt.height/C}})():{width:140,height:100},Be=bo(o.position.x,o.position.y,de.width,de.height,16);return g.jsx(g.Fragment,{children:Be.map((Ue,yt)=>{const pt=Ue.x-o.position.x,qt=Ue.y-o.position.y;return g.jsx("div",{className:"absolute w-3 h-3 rounded-full bg-primary/80 border-2 border-card cursor-crosshair hover:scale-150 hover:bg-primary transition-all z-10",style:{left:`${pt-6}px`,top:`${qt-6}px`},onMouseDown:Je=>{Je.stopPropagation(),at(Je,yt)},onMouseUp:Je=>{Je.stopPropagation(),n&&t?.(yt)},title:"Connection point"},yt)})})})()]})})})}const D5=w.memo(A5,(o,e)=>!(o.node.id!==e.node.id||o.node.position.x!==e.node.position.x||o.node.position.y!==e.node.position.y||o.node.selected!==e.node.selected||o.node.type!==e.node.type||o.node.data.label!==e.node.data.label||o.isConnecting!==e.isConnecting||o.onConnectionStart!==e.onConnectionStart||o.onConnectionEnd!==e.onConnectionEnd||o.onContextMenu!==e.onContextMenu));function N5({selectedNodeId:o,highlightPath:e=!0}){const{nodes:t,connections:n}=Re(),{isRunning:a}=Dt(),{getConnectionMessages:r}=ja(),[c,l]=w.useState(new Set),[d,h]=w.useState(new Map);return w.useEffect(()=>{if(!o||!e||!a){l(new Set),h(new Map);return}const p=new Set,m=new Map,y=[{nodeId:o,path:[o]}];for(;y.length>0;){const{nodeId:b,path:S}=y.shift();if(p.has(b))continue;p.add(b);const C=n.filter(E=>E.source===b);for(const E of C){const M=E.target,k=[...S,M];m.set(E.id,k),p.has(M)||y.push({nodeId:M,path:k})}}h(m),l(new Set(m.keys()))},[o,n,e,a]),w.useEffect(()=>{if(!o||!e||!a)return;const p=new Set,m=[{nodeId:o,path:[o]}];for(;m.length>0;){const{nodeId:y,path:b}=m.shift();if(p.has(y))continue;p.add(y);const S=n.filter(C=>C.target===y);for(const C of S){const E=C.source,M=[E,...b],k=d.get(C.id)||[];(k.length===0||M.length<k.length)&&(d.set(C.id,M),h(new Map(d))),p.has(E)||m.push({nodeId:E,path:M})}}l(new Set(d.keys()))},[o,n,e,a]),null}function _5(o){const{selectedNodeId:e}=Re(),{isRunning:t}=Dt(),[n,a]=w.useState(!1);return w.useEffect(()=>{if(!e||!t){a(!1);return}const{nodes:r,connections:c}=Re.getState();if(!r.find(h=>h.id===e)){a(!1);return}const d=c.find(h=>h.id===o);d&&(d.source===e||d.target===e)?a(!0):a(!1)},[e,o,t]),n}const $1=w.createContext(null);function j5({children:o}){const e=w.useRef(null),t=w.useRef(new WeakMap);w.useEffect(()=>(e.current=new ResizeObserver(r=>{r.forEach(c=>{const l=t.current.get(c.target);l&&l()})}),()=>{e.current&&(e.current.disconnect(),e.current=null)}),[]);const a={observe:w.useCallback((r,c)=>e.current?(t.current.set(r,c),e.current.observe(r),()=>{e.current&&(e.current.unobserve(r),t.current.delete(r))}):()=>{},[])};return g.jsx($1.Provider,{value:a,children:o})}function U1(){const o=w.useContext($1);if(!o)throw new Error("useResizeObserver must be used within ResizeObserverProvider");return o}function L5({connection:o,sourceNode:e,targetNode:t,zoom:n,pan:a,isSelected:r=!1,onClick:c,onContextMenu:l}){const[d,h]=w.useState(!1),{isRunning:p,connectionMetrics:m}=Dt(H1(V=>({isRunning:V.isRunning,connectionMetrics:V.connectionMetrics}))),y=p?m.get(o.id):void 0,{getConnectionMessages:b}=ja(),S=Re(V=>V.selectedNodeId),C=Re(V=>V.connections),E=p?b(o.id):[],M=w.useMemo(()=>E.filter(V=>V.status==="in-transit"||V.status==="pending"),[E]),k=_5(o.id);w.useMemo(()=>C.some(V=>V.source===o.target&&V.target===o.source),[C,o.target,o.source]);const{getNodeRef:T}=Cu(),{observe:A}=U1(),[N,q]=w.useState(()=>{const V=pe=>{const me=T(pe);if(!me)return{width:140,height:100};const Le=(me.querySelector(".bg-card")||me).getBoundingClientRect();return{width:Le.width/n,height:Le.height/n}};return{source:V(e.id),target:V(t.id)}});w.useEffect(()=>{const V=()=>{const Ze=Nt=>{const de=T(Nt);if(!de)return{width:140,height:100};const yt=(de.querySelector(".bg-card")||de).getBoundingClientRect();return{width:yt.width/n,height:yt.height/n}};q({source:Ze(e.id),target:Ze(t.id)})};V();const pe=T(e.id),me=T(t.id),ye=pe?.querySelector(".bg-card"),ve=me?.querySelector(".bg-card"),Le=ye||pe,$e=ve||me,at=[];if(Le){const Ze=A(Le,V);at.push(Ze)}if($e){const Ze=A($e,V);at.push(Ze)}return()=>{at.forEach(Ze=>Ze())}},[e.id,t.id,n,T,A]);const O=N.source.width,H=N.source.height,J=N.target.width,se=N.target.height,ce=O/2,Z=H/2,te=J/2,le=se/2;let ue,L,_,P;if(o.sourcePort!==void 0&&o.targetPort!==void 0){const V=bo(e.position.x,e.position.y,O,H,16),pe=bo(t.position.x,t.position.y,J,se,16),me=V[o.sourcePort],ye=pe[o.targetPort];ue=me.x,L=me.y,_=ye.x,P=ye.y}else{const V=e.position.x+ce,pe=e.position.y+Z,me=t.position.x+te,ye=t.position.y+le,ve=Math.atan2(ye-pe,me-V),Le=(Ze,Nt,de,Be)=>{const Ue=Math.abs(de),yt=Be?ce:te,pt=Be?Z:le,qt=Math.atan2(pt,yt);let Je,_t;if(Ue<qt||Ue>Math.PI-qt){const vt=Be?1:-1;Je=Ze+vt*yt*Math.sign(Math.cos(de)),_t=Nt+vt*yt*Math.tan(de)*Math.sign(Math.cos(de))}else{const vt=Be?1:-1;Je=Ze+vt*pt/Math.tan(de)*Math.sign(Math.sin(de)),_t=Nt+vt*pt*Math.sign(Math.sin(de))}return{x:Je,y:_t}},$e=Le(V,pe,ve,!0),at=Le(me,ye,ve,!1);ue=$e.x,L=$e.y,_=at.x,P=at.y}const W=_-ue,he=P-L,j=Math.min(Math.abs(W),Math.abs(he))*.3+30,Q=`
    M ${ue},${L}
    C ${ue+j*Math.sign(W)},${L}
      ${_-j*Math.sign(W)},${P}
      ${_},${P}
  `;let Y="hsl(var(--border))",ae=2;k&&S?(Y="hsl(280 100% 70%)",ae=3):r?(Y="hsl(var(--primary))",ae=2.5):d?(Y="hsl(var(--accent))",ae=2.5):y&&p&&(y.effectiveThroughput>0||y.traffic>0)&&(y.bottleneck?(Y="hsl(0 84% 60%)",ae=3):y.backpressure>.7?(Y="hsl(25 95% 53%)",ae=2.5):y.congestion>.6?(Y="hsl(45 93% 47%)",ae=2.5):y.throughputDependency>.5?(Y="hsl(142 76% 36%)",ae=2):y.effectiveThroughput>0&&(Y="hsl(var(--primary))",ae=2));const U=V=>{V.stopPropagation(),c?.()},ie=V=>{V.preventDefault(),V.stopPropagation(),l?.(V)},$=p&&y&&y.effectiveThroughput>0?y.effectiveThroughput%40/2:0;return g.jsxs("g",{children:[g.jsx("path",{d:Q,fill:"none",stroke:"transparent",strokeWidth:20/n,style:{cursor:"pointer"},onClick:U,onContextMenu:ie,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)}),p&&y&&y.effectiveThroughput>0&&y.traffic>0&&g.jsx("path",{d:Q,fill:"none",stroke:Y,strokeWidth:Math.max(1,ae/n),strokeLinecap:"round",strokeDasharray:`${Math.max(4,8/n)} ${Math.max(2,4/n)}`,strokeDashoffset:-$,style:{opacity:.4,pointerEvents:"none",animation:"flow 2s linear infinite"}}),p&&M.map((V,pe)=>{const me=Date.now()-V.timestamp,ve=V.latency?Math.min(1,me/V.latency):0,Le=ue+(_-ue)*ve,$e=L+(P-L)*ve,Ze={json:"hsl(142 76% 36%)",xml:"hsl(25 95% 53%)",binary:"hsl(221 83% 53%)",protobuf:"hsl(280 100% 70%)",text:"hsl(210 40% 50%)"}[V.format]||"hsl(var(--primary))";return g.jsxs("g",{children:[g.jsx("circle",{cx:Le,cy:$e,r:4/n,fill:Ze,stroke:"hsl(var(--background))",strokeWidth:1/n,style:{pointerEvents:"none",filter:"drop-shadow(0 0 2px rgba(0,0,0,0.3))"},children:g.jsx("animate",{attributeName:"opacity",values:"0.5;1;0.5",dur:"1s",repeatCount:"indefinite"})}),V.size>1e3&&g.jsx("text",{x:Le,y:$e-8/n,fill:Ze,fontSize:8/n,textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:V.format})]},V.id||pe)}),g.jsx("path",{d:Q,fill:"none",stroke:Y,strokeWidth:Math.max(1,ae/n),strokeLinecap:"round",markerEnd:p&&y&&(y.effectiveThroughput>0||y.traffic>0)?`url(#arrowhead-${r?"selected":y?.bottleneck?"bottleneck":"default"})`:r?"url(#arrowhead-selected)":"url(#arrowhead-default)",style:{transition:"stroke 0.3s, stroke-width 0.3s",pointerEvents:"none"}}),p&&y&&(y.effectiveThroughput>0||y.traffic>0)?g.jsxs("g",{children:[g.jsx("text",{x:(ue+_)/2,y:(L+P)/2-10/n,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/n),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:o.label||`${y.latency.toFixed(1)}ms`}),g.jsx("text",{x:(ue+_)/2,y:(L+P)/2+8/n,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(7,9/n),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none"},children:y.traffic>0?`${y.traffic.toFixed(1)} KB/s`:`${y.effectiveThroughput.toFixed(0)} msg/s`}),o.data?.bandwidthMbps&&y.traffic>0&&g.jsxs("text",{x:(ue+_)/2,y:(L+P)/2+20/n,fill:"hsl(var(--muted-foreground))",fontSize:Math.max(6,8/n),textAnchor:"middle",style:{pointerEvents:"none",userSelect:"none",opacity:.7},children:["Limit: ",o.data.bandwidthMbps,"Mbps"]})]}):o.label?g.jsx("g",{children:g.jsx("text",{x:(ue+_)/2,y:(L+P)/2-10/n,fill:"hsl(var(--primary))",fontSize:Math.max(8,11/n),textAnchor:"middle",fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:o.label})}):null]})}const z5=w.memo(L5,(o,e)=>!(o.connection.id!==e.connection.id||o.connection.sourcePort!==e.connection.sourcePort||o.connection.targetPort!==e.connection.targetPort||o.connection.label!==e.connection.label||o.sourceNode.id!==e.sourceNode.id||o.sourceNode.position.x!==e.sourceNode.position.x||o.sourceNode.position.y!==e.sourceNode.position.y||o.targetNode.id!==e.targetNode.id||o.targetNode.position.x!==e.targetNode.position.x||o.targetNode.position.y!==e.targetNode.position.y||o.zoom!==e.zoom||o.pan.x!==e.pan.x||o.pan.y!==e.pan.y||o.isSelected!==e.isSelected||o.onClick!==e.onClick||o.onContextMenu!==e.onContextMenu)),P5=140,O5=140,I5=16;function q5({nodeId:o,position:e}){const t=Dt(p=>p.componentMetrics.get(o)),{connections:n}=Re(),{isRunning:a}=Dt(),r=n.some(p=>p.source===o||p.target===o),c=t&&(t.throughput&&t.throughput>.1||t.errorRate&&t.errorRate>.001||t.utilization&&t.utilization>.01),l=w.useMemo(()=>{if(!t)return[];const p=[{label:"Throughput",value:`${Math.round(t.throughput)}`,unit:"ops/s",color:"text-blue-400"},{label:"Latency (avg)",value:`${Math.round(t.latency)}`,unit:"ms",color:"text-yellow-400"}];return t.latencyP50!==void 0&&p.push({label:"Latency (p50)",value:`${Math.round(t.latencyP50)}`,unit:"ms",color:"text-green-400"}),t.latencyP99!==void 0&&p.push({label:"Latency (p99)",value:`${Math.round(t.latencyP99)}`,unit:"ms",color:"text-red-400"}),p.push({label:"Error Rate",value:`${(t.errorRate*100).toFixed(2)}`,unit:"%",color:"text-orange-400"},{label:"Utilization",value:`${Math.round(t.utilization*100)}`,unit:"%",color:"text-purple-400"}),p},[t]);if(!a||!t||!r||!c||l.length===0)return null;const d=e.x+P5/2,h=e.y+O5+I5;return g.jsx("div",{className:"absolute pointer-events-none",style:{left:`${d}px`,top:`${h}px`,transform:"translateX(-50%)",zIndex:10},children:g.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-2 shadow-lg min-w-max",children:g.jsx("div",{className:"text-xs space-y-1",children:l.map(p=>g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("span",{className:"text-slate-400",children:[p.label,":"]}),g.jsxs("span",{className:`font-mono font-semibold ${p.color}`,children:[p.value," ",p.unit]})]},p.label))})})})}function H5({isVisible:o=!0}){return o?g.jsx("div",{className:"absolute bottom-4 right-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-muted-foreground",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-green-500/20 border border-green-500/30"}),g.jsx("span",{children:"<20%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500/20 border border-yellow-500/30"}),g.jsx("span",{children:"20-40%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-orange-500/20 border border-orange-500/30"}),g.jsx("span",{children:"40-60%"})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("div",{className:"w-3 h-3 rounded bg-red-500/20 border border-red-500/30"}),g.jsx("span",{children:">60%"})]})]})}):null}function B5({isVisible:o=!0}){const{nodes:e,connections:t,zoom:n,pan:a}=Re(),{isRunning:r}=Dt(),c=Et.useMemo(()=>{if(e.length===0)return{minX:0,minY:0,maxX:2e3,maxY:2e3};const k=e.map(H=>H.position.x),T=e.map(H=>H.position.y),A=Math.min(...k)-200,N=Math.min(...T)-200,q=Math.max(...k)+200,O=Math.max(...T)+200;return{minX:A,minY:N,maxX:q,maxY:O}},[e]),l=c.maxX-c.minX,d=c.maxY-c.minY,h=120,p=80,m=h/Math.max(l,1e3),y=p/Math.max(d,1e3),b=Math.min(m,y),S=window.innerWidth/n*b,C=window.innerHeight/n*b,E=(-a.x/n-c.minX)*b,M=(-a.y/n-c.minY)*b;return o?g.jsx("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm border border-border rounded-md p-2 z-10 pointer-events-none",children:g.jsxs("svg",{width:h,height:p,className:"border border-border/50 rounded",style:{background:"hsl(var(--background))"},children:[t.map(k=>{const T=e.find(J=>J.id===k.source),A=e.find(J=>J.id===k.target);if(!T||!A)return null;const N=(T.position.x-c.minX)*b,q=(T.position.y-c.minY)*b,O=(A.position.x-c.minX)*b,H=(A.position.y-c.minY)*b;return g.jsx("line",{x1:N,y1:q,x2:O,y2:H,stroke:"hsl(var(--border))",strokeWidth:.3,opacity:.2},k.id)}),e.map(k=>g.jsx("circle",{cx:(k.position.x-c.minX)*b,cy:(k.position.y-c.minY)*b,r:1.5,fill:"hsl(var(--muted-foreground))",opacity:.5},k.id)),g.jsx("rect",{x:E,y:M,width:S,height:C,fill:"hsl(var(--primary))",fillOpacity:.2,stroke:"hsl(var(--primary))",strokeWidth:1.5,strokeDasharray:"2 2"})]})}):null}function $5({x:o,y:e,onDelete:t,onRename:n,onCopyId:a,onClose:r}){const c=w.useRef(null),[l,d]=w.useState({x:o,y:e});return w.useEffect(()=>{if(c.current){const h=c.current.getBoundingClientRect(),p=window.innerWidth,m=window.innerHeight;let y=o,b=e;o+h.width>p&&(y=p-h.width-10),e+h.height>m&&(b=m-h.height-10),y=Math.max(10,y),b=Math.max(10,b),d({x:y,y:b})}},[o,e]),w.useEffect(()=>{const h=m=>{c.current&&!c.current.contains(m.target)&&r()},p=m=>{m.key==="Escape"&&r()};return document.addEventListener("mousedown",h),document.addEventListener("keydown",p),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("keydown",p)}},[r]),g.jsxs("div",{ref:c,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[120px]",style:{left:`${l.x}px`,top:`${l.y}px`},children:[g.jsxs("button",{onClick:()=>{n(),r()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(HA,{className:"w-3.5 h-3.5"}),"Rename"]}),g.jsxs("button",{onClick:()=>{a(),r()},className:"w-full px-2 py-1 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(cb,{className:"w-3.5 h-3.5"}),"Copy ID"]}),g.jsx("div",{className:"border-t border-border my-0.5"}),g.jsxs("button",{onClick:()=>{t(),r()},className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Hh,{className:"w-3.5 h-3.5"}),"Delete"]})]})}const U5=140,Q5=100;function F5(o,e,t){const n=t(o);if(!n)return{width:U5,height:Q5};const c=(n.querySelector(".bg-card")||n).getBoundingClientRect();return{width:c.width/e,height:c.height/e}}function G5(o,e){const{getNodeRef:t}=Cu(),{observe:n}=U1(),[a,r]=w.useState({}),c=w.useCallback(()=>{const l={};o.forEach(d=>{const h=F5(d,e,t);h&&(l[d]=h)}),r(d=>({...d,...l}))},[o,e,t]);return w.useEffect(()=>{if(o.length===0)return;c();const l=[];return o.forEach(d=>{const h=t(d);if(h){const m=h.querySelector(".bg-card")||h;if(m){const y=n(m,c);l.push(y)}}}),()=>{l.forEach(d=>d())}},[o,e,c,t,n]),a}const ah=20,V5=140,K5=100,Y5=18,W5=6,X5=Y5+W5*2;function Z5(o,e,t,n){return w.useMemo(()=>{const a=e.filter(y=>o.nodeIds.includes(y.id));if(a.length===0)return null;const r=ah,c=ah,l=o.showName!==!1?X5:ah;let d=1/0,h=1/0,p=-1/0,m=-1/0;return a.forEach(y=>{const b=t[y.id]||{width:V5,height:K5},S=y.position.x,C=y.position.y,E=S+b.width,M=C+b.height;d=Math.min(d,S),h=Math.min(h,C),p=Math.max(p,E),m=Math.max(m,M)}),{x:d-r,y:h-l,width:p-d+r*2,height:m-h+l+c}},[e,o.nodeIds,t,n,o.showName])}function J5(o,e){const{nodes:t,updateNodes:n}=Re(),[a,r]=w.useState(!1),c=w.useRef({x:0,y:0}),l=w.useRef({}),d=w.useCallback(h=>{if(h.button!==0||h.target.closest("[data-node-id]"))return;h.stopPropagation();const y=Re.getState();y.selectGroup(o.id),r(!0),c.current.x=h.clientX,c.current.y=h.clientY,y.setGroupDragging(!0);const b=t.filter(S=>o.nodeIds.includes(S.id));l.current={},b.forEach(S=>{l.current[S.id]={...S.position}})},[o.id,o.nodeIds,t]);return w.useEffect(()=>{if(!a)return;let h=null,p=null,m=!0;const y=S=>{if(!m)return;const C=(S.clientX-c.current.x)/e,E=(S.clientY-c.current.y)/e;p={dx:C,dy:E},h===null&&(h=requestAnimationFrame(()=>{if(!m||!p){h=null,p=null;return}const{dx:M,dy:k}=p,T=Re.getState(),A=o.nodeIds.map(N=>{const q=l.current[N];return q?{id:N,updates:{position:{x:q.x+M,y:q.y+k}}}:null}).filter(N=>N!==null);A.length>0&&T.updateNodes(A,!0),h=null,p=null}))},b=S=>{if(S&&S.button!==0)return;m=!1,h!==null&&(cancelAnimationFrame(h),h=null);const C=Re.getState();if(p){const{dx:E,dy:M}=p,k=o.nodeIds.map(T=>{const A=l.current[T];return A?{id:T,updates:{position:{x:A.x+E,y:A.y+M}}}:null}).filter(T=>T!==null);if(C.setGroupDragging(!1),k.length>0){C.updateNodes(k,!0);const T=Re.getState();ht(T,T.diagramName)}}else C.setGroupDragging(!1);p=null,r(!1)};return document.addEventListener("mousemove",y,{passive:!0}),document.addEventListener("mouseup",b,{capture:!0}),()=>{m=!1,h!==null&&cancelAnimationFrame(h),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b,{capture:!0}),Re.getState().setGroupDragging(!1)}},[a,o.nodeIds,e]),{isDragging:a,handleMouseDown:d}}const kv=18,gl=6;function eP({group:o,zoom:e}){const{nodes:t,selectedGroupId:n,selectGroup:a,deleteGroup:r,updateGroup:c}=Re(),[l,d]=w.useState(null),[h,p]=w.useState(!1),[m,y]=w.useState(!1),b=G5(o.nodeIds,e),S=Z5(o,t,b,e),{handleMouseDown:C}=J5(o,e);if(!S)return null;const E=n===o.id,M=o.color||"hsl(var(--primary))",k=H=>{H.preventDefault(),H.stopPropagation(),a(o.id),d({x:H.clientX,y:H.clientY})},T=()=>{p(!0)},A=()=>{r(o.id),Ye.success("Group deleted"),p(!1)},N=()=>{y(!0)},q=H=>{c(o.id,{name:H}),Ye.success("Group renamed"),y(!1)},O=()=>{navigator.clipboard.writeText(o.id),Ye.success("Group ID copied to clipboard")};return g.jsxs(g.Fragment,{children:[g.jsxs("g",{children:[g.jsx("rect",{x:S.x,y:S.y,width:S.width,height:S.height,fill:M,fillOpacity:E?.1:.05,stroke:M,strokeWidth:E?3/e:2/e,strokeDasharray:E?"0":"5,5",rx:8/e,ry:8/e,style:{cursor:"pointer",transition:"all 0.2s"},onMouseDown:C,onContextMenu:k}),o.showName!==!1&&g.jsxs("g",{onClick:H=>{H.stopPropagation(),a(o.id)},onContextMenu:k,style:{cursor:"pointer"},children:[g.jsx("rect",{x:S.x+gl,y:S.y+gl,width:Math.max(80,o.name.length*6.5+16),height:kv,fill:M,fillOpacity:.85,rx:3,ry:3,stroke:M,strokeWidth:.5}),g.jsx("text",{x:S.x+gl+8,y:S.y+gl+kv/2,fill:"white",fontSize:11,fontWeight:"600",dominantBaseline:"middle",style:{pointerEvents:"none",userSelect:"none"},children:o.name})]})]}),l&&g.jsx($5,{x:l.x,y:l.y,onDelete:T,onRename:N,onCopyId:O,onClose:()=>d(null)}),g.jsx(q1,{open:h,groupName:o.name,onConfirm:A,onCancel:()=>p(!1)}),g.jsx(ip,{open:m,initialName:o.name,onConfirm:q,onCancel:()=>y(!1)})]})}const tP=w.memo(eP,(o,e)=>!(o.group.id!==e.group.id||o.group.name!==e.group.name||o.group.color!==e.group.color||o.group.nodeIds.length!==e.group.nodeIds.length||o.group.nodeIds.some((t,n)=>t!==e.group.nodeIds[n])||o.zoom!==e.zoom));function nP({isVisible:o,canvasRef:e}){const{zoom:t,pan:n}=Re(),[a,r]=w.useState(null),c=w.useRef(null);if(w.useEffect(()=>{if(!o){r(null);return}const N=()=>{if(e?.current)r(e.current.getBoundingClientRect());else if(c.current?.parentElement){const se=c.current.parentElement.getBoundingClientRect(),ce=24;r({...se,width:se.width-ce,height:se.height-ce,left:se.left+ce,top:se.top+ce})}},q=setTimeout(N,10),O=requestAnimationFrame(N),H=requestAnimationFrame(()=>{requestAnimationFrame(N)});return window.addEventListener("resize",N),()=>{clearTimeout(q),cancelAnimationFrame(O),cancelAnimationFrame(H),window.removeEventListener("resize",N)}},[o,e]),w.useEffect(()=>{if(!o)return;const q=requestAnimationFrame(()=>{e?.current&&r(e.current.getBoundingClientRect())});return()=>cancelAnimationFrame(q)},[t,n,o,e]),!o)return null;if(!a)return g.jsx("div",{ref:c,className:"absolute inset-0 pointer-events-none z-20"});const l=20,d=l*t;let h=1;d<10?h=10:d<20?h=5:d<40&&(h=2);const p=l*h,m=24,y=24,b=a.width,S=a.height,C=Math.floor(-n.x/t/p)*p,E=Math.floor(-n.y/t/p)*p,M=C+b/t+p*2,k=E+S/t+p*2,T=[];for(let N=C;N<=M;N+=p)T.push(N);const A=[];for(let N=E;N<=k;N+=p)A.push(N);return g.jsxs("div",{ref:c,className:"absolute inset-0 pointer-events-none z-20",children:[g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-border pointer-events-none",style:{top:0,left:`${m}px`,right:0,height:`${y}px`,transform:`translate(${n.x}px, 0) scale(${t})`,transformOrigin:"0 0"},children:T.map(N=>g.jsx("div",{className:"absolute top-0 bottom-0 border-l border-border/60",style:{left:`${N}px`,width:"1px"},children:g.jsx("span",{className:"absolute top-0.5 left-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/t})`,transformOrigin:"0 0"},children:N})},`h-${N}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-r border-border pointer-events-none",style:{top:`${y}px`,left:0,bottom:0,width:`${m}px`,transform:`translate(0, ${n.y}px) scale(${t})`,transformOrigin:"0 0"},children:A.map(N=>g.jsx("div",{className:"absolute left-0 right-0 border-t border-border/60",style:{top:`${N}px`,height:"1px"},children:g.jsx("span",{className:"absolute left-0.5 top-1 text-[10px] text-muted-foreground font-mono whitespace-nowrap",style:{transform:`scale(${1/t})`,transformOrigin:"0 0"},children:N})},`v-${N}`))}),g.jsx("div",{className:"absolute bg-card/90 backdrop-blur-sm border-b border-r border-border pointer-events-none",style:{top:0,left:0,width:`${m}px`,height:`${y}px`}})]})}function sP({x:o,y:e,onDelete:t,onDuplicate:n,onCopyId:a,onBringToFront:r,onSendToBack:c,onBringForward:l,onSendBackward:d,onAddToGroup:h,onRemoveFromGroup:p,onClose:m}){const y=w.useRef(null);w.useEffect(()=>{const q=H=>{y.current&&!y.current.contains(H.target)&&m()},O=H=>{H.key==="Escape"&&m()};return document.addEventListener("mousedown",q),document.addEventListener("keydown",O),()=>{document.removeEventListener("mousedown",q),document.removeEventListener("keydown",O)}},[m]);const b=()=>{t(),m()},S=()=>{n(),m()},C=()=>{a(),m()},E=()=>{r?.(),m()},M=()=>{c?.(),m()},k=()=>{l?.(),m()},T=()=>{d?.(),m()},A=()=>{h?.(),m()},N=()=>{p?.(),m()};return g.jsxs("div",{ref:y,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-0.5 min-w-[140px]",style:{left:`${o}px`,top:`${e}px`},children:[g.jsxs("button",{onClick:S,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(lb,{className:"w-3.5 h-3.5"}),"Duplicate"]}),g.jsxs("button",{onClick:C,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(cb,{className:"w-3.5 h-3.5"}),"Copy ID"]}),(h||p)&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"border-t border-border my-0.5"}),p&&g.jsxs("button",{onClick:N,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(nA,{className:"w-3.5 h-3.5"}),"Remove from Group"]}),h&&g.jsxs("button",{onClick:A,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(ch,{className:"w-3.5 h-3.5"}),"Add to Group"]})]}),g.jsx("div",{className:"border-t border-border my-0.5"}),(r||c||l||d)&&g.jsxs(g.Fragment,{children:[g.jsxs("button",{onClick:E,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Ok,{className:"w-3.5 h-3.5"}),"Bring to Front"]}),g.jsxs("button",{onClick:M,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(jk,{className:"w-3.5 h-3.5"}),"Send to Back"]}),g.jsxs("button",{onClick:k,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(rb,{className:"w-3.5 h-3.5"}),"Bring Forward"]}),g.jsxs("button",{onClick:T,className:"w-full px-2 py-1.5 text-xs text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Bl,{className:"w-3.5 h-3.5"}),"Send Backward"]}),g.jsx("div",{className:"border-t border-border my-0.5"})]}),g.jsxs("button",{onClick:b,className:"w-full px-2.5 py-1.5 text-xs text-destructive hover:bg-destructive hover:text-destructive-foreground flex items-center gap-1.5 transition-colors",children:[g.jsx(Hh,{className:"w-3.5 h-3.5"}),"Delete"]})]})}function aP({nodeId:o,x:e,y:t,onClose:n}){const a=w.useRef(null),{groups:r,addNodeToGroup:c}=Re();return w.useEffect(()=>{const l=h=>{a.current&&!a.current.contains(h.target)&&n()},d=h=>{h.key==="Escape"&&n()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",d)}},[n]),g.jsxs("div",{ref:a,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${e}px`,top:`${t}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Add to Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:(()=>{const l=r.filter(d=>!d.nodeIds.includes(o));return l.length>0?l.map(d=>g.jsxs("button",{onClick:()=>{c(d.id,o),Ye.success(`Added to "${d.name}"`),n()},className:"w-full px-2 py-1.5 text-xs text-left text-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:d.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:d.name})]},d.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:r.length===0?"No groups available":"Already in all groups"})})()}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:n,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function iP({nodeId:o,x:e,y:t,onClose:n}){const a=w.useRef(null),{groups:r,removeNodeFromGroup:c}=Re(),l=r.filter(d=>d.nodeIds.includes(o));return w.useEffect(()=>{const d=p=>{a.current&&!a.current.contains(p.target)&&n()},h=p=>{p.key==="Escape"&&n()};return document.addEventListener("mousedown",d),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",h)}},[n]),g.jsxs("div",{ref:a,className:"fixed bg-popover border border-border rounded-md shadow-lg z-50 py-1 min-w-[180px]",style:{left:`${e}px`,top:`${t}px`},children:[g.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground border-b border-border",children:"Remove from Group"}),g.jsx("div",{className:"max-h-60 overflow-y-auto",children:l.length>0?l.map(d=>g.jsxs("button",{onClick:()=>{c(d.id,o),Ye.success(`Removed from "${d.name}"`),n()},className:"w-full px-2 py-1.5 text-xs text-left text-destructive hover:bg-destructive/10 hover:text-destructive flex items-center gap-2 transition-colors",children:[g.jsx("div",{className:"w-3 h-3 rounded border border-border flex-shrink-0",style:{backgroundColor:d.color||"hsl(var(--primary))"}}),g.jsx("span",{className:"truncate flex-1",children:d.name})]},d.id)):g.jsx("div",{className:"px-2 py-4 text-xs text-muted-foreground text-center",children:"Not in any groups"})}),g.jsx("div",{className:"border-t border-border mt-1",children:g.jsx("button",{onClick:n,className:"w-full px-2 py-1.5 text-xs text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors",children:"Cancel"})})]})}function oP({x:o,y:e,onDelete:t,onClose:n}){const a=w.useRef(null),[r,c]=w.useState({x:o,y:e});return w.useEffect(()=>{if(a.current){const l=a.current.getBoundingClientRect(),d=window.innerWidth,h=window.innerHeight;let p=o,m=e;o+l.width>d&&(p=d-l.width-8),e+l.height>h&&(m=h-l.height-8),p=Math.max(8,p),m=Math.max(8,m),c({x:p,y:m})}},[o,e]),w.useEffect(()=>{const l=h=>{a.current&&!a.current.contains(h.target)&&n()},d=h=>{h.key==="Escape"&&n()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",d)}},[n]),g.jsx("div",{ref:a,className:"fixed bg-card border border-border rounded-md shadow-lg z-50",style:{left:`${r.x}px`,top:`${r.y}px`},children:g.jsx("button",{className:"w-full px-3 py-2 text-sm text-left hover:bg-accent transition-colors first:rounded-t-md last:rounded-b-md",onClick:t,children:"Delete"})})}function Av(){const o=w.useRef(null),{nodes:e,connections:t,groups:n=[],addNode:a,addConnection:r,deleteConnection:c,zoom:l,pan:d,setPan:h,setZoom:p,selectNode:m,selectConnection:y,selectGroup:b,selectNodesByIds:S,selectedConnectionId:C,selectedNodeId:E,setViewportSize:M,deleteNode:k,updateNode:T,bringToFront:A,sendToBack:N,bringForward:q,sendBackward:O,canvasBounds:H,canvasChunks:J,addNodeToGroup:se,removeNodeFromGroup:ce}=Re(),{isRunning:Z}=Dt(),{showMinimap:te,showHeatMapLegend:le,showRuler:ue}=zr(),{getNodeRef:L}=Cu(),[_,P]=w.useState(!1),[W,he]=w.useState({x:0,y:0}),[j,Q]=w.useState(!1),[Y,ae]=w.useState(null),[U,ie]=w.useState(void 0),[$,V]=w.useState(null),[pe,me]=w.useState(null),[ye,ve]=w.useState(null),[Le,$e]=w.useState(null),[at,Ze]=w.useState(null),[Nt,de]=w.useState(null),[Be,Ue]=w.useState(null);w.useEffect(()=>{if(!o.current)return;const ee=()=>{if(!o.current)return;const be=o.current.getBoundingClientRect();M({width:be.width,height:be.height})};ee();const fe=new ResizeObserver(()=>{ee()});return fe.observe(o.current),window.addEventListener("resize",ee),()=>{fe.disconnect(),window.removeEventListener("resize",ee)}},[M]),w.useEffect(()=>{const ee=fe=>{if((fe.ctrlKey||fe.metaKey)&&o.current){const be=o.current.getBoundingClientRect();fe.clientX>=be.left&&fe.clientX<=be.right&&fe.clientY>=be.top&&fe.clientY<=be.bottom&&fe.preventDefault()}};return document.addEventListener("wheel",ee,{passive:!1,capture:!0}),()=>{document.removeEventListener("wheel",ee,{capture:!0})}},[]);const yt=ee=>{if(ee.preventDefault(),!o.current)return;const fe=ee.dataTransfer.getData("application/json");if(!fe)return;const be=JSON.parse(fe),ze=o.current.getBoundingClientRect(),Oe=(ee.clientX-ze.left-d.x)/l,ct=(ee.clientY-ze.top-d.y)/l,Lt={id:`node-${Date.now()}`,type:be.type,position:{x:Oe,y:ct},data:{label:be.label}};a(Lt)},pt=ee=>{ee.preventDefault(),ee.dataTransfer.dropEffect="copy"},qt=ee=>{const fe=ee.button===0;if(ee.button===1||fe&&ee.ctrlKey){P(!0),he({x:ee.clientX-d.x,y:ee.clientY-d.y}),ee.preventDefault();return}if(fe&&!j&&!ee.ctrlKey&&!ee.metaKey){if(o.current){const ze=o.current.getBoundingClientRect(),Oe=(ee.clientX-ze.left-d.x)/l,ct=(ee.clientY-ze.top-d.y)/l;$e({x:Oe,y:ct}),Ze({x:Oe,y:ct,width:0,height:0})}m(null),y(null),b(null)}},Je=ee=>{if(_)h({x:ee.clientX-W.x,y:ee.clientY-W.y});else if(j&&o.current){const fe=o.current.getBoundingClientRect();V({x:(ee.clientX-fe.left-d.x)/l,y:(ee.clientY-fe.top-d.y)/l})}else if(Le&&o.current){const fe=o.current.getBoundingClientRect(),be=(ee.clientX-fe.left-d.x)/l,ze=(ee.clientY-fe.top-d.y)/l,Oe=Math.min(Le.x,be),ct=Math.min(Le.y,ze),Lt=Math.abs(be-Le.x),Xt=Math.abs(ze-Le.y),Rt={x:Oe,y:ct,width:Lt,height:Xt};Ze(Rt);const cn=e.filter(wt=>{const it=wt.position.x,mt=wt.position.y,Ht=wt.position.x+140,rs=wt.position.y+140;return Ht>=Rt.x&&it<=Rt.x+Rt.width&&rs>=Rt.y&&mt<=Rt.y+Rt.height}).map(wt=>wt.id);S(cn)}},_t=()=>{P(!1),j&&(Q(!1),ae(null),V(null)),Le&&($e(null),Ze(null))},vt=w.useCallback((ee,fe)=>{Q(!0),ae(ee),ie(fe)},[]),gt=w.useCallback(ee=>{const fe=L(ee);if(!fe)return{width:140,height:100};const Oe=(fe.querySelector(".bg-card")||fe).getBoundingClientRect();return{width:Oe.width/l,height:Oe.height/l}},[L,l]),Yt=w.useCallback((ee,fe)=>{if(j&&Y&&Y!==ee){const be=e.find(Oe=>Oe.id===Y),ze=e.find(Oe=>Oe.id===ee);if(be&&ze){const Oe=gt(Y),ct=gt(ee),Lt=$?.x??ze.position.x+ct.width/2,Xt=$?.y??ze.position.y+ct.height/2,Rt=be.position.x+Oe.width/2,cn=be.position.y+Oe.height/2,wt=U!==void 0?U:Tv(Y,ee,Lt,Xt,t,be.position.x,be.position.y,Oe.width,Oe.height),it=fe!==void 0?fe:Tv(ee,Y,Rt,cn,t,ze.position.x,ze.position.y,ct.width,ct.height),mt={id:`conn-${Date.now()}`,source:Y,target:ee,type:"async",sourcePort:wt,targetPort:it};r(mt)}}Q(!1),ae(null),ie(void 0),V(null)},[j,Y,U,e,t,r,$,gt]),Ft=w.useCallback(ee=>{y(ee)},[y]),Rs=w.useCallback((ee,fe,be)=>{me({connectionId:ee,x:fe,y:be})},[]),Yn=w.useCallback(ee=>{const fe=ee.target,be=fe.closest?.("[data-node-id]"),ze=fe.closest?.("[data-connection-id]"),Oe=fe instanceof SVGElement,ct=fe.closest?.("svg")!==null;if(be||ze||Oe||ct)return;const Lt=e.filter(Xt=>Xt.selected);Lt.length>0&&(ee.preventDefault(),ee.stopPropagation(),ve({nodeId:Lt[0].id,x:ee.clientX,y:ee.clientY}))},[e]),Dn=w.useCallback(()=>{pe&&(c(pe.connectionId),me(null))},[pe,c]),os=w.useMemo(()=>e.map(ee=>ee.id).join(","),[e]),Wt=w.useMemo(()=>{const ee=new Map;return e.forEach(fe=>{const be=fe.id;ee.set(be,{onConnectionStart:ze=>vt(be,ze),onConnectionEnd:ze=>Yt(be,ze),onContextMenu:(ze,Oe)=>ve({nodeId:be,x:ze,y:Oe})})}),ee},[os,vt,Yt,e]),Gt=w.useMemo(()=>t.map(ee=>ee.id).join(","),[t]),jt=w.useMemo(()=>{const ee=new Map;return t.forEach(fe=>{const be=fe.id;ee.set(be,{onClick:()=>Ft(be),onContextMenu:ze=>Rs(be,ze.clientX,ze.clientY)})}),ee},[Gt,Ft,Rs,t]),$a=ee=>{if(ee.ctrlKey&&o.current){ee.preventDefault();const{left:fe,top:be,width:ze,height:Oe}=o.current.getBoundingClientRect(),ct=ee.clientX-fe,Lt=ee.clientY-be,Xt=(ct-d.x)/l,Rt=(Lt-d.y)/l,cn=1+Math.min(Math.max(-ee.deltaY/500,-.5),.5);let wt=l*cn;wt=Math.min(Math.max(wt,.3),2.5);const it=ct-Xt*wt,mt=Lt-Rt*wt;p(wt),h({x:it,y:mt})}},Nn=20,Fr=ue?24:0,Ts=2e3,Ua=l<.5,ia=Re(ee=>ee.viewportWidth),Wn=Re(ee=>ee.viewportHeight),ks=w.useMemo(()=>{if(ia===0||Wn===0)return e;const ee=-d.x/l,fe=-d.y/l,be=(ia-d.x)/l,ze=(Wn-d.y)/l,Oe=200,ct=ee-Oe,Lt=fe-Oe,Xt=be+Oe,Rt=ze+Oe;return e.filter(cn=>{const wt=cn.position.x,it=cn.position.y;return wt+140>=ct&&wt<=Xt&&it+100>=Lt&&it<=Rt})},[e,l,d,ia,Wn]),As=w.useMemo(()=>new Set(ks.map(ee=>ee.id)),[ks]),Mu=w.useMemo(()=>t.filter(ee=>As.has(ee.source)&&As.has(ee.target)),[t,As]);return g.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[g.jsx(nP,{isVisible:ue,canvasRef:o}),g.jsx("div",{ref:o,className:"absolute overflow-hidden",style:{top:`${Fr}px`,left:`${Fr}px`,right:0,bottom:0,cursor:_?"grabbing":j?"crosshair":"default",backgroundColor:"hsl(var(--muted) / 0.1)"},onDrop:yt,onDragOver:pt,onMouseDown:qt,onMouseMove:Je,onMouseUp:_t,onMouseLeave:_t,onWheel:$a,onContextMenu:Yn,children:g.jsxs("div",{style:{transform:`translate(${d.x}px, ${d.y}px) scale(${l})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[J.map(ee=>{const fe=ee.x*Ts,be=ee.y*Ts,ze=J.some(it=>it.x===ee.x+1&&it.y===ee.y),Oe=J.some(it=>it.x===ee.x&&it.y===ee.y+1),ct=d.x/l,Lt=d.y/l,Xt=(-ct%Nn+Nn)%Nn,Rt=(-Lt%Nn+Nn)%Nn,cn=fe%Nn,wt=be%Nn;return g.jsxs("div",{className:"absolute pointer-events-none",style:{left:`${fe}px`,top:`${be}px`,width:`${Ts}px`,height:`${Ts}px`,backgroundColor:"hsl(var(--canvas-bg))",backgroundImage:`
                  linear-gradient(hsl(var(--canvas-grid)) 1px, transparent 1px),
                  linear-gradient(90deg, hsl(var(--canvas-grid)) 1px, transparent 1px)
                `,backgroundSize:`${Nn}px ${Nn}px`,backgroundPosition:`${Xt+cn}px ${Rt+wt}px`,border:Ua?"2px dashed hsl(var(--border) / 0.6)":"none",boxShadow:Ua?"inset 0 0 0 1px hsl(var(--border) / 0.3)":"none"},children:[ze&&g.jsx("div",{className:"absolute top-0 bottom-0 pointer-events-none z-10",style:{right:0,width:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}}),Oe&&g.jsx("div",{className:"absolute left-0 right-0 pointer-events-none z-10",style:{bottom:0,height:"1px",backgroundColor:"hsl(var(--border) / 0.5)"}})]},`chunk-${ee.x}-${ee.y}`)}),at&&g.jsx("div",{className:"absolute border-2 border-primary/60 bg-primary/10 pointer-events-none",style:{left:at.x,top:at.y,width:at.width,height:at.height}}),g.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"visible"},children:[g.jsxs("defs",{children:[g.jsx("marker",{id:"arrowhead-default",markerWidth:"8",markerHeight:"8",refX:"7",refY:"4",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,8 L8,4 z",fill:"hsl(var(--border))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-selected",markerWidth:"10",markerHeight:"10",refX:"8",refY:"5",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,10 L10,5 z",fill:"hsl(var(--primary))",stroke:"none"})}),g.jsx("marker",{id:"arrowhead-bottleneck",markerWidth:"12",markerHeight:"12",refX:"10",refY:"6",orient:"auto",markerUnits:"userSpaceOnUse",children:g.jsx("path",{d:"M0,0 L0,12 L12,6 z",fill:"hsl(0 84% 60%)",stroke:"none"})})]}),n&&n.length>0&&g.jsx("g",{style:{pointerEvents:"auto"},children:n.map(ee=>g.jsx(tP,{group:ee,zoom:l},ee.id))}),g.jsxs("g",{style:{pointerEvents:"auto"},children:[Mu.map(ee=>{const fe=e.find(Oe=>Oe.id===ee.source),be=e.find(Oe=>Oe.id===ee.target);if(!fe||!be)return null;const ze=jt.get(ee.id);return ze?g.jsx(z5,{connection:ee,sourceNode:fe,targetNode:be,zoom:l,pan:d,isSelected:C===ee.id,onClick:ze.onClick,onContextMenu:ze.onContextMenu},ee.id):null}),j&&Y&&$&&(()=>{const ee=e.find(Oe=>Oe.id===Y);if(!ee)return null;const fe=gt(Y);let be,ze;if(U!==void 0){const ct=bo(ee.position.x,ee.position.y,fe.width,fe.height,16)[U];be=ct.x,ze=ct.y}else be=ee.position.x+fe.width/2,ze=ee.position.y+fe.height/2;return g.jsx("line",{x1:be,y1:ze,x2:$.x,y2:$.y,stroke:"hsl(var(--primary))",strokeWidth:2/l,strokeDasharray:"5,5",style:{pointerEvents:"none"}})})()]})]}),ks.map(ee=>{const fe=Wt.get(ee.id);return fe?g.jsx(D5,{node:ee,onConnectionStart:fe.onConnectionStart,onConnectionEnd:fe.onConnectionEnd,isConnecting:j,onContextMenu:fe.onContextMenu},ee.id):null}),Z&&ks.map(ee=>g.jsx(q5,{nodeId:ee.id,position:ee.position},`metrics-${ee.id}`))]})}),g.jsx(H5,{isVisible:le}),g.jsx(B5,{isVisible:te}),g.jsx(N5,{selectedNodeId:E,highlightPath:!0}),pe&&g.jsx(oP,{x:pe.x,y:pe.y,onDelete:Dn,onClose:()=>me(null)}),ye&&(()=>{const ee=e.find(Qe=>Qe.id===ye.nodeId);if(!ee)return null;const fe=e.filter(Qe=>Qe.selected),be=fe.length>1,ze=()=>{be?(fe.forEach(Qe=>{k(Qe.id)}),Ye.success(`${fe.length} elements deleted`)):(k(ee.id),Ye.success("Element deleted")),ve(null)},Oe=()=>{if(be)fe.forEach((Qe,_n)=>{const Qa={...pl(Qe),id:`${Qe.type}_${Date.now()}_${_n}`,position:{x:Qe.position.x+20+_n*10,y:Qe.position.y+20+_n*10},selected:!1};Qa.data?.config&&(Qa.data.config=pl(Qa.data.config)),a(Qa)}),Ye.success(`${fe.length} elements duplicated`);else{const Qe={...pl(ee),id:`${ee.type}_${Date.now()}`,position:{x:ee.position.x+20,y:ee.position.y+20},selected:!1};Qe.data?.config&&(Qe.data.config=pl(Qe.data.config)),a(Qe),Ye.success("Element duplicated")}ve(null)},ct=()=>{if(be){const Qe=fe.map(_n=>_n.id).join(", ");navigator.clipboard.writeText(Qe),Ye.success(`${fe.length} IDs copied to clipboard`)}else navigator.clipboard.writeText(ee.id),Ye.success("ID copied to clipboard");ve(null)},Lt=()=>{be?(fe.forEach(Qe=>{A(Qe.id)}),Ye.success(`${fe.length} elements brought to front`)):(A(ee.id),Ye.success("Brought to front")),ve(null)},Xt=()=>{be?(fe.forEach(Qe=>{N(Qe.id)}),Ye.success(`${fe.length} elements sent to back`)):(N(ee.id),Ye.success("Sent to back")),ve(null)},Rt=()=>{be?(fe.forEach(Qe=>{q(Qe.id)}),Ye.success(`${fe.length} elements brought forward`)):(q(ee.id),Ye.success("Brought forward")),ve(null)},cn=()=>{be?(fe.forEach(Qe=>{O(Qe.id)}),Ye.success(`${fe.length} elements sent backward`)):(O(ee.id),Ye.success("Sent backward")),ve(null)},wt=()=>{de(be?{nodeId:fe[0].id,x:ye.x,y:ye.y}:{nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)},it=be?n.filter(Qe=>fe.some(_n=>Qe.nodeIds.includes(_n.id))):n.filter(Qe=>Qe.nodeIds.includes(ee.id)),mt=it.length>=1,Ht=it.length>=2,rs=()=>{if(be){let Qe=0;fe.forEach(_n=>{n.filter(xi=>xi.nodeIds.includes(_n.id)).forEach(xi=>{ce(xi.id,_n.id),Qe++})}),Qe>0&&Ye.success(`Removed ${fe.length} elements from groups`),ve(null)}else Ht?(Ue({nodeId:ee.id,x:ye.x,y:ye.y}),ve(null)):it.length===1&&(ce(it[0].id,ee.id),Ye.success(`Removed from "${it[0].name}"`),ve(null))};return g.jsx(sP,{x:ye.x,y:ye.y,onDelete:ze,onDuplicate:Oe,onCopyId:ct,onBringToFront:Lt,onSendToBack:Xt,onBringForward:Rt,onSendBackward:cn,onAddToGroup:wt,onRemoveFromGroup:mt?rs:void 0,onClose:()=>ve(null)})})(),Nt&&g.jsx(aP,{nodeId:Nt.nodeId,x:Nt.x,y:Nt.y,onClose:()=>de(null)}),Be&&g.jsx(iP,{nodeId:Be.nodeId,x:Be.x,y:Be.y,onClose:()=>Ue(null)})]})}const rP="modulepreload",cP=function(o){return"/"+o},Dv={},Ce=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let d=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");a=d(t.map(h=>{if(h=cP(h),h in Dv)return;Dv[h]=!0;const p=h.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":rP,p||(y.as="script"),y.crossOrigin="",y.href=h,l&&y.setAttribute("nonce",l),document.head.appendChild(y),p)return new Promise((b,S)=>{y.addEventListener("load",b),y.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return a.then(c=>{for(const l of c||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})},lP=w.lazy(()=>Ce(()=>import("./KafkaConfigAdvanced-isnaxvOs.js"),__vite__mapDeps([0,1,2,3,4,5])).then(o=>({default:o.KafkaConfigAdvanced}))),uP=w.lazy(()=>Ce(()=>import("./RabbitMQConfigAdvanced-DtGWFEXq.js"),__vite__mapDeps([6,1,7,8,9,10,11,12,5,3])).then(o=>({default:o.RabbitMQConfigAdvanced}))),dP=w.lazy(()=>Ce(()=>import("./PostgreSQLConfigAdvanced-DOwdsDDQ.js"),__vite__mapDeps([13,2,7,9,8,3,14,4,12])).then(o=>({default:o.PostgreSQLConfigAdvanced}))),fP=w.lazy(()=>Ce(()=>import("./MongoDBConfigAdvanced-CAd03sYS.js"),__vite__mapDeps([15,2,7,9,8,3])).then(o=>({default:o.MongoDBConfigAdvanced}))),hP=w.lazy(()=>Ce(()=>import("./RedisConfigAdvanced-CuCCLh6T.js"),__vite__mapDeps([16,2,9,8,3,12])).then(o=>({default:o.RedisConfigAdvanced}))),pP=w.lazy(()=>Ce(()=>import("./ElasticsearchConfigAdvanced-DK-MQvRS.js"),__vite__mapDeps([17,2,9,18,19,3,5])).then(o=>({default:o.ElasticsearchConfigAdvanced}))),gP=w.lazy(()=>Ce(()=>import("./CassandraConfigAdvanced-BRJJaric.js"),__vite__mapDeps([20,1,2,3,14,19])).then(o=>({default:o.CassandraConfigAdvanced}))),mP=w.lazy(()=>Ce(()=>import("./ClickHouseConfigAdvanced-CrLSrmA1.js"),__vite__mapDeps([21,2,1,7,8,9,22,3,19])).then(o=>({default:o.ClickHouseConfigAdvanced}))),yP=w.lazy(()=>Ce(()=>import("./SnowflakeConfigAdvanced-Gmnrxj9i.js"),__vite__mapDeps([23,2,18,3,12])).then(o=>({default:o.SnowflakeConfigAdvanced}))),vP=w.lazy(()=>Ce(()=>import("./S3DataLakeConfigAdvanced-8acOqtTc.js"),__vite__mapDeps([24,18,12,25])).then(o=>({default:o.S3DataLakeConfigAdvanced}))),bP=w.lazy(()=>Ce(()=>import("./NginxConfigAdvanced-CJBhVKPw.js"),__vite__mapDeps([26,2,27,28,11,5])).then(o=>({default:o.NginxConfigAdvanced}))),xP=w.lazy(()=>Ce(()=>import("./RestApiConfigAdvanced-Bxl25MAh.js"),__vite__mapDeps([29,2,27,19])).then(o=>({default:o.RestApiConfigAdvanced}))),wP=w.lazy(()=>Ce(()=>import("./GRPCConfigAdvanced-d_SKJXtw.js"),__vite__mapDeps([30,2,18,28,31])).then(o=>({default:o.GRPCConfigAdvanced}))),SP=w.lazy(()=>Ce(()=>import("./WebSocketConfigAdvanced-BQTBQVT2.js"),__vite__mapDeps([32,2,18,10,33,31])).then(o=>({default:o.WebSocketConfigAdvanced}))),CP=w.lazy(()=>Ce(()=>import("./GraphQLConfigAdvanced-zQzLkp0_.js"),__vite__mapDeps([34,2,18,3,19,31])).then(o=>({default:o.GraphQLConfigAdvanced}))),MP=w.lazy(()=>Ce(()=>import("./SOAPConfigAdvanced-eRQTfGvb.js"),__vite__mapDeps([35,2,18,28,31])).then(o=>({default:o.SOAPConfigAdvanced}))),EP=w.lazy(()=>Ce(()=>import("./WebhookConfigAdvanced-BFAlpIWE.js"),__vite__mapDeps([36,18,37,33,31,38])).then(o=>({default:o.WebhookConfigAdvanced}))),RP=w.lazy(()=>Ce(()=>import("./DockerK8sConfigAdvanced-Cs5JFj_A.js"),__vite__mapDeps([39,2,1])).then(o=>({default:o.DockerK8sConfigAdvanced}))),TP=w.lazy(()=>Ce(()=>import("./HAProxyConfigAdvanced-BxHp_ZDI.js"),__vite__mapDeps([40,18,41,31,28,5])).then(o=>({default:o.HAProxyConfigAdvanced}))),kP=w.lazy(()=>Ce(()=>import("./TraefikConfigAdvanced-ddiUVNoF.js"),__vite__mapDeps([42,18,43,31,5])).then(o=>({default:o.TraefikConfigAdvanced}))),AP=w.lazy(()=>Ce(()=>import("./EnvoyConfigAdvanced-DXI6I7LP.js"),__vite__mapDeps([44,18,27,28,31])).then(o=>({default:o.EnvoyConfigAdvanced}))),DP=w.lazy(()=>Ce(()=>import("./ActiveMQConfigAdvanced-BfmCbn_A.js"),__vite__mapDeps([45,1,46,18,10,3,4,5,47])).then(o=>({default:o.ActiveMQConfigAdvanced}))),NP=w.lazy(()=>Ce(()=>import("./AWSSQSConfigAdvanced-D8m9pfBc.js"),__vite__mapDeps([48,1,18,49,10,12,5,33])).then(o=>({default:o.AWSSQSConfigAdvanced}))),_P=w.lazy(()=>Ce(()=>import("./AzureServiceBusConfigAdvanced-BI9iEKQG.js"),__vite__mapDeps([50,2,10,12])).then(o=>({default:o.AzureServiceBusConfigAdvanced}))),jP=w.lazy(()=>Ce(()=>import("./GCPPubSubConfigAdvanced-D9Ci542V.js"),__vite__mapDeps([51,2,10,4,12])).then(o=>({default:o.GCPPubSubConfigAdvanced}))),LP=w.lazy(()=>Ce(()=>import("./KongConfigAdvanced-D6KXdhHf.js"),__vite__mapDeps([52,2,9,28,43,4])).then(o=>({default:o.KongConfigAdvanced}))),zP=w.lazy(()=>Ce(()=>import("./ApigeeConfigAdvanced-D3JdsgyO.js"),__vite__mapDeps([53,1,5])).then(o=>({default:o.ApigeeConfigAdvanced}))),PP=w.lazy(()=>Ce(()=>import("./MuleSoftConfigAdvanced-CLA9-Ecj.js"),__vite__mapDeps([54,1,3,31])).then(o=>({default:o.MuleSoftConfigAdvanced}))),OP=w.lazy(()=>Ce(()=>import("./GraphQLGatewayConfigAdvanced-B_cDQ_sQ.js"),__vite__mapDeps([55,31,27])).then(o=>({default:o.GraphQLGatewayConfigAdvanced}))),IP=w.lazy(()=>Ce(()=>import("./BFFServiceConfigAdvanced-CkQ7i7IP.js"),__vite__mapDeps([56,18])).then(o=>({default:o.BFFServiceConfigAdvanced}))),qP=w.lazy(()=>Ce(()=>import("./WebhookRelayConfigAdvanced-CE2Z6sFe.js"),__vite__mapDeps([57,2,46,18,37,33,31,38])).then(o=>({default:o.WebhookRelayConfigAdvanced}))),HP=w.lazy(()=>Ce(()=>import("./PrometheusConfigAdvanced-CdR5dwCe.js"),__vite__mapDeps([58,2,9])).then(o=>({default:o.PrometheusConfigAdvanced}))),BP=w.lazy(()=>Ce(()=>import("./GrafanaConfigAdvanced-n1vN_9R5.js"),__vite__mapDeps([59,22,60,2,3])).then(o=>({default:o.GrafanaConfigAdvanced}))),$P=w.lazy(()=>Ce(()=>import("./LokiConfigAdvanced-DUgGOxO9.js"),__vite__mapDeps([61,2,47])).then(o=>({default:o.LokiConfigAdvanced}))),UP=w.lazy(()=>Ce(()=>import("./JaegerConfigAdvanced-B_HfhaBn.js"),__vite__mapDeps([62,1,63])).then(o=>({default:o.JaegerConfigAdvanced}))),QP=w.lazy(()=>Ce(()=>import("./OpenTelemetryCollectorConfigAdvanced-CnlMUG1m.js"),__vite__mapDeps([64,1,18,11])).then(o=>({default:o.OpenTelemetryCollectorConfigAdvanced}))),FP=w.lazy(()=>Ce(()=>import("./PagerDutyConfigAdvanced-CSwKXF_r.js"),__vite__mapDeps([65,18,4,38])).then(o=>({default:o.PagerDutyConfigAdvanced}))),GP=w.lazy(()=>Ce(()=>import("./KeycloakConfigAdvanced-DV5NpNVM.js"),__vite__mapDeps([66,2,67,5,27,12,4,38,68,69,70])).then(o=>({default:o.KeycloakConfigAdvanced}))),VP=w.lazy(()=>Ce(()=>import("./WAFConfigAdvanced-Ca8DZzEl.js"),__vite__mapDeps([71,67,18,5,27,31])).then(o=>({default:o.WAFConfigAdvanced}))),KP=w.lazy(()=>Ce(()=>import("./SecretsVaultConfigAdvanced-BUwH4clS.js"),__vite__mapDeps([72,67,2,18,12,3,5,68,70,31])).then(o=>({default:o.SecretsVaultConfigAdvanced}))),YP=w.lazy(()=>Ce(()=>import("./IDSIPSConfigAdvanced-Bsm2C3mk.js"),__vite__mapDeps([73,67,18,5,74,31])).then(o=>({default:o.IDSIPSConfigAdvanced}))),WP=w.lazy(()=>Ce(()=>import("./FirewallConfigAdvanced-CF5NNJtl.js"),__vite__mapDeps([75,46,67,18,5,31,74,41])).then(o=>({default:o.FirewallConfigAdvanced}))),XP=w.lazy(()=>Ce(()=>import("./JenkinsConfigAdvanced-C3F_tzKe.js"),__vite__mapDeps([76,1,2,67,63,77,28,4,22,41,60,38])).then(o=>({default:o.JenkinsConfigAdvanced}))),ZP=w.lazy(()=>Ce(()=>import("./GitLabCIConfigAdvanced-DpMpLd3W.js"),__vite__mapDeps([78,1,63,38])).then(o=>({default:o.GitLabCIConfigAdvanced}))),JP=w.lazy(()=>Ce(()=>import("./ArgoCDConfigAdvanced-CJx3D3MI.js"),__vite__mapDeps([79,1,38])).then(o=>({default:o.ArgoCDConfigAdvanced}))),eO=w.lazy(()=>Ce(()=>import("./HarborConfigAdvanced-CZCaD5UU.js"),__vite__mapDeps([80,77,25,4,5])).then(o=>({default:o.HarborConfigAdvanced}))),tO=w.lazy(()=>Ce(()=>import("./TerraformConfigAdvanced-Zn0Lwsoo.js"),__vite__mapDeps([81,2,18,31,49,38])).then(o=>({default:o.TerraformConfigAdvanced}))),nO=w.lazy(()=>Ce(()=>import("./AnsibleConfigAdvanced-BOr5NK_j.js"),__vite__mapDeps([82,18,28,31,38])).then(o=>({default:o.AnsibleConfigAdvanced}))),sO=w.lazy(()=>Ce(()=>import("./IstioConfigAdvanced-CHdCQo96.js"),__vite__mapDeps([83,18,27,43])).then(o=>({default:o.IstioConfigAdvanced}))),aO=w.lazy(()=>Ce(()=>import("./ServiceMeshConfigAdvanced-CzQkBr69.js"),__vite__mapDeps([84,18,28,5])).then(o=>({default:o.ServiceMeshConfigAdvanced}))),iO=w.lazy(()=>Ce(()=>import("./APIGatewayConfigAdvanced-BaVNpRTl.js"),__vite__mapDeps([85,9,18,27,5,41,43])).then(o=>({default:o.APIGatewayConfigAdvanced}))),oO=w.lazy(()=>Ce(()=>import("./VPNConfigAdvanced-Bz2gDeeS.js"),__vite__mapDeps([86,18,4,68,38])).then(o=>({default:o.VPNConfigAdvanced}))),rO=w.lazy(()=>Ce(()=>import("./CDNConfigAdvanced-CS8y_O7c.js"),__vite__mapDeps([87,18,27,41])).then(o=>({default:o.CDNConfigAdvanced}))),cO=w.lazy(()=>Ce(()=>import("./SparkConfigAdvanced-BSt-ZXF2.js"),__vite__mapDeps([88,18,3,31,38])).then(o=>({default:o.SparkConfigAdvanced}))),lO=w.lazy(()=>Ce(()=>import("./TensorFlowServingConfigAdvanced-Y1TFfkiA.js"),__vite__mapDeps([89,2,18,3,31])).then(o=>({default:o.TensorFlowServingConfigAdvanced}))),uO=w.lazy(()=>Ce(()=>import("./PyTorchServeConfigAdvanced-fKGuXN0f.js"),__vite__mapDeps([90,2,18,3,31])).then(o=>({default:o.PyTorchServeConfigAdvanced}))),dO=w.lazy(()=>Ce(()=>import("./FeatureStoreConfigAdvanced-BqHnHOas.js"),__vite__mapDeps([91,18,77,3,41])).then(o=>({default:o.FeatureStoreConfigAdvanced}))),fO=w.lazy(()=>Ce(()=>import("./MLflowConfigAdvanced-DOXEUe3B.js"),__vite__mapDeps([92,77,41])).then(o=>({default:o.MLflowConfigAdvanced}))),hO=w.lazy(()=>Ce(()=>import("./CRMConfigAdvanced-CDYSE5Av.js"),__vite__mapDeps([93,18,4,94,41,95,69])).then(o=>({default:o.CRMConfigAdvanced}))),pO=w.lazy(()=>Ce(()=>import("./ERPConfigAdvanced-DZl2l8B1.js"),__vite__mapDeps([96,18,77,94,41,95])).then(o=>({default:o.ERPConfigAdvanced}))),gO=w.lazy(()=>Ce(()=>import("./RPABotConfigAdvanced-CUkw1t0S.js"),__vite__mapDeps([97,18,41,31,38])).then(o=>({default:o.RPABotConfigAdvanced}))),mO=w.lazy(()=>Ce(()=>import("./BPMNEngineConfigAdvanced-CNN7SvR0.js"),__vite__mapDeps([98,18,31,38,4])).then(o=>({default:o.BPMNEngineConfigAdvanced}))),yO=w.lazy(()=>Ce(()=>import("./PaymentGatewayConfigAdvanced-Bk2cAOM5.js"),__vite__mapDeps([99,18,94,41,5,31,38])).then(o=>({default:o.PaymentGatewayConfigAdvanced}))),vO=()=>g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsx("div",{className:"text-muted-foreground",children:"Loading configuration..."})});function bO({componentId:o,componentType:e}){const t=()=>{switch(e){case"kafka":return g.jsx(lP,{componentId:o});case"rabbitmq":return g.jsx(uP,{componentId:o});case"postgres":return g.jsx(dP,{componentId:o});case"mongodb":return g.jsx(fP,{componentId:o});case"redis":return g.jsx(hP,{componentId:o});case"elasticsearch":return g.jsx(pP,{componentId:o});case"cassandra":return g.jsx(gP,{componentId:o});case"clickhouse":return g.jsx(mP,{componentId:o});case"snowflake":return g.jsx(yP,{componentId:o});case"s3-datalake":return g.jsx(vP,{componentId:o});case"nginx":return g.jsx(bP,{componentId:o});case"rest":return g.jsx(xP,{componentId:o});case"grpc":return g.jsx(wP,{componentId:o});case"websocket":return g.jsx(SP,{componentId:o});case"graphql":return g.jsx(CP,{componentId:o});case"soap":return g.jsx(MP,{componentId:o});case"webhook":return g.jsx(EP,{componentId:o});case"docker":case"kubernetes":return g.jsx(RP,{componentId:o});case"haproxy":return g.jsx(TP,{componentId:o});case"traefik":return g.jsx(kP,{componentId:o});case"envoy":return g.jsx(AP,{componentId:o});case"activemq":return g.jsx(DP,{componentId:o});case"aws-sqs":return g.jsx(NP,{componentId:o});case"azure-service-bus":return g.jsx(_P,{componentId:o});case"gcp-pubsub":return g.jsx(jP,{componentId:o});case"kong":return g.jsx(LP,{componentId:o});case"apigee":return g.jsx(zP,{componentId:o});case"mulesoft":return g.jsx(PP,{componentId:o});case"graphql-gateway":return g.jsx(OP,{componentId:o});case"bff-service":return g.jsx(IP,{componentId:o});case"webhook-relay":return g.jsx(qP,{componentId:o});case"prometheus":return g.jsx(HP,{componentId:o});case"grafana":return g.jsx(BP,{componentId:o});case"loki":return g.jsx($P,{componentId:o});case"jaeger":return g.jsx(UP,{componentId:o});case"otel-collector":return g.jsx(QP,{componentId:o});case"pagerduty":return g.jsx(FP,{componentId:o});case"keycloak":return g.jsx(GP,{componentId:o});case"waf":return g.jsx(VP,{componentId:o});case"firewall":return g.jsx(WP,{componentId:o});case"secrets-vault":return g.jsx(KP,{componentId:o});case"ids-ips":return g.jsx(YP,{componentId:o});case"jenkins":return g.jsx(XP,{componentId:o});case"gitlab-ci":return g.jsx(ZP,{componentId:o});case"argo-cd":return g.jsx(JP,{componentId:o});case"terraform":return g.jsx(tO,{componentId:o});case"ansible":return g.jsx(nO,{componentId:o});case"harbor":return g.jsx(eO,{componentId:o});case"istio":return g.jsx(sO,{componentId:o});case"service-mesh":return g.jsx(aO,{componentId:o});case"api-gateway":return g.jsx(iO,{componentId:o});case"vpn":return g.jsx(oO,{componentId:o});case"cdn":return g.jsx(rO,{componentId:o});case"spark":return g.jsx(cO,{componentId:o});case"tensorflow-serving":return g.jsx(lO,{componentId:o});case"pytorch-serve":return g.jsx(uO,{componentId:o});case"feature-store":return g.jsx(dO,{componentId:o});case"mlflow":return g.jsx(fO,{componentId:o});case"crm":return g.jsx(hO,{componentId:o});case"erp":return g.jsx(pO,{componentId:o});case"rpa-bot":return g.jsx(gO,{componentId:o});case"bpmn-engine":return g.jsx(mO,{componentId:o});case"payment-gateway":return g.jsx(yO,{componentId:o});default:return g.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"Configuration panel not available for this component type"})}};return g.jsx(w.Suspense,{fallback:g.jsx(vO,{}),children:t()})}function xO(){const{undo:o,redo:e,zoom:t,setZoom:n,pan:a,setPan:r,resetCanvas:c,saveDiagram:l,selectedConnectionId:d,selectedNodeId:h,selectedGroupId:p,nodes:m,deleteConnection:y,deleteNode:b,deleteGroup:S,selectConnection:C,selectNode:E,selectGroup:M}=Re(),{canUndo:k,canRedo:T}=Mr(),{isRunning:A,start:N,stop:q}=Dt(),{showMinimap:O,toggleMinimap:H,showHeatMapLegend:J,toggleHeatMapLegend:se}=zr();w.useEffect(()=>{const ce=Z=>{const te=Z.ctrlKey||Z.metaKey;if(te&&Z.key==="z"&&!Z.shiftKey&&k){Z.preventDefault(),o();return}if(te&&(Z.key==="z"&&Z.shiftKey||Z.key==="y")&&T){Z.preventDefault(),e();return}if(te&&(Z.key==="="||Z.key==="+")){Z.preventDefault(),n(Math.min(t+.1,2));return}if(te&&Z.key==="-"){Z.preventDefault(),n(Math.max(t-.1,.5));return}if(te&&Z.key==="0"){Z.preventDefault(),n(1),r({x:0,y:0});return}const le=50;if(!te){if(Z.key==="ArrowLeft"){Z.preventDefault(),r({x:a.x+le,y:a.y});return}if(Z.key==="ArrowRight"){Z.preventDefault(),r({x:a.x-le,y:a.y});return}if(Z.key==="ArrowUp"){Z.preventDefault(),r({x:a.x,y:a.y+le});return}if(Z.key==="ArrowDown"){Z.preventDefault(),r({x:a.x,y:a.y-le});return}}if(!te&&Z.key===" "){const ue=Z.target;if(!ue){if(Z.preventDefault(),A)q();else{const{nodes:W,connections:he}=Re.getState();Dt.getState().initialize(W,he),N()}return}const L=ue.tagName;if(L==="INPUT"||L==="TEXTAREA"||L==="SELECT"||ue.isContentEditable||ue.closest('input, textarea, select, [contenteditable="true"]'))return;const P=ue.getAttribute("role");if(P==="textbox"||P==="combobox"||P==="searchbox"||P==="spinbutton"||ue.closest("[data-radix-select-trigger], [data-radix-select-content], [data-radix-select-viewport]"))return;if(Z.preventDefault(),A)q();else{const{nodes:W,connections:he}=Re.getState();Dt.getState().initialize(W,he),N()}return}if(te&&(Z.key==="s"||Z.key==="")){Z.preventDefault(),l();return}if(te&&(Z.key==="m"||Z.key==="")){Z.preventDefault(),H();return}if(te&&(Z.key==="h"||Z.key==="")){Z.preventDefault(),se();return}if((Z.key==="Delete"||Z.key==="Backspace")&&!te){const ue=document.activeElement;if(ue){const _=ue.tagName;if(_==="INPUT"||_==="TEXTAREA"||_==="SELECT"||ue.isContentEditable)return;const P=ue.getAttribute("role");if(P==="textbox"||P==="combobox"||P==="searchbox"||P==="spinbutton")return;const W=ue.closest("form")!==null,he=ue.closest('[role="textbox"], [role="combobox"], [contenteditable="true"]')!==null,j=ue.closest("[data-radix-select-trigger], [data-radix-select-content]")!==null,Q=ue.closest('[role="dialog"]')!==null;if(W||he||j||Q)return}if(Z.preventDefault(),d){y(d),C(null);return}if(p){S(p),M(null);return}const L=m.filter(_=>_.selected);if(L.length>0){L.forEach(_=>b(_.id)),E(null);return}if(h){b(h),E(null);return}}};return window.addEventListener("keydown",ce),()=>{window.removeEventListener("keydown",ce)}},[o,e,k,T,t,n,a,r,c,l,A,N,q,O,H,J,se,d,h,p,m,y,b,S,C,E,M])}class ml extends w.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){ta("ErrorBoundary caught an error",e,{componentStack:t.componentStack}),this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:g.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:g.jsxs(An,{className:"w-full max-w-2xl",children:[g.jsxs(Xs,{children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(ys,{className:"h-5 w-5 text-destructive"}),g.jsx(Zs,{children:"-   "})]}),g.jsx(go,{children:"    "})]}),g.jsxs(Js,{className:"space-y-4",children:[this.state.error&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("p",{className:"text-sm font-semibold text-foreground",children:":"}),g.jsx("pre",{className:"text-xs bg-muted p-3 rounded-md overflow-auto max-h-48",children:this.state.error.toString()})]}),!1,g.jsxs("div",{className:"flex gap-2",children:[g.jsxs(Ae,{onClick:this.handleReset,variant:"default",children:[g.jsx(TA,{className:"h-4 w-4 mr-2"})," "]}),g.jsx(Ae,{onClick:()=>window.location.reload(),variant:"outline",children:" "})]})]})]})}):this.props.children}}function wO(){xO();const{tabs:o}=pu(),e=o.find(t=>t.active);return g.jsx(ml,{children:g.jsx(j5,{children:g.jsx(k5,{children:g.jsxs("div",{className:"h-screen flex flex-col bg-background",children:[g.jsx(EN,{}),g.jsx(M5,{}),g.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[g.jsx(ml,{children:g.jsx(DL,{})}),g.jsx(ml,{children:e?.type==="diagram"?g.jsx(Av,{}):e?.type==="component"&&e.componentId&&e.componentType?g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsx(bO,{componentId:e.componentId,componentType:e.componentType})}):g.jsx(Av,{})}),g.jsx(ml,{children:g.jsx(C5,{})})]})]})})})})}lE.createRoot(document.getElementById("root")).render(g.jsxs(Et.StrictMode,{children:[g.jsx(XE,{position:"top-right"}),g.jsx(wO,{})]}));export{lA as $,hi as A,Qt as B,An as C,ap as D,Ne as E,K0 as F,SO as G,$z as H,At as I,Qz as J,$l as K,st as L,Jk as M,xA as N,iA as O,kl as P,cb as Q,mA as R,vn as S,rp as T,HA as U,je as V,lb as W,di as X,vA as Y,fb as Z,Dt as _,au as a,vs as a0,N1 as a1,fi as a2,ys as a3,Nh as a4,Ee as a5,CO as a6,_h as a7,Xk as a8,Bv as a9,Et as aa,Th as ab,TA as ac,on as ad,ta as ae,qh as af,EO as ag,hs as b,PA as c,La as d,Xs as e,Zs as f,MO as g,go as h,Ae as i,g as j,Js as k,Rr as l,Hh as m,hz as n,KS as o,pz as p,XS as q,w as r,Cr as s,ui as t,Re as u,Wl as v,Xl as w,Jl as x,eu as y,Zl as z};
