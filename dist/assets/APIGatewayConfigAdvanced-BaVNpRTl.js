import{u as X,j as e,r as u,i as p,S,C as d,e as x,f as m,k as l,A as Y,T as Z,a as ee,b as R,c as se,d as T,h as E,P as K,L as r,I as j,n as te,o as ae,p as re,q as ie,s as b,B as o,t as N,m as ne}from"./index-2Qx8irw2.js";import{s as f,a as le}from"./toast-CFowQKth.js";import{R as ce}from"./refresh-ccw-DHaGPCfE.js";import{G as B}from"./globe-NIN3Xt0B.js";import{S as q}from"./shield-Czwvtzuc.js";import{T as de}from"./trending-up-Bm6Ln2ik.js";import{R as xe}from"./route-CFLAwhOO.js";function Ne({componentId:G}){const{nodes:U,updateNode:M}=X(),P=U.find(s=>s.id===G);if(!P)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const t=P.data.config||{},i=t.apis||[{id:"api-1",name:"User API",path:"/api/users",backend:"http://user-service:8080",method:"ALL",rateLimit:1e3,requests:12500,errors:25,enabled:!0},{id:"api-2",name:"Product API",path:"/api/products",backend:"http://product-service:8080",method:"GET",rateLimit:2e3,requests:9800,errors:12,enabled:!0}],w=t.keys||[{id:"key-1",name:"Mobile App Key",key:"ak_live_***",apis:["api-1","api-2"],rateLimit:100,enabled:!0},{id:"key-2",name:"Web App Key",key:"ak_live_***",apis:["api-1"],rateLimit:500,enabled:!0}],D=t.totalAPIs||i.length,z=t.totalKeys||w.length,_=t.totalRequests||i.reduce((s,a)=>s+(a.requests||0),0),$=t.successRate||i.reduce((s,a)=>s+(a.requests||0)-(a.errors||0),0)/i.reduce((s,a)=>s+(a.requests||0),0)*100,[V,A]=u.useState(!1),[me,F]=u.useState(!1),[g,C]=u.useState(""),[h,I]=u.useState(""),[v,k]=u.useState(""),[y,L]=u.useState("GET"),n=s=>{M(G,{data:{...P.data,config:{...t,...s}}})},O=()=>{if(!g.trim()){f("Имя API обязательно");return}if(!h.trim()){f("Путь API обязателен");return}if(!h.startsWith("/")){f("Путь должен начинаться с /");return}if(!v.trim()){f("Backend URL обязателен");return}if(i.some(c=>c.path===h.trim()&&c.method===y)){f(`API с путем ${h.trim()} и методом ${y} уже существует`);return}const a={id:`api-${Date.now()}`,name:g.trim(),path:h.trim(),backend:v.trim(),method:y,enabled:!0};n({apis:[...i,a]}),A(!1),C(""),I(""),k(""),L("GET"),le(`API "${g.trim()}" успешно создан`)},W=s=>{n({apis:i.filter(a=>a.id!==s)})},H=s=>{const a=i.map(c=>c.id===s?{...c,enabled:!c.enabled}:c);n({apis:a})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"API Gateway"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Cloud API Gateway"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Unified API management and routing"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(S,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(d,{className:"border-l-4 border-l-blue-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"APIs"}),e.jsx(B,{className:"h-4 w-4 text-blue-500"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:D}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"registered"})]})})]}),e.jsxs(d,{className:"border-l-4 border-l-green-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"API Keys"}),e.jsx(q,{className:"h-4 w-4 text-green-500"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:z}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"active"})]})})]}),e.jsxs(d,{className:"border-l-4 border-l-purple-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Requests"}),e.jsx(Y,{className:"h-4 w-4 text-purple-500"})]})}),e.jsx(l,{children:e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:_.toLocaleString()})})})]}),e.jsxs(d,{className:"border-l-4 border-l-cyan-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Success Rate"}),e.jsx(de,{className:"h-4 w-4 text-cyan-500"})]})}),e.jsx(l,{children:e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-3xl font-bold text-cyan-600 dark:text-cyan-400",children:[$.toFixed(1),"%"]})})})]})]}),e.jsxs(Z,{defaultValue:"apis",className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsxs(R,{value:"apis",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"APIs (",i.length,")"]}),e.jsxs(R,{value:"keys",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"API Keys (",w.length,")"]}),e.jsxs(R,{value:"settings",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(T,{value:"apis",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"API Routes"}),e.jsx(E,{children:"Registered API endpoints"})]}),e.jsxs(p,{onClick:()=>A(!0),size:"sm",variant:"outline",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Create API"]})]})}),V&&e.jsx(l,{className:"border-b pb-4 mb-4 bg-card",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"API Name *"}),e.jsx(j,{value:g,onChange:s=>C(s.target.value),placeholder:"User Service API"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Method *"}),e.jsxs(te,{value:y,onValueChange:s=>L(s),children:[e.jsx(ae,{children:e.jsx(re,{})}),e.jsxs(ie,{children:[e.jsx(b,{value:"GET",children:"GET"}),e.jsx(b,{value:"POST",children:"POST"}),e.jsx(b,{value:"PUT",children:"PUT"}),e.jsx(b,{value:"DELETE",children:"DELETE"}),e.jsx(b,{value:"ALL",children:"ALL"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Path *"}),e.jsx(j,{value:h,onChange:s=>I(s.target.value),placeholder:"/api/users"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Backend URL *"}),e.jsx(j,{value:v,onChange:s=>k(s.target.value),placeholder:"http://backend:8080"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:O,disabled:!g.trim()||!h.trim()||!v.trim(),children:"Create API"}),e.jsx(p,{variant:"outline",onClick:()=>{A(!1),C(""),I(""),k(""),L("GET")},children:"Cancel"})]})]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsxs(d,{className:"border-l-4 border-l-blue-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(xe,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(o,{variant:"outline",className:"font-mono text-xs",children:s.method}),e.jsx(o,{variant:"outline",className:"font-mono text-xs",children:s.path}),s.rateLimit&&e.jsxs(o,{variant:"outline",children:[s.rateLimit,"/min"]}),s.requests&&e.jsxs(o,{variant:"outline",className:"bg-green-50 dark:bg-green-950/20 text-green-700 dark:text-green-300",children:[s.requests," requests"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{checked:s.enabled,onCheckedChange:()=>H(s.id)}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>W(s.id),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})}),e.jsxs(l,{children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Backend:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:s.backend})]}),s.errors&&s.errors>0&&e.jsxs("div",{className:"text-sm mt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Errors:"}),e.jsx("span",{className:"ml-2 font-semibold text-red-500",children:s.errors})]})]})]},s.id))})})]})}),e.jsx(T,{value:"keys",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"API Keys"}),e.jsx(E,{children:"API authentication keys"})]}),e.jsxs(p,{onClick:()=>F(!0),size:"sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Create Key"]})]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsxs(d,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(q,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(o,{variant:"outline",className:"font-mono text-xs",children:s.key}),e.jsx(o,{variant:s.enabled?"default":"outline",children:s.enabled?"Enabled":"Disabled"}),s.rateLimit&&e.jsxs(o,{variant:"outline",children:[s.rateLimit,"/min"]})]})]})]})}),e.jsx(l,{children:s.apis.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Authorized APIs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.apis.map((a,c)=>{const J=i.find(Q=>Q.id===a);return e.jsx(o,{variant:"outline",className:"text-xs",children:J?.name||a},c)})})]})})]},s.id))})})]})}),e.jsx(T,{value:"settings",className:"space-y-4",children:e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"API Gateway Settings"}),e.jsx(E,{children:"Gateway configuration"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable API Key Authentication"}),e.jsx(N,{checked:t.enableApiKeyAuth??!0,onCheckedChange:s=>n({enableApiKeyAuth:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Rate Limiting"}),e.jsx(N,{checked:t.enableRateLimiting??!0,onCheckedChange:s=>n({enableRateLimiting:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Request Logging"}),e.jsx(N,{checked:t.enableRequestLogging??!0,onCheckedChange:s=>n({enableRequestLogging:s})})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Default Rate Limit (requests/min)"}),e.jsx(j,{type:"number",value:t.defaultRateLimit??1e3,onChange:s=>n({defaultRateLimit:parseInt(s.target.value)||1e3}),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Request Timeout (seconds)"}),e.jsx(j,{type:"number",value:t.requestTimeout??30,onChange:s=>n({requestTimeout:parseInt(s.target.value)||30}),min:1})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Enable Metrics Export"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Export metrics for Prometheus scraping"})]}),e.jsx(N,{checked:t.metrics?.enabled??!0,onCheckedChange:s=>n({metrics:{...t.metrics,enabled:s,port:t.metrics?.port||9100,path:t.metrics?.path||"/metrics"}})})]}),t.metrics?.enabled!==!1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Metrics Port"}),e.jsx(j,{type:"number",value:t.metrics?.port??9100,onChange:s=>n({metrics:{...t.metrics,port:parseInt(s.target.value)||9100,path:t.metrics?.path||"/metrics"}}),min:1024,max:65535}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Port for Prometheus metrics endpoint"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Metrics Path"}),e.jsx(j,{type:"text",value:t.metrics?.path??"/metrics",onChange:s=>n({metrics:{...t.metrics,path:s.target.value||"/metrics",port:t.metrics?.port||9100}}),placeholder:"/metrics"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Path for metrics endpoint (e.g., /metrics)"})]})]})]})]})]})})]})]})})}export{Ne as APIGatewayConfigAdvanced};
