import{E as me,u as he,j as e,r as k,B as xe,i,c as M,S as G,C as h,e as x,f as j,k as m,T as je,a as pe,b as v,R as ue,Z as ve,d as g,h as p,L as c,I as n,P as C,m as y,n as ge,o as Ne,p as fe,q as be,s as L,t as S}from"./index-D0eJihqw.js";import{T as Ce}from"./textarea-DSx3fPqa.js";import{G as ye}from"./globe-CI6oPniU.js";import{S as Se}from"./server-D89dmAV3.js";import{A as D}from"./arrow-right-left-KpaEsqVn.js";import{S as we}from"./shield-D1vwDJ8j.js";const ke=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],Le=me("gauge",ke);function Ze({componentId:B}){const{nodes:X,updateNode:q}=he(),P=X.find(s=>s.id===B);if(!P)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const o=P.data.config||{},W=o.port||80,I=o.serverName||"localhost",H=o.maxWorkers||4,V=o.config||`server {
  listen 80;
  server_name localhost;

  location / {
    proxy_pass http://backend:8080;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
}`,N=o.locations||[{path:"/",proxyPass:"http://backend:8080",method:"proxy"},{path:"/api",proxyPass:"http://api:3000",method:"proxy"}],u=o.upstreams||[{name:"backend",servers:[{address:"backend1:8080",weight:1},{address:"backend2:8080",weight:1},{address:"backend3:8080",weight:2}],method:"round-robin",keepalive:32}],w=o.sslCertificates||[{name:"default",certPath:"/etc/nginx/ssl/cert.pem",keyPath:"/etc/nginx/ssl/key.pem",domain:"example.com"}],b=o.rateLimitZones||[{name:"api_limit",size:"10m",rate:"10r/s"},{name:"login_limit",size:"5m",rate:"5r/m"}],z=o.enableSSL??!1,K=o.sslPort||443,$=o.enableGzip??!0,O=o.enableCache??!0;o.requestsPerSecond,o.activeConnections;const[J,_]=k.useState(!1),[Q,T]=k.useState(!1),[Y,R]=k.useState(!1),[U,ee]=k.useState(null),t=s=>{q(B,{data:{...P.data,config:{...o,...s}}})},se=()=>{t({locations:[...N,{path:"/new-path",proxyPass:"http://service:8080",method:"proxy"}]})},ae=s=>{t({locations:N.filter((a,r)=>r!==s)})},Z=(s,a,r)=>{const l=[...N];l[s]={...l[s],[a]:r},t({locations:l})},re=()=>{const s={name:"new_upstream",servers:[{address:"server1:8080",weight:1}],method:"round-robin"};t({upstreams:[...u,s]}),_(!1)},le=s=>{t({upstreams:u.filter((a,r)=>r!==s)})},A=(s,a,r)=>{const l=[...u];l[s]={...l[s],[a]:r},t({upstreams:l})},ce=s=>{const a=[...u];a[s].servers||(a[s].servers=[]),a[s].servers=[...a[s].servers,{address:"server:8080",weight:1}],t({upstreams:a})},te=(s,a)=>{const r=[...u];r[s].servers=r[s].servers.filter((l,d)=>d!==a),t({upstreams:r})},f=(s,a,r,l)=>{const d=[...u];d[s].servers[a]={...d[s].servers[a],[r]:l},t({upstreams:d})},ne=()=>{const s={name:"new_cert",certPath:"/etc/nginx/ssl/cert.pem",keyPath:"/etc/nginx/ssl/key.pem",domain:"example.com"};t({sslCertificates:[...w,s]}),T(!1)},ie=s=>{t({sslCertificates:w.filter((a,r)=>r!==s)})},E=(s,a,r)=>{const l=[...w];l[s]={...l[s],[a]:r},t({sslCertificates:l})},de=()=>{const s={name:"new_limit",size:"10m",rate:"10r/s"};t({rateLimitZones:[...b,s]}),R(!1)},oe=s=>{t({rateLimitZones:b.filter((a,r)=>r!==s)})},F=(s,a,r)=>{const l=[...b];l[s]={...l[s],[a]:r},t({rateLimitZones:l})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(ye,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"NGINX"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Web Server & Reverse Proxy"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(xe,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),"Running"]}),e.jsxs(i,{size:"sm",variant:"outline",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Reload Config"]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(h,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"SSL"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:z?"Enabled":"Disabled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"TLS/SSL status"})]})]}),e.jsxs(h,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Workers"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:H}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Worker processes"})]})]}),e.jsxs(h,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Locations"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:N.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Configured"})]})]}),e.jsxs(h,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Port"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:W}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Listening port"})]})]})]}),e.jsxs(je,{defaultValue:"server",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-7",children:[e.jsxs(v,{value:"server",className:"gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Server"]}),e.jsxs(v,{value:"upstreams",className:"gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Upstreams"]}),e.jsxs(v,{value:"locations",className:"gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Locations"]}),e.jsxs(v,{value:"ssl",className:"gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"SSL/TLS"]}),e.jsxs(v,{value:"rate-limiting",className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Rate Limit"]}),e.jsxs(v,{value:"performance",className:"gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Performance"]}),e.jsxs(v,{value:"config",className:"gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Config"]})]}),e.jsx(g,{value:"server",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Server Configuration"}),e.jsx(p,{children:"Basic server settings"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"port",children:"Port"}),e.jsx(n,{id:"port",type:"number",value:W,onChange:s=>t({port:parseInt(s.target.value)||80}),placeholder:"80"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"server-name",children:"Server Name"}),e.jsx(n,{id:"server-name",value:I,onChange:s=>t({serverName:s.target.value}),placeholder:"localhost"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"max-workers",children:"Worker Processes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{id:"max-workers",type:"number",min:"1",value:H,onChange:s=>t({maxWorkers:parseInt(s.target.value)||4}),placeholder:"4"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"processes"})]})]})]})]})}),e.jsx(g,{value:"upstreams",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Upstream Servers"}),e.jsx(p,{children:"Configure load balancing backends"})]}),e.jsxs(i,{size:"sm",onClick:()=>_(!0),variant:"outline",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Upstream"]})]}),J&&e.jsx(m,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Upstream Name"}),e.jsx(n,{placeholder:"backend"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:re,children:"Create Upstream"}),e.jsx(i,{variant:"outline",onClick:()=>_(!1),children:"Cancel"})]})]})}),e.jsx(m,{className:"space-y-4",children:u.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold font-mono",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.servers.length," server(s) • Method: ",s.method||"round-robin"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>ee(U===a?null:a),children:U===a?"Hide":"Edit"}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>le(a),children:e.jsx(y,{className:"h-4 w-4"})})]})]}),U===a&&e.jsxs("div",{className:"space-y-4 pt-3 border-t",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Upstream Name"}),e.jsx(n,{value:s.name,onChange:r=>A(a,"name",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Load Balancing Method"}),e.jsxs(ge,{value:s.method||"round-robin",onValueChange:r=>A(a,"method",r),children:[e.jsx(Ne,{children:e.jsx(fe,{})}),e.jsxs(be,{children:[e.jsx(L,{value:"round-robin",children:"Round Robin"}),e.jsx(L,{value:"least_conn",children:"Least Connections"}),e.jsx(L,{value:"ip_hash",children:"IP Hash"}),e.jsx(L,{value:"hash",children:"Hash"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{children:"Servers"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>ce(a),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Server"]})]}),e.jsx("div",{className:"space-y-2",children:s.servers.map((r,l)=>e.jsx("div",{className:"p-3 border rounded bg-muted/50 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-2 flex-1",children:[e.jsx(n,{value:r.address,onChange:d=>f(a,l,"address",d.target.value),placeholder:"server:8080"}),e.jsx(n,{type:"number",value:r.weight||1,onChange:d=>f(a,l,"weight",parseInt(d.target.value)||1),placeholder:"Weight"}),e.jsx(n,{type:"number",value:r.maxFails||3,onChange:d=>f(a,l,"maxFails",parseInt(d.target.value)||3),placeholder:"Max Fails"}),e.jsx(n,{value:r.failTimeout||"10s",onChange:d=>f(a,l,"failTimeout",d.target.value),placeholder:"Fail Timeout"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{checked:r.backup||!1,onCheckedChange:d=>f(a,l,"backup",d)}),e.jsx(c,{className:"text-xs",children:"Backup"}),e.jsx(S,{checked:r.down||!1,onCheckedChange:d=>f(a,l,"down",d)}),e.jsx(c,{className:"text-xs",children:"Down"}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>te(a,l),children:e.jsx(y,{className:"h-3 w-3"})})]})]})},l))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Keepalive Connections"}),e.jsx(n,{type:"number",value:s.keepalive||32,onChange:r=>A(a,"keepalive",parseInt(r.target.value)||32),placeholder:"32"})]})]})]},a))})]})}),e.jsx(g,{value:"locations",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Location Blocks"}),e.jsx(p,{children:"Configure routing and proxying"})]}),e.jsxs(i,{size:"sm",onClick:se,variant:"outline",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Location"]})]})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-4",children:N.map((s,a)=>e.jsxs(h,{className:"border-border",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(D,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(j,{className:"text-lg",children:s.path}),e.jsxs(p,{className:"text-xs mt-1",children:[s.method," → ",s.proxyPass]})]})]}),N.length>1&&e.jsx(i,{size:"icon",variant:"ghost",onClick:()=>ae(a),children:e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsxs(m,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Path"}),e.jsx(n,{value:s.path,onChange:r=>Z(a,"path",r.target.value),placeholder:"/"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Method"}),e.jsx(n,{value:s.method,onChange:r=>Z(a,"method",r.target.value),placeholder:"proxy"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Proxy Pass"}),e.jsx(n,{value:s.proxyPass,onChange:r=>Z(a,"proxyPass",r.target.value),placeholder:"http://backend:8080"})]})]})]},a))})})]})}),e.jsx(g,{value:"ssl",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"SSL/TLS Configuration"}),e.jsx(p,{children:"Secure connections and certificates"})]}),e.jsxs(i,{size:"sm",onClick:()=>T(!0),variant:"outline",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Certificate"]})]}),Q&&e.jsx(m,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Certificate Name"}),e.jsx(n,{placeholder:"default"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:ne,children:"Add Certificate"}),e.jsx(i,{variant:"outline",onClick:()=>T(!1),children:"Cancel"})]})]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Enable SSL"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Enable HTTPS support"})]}),e.jsx(S,{checked:z,onCheckedChange:s=>t({enableSSL:s})})]}),z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"ssl-port",children:"SSL Port"}),e.jsx(n,{id:"ssl-port",type:"number",value:K,onChange:s=>t({sslPort:parseInt(s.target.value)||443}),placeholder:"443"})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"SSL Certificates"}),w.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>ie(a),children:e.jsx(y,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Certificate Path"}),e.jsx(n,{value:s.certPath,onChange:r=>E(a,"certPath",r.target.value),placeholder:"/etc/nginx/ssl/cert.pem"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Private Key Path"}),e.jsx(n,{value:s.keyPath,onChange:r=>E(a,"keyPath",r.target.value),placeholder:"/etc/nginx/ssl/key.pem"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Domain"}),e.jsx(n,{value:s.domain||"",onChange:r=>E(a,"domain",r.target.value),placeholder:"example.com"})]})]},a))]})]})]})]})}),e.jsx(g,{value:"rate-limiting",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Rate Limiting"}),e.jsx(p,{children:"Configure request rate limiting zones"})]}),e.jsxs(i,{size:"sm",onClick:()=>R(!0),variant:"outline",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Zone"]})]}),Y&&e.jsx(m,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Zone Name"}),e.jsx(n,{placeholder:"api_limit"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:de,children:"Add Zone"}),e.jsx(i,{variant:"outline",onClick:()=>R(!1),children:"Cancel"})]})]})}),e.jsxs(m,{className:"space-y-3",children:[b.map((s,a)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold font-mono",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Size: ",s.size," • Rate: ",s.rate]})]}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>oe(a),children:e.jsx(y,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Zone Name"}),e.jsx(n,{value:s.name,onChange:r=>F(a,"name",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Size"}),e.jsx(n,{value:s.size,onChange:r=>F(a,"size",r.target.value),placeholder:"10m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Rate"}),e.jsx(n,{value:s.rate,onChange:r=>F(a,"rate",r.target.value),placeholder:"10r/s"})]})]})]},a)),b.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No rate limit zones configured. Add a zone to get started."})]})]})}),e.jsx(g,{value:"performance",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Performance Settings"}),e.jsx(p,{children:"Optimization and caching"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Enable Gzip"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Compress responses"})]}),e.jsx(S,{checked:$,onCheckedChange:s=>t({enableGzip:s})})]}),e.jsx(G,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Enable Cache"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache static content"})]}),e.jsx(S,{checked:O,onCheckedChange:s=>t({enableCache:s})})]})]})]})}),e.jsx(g,{value:"config",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Server Block Configuration"}),e.jsx(p,{children:"NGINX server block configuration"})]}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"config",children:"Configuration"}),e.jsx(Ce,{id:"config",value:V,onChange:s=>t({config:s.target.value}),className:"font-mono text-sm h-96",placeholder:"Enter NGINX configuration..."})]})})]})})]})]})})}export{Ze as NginxConfigAdvanced};
