import{u as xe,a as ue,j as e,r as j,F as R,B as O,S as he,T as je,b as ge,c as _,a5 as $,d as ve,f as D,C as g,h as v,i as N,k as f,l as n,P as L,m as y,I as m,am as k,o as F,L as o}from"./index-DCOdhwlJ.js";import{T as V}from"./textarea-DZHYvQNj.js";import{O as Ne}from"./profiles-BYwWLXF9.js";import{P as W}from"./pen-B-oyLgG9.js";function Se({componentId:S}){const{nodes:H,updateNode:X,connections:Y}=xe(),{componentMetrics:J}=ue(),z=H.find(s=>s.id===S);if(!z)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const M=Y.some(s=>s.target===S),B=Ne.loki?.defaults||{},u=z.data.config||{},Z=u.serverUrl||B.serverUrl||"http://loki:3100",C=J.get(S)?.customMetrics||{},Q=C.ingestion_lines_per_second||0,ee=C.average_query_latency||0,se=C.active_streams||0,I=C.total_storage_size||0,i=u.streams&&Array.isArray(u.streams)?u.streams:[],b=u.queries&&Array.isArray(u.queries)?u.queries:[];j.useMemo(()=>i.length>0?i.reduce((s,a)=>s+(a.entries||0),0):Math.floor(Q*60),[i,Q]);const ae=j.useMemo(()=>I>0?I/(1024*1024*1024):i.length>0?i.reduce((s,a)=>s+(a.size||0),0):0,[i,I]),[le,K]=j.useState(null),[A,p]=j.useState(null),[t,h]=j.useState(null),[U,P]=j.useState(null),[te,q]=j.useState(!1),[d,w]=j.useState({query:"",duration:0,results:0}),x=s=>{X(S,{data:{...z.data,config:{...u,...s}}})},re=()=>{x({streams:[...i,{name:"new-stream",labels:{app:"new"},entries:0,size:0}]})},ne=s=>{x({streams:i.filter((a,l)=>l!==s)})},ie=(s,a,l)=>{const r=[...i];r[s]={...r[s],[a]:l},x({streams:r})},E=(s,a,l)=>{const r=[...i],c=r[s],me={...c.labels,[a]:l};r[s]={...c,labels:me},x({streams:r})},ce=(s,a)=>{const l=[...i],r=l[s],c={...r.labels};delete c[a],l[s]={...r,labels:c},x({streams:l})},G=(s,a,l)=>{if(!a||!l)return;i[s].labels[a],E(s,a,l),h(null)},de=()=>{if(!d.query.trim())return;const s={id:`query-${Date.now()}`,query:d.query,duration:d.duration,results:d.results};x({queries:[...b,s]}),w({query:"",duration:0,results:0}),q(!1)},oe=s=>{x({queries:b.filter(a=>a.id!==s)})},T=(s,a,l)=>{const r=b.map(c=>c.id===s?{...c,[a]:l}:c);x({queries:r})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(R,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Loki"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Log Aggregation System"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(O,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${M?"bg-green-500 animate-pulse":"bg-gray-400"}`}),M?"Running":"Idle"]})})]}),e.jsx(he,{}),e.jsxs(je,{defaultValue:"streams",className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-3",children:[e.jsxs(_,{value:"streams",className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Log Streams"]}),e.jsxs(_,{value:"queries",className:"gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Queries"]}),e.jsxs(_,{value:"settings",className:"gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(D,{value:"streams",className:"space-y-4 mt-4",children:e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Log Streams"}),e.jsx(f,{children:"Log stream configuration and labels"})]}),e.jsxs(n,{size:"sm",onClick:re,variant:"outline",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Stream"]})]})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-3",children:i.map((s,a)=>e.jsxs(g,{className:"border-border",children:[e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(R,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"flex-1",children:le===a?e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{value:s.name,onChange:l=>ie(a,"name",l.target.value),placeholder:"stream-name",className:"font-semibold"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>K(null),children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Done"]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-lg",children:s.name}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>K(a),children:e.jsx(W,{className:"h-3 w-3"})})]}),e.jsxs(f,{className:"text-xs mt-1",children:[s.entries?.toLocaleString()||0," entries • ",s.size?.toFixed(2)||0," GB",s.lastEntry&&` • Last: ${s.lastEntry}`]})]})})]}),e.jsx("div",{className:"flex gap-2",children:i.length>1&&e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>ne(a),children:e.jsx(F,{className:"h-4 w-4"})})})]})}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(o,{className:"text-sm font-semibold",children:"Labels"}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>{t&&t.streamIndex===a?h(null):h({streamIndex:a,key:"",value:""})},disabled:A?.streamIndex===a,children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),t&&t.streamIndex===a?"Cancel":"Add Label"]})]}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(s.labels).map(([l,r])=>e.jsx("div",{className:"flex items-center gap-2",children:A?.streamIndex===a&&A.labelKey===l?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(m,{value:l,placeholder:"label-key",className:"flex-1",disabled:!0}),e.jsx(m,{value:r,onChange:c=>E(a,l,c.target.value),placeholder:"label-value",className:"flex-1",onBlur:()=>p(null),onKeyDown:c=>{c.key==="Enter"&&p(null),c.key==="Escape"&&p(null)},autoFocus:!0}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>{ce(a,l),p(null)},children:e.jsx(F,{className:"h-3 w-3"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>p(null),children:e.jsx(k,{className:"h-3 w-3"})})]}):e.jsxs(O,{variant:"outline",className:"text-xs cursor-pointer hover:bg-accent",onClick:()=>p({streamIndex:a,labelKey:l}),children:[l,"=",r]})},l)),t&&t.streamIndex===a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{value:t.key,onChange:l=>h({...t,key:l.target.value}),placeholder:"label-key",className:"flex-1"}),e.jsx(m,{value:t.value,onChange:l=>h({...t,value:l.target.value}),placeholder:"label-value",className:"flex-1",onKeyDown:l=>{l.key==="Enter"&&t.key&&t.value&&(G(a,t.key,t.value),h({streamIndex:a,key:"",value:""}))}}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{t.key&&t.value&&(G(a,t.key,t.value),h({streamIndex:a,key:"",value:""}))},disabled:!t.key||!t.value,children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>h(null),children:e.jsx(k,{className:"h-3 w-3"})})]})]})]})})]},a))})})]})}),e.jsx(D,{value:"queries",className:"space-y-4 mt-4",children:e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"LogQL Queries"}),e.jsx(f,{children:"Query log streams with LogQL"})]}),e.jsxs(n,{size:"sm",onClick:()=>q(!0),variant:"outline",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Query"]})]})}),e.jsxs(y,{children:[te&&e.jsxs(g,{className:"mb-4 border-primary",children:[e.jsx(v,{children:e.jsx(N,{className:"text-sm",children:"New Query"})}),e.jsxs(y,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"LogQL Query"}),e.jsx(V,{value:d.query,onChange:s=>w({...d,query:s.target.value}),placeholder:'{app="web"} |= "error"',className:"font-mono text-sm",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Duration (ms)"}),e.jsx(m,{type:"number",value:d.duration,onChange:s=>w({...d,duration:parseInt(s.target.value)||0}),placeholder:"125"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Results"}),e.jsx(m,{type:"number",value:d.results,onChange:s=>w({...d,results:parseInt(s.target.value)||0}),placeholder:"1250"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",onClick:de,disabled:!d.query.trim(),children:"Add"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{q(!1),w({query:"",duration:0,results:0})},children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-3",children:b.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No queries configured"}),e.jsx("p",{className:"text-xs mt-2",children:'Click "Add Query" to create a new LogQL query'})]}):b.map(s=>e.jsx(g,{className:"border-border",children:e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:U===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{value:s.query,onChange:a=>T(s.id,"query",a.target.value),placeholder:'{app="web"} |= "error"',className:"font-mono text-sm",rows:2}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-xs",children:"Duration (ms)"}),e.jsx(m,{type:"number",value:s.duration,onChange:a=>T(s.id,"duration",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-xs",children:"Results"}),e.jsx(m,{type:"number",value:s.results,onChange:a=>T(s.id,"results",parseInt(a.target.value)||0)})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>P(null),children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Done"]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-sm font-mono",children:s.query}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>P(s.id),children:e.jsx(W,{className:"h-3 w-3"})})]}),e.jsxs(f,{className:"text-xs mt-1",children:[s.results," results • ",s.duration,"ms"]})]})}),!U&&e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>oe(s.id),children:e.jsx(F,{className:"h-4 w-4"})})]})})},s.id))})]})]})}),e.jsxs(D,{value:"settings",className:"space-y-4 mt-4",children:[e.jsxs(g,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Loki Server"}),e.jsx(f,{children:"Server configuration"})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"server-url",children:"Server URL"}),e.jsx(m,{id:"server-url",type:"url",value:Z,onChange:s=>{const a=s.target.value;(a===""||a.startsWith("http://")||a.startsWith("https://"))&&x({serverUrl:a})},placeholder:B.serverUrl||"http://loki:3100",pattern:"https?://.*"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Server URL is used to identify this Loki instance when connecting from Grafana or other components. In simulation, logs are received automatically from connected components via data flow connections. The URL is also used by Grafana datasource configuration to find this Loki instance."})]})})]}),e.jsxs(g,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Real-time Metrics"}),e.jsx(f,{children:"Current metrics from simulation"})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-semibold",children:"Ingestion Rate"}),e.jsx("div",{className:"text-2xl font-bold",children:Math.round(Q).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"lines/second"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-semibold",children:"Query Latency"}),e.jsx("div",{className:"text-2xl font-bold",children:Math.round(ee)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ms (average)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-semibold",children:"Active Streams"}),e.jsx("div",{className:"text-2xl font-bold",children:se.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"streams"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-semibold",children:"Storage Size"}),e.jsx("div",{className:"text-2xl font-bold",children:ae.toFixed(2)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"GB"})]})]})})]})]})]})]})})}export{Se as LokiConfigAdvanced};
