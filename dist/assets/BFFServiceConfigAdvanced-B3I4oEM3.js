import{u as Q,j as e,r as f,i as p,S,C as c,e as d,f as i,R as k,k as l,W as w,A as X,Z as Y,T as _,a as ee,b as C,c as se,d as y,h as B,P as q,B as m,m as R,L as u,t as E,I as T,V as te}from"./index-D6rf2aAc.js";import{R as ne}from"./refresh-ccw-mfA9RHAw.js";function me({componentId:b}){const{nodes:L,updateNode:I}=Q(),v=L.find(s=>s.id===b);if(!v)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const o=v.data.config||{},n=o.backends||[],x=o.endpoints||[],A=n.length,F=x.length,z=x.reduce((s,t)=>s+(t.requests||0),0),D=n.length>0?n.reduce((s,t)=>s+(t.avgLatency||0),0)/n.length:0,[ae,re]=f.useState(null),[ce,de]=f.useState(null),[ie,P]=f.useState(null),[le,$]=f.useState(null),a=s=>{I(b,{data:{...v.data,config:{...o,...s}}})},M=()=>{const s={id:`backend-${Date.now()}`,name:"new-backend",endpoint:"http://localhost:8080",protocol:"http",status:"disconnected",timeout:5e3,retries:3,retryBackoff:"exponential",circuitBreaker:{enabled:!0,failureThreshold:5,successThreshold:2,timeout:6e4}};a({backends:[...n,s]}),$(s.id)},V=s=>{const t=x.map(r=>({...r,backends:r.backends.filter(j=>j!==s)}));a({backends:n.filter(r=>r.id!==s),endpoints:t})},Z=()=>{const s={id:`endpoint-${Date.now()}`,path:"/api/new-endpoint",method:"GET",backends:[],aggregator:"merge",cacheTtl:5,timeout:5e3};a({endpoints:[...x,s]}),P(s.id)},G=s=>{a({endpoints:x.filter(t=>t.id!==s)})},H=()=>{const s=te.getBFFRoutingEngine(b);if(s){const r=s.getStats().backendStats,j=n.map(h=>{const g=r[h.id];return g?{...h,requests:g.requestCount,avgLatency:Math.round(g.averageLatency)}:h}),N=x.map(h=>{const g=h.backends.reduce((J,K)=>{const O=r[K];return J+(O?.requestCount||0)},0);return{...h,requests:g}});a({backends:j,endpoints:N})}},U=s=>{switch(s){case"connected":return"bg-green-500";case"disconnected":return"bg-muted";case"error":return"bg-red-500";default:return"bg-muted"}},W=s=>{switch(s){case"connected":return"bg-green-500 text-white";case"disconnected":return"bg-muted text-foreground";case"error":return"bg-red-500 text-white";default:return"bg-muted text-foreground"}};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"BFF Service"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Backend for Frontend"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Aggregated API service for frontend applications"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(p,{variant:"outline",size:"sm",onClick:H,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Refresh Metrics"]})})]}),e.jsx(S,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(c,{className:"border-l-4 border-l-blue-500 bg-card",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Backends"}),e.jsx(k,{className:"h-4 w-4 text-blue-500"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:A}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"connected"})]})})]}),e.jsxs(c,{className:"border-l-4 border-l-green-500 bg-card",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Endpoints"}),e.jsx(w,{className:"h-4 w-4 text-green-500"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:F}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"defined"})]})})]}),e.jsxs(c,{className:"border-l-4 border-l-purple-500 bg-card",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Requests"}),e.jsx(X,{className:"h-4 w-4 text-purple-500"})]})}),e.jsx(l,{children:e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:z.toLocaleString()})})})]}),e.jsxs(c,{className:"border-l-4 border-l-cyan-500 bg-card",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Avg Latency"}),e.jsx(Y,{className:"h-4 w-4 text-cyan-500"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-cyan-600 dark:text-cyan-400",children:D.toFixed(0)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"ms"})]})})]})]}),e.jsxs(_,{defaultValue:"endpoints",className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsxs(C,{value:"endpoints",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Endpoints (",x.length,")"]}),e.jsxs(C,{value:"backends",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Backends (",n.length,")"]}),e.jsxs(C,{value:"settings",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(y,{value:"endpoints",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(i,{children:"API Endpoints"}),e.jsx(B,{children:"Aggregated endpoints"})]}),e.jsxs(p,{onClick:Z,size:"sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Create Endpoint"]})]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs(c,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(w,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsxs(i,{className:"text-lg font-semibold",children:[s.method," ",s.path]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(m,{variant:"outline",children:s.aggregator||"merge"}),e.jsxs(m,{variant:"outline",children:[s.backends.length," backends"]}),s.requests&&e.jsxs(m,{variant:"outline",className:"bg-blue-50 dark:bg-blue-950/20 text-blue-700 dark:text-blue-300",children:[s.requests," requests"]})]})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>G(s.id),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Backends"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.backends.map((t,r)=>{const j=n.find(N=>N.id===t);return e.jsx(m,{variant:"outline",children:j?.name||t},r)})})]})})]},s.id))})})]})}),e.jsx(y,{value:"backends",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Backend Services"}),e.jsx(B,{children:"Connected backend services"})]}),e.jsxs(p,{onClick:M,size:"sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Backend"]})]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsxs(c,{className:"border-l-4 border-l-blue-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${U(s.status)}/20`,children:e.jsx(k,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(i,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(m,{variant:"outline",className:`${W(s.status)} border-0`,children:s.status}),e.jsx(m,{variant:"outline",children:s.protocol.toUpperCase()}),e.jsx(m,{variant:"outline",className:"font-mono text-xs",children:s.endpoint})]})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>V(s.id),className:"hover:bg-destructive/10 hover:text-destructive",children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.requests&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Requests:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.requests.toLocaleString()})]}),s.avgLatency&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Latency:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[s.avgLatency,"ms"]})]})]})})]},s.id))})})]})}),e.jsx(y,{value:"settings",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(i,{children:"BFF Service Settings"}),e.jsx(B,{children:"Service configuration"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Enable Caching"}),e.jsx(E,{checked:o.enableCaching??!0,onCheckedChange:s=>a({enableCaching:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Enable Request Batching"}),e.jsx(E,{checked:o.enableRequestBatching??!1,onCheckedChange:s=>a({enableRequestBatching:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Enable Response Compression"}),e.jsx(E,{checked:o.enableResponseCompression??!0,onCheckedChange:s=>a({enableResponseCompression:s})})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Default Timeout (ms)"}),e.jsx(T,{type:"number",value:o.defaultTimeout??5e3,onChange:s=>a({defaultTimeout:parseInt(s.target.value)||5e3}),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Max Concurrent Requests"}),e.jsx(T,{type:"number",value:o.maxConcurrentRequests??100,onChange:s=>a({maxConcurrentRequests:parseInt(s.target.value)||100}),min:1})]})]})]})})]})]})})}export{me as BFFServiceConfigAdvanced};
