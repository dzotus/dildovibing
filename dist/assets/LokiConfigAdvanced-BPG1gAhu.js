import{u as re,j as e,r as g,F as q,B as P,S as te,T as ne,a as ie,b as T,K as G,c as ce,d as A,C as v,e as p,f as N,h as b,i as n,P as C,k as w,I as o,Y as L,m as K,L as h}from"./index-DURBjmRY.js";import{T as $}from"./textarea-XEi4bLpn.js";import{P as W}from"./pen-D30ivbmt.js";function ue({componentId:S}){const{nodes:H,updateNode:O,connections:V}=re(),k=H.find(s=>s.id===S);if(!k)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const D=V.some(s=>s.target===S),u=k.data.config||{},X=u.serverUrl||"http://loki:3100",d=u.streams||[{name:"app-logs",labels:{app:"web",env:"prod"},entries:125e4,size:2.5,lastEntry:"2s ago"},{name:"error-logs",labels:{level:"error",app:"api"},entries:45e3,size:.8,lastEntry:"5s ago"},{name:"access-logs",labels:{type:"access",app:"nginx"},entries:89e4,size:1.8,lastEntry:"1s ago"}],f=u.queries||[{id:"1",query:'{app="web"} |= "error"',duration:125,results:1250},{id:"2",query:'rate({level="error"}[5m])',duration:89,results:45}];u.totalEntries||d.reduce((s,a)=>s+a.entries,0),u.totalSize||d.reduce((s,a)=>s+a.size,0),u.ingestionRate,u.queryLatency;const[Y,R]=g.useState(null),[z,j]=g.useState(null),[r,x]=g.useState(null),[F,U]=g.useState(null),[_,Q]=g.useState(!1),[c,y]=g.useState({query:"",duration:0,results:0}),m=s=>{O(S,{data:{...k.data,config:{...u,...s}}})},J=()=>{m({streams:[...d,{name:"new-stream",labels:{app:"new"},entries:0,size:0}]})},M=s=>{m({streams:d.filter((a,l)=>l!==s)})},Z=(s,a,l)=>{const t=[...d];t[s]={...t[s],[a]:l},m({streams:t})},I=(s,a,l)=>{const t=[...d],i=t[s],le={...i.labels,[a]:l};t[s]={...i,labels:le},m({streams:t})},ee=(s,a)=>{const l=[...d],t=l[s],i={...t.labels};delete i[a],l[s]={...t,labels:i},m({streams:l})},B=(s,a,l)=>{if(!a||!l)return;d[s].labels[a],I(s,a,l),x(null)},se=()=>{if(!c.query.trim())return;const s={id:`query-${Date.now()}`,query:c.query,duration:c.duration,results:c.results};m({queries:[...f,s]}),y({query:"",duration:0,results:0}),Q(!1)},ae=s=>{m({queries:f.filter(a=>a.id!==s)})},E=(s,a,l)=>{const t=f.map(i=>i.id===s?{...i,[a]:l}:i);m({queries:t})};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(q,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Loki"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Log Aggregation System"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(P,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${D?"bg-green-500 animate-pulse":"bg-gray-400"}`}),D?"Running":"Idle"]})})]}),e.jsx(te,{}),e.jsxs(ne,{defaultValue:"streams",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-3",children:[e.jsxs(T,{value:"streams",className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Log Streams"]}),e.jsxs(T,{value:"queries",className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Queries"]}),e.jsxs(T,{value:"settings",className:"gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(A,{value:"streams",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Log Streams"}),e.jsx(b,{children:"Log stream configuration and labels"})]}),e.jsxs(n,{size:"sm",onClick:J,variant:"outline",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Stream"]})]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:d.map((s,a)=>e.jsxs(v,{className:"border-border",children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(q,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"flex-1",children:Y===a?e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{value:s.name,onChange:l=>Z(a,"name",l.target.value),placeholder:"stream-name",className:"font-semibold"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>R(null),children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Done"]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-lg",children:s.name}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>R(a),children:e.jsx(W,{className:"h-3 w-3"})})]}),e.jsxs(b,{className:"text-xs mt-1",children:[s.entries.toLocaleString()," entries • ",s.size," GB",s.lastEntry&&` • Last: ${s.lastEntry}`]})]})})]}),e.jsx("div",{className:"flex gap-2",children:d.length>1&&e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>M(a),children:e.jsx(K,{className:"h-4 w-4"})})})]})}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(h,{className:"text-sm font-semibold",children:"Labels"}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>{r&&r.streamIndex===a?x(null):x({streamIndex:a,key:"",value:""})},disabled:z?.streamIndex===a,children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),r&&r.streamIndex===a?"Cancel":"Add Label"]})]}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(s.labels).map(([l,t])=>e.jsx("div",{className:"flex items-center gap-2",children:z?.streamIndex===a&&z.labelKey===l?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(o,{value:l,placeholder:"label-key",className:"flex-1",disabled:!0}),e.jsx(o,{value:t,onChange:i=>I(a,l,i.target.value),placeholder:"label-value",className:"flex-1",onBlur:()=>j(null),onKeyDown:i=>{i.key==="Enter"&&j(null),i.key==="Escape"&&j(null)},autoFocus:!0}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>{ee(a,l),j(null)},children:e.jsx(K,{className:"h-3 w-3"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>j(null),children:e.jsx(L,{className:"h-3 w-3"})})]}):e.jsxs(P,{variant:"outline",className:"text-xs cursor-pointer hover:bg-accent",onClick:()=>j({streamIndex:a,labelKey:l}),children:[l,"=",t]})},l)),r&&r.streamIndex===a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{value:r.key,onChange:l=>x({...r,key:l.target.value}),placeholder:"label-key",className:"flex-1"}),e.jsx(o,{value:r.value,onChange:l=>x({...r,value:l.target.value}),placeholder:"label-value",className:"flex-1",onKeyDown:l=>{l.key==="Enter"&&r.key&&r.value&&(B(a,r.key,r.value),x({streamIndex:a,key:"",value:""}))}}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{r.key&&r.value&&(B(a,r.key,r.value),x({streamIndex:a,key:"",value:""}))},disabled:!r.key||!r.value,children:e.jsx(C,{className:"h-3 w-3"})}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>x(null),children:e.jsx(L,{className:"h-3 w-3"})})]})]})]})})]},a))})})]})}),e.jsx(A,{value:"queries",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"LogQL Queries"}),e.jsx(b,{children:"Query log streams with LogQL"})]}),e.jsxs(n,{size:"sm",onClick:()=>Q(!0),variant:"outline",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Query"]})]})}),e.jsxs(w,{children:[_&&e.jsxs(v,{className:"mb-4 border-primary",children:[e.jsx(p,{children:e.jsx(N,{className:"text-sm",children:"New Query"})}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"LogQL Query"}),e.jsx($,{value:c.query,onChange:s=>y({...c,query:s.target.value}),placeholder:'{app="web"} |= "error"',className:"font-mono text-sm",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Duration (ms)"}),e.jsx(o,{type:"number",value:c.duration,onChange:s=>y({...c,duration:parseInt(s.target.value)||0}),placeholder:"125"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Results"}),e.jsx(o,{type:"number",value:c.results,onChange:s=>y({...c,results:parseInt(s.target.value)||0}),placeholder:"1250"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",onClick:se,disabled:!c.query.trim(),children:"Add"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{Q(!1),y({query:"",duration:0,results:0})},children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-3",children:f.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No queries configured"}),e.jsx("p",{className:"text-xs mt-2",children:'Click "Add Query" to create a new LogQL query'})]}):f.map(s=>e.jsx(v,{className:"border-border",children:e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:F===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{value:s.query,onChange:a=>E(s.id,"query",a.target.value),placeholder:'{app="web"} |= "error"',className:"font-mono text-sm",rows:2}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs",children:"Duration (ms)"}),e.jsx(o,{type:"number",value:s.duration,onChange:a=>E(s.id,"duration",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs",children:"Results"}),e.jsx(o,{type:"number",value:s.results,onChange:a=>E(s.id,"results",parseInt(a.target.value)||0)})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>U(null),children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Done"]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-sm font-mono",children:s.query}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>U(s.id),children:e.jsx(W,{className:"h-3 w-3"})})]}),e.jsxs(b,{className:"text-xs mt-1",children:[s.results," results • ",s.duration,"ms"]})]})}),!F&&e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>ae(s.id),children:e.jsx(K,{className:"h-4 w-4"})})]})})},s.id))})]})]})}),e.jsx(A,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(v,{children:[e.jsxs(p,{children:[e.jsx(N,{children:"Loki Server"}),e.jsx(b,{children:"Server configuration"})]}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"server-url",children:"Server URL"}),e.jsx(o,{id:"server-url",type:"url",value:X,onChange:s=>{const a=s.target.value;(a===""||a.startsWith("http://")||a.startsWith("https://"))&&m({serverUrl:a})},placeholder:"http://loki:3100",pattern:"https?://.*"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Server URL is used to identify this Loki instance when connecting from Grafana or other components. In simulation, logs are received automatically from connected components via data flow connections. The URL is also used by Grafana datasource configuration to find this Loki instance."})]})})]})})]})]})})}export{ue as LokiConfigAdvanced};
