import{u as te,a as ae,j as e,r as y,e as re,S as R,C as m,h,i as u,a4 as T,m as j,A as ne,aA as ie,T as ce,b as le,c as q,aj as de,f as F,k as S,L as n,B as v,l as oe,o as xe,x as G,q as I,s as O,t as U,v as Z,w as P,I as E}from"./index-UHkh-5io.js";import{u as me}from"./use-toast-D3-v-Nv7.js";import{G as _}from"./globe-B8VDamHl.js";import{C as he}from"./chart-column-BM7_qMfX.js";import{S as ue}from"./shield-BuOfjExX.js";function be({componentId:o}){const{nodes:g,updateNode:A,connections:Q}=te(),{isRunning:H,getComponentMetrics:J}=ae(),{toast:f}=me(),M=g.find(s=>s.id===o);if(!M)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const l=M.data?.config||{},d=Array.isArray(l.services)?l.services:[],a=l.federation||{enabled:!1,services:[]},K=l.endpoint||"/graphql",w=J(o),b=w?.customMetrics||{},r=y.useMemo(()=>({requestsTotal:b.gatewayRequestsTotal||0,errorsTotal:b.gatewayErrorsTotal||0,rateLimitedTotal:b.gatewayRateLimitedTotal||0,complexityRejectedTotal:b.gatewayComplexityRejectedTotal||0,federatedRequestCount:b.gatewayFederatedRequests||0,cacheHitCount:b.gatewayCacheHitCount||0,cacheMissCount:b.gatewayCacheMissCount||0,cacheSize:b.gatewayCacheSize||0,latencyP50:w?.latencyP50||0,latencyP95:0,latencyP99:w?.latencyP99||0,averageLatency:w?.latency||0,errorRate:w?.errorRate||0,requestsPerSecond:w?.throughput||0}),[w,b]),k=y.useMemo(()=>g.filter(s=>s.type==="graphql"&&s.id!==o),[g,o]),V=y.useMemo(()=>Q.filter(s=>s.source===o).map(s=>g.find(t=>t.id===s.target)).filter(s=>s!==void 0&&s.type==="graphql"),[Q,o,g]),$=y.useMemo(()=>{const s=new Set(V.map(t=>t.id));return k.filter(t=>!s.has(t.id))},[k,V]),i=y.useCallback(s=>{const t={...l,...s};A(o,{data:{...M.data,config:t}})},[o,M,l,A,f]);y.useEffect(()=>{if(!H)return;const s=re.getGraphQLGatewayRoutingEngine(o);if(!s)return;const t=setInterval(()=>{const x=s.getServiceRegistry().getAllServices(),N=d.map(p=>{const C=x.find(L=>L.id===p.id||L.name===p.name);return C?{...p,requests:Math.floor(C.rollingLatency.length),errors:C.rollingErrors.length,status:C.status}:p});N.some((p,C)=>{const L=d[C];return p.requests!==L?.requests||p.errors!==L?.errors||p.status!==L?.status})&&i({services:N})},2e3);return()=>clearInterval(t)},[o,H,d,i]);const W=y.useCallback(s=>{const t=d.find(c=>c.id===s);i({services:d.filter(c=>c.id!==s)}),f({title:"Service Removed",description:t?`Service "${t.name}" has been removed`:"Service removed"})},[d,i,f]),D=y.useCallback(s=>s.status==="error"?"error":Q.some(c=>{if(c.source!==o)return!1;const x=g.find(C=>C.id===c.target);if(!x||x.type!=="graphql")return!1;const N=x.data?.label||x.id,B=s.name===N||s.name===x.id,p=s.endpoint&&x.id?s.endpoint.includes(x.id)||s.endpoint.includes(N):!1;return B||p})?"connected":"disconnected",[Q,o,g]),Y=y.useCallback(s=>g.find(t=>{if(t.type!=="graphql")return!1;const c=t.data?.label||t.id,x=s.name===c||s.name===t.id,N=s.endpoint&&t.id?s.endpoint.includes(t.id)||s.endpoint.includes(c):!1;return x||N}),[g]),ee=s=>{switch(s){case"connected":return"bg-green-500 text-white";case"disconnected":return"bg-muted text-foreground";case"error":return"bg-red-500 text-white";default:return"bg-muted text-foreground"}},se=r.cacheHitCount+r.cacheMissCount>0?(r.cacheHitCount/(r.cacheHitCount+r.cacheMissCount)*100).toFixed(1):"0",z=d.filter(s=>D(s)==="connected").length;return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"GraphQL Gateway"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Federated GraphQL Gateway"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Unified GraphQL API gateway with federation support"})]})}),e.jsx(R,{}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(m,{className:"border-l-4 border-l-blue-500 bg-card",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Services"}),e.jsx(T,{className:"h-4 w-4 text-blue-500"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:d.length}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[z," connected"]})]})})]}),e.jsxs(m,{className:"border-l-4 border-l-green-500 bg-card",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Requests"}),e.jsx(ne,{className:"h-4 w-4 text-green-500"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:r.requestsTotal.toLocaleString()}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.requestsPerSecond.toFixed(1),"/s"]})]})})]}),e.jsxs(m,{className:"border-l-4 border-l-red-500 bg-card",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Errors"}),e.jsx(ie,{className:"h-4 w-4 text-red-500"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:r.errorsTotal}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[(r.errorRate*100).toFixed(1),"%"]})]})})]}),e.jsxs(m,{className:"border-l-4 border-l-cyan-500 bg-card",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Federation"}),e.jsx(_,{className:"h-4 w-4 text-cyan-500"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-cyan-600 dark:text-cyan-400",children:a.enabled?"ON":"OFF"}),a.enabled&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.federatedRequestCount," requests"]})]})})]})]}),e.jsxs(ce,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(le,{className:"flex-wrap",children:[e.jsxs(q,{value:"overview",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Overview"]}),e.jsxs(q,{value:"services",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Services (",d.length,")"]}),e.jsxs(q,{value:"federation",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Federation"]}),e.jsxs(q,{value:"performance",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Performance & Cache"]}),e.jsxs(q,{value:"security",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Security & Limits"]})]}),e.jsx(F,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Gateway Status"}),e.jsx(S,{children:"Current gateway configuration and status"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Endpoint"}),e.jsx("div",{className:"font-mono text-sm bg-muted p-2 rounded",children:K})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Federation"}),e.jsx(v,{variant:a.enabled?"default":"secondary",children:a.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Connected Services"}),e.jsxs(v,{variant:"outline",children:[z," / ",d.length]})]})]})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Performance Metrics"}),e.jsx(S,{children:"Real-time gateway performance"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Average Latency"}),e.jsxs("span",{className:"font-semibold",children:[r.averageLatency.toFixed(1),"ms"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"P50 Latency"}),e.jsxs("span",{className:"font-semibold",children:[r.latencyP50.toFixed(1),"ms"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"P99 Latency"}),e.jsxs("span",{className:"font-semibold",children:[r.latencyP99.toFixed(1),"ms"]})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Error Rate"}),e.jsxs("span",{className:"font-semibold text-red-500",children:[(r.errorRate*100).toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Requests/sec"}),e.jsx("span",{className:"font-semibold",children:r.requestsPerSecond.toFixed(1)})]})]})]})]})]})}),e.jsxs(F,{value:"services",className:"space-y-4",children:[e.jsxs(m,{children:[e.jsx(h,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(u,{children:"GraphQL Backend Services"}),e.jsx(S,{children:"Services are automatically registered when you connect GraphQL Gateway to GraphQL nodes on the canvas"})]})})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"font-medium mb-2",children:"No services connected"}),e.jsx("p",{className:"text-sm mb-4",children:"To connect a service, create a connection from this GraphQL Gateway to a GraphQL node on the canvas"}),k.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Available GraphQL nodes:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:k.map(s=>e.jsx(v,{variant:"outline",children:s.data?.label||s.id},s.id))})]})]}):d.map(s=>{const t=D(s),c=Y(s);return e.jsxs(m,{className:`border-l-4 hover:shadow-md transition-shadow bg-card ${t==="connected"?"border-l-green-500":t==="error"?"border-l-red-500":"border-l-muted"}`,children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-lg ${t==="connected"?"bg-green-500/20":t==="error"?"bg-red-500/20":"bg-muted/20"}`,children:e.jsx(T,{className:`h-5 w-5 ${t==="connected"?"text-green-600":t==="error"?"text-red-600":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"text-lg font-semibold",children:s.name}),e.jsx(v,{variant:"outline",className:`${ee(t)} border-0`,children:t}),c&&e.jsx(v,{variant:"outline",className:"text-xs",children:c.data?.label||c.id})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(v,{variant:"outline",className:"font-mono text-xs",children:s.endpoint}),t==="disconnected"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Connect on canvas to activate"})]})]})]}),e.jsx(oe,{variant:"ghost",size:"icon",onClick:()=>W(s.id),className:"hover:bg-destructive/10 hover:text-destructive",title:"Remove service (disconnect on canvas to remove automatically)",children:e.jsx(xe,{className:"h-4 w-4"})})]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.requests!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Requests:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.requests.toLocaleString()})]}),s.errors!==void 0&&s.errors>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Errors:"}),e.jsx("span",{className:"ml-2 font-semibold text-red-500",children:s.errors})]})]})})]},s.id)})})})]}),$.length>0&&e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Available GraphQL Nodes"}),e.jsx(S,{children:"Connect these nodes on the canvas to add them as services"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:$.map(s=>{const t=s.data?.label||s.id;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:t}),e.jsx(v,{variant:"outline",className:"text-xs",children:s.id})]}),e.jsx(v,{variant:"outline",className:"text-xs text-muted-foreground",children:"Not connected"})]},s.id)})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("strong",{children:"Tip:"})," To connect a service, drag a connection from this GraphQL Gateway node to a GraphQL node on the canvas. The service will be automatically registered."]})})]})]})]}),e.jsx(F,{value:"federation",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"GraphQL Federation"}),e.jsx(S,{children:"Federated schema configuration"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable Federation"}),e.jsx(G,{checked:a.enabled,onCheckedChange:s=>{i({federation:{...a,enabled:s,version:s?a.version||"2":void 0}}),f({title:s?"Federation Enabled":"Federation Disabled",description:s?"Federation has been enabled":"Federation has been disabled"})}})]}),a.enabled&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Federation Version"}),e.jsxs(I,{value:a.version||"2",onValueChange:s=>{i({federation:{...a,version:s}})},children:[e.jsx(O,{children:e.jsx(U,{})}),e.jsxs(Z,{children:[e.jsx(P,{value:"1",children:"Federation v1"}),e.jsx(P,{value:"2",children:"Federation v2"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Federated Services"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.services.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No federated services configured"}):a.services.map((s,t)=>e.jsxs(v,{variant:"outline",className:"flex items-center gap-1",children:[s,e.jsx("button",{onClick:()=>{const c=a.services.filter((x,N)=>N!==t);i({federation:{...a,services:c}}),f({title:"Service Removed",description:`Service "${s}" removed from federation`})},className:"ml-1 hover:text-destructive",children:e.jsx(X,{className:"h-3 w-3"})})]},t))}),e.jsxs(I,{value:"",onValueChange:s=>{s&&!a.services.includes(s)&&(i({federation:{...a,services:[...a.services,s]}}),f({title:"Service Added",description:`Service "${s}" added to federation`}))},children:[e.jsx(O,{children:e.jsx(U,{placeholder:"Add service to federation"})}),e.jsx(Z,{children:d.filter(s=>!a.services.includes(s.name)).map(s=>e.jsx(P,{value:s.name,children:s.name},s.id))})]})]}),a.supergraph&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Supergraph Schema"}),e.jsx("div",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto max-h-48",children:a.supergraph})]}),a.compositionStatus&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Composition Status"}),e.jsx(v,{variant:a.compositionStatus==="ok"?"default":a.compositionStatus==="error"?"destructive":"secondary",children:a.compositionStatus})]})]})]})]})}),e.jsx(F,{value:"performance",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Performance & Cache"}),e.jsx(S,{children:"Cache configuration and performance metrics"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Cache TTL (seconds)"}),e.jsx(E,{type:"number",value:l.cacheTtl||0,onChange:s=>{const t=parseInt(s.target.value)||0;if(t<0){f({title:"Validation Error",description:"Cache TTL must be non-negative",variant:"destructive"});return}i({cacheTtl:t})},min:0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Persist Queries"}),e.jsx(G,{checked:l.persistQueries??!1,onCheckedChange:s=>i({persistQueries:s})})]}),e.jsx(R,{}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(n,{children:"Cache Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Hits"}),e.jsx("div",{className:"text-2xl font-bold",children:r.cacheHitCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Misses"}),e.jsx("div",{className:"text-2xl font-bold",children:r.cacheMissCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Hit Rate"}),e.jsxs("div",{className:"text-2xl font-bold",children:[se,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Size"}),e.jsx("div",{className:"text-2xl font-bold",children:r.cacheSize})]})]})]})})]})]})}),e.jsx(F,{value:"security",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Security & Limits"}),e.jsx(S,{children:"Gateway security and rate limiting configuration"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable Introspection"}),e.jsx(G,{checked:l.enableIntrospection??!0,onCheckedChange:s=>i({enableIntrospection:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable Query Complexity Analysis"}),e.jsx(G,{checked:l.enableQueryComplexityAnalysis??!0,onCheckedChange:s=>i({enableQueryComplexityAnalysis:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Enable Rate Limiting"}),e.jsx(G,{checked:l.enableRateLimiting??!1,onCheckedChange:s=>i({enableRateLimiting:s})})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Max Query Depth"}),e.jsx(E,{type:"number",value:l.maxQueryDepth??15,onChange:s=>{const t=parseInt(s.target.value)||15;if(t<1||t>50){f({title:"Validation Error",description:"Max query depth must be between 1 and 50",variant:"destructive"});return}i({maxQueryDepth:t})},min:1,max:50})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Max Query Complexity"}),e.jsx(E,{type:"number",value:l.maxQueryComplexity??1e3,onChange:s=>{const t=parseInt(s.target.value)||1e3;if(t<1){f({title:"Validation Error",description:"Max query complexity must be positive",variant:"destructive"});return}i({maxQueryComplexity:t})},min:1})]}),l.enableRateLimiting&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Global Rate Limit (requests/minute)"}),e.jsx(E,{type:"number",value:l.globalRateLimitPerMinute||100,onChange:s=>{const t=parseInt(s.target.value)||100;if(t<1){f({title:"Validation Error",description:"Rate limit must be positive",variant:"destructive"});return}i({globalRateLimitPerMinute:t})},min:1})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Rate Limited Requests"}),e.jsx("div",{className:"text-2xl font-bold",children:r.rateLimitedTotal})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Complexity Rejected Requests"}),e.jsx("div",{className:"text-2xl font-bold",children:r.complexityRejectedTotal})]})]})]})})]})]})})}export{be as GraphQLGatewayConfigAdvanced};
