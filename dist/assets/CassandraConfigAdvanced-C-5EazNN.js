import{u as Re,j as e,r as f,V,B as $,i as N,c as me,S as _,C as o,e as x,f as u,k as d,T as Qe,a as $e,b as D,R as De,d as q,h as b,P as X,m as qe,L as v,I as L,n as xe,o as ue,p as he,q as pe,s as J,N as Me,t as Ae}from"./index-Dd33G1rA.js";import{P as Z}from"./progress-zyfouKmR.js";import{T as Fe}from"./textarea-DbhW0zkJ.js";import{a as ee,s as M}from"./toast-DIwbB4rV.js";import{D as se}from"./database-CTo8fyrd.js";import{T as je}from"./table-DxlQJB1V.js";import{C as Ue}from"./code-CeqdEWNh.js";function Ge({componentId:C}){const{nodes:ye,updateNode:ge}=Re(),S=ye.find(s=>s.id===C);if(!S)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const p=S.data.config||{},Ne=p.clusterName||"archiphoenix-cluster",ae=p.nodes||[],j=p.keyspaces||[{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}],A=p.tables||[],E=p.queries||[],[te,ce]=f.useState(null),[fe,O]=f.useState(!1),[ve,F]=f.useState(!1),[U,I]=f.useState(""),[K,P]=f.useState(j[0]?.name||"system"),[w,Y]=f.useState(""),B=p.consistencyLevel||"QUORUM",G=p.replicationFactor||3,re=p.enableCompaction??!0,be=p.compactionStrategy||"SizeTieredCompactionStrategy",[z,we]=f.useState(null),[ne,Ce]=f.useState(j),[le,Se]=f.useState(A);f.useEffect(()=>{if(!S)return;const s=setInterval(()=>{const a=S.data.config||{},r=a.keyspaces||[],t=a.tables||[],n=V.getCassandraRoutingEngine(C);if(n){const c=n.getMetrics(),y=n.getKeyspaces(),g=n.getTables();we({readLatency:c.readLatency,writeLatency:c.writeLatency,totalNodes:c.totalNodes,healthyNodes:c.healthyNodes,totalKeyspaces:c.totalKeyspaces,totalTables:c.totalTables,totalRows:c.totalRows,totalSize:c.totalSize});const R=new Map(r.map(m=>[m.name,m])),i=y.map(m=>{const T=R.get(m.name);return{...m,...T&&{size:T.size,tables:g.filter(h=>h.keyspace===m.name).length}}});Ce(i);const W=new Map(t.map(m=>[`${m.keyspace}.${m.name}`,m])),Q=g.map(m=>{const T=W.get(`${m.keyspace}.${m.name}`);return{...m,...T&&{columns:T.columns}}});Se(Q)}},500);return()=>clearInterval(s)},[C,S]);const Te=z?.totalSize?z.totalSize/(1024*1024*1024):p.totalSize||j.reduce((s,a)=>s+a.size,0),H=z?.readLatency??(p.readLatency||2.5),ie=z?.writeLatency??(p.writeLatency||3.2),k=ne.length>0?ne:j,oe=le.length>0?le:A,l=s=>{ge(C,{data:{...S.data,config:{...p,...s}}})},Ee=()=>{const s=`keyspace_${Date.now()}`,a=`CREATE KEYSPACE ${s} WITH REPLICATION = {'class': 'SimpleStrategy', 'replication_factor': ${G}}`,r=V.getCassandraRoutingEngine(C);if(r)try{const t=r.executeCQL(a,B);if(t.success){const n=r.getKeyspaces();l({keyspaces:n.map(y=>({...y,tables:A.filter(g=>g.keyspace===y.name).length,size:j.find(g=>g.name===y.name)?.size||0}))});const c={id:`query-${Date.now()}`,query:a,status:"success",duration:t.latency||0,rowsReturned:0};l({queries:[c,...E.slice(0,9)]}),ee(`Keyspace ${s} created successfully`)}else M(`Failed to create keyspace: ${t.error}`)}catch(t){M(`Error creating keyspace: ${t instanceof Error?t.message:"Unknown error"}`)}else l({keyspaces:[...j,{name:s,replication:G,replicationStrategy:"SimpleStrategy",tables:0,size:0,durableWrites:!0}]})},Ke=s=>{l({keyspaces:j.filter((a,r)=>r!==s)})},de=(s,a,r)=>{const t=[...j];t[s]={...t[s],[a]:r},l({keyspaces:t})},Le=()=>{if(!w.trim())return;const s=`query-${Date.now()}`,a=Date.now(),r={id:s,query:w,status:"running",duration:0,rowsReturned:0},t=V.getCassandraRoutingEngine(C);let n=r;if(t)try{const c=t.executeCQL(w,B),y=Date.now()-a;if(n={id:s,query:w,status:c.success?"success":"error",duration:y,rowsReturned:c.rowCount||0},c.success){const g=w.trim().toUpperCase();if(g.startsWith("CREATE TABLE")||g.startsWith("CREATE KEYSPACE")){const R=t.getKeyspaces(),i=t.getTables(),Q=(S.data.config||{}).keyspaces||[],m=new Map(Q.map(h=>[h.name,h])),T=R.map(h=>{const ze=m.get(h.name);return{...h,size:ze?.size||0,tables:i.filter(ke=>ke.keyspace===h.name).length}});l({keyspaces:T,tables:i.map(h=>({name:h.name,keyspace:h.keyspace,columns:h.columns||[],rows:h.rows||0,size:h.size||0}))})}}n.status==="success"?ee("Query executed successfully"):M(c.error||"Query execution failed")}catch{const y=Date.now()-a;n={id:s,query:w,status:"error",duration:y,rowsReturned:0}}else n.status="success",n.duration=Date.now()-a;l({queries:[n,...E.slice(0,9)]}),Y(""),O(!1)};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(se,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Apache Cassandra"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Distributed NoSQL Database"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),"Cluster Healthy"]}),e.jsxs(N,{size:"sm",variant:"outline",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"CQL Shell"]})]})]}),e.jsx(_,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Nodes"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:ae.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Cluster nodes"})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Keyspaces"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:z?.totalKeyspaces??j.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total keyspaces"})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Read Latency"})}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[H,"ms"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Average"})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Data Size"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Te.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"GB"})]})]})]}),e.jsxs(Qe,{defaultValue:"keyspaces",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-5",children:[e.jsxs(D,{value:"keyspaces",className:"gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Keyspaces"]}),e.jsxs(D,{value:"tables",className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Tables"]}),e.jsxs(D,{value:"cql",className:"gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"CQL Shell"]}),e.jsxs(D,{value:"cluster",className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Cluster"]}),e.jsxs(D,{value:"settings",className:"gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(q,{value:"keyspaces",className:"space-y-4 mt-4",children:e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Keyspaces"}),e.jsx(b,{children:"Cassandra keyspace configuration"})]}),e.jsxs(N,{size:"sm",onClick:Ee,variant:"outline",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Create Keyspace"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:k.map((s,a)=>e.jsxs(o,{className:"border-border",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(se,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(u,{className:"text-lg",children:s.name}),e.jsxs(b,{className:"text-xs mt-1",children:[s.tables," tables • Replication: ",s.replication," • Size: ",s.size," GB",s.replicationStrategy&&` • ${s.replicationStrategy}`]})]})]}),k.length>1&&e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>Ke(a),children:e.jsx(qe,{className:"h-4 w-4"})})]})}),te===a&&e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Replication Factor"}),e.jsx(L,{type:"number",value:s.replication,onChange:r=>de(a,"replication",Number(r.target.value)),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Replication Strategy"}),e.jsxs(xe,{value:s.replicationStrategy||"NetworkTopologyStrategy",onValueChange:r=>de(a,"replicationStrategy",r),children:[e.jsx(ue,{children:e.jsx(he,{})}),e.jsxs(pe,{children:[e.jsx(J,{value:"SimpleStrategy",children:"Simple Strategy"}),e.jsx(J,{value:"NetworkTopologyStrategy",children:"Network Topology Strategy"})]})]})]})]}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>ce(null),children:"Done"})]}),te!==a&&e.jsx(d,{children:e.jsx(N,{size:"sm",variant:"outline",onClick:()=>ce(a),children:"Edit Settings"})})]},a))})})]})}),e.jsx(q,{value:"tables",className:"space-y-4 mt-4",children:e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Tables"}),e.jsx(b,{children:"Cassandra table configuration"})]}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>F(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Create Table"]})]})}),e.jsxs(d,{children:[ve&&e.jsxs(o,{className:"mb-4 border-primary",children:[e.jsxs(x,{children:[e.jsx(u,{children:"Create New Table"}),e.jsx(b,{children:"Create a table in a keyspace"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Keyspace"}),e.jsxs(xe,{value:K,onValueChange:P,children:[e.jsx(ue,{children:e.jsx(he,{})}),e.jsx(pe,{children:k.map(s=>e.jsx(J,{value:s.name,children:s.name},s.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Table Name"}),e.jsx(L,{value:U,onChange:s=>I(s.target.value),placeholder:"users"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{onClick:()=>{if(U.trim()&&K){const s=U.trim(),a=`CREATE TABLE ${K}.${s} (id UUID PRIMARY KEY, data TEXT)`,r=V.getCassandraRoutingEngine(C);if(r)try{const t=r.executeCQL(a,B);if(t.success){const n=r.getKeyspaces(),c=r.getTables(),y=new Map(j.map(i=>[i.name,i])),g=n.map(i=>{const W=y.get(i.name);return{...i,size:W?.size||0,tables:c.filter(Q=>Q.keyspace===i.name).length}});l({keyspaces:g,tables:c.map(i=>({name:i.name,keyspace:i.keyspace,columns:i.columns||[],rows:i.rows||0,size:i.size||0}))});const R={id:`query-${Date.now()}`,query:a,status:"success",duration:t.latency||0,rowsReturned:0};l({queries:[R,...E.slice(0,9)]}),F(!1),I(""),P(k[0]?.name||"system"),ee(`Table ${s} created successfully`)}else{const n={id:`query-${Date.now()}`,query:a,status:"error",duration:t.latency||0,rowsReturned:0};l({queries:[n,...E.slice(0,9)]}),M(`Failed to create table: ${t.error}`)}}catch(t){M(`Error creating table: ${t instanceof Error?t.message:"Unknown error"}`)}else{const t={name:s,keyspace:K,columns:[{name:"id",type:"UUID",primaryKey:!0},{name:"data",type:"TEXT"}],rows:0,size:0};l({tables:[...A,t]});const n=j.map(c=>c.name===K?{...c,tables:(c.tables||0)+1}:c);l({keyspaces:n}),F(!1),I(""),P(k[0]?.name||"system")}}},disabled:!U.trim()||!K,children:"Create Table"}),e.jsx(N,{variant:"outline",onClick:()=>{F(!1),I(""),P(j[0]?.name||"system")},children:"Cancel"})]})]})]}),oe.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No tables created"}):e.jsx("div",{className:"space-y-3",children:oe.map((s,a)=>e.jsx(o,{className:"border-border",children:e.jsx(x,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx(u,{className:"text-lg",children:s.name}),e.jsxs(b,{className:"text-xs mt-1",children:[s.keyspace," • ",s.rows||0," rows • ",s.size?`${s.size} GB`:"N/A"]})]})]})})})},a))})]})]})}),e.jsx(q,{value:"cql",className:"space-y-4 mt-4",children:e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"CQL Shell"}),e.jsx(b,{children:"Execute CQL queries"})]}),e.jsxs(N,{size:"sm",onClick:()=>O(!0),variant:"outline",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"New Query"]})]})}),e.jsxs(d,{children:[fe&&e.jsxs(o,{className:"mb-4 border-primary",children:[e.jsx(x,{children:e.jsx(u,{children:"Execute CQL Query"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"CQL Query"}),e.jsx(Fe,{value:w,onChange:s=>Y(s.target.value),placeholder:"SELECT * FROM keyspace.table LIMIT 10;",rows:6,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{onClick:Le,disabled:!w.trim(),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Execute"]}),e.jsx(N,{variant:"outline",onClick:()=>{O(!1),Y("")},children:"Cancel"})]})]})]}),E.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No queries executed"}):e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsx(o,{className:"border-l-4 border-l-blue-500",children:e.jsx(d,{className:"pt-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{variant:s.status==="success"?"default":s.status==="error"?"destructive":"secondary",children:s.status}),s.duration!==void 0&&e.jsxs($,{variant:"outline",children:[s.duration,"ms"]}),s.rowsReturned!==void 0&&e.jsxs($,{variant:"outline",children:[s.rowsReturned," rows"]})]}),e.jsx("pre",{className:"text-xs font-mono bg-muted p-2 rounded overflow-x-auto",children:s.query})]})})})},s.id))})]})]})}),e.jsx(q,{value:"cluster",className:"space-y-4 mt-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Cluster Nodes"}),e.jsx(b,{children:"Cassandra cluster topology"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:ae.map((s,a)=>e.jsxs(o,{className:"border-border",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${s.status==="up"?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx(u,{className:"text-lg",children:s.address}),e.jsxs(b,{className:"text-xs mt-1",children:[s.tokens," tokens • Load: ",(s.load*100).toFixed(1),"%"]})]})]}),e.jsx($,{variant:s.status==="up"?"default":"destructive",children:s.status.toUpperCase()})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Load:"}),e.jsxs("span",{className:"font-semibold",children:[(s.load*100).toFixed(1),"%"]})]}),e.jsx(Z,{value:s.load*100,className:"h-2"})]})})]},a))})})]})}),e.jsx(q,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Cluster Settings"}),e.jsx(b,{children:"Cassandra cluster configuration"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Read Latency"})}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[H,"ms"]}),e.jsx(Z,{value:Math.min(H/10*100,100),className:"h-2 mt-2"})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Write Latency"})}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[ie,"ms"]}),e.jsx(Z,{value:Math.min(ie/10*100,100),className:"h-2 mt-2"})]})]})]}),e.jsx(_,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"cluster-name",children:"Cluster Name"}),e.jsx(L,{id:"cluster-name",value:Ne,onChange:s=>l({clusterName:s.target.value}),placeholder:"my-cluster"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"replication-factor",children:"Replication Factor"}),e.jsx(L,{id:"replication-factor",type:"number",min:"1",max:"10",value:G,onChange:s=>l({replicationFactor:parseInt(s.target.value)||3})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"consistency-level",children:"Consistency Level"}),e.jsx(L,{id:"consistency-level",value:B,onChange:s=>l({consistencyLevel:s.target.value}),placeholder:"QUORUM"})]})]}),e.jsx(_,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{children:"Enable Compaction"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Automatic data compaction"})]}),e.jsx(Ae,{checked:re,onCheckedChange:s=>l({enableCompaction:s})})]}),re&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"compaction-strategy",children:"Compaction Strategy"}),e.jsx(L,{id:"compaction-strategy",value:be,onChange:s=>l({compactionStrategy:s.target.value}),placeholder:"SizeTieredCompactionStrategy"})]})]})]})})]})]})})}export{Ge as CassandraConfigAdvanced};
