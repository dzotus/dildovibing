import{u as ce,j as e,r as S,S as D,C as x,h as N,i as y,m as f,B as le,T as oe,b as de,c as E,d as me,f as L,k as B,L as r,q as $,s as H,t as K,v as _,w as M,I as l,l as C,P as z,o as O,x as v}from"./index-Cr1wcIS8.js";import{T as V}from"./textarea-Dvy4XTRf.js";import{A as U,a as Z}from"./alert-BYWdeygq.js";import{M as G}from"./message-square-CJ85zxgd.js";import{K as he}from"./key-DKkNLHjr.js";function ye({componentId:A}){const{nodes:J,updateNode:X}=ce(),Q=J.find(s=>s.id===A);if(!Q)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const m=Q.data.config||{},k=m.namespace||"archiphoenix.servicebus.windows.net",Y=m.connectionString||"",b=m.queues||[],j=m.topics||[],[ue,xe]=S.useState(null),[je,pe]=S.useState(null),[P,F]=S.useState({}),[w,W]=S.useState({}),[T,R]=S.useState({}),q=s=>!s||s.trim()===""?"Name cannot be empty":s.length<1||s.length>260?"Name must be between 1 and 260 characters":/^[a-zA-Z0-9._-]+$/.test(s)?s.startsWith(".")||s.endsWith(".")?"Name cannot start or end with a period":s.startsWith("-")||s.endsWith("-")?"Name cannot start or end with a hyphen":s.includes("..")?"Name cannot contain consecutive periods":null:"Name can only contain letters, numbers, periods, hyphens, and underscores",p=s=>{X(A,{data:{...Q.data,config:{...m,...s}}})},I=()=>{const s={name:"new-queue",namespace:k,maxSizeInMegabytes:1024,defaultMessageTimeToLive:2592e3,lockDuration:30,maxDeliveryCount:10,enablePartitioning:!1,enableDeadLetteringOnMessageExpiration:!0,enableSessions:!1,enableDuplicateDetection:!1,duplicateDetectionHistoryTimeWindow:600,forwardTo:void 0,enableBatchedOperations:!1,activeMessageCount:0,deadLetterMessageCount:0,scheduledMessageCount:0};p({queues:[...b,s]})},ee=s=>{p({queues:b.filter((i,a)=>a!==s)})},h=(s,i,a)=>{if(i==="name"){const n=q(a);if(n){F({...P,[s]:n});return}else{const c={...P};delete c[s],F(c)}}const t=[...b];t[s]={...t[s],[i]:a},p({queues:t})},se=()=>{const s={name:"new-topic",namespace:k,maxSizeInMegabytes:1024,defaultMessageTimeToLive:2592e3,enablePartitioning:!1,enableDuplicateDetection:!1,duplicateDetectionHistoryTimeWindow:600,forwardTo:void 0,enableBatchedOperations:!1,subscriptions:[]};p({topics:[...j,s]})},ae=s=>{p({topics:j.filter((i,a)=>a!==s)})},g=(s,i,a)=>{if(i==="name"){const n=q(a);if(n){W({...w,[s]:n});return}else{const c={...w};delete c[s],W(c)}}const t=[...j];t[s]={...t[s],[i]:a},p({topics:t})},ie=s=>{const i=j[s];if(i){const a={name:"new-subscription",maxDeliveryCount:10,lockDuration:30,enableDeadLetteringOnMessageExpiration:!0,requiresSession:!1,forwardTo:void 0,enableBatchedOperations:!1,rules:[],activeMessageCount:0},t=[...i.subscriptions||[],a];g(s,"subscriptions",t)}},ne=(s,i)=>{const a=j[s];if(a&&a.subscriptions){const t=a.subscriptions.filter((n,c)=>c!==i);g(s,"subscriptions",t)}},d=(s,i,a,t)=>{if(a==="name"){const c=`${s}-${i}`,u=q(t);if(u){R({...T,[c]:u});return}else{const o={...T};delete o[c],R(o)}}const n=j[s];if(n&&n.subscriptions){const c=[...n.subscriptions];c[i]={...c[i],[a]:t},g(s,"subscriptions",c)}},te=b.reduce((s,i)=>s+(i.activeMessageCount||0),0)+j.reduce((s,i)=>s+(i.subscriptions?.reduce((a,t)=>a+(t.activeMessageCount||0),0)||0),0);return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Azure Service Bus"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Service Bus Namespace"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Configure queues, topics and subscriptions with sessions and dead-lettering"})]})}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(x,{children:[e.jsx(N,{className:"pb-3",children:e.jsx(y,{className:"text-sm font-medium",children:"Namespace"})}),e.jsx(f,{children:e.jsx(le,{variant:"outline",className:"truncate max-w-full",children:k})})]}),e.jsxs(x,{children:[e.jsx(N,{className:"pb-3",children:e.jsx(y,{className:"text-sm font-medium",children:"Queues"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold",children:b.length})})]}),e.jsxs(x,{children:[e.jsx(N,{className:"pb-3",children:e.jsx(y,{className:"text-sm font-medium",children:"Topics"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold",children:j.length})})]}),e.jsxs(x,{children:[e.jsx(N,{className:"pb-3",children:e.jsx(y,{className:"text-sm font-medium",children:"Total Messages"})}),e.jsx(f,{children:e.jsx("span",{className:"text-2xl font-bold",children:te.toLocaleString()})})]})]}),e.jsxs(oe,{defaultValue:"queues",className:"space-y-4",children:[e.jsxs(de,{className:"flex-wrap h-auto",children:[e.jsxs(E,{value:"namespace",className:"flex-shrink-0",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Namespace Settings"]}),e.jsxs(E,{value:"queues",className:"flex-shrink-0",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Queues (",b.length,")"]}),e.jsxs(E,{value:"topics",className:"flex-shrink-0",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Topics (",j.length,")"]}),e.jsxs(E,{value:"connection",className:"flex-shrink-0",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Connection"]})]}),e.jsx(L,{value:"namespace",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Namespace Settings"}),e.jsx(B,{children:"Configure Azure Service Bus namespace tier and capacity"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Pricing Tier"}),e.jsxs($,{value:m.pricingTier||"standard",onValueChange:s=>p({pricingTier:s}),children:[e.jsx(H,{children:e.jsx(K,{})}),e.jsxs(_,{children:[e.jsx(M,{value:"basic",children:"Basic"}),e.jsx(M,{value:"standard",children:"Standard"}),e.jsx(M,{value:"premium",children:"Premium"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m.pricingTier==="basic"&&"Basic tier: 1000 msg/s, 256KB message size limit",m.pricingTier==="standard"&&"Standard tier: 10000 msg/s, 256KB message size limit",m.pricingTier==="premium"&&"Premium tier: 100000 msg/s per messaging unit, 100MB message size limit"]})]}),m.pricingTier==="premium"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Messaging Units"}),e.jsx(l,{type:"number",min:1,max:16,value:m.messagingUnits||1,onChange:s=>p({messagingUnits:Math.max(1,Math.min(16,Number(s.target.value)))}),placeholder:"1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of messaging units (1-16). Each unit provides 100000 msg/s throughput."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Consumption Rate (messages/second)"}),e.jsx(l,{type:"number",min:1,value:m.consumptionRate||10,onChange:s=>p({consumptionRate:Math.max(1,Number(s.target.value))}),placeholder:"10"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rate at which messages are consumed from queues/subscriptions and sent to outgoing connections."})]})]})]})}),e.jsx(L,{value:"queues",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Queues"}),e.jsx(B,{children:"Configure Service Bus queues"})]}),e.jsxs(C,{onClick:I,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Queue"]})]})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:b.map((s,i)=>e.jsxs(x,{className:"border-l-4 border-l-blue-500",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(r,{children:"Queue Name"}),e.jsx(l,{value:s.name,onChange:a=>h(i,"name",a.target.value),placeholder:"queue-name"})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>ee(i),disabled:b.length===1,className:"ml-4",children:e.jsx(O,{className:"h-4 w-4"})})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Messages"}),e.jsx("p",{className:"text-lg font-semibold",children:s.activeMessageCount||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dead Letter"}),e.jsx("p",{className:"text-lg font-semibold",children:s.deadLetterMessageCount||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Scheduled"}),e.jsx("p",{className:"text-lg font-semibold",children:s.scheduledMessageCount||0})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Max Size (MB)"}),e.jsx(l,{type:"number",value:s.maxSizeInMegabytes,onChange:a=>h(i,"maxSizeInMegabytes",Number(a.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Message TTL (seconds)"}),e.jsx(l,{type:"number",value:s.defaultMessageTimeToLive,onChange:a=>h(i,"defaultMessageTimeToLive",Number(a.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Lock Duration (seconds)"}),e.jsx(l,{type:"number",value:s.lockDuration,onChange:a=>h(i,"lockDuration",Number(a.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Max Delivery Count"}),e.jsx(l,{type:"number",value:s.maxDeliveryCount,onChange:a=>h(i,"maxDeliveryCount",Number(a.target.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Sessions"}),e.jsx(v,{checked:s.enableSessions,onCheckedChange:a=>h(i,"enableSessions",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Partitioning"}),e.jsx(v,{checked:s.enablePartitioning,onCheckedChange:a=>h(i,"enablePartitioning",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Dead Letter on Expiration"}),e.jsx(v,{checked:s.enableDeadLetteringOnMessageExpiration,onCheckedChange:a=>h(i,"enableDeadLetteringOnMessageExpiration",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Duplicate Detection"}),e.jsx(v,{checked:s.enableDuplicateDetection||!1,onCheckedChange:a=>h(i,"enableDuplicateDetection",a)})]}),s.enableDuplicateDetection&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Duplicate Detection Window (seconds)"}),e.jsx(l,{type:"number",value:s.duplicateDetectionHistoryTimeWindow||600,onChange:a=>h(i,"duplicateDetectionHistoryTimeWindow",Number(a.target.value)),placeholder:"600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Forward To (queue/topic name)"}),e.jsx(l,{value:s.forwardTo||"",onChange:a=>h(i,"forwardTo",a.target.value||void 0),placeholder:"destination-queue-or-topic"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Batched Operations"}),e.jsx(v,{checked:s.enableBatchedOperations||!1,onCheckedChange:a=>h(i,"enableBatchedOperations",a)})]})]})]})]},i))})})]})}),e.jsx(L,{value:"topics",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Topics"}),e.jsx(B,{children:"Configure publish-subscribe topics with subscriptions"})]}),e.jsxs(C,{onClick:se,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Topic"]})]})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:j.map((s,i)=>e.jsxs(x,{className:"border-l-4 border-l-green-500",children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(r,{children:"Topic Name"}),e.jsx(l,{value:s.name,onChange:a=>g(i,"name",a.target.value),placeholder:"topic-name",className:w[i]?"border-destructive":""}),w[i]&&e.jsx(U,{variant:"destructive",className:"mt-2",children:e.jsx(Z,{children:w[i]})})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>ae(i),disabled:j.length===1,className:"ml-4",children:e.jsx(O,{className:"h-4 w-4"})})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Max Size (MB)"}),e.jsx(l,{type:"number",value:s.maxSizeInMegabytes,onChange:a=>g(i,"maxSizeInMegabytes",Number(a.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Message TTL (seconds)"}),e.jsx(l,{type:"number",value:s.defaultMessageTimeToLive,onChange:a=>g(i,"defaultMessageTimeToLive",Number(a.target.value))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Partitioning"}),e.jsx(v,{checked:s.enablePartitioning,onCheckedChange:a=>g(i,"enablePartitioning",a)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Duplicate Detection"}),e.jsx(v,{checked:s.enableDuplicateDetection||!1,onCheckedChange:a=>g(i,"enableDuplicateDetection",a)})]}),s.enableDuplicateDetection&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Duplicate Detection Window (seconds)"}),e.jsx(l,{type:"number",value:s.duplicateDetectionHistoryTimeWindow||600,onChange:a=>g(i,"duplicateDetectionHistoryTimeWindow",Number(a.target.value)),placeholder:"600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Forward To (queue/topic name)"}),e.jsx(l,{value:s.forwardTo||"",onChange:a=>g(i,"forwardTo",a.target.value||void 0),placeholder:"destination-queue-or-topic"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Batched Operations"}),e.jsx(v,{checked:s.enableBatchedOperations||!1,onCheckedChange:a=>g(i,"enableBatchedOperations",a)})]})]}),e.jsx(D,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(r,{children:["Subscriptions (",s.subscriptions?.length||0,")"]}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>ie(i),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add Subscription"]})]}),s.subscriptions&&s.subscriptions.length>0?e.jsx("div",{className:"space-y-4",children:s.subscriptions.map((a,t)=>e.jsx(x,{className:"p-4 border-l-4 border-l-purple-500",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(r,{children:"Subscription Name"}),e.jsx(l,{value:a.name,onChange:n=>d(i,t,"name",n.target.value),placeholder:"subscription-name",className:T[`${i}-${t}`]?"border-destructive":""}),T[`${i}-${t}`]&&e.jsx(U,{variant:"destructive",className:"mt-2",children:e.jsx(Z,{children:T[`${i}-${t}`]})})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>ne(i,t),className:"ml-4",children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Active Messages"}),e.jsx("p",{className:"text-lg font-semibold",children:a.activeMessageCount||0})]})}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Lock Duration (seconds)"}),e.jsx(l,{type:"number",value:a.lockDuration,onChange:n=>d(i,t,"lockDuration",Number(n.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Max Delivery Count"}),e.jsx(l,{type:"number",value:a.maxDeliveryCount,onChange:n=>d(i,t,"maxDeliveryCount",Number(n.target.value))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Dead Letter on Expiration"}),e.jsx(v,{checked:a.enableDeadLetteringOnMessageExpiration,onCheckedChange:n=>d(i,t,"enableDeadLetteringOnMessageExpiration",n)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Requires Session"}),e.jsx(v,{checked:a.requiresSession||!1,onCheckedChange:n=>d(i,t,"requiresSession",n)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Forward To (queue/topic name)"}),e.jsx(l,{value:a.forwardTo||"",onChange:n=>d(i,t,"forwardTo",n.target.value||void 0),placeholder:"destination-queue-or-topic"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{children:"Enable Batched Operations"}),e.jsx(v,{checked:a.enableBatchedOperations||!1,onCheckedChange:n=>d(i,t,"enableBatchedOperations",n)})]}),e.jsx(D,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(r,{children:["Rules/Filters (",(a.rules||[]).length,")"]}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>{const n=a.rules||[],c={name:`rule-${n.length+1}`,filterType:"SQL",sqlFilter:""};d(i,t,"rules",[...n,c])},children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add Rule"]})]}),a.rules&&a.rules.length>0?e.jsx("div",{className:"space-y-2",children:a.rules.map((n,c)=>e.jsx(x,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{value:n.name,onChange:u=>{const o=[...a.rules||[]];o[c]={...n,name:u.target.value},d(i,t,"rules",o)},placeholder:"Rule name",className:"flex-1 mr-2"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>{const u=(a.rules||[]).filter((o,re)=>re!==c);d(i,t,"rules",u)},children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs($,{value:n.filterType,onValueChange:u=>{const o=[...a.rules||[]];o[c]={...n,filterType:u},d(i,t,"rules",o)},children:[e.jsx(H,{children:e.jsx(K,{})}),e.jsxs(_,{children:[e.jsx(M,{value:"SQL",children:"SQL Filter"}),e.jsx(M,{value:"Correlation",children:"Correlation Filter"})]})]}),n.filterType==="SQL"&&e.jsx(V,{value:n.sqlFilter||"",onChange:u=>{const o=[...a.rules||[]];o[c]={...n,sqlFilter:u.target.value},d(i,t,"rules",o)},placeholder:"SQL filter expression, e.g., user.type = 'premium'",rows:2}),n.filterType==="Correlation"&&e.jsx("div",{className:"space-y-2",children:e.jsx(l,{value:n.correlationFilter?.correlationId||"",onChange:u=>{const o=[...a.rules||[]];o[c]={...n,correlationFilter:{...n.correlationFilter,correlationId:u.target.value}},d(i,t,"rules",o)},placeholder:"Correlation ID"})})]})},c))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No rules (all messages will be delivered)"})]})]})},t))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No subscriptions"})]})]})]},i))})})]})}),e.jsx(L,{value:"connection",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Connection Settings"}),e.jsx(B,{children:"Azure Service Bus connection string"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Namespace"}),e.jsx(l,{value:k,onChange:s=>p({namespace:s.target.value}),placeholder:"my-namespace.servicebus.windows.net"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Connection String"}),e.jsx(V,{value:Y,onChange:s=>p({connectionString:s.target.value}),placeholder:"Endpoint=sb://...",rows:4})]})]})]})})]})]})})}export{ye as AzureServiceBusConfigAdvanced};
