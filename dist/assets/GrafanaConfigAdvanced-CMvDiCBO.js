import{K as Ue,u as ce,a as re,r as D,j as e,B as $,l as P,al as Be,am as He,an as Ke,aA as ie,C as _,h as M,i as R,m as E,S as ue,k as F,q as H,s as K,t as q,v as O,w as p,T as qe,b as Oe,c as X,D as je,a6 as pe,d as We,f as Y,L as w,I as Q,P as J,o as se,x as le,ai as Xe,y as Ye,z as Je,E as Ze,G as es,bb as ss}from"./index-HDGrDyRq.js";import{O as as}from"./profiles-DcjZ134_.js";import{C as G}from"./chart-column-P2BXSWww.js";import{R as ae,s as ge,T as te,L as ve,B as Ne,b as ye,C as be,X as we,Y as Ce,a as De}from"./LineChart-Cj16NB3Q.js";import{P as Ae,a as Pe}from"./PieChart-CK27OCfB.js";import{B as Se}from"./BarChart-DhtmkRt5.js";import{T as ts}from"./textarea-CjQgIquO.js";import"./value-DZlexiVD.js";const rs=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],ns=Ue("link",rs);let ls=class{nodes;getComponentMetrics;constructor(c,h){this.nodes=c,this.getComponentMetrics=h}executeQuery(c,h){const x=[],l=Date.now();if(c.includes("component_throughput_total")||c.includes("throughput"))this.nodes.forEach(t=>{const v=this.getComponentMetrics(t.id);v&&x.push({timestamp:l,value:v.throughput||0,labels:{component:t.data.label||t.type,component_id:t.id,component_type:t.type}})});else if(c.includes("component_latency_ms")||c.includes("latency"))this.nodes.forEach(t=>{const v=this.getComponentMetrics(t.id);v&&x.push({timestamp:l,value:v.latency||0,labels:{component:t.data.label||t.type,component_id:t.id,component_type:t.type}})});else if(c.includes("component_error_rate")||c.includes("error_rate"))this.nodes.forEach(t=>{const v=this.getComponentMetrics(t.id);v&&x.push({timestamp:l,value:(v.errorRate||0)*100,labels:{component:t.data.label||t.type,component_id:t.id,component_type:t.type}})});else if(c.includes("component_utilization")||c.includes("utilization"))this.nodes.forEach(t=>{const v=this.getComponentMetrics(t.id);v&&x.push({timestamp:l,value:(v.utilization||0)*100,labels:{component:t.data.label||t.type,component_id:t.id,component_type:t.type}})});else if(c.includes("up"))this.nodes.forEach(t=>{const v=this.getComponentMetrics(t.id);x.push({timestamp:l,value:v?1:0,labels:{component:t.data.label||t.type,component_id:t.id,component_type:t.type}})});else return[];return x}};function is({panel:d,executor:c,timeRange:h}){const[x,l]=D.useState([]),[t,v]=D.useState([]);D.useEffect(()=>{const N=[];d.queries.forEach((y,f)=>{c.executeQuery(y.expr,h).forEach(b=>{N.push({...b,series:y.legendFormat?y.legendFormat.replace("{{component}}",b.labels.component||"unknown"):`Series ${f+1}`,refId:y.refId})})}),l(N),v(y=>[...y,{timestamp:Date.now(),data:N}].slice(-50))},[d.queries,c,h]);const U=D.useMemo(()=>{if(d.type==="graph"||d.type==="bargraph"){const N=new Map;t.forEach((r,b)=>{r.data.forEach(j=>{const g=j.series||"default";N.has(g)||N.set(g,[]),N.get(g).push({time:b,value:j.value,timestamp:r.timestamp})})});const y=Math.max(...Array.from(N.values()).map(r=>r.length)),f=[];for(let r=0;r<y;r++){const b={time:r};N.forEach((j,g)=>{j[r]&&(b[g]=j[r].value)}),f.push(b)}return f}return x},[t,x,d.type]),V=()=>{switch(d.type){case"graph":case"bargraph":const N=d.type==="bargraph"?Se:ve,y=d.type==="bargraph"?Ne:ye;if(U.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground text-sm",children:"No data available"});const f=Array.from(new Set(x.map(a=>a.series))),r=["#8884d8","#82ca9d","#ffc658","#ff7300","#00ff00","#ff00ff"];return e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(N,{data:U,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(we,{dataKey:"time"}),e.jsx(Ce,{}),e.jsx(te,{}),e.jsx(De,{}),f.map((a,n)=>e.jsx(y,{type:"monotone",dataKey:a,stroke:r[n%r.length],fill:r[n%r.length]},a))]})});case"stat":const b=x.length>0?x.reduce((a,n)=>a+n.value,0)/x.length:0;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-4xl font-bold",children:b.toFixed(2)}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:d.title})]});case"gauge":const j=x.length>0?x.reduce((a,n)=>a+n.value,0)/x.length:0,g=Math.min(100,Math.max(0,j));return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"transform -rotate-90 w-32 h-32",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"none",className:"text-muted"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"none",strokeDasharray:`${2*Math.PI*56}`,strokeDashoffset:`${2*Math.PI*56*(1-g/100)}`,className:"text-primary transition-all"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-2xl font-bold",children:[g.toFixed(0),"%"]})})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:d.title})]});case"table":return e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Component"}),e.jsx("th",{className:"text-right p-2",children:"Value"})]})}),e.jsx("tbody",{children:x.map((a,n)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:a.labels?.component||"Unknown"}),e.jsx("td",{className:"text-right p-2",children:a.value.toFixed(2)})]},n))})]})});case"piechart":const L=x.map(a=>({name:a.labels?.component||"Unknown",value:a.value})),S=["#8884d8","#82ca9d","#ffc658","#ff7300","#00ff00","#ff00ff"];return e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Ae,{children:[e.jsx(Pe,{data:L,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:n})=>`${a}: ${(n*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:L.map((a,n)=>e.jsx(ge,{fill:S[n%S.length]},`cell-${n}`))}),e.jsx(te,{})]})});default:return e.jsxs("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:['Panel type "',d.type,'" not supported']})}};return e.jsxs(_,{className:"h-full",children:[e.jsx(M,{className:"pb-2",children:e.jsx(R,{className:"text-sm font-medium",children:d.title})}),e.jsx(E,{className:"h-[calc(100%-60px)]",children:V()})]})}function fe({componentId:d,dashboardId:c,onClose:h}){const{nodes:x}=ce(),{getComponentMetrics:l,isRunning:t}=re(),v=x.find(a=>a.id===d),N=((v?.data.config||{}).dashboards||[]).map(a=>typeof a.panels=="number"?{id:a.id||String(Date.now()),name:a.name||"Dashboard",panels:[],tags:Array.isArray(a.tags)?a.tags:[],refresh:a.refresh||"30s"}:a).filter(a=>a&&typeof a=="object"&&a.id),y=c?N.find(a=>a.id===c):N[0],[f,r]=D.useState({from:Date.now()-3e5,to:Date.now()}),[b,j]=D.useState(0),g=D.useMemo(()=>new ls(x,l),[x,l]);D.useEffect(()=>{if(!t||!y)return;const a=L(y.refresh||"30s"),n=setInterval(()=>{r({from:Date.now()-3e5,to:Date.now()}),j(o=>o+1)},a);return()=>clearInterval(n)},[t,y]);function L(a){const n=a.match(/^(\d+)([smhd])$/);if(!n)return 3e4;const o=parseInt(n[1]);switch(n[2]){case"s":return o*1e3;case"m":return o*60*1e3;case"h":return o*60*60*1e3;case"d":return o*24*60*60*1e3;default:return 3e4}}if(!v)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Grafana component not found"});if(N.length===0)return e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No dashboards configured"}),e.jsx("p",{className:"text-sm mt-2",children:"Configure dashboards in Grafana settings"})]});if(!y)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Dashboard not found"});const S=[...y.panels].sort((a,n)=>a.gridPos.y!==n.gridPos.y?a.gridPos.y-n.gridPos.y:a.gridPos.x-n.gridPos.x);return e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:y.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:y.tags.map((a,n)=>e.jsx($,{variant:"outline",className:"text-xs",children:a},n))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>{r({from:Date.now()-3e5,to:Date.now()}),j(a=>a+1)},children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Refresh"]}),h&&e.jsx(P,{size:"sm",variant:"ghost",onClick:h,children:e.jsx(He,{className:"h-4 w-4"})})]})]}),e.jsx(Ke,{className:"flex-1",children:e.jsx("div",{className:"p-4",children:S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No panels in this dashboard"})]}):e.jsx("div",{className:"grid grid-cols-12 gap-4",children:S.map(a=>e.jsx("div",{className:"col-span-12",style:{gridColumn:`span ${Math.min(12,a.gridPos.w||12)}`,minHeight:`${(a.gridPos.h||8)*40}px`},children:e.jsx(is,{panel:a,executor:g,timeRange:f},`${a.id}-${b}`)},a.id))})})}),!t&&e.jsx("div",{className:"p-2 bg-yellow-500/10 border-t border-yellow-500/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-600",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Simulation is not running. Start emulation to see live data."})]})})]})}class cs{nodes;getComponentMetrics;constructor(c,h){this.nodes=c,this.getComponentMetrics=h}executeQuery(c){const h=[],x=Date.now();return c.includes("component_throughput_total")||c.includes("throughput")?this.nodes.forEach(l=>{const t=this.getComponentMetrics(l.id);t&&h.push({timestamp:x,value:t.throughput||0,labels:{component:l.data.label||l.type,component_id:l.id,component_type:l.type}})}):c.includes("component_latency_ms")||c.includes("latency")?this.nodes.forEach(l=>{const t=this.getComponentMetrics(l.id);t&&h.push({timestamp:x,value:t.latency||0,labels:{component:l.data.label||l.type,component_id:l.id,component_type:l.type}})}):c.includes("component_error_rate")||c.includes("error_rate")?this.nodes.forEach(l=>{const t=this.getComponentMetrics(l.id);t&&h.push({timestamp:x,value:(t.errorRate||0)*100,labels:{component:l.data.label||l.type,component_id:l.id,component_type:l.type}})}):c.includes("component_utilization")||c.includes("utilization")?this.nodes.forEach(l=>{const t=this.getComponentMetrics(l.id);t&&h.push({timestamp:x,value:(t.utilization||0)*100,labels:{component:l.data.label||l.type,component_id:l.id,component_type:l.type}})}):c.includes("up")&&this.nodes.forEach(l=>{const t=this.getComponentMetrics(l.id);h.push({timestamp:x,value:t?1:0,labels:{component:l.data.label||l.type,component_id:l.id,component_type:l.type}})}),h}}function os({panel:d,executor:c}){const[h,x]=D.useState([]),[l,t]=D.useState([]),{isRunning:v}=re(),[U,V]=D.useState(0);D.useEffect(()=>{const f=[];d.queries.forEach((r,b)=>{c.executeQuery(r.expr).forEach(g=>{f.push({...g,series:r.legendFormat?r.legendFormat.replace("{{component}}",g.labels.component||"unknown"):`Series ${b+1}`})})}),x(f),t(r=>[...r,{timestamp:Date.now(),data:f}].slice(-20))},[d.queries,c,U]),D.useEffect(()=>{if(!v)return;const f=setInterval(()=>{V(r=>r+1)},1e3);return()=>clearInterval(f)},[v]);const N=D.useMemo(()=>{if(d.type==="graph"||d.type==="bargraph"){const f=new Map;l.forEach((j,g)=>{j.data.forEach(L=>{const S=L.series||"default";f.has(S)||f.set(S,[]),f.get(S).push({time:g,value:L.value})})});const r=Math.max(...Array.from(f.values()).map(j=>j.length),0),b=[];for(let j=0;j<r;j++){const g={time:j};f.forEach((L,S)=>{L[j]&&(g[S]=L[j].value)}),b.push(g)}return b}return h},[l,h,d.type]),y=()=>{switch(d.type){case"graph":case"bargraph":const f=d.type==="bargraph"?Se:ve,r=d.type==="bargraph"?Ne:ye;if(N.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground text-xs",children:"No data"});const b=Array.from(new Set(h.map(o=>o.series))),j=["#8884d8","#82ca9d","#ffc658","#ff7300"];return e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(f,{data:N,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(we,{dataKey:"time",stroke:"rgba(255,255,255,0.5)"}),e.jsx(Ce,{stroke:"rgba(255,255,255,0.5)"}),e.jsx(te,{contentStyle:{backgroundColor:"rgba(0,0,0,0.8)",border:"1px solid rgba(255,255,255,0.1)"}}),e.jsx(De,{wrapperStyle:{fontSize:"12px"}}),b.map((o,T)=>e.jsx(r,{type:"monotone",dataKey:o,stroke:j[T%j.length],fill:j[T%j.length],strokeWidth:2},o))]})});case"stat":const g=h.length>0?h.reduce((o,T)=>o+T.value,0)/h.length:0;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:g.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:d.title})]});case"gauge":const L=h.length>0?h.reduce((o,T)=>o+T.value,0)/h.length:0,S=Math.min(100,Math.max(0,L));return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative w-24 h-24",children:[e.jsxs("svg",{className:"transform -rotate-90 w-24 h-24",children:[e.jsx("circle",{cx:"48",cy:"48",r:"42",stroke:"currentColor",strokeWidth:"6",fill:"none",className:"text-muted opacity-30"}),e.jsx("circle",{cx:"48",cy:"48",r:"42",stroke:"currentColor",strokeWidth:"6",fill:"none",strokeDasharray:`${2*Math.PI*42}`,strokeDashoffset:`${2*Math.PI*42*(1-S/100)}`,className:"text-orange-500 transition-all"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-xl font-bold",children:[S.toFixed(0),"%"]})})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:d.title})]});case"table":return e.jsx("div",{className:"h-full overflow-auto text-xs",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-1",children:"Component"}),e.jsx("th",{className:"text-right p-1",children:"Value"})]})}),e.jsx("tbody",{children:h.slice(0,5).map((o,T)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-1",children:o.labels?.component||"Unknown"}),e.jsx("td",{className:"text-right p-1",children:o.value.toFixed(1)})]},T))})]})});case"piechart":const a=h.slice(0,5).map(o=>({name:o.labels?.component||"Unknown",value:o.value})),n=["#8884d8","#82ca9d","#ffc658","#ff7300","#00ff00"];return e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Ae,{children:[e.jsx(Pe,{data:a,cx:"50%",cy:"50%",labelLine:!1,label:({percent:o})=>`${(o*100).toFixed(0)}%`,outerRadius:60,fill:"#8884d8",dataKey:"value",children:a.map((o,T)=>e.jsx(ge,{fill:n[T%n.length]},`cell-${T}`))}),e.jsx(te,{})]})});default:return e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground text-xs",children:d.type})}};return e.jsxs(_,{className:"h-full",children:[e.jsx(M,{className:"pb-2",children:e.jsx(R,{className:"text-sm font-medium",children:d.title})}),e.jsx(E,{className:"h-[calc(100%-50px)]",children:y()})]})}function ds({componentId:d,dashboardId:c}){const{nodes:h}=ce(),{getComponentMetrics:x,isRunning:l}=re(),N=((h.find(r=>r.id===d)?.data.config||{}).dashboards||[]).map(r=>typeof r.panels=="number"?{id:r.id,name:r.name,panels:[],tags:[]}:r).filter(r=>r&&typeof r=="object"&&r.id).find(r=>r.id===c),y=D.useMemo(()=>new cs(h,x),[h,x]);if(D.useEffect(()=>{if(!l)return;const r=setInterval(()=>{},1e3);return()=>clearInterval(r)},[l]),!N||N.panels.length===0)return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"No panels in this dashboard"})});const f=N.panels.slice(0,4);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:f.map(r=>e.jsx("div",{className:"h-48",children:e.jsx(os,{panel:r,executor:y})},r.id))}),N.panels.length>4&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["+",N.panels.length-4,' more panels. Click "Open Dashboard" to view all.']}),!l&&e.jsx("div",{className:"text-center text-xs text-yellow-600 bg-yellow-500/10 p-2 rounded",children:"Start emulation to see live data"})]})}function ys({componentId:d}){const[c,h]=D.useState(null),[x,l]=D.useState(null),[t,v]=D.useState(!1),[U,V]=D.useState(!1),[N,y]=D.useState(!1),[f,r]=D.useState(!1),[b,j]=D.useState(void 0);try{const{nodes:g,updateNode:L}=ce(),{isRunning:S}=re(),a=g.find(s=>s.id===d);if(!a)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const n=a.data.config||{},o=as.grafana.defaults,T=n.adminUser||o.adminUser,ke=n.adminPassword||o.adminPassword;let z=[];Array.isArray(n.datasources)&&(n.datasources.length>0&&typeof n.datasources[0]=="string"?z=n.datasources.map(s=>({name:s,type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:s===n.datasources[0]})):z=n.datasources.filter(s=>s&&typeof s=="object"&&s.name)),z.length===0&&(z=[{name:Array.isArray(o.datasources)&&o.datasources.length>0&&typeof o.datasources[0]=="string"?o.datasources[0]:"Prometheus",type:"prometheus",url:"http://localhost:9090",access:"proxy",isDefault:!0}]);let C=[];Array.isArray(n.dashboards)&&(C=n.dashboards.map(s=>{if(s&&typeof s=="object"){if(typeof s.panels=="number")return{...s,panels:[],tags:Array.isArray(s.tags)?s.tags:[]};if(Array.isArray(s.panels))return{...s,panels:s.panels.map(u=>({id:u.id||`panel-${Date.now()}`,title:u.title||"Panel",type:u.type||"graph",datasource:u.datasource||z[0]?.name||"Prometheus",queries:Array.isArray(u.queries)?u.queries:[{refId:"A",expr:"up"}],gridPos:u.gridPos||{x:0,y:0,w:12,h:8}})),tags:Array.isArray(s.tags)?s.tags:[]}}return s}).filter(s=>s&&typeof s=="object"&&s.id)),C.length===0&&(C=[]);const Z=Array.isArray(n.alerts)?n.alerts.filter(s=>s&&typeof s=="object"&&s.id):[],oe=n.defaultDashboard||o.defaultDashboard,de=n.enableAuth??o.enableAuth,Ee=n.authProvider||o.authProvider,he=n.enableAlerting??o.enableAlerting,_e=Array.isArray(n.alertNotificationChannels)?n.alertNotificationChannels:Array.isArray(o.alertNotificationChannels)?o.alertNotificationChannels:["email","slack"],hs=n.theme||o.theme,k=s=>{L(d,{data:{...a.data,config:{...n,...s}}})},Me=()=>{const s={name:"New Data Source",type:"prometheus",url:"http://localhost:9090",access:"proxy"};k({datasources:[...z,s]}),y(!1)},Le=s=>{k({datasources:z.filter((u,i)=>i!==s)})},ee=(s,u,i)=>{const m=[...z];m[s]={...m[s],[u]:i},k({datasources:m})},Te=()=>{const s={id:String(Date.now()),name:"New Dashboard",panels:[],tags:[],refresh:"30s"};k({dashboards:[...C,s]}),v(!1)},Re=s=>{k({dashboards:C.filter((u,i)=>i!==s)})},ze=s=>{const u=z&&z.length>0?z[0].name:"Prometheus",i={id:`panel-${Date.now()}`,title:"New Panel",type:"graph",datasource:u,queries:[{refId:"A",expr:"up",legendFormat:"{{instance}}"}],gridPos:{x:0,y:0,w:12,h:8}},m=C.map(A=>A.id===s?{...A,panels:[...A.panels,i]}:A);k({dashboards:m})},Ie=(s,u)=>{const i=C.map(m=>m.id===s?{...m,panels:m.panels.filter(A=>A.id!==u)}:m);k({dashboards:i})},ne=(s,u,i,m)=>{const A=C.map(I=>I.id===s?{...I,panels:I.panels.map(B=>B.id===u?{...B,[i]:m}:B)}:I);k({dashboards:A})},Qe=(s,u)=>{const i=C.map(m=>m.id===s?{...m,panels:m.panels.map(A=>{if(A.id===u){const I=Array.isArray(A.queries)?A.queries:[];return{...A,queries:[...I,{refId:String.fromCharCode(65+I.length),expr:"",legendFormat:""}]}}return A})}:m);k({dashboards:i})},me=(s,u,i,m,A)=>{const I=C.map(B=>B.id===s?{...B,panels:B.panels.map(W=>{if(W.id===u){const $e=Array.isArray(W.queries)?W.queries:[];return{...W,queries:$e.map((xe,Ge)=>Ge===i?{...xe,[m]:A}:xe)}}return W})}:B);k({dashboards:I})},Fe=()=>{const s={id:`alert-${Date.now()}`,name:"New Alert",condition:{query:"up == 0",evaluator:{type:"gt",params:[0]},reducer:{type:"last",params:[]}},for:"5m",annotations:{summary:"Alert triggered",description:"Service is down"},notificationChannels:_e.slice(0,1)};k({alerts:[...Z,s]}),V(!1)},Ve=s=>{k({alerts:Z.filter(u=>u.id!==s)})};return e.jsxs("div",{className:"h-full overflow-y-auto bg-background",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(G,{className:"h-6 w-6 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Grafana"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Analytics & Monitoring Platform"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${S?"bg-green-500 animate-pulse":"bg-gray-400"}`}),S?"Running":"Stopped"]}),e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>{j(oe==="overview"?C[0]?.id:C.find(s=>s.id===oe)?.id),r(!0)},children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Open Dashboard"]})]})]}),e.jsx(ue,{}),e.jsxs(_,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Live Dashboard Preview"}),e.jsx(F,{children:"Real-time metrics from configured dashboards"})]}),C.length>0&&e.jsxs(H,{value:b||C[0]?.id,onValueChange:s=>j(s),children:[e.jsx(K,{className:"w-48",children:e.jsx(q,{})}),e.jsx(O,{children:C.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))})]})]})}),e.jsx(E,{children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No dashboards configured"}),e.jsx("p",{className:"text-sm mt-2",children:"Create a dashboard to see live metrics here"})]}):e.jsx(ds,{componentId:d,dashboardId:b||C[0]?.id})})]}),e.jsxs(qe,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Oe,{className:"grid w-full grid-cols-5",children:[e.jsxs(X,{value:"dashboard",className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(X,{value:"datasources",className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Data Sources"]}),e.jsxs(X,{value:"dashboards",className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Dashboards"]}),e.jsxs(X,{value:"alerts",className:"gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Alerts"]}),e.jsxs(X,{value:"settings",className:"gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(Y,{value:"dashboard",className:"space-y-4 mt-4",children:e.jsxs(_,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Live Dashboard"}),e.jsx(F,{children:"Real-time metrics visualization"})]}),C.length>0&&e.jsxs(H,{value:b||C[0]?.id,onValueChange:s=>j(s),children:[e.jsx(K,{className:"w-48",children:e.jsx(q,{})}),e.jsx(O,{children:C.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))})]})]})}),e.jsx(E,{children:C.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(G,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No dashboards configured"}),e.jsx("p",{className:"text-sm mt-2",children:'Create a dashboard in the "Dashboards" tab'})]}):e.jsx("div",{className:"h-[600px] border rounded-lg overflow-hidden",children:e.jsx(fe,{componentId:d,dashboardId:b||C[0]?.id})})})]})}),e.jsxs(Y,{value:"datasources",className:"space-y-4 mt-4",children:[N&&e.jsxs(_,{className:"mb-4 border-primary",children:[e.jsxs(M,{children:[e.jsx(R,{children:"Create Data Source"}),e.jsx(F,{children:"Configure connection to metrics/logs database"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Name"}),e.jsx(Q,{placeholder:"Prometheus"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Type"}),e.jsxs(H,{defaultValue:"prometheus",children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"prometheus",children:"Prometheus"}),e.jsx(p,{value:"loki",children:"Loki"}),e.jsx(p,{value:"influxdb",children:"InfluxDB"}),e.jsx(p,{value:"elasticsearch",children:"Elasticsearch"}),e.jsx(p,{value:"postgres",children:"PostgreSQL"}),e.jsx(p,{value:"mysql",children:"MySQL"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"URL"}),e.jsx(Q,{placeholder:"http://localhost:9090"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{onClick:Me,children:"Create Data Source"}),e.jsx(P,{variant:"outline",onClick:()=>y(!1),children:"Cancel"})]})]})]}),e.jsxs(_,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Data Sources"}),e.jsx(F,{children:"Configure data sources for metrics and logs"})]}),e.jsxs(P,{size:"sm",onClick:()=>y(!0),variant:"outline",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Data Source"]})]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:z.map((s,u)=>e.jsxs(_,{className:"border-border",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(je,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(R,{className:"text-lg",children:s.name}),e.jsxs(F,{className:"text-xs mt-1",children:[s.type," • ",s.url,s.isDefault&&e.jsx($,{variant:"outline",className:"ml-2",children:"Default"})]})]})]}),e.jsx(P,{size:"icon",variant:"ghost",onClick:()=>Le(u),children:e.jsx(se,{className:"h-4 w-4"})})]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Name"}),e.jsx(Q,{value:s.name,onChange:i=>ee(u,"name",i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Type"}),e.jsxs(H,{value:s.type,onValueChange:i=>ee(u,"type",i),children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"prometheus",children:"Prometheus"}),e.jsx(p,{value:"loki",children:"Loki"}),e.jsx(p,{value:"influxdb",children:"InfluxDB"}),e.jsx(p,{value:"elasticsearch",children:"Elasticsearch"}),e.jsx(p,{value:"postgres",children:"PostgreSQL"}),e.jsx(p,{value:"mysql",children:"MySQL"}),e.jsx(p,{value:"jaeger",children:"Jaeger"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"URL"}),e.jsx(Q,{value:s.url,onChange:i=>ee(u,"url",i.target.value),placeholder:"http://localhost:9090"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{checked:s.isDefault||!1,onCheckedChange:i=>ee(u,"isDefault",i)}),e.jsx(w,{children:"Set as default"})]})]})]},u))})})]})]}),e.jsxs(Y,{value:"dashboards",className:"space-y-4 mt-4",children:[t&&e.jsxs(_,{className:"mb-4 border-primary",children:[e.jsxs(M,{children:[e.jsx(R,{children:"Create Dashboard"}),e.jsx(F,{children:"Configure dashboard settings"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Dashboard Name"}),e.jsx(Q,{placeholder:"My Dashboard"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{onClick:Te,children:"Create Dashboard"}),e.jsx(P,{variant:"outline",onClick:()=>v(!1),children:"Cancel"})]})]})]}),e.jsxs(_,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Dashboards"}),e.jsx(F,{children:"Manage and configure dashboards"})]}),e.jsxs(P,{size:"sm",onClick:()=>v(!0),variant:"outline",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Create Dashboard"]})]})}),e.jsx(E,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:C.map((s,u)=>e.jsxs(_,{className:"border-border hover:border-primary/50 transition-colors cursor-pointer",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(R,{className:"text-base",children:s.name})]}),C.length>1&&e.jsx(P,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>Re(u),children:e.jsx(se,{className:"h-3 w-3"})})]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Panels:"}),e.jsx("span",{className:"font-semibold",children:Array.isArray(s.panels)?s.panels.length:0})]}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:s.tags.map((i,m)=>e.jsx($,{variant:"outline",className:"text-xs",children:i},m))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(P,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>h(c===s.id?null:s.id),children:[e.jsx(Xe,{className:"h-3 w-3 mr-2"}),c===s.id?"Hide":"Edit"]}),e.jsxs(P,{size:"sm",variant:"default",className:"flex-1",onClick:()=>{j(s.id),r(!0)},children:[e.jsx(pe,{className:"h-3 w-3 mr-2"}),"View"]})]})]})}),c===s.id&&e.jsx(E,{className:"pt-0 border-t",children:e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{className:"text-sm font-semibold",children:"Panels"}),e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>ze(s.id),children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Add Panel"]})]}),!Array.isArray(s.panels)||s.panels.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground text-sm",children:'No panels. Click "Add Panel" to create one.'}):s.panels.map(i=>e.jsxs(_,{className:"border-border",children:[e.jsx(M,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"outline",children:i.type}),e.jsx(Q,{value:i.title,onChange:m=>ne(s.id,i.id,"title",m.target.value),className:"h-7 flex-1"})]}),e.jsx(P,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>Ie(s.id,i.id),children:e.jsx(se,{className:"h-3 w-3"})})]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Type"}),e.jsxs(H,{value:i.type,onValueChange:m=>ne(s.id,i.id,"type",m),children:[e.jsx(K,{className:"h-7",children:e.jsx(q,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"graph",children:"Graph"}),e.jsx(p,{value:"table",children:"Table"}),e.jsx(p,{value:"stat",children:"Stat"}),e.jsx(p,{value:"gauge",children:"Gauge"}),e.jsx(p,{value:"piechart",children:"Pie Chart"}),e.jsx(p,{value:"bargraph",children:"Bar Graph"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Data Source"}),e.jsxs(H,{value:i.datasource,onValueChange:m=>ne(s.id,i.id,"datasource",m),children:[e.jsx(K,{className:"h-7",children:e.jsx(q,{})}),e.jsx(O,{children:z.map(m=>e.jsx(p,{value:m.name,children:m.name},m.name))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{className:"text-xs",children:"Queries (PromQL/LogQL)"}),e.jsxs(P,{size:"sm",variant:"ghost",className:"h-6",onClick:()=>Qe(s.id,i.id),children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Add Query"]})]}),Array.isArray(i.queries)&&i.queries.length>0?i.queries.map((m,A)=>e.jsxs("div",{className:"space-y-1 p-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"secondary",className:"text-xs",children:m.refId||"A"}),e.jsx(Q,{value:m.expr||"",onChange:I=>me(s.id,i.id,A,"expr",I.target.value),placeholder:"up or {job='api'} |= 'error'",className:"h-7 text-xs font-mono"})]}),e.jsx(Q,{value:m.legendFormat||"",onChange:I=>me(s.id,i.id,A,"legendFormat",I.target.value),placeholder:"Legend format: {{instance}}",className:"h-6 text-xs"})]},A)):e.jsx("div",{className:"text-center py-2 text-xs text-muted-foreground",children:'No queries. Click "Add Query" to add one.'})]})]})]},i.id))]})})]},u))})})]})]}),e.jsxs(Y,{value:"alerts",className:"space-y-4 mt-4",children:[U&&e.jsxs(_,{className:"mb-4 border-primary",children:[e.jsxs(M,{children:[e.jsx(R,{children:"Create Alert Rule"}),e.jsx(F,{children:"Configure alert conditions and notifications"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Alert Name"}),e.jsx(Q,{placeholder:"High CPU Usage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"PromQL Query"}),e.jsx(ts,{placeholder:"rate(process_cpu_seconds_total[5m]) > 0.8",className:"font-mono text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Condition"}),e.jsxs(H,{defaultValue:"gt",children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"gt",children:"Greater Than"}),e.jsx(p,{value:"lt",children:"Less Than"}),e.jsx(p,{value:"eq",children:"Equal"}),e.jsx(p,{value:"ne",children:"Not Equal"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Threshold"}),e.jsx(Q,{type:"number",placeholder:"0.8"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{onClick:Fe,children:"Create Alert"}),e.jsx(P,{variant:"outline",onClick:()=>V(!1),children:"Cancel"})]})]})]}),e.jsxs(_,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Alert Rules"}),e.jsx(F,{children:"Configure alert conditions and notifications"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{checked:he,onCheckedChange:s=>k({enableAlerting:s})}),e.jsxs(P,{size:"sm",onClick:()=>V(!0),variant:"outline",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Create Alert"]})]})]})}),e.jsx(E,{children:he?Z.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:'No alert rules configured. Click "Create Alert" to add one.'})]}):e.jsx("div",{className:"space-y-3",children:Z.map(s=>e.jsxs(_,{className:"border-border",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-lg",children:s.name}),e.jsxs(F,{className:"text-xs mt-1",children:["For: ",s.for," • Channels: ",s.notificationChannels.join(", ")]})]}),e.jsx(P,{size:"icon",variant:"ghost",onClick:()=>Ve(s.id),children:e.jsx(se,{className:"h-4 w-4"})})]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-xs",children:"PromQL Query"}),e.jsx("div",{className:"p-2 bg-muted rounded font-mono text-sm",children:s.condition.query})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Evaluator"}),e.jsx($,{variant:"outline",children:s.condition.evaluator.type})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Threshold"}),e.jsx($,{variant:"outline",children:s.condition.evaluator.params.join(", ")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Reducer"}),e.jsx($,{variant:"outline",children:s.condition.reducer.type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-xs",children:"Summary"}),e.jsx("div",{className:"text-sm",children:s.annotations.summary}),s.annotations.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.annotations.description})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Alerting is disabled. Enable it to create alert rules."})]})})]})]}),e.jsx(Y,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(_,{children:[e.jsxs(M,{children:[e.jsx(R,{children:"Administration"}),e.jsx(F,{children:"Grafana server configuration"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"admin-user",children:"Admin Username"}),e.jsx(Q,{id:"admin-user",value:T,onChange:s=>k({adminUser:s.target.value}),placeholder:"admin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"admin-password",children:"Admin Password"}),e.jsx(Q,{id:"admin-password",type:"password",value:ke,onChange:s=>k({adminPassword:s.target.value}),placeholder:"admin"})]})]}),e.jsx(ue,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{children:"Enable Authentication"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Require login to access Grafana"})]}),e.jsx(le,{checked:de,onCheckedChange:s=>k({enableAuth:s})})]}),de&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Auth Provider"}),e.jsxs(H,{value:Ee,onValueChange:s=>k({authProvider:s}),children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(O,{children:[e.jsx(p,{value:"ldap",children:"LDAP"}),e.jsx(p,{value:"oauth",children:"OAuth"}),e.jsx(p,{value:"saml",children:"SAML"}),e.jsx(p,{value:"jwt",children:"JWT"})]})]})]})]})]})})]})]}),e.jsx(Ye,{open:f,onOpenChange:r,children:e.jsxs(Je,{className:"max-w-[95vw] max-h-[95vh] w-full h-full p-0",children:[e.jsx(Ze,{className:"sr-only",children:e.jsx(es,{children:"Grafana Dashboard"})}),e.jsx("div",{className:"h-full",children:e.jsx(fe,{componentId:d,dashboardId:b,onClose:()=>r(!1)})})]})})]})}catch(g){return ss("Error rendering GrafanaConfigAdvanced",g instanceof Error?g:new Error(String(g))),e.jsxs("div",{className:"p-4 text-destructive",children:[e.jsx("p",{children:"Error loading Grafana configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:String(g)})]})}}export{ys as GrafanaConfigAdvanced};
