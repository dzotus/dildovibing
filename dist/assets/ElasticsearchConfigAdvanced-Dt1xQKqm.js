import{u as Te,j as e,V as Y,r as w,K as ke,B as I,i as u,S as R,C as i,e as h,f as x,k as c,T as ze,a as De,b as T,F as Qe,c as Re,d as k,h as S,P as B,m as O,L as m,I as N,l as L,N as Le,t as Z}from"./index-D1p3qKk1.js";import{T as Ae}from"./textarea-Cbj5d7Ql.js";import{a as A,s as ee}from"./toast-CZBBazh_.js";import{R as Fe}from"./refresh-ccw-BoEyyRRQ.js";import{C as He}from"./code-CvmuBIIH.js";import{D as Pe}from"./database-DCvPvYtR.js";import{S as $e}from"./shield-Czxogl5B.js";function We({componentId:y}){const{nodes:se,updateNode:ae,connections:te}=Te(),F=se.find(s=>s.id===y);if(!F)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const r=F.data.config||{},re=r.clusterName||"archiphoenix-cluster",j=r.nodes||["localhost:9200"],le=r.index||"archiphoenix-index",ne=r.shards||5,ie=r.replicas||1,ce=r.refreshInterval||"1s",de=r.enableSSL??!1,J=r.enableAuth??!1,oe=r.username||"elastic",he=r.password||"",g=r.indices||[],z=r.queries||[],G=te.some(s=>s.source===y||s.target===y),C=Y.elasticsearchRoutingEngines?.get(y),M=C?.getMetrics();let p=r.clusterHealth||"green";M?p=M.clusterHealth:G||(p="yellow");const xe=r.activeShards||10,me=r.relocatingShards||0;r.initializingShards;const ue=r.totalDocs||g.reduce((s,a)=>s+a.docs,0),je=r.totalSize||g.reduce((s,a)=>s+a.size,0),[U,W]=w.useState(null),[ge,H]=w.useState(!1),[f,P]=w.useState(""),[E,b]=w.useState(""),[D,$]=w.useState(""),fe=()=>{const s=Y.elasticsearchRoutingEngines?.get(y);if(!s){ee("Elasticsearch engine not initialized. Please start emulation first.");return}const a=s.getMetrics(),t=s.getIndices(),n=s.getRecentQueries(100),d=t.map(o=>{const X=g.find(Ie=>Ie.name===o.name);return{...o,shards:X?.shards??o.shards,replicas:X?.replicas??o.replicas}});l({indices:d.length>0?d:g,queries:n.map(o=>({id:`query-${Date.now()}-${Math.random()}`,query:JSON.stringify(o.query||o.queryString||"",null,2),status:o.success?"success":"error",duration:o.latency,hits:o.hits,took:o.took})).slice(0,100),clusterHealth:a.clusterHealth,activeShards:a.activeShards,relocatingShards:a.relocatingShards,initializingShards:a.initializingShards,totalDocs:a.totalDocs,totalSize:a.totalSize}),A("Elasticsearch metrics refreshed")},l=s=>{if(ae(y,{data:{...F.data,config:{...r,...s}}}),s.nodes!==void 0){const a={...v};a.nodes&&delete a.nodes,Q(a)}},[v,Q]=w.useState({}),q=()=>{if(!j||j.length===0)return Q({...v,nodes:"Необходимо указать хотя бы один узел"}),!1;if(j.filter(t=>{if(!t||!t.trim())return!0;const n=t.trim().split(":");if(n.length!==2)return!0;const d=parseInt(n[1]);return isNaN(d)||d<=0||d>65535}).length>0)return Q({...v,nodes:"Неверный формат узла. Используйте формат host:port"}),!1;const a={...v};return a.nodes&&delete a.nodes,Q(a),!0},ve=()=>q(),_=s=>s.trim()?/^-1$|^\d+[smhd]$/i.test(s.trim())?($(""),!0):($("Invalid format. Use format like: 1s, 5m, 1h, or -1 to disable"),!1):($("Refresh interval cannot be empty"),!1),Ne=()=>{l({nodes:[...j,"localhost:9201"]})},pe=s=>{l({nodes:j.filter((a,t)=>t!==s)})},ye=(s,a)=>{const t=[...j];t[s]=a,l({nodes:t})},be=()=>{l({indices:[...g,{name:"new-index",docs:0,size:0,shards:1,replicas:1,health:"yellow"}]})},we=s=>{l({indices:g.filter((a,t)=>t!==s)})},V=(s,a,t)=>{const n=[...g];n[s]={...n[s],[a]:t},l({indices:n})},K=s=>{if(!s.trim())return{valid:!1,error:"Query cannot be empty"};const a=s.trim();if(a.startsWith("{")||a.startsWith("["))try{JSON.parse(a)}catch{return{valid:!1,error:"Invalid JSON format"}}const t=a.split(`
`);if(t.length>1){if(!t[0].trim().match(/^(GET|POST|PUT|DELETE)\s+/))return{valid:!1,error:"API call format should start with HTTP method (GET, POST, PUT, DELETE)"};if(t.length>1){const d=t.slice(1).join(`
`).trim();if(d&&(d.startsWith("{")||d.startsWith("[")))try{JSON.parse(d)}catch{return{valid:!1,error:"Invalid JSON in request body"}}}}return{valid:!0}},Se=()=>{if(!f.trim()){b("Query cannot be empty");return}const s=K(f);if(!s.valid){b(s.error||"Invalid query format");return}b("");let a=null;if(C)try{const t=C.executeQuery(f);a={id:`query-${Date.now()}`,query:f,status:t.success?"success":"error",duration:t.latency||t.took||0,hits:t.hits,took:t.took}}catch{a={id:`query-${Date.now()}`,query:f,status:"error",duration:0,hits:0,took:0}}else a={id:`query-${Date.now()}`,query:f,status:"running",duration:0,hits:0,took:0};a&&(l({queries:[a,...z.slice(0,99)]}),P(""),H(!1),A("Query executed"))},Ce=s=>{l({queries:z.filter(a=>a.id!==s)}),A("Query deleted")},Ee=s=>{switch(s){case"green":return"bg-green-500";case"yellow":return"bg-yellow-500";case"red":return"bg-red-500";default:return"bg-gray-500"}};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(ke,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Elasticsearch"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Distributed Search & Analytics Engine"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(I,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${p==="green"?"bg-green-500":p==="yellow"?"bg-yellow-500":"bg-red-500"} animate-pulse`}),p==="green"?"Healthy":p==="yellow"?"Degraded":"Unhealthy"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:fe,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Indices"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total indices"})]})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Documents"})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(ue/1e6).toFixed(1),"M"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total documents"})]})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Size"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:je.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"GB"})]})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Nodes"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Cluster nodes"})]})]})]}),e.jsxs(ze,{defaultValue:"indices",className:"w-full",children:[e.jsxs(De,{className:"grid w-full grid-cols-5",children:[e.jsxs(T,{value:"indices",className:"gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Indices"]}),e.jsxs(T,{value:"devtools",className:"gap-2",children:[e.jsx(He,{className:"h-4 w-4"}),"Dev Tools"]}),e.jsxs(T,{value:"cluster",className:"gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Cluster"]}),e.jsxs(T,{value:"security",className:"gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Security"]}),e.jsxs(T,{value:"settings",className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(k,{value:"indices",className:"space-y-4 mt-4",children:e.jsxs(i,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Indices"}),e.jsx(S,{children:"Elasticsearch index configuration"})]}),e.jsxs(u,{size:"sm",onClick:be,variant:"outline",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Index"]})]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:g.map((s,a)=>{let t=s.health;if(C){const d=C.getIndices().find(o=>o.name===s.name);d&&(t=d.health)}else G||(t="yellow");return e.jsxs(i,{className:"border-border",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${Ee(t)}`}),e.jsxs("div",{children:[e.jsx(x,{className:"text-lg",children:s.name}),e.jsxs(S,{className:"text-xs mt-1",children:[s.shards," shards • ",s.replicas," replicas • Health: ",t]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:t==="green"?"default":t==="yellow"?"secondary":"destructive",children:t}),g.length>1&&e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>we(a),children:e.jsx(O,{className:"h-4 w-4"})})]})]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Documents:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.docs.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Size:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[s.size," GB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shards:"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.shards})]})]}),U===a&&e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Number of Shards"}),e.jsx(N,{type:"number",value:s.shards,onChange:n=>V(a,"shards",Number(n.target.value)),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Number of Replicas"}),e.jsx(N,{type:"number",value:s.replicas,onChange:n=>V(a,"replicas",Number(n.target.value)),min:0})]})]}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>W(null),children:"Done"})]}),U!==a&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>W(a),children:"Edit Settings"})]})]},a)})})})]})}),e.jsx(k,{value:"devtools",className:"space-y-4 mt-4",children:e.jsxs(i,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Dev Tools"}),e.jsx(S,{children:"Execute Elasticsearch queries and API calls"})]}),e.jsxs(u,{size:"sm",onClick:()=>H(!0),variant:"outline",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"New Query"]})]})}),e.jsxs(c,{children:[ge&&e.jsxs(i,{className:"mb-4 border-primary",children:[e.jsx(h,{children:e.jsx(x,{children:"Execute Query"})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Query (JSON or Elasticsearch API)"}),e.jsx(Ae,{value:f,onChange:s=>{P(s.target.value),E&&b("")},onBlur:()=>{if(f.trim()){const s=K(f);s.valid||b(s.error||"Invalid query format")}},placeholder:'GET /_search\\n{\\n  "query": {\\n    "match_all": {}\\n  }\\n}',rows:8,className:`font-mono text-sm ${E?"border-destructive":""}`}),E&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:E})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{onClick:Se,disabled:!f.trim()||!!E,children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Execute"]}),e.jsx(u,{variant:"outline",onClick:()=>{H(!1),P(""),b("")},children:"Cancel"})]})]})]}),z.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No queries executed"}):e.jsx("div",{className:"space-y-2",children:z.map(s=>e.jsx(i,{className:"border-l-4 border-l-blue-500",children:e.jsx(c,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{variant:s.status==="success"?"default":s.status==="error"?"destructive":"secondary",children:s.status}),s.took!==void 0&&e.jsxs(I,{variant:"outline",children:[s.took,"ms"]}),s.hits!==void 0&&e.jsxs(I,{variant:"outline",children:[s.hits," hits"]})]}),e.jsx("pre",{className:"text-xs font-mono bg-muted p-2 rounded overflow-x-auto",children:s.query})]}),e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>Ce(s.id),className:"ml-2",children:e.jsx(O,{className:"h-4 w-4"})})]})})},s.id))})]})]})}),e.jsx(k,{value:"cluster",className:"space-y-4 mt-4",children:e.jsxs(i,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Cluster Configuration"}),e.jsx(S,{children:"Elasticsearch cluster connection and topology"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium",children:"Cluster Health"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${p==="green"?"bg-green-500":p==="yellow"?"bg-yellow-500":"bg-red-500"}`}),e.jsx("span",{className:"text-lg font-semibold uppercase",children:p})]})})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium",children:"Active Shards"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold",children:xe})})]}),e.jsxs(i,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium",children:"Relocating"})}),e.jsx(c,{children:e.jsx("span",{className:"text-2xl font-bold",children:me})})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"cluster-name",children:"Cluster Name"}),e.jsx(N,{id:"cluster-name",value:re,onChange:s=>l({clusterName:s.target.value}),placeholder:"my-cluster"})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{children:["Node Addresses ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(u,{size:"sm",onClick:Ne,variant:"outline",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Node"]})]}),j.length===0&&v.nodes&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive p-2 border border-destructive rounded",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:v.nodes})]}),e.jsx("div",{className:"space-y-2",children:j.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{value:s,onChange:t=>{ye(a,t.target.value),v.nodes&&q()},onBlur:q,placeholder:"localhost:9200",className:`flex-1 ${v.nodes?"border-destructive":""}`}),j.length>1&&e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>pe(a),children:e.jsx(O,{className:"h-4 w-4"})})]},a))}),v.nodes&&j.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:v.nodes})]})]}),e.jsx("div",{className:"flex gap-2 pt-4 border-t",children:e.jsx(u,{onClick:()=>{ve()?A("Параметры подключения сохранены"):ee("Пожалуйста, укажите хотя бы один корректный узел (host:port)")},children:"Сохранить настройки"})})]})]})}),e.jsx(k,{value:"security",className:"space-y-4 mt-4",children:e.jsxs(i,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Security Settings"}),e.jsx(S,{children:"SSL/TLS and authentication"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Enable SSL/TLS"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Encrypt connections to cluster"})]}),e.jsx(Z,{checked:de,onCheckedChange:s=>l({enableSSL:s})})]}),e.jsx(R,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Enable Authentication"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Require authentication"})]}),e.jsx(Z,{checked:J,onCheckedChange:s=>l({enableAuth:s})})]}),J&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"username",children:"Username"}),e.jsx(N,{id:"username",value:oe,onChange:s=>l({username:s.target.value}),placeholder:"elastic"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"password",children:"Password"}),e.jsx(N,{id:"password",type:"password",value:he,onChange:s=>l({password:s.target.value}),placeholder:"password"})]})]})})]})]})}),e.jsx(k,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(i,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Index Settings"}),e.jsx(S,{children:"Default index configuration"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"index",children:"Index Name"}),e.jsx(N,{id:"index",value:le,onChange:s=>l({index:s.target.value}),placeholder:"my-index"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"shards",children:"Number of Shards"}),e.jsx(N,{id:"shards",type:"number",min:"1",max:"100",value:ne,onChange:s=>l({shards:parseInt(s.target.value)||5})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"replicas",children:"Number of Replicas"}),e.jsx(N,{id:"replicas",type:"number",min:"0",max:"10",value:ie,onChange:s=>l({replicas:parseInt(s.target.value)||1})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refresh-interval",children:"Refresh Interval"}),e.jsx(N,{id:"refresh-interval",value:ce,onChange:s=>{l({refreshInterval:s.target.value}),D&&_(s.target.value)},onBlur:s=>_(s.target.value),placeholder:"1s",className:D?"border-destructive":""}),D&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:D})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"How often to refresh the index (e.g., 1s, 5m, 1h, or -1 to disable)"})]})]})]})})]})]})})}export{We as ElasticsearchConfigAdvanced};
