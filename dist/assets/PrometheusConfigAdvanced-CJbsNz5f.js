import{E as ne,u as fe,j as e,r as W,A as X,H as ye,J as Ne,B as H,i as x,a8 as be,S as Ce,T as Re,a as we,b as U,K as Se,a2 as _e,F as ke,d as I,C as $,e as T,f as O,h as A,k as w,L as d,I as j,P as B,m as z,t as Z,n as ee,o as se,p as ae,q as re,s as L}from"./index-DnHhyaNM.js";import{T as S}from"./textarea-DTiKCdOr.js";import{s as M,a as $e}from"./toast-C7aL9cAI.js";const Te=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Oe=ne("cloud-upload",Te);const Ae=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Le=ne("hard-drive",Ae);function te(r){try{const s=new URL(r);return s.port?`${s.hostname}:${s.port}`:s.hostname}catch{const s=r.match(/^https?:\/\/([^\/]+)/);return s?s[1]:r}}function Pe(r){const s=new Map;for(const o of r){const c=o.job||"default";s.has(c)||s.set(c,[]),s.get(c).push(o)}return s}function Ue(r){const s=[];s.push("global:"),r.scrapeInterval&&s.push(`  scrape_interval: ${r.scrapeInterval}`),r.evaluationInterval&&s.push(`  evaluation_interval: ${r.evaluationInterval}`),r.storagePath&&s.push(`  # storage.tsdb.path: ${r.storagePath}`),r.retentionTime&&s.push(`  # storage.tsdb.retention.time: ${r.retentionTime}`),s.push("");const o=r.scrapeInterval||"15s";if(r.scrape_configs&&r.scrape_configs.length>0){s.push("scrape_configs:");for(const c of r.scrape_configs){s.push(`  - job_name: '${f(c.job_name)}'`),c.scrape_interval&&c.scrape_interval!==o&&s.push(`    scrape_interval: ${c.scrape_interval}`),c.scrape_timeout&&s.push(`    scrape_timeout: ${c.scrape_timeout}`),c.metrics_path&&c.metrics_path!=="/metrics"&&s.push(`    metrics_path: '${f(c.metrics_path)}'`),s.push("    static_configs:");for(const l of c.static_configs||[]){s.push("      - targets:");for(const p of l.targets||[])s.push(`          - '${f(p)}'`);if(l.labels&&Object.keys(l.labels).length>0){s.push("        labels:");for(const[p,y]of Object.entries(l.labels))s.push(`          ${p}: '${f(String(y))}'`)}}s.push("")}}else if(r.targets&&r.targets.length>0){s.push("scrape_configs:");const c=Pe(r.targets);for(const[l,p]of c.entries()){const y=p[0],_=y.interval||o,R=y.metricsPath||"/metrics",N=y.scrapeTimeout;s.push(`  - job_name: '${f(l)}'`),_!==o&&s.push(`    scrape_interval: ${_}`),N&&s.push(`    scrape_timeout: ${N}`),R!=="/metrics"&&s.push(`    metrics_path: '${f(R)}'`),s.push("    static_configs:");const b=new Map;for(const u of p){const g=JSON.stringify(u.labels||{});b.has(g)||b.set(g,[]),b.get(g).push(u)}for(const[u,g]of b.entries()){const P=JSON.parse(u);s.push("      - targets:");for(const v of g){const m=te(v.endpoint);s.push(`          - '${f(m)}'`)}if(Object.keys(P).length>0){s.push("        labels:");for(const[v,m]of Object.entries(P))s.push(`          ${v}: '${f(String(m))}'`)}}s.push("")}}else s.push("scrape_configs: []"),s.push("");if(r.enableAlertmanager&&r.alertmanagerUrl){s.push("alerting:"),s.push("  alertmanagers:"),s.push("    - static_configs:"),s.push("        - targets:");const c=te(r.alertmanagerUrl);s.push(`            - '${f(c)}'`),s.push("")}if(r.enableRemoteWrite&&r.remoteWrite&&r.remoteWrite.length>0){s.push("remote_write:");for(const c of r.remoteWrite)s.push("  - url:"),s.push(`      '${f(c.url)}'`),c.auth&&s.push("    # Authorization header should be configured via file or environment");s.push("")}return s.join(`
`)}function Ie(r){if(r.length===0)return"";const s=["groups:"];s.push("  - name: alerts"),s.push("    rules:");for(const o of r){if(s.push(`      - alert: ${o.name}`),s.push(`        expr: ${o.expr}`),o.for&&s.push(`        for: ${o.for}`),o.labels&&Object.keys(o.labels).length>0){s.push("        labels:");for(const[c,l]of Object.entries(o.labels))s.push(`          ${c}: '${f(String(l))}'`)}if(o.annotations&&Object.keys(o.annotations).length>0){s.push("        annotations:");for(const[c,l]of Object.entries(o.annotations))s.push(`          ${c}: '${f(String(l))}'`)}s.push("")}return s.join(`
`)}function De(r){if(r.length===0)return"";const s=["groups:"];s.push("  - name: recording_rules"),s.push("    rules:");for(const o of r){if(s.push(`      - record: ${o.name}`),s.push(`        expr: ${o.expr}`),o.labels&&Object.keys(o.labels).length>0){s.push("        labels:");for(const[c,l]of Object.entries(o.labels))s.push(`          ${c}: '${f(String(l))}'`)}s.push("")}return s.join(`
`)}function f(r){return r.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\n/g,"\\n")}function Ee(r){try{const s=new URL(r);return s.port?`${s.hostname}:${s.port}`:s.protocol==="https:"?`${s.hostname}:443`:`${s.hostname}:80`}catch{const s=r.match(/^https?:\/\/([^\/]+)/);return s?s[1]:null}}function Je(r){try{return new URL(r).pathname||"/metrics"}catch{const s=r.match(/^https?:\/\/[^\/]+(\/.*)/);return s?s[1]:"/metrics"}}function We(r,s="15s"){if(!r||r.length===0)return[];const o=new Map;for(const l of r){const p=l.job||"default";o.has(p)||o.set(p,[]),o.get(p).push(l)}const c=[];for(const[l,p]of o.entries()){const y=new Map;for(const u of p){const g=JSON.stringify(u.labels||{});y.has(g)||y.set(g,[]),y.get(g).push(u)}const _=[];let R,N,b;for(const[u,g]of y.entries()){const P=JSON.parse(u),v=[];for(const m of g){const k=Ee(m.endpoint);k&&v.push(k),!R&&m.interval&&(R=m.interval),!N&&m.metricsPath?N=m.metricsPath:N||(N=Je(m.endpoint)),!b&&m.scrapeTimeout&&(b=m.scrapeTimeout)}v.length>0&&_.push({targets:v,labels:Object.keys(P).length>0?P:void 0})}if(_.length>0){const u={job_name:l,static_configs:_};R&&R!==s&&(u.scrape_interval=R),N&&N!=="/metrics"&&(u.metrics_path=N),b&&(u.scrape_timeout=b),c.push(u)}}return c}function le(r){return r.targets&&Array.isArray(r.targets)&&r.targets.length>0&&!r.scrape_configs}function Be(r){if(!le(r))return r;const s=We(r.targets,r.scrapeInterval||"15s");return{...r,scrape_configs:s}}function Ye({componentId:r}){const{nodes:s,updateNode:o}=fe(),c=s.find(a=>a.id===r);if(!c)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});let l=c.data.config||{};le(l)&&(l=Be(l),o(r,{data:{...c.data,config:l}}));const p=l.version||"2.48.0",y=l.scrapeInterval||"15s",_=l.evaluationInterval||"15s",R=l.retentionTime||"15d",N=l.storagePath||"/prometheus",b=l.enableRemoteWrite??!1,u=l.remoteWrite||[],g=l.enableAlertmanager??!0,P=l.alertmanagerUrl||"http://alertmanager:9093";l.scrape_configs;const v=l.alertingRules||[],m=l.recordingRules||[],k=l.serviceDiscovery||[],[ze,Me]=W.useState(null),[He,qe]=W.useState(null),[ce,q]=W.useState(!1),[ie,K]=W.useState(!1),[Ke,oe]=W.useState(!1),h=a=>{o(r,{data:{...c.data,config:{...l,...a}}})},de=()=>{h({remoteWrite:[...u,{url:""}]})},he=a=>{h({remoteWrite:u.filter((n,t)=>t!==a)})},Q=(a,n)=>{const t=[...u];t[a]=n,h({remoteWrite:t})},ue=()=>{const a={name:"New Alert Rule",expr:"up == 0",for:"5m",labels:{},annotations:{},severity:"warning"};h({alertingRules:[...v,a]}),q(!1)},me=a=>{h({alertingRules:v.filter((n,t)=>t!==a)})},D=(a,n,t)=>{const i=[...v];i[a]={...i[a],[n]:t},h({alertingRules:i})},pe=()=>{const a={name:"new:metric:name",expr:"rate(metric_name[5m])",labels:{}};h({recordingRules:[...m,a]}),K(!1)},xe=a=>{h({recordingRules:m.filter((n,t)=>t!==a)})},V=(a,n,t)=>{const i=[...m];i[a]={...i[a],[n]:t},h({recordingRules:i})},ge=()=>{const a={type:"static",config:{}};h({serviceDiscovery:[...k,a]}),oe(!1)},je=a=>{h({serviceDiscovery:k.filter((n,t)=>t!==a)})},Y=(a,n,t)=>{const i=[...k];i[a]={...i[a],[n]:t},h({serviceDiscovery:i})},ve=()=>{try{const a=Ue(l),n=l.alertingRules&&l.alertingRules.length>0?Ie(l.alertingRules):"",t=l.recordingRules&&l.recordingRules.length>0?De(l.recordingRules):"",i=new Blob([a],{type:"text/yaml"}),G=URL.createObjectURL(i),E=document.createElement("a");if(E.href=G,E.download="prometheus.yml",document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(G),n){const F=new Blob([n],{type:"text/yaml"}),J=URL.createObjectURL(F),C=document.createElement("a");C.href=J,C.download="alerts.yml",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(J)}if(t){const F=new Blob([t],{type:"text/yaml"}),J=URL.createObjectURL(F),C=document.createElement("a");C.href=J,C.download="recording_rules.yml",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(J)}$e("Configuration exported successfully")}catch(a){M(`Failed to export configuration: ${a instanceof Error?a.message:"Unknown error"}`)}};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(X,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(ye,{children:"Prometheus"}),e.jsx(Ne,{children:"Metrics collection & rule evaluation"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",children:["v",p]}),e.jsxs(H,{variant:"secondary",className:"gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),"Healthy"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:ve,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Export YAML"]})]})]}),e.jsx(Ce,{}),e.jsxs(Re,{defaultValue:"scraping",className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-6",children:[e.jsxs(U,{value:"scraping",className:"gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Scraping"]}),e.jsxs(U,{value:"service-discovery",className:"gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Service Discovery"]}),e.jsxs(U,{value:"alerting-rules",className:"gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Alerting Rules"]}),e.jsxs(U,{value:"recording-rules",className:"gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Recording Rules"]}),e.jsxs(U,{value:"storage",className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Storage"]}),e.jsxs(U,{value:"remote",className:"gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Remote Write"]})]}),e.jsxs(I,{value:"scraping",className:"mt-4 space-y-4",children:[e.jsxs($,{children:[e.jsxs(T,{children:[e.jsx(O,{children:"Global Settings"}),e.jsx(A,{children:"Intervals for scraping targets and evaluating rules"})]}),e.jsxs(w,{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Version"}),e.jsx(j,{value:p,onChange:a=>h({version:a.target.value}),placeholder:"2.48.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Scrape Interval"}),e.jsx(j,{value:y,onChange:a=>h({scrapeInterval:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Evaluation Interval"}),e.jsx(j,{value:_,onChange:a=>h({evaluationInterval:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Retention Time"}),e.jsx(j,{value:R,onChange:a=>h({retentionTime:a.target.value})})]})]})]}),e.jsxs($,{children:[e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Scrape Targets"}),e.jsx(A,{children:"Endpoints Prometheus scrapes for metrics"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:addTarget,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Target"]})]}),e.jsxs(w,{className:"space-y-3",children:[targets.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No scrape targets configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Add targets manually or connect components to automatically add them"})]}),targets.map((a,n)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{value:a.job,className:"font-semibold",onChange:t=>updateTarget(n,"job",t.target.value)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Job Name"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:a.status==="up"?"secondary":"destructive",children:a.status==="up"?"UP":"DOWN"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>removeTarget(n),children:e.jsx(z,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Endpoint"}),e.jsx(j,{value:a.endpoint,onChange:t=>updateTarget(n,"endpoint",t.target.value),placeholder:"http://service:port/metrics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Scrape Interval"}),e.jsx(j,{value:a.interval,onChange:t=>updateTarget(n,"interval",t.target.value),placeholder:"15s"})]})]},`${a.job}-${n}`))]})]})]}),e.jsx(I,{value:"storage",className:"mt-4 space-y-4",children:e.jsxs($,{children:[e.jsxs(T,{children:[e.jsx(O,{children:"Local Storage"}),e.jsx(A,{children:"TSDB configuration"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Storage Path"}),e.jsx(j,{value:N,onChange:a=>h({storagePath:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Compaction Log"}),e.jsx(S,{className:"font-mono text-xs",rows:4,value:`level=info ts=${Date.now()} caller=compact.go:516 msg="compact blocks" count=3 mint=0 maxt=3600000`,readOnly:!0})]})]})]})}),e.jsx(I,{value:"remote",className:"mt-4 space-y-4",children:e.jsxs($,{children:[e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Remote Write"}),e.jsx(A,{children:"Ship metrics to long-term storage"})]}),e.jsx(Z,{checked:b,onCheckedChange:a=>h({enableRemoteWrite:a})})]}),b&&e.jsxs(w,{className:"space-y-4",children:[u.map((a,n)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg space-y-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Endpoint #",n+1]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>he(n),children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Remote URL"}),e.jsx(j,{value:a.url,onChange:t=>Q(n,{...a,url:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Authorization Header"}),e.jsx(j,{placeholder:"Bearer ...",value:a.auth||"",onChange:t=>Q(n,{...a,auth:t.target.value})})]})]},n)),e.jsxs(x,{variant:"outline",size:"sm",onClick:de,className:"gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Add Endpoint"]})]})]})}),e.jsx(I,{value:"service-discovery",className:"mt-4 space-y-4",children:e.jsxs($,{children:[e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Service Discovery"}),e.jsx(A,{children:"Configure automatic target discovery"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:ge,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Add Service Discovery"]})]}),e.jsxs(w,{className:"space-y-3",children:[k.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No service discovery configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Configure automatic target discovery for Kubernetes, Consul, etc."})]}),k.map((a,n)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ee,{value:a.type,onValueChange:t=>Y(n,"type",t),children:[e.jsx(se,{className:"w-48",children:e.jsx(ae,{})}),e.jsxs(re,{children:[e.jsx(L,{value:"kubernetes",children:"Kubernetes"}),e.jsx(L,{value:"consul",children:"Consul"}),e.jsx(L,{value:"static",children:"Static"}),e.jsx(L,{value:"file",children:"File"}),e.jsx(L,{value:"dns",children:"DNS"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Discovery Type"})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>je(n),children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Configuration (JSON)"}),e.jsx(S,{className:"font-mono text-xs",rows:4,value:JSON.stringify(a.config,null,2),onChange:t=>{try{const i=JSON.parse(t.target.value);Y(n,"config",i)}catch(i){M(`Неверный формат JSON: ${i instanceof Error?i.message:"Неизвестная ошибка"}`)}},placeholder:'{"role": "pod", "namespaces": {"names": ["default"]}}'})]})]},n))]})]})}),e.jsxs(I,{value:"alerting-rules",className:"mt-4 space-y-4",children:[e.jsxs($,{children:[e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Alerting Rules"}),e.jsx(A,{children:"Define PromQL expressions that trigger alerts"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>q(!0),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Alert Rule"]})]}),ce&&e.jsx(w,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Rule Name"}),e.jsx(j,{placeholder:"HighCPUUsage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"PromQL Expression"}),e.jsx(S,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m]) > 0.8"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:ue,children:"Create Rule"}),e.jsx(x,{variant:"outline",onClick:()=>q(!1),children:"Cancel"})]})]})}),e.jsxs(w,{className:"space-y-3",children:[v.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No alerting rules configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Create rules to monitor your system and trigger alerts"})]}),v.map((a,n)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:a.name}),e.jsx(H,{variant:a.severity==="critical"?"destructive":a.severity==="warning"?"default":"secondary",children:a.severity||"info"})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>me(n),children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"PromQL Expression"}),e.jsx(S,{className:"font-mono text-xs",rows:2,value:a.expr,onChange:t=>D(n,"expr",t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"For Duration"}),e.jsx(j,{value:a.for||"",onChange:t=>D(n,"for",t.target.value),placeholder:"5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Severity"}),e.jsxs(ee,{value:a.severity||"warning",onValueChange:t=>D(n,"severity",t),children:[e.jsx(se,{children:e.jsx(ae,{})}),e.jsxs(re,{children:[e.jsx(L,{value:"critical",children:"Critical"}),e.jsx(L,{value:"warning",children:"Warning"}),e.jsx(L,{value:"info",children:"Info"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Labels (JSON)"}),e.jsx(S,{className:"font-mono text-xs",rows:2,value:JSON.stringify(a.labels||{},null,2),onChange:t=>{try{const i=JSON.parse(t.target.value);D(n,"labels",i)}catch(i){M(`Неверный формат JSON: ${i instanceof Error?i.message:"Неизвестная ошибка"}`)}},placeholder:'{"severity": "warning"}'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Annotations (JSON)"}),e.jsx(S,{className:"font-mono text-xs",rows:2,value:JSON.stringify(a.annotations||{},null,2),onChange:t=>{try{const i=JSON.parse(t.target.value);D(n,"annotations",i)}catch(i){M(`Неверный формат JSON: ${i instanceof Error?i.message:"Неизвестная ошибка"}`)}},placeholder:'{"summary": "Alert summary", "description": "Alert description"}'})]})]},n))]})]}),e.jsxs($,{children:[e.jsxs(T,{children:[e.jsx(O,{children:"Alertmanager Integration"}),e.jsx(A,{children:"Configure alert notifications pipeline"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{children:"Enable Alertmanager"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Forward firing alerts to Alertmanager"})]}),e.jsx(Z,{checked:g,onCheckedChange:a=>h({enableAlertmanager:a})})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Alertmanager URL"}),e.jsx(j,{value:P,onChange:a=>h({alertmanagerUrl:a.target.value})})]})]})]})]}),e.jsx(I,{value:"recording-rules",className:"mt-4 space-y-4",children:e.jsxs($,{children:[e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Recording Rules"}),e.jsx(A,{children:"Pre-compute frequently used or expensive queries"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>K(!0),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Recording Rule"]})]}),ie&&e.jsx(w,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Rule Name"}),e.jsx(j,{placeholder:"cpu:usage:rate5m"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"PromQL Expression"}),e.jsx(S,{className:"font-mono text-sm",rows:2,placeholder:"rate(process_cpu_seconds_total[5m])"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:pe,children:"Create Rule"}),e.jsx(x,{variant:"outline",onClick:()=>K(!1),children:"Cancel"})]})]})}),e.jsxs(w,{className:"space-y-3",children:[m.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No recording rules configured"}),e.jsx("p",{className:"text-xs mt-2",children:"Create rules to pre-compute frequently used queries"})]}),m.map((a,n)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold font-mono",children:a.name}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>xe(n),children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"PromQL Expression"}),e.jsx(S,{className:"font-mono text-xs",rows:2,value:a.expr,onChange:t=>V(n,"expr",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Labels (JSON)"}),e.jsx(S,{className:"font-mono text-xs",rows:2,value:JSON.stringify(a.labels||{},null,2),onChange:t=>{try{const i=JSON.parse(t.target.value);V(n,"labels",i)}catch(i){M(`Неверный формат JSON: ${i instanceof Error?i.message:"Неизвестная ошибка"}`)}},placeholder:'{"job": "node-exporter"}'})]})]},n))]})]})})]})]})})}export{Ye as PrometheusConfigAdvanced};
