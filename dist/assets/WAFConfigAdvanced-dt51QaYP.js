import{K as Oe,u as Me,a as Qe,j as e,e as ze,r as q,l as P,S as W,C as m,h as p,i as v,m as u,T as Fe,b as Ge,c as b,aA as Je,F as Ue,A as $e,a4 as He,d as _e,f,k as w,P as Y,a5 as Xe,I as o,B as k,x as j,o as Z,L as l,q as D,s as I,t as A,v as T,w as c,ah as Ye,a7 as he,ax as $}from"./index-HDGrDyRq.js";import{T as xe}from"./textarea-CjQgIquO.js";import{u as Ze}from"./use-toast-XAAHaGVT.js";import{R as es}from"./refresh-ccw-BUKvY8S7.js";import{S as ss}from"./shield-DzL7mY-o.js";import{G as as}from"./globe-CxWY8qo-.js";import{C as ts}from"./code-BU_fBAbx.js";import{L as ls}from"./lock-BhuwrGKI.js";import{K as is}from"./key-CMmIYHBN.js";import{T as ns}from"./trending-up-CyszUFvc.js";import{C as cs}from"./circle-check-big-3lbqtoL4.js";const rs=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],ds=Oe("bot",rs);function Ss({componentId:Q}){const{nodes:me,updateNode:ue}=Me(),{getComponentMetrics:je}=Qe(),{toast:L}=Ze(),O=me.find(s=>s.id===Q);if(!O)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const r=O.data.config||{},pe=r.mode||"detection",ee=r.enableOWASP??!0,ve=r.owaspRuleset||"3.3",se=r.enableRateLimiting??!0,ae=r.rateLimitPerMinute||100,te=r.enableGeoBlocking??!1,z=r.blockedCountries||[],le=r.enableIPWhitelist??!1,F=r.whitelistedIPs||[],G=r.ipBlacklist||[],ie=r.enableDDoSProtection??!0,ge=r.ddosThreshold||1e3,ne=r.rateLimitStrategy||"fixed-window",ye=r.rateLimitBurst||ae,C=r.schemaValidation||{enabled:!1,schemaType:"json-schema",schema:"",validateRequest:!0,validateResponse:!1},h=r.jwtValidation||{enabled:!1,algorithm:"HS256",requireExpiration:!0},x=r.apiKeyValidation||{enabled:!1,keys:[],headerName:"X-API-Key"},S=r.graphQLProtection||{enabled:!1,maxDepth:10,maxComplexity:100,maxAliases:10,blockIntrospection:!1},R=r.botDetection||{enabled:!1,methods:["user-agent"],blockKnownBots:!1,challengeSuspicious:!1},K=r.anomalyDetection||{enabled:!1,threshold:3,windowSize:60},y=r.rules||[{id:"1",name:"Block SQL Injection",description:"Detect and block SQL injection attempts",enabled:!0,action:"block",priority:1,conditions:[{type:"body",operator:"contains",value:"'; DROP TABLE"}]},{id:"2",name:"Block XSS",description:"Detect and block cross-site scripting",enabled:!0,action:"block",priority:2,conditions:[{type:"body",operator:"contains",value:"<script>"}]}],B=je(Q),V=ze.getWAFEmulationEngine(Q),[J,ce]=q.useState({requestsBlocked:0,requestsAllowed:0,threatsDetected:0,activeRules:y.filter(s=>s.enabled).length}),[re,de]=q.useState([]);q.useEffect(()=>{const s=setInterval(()=>{if(V){const a=V.getStats(),n=V.getThreats(100);ce({requestsBlocked:a.blockedRequests,requestsAllowed:a.allowedRequests,threatsDetected:a.threatsDetected,activeRules:a.activeRules});const i=n.map(d=>({id:d.id,type:d.type,sourceIP:d.sourceIP,target:d.target,timestamp:new Date(d.timestamp).toISOString(),severity:d.severity,blocked:d.blocked,ruleId:d.ruleId,ruleName:d.ruleName,details:d.details}));de(i)}else ce({requestsBlocked:r.requestsBlocked||0,requestsAllowed:r.requestsAllowed||0,threatsDetected:r.threatsDetected||0,activeRules:y.filter(a=>a.enabled).length}),de(r.threats||[])},1e3);return()=>clearInterval(s)},[V,r,y]);const Ne=J.requestsBlocked,be=J.requestsAllowed,fe=J.threatsDetected,H=re.length>0?re:r.threats||[],[os,hs]=q.useState(null),we=()=>{const s=JSON.stringify(E,null,2),a=new Blob([s],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=`waf-threats-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n),L({title:"Export successful",description:`Exported ${E.length} threats to JSON`})},ke=()=>{if(E.length===0){L({title:"No data to export",description:"There are no threats to export",variant:"destructive"});return}const s=["ID","Type","Severity","Source IP","Target","Timestamp","Blocked","Rule ID","Rule Name","Details"],a=E.map(g=>[g.id,g.type,g.severity,g.sourceIP,g.target,new Date(g.timestamp).toISOString(),g.blocked?"Yes":"No",g.ruleId||"",g.ruleName||"",g.details?JSON.stringify(g.details):""]),n=[s.join(","),...a.map(g=>g.map(We=>`"${String(We).replace(/"/g,'""')}"`).join(","))].join(`
`),i=new Blob([n],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(i),N=document.createElement("a");N.href=d,N.download=`waf-threats-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(d),L({title:"Export successful",description:`Exported ${E.length} threats to CSV`})},[xs,Ce]=q.useState(!1),[U,Se]=q.useState(""),[_,Re]=q.useState("all"),[ms,us]=q.useState(null),t=s=>{const a={...r,...s};if(ue(Q,{data:{...O.data,config:a}}),V){const n={...O,data:{...O.data,config:a}};V.initializeConfig(n)}},Pe=()=>{const s={id:`rule-${Date.now()}`,name:"New Rule",description:"",enabled:!0,action:"block",priority:y.length+1,conditions:[]};t({rules:[...y,s]}),Ce(!1)},De=s=>{t({rules:y.filter(a=>a.id!==s)})},M=(s,a,n)=>{const i=y.map(d=>d.id===s?{...d,[a]:n}:d);t({rules:i})},Ie=s=>{z.includes(s)||t({blockedCountries:[...z,s]})},Ae=s=>{t({blockedCountries:z.filter(a=>a!==s)})},Te=s=>{F.includes(s)||t({whitelistedIPs:[...F,s]})},Le=s=>{t({whitelistedIPs:F.filter(a=>a!==s)}),L({title:"IP removed",description:`IP ${s} removed from whitelist`})},Be=s=>{G.includes(s)||t({ipBlacklist:[...G,s]})},Ve=s=>{t({ipBlacklist:G.filter(a=>a!==s)}),L({title:"IP removed",description:`IP ${s} removed from blacklist`})},Ee=s=>{const a={type:"body",operator:"contains",value:""},n=y.map(i=>i.id===s?{...i,conditions:[...i.conditions||[],a]}:i);t({rules:n}),L({title:"Condition added",description:"New condition added to rule"})},qe=(s,a)=>{const n=y.map(i=>i.id===s?{...i,conditions:(i.conditions||[]).filter((d,N)=>N!==a)}:i);t({rules:n}),L({title:"Condition removed",description:"Condition removed from rule"})},X=(s,a,n,i)=>{const d=y.map(N=>{if(N.id===s&&N.conditions){const g=[...N.conditions];return g[a]={...g[a],[n]:i},{...N,conditions:g}}return N});t({rules:d})},Ke=()=>{V&&(V.resetMetrics(),L({title:"Metrics reset",description:"WAF metrics have been reset"}))},oe=y.filter(s=>s.name.toLowerCase().includes(U.toLowerCase())||s.description.toLowerCase().includes(U.toLowerCase())),E=H.filter(s=>!(_==="blocked"&&!s.blocked||_==="not-blocked"&&s.blocked));return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"Web Application Firewall"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"WAF Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Protect applications from web exploits and attacks"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(P,{variant:"outline",size:"sm",onClick:Ke,children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(W,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(m,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(v,{className:"text-sm font-medium",children:"Requests Blocked"})}),e.jsxs(u,{children:[e.jsx("span",{className:"text-2xl font-bold text-red-500",children:Ne.toLocaleString()}),B&&B.customMetrics&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Block Rate: ",((B.customMetrics.waf_block_rate||0)*100).toFixed(2),"%"]})]})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(v,{className:"text-sm font-medium",children:"Requests Allowed"})}),e.jsxs(u,{children:[e.jsx("span",{className:"text-2xl font-bold text-green-500",children:be.toLocaleString()}),B&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Throughput: ",Math.round(B.throughput||0)," req/s"]})]})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(v,{className:"text-sm font-medium",children:"Threats Detected"})}),e.jsxs(u,{children:[e.jsx("span",{className:"text-2xl font-bold text-orange-500",children:fe.toLocaleString()}),B&&B.customMetrics&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Detection Rate: ",((B.customMetrics.waf_threat_detection_rate||0)*100).toFixed(2),"%"]})]})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(v,{className:"text-sm font-medium",children:"Active Rules"})}),e.jsxs(u,{children:[e.jsx("span",{className:"text-2xl font-bold",children:J.activeRules}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Total: ",y.length," rules"]})]})]})]}),e.jsxs(Fe,{defaultValue:"rules",className:"space-y-4",children:[e.jsxs(Ge,{children:[e.jsxs(b,{value:"rules",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Rules (",y.length,")"]}),e.jsxs(b,{value:"threats",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Threats (",H.length,")"]}),e.jsxs(b,{value:"owasp",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"OWASP Rules"]}),e.jsxs(b,{value:"rate-limiting",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Rate Limiting"]}),e.jsxs(b,{value:"geo-blocking",children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Geo-Blocking"]}),e.jsxs(b,{value:"schema-validation",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Schema Validation"]}),e.jsxs(b,{value:"jwt-validation",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"JWT Validation"]}),e.jsxs(b,{value:"api-keys",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"API Keys"]}),e.jsxs(b,{value:"graphql-protection",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"GraphQL Protection"]}),e.jsxs(b,{value:"bot-detection",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Bot Detection"]}),e.jsxs(b,{value:"anomaly-detection",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Anomaly Detection"]}),e.jsxs(b,{value:"settings",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(f,{value:"rules",className:"space-y-4",children:e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Custom Rules"}),e.jsx(w,{children:"Configure custom WAF rules"})]}),e.jsxs(P,{onClick:Pe,size:"sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Create Rule"]})]})}),e.jsxs(u,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search rules...",value:U,onChange:s=>Se(s.target.value),className:"pl-8"})]})}),e.jsxs("div",{className:"space-y-4",children:[oe.map(s=>e.jsxs(m,{className:"border-l-4 border-l-blue-500",children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(k,{variant:s.enabled?"default":"outline",children:s.enabled?"Enabled":"Disabled"}),e.jsx(k,{variant:"outline",children:s.action}),e.jsxs(k,{variant:"outline",children:["Priority: ",s.priority]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{checked:s.enabled,onCheckedChange:a=>M(s.id,"enabled",a)}),e.jsx(P,{variant:"ghost",size:"icon",onClick:()=>De(s.id),children:e.jsx(Z,{className:"h-4 w-4"})})]})]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Rule Name"}),e.jsx(o,{value:s.name,onChange:a=>M(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Action"}),e.jsxs(D,{value:s.action,onValueChange:a=>M(s.id,"action",a),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"block",children:"Block"}),e.jsx(c,{value:"allow",children:"Allow"}),e.jsx(c,{value:"log",children:"Log"}),e.jsx(c,{value:"challenge",children:"Challenge"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Priority"}),e.jsx(o,{type:"number",value:s.priority,onChange:a=>M(s.id,"priority",Number(a.target.value)),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Description"}),e.jsx(o,{value:s.description,onChange:a=>M(s.id,"description",a.target.value),placeholder:"Rule description"})]})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Conditions"}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>Ee(s.id),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Condition"]})]}),s.conditions&&s.conditions.length>0?e.jsx("div",{className:"space-y-2",children:s.conditions.map((a,n)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsxs(D,{value:a.type,onValueChange:i=>X(s.id,n,"type",i),children:[e.jsx(I,{className:"w-32",children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"ip",children:"IP"}),e.jsx(c,{value:"uri",children:"URI"}),e.jsx(c,{value:"header",children:"Header"}),e.jsx(c,{value:"body",children:"Body"}),e.jsx(c,{value:"method",children:"Method"}),e.jsx(c,{value:"country",children:"Country"}),e.jsx(c,{value:"user-agent",children:"User-Agent"})]})]}),e.jsxs(D,{value:a.operator,onValueChange:i=>X(s.id,n,"operator",i),children:[e.jsx(I,{className:"w-40",children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"equals",children:"Equals"}),e.jsx(c,{value:"contains",children:"Contains"}),e.jsx(c,{value:"startsWith",children:"Starts With"}),e.jsx(c,{value:"endsWith",children:"Ends With"}),e.jsx(c,{value:"regex",children:"Regex"}),e.jsx(c,{value:"in",children:"In"}),e.jsx(c,{value:"not-in",children:"Not In"})]})]}),e.jsx(o,{value:a.value,onChange:i=>X(s.id,n,"value",i.target.value),placeholder:"Value",className:"flex-1"}),e.jsx(P,{variant:"ghost",size:"icon",onClick:()=>qe(s.id,n),children:e.jsx(Z,{className:"h-4 w-4"})})]},n))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No conditions. Add at least one condition for the rule to work."})]})]})]},s.id)),oe.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:U?"No rules found matching your search":"No rules configured"})]})]})]})}),e.jsx(f,{value:"threats",className:"space-y-4",children:e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Detected Threats"}),e.jsx(w,{children:"Recent security threats and attacks"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{value:_,onValueChange:s=>Re(s),children:[e.jsxs(I,{className:"w-40",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),e.jsx(A,{})]}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"All Threats"}),e.jsx(c,{value:"blocked",children:"Blocked"}),e.jsx(c,{value:"not-blocked",children:"Not Blocked"})]})]}),E.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:we,className:"gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Export JSON"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:ke,className:"gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Export CSV"]})]})]})]})}),e.jsx(u,{children:E.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:H.length===0?"No threats detected":"No threats match the filter"}):e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsx(m,{className:`border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="high"?"border-l-orange-500":s.severity==="medium"?"border-l-yellow-500":"border-l-blue-500"}`,children:e.jsx(u,{className:"pt-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{variant:s.severity==="critical"?"destructive":s.severity==="high"?"default":"outline",children:s.severity}),e.jsx(k,{variant:"outline",children:s.type}),s.blocked?e.jsxs(k,{variant:"default",className:"bg-green-500",children:[e.jsx(cs,{className:"h-3 w-3 mr-1"}),"Blocked"]}):e.jsxs(k,{variant:"outline",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Not Blocked"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Source IP: ",s.sourceIP]}),e.jsxs("p",{children:["Target: ",s.target]}),e.jsxs("p",{children:["Time: ",new Date(s.timestamp).toLocaleString()]}),s.ruleName&&e.jsx("p",{className:"mt-1",children:e.jsxs(k,{variant:"outline",className:"mr-2",children:["Rule: ",s.ruleName]})}),s.details&&Object.keys(s.details).length>0&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs",children:"Details"}),e.jsx("pre",{className:"mt-1 text-xs bg-muted p-2 rounded overflow-auto",children:JSON.stringify(s.details,null,2)})]})]})]})})})},s.id))})})]})}),e.jsx(f,{value:"owasp",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"OWASP ModSecurity Rules"}),e.jsx(w,{children:"Core Rule Set configuration"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable OWASP Rules"}),e.jsx(j,{checked:ee,onCheckedChange:s=>t({enableOWASP:s})})]}),ee&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"OWASP Rule Set Version"}),e.jsxs(D,{value:ve,onValueChange:s=>t({owaspRuleset:s}),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"3.3",children:"3.3 (Latest)"}),e.jsx(c,{value:"3.2",children:"3.2"}),e.jsx(c,{value:"3.1",children:"3.1"})]})]})]})]})]})}),e.jsx(f,{value:"rate-limiting",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Rate Limiting"}),e.jsx(w,{children:"Configure request rate limits"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable Rate Limiting"}),e.jsx(j,{checked:se,onCheckedChange:s=>t({enableRateLimiting:s})})]}),se&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Rate Limit (requests per minute)"}),e.jsx(o,{type:"number",value:ae,onChange:s=>t({rateLimitPerMinute:Number(s.target.value)}),min:1,max:1e4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Rate Limit Strategy"}),e.jsxs(D,{value:ne,onValueChange:s=>t({rateLimitStrategy:s}),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"fixed-window",children:"Fixed Window"}),e.jsx(c,{value:"sliding-window",children:"Sliding Window"}),e.jsx(c,{value:"token-bucket",children:"Token Bucket"})]})]})]}),ne==="token-bucket"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Burst Size (tokens)"}),e.jsx(o,{type:"number",value:ye,onChange:s=>t({rateLimitBurst:Number(s.target.value)}),min:1,max:1e4}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum number of tokens in the bucket"})]})]})]})]})}),e.jsx(f,{value:"geo-blocking",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Geo-Blocking"}),e.jsx(w,{children:"Block requests from specific countries"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable Geo-Blocking"}),e.jsx(j,{checked:te,onCheckedChange:s=>t({enableGeoBlocking:s})})]}),te&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Blocked Countries (ISO codes)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map(s=>e.jsxs(k,{variant:"outline",className:"gap-1",children:[s,e.jsx("button",{onClick:()=>Ae(s),className:"ml-1 hover:text-destructive",children:e.jsx($,{className:"h-3 w-3"})})]},s))}),e.jsx(o,{placeholder:"Enter ISO country code (e.g., CN, RU)",onKeyDown:s=>{if(s.key==="Enter"){const a=s.currentTarget.value.trim().toUpperCase();a&&(Ie(a),s.currentTarget.value="")}}})]})]})]})}),e.jsx(f,{value:"schema-validation",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Schema Validation"}),e.jsx(w,{children:"Validate requests and responses against JSON Schema or OpenAPI"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable Schema Validation"}),e.jsx(j,{checked:C.enabled,onCheckedChange:s=>t({schemaValidation:{...C,enabled:s}})})]}),C.enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Schema Type"}),e.jsxs(D,{value:C.schemaType,onValueChange:s=>t({schemaValidation:{...C,schemaType:s}}),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"json-schema",children:"JSON Schema"}),e.jsx(c,{value:"openapi",children:"OpenAPI"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Schema (JSON)"}),e.jsx(xe,{value:C.schema,onChange:s=>t({schemaValidation:{...C,schema:s.target.value}}),placeholder:'{"type": "object", "properties": {...}}',rows:10,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Validate Request"}),e.jsx(j,{checked:C.validateRequest,onCheckedChange:s=>t({schemaValidation:{...C,validateRequest:s}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Validate Response"}),e.jsx(j,{checked:C.validateResponse,onCheckedChange:s=>t({schemaValidation:{...C,validateResponse:s}})})]})]})]})]})}),e.jsx(f,{value:"jwt-validation",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"JWT Validation"}),e.jsx(w,{children:"Validate JWT tokens in requests"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable JWT Validation"}),e.jsx(j,{checked:h.enabled,onCheckedChange:s=>t({jwtValidation:{...h,enabled:s}})})]}),h.enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Algorithm"}),e.jsxs(D,{value:h.algorithm,onValueChange:s=>t({jwtValidation:{...h,algorithm:s}}),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"HS256",children:"HS256 (HMAC)"}),e.jsx(c,{value:"RS256",children:"RS256 (RSA)"}),e.jsx(c,{value:"ES256",children:"ES256 (ECDSA)"})]})]})]}),h.algorithm==="HS256"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Secret Key"}),e.jsx(o,{type:"password",value:h.secret||"",onChange:s=>t({jwtValidation:{...h,secret:s.target.value}}),placeholder:"Enter secret key"})]}),(h.algorithm==="RS256"||h.algorithm==="ES256")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Public Key"}),e.jsx(xe,{value:h.publicKey||"",onChange:s=>t({jwtValidation:{...h,publicKey:s.target.value}}),placeholder:"Enter public key (PEM format)",rows:5,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Issuer (optional)"}),e.jsx(o,{value:h.issuer||"",onChange:s=>t({jwtValidation:{...h,issuer:s.target.value}}),placeholder:"https://example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Audience (comma-separated, optional)"}),e.jsx(o,{value:Array.isArray(h.audience)?h.audience.join(", "):h.audience||"",onChange:s=>{const a=s.target.value.split(",").map(n=>n.trim()).filter(n=>n);t({jwtValidation:{...h,audience:a}})},placeholder:"api1, api2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Require Expiration"}),e.jsx(j,{checked:h.requireExpiration,onCheckedChange:s=>t({jwtValidation:{...h,requireExpiration:s}})})]})]})]})]})}),e.jsx(f,{value:"api-keys",className:"space-y-4",children:e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{children:"API Key Validation"}),e.jsx(w,{children:"Manage API keys for authentication"})]}),e.jsxs(P,{size:"sm",onClick:()=>{const s={id:`key-${Date.now()}`,key:`api-key-${Math.random().toString(36).substring(7)}`,enabled:!0,allowedPaths:[],rateLimit:void 0};t({apiKeyValidation:{...x,keys:[...x.keys,s]}})},children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Key"]})]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable API Key Validation"}),e.jsx(j,{checked:x.enabled,onCheckedChange:s=>t({apiKeyValidation:{...x,enabled:s}})})]}),x.enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Header Name"}),e.jsx(o,{value:x.headerName,onChange:s=>t({apiKeyValidation:{...x,headerName:s.target.value}}),placeholder:"X-API-Key"})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-4",children:[x.keys.map(s=>e.jsxs(m,{className:"border-l-4 border-l-blue-500",children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(v,{className:"text-base",children:["API Key: ",s.key.substring(0,20),"..."]}),e.jsx(k,{variant:s.enabled?"default":"outline",className:"mt-1",children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{checked:s.enabled,onCheckedChange:a=>{const n=x.keys.map(i=>i.id===s.id?{...i,enabled:a}:i);t({apiKeyValidation:{...x,keys:n}})}}),e.jsx(P,{variant:"ghost",size:"icon",onClick:()=>{const a=x.keys.filter(n=>n.id!==s.id);t({apiKeyValidation:{...x,keys:a}})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"API Key"}),e.jsx(o,{value:s.key,onChange:a=>{const n=x.keys.map(i=>i.id===s.id?{...i,key:a.target.value}:i);t({apiKeyValidation:{...x,keys:n}})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Allowed Paths (comma-separated, optional)"}),e.jsx(o,{value:Array.isArray(s.allowedPaths)?s.allowedPaths.join(", "):"",onChange:a=>{const n=a.target.value.split(",").map(d=>d.trim()).filter(d=>d),i=x.keys.map(d=>d.id===s.id?{...d,allowedPaths:n}:d);t({apiKeyValidation:{...x,keys:i}})},placeholder:"/api/v1/*, /api/v2/users"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Rate Limit (per minute, optional)"}),e.jsx(o,{type:"number",value:s.rateLimit||"",onChange:a=>{const n=x.keys.map(i=>i.id===s.id?{...i,rateLimit:a.target.value?Number(a.target.value):void 0}:i);t({apiKeyValidation:{...x,keys:n}})},placeholder:"Leave empty for no limit"})]})]})]},s.id)),x.keys.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No API keys configured"})]})]})]})]})}),e.jsx(f,{value:"graphql-protection",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"GraphQL Query Protection"}),e.jsx(w,{children:"Protect against complex and dangerous GraphQL queries"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable GraphQL Protection"}),e.jsx(j,{checked:S.enabled,onCheckedChange:s=>t({graphQLProtection:{...S,enabled:s}})})]}),S.enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Query Depth"}),e.jsx(o,{type:"number",value:S.maxDepth,onChange:s=>t({graphQLProtection:{...S,maxDepth:Number(s.target.value)}}),min:1,max:50})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Query Complexity"}),e.jsx(o,{type:"number",value:S.maxComplexity,onChange:s=>t({graphQLProtection:{...S,maxComplexity:Number(s.target.value)}}),min:1,max:1e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Aliases"}),e.jsx(o,{type:"number",value:S.maxAliases,onChange:s=>t({graphQLProtection:{...S,maxAliases:Number(s.target.value)}}),min:1,max:100})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Block Introspection Queries"}),e.jsx(j,{checked:S.blockIntrospection,onCheckedChange:s=>t({graphQLProtection:{...S,blockIntrospection:s}})})]})]})]})]})}),e.jsx(f,{value:"bot-detection",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Bot Detection"}),e.jsx(w,{children:"Detect and block automated requests and bots"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable Bot Detection"}),e.jsx(j,{checked:R.enabled,onCheckedChange:s=>t({botDetection:{...R,enabled:s}})})]}),R.enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Detection Methods"}),e.jsx("div",{className:"space-y-2",children:["user-agent","behavioral","fingerprint"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:R.methods.includes(s),onChange:a=>{const n=a.target.checked?[...R.methods,s]:R.methods.filter(i=>i!==s);t({botDetection:{...R,methods:n}})},className:"rounded"}),e.jsx(l,{className:"font-normal capitalize",children:s.replace("-"," ")})]},s))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Block Known Bots"}),e.jsx(j,{checked:R.blockKnownBots,onCheckedChange:s=>t({botDetection:{...R,blockKnownBots:s}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Challenge Suspicious Requests"}),e.jsx(j,{checked:R.challengeSuspicious,onCheckedChange:s=>t({botDetection:{...R,challengeSuspicious:s}})})]})]})]})]})}),e.jsx(f,{value:"anomaly-detection",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Anomaly Detection"}),e.jsx(w,{children:"Detect anomalous traffic patterns and potential attacks"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable Anomaly Detection"}),e.jsx(j,{checked:K.enabled,onCheckedChange:s=>t({anomalyDetection:{...K,enabled:s}})})]}),K.enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Anomaly Threshold (multiplier)"}),e.jsx(o,{type:"number",value:K.threshold,onChange:s=>t({anomalyDetection:{...K,threshold:Number(s.target.value)}}),min:1,max:10,step:.1}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Traffic above this multiplier of average will be flagged as anomalous"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Window Size (seconds)"}),e.jsx(o,{type:"number",value:K.windowSize,onChange:s=>t({anomalyDetection:{...K,windowSize:Number(s.target.value)}}),min:10,max:600}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time window for calculating average traffic"})]})]})]})]})}),e.jsx(f,{value:"settings",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"WAF Settings"}),e.jsx(w,{children:"General WAF configuration"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Operation Mode"}),e.jsxs(D,{value:pe,onValueChange:s=>t({mode:s}),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"prevention",children:"Prevention (Block threats)"}),e.jsx(c,{value:"detection",children:"Detection (Log only)"}),e.jsx(c,{value:"logging",children:"Logging Only"})]})]})]}),e.jsx(W,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable DDoS Protection"}),e.jsx(j,{checked:ie,onCheckedChange:s=>t({enableDDoSProtection:s})})]}),ie&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"DDoS Threshold (requests per second)"}),e.jsx(o,{type:"number",value:ge,onChange:s=>t({ddosThreshold:Number(s.target.value)}),min:100,max:1e5})]}),e.jsx(W,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:"Enable IP Whitelist"}),e.jsx(j,{checked:le,onCheckedChange:s=>t({enableIPWhitelist:s})})]}),le&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Whitelisted IPs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:F.map(s=>e.jsxs(k,{variant:"outline",className:"gap-1",children:[s,e.jsx("button",{onClick:()=>Le(s),className:"ml-1 hover:text-destructive",children:e.jsx($,{className:"h-3 w-3"})})]},s))}),e.jsx(o,{placeholder:"Enter IP or CIDR (e.g., 192.168.1.0/24)",onKeyDown:s=>{if(s.key==="Enter"){const a=s.currentTarget.value.trim();a&&(Te(a),s.currentTarget.value="")}}})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"IP Blacklist"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(s=>e.jsxs(k,{variant:"outline",className:"gap-1",children:[s,e.jsx("button",{onClick:()=>Ve(s),className:"ml-1 hover:text-destructive",children:e.jsx($,{className:"h-3 w-3"})})]},s))}),e.jsx(o,{placeholder:"Enter IP or CIDR to block (e.g., 192.168.1.0/24)",onKeyDown:s=>{if(s.key==="Enter"){const a=s.currentTarget.value.trim();a&&(Be(a),s.currentTarget.value="")}}})]})]})]})})]})]})})}export{Ss as WAFConfigAdvanced};
