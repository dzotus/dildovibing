import{E as ve,u as fe,X as Ne,j as e,V as J,r as C,i as f,S as P,C as o,e as x,f as m,k as h,A as H,Z as be,T as ye,a as we,b as M,N as _,B as i,c as Se,d as k,h as T,L as a,n as X,o as Z,p as K,q as Q,s as Y,P as ee,m as Ce,a9 as Pe,I as N,t as E}from"./index-Dy7IKEk-.js";import{T as se}from"./textarea-E5z5wuOP.js";import{a as u,s as w}from"./toast-C_0amNim.js";import{R as Me}from"./refresh-ccw-DGCOD7Wa.js";import{D as ke}from"./database-DRQl_aUU.js";import{C as Te}from"./circle-check-big-CAguCn2G.js";const Ee=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],D=ve("flame",Ee);function $e({componentId:b}){const{nodes:te,updateNode:ae}=fe(),{getComponentMetrics:ne}=Ne(),B=te.find(s=>s.id===b);if(!B)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const y=J.getPyTorchServeEmulationEngine(b),O=ne(b)?.customMetrics||{},n=B.data.config||{},r=n.models||[],p=n.predictions||[],L=n.endpoint||"localhost:8080",re=n.modelStore||"/models",I=n.enableWorkers!==!1,le=n.numWorkers||1,q=n.enableBatching!==!1,ce=n.batchSize||1,ie=n.maxBatchDelay||100,de=n.enableGPU||!1,W=n.enableMetrics!==!1,oe=n.metricsPort||8082,g=y?.getMetrics(),xe=g?.totalModels??n.totalModels??r.length,$=g?.servingModels??r.filter(s=>s.status==="serving").length,me=g?.totalPredictions??n.totalPredictions??p.length,he=g?.averageLatency??n.averageLatency??(r.length>0?r.reduce((s,t)=>s+(t.avgLatency||0),0)/r.length:0),F=g?.requestsPerSecond??O.requestsPerSecond??0,U=g?.errorRate??O.errorRate??0,[d,ue]=C.useState(""),[j,z]=C.useState(""),[v,R]=C.useState(""),[je,S]=C.useState(""),l=s=>{const t={...n,...s};ae(b,{data:{...B.data,config:t}}),setTimeout(()=>{const c=J.getPyTorchServeEmulationEngine(b);c&&c.syncModelsFromConfig()},0)},pe=async()=>{if(!d||!j){w("Please select a model and version");return}if(!v.trim()){w("Please provide input data");return}try{let s;try{s=JSON.parse(v)}catch{w("Invalid JSON input");return}if(y){const t=await y.processPrediction(d,j,s);if(t.success&&t.output){const c={id:`pred-${Date.now()}`,model:d,version:j,input:v,output:JSON.stringify(t.output,null,2),status:"success",timestamp:new Date().toISOString(),latency:t.latency};S(c.output),l({predictions:[...p.slice(-99),c]}),u(`Prediction completed in ${t.latency}ms`)}else{const c={id:`pred-${Date.now()}`,model:d,version:j,input:v,output:void 0,status:"error",timestamp:new Date().toISOString(),latency:t.latency};S(JSON.stringify({error:t.error},null,2)),l({predictions:[...p.slice(-99),c]}),w(t.error||"Prediction failed")}}else{const t={id:`pred-${Date.now()}`,model:d,version:j,input:v,output:JSON.stringify({predictions:[[.85,.1,.05]]},null,2),status:"success",timestamp:new Date().toISOString(),latency:Math.floor(Math.random()*40)+20};S(t.output||""),l({predictions:[...p.slice(-99),t]}),u("Prediction completed (mock)")}}catch(s){w(s instanceof Error?s.message:"Prediction failed")}},V=()=>{const s={name:`model-${Date.now()}`,version:"1.0",status:"serving",handler:"image_classifier",inputs:[],outputs:[]};l({models:[...r,s]}),u("Model added")},ge=(s,t)=>{const c=r.filter(G=>!(G.name===s&&G.version===t));l({models:c}),u("Model deleted")},A=s=>{switch(s){case"serving":return"bg-green-500";case"loading":return"bg-yellow-500";case"unavailable":return"bg-red-500";default:return"bg-gray-500"}};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"PyTorch Serve"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Model Serving"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Flexible and easy-to-use serving for PyTorch models"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{y&&(y.syncModelsFromConfig(),u("Configuration refreshed"))},children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsx(P,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(o,{className:"border-l-4 border-l-orange-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Models"}),e.jsx(D,{className:"h-4 w-4 text-orange-500"})]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400",children:xe}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"total"})]}),$>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[$," serving"]})]})]}),e.jsxs(o,{className:"border-l-4 border-l-green-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Predictions"}),e.jsx(H,{className:"h-4 w-4 text-green-500"})]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:me}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"total"})]}),F>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[F.toFixed(1)," req/s"]})]})]}),e.jsxs(o,{className:"border-l-4 border-l-purple-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Avg Latency"}),e.jsx(be,{className:"h-4 w-4 text-purple-500"})]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:he.toFixed(0)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"ms"})]}),U>0&&e.jsxs("div",{className:"text-xs text-destructive mt-1",children:[(U*100).toFixed(1),"% errors"]})]})]}),e.jsxs(o,{className:"border-l-4 border-l-cyan-500 bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Endpoint"}),e.jsx(ke,{className:"h-4 w-4 text-cyan-500"})]})}),e.jsx(h,{children:e.jsx("div",{className:"text-sm font-semibold text-cyan-600 dark:text-cyan-400 truncate",children:L})})]})]}),e.jsxs(ye,{defaultValue:"test",className:"space-y-4",children:[e.jsxs(we,{className:"flex-wrap",children:[e.jsxs(M,{value:"test",className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Test Prediction"}),e.jsx("span",{className:"sm:hidden",children:"Test"})]}),e.jsxs(M,{value:"models",className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Models"}),e.jsxs(i,{variant:"secondary",className:"ml-1",children:["(",r.length,")"]})]}),e.jsxs(M,{value:"history",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"History"}),e.jsxs(i,{variant:"secondary",className:"ml-1",children:["(",p.length,")"]})]}),e.jsxs(M,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"}),e.jsx("span",{className:"sm:hidden",children:"Config"})]})]}),e.jsx(k,{value:"test",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Model Prediction"}),e.jsx(T,{children:"Test model inference"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Model"}),e.jsxs(X,{value:d,onValueChange:s=>{ue(s);const t=r.find(c=>c.name===s);t&&z(t.version)},children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Select model"})}),e.jsx(Q,{children:r.map(s=>e.jsx(Y,{value:s.name,children:s.name},s.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Version"}),e.jsxs(X,{value:j,onValueChange:z,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Select version"})}),e.jsx(Q,{children:d&&r.find(s=>s.name===d)&&e.jsx(Y,{value:r.find(s=>s.name===d).version,children:r.find(s=>s.name===d).version})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Input (JSON)"}),e.jsx(se,{value:v,onChange:s=>R(s.target.value),className:"font-mono text-sm min-h-[200px]",placeholder:'{ "data": [...] }'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Output"}),e.jsx(se,{value:je,readOnly:!0,className:"font-mono text-sm min-h-[200px] bg-muted",placeholder:"Prediction result will appear here..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:pe,disabled:!d||!j,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Run Prediction"]}),e.jsx(f,{variant:"outline",onClick:()=>{R(""),S("")},children:"Clear"})]})]})]})}),e.jsx(k,{value:"models",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Models"}),e.jsx(T,{children:"Deployed PyTorch models"})]}),e.jsxs(f,{onClick:V,size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Add Model"]})]})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No models deployed"}),e.jsxs(f,{onClick:V,variant:"outline",size:"sm",className:"mt-4",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Add First Model"]})]}):r.map(s=>e.jsxs(o,{className:"border-l-4 border-l-orange-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-lg ${A(s.status)}/20`,children:e.jsx(D,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[e.jsx(i,{variant:"outline",className:A(s.status),children:s.status}),e.jsxs(i,{variant:"outline",children:["v",s.version]}),e.jsx(i,{variant:"outline",children:s.handler}),s.requests&&e.jsxs(i,{variant:"outline",children:[s.requests," requests"]})]})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{confirm(`Delete model ${s.name} v${s.version}?`)&&ge(s.name,s.version)},children:e.jsx(Ce,{className:"h-4 w-4 text-destructive"})})]})}),e.jsxs(h,{children:[s.inputs&&s.inputs.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Inputs"}),s.inputs.map((t,c)=>e.jsxs("div",{className:"p-2 border rounded text-sm",children:[e.jsx("span",{className:"font-mono font-semibold",children:t.name}),e.jsx(i,{variant:"outline",className:"ml-2 text-xs",children:t.dtype}),e.jsx(i,{variant:"outline",className:"ml-2 text-xs",children:t.shape})]},c))]}),s.outputs&&s.outputs.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(a,{children:"Outputs"}),s.outputs.map((t,c)=>e.jsxs("div",{className:"p-2 border rounded text-sm",children:[e.jsx("span",{className:"font-mono font-semibold",children:t.name}),e.jsx(i,{variant:"outline",className:"ml-2 text-xs",children:t.dtype}),e.jsx(i,{variant:"outline",className:"ml-2 text-xs",children:t.shape})]},c))]}),s.avgLatency&&e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Latency:"}),e.jsxs("span",{className:"ml-2 font-semibold",children:[s.avgLatency,"ms"]})]})]})]},`${s.name}-${s.version}`))})})]})}),e.jsx(k,{value:"history",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Prediction History"}),e.jsx(T,{children:"Previously executed predictions"})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsxs(o,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow bg-card",children:[e.jsx(x,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.status==="success"?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:s.status==="success"?e.jsx(Te,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):e.jsx(Pe,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsxs(m,{className:"text-lg font-semibold",children:[s.model," v",s.version]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.latency&&e.jsxs(i,{variant:"outline",children:[s.latency,"ms"]}),e.jsx(i,{variant:s.status==="success"?"default":"destructive",children:s.status})]})]})]})})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.input&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Input"}),e.jsx("pre",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto max-h-40 overflow-y-auto",children:s.input})]}),s.output&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Output"}),e.jsx("pre",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto max-h-40 overflow-y-auto",children:s.output})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:new Date(s.timestamp).toLocaleString()})]})]},s.id))})})]})}),e.jsx(k,{value:"settings",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"PyTorch Serve Settings"}),e.jsx(T,{children:"Server configuration"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Endpoint"}),e.jsx(N,{value:L,onChange:s=>l({endpoint:s.target.value}),placeholder:"localhost:8080"})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(a,{children:"Enable GPU"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use GPU acceleration for inference"})]}),e.jsx(E,{checked:de,onCheckedChange:s=>{l({enableGPU:s}),u(s?"GPU enabled":"GPU disabled")}})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(a,{children:"Enable Batching"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Batch multiple requests together"})]}),e.jsx(E,{checked:q,onCheckedChange:s=>{l({enableBatching:s}),u(s?"Batching enabled":"Batching disabled")}})]}),q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Batch Size"}),e.jsx(N,{type:"number",value:ce,onChange:s=>{const t=parseInt(s.target.value)||1;t>=1&&t<=1e3&&l({batchSize:t})},min:1,max:1e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Max Batch Wait Time (ms)"}),e.jsx(N,{type:"number",value:ie,onChange:s=>{const t=parseInt(s.target.value)||100;t>=1&&t<=1e4&&l({maxBatchDelay:t})},min:1,max:1e4})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Model Store"}),e.jsx(N,{value:re,onChange:s=>l({modelStore:s.target.value}),placeholder:"/models"})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(a,{children:"Enable Workers"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use worker processes for parallel processing"})]}),e.jsx(E,{checked:I,onCheckedChange:s=>{l({enableWorkers:s}),u(s?"Workers enabled":"Workers disabled")}})]}),I&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Number of Workers"}),e.jsx(N,{type:"number",value:le,onChange:s=>{const t=parseInt(s.target.value)||1;t>=1&&t<=100&&l({numWorkers:t})},min:1,max:100})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(a,{children:"Enable Metrics"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Export metrics for monitoring"})]}),e.jsx(E,{checked:W,onCheckedChange:s=>{l({enableMetrics:s}),u(s?"Metrics enabled":"Metrics disabled")}})]}),W&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Metrics Port"}),e.jsx(N,{type:"number",value:oe,onChange:s=>{const t=parseInt(s.target.value)||8082;t>=1024&&t<=65535&&l({metricsPort:t})},min:1024,max:65535})]})]})]})})]})]})})}export{$e as PyTorchServeConfigAdvanced};
