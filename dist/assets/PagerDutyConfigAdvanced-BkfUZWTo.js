import{u as Ke,a as He,r as B,j as e,e as P,l as f,S as Ve,C as g,h as C,i as M,m as N,A as Be,k as L,L as h,x as Q,I as y,q as U,s as E,t as _,v as $,w as o,T as We,b as Ge,c as W,aA as Ze,d as qe,f as G,B as A,P as z,o as I}from"./index-UHkh-5io.js";import{R as me}from"./refresh-ccw-CtMpp-dW.js";import{U as Je}from"./users-CnLxVhqj.js";import{B as Qe}from"./bell-o4Lql_AQ.js";import{C as X}from"./clock-BG9TXgSU.js";const Xe=j=>j?/^[a-zA-Z0-9_-]+$/.test(j)&&j.length>=8:!0,es=j=>j?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j):!1,ss=j=>{if(!j)return!0;try{return new URL(j),!0}catch{return!1}};function cs({componentId:j}){const{nodes:ee,updateNode:he}=Ke(),{getComponentMetrics:ue,isRunning:je}=He(),O=ee.find(s=>s.id===j),[k,ge]=B.useState({}),[ve,se]=B.useState(!1),ae=ue(j),te=ae?.customMetrics||{};if(B.useEffect(()=>{},[ae,je]),!O)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const v=O?.data?.config||{},pe=v.enableAutoResolve??!0,fe=v.resolveTimeout??300,Z=v.enableWebhooks??!1,Ne=v.webhookUrl??"",ye=v.severityMapping??"standard",D=Array.isArray(v.services)?v.services:[],F=P.getPagerDutyIncidents(j).map(s=>{const a=D.find(n=>n.id===s.serviceId);return{id:s.id,title:s.title,service:a?.name||s.serviceId,status:s.status,severity:s.severity,createdAt:new Date(s.createdAt).toISOString(),acknowledgedAt:s.acknowledgedAt?new Date(s.acknowledgedAt).toISOString():void 0,resolvedAt:s.resolvedAt?new Date(s.resolvedAt).toISOString():void 0}}),w=Array.isArray(v.escalationPolicies)?v.escalationPolicies:[],b=Array.isArray(v.onCallUsers)?v.onCallUsers:[],S=Array.isArray(v.schedules)?v.schedules:[],q=P.getPagerDutyMetrics(j),[Y,be]=B.useState(v.timeFormat||"24h"),[p,we]=B.useState(v.dateFormat||"YYYY-MM-DD"),Se=q?.incidentsTotal??F.length,ne=q?.incidentsActive??F.filter(s=>s.status!=="resolved").length,Ce=q?.incidentsResolved??F.filter(s=>s.status==="resolved").length,x=s=>{const a={...v,...s},n={};if(a.enableWebhooks&&a.webhookUrl&&(ss(a.webhookUrl)||(n.webhookUrl="Invalid URL format")),Array.isArray(a.services)&&a.services.forEach((i,l)=>{i.integrationKey&&!Xe(i.integrationKey)&&(n[`service-${l}-integrationKey`]="Invalid integration key format")}),Array.isArray(a.onCallUsers)&&a.onCallUsers.forEach((i,l)=>{es(i.email)||(n[`user-${l}-email`]="Invalid email format")}),ge(n),Object.keys(n).length>0)return;he(j,{data:{...O.data,config:a}}),se(!0);const t={...O,data:{...O.data,config:a}};P.updateNodesAndConnections([t],[]),setTimeout(()=>se(!1),500)},De=()=>{const s={id:`service-${Date.now()}`,name:"new-service",integrationKey:"",status:"active",autoResolve:!0,resolveTimeout:300,incidentCount:0};x({services:[...D,s]}),setShowCreateService(!1)},Me=s=>{x({services:D.filter(a=>a.id!==s)})},R=(s,a,n)=>{const t=D.map(i=>i.id===s?{...i,[a]:n}:i);x({services:t})},Ye=s=>{P.acknowledgePagerDutyIncident(j,s)},Ae=s=>{P.resolvePagerDutyIncident(j,s)},ke=()=>{const s={id:`policy-${Date.now()}`,name:"new-policy",levels:[{level:1,timeout:5,targets:[]}]};x({escalationPolicies:[...w,s]}),setShowCreatePolicy(!1)},Te=s=>{x({escalationPolicies:w.filter(a=>a.id!==s)})},Pe=(s,a)=>{const n=w.map(t=>t.id===s?{...t,name:a}:t);x({escalationPolicies:n})},Ue=s=>{const a=w.map(n=>{if(n.id!==s)return n;const t=(n.levels[n.levels.length-1]?.level||0)+1;return{...n,levels:[...n.levels,{level:t,timeout:5,targets:[]}]}});x({escalationPolicies:a})},Ee=(s,a)=>{const n=w.map(t=>{if(t.id!==s)return t;const i=t.levels.filter((l,r)=>r!==a);return{...t,levels:i}});x({escalationPolicies:n})},_e=(s,a,n)=>{const t=w.map(i=>{if(i.id!==s)return i;const l=i.levels.map((r,m)=>m===a?{...r,timeout:n}:r);return{...i,levels:l}});x({escalationPolicies:t})},$e=()=>{const s={id:`user-${Date.now()}`,name:"On-Call User",email:"user@example.com",status:"on-call"};x({onCallUsers:[...b,s]}),setShowCreateOnCall(!1)},Oe=s=>{const a=b.filter(t=>t.id!==s),n=w.map(t=>({...t,levels:t.levels.map(i=>({...i,targets:i.targets.filter(l=>l!==s)}))}));x({onCallUsers:a,escalationPolicies:n})},J=(s,a,n)=>{const t=b.map(i=>i.id===s?{...i,[a]:n}:i);x({onCallUsers:t})},Re=()=>{const s={id:`schedule-${Date.now()}`,name:"new-schedule",timezone:"UTC",layers:[{start:new Date().toISOString(),rotation_virtual_start:new Date().toISOString(),rotation_turn_length_seconds:604800,users:[]}]};x({schedules:[...S,s]})},Le=s=>{x({schedules:S.filter(n=>n.id!==s)});const a=w.map(n=>({...n,levels:n.levels.map(t=>({...t,targets:t.targets.filter(i=>i!==s)}))}));x({escalationPolicies:a})},ie=(s,a,n)=>{const t=S.map(i=>i.id===s?{...i,[a]:n}:i);x({schedules:t})},ze=s=>{const a=S.map(n=>n.id!==s?n:{...n,layers:[...n.layers,{start:new Date().toISOString(),rotation_virtual_start:new Date().toISOString(),rotation_turn_length_seconds:604800,users:[]}]});x({schedules:a})},Ie=(s,a)=>{const n=S.map(t=>t.id!==s?t:{...t,layers:t.layers.filter((i,l)=>l!==a)});x({schedules:n})},K=(s,a,n,t)=>{const i=S.map(l=>l.id!==s?l:{...l,layers:l.layers.map((r,m)=>m===a?{...r,[n]:t}:r)});x({schedules:i})},Fe=(s,a,n)=>{const t=S.map(i=>i.id!==s?i:{...i,layers:i.layers.map((l,r)=>{if(r!==a)return l;const m=l.users.some(c=>c.user.id===n);return{...l,users:m?l.users.filter(c=>c.user.id!==n):[...l.users,{user:{id:n}}]}})});x({schedules:t})},le=(s,a,n)=>{const t=w.map(i=>{if(i.id!==s)return i;const l=i.levels.map((r,m)=>{if(m!==a)return r;const d=r.targets.includes(n)?r.targets.filter(T=>T!==n):[...r.targets,n];return{...r,targets:d}});return{...i,levels:l}});x({escalationPolicies:t})},re=s=>P.getPagerDutyScheduleOnCallUsers(j,s),ce=s=>{const a=new Date(s),n=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return p==="MM/DD/YYYY"?`${t}/${i}/${n}`:p==="DD/MM/YYYY"?`${i}/${t}/${n}`:`${n}-${t}-${i}`},de=s=>{if(!s)return null;let a,n,t;if(p==="MM/DD/YYYY"){const[i,l,r]=s.split("/").map(Number);a=r,n=i-1,t=l}else if(p==="DD/MM/YYYY"){const[i,l,r]=s.split("/").map(Number);a=r,n=l-1,t=i}else{const[i,l,r]=s.split("-").map(Number);a=i,n=l-1,t=r}return new Date(a,n,t)},oe=s=>{const a=new Date(s),n=a.getHours(),t=a.getMinutes();if(Y==="12h"){const i=n%12||12,l=n>=12?"PM":"AM";return`${String(i).padStart(2,"0")}:${String(t).padStart(2,"0")} ${l}`}return`${String(n).padStart(2,"0")}:${String(t).padStart(2,"0")}`},xe=(s,a)=>{s!==void 0&&(be(s),x({timeFormat:s})),a!==void 0&&(we(a),x({dateFormat:a}))};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground tracking-wide",children:"PagerDuty"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Incident Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage incidents, services, escalation policies and on-call schedules"})]}),e.jsxs("div",{className:"flex gap-2",children:[ve&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(me,{className:"h-4 w-4 animate-spin"}),"Updating..."]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{const s={...O};P.updateNodesAndConnections([s],[])},children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(g,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Total Incidents"})}),e.jsx(N,{children:e.jsx("span",{className:"text-2xl font-bold",children:Se})})]}),e.jsxs(g,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Active"})}),e.jsx(N,{children:e.jsx("span",{className:"text-2xl font-bold text-red-500",children:ne})})]}),e.jsxs(g,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Resolved"})}),e.jsx(N,{children:e.jsx("span",{className:"text-2xl font-bold text-green-500",children:Ce})})]}),e.jsxs(g,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(M,{className:"text-sm font-medium",children:"Services"})}),e.jsx(N,{children:e.jsx("span",{className:"text-2xl font-bold",children:D.length})})]})]}),e.jsxs(g,{children:[e.jsxs(C,{children:[e.jsxs(M,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Global Settings"]}),e.jsx(L,{children:"Control how incidents are auto-resolved, mapped by severity and propagated via webhooks"})]}),e.jsx(N,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Auto Resolve"}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Enable automatic incident resolution"}),e.jsx(Q,{checked:pe,onCheckedChange:s=>x({enableAutoResolve:s})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Resolve Timeout (seconds)"}),e.jsx(y,{type:"number",value:fe,onChange:s=>x({resolveTimeout:Number(s.target.value)||0}),min:60})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Severity Mapping"}),e.jsxs(U,{value:ye,onValueChange:s=>x({severityMapping:s}),children:[e.jsx(E,{children:e.jsx(_,{})}),e.jsxs($,{children:[e.jsx(o,{value:"standard",children:"Standard (critical / warning / info)"}),e.jsx(o,{value:"error-focused",children:"Error-focused (warnings treated as errors)"}),e.jsx(o,{value:"warning-demoted",children:"Warning demoted (warnings as info)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Enable Webhooks"}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Send outbound incident webhooks"}),e.jsx(Q,{checked:Z,onCheckedChange:s=>x({enableWebhooks:s})})]})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(h,{children:"Webhook URL"}),e.jsx(y,{value:Ne,onChange:s=>x({webhookUrl:s.target.value}),placeholder:"https://webhook.example.com/pagerduty",disabled:!Z,className:k.webhookUrl?"border-red-500":""}),k.webhookUrl&&e.jsx("p",{className:"text-xs text-red-500",children:k.webhookUrl}),Z&&te.webhook_success_rate!==void 0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Success rate: ",(te.webhook_success_rate*100).toFixed(1),"%"]})]})]})})]}),e.jsxs(We,{defaultValue:"incidents",className:"space-y-4",children:[e.jsxs(Ge,{children:[e.jsxs(W,{value:"incidents",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Incidents (",ne,")"]}),e.jsxs(W,{value:"services",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Services (",D.length,")"]}),e.jsxs(W,{value:"policies",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Escalation Policies (",w.length,")"]}),e.jsxs(W,{value:"oncall",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"On-Call"]}),e.jsxs(W,{value:"schedules",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Schedules (",S.length,")"]})]}),e.jsx(G,{value:"incidents",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Incidents"}),e.jsx(L,{children:"Manage and respond to incidents"})]}),e.jsx(N,{children:F.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No incidents"}):e.jsx("div",{className:"space-y-2",children:F.map(s=>e.jsx(g,{className:`border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="error"?"border-l-orange-500":s.severity==="warning"?"border-l-yellow-500":"border-l-blue-500"}`,children:e.jsx(N,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(A,{variant:s.status==="resolved"?"default":s.status==="acknowledged"?"secondary":"destructive",children:s.status}),e.jsx(A,{variant:s.severity==="critical"?"destructive":s.severity==="error"?"default":"outline",children:s.severity}),e.jsx("span",{className:"font-medium",children:s.title})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Service: ",s.service]}),e.jsxs("p",{children:["Created: ",new Date(s.createdAt).toLocaleString()]}),s.assignedTo&&e.jsxs("p",{children:["Assigned to: ",s.assignedTo]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="triggered"&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Ye(s.id),children:"Acknowledge"}),s.status!=="resolved"&&e.jsx(f,{size:"sm",variant:"default",onClick:()=>Ae(s.id),children:"Resolve"})]})]})})},s.id))})})]})}),e.jsx(G,{value:"services",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Services"}),e.jsx(L,{children:"Configure monitored services"})]}),e.jsxs(f,{onClick:De,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Service"]})]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsxs(g,{className:"border-l-4 border-l-blue-500",children:[e.jsx(C,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-base",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(A,{variant:s.status==="active"?"default":s.status==="maintenance"?"secondary":"outline",children:s.status}),e.jsxs(A,{variant:"outline",children:[s.incidentCount||0," incidents"]})]})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Me(s.id),disabled:D.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsx(N,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Service Name"}),e.jsx(y,{value:s.name,onChange:a=>R(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Integration Key"}),e.jsx(y,{value:s.integrationKey,onChange:a=>R(s.id,"integrationKey",a.target.value),placeholder:"integration-key",className:k[`service-${D.indexOf(s)}-integrationKey`]?"border-red-500":""}),k[`service-${D.indexOf(s)}-integrationKey`]&&e.jsx("p",{className:"text-xs text-red-500",children:k[`service-${D.indexOf(s)}-integrationKey`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Status"}),e.jsxs(U,{value:s.status,onValueChange:a=>R(s.id,"status",a),children:[e.jsx(E,{children:e.jsx(_,{})}),e.jsxs($,{children:[e.jsx(o,{value:"active",children:"Active"}),e.jsx(o,{value:"maintenance",children:"Maintenance"}),e.jsx(o,{value:"disabled",children:"Disabled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Escalation Policy"}),e.jsxs(U,{value:s.escalationPolicy||"",onValueChange:a=>R(s.id,"escalationPolicy",a),children:[e.jsx(E,{children:e.jsx(_,{})}),e.jsx($,{children:w.map(a=>e.jsx(o,{value:a.name,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Auto Resolve"}),e.jsx(Q,{checked:s.autoResolve??!0,onCheckedChange:a=>R(s.id,"autoResolve",a)})]}),s.autoResolve&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Resolve Timeout (seconds)"}),e.jsx(y,{type:"number",value:s.resolveTimeout||300,onChange:a=>R(s.id,"resolveTimeout",Number(a.target.value)),min:60})]})]})})]},s.id))})})]})}),e.jsx(G,{value:"policies",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Escalation Policies"}),e.jsx(L,{children:"Configure incident escalation rules"})]}),e.jsxs(f,{onClick:ke,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Policy"]})]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsxs(g,{className:"border-l-4 border-l-green-500",children:[e.jsx(C,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(h,{children:"Policy Name"}),e.jsx(y,{value:s.name,onChange:a=>Pe(s.id,a.target.value)})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Te(s.id),disabled:w.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsxs(N,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(X,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.levels.length," levels"]})]}),e.jsxs(f,{variant:"outline",size:"xs",onClick:()=>Ue(s.id),children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Add Level"]})]}),e.jsx("div",{className:"space-y-2",children:s.levels.map((a,n)=>e.jsx(g,{className:"p-3",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-medium",children:["Level ",a.level]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Ee(s.id,n),disabled:s.levels.length===1,children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Timeout (minutes)"}),e.jsx(y,{type:"number",value:a.timeout,min:1,onChange:t=>_e(s.id,n,Number(t.target.value)||0)})]}),e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Targets (users or schedules)"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[b.map(t=>{const i=a.targets.includes(t.id);return e.jsxs(A,{variant:i?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>le(s.id,n,t.id),children:["ðŸ‘¤ ",t.name]},t.id)}),S.map(t=>{const i=a.targets.includes(t.id),l=re(t.id);return e.jsxs(A,{variant:i?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>le(s.id,n,t.id),title:`Schedule: ${t.name} (${l.length} on-call)`,children:["ðŸ“… ",t.name]},t.id)}),b.length===0&&S.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"No targets configured"})]})})]})]})]})})},n))})]})]},s.id))})})]})}),e.jsx(G,{value:"oncall",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"On-Call Roster"}),e.jsx(L,{children:"Manage who participates in on-call and their status"})]}),e.jsxs(f,{size:"sm",onClick:$e,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsx(N,{children:b.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No on-call users configured. Add at least one user to use escalation policies effectively."}):e.jsx("div",{className:"space-y-2",children:b.map(s=>e.jsx(g,{className:"border-l-4 border-l-purple-500",children:e.jsx(N,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Name"}),e.jsx(y,{value:s.name,onChange:a=>J(s.id,"name",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Email"}),e.jsx(y,{value:s.email,onChange:a=>J(s.id,"email",a.target.value),className:k[`user-${b.indexOf(s)}-email`]?"border-red-500":""}),k[`user-${b.indexOf(s)}-email`]&&e.jsx("p",{className:"text-xs text-red-500",children:k[`user-${b.indexOf(s)}-email`]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Status"}),e.jsxs(U,{value:s.status,onValueChange:a=>J(s.id,"status",a),children:[e.jsx(E,{className:"h-8 w-[140px]",children:e.jsx(_,{})}),e.jsxs($,{children:[e.jsx(o,{value:"on-call",children:"On-Call"}),e.jsx(o,{value:"off-call",children:"Off-Call"})]})]})]}),e.jsx(A,{variant:s.status==="on-call"?"default":"outline",children:s.status==="on-call"?"On-Call":"Off-Call"})]})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Oe(s.id),disabled:b.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})})},s.id))})})]})}),e.jsx(G,{value:"schedules",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Schedules"}),e.jsx(L,{children:"Configure on-call rotation schedules"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"text-xs",children:"Time Format:"}),e.jsxs(U,{value:Y,onValueChange:s=>xe(s),children:[e.jsx(E,{className:"h-8 w-20",children:e.jsx(_,{})}),e.jsxs($,{children:[e.jsx(o,{value:"12h",children:"12h"}),e.jsx(o,{value:"24h",children:"24h"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"text-xs",children:"Date Format:"}),e.jsxs(U,{value:p,onValueChange:s=>xe(void 0,s),children:[e.jsx(E,{className:"h-8 w-32",children:e.jsx(_,{})}),e.jsxs($,{children:[e.jsx(o,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"}),e.jsx(o,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(o,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"})]})]})]}),e.jsxs(f,{onClick:Re,size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Create Schedule"]})]})]})}),e.jsx(N,{children:S.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No schedules configured. Create a schedule to manage on-call rotations."}):e.jsx("div",{className:"space-y-4",children:S.map(s=>{const a=re(s.id),n=b.filter(t=>a.includes(t.id));return e.jsxs(g,{className:"border-l-4 border-l-indigo-500",children:[e.jsx(C,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{children:"Schedule Name"}),e.jsx(y,{value:s.name,onChange:t=>ie(s.id,"name",t.target.value),className:"max-w-xs"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{children:"Timezone"}),e.jsxs(U,{value:s.timezone,onValueChange:t=>ie(s.id,"timezone",t),children:[e.jsx(E,{className:"max-w-xs",children:e.jsx(_,{placeholder:"Select timezone"})}),e.jsxs($,{children:[e.jsx(o,{value:"UTC",children:"UTC (Coordinated Universal Time)"}),e.jsx(o,{value:"America/New_York",children:"America/New_York (EST/EDT)"}),e.jsx(o,{value:"America/Chicago",children:"America/Chicago (CST/CDT)"}),e.jsx(o,{value:"America/Denver",children:"America/Denver (MST/MDT)"}),e.jsx(o,{value:"America/Los_Angeles",children:"America/Los_Angeles (PST/PDT)"}),e.jsx(o,{value:"Europe/London",children:"Europe/London (GMT/BST)"}),e.jsx(o,{value:"Europe/Paris",children:"Europe/Paris (CET/CEST)"}),e.jsx(o,{value:"Europe/Berlin",children:"Europe/Berlin (CET/CEST)"}),e.jsx(o,{value:"Europe/Moscow",children:"Europe/Moscow (MSK)"}),e.jsx(o,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"}),e.jsx(o,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(o,{value:"Asia/Shanghai",children:"Asia/Shanghai (CST)"}),e.jsx(o,{value:"Asia/Tokyo",children:"Asia/Tokyo (JST)"}),e.jsx(o,{value:"Australia/Sydney",children:"Australia/Sydney (AEST/AEDT)"}),e.jsx(o,{value:"Pacific/Auckland",children:"Pacific/Auckland (NZST/NZDT)"})]})]})]}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"default",children:"Current On-Call:"}),n.map(t=>e.jsx(A,{variant:"outline",children:t.name},t.id))]})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Le(s.id),disabled:S.length===1,children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsxs(N,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(X,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.layers.length," layer(s)"]})]}),e.jsxs(f,{variant:"outline",size:"xs",onClick:()=>ze(s.id),children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Add Layer"]})]}),e.jsx("div",{className:"space-y-2",children:s.layers.map((t,i)=>e.jsx(g,{className:"p-3 bg-muted/50",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Layer ",i+1]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Ie(s.id,i),disabled:s.layers.length===1,children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Start Date & Time"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{type:p==="YYYY-MM-DD"?"date":"text",value:p==="YYYY-MM-DD"?new Date(t.start).toISOString().split("T")[0]:ce(t.start),onChange:l=>{const r=l.target.value;if(!r)return;const m=new Date(t.start);let c;if(p==="YYYY-MM-DD"){const[d,T,u]=r.split("-").map(Number);c=new Date(d,T-1,u,m.getHours(),m.getMinutes())}else{const d=de(r);if(!d)return;c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),m.getHours(),m.getMinutes())}K(s.id,i,"start",c.toISOString())},placeholder:p==="YYYY-MM-DD"?"":p,className:"text-xs flex-1"}),e.jsx(y,{type:Y==="24h"?"time":"text",value:oe(t.start),onChange:l=>{const r=l.target.value.trim(),m=new Date(t.start);let c,d;if(Y==="24h"){if(!r)return;const u=r.split(":");if(u.length<2||(c=Number(u[0]),d=Number(u[1]),isNaN(c)||isNaN(d))||c<0||c>23||d<0||d>59)return}else{if(!r)return;const u=r.match(/(\d{1,2}):?(\d{0,2})\s*(AM|PM)?/i);if(!u)return;c=Number(u[1]);const H=u[2]||"0";if(d=Number(H),isNaN(c)||c<1||c>12||isNaN(d)||d<0||d>59)return;if(u[3]||H.length===2){const V=(u[3]||"").toUpperCase()==="PM";V&&c!==12&&(c+=12),!V&&c===12&&(c=0)}else return}const T=new Date(m.getFullYear(),m.getMonth(),m.getDate(),c,d);K(s.id,i,"start",T.toISOString())},placeholder:Y==="24h"?"HH:mm":"hh:mm AM/PM",className:"text-xs w-28"},`start-time-${Y}-${s.id}-${i}`)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Rotation Start Date & Time"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{type:p==="YYYY-MM-DD"?"date":"text",value:p==="YYYY-MM-DD"?new Date(t.rotation_virtual_start).toISOString().split("T")[0]:ce(t.rotation_virtual_start),onChange:l=>{const r=l.target.value;if(!r)return;const m=new Date(t.rotation_virtual_start);let c;if(p==="YYYY-MM-DD"){const[d,T,u]=r.split("-").map(Number);c=new Date(d,T-1,u,m.getHours(),m.getMinutes())}else{const d=de(r);if(!d)return;c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),m.getHours(),m.getMinutes())}K(s.id,i,"rotation_virtual_start",c.toISOString())},placeholder:p==="YYYY-MM-DD"?"":p,className:"text-xs flex-1"}),e.jsx(y,{type:Y==="24h"?"time":"text",value:oe(t.rotation_virtual_start),onChange:l=>{const r=l.target.value.trim(),m=new Date(t.rotation_virtual_start);let c,d;if(Y==="24h"){if(!r)return;const u=r.split(":");if(u.length<2||(c=Number(u[0]),d=Number(u[1]),isNaN(c)||isNaN(d))||c<0||c>23||d<0||d>59)return}else{if(!r)return;const u=r.match(/(\d{1,2}):?(\d{0,2})\s*(AM|PM)?/i);if(!u)return;c=Number(u[1]);const H=u[2]||"0";if(d=Number(H),isNaN(c)||c<1||c>12||isNaN(d)||d<0||d>59)return;if(u[3]||H.length===2){const V=(u[3]||"").toUpperCase()==="PM";V&&c!==12&&(c+=12),!V&&c===12&&(c=0)}else return}const T=new Date(m.getFullYear(),m.getMonth(),m.getDate(),c,d);K(s.id,i,"rotation_virtual_start",T.toISOString())},placeholder:Y==="24h"?"HH:mm":"hh:mm AM/PM",className:"text-xs w-28"},`rotation-time-${Y}-${s.id}-${i}`)]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Rotation Length (days)"}),e.jsx(y,{type:"number",value:Math.floor(t.rotation_turn_length_seconds/86400),onChange:l=>{const r=Number(l.target.value)||7;K(s.id,i,"rotation_turn_length_seconds",r*86400)},min:1,className:"text-xs"})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Users in Rotation"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[b.map(l=>{const r=t.users.some(m=>m.user.id===l.id);return e.jsx(A,{variant:r?"default":"outline",className:"cursor-pointer text-xs",onClick:()=>Fe(s.id,i,l.id),children:l.name},l.id)}),b.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"No on-call users configured"})]})]})]})})},i))})]})]},s.id)})})})]})})]})]})})}export{cs as PagerDutyConfigAdvanced};
