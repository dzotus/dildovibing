import{u as Re,j as e,r as h,V as z,B as A,S as G,C as c,e as i,f as d,k as r,T as Ke,a as ke,b as Q,R as ze,c as Ae,d as M,h as b,i as p,P as X,m as Qe,L as w,I as P,n as J,o as Z,p as ee,q as se,s as j,N as Me}from"./index-CydFlkT-.js";import{P as ae}from"./progress-D4uPsSdo.js";import{T as Oe}from"./textarea-gCrBNtSF.js";import{D as te}from"./database-DwkLiyCd.js";import{T as ge}from"./table-CWGfLDCm.js";import{C as De}from"./code--bQLq1Nz.js";function Ie({componentId:T}){const{nodes:le,connections:Ne,updateNode:ye}=Re(),L=le.find(s=>s.id===T);if(!L)return e.jsx("div",{className:"p-4 text-muted-foreground",children:"Component not found"});const g=L.data.config||{},fe=g.clusterName||"archiphoenix-cluster",I=g.nodes||[],o=g.keyspaces||[{name:"system",replication:3,replicationStrategy:"NetworkTopologyStrategy",tables:0,size:0,durableWrites:!0}],R=g.tables||[],W=g.queries||[],[ne,ce]=h.useState(null),[ve,O]=h.useState(!1),[be,D]=h.useState(!1),[U,_]=h.useState(""),[$,H]=h.useState(o[0]?.name||"system"),[N,q]=h.useState(""),V=g.consistencyLevel||"QUORUM",re=g.replicationFactor||3,[l,ie]=h.useState(null),[de,B]=h.useState(o),[oe,F]=h.useState(R),[xe,me]=h.useState(I);h.useEffect(()=>{if(!L)return;const s=setInterval(()=>{const a=z.getCassandraRoutingEngine(T);if(a){const t=a.getMetrics(),m=a.getKeyspaces(),x=a.getTables(),C=a.getNodes();ie({readLatency:t.readLatency,writeLatency:t.writeLatency,totalNodes:t.totalNodes,healthyNodes:t.healthyNodes,totalKeyspaces:t.totalKeyspaces,totalTables:t.totalTables,totalRows:t.totalRows,totalSize:t.totalSize}),me(C);const f=new Map(o.map(n=>[n.name,n])),u=m.map(n=>{const S=f.get(n.name);return{...n,size:S?.size??n.size??0,tables:x.filter(v=>v.keyspace===n.name).length}});B(u);const k=new Map(R.map(n=>[`${n.keyspace}.${n.name}`,n])),E=x.map(n=>{const S=k.get(`${n.keyspace}.${n.name}`);return{...n,...S&&{columns:S.columns}}});F(E)}else ie(null),B(o),F(R),me(I)},500);return()=>clearInterval(s)},[T,L,o,R]);const Ce=l?.totalSize?l.totalSize/(1024*1024*1024):g.totalSize||o.reduce((s,a)=>s+a.size,0),K=l&&(l.readOperationsPerSecond>0||l.totalRows>0)?l.readLatency:null,ue=l&&(l.writeOperationsPerSecond>0||l.totalRows>0)?l.writeLatency:null,Y=de.length>0?de:o,he=oe.length>0?oe:R,je=xe.length>0?xe:I,y=s=>{ye(T,{data:{...L.data,config:{...g,...s}}})},we=()=>{y({keyspaces:[...o,{name:"new_keyspace",replication:re,tables:0,size:0}]})},Te=s=>{y({keyspaces:o.filter((a,t)=>t!==s)})},pe=(s,a,t)=>{const m=[...o];m[s]={...m[s],[a]:t},y({keyspaces:m})},Ee=()=>{if(!N.trim())return;const s=`query-${Date.now()}`,a=Date.now(),t={id:s,query:N,status:"running",duration:0,rowsReturned:0},m=z.getCassandraRoutingEngine(T);let x=t;if(m)try{const C=m.executeCQL(N,V),f=Date.now()-a;if(x={id:s,query:N,status:C.success?"success":"error",duration:f,rowsReturned:C.rowCount||0},C.success){const u=N.trim().toUpperCase();if(u.startsWith("CREATE TABLE")||u.startsWith("CREATE KEYSPACE")||u.startsWith("DROP TABLE")||u.startsWith("DROP KEYSPACE")){const k=m.getKeyspaces(),E=m.getTables(),n=new Map(o.map(v=>[v.name,v])),S=k.map(v=>{const Se=n.get(v.name);return{...v,size:Se?.size||v.size||0,tables:E.filter(Le=>Le.keyspace===v.name).length}});y({keyspaces:S,tables:E}),B(S),F(E)}}}catch{const f=Date.now()-a;x={id:s,query:N,status:"error",duration:f,rowsReturned:0}}else x.status="success",x.duration=Date.now()-a;y({queries:[x,...W.slice(0,9)]}),q(""),O(!1)};return e.jsx("div",{className:"h-full overflow-y-auto bg-background",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(te,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Apache Cassandra"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Distributed NoSQL Database"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(A,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full animate-pulse ${l&&l.healthyNodes>0&&l.healthyNodes===l.totalNodes?"bg-green-500":l&&l.healthyNodes>0?"bg-yellow-500":"bg-red-500"}`}),l&&l.totalNodes>0?`Cluster ${l.healthyNodes===l.totalNodes?"Healthy":"Degraded"}`:"Cluster Not Initialized"]})})]}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Nodes"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l?.totalNodes??je.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Cluster nodes"})]})]}),e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Keyspaces"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l?.totalKeyspaces??o.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total keyspaces"})]})]}),e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Read Latency"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:K!==null?`${K}ms`:"—"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:K!==null?"Average":"No activity"})]})]}),e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Data Size"})}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Ce.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"GB"})]})]})]}),e.jsxs(Ke,{defaultValue:"keyspaces",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-5",children:[e.jsxs(Q,{value:"keyspaces",className:"gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Keyspaces"]}),e.jsxs(Q,{value:"tables",className:"gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Tables"]}),e.jsxs(Q,{value:"cql",className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"CQL Shell"]}),e.jsxs(Q,{value:"cluster",className:"gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"Cluster"]}),e.jsxs(Q,{value:"settings",className:"gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Settings"]})]}),e.jsx(M,{value:"keyspaces",className:"space-y-4 mt-4",children:e.jsxs(c,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Keyspaces"}),e.jsx(b,{children:"Cassandra keyspace configuration"})]}),e.jsxs(p,{size:"sm",onClick:we,variant:"outline",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Create Keyspace"]})]})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-3",children:Y.map((s,a)=>e.jsxs(c,{className:"border-border",children:[e.jsx(i,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded bg-primary/10",children:e.jsx(te,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(d,{className:"text-lg",children:s.name}),e.jsxs(b,{className:"text-xs mt-1",children:[s.tables," tables • Replication: ",s.replication," • Size: ",s.size," GB",s.replicationStrategy&&` • ${s.replicationStrategy}`]})]})]}),Y.length>1&&e.jsx(p,{size:"icon",variant:"ghost",onClick:()=>Te(a),children:e.jsx(Qe,{className:"h-4 w-4"})})]})}),ne===a&&e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Replication Factor"}),e.jsx(P,{type:"number",value:s.replication,onChange:t=>pe(a,"replication",Number(t.target.value)),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Replication Strategy"}),e.jsxs(J,{value:s.replicationStrategy||"NetworkTopologyStrategy",onValueChange:t=>pe(a,"replicationStrategy",t),children:[e.jsx(Z,{children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(j,{value:"SimpleStrategy",children:"Simple Strategy"}),e.jsx(j,{value:"NetworkTopologyStrategy",children:"Network Topology Strategy"})]})]})]})]}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>ce(null),children:"Done"})]}),ne!==a&&e.jsx(r,{children:e.jsx(p,{size:"sm",variant:"outline",onClick:()=>ce(a),children:"Edit Settings"})})]},a))})})]})}),e.jsx(M,{value:"tables",className:"space-y-4 mt-4",children:e.jsxs(c,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Tables"}),e.jsx(b,{children:"Cassandra table configuration"})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>D(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Create Table"]})]})}),e.jsxs(r,{children:[be&&e.jsxs(c,{className:"mb-4 border-primary",children:[e.jsxs(i,{children:[e.jsx(d,{children:"Create New Table"}),e.jsx(b,{children:"Create a table in a keyspace"})]}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Keyspace"}),e.jsxs(J,{value:$,onValueChange:H,children:[e.jsx(Z,{children:e.jsx(ee,{})}),e.jsx(se,{children:Y.map(s=>e.jsx(j,{value:s.name,children:s.name},s.name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Table Name"}),e.jsx(P,{value:U,onChange:s=>_(s.target.value),placeholder:"users"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:async()=>{if(!U.trim()||!$)return;const s=`CREATE TABLE ${$}.${U.trim()} (id UUID PRIMARY KEY, data TEXT)`;let a=z.getCassandraRoutingEngine(T);if(!a&&L&&(z.initialize(le,Ne||[]),a=z.getCassandraRoutingEngine(T)),a)try{console.log("Executing CREATE TABLE:",s);const t=a.executeCQL(s,V);if(console.log("CREATE TABLE result:",t),t.success){const m=a.getKeyspaces(),x=a.getTables();console.log("Engine keyspaces:",m),console.log("Engine tables:",x);const C=new Map(o.map(u=>[u.name,u])),f=m.map(u=>{const k=C.get(u.name);return{...u,size:k?.size||0,tables:x.filter(E=>E.keyspace===u.name).length}});console.log("Merged keyspaces:",f),console.log("Merged tables:",x),y({keyspaces:f,tables:x}),B(f),F(x),_(""),H(o[0]?.name||"system"),D(!1)}else console.error("CREATE TABLE failed:",t.error),alert(`Failed to create table: ${t.error||"Unknown error"}`)}catch(t){console.error("CREATE TABLE error:",t),alert(`Error creating table: ${t instanceof Error?t.message:"Unknown error"}`)}else console.warn("Cassandra engine not available, using CQL Shell fallback"),q(s),D(!1),O(!0)},disabled:!U.trim()||!$,children:"Create Table"}),e.jsx(p,{variant:"outline",onClick:()=>{D(!1),_(""),H(o[0]?.name||"system")},children:"Cancel"})]})]})]}),he.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No tables created"}):e.jsx("div",{className:"space-y-3",children:he.map((s,a)=>e.jsx(c,{className:"border-border",children:e.jsx(i,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx(d,{className:"text-lg",children:s.name}),e.jsxs(b,{className:"text-xs mt-1",children:[s.keyspace," • ",s.rows||0," rows • ",s.size?`${s.size} GB`:"N/A"]})]})]})})})},a))})]})]})}),e.jsx(M,{value:"cql",className:"space-y-4 mt-4",children:e.jsxs(c,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{children:"CQL Shell"}),e.jsx(b,{children:"Execute CQL queries"})]}),e.jsxs(p,{size:"sm",onClick:()=>O(!0),variant:"outline",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"New Query"]})]})}),e.jsxs(r,{children:[ve&&e.jsxs(c,{className:"mb-4 border-primary",children:[e.jsx(i,{children:e.jsx(d,{children:"Execute CQL Query"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"CQL Query"}),e.jsx(Oe,{value:N,onChange:s=>q(s.target.value),placeholder:"SELECT * FROM keyspace.table LIMIT 10;",rows:6,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:Ee,disabled:!N.trim(),title:N.trim()?"Execute CQL query":"Enter a CQL query to execute",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Execute"]}),e.jsx(p,{variant:"outline",onClick:()=>{O(!1),q("")},children:"Cancel"})]})]})]}),W.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No queries executed"}):e.jsx("div",{className:"space-y-2",children:W.map(s=>e.jsx(c,{className:"border-l-4 border-l-blue-500",children:e.jsx(r,{className:"pt-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(A,{variant:s.status==="success"?"default":s.status==="error"?"destructive":"secondary",children:s.status}),s.duration!==void 0&&e.jsxs(A,{variant:"outline",children:[s.duration,"ms"]}),s.rowsReturned!==void 0&&e.jsxs(A,{variant:"outline",children:[s.rowsReturned," rows"]})]}),e.jsx("pre",{className:"text-xs font-mono bg-muted p-2 rounded overflow-x-auto",children:s.query})]})})})},s.id))})]})]})}),e.jsx(M,{value:"cluster",className:"space-y-4 mt-4",children:e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Cluster Nodes"}),e.jsx(b,{children:"Cassandra cluster topology"})]}),e.jsx(r,{children:e.jsx("div",{className:"space-y-3",children:je.map((s,a)=>e.jsxs(c,{className:"border-border",children:[e.jsx(i,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${s.status==="up"?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx(d,{className:"text-lg",children:s.address}),e.jsxs(b,{className:"text-xs mt-1",children:[s.tokens," tokens • Load: ",(s.load*100).toFixed(1),"%"]})]})]}),e.jsx(A,{variant:s.status==="up"?"default":"destructive",children:s.status.toUpperCase()})]})}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Load:"}),e.jsxs("span",{className:"font-semibold",children:[(s.load*100).toFixed(1),"%"]})]}),e.jsx(ae,{value:s.load*100,className:"h-2"})]})})]},a))})})]})}),e.jsx(M,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Cluster Settings"}),e.jsx(b,{children:"Cassandra cluster configuration"})]}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Read Latency"})}),e.jsxs(r,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[K,"ms"]}),e.jsx(ae,{value:Math.min(K/10*100,100),className:"h-2 mt-2"})]})]}),e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(d,{className:"text-sm font-medium",children:"Write Latency"})}),e.jsxs(r,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[ue,"ms"]}),e.jsx(ae,{value:Math.min(ue/10*100,100),className:"h-2 mt-2"})]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"cluster-name",children:"Cluster Name"}),e.jsx(P,{id:"cluster-name",value:fe,onChange:s=>y({clusterName:s.target.value}),placeholder:"my-cluster"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"replication-factor",children:"Default Replication Factor"}),e.jsx(P,{id:"replication-factor",type:"number",min:"1",max:"10",value:re,onChange:s=>y({replicationFactor:parseInt(s.target.value)||3})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default replication factor for new keyspaces. Can be overridden per keyspace."})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"default-consistency-level",children:"Default Consistency Level"}),e.jsxs(J,{value:V,onValueChange:s=>y({consistencyLevel:s}),children:[e.jsx(Z,{id:"default-consistency-level",children:e.jsx(ee,{placeholder:"Select consistency level"})}),e.jsxs(se,{children:[e.jsx(j,{value:"ONE",children:"ONE"}),e.jsx(j,{value:"TWO",children:"TWO"}),e.jsx(j,{value:"THREE",children:"THREE"}),e.jsx(j,{value:"QUORUM",children:"QUORUM"}),e.jsx(j,{value:"ALL",children:"ALL"}),e.jsx(j,{value:"LOCAL_ONE",children:"LOCAL_ONE"}),e.jsx(j,{value:"LOCAL_QUORUM",children:"LOCAL_QUORUM"}),e.jsx(j,{value:"EACH_QUORUM",children:"EACH_QUORUM"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default consistency level for CQL queries. Can be overridden per query using CONSISTENCY command or in CQL Shell."})]}),e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 dark:bg-blue-950 dark:border-blue-800 p-3",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("strong",{children:"Note:"})," In real Apache Cassandra, consistency level is specified per query/session, not as a global cluster setting. This is a default value used when not explicitly specified in queries."]})})]})]})})]})]})})}export{Ie as CassandraConfigAdvanced};
