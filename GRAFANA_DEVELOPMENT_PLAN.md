# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ Grafana

## –†–µ–∑—é–º–µ –∞–Ω–∞–ª–∏–∑–∞

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
1. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ Sidebar**: –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `COMPONENT_LIBRARY`
2. **EmulationEngine**: –ë–∞–∑–æ–≤–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
3. **Connection Rules**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ datasource –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Prometheus
4. **Config Panel**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ HTTP —Ç—Ä–∞—Ñ–∏–∫–∞**: Grafana –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Prometheus —á–µ—Ä–µ–∑ DataFlowEngine
2. **–•–∞—Ä–¥–∫–æ–¥ –≤ Config Panel**: –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
3. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–º—É–ª—è—Ü–∏—è**: Latency —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. **–ù–µ—Ç Routing Engine**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç GrafanaRoutingEngine –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è:
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PrometheusEmulationEngine –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è queries
2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π
3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ canvas
4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ queries

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ

1. **–ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**:
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ `src/data/components.ts`: `{ id: 'grafana', type: 'grafana', label: 'Grafana', icon: 'üìà', color: '#F56815', category: 'observability' }`
   - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ Sidebar —Å draggable —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
   - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ UI/UX**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `renderComponentCard()` –≤ `Sidebar.tsx`
   - ‚úÖ **–ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ `COMPONENT_LIBRARY`, –Ω–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è Grafana
   - ‚úÖ **Draggable —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç `draggable` –∞—Ç—Ä–∏–±—É—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `onDragStart`
   - ‚úÖ **–°—Ç–∏–ª–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—â–∏–µ –∫–ª–∞—Å—Å—ã Tailwind, –Ω–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è Grafana

2. **EmulationEngine**:
   - `GrafanaEmulationEngine.ts` - —Å–∏–º—É–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É Grafana
   - –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫: queriesPerSecond, dashboardRefreshesPerSecond, alertEvaluationsPerSecond
   - –°–∏–º—É–ª—è—Ü–∏—è query execution —Å —É—á–µ—Ç–æ–º complexity
   - –°–∏–º—É–ª—è—Ü–∏—è panel rendering
   - –†–∞—Å—á–µ—Ç CPU –∏ memory utilization

3. **Connection Rules**:
   - `grafanaRules.ts` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ datasource –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Prometheus
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫) –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–æ–±—ä–µ–∫—Ç—ã)

4. **Config Panel**:
   - `GrafanaConfigAdvanced.tsx` - –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è dashboards, panels, queries, alerts, datasources
   - `GrafanaDashboardViewer.tsx` - –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–æ–≤
   - `GrafanaDashboardPreview.tsx` - –ø—Ä–µ–≤—å—é –¥–∞—à–±–æ—Ä–¥–æ–≤

5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EmulationEngine**:
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ `EmulationEngine.initialize()`
   - –°–∏–º—É–ª—è—Ü–∏—è –≤ `EmulationEngine.simulateGrafana()`
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Loki queries —á–µ—Ä–µ–∑ `createLokiQueryExecutor()`

### –ü—Ä–æ–±–ª–µ–º—ã –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ ‚ùå

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ HTTP —Ç—Ä–∞—Ñ–∏–∫–∞**:
   - Grafana –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Prometheus —á–µ—Ä–µ–∑ DataFlowEngine
   - Queries —Å–∏–º—É–ª–∏—Ä—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ GrafanaEmulationEngine, –Ω–æ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö DataMessage –æ—Ç Grafana –∫ Prometheus

2. **–•–∞—Ä–¥–∫–æ–¥ latency**:
   - Latency —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ (50ms + complexity * 10ms)
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è latency —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É Grafana –∏ Prometheus
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Prometheus

3. **–ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus**:
   - –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PrometheusEmulationEngine –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è queries
   - –ù–µ—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ HTTP API Prometheus (`/api/v1/query`, `/api/v1/query_range`)
   - –ù–µ—Ç —É—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫ Prometheus (throughput, latency) –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ query latency

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Routing Engine**:
   - Grafana –Ω–µ –∏–º–µ–µ—Ç RoutingEngine –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ datasources
   - –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

5. **–ù–µ–ø–æ–ª–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**:
   - –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ Grafana –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Prometheus API
   - –ù–µ—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ Grafana HTTP API endpoints
   - –ù–µ—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è queries

6. **UI/UX –ø—Ä–æ–±–ª–µ–º—ã** (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–µ–Ω–æ):
   - ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ Sidebar: –ø—Ä–æ–≤–µ—Ä–µ–Ω, —Ö–∞—Ä–¥–∫–æ–¥–∞ –Ω–µ—Ç, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `COMPONENT_LIBRARY`
   - ‚ùå –ù–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Grafana –∫ Prometheus –Ω–∞ canvas
   - ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Config Panel –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## –†–µ–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Grafana

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Grafana –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏

1. **Pull-based –º–æ–¥–µ–ª—å**:
   - Grafana –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ datasources (Prometheus, Loki –∏ —Ç.–¥.) –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
   - –ó–∞–ø—Ä–æ—Å—ã –∏–Ω–∏—Ü–∏–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏:
     - –û—Ç–∫—Ä—ã—Ç–∏–∏ dashboard –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
     - –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ dashboard –ø–æ refresh interval
     - –û—Ü–µ–Ω–∫–µ alert rules

2. **HTTP API Prometheus**:
   - Instant queries: `GET /api/v1/query?query=<promql>&time=<timestamp>`
   - Range queries: `GET /api/v1/query_range?query=<promql>&start=<start>&end=<end>&step=<step>`
   - Grafana –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤**:
   - Grafana ‚Üí HTTP Request ‚Üí Prometheus API ‚Üí Response ‚Üí Grafana
   - –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Grafana proxy (–µ—Å–ª–∏ access: 'proxy')
   - –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (–µ—Å–ª–∏ access: 'direct')

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - Grafana –∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã queries –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –ö—ç—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö queries –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏

5. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ datasources**:
   - Grafana –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º Prometheus instances
   - –ö–∞–∂–¥—ã–π panel –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π datasource
   - Queries –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∫ —Ä–∞–∑–Ω—ã–º datasources

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ò–∑—É—á–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã

**–§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:**

1. `src/core/EmulationEngine.ts`:
   - –ö–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –¥–≤–∏–∂–∫–∏ (—Å—Ç—Ä–æ–∫–∏ ~2000-3000)
   - –ö–∞–∫ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `simulateGrafana()` (—Å—Ç—Ä–æ–∫–∞ 6743)
   - –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç—Å—è –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å DataFlowEngine

2. `src/core/DataFlowEngine.ts`:
   - –ö–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç DataMessage
   - –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è HTTP –∑–∞–ø—Ä–æ—Å—ã
   - –ö–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω–∏—Ü–∏–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

3. `src/services/connection/ServiceDiscovery.ts`:
   - –ö–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∏–º–µ–Ω–∞/–ø–æ—Ä—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ö–∞–∫ –ø–æ–ª—É—á–∞–µ—Ç—Å—è URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

4. `src/core/PrometheusEmulationEngine.ts`:
   - –ö–∞–∫ Prometheus –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç queries
   - –ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –µ—Å—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è PromQL queries
   - –ö–∞–∫ Prometheus –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å DataFlowEngine

5. –ü–æ—Ö–æ–∂–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:
   - `src/core/GraphQLEmulationEngine.ts` - –∫–∞–∫ GraphQL –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
   - `src/core/KongRoutingEngine.ts` - –∫–∞–∫ Kong –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
   - `src/core/BFFRoutingEngine.ts` - –∫–∞–∫ BFF –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ backend

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ GrafanaRoutingEngine ‚úÖ

**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å RoutingEngine –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Grafana –∫ datasources.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

**–§–∞–π–ª**: `src/core/GrafanaRoutingEngine.ts` ‚úÖ

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
1. ‚úÖ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è queries –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É datasource (Prometheus, Loki –∏ —Ç.–¥.)
2. ‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Prometheus API —á–µ—Ä–µ–∑ PromQLEvaluator:
   - Instant queries: `/api/v1/query`
   - Range queries: `/api/v1/query_range`
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Prometheus
4. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources (Prometheus, Loki)
5. ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ Prometheus instances (round-robin –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
6. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ queries –¥–ª—è instant queries (TTL 5 —Å–µ–∫—É–Ω–¥)
7. ‚úÖ –£—á–µ—Ç latency —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É Grafana –∏ Prometheus/Loki

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**:
```typescript
export class GrafanaRoutingEngine {
  routeQuery(
    query: GrafanaPanelQuery,
    datasource: GrafanaDataSource,
    timeRange?: { from: number; to: number },
    isRangeQuery?: boolean
  ): {
    success: boolean;
    latency: number;
    data?: any;
    error?: string;
  }
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ServiceDiscovery –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL Prometheus
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PromQLEvaluator –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è queries (—á–µ—Ä–µ–∑ createPrometheusQueryExecutor)
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—Ç—å latency —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É Grafana –∏ Prometheus
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏: round-robin –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ Prometheus/Loki instances

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DataFlowEngine ‚úÖ

**–¶–µ–ª—å**: Grafana –¥–æ–ª–∂–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Prometheus —á–µ—Ä–µ–∑ DataFlowEngine.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `GrafanaEmulationEngine.ts`**:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç GrafanaRoutingEngine
2. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–º—É–ª—è—Ü–∏—è queries –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ RoutingEngine:
   ```typescript
   // –¢–µ–ø–µ—Ä—å:
   const result = await this.routingEngine.routeQuery(query, datasource, timeRange, isRangeQuery);
   const queryLatency = result.latency;
   ```

3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PrometheusEmulationEngine –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è queries:
   - ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç—Å—è Prometheus node –ø–æ datasource URL —á–µ—Ä–µ–∑ ServiceDiscovery
   - ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç—Å—è PromQLEvaluator –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è query —á–µ—Ä–µ–∑ createPrometheusQueryExecutor
   - ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è latency –∏ –¥–∞–Ω–Ω—ã–µ
4. ‚úÖ –ú–µ—Ç–æ–¥ performUpdate —Å—Ç–∞–ª async –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è queries (cache hit —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `DataFlowEngine.ts`**:

1. –î–æ–±–∞–≤–∏—Ç—å handler –¥–ª—è Grafana:
   ```typescript
   if (type === 'grafana') {
     return {
       processData: (node, message, config) => {
         // Grafana –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
         // –û–Ω —Ç–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
         message.status = 'delivered';
         return message;
       }
     };
   }
   ```

2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Grafana:
   ```typescript
   initiateGrafanaQuery(
     grafanaNode: CanvasNode,
     targetNode: CanvasNode,
     query: string,
     queryType: 'instant' | 'range',
     timeRange?: { from: number; to: number }
   ): DataMessage
   ```

### –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏ queries ‚úÖ

**–¶–µ–ª—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ latency.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `GrafanaEmulationEngine.ts`**:

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PromQLEvaluator –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è queries –Ω–∞–¥ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. ‚ö†Ô∏è –£—á–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Prometheus (—á–∞—Å—Ç–∏—á–Ω–æ - latency —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ PromQLEvaluator, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è utilization –Ω–∞–ø—Ä—è–º—É—é)
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è latency —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
   ```typescript
   const connectionLatency = connection?.data?.latency || 0;
   const totalLatency = connectionLatency + result.latency;
   ```
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - ‚úÖ –ö—ç—à–∏—Ä—É—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã instant queries (TTL 5 —Å–µ–∫—É–Ω–¥)
   - ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è cache hit rate –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö (cachedQueries)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ expired cache

### –≠—Ç–∞–ø 5: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources

**–¶–µ–ª—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º Prometheus instances –∏ –¥—Ä—É–≥–∏–º datasources.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

1. –í `GrafanaRoutingEngine.ts`:
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∫ —Ä–∞–∑–Ω—ã–º datasources
   - –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ Prometheus instances
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Loki, InfluxDB –∏ –¥—Ä—É–≥–∏—Ö datasources

2. –í `GrafanaEmulationEngine.ts`:
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ queries –¥–ª—è —Ä–∞–∑–Ω—ã—Ö datasources
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ queries –∫ —Ä–∞–∑–Ω—ã–º datasources
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –æ—Ç —Ä–∞–∑–Ω—ã—Ö datasources

3. –í `grafanaRules.ts`:
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º Prometheus instances
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ datasource –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –≠—Ç–∞–ø 6: –£–ª—É—á—à–µ–Ω–∏–µ UI/UX

**–¶–µ–ª—å**: –£–ª—É—á—à–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∏ —É–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥.

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:

1. **Sidebar –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`src/components/layout/Sidebar.tsx`):
   - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `renderComponentCard()`
   - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ `COMPONENT_LIBRARY[32]` (Grafana)
   - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: –°—Ç–∏–ª–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ, –Ω–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è Grafana
   - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: Draggable —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **Config Panel** (`src/components/config/observability/GrafanaConfigAdvanced.tsx`):
   - ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–ø–µ—Ä—å –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è:
     - ‚úÖ `const adminUser = config.adminUser || profileDefaults.adminUser;`
     - ‚úÖ `const adminPassword = config.adminPassword || profileDefaults.adminPassword;`
     - ‚úÖ `const defaultDashboard = config.defaultDashboard || profileDefaults.defaultDashboard;`
     - ‚úÖ `const theme = config.theme || profileDefaults.theme;`
     - ‚úÖ `datasources` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –∏–ª–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞)
   - ‚úÖ **–ü—Ä–æ—Ñ–∏–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `OBSERVABILITY_PROFILES` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `profileDefaults`
   - ‚úÖ **–£–±—Ä–∞–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ dashboards**: –í–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ dashboard –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Å–∞–º)

3. **Dashboard Viewer**:
   - ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ EmulationEngine
   - ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ queries –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ RoutingEngine (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
   - ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç—Ä–∏–∫

4. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Canvas**:
   - ‚ùå **–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Grafana –∫ Prometheus
   - ‚ùå **–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å queries –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - ‚ùå **–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å latency –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ connection lines

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–¶–µ–ª—å**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.

**–¢–µ—Å—Ç—ã**:

1. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
   - Grafana –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Prometheus
   - Queries –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ PrometheusEmulationEngine
   - Latency —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Grafana –∫ Prometheus —á–µ—Ä–µ–∑ connection
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ datasource
   - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ queries –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Prometheus

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫**:
   - –ú–µ—Ç—Ä–∏–∫–∏ Grafana —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
   - CPU –∏ memory utilization —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - Query latency —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ UI/UX**:
   - –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –≤ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
   - –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ñ–∞–π–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **`src/core/GrafanaRoutingEngine.ts`** ‚úÖ (–Ω–æ–≤—ã–π):
   - ‚úÖ –ö–ª–∞—Å—Å `GrafanaRoutingEngine`
   - ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ queries –∫ datasources (`routeQuery`)
   - ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PrometheusEmulationEngine —á–µ—Ä–µ–∑ PromQLEvaluator
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Prometheus –∏ Loki datasources
   - ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ queries
   - ‚úÖ –£—á–µ—Ç latency —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

1. **`src/core/GrafanaEmulationEngine.ts`** ‚úÖ:
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `GrafanaRoutingEngine`
   - ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–º—É–ª—è—Ü–∏—è queries –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus —á–µ—Ä–µ–∑ PromQLEvaluator
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è queries
   - ‚úÖ –ú–µ—Ç–æ–¥ `performUpdate` —Å—Ç–∞–ª async

2. **`src/core/EmulationEngine.ts`** ‚úÖ:
   - ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è `GrafanaRoutingEngine` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Grafana node
   - ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è `GrafanaRoutingEngine` –≤ `GrafanaEmulationEngine`
   - ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `createPrometheusQueryExecutor` –∏ `createLokiQueryExecutorForRouting`
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ nodes –∏ connections –≤ RoutingEngine –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ü–∏–∫–ª–µ —Å–∏–º—É–ª—è—Ü–∏–∏

3. **`src/core/DataFlowEngine.ts`**:
   - ‚ö†Ô∏è Handler –¥–ª—è Grafana –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (Grafana –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ)
   - ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ PromQLEvaluator –Ω–∞–ø—Ä—è–º—É—é

4. **`src/services/connection/rules/grafanaRules.ts`**:
   - ‚ö†Ô∏è –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö Prometheus instances (–æ—Å—Ç–∞–ª–æ—Å—å –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)

5. **`src/components/config/observability/GrafanaConfigAdvanced.tsx`** ‚úÖ:
   - ‚úÖ –£–±—Ä–∞–Ω —Ö–∞—Ä–¥–∫–æ–¥ - –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
   - ‚úÖ –£–±—Ä–∞–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ dashboards

6. **`src/components/layout/Sidebar.tsx`**:
   - ‚úÖ –£–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ä–∞–Ω–µ–µ - –Ω–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `COMPONENT_LIBRARY`

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. ‚úÖ Grafana –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Prometheus —á–µ—Ä–µ–∑ GrafanaRoutingEngine
2. ‚úÖ Queries –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ PromQLEvaluator —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. ‚úÖ Latency —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é latency —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É Grafana –∏ Prometheus/Loki
4. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources (Prometheus, Loki)
5. ‚úÖ –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –≤ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö - –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
6. ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ Grafana —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (queries, cache hits, errors)
7. ‚ö†Ô∏è –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Dashboard Viewer)
8. ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ `.cursor/rules/context.mdc` –∏ `.cursor/rules/connectionsrules.mdc`

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–≤–µ—Ä—Å–∏—è 0.1.8s)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ GrafanaRoutingEngine
- ‚úÖ –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DataFlowEngine (—á–µ—Ä–µ–∑ PromQLEvaluator)
- ‚úÖ –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏ queries (—Ä–µ–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –≠—Ç–∞–ø 6: –£–ª—É—á—à–µ–Ω–∏–µ UI/UX (—É–±—Ä–∞–Ω—ã —Ö–∞—Ä–¥–∫–æ–¥—ã)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- ‚úÖ –≠—Ç–∞–ø 5: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (round-robin)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ö–∞—Ä–¥–∫–æ–¥ –≤ `getActiveDatasources()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è placeholder URL –≤–º–µ—Å—Ç–æ `localhost:9090`
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ Prometheus instances (round-robin –∞–ª–≥–æ—Ä–∏—Ç–º)
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ Loki instances (round-robin –∞–ª–≥–æ—Ä–∏—Ç–º)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ Canvas –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `addMessage` –≤ DataFlowEngine –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
  - ‚úÖ GrafanaRoutingEngine —Å–æ–∑–¥–∞–µ—Ç DataMessage –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ queries –∫ Prometheus/Loki
  - ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ connection lines –º–µ–∂–¥—É Grafana –∏ datasources
  - ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ö–∞—Ä–¥–∫–æ–¥–∞ - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ queries

### ‚ùå –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (–¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π):
- ‚ùå –≠—Ç–∞–ø 7: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ù–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–ø–æ** –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–Ω–∏–∫–∞–ª–µ–Ω
- **–û–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** Grafana –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ò–∑–±–µ–≥–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥–∞** - –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—Ä–∞—Ç—å—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–°–ª–µ–¥–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º** –∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É Grafana
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò–∑—É—á–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã (–≠—Ç–∞–ø 1)
2. –°–æ–∑–¥–∞—Ç—å GrafanaRoutingEngine (–≠—Ç–∞–ø 2)
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å DataFlowEngine (–≠—Ç–∞–ø 3)
4. –£–ª—É—á—à–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é queries (–≠—Ç–∞–ø 4)
5. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö datasources (–≠—Ç–∞–ø 5)
6. –£–ª—É—á—à–∏—Ç—å UI/UX (–≠—Ç–∞–ø 6)
7. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å (–≠—Ç–∞–ø 7)
